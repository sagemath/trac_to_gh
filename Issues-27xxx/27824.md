# Issue 27824: spkg-configure.m4 for python3

archive/issues_027587.json:
```json
{
    "assignees": [],
    "body": "Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n\nAs suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. \n\nThis is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.\n\nThe venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n\n(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)\n\n\n\nCC:  @jdemeyer @embray @vbraun @kiwifb @jhpalmieri @videlec\n\nBranch: **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe, Erik Bray**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27824_\n\n",
    "closed_at": "2020-03-29T00:24:15Z",
    "created_at": "2019-05-13T15:52:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spkg-configure.m4 for python3",
    "type": "issue",
    "updated_at": "2020-05-18T17:36:15Z",
    "url": "https://github.com/sagemath/sage/issues/27824",
    "user": "https://github.com/dimpase"
}
```
Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.

As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. 

This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.

The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.

(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)



CC:  @jdemeyer @embray @vbraun @kiwifb @jhpalmieri @videlec

Branch: **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe, Erik Bray**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/27824_





---

archive/issue_events_378693.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-13T15:52:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378693"
}
```



---

archive/issue_events_378694.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-13T15:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378694"
}
```



---

archive/issue_events_378695.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-13T15:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378695"
}
```



---

archive/issue_events_378696.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-13T15:52:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378696"
}
```



---

archive/issue_comments_431679.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,15 @@\n \n At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.\n \n-\n+while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:\n+* cysignals\n+* cython\n+* ipython\n+* jinja2\n+* jupyter_core\n+* numpy\n+* scipy\n+* sympy\n+* pip\n+* setuptools\n+* six\n``````\n",
    "created_at": "2019-05-13T15:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431679",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,15 @@
 
 At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.
 
-
+while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
+* cysignals
+* cython
+* ipython
+* jinja2
+* jupyter_core
+* numpy
+* scipy
+* sympy
+* pip
+* setuptools
+* six
``````




---

archive/issue_comments_431680.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,5 @@\n * sympy\n * pip\n * setuptools\n+* pkgconfig\n * six\n``````\n",
    "created_at": "2019-05-13T21:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431680",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,5 @@
 * sympy
 * pip
 * setuptools
+* pkgconfig
 * six
``````




---

archive/issue_events_378697.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378697"
}
```



---

archive/issue_comments_431681.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431681",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_431682.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFor Python packages when installing using the system Python we definitely need a well thought out approach, likely with different options for handling questions such as where to install additional Python packages.\n\n`$SAGE_LOCAL` *already* acts as a sort-of virtualenv, but we might still consider using virtualenv/venv in `$SAGE_LOCAL` (with the `--system-site-packages` option) as a way of extending `sys.path` while still using as many system Python packages as possible.",
    "created_at": "2019-08-14T11:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431682",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

For Python packages when installing using the system Python we definitely need a well thought out approach, likely with different options for handling questions such as where to install additional Python packages.

`$SAGE_LOCAL` *already* acts as a sort-of virtualenv, but we might still consider using virtualenv/venv in `$SAGE_LOCAL` (with the `--system-site-packages` option) as a way of extending `sys.path` while still using as many system Python packages as possible.



---

archive/issue_comments_431683.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSee #29013 - \"In a python3 build, install all Python packages into a venv\"",
    "created_at": "2020-01-14T22:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431683",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

See #29013 - "In a python3 build, install all Python packages into a venv"



---

archive/issue_comments_431684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,5 @@\n-do not install pythonX if we are in the virtenv of pythonX.\n+Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.\n+Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.\n \n-while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:\n-* cysignals\n-* cython\n-* ipython\n-* jinja2\n-* jupyter_core\n-* numpy\n-* scipy\n-* sympy\n-* pip\n-* setuptools\n-* pkgconfig\n-* six\n+\n``````\n",
    "created_at": "2020-01-15T02:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431684",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,5 @@
-do not install pythonX if we are in the virtenv of pythonX.
+Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.
+Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.
 
-while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
-* cysignals
-* cython
-* ipython
-* jinja2
-* jupyter_core
-* numpy
-* scipy
-* sympy
-* pip
-* setuptools
-* pkgconfig
-* six
+
``````




---

archive/issue_comments_431685.json:
```json
{
    "body": "Dependencies: **#29013**",
    "created_at": "2020-01-15T02:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431685",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29013**



---

archive/issue_comments_431686.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNarrowed the ticket to py3.",
    "created_at": "2020-01-15T02:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431686",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Narrowed the ticket to py3.



---

archive/issue_events_378698.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T02:05:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "title_is": "spkg-configure.m4 for python3",
    "title_was": "spkg-configure.m4 for pythons",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378698"
}
```



---

archive/issue_comments_431687.json:
```json
{
    "body": "Branch: **[public/27824-python3-spkg-configure](https://github.com/sagemath/sagetrac-mirror/tree/public/27824-python3-spkg-configure)**",
    "created_at": "2020-01-15T04:42:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431687",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[public/27824-python3-spkg-configure](https://github.com/sagemath/sagetrac-mirror/tree/public/27824-python3-spkg-configure)**



---

archive/issue_comments_431688.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHere's a version that works. The venv is created in `build/make/Makefile` target (in #29013, I created the venv in the `spkg-postinst` script of the `python3` spkg.) \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44\"><code>1363425</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9\"><code>a394268</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410\"><code>a84815b</code></a></td><td><code>spkg-configure.m4 for python3</code></td></tr></table>\n",
    "created_at": "2020-01-15T04:45:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431688",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Here's a version that works. The venv is created in `build/make/Makefile` target (in #29013, I created the venv in the `spkg-postinst` script of the `python3` spkg.) 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44"><code>1363425</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9"><code>a394268</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410"><code>a84815b</code></a></td><td><code>spkg-configure.m4 for python3</code></td></tr></table>




---

archive/issue_comments_431689.json:
```json
{
    "body": "Commit: **[`a84815b`](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)**",
    "created_at": "2020-01-15T04:45:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431689",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`a84815b`](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)**



---

archive/issue_events_378699.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T04:48:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378699"
}
```



---

archive/issue_comments_431690.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-01-15T04:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431690",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_431691.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nhow about checking for Py3 deps: `sqlite libpng bzip2 xz libffi` ?\n(I skipped in this list ones that are 2nd order, so no need to check them)",
    "created_at": "2020-01-15T10:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431691",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

how about checking for Py3 deps: `sqlite libpng bzip2 xz libffi` ?
(I skipped in this list ones that are 2nd order, so no need to check them)



---

archive/issue_comments_431692.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOn Gentoo Python 3 does not have sqlite module by default. I had to do\n`$ pip install pysqlite3 --user`, and still `elliptic_curves` spkg installation errors out.",
    "created_at": "2020-01-15T11:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431692",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

On Gentoo Python 3 does not have sqlite module by default. I had to do
`$ pip install pysqlite3 --user`, and still `elliptic_curves` spkg installation errors out.



---

archive/issue_comments_431693.json:
```json
{
    "body": "Changed commit from **[`a84815b`](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)** to **[`0d0495f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)**",
    "created_at": "2020-01-15T14:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431693",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a84815b`](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)** to **[`0d0495f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)**



---

archive/issue_comments_431694.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f\"><code>0d0495f</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi</code></td></tr></table>\n",
    "created_at": "2020-01-15T14:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431694",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f"><code>0d0495f</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi</code></td></tr></table>




---

archive/issue_comments_431695.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a\"><code>98dff9d</code></a></td><td><code>Remove use of --system-site-packages</code></td></tr></table>\n",
    "created_at": "2020-01-15T14:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431695",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a"><code>98dff9d</code></a></td><td><code>Remove use of --system-site-packages</code></td></tr></table>




---

archive/issue_comments_431696.json:
```json
{
    "body": "Changed commit from **[`0d0495f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)** to **[`98dff9d`](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)**",
    "created_at": "2020-01-15T14:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431696",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d0495f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)** to **[`98dff9d`](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)**



---

archive/issue_comments_431697.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI've reduced the scope of the ticket, excluding the use of system site packages.",
    "created_at": "2020-01-15T14:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431697",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

I've reduced the scope of the ticket, excluding the use of system site packages.



---

archive/issue_comments_431698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.\n+Via #29013, we install all of our own Python packages into a separate venv.\n+\n+The venv does not include the system site-packages; we keep that task for a follow-up ticket.\n \n \n``````\n",
    "created_at": "2020-01-15T14:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431698",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
 Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.
+Via #29013, we install all of our own Python packages into a separate venv.
+
+The venv does not include the system site-packages; we keep that task for a follow-up ticket.
 
 
``````




---

archive/issue_comments_431699.json:
```json
{
    "body": "Changed commit from **[`98dff9d`](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)** to **[`6180132`](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)**",
    "created_at": "2020-01-15T16:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431699",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`98dff9d`](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)** to **[`6180132`](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)**



---

archive/issue_comments_431700.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030\"><code>6180132</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Find @PYTHON_FOR_VENV@ that has sqlite3 module</code></td></tr></table>\n",
    "created_at": "2020-01-15T16:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431700",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030"><code>6180132</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Find @PYTHON_FOR_VENV@ that has sqlite3 module</code></td></tr></table>




---

archive/issue_comments_431701.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\nand it broke at docbuild, with\n\n```\nRuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n```\neven though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)",
    "created_at": "2020-01-15T18:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431701",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
and it broke at docbuild, with

```
RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
```
even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)



---

archive/issue_comments_431702.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks for testing!",
    "created_at": "2020-01-15T18:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431702",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks for testing!



---

archive/issue_comments_431703.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mkoeppe](#comment%3A14):\n> I've reduced the scope of the ticket, excluding the use of system site packages.\n\ndo you mean pip/etc-installed `site-packages` of system's Python?",
    "created_at": "2020-01-15T18:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431703",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mkoeppe](#comment%3A14):
> I've reduced the scope of the ticket, excluding the use of system site packages.

do you mean pip/etc-installed `site-packages` of system's Python?



---

archive/issue_comments_431704.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@dimpase](#comment%3A18):\n> Replying to [@mkoeppe](#comment%3A14):\n> > I've reduced the scope of the ticket, excluding the use of system site packages.\n\n> \n> do you mean pip/etc-installed `site-packages` of system's Python?\n\nYes.",
    "created_at": "2020-01-15T18:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431704",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@dimpase](#comment%3A18):
> Replying to [@mkoeppe](#comment%3A14):
> > I've reduced the scope of the ticket, excluding the use of system site packages.

> 
> do you mean pip/etc-installed `site-packages` of system's Python?

Yes.



---

archive/issue_comments_431705.json:
```json
{
    "body": "Changed dependencies from **#29013** to **#29013, #29019**",
    "created_at": "2020-01-15T20:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431705",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29013** to **#29013, #29019**



---

archive/issue_comments_431706.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61d78220089040d4c91ee5b52df63d29107e80aa\"><code>61d7822</code></a></td><td><code>Trac #29002: lower the version bound on the system sqlite check.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ab451549f66743220caa00d43831341690f80e9\"><code>3ab4515</code></a></td><td><code>Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7b9ae4393cfe2b8975aafc196cd96bece7de75d\"><code>c7b9ae4</code></a></td><td><code>Add sqlite depcheck</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/961f850b915e4d267262d4a67129a031eb0cc48e\"><code>961f850</code></a></td><td><code>Trac #29002: lower the version bound on the system sqlite check (again).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d32194842f5f7f83c2d50d020267838176a666f3\"><code>d321948</code></a></td><td><code>Trac #29002: drop the readline dependency check for system sqlite.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14d15fb744114903df9bb1935c3f100946e6c16e\"><code>14d15fb</code></a></td><td><code>Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/258d1124b7b0739c306caaf8a6f9d08bb88eafdc\"><code>258d112</code></a></td><td><code>build/pkgs/pillow/patches/setup.py.patch: Don't fail if Py_MACOS_SYSROOT sysconfig variable does not exist</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43673c002a3135c71727a38eadee05fcbb54cd67\"><code>43673c0</code></a></td><td><code>Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56b16181df532469e5c680345166ea116a3e6f15\"><code>56b1618</code></a></td><td><code>build/pkgs/pillow/spkg-install: Help setup.py find zlib.h on macOS; show more build output</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4\"><code>5930b4e</code></a></td><td><code>Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>\n",
    "created_at": "2020-01-15T20:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431706",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61d78220089040d4c91ee5b52df63d29107e80aa"><code>61d7822</code></a></td><td><code>Trac #29002: lower the version bound on the system sqlite check.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ab451549f66743220caa00d43831341690f80e9"><code>3ab4515</code></a></td><td><code>Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7b9ae4393cfe2b8975aafc196cd96bece7de75d"><code>c7b9ae4</code></a></td><td><code>Add sqlite depcheck</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/961f850b915e4d267262d4a67129a031eb0cc48e"><code>961f850</code></a></td><td><code>Trac #29002: lower the version bound on the system sqlite check (again).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d32194842f5f7f83c2d50d020267838176a666f3"><code>d321948</code></a></td><td><code>Trac #29002: drop the readline dependency check for system sqlite.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14d15fb744114903df9bb1935c3f100946e6c16e"><code>14d15fb</code></a></td><td><code>Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/258d1124b7b0739c306caaf8a6f9d08bb88eafdc"><code>258d112</code></a></td><td><code>build/pkgs/pillow/patches/setup.py.patch: Don't fail if Py_MACOS_SYSROOT sysconfig variable does not exist</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43673c002a3135c71727a38eadee05fcbb54cd67"><code>43673c0</code></a></td><td><code>Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56b16181df532469e5c680345166ea116a3e6f15"><code>56b1618</code></a></td><td><code>build/pkgs/pillow/spkg-install: Help setup.py find zlib.h on macOS; show more build output</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4"><code>5930b4e</code></a></td><td><code>Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>




---

archive/issue_comments_431707.json:
```json
{
    "body": "Changed commit from **[`6180132`](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)** to **[`5930b4e`](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)**",
    "created_at": "2020-01-15T20:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6180132`](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)** to **[`5930b4e`](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)**



---

archive/issue_comments_431708.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNow this is giving\n\n```\n[pillow-5.3.0.p0] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/usr/include -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -g -DHAVE_OPENJPEG -DHAVE_LIBZ -DHAVE_LIBTIFF -DPILLOW_VERSION=\"5.3.0\" -I/usr/local/Cellar/openjpeg/2.3.1/include/openjpeg-2.3 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/var/tmp/sage/build/pillow-5.3.0.p0/src/src/libImaging -I/usr/local/Cellar/jpeg/9c/include -I/usr/local/Cellar/libtiff/4.1.0/include -I/usr/local/Cellar/freetype/2.10.1/include/freetype2 -I/usr/local/Cellar/little-cms2/2.9/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/include -I/usr/local/Cellar/freetype/2.10.1/include -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/include/python3.7m -c src/_imaging.c -o build/temp.macosx-10.15-x86_64-3.7/src/_imaging.o\n[pillow-5.3.0.p0] error: $MACOSX_DEPLOYMENT_TARGET mismatch: now \"10.9\" but \"10.15\" during configure\n[pillow-5.3.0.p0] ********************************************************************************\n```\nThis is coming from the fake `MACOSX_DEPLOYMENT_TARGET` set in `sage-env`. See #18272, #7095, #18254, #16312.",
    "created_at": "2020-01-15T21:05:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431708",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Now this is giving

```
[pillow-5.3.0.p0] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/usr/include -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -g -DHAVE_OPENJPEG -DHAVE_LIBZ -DHAVE_LIBTIFF -DPILLOW_VERSION="5.3.0" -I/usr/local/Cellar/openjpeg/2.3.1/include/openjpeg-2.3 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/var/tmp/sage/build/pillow-5.3.0.p0/src/src/libImaging -I/usr/local/Cellar/jpeg/9c/include -I/usr/local/Cellar/libtiff/4.1.0/include -I/usr/local/Cellar/freetype/2.10.1/include/freetype2 -I/usr/local/Cellar/little-cms2/2.9/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/include -I/usr/local/Cellar/freetype/2.10.1/include -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/include/python3.7m -c src/_imaging.c -o build/temp.macosx-10.15-x86_64-3.7/src/_imaging.o
[pillow-5.3.0.p0] error: $MACOSX_DEPLOYMENT_TARGET mismatch: now "10.9" but "10.15" during configure
[pillow-5.3.0.p0] ********************************************************************************
```
This is coming from the fake `MACOSX_DEPLOYMENT_TARGET` set in `sage-env`. See #18272, #7095, #18254, #16312.



---

archive/issue_comments_431709.json:
```json
{
    "body": "Changed commit from **[`5930b4e`](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)** to **[`7bd8746`](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)**",
    "created_at": "2020-01-15T22:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431709",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5930b4e`](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)** to **[`7bd8746`](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)**



---

archive/issue_comments_431710.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b34e2ef8d348478c03d61b9a993034b6eb703e3\"><code>3b34e2e</code></a></td><td><code>src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c\"><code>7bd8746</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2020-01-15T22:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431710",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b34e2ef8d348478c03d61b9a993034b6eb703e3"><code>3b34e2e</code></a></td><td><code>src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c"><code>7bd8746</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_431711.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@dimpase](#comment%3A16):\n> I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\n> and it broke at docbuild, with\n> \n> ```\n> RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n> ```\n> even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)\n\nFixed now.",
    "created_at": "2020-01-15T22:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431711",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@dimpase](#comment%3A16):
> I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
> and it broke at docbuild, with
> 
> ```
> RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
> ```
> even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)

Fixed now.



---

archive/issue_comments_431712.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n Via #29013, we install all of our own Python packages into a separate venv.\n \n-The venv does not include the system site-packages; we keep that task for a follow-up ticket.\n+The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.\n \n \n``````\n",
    "created_at": "2020-01-15T23:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431712",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 Via #29013, we install all of our own Python packages into a separate venv.
 
-The venv does not include the system site-packages; we keep that task for a follow-up ticket.
+The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.
 
 
``````




---

archive/issue_comments_431713.json:
```json
{
    "body": "Changed commit from **[`7bd8746`](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)** to **[`cd864e8`](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)**",
    "created_at": "2020-01-16T00:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431713",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7bd8746`](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)** to **[`cd864e8`](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)**



---

archive/issue_comments_431714.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94\"><code>d4fbe40</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23\"><code>bba08ec</code></a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970\"><code>d1779cc</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118\"><code>cd864e8</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>\n",
    "created_at": "2020-01-16T00:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431714",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94"><code>d4fbe40</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23"><code>bba08ec</code></a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970"><code>d1779cc</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118"><code>cd864e8</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>




---

archive/issue_comments_431715.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nCompiles OK on macOS with homebrew. `make ptestlong` mostly good except for\n- GLPK output (spkg-configure should really reject a libglpk that talks too much) - it makes it hard to see actual failures\n- and numerical failures in `src/sage/matrix/matrix2.pyx`, `src/sage/finance/time_series.pyx`, and `src/sage/schemes/affine/affine_homset.py` as reported in #29013\n\n```\nsage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed\nsage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed\nsage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed\n```",
    "created_at": "2020-01-16T02:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431715",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Compiles OK on macOS with homebrew. `make ptestlong` mostly good except for
- GLPK output (spkg-configure should really reject a libglpk that talks too much) - it makes it hard to see actual failures
- and numerical failures in `src/sage/matrix/matrix2.pyx`, `src/sage/finance/time_series.pyx`, and `src/sage/schemes/affine/affine_homset.py` as reported in #29013

```
sage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed
sage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed
sage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed
```



---

archive/issue_comments_431716.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432\"><code>85147f9</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6\"><code>93bae6f</code></a></td><td><code>Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d\"><code>669b1df</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>\n",
    "created_at": "2020-01-16T03:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431716",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432"><code>85147f9</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6"><code>93bae6f</code></a></td><td><code>Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d"><code>669b1df</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>




---

archive/issue_comments_431717.json:
```json
{
    "body": "Changed commit from **[`cd864e8`](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)** to **[`669b1df`](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)**",
    "created_at": "2020-01-16T03:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431717",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cd864e8`](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)** to **[`669b1df`](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)**



---

archive/issue_comments_431718.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@mkoeppe](#comment%3A24):\n> Replying to [@dimpase](#comment%3A16):\n> > I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\n> > and it broke at docbuild, with\n> > \n> > ```\n> > RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n> > ```\n> > even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)\n\n> Fixed now.\n\nafter this fix, it builds and passes most tests on Gentoo (some errors related to cryptominisat that I had installed, and it probably got broken in some way)",
    "created_at": "2020-01-16T08:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431718",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@mkoeppe](#comment%3A24):
> Replying to [@dimpase](#comment%3A16):
> > I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
> > and it broke at docbuild, with
> > 
> > ```
> > RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
> > ```
> > even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)

> Fixed now.

after this fix, it builds and passes most tests on Gentoo (some errors related to cryptominisat that I had installed, and it probably got broken in some way)



---

archive/issue_comments_431719.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)\n\n```\nsage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py\n**********************************************************************\nFile \"src/sage/sat/solvers/cryptominisat.py\", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat\nFailed example:\n    solver = CryptoMiniSat()                                  # optional - cryptominisat\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py\", line 69, in __init__\n        from pycryptosat import Solver\n    ModuleNotFoundError: No module named 'pycryptosat'\n```\nI wonder whether it uses a convoluted way to create python extensions, which got broken.",
    "created_at": "2020-01-16T09:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431719",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

I see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)

```
sage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py
**********************************************************************
File "src/sage/sat/solvers/cryptominisat.py", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat
Failed example:
    solver = CryptoMiniSat()                                  # optional - cryptominisat
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py", line 69, in __init__
        from pycryptosat import Solver
    ModuleNotFoundError: No module named 'pycryptosat'
```
I wonder whether it uses a convoluted way to create python extensions, which got broken.



---

archive/issue_comments_431720.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI see (on a system where cryptominisat package works) that it is one of few packages that get installed without a sub-directory named the same as package in site-packages:\n\n```\nsage: import pycryptosat\nsage: print(pycryptosat.__file__)\n/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so\nsage: import numpy\nsage: print(numpy.__file__)\n/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/numpy/__init__.py\n```\n\nNot sure whether this is a bug on the package, or a bug in this branch.\nOn this branch I see (with `local=SAGE_LOCAL`)\n\n```\n$ ls local/lib/python3.7/site-packages/*\nlocal/lib/python3.7/site-packages/pycryptosat-0.2.0-py3.7.egg-info  local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so\n```\nSo it seems that this branch does not pick up anything from that location.",
    "created_at": "2020-01-16T09:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431720",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

I see (on a system where cryptominisat package works) that it is one of few packages that get installed without a sub-directory named the same as package in site-packages:

```
sage: import pycryptosat
sage: print(pycryptosat.__file__)
/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so
sage: import numpy
sage: print(numpy.__file__)
/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/numpy/__init__.py
```

Not sure whether this is a bug on the package, or a bug in this branch.
On this branch I see (with `local=SAGE_LOCAL`)

```
$ ls local/lib/python3.7/site-packages/*
local/lib/python3.7/site-packages/pycryptosat-0.2.0-py3.7.egg-info  local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so
```
So it seems that this branch does not pick up anything from that location.



---

archive/issue_comments_431721.json:
```json
{
    "body": "Changed commit from **[`669b1df`](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)** to **[`61a9e37`](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)**",
    "created_at": "2020-01-16T14:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431721",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`669b1df`](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)** to **[`61a9e37`](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)**



---

archive/issue_comments_431722.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a\"><code>2ed5d07</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749\"><code>61a9e37</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>\n",
    "created_at": "2020-01-16T14:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431722",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a"><code>2ed5d07</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749"><code>61a9e37</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>




---

archive/issue_comments_431723.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541\"><code>27d945a</code></a></td><td><code>moved patch to the right place</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2\"><code>8c546cf</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>\n",
    "created_at": "2020-01-16T16:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431723",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541"><code>27d945a</code></a></td><td><code>moved patch to the right place</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2"><code>8c546cf</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr></table>




---

archive/issue_comments_431724.json:
```json
{
    "body": "Changed commit from **[`61a9e37`](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)** to **[`8c546cf`](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)**",
    "created_at": "2020-01-16T16:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431724",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`61a9e37`](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)** to **[`8c546cf`](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)**



---

archive/issue_comments_431725.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWhat's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear.  It seems to me another reason to avoid all the venv stuff...",
    "created_at": "2020-01-16T18:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431725",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear.  It seems to me another reason to avoid all the venv stuff...



---

archive/issue_comments_431726.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSo, all that `$VIRTUAL_ENV/bin/activate` does, essentially, is to set 3 environment variables: `PATH` (to which it inserts `$VIRTUAL_ENV/bin` in the front), `PS1` (which Sage also already sets when activating the sage environment), and the `$VIRTUAL_ENV` environment variable itself.\n\nOther than that, the only thing that really makes a directory a virtualenv (with Python 3 + venv, I'm not counting the old virtualenv) is the presence of `pyvenv.cfg` in the install prefix.  The format of this file is more-or-less documented (albeit not very clearly) in https://docs.python.org/3/library/venv.html.  So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  That, and make `$SAGE_LOCAL/bin/python3` a symlink to the real python3.\n\nAlthough not strictly necessary, it is also possibly helpful to third-party tools to set the `$VIRTUAL_ENV` environment variable.",
    "created_at": "2020-01-16T18:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431726",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

So, all that `$VIRTUAL_ENV/bin/activate` does, essentially, is to set 3 environment variables: `PATH` (to which it inserts `$VIRTUAL_ENV/bin` in the front), `PS1` (which Sage also already sets when activating the sage environment), and the `$VIRTUAL_ENV` environment variable itself.

Other than that, the only thing that really makes a directory a virtualenv (with Python 3 + venv, I'm not counting the old virtualenv) is the presence of `pyvenv.cfg` in the install prefix.  The format of this file is more-or-less documented (albeit not very clearly) in https://docs.python.org/3/library/venv.html.  So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  That, and make `$SAGE_LOCAL/bin/python3` a symlink to the real python3.

Although not strictly necessary, it is also possibly helpful to third-party tools to set the `$VIRTUAL_ENV` environment variable.



---

archive/issue_comments_431727.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@embray](#comment%3A34):\n> What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. \n\nIt is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.",
    "created_at": "2020-01-16T18:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431727",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@embray](#comment%3A34):
> What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. 

It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.



---

archive/issue_comments_431728.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@embray](#comment%3A35):\n> So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  \n\nThis amounts to trying to upgrade python3's `venv` to something like a conda environment. This is what I avoid in #29013 on purpose - the `venv` is only used in a clean, documented way, using the documented tools.",
    "created_at": "2020-01-16T18:52:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431728",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@embray](#comment%3A35):
> So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  

This amounts to trying to upgrade python3's `venv` to something like a conda environment. This is what I avoid in #29013 on purpose - the `venv` is only used in a clean, documented way, using the documented tools.



---

archive/issue_comments_431729.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nwriting `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.\nThe correct interface to `venv` is to use `venv`, I think.\n\n(By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))",
    "created_at": "2020-01-16T18:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431729",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.
The correct interface to `venv` is to use `venv`, I think.

(By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))



---

archive/issue_comments_431730.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@dimpase](#comment%3A38):\n> (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))\n\nGlad we have this on record now for the software historians/archaeologists to discover :)",
    "created_at": "2020-01-16T18:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431730",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@dimpase](#comment%3A38):
> (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))

Glad we have this on record now for the software historians/archaeologists to discover :)



---

archive/issue_comments_431731.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@dimpase](#comment%3A38):\n> writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.\n> The correct interface to `venv` is to use `venv`, I think.\n\nThat's not true.  It's documented both in the documentation for the `venv` module and the `site` module.  If you really want to avoid writing it by hand the `venv` module includes code for that as well.  This (with the *system* Python 3) is effectively the same (albeit more opaque).  From within SAGE_ROOT, but without the sage environment activated:\n\n```\n$ python3 -c 'import venv; b = venv.EnvBuilder(); c = b.ensure_directories(\"local\"); b.create_configuration(c)'\n$ cat local/pyvenv.cfg\nhome = /usr/bin\ninclude-system-site-packages = false\nversion = 3.6.8\n```\n\nbut I think even that's overkill for now.",
    "created_at": "2020-01-16T19:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431731",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@dimpase](#comment%3A38):
> writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.
> The correct interface to `venv` is to use `venv`, I think.

That's not true.  It's documented both in the documentation for the `venv` module and the `site` module.  If you really want to avoid writing it by hand the `venv` module includes code for that as well.  This (with the *system* Python 3) is effectively the same (albeit more opaque).  From within SAGE_ROOT, but without the sage environment activated:

```
$ python3 -c 'import venv; b = venv.EnvBuilder(); c = b.ensure_directories("local"); b.create_configuration(c)'
$ cat local/pyvenv.cfg
home = /usr/bin
include-system-site-packages = false
version = 3.6.8
```

but I think even that's overkill for now.



---

archive/issue_comments_431732.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@mkoeppe](#comment%3A36):\n> Replying to [@embray](#comment%3A34):\n> > What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. \n\n> \n> It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.\n\nBut why do you need to make a virtualenv for that?  Why not run the system python directly?",
    "created_at": "2020-01-16T19:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431732",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@mkoeppe](#comment%3A36):
> Replying to [@embray](#comment%3A34):
> > What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. 

> 
> It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.

But why do you need to make a virtualenv for that?  Why not run the system python directly?



---

archive/issue_comments_431733.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@embray](#comment%3A41):\n> But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\nOn this ticket, the system python is not used directly but rather in a venv without site-packages.\nTherefore the correct test is to test whether the module will be available in a venv.",
    "created_at": "2020-01-16T19:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431733",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@embray](#comment%3A41):
> But why do you need to make a virtualenv for that?  Why not run the system python directly?

On this ticket, the system python is not used directly but rather in a venv without site-packages.
Therefore the correct test is to test whether the module will be available in a venv.



---

archive/issue_comments_431734.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI'll add this documentation to the branch.",
    "created_at": "2020-01-16T19:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431734",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

I'll add this documentation to the branch.



---

archive/issue_comments_431735.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@mkoeppe](#comment%3A39):\n> Replying to [@dimpase](#comment%3A38):\n> > (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))\n\n> Glad we have this on record now for the software historians/archaeologists to discover :)\n\nit's here:\nhttps://trac.sagemath.org/ticket/27824?version=0",
    "created_at": "2020-01-16T19:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431735",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@mkoeppe](#comment%3A39):
> Replying to [@dimpase](#comment%3A38):
> > (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))

> Glad we have this on record now for the software historians/archaeologists to discover :)

it's here:
https://trac.sagemath.org/ticket/27824?version=0



---

archive/issue_comments_431736.json:
```json
{
    "body": "Changed commit from **[`8c546cf`](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)** to **[`348cf22`](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)**",
    "created_at": "2020-01-16T19:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431736",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8c546cf`](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)** to **[`348cf22`](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)**



---

archive/issue_comments_431737.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9\"><code>348cf22</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add comments</code></td></tr></table>\n",
    "created_at": "2020-01-16T19:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431737",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9"><code>348cf22</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add comments</code></td></tr></table>




---

archive/issue_comments_431738.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nBy the way, should I be checking for the ssl module too?",
    "created_at": "2020-01-16T19:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431738",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

By the way, should I be checking for the ssl module too?



---

archive/issue_comments_431739.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@mkoeppe](#comment%3A42):\n> Replying to [@embray](#comment%3A41):\n> > But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\n> On this ticket, the system python is not used directly but rather in a venv without site-packages.\n> Therefore the correct test is to test whether the module will be available in a venv.\n\nBut why?",
    "created_at": "2020-01-16T19:50:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431739",
    "user": "https://github.com/embray"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@mkoeppe](#comment%3A42):
> Replying to [@embray](#comment%3A41):
> > But why do you need to make a virtualenv for that?  Why not run the system python directly?

> On this ticket, the system python is not used directly but rather in a venv without site-packages.
> Therefore the correct test is to test whether the module will be available in a venv.

But why?



---

archive/issue_comments_431740.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@embray](#comment%3A47):\n> Replying to [@mkoeppe](#comment%3A42):\n> > Replying to [@embray](#comment%3A41):\n> > > But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\n> > On this ticket, the system python is not used directly but rather in a venv without site-packages.\n> > Therefore the correct test is to test whether the module will be available in a venv.\n\n> \n> But why?\n\nWait, I misunderstood what you wrote at first.  I know why it uses a virtualenv.  What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?",
    "created_at": "2020-01-16T19:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431740",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@embray](#comment%3A47):
> Replying to [@mkoeppe](#comment%3A42):
> > Replying to [@embray](#comment%3A41):
> > > But why do you need to make a virtualenv for that?  Why not run the system python directly?

> > On this ticket, the system python is not used directly but rather in a venv without site-packages.
> > Therefore the correct test is to test whether the module will be available in a venv.

> 
> But why?

Wait, I misunderstood what you wrote at first.  I know why it uses a virtualenv.  What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?



---

archive/issue_comments_431741.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@embray](#comment%3A48):\n> What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\nBecause system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.",
    "created_at": "2020-01-16T19:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431741",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@embray](#comment%3A48):
> What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.



---

archive/issue_comments_431742.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@mkoeppe](#comment%3A46):\n> By the way, should I be checking for the ssl module too?\n\nI think I'll check for all modules mentioned in #27705.",
    "created_at": "2020-01-16T20:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431742",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@mkoeppe](#comment%3A46):
> By the way, should I be checking for the ssl module too?

I think I'll check for all modules mentioned in #27705.



---

archive/issue_comments_431743.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@mkoeppe](#comment%3A49):\n> Replying to [@embray](#comment%3A48):\n> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\n> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.\n\nSo use `python3 -S` if you really want to be sure.  That disables site-packages.",
    "created_at": "2020-01-16T20:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431743",
    "user": "https://github.com/embray"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@mkoeppe](#comment%3A49):
> Replying to [@embray](#comment%3A48):
> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.

So use `python3 -S` if you really want to be sure.  That disables site-packages.



---

archive/issue_comments_431744.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAn interesting discovery while playing around with this:  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.",
    "created_at": "2020-01-16T20:21:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431744",
    "user": "https://github.com/embray"
}
```

<div id="comment:52" align="right">comment:52</div>

An interesting discovery while playing around with this:  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.



---

archive/issue_comments_431745.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nFWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...",
    "created_at": "2020-01-16T20:24:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431745",
    "user": "https://github.com/embray"
}
```

<div id="comment:53" align="right">comment:53</div>

FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...



---

archive/issue_comments_431746.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1\"><code>cb399a1</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr></table>\n",
    "created_at": "2020-01-16T21:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431746",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1"><code>cb399a1</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr></table>




---

archive/issue_comments_431747.json:
```json
{
    "body": "Changed commit from **[`348cf22`](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)** to **[`cb399a1`](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)**",
    "created_at": "2020-01-16T21:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431747",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`348cf22`](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)** to **[`cb399a1`](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)**



---

archive/issue_comments_431748.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@embray](#comment%3A52):\n>  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.\n\nThanks! I'll add this test.",
    "created_at": "2020-01-16T22:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431748",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@embray](#comment%3A52):
>  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.

Thanks! I'll add this test.



---

archive/issue_comments_431749.json:
```json
{
    "body": "Changed commit from **[`cb399a1`](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)** to **[`71cc491`](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)**",
    "created_at": "2020-01-16T22:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431749",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb399a1`](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)** to **[`71cc491`](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)**



---

archive/issue_comments_431750.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478\"><code>71cc491</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr></table>\n",
    "created_at": "2020-01-16T22:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431750",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478"><code>71cc491</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr></table>




---

archive/issue_comments_431751.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAlso, of course, one needs the Python headers, on Ubuntu from `libpython3.7-dev`.",
    "created_at": "2020-01-16T22:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431751",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Also, of course, one needs the Python headers, on Ubuntu from `libpython3.7-dev`.



---

archive/issue_comments_431752.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nSo I'll add a check that the distutils can actually build an extension.",
    "created_at": "2020-01-16T23:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431752",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

So I'll add a check that the distutils can actually build an extension.



---

archive/issue_comments_431753.json:
```json
{
    "body": "Changed commit from **[`71cc491`](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)** to **[`c7c1671`](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)**",
    "created_at": "2020-01-17T01:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`71cc491`](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)** to **[`c7c1671`](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)**



---

archive/issue_comments_431754.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff\"><code>c7c1671</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check that distutils can build an extension</code></td></tr></table>\n",
    "created_at": "2020-01-17T01:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff"><code>c7c1671</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check that distutils can build an extension</code></td></tr></table>




---

archive/issue_comments_431755.json:
```json
{
    "body": "Attachment: **[Dockerfile-ubuntu-minimal.gz](https://github.com/sagemath/sage/files/ticket27824/Dockerfile-ubuntu-minimal.gz)**",
    "created_at": "2020-01-17T03:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431755",
    "user": "https://github.com/mkoeppe"
}
```

Attachment: **[Dockerfile-ubuntu-minimal.gz](https://github.com/sagemath/sage/files/ticket27824/Dockerfile-ubuntu-minimal.gz)**



---

archive/issue_comments_431756.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nTesting with the attached Dockerfile on ubuntu bionic.\n\nmodule and distutils checking seems to work correctly.\n\nGot stuck at `scipy` install. \n\n```\n[scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n```\n\nLooks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.",
    "created_at": "2020-01-17T04:03:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431756",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

Testing with the attached Dockerfile on ubuntu bionic.

module and distutils checking seems to work correctly.

Got stuck at `scipy` install. 

```
[scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
```

Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.



---

archive/issue_comments_431757.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@mkoeppe](#comment%3A60):\n> Testing with the attached Dockerfile on ubuntu bionic.\n> \n> module and distutils checking seems to work correctly.\n> \n> Got stuck at `scipy` install. \n> \n> ```\n> [scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n> ```\n> \n> Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.\n\n@kiwifb, based on your work on scipy configuration in #20157, would you be able to help with this?",
    "created_at": "2020-01-17T04:26:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431757",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@mkoeppe](#comment%3A60):
> Testing with the attached Dockerfile on ubuntu bionic.
> 
> module and distutils checking seems to work correctly.
> 
> Got stuck at `scipy` install. 
> 
> ```
> [scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
> ```
> 
> Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.

@kiwifb, based on your work on scipy configuration in #20157, would you be able to help with this?



---

archive/issue_comments_431758.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nYou could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.",
    "created_at": "2020-01-17T04:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431758",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">comment:62</div>

You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.



---

archive/issue_comments_431759.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@mkoeppe](#comment%3A49):\n> Replying to [@embray](#comment%3A48):\n> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\n> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.\n\nI wonder about rationale for disabling system's `site-packages`.\nIs this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?",
    "created_at": "2020-01-17T10:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431759",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@mkoeppe](#comment%3A49):
> Replying to [@embray](#comment%3A48):
> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.

I wonder about rationale for disabling system's `site-packages`.
Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?



---

archive/issue_comments_431760.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\n> I wonder about rationale for disabling system's `site-packages`.\n> Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?\n\nIt\u2019s strictly for making this ticket easier because I don\u2019t have to worry about getting the correct versions of all Python packages.\nSee #29023 for the next step - let\u2019s discuss any issues regarding use of system site packages there.",
    "created_at": "2020-01-17T12:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431760",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

> I wonder about rationale for disabling system's `site-packages`.
> Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?

It’s strictly for making this ticket easier because I don’t have to worry about getting the correct versions of all Python packages.
See #29023 for the next step - let’s discuss any issues regarding use of system site packages there.



---

archive/issue_comments_431761.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@mkoeppe](#comment%3A64):\n> \n> > I wonder about rationale for disabling system's `site-packages`.\n> > Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?\n\n> \n> It\u2019s strictly for making this ticket easier because I don\u2019t have to worry about getting the correct versions of all Python packages.\n> See #29023 for the next step - let\u2019s discuss any issues regarding use of system site packages there.\n\nI agree here, it's much simpler for now to focus on using a \"bare\" Python as much as possible.  I think detecting and using system Python packages *is* where we want to go, but it can get a bit hairier...",
    "created_at": "2020-01-17T12:37:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431761",
    "user": "https://github.com/embray"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@mkoeppe](#comment%3A64):
> 
> > I wonder about rationale for disabling system's `site-packages`.
> > Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?

> 
> It’s strictly for making this ticket easier because I don’t have to worry about getting the correct versions of all Python packages.
> See #29023 for the next step - let’s discuss any issues regarding use of system site packages there.

I agree here, it's much simpler for now to focus on using a "bare" Python as much as possible.  I think detecting and using system Python packages *is* where we want to go, but it can get a bit hairier...



---

archive/issue_comments_431762.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nFor the heck of it, I'm seeing how far I can get with a system Python 3.6.  I think anything less than 3.6 is almost definitely too old, but I have a feeling 3.6 might still be usable as a minimum.  The only major hassle I've had so far is ensuring that it uses UTF-8 encoding by default.",
    "created_at": "2020-01-17T14:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431762",
    "user": "https://github.com/embray"
}
```

<div id="comment:66" align="right">comment:66</div>

For the heck of it, I'm seeing how far I can get with a system Python 3.6.  I think anything less than 3.6 is almost definitely too old, but I have a feeling 3.6 might still be usable as a minimum.  The only major hassle I've had so far is ensuring that it uses UTF-8 encoding by default.



---

archive/issue_comments_431763.json:
```json
{
    "body": "Changed dependencies from **#29013, #29019** to **#29002, #29013, #29019**",
    "created_at": "2020-01-17T14:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431763",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#29013, #29019** to **#29002, #29013, #29019**



---

archive/issue_comments_431764.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@kiwifb](#comment%3A62):\n> You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.\n\nThank you! The file is installed. I'll investigate why it is not enough.",
    "created_at": "2020-01-17T15:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431764",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@kiwifb](#comment%3A62):
> You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.

Thank you! The file is installed. I'll investigate why it is not enough.



---

archive/issue_comments_431765.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@embray](#comment%3A53):\n> FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...\n\nHere's a prototype of my alternative approach: #29032\n\nI admit it does not yet address as many issues as this ticket does, like all the site.cfg fixes with Numpy.  Personally I didn't need it, but if those fixes are necessary they can easily be applied to my ticket as well.",
    "created_at": "2020-01-17T17:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431765",
    "user": "https://github.com/embray"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@embray](#comment%3A53):
> FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...

Here's a prototype of my alternative approach: #29032

I admit it does not yet address as many issues as this ticket does, like all the site.cfg fixes with Numpy.  Personally I didn't need it, but if those fixes are necessary they can easily be applied to my ticket as well.



---

archive/issue_comments_431766.json:
```json
{
    "body": "Changed commit from **[`c7c1671`](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)** to **[`356b6d7`](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)**",
    "created_at": "2020-01-17T18:03:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431766",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c7c1671`](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)** to **[`356b6d7`](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)**



---

archive/issue_comments_431767.json:
```json
{
    "body": "<div id=\"comment:70\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3\"><code>356b6d7</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"</code></td></tr></table>\n",
    "created_at": "2020-01-17T18:03:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431767",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:70"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3"><code>356b6d7</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"</code></td></tr></table>




---

archive/issue_comments_431768.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\n(extracted from Erik's commit at #29032.)",
    "created_at": "2020-01-17T18:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431768",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

(extracted from Erik's commit at #29032.)



---

archive/issue_comments_431769.json:
```json
{
    "body": "Changed commit from **[`356b6d7`](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)** to **[`92953ce`](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)**",
    "created_at": "2020-01-17T18:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431769",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`356b6d7`](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)** to **[`92953ce`](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)**



---

archive/issue_comments_431770.json:
```json
{
    "body": "<div id=\"comment:72\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84\"><code>92953ce</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"</code></td></tr></table>\n",
    "created_at": "2020-01-17T18:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431770",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:72"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84"><code>92953ce</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"</code></td></tr></table>




---

archive/issue_comments_431771.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Erik Bray**",
    "created_at": "2020-01-17T18:34:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431771",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Erik Bray**



---

archive/issue_comments_431772.json:
```json
{
    "body": "<div id=\"comment:74\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7\"><code>08ec551</code></a></td><td><code>build/make/deps: Make python3_venv a .PHONY target</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83\"><code>b2ab6f3</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6\"><code>7a43544</code></a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a\"><code>f2af478</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8959c19aed99055839e47a5025d5a69411fd7734\"><code>8959c19</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143\"><code>4c78bdf</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr></table>\n",
    "created_at": "2020-01-17T21:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431772",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7"><code>08ec551</code></a></td><td><code>build/make/deps: Make python3_venv a .PHONY target</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83"><code>b2ab6f3</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6"><code>7a43544</code></a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a"><code>f2af478</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8959c19aed99055839e47a5025d5a69411fd7734"><code>8959c19</code></a></td><td><code>Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143"><code>4c78bdf</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr></table>




---

archive/issue_comments_431773.json:
```json
{
    "body": "Changed commit from **[`92953ce`](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)** to **[`4c78bdf`](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)**",
    "created_at": "2020-01-17T21:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431773",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`92953ce`](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)** to **[`4c78bdf`](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)**



---

archive/issue_comments_431774.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nReplying to [@mkoeppe](#comment%3A68):\n> Replying to [@kiwifb](#comment%3A62):\n> > You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.\n\n> Thank you! The file is installed. I'll investigate why it is not enough.\n\nI've created ticket #29051 for this (Paths configured in installed numpy `site.cfg [DEFAULT/ALL]` do not affect scipy)",
    "created_at": "2020-01-20T14:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431774",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:75" align="right">comment:75</div>

Replying to [@mkoeppe](#comment%3A68):
> Replying to [@kiwifb](#comment%3A62):
> > You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.

> Thank you! The file is installed. I'll investigate why it is not enough.

I've created ticket #29051 for this (Paths configured in installed numpy `site.cfg [DEFAULT/ALL]` do not affect scipy)



---

archive/issue_comments_431775.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5\"><code>56e3daa</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431\"><code>208c7e6</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bd8aef383130227fdc466712dccfcd981851b69\"><code>1bd8aef</code></a></td><td><code>spkg-configure.m4 for python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7237aa4d7d3121a0dbb8bd34b270925e38bedbf6\"><code>7237aa4</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d044744bbdfaac333cf50aa7c8a0db1b911f63d6\"><code>d044744</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Find @PYTHON_FOR_VENV@ that has sqlite3 module</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6fec131e6fd2e95ee72b7c611ec58bc5d02c99b\"><code>c6fec13</code></a></td><td><code>src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b69ac5bbe12aafb66fb54f052d3e62c020e99c28\"><code>b69ac5b</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1430438d70f52a369bca79881a9a0e0ddef06ba\"><code>c143043</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/973c36f09dd8407aeceb0b4cf586a10e95937ffb\"><code>973c36f</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2\"><code>3d90535</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr></table>\n",
    "created_at": "2020-03-18T00:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431775",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5"><code>56e3daa</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431"><code>208c7e6</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bd8aef383130227fdc466712dccfcd981851b69"><code>1bd8aef</code></a></td><td><code>spkg-configure.m4 for python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7237aa4d7d3121a0dbb8bd34b270925e38bedbf6"><code>7237aa4</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d044744bbdfaac333cf50aa7c8a0db1b911f63d6"><code>d044744</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Find @PYTHON_FOR_VENV@ that has sqlite3 module</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6fec131e6fd2e95ee72b7c611ec58bc5d02c99b"><code>c6fec13</code></a></td><td><code>src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b69ac5bbe12aafb66fb54f052d3e62c020e99c28"><code>b69ac5b</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1430438d70f52a369bca79881a9a0e0ddef06ba"><code>c143043</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/973c36f09dd8407aeceb0b4cf586a10e95937ffb"><code>973c36f</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2"><code>3d90535</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr></table>




---

archive/issue_comments_431776.json:
```json
{
    "body": "Changed commit from **[`4c78bdf`](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)** to **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)**",
    "created_at": "2020-03-18T00:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431776",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4c78bdf`](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)** to **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)**



---

archive/issue_comments_431777.json:
```json
{
    "body": "Changed dependencies from **#29002, #29013, #29019** to **#29013**",
    "created_at": "2020-03-18T00:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431777",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29002, #29013, #29019** to **#29013**



---

archive/issue_comments_431778.json:
```json
{
    "body": "<div id=\"comment:78\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73e730cc464b3409b146f5a6820450b8c260087a\"><code>73e730c</code></a></td><td><code>build/bin/sage-system-python: Prefer python3, check a larger list of executable names, check for urllib; exit with a proper error message if no suitable Python is found</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820\"><code>b7c5335</code></a></td><td><code>configure.ac: Stop early if no suitable Python is found</code></td></tr></table>\n",
    "created_at": "2020-03-18T01:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431778",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:78"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73e730cc464b3409b146f5a6820450b8c260087a"><code>73e730c</code></a></td><td><code>build/bin/sage-system-python: Prefer python3, check a larger list of executable names, check for urllib; exit with a proper error message if no suitable Python is found</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820"><code>b7c5335</code></a></td><td><code>configure.ac: Stop early if no suitable Python is found</code></td></tr></table>




---

archive/issue_comments_431779.json:
```json
{
    "body": "Changed commit from **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)** to **[`b7c5335`](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)**",
    "created_at": "2020-03-18T01:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431779",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)** to **[`b7c5335`](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)**



---

archive/issue_comments_431780.json:
```json
{
    "body": "Changed commit from **[`b7c5335`](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)** to **[`3aa209e`](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)**",
    "created_at": "2020-03-18T01:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431780",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b7c5335`](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)** to **[`3aa209e`](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)**



---

archive/issue_comments_431781.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e\"><code>3aa209e</code></a></td><td><code>src/bin/sage-location: Use sage-python instead of sage-system-python</code></td></tr></table>\n",
    "created_at": "2020-03-18T01:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431781",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e"><code>3aa209e</code></a></td><td><code>src/bin/sage-location: Use sage-python instead of sage-system-python</code></td></tr></table>




---

archive/issue_comments_431782.json:
```json
{
    "body": "<div id=\"comment:80\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-18T01:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431782",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:80"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_431783.json:
```json
{
    "body": "Changed commit from **[`3aa209e`](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)** to **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)**",
    "created_at": "2020-03-18T01:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431783",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3aa209e`](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)** to **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)**



---

archive/issue_comments_431784.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\n(pushed to wrong ticket, corrected)",
    "created_at": "2020-03-18T01:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431784",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">comment:81</div>

(pushed to wrong ticket, corrected)



---

archive/issue_comments_431785.json:
```json
{
    "body": "Changed commit from **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)** to **[`dfa2816`](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)**",
    "created_at": "2020-03-18T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431785",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3d90535`](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)** to **[`dfa2816`](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)**



---

archive/issue_comments_431786.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7cfbab409beb241820de5f003e8678fd573463f\"><code>a7cfbab</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede\"><code>dfa2816</code></a></td><td><code>Makefile [misc-clean): No need to remove config_venv</code></td></tr></table>\n",
    "created_at": "2020-03-18T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431786",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7cfbab409beb241820de5f003e8678fd573463f"><code>a7cfbab</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede"><code>dfa2816</code></a></td><td><code>Makefile [misc-clean): No need to remove config_venv</code></td></tr></table>




---

archive/issue_comments_431787.json:
```json
{
    "body": "<div id=\"comment:83\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e\"><code>8f44123</code></a></td><td><code>src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV</code></td></tr></table>\n",
    "created_at": "2020-03-18T23:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431787",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e"><code>8f44123</code></a></td><td><code>src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV</code></td></tr></table>




---

archive/issue_comments_431788.json:
```json
{
    "body": "Changed commit from **[`dfa2816`](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)** to **[`8f44123`](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)**",
    "created_at": "2020-03-18T23:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431788",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dfa2816`](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)** to **[`8f44123`](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)**



---

archive/issue_comments_431789.json:
```json
{
    "body": "<div id=\"comment:84\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0a99e5c3df860de9c5cd68de2bfddc8f2e49059\"><code>c0a99e5</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fcd7cd6a05e8a6fe7869ecd8b4d55f96f877649\"><code>6fcd7cd</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15eceae1cd0b97122d3fbd28a5648ec8803c606a\"><code>15eceae</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fde251bf1935122fbcc31419cb616635725a494a\"><code>fde251b</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e73a42814ad20ce55bf079f6930f7d3e20eccd7b\"><code>e73a428</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1518b783776e769a399a1dd3520ef44f72a4734\"><code>b1518b7</code></a></td><td><code>Makefile [misc-clean): No need to remove config_venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/179d2e5d83e3de1c9f2cdffe5df4830f6dbce7a5\"><code>179d2e5</code></a></td><td><code>src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/176ce61ddeca2f26d9d5bd530e5c1e59d2ea9ca2\"><code>176ce61</code></a></td><td><code>build/make/Makefile.in, build/make/deps: Create venv in $SAGE_LOCAL using venv.EnvBuilder, instead of in $SAGE_LOCAL/lib/sage/venv using venv command line</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e29087a99358ac13cd777b1f741cab0ab1fc1ac2\"><code>e29087a</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Only set PYTHON_FOR_VENV if we use the system python</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db\"><code>f7924eb</code></a></td><td><code>build/bin/sage-venv: New, use it in build/pkgs/python3/spkg-configure.m4 and build/make/deps</code></td></tr></table>\n",
    "created_at": "2020-03-19T15:48:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431789",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:84"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0a99e5c3df860de9c5cd68de2bfddc8f2e49059"><code>c0a99e5</code></a></td><td><code>Set PYTHON_FOR_VENV correctly, use it in build/make/deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fcd7cd6a05e8a6fe7869ecd8b4d55f96f877649"><code>6fcd7cd</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15eceae1cd0b97122d3fbd28a5648ec8803c606a"><code>15eceae</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fde251bf1935122fbcc31419cb616635725a494a"><code>fde251b</code></a></td><td><code>src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e73a42814ad20ce55bf079f6930f7d3e20eccd7b"><code>e73a428</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1518b783776e769a399a1dd3520ef44f72a4734"><code>b1518b7</code></a></td><td><code>Makefile [misc-clean): No need to remove config_venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/179d2e5d83e3de1c9f2cdffe5df4830f6dbce7a5"><code>179d2e5</code></a></td><td><code>src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/176ce61ddeca2f26d9d5bd530e5c1e59d2ea9ca2"><code>176ce61</code></a></td><td><code>build/make/Makefile.in, build/make/deps: Create venv in $SAGE_LOCAL using venv.EnvBuilder, instead of in $SAGE_LOCAL/lib/sage/venv using venv command line</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e29087a99358ac13cd777b1f741cab0ab1fc1ac2"><code>e29087a</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Only set PYTHON_FOR_VENV if we use the system python</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db"><code>f7924eb</code></a></td><td><code>build/bin/sage-venv: New, use it in build/pkgs/python3/spkg-configure.m4 and build/make/deps</code></td></tr></table>




---

archive/issue_comments_431790.json:
```json
{
    "body": "Changed commit from **[`8f44123`](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)** to **[`f7924eb`](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)**",
    "created_at": "2020-03-19T15:48:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431790",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8f44123`](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)** to **[`f7924eb`](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)**



---

archive/issue_comments_431791.json:
```json
{
    "body": "Changed dependencies from **#29013** to none",
    "created_at": "2020-03-19T15:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431791",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29013** to none



---

archive/issue_events_378700.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T15:56:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378700"
}
```



---

archive/issue_events_378701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T15:56:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378701"
}
```



---

archive/issue_comments_431792.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-Via #29013, we install all of our own Python packages into a separate venv.\n+As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. \n \n-The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.\n+This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.\n+\n+The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n \n \n``````\n",
    "created_at": "2020-03-19T15:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431792",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
 Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-Via #29013, we install all of our own Python packages into a separate venv.
+As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. 
 
-The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.
+This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.
+
+The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.
 
 
``````




---

archive/issue_comments_431793.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nThis ticket is no longer on top of #29013.",
    "created_at": "2020-03-19T15:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431793",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

This ticket is no longer on top of #29013.



---

archive/issue_comments_431794.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nTests run at https://github.com/mkoeppe/sage/actions/runs/58992626 and \nhttps://github.com/mkoeppe/sage/actions/runs/58992623",
    "created_at": "2020-03-19T16:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431794",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:86" align="right">comment:86</div>

Tests run at https://github.com/mkoeppe/sage/actions/runs/58992626 and 
https://github.com/mkoeppe/sage/actions/runs/58992623



---

archive/issue_events_378702.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:25:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378702"
}
```



---

archive/issue_comments_431795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,6 @@\n \n The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n \n+(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)\n \n+\n``````\n",
    "created_at": "2020-03-19T16:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431795",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,6 @@
 
 The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.
 
+(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)
 
+
``````




---

archive/issue_comments_431796.json:
```json
{
    "body": "Changed commit from **[`f7924eb`](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)** to **[`c570d6b`](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)**",
    "created_at": "2020-03-19T20:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431796",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f7924eb`](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)** to **[`c570d6b`](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)**



---

archive/issue_comments_431797.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3\"><code>c570d6b</code></a></td><td><code>build/bin/sage-venv: Fixup</code></td></tr></table>\n",
    "created_at": "2020-03-19T20:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431797",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3"><code>c570d6b</code></a></td><td><code>build/bin/sage-venv: Fixup</code></td></tr></table>




---

archive/issue_comments_431798.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nA successful test at: https://github.com/mkoeppe/sage/runs/520449412",
    "created_at": "2020-03-20T01:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431798",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:89" align="right">comment:89</div>

A successful test at: https://github.com/mkoeppe/sage/runs/520449412



---

archive/issue_comments_431799.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nTests run at https://github.com/mkoeppe/sage/actions/runs/60588138",
    "created_at": "2020-03-22T03:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431799",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:92" align="right">comment:92</div>

Tests run at https://github.com/mkoeppe/sage/actions/runs/60588138



---

archive/issue_comments_431800.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nBreaks python 2 builds",
    "created_at": "2020-03-22T09:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431800",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">comment:93</div>

Breaks python 2 builds



---

archive/issue_events_378703.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T09:23:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378703"
}
```



---

archive/issue_events_378704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T09:23:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378704"
}
```



---

archive/issue_comments_431801.json:
```json
{
    "body": "<div id=\"comment:94\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c\"><code>65a9f02</code></a></td><td><code>build/make/deps: Do not set PYTHON = python3_venv in a python2 build</code></td></tr></table>\n",
    "created_at": "2020-03-22T16:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431801",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:94"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c"><code>65a9f02</code></a></td><td><code>build/make/deps: Do not set PYTHON = python3_venv in a python2 build</code></td></tr></table>




---

archive/issue_comments_431802.json:
```json
{
    "body": "Changed commit from **[`c570d6b`](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)** to **[`65a9f02`](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)**",
    "created_at": "2020-03-22T16:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431802",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c570d6b`](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)** to **[`65a9f02`](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)**



---

archive/issue_events_378705.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T16:03:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378705"
}
```



---

archive/issue_events_378706.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T16:03:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378706"
}
```



---

archive/issue_comments_431803.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nReady for review",
    "created_at": "2020-03-22T17:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431803",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:96" align="right">comment:96</div>

Ready for review



---

archive/issue_comments_431804.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nNew tests at https://github.com/mkoeppe/sage/actions/runs/60877259; see also #29367",
    "created_at": "2020-03-22T19:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431804",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">comment:97</div>

New tests at https://github.com/mkoeppe/sage/actions/runs/60877259; see also #29367



---

archive/issue_comments_431805.json:
```json
{
    "body": "Changed commit from **[`65a9f02`](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)** to **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**",
    "created_at": "2020-03-23T00:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431805",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`65a9f02`](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)** to **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**



---

archive/issue_comments_431806.json:
```json
{
    "body": "<div id=\"comment:98\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891\"><code>1c845a4</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not use venv for python3 if we do a python2 build</code></td></tr></table>\n",
    "created_at": "2020-03-23T00:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431806",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:98"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891"><code>1c845a4</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not use venv for python3 if we do a python2 build</code></td></tr></table>




---

archive/issue_comments_431807.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nTests at https://github.com/mkoeppe/sage/actions/runs/61077298",
    "created_at": "2020-03-23T00:48:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431807",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:99" align="right">comment:99</div>

Tests at https://github.com/mkoeppe/sage/actions/runs/61077298



---

archive/issue_events_378707.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-23T14:04:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378707"
}
```



---

archive/issue_events_378708.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-23T14:04:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378708"
}
```



---

archive/issue_comments_431808.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nLet's move this, looks good to me.",
    "created_at": "2020-03-23T14:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431808",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:100" align="right">comment:100</div>

Let's move this, looks good to me.



---

archive/issue_comments_431809.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-03-23T14:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431809",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_431810.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nThanks!",
    "created_at": "2020-03-23T16:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431810",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:101" align="right">comment:101</div>

Thanks!



---

archive/issue_comments_431811.json:
```json
{
    "body": "Changed branch from **[public/27824-python3-spkg-configure](https://github.com/sagemath/sagetrac-mirror/tree/public/27824-python3-spkg-configure)** to **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**",
    "created_at": "2020-03-29T00:24:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431811",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/27824-python3-spkg-configure](https://github.com/sagemath/sagetrac-mirror/tree/public/27824-python3-spkg-configure)** to **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)**



---

archive/issue_events_378709.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378709"
}
```



---

archive/issue_events_378710.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7dc258767bd48aa77bf39f5f43e90c0d0386652b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-29T00:24:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27824#event-378710"
}
```



---

archive/issue_comments_431812.json:
```json
{
    "body": "Changed commit from **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)** to none",
    "created_at": "2020-05-18T14:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431812",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`1c845a4`](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)** to none



---

archive/issue_comments_431813.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nHello everyone,\n\nWhen trying to upgrade to 9.1.rc5, I'm seeing an issue that I suspect could be a side effect of this ticket.\n\nFor some reason my `sage/local/bin/python3.7` was a symlink to the system python binary. Sage decided it wanted to install its own python-3.7.3.p1, but that failed with a permission error on the symlink. After deleting the symlink, python builds and installs correctly. (I let the logs be overwritten, so I won't be able to provide much details \u2014 sorry.)\n\nThe overall Sage build still fails with an error about six not being found while building setuptools that I haven't yet investigated.",
    "created_at": "2020-05-18T14:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431813",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:103" align="right">comment:103</div>

Hello everyone,

When trying to upgrade to 9.1.rc5, I'm seeing an issue that I suspect could be a side effect of this ticket.

For some reason my `sage/local/bin/python3.7` was a symlink to the system python binary. Sage decided it wanted to install its own python-3.7.3.p1, but that failed with a permission error on the symlink. After deleting the symlink, python builds and installs correctly. (I let the logs be overwritten, so I won't be able to provide much details — sorry.)

The overall Sage build still fails with an error about six not being found while building setuptools that I haven't yet investigated.



---

archive/issue_comments_431814.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nif you switch to py3 from py2, you probably need to run `./configure --with-python=3`\n\nit is not clear what version you were on, but the changes to the build system were very substantial, so ymmv.",
    "created_at": "2020-05-18T17:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431814",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:104" align="right">comment:104</div>

if you switch to py3 from py2, you probably need to run `./configure --with-python=3`

it is not clear what version you were on, but the changes to the build system were very substantial, so ymmv.



---

archive/issue_comments_431815.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nYes, this is a known limitation. I have created #29708 (Fix switching between --with-system-python3 and --without-system-python3) for it. We shall fix it in 9.2.",
    "created_at": "2020-05-18T17:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27824#issuecomment-431815",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:105" align="right">comment:105</div>

Yes, this is a known limitation. I have created #29708 (Fix switching between --with-system-python3 and --without-system-python3) for it. We shall fix it in 9.2.
