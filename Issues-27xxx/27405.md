# Issue 27405: Ignore pip stderr when querying packages

archive/issues_027168.json:
```json
{
    "body": "When querying installed packages using `pip`, sage will currently parse stdout and not explicitly handle stderr. That means that stderr will be printed to the terminal.\n\nSince pip 19 has started printing a deprecation warning for python 2.7, this warning will also be printed when querying installed packages with sage. That leads to doctest failures.\n\nSince this warning does not belong to the `installed_packages` function (using pip is an implementation detail here) and to make sure the doctests work for old as well as new pip versions (and python2 as well as python3), we should explicitly send stderr to /dev/null.\n\nThe alternative would be to incorporate the deprecation warning into the doctest. That would make it harder to use the system pip (which I don't think we currently do but probably will want to do in the future).\n\nCC:  @embray\n\nBranch/Commit: 78a36a783bfe8000341f30aa43bb4d85de30fcd5\n\nReviewer: Vincent Delecroix\n\nAuthor: Timo Kaufmann\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27405\n\n",
    "closed_at": "2019-03-04T23:16:23Z",
    "created_at": "2019-03-03T12:12:25Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Ignore pip stderr when querying packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27405",
    "user": "https://github.com/timokau"
}
```
When querying installed packages using `pip`, sage will currently parse stdout and not explicitly handle stderr. That means that stderr will be printed to the terminal.

Since pip 19 has started printing a deprecation warning for python 2.7, this warning will also be printed when querying installed packages with sage. That leads to doctest failures.

Since this warning does not belong to the `installed_packages` function (using pip is an implementation detail here) and to make sure the doctests work for old as well as new pip versions (and python2 as well as python3), we should explicitly send stderr to /dev/null.

The alternative would be to incorporate the deprecation warning into the doctest. That would make it harder to use the system pip (which I don't think we currently do but probably will want to do in the future).

CC:  @embray

Branch/Commit: 78a36a783bfe8000341f30aa43bb4d85de30fcd5

Reviewer: Vincent Delecroix

Author: Timo Kaufmann

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27405





---

archive/issue_comments_528295.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-03T12:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528295",
    "user": "https://github.com/timokau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_528296.json:
```json
{
    "body": "Changing commit from \"95b7d14e6ec17e8a97b82b2fd70e6717ddbab490\" to \"03fcdac27770afcd904c9ed36fa8a8073f88c369\"",
    "created_at": "2019-03-03T12:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "95b7d14e6ec17e8a97b82b2fd70e6717ddbab490" to "03fcdac27770afcd904c9ed36fa8a8073f88c369"



---

archive/issue_comments_528297.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[03fcdac](https://git.sagemath.org/sage.git/commit/?id=03fcdac27770afcd904c9ed36fa8a8073f88c369)|`Ignore pip stderr when querying packages`|",
    "created_at": "2019-03-03T12:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[03fcdac](https://git.sagemath.org/sage.git/commit/?id=03fcdac27770afcd904c9ed36fa8a8073f88c369)|`Ignore pip stderr when querying packages`|



---

archive/issue_comments_528298.json:
```json
{
    "body": "<a id='comment:3'></a>\nI don't see any redirection in your commit... didn't you forgot `stderr=devnull`?",
    "created_at": "2019-03-03T18:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528298",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
I don't see any redirection in your commit... didn't you forgot `stderr=devnull`?



---

archive/issue_comments_528299.json:
```json
{
    "body": "Changing commit from \"03fcdac27770afcd904c9ed36fa8a8073f88c369\" to \"78a36a783bfe8000341f30aa43bb4d85de30fcd5\"",
    "created_at": "2019-03-03T20:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "03fcdac27770afcd904c9ed36fa8a8073f88c369" to "78a36a783bfe8000341f30aa43bb4d85de30fcd5"



---

archive/issue_comments_528300.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[78a36a7](https://git.sagemath.org/sage.git/commit/?id=78a36a783bfe8000341f30aa43bb4d85de30fcd5)|`Ignore pip stderr when querying packages`|",
    "created_at": "2019-03-03T20:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[78a36a7](https://git.sagemath.org/sage.git/commit/?id=78a36a783bfe8000341f30aa43bb4d85de30fcd5)|`Ignore pip stderr when querying packages`|



---

archive/issue_comments_528301.json:
```json
{
    "body": "<a id='comment:5'></a>\nYes, I had to rebase on top of #27001 and must have forgotten to re-add that. Thanks for catching that.\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[78a36a7](https://git.sagemath.org/sage.git/commit?id=78a36a783bfe8000341f30aa43bb4d85de30fcd5)|`Ignore pip stderr when querying packages`|",
    "created_at": "2019-03-03T20:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528301",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'></a>
Yes, I had to rebase on top of #27001 and must have forgotten to re-add that. Thanks for catching that.

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[78a36a7](https://git.sagemath.org/sage.git/commit?id=78a36a783bfe8000341f30aa43bb4d85de30fcd5)|`Ignore pip stderr when querying packages`|



---

archive/issue_comments_528302.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-03T20:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528302",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_528303.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2019-03-03T20:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528303",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_528304.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks!",
    "created_at": "2019-03-03T20:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528304",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>
Thanks!



---

archive/issue_comments_528305.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-04T23:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528305",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068063.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-04T23:16:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27405#event-68063"
}
```



---

archive/issue_comments_528306.json:
```json
{
    "body": "Changing branch from \"u/gh-timokau/pip-ignore-stderr\" to \"78a36a783bfe8000341f30aa43bb4d85de30fcd5\"",
    "created_at": "2019-03-04T23:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-528306",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-timokau/pip-ignore-stderr" to "78a36a783bfe8000341f30aa43bb4d85de30fcd5"
