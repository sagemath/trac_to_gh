# Issue 27405: Ignore pip stderr when querying packages

archive/issues_027168.json:
```json
{
    "assignees": [],
    "body": "When querying installed packages using `pip`, sage will currently parse stdout and not explicitly handle stderr. That means that stderr will be printed to the terminal.\n\nSince pip 19 has started printing a deprecation warning for python 2.7, this warning will also be printed when querying installed packages with sage. That leads to doctest failures.\n\nSince this warning does not belong to the `installed_packages` function (using pip is an implementation detail here) and to make sure the doctests work for old as well as new pip versions (and python2 as well as python3), we should explicitly send stderr to /dev/null.\n\nThe alternative would be to incorporate the deprecation warning into the doctest. That would make it harder to use the system pip (which I don't think we currently do but probably will want to do in the future).\n\nCC:  @embray\n\nBranch/Commit: **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Timo Kaufmann**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27405_\n\n",
    "closed_at": "2019-03-04T23:16:23Z",
    "created_at": "2019-03-03T12:12:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Ignore pip stderr when querying packages",
    "type": "issue",
    "updated_at": "2019-03-04T23:16:23Z",
    "url": "https://github.com/sagemath/sage/issues/27405",
    "user": "https://github.com/timokau"
}
```
When querying installed packages using `pip`, sage will currently parse stdout and not explicitly handle stderr. That means that stderr will be printed to the terminal.

Since pip 19 has started printing a deprecation warning for python 2.7, this warning will also be printed when querying installed packages with sage. That leads to doctest failures.

Since this warning does not belong to the `installed_packages` function (using pip is an implementation detail here) and to make sure the doctests work for old as well as new pip versions (and python2 as well as python3), we should explicitly send stderr to /dev/null.

The alternative would be to incorporate the deprecation warning into the doctest. That would make it harder to use the system pip (which I don't think we currently do but probably will want to do in the future).

CC:  @embray

Branch/Commit: **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**

Reviewer: **Vincent Delecroix**

Author: **Timo Kaufmann**

_Issue created by migration from https://trac.sagemath.org/ticket/27405_





---

archive/issue_events_358259.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-03-03T12:12:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358259"
}
```



---

archive/issue_events_358260.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-03-03T12:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358260"
}
```



---

archive/issue_events_358261.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-03-03T12:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358261"
}
```



---

archive/issue_events_358262.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-03-03T12:12:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358262"
}
```



---

archive/issue_comments_426798.json:
```json
{
    "body": "Changed commit from **[95b7d14](https://github.com/sagemath/sagetrac-mirror/commit/95b7d14e6ec17e8a97b82b2fd70e6717ddbab490)** to **[03fcdac](https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369)**",
    "created_at": "2019-03-03T12:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426798",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[95b7d14](https://github.com/sagemath/sagetrac-mirror/commit/95b7d14e6ec17e8a97b82b2fd70e6717ddbab490)** to **[03fcdac](https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369)**



---

archive/issue_comments_426799.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369\">03fcdac</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>\n",
    "created_at": "2019-03-03T12:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426799",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369">03fcdac</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>




---

archive/issue_comments_426800.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI don't see any redirection in your commit... didn't you forgot `stderr=devnull`?",
    "created_at": "2019-03-03T18:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426800",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'>Comment 3:</a>
I don't see any redirection in your commit... didn't you forgot `stderr=devnull`?



---

archive/issue_comments_426801.json:
```json
{
    "body": "Changed commit from **[03fcdac](https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369)** to **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**",
    "created_at": "2019-03-03T20:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426801",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[03fcdac](https://github.com/sagemath/sagetrac-mirror/commit/03fcdac27770afcd904c9ed36fa8a8073f88c369)** to **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**



---

archive/issue_comments_426802.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5\">78a36a7</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>\n",
    "created_at": "2019-03-03T20:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426802",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5">78a36a7</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>




---

archive/issue_comments_426803.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nYes, I had to rebase on top of #27001 and must have forgotten to re-add that. Thanks for catching that.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5\">78a36a7</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>\n",
    "created_at": "2019-03-03T20:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426803",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'>Comment 5:</a>
Yes, I had to rebase on top of #27001 and must have forgotten to re-add that. Thanks for catching that.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5">78a36a7</a></td><td><code>Ignore pip stderr when querying packages</code></td></tr></table>




---

archive/issue_events_358263.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-03-03T20:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358263"
}
```



---

archive/issue_events_358264.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-03-03T20:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358264"
}
```



---

archive/issue_comments_426804.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2019-03-03T20:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426804",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_426805.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThanks!",
    "created_at": "2019-03-03T20:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426805",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'>Comment 7:</a>
Thanks!



---

archive/issue_events_358265.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-04T23:16:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358265"
}
```



---

archive/issue_events_358266.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "880ed5f5d7d52e4df0a9f6a4c6b4ccebbc46d63f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-04T23:16:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27405#event-358266"
}
```



---

archive/issue_comments_426806.json:
```json
{
    "body": "Changed branch from **[u/gh-timokau/pip-ignore-stderr](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/pip-ignore-stderr)** to **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**",
    "created_at": "2019-03-04T23:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27405#issuecomment-426806",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-timokau/pip-ignore-stderr](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/pip-ignore-stderr)** to **[78a36a7](https://github.com/sagemath/sagetrac-mirror/commit/78a36a783bfe8000341f30aa43bb4d85de30fcd5)**
