# Issue 27712: improve function field differentials to work over nested fields

archive/issues_027475.json:
```json
{
    "body": "Differentials don't currently work right over nested function fields.  For example,\n\n```\nsage: K.<x> = FunctionField(GF(31))\nsage: R.<y> = K[]\nsage: L.<y> = K.extension(y^2 - x)\nsage: R.<z> = L[]\nsage: M.<z> = L.extension(z^2 - y)\n\nsage: K.space_of_differentials()(x)\nd(x)\nsage: L.space_of_differentials()(x)\nd(x)\nsage: M.space_of_differentials()(x)\nd(y)\n\nsage: z.differential()\n(8/x*z) d(y)\n```\n\nYet dz = 1/(2*z) dy, which isn't (8/x*z):\n\n```\nsage: 1/(2*z) == (8/x*z)\nFalse\n```\n\nThis ticket is spun off from #26993\n\nCC:  @kwankyu\n\nKeywords: function fields\n\nBranch/Commit: a9a05086b8be4d72b9243812483117ac78d38b03\n\nReviewer: Kwankyu Lee\n\nAuthor: Brent Baccala\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27712\n\n",
    "closed_at": "2019-05-21T12:15:47Z",
    "created_at": "2019-04-22T18:42:12Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "improve function field differentials to work over nested fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27712",
    "user": "https://github.com/BrentBaccala"
}
```
Differentials don't currently work right over nested function fields.  For example,

```
sage: K.<x> = FunctionField(GF(31))
sage: R.<y> = K[]
sage: L.<y> = K.extension(y^2 - x)
sage: R.<z> = L[]
sage: M.<z> = L.extension(z^2 - y)

sage: K.space_of_differentials()(x)
d(x)
sage: L.space_of_differentials()(x)
d(x)
sage: M.space_of_differentials()(x)
d(y)

sage: z.differential()
(8/x*z) d(y)
```

Yet dz = 1/(2*z) dy, which isn't (8/x*z):

```
sage: 1/(2*z) == (8/x*z)
False
```

This ticket is spun off from #26993

CC:  @kwankyu

Keywords: function fields

Branch/Commit: a9a05086b8be4d72b9243812483117ac78d38b03

Reviewer: Kwankyu Lee

Author: Brent Baccala

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27712





---

archive/issue_comments_412511.json:
```json
{
    "body": "<a id='comment:1'></a>The patch adds an explicit instance variable to `DifferentialsSpace` that specifies the base differential that all of the other differentials will be expressed relative to.\n\nIf possible, the base differential is the generator of the base rational function field.  If this is not possible (because that generator is not a separating element), then the generator of the next higher field is considered until a suitable base differential is found.\n\nI'm wondering if some means should be provided for the user to set the base generator, say if they wanted to use d(y) instead of d(x) when both are suitable.  Then we might have two different `DifferentialsSpace`s attached to the same function field, with two different base generators.  It really should only affect how the differentials are printed.  I'm not sure how to do it, so right now I'm just leaving it the way it is, and no means is provided for the user to pick the base differential.\n\nBut it solves the problem - the example listed in the ticket description is added as a test case.\n\n---\nNew commits:",
    "created_at": "2019-04-24T00:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412511",
    "user": "https://github.com/BrentBaccala"
}
```

<a id='comment:1'></a>The patch adds an explicit instance variable to `DifferentialsSpace` that specifies the base differential that all of the other differentials will be expressed relative to.

If possible, the base differential is the generator of the base rational function field.  If this is not possible (because that generator is not a separating element), then the generator of the next higher field is considered until a suitable base differential is found.

I'm wondering if some means should be provided for the user to set the base generator, say if they wanted to use d(y) instead of d(x) when both are suitable.  Then we might have two different `DifferentialsSpace`s attached to the same function field, with two different base generators.  It really should only affect how the differentials are printed.  I'm not sure how to do it, so right now I'm just leaving it the way it is, and no means is provided for the user to pick the base differential.

But it solves the problem - the example listed in the ticket description is added as a test case.

---
New commits:



---

archive/issue_comments_412512.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-24T00:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412512",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412513.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-26T00:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412514.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-13T19:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412515.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-14T05:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412516.json:
```json
{
    "body": "<a id='comment:6'></a>Brent, I refactored differentials module so that now basic arithmetic with differentials of arbitrary function fields is supported. I also tweaked your code a little bit to speed up.\n\nIf you are positive on my portion of the code, then you can set positive review.",
    "created_at": "2019-05-14T05:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412516",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:6'></a>Brent, I refactored differentials module so that now basic arithmetic with differentials of arbitrary function fields is supported. I also tweaked your code a little bit to speed up.

If you are positive on my portion of the code, then you can set positive review.



---

archive/issue_comments_412517.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-15T14:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412517",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412518.json:
```json
{
    "body": "<a id='comment:8'></a>LGTM",
    "created_at": "2019-05-15T14:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412518",
    "user": "https://github.com/BrentBaccala"
}
```

<a id='comment:8'></a>LGTM



---

archive/issue_comments_412519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-21T12:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27712#issuecomment-412519",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068718.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-21T12:15:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27712",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27712#event-68718"
}
```
