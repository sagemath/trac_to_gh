# Issue 27548: Introduce periodic coordinates on manifolds

archive/issues_027311.json:
```json
{
    "assignees": [],
    "body": "This ticket introduces periodic coordinates on manifolds for more flexibility. \nIn particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n\n```\nsage: M = Manifold(4, 'M', structure='Lorentzian')\nsage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\\theta ph:(0,2*pi):\\phi')\nsage: g = M.metric()\nsage: g[0,0], g[1,1] = -(1-2/r), 1/(1-2/r)\nsage: g[2,2], g[3,3] = r^2, (r*sin(th))^2\nsage: p0 = M((0, 8, pi/2, pi))  # initial point\nsage: v0 = M.tangent_space(p0)((1.297, 0, 0, 0.064))  # initial tangent vector\nsage: s = var('s')\nsage: geod = M.integrated_geodesic(g, (s, 0, 1500), v0)\nsage: geod.solve() # numerical integration\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: the 7th point (initial point being the '0th' point) of the \nnumerical solution (obtained for a curve parameter equal to 105.0) is \nout of the chart domain\n```\nThis is because phi reaches 2*pi at some point in the integration.\n\nWith the branch in this ticket, it suffices to declare phi to be a periodic coordinate, by adding the keyword `periodic` in the chart definition\n\n```\nsage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\\theta ph:(0,2*pi):periodic:\\phi')\n```\nto allow for the full integration of the geodesic.\n\nThe periodicity of the coordinate is taken into account in point comparisons:\n\n```\nsage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))\nTrue\nsage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, -pi))\nTrue\n```\n\n\nCC:  @tscrim\n\nKeywords: **coordinate chart, manifold**\n\nBranch/Commit: **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Eric Gourgoulhon**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27548_\n\n",
    "closed_at": "2019-03-30T20:37:59Z",
    "created_at": "2019-03-25T20:32:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Introduce periodic coordinates on manifolds",
    "type": "issue",
    "updated_at": "2019-03-30T20:37:59Z",
    "url": "https://github.com/sagemath/sage/issues/27548",
    "user": "https://github.com/egourgoulhon"
}
```
This ticket introduces periodic coordinates on manifolds for more flexibility. 
In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:

```
sage: M = Manifold(4, 'M', structure='Lorentzian')
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):\phi')
sage: g = M.metric()
sage: g[0,0], g[1,1] = -(1-2/r), 1/(1-2/r)
sage: g[2,2], g[3,3] = r^2, (r*sin(th))^2
sage: p0 = M((0, 8, pi/2, pi))  # initial point
sage: v0 = M.tangent_space(p0)((1.297, 0, 0, 0.064))  # initial tangent vector
sage: s = var('s')
sage: geod = M.integrated_geodesic(g, (s, 0, 1500), v0)
sage: geod.solve() # numerical integration
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: the 7th point (initial point being the '0th' point) of the 
numerical solution (obtained for a curve parameter equal to 105.0) is 
out of the chart domain
```
This is because phi reaches 2*pi at some point in the integration.

With the branch in this ticket, it suffices to declare phi to be a periodic coordinate, by adding the keyword `periodic` in the chart definition

```
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):periodic:\phi')
```
to allow for the full integration of the geodesic.

The periodicity of the coordinate is taken into account in point comparisons:

```
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))
True
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, -pi))
True
```


CC:  @tscrim

Keywords: **coordinate chart, manifold**

Branch/Commit: **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**

Reviewer: **Travis Scrimshaw**

Author: **Eric Gourgoulhon**

_Issue created by migration from https://trac.sagemath.org/ticket/27548_





---

archive/issue_events_347277.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-25T20:32:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347277"
}
```



---

archive/issue_events_347278.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-25T20:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347278"
}
```



---

archive/issue_events_347279.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-25T20:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347279"
}
```



---

archive/issue_events_347280.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-25T20:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347280"
}
```



---

archive/issue_comments_429637.json:
```json
{
    "body": "Branch: **[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)**",
    "created_at": "2019-03-25T20:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429637",
    "user": "https://github.com/egourgoulhon"
}
```

Branch: **[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)**



---

archive/issue_comments_429638.json:
```json
{
    "body": "Commit: **[1d658e0](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)**",
    "created_at": "2019-03-25T20:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429638",
    "user": "https://github.com/egourgoulhon"
}
```

Commit: **[1d658e0](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)**



---

archive/issue_events_347281.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-25T20:33:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347281"
}
```



---

archive/issue_comments_429639.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d27d46470b74b87e95d2894409e7436df5a9d362\">d27d464</a></td><td><code>Add periodic coordinates in manifold charts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e2543e0d84bdaf733381e574b6430b14d9167a5\">2e2543e</a></td><td><code>Treatment of periodic coordinates in point comparison; add periodic azimuthal coordinate in Euclidean spaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8\">1d658e0</a></td><td><code>Correct typo in error message in IntegratedCurve.solve()</code></td></tr></table>\n",
    "created_at": "2019-03-25T20:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429639",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d27d46470b74b87e95d2894409e7436df5a9d362">d27d464</a></td><td><code>Add periodic coordinates in manifold charts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e2543e0d84bdaf733381e574b6430b14d9167a5">2e2543e</a></td><td><code>Treatment of periodic coordinates in point comparison; add periodic azimuthal coordinate in Euclidean spaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8">1d658e0</a></td><td><code>Correct typo in error message in IntegratedCurve.solve()</code></td></tr></table>




---

archive/issue_comments_429640.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n This ticket introduces periodic coordinates on manifolds for more flexibility. \n-In particular, this fixes an issue with the azimuthal angle phi being limited limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n+In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n \n ```\n sage: M = Manifold(4, 'M', structure='Lorentzian')\n@@ -28,7 +28,7 @@\n ```\n to allow for the full integration of the geodesic.\n \n-The periodicity of the coordinate is taken into account in the point comparison:\n+The periodicity of the coordinate is taken into account in point comparisons:\n \n ```\n sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))\n``````\n",
    "created_at": "2019-03-25T20:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429640",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 This ticket introduces periodic coordinates on manifolds for more flexibility. 
-In particular, this fixes an issue with the azimuthal angle phi being limited limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:
+In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:
 
 ```
 sage: M = Manifold(4, 'M', structure='Lorentzian')
@@ -28,7 +28,7 @@
 ```
 to allow for the full integration of the geodesic.
 
-The periodicity of the coordinate is taken into account in the point comparison:
+The periodicity of the coordinate is taken into account in point comparisons:
 
 ```
 sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))
``````




---

archive/issue_comments_429641.json:
```json
{
    "body": "Changed commit from **[1d658e0](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)** to **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**",
    "created_at": "2019-03-26T12:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429641",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1d658e0](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)** to **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**



---

archive/issue_comments_429642.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36\">1718b1d</a></td><td><code>Fix two pyflakes errors in src/sage/manifolds/differentiable</code></td></tr></table>\n",
    "created_at": "2019-03-26T12:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429642",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36">1718b1d</a></td><td><code>Fix two pyflakes errors in src/sage/manifolds/differentiable</code></td></tr></table>




---

archive/issue_events_347282.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-26T22:36:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347282"
}
```



---

archive/issue_events_347283.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-26T22:36:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347283"
}
```



---

archive/issue_comments_429643.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-03-26T22:36:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429643",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_429644.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nLGTM.",
    "created_at": "2019-03-26T22:36:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429644",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>Comment 4:</a>
LGTM.



---

archive/issue_comments_429645.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThanks for the review!",
    "created_at": "2019-03-27T09:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429645",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'>Comment 5:</a>
Thanks for the review!



---

archive/issue_events_347284.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:37:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347284"
}
```



---

archive/issue_events_347285.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "398706d31f4dd799c208ebc65c021e820db7fc50",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-30T20:37:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27548#event-347285"
}
```



---

archive/issue_comments_429646.json:
```json
{
    "body": "Changed branch from **[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)** to **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**",
    "created_at": "2019-03-30T20:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27548#issuecomment-429646",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)** to **[1718b1d](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)**
