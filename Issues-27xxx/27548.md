# Issue 27548: Introduce periodic coordinates on manifolds

archive/issues_027311.json:
```json
{
    "body": "This ticket introduces periodic coordinates on manifolds for more flexibility. \nIn particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n\n```\nsage: M = Manifold(4, 'M', structure='Lorentzian')\nsage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\\theta ph:(0,2*pi):\\phi')\nsage: g = M.metric()\nsage: g[0,0], g[1,1] = -(1-2/r), 1/(1-2/r)\nsage: g[2,2], g[3,3] = r^2, (r*sin(th))^2\nsage: p0 = M((0, 8, pi/2, pi))  # initial point\nsage: v0 = M.tangent_space(p0)((1.297, 0, 0, 0.064))  # initial tangent vector\nsage: s = var('s')\nsage: geod = M.integrated_geodesic(g, (s, 0, 1500), v0)\nsage: geod.solve() # numerical integration\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: the 7th point (initial point being the '0th' point) of the \nnumerical solution (obtained for a curve parameter equal to 105.0) is \nout of the chart domain\n```\nThis is because phi reaches 2*pi at some point in the integration.\n\nWith the branch in this ticket, it suffices to declare phi to be a periodic coordinate, by adding the keyword `periodic` in the chart definition\n\n```\nsage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\\theta ph:(0,2*pi):periodic:\\phi')\n```\nto allow for the full integration of the geodesic.\n\nThe periodicity of the coordinate is taken into account in point comparisons:\n\n```\nsage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))\nTrue\nsage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, -pi))\nTrue\n```\n\n\n**CC:**  @tscrim\n\n**Keywords:** coordinate chart, manifold\n\n**Branch/Commit:** [1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Eric Gourgoulhon\n\nIssue created by migration from https://trac.sagemath.org/ticket/27548\n\n",
    "closed_at": "2019-03-30T20:37:59Z",
    "created_at": "2019-03-25T20:32:34Z",
    "labels": [
        "component: geometry",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Introduce periodic coordinates on manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27548",
    "user": "https://github.com/egourgoulhon"
}
```
This ticket introduces periodic coordinates on manifolds for more flexibility. 
In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:

```
sage: M = Manifold(4, 'M', structure='Lorentzian')
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):\phi')
sage: g = M.metric()
sage: g[0,0], g[1,1] = -(1-2/r), 1/(1-2/r)
sage: g[2,2], g[3,3] = r^2, (r*sin(th))^2
sage: p0 = M((0, 8, pi/2, pi))  # initial point
sage: v0 = M.tangent_space(p0)((1.297, 0, 0, 0.064))  # initial tangent vector
sage: s = var('s')
sage: geod = M.integrated_geodesic(g, (s, 0, 1500), v0)
sage: geod.solve() # numerical integration
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: the 7th point (initial point being the '0th' point) of the 
numerical solution (obtained for a curve parameter equal to 105.0) is 
out of the chart domain
```
This is because phi reaches 2*pi at some point in the integration.

With the branch in this ticket, it suffices to declare phi to be a periodic coordinate, by adding the keyword `periodic` in the chart definition

```
sage: X.<t,r,th,ph> = M.chart(r't r:(0,+oo) th:(0,pi):\theta ph:(0,2*pi):periodic:\phi')
```
to allow for the full integration of the geodesic.

The periodicity of the coordinate is taken into account in point comparisons:

```
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))
True
sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, -pi))
True
```


**CC:**  @tscrim

**Keywords:** coordinate chart, manifold

**Branch/Commit:** [1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)

**Reviewer:** Travis Scrimshaw

**Author:** Eric Gourgoulhon

Issue created by migration from https://trac.sagemath.org/ticket/27548





---

archive/issue_comments_507719.json:
```json
{
    "body": "**Branch:** [public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)",
    "created_at": "2019-03-25T20:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507719",
    "user": "https://github.com/egourgoulhon"
}
```

**Branch:** [public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)



---

archive/issue_comments_507720.json:
```json
{
    "body": "**Commit:** [1d658e0e3f95a6c8389e7b0b36eea914078bfff8](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)",
    "created_at": "2019-03-25T20:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507720",
    "user": "https://github.com/egourgoulhon"
}
```

**Commit:** [1d658e0e3f95a6c8389e7b0b36eea914078bfff8](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)



---

archive/issue_comments_507721.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-03-25T20:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507721",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_507722.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d27d46470b74b87e95d2894409e7436df5a9d362\">d27d464</a></td><td><code>Add periodic coordinates in manifold charts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e2543e0d84bdaf733381e574b6430b14d9167a5\">2e2543e</a></td><td><code>Treatment of periodic coordinates in point comparison; add periodic azimuthal coordinate in Euclidean spaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8\">1d658e0</a></td><td><code>Correct typo in error message in IntegratedCurve.solve()</code></td></tr></table>\n",
    "created_at": "2019-03-25T20:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507722",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d27d46470b74b87e95d2894409e7436df5a9d362">d27d464</a></td><td><code>Add periodic coordinates in manifold charts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e2543e0d84bdaf733381e574b6430b14d9167a5">2e2543e</a></td><td><code>Treatment of periodic coordinates in point comparison; add periodic azimuthal coordinate in Euclidean spaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8">1d658e0</a></td><td><code>Correct typo in error message in IntegratedCurve.solve()</code></td></tr></table>




---

archive/issue_comments_507723.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n This ticket introduces periodic coordinates on manifolds for more flexibility. \n-In particular, this fixes an issue with the azimuthal angle phi being limited limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n+In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:\n \n ```\n sage: M = Manifold(4, 'M', structure='Lorentzian')\n@@ -28,7 +28,7 @@\n ```\n to allow for the full integration of the geodesic.\n \n-The periodicity of the coordinate is taken into account in the point comparison:\n+The periodicity of the coordinate is taken into account in point comparisons:\n \n ```\n sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))\n``````\n",
    "created_at": "2019-03-25T20:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507723",
    "user": "https://github.com/egourgoulhon"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 This ticket introduces periodic coordinates on manifolds for more flexibility. 
-In particular, this fixes an issue with the azimuthal angle phi being limited limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:
+In particular, this fixes an issue with the azimuthal angle phi being limited to the interval (0,2*pi). For instance, the numerical computation of a geodesic that is winding around the center in Schwarzschild spacetime fails:
 
 ```
 sage: M = Manifold(4, 'M', structure='Lorentzian')
@@ -28,7 +28,7 @@
 ```
 to allow for the full integration of the geodesic.
 
-The periodicity of the coordinate is taken into account in the point comparison:
+The periodicity of the coordinate is taken into account in point comparisons:
 
 ```
 sage: M((0, 8, pi/2, pi)) == M((0, 8, pi/2, 3*pi))
``````




---

archive/issue_comments_507724.json:
```json
{
    "body": "**Changing commit** from \"[1d658e0e3f95a6c8389e7b0b36eea914078bfff8](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)\" to \"[1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)\".",
    "created_at": "2019-03-26T12:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1d658e0e3f95a6c8389e7b0b36eea914078bfff8](https://github.com/sagemath/sagetrac-mirror/commit/1d658e0e3f95a6c8389e7b0b36eea914078bfff8)" to "[1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)".



---

archive/issue_comments_507725.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36\">1718b1d</a></td><td><code>Fix two pyflakes errors in src/sage/manifolds/differentiable</code></td></tr></table>\n",
    "created_at": "2019-03-26T12:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36">1718b1d</a></td><td><code>Fix two pyflakes errors in src/sage/manifolds/differentiable</code></td></tr></table>




---

archive/issue_comments_507726.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-03-26T22:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507726",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_507727.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2019-03-26T22:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507727",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_507728.json:
```json
{
    "body": "<a id='comment:4'></a>\nLGTM.",
    "created_at": "2019-03-26T22:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507728",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
LGTM.



---

archive/issue_comments_507729.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for the review!",
    "created_at": "2019-03-27T09:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507729",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>
Thanks for the review!



---

archive/issue_events_077888.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:37:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27548#event-77888"
}
```



---

archive/issue_comments_507730.json:
```json
{
    "body": "**Changing branch** from \"[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)\" to \"[1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)\".",
    "created_at": "2019-03-30T20:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27548#issuecomment-507730",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/manifolds/periodic_coords](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/periodic_coords)" to "[1718b1d43dcc024c5bb1b9b1be6afa0142c99b36](https://github.com/sagemath/sagetrac-mirror/commit/1718b1d43dcc024c5bb1b9b1be6afa0142c99b36)".
