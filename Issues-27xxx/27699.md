# Issue 27699: configure: Exit with error if an Anaconda environment without compilers is active

archive/issues_027462.json:
```json
{
    "body": "This ticket makes it an error at `configure` time if an Anaconda environment is active \nthat does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).\n\nMany support requests come from the failure of Sage to build or\nto run in the presence of Anaconda.\n\nCC:  @dimpase @saraedum @isuruf @jhpalmieri @embray @tscrim @kiwifb\n\nKeywords: conda\n\nBranch/Commit: 4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6\n\nReviewer: Isuru Fernando\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27699\n\n",
    "closed_at": "2020-05-02T21:58:39Z",
    "created_at": "2019-04-18T13:48:22Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "configure: Exit with error if an Anaconda environment without compilers is active",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27699",
    "user": "https://github.com/slel"
}
```
This ticket makes it an error at `configure` time if an Anaconda environment is active 
that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).

Many support requests come from the failure of Sage to build or
to run in the presence of Anaconda.

CC:  @dimpase @saraedum @isuruf @jhpalmieri @embray @tscrim @kiwifb

Keywords: conda

Branch/Commit: 4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6

Reviewer: Isuru Fernando

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27699





---

archive/issue_comments_412318.json:
```json
{
    "body": "<a id='comment:1'></a>I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).",
    "created_at": "2019-05-10T11:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412318",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).



---

archive/issue_comments_412319.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 embray]:\n> I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).\n\n+1",
    "created_at": "2019-06-04T01:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412319",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Replying to [comment:1 embray]:
> I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).

+1



---

archive/issue_comments_412320.json:
```json
{
    "body": "<a id='comment:3'></a>First ticket: #27941",
    "created_at": "2019-06-06T20:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412320",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>First ticket: #27941



---

archive/issue_comments_412321.json:
```json
{
    "body": "<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412321",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_412322.json:
```json
{
    "body": "<a id='comment:5'></a>As discussed in #27941, if Anaconda is detected, it may suffice to add an `-rpath` directive to our `LDFLAGS` to enable linking against the libraries provided by Anaconda.",
    "created_at": "2019-06-21T03:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412322",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>As discussed in #27941, if Anaconda is detected, it may suffice to add an `-rpath` directive to our `LDFLAGS` to enable linking against the libraries provided by Anaconda.



---

archive/issue_comments_412323.json:
```json
{
    "body": "<a id='comment:6'></a>It suffices to install the following conda packages:\n- c-compiler\n- cxx-compiler\n- fortran-compiler\nThey take care of adding the necessary flags. See https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html (end) and also #28745.",
    "created_at": "2019-11-17T19:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412323",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>It suffices to install the following conda packages:
- c-compiler
- cxx-compiler
- fortran-compiler
They take care of adding the necessary flags. See https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html (end) and also #28745.



---

archive/issue_comments_412324.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2020-01-11T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412324",
    "user": "https://github.com/mkoeppe"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_412325.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,11 +1,8 @@\n-This ticket is to detect the presence of Anaconda when building or\n-starting Sage, and output a helpful warning or error message in\n-cases where it is likely to cause, or when it causes, trouble.\n+This ticket makes it an error at \\`configure\\` time if an Anaconda environment is active \n+that does not have the \\`c-compiler\\`, \\`cxx-compiler\\`, and \\`fortran-compiler\\` packages.\n \n Many support requests come from the failure of Sage to build or\n to run in the presence of Anaconda.\n-\n-Keywords: Anaconda\n \n Comment: 1\n \n```\n",
    "created_at": "2020-01-11T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412325",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,11 +1,8 @@
-This ticket is to detect the presence of Anaconda when building or
-starting Sage, and output a helpful warning or error message in
-cases where it is likely to cause, or when it causes, trouble.
+This ticket makes it an error at \`configure\` time if an Anaconda environment is active 
+that does not have the \`c-compiler\`, \`cxx-compiler\`, and \`fortran-compiler\` packages.
 
 Many support requests come from the failure of Sage to build or
 to run in the presence of Anaconda.
-
-Keywords: Anaconda
 
 Comment: 1
 
```




---

archive/issue_events_068701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-11T00:34:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27699#event-68701"
}
```



---

archive/issue_comments_412326.json:
```json
{
    "body": "<a id='comment:9'></a>New commits:",
    "created_at": "2020-01-11T01:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412326",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>New commits:



---

archive/issue_comments_412327.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-11T01:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412327",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412328.json:
```json
{
    "body": "<a id='comment:12'></a>Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:\n\n```\n# >>> conda initialize >>>\n# !! Contents within this block are managed by 'conda init' !!\n__conda_setup=\"$('/home/scratch2/dimpase/miniconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)\"\n if [ $? -eq 0 ]; then\n    eval \"$__conda_setup\"\n else\n    if [ -f \"/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh\" ]; then\n        . \"/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh\"\n    else\n        export PATH=\"/home/scratch2/dimpase/miniconda3/bin:$PATH\"\n    fi\nfi\n```\n- deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.",
    "created_at": "2020-01-13T11:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412328",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:

```
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/scratch2/dimpase/miniconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
 if [ $? -eq 0 ]; then
    eval "$__conda_setup"
 else
    if [ -f "/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh" ]; then
        . "/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="/home/scratch2/dimpase/miniconda3/bin:$PATH"
    fi
fi
```
- deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.



---

archive/issue_comments_412329.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 dimpase]:\n> Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:\n> \n> ```\n> # >>> conda initialize >>>\n> # !! Contents within this block are managed by 'conda init' !! ...\n> ```\n> - deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.\n\n\nThat would be a conda bug.\nWhat is the environment on that system after `conda deactivate`?",
    "created_at": "2020-01-13T14:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412329",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:12 dimpase]:
> Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:
> 
> ```
> # >>> conda initialize >>>
> # !! Contents within this block are managed by 'conda init' !! ...
> ```
> - deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.


That would be a conda bug.
What is the environment on that system after `conda deactivate`?



---

archive/issue_comments_412330.json:
```json
{
    "body": "<a id='comment:14'></a>If I leave these things uncommented, and ssh into the box, I land in conda's `(base)`.\nThen\n\n```\n(base) clpc171[~]$ conda deactivate  \nclpc171[~]$ \nclpc171[~]$ logout\nConnection to clpc171.cs.ox.ac.uk closed.\ncoml0531@raven:~$ ssh cs\nLast login: Mon Jan 13 14:07:02 2020 from raven.linux.ox.ac.uk\n(base) clpc171[~]$ \n```\nand I land back into conda, as you see...",
    "created_at": "2020-01-13T14:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412330",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>If I leave these things uncommented, and ssh into the box, I land in conda's `(base)`.
Then

```
(base) clpc171[~]$ conda deactivate  
clpc171[~]$ 
clpc171[~]$ logout
Connection to clpc171.cs.ox.ac.uk closed.
coml0531@raven:~$ ssh cs
Last login: Mon Jan 13 14:07:02 2020 from raven.linux.ox.ac.uk
(base) clpc171[~]$ 
```
and I land back into conda, as you see...



---

archive/issue_comments_412331.json:
```json
{
    "body": "<a id='comment:15'></a>That's normal.\n`conda deactivate` and `conda activate` manipulate the environment of the current shell.",
    "created_at": "2020-01-13T14:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412331",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>That's normal.
`conda deactivate` and `conda activate` manipulate the environment of the current shell.



---

archive/issue_comments_412332.json:
```json
{
    "body": "<a id='comment:16'></a>but then every `sh` call in a build that happens to source `~/.bashrc` activates conda, resulting in broken builds.",
    "created_at": "2020-01-13T14:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412332",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>but then every `sh` call in a build that happens to source `~/.bashrc` activates conda, resulting in broken builds.



---

archive/issue_comments_412333.json:
```json
{
    "body": "<a id='comment:17'></a>E.g.:\n\n```\nclpc171[~]$ bash\n(base) clpc171[~]$ \n```\n\nGiven that `bash` is called in a lot of places in `build/` we obviously have a problem.",
    "created_at": "2020-01-13T14:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412333",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>E.g.:

```
clpc171[~]$ bash
(base) clpc171[~]$ 
```

Given that `bash` is called in a lot of places in `build/` we obviously have a problem.



---

archive/issue_comments_412334.json:
```json
{
    "body": "<a id='comment:18'></a>The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.",
    "created_at": "2020-01-13T15:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412334",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.



---

archive/issue_comments_412335.json:
```json
{
    "body": "<a id='comment:19'></a>I have not done anything special to install conda on that box. Perhaps it just has no .bash_profile\n\nI will check as soon as I am back to keyboard. Feels like a conda bug to me.",
    "created_at": "2020-01-13T15:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412335",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>I have not done anything special to install conda on that box. Perhaps it just has no .bash_profile

I will check as soon as I am back to keyboard. Feels like a conda bug to me.



---

archive/issue_comments_412336.json:
```json
{
    "body": "<a id='comment:20'></a>It may be behavior of older versions of conda. In any case, also `~/.bashrc` is only run by **interactive** bash invocations. If one of our build scripts calls it, that's a bug on our side.",
    "created_at": "2020-01-13T15:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412336",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>It may be behavior of older versions of conda. In any case, also `~/.bashrc` is only run by **interactive** bash invocations. If one of our build scripts calls it, that's a bug on our side.



---

archive/issue_comments_412337.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:18 mkoeppe]:\n> The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.\n\nI think it may be a difference in `conda init` behavior between mac and linux.",
    "created_at": "2020-01-13T15:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412337",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Replying to [comment:18 mkoeppe]:
> The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.

I think it may be a difference in `conda init` behavior between mac and linux.



---

archive/issue_comments_412338.json:
```json
{
    "body": "<a id='comment:22'></a>I do have `~/.bash_profile` - but it was not used by `conda init` (which I did last month, so it's a pretty recent install).\n\nI'll move that chunk to `~/.bash_profile` and verify whether it allows to build.\n\nIsuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?",
    "created_at": "2020-01-13T16:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412338",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>I do have `~/.bash_profile` - but it was not used by `conda init` (which I did last month, so it's a pretty recent install).

I'll move that chunk to `~/.bash_profile` and verify whether it allows to build.

Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?



---

archive/issue_comments_412339.json:
```json
{
    "body": "<a id='comment:23'></a>> Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?\n\n\nYou could do,\n\n```\nconda config --set auto_activate_base false\n```\n\nto make it not initialize by default.",
    "created_at": "2020-01-13T16:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412339",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:23'></a>> Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?


You could do,

```
conda config --set auto_activate_base false
```

to make it not initialize by default.



---

archive/issue_comments_412340.json:
```json
{
    "body": "<a id='comment:24'></a>See also, https://stackoverflow.com/a/57974390/4768820",
    "created_at": "2020-01-13T16:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412340",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:24'></a>See also, https://stackoverflow.com/a/57974390/4768820



---

archive/issue_comments_412341.json:
```json
{
    "body": "<a id='comment:25'></a>ok, so this stuff has to be in Sage's docs.\n\none way or another, why would anyone want automatic activation of conda in non-login shell?",
    "created_at": "2020-01-13T17:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412341",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>ok, so this stuff has to be in Sage's docs.

one way or another, why would anyone want automatic activation of conda in non-login shell?



---

archive/issue_comments_412342.json:
```json
{
    "body": "<a id='comment:26'></a>For what it's worth, I very recently installed anaconda on a Mac, and the installation wrote to `.bash_profile`, not `.bashrc`.",
    "created_at": "2020-01-13T18:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412342",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>For what it's worth, I very recently installed anaconda on a Mac, and the installation wrote to `.bash_profile`, not `.bashrc`.



---

archive/issue_comments_412343.json:
```json
{
    "body": "<a id='comment:27'></a>FWIW, I successfully built sage from scratch after `conda deactivate`. But this is with a miniconda installation with a clean `base` environment.\n\nI'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.",
    "created_at": "2020-01-13T18:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412343",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>FWIW, I successfully built sage from scratch after `conda deactivate`. But this is with a miniconda installation with a clean `base` environment.

I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.



---

archive/issue_comments_412344.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 dimpase]:\n> one way or another, why would anyone want automatic activation of conda in non-login shell?\n\n\nI don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).",
    "created_at": "2020-01-13T18:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412344",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Replying to [comment:25 dimpase]:
> one way or another, why would anyone want automatic activation of conda in non-login shell?


I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).



---

archive/issue_comments_412345.json:
```json
{
    "body": "Changing keywords from \"Anaconda\" to \"Anaconda, conda\".",
    "created_at": "2020-01-13T18:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412345",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "Anaconda" to "Anaconda, conda".



---

archive/issue_comments_412346.json:
```json
{
    "body": "Changing keywords from \"Anaconda, conda\" to \"conda\".",
    "created_at": "2020-01-13T18:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412346",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "Anaconda, conda" to "conda".



---

archive/issue_comments_412347.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:25 dimpase]:\n> ok, so this stuff has to be in Sage's docs.\n\n\nI'll update the doc in this ticket.",
    "created_at": "2020-01-13T18:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Replying to [comment:25 dimpase]:
> ok, so this stuff has to be in Sage's docs.


I'll update the doc in this ticket.



---

archive/issue_comments_412348.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-13T18:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412349.json:
```json
{
    "body": "Attachment [Dockerfile-build-within-conda](tarball://root/attachments/some-uuid/ticket27699/Dockerfile-build-within-conda) by @mkoeppe created at 2020-01-14 03:25:47",
    "created_at": "2020-01-14T03:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412349",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [Dockerfile-build-within-conda](tarball://root/attachments/some-uuid/ticket27699/Dockerfile-build-within-conda) by @mkoeppe created at 2020-01-14 03:25:47



---

archive/issue_comments_412350.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:27 mkoeppe]:\n> I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.\n\n\nSee the attached Dockerfile for this setup.",
    "created_at": "2020-01-14T03:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412350",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Replying to [comment:27 mkoeppe]:
> I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.


See the attached Dockerfile for this setup.



---

archive/issue_comments_412351.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:28 mkoeppe]:\n> Replying to [comment:25 dimpase]:\n> > one way or another, why would anyone want automatic activation of conda in non-login shell?\n\n> \n> I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).\n\n\nWell, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off. Can we test that Conda has `auto_activate_base=false` - if we are outside conda?\n\nAs well, the docs ought to mention comment:23 (atm they only tell how to use conda, but they also ought to tell how not to)",
    "created_at": "2020-01-14T11:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412351",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>Replying to [comment:28 mkoeppe]:
> Replying to [comment:25 dimpase]:
> > one way or another, why would anyone want automatic activation of conda in non-login shell?

> 
> I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).


Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off. Can we test that Conda has `auto_activate_base=false` - if we are outside conda?

As well, the docs ought to mention comment:23 (atm they only tell how to use conda, but they also ought to tell how not to)



---

archive/issue_comments_412352.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 dimpase]:\n> Replying to [comment:28 mkoeppe]:\n> > Replying to [comment:25 dimpase]:\n> > > one way or another, why would anyone want automatic activation of conda in non-login shell?\n\n> > \n> > I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).\n\n> \n> Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off.\n\n\nIf there is such a bug in the testsuite, we'll fix it. \n\nThis really isn't specific to conda. Users' interactive shell configuration in  ~/.bashrc could also define all kinds of incompatible `alias`es or print arbitrary output etc. that could confuse a doctest.\n\n> Can we test that Conda has `auto_activate_base=false` - if we are outside conda?\n\n\nI don't know what you mean by that.\n\n> As well, the docs ought to mention comment:23 (atm they only tell how to use conda, but they also ought to tell how not to)\n\n\nThe added docs already mention `conda deactivate`. And that is sufficient. \n\nTelling the user that they have to disable conda by editing their init scripts, or uninstall conda, or change their conda configuration --- all of this is going in the wrong direction for Sage.",
    "created_at": "2020-01-14T14:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412352",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Replying to [comment:34 dimpase]:
> Replying to [comment:28 mkoeppe]:
> > Replying to [comment:25 dimpase]:
> > > one way or another, why would anyone want automatic activation of conda in non-login shell?

> > 
> > I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).

> 
> Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off.


If there is such a bug in the testsuite, we'll fix it. 

This really isn't specific to conda. Users' interactive shell configuration in  ~/.bashrc could also define all kinds of incompatible `alias`es or print arbitrary output etc. that could confuse a doctest.

> Can we test that Conda has `auto_activate_base=false` - if we are outside conda?


I don't know what you mean by that.

> As well, the docs ought to mention comment:23 (atm they only tell how to use conda, but they also ought to tell how not to)


The added docs already mention `conda deactivate`. And that is sufficient. 

Telling the user that they have to disable conda by editing their init scripts, or uninstall conda, or change their conda configuration --- all of this is going in the wrong direction for Sage.



---

archive/issue_comments_412353.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:33 mkoeppe]:\n> Replying to [comment:27 mkoeppe]:\n> > I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.\n\n> \n> See the attached Dockerfile for this setup.\n\n\nWith #29026 (which fixes a compile error in the conda environment reported in #29005), this works fine.",
    "created_at": "2020-01-18T02:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412353",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Replying to [comment:33 mkoeppe]:
> Replying to [comment:27 mkoeppe]:
> > I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.

> 
> See the attached Dockerfile for this setup.


With #29026 (which fixes a compile error in the conda environment reported in #29005), this works fine.



---

archive/issue_comments_412354.json:
```json
{
    "body": "<a id='comment:38'></a>I will not add #29026 as a dependency because the main purpose of the present ticket is to prevent broken builds in the situation described in the ticket.\n\nNeeds review.",
    "created_at": "2020-01-18T02:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412354",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>I will not add #29026 as a dependency because the main purpose of the present ticket is to prevent broken builds in the situation described in the ticket.

Needs review.



---

archive/issue_comments_412355.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-27T20:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412355",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_412356.json:
```json
{
    "body": "<a id='comment:41'></a>This would break building the conda package.",
    "created_at": "2020-01-27T20:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412356",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:41'></a>This would break building the conda package.



---

archive/issue_comments_412357.json:
```json
{
    "body": "<a id='comment:42'></a>When building the conda package, are the c-compiler, cxx-compiler, and fortran-compiler packages not installed?",
    "created_at": "2020-01-27T22:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412357",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>When building the conda package, are the c-compiler, cxx-compiler, and fortran-compiler packages not installed?



---

archive/issue_comments_412358.json:
```json
{
    "body": "<a id='comment:43'></a>Nope. Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.",
    "created_at": "2020-01-27T22:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412358",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:43'></a>Nope. Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.



---

archive/issue_comments_412359.json:
```json
{
    "body": "<a id='comment:44'></a>Would you have a suggestion how we should test this more generally?",
    "created_at": "2020-01-27T22:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412359",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>Would you have a suggestion how we should test this more generally?



---

archive/issue_comments_412360.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:43 isuruf]:\n> Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.\n\nIn that case, are the environment variables CC and CXX guaranteed to be set?",
    "created_at": "2020-04-23T03:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412360",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Replying to [comment:43 isuruf]:
> Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.

In that case, are the environment variables CC and CXX guaranteed to be set?



---

archive/issue_comments_412361.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-23T04:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412362.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-23T04:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412363.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+This ticket makes it an error at \\`configure\\` time if an Anaconda environment is active \n+that does not have the \\`c-compiler\\`, \\`cxx-compiler\\`, and \\`fortran-compiler\\` packages (or equivalent).\n \n+Many support requests come from the failure of Sage to build or\n+to run in the presence of Anaconda.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-04-23T04:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412363",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+This ticket makes it an error at \`configure\` time if an Anaconda environment is active 
+that does not have the \`c-compiler\`, \`cxx-compiler\`, and \`fortran-compiler\` packages (or equivalent).
 
+Many support requests come from the failure of Sage to build or
+to run in the presence of Anaconda.
 
 Comment: 1
 
```




---

archive/issue_comments_412364.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-23T04:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412364",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_412365.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:45 mkoeppe]:\n> Replying to [comment:43 isuruf]:\n> > Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.\n\n> In that case, are the environment variables CC and CXX guaranteed to be set?\n\nYes.",
    "created_at": "2020-04-23T04:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412365",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:49'></a>Replying to [comment:45 mkoeppe]:
> Replying to [comment:43 isuruf]:
> > Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.

> In that case, are the environment variables CC and CXX guaranteed to be set?

Yes.



---

archive/issue_comments_412366.json:
```json
{
    "body": "<a id='comment:50'></a>Then is the updated branch OK for building the conda package?",
    "created_at": "2020-04-23T06:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412366",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Then is the updated branch OK for building the conda package?



---

archive/issue_comments_412367.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-04-23T17:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412367",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_412368.json:
```json
{
    "body": "<a id='comment:53'></a>`@`isuruf Any objections?",
    "created_at": "2020-04-25T05:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412368",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>`@`isuruf Any objections?



---

archive/issue_comments_412369.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-25T06:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412369",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412370.json:
```json
{
    "body": "<a id='comment:55'></a>Thank you!",
    "created_at": "2020-04-25T06:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412370",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>Thank you!



---

archive/issue_comments_412371.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-25T22:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412371",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_412372.json:
```json
{
    "body": "<a id='comment:56'></a>Merge conflict",
    "created_at": "2020-04-25T22:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412372",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>Merge conflict



---

archive/issue_comments_412373.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-25T22:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412374.json:
```json
{
    "body": "<a id='comment:58'></a>rebased on 9.1.rc2",
    "created_at": "2020-04-25T22:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412374",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>rebased on 9.1.rc2



---

archive/issue_comments_412375.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-04-25T22:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412375",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_412376.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-02T21:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27699#issuecomment-412376",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068702.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-02T21:58:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27699",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27699#event-68702"
}
```
