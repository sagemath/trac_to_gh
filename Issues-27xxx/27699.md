# Issue 27699: configure: Exit with error if an Anaconda environment without compilers is active

archive/issues_027462.json:
```json
{
    "body": "This ticket makes it an error at `configure` time if an Anaconda environment is active \nthat does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).\n\nMany support requests come from the failure of Sage to build or\nto run in the presence of Anaconda.\n\n**CC:**  @dimpase @saraedum @isuruf @jhpalmieri @embray @tscrim @kiwifb\n\n**Keywords:** conda\n\n**Branch/Commit:** [4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)\n\n**Reviewer:** Isuru Fernando\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/27699\n\n",
    "closed_at": "2020-05-02T21:58:39Z",
    "created_at": "2019-04-18T13:48:22Z",
    "labels": [
        "component: build",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "configure: Exit with error if an Anaconda environment without compilers is active",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/27699",
    "user": "https://github.com/slel"
}
```
This ticket makes it an error at `configure` time if an Anaconda environment is active 
that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).

Many support requests come from the failure of Sage to build or
to run in the presence of Anaconda.

**CC:**  @dimpase @saraedum @isuruf @jhpalmieri @embray @tscrim @kiwifb

**Keywords:** conda

**Branch/Commit:** [4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)

**Reviewer:** Isuru Fernando

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/27699





---

archive/issue_comments_432117.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).",
    "created_at": "2019-05-10T11:14:17Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432117",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).



---

archive/issue_comments_432118.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [embray](#comment%3A1):\n> I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).\n\n+1",
    "created_at": "2019-06-04T01:31:14Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Replying to [embray](#comment%3A1):
> I think it would be best to just make it possible to build sage in an anaconda env (at least given the right dependencies).

+1



---

archive/issue_comments_432119.json:
```json
{
    "body": "<a id='comment:3'></a>\nFirst ticket: #27941",
    "created_at": "2019-06-06T20:49:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
First ticket: #27941



---

archive/issue_comments_432120.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432120",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_244447.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244447"
}
```



---

archive/issue_comments_432121.json:
```json
{
    "body": "<a id='comment:5'></a>\nAs discussed in #27941, if Anaconda is detected, it may suffice to add an `-rpath` directive to our `LDFLAGS` to enable linking against the libraries provided by Anaconda.",
    "created_at": "2019-06-21T03:08:13Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432121",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
As discussed in #27941, if Anaconda is detected, it may suffice to add an `-rpath` directive to our `LDFLAGS` to enable linking against the libraries provided by Anaconda.



---

archive/issue_comments_432122.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt suffices to install the following conda packages:\n- c-compiler\n- cxx-compiler\n- fortran-compiler\nThey take care of adding the necessary flags. See https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html (end) and also #28745.",
    "created_at": "2019-11-17T19:14:06Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432122",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
It suffices to install the following conda packages:
- c-compiler
- cxx-compiler
- fortran-compiler
They take care of adding the necessary flags. See https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html (end) and also #28745.



---

archive/issue_events_244448.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-11T00:34:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244448"
}
```



---

archive/issue_comments_432123.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-01-11T00:34:05Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432123",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_432124.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n-This ticket is to detect the presence of Anaconda when building or\n-starting Sage, and output a helpful warning or error message in\n-cases where it is likely to cause, or when it causes, trouble.\n+This ticket makes it an error at `configure` time if an Anaconda environment is active \n+that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages.\n \n Many support requests come from the failure of Sage to build or\n to run in the presence of Anaconda.\n``````\n",
    "created_at": "2020-01-11T00:34:05Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432124",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
-This ticket is to detect the presence of Anaconda when building or
-starting Sage, and output a helpful warning or error message in
-cases where it is likely to cause, or when it causes, trouble.
+This ticket makes it an error at `configure` time if an Anaconda environment is active 
+that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages.
 
 Many support requests come from the failure of Sage to build or
 to run in the presence of Anaconda.
``````




---

archive/issue_events_244449.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-11T00:34:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244449"
}
```



---

archive/issue_comments_432125.json:
```json
{
    "body": "**Branch:** [public/27699-detect-anaconda](https://github.com/sagemath/sagetrac-mirror/tree/public/27699-detect-anaconda)",
    "created_at": "2020-01-11T01:49:24Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432125",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [public/27699-detect-anaconda](https://github.com/sagemath/sagetrac-mirror/tree/public/27699-detect-anaconda)



---

archive/issue_comments_432126.json:
```json
{
    "body": "**Commit:** [f75a807db54b3d602332a5927c73317bfd6bffd6](https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6)",
    "created_at": "2020-01-11T01:50:17Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432126",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [f75a807db54b3d602332a5927c73317bfd6bffd6](https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6)



---

archive/issue_comments_432127.json:
```json
{
    "body": "<a id='comment:9'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6\">f75a807</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr></table>\n",
    "created_at": "2020-01-11T01:50:17Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6">f75a807</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr></table>




---

archive/issue_events_244450.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-11T01:50:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244450"
}
```



---

archive/issue_comments_432128.json:
```json
{
    "body": "<a id='comment:12'></a>\nNice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:\n\n```\n# >>> conda initialize >>>\n# !! Contents within this block are managed by 'conda init' !!\n__conda_setup=\"$('/home/scratch2/dimpase/miniconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)\"\n if [ $? -eq 0 ]; then\n    eval \"$__conda_setup\"\n else\n    if [ -f \"/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh\" ]; then\n        . \"/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh\"\n    else\n        export PATH=\"/home/scratch2/dimpase/miniconda3/bin:$PATH\"\n    fi\nfi\n```\n- deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.",
    "created_at": "2020-01-13T11:02:52Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432128",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:

```
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/scratch2/dimpase/miniconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
 if [ $? -eq 0 ]; then
    eval "$__conda_setup"
 else
    if [ -f "/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh" ]; then
        . "/home/scratch2/dimpase/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="/home/scratch2/dimpase/miniconda3/bin:$PATH"
    fi
fi
```
- deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.



---

archive/issue_comments_432129.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [dimpase](#comment%3A12):\n> Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:\n> \n> ```\n> # >>> conda initialize >>>\n> # !! Contents within this block are managed by 'conda init' !! ...\n> ```\n> - deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.\n\nThat would be a conda bug.\nWhat is the environment on that system after `conda deactivate`?",
    "created_at": "2020-01-13T14:00:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432129",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Replying to [dimpase](#comment%3A12):
> Nice, but does it always do the job? E.g. I noticed that I must comment out everything in the following block inserted by conda into my `.bashrc`:
> 
> ```
> # >>> conda initialize >>>
> # !! Contents within this block are managed by 'conda init' !! ...
> ```
> - deactivating conda is not enough to let a conda-less build of Sage complete on Fedora.

That would be a conda bug.
What is the environment on that system after `conda deactivate`?



---

archive/issue_comments_432130.json:
```json
{
    "body": "<a id='comment:14'></a>\nIf I leave these things uncommented, and ssh into the box, I land in conda's `(base)`.\nThen\n\n```\n(base) clpc171[~]$ conda deactivate  \nclpc171[~]$ \nclpc171[~]$ logout\nConnection to clpc171.cs.ox.ac.uk closed.\ncoml0531@raven:~$ ssh cs\nLast login: Mon Jan 13 14:07:02 2020 from raven.linux.ox.ac.uk\n(base) clpc171[~]$ \n```\nand I land back into conda, as you see...",
    "created_at": "2020-01-13T14:10:07Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432130",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
If I leave these things uncommented, and ssh into the box, I land in conda's `(base)`.
Then

```
(base) clpc171[~]$ conda deactivate  
clpc171[~]$ 
clpc171[~]$ logout
Connection to clpc171.cs.ox.ac.uk closed.
coml0531@raven:~$ ssh cs
Last login: Mon Jan 13 14:07:02 2020 from raven.linux.ox.ac.uk
(base) clpc171[~]$ 
```
and I land back into conda, as you see...



---

archive/issue_comments_432131.json:
```json
{
    "body": "<a id='comment:15'></a>\nThat's normal.\n`conda deactivate` and `conda activate` manipulate the environment of the current shell.",
    "created_at": "2020-01-13T14:15:45Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432131",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
That's normal.
`conda deactivate` and `conda activate` manipulate the environment of the current shell.



---

archive/issue_comments_432132.json:
```json
{
    "body": "<a id='comment:16'></a>\nbut then every `sh` call in a build that happens to source `~/.bashrc` activates conda, resulting in broken builds.",
    "created_at": "2020-01-13T14:27:20Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432132",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
but then every `sh` call in a build that happens to source `~/.bashrc` activates conda, resulting in broken builds.



---

archive/issue_comments_432133.json:
```json
{
    "body": "<a id='comment:17'></a>\nE.g.:\n\n```\nclpc171[~]$ bash\n(base) clpc171[~]$ \n```\n\nGiven that `bash` is called in a lot of places in `build/` we obviously have a problem.",
    "created_at": "2020-01-13T14:37:16Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432133",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
E.g.:

```
clpc171[~]$ bash
(base) clpc171[~]$ 
```

Given that `bash` is called in a lot of places in `build/` we obviously have a problem.



---

archive/issue_comments_432134.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.",
    "created_at": "2020-01-13T15:05:57Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432134",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.



---

archive/issue_comments_432135.json:
```json
{
    "body": "<a id='comment:19'></a>\nI have not done anything special to install conda on that box. Perhaps it just has no .bash_profile\n\nI will check as soon as I am back to keyboard. Feels like a conda bug to me.",
    "created_at": "2020-01-13T15:16:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432135",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
I have not done anything special to install conda on that box. Perhaps it just has no .bash_profile

I will check as soon as I am back to keyboard. Feels like a conda bug to me.



---

archive/issue_comments_432136.json:
```json
{
    "body": "<a id='comment:20'></a>\nIt may be behavior of older versions of conda. In any case, also `~/.bashrc` is only run by **interactive** bash invocations. If one of our build scripts calls it, that's a bug on our side.",
    "created_at": "2020-01-13T15:31:45Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
It may be behavior of older versions of conda. In any case, also `~/.bashrc` is only run by **interactive** bash invocations. If one of our build scripts calls it, that's a bug on our side.



---

archive/issue_comments_432137.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mkoeppe](#comment%3A18):\n> The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.\n\nI think it may be a difference in `conda init` behavior between mac and linux.",
    "created_at": "2020-01-13T15:58:30Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432137",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [mkoeppe](#comment%3A18):
> The conda initialization code belongs into `~/.bash_profile`, not `~/.bashrc`. This is where `conda init` puts it. It is supposed to be invoked for login shells only.

I think it may be a difference in `conda init` behavior between mac and linux.



---

archive/issue_comments_432138.json:
```json
{
    "body": "<a id='comment:22'></a>\nI do have `~/.bash_profile` - but it was not used by `conda init` (which I did last month, so it's a pretty recent install).\n\nI'll move that chunk to `~/.bash_profile` and verify whether it allows to build.\n\nIsuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?",
    "created_at": "2020-01-13T16:22:38Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432138",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
I do have `~/.bash_profile` - but it was not used by `conda init` (which I did last month, so it's a pretty recent install).

I'll move that chunk to `~/.bash_profile` and verify whether it allows to build.

Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?



---

archive/issue_comments_432139.json:
```json
{
    "body": "<a id='comment:23'></a>\n> Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?\n\nYou could do,\n\n```\nconda config --set auto_activate_base false\n```\n\nto make it not initialize by default.",
    "created_at": "2020-01-13T16:43:12Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432139",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:23'></a>
> Isuru, is this not a conda bug, installing that stuff into `~/.bashrc` ?

You could do,

```
conda config --set auto_activate_base false
```

to make it not initialize by default.



---

archive/issue_comments_432140.json:
```json
{
    "body": "<a id='comment:24'></a>\nSee also, https://stackoverflow.com/a/57974390/4768820",
    "created_at": "2020-01-13T16:52:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432140",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:24'></a>
See also, https://stackoverflow.com/a/57974390/4768820



---

archive/issue_comments_432141.json:
```json
{
    "body": "<a id='comment:25'></a>\nok, so this stuff has to be in Sage's docs.\n\none way or another, why would anyone want automatic activation of conda in non-login shell?",
    "created_at": "2020-01-13T17:24:08Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432141",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
ok, so this stuff has to be in Sage's docs.

one way or another, why would anyone want automatic activation of conda in non-login shell?



---

archive/issue_comments_432142.json:
```json
{
    "body": "<a id='comment:26'></a>\nFor what it's worth, I very recently installed anaconda on a Mac, and the installation wrote to `.bash_profile`, not `.bashrc`.",
    "created_at": "2020-01-13T18:02:51Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432142",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
For what it's worth, I very recently installed anaconda on a Mac, and the installation wrote to `.bash_profile`, not `.bashrc`.



---

archive/issue_comments_432143.json:
```json
{
    "body": "<a id='comment:27'></a>\nFWIW, I successfully built sage from scratch after `conda deactivate`. But this is with a miniconda installation with a clean `base` environment.\n\nI'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.",
    "created_at": "2020-01-13T18:08:49Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
FWIW, I successfully built sage from scratch after `conda deactivate`. But this is with a miniconda installation with a clean `base` environment.

I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.



---

archive/issue_comments_432144.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [dimpase](#comment%3A25):\n> one way or another, why would anyone want automatic activation of conda in non-login shell?\n\nI don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).",
    "created_at": "2020-01-13T18:10:08Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432144",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Replying to [dimpase](#comment%3A25):
> one way or another, why would anyone want automatic activation of conda in non-login shell?

I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).



---

archive/issue_comments_432145.json:
```json
{
    "body": "**Changing keywords** from \"Anaconda\" to \"Anaconda, conda\".",
    "created_at": "2020-01-13T18:14:20Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432145",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "Anaconda" to "Anaconda, conda".



---

archive/issue_comments_432146.json:
```json
{
    "body": "**Changing keywords** from \"Anaconda, conda\" to \"conda\".",
    "created_at": "2020-01-13T18:16:41Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432146",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "Anaconda, conda" to "conda".



---

archive/issue_comments_432147.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [dimpase](#comment%3A25):\n> ok, so this stuff has to be in Sage's docs.\n\nI'll update the doc in this ticket.",
    "created_at": "2020-01-13T18:19:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432147",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Replying to [dimpase](#comment%3A25):
> ok, so this stuff has to be in Sage's docs.

I'll update the doc in this ticket.



---

archive/issue_comments_432148.json:
```json
{
    "body": "**Changing commit** from \"[f75a807db54b3d602332a5927c73317bfd6bffd6](https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6)\" to \"[d5f5e9aa2cf58debe727d3867719b1ab65a575a8](https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8)\".",
    "created_at": "2020-01-13T18:44:26Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f75a807db54b3d602332a5927c73317bfd6bffd6](https://github.com/sagemath/sagetrac-mirror/commit/f75a807db54b3d602332a5927c73317bfd6bffd6)" to "[d5f5e9aa2cf58debe727d3867719b1ab65a575a8](https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8)".



---

archive/issue_comments_432149.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8\">d5f5e9a</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr></table>\n",
    "created_at": "2020-01-13T18:44:26Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8">d5f5e9a</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr></table>




---

archive/attachments_021914.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "Dockerfile-build-within-conda",
    "asset_url": "tarball://root/attachments/ticket27699/Dockerfile-build-within-conda",
    "created_at": "2020-01-14T03:25:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket27699/Dockerfile-build-within-conda",
    "user": "https://github.com/mkoeppe"
}
```



---

archive/issue_comments_432150.json:
```json
{
    "body": "**Attachment:** [Dockerfile-build-within-conda](https://github.com/sagemath/sage/files/ticket27699/Dockerfile-build-within-conda)",
    "created_at": "2020-01-14T03:25:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432150",
    "user": "https://github.com/mkoeppe"
}
```

**Attachment:** [Dockerfile-build-within-conda](https://github.com/sagemath/sage/files/ticket27699/Dockerfile-build-within-conda)



---

archive/issue_comments_432151.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [mkoeppe](#comment%3A27):\n> I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.\n\nSee the attached Dockerfile for this setup.",
    "created_at": "2020-01-14T03:54:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432151",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [mkoeppe](#comment%3A27):
> I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.

See the attached Dockerfile for this setup.



---

archive/issue_comments_432152.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [mkoeppe](#comment%3A28):\n> Replying to [dimpase](#comment%3A25):\n> > one way or another, why would anyone want automatic activation of conda in non-login shell?\n\n> \n> I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).\n\nWell, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off. Can we test that Conda has `auto_activate_base=false` - if we are outside conda?\n\nAs well, the docs ought to mention [comment:23](#comment%3A23) (atm they only tell how to use conda, but they also ought to tell how not to)",
    "created_at": "2020-01-14T11:36:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432152",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Replying to [mkoeppe](#comment%3A28):
> Replying to [dimpase](#comment%3A25):
> > one way or another, why would anyone want automatic activation of conda in non-login shell?

> 
> I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).

Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off. Can we test that Conda has `auto_activate_base=false` - if we are outside conda?

As well, the docs ought to mention [comment:23](#comment%3A23) (atm they only tell how to use conda, but they also ought to tell how not to)



---

archive/issue_comments_432153.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [dimpase](#comment%3A34):\n> Replying to [mkoeppe](#comment%3A28):\n> > Replying to [dimpase](#comment%3A25):\n> > > one way or another, why would anyone want automatic activation of conda in non-login shell?\n\n> > \n> > I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).\n\n> \n> Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off.\n\nIf there is such a bug in the testsuite, we'll fix it. \n\nThis really isn't specific to conda. Users' interactive shell configuration in  ~/.bashrc could also define all kinds of incompatible `alias`es or print arbitrary output etc. that could confuse a doctest.\n\n> Can we test that Conda has `auto_activate_base=false` - if we are outside conda?\n\nI don't know what you mean by that.\n\n> As well, the docs ought to mention [comment:23](#comment%3A23) (atm they only tell how to use conda, but they also ought to tell how not to)\n\nThe added docs already mention `conda deactivate`. And that is sufficient. \n\nTelling the user that they have to disable conda by editing their init scripts, or uninstall conda, or change their conda configuration --- all of this is going in the wrong direction for Sage.",
    "created_at": "2020-01-14T14:06:09Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Replying to [dimpase](#comment%3A34):
> Replying to [mkoeppe](#comment%3A28):
> > Replying to [dimpase](#comment%3A25):
> > > one way or another, why would anyone want automatic activation of conda in non-login shell?

> > 
> > I don't know but it does not matter as long as it's not also done in noninteractive shells (which it isn't).

> 
> Well, I can imagine a Sage test invoking an interactive shell, and then, well, all the bets are off.

If there is such a bug in the testsuite, we'll fix it. 

This really isn't specific to conda. Users' interactive shell configuration in  ~/.bashrc could also define all kinds of incompatible `alias`es or print arbitrary output etc. that could confuse a doctest.

> Can we test that Conda has `auto_activate_base=false` - if we are outside conda?

I don't know what you mean by that.

> As well, the docs ought to mention [comment:23](#comment%3A23) (atm they only tell how to use conda, but they also ought to tell how not to)

The added docs already mention `conda deactivate`. And that is sufficient. 

Telling the user that they have to disable conda by editing their init scripts, or uninstall conda, or change their conda configuration --- all of this is going in the wrong direction for Sage.



---

archive/issue_comments_432154.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [mkoeppe](#comment%3A33):\n> Replying to [mkoeppe](#comment%3A27):\n> > I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.\n\n> \n> See the attached Dockerfile for this setup.\n\nWith #29026 (which fixes a compile error in the conda environment reported in #29005), this works fine.",
    "created_at": "2020-01-18T02:03:34Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432154",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Replying to [mkoeppe](#comment%3A33):
> Replying to [mkoeppe](#comment%3A27):
> > I'll test again on Linux with a dirty `base` environment that has lots of `bin/*-config` executables - this was the problem in #27941.

> 
> See the attached Dockerfile for this setup.

With #29026 (which fixes a compile error in the conda environment reported in #29005), this works fine.



---

archive/issue_comments_432155.json:
```json
{
    "body": "<a id='comment:38'></a>\nI will not add #29026 as a dependency because the main purpose of the present ticket is to prevent broken builds in the situation described in the ticket.\n\nNeeds review.",
    "created_at": "2020-01-18T02:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
I will not add #29026 as a dependency because the main purpose of the present ticket is to prevent broken builds in the situation described in the ticket.

Needs review.



---

archive/issue_events_244451.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-27T20:16:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244451"
}
```



---

archive/issue_events_244452.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-27T20:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244452"
}
```



---

archive/issue_comments_432156.json:
```json
{
    "body": "<a id='comment:41'></a>\nThis would break building the conda package.",
    "created_at": "2020-01-27T20:16:48Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432156",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:41'></a>
This would break building the conda package.



---

archive/issue_comments_432157.json:
```json
{
    "body": "<a id='comment:42'></a>\nWhen building the conda package, are the c-compiler, cxx-compiler, and fortran-compiler packages not installed?",
    "created_at": "2020-01-27T22:04:46Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432157",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
When building the conda package, are the c-compiler, cxx-compiler, and fortran-compiler packages not installed?



---

archive/issue_comments_432158.json:
```json
{
    "body": "<a id='comment:43'></a>\nNope. Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.",
    "created_at": "2020-01-27T22:16:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432158",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:43'></a>
Nope. Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.



---

archive/issue_comments_432159.json:
```json
{
    "body": "<a id='comment:44'></a>\nWould you have a suggestion how we should test this more generally?",
    "created_at": "2020-01-27T22:18:24Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432159",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Would you have a suggestion how we should test this more generally?



---

archive/issue_comments_432160.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [isuruf](#comment%3A43):\n> Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.\n\nIn that case, are the environment variables CC and CXX guaranteed to be set?",
    "created_at": "2020-04-23T03:57:05Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Replying to [isuruf](#comment%3A43):
> Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.

In that case, are the environment variables CC and CXX guaranteed to be set?



---

archive/issue_comments_432161.json:
```json
{
    "body": "**Changing commit** from \"[d5f5e9aa2cf58debe727d3867719b1ab65a575a8](https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8)\" to \"[d566fdd8d24012d41872ec654c05b2d926f31c5c](https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c)\".",
    "created_at": "2020-04-23T04:03:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d5f5e9aa2cf58debe727d3867719b1ab65a575a8](https://github.com/sagemath/sagetrac-mirror/commit/d5f5e9aa2cf58debe727d3867719b1ab65a575a8)" to "[d566fdd8d24012d41872ec654c05b2d926f31c5c](https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c)".



---

archive/issue_comments_432162.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f854dd27a9b10fe61fdda716ada2be1416035ea8\">f854dd2</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c\">d566fdd</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr></table>\n",
    "created_at": "2020-04-23T04:03:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f854dd27a9b10fe61fdda716ada2be1416035ea8">f854dd2</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c">d566fdd</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr></table>




---

archive/issue_comments_432163.json:
```json
{
    "body": "**Changing commit** from \"[d566fdd8d24012d41872ec654c05b2d926f31c5c](https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c)\" to \"[193593a858ab42500d7095e17fe140a5810296f1](https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1)\".",
    "created_at": "2020-04-23T04:12:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d566fdd8d24012d41872ec654c05b2d926f31c5c](https://github.com/sagemath/sagetrac-mirror/commit/d566fdd8d24012d41872ec654c05b2d926f31c5c)" to "[193593a858ab42500d7095e17fe140a5810296f1](https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1)".



---

archive/issue_comments_432164.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1\">193593a</a></td><td><code>m4/sage_check_conda_compilers.m4: Check environment variables CC, CXX, FC</code></td></tr></table>\n",
    "created_at": "2020-04-23T04:12:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1">193593a</a></td><td><code>m4/sage_check_conda_compilers.m4: Check environment variables CC, CXX, FC</code></td></tr></table>




---

archive/issue_comments_432165.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n This ticket makes it an error at `configure` time if an Anaconda environment is active \n-that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages.\n+that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).\n \n Many support requests come from the failure of Sage to build or\n to run in the presence of Anaconda.\n``````\n",
    "created_at": "2020-04-23T04:13:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432165",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 This ticket makes it an error at `configure` time if an Anaconda environment is active 
-that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages.
+that does not have the `c-compiler`, `cxx-compiler`, and `fortran-compiler` packages (or equivalent).
 
 Many support requests come from the failure of Sage to build or
 to run in the presence of Anaconda.
``````




---

archive/issue_events_244453.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-23T04:13:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244453"
}
```



---

archive/issue_events_244454.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-23T04:13:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244454"
}
```



---

archive/issue_comments_432166.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [mkoeppe](#comment%3A45):\n> Replying to [isuruf](#comment%3A43):\n> > Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.\n\n> In that case, are the environment variables CC and CXX guaranteed to be set?\n\nYes.",
    "created_at": "2020-04-23T04:19:25Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432166",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:49'></a>
Replying to [mkoeppe](#comment%3A45):
> Replying to [isuruf](#comment%3A43):
> > Individual packages like `gcc_linux-64` (or `clang_osx-64`) are installed.

> In that case, are the environment variables CC and CXX guaranteed to be set?

Yes.



---

archive/issue_comments_432167.json:
```json
{
    "body": "<a id='comment:50'></a>\nThen is the updated branch OK for building the conda package?",
    "created_at": "2020-04-23T06:54:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432167",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
Then is the updated branch OK for building the conda package?



---

archive/issue_events_244455.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-23T17:57:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244455"
}
```



---

archive/issue_events_244456.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T03:39:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "rename": {
        "from": "Detect Anaconda",
        "to": "configure: Exit with error if an Anaconda environment without compilers is active"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244456"
}
```



---

archive/issue_comments_432168.json:
```json
{
    "body": "<a id='comment:53'></a>\n@isuruf Any objections?",
    "created_at": "2020-04-25T05:41:24Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432168",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
@isuruf Any objections?



---

archive/issue_events_244457.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-25T06:16:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244457"
}
```



---

archive/issue_events_244458.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-25T06:16:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244458"
}
```



---

archive/issue_comments_432169.json:
```json
{
    "body": "**Reviewer:** Isuru Fernando",
    "created_at": "2020-04-25T06:16:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432169",
    "user": "https://github.com/isuruf"
}
```

**Reviewer:** Isuru Fernando



---

archive/issue_comments_432170.json:
```json
{
    "body": "<a id='comment:55'></a>\nThank you!",
    "created_at": "2020-04-25T06:17:19Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
Thank you!



---

archive/issue_events_244459.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-25T22:16:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244459"
}
```



---

archive/issue_events_244460.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-25T22:16:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244460"
}
```



---

archive/issue_comments_432171.json:
```json
{
    "body": "<a id='comment:56'></a>\nMerge conflict",
    "created_at": "2020-04-25T22:16:37Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432171",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>
Merge conflict



---

archive/issue_comments_432172.json:
```json
{
    "body": "**Changing commit** from \"[193593a858ab42500d7095e17fe140a5810296f1](https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1)\" to \"[4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)\".",
    "created_at": "2020-04-25T22:43:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[193593a858ab42500d7095e17fe140a5810296f1](https://github.com/sagemath/sagetrac-mirror/commit/193593a858ab42500d7095e17fe140a5810296f1)" to "[4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)".



---

archive/issue_comments_432173.json:
```json
{
    "body": "<a id='comment:57'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/234d23c8e1a1e288f14692c15a5166be5b60fa85\">234d23c</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be7b4467173e87c8a42bd937826c5cad4e91e4bc\">be7b446</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6\">4ac6aaf</a></td><td><code>m4/sage_check_conda_compilers.m4: Check environment variables CC, CXX, FC</code></td></tr></table>\n",
    "created_at": "2020-04-25T22:43:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/234d23c8e1a1e288f14692c15a5166be5b60fa85">234d23c</a></td><td><code>configure.ac, m4/sage_check_conda_compilers.m4: Check for conda</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be7b4467173e87c8a42bd937826c5cad4e91e4bc">be7b446</a></td><td><code>src/doc/en/installation/source.rst: Add notes on using Anaconda/Miniconda</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6">4ac6aaf</a></td><td><code>m4/sage_check_conda_compilers.m4: Check environment variables CC, CXX, FC</code></td></tr></table>




---

archive/issue_comments_432174.json:
```json
{
    "body": "<a id='comment:58'></a>\nrebased on 9.1.rc2",
    "created_at": "2020-04-25T22:44:13Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432174",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
rebased on 9.1.rc2



---

archive/issue_events_244461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T22:44:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244461"
}
```



---

archive/issue_events_244462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T22:44:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244462"
}
```



---

archive/issue_comments_432175.json:
```json
{
    "body": "**Changing branch** from \"[public/27699-detect-anaconda](https://github.com/sagemath/sagetrac-mirror/tree/public/27699-detect-anaconda)\" to \"[4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)\".",
    "created_at": "2020-05-02T21:58:39Z",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27699#issuecomment-432175",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/27699-detect-anaconda](https://github.com/sagemath/sagetrac-mirror/tree/public/27699-detect-anaconda)" to "[4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6](https://github.com/sagemath/sagetrac-mirror/commit/4ac6aaf4cc0f91300ee31d31401631a6f4fc60e6)".



---

archive/issue_events_244463.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-02T21:58:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244463"
}
```



---

archive/issue_events_244464.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "790f4237bc83cd2607d14ded2dcedcfebc2ef0ec",
    "created_at": "2020-05-02T21:58:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27699",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27699#event-244464"
}
```
