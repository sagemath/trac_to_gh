# Issue 27360: upgrade eclib to v20190226

archive/issues_027123.json:
```json
{
    "assignees": [],
    "body": "Release v20170815 introduced a modular symbol scaling bug (while sorting out modular symbol scaling essentially correctly) in functions not currently used by Sage.  Other releases since the current one in Sage (v20180815) make some interface changes including precision handling (now using bits not digits), so some Sage code changes are likely to be necessary.\n\nUpdated source: http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20190226.tar.bz2\n\nCC:  @slel @kiwifb @timokau\n\nKeywords: **eclib, upgrade**\n\nBranch: **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**\n\nReviewer: **Jeroen Demeyer, John Cremona**\n\nAuthor: **John Cremona, Jeroen Demeyer**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27360_\n\n",
    "closed_at": "2019-03-13T18:29:33Z",
    "created_at": "2019-02-26T11:10:16Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "upgrade eclib to v20190226",
    "type": "issue",
    "updated_at": "2019-03-14T14:33:40Z",
    "url": "https://github.com/sagemath/sage/issues/27360",
    "user": "https://github.com/JohnCremona"
}
```
Release v20170815 introduced a modular symbol scaling bug (while sorting out modular symbol scaling essentially correctly) in functions not currently used by Sage.  Other releases since the current one in Sage (v20180815) make some interface changes including precision handling (now using bits not digits), so some Sage code changes are likely to be necessary.

Updated source: http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20190226.tar.bz2

CC:  @slel @kiwifb @timokau

Keywords: **eclib, upgrade**

Branch: **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**

Reviewer: **Jeroen Demeyer, John Cremona**

Author: **John Cremona, Jeroen Demeyer**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/27360_





---

archive/issue_events_375824.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-02-26T11:10:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375824"
}
```



---

archive/issue_events_375825.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-02-26T11:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375825"
}
```



---

archive/issue_events_375826.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-02-26T11:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375826"
}
```



---

archive/issue_events_375827.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-02-26T11:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375827"
}
```



---

archive/issue_comments_423149.json:
```json
{
    "body": "Changed keywords from **eclib** to **eclib, upgrade**",
    "created_at": "2019-02-26T13:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423149",
    "user": "https://github.com/slel"
}
```

Changed keywords from **eclib** to **eclib, upgrade**



---

archive/issue_comments_423150.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThanks for adding the new keyword.  I have built 8.7.beta5 and am starting to test.",
    "created_at": "2019-02-26T14:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423150",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

Thanks for adding the new keyword.  I have built 8.7.beta5 and am starting to test.



---

archive/issue_comments_423151.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe current tarball's configure script sets compiler flags which result in code requiring an optional FLINT module which Sage's FLINT does not have, which I have on my own machine and always forget to remove for Sage.  I will replace it.  (The module is hmod_mat which allows for linear algebra mod p using 32-bit integers.)",
    "created_at": "2019-02-26T14:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423151",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

The current tarball's configure script sets compiler flags which result in code requiring an optional FLINT module which Sage's FLINT does not have, which I have on my own machine and always forget to remove for Sage.  I will replace it.  (The module is hmod_mat which allows for linear algebra mod p using 32-bit integers.)



---

archive/issue_comments_423152.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7\">25d6db5</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr></table>\n",
    "created_at": "2019-02-27T10:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423152",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7">25d6db5</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr></table>




---

archive/issue_events_375828.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-02-27T10:04:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375828"
}
```



---

archive/issue_comments_423153.json:
```json
{
    "body": "Commit: **[25d6db5](https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7)**",
    "created_at": "2019-02-27T10:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423153",
    "user": "https://github.com/JohnCremona"
}
```

Commit: **[25d6db5](https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7)**



---

archive/issue_comments_423154.json:
```json
{
    "body": "Branch: **[u/cremona/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/eclib)**",
    "created_at": "2019-02-27T10:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423154",
    "user": "https://github.com/JohnCremona"
}
```

Branch: **[u/cremona/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/eclib)**



---

archive/issue_comments_423155.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI did the testing on a python3 build of Sage.",
    "created_at": "2019-02-27T10:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423155",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:6" align="right">comment:6</div>

I did the testing on a python3 build of Sage.



---

archive/issue_comments_423156.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nTypo: `procision`",
    "created_at": "2019-02-27T10:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423156",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Typo: `procision`



---

archive/issue_comments_423157.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@JohnCremona](#comment:6):\n> I did the testing on a python3 build of Sage.\n\nThat is what I thought but it seems that the steps make distclean; make build took me back to python2 (where all is well with the patch uploaded).\n\nI will build the branch from scratch again, this time making sure it is python3.",
    "created_at": "2019-02-27T15:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423157",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@JohnCremona](#comment:6):
> I did the testing on a python3 build of Sage.

That is what I thought but it seems that the steps make distclean; make build took me back to python2 (where all is well with the patch uploaded).

I will build the branch from scratch again, this time making sure it is python3.



---

archive/issue_comments_423158.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@JohnCremona](#comment:9):\n> make distclean [..] took me back to python2\n\nIndeed. `make distclean` is meant to remove everything, including output generated by `./configure` indicating that you wanted a Python 3 build.",
    "created_at": "2019-02-27T15:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423158",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@JohnCremona](#comment:9):
> make distclean [..] took me back to python2

Indeed. `make distclean` is meant to remove everything, including output generated by `./configure` indicating that you wanted a Python 3 build.



---

archive/issue_comments_423159.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks -- I misunderstood Vincent's recent instructions on sage-devel.  So now the situation is that this branch works fine under python2 but not under python3 where the output buffering issue arises.  To be clear: after switching to this commit and putting the new source tarball into upstream/ I do\n\n```\nmake distclean\n./configure --with-python=3\nMAKE='make -j20' make\n./sage -t src/sage/libs/eclib\n```\nand see doctest failures in 2 files all of which (by eye) are caused by output buffering.\n\nThe same happens on a different machine and a python3 build of vanilla 8.7.beta5 so this issue is *not* related to the eclib upgrade at all.  For that reason it might be better to open a new ticket for it, and not hold up this one.",
    "created_at": "2019-02-27T16:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423159",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks -- I misunderstood Vincent's recent instructions on sage-devel.  So now the situation is that this branch works fine under python2 but not under python3 where the output buffering issue arises.  To be clear: after switching to this commit and putting the new source tarball into upstream/ I do

```
make distclean
./configure --with-python=3
MAKE='make -j20' make
./sage -t src/sage/libs/eclib
```
and see doctest failures in 2 files all of which (by eye) are caused by output buffering.

The same happens on a different machine and a python3 build of vanilla 8.7.beta5 so this issue is *not* related to the eclib upgrade at all.  For that reason it might be better to open a new ticket for it, and not hold up this one.



---

archive/issue_comments_423160.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAs a *proof* that this is the issue, after\n\n```\n export PYTHONUNBUFFERED=1\n```\nthe test\n\n```\n./sage -t src/sage/libs/eclib\n```\nruns fine.  I suppose that we do not want to turn off all python output buffering always?",
    "created_at": "2019-02-27T16:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423160",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:12" align="right">comment:12</div>

As a *proof* that this is the issue, after

```
 export PYTHONUNBUFFERED=1
```
the test

```
./sage -t src/sage/libs/eclib
```
runs fine.  I suppose that we do not want to turn off all python output buffering always?



---

archive/issue_comments_423161.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe last comment is surprising to me... how would disabling *Python* buffering fix buffering issues in *eclib*?",
    "created_at": "2019-02-28T06:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423161",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

The last comment is surprising to me... how would disabling *Python* buffering fix buffering issues in *eclib*?



---

archive/issue_comments_423162.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nMinor nitpick, but why this change?\n\n```diff\n-    r\"\"\"\n-    Set the global NTL real number precision.  This has a massive\n+    r\"\"\" Set the global NTL real number bit precision.  This has a massive\n```\nI don't know if it's right or wrong to format docstrings like that, but in any case this seems to go against the typical Sage docstring style. And if you really insist on starting the text on the line with the `\"\"\"` I would at least remove the leading space before `Set the`.",
    "created_at": "2019-02-28T08:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423162",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Minor nitpick, but why this change?

```diff
-    r"""
-    Set the global NTL real number precision.  This has a massive
+    r""" Set the global NTL real number bit precision.  This has a massive
```
I don't know if it's right or wrong to format docstrings like that, but in any case this seems to go against the typical Sage docstring style. And if you really insist on starting the text on the line with the `"""` I would at least remove the leading space before `Set the`.



---

archive/issue_comments_423163.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIs `-DNTL_ALL` now superfluous? If so, you could remove the line\n\n```\n# distutils: extra_compile_args = -DNTL_ALL\n```\nfrom `src/sage/libs/eclib/__init__.pxd`",
    "created_at": "2019-02-28T09:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423163",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Is `-DNTL_ALL` now superfluous? If so, you could remove the line

```
# distutils: extra_compile_args = -DNTL_ALL
```
from `src/sage/libs/eclib/__init__.pxd`



---

archive/issue_comments_423164.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> The last comment is surprising to me... how would disabling *Python* buffering fix buffering issues in *eclib*?\n\nWell if you ignore my \"proof\" remark it seems to be a fact that setting that environment variable fixes the issue.  Nothing has changed in eclib regarding buffering.\n\nOne fix would be to make changes in the Sage interface so that whenever an eclib function is called which outputs to stdout, the python stdout is flushed first.  It would be possible to add flushing functions in eclib itself but that does not seem the right approach to me.",
    "created_at": "2019-02-28T09:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423164",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> The last comment is surprising to me... how would disabling *Python* buffering fix buffering issues in *eclib*?

Well if you ignore my "proof" remark it seems to be a fact that setting that environment variable fixes the issue.  Nothing has changed in eclib regarding buffering.

One fix would be to make changes in the Sage interface so that whenever an eclib function is called which outputs to stdout, the python stdout is flushed first.  It would be possible to add flushing functions in eclib itself but that does not seem the right approach to me.



---

archive/issue_comments_423165.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:15):\n> Is `-DNTL_ALL` now superfluous? If so, you could remove the line\n> \n> ```\n> # distutils: extra_compile_args = -DNTL_ALL\n> ```\n> from `src/sage/libs/eclib/__init__.pxd`\n\nYou are right, and I will remove that line.",
    "created_at": "2019-02-28T09:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423165",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:15):
> Is `-DNTL_ALL` now superfluous? If so, you could remove the line
> 
> ```
> # distutils: extra_compile_args = -DNTL_ALL
> ```
> from `src/sage/libs/eclib/__init__.pxd`

You are right, and I will remove that line.



---

archive/issue_comments_423166.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:14):\n> Minor nitpick, but why this change?\n> \n> ```diff\n> -    r\"\"\"\n> -    Set the global NTL real number precision.  This has a massive\n> +    r\"\"\" Set the global NTL real number bit precision.  This has a massive\n> ```\n> I don't know if it's right or wrong to format docstrings like that, but in any case this seems to go against the typical Sage docstring style. And if you really insist on starting the text on the line with the `\"\"\"` I would at least remove the leading space before `Set the`.\n\nSorry that is an artefact introduced by emacs python mode which I usually change back manually.  I'll do that.",
    "created_at": "2019-02-28T09:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423166",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:14):
> Minor nitpick, but why this change?
> 
> ```diff
> -    r"""
> -    Set the global NTL real number precision.  This has a massive
> +    r""" Set the global NTL real number bit precision.  This has a massive
> ```
> I don't know if it's right or wrong to format docstrings like that, but in any case this seems to go against the typical Sage docstring style. And if you really insist on starting the text on the line with the `"""` I would at least remove the leading space before `Set the`.

Sorry that is an artefact introduced by emacs python mode which I usually change back manually.  I'll do that.



---

archive/issue_comments_423167.json:
```json
{
    "body": "Changed commit from **[25d6db5](https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7)** to **[8c0f976](https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f)**",
    "created_at": "2019-02-28T09:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[25d6db5](https://github.com/sagemath/sagetrac-mirror/commit/25d6db58591c04f90e2f3626b0ee1755d0fdaec7)** to **[8c0f976](https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f)**



---

archive/issue_comments_423168.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f\">8c0f976</a></td><td><code>#27360 changes addressing reviewer suggestions</code></td></tr></table>\n",
    "created_at": "2019-02-28T09:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423168",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f">8c0f976</a></td><td><code>#27360 changes addressing reviewer suggestions</code></td></tr></table>




---

archive/issue_comments_423169.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI created #27383 for the buffering issues.",
    "created_at": "2019-02-28T09:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423169",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

I created #27383 for the buffering issues.



---

archive/issue_comments_423170.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThere is still `procision`",
    "created_at": "2019-02-28T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423170",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

There is still `procision`



---

archive/issue_comments_423171.json:
```json
{
    "body": "Changed commit from **[8c0f976](https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f)** to **[36bf090](https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a)**",
    "created_at": "2019-02-28T09:54:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423171",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8c0f976](https://github.com/sagemath/sagetrac-mirror/commit/8c0f97697c4c751a5a12c3974366ecd8d1f1e63f)** to **[36bf090](https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a)**



---

archive/issue_comments_423172.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a\">36bf090</a></td><td><code>fix typo</code></td></tr></table>\n",
    "created_at": "2019-02-28T09:54:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a">36bf090</a></td><td><code>fix typo</code></td></tr></table>




---

archive/issue_comments_423173.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks -- I fixed the typo and assume that the buffering questions will be fixed in #27383.",
    "created_at": "2019-02-28T09:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423173",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks -- I fixed the typo and assume that the buffering questions will be fixed in #27383.



---

archive/issue_comments_423174.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2019-02-28T10:36:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423174",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_423175.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI have no more comments on the branch, now testing...",
    "created_at": "2019-02-28T10:36:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423175",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

I have no more comments on the branch, now testing...



---

archive/issue_comments_423176.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOn a 32-bit machine I get\n\n```\nsage -t --warn-long 43.4 src/sage/libs/eclib/mwrank.pyx\n**********************************************************************\nFile \"src/sage/libs/eclib/mwrank.pyx\", line 365, in sage.libs.eclib.mwrank._Curvedata.cps_bound\nFailed example:\n    E.cps_bound()\nExpected:\n    0.11912451909250964\nGot:\n    0.11912451909250982\n**********************************************************************\nFile \"src/sage/libs/eclib/mwrank.pyx\", line 404, in sage.libs.eclib.mwrank._Curvedata.height_constant\nFailed example:\n    E.height_constant()\nExpected:\n    0.11912451909250964\nGot:\n    0.11912451909250982\n**********************************************************************\nFile \"src/sage/libs/eclib/mwrank.pyx\", line 1344, in sage.libs.eclib.mwrank._two_descent.regulator\nFailed example:\n    D2.regulator()\nExpected:\n    0.41714355875838\nGot:\n    0.417143558758384\n**********************************************************************\n```\nand\n\n```\nsage -t --warn-long 43.4 src/sage/libs/eclib/interface.py\n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 601, in sage.libs.eclib.interface.mwrank_EllipticCurve.regulator\nFailed example:\n    E.regulator()\nExpected:\n    0.051111408239969\nGot:\n    0.05111140823996884\n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 1083, in sage.libs.eclib.interface.mwrank_MordellWeil.regulator\nFailed example:\n    E.regulator()\nExpected:\n    0.41714355875838\nGot:\n    0.417143558758384\n**********************************************************************\n```",
    "created_at": "2019-02-28T15:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423176",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

On a 32-bit machine I get

```
sage -t --warn-long 43.4 src/sage/libs/eclib/mwrank.pyx
**********************************************************************
File "src/sage/libs/eclib/mwrank.pyx", line 365, in sage.libs.eclib.mwrank._Curvedata.cps_bound
Failed example:
    E.cps_bound()
Expected:
    0.11912451909250964
Got:
    0.11912451909250982
**********************************************************************
File "src/sage/libs/eclib/mwrank.pyx", line 404, in sage.libs.eclib.mwrank._Curvedata.height_constant
Failed example:
    E.height_constant()
Expected:
    0.11912451909250964
Got:
    0.11912451909250982
**********************************************************************
File "src/sage/libs/eclib/mwrank.pyx", line 1344, in sage.libs.eclib.mwrank._two_descent.regulator
Failed example:
    D2.regulator()
Expected:
    0.41714355875838
Got:
    0.417143558758384
**********************************************************************
```
and

```
sage -t --warn-long 43.4 src/sage/libs/eclib/interface.py
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 601, in sage.libs.eclib.interface.mwrank_EllipticCurve.regulator
Failed example:
    E.regulator()
Expected:
    0.051111408239969
Got:
    0.05111140823996884
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 1083, in sage.libs.eclib.interface.mwrank_MordellWeil.regulator
Failed example:
    E.regulator()
Expected:
    0.41714355875838
Got:
    0.417143558758384
**********************************************************************
```



---

archive/issue_events_375829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-28T15:59:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375829"
}
```



---

archive/issue_events_375830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-28T15:59:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375830"
}
```



---

archive/issue_comments_423177.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOh misery.  I don't have a 32-bit machine to test on.  But I also have no idea why there should be any difference.  I don't think I have ever before had to deal with 32/64-bit issues with eclib in Sage.  Sage uses NTL floating point (which used to require siwtching on with the NTL_ALL flag but now is on by default) and that is 32/64-independent.",
    "created_at": "2019-02-28T16:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423177",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:26" align="right">comment:26</div>

Oh misery.  I don't have a 32-bit machine to test on.  But I also have no idea why there should be any difference.  I don't think I have ever before had to deal with 32/64-bit issues with eclib in Sage.  Sage uses NTL floating point (which used to require siwtching on with the NTL_ALL flag but now is on by default) and that is 32/64-independent.



---

archive/issue_comments_423178.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nCould there be a problem with the precision handling? I made this change:\n\n```diff\ndiff --git a/src/sage/libs/eclib/wrap.cpp b/src/sage/libs/eclib/wrap.cpp\nindex de70e6b..88fcebe 100644\n--- a/src/sage/libs/eclib/wrap.cpp\n+++ b/src/sage/libs/eclib/wrap.cpp\n@@ -250,5 +250,7 @@ char* two_descent_regulator(struct two_descent* t)\n   bigfloat reg = t->regulator();\n   ostringstream instore;\n   instore << reg;\n-  return stringstream_to_char(instore);\n+  char *ptr = stringstream_to_char(instore);\n+  printf(\"two_descent_regulator(): %s\\n\", ptr);\n+  return ptr;\n }\n```\nto debug the `bigfloat` object `t->regulator()`.\n\nOn 64-bit, I get\n\n```\nsage: E = mwrank_EllipticCurve([0, 0, 1, -1, 0]); E.regulator()\ntwo_descent_regulator(): 0.051111408239968840235886099756942021609538202280852964249242761521097051665601926126276280166145013158726830156913137573334269246681032033729207105828\n0.05111140823996884\n```\n\nOn 32-bit, I get\n\n```\nsage: E = mwrank_EllipticCurve([0, 0, 1, -1, 0]); E.regulator()\ntwo_descent_regulator(): 0.0511114082399688402358860997569420216095382\n0.05111140823996884\n```",
    "created_at": "2019-02-28T22:10:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423178",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Could there be a problem with the precision handling? I made this change:

```diff
diff --git a/src/sage/libs/eclib/wrap.cpp b/src/sage/libs/eclib/wrap.cpp
index de70e6b..88fcebe 100644
--- a/src/sage/libs/eclib/wrap.cpp
+++ b/src/sage/libs/eclib/wrap.cpp
@@ -250,5 +250,7 @@ char* two_descent_regulator(struct two_descent* t)
   bigfloat reg = t->regulator();
   ostringstream instore;
   instore << reg;
-  return stringstream_to_char(instore);
+  char *ptr = stringstream_to_char(instore);
+  printf("two_descent_regulator(): %s\n", ptr);
+  return ptr;
 }
```
to debug the `bigfloat` object `t->regulator()`.

On 64-bit, I get

```
sage: E = mwrank_EllipticCurve([0, 0, 1, -1, 0]); E.regulator()
two_descent_regulator(): 0.051111408239968840235886099756942021609538202280852964249242761521097051665601926126276280166145013158726830156913137573334269246681032033729207105828
0.05111140823996884
```

On 32-bit, I get

```
sage: E = mwrank_EllipticCurve([0, 0, 1, -1, 0]); E.regulator()
two_descent_regulator(): 0.0511114082399688402358860997569420216095382
0.05111140823996884
```



---

archive/issue_comments_423179.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI applied this patch to debug:\n\n```diff\ndiff --git a/src/sage/libs/eclib/wrap.cpp b/src/sage/libs/eclib/wrap.cpp\nindex de70e6b..74d92a4 100644\n--- a/src/sage/libs/eclib/wrap.cpp\n+++ b/src/sage/libs/eclib/wrap.cpp\n@@ -250,5 +250,7 @@ char* two_descent_regulator(struct two_descent* t)\n   bigfloat reg = t->regulator();\n   ostringstream instore;\n   instore << reg;\n-  return stringstream_to_char(instore);\n+  char *ptr = stringstream_to_char(instore);\n+  printf(\"two_descent_regulator():\\n%s\\nprecision = %ld\\nas double = %a\\n\", ptr, reg.precision(), to_double(reg));\n+  return ptr;\n }\n```\n\nWhat I see when I run the doctests on 64-bit:\n\n```\nsage -t src/sage/libs/eclib/interface.py                                                                                                                                \n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 601, in sage.libs.eclib.interface.mwrank_EllipticCurve.regulator\nFailed example:\n    E.regulator()\nExpected:\n    0.051111408239969\nGot:\n    two_descent_regulator():\n    0.051111408239969\n    precision = 53\n    as double = 0x1.a2b4645afb41dp-5\n    0.051111408239969\n**********************************************************************\n```\nSo the precision is only 53 bits here. So one of the tests preceding it apparently changes the precision from 150 to 53.",
    "created_at": "2019-03-01T09:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423179",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

I applied this patch to debug:

```diff
diff --git a/src/sage/libs/eclib/wrap.cpp b/src/sage/libs/eclib/wrap.cpp
index de70e6b..74d92a4 100644
--- a/src/sage/libs/eclib/wrap.cpp
+++ b/src/sage/libs/eclib/wrap.cpp
@@ -250,5 +250,7 @@ char* two_descent_regulator(struct two_descent* t)
   bigfloat reg = t->regulator();
   ostringstream instore;
   instore << reg;
-  return stringstream_to_char(instore);
+  char *ptr = stringstream_to_char(instore);
+  printf("two_descent_regulator():\n%s\nprecision = %ld\nas double = %a\n", ptr, reg.precision(), to_double(reg));
+  return ptr;
 }
```

What I see when I run the doctests on 64-bit:

```
sage -t src/sage/libs/eclib/interface.py                                                                                                                                
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 601, in sage.libs.eclib.interface.mwrank_EllipticCurve.regulator
Failed example:
    E.regulator()
Expected:
    0.051111408239969
Got:
    two_descent_regulator():
    0.051111408239969
    precision = 53
    as double = 0x1.a2b4645afb41dp-5
    0.051111408239969
**********************************************************************
```
So the precision is only 53 bits here. So one of the tests preceding it apparently changes the precision from 150 to 53.



---

archive/issue_comments_423180.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAnother obvious thing to ask is why does the eclib interface uses strings for conversion? For the regulator, an NTL `RR` is converted to a string and then to a Python `float`. It would be more efficient and more reliable to use the NTL conversion function `to_double`.\n\n(Edit: I don't think that it would fix the doctest failures, it's just something that I saw while reading the code)",
    "created_at": "2019-03-01T09:23:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423180",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Another obvious thing to ask is why does the eclib interface uses strings for conversion? For the regulator, an NTL `RR` is converted to a string and then to a Python `float`. It would be more efficient and more reliable to use the NTL conversion function `to_double`.

(Edit: I don't think that it would fix the doctest failures, it's just something that I saw while reading the code)



---

archive/issue_comments_423181.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThe problem is obvious: you have a doctest `sage: mwrank_set_precision(50)` which means that all following doctests are run with a precision much lower than default.",
    "created_at": "2019-03-01T09:33:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423181",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

The problem is obvious: you have a doctest `sage: mwrank_set_precision(50)` which means that all following doctests are run with a precision much lower than default.



---

archive/issue_comments_423182.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jdemeyer](#comment:29):\n> Another obvious thing to ask is why does the eclib interface uses strings for conversion? For the regulator, an NTL `RR` is converted to a string and then to a Python `float`. It would be more efficient and more reliable to use the NTL conversion function `to_double`.\n\nI agree.  I didn't write the wrapping code -- I have only tweaked it so take changes to eclib into account.\n\nDo you know how to convert an NTL RR into an element of RealField() or some other Sage real type?\n\n> \n> (Edit: I don't think that it would fix the doctest failures, it's just something that I saw while reading the code)",
    "created_at": "2019-03-01T10:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423182",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jdemeyer](#comment:29):
> Another obvious thing to ask is why does the eclib interface uses strings for conversion? For the regulator, an NTL `RR` is converted to a string and then to a Python `float`. It would be more efficient and more reliable to use the NTL conversion function `to_double`.

I agree.  I didn't write the wrapping code -- I have only tweaked it so take changes to eclib into account.

Do you know how to convert an NTL RR into an element of RealField() or some other Sage real type?

> 
> (Edit: I don't think that it would fix the doctest failures, it's just something that I saw while reading the code)



---

archive/issue_comments_423183.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment:30):\n> The problem is obvious: you have a doctest `sage: mwrank_set_precision(50)` which means that all following doctests are run with a precision much lower than default.\n\nOf course, how stupid.  This hardly needs a doctest; it would be silly to use the default here;  perhaps the doctest should be expanded to save the current precision, set it to a new value and then rest it.  I will do that.",
    "created_at": "2019-03-01T10:09:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423183",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment:30):
> The problem is obvious: you have a doctest `sage: mwrank_set_precision(50)` which means that all following doctests are run with a precision much lower than default.

Of course, how stupid.  This hardly needs a doctest; it would be silly to use the default here;  perhaps the doctest should be expanded to save the current precision, set it to a new value and then rest it.  I will do that.



---

archive/issue_comments_423184.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n@jdemeyer: after editing the file wrap.cpp what exactly needs to be done to rebuild sage?  I have the impression that neither \"sage -b\" nor \"make\" caused that file to be recompiled when it changed.",
    "created_at": "2019-03-01T10:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423184",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:33" align="right">comment:33</div>

@jdemeyer: after editing the file wrap.cpp what exactly needs to be done to rebuild sage?  I have the impression that neither "sage -b" nor "make" caused that file to be recompiled when it changed.



---

archive/issue_comments_423185.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nYes, I noticed that too and created a new ticket #27389. To solve this problem concretely, remove all copies of `wrap.cpp` in the `src/build` directory and try again.",
    "created_at": "2019-03-01T10:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423185",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Yes, I noticed that too and created a new ticket #27389. To solve this problem concretely, remove all copies of `wrap.cpp` in the `src/build` directory and try again.



---

archive/issue_comments_423186.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jdemeyer](#comment:34):\n> Yes, I noticed that too and created a new ticket #27389. To solve this problem concretely, remove all copies of `wrap.cpp` in the `src/build` directory and try again.\n\nThanks for that tip.",
    "created_at": "2019-03-01T10:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423186",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jdemeyer](#comment:34):
> Yes, I noticed that too and created a new ticket #27389. To solve this problem concretely, remove all copies of `wrap.cpp` in the `src/build` directory and try again.

Thanks for that tip.



---

archive/issue_comments_423187.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6\">d63916a</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr></table>\n",
    "created_at": "2019-03-01T14:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423187",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6">d63916a</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr></table>




---

archive/issue_comments_423188.json:
```json
{
    "body": "Changed commit from **[36bf090](https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a)** to **[d63916a](https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6)**",
    "created_at": "2019-03-01T14:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423188",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[36bf090](https://github.com/sagemath/sagetrac-mirror/commit/36bf0909d81ef12a4328bd3c7afda5c23700d14a)** to **[d63916a](https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6)**



---

archive/issue_comments_423189.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThe latest commit d63916a address some of the issues discovered.\n1. By adding a couple of \"cou<<flush;\" statememts in the c++ wrapper file wrap.cpp I think I have dealt with that problem under python3.  At the same time I deleted some flushing which was there already but redundant.  The result works fine in python3.\n2. Fixed an interface bug where I called eclib's set_precision() instead of set_bit_precision.  The former still takes a decimal precision input.\n3. Fixed a doctesting bug where one test left the preciaion at a different value than the usual default.\n4. Avoid converting an NTL:RR to a float via strings by using iNTL's to_double() as suggested, returning a double.\n\nAll that left a lot of computed number ending in some different digits.  I fixed those doctests in the stupid way, i.e. changing the expected digits to what I now get.  But I only tested on a 64-bit machine.  If there are problems on 32-bit I will probably get around that by replacing some trailing digits by \"...\".\n\nPutting this back to \"needs review\", and the testing and debugging help already received are much appreciated.",
    "created_at": "2019-03-01T14:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423189",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:37" align="right">comment:37</div>

The latest commit d63916a address some of the issues discovered.
1. By adding a couple of "cou<<flush;" statememts in the c++ wrapper file wrap.cpp I think I have dealt with that problem under python3.  At the same time I deleted some flushing which was there already but redundant.  The result works fine in python3.
2. Fixed an interface bug where I called eclib's set_precision() instead of set_bit_precision.  The former still takes a decimal precision input.
3. Fixed a doctesting bug where one test left the preciaion at a different value than the usual default.
4. Avoid converting an NTL:RR to a float via strings by using iNTL's to_double() as suggested, returning a double.

All that left a lot of computed number ending in some different digits.  I fixed those doctests in the stupid way, i.e. changing the expected digits to what I now get.  But I only tested on a 64-bit machine.  If there are problems on 32-bit I will probably get around that by replacing some trailing digits by "...".

Putting this back to "needs review", and the testing and debugging help already received are much appreciated.



---

archive/issue_events_375831.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-03-01T14:55:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375831"
}
```



---

archive/issue_events_375832.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-03-01T14:55:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375832"
}
```



---

archive/issue_comments_423190.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThere is still a `mwrank_set_precision(50)` doctest in `src/sage/libs/eclib/interface.py`, shouldn't that be fixed too?",
    "created_at": "2019-03-01T14:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423190",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

There is still a `mwrank_set_precision(50)` doctest in `src/sage/libs/eclib/interface.py`, shouldn't that be fixed too?



---

archive/issue_comments_423191.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@JohnCremona](#comment:37):\n> At the same time I deleted some flushing which was there already but redundant.\n\nAs explained in #27383, it's flushing the wrong buffers anyway (the Python buffers, not the C buffers used by eclib).",
    "created_at": "2019-03-01T15:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423191",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@JohnCremona](#comment:37):
> At the same time I deleted some flushing which was there already but redundant.

As explained in #27383, it's flushing the wrong buffers anyway (the Python buffers, not the C buffers used by eclib).



---

archive/issue_comments_423192.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nSpeaking of getting/setting precision, I wonder why there are `get_precision` and `set_precision` functions in both `src/sage/libs/eclib/mwrank.pyx` and `src/sage/libs/eclib/interface.py`. There is probably a historical reason for this, but it's confusing.\n\nI suggest to remove the `get_precision` and `set_precision` functions from `src/sage/libs/eclib/interface.py` and then adjust the imports in `src/sage/libs/eclib/all.py`.\n\nNote that the docstring for these functions in `src/sage/libs/eclib/mwrank.pyx` and `src/sage/libs/eclib/interface.py` are different, so they should be merged.",
    "created_at": "2019-03-01T15:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423192",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Speaking of getting/setting precision, I wonder why there are `get_precision` and `set_precision` functions in both `src/sage/libs/eclib/mwrank.pyx` and `src/sage/libs/eclib/interface.py`. There is probably a historical reason for this, but it's confusing.

I suggest to remove the `get_precision` and `set_precision` functions from `src/sage/libs/eclib/interface.py` and then adjust the imports in `src/sage/libs/eclib/all.py`.

Note that the docstring for these functions in `src/sage/libs/eclib/mwrank.pyx` and `src/sage/libs/eclib/interface.py` are different, so they should be merged.



---

archive/issue_events_375833.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-01T15:44:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375833"
}
```



---

archive/issue_events_375834.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-01T15:44:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375834"
}
```



---

archive/issue_comments_423193.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI'll fix this.",
    "created_at": "2019-03-04T09:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423193",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

I'll fix this.



---

archive/issue_comments_423194.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@jdemeyer](#comment:42):\n> I'll fix this.\n\nThanks -- but I also could do it.\n\nThe eclib wrapping happened in 2007 or 2006, by William --I made many changes to eclib at the time to make an interface even possible, but did not do the wrapping as at that time I had never written a single line of python.  After that William often suggested that it needed to be redone from scratch but the intersection of people who had the expertise to do that was always empty.",
    "created_at": "2019-03-04T09:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423194",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@jdemeyer](#comment:42):
> I'll fix this.

Thanks -- but I also could do it.

The eclib wrapping happened in 2007 or 2006, by William --I made many changes to eclib at the time to make an interface even possible, but did not do the wrapping as at that time I had never written a single line of python.  After that William often suggested that it needed to be redone from scratch but the intersection of people who had the expertise to do that was always empty.



---

archive/issue_comments_423195.json:
```json
{
    "body": "Changed branch from **[u/cremona/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/eclib)** to **[u/jdemeyer/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/eclib)**",
    "created_at": "2019-03-04T09:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423195",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/cremona/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/eclib)** to **[u/jdemeyer/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/eclib)**



---

archive/issue_comments_423196.json:
```json
{
    "body": "Changed commit from **[d63916a](https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6)** to **[29b2288](https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837)**",
    "created_at": "2019-03-04T09:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423196",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d63916a](https://github.com/sagemath/sagetrac-mirror/commit/d63916a12d7fbc038ed7c6fb2fa4eadbd8fa64a6)** to **[29b2288](https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837)**



---

archive/issue_comments_423197.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f217b55316e153a3adda664b1d22c5d2fcd910\">72f217b</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2defe8a51e9565eccfede4a60348529f5485c42e\">2defe8a</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69d2f64366669272b72038fe088df32a77cdd3e8\">69d2f64</a></td><td><code>Allow any kind of iterable for ainvs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff2e9dd78a84baaa1984715f18f28e0fe2ac500b\">ff2e9dd</a></td><td><code>Remove get/set_precision from eclib/interface.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17635d8fb516048baad95aec441055e1c7ffb2cf\">17635d8</a></td><td><code>Do not import eclib at startup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837\">29b2288</a></td><td><code>Remove superfluous \"cdef double\" declarations</code></td></tr></table>\n",
    "created_at": "2019-03-04T09:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423197",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f217b55316e153a3adda664b1d22c5d2fcd910">72f217b</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2defe8a51e9565eccfede4a60348529f5485c42e">2defe8a</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69d2f64366669272b72038fe088df32a77cdd3e8">69d2f64</a></td><td><code>Allow any kind of iterable for ainvs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff2e9dd78a84baaa1984715f18f28e0fe2ac500b">ff2e9dd</a></td><td><code>Remove get/set_precision from eclib/interface.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17635d8fb516048baad95aec441055e1c7ffb2cf">17635d8</a></td><td><code>Do not import eclib at startup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837">29b2288</a></td><td><code>Remove superfluous "cdef double" declarations</code></td></tr></table>




---

archive/issue_comments_423198.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nRebased to 8.7.beta6 and partially squashed. The last 4 commits are by me and fix various minor things. Each of these commits is more or less independent.",
    "created_at": "2019-03-04T09:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423198",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Rebased to 8.7.beta6 and partially squashed. The last 4 commits are by me and fix various minor things. Each of these commits is more or less independent.



---

archive/issue_comments_423199.json:
```json
{
    "body": "Dependencies: **#27389**",
    "created_at": "2019-03-04T10:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423199",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#27389**



---

archive/issue_comments_423200.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThanks.  The diffs look good and I will do my own testing once the rebuild is done.  As soon as we are both happy I think we can set this to Positive Review though I do not know what the strange colour of the patchbot icon means.",
    "created_at": "2019-03-04T11:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423200",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:48" align="right">comment:48</div>

Thanks.  The diffs look good and I will do my own testing once the rebuild is done.  As soon as we are both happy I think we can set this to Positive Review though I do not know what the strange colour of the patchbot icon means.



---

archive/issue_comments_423201.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@JohnCremona](#comment:48):\n> I do not know what the strange colour of the patchbot icon means.\n\nThat it's a package upgrade and the patchbot doesn't (or can't) know how to deal with those.",
    "created_at": "2019-03-04T11:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@JohnCremona](#comment:48):
> I do not know what the strange colour of the patchbot icon means.

That it's a package upgrade and the patchbot doesn't (or can't) know how to deal with those.



---

archive/issue_comments_423202.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nThis passes all tests in `src/sage/libs/eclib/` and `src/sage/schemes/elliptic_curves/` both on 32-bit and 64-bit Linux.",
    "created_at": "2019-03-04T11:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423202",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

This passes all tests in `src/sage/libs/eclib/` and `src/sage/schemes/elliptic_curves/` both on 32-bit and 64-bit Linux.



---

archive/issue_events_375835.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-04T11:23:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375835"
}
```



---

archive/issue_events_375836.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-04T11:23:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375836"
}
```



---

archive/issue_comments_423203.json:
```json
{
    "body": "Changed author from **John Cremona** to **John Cremona, Jeroen Demeyer**",
    "created_at": "2019-03-04T14:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423203",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **John Cremona** to **John Cremona, Jeroen Demeyer**



---

archive/issue_comments_423204.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, John Cremona**",
    "created_at": "2019-03-04T14:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423204",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, John Cremona**



---

archive/issue_comments_423205.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nWhen I test this on a python3 build, then there are some doctest failures in elliptic_curves most of which are unrelated unresolved python3 things, except perhaps one in height.py:\n\n```\nFile \"src/sage/schemes/elliptic_curves/height.py\", line 1934, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.min_gr\nFailed example:\n    H.min_gr(.1,5,True) # long time (~22s)\nExpected:\n    B_1(1) = 1540.199246369678\n    ...\n    halving mu to 0.25 and increasing n_max to 6\n    ...\n    halving mu to 0.001953125 and increasing n_max to 13\n    doubling mu to 0.0078125\n    doubling mu to 0.015625\n    height bound in [0.0078125, 0.015625] using n_max = 13\n    ...\n    height bound in [0.0120485220735, 0.0131390064883] using n_max = 13\n    0.012048522073499539\nGot:\n    B_1(1) = 1540.199246369678\n    B_2(1) = 621360.723701339\n    B_3(1) = 13686380726.84389\n    B_4(1) = 1.6459300096812694e+16\n    B_5(1) = 4.322868545515137e+22\n    halving mu to 0.25 and increasing n_max to 6\n    halving mu to 0.125 and increasing n_max to 7\n    halving mu to 0.0625 and increasing n_max to 8\n    halving mu to 0.03125 and increasing n_max to 9\n    halving mu to 0.015625 and increasing n_max to 10\n    halving mu to 0.0078125 and increasing n_max to 11\n    halving mu to 0.00390625 and increasing n_max to 12\n    halving mu to 0.001953125 and increasing n_max to 13\n    doubling mu to 0.0078125\n    doubling mu to 0.015625\n    height bound in [0.0078125, 0.015625] using n_max = 13\n    height bound in [0.011048543456039806, 0.015625000000000003] using n_max = 13\n    height bound in [0.011048543456039806, 0.01313900648833929] using n_max = 13\n    height bound in [0.012048522073499539, 0.01313900648833929] using n_max = 13\n    0.012048522073499539\n**********************************************************************\n```\nwhere the penultimate line (only) is slightly different.  Did that test really pass for you?",
    "created_at": "2019-03-04T14:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423205",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:52" align="right">comment:52</div>

When I test this on a python3 build, then there are some doctest failures in elliptic_curves most of which are unrelated unresolved python3 things, except perhaps one in height.py:

```
File "src/sage/schemes/elliptic_curves/height.py", line 1934, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.min_gr
Failed example:
    H.min_gr(.1,5,True) # long time (~22s)
Expected:
    B_1(1) = 1540.199246369678
    ...
    halving mu to 0.25 and increasing n_max to 6
    ...
    halving mu to 0.001953125 and increasing n_max to 13
    doubling mu to 0.0078125
    doubling mu to 0.015625
    height bound in [0.0078125, 0.015625] using n_max = 13
    ...
    height bound in [0.0120485220735, 0.0131390064883] using n_max = 13
    0.012048522073499539
Got:
    B_1(1) = 1540.199246369678
    B_2(1) = 621360.723701339
    B_3(1) = 13686380726.84389
    B_4(1) = 1.6459300096812694e+16
    B_5(1) = 4.322868545515137e+22
    halving mu to 0.25 and increasing n_max to 6
    halving mu to 0.125 and increasing n_max to 7
    halving mu to 0.0625 and increasing n_max to 8
    halving mu to 0.03125 and increasing n_max to 9
    halving mu to 0.015625 and increasing n_max to 10
    halving mu to 0.0078125 and increasing n_max to 11
    halving mu to 0.00390625 and increasing n_max to 12
    halving mu to 0.001953125 and increasing n_max to 13
    doubling mu to 0.0078125
    doubling mu to 0.015625
    height bound in [0.0078125, 0.015625] using n_max = 13
    height bound in [0.011048543456039806, 0.015625000000000003] using n_max = 13
    height bound in [0.011048543456039806, 0.01313900648833929] using n_max = 13
    height bound in [0.012048522073499539, 0.01313900648833929] using n_max = 13
    0.012048522073499539
**********************************************************************
```
where the penultimate line (only) is slightly different.  Did that test really pass for you?



---

archive/issue_comments_423206.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI tested Python 2, not Python 3. Did you test both Python 2 and Python 3 or only Python 3?\n\nI would find it quite surprising that you get different numerical noise on Python 3 compared to Python 2. More likely, it depends on the machine and not on the Python version.",
    "created_at": "2019-03-04T14:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

I tested Python 2, not Python 3. Did you test both Python 2 and Python 3 or only Python 3?

I would find it quite surprising that you get different numerical noise on Python 3 compared to Python 2. More likely, it depends on the machine and not on the Python version.



---

archive/issue_comments_423207.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jdemeyer](#comment:53):\n> I tested Python 2, not Python 3. Did you test both Python 2 and Python 3 or only Python 3?\n\nOnly Python 3\n\n> \n> I would find it quite surprising that you get different numerical noise on Python 3 compared to Python 2. More likely, it depends on the machine and not on the Python version.\n\nMe too.  The only numerical computation with output other than halving or doubling is line 1975 of height.py where math.sqrt() is used on a float.  Perhaps mu and eps should be in RDF from the start, as the output is coerced in there at the end.  But this does not explain the discrepancy, it must be a machine difference.",
    "created_at": "2019-03-04T14:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423207",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jdemeyer](#comment:53):
> I tested Python 2, not Python 3. Did you test both Python 2 and Python 3 or only Python 3?

Only Python 3

> 
> I would find it quite surprising that you get different numerical noise on Python 3 compared to Python 2. More likely, it depends on the machine and not on the Python version.

Me too.  The only numerical computation with output other than halving or doubling is line 1975 of height.py where math.sqrt() is used on a float.  Perhaps mu and eps should be in RDF from the start, as the output is coerced in there at the end.  But this does not explain the discrepancy, it must be a machine difference.



---

archive/issue_comments_423208.json:
```json
{
    "body": "Changed dependencies from **#27389** to none",
    "created_at": "2019-03-11T06:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423208",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#27389** to none



---

archive/issue_comments_423209.json:
```json
{
    "body": "Changed commit from **[29b2288](https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837)** to **[3ff19c1](https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c)**",
    "created_at": "2019-03-11T06:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423209",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[29b2288](https://github.com/sagemath/sagetrac-mirror/commit/29b22888066867ec53bef6ab3c3f5fa840e93837)** to **[3ff19c1](https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c)**



---

archive/issue_comments_423210.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e3efa22a33af05afa3a9e7f9a73710dbc9a66de\">0e3efa2</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/424678cceba8d190a8fb785f5310096e6fa9a915\">424678c</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc988931d0492c9487f78e2e205d1ffc5077051e\">dc98893</a></td><td><code>Allow any kind of iterable for ainvs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00754bae19bb486a75a8c7b4d0f575b04c14ba02\">00754ba</a></td><td><code>Remove get/set_precision from eclib/interface.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2fcfc399691ec513bc582b792b4e6a78896699a\">c2fcfc3</a></td><td><code>Do not import eclib at startup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c\">3ff19c1</a></td><td><code>Remove superfluous \"cdef double\" declarations</code></td></tr></table>\n",
    "created_at": "2019-03-11T06:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423210",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e3efa22a33af05afa3a9e7f9a73710dbc9a66de">0e3efa2</a></td><td><code>#27360 eclib upgrade to v20190226</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/424678cceba8d190a8fb785f5310096e6fa9a915">424678c</a></td><td><code>#27360: fix flushing, avoid some stringy interfaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc988931d0492c9487f78e2e205d1ffc5077051e">dc98893</a></td><td><code>Allow any kind of iterable for ainvs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00754bae19bb486a75a8c7b4d0f575b04c14ba02">00754ba</a></td><td><code>Remove get/set_precision from eclib/interface.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2fcfc399691ec513bc582b792b4e6a78896699a">c2fcfc3</a></td><td><code>Do not import eclib at startup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c">3ff19c1</a></td><td><code>Remove superfluous "cdef double" declarations</code></td></tr></table>




---

archive/issue_comments_423211.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI tested this again (on x86_64 laptop with Sage 8.7.beta7 under Python 2) and all long tests in `src/sage/schemes/elliptic_curves/` do pass for me.",
    "created_at": "2019-03-11T07:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423211",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

I tested this again (on x86_64 laptop with Sage 8.7.beta7 under Python 2) and all long tests in `src/sage/schemes/elliptic_curves/` do pass for me.



---

archive/issue_comments_423212.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6\">8936611</a></td><td><code>Numerical noise</code></td></tr></table>\n",
    "created_at": "2019-03-11T08:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423212",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6">8936611</a></td><td><code>Numerical noise</code></td></tr></table>




---

archive/issue_comments_423213.json:
```json
{
    "body": "Changed commit from **[3ff19c1](https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c)** to **[8936611](https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6)**",
    "created_at": "2019-03-11T08:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423213",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3ff19c1](https://github.com/sagemath/sagetrac-mirror/commit/3ff19c1e0180ed48e85cda56d3899ae082013c1c)** to **[8936611](https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6)**



---

archive/issue_comments_423214.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThis should work now.",
    "created_at": "2019-03-11T08:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423214",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

This should work now.



---

archive/issue_comments_423215.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nWhat is the difference between  the commits in comment 56 and those in comment 45?",
    "created_at": "2019-03-11T09:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423215",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:60" align="right">comment:60</div>

What is the difference between  the commits in comment 56 and those in comment 45?



---

archive/issue_comments_423216.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@JohnCremona](#comment:60):\n> What is the difference between  the commits in comment 56 and those in comment 45?\n\nI just rebased to 8.7.beta7 (which includes #27389)",
    "created_at": "2019-03-11T09:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423216",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@JohnCremona](#comment:60):
> What is the difference between  the commits in comment 56 and those in comment 45?

I just rebased to 8.7.beta7 (which includes #27389)



---

archive/issue_comments_423217.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nSo should I rebuild my python3 using your rebase and test again what I saw at comment 53?  Or should we leave this to be dealt with later when other python3 issues are finally fixed?",
    "created_at": "2019-03-11T10:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423217",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:62" align="right">comment:62</div>

So should I rebuild my python3 using your rebase and test again what I saw at comment 53?  Or should we leave this to be dealt with later when other python3 issues are finally fixed?



---

archive/issue_comments_423218.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI built and tested this on Python 3 myself. I can indeed reproduce the failure from [comment:52]. I'll try to figure out why it's happening, if only because I'm honestly curious.",
    "created_at": "2019-03-11T10:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423218",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

I built and tested this on Python 3 myself. I can indeed reproduce the failure from [comment:52]. I'll try to figure out why it's happening, if only because I'm honestly curious.



---

archive/issue_comments_423219.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nOK, the difference between Python 2 and 3 is that the same numbers are *printed* differently. So this suggests a different fix: use `%r` which always print floats exactly.",
    "created_at": "2019-03-11T10:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423219",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

OK, the difference between Python 2 and 3 is that the same numbers are *printed* differently. So this suggests a different fix: use `%r` which always print floats exactly.



---

archive/issue_events_375837.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T10:22:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375837"
}
```



---

archive/issue_events_375838.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T10:22:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375838"
}
```



---

archive/issue_comments_423220.json:
```json
{
    "body": "Changed commit from **[8936611](https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6)** to **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**",
    "created_at": "2019-03-11T10:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423220",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8936611](https://github.com/sagemath/sagetrac-mirror/commit/8936611b538c6e8bbd192c224828a5c2a9424be6)** to **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**



---

archive/issue_comments_423221.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c\">901eaf8</a></td><td><code>Print numbers consistently on Python 2 and 3</code></td></tr></table>\n",
    "created_at": "2019-03-11T10:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423221",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c">901eaf8</a></td><td><code>Print numbers consistently on Python 2 and 3</code></td></tr></table>




---

archive/issue_comments_423222.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nWell spotted, and thanks for fixing.  I'm still building the previous version but will continue.",
    "created_at": "2019-03-11T10:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423222",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:66" align="right">comment:66</div>

Well spotted, and thanks for fixing.  I'm still building the previous version but will continue.



---

archive/issue_comments_423223.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nI made a few more minor fixes in that function, in particular replacing `/= 2` by `*= 0.5` (dividing an integer by an integer has different semantics in Python 3, so this might fix a not yet discovered Python 3 bug). I could have written `/= 2.0` but decided that the multiplication would be faster too (not that it matters here).",
    "created_at": "2019-03-11T10:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423223",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">comment:67</div>

I made a few more minor fixes in that function, in particular replacing `/= 2` by `*= 0.5` (dividing an integer by an integer has different semantics in Python 3, so this might fix a not yet discovered Python 3 bug). I could have written `/= 2.0` but decided that the multiplication would be faster too (not that it matters here).



---

archive/issue_events_375839.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T10:40:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375839"
}
```



---

archive/issue_events_375840.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T10:40:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375840"
}
```



---

archive/issue_comments_423224.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nWhen I pull your commit 901eaf8 on top of 8936611 I get a merge conflict in height.py.  That seems to be because the parent of your latest commit is not 8936611 but 3ff16c1.  Did you mean to get rid of commit 8936611?",
    "created_at": "2019-03-11T11:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423224",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:69" align="right">comment:69</div>

When I pull your commit 901eaf8 on top of 8936611 I get a merge conflict in height.py.  That seems to be because the parent of your latest commit is not 8936611 but 3ff16c1.  Did you mean to get rid of commit 8936611?



---

archive/issue_comments_423225.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nDon't pull. Just checkout my branch.",
    "created_at": "2019-03-11T11:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423225",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">comment:70</div>

Don't pull. Just checkout my branch.



---

archive/issue_comments_423226.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@jdemeyer](#comment:70):\n> Don't pull. Just checkout my branch.\n\nOf course.  For some reason I had created a new  branch tracking trac/u/jdemeyer/eclib.  Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...",
    "created_at": "2019-03-11T11:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423226",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@jdemeyer](#comment:70):
> Don't pull. Just checkout my branch.

Of course.  For some reason I had created a new  branch tracking trac/u/jdemeyer/eclib.  Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...



---

archive/issue_comments_423227.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nOK, so testing all the elliptic_curves directory with a python3 build the only failures I get are ones which have nothing to do with this fix.\n\nFor the record there is one failure in each of ell_rational_field, ell_number_field, and padic_lseries.  The one in ell_rational_field has been fixed in #27432.",
    "created_at": "2019-03-11T12:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423227",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:72" align="right">comment:72</div>

OK, so testing all the elliptic_curves directory with a python3 build the only failures I get are ones which have nothing to do with this fix.

For the record there is one failure in each of ell_rational_field, ell_number_field, and padic_lseries.  The one in ell_rational_field has been fixed in #27432.



---

archive/issue_events_375841.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-03-11T12:00:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375841"
}
```



---

archive/issue_events_375842.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-03-11T12:00:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375842"
}
```



---

archive/issue_comments_423228.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@JohnCremona](#comment:71):\n> Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...\n\nI think you're right in principle. On the other hand, sometimes it is more practical to just rebase a branch. For example, having one commit and then another one which reverts that is just adding noise to the git history. In that case, I'd rather just remove the commit.",
    "created_at": "2019-03-11T12:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423228",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@JohnCremona](#comment:71):
> Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...

I think you're right in principle. On the other hand, sometimes it is more practical to just rebase a branch. For example, having one commit and then another one which reverts that is just adding noise to the git history. In that case, I'd rather just remove the commit.



---

archive/issue_comments_423229.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@jdemeyer](#comment:73):\n> Replying to [@JohnCremona](#comment:71):\n> > Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...\n\n> \n> I think you're right in principle. On the other hand, sometimes it is more practical to just rebase a branch. For example, having one commit and then another one which reverts that is just adding noise to the git history. In that case, I'd rather just remove the commit.\n\n*and* as a courtesy to others, add a comment on trac to say that that is what you have done!",
    "created_at": "2019-03-11T12:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423229",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@jdemeyer](#comment:73):
> Replying to [@JohnCremona](#comment:71):
> > Still, I think it may be bad practice to upload a branch with same name as an old one but which does not have the old one as parent...

> 
> I think you're right in principle. On the other hand, sometimes it is more practical to just rebase a branch. For example, having one commit and then another one which reverts that is just adding noise to the git history. In that case, I'd rather just remove the commit.

*and* as a courtesy to others, add a comment on trac to say that that is what you have done!



---

archive/issue_comments_423230.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/eclib)** to **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**",
    "created_at": "2019-03-13T18:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423230",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/eclib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/eclib)** to **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)**



---

archive/issue_events_375843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-13T18:29:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375843"
}
```



---

archive/issue_events_375844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f570e3a7fc2965764b84c04ce301a88ded2c42df",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-13T18:29:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27360#event-375844"
}
```



---

archive/issue_comments_423231.json:
```json
{
    "body": "Changed commit from **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)** to none",
    "created_at": "2019-03-14T14:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423231",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[901eaf8](https://github.com/sagemath/sagetrac-mirror/commit/901eaf8760dc96dac0fc3757fc5f90ddf1cf850c)** to none



---

archive/issue_comments_423232.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nGood news! This ticket took a bit longer than expected...",
    "created_at": "2019-03-14T14:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423232",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:76" align="right">comment:76</div>

Good news! This ticket took a bit longer than expected...



---

archive/issue_comments_423233.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nI would like to publicly thank Jeroen for his work on this.  It's not the first time that eclib's inclusion in Sage has led to improvements in the library itself.\n\nThe less good news is that some of my code it not converging well with the new precision handling (decimal to bits) but not in a part which affects Sage, so there will not be another ticket to upgrade again.  Well, not this month.",
    "created_at": "2019-03-14T14:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27360#issuecomment-423233",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:77" align="right">comment:77</div>

I would like to publicly thank Jeroen for his work on this.  It's not the first time that eclib's inclusion in Sage has led to improvements in the library itself.

The less good news is that some of my code it not converging well with the new precision handling (decimal to bits) but not in a part which affects Sage, so there will not be another ticket to upgrade again.  Well, not this month.
