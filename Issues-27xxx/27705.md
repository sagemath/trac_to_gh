# Issue 27705: Check for more strictly required extension modules in Python build: zlib sqlite3

archive/issues_027468.json:
```json
{
    "assignees": [],
    "body": "When building Python 2/3 the Python build system attempts to build several extension modules that are part of the stdlib, but does not fail the build if building some of those modules fails, as many of them are optional.\n\nThere are some such modules that are mandatory for Sage, so we check after the Python build that they can be imported, and force the build to fail if not:\n\n```\necho \"Testing importing of various modules...\"\nimport_errors=false\ntest_modules=\"ctypes math hashlib crypt readline socket\"\nif [ \"$UNAME\" = \"Darwin\" ]; then\n    test_modules=\"$test_modules _scproxy\"\nfi\n\nfor module in $test_modules; do\n    if $PYTHON -c \"import $module\"; then\n        echo \"$module module imported OK\"\n    else\n        echo >&2 \"$module module failed to import\"\n        import_errors=true\n    fi\ndone\n\nif $import_errors; then\n    echo >&2 \"Error: One or more modules failed to import.\"\n    exit 1\nfi\n```\n\nThis came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.\n\nIt turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.\n\nAlso `ssl` should be added, but we reserve this for a follow-up ticket that addresses the whole openssl mess on macOS.\n\n\nCC:  @dimpase @orlitzky @jdemeyer @jhpalmieri @vbraun @slel @vinklein @tscrim @kcrisman @saraedum @videlec\n\nComponent: **packages: standard**\n\nAuthor: **Matthias Koeppe**\n\nBranch: **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27705_\n\n",
    "closed_at": "2020-02-22T21:15:24Z",
    "created_at": "2019-04-19T16:21:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Check for more strictly required extension modules in Python build: zlib sqlite3",
    "type": "issue",
    "updated_at": "2020-03-06T22:39:14Z",
    "url": "https://github.com/sagemath/sage/issues/27705",
    "user": "https://github.com/embray"
}
```
When building Python 2/3 the Python build system attempts to build several extension modules that are part of the stdlib, but does not fail the build if building some of those modules fails, as many of them are optional.

There are some such modules that are mandatory for Sage, so we check after the Python build that they can be imported, and force the build to fail if not:

```
echo "Testing importing of various modules..."
import_errors=false
test_modules="ctypes math hashlib crypt readline socket"
if [ "$UNAME" = "Darwin" ]; then
    test_modules="$test_modules _scproxy"
fi

for module in $test_modules; do
    if $PYTHON -c "import $module"; then
        echo "$module module imported OK"
    else
        echo >&2 "$module module failed to import"
        import_errors=true
    fi
done

if $import_errors; then
    echo >&2 "Error: One or more modules failed to import."
    exit 1
fi
```

This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.

It turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.

Also `ssl` should be added, but we reserve this for a follow-up ticket that addresses the whole openssl mess on macOS.


CC:  @dimpase @orlitzky @jdemeyer @jhpalmieri @vbraun @slel @vinklein @tscrim @kcrisman @saraedum @videlec

Component: **packages: standard**

Author: **Matthias Koeppe**

Branch: **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/27705_





---

archive/issue_events_377177.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-19T16:21:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377177"
}
```



---

archive/issue_events_377178.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-19T16:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377178"
}
```



---

archive/issue_events_377179.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-19T16:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377179"
}
```



---

archive/issue_events_377180.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-19T16:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377180"
}
```



---

archive/issue_comments_429430.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nCorrection: It's elliptic_curves that has the sqlite3 dependency.",
    "created_at": "2019-04-19T16:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429430",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

Correction: It's elliptic_curves that has the sqlite3 dependency.



---

archive/issue_comments_429431.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,4 +27,4 @@\n \n This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.\n \n-It turns out also that pillow, for some reason, has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.\n+It turns out also that elliptic_curves has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.\n``````\n",
    "created_at": "2019-04-19T16:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429431",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,4 +27,4 @@
 
 This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.
 
-It turns out also that pillow, for some reason, has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.
+It turns out also that elliptic_curves has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.
``````




---

archive/issue_events_377181.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377181"
}
```



---

archive/issue_comments_429432.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429432",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_429433.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think we should also add `ssl` to this list, unless a flag is passed to Sage's `configure` explicitly requesting an SSL-less build.",
    "created_at": "2019-07-11T10:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429433",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

I think we should also add `ssl` to this list, unless a flag is passed to Sage's `configure` explicitly requesting an SSL-less build.



---

archive/issue_comments_429434.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSee also #29002, #27824",
    "created_at": "2020-01-15T18:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429434",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

See also #29002, #27824



---

archive/issue_comments_429435.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,4 +27,4 @@\n \n This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.\n \n-It turns out also that elliptic_curves has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.\n+It turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.\n``````\n",
    "created_at": "2020-01-16T11:29:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429435",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,4 +27,4 @@
 
 This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.
 
-It turns out also that elliptic_curves has a build-time dependency on the `_sqlite3` module being built properly, so we should add it as well.
+It turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.
``````




---

archive/issue_comments_429436.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@embray](#comment%3A3):\n> I think we should also add `ssl` to this list, unless a flag is passed to Sage's `configure` explicitly requesting an SSL-less build.\n\nThat's a good idea, I think, because it avoids nasty surprises later when people try to use pip.",
    "created_at": "2020-01-16T19:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429436",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@embray](#comment%3A3):
> I think we should also add `ssl` to this list, unless a flag is passed to Sage's `configure` explicitly requesting an SSL-less build.

That's a good idea, I think, because it avoids nasty surprises later when people try to use pip.



---

archive/issue_events_377182.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-16T19:34:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377182"
}
```



---

archive/issue_comments_429437.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nActually, is `crypt` used anywhere in sage? I'm having trouble building it in #29012.",
    "created_at": "2020-01-16T20:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429437",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Actually, is `crypt` used anywhere in sage? I'm having trouble building it in #29012.



---

archive/issue_comments_429438.json:
```json
{
    "body": "Branch: **[u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build)**",
    "created_at": "2020-01-18T19:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429438",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build)**



---

archive/issue_comments_429439.json:
```json
{
    "body": "Commit: **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)**",
    "created_at": "2020-01-18T19:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429439",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)**



---

archive/issue_events_377183.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T19:40:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "title_is": "Check for more strictly required extension modules in Python build: zlib sqlite3 ssl",
    "title_was": "Check for more strictly required extension modules in Python build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377183"
}
```



---

archive/issue_comments_429440.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-01-18T19:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429440",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_377184.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T19:40:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377184"
}
```



---

archive/issue_comments_429441.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222\"><code>da5e0fc</code></a></td><td><code>build/pkgs/python3/spkg-build: Check that Python build has modules zlib sqlite3 ssl</code></td></tr></table>\n",
    "created_at": "2020-01-18T19:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429441",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222"><code>da5e0fc</code></a></td><td><code>build/pkgs/python3/spkg-build: Check that Python build has modules zlib sqlite3 ssl</code></td></tr></table>




---

archive/issue_comments_429442.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nlgtm\n\nI expect some noise about ssl, but well...",
    "created_at": "2020-01-18T20:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429442",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

lgtm

I expect some noise about ssl, but well...



---

archive/issue_events_377185.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-18T20:19:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377185"
}
```



---

archive/issue_events_377186.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-18T20:19:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377186"
}
```



---

archive/issue_comments_429443.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-01-18T20:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429443",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_429444.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThank you!",
    "created_at": "2020-01-19T19:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429444",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Thank you!



---

archive/issue_comments_429445.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build)** to **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)**",
    "created_at": "2020-01-22T20:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429445",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/check_for_more_strictly_required_extension_modules_in_python_build)** to **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)**



---

archive/issue_events_377187.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-22T20:44:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377187"
}
```



---

archive/issue_events_377188.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-22T20:44:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377188"
}
```



---

archive/issue_comments_429446.json:
```json
{
    "body": "Changed commit from **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)** to none",
    "created_at": "2020-01-24T23:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429446",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)** to none



---

archive/issue_comments_429447.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n\n```\nTesting importing of various modules...\nctypes module imported OK\nmath module imported OK\nhashlib module imported OK\ncrypt module imported OK\nreadline module imported OK\nsocket module imported OK\nzlib module imported OK\nsqlite3 module imported OK\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/python3-3.7.3.p1/src/Lib/ssl.py\", line 98, in <module>\n    import _ssl             # if we can't import it, let the error propagate\nModuleNotFoundError: No module named '_ssl'\nssl module failed to import\nError: One or more modules failed to import.\n```",
    "created_at": "2020-01-24T23:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429447",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>


```
Testing importing of various modules...
ctypes module imported OK
math module imported OK
hashlib module imported OK
crypt module imported OK
readline module imported OK
socket module imported OK
zlib module imported OK
sqlite3 module imported OK
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/python3-3.7.3.p1/src/Lib/ssl.py", line 98, in <module>
    import _ssl             # if we can't import it, let the error propagate
ModuleNotFoundError: No module named '_ssl'
ssl module failed to import
Error: One or more modules failed to import.
```



---

archive/issue_events_377189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-24T23:15:39Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377189"
}
```



---

archive/issue_comments_429448.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nhmm, isn't this buildbot broken?",
    "created_at": "2020-01-24T23:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429448",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

hmm, isn't this buildbot broken?



---

archive/issue_comments_429449.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI get this same error on OS X.",
    "created_at": "2020-01-24T23:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429449",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

I get this same error on OS X.



---

archive/issue_comments_429450.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nDoes moving these tests to spkg-install from spkg-build fixes this?",
    "created_at": "2020-01-25T12:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429450",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Does moving these tests to spkg-install from spkg-build fixes this?



---

archive/issue_comments_429451.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nNo. From earlier in the log file:\n\n```\nCould not build the ssl module!\nPython requires an OpenSSL 1.0.2 or 1.1 compatible libssl with X509_VERIFY_PARAM_set1_host().\nLibreSSL 2.6.4 and earlier do not provide the necessary APIs, https://github.com/libressl-portable/portable/issues/381\n```\nIt works if I first install `openssl` via homebrew.",
    "created_at": "2020-01-26T19:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429451",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

No. From earlier in the log file:

```
Could not build the ssl module!
Python requires an OpenSSL 1.0.2 or 1.1 compatible libssl with X509_VERIFY_PARAM_set1_host().
LibreSSL 2.6.4 and earlier do not provide the necessary APIs, https://github.com/libressl-portable/portable/issues/381
```
It works if I first install `openssl` via homebrew.



---

archive/issue_comments_429452.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nthat is, is actually works as it should, i.e. you cannot build a broken (ssh-less) Python any more?",
    "created_at": "2020-01-26T20:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429452",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

that is, is actually works as it should, i.e. you cannot build a broken (ssh-less) Python any more?



---

archive/issue_comments_429453.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIf you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.",
    "created_at": "2020-01-26T20:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429453",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

If you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.



---

archive/issue_comments_429454.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment%3A20):\n> If you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.\n\nSage without a functioning openssl (and thus not fully functioning pip, probably broken jupyter too) is pretty much broken, that is, it's probably more about saving potential users time.\n\nI ventured into this mess on MacOS last year https://bugs.python.org/issue36344\nand the \"logic\" of what's going on with openssl support made me question my own sanity :-)\n\nBut perhaps Python 3.8 is an improvement.\n\nIMHO we'd ease the suffering of everyone wanting to build/run Sage on MacOS by telling them to use Conda or Homebrew.",
    "created_at": "2020-01-26T22:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429454",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment%3A20):
> If you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.

Sage without a functioning openssl (and thus not fully functioning pip, probably broken jupyter too) is pretty much broken, that is, it's probably more about saving potential users time.

I ventured into this mess on MacOS last year https://bugs.python.org/issue36344
and the "logic" of what's going on with openssl support made me question my own sanity :-)

But perhaps Python 3.8 is an improvement.

IMHO we'd ease the suffering of everyone wanting to build/run Sage on MacOS by telling them to use Conda or Homebrew.



---

archive/issue_comments_429455.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nFor this ticket, I'll change the error for a missing `_ssl` module into a warning.",
    "created_at": "2020-01-26T23:14:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429455",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

For this ticket, I'll change the error for a missing `_ssl` module into a warning.



---

archive/issue_comments_429456.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dimpase](#comment%3A21):\n> Replying to [@jhpalmieri](#comment%3A20):\n> > If you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.\n\n> \n> Sage without a functioning openssl (and thus not fully functioning pip, probably broken jupyter too) is pretty much broken, that is, it's probably more about saving potential users time.\n\nOn the same machine, vanilla Sage 9.1.beta1 runs the Jupyter notebook just fine, despite Python's failure to build the `ssl` module. `pip` is indeed broken, but it apparently hasn't bothered me before, so I am at least one user who can survive without a functioning `ssl` Python module.",
    "created_at": "2020-01-27T18:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429456",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dimpase](#comment%3A21):
> Replying to [@jhpalmieri](#comment%3A20):
> > If you want to force that change, then at the very least, you have to change the documentation from saying that `openssl` is recommended to saying that it is required. You will also be adding another obstacle to installing Sage on OS X.

> 
> Sage without a functioning openssl (and thus not fully functioning pip, probably broken jupyter too) is pretty much broken, that is, it's probably more about saving potential users time.

On the same machine, vanilla Sage 9.1.beta1 runs the Jupyter notebook just fine, despite Python's failure to build the `ssl` module. `pip` is indeed broken, but it apparently hasn't bothered me before, so I am at least one user who can survive without a functioning `ssl` Python module.



---

archive/issue_comments_429457.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\ndup: #22776",
    "created_at": "2020-02-10T01:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429457",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

dup: #22776



---

archive/issue_comments_429458.json:
```json
{
    "body": "Changed branch from **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)** to **[u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222)**",
    "created_at": "2020-02-10T01:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429458",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[`da5e0fc`](https://github.com/sagemath/sagetrac-mirror/commit/da5e0fcee826ad1c667c52341220c90306f0e222)** to **[u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222)**



---

archive/issue_comments_429459.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,6 @@\n This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.\n \n It turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.\n+\n+Also `ssl` should be added, but we reserve this for a follow-up ticket that addresses the whole openssl mess on macOS.\n+\n``````\n",
    "created_at": "2020-02-10T01:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429459",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,6 @@
 This came up recently in light of #26899, where the `zlib` module was silently failing to build on some macOS versions.  Hence, we should have also added `zlib` to this list.
 
 It turns out also that elliptic_curves has a build-time dependency on the `sqlite3` module being built properly, so we should add it as well.
+
+Also `ssl` should be added, but we reserve this for a follow-up ticket that addresses the whole openssl mess on macOS.
+
``````




---

archive/issue_events_377190.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-10T01:48:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "title_is": "Check for more strictly required extension modules in Python build: zlib sqlite3",
    "title_was": "Check for more strictly required extension modules in Python build: zlib sqlite3 ssl",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377190"
}
```



---

archive/issue_comments_429460.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dade95205ecbbbe309caa82240374ca8b5a0d6eb\"><code>dade952</code></a></td><td><code>build/pkgs/python3/spkg-build: Check that Python build has modules zlib sqlite3 ssl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e\"><code>8a294fb</code></a></td><td><code>Remove ssl from the list of required modules</code></td></tr></table>\n",
    "created_at": "2020-02-10T01:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429460",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dade95205ecbbbe309caa82240374ca8b5a0d6eb"><code>dade952</code></a></td><td><code>build/pkgs/python3/spkg-build: Check that Python build has modules zlib sqlite3 ssl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e"><code>8a294fb</code></a></td><td><code>Remove ssl from the list of required modules</code></td></tr></table>




---

archive/issue_events_377191.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-10T01:48:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377191"
}
```



---

archive/issue_comments_429461.json:
```json
{
    "body": "Commit: **[`8a294fb`](https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e)**",
    "created_at": "2020-02-10T01:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429461",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`8a294fb`](https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e)**



---

archive/issue_comments_429462.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f\"><code>c3542d5</code></a></td><td><code>Merge tag '9.1.beta4' into t/27705/da5e0fcee826ad1c667c52341220c90306f0e222</code></td></tr></table>\n",
    "created_at": "2020-02-16T20:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429462",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f"><code>c3542d5</code></a></td><td><code>Merge tag '9.1.beta4' into t/27705/da5e0fcee826ad1c667c52341220c90306f0e222</code></td></tr></table>




---

archive/issue_comments_429463.json:
```json
{
    "body": "Changed commit from **[`8a294fb`](https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e)** to **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**",
    "created_at": "2020-02-16T20:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429463",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8a294fb`](https://github.com/sagemath/sagetrac-mirror/commit/8a294fbc9876c9892cf4e9557b857ca20a8a375e)** to **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**



---

archive/issue_comments_429464.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nNeeds review",
    "created_at": "2020-02-21T18:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429464",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Needs review



---

archive/issue_events_377192.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-02-21T21:56:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377192"
}
```



---

archive/issue_events_377193.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-02-21T21:56:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377193"
}
```



---

archive/issue_comments_429465.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nok",
    "created_at": "2020-02-21T21:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429465",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

ok



---

archive/issue_events_377194.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-02-22T21:15:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377194"
}
```



---

archive/issue_events_377195.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c404100740173dcfc056b28a8c79930797a075fa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-02-22T21:15:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27705#event-377195"
}
```



---

archive/issue_comments_429466.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222)** to **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**",
    "created_at": "2020-02-22T21:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429466",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/da5e0fcee826ad1c667c52341220c90306f0e222)** to **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)**



---

archive/issue_comments_429467.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nFollow-up for ssl: #29291",
    "created_at": "2020-03-06T22:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429467",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Follow-up for ssl: #29291



---

archive/issue_comments_429468.json:
```json
{
    "body": "Changed commit from **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)** to none",
    "created_at": "2020-03-06T22:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27705#issuecomment-429468",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`c3542d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3542d532b537f10e6dd2f89c8f69401b91a185f)** to none
