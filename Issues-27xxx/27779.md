# Issue 27779: Py3: Fix dynamics.arithmetic_dynamics for python3

archive/issues_027542.json:
```json
{
    "assignees": [],
    "body": "Fix dynamics.arithmetic_dynamics for python3.\nOne failling doctest remains.\n\nCC:  @bhutz\n\nBranch/Commit: **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Vincent Klein**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27779_\n\n",
    "closed_at": "2019-05-12T21:30:12Z",
    "created_at": "2019-05-06T09:46:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Py3: Fix dynamics.arithmetic_dynamics for python3",
    "type": "issue",
    "updated_at": "2019-05-12T21:30:12Z",
    "url": "https://github.com/sagemath/sage/issues/27779",
    "user": "https://github.com/vinklein"
}
```
Fix dynamics.arithmetic_dynamics for python3.
One failling doctest remains.

CC:  @bhutz

Branch/Commit: **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**

Reviewer: **Frédéric Chapoton**

Author: **Vincent Klein**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/27779_





---

archive/issue_events_378162.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-05-06T09:46:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378162"
}
```



---

archive/issue_events_378163.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-05-06T09:46:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378163"
}
```



---

archive/issue_events_378164.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-05-06T09:46:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378164"
}
```



---

archive/issue_events_378165.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-05-06T09:46:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378165"
}
```



---

archive/issue_comments_430988.json:
```json
{
    "body": "Branch: **[u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3)**",
    "created_at": "2019-05-06T11:58:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430988",
    "user": "https://github.com/vinklein"
}
```

Branch: **[u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3)**



---

archive/issue_comments_430989.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7\"><code>ccf846c</code></a></td><td><code>Trac 27779: Fix arithmetic_dynamics for py3</code></td></tr></table>\n",
    "created_at": "2019-05-06T11:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430989",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7"><code>ccf846c</code></a></td><td><code>Trac 27779: Fix arithmetic_dynamics for py3</code></td></tr></table>




---

archive/issue_events_378166.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-05-06T11:59:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378166"
}
```



---

archive/issue_comments_430990.json:
```json
{
    "body": "Commit: **[`ccf846c`](https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7)**",
    "created_at": "2019-05-06T11:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430990",
    "user": "https://github.com/vinklein"
}
```

Commit: **[`ccf846c`](https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7)**



---

archive/issue_comments_430991.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nsome of the new lines must be tagged `# long time` too, as they depend on #long results\n\n```\n+            sage: lst, label = f.automorphism_group(return_functions=True, iso_type=True) # long time\n+            sage: sorted(lst, key=str), label\n```",
    "created_at": "2019-05-07T05:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430991",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

some of the new lines must be tagged `# long time` too, as they depend on #long results

```
+            sage: lst, label = f.automorphism_group(return_functions=True, iso_type=True) # long time
+            sage: sorted(lst, key=str), label
```



---

archive/issue_comments_430992.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3\"><code>b04931f</code></a></td><td><code>Trac #27779: Add missing `# long time` flag</code></td></tr></table>\n",
    "created_at": "2019-05-07T06:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430992",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3"><code>b04931f</code></a></td><td><code>Trac #27779: Add missing `# long time` flag</code></td></tr></table>




---

archive/issue_comments_430993.json:
```json
{
    "body": "Changed commit from **[`ccf846c`](https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7)** to **[`b04931f`](https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3)**",
    "created_at": "2019-05-07T06:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430993",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ccf846c`](https://github.com/sagemath/sagetrac-mirror/commit/ccf846c2be2b5015a2595370475433c4c5aeb1c7)** to **[`b04931f`](https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3)**



---

archive/issue_comments_430994.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks ! Missing tag added.",
    "created_at": "2019-05-07T06:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430994",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks ! Missing tag added.



---

archive/issue_comments_430995.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nmaybe add `# abs tol 1e-11` to the last failing doctest ?",
    "created_at": "2019-05-07T08:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430995",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

maybe add `# abs tol 1e-11` to the last failing doctest ?



---

archive/issue_comments_430996.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIt works. You mean values `(x^4 - 2.86348722511320e-12*y^4 : 1.41421356237310*y^4)` and `(x^4 + 7.74491581978509e-13*y^4 : 1.41421356237310*y^4)` are both valid results for this doctest ?",
    "created_at": "2019-05-07T09:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430996",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:7" align="right">comment:7</div>

It works. You mean values `(x^4 - 2.86348722511320e-12*y^4 : 1.41421356237310*y^4)` and `(x^4 + 7.74491581978509e-13*y^4 : 1.41421356237310*y^4)` are both valid results for this doctest ?



---

archive/issue_comments_430997.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI thought so, but maybe this is not so clear. We should cc the authors of that piece of code.",
    "created_at": "2019-05-07T09:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430997",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

I thought so, but maybe this is not so clear. We should cc the authors of that piece of code.



---

archive/issue_comments_430998.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nGit blame says it's from Ben Hutz but he is not listed in sage account list.",
    "created_at": "2019-05-07T09:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430998",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:9" align="right">comment:9</div>

Git blame says it's from Ben Hutz but he is not listed in sage account list.



---

archive/issue_comments_430999.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a\"><code>d2ad260</code></a></td><td><code>Trac #27779: Add `# abs tol 1e-11` tag to doctest</code></td></tr></table>\n",
    "created_at": "2019-05-07T09:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-430999",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a"><code>d2ad260</code></a></td><td><code>Trac #27779: Add `# abs tol 1e-11` tag to doctest</code></td></tr></table>




---

archive/issue_comments_431000.json:
```json
{
    "body": "Changed commit from **[`b04931f`](https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3)** to **[`d2ad260`](https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a)**",
    "created_at": "2019-05-07T09:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431000",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b04931f`](https://github.com/sagemath/sagetrac-mirror/commit/b04931f9f85f85e97701acc3184cc11da459d3d3)** to **[`d2ad260`](https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a)**



---

archive/issue_comments_431001.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nPerhaps a cleaner fix here would be to change the doctest to\n\n```\ng,m = f.reduced_form(smallest_coeffs=False); m\n```\n\nThe matrix is it producing for the conjugation is always an integer matrix, but just working over RR to conjugate and then conjugate by the inverse is introducing numerical error, so the resulting function is not an exact match of the original. So, the error that is cropping up in the doctest actually has nothing to do with the functionality of .reduced_form(), rather it is just a consequence of conjugating over a numerical field.\n\nYou should probably do the same thing for the doctest immediately following as I would have expected the same kind of issue over CC.",
    "created_at": "2019-05-07T10:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431001",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:12" align="right">comment:12</div>

Perhaps a cleaner fix here would be to change the doctest to

```
g,m = f.reduced_form(smallest_coeffs=False); m
```

The matrix is it producing for the conjugation is always an integer matrix, but just working over RR to conjugate and then conjugate by the inverse is introducing numerical error, so the resulting function is not an exact match of the original. So, the error that is cropping up in the doctest actually has nothing to do with the functionality of .reduced_form(), rather it is just a consequence of conjugating over a numerical field.

You should probably do the same thing for the doctest immediately following as I would have expected the same kind of issue over CC.



---

archive/issue_comments_431002.json:
```json
{
    "body": "Changed commit from **[`d2ad260`](https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a)** to **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**",
    "created_at": "2019-05-07T11:58:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2ad260`](https://github.com/sagemath/sagetrac-mirror/commit/d2ad26030d76568687134cc5536998a28c5a3b4a)** to **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**



---

archive/issue_comments_431003.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489\"><code>e26a443</code></a></td><td><code>Trac #27779: Test the matrix result only for ...</code></td></tr></table>\n",
    "created_at": "2019-05-07T11:58:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431003",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489"><code>e26a443</code></a></td><td><code>Trac #27779: Test the matrix result only for ...</code></td></tr></table>




---

archive/issue_comments_431004.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOk it's done.\\\\\nThank you for your help Ben.",
    "created_at": "2019-05-07T11:59:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431004",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:14" align="right">comment:14</div>

Ok it's done.\\
Thank you for your help Ben.



---

archive/issue_events_378167.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-05-08T06:03:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378167"
}
```



---

archive/issue_events_378168.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-05-08T06:03:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378168"
}
```



---

archive/issue_comments_431005.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n\u00c7a me parait correct.",
    "created_at": "2019-05-08T06:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431005",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

Ça me parait correct.



---

archive/issue_comments_431006.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2019-05-08T06:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431006",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_378169.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:30:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378169"
}
```



---

archive/issue_events_378170.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ddbf8517cd31399c9b17749490db0d8251762e56",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-05-12T21:30:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27779#event-378170"
}
```



---

archive/issue_comments_431007.json:
```json
{
    "body": "Changed branch from **[u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3)** to **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**",
    "created_at": "2019-05-12T21:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27779#issuecomment-431007",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/py3__fix_dynamics_arithmetic_dynamics_for_python3)** to **[`e26a443`](https://github.com/sagemath/sagetrac-mirror/commit/e26a443fba787f4a66c0c1b76b84558b61987489)**
