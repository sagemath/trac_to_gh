# Issue 27018: Cannot construct FreeNilpotentLieAlgebra of step > 2 with > 10 generators

archive/issues_026781.json:
```json
{
    "body": "As [reported on Ask SageMath](https://ask.sagemath.org/question/44619/free-nilpotent-lie-algebra-of-step-3-with-11-generators/), this works:\n\n```\nLieAlgebra(QQ, 10, step=3, names='X', naming='linear')\n```\nand this works:\n\n```\nLieAlgebra(QQ, 11, step=2, names='X', naming='linear')\n```\nbut this doesn't work:\n\n```\nLieAlgebra(QQ, 11, step=3, names='X', naming='linear')\n```\nThe traceback is as follows:\n\n```\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-5-8672234ea66b> in <module>()\n----> 1 LieAlgebra(QQ, Integer(11), step=Integer(3), names='X', naming='linear')\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)()\n    328         \"\"\"\n    329         if cls.classcall is not None:\n--> 330             return cls.classcall(cls, *args, **kwds)\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra.py in __classcall_private__(cls, R, arg0, arg1, names, index_set, abelian, nilpotent, category, **kwds)\n    439                 from sage.algebras.lie_algebras.nilpotent_lie_algebra import FreeNilpotentLieAlgebra\n    440                 del kwds[\"step\"]\n--> 441                 return FreeNilpotentLieAlgebra(R, arg1, step, names=names, **kwds)\n    442             elif nilpotent:\n    443                 raise ValueError(\"free nilpotent Lie algebras must have a\"\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)()\n    328         \"\"\"\n    329         if cls.classcall is not None:\n--> 330             return cls.classcall(cls, *args, **kwds)\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/nilpotent_lie_algebra.py in __classcall_private__(cls, R, r, s, names, naming, category, **kwds)\n    325         return super(FreeNilpotentLieAlgebra, cls).__classcall__(\n    326             cls, R,r, s, names=tuple(names), naming=naming,\n--> 327             category=category, **kwds)\n    328\n    329     def __init__(self, R, r, s, names, naming, category, **kwds):\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6068)()\n   1003                 return self.cache[k]\n   1004         except KeyError:\n-> 1005             w = self.f(*args, **kwds)\n   1006             self.cache[k] = w\n   1007             return w\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/structure/unique_representation.py in __classcall__(cls, *args, **options)\n   1025             True\n   1026         \"\"\"\n-> 1027         instance = typecall(cls, *args, **options)\n   1028         assert isinstance( instance, cls )\n   1029         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2151)()\n    495             TypeError: Argument 'cls' has incorrect type (expected type, got classobj)\n    496     \"\"\"\n--> 497     return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n    498\n    499 # Class for timing::\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/nilpotent_lie_algebra.py in __init__(self, R, r, s, names, naming, category, **kwds)\n    398                     for X_ind, X in basis_by_deg[dx]:\n    399                         for Y_ind, Y in basis_by_deg[dy]:\n--> 400                             Z = L[X, Y]\n    401                             if not Z.is_zero():\n    402                                 s_coeff[(X_ind, Y_ind)] = {W_ind: Z[W.leading_support()]\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra.py in __getitem__(self, x)\n    573                 return x[1].ideal(x[0])\n    574             # Otherwise it is the bracket of two elements\n--> 575             return self(x[0])._bracket_(self(x[1]))\n    576         return super(LieAlgebra, self).__getitem__(x)\n    577\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra_element.pyx in sage.algebras.lie_algebras.lie_algebra_element.FreeLieAlgebraElement._bracket_ (build/cythonized/sage/algebras/lie_algebras/lie_algebra_element.c:18483)()\n   1452                     a, b = mr, ml\n   1453                     cr = -cr\n-> 1454                 for b_elt, coeff in self.parent()._rewrite_bracket(a, b).iteritems():\n   1455                     d[b_elt] = d.get(b_elt, zero) + cl * cr * coeff\n   1456                     if d[b_elt] == zero:\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10324)()\n   1950                 return cache[k]\n   1951         except KeyError:\n-> 1952             w = self._instance_call(*args, **kwds)\n   1953             cache[k] = w\n   1954             return w\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9809)()\n   1826             True\n   1827         \"\"\"\n-> 1828         return self.f(self._instance, *args, **kwds)\n   1829\n   1830     cdef fix_args_kwds(self, tuple args, dict kwds):\n\n/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/free_lie_algebra.py in _rewrite_bracket(self, l, r)\n    690             # For a similar reason, we have b >= c.\n    691             # Compute the left summand\n--> 692             for m, inner_coeff in iteritems(self._rewrite_bracket(l._right, r)):\n    693                 if l._left == m:\n    694                     continue\n\nAttributeError: 'sage.algebras.lie_algebras.lie_algebra_element.Lie' object has no attribute '_right'\n```\n\n\nCC:  @ehaka @tscrim\n\nKeywords: FreeNilpotentLieAlgebra, LieAlgebra, nilpotent, free\n\nReviewer: Travis Scrimshaw\n\nDependencies: #27069\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/27018\n\n",
    "closed_at": "2019-02-26T13:58:00Z",
    "created_at": "2019-01-04T12:30:34Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Cannot construct FreeNilpotentLieAlgebra of step > 2 with > 10 generators",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27018",
    "user": "https://github.com/rburing"
}
```
As [reported on Ask SageMath](https://ask.sagemath.org/question/44619/free-nilpotent-lie-algebra-of-step-3-with-11-generators/), this works:

```
LieAlgebra(QQ, 10, step=3, names='X', naming='linear')
```
and this works:

```
LieAlgebra(QQ, 11, step=2, names='X', naming='linear')
```
but this doesn't work:

```
LieAlgebra(QQ, 11, step=3, names='X', naming='linear')
```
The traceback is as follows:

```
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-5-8672234ea66b> in <module>()
----> 1 LieAlgebra(QQ, Integer(11), step=Integer(3), names='X', naming='linear')

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra.py in __classcall_private__(cls, R, arg0, arg1, names, index_set, abelian, nilpotent, category, **kwds)
    439                 from sage.algebras.lie_algebras.nilpotent_lie_algebra import FreeNilpotentLieAlgebra
    440                 del kwds["step"]
--> 441                 return FreeNilpotentLieAlgebra(R, arg1, step, names=names, **kwds)
    442             elif nilpotent:
    443                 raise ValueError("free nilpotent Lie algebras must have a"

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)()
    328         """
    329         if cls.classcall is not None:
--> 330             return cls.classcall(cls, *args, **kwds)
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/nilpotent_lie_algebra.py in __classcall_private__(cls, R, r, s, names, naming, category, **kwds)
    325         return super(FreeNilpotentLieAlgebra, cls).__classcall__(
    326             cls, R,r, s, names=tuple(names), naming=naming,
--> 327             category=category, **kwds)
    328
    329     def __init__(self, R, r, s, names, naming, category, **kwds):

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6068)()
   1003                 return self.cache[k]
   1004         except KeyError:
-> 1005             w = self.f(*args, **kwds)
   1006             self.cache[k] = w
   1007             return w

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/structure/unique_representation.py in __classcall__(cls, *args, **options)
   1025             True
   1026         """
-> 1027         instance = typecall(cls, *args, **options)
   1028         assert isinstance( instance, cls )
   1029         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2151)()
    495             TypeError: Argument 'cls' has incorrect type (expected type, got classobj)
    496     """
--> 497     return (<PyTypeObject*>type).tp_call(cls, args, kwds)
    498
    499 # Class for timing::

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/nilpotent_lie_algebra.py in __init__(self, R, r, s, names, naming, category, **kwds)
    398                     for X_ind, X in basis_by_deg[dx]:
    399                         for Y_ind, Y in basis_by_deg[dy]:
--> 400                             Z = L[X, Y]
    401                             if not Z.is_zero():
    402                                 s_coeff[(X_ind, Y_ind)] = {W_ind: Z[W.leading_support()]

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra.py in __getitem__(self, x)
    573                 return x[1].ideal(x[0])
    574             # Otherwise it is the bracket of two elements
--> 575             return self(x[0])._bracket_(self(x[1]))
    576         return super(LieAlgebra, self).__getitem__(x)
    577

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/lie_algebra_element.pyx in sage.algebras.lie_algebras.lie_algebra_element.FreeLieAlgebraElement._bracket_ (build/cythonized/sage/algebras/lie_algebras/lie_algebra_element.c:18483)()
   1452                     a, b = mr, ml
   1453                     cr = -cr
-> 1454                 for b_elt, coeff in self.parent()._rewrite_bracket(a, b).iteritems():
   1455                     d[b_elt] = d.get(b_elt, zero) + cl * cr * coeff
   1456                     if d[b_elt] == zero:

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10324)()
   1950                 return cache[k]
   1951         except KeyError:
-> 1952             w = self._instance_call(*args, **kwds)
   1953             cache[k] = w
   1954             return w

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9809)()
   1826             True
   1827         """
-> 1828         return self.f(self._instance, *args, **kwds)
   1829
   1830     cdef fix_args_kwds(self, tuple args, dict kwds):

/opt/sagemath-8.5/local/lib/python2.7/site-packages/sage/algebras/lie_algebras/free_lie_algebra.py in _rewrite_bracket(self, l, r)
    690             # For a similar reason, we have b >= c.
    691             # Compute the left summand
--> 692             for m, inner_coeff in iteritems(self._rewrite_bracket(l._right, r)):
    693                 if l._left == m:
    694                     continue

AttributeError: 'sage.algebras.lie_algebras.lie_algebra_element.Lie' object has no attribute '_right'
```


CC:  @ehaka @tscrim

Keywords: FreeNilpotentLieAlgebra, LieAlgebra, nilpotent, free

Reviewer: Travis Scrimshaw

Dependencies: #27069

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/27018





---

archive/issue_comments_512904.json:
```json
{
    "body": "<a id='comment:1'></a>\nSomething strange is going on because there is no such class `sage.algebras.lie_algebras.lie_algebra_element.Lie`. Further investigation is needed.",
    "created_at": "2019-01-04T20:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512904",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
Something strange is going on because there is no such class `sage.algebras.lie_algebras.lie_algebra_element.Lie`. Further investigation is needed.



---

archive/issue_comments_512905.json:
```json
{
    "body": "<a id='comment:2'></a>\nStaring at the construction through the debugger, I can recreate the problem more precisely with the following:\n\n```\nsage: L = LieAlgebra(QQ, ['F%d' % k for k in range(11)]).Lyndon()\nsage: L[L.graded_basis(1)[0],L.graded_basis(2)[26]]\nTraceback (most recent call last)\n...\nAttributeError: 'sage.algebras.lie_algebras.lie_algebra_element.Lie' object has no attribute '_right'\n```\nThe problem seems like it may arise from a mismatch between what the graded basis outputs vs. what the free Lie algebra expects it elements to be like.\n\n```\nsage: L.graded_basis(1)[0]\nF0\nsage: X=L.graded_basis(2)[26]; X\n[F2, F10]\nsage: Y=L[L.graded_basis(1)[2],L.graded_basis(1)[10]]; Y\n-[F10, F2]\nsage: X==Y\nFalse\n```\nI will try to figure out more.",
    "created_at": "2019-01-04T23:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512905",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:2'></a>
Staring at the construction through the debugger, I can recreate the problem more precisely with the following:

```
sage: L = LieAlgebra(QQ, ['F%d' % k for k in range(11)]).Lyndon()
sage: L[L.graded_basis(1)[0],L.graded_basis(2)[26]]
Traceback (most recent call last)
...
AttributeError: 'sage.algebras.lie_algebras.lie_algebra_element.Lie' object has no attribute '_right'
```
The problem seems like it may arise from a mismatch between what the graded basis outputs vs. what the free Lie algebra expects it elements to be like.

```
sage: L.graded_basis(1)[0]
F0
sage: X=L.graded_basis(2)[26]; X
[F2, F10]
sage: Y=L[L.graded_basis(1)[2],L.graded_basis(1)[10]]; Y
-[F10, F2]
sage: X==Y
False
```
I will try to figure out more.



---

archive/issue_comments_512906.json:
```json
{
    "body": "<a id='comment:3'></a>\nThat is very helpful. So I was thinking it was because `F10` is not sorted by the integer `10` but by the string `'10'`. Thus, we have\n\n```\nsage: sorted(L.graded_basis(1))\n[F0, F1, F10, F2, F3, F4, F5, F6, F7, F8, F9]\n```\nSo this is an issue that I was hoping we did not have to address. In other words, the computation does not depend on the generators, i.e., these would do the same computations:\n\n```\nsage: Lxyz = LieAlgebra(QQ, ['x','y','z']).Lyndon()\nsage: Lzxy = LieAlgebra(QQ, ['z','x','y']).Lyndon()\nsage: Lxyz.graded_basis(2)\n([x, y], [x, z], [y, z])\nsage: Lzxy.graded_basis(2)\n([z, x], [z, y], [x, y])\nsage: x,y,z = Lxyz.gens()\nsage: a,b,c = Lzxy.gens()\nsage: a,b,c\n(z, x, y)\nsage: b.bracket(a)\n[x, z]\nsage: x.bracket(z)\n[x, z]\nsage: Lzxy._is_basis_element(b.leading_support(),a.leading_support())\nTrue\nsage: Lzxy._is_basis_element(a.leading_support(),b.leading_support())\nFalse\n```\nSo what we have to do is during the comparison of the Lie bracketing (most likely in `_bracket_` and maybe `_rewrite_bracket`) is look up the index within the generators. Actually, a little more invasive but will likely make the code more maintainable is have the `LieGenerator` just keep track of the index of the generator and then have the `monomial_coefficients()` do the translation to the `index_set`. Although that might be better long term, but just tweaking the comparison I mentioned above would be the quick fix. What would you like to do?",
    "created_at": "2019-01-05T05:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512906",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
That is very helpful. So I was thinking it was because `F10` is not sorted by the integer `10` but by the string `'10'`. Thus, we have

```
sage: sorted(L.graded_basis(1))
[F0, F1, F10, F2, F3, F4, F5, F6, F7, F8, F9]
```
So this is an issue that I was hoping we did not have to address. In other words, the computation does not depend on the generators, i.e., these would do the same computations:

```
sage: Lxyz = LieAlgebra(QQ, ['x','y','z']).Lyndon()
sage: Lzxy = LieAlgebra(QQ, ['z','x','y']).Lyndon()
sage: Lxyz.graded_basis(2)
([x, y], [x, z], [y, z])
sage: Lzxy.graded_basis(2)
([z, x], [z, y], [x, y])
sage: x,y,z = Lxyz.gens()
sage: a,b,c = Lzxy.gens()
sage: a,b,c
(z, x, y)
sage: b.bracket(a)
[x, z]
sage: x.bracket(z)
[x, z]
sage: Lzxy._is_basis_element(b.leading_support(),a.leading_support())
True
sage: Lzxy._is_basis_element(a.leading_support(),b.leading_support())
False
```
So what we have to do is during the comparison of the Lie bracketing (most likely in `_bracket_` and maybe `_rewrite_bracket`) is look up the index within the generators. Actually, a little more invasive but will likely make the code more maintainable is have the `LieGenerator` just keep track of the index of the generator and then have the `monomial_coefficients()` do the translation to the `index_set`. Although that might be better long term, but just tweaking the comparison I mentioned above would be the quick fix. What would you like to do?



---

archive/issue_comments_512907.json:
```json
{
    "body": "<a id='comment:4'></a>\nKeeping track of the index sounds perhaps more reasonable, considering that bracketing is one of the primary operations of Lie algebra elements. Although I don't have that clear of an understanding of the internals of the elements, so take my opinion with a grain of salt :)\n\nIf you want to do the fix you're more than welcome. As I said, I am not quite clear about the internals and am a bit worried about breaking things. Nonetheless I can also do a fix and you can tell me if something should be corrected if that is easier.",
    "created_at": "2019-01-05T07:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512907",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:4'></a>
Keeping track of the index sounds perhaps more reasonable, considering that bracketing is one of the primary operations of Lie algebra elements. Although I don't have that clear of an understanding of the internals of the elements, so take my opinion with a grain of salt :)

If you want to do the fix you're more than welcome. As I said, I am not quite clear about the internals and am a bit worried about breaking things. Nonetheless I can also do a fix and you can tell me if something should be corrected if that is easier.



---

archive/issue_comments_512908.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [tscrim](#comment%3A3):\n> Actually, a little more invasive but will likely make the code more maintainable is have the `LieGenerator` just keep track of the index of the generator and then have the `monomial_coefficients()` do the translation to the `index_set`.\n\nI'm afraid I don't understand what you mean by this. Namely, I don't understand at which point `monomial_coefficients()` comes into play, since `FreeLieAlgebra.Lyndon._is_basis_element` only uses the word representation of the elements. \n\nI started modifying the ordering behavior but ran into some problems.\nI added an `_index` attribute to `LieGenerator` in the commits and changed `LieGenerator.__richcmp__` to order by indices instead of name. I did not change comparisons in `LyndonBracket.__richcmp__` or `_is_basis_element` yet, as I am not in fact sure what should be the desired behavior. Hence the current commit is still very much broken (a lot of tests fail) due to inconsistent ordering behavior.\n\nWhat should be the desired behavior?\nWas the idea that `Lxyz` and `Lzxy` should or should not behave the same?\n\nIf they should behave differently, then should all the word-based comparisons all be changed to use the index-based comparisons?\n\nIf they should behave the same, then is it the case that only `graded_basis` has incorrect behavior? \n\n---\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[4e27c06](https://github.com/sagemath/sagetrac-mirror/commit/4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3)|`added _index attribute to LieGenerator`|",
    "created_at": "2019-01-06T08:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512908",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:5'></a>
Replying to [tscrim](#comment%3A3):
> Actually, a little more invasive but will likely make the code more maintainable is have the `LieGenerator` just keep track of the index of the generator and then have the `monomial_coefficients()` do the translation to the `index_set`.

I'm afraid I don't understand what you mean by this. Namely, I don't understand at which point `monomial_coefficients()` comes into play, since `FreeLieAlgebra.Lyndon._is_basis_element` only uses the word representation of the elements. 

I started modifying the ordering behavior but ran into some problems.
I added an `_index` attribute to `LieGenerator` in the commits and changed `LieGenerator.__richcmp__` to order by indices instead of name. I did not change comparisons in `LyndonBracket.__richcmp__` or `_is_basis_element` yet, as I am not in fact sure what should be the desired behavior. Hence the current commit is still very much broken (a lot of tests fail) due to inconsistent ordering behavior.

What should be the desired behavior?
Was the idea that `Lxyz` and `Lzxy` should or should not behave the same?

If they should behave differently, then should all the word-based comparisons all be changed to use the index-based comparisons?

If they should behave the same, then is it the case that only `graded_basis` has incorrect behavior? 

---
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[4e27c06](https://github.com/sagemath/sagetrac-mirror/commit/4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3)|`added _index attribute to LieGenerator`|



---

archive/issue_comments_512909.json:
```json
{
    "body": "Changing branch from \"\" to \"public/lie_elem_indexing-27018\"",
    "created_at": "2019-01-06T08:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512909",
    "user": "https://github.com/ehaka"
}
```

Changing branch from "" to "public/lie_elem_indexing-27018"



---

archive/issue_comments_512910.json:
```json
{
    "body": "Changing commit from \"\" to \"4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3\"",
    "created_at": "2019-01-06T08:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512910",
    "user": "https://github.com/ehaka"
}
```

Changing commit from "" to "4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3"



---

archive/issue_events_083956.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27018#event-83956"
}
```



---

archive/issue_comments_512911.json:
```json
{
    "body": "<a id='comment:6'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512911",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_512912.json:
```json
{
    "body": "Changing branch from \"public/lie_elem_indexing-27018\" to \"public/freenilp_lie_gens_fix-27018\"",
    "created_at": "2019-01-16T20:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512912",
    "user": "https://github.com/ehaka"
}
```

Changing branch from "public/lie_elem_indexing-27018" to "public/freenilp_lie_gens_fix-27018"



---

archive/issue_comments_512913.json:
```json
{
    "body": "<a id='comment:7'></a>\nNot knowing how to fix the underlying issue at the moment, I wrote up a bandaid fix for the part that concerns the free nilpotent Lie algebras, since the traceback caused by simply inputting the wrong numbers into a constructor is not very helpful. \n\nI opened a new ticket #27069 to address the underlying issue.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[f086e53](https://github.com/sagemath/sagetrac-mirror/commit/f086e53e1404d0d0bcc63ca0385f3890061772fa)|`trac #27018: bandaid fix for free nilpotent Lie algebras with many generators`|",
    "created_at": "2019-01-16T20:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512913",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:7'></a>
Not knowing how to fix the underlying issue at the moment, I wrote up a bandaid fix for the part that concerns the free nilpotent Lie algebras, since the traceback caused by simply inputting the wrong numbers into a constructor is not very helpful. 

I opened a new ticket #27069 to address the underlying issue.

---
New commits:
|                                                                                                                                          |                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[f086e53](https://github.com/sagemath/sagetrac-mirror/commit/f086e53e1404d0d0bcc63ca0385f3890061772fa)|`trac #27018: bandaid fix for free nilpotent Lie algebras with many generators`|



---

archive/issue_comments_512914.json:
```json
{
    "body": "Changing commit from \"4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3\" to \"f086e53e1404d0d0bcc63ca0385f3890061772fa\"",
    "created_at": "2019-01-16T20:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512914",
    "user": "https://github.com/ehaka"
}
```

Changing commit from "4e27c06abf6bfc538f3a21394f2ce86dd4fc26b3" to "f086e53e1404d0d0bcc63ca0385f3890061772fa"



---

archive/issue_comments_512915.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-16T20:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512915",
    "user": "https://github.com/ehaka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_512916.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-01-18T10:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512916",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_512917.json:
```json
{
    "body": "<a id='comment:8'></a>\nI don't understand what this is supposed to be fixing:\n\n```diff\n@@ -348,7 +355,7 @@ class FreeNilpotentLieAlgebra(NilpotentLieAlgebra_dense):\n         # free Lie algebra, and store the corresponding elements in a dict\n         from sage.algebras.lie_algebras.lie_algebra import LieAlgebra\n \n-        free_gen_names = ['F%d' % k for k in range(r)]\n+        free_gen_names = sorted('F%d' % k for k in range(r))\n```\n\nOriginally it was just generating the sequence `'F0'`, `'F1'`, `'F2'`, ... `'F<r>'`.\nThe only difference here is that if `r >= 10` you'll get something like `'F0'`, `'F1'`, `'F10'`, `'F2'`, ...",
    "created_at": "2019-01-18T10:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512917",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
I don't understand what this is supposed to be fixing:

```diff
@@ -348,7 +355,7 @@ class FreeNilpotentLieAlgebra(NilpotentLieAlgebra_dense):
         # free Lie algebra, and store the corresponding elements in a dict
         from sage.algebras.lie_algebras.lie_algebra import LieAlgebra
 
-        free_gen_names = ['F%d' % k for k in range(r)]
+        free_gen_names = sorted('F%d' % k for k in range(r))
```

Originally it was just generating the sequence `'F0'`, `'F1'`, `'F2'`, ... `'F<r>'`.
The only difference here is that if `r >= 10` you'll get something like `'F0'`, `'F1'`, `'F10'`, `'F2'`, ...



---

archive/issue_comments_512918.json:
```json
{
    "body": "<a id='comment:9'></a>\nSorry, I actually read the rest of the discussion and now I understand how you came to this solution.  But like you said it's just a band-aid, and a very flimsy one at that.  But having the test case helps.",
    "created_at": "2019-01-18T10:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512918",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Sorry, I actually read the rest of the discussion and now I understand how you came to this solution.  But like you said it's just a band-aid, and a very flimsy one at that.  But having the test case helps.



---

archive/issue_comments_512919.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe motivation for the bandaid fix was mainly that the free Lie algebra computations are only used as an auxiliary tool in the initialization of the `FreeNilpotentLieAlgebra` object.\nSince it was not clear to me what is the desired behavior in the free Lie algebra setting, it could be argued that this bug is caused by incorrect usage of the `FreeLieAlgebra` structure inside `FreeNilpotentLieAlgebra.__init__`.\n\nThis is why I considered splitting the underlying issue from this ticket, in order to at least avoid the confusing traceback caused by a call of a simple constructor `LieAlgebra(QQ, 11, step=3)` while the underlying issue is being figured out.",
    "created_at": "2019-01-18T10:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512919",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:10'></a>
The motivation for the bandaid fix was mainly that the free Lie algebra computations are only used as an auxiliary tool in the initialization of the `FreeNilpotentLieAlgebra` object.
Since it was not clear to me what is the desired behavior in the free Lie algebra setting, it could be argued that this bug is caused by incorrect usage of the `FreeLieAlgebra` structure inside `FreeNilpotentLieAlgebra.__init__`.

This is why I considered splitting the underlying issue from this ticket, in order to at least avoid the confusing traceback caused by a call of a simple constructor `LieAlgebra(QQ, 11, step=3)` while the underlying issue is being figured out.



---

archive/issue_comments_512920.json:
```json
{
    "body": "<a id='comment:11'></a>\nSorry for taking so long to get to this. I figured it was easier to fix the problem on #27069 instead of the temporary patch here. So please review #27069, and then we can close this one.",
    "created_at": "2019-01-25T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512920",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Sorry for taking so long to get to this. I figured it was easier to fix the problem on #27069 instead of the temporary patch here. So please review #27069, and then we can close this one.



---

archive/issue_events_083957.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-25T18:57:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27018#event-83957"
}
```



---

archive/issue_events_083958.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-25T18:57:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27018#event-83958"
}
```



---

archive/issue_comments_512921.json:
```json
{
    "body": "Changing commit from \"f086e53e1404d0d0bcc63ca0385f3890061772fa\" to \"\"",
    "created_at": "2019-01-25T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512921",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "f086e53e1404d0d0bcc63ca0385f3890061772fa" to ""



---

archive/issue_comments_512922.json:
```json
{
    "body": "Changing branch from \"public/freenilp_lie_gens_fix-27018\" to \"\"",
    "created_at": "2019-01-25T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512922",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "public/freenilp_lie_gens_fix-27018" to ""



---

archive/issue_comments_512923.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-01-25T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512923",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_512924.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#27069\"",
    "created_at": "2019-01-25T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512924",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#27069"



---

archive/issue_comments_512925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-07T00:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512925",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_512926.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2019-02-07T00:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512926",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_512927.json:
```json
{
    "body": "<a id='comment:13'></a>\nPresuming these are all correctly reviewed as either duplicate, invalid, or wontfix.",
    "created_at": "2019-02-26T13:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512927",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
Presuming these are all correctly reviewed as either duplicate, invalid, or wontfix.



---

archive/issue_comments_512928.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2019-02-26T13:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27018#issuecomment-512928",
    "user": "https://github.com/embray"
}
```

Resolution: invalid



---

archive/issue_events_083959.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-26T13:58:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27018",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27018#event-83959"
}
```
