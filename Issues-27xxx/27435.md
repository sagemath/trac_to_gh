# Issue 27435: py3: failing doctest in graph_database.py with interactive_query

archive/issues_027198.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage -t --long src/sage/graphs/graph_database.py\n**********************************************************************\nFile \"src/sage/graphs/graph_database.py\", line 1081, in sage.graphs.graph_database.GraphDatabase.interactive_query\nFailed example:\n    D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=5, max_degree=3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py\", line 1119, in getfullargspec\n        sigcls=Signature)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py\", line 2186, in _signature_from_callable\n        raise TypeError('{!r} is not a callable object'.format(obj))\n    TypeError: 0 is not a callable object\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_database.GraphDatabase.interactive_query[1]>\", line 1, in <module>\n        D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=Integer(5), max_degree=Integer(3))\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/graphs/graph_database.py\", line 1087, in interactive_query\n        interact(f)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/misc/decorators.py\", line 343, in my_wrap\n        return func(*args)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sagenb/notebook/interact.py\", line 2636, in interact\n        (args, varargs, varkw, defaults) = inspect.getargspec(f)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py\", line 1073, in getargspec\n        getfullargspec(func)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py\", line 1125, in getfullargspec\n        raise TypeError('unsupported callable') from ex\n    TypeError: unsupported callable\n\n```\n\nCC:  @dimpase @jdemeyer\n\nKeywords: **py3, graph**\n\nBranch/Commit: **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**\n\nAuthor: **Ewan Davies, David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27435_\n\n",
    "closed_at": "2019-07-20T09:10:54Z",
    "created_at": "2019-03-07T12:02:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: failing doctest in graph_database.py with interactive_query",
    "type": "issue",
    "updated_at": "2019-07-20T09:10:54Z",
    "url": "https://github.com/sagemath/sage/issues/27435",
    "user": "https://github.com/dcoudert"
}
```

```
sage -t --long src/sage/graphs/graph_database.py
**********************************************************************
File "src/sage/graphs/graph_database.py", line 1081, in sage.graphs.graph_database.GraphDatabase.interactive_query
Failed example:
    D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=5, max_degree=3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py", line 1119, in getfullargspec
        sigcls=Signature)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py", line 2186, in _signature_from_callable
        raise TypeError('{!r} is not a callable object'.format(obj))
    TypeError: 0 is not a callable object

    The above exception was the direct cause of the following exception:

    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_database.GraphDatabase.interactive_query[1]>", line 1, in <module>
        D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=Integer(5), max_degree=Integer(3))
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/graphs/graph_database.py", line 1087, in interactive_query
        interact(f)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sage/misc/decorators.py", line 343, in my_wrap
        return func(*args)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/site-packages/sagenb/notebook/interact.py", line 2636, in interact
        (args, varargs, varkw, defaults) = inspect.getargspec(f)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py", line 1073, in getargspec
        getfullargspec(func)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.6/inspect.py", line 1125, in getfullargspec
        raise TypeError('unsupported callable') from ex
    TypeError: unsupported callable

```

CC:  @dimpase @jdemeyer

Keywords: **py3, graph**

Branch/Commit: **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**

Reviewer: **Frédéric Chapoton, John Palmieri**

Author: **Ewan Davies, David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/27435_





---

archive/issue_events_376809.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-07T12:02:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376809"
}
```



---

archive/issue_events_376810.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-07T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376810"
}
```



---

archive/issue_events_376811.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-07T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376811"
}
```



---

archive/issue_events_376812.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-07T12:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376812"
}
```



---

archive/issue_comments_424613.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI don't know how to fix it.",
    "created_at": "2019-03-07T12:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424613",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1" align="right">comment:1</div>

I don't know how to fix it.



---

archive/issue_comments_424614.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHi, I am Piyush, I am new to sage, I was wondering if I could be of some help here.\n\nI am not able to replicate this test. Is there something that I am missing? I am using Ubuntu 16.04\n\n```\n$ ./sage -t --long src/sage/graphs/graph_database.py\nRunning doctests with ID 2019-03-08-11-03-04-40b4d48a.\nGit branch: develop\nUsing --optional=dochtml,memlimit,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long src/sage/graphs/graph_database.py\n    [50 tests, 0.49 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.6 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 0.5 seconds\n```",
    "created_at": "2019-03-08T11:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424614",
    "user": "https://github.com/sheldoncooper07"
}
```

<div id="comment:2" align="right">comment:2</div>

Hi, I am Piyush, I am new to sage, I was wondering if I could be of some help here.

I am not able to replicate this test. Is there something that I am missing? I am using Ubuntu 16.04

```
$ ./sage -t --long src/sage/graphs/graph_database.py
Running doctests with ID 2019-03-08-11-03-04-40b4d48a.
Git branch: develop
Using --optional=dochtml,memlimit,mpir,python2,sage
Doctesting 1 file.
sage -t --long src/sage/graphs/graph_database.py
    [50 tests, 0.49 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.6 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
```



---

archive/issue_comments_424615.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe problem is with Python 3. We are working hard on the transition from Python 2 to Python 3.",
    "created_at": "2019-03-08T11:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424615",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

The problem is with Python 3. We are working hard on the transition from Python 2 to Python 3.



---

archive/issue_events_376813.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376813"
}
```



---

archive/issue_events_376814.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376814"
}
```



---

archive/issue_comments_424616.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424616",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_424617.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI may have managed to fix this error. I don't know anything about the origins of the code but the error arises in in `graph_database._gen_interact_func` where it seems a string defining a function called `_` is run with `exec`.\n\nI tried changing the name of the function that gets defined and ran into a different python3-related bug in the `sagenb` python package (maintained out of the main sage tree): it still uses `xrange` in `sagenb.notebook.interact` at line 1185.\n\nI downloaded the source for that package, changed the uses of `xrange`, and now the doctest passes on my machine, but the bar for passing is simply emitting a string starting and finishing with `<html>` and `</html>`. \n\nI'm not sure what to suggest for this ticket, the doctest in question has something to do with the old sage notebook (sagenb). The function `interactive_query` returns some html that doesn't appear do anything in jupyter, and I can't use the old notebook on python3 (an error related to Twisted). Is the old notebook formally deprecated? See #22431 and in particular the 'side remark' about the graph database explorer.\n\nIf my changes to `_gen_interact_func` and the `sagenb` package are wanted I can send patches, but as I can't run the notebook myself on python3 I can't even verify that it's a proper fix.",
    "created_at": "2019-05-13T04:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424617",
    "user": "https://github.com/ed359"
}
```

<div id="comment:5" align="right">comment:5</div>

I may have managed to fix this error. I don't know anything about the origins of the code but the error arises in in `graph_database._gen_interact_func` where it seems a string defining a function called `_` is run with `exec`.

I tried changing the name of the function that gets defined and ran into a different python3-related bug in the `sagenb` python package (maintained out of the main sage tree): it still uses `xrange` in `sagenb.notebook.interact` at line 1185.

I downloaded the source for that package, changed the uses of `xrange`, and now the doctest passes on my machine, but the bar for passing is simply emitting a string starting and finishing with `<html>` and `</html>`. 

I'm not sure what to suggest for this ticket, the doctest in question has something to do with the old sage notebook (sagenb). The function `interactive_query` returns some html that doesn't appear do anything in jupyter, and I can't use the old notebook on python3 (an error related to Twisted). Is the old notebook formally deprecated? See #22431 and in particular the 'side remark' about the graph database explorer.

If my changes to `_gen_interact_func` and the `sagenb` package are wanted I can send patches, but as I can't run the notebook myself on python3 I can't even verify that it's a proper fix.



---

archive/issue_comments_424618.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nLet's ask the author of #22431 if anything was said about `graph_editor` and interactive queries in `graph_database`.\n\nAlso I don't know if these tools have users. If not, we may simply deprecate the parts involving `sagenb`. Otherwise, someone with enough knowledge in notebooks should try to solve the issues.",
    "created_at": "2019-05-13T06:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424618",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

Let's ask the author of #22431 if anything was said about `graph_editor` and interactive queries in `graph_database`.

Also I don't know if these tools have users. If not, we may simply deprecate the parts involving `sagenb`. Otherwise, someone with enough knowledge in notebooks should try to solve the issues.



---

archive/issue_comments_424619.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@ed359](#comment:5):\n> I may have managed to fix this error. I don't know anything about the origins of the code but the error arises in in `graph_database._gen_interact_func` where it seems a string defining a function called `_` is run with `exec`.\n> \n> I tried changing the name of the function that gets defined and ran into a different python3-related bug in the `sagenb` python package (maintained out of the main sage tree): it still uses `xrange` in `sagenb.notebook.interact` at line 1185.\n> \n> I downloaded the source for that package, changed the uses of `xrange`, and now the doctest passes on my machine, but the bar for passing is simply emitting a string starting and finishing with `<html>` and `</html>`. \n> \n> I'm not sure what to suggest for this ticket, the doctest in question has something to do with the old sage notebook (sagenb). The function `interactive_query` returns some html that doesn't appear do anything in jupyter, and I can't use the old notebook on python3 (an error related to Twisted). Is the old notebook formally deprecated? See #22431 and in particular the 'side remark' about the graph database explorer.\n> \n> If my changes to `_gen_interact_func` and the `sagenb` package are wanted I can send patches, but as I can't run the notebook myself on python3 I can't even verify that it's a proper fix.\n\nAs long as these changes don't break sagenb on python2, it is fine.\nPlease send a PR on https://github.com/sagemath/sagenb\n(perhaps they are already fixed in the 4 most recent open PRs there.)\n\nAs to functionality to be removed, I don't know.",
    "created_at": "2019-05-13T07:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424619",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@ed359](#comment:5):
> I may have managed to fix this error. I don't know anything about the origins of the code but the error arises in in `graph_database._gen_interact_func` where it seems a string defining a function called `_` is run with `exec`.
> 
> I tried changing the name of the function that gets defined and ran into a different python3-related bug in the `sagenb` python package (maintained out of the main sage tree): it still uses `xrange` in `sagenb.notebook.interact` at line 1185.
> 
> I downloaded the source for that package, changed the uses of `xrange`, and now the doctest passes on my machine, but the bar for passing is simply emitting a string starting and finishing with `<html>` and `</html>`. 
> 
> I'm not sure what to suggest for this ticket, the doctest in question has something to do with the old sage notebook (sagenb). The function `interactive_query` returns some html that doesn't appear do anything in jupyter, and I can't use the old notebook on python3 (an error related to Twisted). Is the old notebook formally deprecated? See #22431 and in particular the 'side remark' about the graph database explorer.
> 
> If my changes to `_gen_interact_func` and the `sagenb` package are wanted I can send patches, but as I can't run the notebook myself on python3 I can't even verify that it's a proper fix.

As long as these changes don't break sagenb on python2, it is fine.
Please send a PR on https://github.com/sagemath/sagenb
(perhaps they are already fixed in the 4 most recent open PRs there.)

As to functionality to be removed, I don't know.



---

archive/issue_comments_424620.json:
```json
{
    "body": "Branch: **[u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query)**",
    "created_at": "2019-05-13T18:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424620",
    "user": "https://github.com/ed359"
}
```

Branch: **[u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query)**



---

archive/issue_comments_424621.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks.  We may need to think about how to deal with this in the eventual removal of sagenb, as the interact should in principle still be able to work in e.g. Jupyter notebooks, but would have to import from elsewhere.  Cc:ing Jeroen as he knows a lot about how that is implemented in Jupyter and where things might need to import from now.\n  \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367\">2d05ce8</a></td><td><code>graph_database.py: fix doctest on python3</code></td></tr></table>\n",
    "created_at": "2019-05-13T18:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424621",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks.  We may need to think about how to deal with this in the eventual removal of sagenb, as the interact should in principle still be able to work in e.g. Jupyter notebooks, but would have to import from elsewhere.  Cc:ing Jeroen as he knows a lot about how that is implemented in Jupyter and where things might need to import from now.
  
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367">2d05ce8</a></td><td><code>graph_database.py: fix doctest on python3</code></td></tr></table>




---

archive/issue_comments_424622.json:
```json
{
    "body": "Commit: **[`2d05ce8`](https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367)**",
    "created_at": "2019-05-13T18:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424622",
    "user": "https://github.com/kcrisman"
}
```

Commit: **[`2d05ce8`](https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367)**



---

archive/issue_comments_424623.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nNow the error is in sagenb (tested over 8.8.beta6).\n\n```\nsage -t --long src/sage/graphs/graph_database.py\n**********************************************************************\nFile \"src/sage/graphs/graph_database.py\", line 1082, in sage.graphs.graph_database.GraphDatabase.interactive_query\nFailed example:\n    D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=5, max_degree=3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_database.GraphDatabase.interactive_query[1]>\", line 1, in <module>\n        D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=Integer(5), max_degree=Integer(3))\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_database.py\", line 1088, in interactive_query\n        interact(f)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/misc/decorators.py\", line 343, in my_wrap\n        return func(*args)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py\", line 2643, in interact\n        for i, arg in enumerate(args)]\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py\", line 2643, in <listcomp>\n        for i, arg in enumerate(args)]\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py\", line 3093, in render\n        to_value=self.__to_value, width=self.__width)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py\", line 1185, in __init__\n        default_value = [[default_value[i * columns + j] for j in xrange(columns)] for i in xrange(rows)]\n    NameError: name 'xrange' is not defined\n**********************************************************************\n```",
    "created_at": "2019-05-30T15:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424623",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Now the error is in sagenb (tested over 8.8.beta6).

```
sage -t --long src/sage/graphs/graph_database.py
**********************************************************************
File "src/sage/graphs/graph_database.py", line 1082, in sage.graphs.graph_database.GraphDatabase.interactive_query
Failed example:
    D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=5, max_degree=3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_database.GraphDatabase.interactive_query[1]>", line 1, in <module>
        D.interactive_query(display_cols=['graph6', 'num_vertices', 'degree_sequence'], num_edges=Integer(5), max_degree=Integer(3))
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_database.py", line 1088, in interactive_query
        interact(f)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/misc/decorators.py", line 343, in my_wrap
        return func(*args)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py", line 2643, in interact
        for i, arg in enumerate(args)]
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py", line 2643, in <listcomp>
        for i, arg in enumerate(args)]
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py", line 3093, in render
        to_value=self.__to_value, width=self.__width)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sagenb/notebook/interact.py", line 1185, in __init__
        default_value = [[default_value[i * columns + j] for j in xrange(columns)] for i in xrange(rows)]
    NameError: name 'xrange' is not defined
**********************************************************************
```



---

archive/issue_events_376815.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376815"
}
```



---

archive/issue_comments_424624.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424624",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_376816.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-06-15T08:42:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376816"
}
```



---

archive/issue_comments_424625.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIf the problem is with sagenb, then can we mark the doctest as \"# py2\", since my understanding is that sagenb is not compatible with Python 3? That is, keep the proposed changes here, but also tag the doctest as py2 only.",
    "created_at": "2019-07-10T18:52:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424625",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

If the problem is with sagenb, then can we mark the doctest as "# py2", since my understanding is that sagenb is not compatible with Python 3? That is, keep the proposed changes here, but also tag the doctest as py2 only.



---

archive/issue_comments_424626.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\ncan't we just skip installing sagenb on Python3?",
    "created_at": "2019-07-10T19:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424626",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

can't we just skip installing sagenb on Python3?



---

archive/issue_comments_424627.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI think that sagenb as a whole does not work with Python 3, but parts of it do, and parts are imported into the Sage library in various places. If we don't install it, some things may break. Some of the imports:\n\n```\nsrc/sage/graphs/graph_editor.py:    import sagenb.notebook.interact\nsrc/sage/interacts/library.py:        import sagenb.notebook.interact\nsrc/sage/interacts/debugger.py:        from sagenb.notebook.interact import slider, input_box, selector\n```",
    "created_at": "2019-07-10T19:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424627",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

I think that sagenb as a whole does not work with Python 3, but parts of it do, and parts are imported into the Sage library in various places. If we don't install it, some things may break. Some of the imports:

```
src/sage/graphs/graph_editor.py:    import sagenb.notebook.interact
src/sage/interacts/library.py:        import sagenb.notebook.interact
src/sage/interacts/debugger.py:        from sagenb.notebook.interact import slider, input_box, selector
```



---

archive/issue_comments_424628.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI agree with the proposal of marking this doctest as `# py2`, but we should also add that there is known issue with py3, no ? This way, we don't await for a decision about sagenb.",
    "created_at": "2019-07-10T20:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424628",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

I agree with the proposal of marking this doctest as `# py2`, but we should also add that there is known issue with py3, no ? This way, we don't await for a decision about sagenb.



---

archive/issue_comments_424629.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI added proposed modification and pushed the code to a new branch in public. Feel free to modify it if needed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5074f90df3c11fe1415a7235cf8ebf1c58ecdbf\">d5074f9</a></td><td><code>trac #27435: Merged with 8.9.beta2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70\">10fd0e8</a></td><td><code>trac #27435: mark doctest as py2 only and add warning block</code></td></tr></table>\n",
    "created_at": "2019-07-11T09:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424629",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:17" align="right">comment:17</div>

I added proposed modification and pushed the code to a new branch in public. Feel free to modify it if needed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5074f90df3c11fe1415a7235cf8ebf1c58ecdbf">d5074f9</a></td><td><code>trac #27435: Merged with 8.9.beta2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70">10fd0e8</a></td><td><code>trac #27435: mark doctest as py2 only and add warning block</code></td></tr></table>




---

archive/issue_comments_424630.json:
```json
{
    "body": "Author: **Ewan Davies, David Coudert**",
    "created_at": "2019-07-11T09:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424630",
    "user": "https://github.com/dcoudert"
}
```

Author: **Ewan Davies, David Coudert**



---

archive/issue_events_376817.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-07-11T09:44:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376817"
}
```



---

archive/issue_comments_424631.json:
```json
{
    "body": "Changed branch from **[u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query)** to **[public/graphs/27435_doctest_in_graph_database](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27435_doctest_in_graph_database)**",
    "created_at": "2019-07-11T09:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424631",
    "user": "https://github.com/dcoudert"
}
```

Changed branch from **[u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ed359/py3__failing_doctest_in_graph_database_py_with_interactive_query)** to **[public/graphs/27435_doctest_in_graph_database](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27435_doctest_in_graph_database)**



---

archive/issue_comments_424632.json:
```json
{
    "body": "Changed commit from **[`2d05ce8`](https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367)** to **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**",
    "created_at": "2019-07-11T09:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424632",
    "user": "https://github.com/dcoudert"
}
```

Changed commit from **[`2d05ce8`](https://github.com/sagemath/sagetrac-mirror/commit/2d05ce8822d9fd403ccd56dbffa90db9f1285367)** to **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**



---

archive/issue_comments_424633.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is fine with me. Anyone else have any comments? Objections to setting to positive review?",
    "created_at": "2019-07-17T21:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424633",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

This is fine with me. Anyone else have any comments? Objections to setting to positive review?



---

archive/issue_comments_424634.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**",
    "created_at": "2019-07-18T07:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424634",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton, John Palmieri**



---

archive/issue_comments_424635.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nok..",
    "created_at": "2019-07-18T07:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424635",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

ok..



---

archive/issue_events_376818.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-18T07:14:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376818"
}
```



---

archive/issue_events_376819.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-18T07:14:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376819"
}
```



---

archive/issue_comments_424636.json:
```json
{
    "body": "Changed branch from **[public/graphs/27435_doctest_in_graph_database](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27435_doctest_in_graph_database)** to **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**",
    "created_at": "2019-07-20T09:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27435#issuecomment-424636",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/27435_doctest_in_graph_database](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27435_doctest_in_graph_database)** to **[`10fd0e8`](https://github.com/sagemath/sagetrac-mirror/commit/10fd0e835c2a89f5e89b283c691d7a10abb99a70)**



---

archive/issue_events_376820.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-20T09:10:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376820"
}
```



---

archive/issue_events_376821.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f20bcce4493e7201b2dac716a58c7447a42269d5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-07-20T09:10:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27435",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27435#event-376821"
}
```
