# Issue 27443: spring cleanup for QQbar

archive/issues_027206.json:
```json
{
    "assignees": [],
    "body": "removing one deprecated class (after #19954)\n\nalso fix most of the pep8 warnings\n\nplus a few minor code improvements\n\nCC:  @tscrim\n\nBranch/Commit: **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27443_\n\n",
    "closed_at": "2019-03-11T22:39:55Z",
    "created_at": "2019-03-08T07:59:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spring cleanup for QQbar",
    "type": "issue",
    "updated_at": "2019-03-11T22:39:55Z",
    "url": "https://github.com/sagemath/sage/issues/27443",
    "user": "https://github.com/fchapoton"
}
```
removing one deprecated class (after #19954)

also fix most of the pep8 warnings

plus a few minor code improvements

CC:  @tscrim

Branch/Commit: **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**

Reviewer: **Travis Scrimshaw**

Author: **Frédéric Chapoton**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/27443_





---

archive/issue_events_373960.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-08T07:59:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373960"
}
```



---

archive/issue_events_373961.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-08T07:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373961"
}
```



---

archive/issue_events_373962.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-08T07:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373962"
}
```



---

archive/issue_events_373963.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-08T07:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373963"
}
```



---

archive/issue_events_373964.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-08T08:00:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373964"
}
```



---

archive/issue_comments_424576.json:
```json
{
    "body": "Branch: **[u/chapoton/27443](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27443)**",
    "created_at": "2019-03-08T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424576",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/27443](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27443)**



---

archive/issue_comments_424577.json:
```json
{
    "body": "Commit: **[`1303a1d`](https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383)**",
    "created_at": "2019-03-08T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424577",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`1303a1d`](https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383)**



---

archive/issue_comments_424578.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383\"><code>1303a1d</code></a></td><td><code>spring cleanup of QQbar (pep8, removing deprecated stuff)</code></td></tr></table>\n",
    "created_at": "2019-03-08T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424578",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383"><code>1303a1d</code></a></td><td><code>spring cleanup of QQbar (pep8, removing deprecated stuff)</code></td></tr></table>




---

archive/issue_comments_424579.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\ngreen bot, please review",
    "created_at": "2019-03-08T10:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424579",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

green bot, please review



---

archive/issue_comments_424580.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI do not understand the `extras=None` change. I think it is fine to have an optional parameter that has a default value as optional is a way to convey a little more context/information to the user (rather than saying it is a default value). If there is something that is passing `None`, then I feel that should be changed.",
    "created_at": "2019-03-08T23:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424580",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

I do not understand the `extras=None` change. I think it is fine to have an optional parameter that has a default value as optional is a way to convey a little more context/information to the user (rather than saying it is a default value). If there is something that is passing `None`, then I feel that should be changed.



---

archive/issue_comments_424581.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe reason is the following (as explained by lgtm):\n\nWhen a parameter default value is a dictionary, it is stored in the function definition, and any modification of this dictionary is acting on (changing) this stored default. So the next call of the function will use the modified default. Which is not the expected effect.",
    "created_at": "2019-03-09T07:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424581",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

The reason is the following (as explained by lgtm):

When a parameter default value is a dictionary, it is stored in the function definition, and any modification of this dictionary is acting on (changing) this stored default. So the next call of the function will use the modified default. Which is not the expected effect.



---

archive/issue_comments_424582.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI was not aware of that, but it makes sense that things were designed that way. That sure can lead to subtle bugs.\n\n```\nsage: def foo(x, d={}):\n....:     d[x] = 1\n....:     return d\n....: \nsage: x = foo(5)\nsage: x\n{5: 1}\nsage: x[10] = 10\nsage: foo(0)\n{0: 1, 5: 1, 10: 10}\n```\n\nHowever, in these cases the `dict` is only expanded and never changed. So I don't see the point of making the code more complex to silence a warning:\n\n```\nsage: def bar(**opts):\n....:     opts[1] = 5\n....:     \nsage: def foo(d={}):\n....:     bar(**d)\n....:     return d\n....: \nsage: foo()\n{}\nsage: foo()\n{}\n```",
    "created_at": "2019-03-09T08:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424582",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I was not aware of that, but it makes sense that things were designed that way. That sure can lead to subtle bugs.

```
sage: def foo(x, d={}):
....:     d[x] = 1
....:     return d
....: 
sage: x = foo(5)
sage: x
{5: 1}
sage: x[10] = 10
sage: foo(0)
{0: 1, 5: 1, 10: 10}
```

However, in these cases the `dict` is only expanded and never changed. So I don't see the point of making the code more complex to silence a warning:

```
sage: def bar(**opts):
....:     opts[1] = 5
....:     
sage: def foo(d={}):
....:     bar(**d)
....:     return d
....: 
sage: foo()
{}
sage: foo()
{}
```



---

archive/issue_comments_424583.json:
```json
{
    "body": "Changed commit from **[`1303a1d`](https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383)** to **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**",
    "created_at": "2019-03-09T12:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424583",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1303a1d`](https://github.com/sagemath/sagetrac-mirror/commit/1303a1ddf1f064c95b8072791e28677496a12383)** to **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**



---

archive/issue_comments_424584.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289\"><code>d24560a</code></a></td><td><code>trac 27443 change-back the extras parameter of completions in QQbar</code></td></tr></table>\n",
    "created_at": "2019-03-09T12:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424584",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289"><code>d24560a</code></a></td><td><code>trac 27443 change-back the extras parameter of completions in QQbar</code></td></tr></table>




---

archive/issue_comments_424585.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\ndone, back to `{}`",
    "created_at": "2019-03-09T12:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424585",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

done, back to `{}`



---

archive/issue_events_373965.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-09T12:51:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373965"
}
```



---

archive/issue_events_373966.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-09T12:51:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373966"
}
```



---

archive/issue_comments_424586.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-03-09T12:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424586",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_424587.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThank you. LGTM.",
    "created_at": "2019-03-09T12:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424587",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Thank you. LGTM.



---

archive/issue_events_373967.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-11T22:39:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373967"
}
```



---

archive/issue_events_373968.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "76b7b821ac04004f7d20b248be77d8878473fc84",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-11T22:39:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27443#event-373968"
}
```



---

archive/issue_comments_424588.json:
```json
{
    "body": "Changed branch from **[u/chapoton/27443](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27443)** to **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**",
    "created_at": "2019-03-11T22:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27443#issuecomment-424588",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/27443](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27443)** to **[`d24560a`](https://github.com/sagemath/sagetrac-mirror/commit/d24560a7d16fbc8022db6b9d3543ccd8beb50289)**
