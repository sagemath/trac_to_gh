# Issue 27443: spring cleanup for QQbar

archive/issues_027206.json:
```json
{
    "body": "removing one deprecated class (after #19954)\n\nalso fix most of the pep8 warnings\n\nplus a few minor code improvements\n\nCC:  @tscrim\n\nBranch/Commit: d24560a7d16fbc8022db6b9d3543ccd8beb50289\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27443\n\n",
    "closed_at": "2019-03-11T22:39:55Z",
    "created_at": "2019-03-08T07:59:32Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "spring cleanup for QQbar",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27443",
    "user": "https://github.com/fchapoton"
}
```
removing one deprecated class (after #19954)

also fix most of the pep8 warnings

plus a few minor code improvements

CC:  @tscrim

Branch/Commit: d24560a7d16fbc8022db6b9d3543ccd8beb50289

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27443





---

archive/issue_comments_529168.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-08T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529168",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_529169.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/27443\"",
    "created_at": "2019-03-08T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529169",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/27443"



---

archive/issue_comments_529170.json:
```json
{
    "body": "Changing commit from \"\" to \"1303a1ddf1f064c95b8072791e28677496a12383\"",
    "created_at": "2019-03-08T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529170",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "1303a1ddf1f064c95b8072791e28677496a12383"



---

archive/issue_comments_529171.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[1303a1d](https://git.sagemath.org/sage.git/commit?id=1303a1ddf1f064c95b8072791e28677496a12383)|`spring cleanup of QQbar (pep8, removing deprecated stuff)`|",
    "created_at": "2019-03-08T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529171",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[1303a1d](https://git.sagemath.org/sage.git/commit?id=1303a1ddf1f064c95b8072791e28677496a12383)|`spring cleanup of QQbar (pep8, removing deprecated stuff)`|



---

archive/issue_comments_529172.json:
```json
{
    "body": "<a id='comment:2'></a>\ngreen bot, please review",
    "created_at": "2019-03-08T10:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529172",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
green bot, please review



---

archive/issue_comments_529173.json:
```json
{
    "body": "<a id='comment:3'></a>\nI do not understand the `extras=None` change. I think it is fine to have an optional parameter that has a default value as optional is a way to convey a little more context/information to the user (rather than saying it is a default value). If there is something that is passing `None`, then I feel that should be changed.",
    "created_at": "2019-03-08T23:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529173",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
I do not understand the `extras=None` change. I think it is fine to have an optional parameter that has a default value as optional is a way to convey a little more context/information to the user (rather than saying it is a default value). If there is something that is passing `None`, then I feel that should be changed.



---

archive/issue_comments_529174.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe reason is the following (as explained by lgtm):\n\nWhen a parameter default value is a dictionary, it is stored in the function definition, and any modification of this dictionary is acting on (changing) this stored default. So the next call of the function will use the modified default. Which is not the expected effect.",
    "created_at": "2019-03-09T07:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529174",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
The reason is the following (as explained by lgtm):

When a parameter default value is a dictionary, it is stored in the function definition, and any modification of this dictionary is acting on (changing) this stored default. So the next call of the function will use the modified default. Which is not the expected effect.



---

archive/issue_comments_529175.json:
```json
{
    "body": "<a id='comment:5'></a>\nI was not aware of that, but it makes sense that things were designed that way. That sure can lead to subtle bugs.\n\n```\nsage: def foo(x, d={}):\n....:     d[x] = 1\n....:     return d\n....: \nsage: x = foo(5)\nsage: x\n{5: 1}\nsage: x[10] = 10\nsage: foo(0)\n{0: 1, 5: 1, 10: 10}\n```\n\nHowever, in these cases the `dict` is only expanded and never changed. So I don't see the point of making the code more complex to silence a warning:\n\n```\nsage: def bar(**opts):\n....:     opts[1] = 5\n....:     \nsage: def foo(d={}):\n....:     bar(**d)\n....:     return d\n....: \nsage: foo()\n{}\nsage: foo()\n{}\n```",
    "created_at": "2019-03-09T08:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529175",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I was not aware of that, but it makes sense that things were designed that way. That sure can lead to subtle bugs.

```
sage: def foo(x, d={}):
....:     d[x] = 1
....:     return d
....: 
sage: x = foo(5)
sage: x
{5: 1}
sage: x[10] = 10
sage: foo(0)
{0: 1, 5: 1, 10: 10}
```

However, in these cases the `dict` is only expanded and never changed. So I don't see the point of making the code more complex to silence a warning:

```
sage: def bar(**opts):
....:     opts[1] = 5
....:     
sage: def foo(d={}):
....:     bar(**d)
....:     return d
....: 
sage: foo()
{}
sage: foo()
{}
```



---

archive/issue_comments_529176.json:
```json
{
    "body": "Changing commit from \"1303a1ddf1f064c95b8072791e28677496a12383\" to \"d24560a7d16fbc8022db6b9d3543ccd8beb50289\"",
    "created_at": "2019-03-09T12:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1303a1ddf1f064c95b8072791e28677496a12383" to "d24560a7d16fbc8022db6b9d3543ccd8beb50289"



---

archive/issue_comments_529177.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[d24560a](https://git.sagemath.org/sage.git/commit/?id=d24560a7d16fbc8022db6b9d3543ccd8beb50289)|`trac 27443 change-back the extras parameter of completions in QQbar`|",
    "created_at": "2019-03-09T12:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[d24560a](https://git.sagemath.org/sage.git/commit/?id=d24560a7d16fbc8022db6b9d3543ccd8beb50289)|`trac 27443 change-back the extras parameter of completions in QQbar`|



---

archive/issue_comments_529178.json:
```json
{
    "body": "<a id='comment:7'></a>\ndone, back to `{}`",
    "created_at": "2019-03-09T12:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529178",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
done, back to `{}`



---

archive/issue_comments_529179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-09T12:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529179",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_529180.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2019-03-09T12:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529180",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_529181.json:
```json
{
    "body": "<a id='comment:8'></a>\nThank you. LGTM.",
    "created_at": "2019-03-09T12:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529181",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Thank you. LGTM.



---

archive/issue_events_068153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-11T22:39:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27443#event-68153"
}
```



---

archive/issue_comments_529182.json:
```json
{
    "body": "Changing branch from \"u/chapoton/27443\" to \"d24560a7d16fbc8022db6b9d3543ccd8beb50289\"",
    "created_at": "2019-03-11T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529182",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/27443" to "d24560a7d16fbc8022db6b9d3543ccd8beb50289"



---

archive/issue_comments_529183.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-11T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27443#issuecomment-529183",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
