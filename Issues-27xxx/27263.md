# Issue 27263: Upgrade to giac 1.5 fails to build with older libstdc++

archive/issues_027026.json:
```json
{
    "body": "#26315 broke building giac on some systems that have a old-ish libstdc++.  It is completely mysterious to me *why* this broke when it worked before, and without a repository it's very difficult to determine what change between the versions is responsible, as there is little difference between the two versions in the relevant code.\n\nNevertheless, it can be fixed by explicitly using `std::isnan` and `std::isinf` so that there is no risk of them conflicting with the libc math.h equivalents thereof.\n\n**CC:**  @dimpase @frederichan-IMJPRG parisse @slel\n\n**Branch:** [2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)\n\n**Upstream:** Not yet reported upstream; Will do shortly.\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/27263\n\n",
    "closed_at": "2019-02-14T19:45:44Z",
    "created_at": "2019-02-12T15:59:19Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "title": "Upgrade to giac 1.5 fails to build with older libstdc++",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/27263",
    "user": "https://github.com/embray"
}
```
#26315 broke building giac on some systems that have a old-ish libstdc++.  It is completely mysterious to me *why* this broke when it worked before, and without a repository it's very difficult to determine what change between the versions is responsible, as there is little difference between the two versions in the relevant code.

Nevertheless, it can be fixed by explicitly using `std::isnan` and `std::isinf` so that there is no risk of them conflicting with the libc math.h equivalents thereof.

**CC:**  @dimpase @frederichan-IMJPRG parisse @slel

**Branch:** [2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)

**Upstream:** Not yet reported upstream; Will do shortly.

**Reviewer:** Dima Pasechnik

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/27263





---

archive/issue_comments_423864.json:
```json
{
    "body": "<a id='comment:1'></a>\nAlso I have no idea what the `FIR_LINUX` macro here means.  There is no documentation mentioning it and it is not defined anywhere.",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423864",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
Also I have no idea what the `FIR_LINUX` macro here means.  There is no documentation mentioning it and it is not defined anywhere.



---

archive/issue_comments_423865.json:
```json
{
    "body": "**Commit:** [832b97cd5d71f0d3acd8abbe87fbc4205eb96491](https://github.com/sagemath/sagetrac-mirror/commit/832b97cd5d71f0d3acd8abbe87fbc4205eb96491)",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423865",
    "user": "https://github.com/embray"
}
```

**Commit:** [832b97cd5d71f0d3acd8abbe87fbc4205eb96491](https://github.com/sagemath/sagetrac-mirror/commit/832b97cd5d71f0d3acd8abbe87fbc4205eb96491)



---

archive/issue_comments_423866.json:
```json
{
    "body": "**Branch:** [u/embray/build/giac/isnan-isinf-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/giac/isnan-isinf-bug)",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423866",
    "user": "https://github.com/embray"
}
```

**Branch:** [u/embray/build/giac/isnan-isinf-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/giac/isnan-isinf-bug)



---

archive/issue_comments_423867.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2019-02-12T16:02:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423867",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_events_240760.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T16:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240760"
}
```



---

archive/issue_events_240761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-12T16:05:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240761"
}
```



---

archive/issue_events_240762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-12T16:05:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240762"
}
```



---

archive/issue_comments_423868.json:
```json
{
    "body": "<a id='comment:2'></a>\nBad branch?",
    "created_at": "2019-02-12T16:05:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423868",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Bad branch?



---

archive/issue_comments_423869.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis might also have been caused by #26787.",
    "created_at": "2019-02-12T16:05:56Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423869",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
This might also have been caused by #26787.



---

archive/issue_comments_423870.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26\">2651e20</a></td><td><code>Trac #27263: Added patch which fixes this issue in GIAC</code></td></tr></table>\n",
    "created_at": "2019-02-12T16:47:13Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26">2651e20</a></td><td><code>Trac #27263: Added patch which fixes this issue in GIAC</code></td></tr></table>




---

archive/issue_comments_423871.json:
```json
{
    "body": "**Changing commit** from \"[832b97cd5d71f0d3acd8abbe87fbc4205eb96491](https://github.com/sagemath/sagetrac-mirror/commit/832b97cd5d71f0d3acd8abbe87fbc4205eb96491)\" to \"[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)\".",
    "created_at": "2019-02-12T16:47:13Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[832b97cd5d71f0d3acd8abbe87fbc4205eb96491](https://github.com/sagemath/sagetrac-mirror/commit/832b97cd5d71f0d3acd8abbe87fbc4205eb96491)" to "[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)".



---

archive/issue_comments_423872.json:
```json
{
    "body": "**Upstream:** Not yet reported upstream; Will do shortly.",
    "created_at": "2019-02-12T16:47:52Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423872",
    "user": "https://github.com/embray"
}
```

**Upstream:** Not yet reported upstream; Will do shortly.



---

archive/issue_comments_423873.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jdemeyer](#comment%3A3):\n> This might also have been caused by #26787.\n\n\nAccording to my research this occurs with or without `-std=c++11` but I haven't explicitly tested that.\n\nI will also try to bring it up upstream in case there is *any* idea.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26\">2651e20</a></td><td><code>Trac #27263: Added patch which fixes this issue in GIAC</code></td></tr></table>\n",
    "created_at": "2019-02-12T16:47:52Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423873",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Replying to [jdemeyer](#comment%3A3):
> This might also have been caused by #26787.


According to my research this occurs with or without `-std=c++11` but I haven't explicitly tested that.

I will also try to bring it up upstream in case there is *any* idea.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26">2651e20</a></td><td><code>Trac #27263: Added patch which fixes this issue in GIAC</code></td></tr></table>




---

archive/issue_events_240763.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T16:47:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240763"
}
```



---

archive/issue_events_240764.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T16:47:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240764"
}
```



---

archive/issue_comments_423874.json:
```json
{
    "body": "<a id='comment:7'></a>\nI still don't fully understand what #26787 does though so it's possible.",
    "created_at": "2019-02-12T17:02:50Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423874",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
I still don't fully understand what #26787 does though so it's possible.



---

archive/issue_comments_423875.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay, confirmed that it is #26787 after all.  If I just put `unset CXX` in the spkg-install for giac it builds.  Something like that might be better than patching...",
    "created_at": "2019-02-12T17:18:31Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423875",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Okay, confirmed that it is #26787 after all.  If I just put `unset CXX` in the spkg-install for giac it builds.  Something like that might be better than patching...



---

archive/issue_comments_423876.json:
```json
{
    "body": "<a id='comment:9'></a>\nRight now in `sage-env-config` I have\n\n```\nexport CONFIGURED_CXX=\"g++ -std=gnu++11 -std=gnu++11\"\n```\n\nI don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.  Perhaps this older gcc is not fully c++11-compatible?\n\nIn any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?",
    "created_at": "2019-02-12T17:21:14Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423876",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Right now in `sage-env-config` I have

```
export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
```

I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.  Perhaps this older gcc is not fully c++11-compatible?

In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?



---

archive/issue_comments_423877.json:
```json
{
    "body": "<a id='comment:10'></a>\nWhy not just apply the patch? I'd rather not mess with environment variables.",
    "created_at": "2019-02-12T17:22:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423877",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Why not just apply the patch? I'd rather not mess with environment variables.



---

archive/issue_comments_423878.json:
```json
{
    "body": "<a id='comment:11'></a>\nI guess, I don't really know what impact the patch has on other systems. But it does seem clear to me: Just explicitly use the `isnan` in the `std` namespace.  I assume there's no reason that should go wrong...",
    "created_at": "2019-02-12T17:32:46Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423878",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
I guess, I don't really know what impact the patch has on other systems. But it does seem clear to me: Just explicitly use the `isnan` in the `std` namespace.  I assume there's no reason that should go wrong...



---

archive/issue_comments_423879.json:
```json
{
    "body": "<a id='comment:12'></a>\nLGTM",
    "created_at": "2019-02-12T18:23:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423879",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
LGTM



---

archive/issue_comments_423880.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2019-02-12T18:23:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423880",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_240765.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-12T18:23:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240765"
}
```



---

archive/issue_events_240766.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-12T18:23:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240766"
}
```



---

archive/issue_comments_423881.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think you should bump the `giac` patchlevel such that this upgrade is actually tested.",
    "created_at": "2019-02-12T18:33:15Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423881",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
I think you should bump the `giac` patchlevel such that this upgrade is actually tested.



---

archive/issue_comments_423882.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [embray](#comment%3A9):\n> Right now in `sage-env-config` I have\n> \n> ```\n> export CONFIGURED_CXX=\"g++ -std=gnu++11 -std=gnu++11\"\n> ```\n> \n\n\nThe only way I think you can end up with that is for `CXX` to be `g++ -std=gnu++11` at configuration time. The macro will then happily add another one because it is fairly stupid.\n\n> I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.\n\n\nDon't think so but I am a C++ bigwig.\n\n>  Perhaps this older gcc is not fully c++11-compatible?\n\n>\n\nMost certainly. Before gcc-5 C++11 support was experimental and the implementation was not fixed in stone.\n \n> In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?\n\n\nI'd rather have that little patch here.",
    "created_at": "2019-02-13T01:45:06Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423882",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Replying to [embray](#comment%3A9):
> Right now in `sage-env-config` I have
> 
> ```
> export CONFIGURED_CXX="g++ -std=gnu++11 -std=gnu++11"
> ```
> 


The only way I think you can end up with that is for `CXX` to be `g++ -std=gnu++11` at configuration time. The macro will then happily add another one because it is fairly stupid.

> I don't know why the `-std=gnu++11` is repeated.  Conceivably it might also matter that it's `gnu++11` and not `c++11`.


Don't think so but I am a C++ bigwig.

>  Perhaps this older gcc is not fully c++11-compatible?

>

Most certainly. Before gcc-5 C++11 support was experimental and the implementation was not fixed in stone.
 
> In any case, what would be the best approach here, do you think?  Would it be reasonable to just `unset CXX` in the `spkg-install`?


I'd rather have that little patch here.



---

archive/issue_comments_423883.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A13):\n> I think you should bump the `giac` patchlevel such that this upgrade is actually tested.\n\n\nIn theory yes, but this only matters for systems that otherwise simply cannot built giac, so you don't need to do this bumping for all practical purposes.",
    "created_at": "2019-02-13T08:17:23Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A13):
> I think you should bump the `giac` patchlevel such that this upgrade is actually tested.


In theory yes, but this only matters for systems that otherwise simply cannot built giac, so you don't need to do this bumping for all practical purposes.



---

archive/issue_comments_423884.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/build/giac/isnan-isinf-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/giac/isnan-isinf-bug)\" to \"[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)\".",
    "created_at": "2019-02-14T19:45:44Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423884",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/build/giac/isnan-isinf-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/giac/isnan-isinf-bug)" to "[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)".



---

archive/issue_events_240767.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-14T19:45:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240767"
}
```



---

archive/issue_events_240768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6772ac9c7813e75c7320218bd00bd7ecd1c54e94",
    "created_at": "2019-02-14T19:45:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27263#event-240768"
}
```



---

archive/issue_comments_423885.json:
```json
{
    "body": "**Changing commit** from \"[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)\" to \"\".",
    "created_at": "2019-02-15T03:20:19Z",
    "issue": "https://github.com/sagemath/sage/issues/27263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27263#issuecomment-423885",
    "user": "https://github.com/slel"
}
```

**Changing commit** from "[2651e2029ae308c9ec0da72bcb7bd2d1ff981d26](https://github.com/sagemath/sagetrac-mirror/commit/2651e2029ae308c9ec0da72bcb7bd2d1ff981d26)" to "".
