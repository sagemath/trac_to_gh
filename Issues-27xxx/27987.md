# Issue 27987: CombinatorialPolyhedron improve initialization, remove bug for unbounded polyhedra

archive/issues_027750.json:
```json
{
    "body": "`CombinatorialPolyhedron` as of #26887 only requires the number of lines (as `n_lines` in `Polyhedron_base`). This does not suffice, as\n\n```\nsage: P1 = Polyhedron(vertices=[[0,1],[1,0]], rays=[[1,1]])\nsage: P2 = Polyhedron(vertices=[[0,1],[1,0],[1,1]])\nsage: P1.incidence_matrix() == P2.incidence_matrix()\nTrue\n```\n\nInstead of just specifying the `n_lines`, one should specify `unbounded` and a far face.\n\nUnfortunately, determining the rays from just the incidence matrix does not seem to work.\n\nNow with the far face at hand anyway, it's much easier to determine the (combinatorial) vertices.\n\nCC:  @jplab @tscrim @videlec\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jonathan Kliem\n\nBranch: 806a217944c9332ec3e09f153cbd589075d0fa0f\n\nCommit: 806a217944c9332ec3e09f153cbd589075d0fa0f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27987\n\n",
    "closed_at": "2019-07-29T21:54:58Z",
    "created_at": "2019-06-14T06:50:42Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "CombinatorialPolyhedron improve initialization, remove bug for unbounded polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27987",
    "user": "https://github.com/kliem"
}
```
`CombinatorialPolyhedron` as of #26887 only requires the number of lines (as `n_lines` in `Polyhedron_base`). This does not suffice, as

```
sage: P1 = Polyhedron(vertices=[[0,1],[1,0]], rays=[[1,1]])
sage: P2 = Polyhedron(vertices=[[0,1],[1,0],[1,1]])
sage: P1.incidence_matrix() == P2.incidence_matrix()
True
```

Instead of just specifying the `n_lines`, one should specify `unbounded` and a far face.

Unfortunately, determining the rays from just the incidence matrix does not seem to work.

Now with the far face at hand anyway, it's much easier to determine the (combinatorial) vertices.

CC:  @jplab @tscrim @videlec

Reviewer: Travis Scrimshaw

Author: Jonathan Kliem

Branch: 806a217944c9332ec3e09f153cbd589075d0fa0f

Commit: 806a217944c9332ec3e09f153cbd589075d0fa0f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27987





---

archive/issue_comments_391620.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2019-06-14T13:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391620",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_391621.json:
```json
{
    "body": "<a id='comment:3'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391621",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_069357.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-07-01T13:47:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27987#event-69357"
}
```



---

archive/issue_comments_391622.json:
```json
{
    "body": "<a id='comment:5'></a>There is also a python3 failing doctest:\n\nThis triggers a new failing doctest with python3-sage:\n\n```\nsage -t --long src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 937, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.edge_graph\nFailed example:\n    G.degree()\nExpected:\n    [4, 3, 4, 3, 4]\nGot:\n    [3, 4, 4, 3, 4]\n```",
    "created_at": "2019-07-10T09:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391622",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>There is also a python3 failing doctest:

This triggers a new failing doctest with python3-sage:

```
sage -t --long src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 937, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.edge_graph
Failed example:
    G.degree()
Expected:
    [4, 3, 4, 3, 4]
Got:
    [3, 4, 4, 3, 4]
```



---

archive/issue_comments_391623.json:
```json
{
    "body": "<a id='comment:6'></a>I have made #28153 for the py3 problem, please review.",
    "created_at": "2019-07-10T09:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391623",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>I have made #28153 for the py3 problem, please review.



---

archive/issue_comments_391624.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2019-07-11T17:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391624",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_comments_391625.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-11T22:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391626.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-11T22:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391626",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391627.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-11T22:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391628.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-11T22:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391628",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391629.json:
```json
{
    "body": "<a id='comment:12'></a>New commits:",
    "created_at": "2019-07-11T22:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391629",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>New commits:



---

archive/issue_comments_391630.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-11T22:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391630",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391631.json:
```json
{
    "body": "<a id='comment:13'></a>https://patchbot.sagemath.org/log/27987/debian/9.9/x86_64/4.9.0-9-amd64/cofio/2019-07-12%2013:08:53?short\n\nThe whole business with testing an interrupt is really unstable. It seems to work almost all of the time, but having the tests fail in even 1 percent of the tests is not acceptable, is it? (Imagine this being the case for all modules.)\n\nI do not know, where I could possible have made a mistake with catching an interrupt. I suspect that it just sometimes fails at some place that I have no impact on.\n\nAnyway, maybe I should remove those fragile tests (in a new ticket).",
    "created_at": "2019-07-12T14:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391631",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>https://patchbot.sagemath.org/log/27987/debian/9.9/x86_64/4.9.0-9-amd64/cofio/2019-07-12%2013:08:53?short

The whole business with testing an interrupt is really unstable. It seems to work almost all of the time, but having the tests fail in even 1 percent of the tests is not acceptable, is it? (Imagine this being the case for all modules.)

I do not know, where I could possible have made a mistake with catching an interrupt. I suspect that it just sometimes fails at some place that I have no impact on.

Anyway, maybe I should remove those fragile tests (in a new ticket).



---

archive/issue_comments_391632.json:
```json
{
    "body": "<a id='comment:16'></a>A few things:\n\nAre you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).\n\n`#27987` -> `:trac:`12987``\n\n`if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).",
    "created_at": "2019-07-24T09:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391632",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>A few things:

Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).

`#27987` -> `:trac:`12987``

`if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).



---

archive/issue_comments_391633.json:
```json
{
    "body": "<a id='comment:17'></a>Thanks.\n\nReplying to [comment:16 tscrim]:\n> A few things:\n> \n> Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).\n\n\n`CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.\n\nAt the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.\nMaybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).\n\n> \n> `#27987` -> `:trac:`12987``\n> \n> `if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).",
    "created_at": "2019-07-24T11:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391633",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>Thanks.

Replying to [comment:16 tscrim]:
> A few things:
> 
> Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).


`CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.

At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).

> 
> `#27987` -> `:trac:`12987``
> 
> `if unbounded is False:` -> `if not unbounded:` (unless you expect `unbounded` to possibly be something else like `None` that should be treated differently, in which case you should add a comment about that).



---

archive/issue_comments_391634.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 gh-kliem]:\n> Thanks.\n> \n> Replying to [comment:16 tscrim]:\n> > A few things:\n> > \n> > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).\n\n> \n> `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.\n\n\nOkay, then this is good as it currently is (i.e., you do not need to issue a warning).\n\n> At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.\n> Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).\n\n\nThat is probably best for another ticket.\n\nSo if you make the other two changes I mentioned, then you can set a positive review on my behalf.",
    "created_at": "2019-07-24T13:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391634",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Replying to [comment:17 gh-kliem]:
> Thanks.
> 
> Replying to [comment:16 tscrim]:
> > A few things:
> > 
> > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).

> 
> `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.


Okay, then this is good as it currently is (i.e., you do not need to issue a warning).

> At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
> Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).


That is probably best for another ticket.

So if you make the other two changes I mentioned, then you can set a positive review on my behalf.



---

archive/issue_comments_391635.json:
```json
{
    "body": "<a id='comment:19'></a>Great. I will do so probably on Saturday (no PC at the moment).\n\nReplying to [comment:18 tscrim]:\n> Replying to [comment:17 gh-kliem]:\n> > Thanks.\n> > \n> > Replying to [comment:16 tscrim]:\n> > > A few things:\n> > > \n> > > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).\n\n> > \n> > `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.\n\n> \n> Okay, then this is good as it currently is (i.e., you do not need to issue a warning).\n> \n> > At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.\n> > Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).\n\n> \n> That is probably best for another ticket.\n> \n> So if you make the other two changes I mentioned, then you can set a positive review on my behalf.",
    "created_at": "2019-07-24T14:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391635",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>Great. I will do so probably on Saturday (no PC at the moment).

Replying to [comment:18 tscrim]:
> Replying to [comment:17 gh-kliem]:
> > Thanks.
> > 
> > Replying to [comment:16 tscrim]:
> > > A few things:
> > > 
> > > Are you absolutely sure that nobody will (should) be passing the `n_lines` data to the constructor (unless they know what they are doing)? If not, then you should deprecate that (including having it be in its original position).

> > 
> > `CombinatorialPolyhedron` has not been in the master branch yet. So I figured it is ok. I can throw a warning, when unbounded is an integer, to make sure no one accidentally uses it.

> 
> Okay, then this is good as it currently is (i.e., you do not need to issue a warning).
> 
> > At the moment, I'm forcing the user to use the Vrepresentation as in `Polyhedron` w.r. to the lines in the representation.
> > Maybe this is to restrictive and I should allow the user to just pass the dimension of the affine space contained in the polyhedron instead (raising the dimension by that number).

> 
> That is probably best for another ticket.
> 
> So if you make the other two changes I mentioned, then you can set a positive review on my behalf.



---

archive/issue_comments_391636.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-27T19:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391636",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391637.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-27T19:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391637",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391638.json:
```json
{
    "body": "<a id='comment:21'></a>Two changes mentioned by Travis taken care of.",
    "created_at": "2019-07-27T19:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391638",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>Two changes mentioned by Travis taken care of.



---

archive/issue_events_069358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-29T21:54:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27987#event-69358"
}
```



---

archive/issue_comments_391639.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-29T21:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27987#issuecomment-391639",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
