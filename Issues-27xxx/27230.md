# Issue 27230: Improve detection of library files in sage.env

archive/issues_026993.json:
```json
{
    "assignees": [],
    "body": "This is basically repackaging the existing code from `sage.env` that is used to set the `SINGULAR_SO` variable, but making it a bit more generic and flexible.\n\nThis will be useful as well for #26930 to get the correct libgap path.  It also tries to be a bit more flexible than the old code, so as to reduce the need for patching in some distros, though this does not guarantee to eliminate that need altogether.\n\nCC:  @dimpase @kiwifb\n\nBranch: **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**\n\nReviewer: **Fran\u00e7ois Bissey, Dima Pasechnik**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27230_\n\n",
    "closed_at": "2019-02-10T12:55:42Z",
    "created_at": "2019-02-06T15:59:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve detection of library files in sage.env",
    "type": "issue",
    "updated_at": "2019-04-08T16:01:09Z",
    "url": "https://github.com/sagemath/sage/issues/27230",
    "user": "https://github.com/embray"
}
```
This is basically repackaging the existing code from `sage.env` that is used to set the `SINGULAR_SO` variable, but making it a bit more generic and flexible.

This will be useful as well for #26930 to get the correct libgap path.  It also tries to be a bit more flexible than the old code, so as to reduce the need for patching in some distros, though this does not guarantee to eliminate that need altogether.

CC:  @dimpase @kiwifb

Branch: **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**

Reviewer: **François Bissey, Dima Pasechnik**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/27230_





---

archive/issue_events_355983.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T15:59:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355983"
}
```



---

archive/issue_events_355984.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T15:59:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355984"
}
```



---

archive/issue_events_355985.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T15:59:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355985"
}
```



---

archive/issue_comments_423417.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI have a branch for this, but the cloud hosting provider for the VM I was working in seems to be monkeying around with something and now my VM lacks working DNS...",
    "created_at": "2019-02-06T16:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423417",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'>Comment 1:</a>
I have a branch for this, but the cloud hosting provider for the VM I was working in seems to be monkeying around with something and now my VM lacks working DNS...



---

archive/issue_comments_423418.json:
```json
{
    "body": "Branch: **[u/embray/misc/sage-env-lib-filename](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/sage-env-lib-filename)**",
    "created_at": "2019-02-06T16:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423418",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/misc/sage-env-lib-filename](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/sage-env-lib-filename)**



---

archive/issue_comments_423419.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nOh, it's working again....\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32940a6e26556a1286e80ac7e48a28e342b7f138\">32940a6</a></td><td><code>Remove deprecated stuff related to Cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6581fd6136b5bbb539380365c22b8663a2ddfa9\">d6581fd</a></td><td><code>Clean up sage.env</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84eb61be734fd9632222f0d5309f1d032fa2cf2c\">84eb61b</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae\">b3c86d4</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr></table>\n",
    "created_at": "2019-02-06T16:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423419",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'>Comment 2:</a>
Oh, it's working again....

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32940a6e26556a1286e80ac7e48a28e342b7f138">32940a6</a></td><td><code>Remove deprecated stuff related to Cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6581fd6136b5bbb539380365c22b8663a2ddfa9">d6581fd</a></td><td><code>Clean up sage.env</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84eb61be734fd9632222f0d5309f1d032fa2cf2c">84eb61b</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae">b3c86d4</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr></table>




---

archive/issue_events_355986.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T16:03:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355986"
}
```



---

archive/issue_comments_423420.json:
```json
{
    "body": "Commit: **[b3c86d4](https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae)**",
    "created_at": "2019-02-06T16:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423420",
    "user": "https://github.com/embray"
}
```

Commit: **[b3c86d4](https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae)**



---

archive/issue_comments_423421.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThis is built on top of #27040, with which it would otherwise conflict.\n\nFor #26930 the idea then would be to add\n\n```\nLIBGAP_SO = _get_shared_lib_filename('gap')\n```",
    "created_at": "2019-02-06T16:04:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423421",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'>Comment 3:</a>
This is built on top of #27040, with which it would otherwise conflict.

For #26930 the idea then would be to add

```
LIBGAP_SO = _get_shared_lib_filename('gap')
```



---

archive/issue_comments_423422.json:
```json
{
    "body": "Dependencies: **#27040**",
    "created_at": "2019-02-06T16:04:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423422",
    "user": "https://github.com/embray"
}
```

Dependencies: **#27040**



---

archive/issue_comments_423423.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nmerge conflict, red branch...",
    "created_at": "2019-02-06T16:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423423",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
merge conflict, red branch...



---

archive/issue_comments_423424.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51aa946c35472e69a828ef1dd6d16ab7161a249e\">51aa946</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc\">34b27b2</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr></table>\n",
    "created_at": "2019-02-06T16:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423424",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51aa946c35472e69a828ef1dd6d16ab7161a249e">51aa946</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc">34b27b2</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr></table>




---

archive/issue_comments_423425.json:
```json
{
    "body": "Changed commit from **[b3c86d4](https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae)** to **[34b27b2](https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc)**",
    "created_at": "2019-02-06T16:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423425",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b3c86d4](https://github.com/sagemath/sagetrac-mirror/commit/b3c86d4ef8aab430172fbbba66bf70baa3f869ae)** to **[34b27b2](https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc)**



---

archive/issue_comments_423426.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nRebased on latest develop again.  It seems 8.7.beta2 was released since I was previously working on this yesterday, and already includes #27040.",
    "created_at": "2019-02-06T16:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423426",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
Rebased on latest develop again.  It seems 8.7.beta2 was released since I was previously working on this yesterday, and already includes #27040.



---

archive/issue_events_355987.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T16:11:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355987"
}
```



---

archive/issue_events_355988.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T16:11:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355988"
}
```



---

archive/issue_comments_423427.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI just realized with my second commit the test could fail now on Debian.",
    "created_at": "2019-02-06T16:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423427",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>Comment 7:</a>
I just realized with my second commit the test could fail now on Debian.



---

archive/issue_comments_423428.json:
```json
{
    "body": "Changed commit from **[34b27b2](https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc)** to **[917a21b](https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e)**",
    "created_at": "2019-02-06T16:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423428",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[34b27b2](https://github.com/sagemath/sagetrac-mirror/commit/34b27b2c8068805c2f24adaa45740a80839cecbc)** to **[917a21b](https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e)**



---

archive/issue_comments_423429.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e\">917a21b</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-06T16:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423429",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e">917a21b</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_events_355989.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T16:14:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355989"
}
```



---

archive/issue_events_355990.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T16:14:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355990"
}
```



---

archive/issue_comments_423430.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e\">917a21b</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-06T16:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423430",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'>Comment 9:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e">917a21b</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_comments_423431.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nDoes this stuff really belong to `src/sage/env.py`? \nIMHO a better fit would be src/sage/libs/ - as this is really something to do with libs...",
    "created_at": "2019-02-06T18:34:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423431",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'>Comment 10:</a>
Does this stuff really belong to `src/sage/env.py`? 
IMHO a better fit would be src/sage/libs/ - as this is really something to do with libs...



---

archive/issue_comments_423432.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\n`env.py` is a central repository of variables so it fits there. But I am open to discussion about splitting some of it in the future if there is a good rationale. But that will be in the future. \n\nNow this will remove a bit of patch in sage-on-gentoo in a nice generic way. The amount of patching of sage in sage-on-gentoo has gone down considerably.",
    "created_at": "2019-02-06T18:51:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423432",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'>Comment 11:</a>
`env.py` is a central repository of variables so it fits there. But I am open to discussion about splitting some of it in the future if there is a good rationale. But that will be in the future. 

Now this will remove a bit of patch in sage-on-gentoo in a nice generic way. The amount of patching of sage in sage-on-gentoo has gone down considerably.



---

archive/issue_events_355991.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-06T19:57:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355991"
}
```



---

archive/issue_events_355992.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-02-06T19:57:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355992"
}
```



---

archive/issue_comments_423433.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nPatchbot has two failures unrelated to this ticket and it looks good to me. So I am giving this a positive review.",
    "created_at": "2019-02-06T19:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423433",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'>Comment 12:</a>
Patchbot has two failures unrelated to this ticket and it looks good to me. So I am giving this a positive review.



---

archive/issue_comments_423434.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2019-02-06T19:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423434",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_423435.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nOK, so please apply to your branch\n\n```\n--- a/src/sage/env.py\n+++ b/src/sage/env.py\n@@ -267,6 +267,10 @@ def _get_shared_lib_filename(libname, *additional_libnames):\n SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')\n var('SINGULAR_SO', SINGULAR_SO)\n \n+# locate libgap shared object\n+GAP_SO= _get_shared_lib_filename('gap','')\n+var('GAP_SO', GAP_SO)\n+\n # post process\n if ' ' in DOT_SAGE:\n     if UNAME[:6] == 'CYGWIN':\n```\nand then I'll use it on #26930",
    "created_at": "2019-02-06T19:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423435",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
OK, so please apply to your branch

```
--- a/src/sage/env.py
+++ b/src/sage/env.py
@@ -267,6 +267,10 @@ def _get_shared_lib_filename(libname, *additional_libnames):
 SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')
 var('SINGULAR_SO', SINGULAR_SO)
 
+# locate libgap shared object
+GAP_SO= _get_shared_lib_filename('gap','')
+var('GAP_SO', GAP_SO)
+
 # post process
 if ' ' in DOT_SAGE:
     if UNAME[:6] == 'CYGWIN':
```
and then I'll use it on #26930



---

archive/issue_events_355993.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T19:58:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355993"
}
```



---

archive/issue_events_355994.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T19:58:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355994"
}
```



---

archive/issue_comments_423436.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nI just added the stuff I asked for in comment 13 to the branch of #26930, so no worried about it, positive review.",
    "created_at": "2019-02-07T01:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423436",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'>Comment 14:</a>
I just added the stuff I asked for in comment 13 to the branch of #26930, so no worried about it, positive review.



---

archive/issue_events_355995.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T01:43:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355995"
}
```



---

archive/issue_events_355996.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T01:43:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355996"
}
```



---

archive/issue_comments_423437.json:
```json
{
    "body": "Changed reviewer from **Fran\u00e7ois Bissey** to **Fran\u00e7ois Bissey, Dima Pasechnik**",
    "created_at": "2019-02-07T01:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423437",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **François Bissey** to **François Bissey, Dima Pasechnik**



---

archive/issue_events_355997.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T08:09:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355997"
}
```



---

archive/issue_events_355998.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T08:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355998"
}
```



---

archive/issue_comments_423438.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n`pyflakes` reports:\n\n```\nsrc/sage/env.py:37: redefinition of unused 'sys' from line 32\nsrc/sage/env.py:235: undefined name 'libdir'\nsrc/sage/env.py:235: undefined name 'libdir'\n```\nThe latter is a genuine bug as far as I can see.",
    "created_at": "2019-02-07T08:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423438",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
`pyflakes` reports:

```
src/sage/env.py:37: redefinition of unused 'sys' from line 32
src/sage/env.py:235: undefined name 'libdir'
src/sage/env.py:235: undefined name 'libdir'
```
The latter is a genuine bug as far as I can see.



---

archive/issue_comments_423439.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nJust a minor thing, but I find this remark more confusing than helping and suggest to remove it:\n\n```\n(technically this is superfluous but clearer when made explicit)\n```",
    "created_at": "2019-02-07T08:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423439",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Just a minor thing, but I find this remark more confusing than helping and suggest to remove it:

```
(technically this is superfluous but clearer when made explicit)
```



---

archive/issue_comments_423440.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@jdemeyer](#comment%3A15):\n> `pyflakes` reports:\n> \n> ```\n> src/sage/env.py:37: redefinition of unused 'sys' from line 32\n> src/sage/env.py:235: undefined name 'libdir'\n> src/sage/env.py:235: undefined name 'libdir'\n> ```\n> The latter is a genuine bug as far as I can see.\n\nI am guessing Erik meant `libname` from the context.",
    "created_at": "2019-02-07T08:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423440",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@jdemeyer](#comment%3A15):
> `pyflakes` reports:
> 
> ```
> src/sage/env.py:37: redefinition of unused 'sys' from line 32
> src/sage/env.py:235: undefined name 'libdir'
> src/sage/env.py:235: undefined name 'libdir'
> ```
> The latter is a genuine bug as far as I can see.

I am guessing Erik meant `libname` from the context.



---

archive/issue_comments_423441.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nAnother detail: why this signature\n\n```\ndef _get_shared_lib_filename(libname, *additional_libnames)\n```\nwhen all the arguments play the same role?\n\nWouldn't it be clearer to write it as\n\n```\ndef _get_shared_lib_filename(*libnames)\n```",
    "created_at": "2019-02-07T08:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423441",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
Another detail: why this signature

```
def _get_shared_lib_filename(libname, *additional_libnames)
```
when all the arguments play the same role?

Wouldn't it be clearer to write it as

```
def _get_shared_lib_filename(*libnames)
```



---

archive/issue_comments_423442.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@jdemeyer](#comment%3A18):\n> Another detail: why this signature\n> \n> ```\n> def _get_shared_lib_filename(libname, *additional_libnames)\n> ```\n> when all the arguments play the same role?\n> \n> Wouldn't it be clearer to write it as\n> \n> ```\n> def _get_shared_lib_filename(*libnames)\n> ```\n\nI pinged back and forth on that, but ultimately did it that way so that it would require at least one argument.  I suppose it could allow zero arguments and then just return None but why bother?",
    "created_at": "2019-02-07T18:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423442",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@jdemeyer](#comment%3A18):
> Another detail: why this signature
> 
> ```
> def _get_shared_lib_filename(libname, *additional_libnames)
> ```
> when all the arguments play the same role?
> 
> Wouldn't it be clearer to write it as
> 
> ```
> def _get_shared_lib_filename(*libnames)
> ```

I pinged back and forth on that, but ultimately did it that way so that it would require at least one argument.  I suppose it could allow zero arguments and then just return None but why bother?



---

archive/issue_comments_423443.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11a8a892a1cfabd51b9a1d9734603edcda0ff40c\">11a8a89</a></td><td><code>trac #26822: pep8 in centrality_betweenness and centrality_closeness</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f780bb11f0089744b954ceefd7813cbcf6fa85d\">7f780bb</a></td><td><code>trac #26822: fix doctest error in centrality_closeness</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bb77cd52464d509df2888188376c60a6fdf1938\">0bb77cd</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 8.7.beta2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5001b21da8f75091b8cf7eba087f84cbc3a0c885\">5001b21</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db8a725c69fbced1273c0ff5ea6c603de8ed983f\">db8a725</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2\">d137bc4</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-07T18:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423443",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11a8a892a1cfabd51b9a1d9734603edcda0ff40c">11a8a89</a></td><td><code>trac #26822: pep8 in centrality_betweenness and centrality_closeness</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f780bb11f0089744b954ceefd7813cbcf6fa85d">7f780bb</a></td><td><code>trac #26822: fix doctest error in centrality_closeness</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bb77cd52464d509df2888188376c60a6fdf1938">0bb77cd</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 8.7.beta2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5001b21da8f75091b8cf7eba087f84cbc3a0c885">5001b21</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db8a725c69fbced1273c0ff5ea6c603de8ed983f">db8a725</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2">d137bc4</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_comments_423444.json:
```json
{
    "body": "Changed commit from **[917a21b](https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e)** to **[d137bc4](https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2)**",
    "created_at": "2019-02-07T18:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423444",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[917a21b](https://github.com/sagemath/sagetrac-mirror/commit/917a21ba4b07dc86ed855d57bfba5cde7a110f8e)** to **[d137bc4](https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2)**



---

archive/issue_comments_423445.json:
```json
{
    "body": "Changed commit from **[d137bc4](https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2)** to **[cc2a024](https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a)**",
    "created_at": "2019-02-07T18:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423445",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d137bc4](https://github.com/sagemath/sagetrac-mirror/commit/d137bc4f18cb77b0e67c3cb7beab8ea2a7f5efb2)** to **[cc2a024](https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a)**



---

archive/issue_comments_423446.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05f3dd95c27ca8f8f31ca04ee3ef5c12931b231e\">05f3dd9</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a\">cc2a024</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-07T18:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423446",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05f3dd95c27ca8f8f31ca04ee3ef5c12931b231e">05f3dd9</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a">cc2a024</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_events_355999.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-07T18:10:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-355999"
}
```



---

archive/issue_events_356000.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-07T18:10:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356000"
}
```



---

archive/issue_comments_423447.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nAddressed [comment:16](#comment%3A16) and obvious bugs from [comment:15](#comment%3A15) (in the latter case, it previously worked on Cygwin but I did not test on Cygwin after the refactoring I did; I'm confident now that it's right-enough).\n\nHappy to shuffle things around to different locations as well, though keep in mind everything in `sage.env` should work easily with minimal, if any, imports from other sub-packages in Sage (at least anything that does anything less trivial that define a few pure-Python classes and functions).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11a8a892a1cfabd51b9a1d9734603edcda0ff40c\">11a8a89</a></td><td><code>trac #26822: pep8 in centrality_betweenness and centrality_closeness</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f780bb11f0089744b954ceefd7813cbcf6fa85d\">7f780bb</a></td><td><code>trac #26822: fix doctest error in centrality_closeness</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bb77cd52464d509df2888188376c60a6fdf1938\">0bb77cd</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 8.7.beta2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5001b21da8f75091b8cf7eba087f84cbc3a0c885\">5001b21</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05f3dd95c27ca8f8f31ca04ee3ef5c12931b231e\">05f3dd9</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a\">cc2a024</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-07T18:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423447",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'>Comment 22:</a>
Addressed [comment:16](#comment%3A16) and obvious bugs from [comment:15](#comment%3A15) (in the latter case, it previously worked on Cygwin but I did not test on Cygwin after the refactoring I did; I'm confident now that it's right-enough).

Happy to shuffle things around to different locations as well, though keep in mind everything in `sage.env` should work easily with minimal, if any, imports from other sub-packages in Sage (at least anything that does anything less trivial that define a few pure-Python classes and functions).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11a8a892a1cfabd51b9a1d9734603edcda0ff40c">11a8a89</a></td><td><code>trac #26822: pep8 in centrality_betweenness and centrality_closeness</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f780bb11f0089744b954ceefd7813cbcf6fa85d">7f780bb</a></td><td><code>trac #26822: fix doctest error in centrality_closeness</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bb77cd52464d509df2888188376c60a6fdf1938">0bb77cd</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 8.7.beta2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5001b21da8f75091b8cf7eba087f84cbc3a0c885">5001b21</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05f3dd95c27ca8f8f31ca04ee3ef5c12931b231e">05f3dd9</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a">cc2a024</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_comments_423448.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nan import is missing, it seems:\n\n```\n[sagelib-8.7.beta2] && sage-python23 -u setup.py --no-user-cfg build install\n[sagelib-8.7.beta2] ************************************************************************\n[sagelib-8.7.beta2] Traceback (most recent call last):\n[sagelib-8.7.beta2]   File \"setup.py\", line 61, in <module>\n[sagelib-8.7.beta2]     import sage.env\n[sagelib-8.7.beta2]   File \"/mnt/opt/Sage/sage-dev/src/sage/env.py\", line 264, in <module>\n[sagelib-8.7.beta2]     SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')\n[sagelib-8.7.beta2]   File \"/mnt/opt/Sage/sage-dev/src/sage/env.py\", line 247, in _get_shared_lib_filename\n[sagelib-8.7.beta2]     libdirs = [sysconfig.get_config_var('LIBDIR')]\n[sagelib-8.7.beta2] NameError: global name 'sysconfig' is not defined\n[sagelib-8.7.beta2] ************************************************************************\n[sagelib-8.7.beta2] Error building the Sage library\n```",
    "created_at": "2019-02-08T12:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423448",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'>Comment 23:</a>
an import is missing, it seems:

```
[sagelib-8.7.beta2] && sage-python23 -u setup.py --no-user-cfg build install
[sagelib-8.7.beta2] ************************************************************************
[sagelib-8.7.beta2] Traceback (most recent call last):
[sagelib-8.7.beta2]   File "setup.py", line 61, in <module>
[sagelib-8.7.beta2]     import sage.env
[sagelib-8.7.beta2]   File "/mnt/opt/Sage/sage-dev/src/sage/env.py", line 264, in <module>
[sagelib-8.7.beta2]     SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')
[sagelib-8.7.beta2]   File "/mnt/opt/Sage/sage-dev/src/sage/env.py", line 247, in _get_shared_lib_filename
[sagelib-8.7.beta2]     libdirs = [sysconfig.get_config_var('LIBDIR')]
[sagelib-8.7.beta2] NameError: global name 'sysconfig' is not defined
[sagelib-8.7.beta2] ************************************************************************
[sagelib-8.7.beta2] Error building the Sage library
```



---

archive/issue_events_356001.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-08T12:08:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356001"
}
```



---

archive/issue_events_356002.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-08T12:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356002"
}
```



---

archive/issue_comments_423449.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThat's weird--I thought an `import sysconfig` was already added in #27040, but apparently not?",
    "created_at": "2019-02-08T12:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423449",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'>Comment 24:</a>
That's weird--I thought an `import sysconfig` was already added in #27040, but apparently not?



---

archive/issue_comments_423450.json:
```json
{
    "body": "Changed dependencies from **#27040** to none",
    "created_at": "2019-02-08T12:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423450",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#27040** to none



---

archive/issue_comments_423451.json:
```json
{
    "body": "Changed commit from **[cc2a024](https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a)** to **[8d62ac5](https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65)**",
    "created_at": "2019-02-08T12:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423451",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cc2a024](https://github.com/sagemath/sagetrac-mirror/commit/cc2a024b7474a6a5e5cb3b11f0797a22d395672a)** to **[8d62ac5](https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65)**



---

archive/issue_comments_423452.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/346eb67a3990916d780faca039ecb118e1c512e2\">346eb67</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65\">8d62ac5</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-08T12:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423452",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/346eb67a3990916d780faca039ecb118e1c512e2">346eb67</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65">8d62ac5</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_events_356003.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-08T12:56:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356003"
}
```



---

archive/issue_events_356004.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-08T12:56:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356004"
}
```



---

archive/issue_comments_423453.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThere is something weird going on with the commits... Why am I seeing `Updated [SageMath](../wiki/SageMath) version to 8.7.beta2` in the list of commits on this ticket (when clicking on \"commits\" in the box at the top of this page)? Either it's something wrong with Trac or with this branch, but it would be good to clear that up.",
    "created_at": "2019-02-08T13:05:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423453",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
There is something weird going on with the commits... Why am I seeing `Updated [SageMath](../wiki/SageMath) version to 8.7.beta2` in the list of commits on this ticket (when clicking on "commits" in the box at the top of this page)? Either it's something wrong with Trac or with this branch, but it would be good to clear that up.



---

archive/issue_events_356005.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-08T13:05:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356005"
}
```



---

archive/issue_events_356006.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-08T13:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356006"
}
```



---

archive/issue_comments_423454.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nI clearly must have screwed something up while rebasing, because it also says I'm the committer on that commit.  I suspect what I did was at some point I did a `git rebase -i` and selected too many commits.  Still surprising that it would modify some commits and set me as the committer even if I didn't change them at all.",
    "created_at": "2019-02-08T13:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423454",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'>Comment 29:</a>
I clearly must have screwed something up while rebasing, because it also says I'm the committer on that commit.  I suspect what I did was at some point I did a `git rebase -i` and selected too many commits.  Still surprising that it would modify some commits and set me as the committer even if I didn't change them at all.



---

archive/issue_comments_423455.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/461ae1dbc64215a28d4b33857d70f66892981964\">461ae1d</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b7df99619ca2a9a37ea79e90cb4617f154b45e4\">3b7df99</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330\">ab94f51</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>\n",
    "created_at": "2019-02-08T13:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423455",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/461ae1dbc64215a28d4b33857d70f66892981964">461ae1d</a></td><td><code>repackages the code for finding the libSingular.so as a somewhat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b7df99619ca2a9a37ea79e90cb4617f154b45e4">3b7df99</a></td><td><code>rework _get_shared_lib_filename to cover more system-specific cases,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330">ab94f51</a></td><td><code>fixed the test to be a little more flexible</code></td></tr></table>




---

archive/issue_comments_423456.json:
```json
{
    "body": "Changed commit from **[8d62ac5](https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65)** to **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**",
    "created_at": "2019-02-08T13:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423456",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8d62ac5](https://github.com/sagemath/sagetrac-mirror/commit/8d62ac50fb8c679e512ced730a5555271c2b1c65)** to **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**



---

archive/issue_comments_423457.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nThat's better.",
    "created_at": "2019-02-08T13:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423457",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'>Comment 31:</a>
That's better.



---

archive/issue_events_356007.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-08T13:15:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356007"
}
```



---

archive/issue_events_356008.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-08T13:15:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356008"
}
```



---

archive/issue_comments_423458.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nok, tests out well.",
    "created_at": "2019-02-08T20:53:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423458",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'>Comment 32:</a>
ok, tests out well.



---

archive/issue_events_356009.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-08T20:53:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356009"
}
```



---

archive/issue_events_356010.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-08T20:53:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356010"
}
```



---

archive/issue_comments_423459.json:
```json
{
    "body": "Changed branch from **[u/embray/misc/sage-env-lib-filename](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/sage-env-lib-filename)** to **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**",
    "created_at": "2019-02-10T12:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423459",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/misc/sage-env-lib-filename](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/sage-env-lib-filename)** to **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)**



---

archive/issue_events_356011.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-10T12:55:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356011"
}
```



---

archive/issue_events_356012.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b66fae2dc5f4b7293156851a5321c3e65692602d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-02-10T12:55:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27230#event-356012"
}
```



---

archive/issue_comments_423460.json:
```json
{
    "body": "Changed commit from **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)** to none",
    "created_at": "2019-02-21T10:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423460",
    "user": "https://github.com/embray"
}
```

Changed commit from **[ab94f51](https://github.com/sagemath/sagetrac-mirror/commit/ab94f51c0c45221d92969721be0a26dc832c1330)** to none



---

archive/issue_comments_423461.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nUgh, this is still completely broken on Cygwin.",
    "created_at": "2019-02-21T10:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423461",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'>Comment 34:</a>
Ugh, this is still completely broken on Cygwin.



---

archive/issue_comments_423462.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nThis fails to find any libraries on nix, since they won't be in the same libdir as python. For that reason I'm already setting the `SINGULAR_SO` and `GAP_SO` env vars, but now this test fails anyways.\n\nThoughts on how best to resolve this? I'm not sure the function should even be tested (instead maybe test that `SINGULAR_SO` and `GAP_SO` have proper values after being assigned. If we really do want to test that function, maybe ad the `SINGULAR_SO` and `GAP_SO` locations to the `libdirs` list?",
    "created_at": "2019-04-06T14:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423462",
    "user": "https://github.com/timokau"
}
```

<a id='comment:35'>Comment 35:</a>
This fails to find any libraries on nix, since they won't be in the same libdir as python. For that reason I'm already setting the `SINGULAR_SO` and `GAP_SO` env vars, but now this test fails anyways.

Thoughts on how best to resolve this? I'm not sure the function should even be tested (instead maybe test that `SINGULAR_SO` and `GAP_SO` have proper values after being assigned. If we really do want to test that function, maybe ad the `SINGULAR_SO` and `GAP_SO` locations to the `libdirs` list?



---

archive/issue_comments_423463.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nthis seems to be duplucating in an ad hoc way what the system linker/loader knows. Is there a way to query the cache of ldconfig from Python? This would be a much more robust thing, for system libraries, IMHO.",
    "created_at": "2019-04-06T16:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423463",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'>Comment 36:</a>
this seems to be duplucating in an ad hoc way what the system linker/loader knows. Is there a way to query the cache of ldconfig from Python? This would be a much more robust thing, for system libraries, IMHO.



---

archive/issue_comments_423464.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nCome to think of it, why do we need this at all? Isn't the functionality covered (better) by `find_library` in `src/sage/misc/compat.py`?",
    "created_at": "2019-04-07T13:17:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423464",
    "user": "https://github.com/timokau"
}
```

<a id='comment:37'>Comment 37:</a>
Come to think of it, why do we need this at all? Isn't the functionality covered (better) by `find_library` in `src/sage/misc/compat.py`?



---

archive/issue_comments_423465.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nNew ticket please.",
    "created_at": "2019-04-08T16:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27230#issuecomment-423465",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'>Comment 38:</a>
New ticket please.
