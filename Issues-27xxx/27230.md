# Issue 27230: Improve detection of library files in sage.env

archive/issues_026993.json:
```json
{
    "body": "This is basically repackaging the existing code from `sage.env` that is used to set the `SINGULAR_SO` variable, but making it a bit more generic and flexible.\n\nThis will be useful as well for #26930 to get the correct libgap path.  It also tries to be a bit more flexible than the old code, so as to reduce the need for patching in some distros, though this does not guarantee to eliminate that need altogether.\n\nCC:  @dimpase @kiwifb\n\nReviewer: Fran\u00e7ois Bissey, Dima Pasechnik\n\nAuthor: Erik Bray\n\nBranch: ab94f51c0c45221d92969721be0a26dc832c1330\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27230\n\n",
    "closed_at": "2019-02-10T12:55:42Z",
    "created_at": "2019-02-06T15:59:11Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Improve detection of library files in sage.env",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27230",
    "user": "https://github.com/embray"
}
```
This is basically repackaging the existing code from `sage.env` that is used to set the `SINGULAR_SO` variable, but making it a bit more generic and flexible.

This will be useful as well for #26930 to get the correct libgap path.  It also tries to be a bit more flexible than the old code, so as to reduce the need for patching in some distros, though this does not guarantee to eliminate that need altogether.

CC:  @dimpase @kiwifb

Reviewer: Fran√ßois Bissey, Dima Pasechnik

Author: Erik Bray

Branch: ab94f51c0c45221d92969721be0a26dc832c1330

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27230





---

archive/issue_comments_404612.json:
```json
{
    "body": "<a id='comment:1'></a>I have a branch for this, but the cloud hosting provider for the VM I was working in seems to be monkeying around with something and now my VM lacks working DNS...",
    "created_at": "2019-02-06T16:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404612",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>I have a branch for this, but the cloud hosting provider for the VM I was working in seems to be monkeying around with something and now my VM lacks working DNS...



---

archive/issue_comments_404613.json:
```json
{
    "body": "<a id='comment:2'></a>Oh, it's working again....\n\n---\nNew commits:",
    "created_at": "2019-02-06T16:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404613",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>Oh, it's working again....

---
New commits:



---

archive/issue_comments_404614.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-06T16:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404614",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404615.json:
```json
{
    "body": "<a id='comment:3'></a>This is built on top of #27040, with which it would otherwise conflict.\n\nFor #26930 the idea then would be to add\n\n```\nLIBGAP_SO = _get_shared_lib_filename('gap')\n```",
    "created_at": "2019-02-06T16:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404615",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>This is built on top of #27040, with which it would otherwise conflict.

For #26930 the idea then would be to add

```
LIBGAP_SO = _get_shared_lib_filename('gap')
```



---

archive/issue_comments_404616.json:
```json
{
    "body": "<a id='comment:4'></a>merge conflict, red branch...",
    "created_at": "2019-02-06T16:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404616",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>merge conflict, red branch...



---

archive/issue_comments_404617.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-06T16:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404617",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404618.json:
```json
{
    "body": "<a id='comment:6'></a>Rebased on latest develop again.  It seems 8.7.beta2 was released since I was previously working on this yesterday, and already includes #27040.",
    "created_at": "2019-02-06T16:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404618",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>Rebased on latest develop again.  It seems 8.7.beta2 was released since I was previously working on this yesterday, and already includes #27040.



---

archive/issue_comments_404619.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-06T16:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404619",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_404620.json:
```json
{
    "body": "<a id='comment:7'></a>I just realized with my second commit the test could fail now on Debian.",
    "created_at": "2019-02-06T16:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404620",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>I just realized with my second commit the test could fail now on Debian.



---

archive/issue_comments_404621.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-06T16:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404622.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-06T16:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404622",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404623.json:
```json
{
    "body": "<a id='comment:9'></a>New commits:",
    "created_at": "2019-02-06T16:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404623",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>New commits:



---

archive/issue_comments_404624.json:
```json
{
    "body": "<a id='comment:10'></a>Does this stuff really belong to `src/sage/env.py`? \nIMHO a better fit would be src/sage/libs/ - as this is really something to do with libs...",
    "created_at": "2019-02-06T18:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404624",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Does this stuff really belong to `src/sage/env.py`? 
IMHO a better fit would be src/sage/libs/ - as this is really something to do with libs...



---

archive/issue_comments_404625.json:
```json
{
    "body": "<a id='comment:11'></a>`env.py` is a central repository of variables so it fits there. But I am open to discussion about splitting some of it in the future if there is a good rationale. But that will be in the future. \n\nNow this will remove a bit of patch in sage-on-gentoo in a nice generic way. The amount of patching of sage in sage-on-gentoo has gone down considerably.",
    "created_at": "2019-02-06T18:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404625",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>`env.py` is a central repository of variables so it fits there. But I am open to discussion about splitting some of it in the future if there is a good rationale. But that will be in the future. 

Now this will remove a bit of patch in sage-on-gentoo in a nice generic way. The amount of patching of sage in sage-on-gentoo has gone down considerably.



---

archive/issue_comments_404626.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-06T19:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404626",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404627.json:
```json
{
    "body": "<a id='comment:12'></a>Patchbot has two failures unrelated to this ticket and it looks good to me. So I am giving this a positive review.",
    "created_at": "2019-02-06T19:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404627",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>Patchbot has two failures unrelated to this ticket and it looks good to me. So I am giving this a positive review.



---

archive/issue_comments_404628.json:
```json
{
    "body": "<a id='comment:13'></a>OK, so please apply to your branch\n\n```\n--- a/src/sage/env.py\n+++ b/src/sage/env.py\n@@ -267,6 +267,10 @@ def _get_shared_lib_filename(libname, *additional_libnames):\n SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')\n var('SINGULAR_SO', SINGULAR_SO)\n \n+# locate libgap shared object\n+GAP_SO= _get_shared_lib_filename('gap','')\n+var('GAP_SO', GAP_SO)\n+\n # post process\n if ' ' in DOT_SAGE:\n     if UNAME[:6] == 'CYGWIN':\n```\nand then I'll use it on #26930",
    "created_at": "2019-02-06T19:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404628",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>OK, so please apply to your branch

```
--- a/src/sage/env.py
+++ b/src/sage/env.py
@@ -267,6 +267,10 @@ def _get_shared_lib_filename(libname, *additional_libnames):
 SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')
 var('SINGULAR_SO', SINGULAR_SO)
 
+# locate libgap shared object
+GAP_SO= _get_shared_lib_filename('gap','')
+var('GAP_SO', GAP_SO)
+
 # post process
 if ' ' in DOT_SAGE:
     if UNAME[:6] == 'CYGWIN':
```
and then I'll use it on #26930



---

archive/issue_comments_404629.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-06T19:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404629",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_404630.json:
```json
{
    "body": "<a id='comment:14'></a>I just added the stuff I asked for in comment 13 to the branch of #26930, so no worried about it, positive review.",
    "created_at": "2019-02-07T01:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404630",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>I just added the stuff I asked for in comment 13 to the branch of #26930, so no worried about it, positive review.



---

archive/issue_comments_404631.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-02-07T01:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404631",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_404632.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-07T08:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404632",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_404633.json:
```json
{
    "body": "<a id='comment:15'></a>`pyflakes` reports:\n\n```\nsrc/sage/env.py:37: redefinition of unused 'sys' from line 32\nsrc/sage/env.py:235: undefined name 'libdir'\nsrc/sage/env.py:235: undefined name 'libdir'\n```\nThe latter is a genuine bug as far as I can see.",
    "created_at": "2019-02-07T08:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404633",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>`pyflakes` reports:

```
src/sage/env.py:37: redefinition of unused 'sys' from line 32
src/sage/env.py:235: undefined name 'libdir'
src/sage/env.py:235: undefined name 'libdir'
```
The latter is a genuine bug as far as I can see.



---

archive/issue_comments_404634.json:
```json
{
    "body": "<a id='comment:16'></a>Just a minor thing, but I find this remark more confusing than helping and suggest to remove it:\n\n```\n(technically this is superfluous but clearer when made explicit)\n```",
    "created_at": "2019-02-07T08:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404634",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Just a minor thing, but I find this remark more confusing than helping and suggest to remove it:

```
(technically this is superfluous but clearer when made explicit)
```



---

archive/issue_comments_404635.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 jdemeyer]:\n> `pyflakes` reports:\n> \n> ```\n> src/sage/env.py:37: redefinition of unused 'sys' from line 32\n> src/sage/env.py:235: undefined name 'libdir'\n> src/sage/env.py:235: undefined name 'libdir'\n> ```\n> The latter is a genuine bug as far as I can see.\n\n\nI am guessing Erik meant `libname` from the context.",
    "created_at": "2019-02-07T08:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404635",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Replying to [comment:15 jdemeyer]:
> `pyflakes` reports:
> 
> ```
> src/sage/env.py:37: redefinition of unused 'sys' from line 32
> src/sage/env.py:235: undefined name 'libdir'
> src/sage/env.py:235: undefined name 'libdir'
> ```
> The latter is a genuine bug as far as I can see.


I am guessing Erik meant `libname` from the context.



---

archive/issue_comments_404636.json:
```json
{
    "body": "<a id='comment:18'></a>Another detail: why this signature\n\n```\ndef _get_shared_lib_filename(libname, *additional_libnames)\n```\nwhen all the arguments play the same role?\n\nWouldn't it be clearer to write it as\n\n```\ndef _get_shared_lib_filename(*libnames)\n```",
    "created_at": "2019-02-07T08:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404636",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Another detail: why this signature

```
def _get_shared_lib_filename(libname, *additional_libnames)
```
when all the arguments play the same role?

Wouldn't it be clearer to write it as

```
def _get_shared_lib_filename(*libnames)
```



---

archive/issue_comments_404637.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:\n> Another detail: why this signature\n> \n> ```\n> def _get_shared_lib_filename(libname, *additional_libnames)\n> ```\n> when all the arguments play the same role?\n> \n> Wouldn't it be clearer to write it as\n> \n> ```\n> def _get_shared_lib_filename(*libnames)\n> ```\n\n\nI pinged back and forth on that, but ultimately did it that way so that it would require at least one argument.  I suppose it could allow zero arguments and then just return None but why bother?",
    "created_at": "2019-02-07T18:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404637",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:
> Another detail: why this signature
> 
> ```
> def _get_shared_lib_filename(libname, *additional_libnames)
> ```
> when all the arguments play the same role?
> 
> Wouldn't it be clearer to write it as
> 
> ```
> def _get_shared_lib_filename(*libnames)
> ```


I pinged back and forth on that, but ultimately did it that way so that it would require at least one argument.  I suppose it could allow zero arguments and then just return None but why bother?



---

archive/issue_comments_404638.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-07T18:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404639.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-07T18:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404639",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404640.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-07T18:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404640",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404641.json:
```json
{
    "body": "<a id='comment:22'></a>Addressed comment:16 and obvious bugs from comment:15 (in the latter case, it previously worked on Cygwin but I did not test on Cygwin after the refactoring I did; I'm confident now that it's right-enough).\n\nHappy to shuffle things around to different locations as well, though keep in mind everything in `sage.env` should work easily with minimal, if any, imports from other sub-packages in Sage (at least anything that does anything less trivial that define a few pure-Python classes and functions).\n\n---\nNew commits:",
    "created_at": "2019-02-07T18:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404641",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>Addressed comment:16 and obvious bugs from comment:15 (in the latter case, it previously worked on Cygwin but I did not test on Cygwin after the refactoring I did; I'm confident now that it's right-enough).

Happy to shuffle things around to different locations as well, though keep in mind everything in `sage.env` should work easily with minimal, if any, imports from other sub-packages in Sage (at least anything that does anything less trivial that define a few pure-Python classes and functions).

---
New commits:



---

archive/issue_comments_404642.json:
```json
{
    "body": "<a id='comment:23'></a>an import is missing, it seems:\n\n```\n[sagelib-8.7.beta2] && sage-python23 -u setup.py --no-user-cfg build install\n[sagelib-8.7.beta2] ************************************************************************\n[sagelib-8.7.beta2] Traceback (most recent call last):\n[sagelib-8.7.beta2]   File \"setup.py\", line 61, in <module>\n[sagelib-8.7.beta2]     import sage.env\n[sagelib-8.7.beta2]   File \"/mnt/opt/Sage/sage-dev/src/sage/env.py\", line 264, in <module>\n[sagelib-8.7.beta2]     SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')\n[sagelib-8.7.beta2]   File \"/mnt/opt/Sage/sage-dev/src/sage/env.py\", line 247, in _get_shared_lib_filename\n[sagelib-8.7.beta2]     libdirs = [sysconfig.get_config_var('LIBDIR')]\n[sagelib-8.7.beta2] NameError: global name 'sysconfig' is not defined\n[sagelib-8.7.beta2] ************************************************************************\n[sagelib-8.7.beta2] Error building the Sage library\n```",
    "created_at": "2019-02-08T12:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404642",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>an import is missing, it seems:

```
[sagelib-8.7.beta2] && sage-python23 -u setup.py --no-user-cfg build install
[sagelib-8.7.beta2] ************************************************************************
[sagelib-8.7.beta2] Traceback (most recent call last):
[sagelib-8.7.beta2]   File "setup.py", line 61, in <module>
[sagelib-8.7.beta2]     import sage.env
[sagelib-8.7.beta2]   File "/mnt/opt/Sage/sage-dev/src/sage/env.py", line 264, in <module>
[sagelib-8.7.beta2]     SINGULAR_SO = _get_shared_lib_filename('Singular', 'singular-Singular')
[sagelib-8.7.beta2]   File "/mnt/opt/Sage/sage-dev/src/sage/env.py", line 247, in _get_shared_lib_filename
[sagelib-8.7.beta2]     libdirs = [sysconfig.get_config_var('LIBDIR')]
[sagelib-8.7.beta2] NameError: global name 'sysconfig' is not defined
[sagelib-8.7.beta2] ************************************************************************
[sagelib-8.7.beta2] Error building the Sage library
```



---

archive/issue_comments_404643.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-08T12:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404643",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_404644.json:
```json
{
    "body": "<a id='comment:24'></a>That's weird--I thought an `import sysconfig` was already added in #27040, but apparently not?",
    "created_at": "2019-02-08T12:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404644",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>That's weird--I thought an `import sysconfig` was already added in #27040, but apparently not?



---

archive/issue_comments_404645.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-08T12:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404645",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404646.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-08T12:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404646",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404647.json:
```json
{
    "body": "<a id='comment:28'></a>There is something weird going on with the commits... Why am I seeing `Updated [SageMath](SageMath) version to 8.7.beta2` in the list of commits on this ticket (when clicking on \"commits\" in the box at the top of this page)? Either it's something wrong with Trac or with this branch, but it would be good to clear that up.",
    "created_at": "2019-02-08T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404647",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>There is something weird going on with the commits... Why am I seeing `Updated [SageMath](SageMath) version to 8.7.beta2` in the list of commits on this ticket (when clicking on "commits" in the box at the top of this page)? Either it's something wrong with Trac or with this branch, but it would be good to clear that up.



---

archive/issue_comments_404648.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-02-08T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404648",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_404649.json:
```json
{
    "body": "<a id='comment:29'></a>I clearly must have screwed something up while rebasing, because it also says I'm the committer on that commit.  I suspect what I did was at some point I did a `git rebase -i` and selected too many commits.  Still surprising that it would modify some commits and set me as the committer even if I didn't change them at all.",
    "created_at": "2019-02-08T13:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404649",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>I clearly must have screwed something up while rebasing, because it also says I'm the committer on that commit.  I suspect what I did was at some point I did a `git rebase -i` and selected too many commits.  Still surprising that it would modify some commits and set me as the committer even if I didn't change them at all.



---

archive/issue_comments_404650.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-08T13:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404651.json:
```json
{
    "body": "<a id='comment:31'></a>That's better.",
    "created_at": "2019-02-08T13:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404651",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>That's better.



---

archive/issue_comments_404652.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-02-08T13:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404652",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_404653.json:
```json
{
    "body": "<a id='comment:32'></a>ok, tests out well.",
    "created_at": "2019-02-08T20:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404653",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>ok, tests out well.



---

archive/issue_comments_404654.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-08T20:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404654",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404655.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-10T12:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404655",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067598.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-10T12:55:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27230#event-67598"
}
```



---

archive/issue_comments_404656.json:
```json
{
    "body": "<a id='comment:34'></a>Ugh, this is still completely broken on Cygwin.",
    "created_at": "2019-02-21T10:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404656",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>Ugh, this is still completely broken on Cygwin.



---

archive/issue_comments_404657.json:
```json
{
    "body": "<a id='comment:35'></a>This fails to find any libraries on nix, since they won't be in the same libdir as python. For that reason I'm already setting the `SINGULAR_SO` and `GAP_SO` env vars, but now this test fails anyways.\n\nThoughts on how best to resolve this? I'm not sure the function should even be tested (instead maybe test that `SINGULAR_SO` and `GAP_SO` have proper values after being assigned. If we really do want to test that function, maybe ad the `SINGULAR_SO` and `GAP_SO` locations to the `libdirs` list?",
    "created_at": "2019-04-06T14:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404657",
    "user": "https://github.com/timokau"
}
```

<a id='comment:35'></a>This fails to find any libraries on nix, since they won't be in the same libdir as python. For that reason I'm already setting the `SINGULAR_SO` and `GAP_SO` env vars, but now this test fails anyways.

Thoughts on how best to resolve this? I'm not sure the function should even be tested (instead maybe test that `SINGULAR_SO` and `GAP_SO` have proper values after being assigned. If we really do want to test that function, maybe ad the `SINGULAR_SO` and `GAP_SO` locations to the `libdirs` list?



---

archive/issue_comments_404658.json:
```json
{
    "body": "<a id='comment:36'></a>this seems to be duplucating in an ad hoc way what the system linker/loader knows. Is there a way to query the cache of ldconfig from Python? This would be a much more robust thing, for system libraries, IMHO.",
    "created_at": "2019-04-06T16:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404658",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>this seems to be duplucating in an ad hoc way what the system linker/loader knows. Is there a way to query the cache of ldconfig from Python? This would be a much more robust thing, for system libraries, IMHO.



---

archive/issue_comments_404659.json:
```json
{
    "body": "<a id='comment:37'></a>Come to think of it, why do we need this at all? Isn't the functionality covered (better) by `find_library` in `src/sage/misc/compat.py`?",
    "created_at": "2019-04-07T13:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404659",
    "user": "https://github.com/timokau"
}
```

<a id='comment:37'></a>Come to think of it, why do we need this at all? Isn't the functionality covered (better) by `find_library` in `src/sage/misc/compat.py`?



---

archive/issue_comments_404660.json:
```json
{
    "body": "<a id='comment:38'></a>New ticket please.",
    "created_at": "2019-04-08T16:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27230#issuecomment-404660",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>New ticket please.
