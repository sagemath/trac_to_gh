# Issue 27896: Fix hiding of TESTS in documentation

archive/issues_027659.json:
```json
{
    "body": "The function `sage.misc.sagedoc.skip_TESTS_block` is responsible for hiding TESTS blocks from the documentation, but the case below is not correctly handled. As a result, all the tests below the line `::` are *not* hidden from the documentation.\n\n```\n    TESTS:\n\n    Some description::\n\n        sage: 2 * 3\n        6\n\n    ::\n\n        sage: 2 * 4\n        8\n```\n\nThis seems to be a common pattern for writing tests. For an actual example, check the end of the output of `ideal?` for instance, also available [here](http://doc.sagemath.org/html/en/reference/rings/sage/rings/ideal.html#sage.rings.ideal.Ideal).\n\n\nReviewer: John Palmieri\n\nAuthor: Markus Wageringel\n\nBranch: 4d0badd20470a1a8b5143da51fc16fbc7e98393c\n\nCommit: 4d0badd20470a1a8b5143da51fc16fbc7e98393c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27896\n\n",
    "closed_at": "2019-06-27T20:13:26Z",
    "created_at": "2019-05-30T11:52:04Z",
    "labels": [
        "component: documentation",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Fix hiding of TESTS in documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27896",
    "user": "https://github.com/mwageringel"
}
```
The function `sage.misc.sagedoc.skip_TESTS_block` is responsible for hiding TESTS blocks from the documentation, but the case below is not correctly handled. As a result, all the tests below the line `::` are *not* hidden from the documentation.

```
    TESTS:

    Some description::

        sage: 2 * 3
        6

    ::

        sage: 2 * 4
        8
```

This seems to be a common pattern for writing tests. For an actual example, check the end of the output of `ideal?` for instance, also available [here](http://doc.sagemath.org/html/en/reference/rings/sage/rings/ideal.html#sage.rings.ideal.Ideal).


Reviewer: John Palmieri

Author: Markus Wageringel

Branch: 4d0badd20470a1a8b5143da51fc16fbc7e98393c

Commit: 4d0badd20470a1a8b5143da51fc16fbc7e98393c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27896





---

archive/issue_comments_390100.json:
```json
{
    "body": "<a id='comment:1'></a>Apparently, `::` gets interpreted as ReST header which can take the form\n\n```\nHeader\n::::::\n```\n\nThis commit adds special handling of `::` to avoid this.\n\n---\nNew commits:",
    "created_at": "2019-05-30T12:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390100",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>Apparently, `::` gets interpreted as ReST header which can take the form

```
Header
::::::
```

This commit adds special handling of `::` to avoid this.

---
New commits:



---

archive/issue_comments_390101.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-30T12:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390101",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390102.json:
```json
{
    "body": "<a id='comment:2'></a>There is one pyflakes warning about an unused import of `sage.all`. However, that import is needed for the line:\n\n```\nx = eval('sage.all.%s'%obj, locals())\n```\nRemoving the import makes the doctest of the corresponding function fail.\n\nThere is also a patchbot warning about insertion of triple colons. I am not sure what the intent of that warning is, but since I am using them in a regular expression, I guess that the warning is irrelevant. Otherwise, `:::+` can be replaced by `:{3,}`.",
    "created_at": "2019-05-31T06:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390102",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:2'></a>There is one pyflakes warning about an unused import of `sage.all`. However, that import is needed for the line:

```
x = eval('sage.all.%s'%obj, locals())
```
Removing the import makes the doctest of the corresponding function fail.

There is also a patchbot warning about insertion of triple colons. I am not sure what the intent of that warning is, but since I am using them in a regular expression, I guess that the warning is irrelevant. Otherwise, `:::+` can be replaced by `:{3,}`.



---

archive/issue_comments_390103.json:
```json
{
    "body": "<a id='comment:3'></a>Is a single colon valid reST? Can we change the end of `header` from `|:|:::+)` to `|:::+)`\n\nI suppose ideally, we would match a string of colons with matching text on the previous line, to make sure it really was a header, but we don't want to write a reST parser to solve this problem.",
    "created_at": "2019-06-01T00:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390103",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>Is a single colon valid reST? Can we change the end of `header` from `|:|:::+)` to `|:::+)`

I suppose ideally, we would match a string of colons with matching text on the previous line, to make sure it really was a header, but we don't want to write a reST parser to solve this problem.



---

archive/issue_comments_390104.json:
```json
{
    "body": "<a id='comment:4'></a>A reST header can have length 1 and can even look like this:\n\n```\n:\ne\n:\n\nThe Euler number.\n```\nThis is indeed interpreted as header by Sphinx. If we disallow single colons nevertheless, this should also apply to the other characters.\n\nI agree that ideally the line containing the header text should be taken into account, but it seems like a solution covering all the cases would add quite a bit of complexity for something that has not been a problem so far.",
    "created_at": "2019-06-01T09:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390104",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:4'></a>A reST header can have length 1 and can even look like this:

```
:
e
:

The Euler number.
```
This is indeed interpreted as header by Sphinx. If we disallow single colons nevertheless, this should also apply to the other characters.

I agree that ideally the line containing the header text should be taken into account, but it seems like a solution covering all the cases would add quite a bit of complexity for something that has not been a problem so far.



---

archive/issue_comments_390105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-11T04:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390105",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390106.json:
```json
{
    "body": "<a id='comment:5'></a>Fine.",
    "created_at": "2019-06-11T04:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390106",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>Fine.



---

archive/issue_comments_390107.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-27T20:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390107",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069156.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-27T20:13:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27896#event-69156"
}
```



---

archive/issue_comments_390108.json:
```json
{
    "body": "<a id='comment:7'></a>Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27896#issuecomment-390108",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.



---

archive/issue_events_069157.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27896",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27896#event-69157"
}
```
