# Issue 27978: sha1-based configure versioning

archive/issues_027741.json:
```json
{
    "body": "as [proposed](https://groups.google.com/d/msg/sage-release/E4vp20O2FN0/j0LfoSUtBAAJ) by Volker, \nextend the bootstrap script to save/load based on the git head sha1, e.g.:\n\n```\n    ./bootstrap -s\n\nsaves upstream/configure-<sha1>.tag.gz\n\n    ./bootstrap  -u http://path/to/upstream/\n\nloads http://path/to/upstream/configure-<sha1>.tag.gz\n```\n`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,\nso this is basically an extenion of `-D` option.\n\nWe also remove `-i` as not needed any more.\n\n**CC:**  @embray @vbraun\n\n**Branch:** [1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)\n\n**Reviewer:** Volker Braun\n\n**Author:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/27978\n\n",
    "closed_at": "2019-07-02T19:12:14Z",
    "created_at": "2019-06-12T19:48:59Z",
    "labels": [
        "component: build: configure",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "title": "sha1-based configure versioning",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/27978",
    "user": "https://github.com/dimpase"
}
```
as [proposed](https://groups.google.com/d/msg/sage-release/E4vp20O2FN0/j0LfoSUtBAAJ) by Volker, 
extend the bootstrap script to save/load based on the git head sha1, e.g.:

```
    ./bootstrap -s

saves upstream/configure-<sha1>.tag.gz

    ./bootstrap  -u http://path/to/upstream/

loads http://path/to/upstream/configure-<sha1>.tag.gz
```
`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,
so this is basically an extenion of `-D` option.

We also remove `-i` as not needed any more.

**CC:**  @embray @vbraun

**Branch:** [1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)

**Reviewer:** Volker Braun

**Author:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/27978





---

archive/issue_comments_438000.json:
```json
{
    "body": "<a id='comment:1'></a>\nIs there any need to keep the numeric version numbers?\n\nHow about simply switching from version numbers for configure to sha1 versions?\n\nThen `-i` should be just removed, and `-s` would mean `--save-head`, as in the proposal ?\n \nSo then the main change would be implementing `--load-head` (perhaps, `--load-from-url` is a better name).",
    "created_at": "2019-06-13T06:55:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438000",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
Is there any need to keep the numeric version numbers?

How about simply switching from version numbers for configure to sha1 versions?

Then `-i` should be just removed, and `-s` would mean `--save-head`, as in the proposal ?
 
So then the main change would be implementing `--load-head` (perhaps, `--load-from-url` is a better name).



---

archive/issue_comments_438001.json:
```json
{
    "body": "<a id='comment:2'></a>\nYes, we don't need consecutive numeric version numbers at all",
    "created_at": "2019-06-13T07:03:59Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438001",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
Yes, we don't need consecutive numeric version numbers at all



---

archive/issue_comments_438002.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n extend the bootstrap script to save/load based on the git head sha1, e.g.:\n \n ```\n-    ./bootstrap --save-head\n+    ./bootstrap --s\n \n saves upstream/configure-<sha1>.tag.gz\n \n@@ -10,3 +10,5 @@\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n+\n+and remove `-i` as not needed any more.\n``````\n",
    "created_at": "2019-06-13T08:37:31Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438002",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 extend the bootstrap script to save/load based on the git head sha1, e.g.:
 
 ```
-    ./bootstrap --save-head
+    ./bootstrap --s
 
 saves upstream/configure-<sha1>.tag.gz
 
@@ -10,3 +10,5 @@
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
+
+and remove `-i` as not needed any more.
``````




---

archive/issue_events_246924.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T08:37:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "rename": {
        "from": "implement ./bootstrap --save-head",
        "to": "sha1-based configure versioning"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246924"
}
```



---

archive/issue_comments_438003.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis was a good suggestion, thanks.  Would we still need to distribute all the tarball on the mirror though?  I'm not sure exactly how this will work.",
    "created_at": "2019-06-13T08:43:17Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438003",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
This was a good suggestion, thanks.  Would we still need to distribute all the tarball on the mirror though?  I'm not sure exactly how this will work.



---

archive/issue_comments_438004.json:
```json
{
    "body": "**Commit:** [69d274d6f6d887ee0cabf93e9717faa1fa03de34](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)",
    "created_at": "2019-06-13T08:57:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438004",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [69d274d6f6d887ee0cabf93e9717faa1fa03de34](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)



---

archive/issue_comments_438005.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2019-06-13T08:57:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438005",
    "user": "https://github.com/dimpase"
}
```

**Author:** Dima Pasechnik



---

archive/issue_comments_438006.json:
```json
{
    "body": "**Branch:** [public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)",
    "created_at": "2019-06-13T08:57:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438006",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)



---

archive/issue_comments_438007.json:
```json
{
    "body": "<a id='comment:5'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df844b6c272e4d417abe4b0ce56e1bb7483bb212\">df844b6</a></td><td><code>switch to sha1 for version \"number\", remove -i</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34\">69d274d</a></td><td><code>use new interface for checksum computation</code></td></tr></table>\n",
    "created_at": "2019-06-13T08:57:04Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438007",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df844b6c272e4d417abe4b0ce56e1bb7483bb212">df844b6</a></td><td><code>switch to sha1 for version "number", remove -i</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34">69d274d</a></td><td><code>use new interface for checksum computation</code></td></tr></table>




---

archive/issue_comments_438008.json:
```json
{
    "body": "<a id='comment:6'></a>\nSo far, the branch just does the switch to sha1 from \"number\".\n\nThe url to download the configure tarball may be stored somewhere, maybe in `build/pkgs/configure/checksum.ini` ?",
    "created_at": "2019-06-13T09:01:09Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438008",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
So far, the branch just does the switch to sha1 from "number".

The url to download the configure tarball may be stored somewhere, maybe in `build/pkgs/configure/checksum.ini` ?



---

archive/issue_comments_438009.json:
```json
{
    "body": "<a id='comment:7'></a>\nIn my proposal the download base url is a parameter to bootstrap, since the buildbot and patchbots may want to use different servers. And its then easy enough to supply the location in the build step configuration, and you don't need to distribute the confballs on the mirror network.",
    "created_at": "2019-06-13T10:35:32Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438009",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
In my proposal the download base url is a parameter to bootstrap, since the buildbot and patchbots may want to use different servers. And its then easy enough to supply the location in the build step configuration, and you don't need to distribute the confballs on the mirror network.



---

archive/issue_comments_438010.json:
```json
{
    "body": "<a id='comment:8'></a>\nBut what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?",
    "created_at": "2019-06-13T10:54:55Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438010",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?



---

archive/issue_comments_438011.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608\">8367d56</a></td><td><code>implement fetching configure tarball from an URL</code></td></tr></table>\n",
    "created_at": "2019-06-13T11:15:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608">8367d56</a></td><td><code>implement fetching configure tarball from an URL</code></td></tr></table>




---

archive/issue_comments_438012.json:
```json
{
    "body": "**Changing commit** from \"[69d274d6f6d887ee0cabf93e9717faa1fa03de34](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)\" to \"[8367d565e2157574e3ed51150ebf02f35bafe608](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)\".",
    "created_at": "2019-06-13T11:15:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[69d274d6f6d887ee0cabf93e9717faa1fa03de34](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)" to "[8367d565e2157574e3ed51150ebf02f35bafe608](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)".



---

archive/issue_comments_438013.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,11 +2,11 @@\n extend the bootstrap script to save/load based on the git head sha1, e.g.:\n \n ```\n-    ./bootstrap --s\n+    ./bootstrap -s\n \n saves upstream/configure-<sha1>.tag.gz\n \n-    ./bootstrap  --load-head http://path/to/upstream/\n+    ./bootstrap  -u http://path/to/upstream/\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n``````\n",
    "created_at": "2019-06-13T11:16:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438013",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,11 +2,11 @@
 extend the bootstrap script to save/load based on the git head sha1, e.g.:
 
 ```
-    ./bootstrap --s
+    ./bootstrap -s
 
 saves upstream/configure-<sha1>.tag.gz
 
-    ./bootstrap  --load-head http://path/to/upstream/
+    ./bootstrap  -u http://path/to/upstream/
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
``````




---

archive/issue_events_246925.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T11:16:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246925"
}
```



---

archive/issue_comments_438014.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, so here it is.",
    "created_at": "2019-06-13T11:16:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438014",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
OK, so here it is.



---

archive/issue_comments_438015.json:
```json
{
    "body": "<a id='comment:11'></a>\nbasically, `-u <URL>` triggers uploading the URL to upstream/, \nand it implies `-D`.\n\nif the resulting tarball does not match the present branch, too bad, it will fail\n(unless it succeeds to download from the \"usual\" Sage mirrors)",
    "created_at": "2019-06-13T11:19:55Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438015",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
basically, `-u <URL>` triggers uploading the URL to upstream/, 
and it implies `-D`.

if the resulting tarball does not match the present branch, too bad, it will fail
(unless it succeeds to download from the "usual" Sage mirrors)



---

archive/issue_comments_438016.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@embray](#comment%3A8):\n> But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?\n\na package tarball is a package tarball. Is there a special-casing for configure package in patch/buildbot configs? \n\nI presume mentioning its URL in the ticket description should be equivalent to what we do with the \"normal\" packages (for this the new `-u` feature doesn't seem to be needed). And release tools can make use of it in some way too.",
    "created_at": "2019-06-13T11:31:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438016",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
Replying to [@embray](#comment%3A8):
> But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?

a package tarball is a package tarball. Is there a special-casing for configure package in patch/buildbot configs? 

I presume mentioning its URL in the ticket description should be equivalent to what we do with the "normal" packages (for this the new `-u` feature doesn't seem to be needed). And release tools can make use of it in some way too.



---

archive/issue_comments_438017.json:
```json
{
    "body": "<a id='comment:13'></a>\nI've asked Harald & Wiliam for what a good \"default\" serving url is in the current webserver, but we don't necessarily have to implement that fallback here.",
    "created_at": "2019-06-13T12:43:57Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438017",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
I've asked Harald & Wiliam for what a good "default" serving url is in the current webserver, but we don't necessarily have to implement that fallback here.



---

archive/issue_comments_438018.json:
```json
{
    "body": "<a id='comment:14'></a>\nWe'll go with http://old.files.sagemath.org/configure/",
    "created_at": "2019-06-13T13:11:14Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438018",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>
We'll go with http://old.files.sagemath.org/configure/



---

archive/issue_comments_438019.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,5 +10,7 @@\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n+`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,\n+so this is basically an extenion of `-D` option.\n \n-and remove `-i` as not needed any more.\n+We also remove `-i` as not needed any more.\n``````\n",
    "created_at": "2019-06-13T13:27:57Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438019",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,5 +10,7 @@
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
+`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,
+so this is basically an extenion of `-D` option.
 
-and remove `-i` as not needed any more.
+We also remove `-i` as not needed any more.
``````




---

archive/issue_events_246926.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T18:39:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246926"
}
```



---

archive/issue_events_246927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T18:39:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246927"
}
```



---

archive/issue_comments_438020.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2019-07-01T18:39:00Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438020",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_438021.json:
```json
{
    "body": "<a id='comment:17'></a>\n/src/bin/sage-update-version calls bootstrap -i which is now an illegal argument error",
    "created_at": "2019-07-01T19:48:46Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438021",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
/src/bin/sage-update-version calls bootstrap -i which is now an illegal argument error



---

archive/issue_events_246928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T19:48:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246928"
}
```



---

archive/issue_events_246929.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T19:48:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246929"
}
```



---

archive/issue_comments_438022.json:
```json
{
    "body": "<a id='comment:18'></a>\nwould just removing that \u201c-i\u201d there be good enough?",
    "created_at": "2019-07-01T20:10:58Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438022",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
would just removing that “-i” there be good enough?



---

archive/issue_comments_438023.json:
```json
{
    "body": "<a id='comment:19'></a>\nYes, just needs to be removed I think\n\nAlso:\n\n```\n    if [ $CONFTARBALL_URL != \"\" ]; then\n        [...]\n    fi\n    bootstrap-download || exit $?\n```\nalways ends up calling bootstrap-download, should be in an else branch",
    "created_at": "2019-07-01T20:33:31Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438023",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
Yes, just needs to be removed I think

Also:

```
    if [ $CONFTARBALL_URL != "" ]; then
        [...]
    fi
    bootstrap-download || exit $?
```
always ends up calling bootstrap-download, should be in an else branch



---

archive/issue_comments_438024.json:
```json
{
    "body": "**Changing commit** from \"[8367d565e2157574e3ed51150ebf02f35bafe608](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)\" to \"[e58bab67b00e8cce7f5ce0646672ae228fe20928](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)\".",
    "created_at": "2019-07-01T20:53:51Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8367d565e2157574e3ed51150ebf02f35bafe608](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)" to "[e58bab67b00e8cce7f5ce0646672ae228fe20928](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)".



---

archive/issue_comments_438025.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0340eeac306b8d14fc294e6dfeac871ee2d3c6f\">f0340ee</a></td><td><code>no more '-i'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928\">e58bab6</a></td><td><code>move bootstrap-download call</code></td></tr></table>\n",
    "created_at": "2019-07-01T20:53:51Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0340eeac306b8d14fc294e6dfeac871ee2d3c6f">f0340ee</a></td><td><code>no more '-i'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928">e58bab6</a></td><td><code>move bootstrap-download call</code></td></tr></table>




---

archive/issue_events_246930.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-01T20:54:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246930"
}
```



---

archive/issue_events_246931.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-01T20:54:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246931"
}
```



---

archive/issue_comments_438026.json:
```json
{
    "body": "**Changing commit** from \"[e58bab67b00e8cce7f5ce0646672ae228fe20928](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)\" to \"[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)\".",
    "created_at": "2019-07-02T17:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e58bab67b00e8cce7f5ce0646672ae228fe20928](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)" to "[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)".



---

archive/issue_comments_438027.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37\">1cab029</a></td><td><code>Use the stored instead of the current sha1 when loading.</code></td></tr></table>\n",
    "created_at": "2019-07-02T17:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438027",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37">1cab029</a></td><td><code>Use the stored instead of the current sha1 when loading.</code></td></tr></table>




---

archive/issue_comments_438028.json:
```json
{
    "body": "<a id='comment:23'></a>\nThere was also the following logic error: The confball checksum needs to be checked in, changing the sha1. So when restoring we need to use the sha1 from package-version.txt and not the current HEAD sha1.\n\nAlso, sage-download-file used to ignore error.",
    "created_at": "2019-07-02T17:09:55Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438028",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>
There was also the following logic error: The confball checksum needs to be checked in, changing the sha1. So when restoring we need to use the sha1 from package-version.txt and not the current HEAD sha1.

Also, sage-download-file used to ignore error.



---

archive/issue_comments_438029.json:
```json
{
    "body": "<a id='comment:24'></a>\nI merely assumed that with CONFTARBALL_URL one can install an arbitrary configure verrsion, not one in any way related to the current repo state. Certainly if your need the latter, this is fine too.",
    "created_at": "2019-07-02T18:07:59Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438029",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
I merely assumed that with CONFTARBALL_URL one can install an arbitrary configure verrsion, not one in any way related to the current repo state. Certainly if your need the latter, this is fine too.



---

archive/issue_comments_438030.json:
```json
{
    "body": "<a id='comment:25'></a>\nI think its better to have bootstrap figure out the confball to download, otherwise the buildbot needs to rummage around in the sources which is all rather complicated.",
    "created_at": "2019-07-02T19:12:03Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438030",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
I think its better to have bootstrap figure out the confball to download, otherwise the buildbot needs to rummage around in the sources which is all rather complicated.



---

archive/issue_comments_438031.json:
```json
{
    "body": "**Changing branch** from \"[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)\" to \"[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)\".",
    "created_at": "2019-07-02T19:12:14Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438031",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)" to "[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)".



---

archive/issue_events_246932.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-02T19:12:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246932"
}
```



---

archive/issue_events_246933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6fd12b83387b4658062ce7af6ddf23d68d9da17e",
    "created_at": "2019-07-02T19:12:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-246933"
}
```



---

archive/issue_comments_438032.json:
```json
{
    "body": "**Changing commit** from \"[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)\" to \"\".",
    "created_at": "2019-07-03T11:24:33Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438032",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[1cab029ccaafc6158ece9187e7cedc0ba6bdab37](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)" to "".



---

archive/issue_comments_438033.json:
```json
{
    "body": "<a id='comment:27'></a>\nSo now what are we supposed to do for building in a fresh Sage repository when we need the configure tarball?  Just running `make configure` blows up with an error that the relevant tarball can't be found.",
    "created_at": "2019-07-03T11:24:33Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438033",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
So now what are we supposed to do for building in a fresh Sage repository when we need the configure tarball?  Just running `make configure` blows up with an error that the relevant tarball can't be found.



---

archive/issue_comments_438034.json:
```json
{
    "body": "<a id='comment:28'></a>\nAre you talking about the transition from old versioning to the new one?",
    "created_at": "2019-07-03T11:31:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438034",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
Are you talking about the transition from old versioning to the new one?



---

archive/issue_comments_438035.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@dimpase](#comment%3A28):\n> Are you talking about the transition from old versioning to the new one?\n\nI don't know. Am I?  On a fresh VM in a fresh build of Sage I just get sage-download blowing up that it can't find `configure-<sha1>.tar.gz`.",
    "created_at": "2019-07-03T11:44:42Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438035",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
Replying to [@dimpase](#comment%3A28):
> Are you talking about the transition from old versioning to the new one?

I don't know. Am I?  On a fresh VM in a fresh build of Sage I just get sage-download blowing up that it can't find `configure-<sha1>.tar.gz`.



---

archive/issue_comments_438036.json:
```json
{
    "body": "<a id='comment:30'></a>\nI think I must be seeing #28099.  Likewise on my buildbot:\n\n```\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'\n************************************************************************\nTraceback (most recent call last):\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py\", line 118, in run_safe\n    run()\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py\", line 98, in run\n    app.download_url(args.url_or_tarball, args.destination)\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/app.py\", line 39, in download_url\n    Download(url, destination, progress=not self.quiet, ignore_errors=False).run()\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/transfer.py\", line 137, in run\n    raise error\nDownloadError: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'\n************************************************************************\nError: downloading configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz from http://old.files.sagemath.org/configure/ failed\n```",
    "created_at": "2019-07-03T11:51:29Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438036",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
I think I must be seeing #28099.  Likewise on my buildbot:

```
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'
************************************************************************
Traceback (most recent call last):
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py", line 118, in run_safe
    run()
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py", line 98, in run
    app.download_url(args.url_or_tarball, args.destination)
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/app.py", line 39, in download_url
    Download(url, destination, progress=not self.quiet, ignore_errors=False).run()
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/transfer.py", line 137, in run
    raise error
DownloadError: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'
************************************************************************
Error: downloading configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz from http://old.files.sagemath.org/configure/ failed
```



---

archive/issue_comments_438037.json:
```json
{
    "body": "<a id='comment:31'></a>\ncould it be that Volker did not upload the configure tarball to mirrors yet?",
    "created_at": "2019-07-03T11:52:34Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438037",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
could it be that Volker did not upload the configure tarball to mirrors yet?



---

archive/issue_comments_438038.json:
```json
{
    "body": "<a id='comment:32'></a>\nyeah I guess #28099 will fix this.",
    "created_at": "2019-07-03T11:56:55Z",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-438038",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
yeah I guess #28099 will fix this.
