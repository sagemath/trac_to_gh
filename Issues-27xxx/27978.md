# Issue 27978: sha1-based configure versioning

archive/issues_027741.json:
```json
{
    "assignees": [],
    "body": "as [proposed](https://groups.google.com/d/msg/sage-release/E4vp20O2FN0/j0LfoSUtBAAJ) by Volker, \nextend the bootstrap script to save/load based on the git head sha1, e.g.:\n\n```\n    ./bootstrap -s\n\nsaves upstream/configure-<sha1>.tag.gz\n\n    ./bootstrap  -u http://path/to/upstream/\n\nloads http://path/to/upstream/configure-<sha1>.tag.gz\n```\n`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,\nso this is basically an extenion of `-D` option.\n\nWe also remove `-i` as not needed any more.\n\nCC:  @embray @vbraun\n\nBranch: **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**\n\nReviewer: **Volker Braun**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27978_\n\n",
    "closed_at": "2019-07-02T19:12:14Z",
    "created_at": "2019-06-12T19:48:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sha1-based configure versioning",
    "type": "issue",
    "updated_at": "2019-07-03T11:56:55Z",
    "url": "https://github.com/sagemath/sage/issues/27978",
    "user": "https://github.com/dimpase"
}
```
as [proposed](https://groups.google.com/d/msg/sage-release/E4vp20O2FN0/j0LfoSUtBAAJ) by Volker, 
extend the bootstrap script to save/load based on the git head sha1, e.g.:

```
    ./bootstrap -s

saves upstream/configure-<sha1>.tag.gz

    ./bootstrap  -u http://path/to/upstream/

loads http://path/to/upstream/configure-<sha1>.tag.gz
```
`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,
so this is basically an extenion of `-D` option.

We also remove `-i` as not needed any more.

CC:  @embray @vbraun

Branch: **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**

Reviewer: **Volker Braun**

Author: **Dima Pasechnik**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/27978_





---

archive/issue_events_380732.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-12T19:48:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380732"
}
```



---

archive/issue_events_380733.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-12T19:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380733"
}
```



---

archive/issue_events_380734.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-12T19:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380734"
}
```



---

archive/issue_events_380735.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-12T19:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380735"
}
```



---

archive/issue_comments_435192.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIs there any need to keep the numeric version numbers?\n\nHow about simply switching from version numbers for configure to sha1 versions?\n\nThen `-i` should be just removed, and `-s` would mean `--save-head`, as in the proposal ?\n \nSo then the main change would be implementing `--load-head` (perhaps, `--load-from-url` is a better name).",
    "created_at": "2019-06-13T06:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435192",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

Is there any need to keep the numeric version numbers?

How about simply switching from version numbers for configure to sha1 versions?

Then `-i` should be just removed, and `-s` would mean `--save-head`, as in the proposal ?
 
So then the main change would be implementing `--load-head` (perhaps, `--load-from-url` is a better name).



---

archive/issue_comments_435193.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYes, we don't need consecutive numeric version numbers at all",
    "created_at": "2019-06-13T07:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435193",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

Yes, we don't need consecutive numeric version numbers at all



---

archive/issue_comments_435194.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n extend the bootstrap script to save/load based on the git head sha1, e.g.:\n \n ```\n-    ./bootstrap --save-head\n+    ./bootstrap --s\n \n saves upstream/configure-<sha1>.tag.gz\n \n@@ -10,3 +10,5 @@\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n+\n+and remove `-i` as not needed any more.\n``````\n",
    "created_at": "2019-06-13T08:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435194",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 extend the bootstrap script to save/load based on the git head sha1, e.g.:
 
 ```
-    ./bootstrap --save-head
+    ./bootstrap --s
 
 saves upstream/configure-<sha1>.tag.gz
 
@@ -10,3 +10,5 @@
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
+
+and remove `-i` as not needed any more.
``````




---

archive/issue_events_380736.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T08:37:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "title_is": "sha1-based configure versioning",
    "title_was": "implement ./bootstrap --save-head",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380736"
}
```



---

archive/issue_comments_435195.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis was a good suggestion, thanks.  Would we still need to distribute all the tarball on the mirror though?  I'm not sure exactly how this will work.",
    "created_at": "2019-06-13T08:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435195",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

This was a good suggestion, thanks.  Would we still need to distribute all the tarball on the mirror though?  I'm not sure exactly how this will work.



---

archive/issue_comments_435196.json:
```json
{
    "body": "Commit: **[`69d274d`](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)**",
    "created_at": "2019-06-13T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435196",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`69d274d`](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)**



---

archive/issue_comments_435197.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-06-13T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435197",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_435198.json:
```json
{
    "body": "Branch: **[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)**",
    "created_at": "2019-06-13T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435198",
    "user": "https://github.com/dimpase"
}
```

Branch: **[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)**



---

archive/issue_comments_435199.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df844b6c272e4d417abe4b0ce56e1bb7483bb212\"><code>df844b6</code></a></td><td><code>switch to sha1 for version \"number\", remove -i</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34\"><code>69d274d</code></a></td><td><code>use new interface for checksum computation</code></td></tr></table>\n",
    "created_at": "2019-06-13T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435199",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df844b6c272e4d417abe4b0ce56e1bb7483bb212"><code>df844b6</code></a></td><td><code>switch to sha1 for version "number", remove -i</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34"><code>69d274d</code></a></td><td><code>use new interface for checksum computation</code></td></tr></table>




---

archive/issue_comments_435200.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSo far, the branch just does the switch to sha1 from \"number\".\n\nThe url to download the configure tarball may be stored somewhere, maybe in `build/pkgs/configure/checksum.ini` ?",
    "created_at": "2019-06-13T09:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435200",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

So far, the branch just does the switch to sha1 from "number".

The url to download the configure tarball may be stored somewhere, maybe in `build/pkgs/configure/checksum.ini` ?



---

archive/issue_comments_435201.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIn my proposal the download base url is a parameter to bootstrap, since the buildbot and patchbots may want to use different servers. And its then easy enough to supply the location in the build step configuration, and you don't need to distribute the confballs on the mirror network.",
    "created_at": "2019-06-13T10:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435201",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

In my proposal the download base url is a parameter to bootstrap, since the buildbot and patchbots may want to use different servers. And its then easy enough to supply the location in the build step configuration, and you don't need to distribute the confballs on the mirror network.



---

archive/issue_comments_435202.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nBut what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?",
    "created_at": "2019-06-13T10:54:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435202",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?



---

archive/issue_comments_435203.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608\"><code>8367d56</code></a></td><td><code>implement fetching configure tarball from an URL</code></td></tr></table>\n",
    "created_at": "2019-06-13T11:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435203",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608"><code>8367d56</code></a></td><td><code>implement fetching configure tarball from an URL</code></td></tr></table>




---

archive/issue_comments_435204.json:
```json
{
    "body": "Changed commit from **[`69d274d`](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)** to **[`8367d56`](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)**",
    "created_at": "2019-06-13T11:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435204",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`69d274d`](https://github.com/sagemath/sagetrac-mirror/commit/69d274d6f6d887ee0cabf93e9717faa1fa03de34)** to **[`8367d56`](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)**



---

archive/issue_comments_435205.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,11 @@\n extend the bootstrap script to save/load based on the git head sha1, e.g.:\n \n ```\n-    ./bootstrap --s\n+    ./bootstrap -s\n \n saves upstream/configure-<sha1>.tag.gz\n \n-    ./bootstrap  --load-head http://path/to/upstream/\n+    ./bootstrap  -u http://path/to/upstream/\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n``````\n",
    "created_at": "2019-06-13T11:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435205",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,11 @@
 extend the bootstrap script to save/load based on the git head sha1, e.g.:
 
 ```
-    ./bootstrap --s
+    ./bootstrap -s
 
 saves upstream/configure-<sha1>.tag.gz
 
-    ./bootstrap  --load-head http://path/to/upstream/
+    ./bootstrap  -u http://path/to/upstream/
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
``````




---

archive/issue_events_380737.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T11:16:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380737"
}
```



---

archive/issue_comments_435206.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOK, so here it is.",
    "created_at": "2019-06-13T11:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435206",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

OK, so here it is.



---

archive/issue_comments_435207.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nbasically, `-u <URL>` triggers uploading the URL to upstream/, \nand it implies `-D`.\n\nif the resulting tarball does not match the present branch, too bad, it will fail\n(unless it succeeds to download from the \"usual\" Sage mirrors)",
    "created_at": "2019-06-13T11:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435207",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

basically, `-u <URL>` triggers uploading the URL to upstream/, 
and it implies `-D`.

if the resulting tarball does not match the present branch, too bad, it will fail
(unless it succeeds to download from the "usual" Sage mirrors)



---

archive/issue_comments_435208.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@embray](#comment%3A8):\n> But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?\n\na package tarball is a package tarball. Is there a special-casing for configure package in patch/buildbot configs? \n\nI presume mentioning its URL in the ticket description should be equivalent to what we do with the \"normal\" packages (for this the new `-u` feature doesn't seem to be needed). And release tools can make use of it in some way too.",
    "created_at": "2019-06-13T11:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435208",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@embray](#comment%3A8):
> But what would be that location?  Say for the patchbots you'd want to have them get the configure tarball from a ticket attachment.  That could be done, but we'd have to modify the patchbot code to do that (doesn't sound too hard, I just want to make sure I understand properly).  What would be the standard location for the buildbots to check?

a package tarball is a package tarball. Is there a special-casing for configure package in patch/buildbot configs? 

I presume mentioning its URL in the ticket description should be equivalent to what we do with the "normal" packages (for this the new `-u` feature doesn't seem to be needed). And release tools can make use of it in some way too.



---

archive/issue_comments_435209.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI've asked Harald & Wiliam for what a good \"default\" serving url is in the current webserver, but we don't necessarily have to implement that fallback here.",
    "created_at": "2019-06-13T12:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435209",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

I've asked Harald & Wiliam for what a good "default" serving url is in the current webserver, but we don't necessarily have to implement that fallback here.



---

archive/issue_comments_435210.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWe'll go with http://old.files.sagemath.org/configure/",
    "created_at": "2019-06-13T13:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435210",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

We'll go with http://old.files.sagemath.org/configure/



---

archive/issue_comments_435211.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,7 @@\n \n loads http://path/to/upstream/configure-<sha1>.tag.gz\n ```\n+`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,\n+so this is basically an extenion of `-D` option.\n \n-and remove `-i` as not needed any more.\n+We also remove `-i` as not needed any more.\n``````\n",
    "created_at": "2019-06-13T13:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435211",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,7 @@
 
 loads http://path/to/upstream/configure-<sha1>.tag.gz
 ```
+`./bootstrap  -u <URL>` loads the tarball  to `upstream/` and checks that the checksum matches, as usual,
+so this is basically an extenion of `-D` option.
 
-and remove `-i` as not needed any more.
+We also remove `-i` as not needed any more.
``````




---

archive/issue_events_380738.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T18:39:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380738"
}
```



---

archive/issue_events_380739.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T18:39:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380739"
}
```



---

archive/issue_comments_435212.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2019-07-01T18:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435212",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_435213.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n/src/bin/sage-update-version calls bootstrap -i which is now an illegal argument error",
    "created_at": "2019-07-01T19:48:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435213",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

/src/bin/sage-update-version calls bootstrap -i which is now an illegal argument error



---

archive/issue_events_380740.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T19:48:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380740"
}
```



---

archive/issue_events_380741.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-01T19:48:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380741"
}
```



---

archive/issue_comments_435214.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nwould just removing that \u201c-i\u201d there be good enough?",
    "created_at": "2019-07-01T20:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435214",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

would just removing that “-i” there be good enough?



---

archive/issue_comments_435215.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYes, just needs to be removed I think\n\nAlso:\n\n```\n    if [ $CONFTARBALL_URL != \"\" ]; then\n        [...]\n    fi\n    bootstrap-download || exit $?\n```\nalways ends up calling bootstrap-download, should be in an else branch",
    "created_at": "2019-07-01T20:33:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435215",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Yes, just needs to be removed I think

Also:

```
    if [ $CONFTARBALL_URL != "" ]; then
        [...]
    fi
    bootstrap-download || exit $?
```
always ends up calling bootstrap-download, should be in an else branch



---

archive/issue_comments_435216.json:
```json
{
    "body": "Changed commit from **[`8367d56`](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)** to **[`e58bab6`](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)**",
    "created_at": "2019-07-01T20:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8367d56`](https://github.com/sagemath/sagetrac-mirror/commit/8367d565e2157574e3ed51150ebf02f35bafe608)** to **[`e58bab6`](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)**



---

archive/issue_comments_435217.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0340eeac306b8d14fc294e6dfeac871ee2d3c6f\"><code>f0340ee</code></a></td><td><code>no more '-i'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928\"><code>e58bab6</code></a></td><td><code>move bootstrap-download call</code></td></tr></table>\n",
    "created_at": "2019-07-01T20:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0340eeac306b8d14fc294e6dfeac871ee2d3c6f"><code>f0340ee</code></a></td><td><code>no more '-i'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928"><code>e58bab6</code></a></td><td><code>move bootstrap-download call</code></td></tr></table>




---

archive/issue_events_380742.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-01T20:54:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380742"
}
```



---

archive/issue_events_380743.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-07-01T20:54:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380743"
}
```



---

archive/issue_comments_435218.json:
```json
{
    "body": "Changed commit from **[`e58bab6`](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)** to **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**",
    "created_at": "2019-07-02T17:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e58bab6`](https://github.com/sagemath/sagetrac-mirror/commit/e58bab67b00e8cce7f5ce0646672ae228fe20928)** to **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**



---

archive/issue_comments_435219.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37\"><code>1cab029</code></a></td><td><code>Use the stored instead of the current sha1 when loading.</code></td></tr></table>\n",
    "created_at": "2019-07-02T17:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435219",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37"><code>1cab029</code></a></td><td><code>Use the stored instead of the current sha1 when loading.</code></td></tr></table>




---

archive/issue_comments_435220.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThere was also the following logic error: The confball checksum needs to be checked in, changing the sha1. So when restoring we need to use the sha1 from package-version.txt and not the current HEAD sha1.\n\nAlso, sage-download-file used to ignore error.",
    "created_at": "2019-07-02T17:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435220",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

There was also the following logic error: The confball checksum needs to be checked in, changing the sha1. So when restoring we need to use the sha1 from package-version.txt and not the current HEAD sha1.

Also, sage-download-file used to ignore error.



---

archive/issue_comments_435221.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI merely assumed that with CONFTARBALL_URL one can install an arbitrary configure verrsion, not one in any way related to the current repo state. Certainly if your need the latter, this is fine too.",
    "created_at": "2019-07-02T18:07:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435221",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

I merely assumed that with CONFTARBALL_URL one can install an arbitrary configure verrsion, not one in any way related to the current repo state. Certainly if your need the latter, this is fine too.



---

archive/issue_comments_435222.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think its better to have bootstrap figure out the confball to download, otherwise the buildbot needs to rummage around in the sources which is all rather complicated.",
    "created_at": "2019-07-02T19:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435222",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

I think its better to have bootstrap figure out the confball to download, otherwise the buildbot needs to rummage around in the sources which is all rather complicated.



---

archive/issue_comments_435223.json:
```json
{
    "body": "Changed branch from **[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)** to **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**",
    "created_at": "2019-07-02T19:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435223",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/build/sha1bootstrap](https://github.com/sagemath/sagetrac-mirror/tree/public/build/sha1bootstrap)** to **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)**



---

archive/issue_events_380744.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-02T19:12:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380744"
}
```



---

archive/issue_events_380745.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6fd12b83387b4658062ce7af6ddf23d68d9da17e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-07-02T19:12:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27978#event-380745"
}
```



---

archive/issue_comments_435224.json:
```json
{
    "body": "Changed commit from **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)** to none",
    "created_at": "2019-07-03T11:24:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435224",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`1cab029`](https://github.com/sagemath/sagetrac-mirror/commit/1cab029ccaafc6158ece9187e7cedc0ba6bdab37)** to none



---

archive/issue_comments_435225.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSo now what are we supposed to do for building in a fresh Sage repository when we need the configure tarball?  Just running `make configure` blows up with an error that the relevant tarball can't be found.",
    "created_at": "2019-07-03T11:24:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435225",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

So now what are we supposed to do for building in a fresh Sage repository when we need the configure tarball?  Just running `make configure` blows up with an error that the relevant tarball can't be found.



---

archive/issue_comments_435226.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAre you talking about the transition from old versioning to the new one?",
    "created_at": "2019-07-03T11:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435226",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

Are you talking about the transition from old versioning to the new one?



---

archive/issue_comments_435227.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@dimpase](#comment%3A28):\n> Are you talking about the transition from old versioning to the new one?\n\nI don't know. Am I?  On a fresh VM in a fresh build of Sage I just get sage-download blowing up that it can't find `configure-<sha1>.tar.gz`.",
    "created_at": "2019-07-03T11:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435227",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@dimpase](#comment%3A28):
> Are you talking about the transition from old versioning to the new one?

I don't know. Am I?  On a fresh VM in a fresh build of Sage I just get sage-download blowing up that it can't find `configure-<sha1>.tar.gz`.



---

archive/issue_comments_435228.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI think I must be seeing #28099.  Likewise on my buildbot:\n\n```\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'\n************************************************************************\nTraceback (most recent call last):\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py\", line 118, in run_safe\n    run()\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py\", line 98, in run\n    app.download_url(args.url_or_tarball, args.destination)\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/app.py\", line 39, in download_url\n    Download(url, destination, progress=not self.quiet, ignore_errors=False).run()\n  File \"/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/transfer.py\", line 137, in run\n    raise error\nDownloadError: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'\n************************************************************************\nError: downloading configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz from http://old.files.sagemath.org/configure/ failed\n```",
    "created_at": "2019-07-03T11:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435228",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

I think I must be seeing #28099.  Likewise on my buildbot:

```
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'
************************************************************************
Traceback (most recent call last):
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py", line 118, in run_safe
    run()
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/cmdline.py", line 98, in run
    app.download_url(args.url_or_tarball, args.destination)
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/app.py", line 39, in download_url
    Download(url, destination, progress=not self.quiet, ignore_errors=False).run()
  File "/home/Admin/sage-buildbot-worker/sage_git/build/build/bin/../sage_bootstrap/download/transfer.py", line 137, in run
    raise error
DownloadError: [Errno 404] Not Found: '//old.files.sagemath.org/configure//configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz'
************************************************************************
Error: downloading configure-6fd12b83387b4658062ce7af6ddf23d68d9da17e.tar.gz from http://old.files.sagemath.org/configure/ failed
```



---

archive/issue_comments_435229.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\ncould it be that Volker did not upload the configure tarball to mirrors yet?",
    "created_at": "2019-07-03T11:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435229",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

could it be that Volker did not upload the configure tarball to mirrors yet?



---

archive/issue_comments_435230.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nyeah I guess #28099 will fix this.",
    "created_at": "2019-07-03T11:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27978#issuecomment-435230",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

yeah I guess #28099 will fix this.
