# Issue 27573: PRESENT Block Cipher

archive/issues_027336.json:
```json
{
    "body": "Implementation of the ultra-lightweight block cipher PRESENT.\n\n\nCC:  @pfasante\n\nKeywords: PRESENT\n\nReviewer: Friedrich Wiemer\n\nAuthor: Lukas Stennes\n\nBranch: 798421b817a008b12d74fa47a6ff40a10a0bdbee\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27573\n\n",
    "closed_at": "2019-08-21T22:27:40Z",
    "created_at": "2019-03-30T15:36:52Z",
    "labels": [
        "component: cryptography"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "PRESENT Block Cipher",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27573",
    "user": "https://github.com/yhxnf"
}
```
Implementation of the ultra-lightweight block cipher PRESENT.


CC:  @pfasante

Keywords: PRESENT

Reviewer: Friedrich Wiemer

Author: Lukas Stennes

Branch: 798421b817a008b12d74fa47a6ff40a10a0bdbee

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27573





---

archive/issue_comments_410427.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-30T15:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410427",
    "user": "https://github.com/yhxnf"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_410428.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-30T20:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410429.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-07T17:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410430.json:
```json
{
    "body": "<a id='comment:6'></a>I would rename the `doLastLinearLayer` argument to `doFinalRound`, as this will fit/be more consistent, when implementing other block ciphers.\n\nI also reviewed the ticket and it lgtm, but maybe someone else also want to take a look?",
    "created_at": "2019-05-02T13:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410430",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:6'></a>I would rename the `doLastLinearLayer` argument to `doFinalRound`, as this will fit/be more consistent, when implementing other block ciphers.

I also reviewed the ticket and it lgtm, but maybe someone else also want to take a look?



---

archive/issue_comments_410431.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-03T20:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410432.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410432",
    "user": "https://github.com/pfasante"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410433.json:
```json
{
    "body": "<a id='comment:8'></a>I'm setting this to positive review now.",
    "created_at": "2019-06-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410433",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:8'></a>I'm setting this to positive review now.



---

archive/issue_comments_410434.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-06-17T13:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410434",
    "user": "https://github.com/pfasante"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_410435.json:
```json
{
    "body": "<a id='comment:9'></a>Actually I realised that I would like to have some design changes.\n\nIn principle, so that this is easier to do experiments with, it should be easy to modify the cipher. I have something in mind like the following:\n\n```\nsage: cipher = PRESENT(rounds=1, doLastLinearLayer=False)\nsage: cipher.sbox = SBox(range(16))\nsage: cipher.key_schedule = lambda x: [0, 0]  # return the 0 keys as round keys\nsage: cipher.encrypt(plain=0x1234, key=0x0) == 0x1234\nTrue\n```\n\nSo this would require the implementation to split the encrypt function into a `round` function that uses an `sboxlayer` function and a `linearlayer` function, the `sboxlayer` uses the member variable `sbox`. All these should not be internal functions, but visible and documented, so that the user knows about them and that it is possible to modify them.\n\nI hope this is clear, otherwise I can specify this further.",
    "created_at": "2019-06-17T13:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410435",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:9'></a>Actually I realised that I would like to have some design changes.

In principle, so that this is easier to do experiments with, it should be easy to modify the cipher. I have something in mind like the following:

```
sage: cipher = PRESENT(rounds=1, doLastLinearLayer=False)
sage: cipher.sbox = SBox(range(16))
sage: cipher.key_schedule = lambda x: [0, 0]  # return the 0 keys as round keys
sage: cipher.encrypt(plain=0x1234, key=0x0) == 0x1234
True
```

So this would require the implementation to split the encrypt function into a `round` function that uses an `sboxlayer` function and a `linearlayer` function, the `sboxlayer` uses the member variable `sbox`. All these should not be internal functions, but visible and documented, so that the user knows about them and that it is possible to modify them.

I hope this is clear, otherwise I can specify this further.



---

archive/issue_comments_410436.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2019-06-19T16:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_events_068485.json:
```json
{
    "actor": "https://github.com/yhxnf",
    "created_at": "2019-06-19T16:25:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27573#event-68485"
}
```



---

archive/issue_comments_410437.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-25T07:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410438.json:
```json
{
    "body": "<a id='comment:13'></a>OK, LGTM with one last point:\n\nIf you do the following import in an example\n\n```\nsage: from sage.crypto.block_cipher.present import _convert_to_vector\n```\n\nI think the `_convert_to_vector` function should not be hidden by default.",
    "created_at": "2019-07-25T08:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410438",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:13'></a>OK, LGTM with one last point:

If you do the following import in an example

```
sage: from sage.crypto.block_cipher.present import _convert_to_vector
```

I think the `_convert_to_vector` function should not be hidden by default.



---

archive/issue_comments_410439.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-25T11:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410440.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-25T11:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410440",
    "user": "https://github.com/yhxnf"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_410441.json:
```json
{
    "body": "<a id='comment:16'></a>lgtm\n\nHowever, I have problems building the documentation, it fails with some error in the `categorie` docs -- which should actually not be related to this ticket? Maybe we should merge the latest development branch, for which I am able to build the documentation.",
    "created_at": "2019-08-02T12:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410441",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:16'></a>lgtm

However, I have problems building the documentation, it fails with some error in the `categorie` docs -- which should actually not be related to this ticket? Maybe we should merge the latest development branch, for which I am able to build the documentation.



---

archive/issue_comments_410442.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-04T19:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410442",
    "user": "https://github.com/pfasante"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410443.json:
```json
{
    "body": "<a id='comment:18'></a>I just did the rebase on the latest develop branch.\n\nDocs now build correctly.\n\nLGTM\n\n---\nNew commits:",
    "created_at": "2019-08-04T19:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410443",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:18'></a>I just did the rebase on the latest develop branch.

Docs now build correctly.

LGTM

---
New commits:



---

archive/issue_comments_410444.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-08-07T22:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410444",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_410445.json:
```json
{
    "body": "<a id='comment:19'></a>The PDF docs don't build\n\n```\n[docpdf] ! Package amsmath Error: \\begin{aligned} allowed only in math mode.\n[docpdf] \n[docpdf] See the amsmath package documentation for explanation.\n[docpdf] Type  H <return>  for immediate help.\n[docpdf]  ...                                              \n[docpdf]                                                   \n[docpdf] l.6727 \\ \n[docpdf]          [k_{79}k_{78}\\dots k_{1}k_{0}] &= [k_{18}k_{17}\\dots k_{20}k_{19}] \\\\\n[docpdf] ? \n[docpdf] ! Emergency stop.\n[docpdf]  ...                                              \n[docpdf]                                                   \n[docpdf] l.6727 \\ \n[docpdf]          [k_{79}k_{78}\\dots k_{1}k_{0}] &= [k_{18}k_{17}\\dots k_{20}k_{19}] \\\\\n[docpdf] !  ==> Fatal error occurred, no output PDF file produced!\n[docpdf] Transcript written on cryptography.log.\n```",
    "created_at": "2019-08-07T22:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410445",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>The PDF docs don't build

```
[docpdf] ! Package amsmath Error: \begin{aligned} allowed only in math mode.
[docpdf] 
[docpdf] See the amsmath package documentation for explanation.
[docpdf] Type  H <return>  for immediate help.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.6727 \ 
[docpdf]          [k_{79}k_{78}\dots k_{1}k_{0}] &= [k_{18}k_{17}\dots k_{20}k_{19}] \\
[docpdf] ? 
[docpdf] ! Emergency stop.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.6727 \ 
[docpdf]          [k_{79}k_{78}\dots k_{1}k_{0}] &= [k_{18}k_{17}\dots k_{20}k_{19}] \\
[docpdf] !  ==> Fatal error occurred, no output PDF file produced!
[docpdf] Transcript written on cryptography.log.
```



---

archive/issue_comments_410446.json:
```json
{
    "body": "<a id='comment:20'></a>New commits:",
    "created_at": "2019-08-08T07:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410446",
    "user": "https://github.com/yhxnf"
}
```

<a id='comment:20'></a>New commits:



---

archive/issue_comments_410447.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 vbraun]:\n> The PDF docs don't build\n\n\nshould be fixed now",
    "created_at": "2019-08-08T07:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410447",
    "user": "https://github.com/yhxnf"
}
```

<a id='comment:21'></a>Replying to [comment:19 vbraun]:
> The PDF docs don't build


should be fixed now



---

archive/issue_comments_410448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-08T07:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410448",
    "user": "https://github.com/yhxnf"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_410449.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-20T18:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410449",
    "user": "https://github.com/pfasante"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410450.json:
```json
{
    "body": "<a id='comment:23'></a>LGTM",
    "created_at": "2019-08-20T18:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410450",
    "user": "https://github.com/pfasante"
}
```

<a id='comment:23'></a>LGTM



---

archive/issue_events_068486.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-21T22:27:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27573#event-68486"
}
```



---

archive/issue_comments_410451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-21T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410451",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_410452.json:
```json
{
    "body": "<a id='comment:25'></a>This causes a doctest failure with Python 3. Follow up at #28403.",
    "created_at": "2019-08-26T02:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410452",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>This causes a doctest failure with Python 3. Follow up at #28403.



---

archive/issue_comments_410453.json:
```json
{
    "body": "<a id='comment:26'></a>I recall that development should now be done with python3. This would prevent this to happen.",
    "created_at": "2019-08-26T06:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27573#issuecomment-410453",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>I recall that development should now be done with python3. This would prevent this to happen.
