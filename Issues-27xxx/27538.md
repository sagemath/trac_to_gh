# Issue 27538: Cycle_basis giving wrong results in case of multiedges()

archive/issues_027301.json:
```json
{
    "body": "Assignee: @rajat1433\n\nCC:  @dcoudert\n\nKeywords: cycle\n\n\n```\nsage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)\n\nsage: G.cycle_basis()\n\ngetting \n\n[[1, 4], [1, 4]]\n\n```\n\nIt should be \n\n```\n[[5, 6, 4], [2, 3, 4, 1]]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27538\n\n",
    "closed_at": "2019-03-31T22:43:35Z",
    "created_at": "2019-03-23T11:48:49Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Cycle_basis giving wrong results in case of multiedges()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27538",
    "user": "https://github.com/rajat1433"
}
```
Assignee: @rajat1433

CC:  @dcoudert

Keywords: cycle


```
sage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)

sage: G.cycle_basis()

getting 

[[1, 4], [1, 4]]

```

It should be 

```
[[5, 6, 4], [2, 3, 4, 1]]
```


Issue created by migration from https://trac.sagemath.org/ticket/27538





---

archive/issue_comments_384481.json:
```json
{
    "body": "I think this discrepency is due to the is_forest function which in turn is calling is_tree function and in it following lines of code is written to return the found cycle:\n\n\n```\n            if self.has_multiple_edges():\n                if output == 'vertex':\n                    return (False, list(self.multiple_edges(sort=True)[0][:2]))\n                edge1, edge2 = self.multiple_edges(sort=True)[:2]\n                if edge1[0] != edge2[0]:\n                    return (False, [edge1, edge2])\n                return (False, [edge1, (edge2[1], edge2[0], edge2[2])])\n```",
    "created_at": "2019-03-23T11:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384481",
    "user": "https://github.com/rajat1433"
}
```

I think this discrepency is due to the is_forest function which in turn is calling is_tree function and in it following lines of code is written to return the found cycle:


```
            if self.has_multiple_edges():
                if output == 'vertex':
                    return (False, list(self.multiple_edges(sort=True)[0][:2]))
                edge1, edge2 = self.multiple_edges(sort=True)[:2]
                if edge1[0] != edge2[0]:
                    return (False, [edge1, edge2])
                return (False, [edge1, (edge2[1], edge2[0], edge2[2])])
```



---

archive/issue_comments_384482.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-03-23T11:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384482",
    "user": "https://github.com/rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_384483.json:
```json
{
    "body": "Problem is due to\n\n\n```\nsage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)\n\nsage: w=G.subgraph(edges=[(1,4,None)])\nsage: w\nSubgraph of (): Multi-graph on 7 vertices\nsage: w.edges()\n[(1, 4, None), (1, 4, None)]\n\n```\n\nSubgraph is returning with multiple edges instead it should have an edge 1 time(maybe).\n\nAlso I am not sure of the definition should the answer for this graph be \n\n```\n[[5, 6, 4], [2, 3, 4, 1]]\n```\n\nOR\n\n```\n[[5, 6, 4], [2, 3, 4, 1],[1,4],[2,3]]\n```",
    "created_at": "2019-03-23T12:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384483",
    "user": "https://github.com/rajat1433"
}
```

Problem is due to


```
sage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)

sage: w=G.subgraph(edges=[(1,4,None)])
sage: w
Subgraph of (): Multi-graph on 7 vertices
sage: w.edges()
[(1, 4, None), (1, 4, None)]

```

Subgraph is returning with multiple edges instead it should have an edge 1 time(maybe).

Also I am not sure of the definition should the answer for this graph be 

```
[[5, 6, 4], [2, 3, 4, 1]]
```

OR

```
[[5, 6, 4], [2, 3, 4, 1],[1,4],[2,3]]
```



---

archive/issue_comments_384484.json:
```json
{
    "body": "Graphs should be simple and unweighted :P\n\nConcerning `.subgraph`, the result you get is what is documented\n\n```\n        - ``vertices`` -- a single vertex or an iterable container of vertices,\n          e.g. a list, set, graph, file or numeric array. If not passed (i.e.,\n          ``None``), defaults to the entire graph.\n\n        - ``edges`` -- as with ``vertices``, edges can be a single edge or an\n          iterable container of edges (e.g., a list, set, file, numeric array,\n          etc.). By default (``edges=None``), all edges are assumed and the\n          returned graph is an induced subgraph. In the case of multiple edges,\n          specifying an edge as `(u,v)` means to keep all edges `(u,v)`,\n          regardless of the label.\n```\n\nThere is a mistake in the documentation. It is documented that `output` can be `'vertex'` or `'edges'`, but\n\n```\nsage: G.cycle_basis(output='edges')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-19-c82db06774e5> in <module>()\n----> 1 G.cycle_basis(output='edges')\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in cycle_basis(self, output)\n   4556         \"\"\"\n   4557         if not output in ['vertex', 'edge']:\n-> 4558             raise ValueError('output must be either vertex or edge')\n   4559 \n   4560         if self.allows_multiple_edges():\n\nValueError: output must be either vertex or edge\nsage: G.cycle_basis(output='edge')\n[[(1, 4, None), (4, 1, None)], [(1, 4, None), (4, 1, None)]]\n```\n\nI don't know how to fix the issue.",
    "created_at": "2019-03-24T18:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384484",
    "user": "https://github.com/dcoudert"
}
```

Graphs should be simple and unweighted :P

Concerning `.subgraph`, the result you get is what is documented

```
        - ``vertices`` -- a single vertex or an iterable container of vertices,
          e.g. a list, set, graph, file or numeric array. If not passed (i.e.,
          ``None``), defaults to the entire graph.

        - ``edges`` -- as with ``vertices``, edges can be a single edge or an
          iterable container of edges (e.g., a list, set, file, numeric array,
          etc.). By default (``edges=None``), all edges are assumed and the
          returned graph is an induced subgraph. In the case of multiple edges,
          specifying an edge as `(u,v)` means to keep all edges `(u,v)`,
          regardless of the label.
```

There is a mistake in the documentation. It is documented that `output` can be `'vertex'` or `'edges'`, but

```
sage: G.cycle_basis(output='edges')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-19-c82db06774e5> in <module>()
----> 1 G.cycle_basis(output='edges')

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in cycle_basis(self, output)
   4556         """
   4557         if not output in ['vertex', 'edge']:
-> 4558             raise ValueError('output must be either vertex or edge')
   4559 
   4560         if self.allows_multiple_edges():

ValueError: output must be either vertex or edge
sage: G.cycle_basis(output='edge')
[[(1, 4, None), (4, 1, None)], [(1, 4, None), (4, 1, None)]]
```

I don't know how to fix the issue.



---

archive/issue_comments_384485.json:
```json
{
    "body": "Replying to [comment:3 dcoudert]:\n> Graphs should be simple and unweighted :P\n\n\nbut in the examples of cycle_basis following is given:\nhere G is non simple \n\n```\nFor undirected graphs with multiple edges:\n\nsage: G = Graph([(0, 2, 'a'), (0, 2, 'b'), (0, 1, 'c'), (1, 2, 'd')], multiedges=True)\nsage: G.cycle_basis()\n[[0, 2], [2, 1, 0]]\nsage: G.cycle_basis(output='edge')\n[[(0, 2, 'a'), (2, 0, 'b')], [(2, 1, 'd'), (1, 0, 'c'), (0, 2, 'a')]]\n\n```",
    "created_at": "2019-03-25T04:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384485",
    "user": "https://github.com/rajat1433"
}
```

Replying to [comment:3 dcoudert]:
> Graphs should be simple and unweighted :P


but in the examples of cycle_basis following is given:
here G is non simple 

```
For undirected graphs with multiple edges:

sage: G = Graph([(0, 2, 'a'), (0, 2, 'b'), (0, 1, 'c'), (1, 2, 'd')], multiedges=True)
sage: G.cycle_basis()
[[0, 2], [2, 1, 0]]
sage: G.cycle_basis(output='edge')
[[(0, 2, 'a'), (2, 0, 'b')], [(2, 1, 'd'), (1, 0, 'c'), (0, 2, 'a')]]

```



---

archive/issue_comments_384486.json:
```json
{
    "body": "It was a joke. Our life would be much easier without multiedges...",
    "created_at": "2019-03-25T07:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384486",
    "user": "https://github.com/dcoudert"
}
```

It was a joke. Our life would be much easier without multiedges...



---

archive/issue_comments_384487.json:
```json
{
    "body": "Haha it really would be...",
    "created_at": "2019-03-25T09:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384487",
    "user": "https://github.com/rajat1433"
}
```

Haha it really would be...



---

archive/issue_comments_384488.json:
```json
{
    "body": "It will work fine if instead of this line in cycle_basis()\n\n```\nreturn [self.subgraph(edges=T + [e]).is_forest(certificate=True,\n                                                           output=output)[1]\n                    for e in self.edge_iterator() if not e in T]\n```\nwe use\n\n```\nreturn [Graph(edges=T + [e]).is_forest(certificate=True,\n                                                           output=output)[1]\n                    for e in self.edge_iterator() if not e in T]\n```\nSince self.subgraph(e) includes multiple existing copies of e as mentioned above in comment and, if two copies of e = (x,y) are in graph and suppose e got included in T, then there is a cycle including (x,y) always in subgraph(T+[e]), which is returned.\nSo, to avoid that we should use the above method.\nBut it will require extra overhead of creating Graph multiple times, maybe we can use this method only when G has parameter multiedges=True.",
    "created_at": "2019-03-28T18:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384488",
    "user": "https://github.com/abhayptp"
}
```

It will work fine if instead of this line in cycle_basis()

```
return [self.subgraph(edges=T + [e]).is_forest(certificate=True,
                                                           output=output)[1]
                    for e in self.edge_iterator() if not e in T]
```
we use

```
return [Graph(edges=T + [e]).is_forest(certificate=True,
                                                           output=output)[1]
                    for e in self.edge_iterator() if not e in T]
```
Since self.subgraph(e) includes multiple existing copies of e as mentioned above in comment and, if two copies of e = (x,y) are in graph and suppose e got included in T, then there is a cycle including (x,y) always in subgraph(T+[e]), which is returned.
So, to avoid that we should use the above method.
But it will require extra overhead of creating Graph multiple times, maybe we can use this method only when G has parameter multiedges=True.



---

archive/issue_comments_384489.json:
```json
{
    "body": "For, example this works right.\n\n```\nsage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)\nsage: T = G.min_spanning_tree()\nsage: [Graph(T + [e],  multiedges=True).is_forest(certificate=True, output='vertex')[1] for e in G.edge_iterator() if not e in T]\n[[4, 3, 2, 1], [6, 5, 4]]\n\n```\nThough, it will not return some cycle of length 2(resulting from multiple edges between two vertices) when multiple edges e gets included in T because 'if not e in T' evaluates to False then.",
    "created_at": "2019-03-28T18:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384489",
    "user": "https://github.com/abhayptp"
}
```

For, example this works right.

```
sage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)
sage: T = G.min_spanning_tree()
sage: [Graph(T + [e],  multiedges=True).is_forest(certificate=True, output='vertex')[1] for e in G.edge_iterator() if not e in T]
[[4, 3, 2, 1], [6, 5, 4]]

```
Though, it will not return some cycle of length 2(resulting from multiple edges between two vertices) when multiple edges e gets included in T because 'if not e in T' evaluates to False then.



---

archive/issue_comments_384490.json:
```json
{
    "body": "I think the answer should be \n\n```\n[[5, 6, 4], [2, 3, 4, 1],[1,4],[2,3]]\n```\n\naccording to definition of cycle_basis.\nhttps://en.wikipedia.org/wiki/Cycle_basis",
    "created_at": "2019-03-28T19:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384490",
    "user": "https://github.com/rajat1433"
}
```

I think the answer should be 

```
[[5, 6, 4], [2, 3, 4, 1],[1,4],[2,3]]
```

according to definition of cycle_basis.
https://en.wikipedia.org/wiki/Cycle_basis



---

archive/issue_comments_384491.json:
```json
{
    "body": "Yes.\nI think it fixes this.\n\n```\nsage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)\nsage: T = G.min_spanning_tree()\nsage: H = G.copy()\nsage: H.delete_edges(T)\nsage: [Graph(T + [e],  multiedges=True).is_forest(certificate=True, output='vertex')[1] for e in H.edge_iterator()]\n[[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]\n```",
    "created_at": "2019-03-28T19:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384491",
    "user": "https://github.com/abhayptp"
}
```

Yes.
I think it fixes this.

```
sage: G = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)
sage: T = G.min_spanning_tree()
sage: H = G.copy()
sage: H.delete_edges(T)
sage: [Graph(T + [e],  multiedges=True).is_forest(certificate=True, output='vertex')[1] for e in H.edge_iterator()]
[[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]
```



---

archive/issue_comments_384492.json:
```json
{
    "body": "I have sent diff #27563 for it by mistake instead of sending diff on this ticket.\nPlease review it.\\\\\nI have imported Graph from sage.graphs.graph in cycle_basis() function to create instance of Graph.",
    "created_at": "2019-03-28T22:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384492",
    "user": "https://github.com/abhayptp"
}
```

I have sent diff #27563 for it by mistake instead of sending diff on this ticket.
Please review it.\\
I have imported Graph from sage.graphs.graph in cycle_basis() function to create instance of Graph.



---

archive/issue_comments_384493.json:
```json
{
    "body": "I suggest to move the branch from #27563 to this ticket and mark #27563 as duplicate. The motivation for that is that the discussion is in this ticket.\n\nSome comments on the branch:\n- instead of calling `is_forest`, you should call `is_tree`. Indeed, at this point of the code, you know that the graph is connected, so there is no need to check that again in `is_forest`. Actually, method `is_tree` will also check if the graph is connected.\n- align `output=output` below `certificate=True`\n- add a doctest with the example of this ticket",
    "created_at": "2019-03-29T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384493",
    "user": "https://github.com/dcoudert"
}
```

I suggest to move the branch from #27563 to this ticket and mark #27563 as duplicate. The motivation for that is that the discussion is in this ticket.

Some comments on the branch:
- instead of calling `is_forest`, you should call `is_tree`. Indeed, at this point of the code, you know that the graph is connected, so there is no need to check that again in `is_forest`. Actually, method `is_tree` will also check if the graph is connected.
- align `output=output` below `certificate=True`
- add a doctest with the example of this ticket



---

archive/issue_comments_384494.json:
```json
{
    "body": "`@`gh-abhayptp can you make the requested changes, then we can move that branch to here. If you require any help let me know.",
    "created_at": "2019-03-29T11:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384494",
    "user": "https://github.com/rajat1433"
}
```

`@`gh-abhayptp can you make the requested changes, then we can move that branch to here. If you require any help let me know.



---

archive/issue_comments_384495.json:
```json
{
    "body": "Added doctests and made the required changes.\\\\\nThere were some extra whitespaces at 4 places in the file which have also been removed. My editor automatically did that :p \\\\\nI can undo that change if anyone wants.\n\n---\nNew commits:",
    "created_at": "2019-03-29T13:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384495",
    "user": "https://github.com/abhayptp"
}
```

Added doctests and made the required changes.\\
There were some extra whitespaces at 4 places in the file which have also been removed. My editor automatically did that :p \\
I can undo that change if anyone wants.

---
New commits:



---

archive/issue_comments_384496.json:
```json
{
    "body": "Please add your real name in the Author field.\n\n`@`Rajat: I move your name in the reviewers field. So please double check the proposed solution ;) It passes all tests on my computer.",
    "created_at": "2019-03-29T15:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384496",
    "user": "https://github.com/dcoudert"
}
```

Please add your real name in the Author field.

`@`Rajat: I move your name in the reviewers field. So please double check the proposed solution ;) It passes all tests on my computer.



---

archive/issue_comments_384497.json:
```json
{
    "body": "In sage we follow pep8 style:\nhttps://www.python.org/dev/peps/pep-0008/\n\n```diff\n-            sage: H = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)\n-            sage: H.cycle_basis()\n-            [[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]\n+            sage: H = Graph([(1, 2), (2, 3), (2, 3), (3, 4), (1, 4), (1, 4), (4, 5), (5, 6), (4, 6), (6, 7)], multiedges=True)\n+            sage: H.cycle_basis()\n+            [[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]\n```\n\nAlso you can add a Wikipedia reference explaining cycle_basis just after its definition\n\n```diff\n+        See the :wikipedia:`Cycle_basis` for more information.\n```",
    "created_at": "2019-03-29T15:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384497",
    "user": "https://github.com/rajat1433"
}
```

In sage we follow pep8 style:
https://www.python.org/dev/peps/pep-0008/

```diff
-            sage: H = Graph([(1,2),(2,3),(2,3),(3,4),(1,4),(1,4),(4,5),(5,6),(4,6),(6,7)],multiedges=True)
-            sage: H.cycle_basis()
-            [[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]
+            sage: H = Graph([(1, 2), (2, 3), (2, 3), (3, 4), (1, 4), (1, 4), (4, 5), (5, 6), (4, 6), (6, 7)], multiedges=True)
+            sage: H.cycle_basis()
+            [[1, 4], [2, 3], [4, 3, 2, 1], [6, 5, 4]]
```

Also you can add a Wikipedia reference explaining cycle_basis just after its definition

```diff
+        See the :wikipedia:`Cycle_basis` for more information.
```



---

archive/issue_comments_384498.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T15:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384499.json:
```json
{
    "body": "Reference added and code made pep8 compliant.",
    "created_at": "2019-03-29T16:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384499",
    "user": "https://github.com/abhayptp"
}
```

Reference added and code made pep8 compliant.



---

archive/issue_comments_384500.json:
```json
{
    "body": "```\n            return [Graph(T + [e], multiedges=True).is_tree(certificate=True,\n                                                            output=output)[1]\n                    for e in H.edge_iterator()]\n```\n\ninstead of creating a new graph again and again you can create a single graph from T and then you may add and delete edge e in H.edge_iterator to that graph.",
    "created_at": "2019-03-29T16:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384500",
    "user": "https://github.com/rajat1433"
}
```

```
            return [Graph(T + [e], multiedges=True).is_tree(certificate=True,
                                                            output=output)[1]
                    for e in H.edge_iterator()]
```

instead of creating a new graph again and again you can create a single graph from T and then you may add and delete edge e in H.edge_iterator to that graph.



---

archive/issue_comments_384501.json:
```json
{
    "body": "That's right, you can do something like:\n\n```\nfrom sage.graphs.graph import Graph\nT = Graph(self.min_spanning_tree(), multiedges=True, format='list_of_edges')\nH = self.copy()\nH.delete_edges(T.edge_iterator())\nL = []\nfor e in H.edge_iterator():\n    T.add_edge(e)\n    L.append(T.is_tree(certificate=True, output=output)[1])\n    T.delete_edge(e)\nreturn L\n```",
    "created_at": "2019-03-29T16:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384501",
    "user": "https://github.com/dcoudert"
}
```

That's right, you can do something like:

```
from sage.graphs.graph import Graph
T = Graph(self.min_spanning_tree(), multiedges=True, format='list_of_edges')
H = self.copy()
H.delete_edges(T.edge_iterator())
L = []
for e in H.edge_iterator():
    T.add_edge(e)
    L.append(T.is_tree(certificate=True, output=output)[1])
    T.delete_edge(e)
return L
```



---

archive/issue_comments_384502.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T16:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384503.json:
```json
{
    "body": "Note that T is a list. So you can't use add_edge in that. You need to construct a graph from T first \n\n```\nT = Graph(self.min_spanning_tree(), multiedges=True, format='list_of_edges')\n```",
    "created_at": "2019-03-29T17:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384503",
    "user": "https://github.com/rajat1433"
}
```

Note that T is a list. So you can't use add_edge in that. You need to construct a graph from T first 

```
T = Graph(self.min_spanning_tree(), multiedges=True, format='list_of_edges')
```



---

archive/issue_comments_384504.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T17:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384505.json:
```json
{
    "body": "Yeah. I missed that. I don't get why tests went silent. Maybe, I didn't do ./sage -br?",
    "created_at": "2019-03-29T17:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384505",
    "user": "https://github.com/abhayptp"
}
```

Yeah. I missed that. I don't get why tests went silent. Maybe, I didn't do ./sage -br?



---

archive/issue_comments_384506.json:
```json
{
    "body": "I usually do `./sage -btp --long src/sage/graphs/generic_graph.py`.\n\nFor me this patch is now good to go. Thanks.\n\n`@`Rajat: if you have no further comments, you can set the ticket to positive review.",
    "created_at": "2019-03-29T17:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384506",
    "user": "https://github.com/dcoudert"
}
```

I usually do `./sage -btp --long src/sage/graphs/generic_graph.py`.

For me this patch is now good to go. Thanks.

`@`Rajat: if you have no further comments, you can set the ticket to positive review.



---

archive/issue_comments_384507.json:
```json
{
    "body": "A few improvements:\n\n- Note that Networkx implementation of cycle_basis also does not work for directed graphs so we can check that at the start of the code and return the appropriate error there only.\n\n- A small grammatical error ;)\n\n```diff\n-        a dictionary associating an unique vector to each undirected edge::\n+        a dictionary associating a unique vector to each undirected edge::\n```\n\n- Since the copy parameter of Networkx graph has been deprecated(ticket:27491) you may remove it:\n\n```diff\n-        cycle_basis_v = networkx.cycle_basis(self.networkx_graph(copy=False))\n+        cycle_basis_v = networkx.cycle_basis(self.networkx_graph())\n```",
    "created_at": "2019-03-29T17:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384507",
    "user": "https://github.com/rajat1433"
}
```

A few improvements:

- Note that Networkx implementation of cycle_basis also does not work for directed graphs so we can check that at the start of the code and return the appropriate error there only.

- A small grammatical error ;)

```diff
-        a dictionary associating an unique vector to each undirected edge::
+        a dictionary associating a unique vector to each undirected edge::
```

- Since the copy parameter of Networkx graph has been deprecated(ticket:27491) you may remove it:

```diff
-        cycle_basis_v = networkx.cycle_basis(self.networkx_graph(copy=False))
+        cycle_basis_v = networkx.cycle_basis(self.networkx_graph())
```



---

archive/issue_comments_384508.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T18:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384508",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384509.json:
```json
{
    "body": "Just last one \ud83d\ude42\n\nYou may consider adding a test mentioning this ticket:\n\n```diff\n+        TESTS:\n+\n+        :trac:`27538`::\n+\n+            sage: G= Graph([(1, 2, 'a'),(2, 3, 'b'),(2, 3, 'c'),(3, 4, 'd'),(3, 4, 'e'),(4, 1, 'f')], multiedges=True)\n+            sage: G.cycle_basis()\n+            [[2, 3], [4, 3, 2, 1], [4, 3, 2, 1]]\n+            sage: G.cycle_basis(output='edge')\n+            [[(2, 3, 'b'), (3, 2, 'c')],\n+             [(4, 3, 'd'), (3, 2, 'b'), (2, 1, 'a'), (1, 4, 'f')],\n+             [(4, 3, 'e'), (3, 2, 'b'), (2, 1, 'a'), (1, 4, 'f')]]\n```",
    "created_at": "2019-03-29T18:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384509",
    "user": "https://github.com/rajat1433"
}
```

Just last one 🙂

You may consider adding a test mentioning this ticket:

```diff
+        TESTS:
+
+        :trac:`27538`::
+
+            sage: G= Graph([(1, 2, 'a'),(2, 3, 'b'),(2, 3, 'c'),(3, 4, 'd'),(3, 4, 'e'),(4, 1, 'f')], multiedges=True)
+            sage: G.cycle_basis()
+            [[2, 3], [4, 3, 2, 1], [4, 3, 2, 1]]
+            sage: G.cycle_basis(output='edge')
+            [[(2, 3, 'b'), (3, 2, 'c')],
+             [(4, 3, 'd'), (3, 2, 'b'), (2, 1, 'a'), (1, 4, 'f')],
+             [(4, 3, 'e'), (3, 2, 'b'), (2, 1, 'a'), (1, 4, 'f')]]
```



---

archive/issue_comments_384510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384511.json:
```json
{
    "body": "add a line after the definition of cycle_basis:\n\n```diff\n-        See the :wikipedia:`Cycle_basis` for more information.\n+\n+        See the :wikipedia:`Cycle_basis` for more information.\n```\n\nNotice the changes:\n\n```diff\n-            sage: G = DiGraph([(0, 2, 'a'), (0, 1, 'c'), (1, 2, 'd')], multiedges=True)\n+            sage: G = DiGraph([(0, 2, 'a'), (0, 1, 'b'), (1, 2, 'c')])\n```",
    "created_at": "2019-03-29T19:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384511",
    "user": "https://github.com/rajat1433"
}
```

add a line after the definition of cycle_basis:

```diff
-        See the :wikipedia:`Cycle_basis` for more information.
+
+        See the :wikipedia:`Cycle_basis` for more information.
```

Notice the changes:

```diff
-            sage: G = DiGraph([(0, 2, 'a'), (0, 1, 'c'), (1, 2, 'd')], multiedges=True)
+            sage: G = DiGraph([(0, 2, 'a'), (0, 1, 'b'), (1, 2, 'c')])
```



---

archive/issue_comments_384512.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T20:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384513.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-29T21:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384513",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384514.json:
```json
{
    "body": "This patch is very good now. Thanks to both of you.\n\nI'm now waiting for the patchbot, just in case.",
    "created_at": "2019-03-29T21:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384514",
    "user": "https://github.com/dcoudert"
}
```

This patch is very good now. Thanks to both of you.

I'm now waiting for the patchbot, just in case.



---

archive/issue_comments_384515.json:
```json
{
    "body": "LGTM\n\n`@`David: if you have no further comments, we can set the ticket to positive review.",
    "created_at": "2019-03-30T05:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384515",
    "user": "https://github.com/rajat1433"
}
```

LGTM

`@`David: if you have no further comments, we can set the ticket to positive review.



---

archive/issue_comments_384516.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-30T07:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384516",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384517.json:
```json
{
    "body": "LGTM.",
    "created_at": "2019-03-30T07:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384517",
    "user": "https://github.com/dcoudert"
}
```

LGTM.



---

archive/issue_events_068366.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-31T22:43:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27538#event-68366"
}
```



---

archive/issue_comments_384518.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-31T22:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27538#issuecomment-384518",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
