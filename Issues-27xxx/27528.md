# Issue 27528: Remove the highlighting patch for Sphinx

archive/issues_027291.json:
```json
{
    "assignees": [],
    "body": "The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n\nTo improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n\nWe also mark some non-Python blocks as what they are, to enable their highlighting.\n\nCC:  @timokau\n\nBranch/Commit: **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **John Palmieri, Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27528_\n\n",
    "closed_at": "2019-03-30T20:38:04Z",
    "created_at": "2019-03-22T01:25:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove the highlighting patch for Sphinx",
    "type": "issue",
    "updated_at": "2019-03-30T20:38:04Z",
    "url": "https://github.com/sagemath/sage/issues/27528",
    "user": "https://github.com/jhpalmieri"
}
```
The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.

To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.

We also mark some non-Python blocks as what they are, to enable their highlighting.

CC:  @timokau

Branch/Commit: **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**

Reviewer: **Dima Pasechnik**

Author: **John Palmieri, Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/27528_





---

archive/issue_events_359802.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:25:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359802"
}
```



---

archive/issue_events_359803.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:25:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359803"
}
```



---

archive/issue_events_359804.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:25:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359804"
}
```



---

archive/issue_events_359805.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:25:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359805"
}
```



---

archive/issue_comments_429282.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nWe want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.\n\nCurrently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt \"sage:\" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:\n\n```\nWARNING: Could not lex literal_block as \"pycon\". Highlighting skipped.\n```\nWe have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.\n\nThere are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.\n\nIn my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like\n\n```\nHere is a block::\n\n.. highlight:: rest\n\n    stuff\n```\nBut that can be on another ticket.",
    "created_at": "2019-03-22T01:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429282",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">Comment 1</div>

We want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.

Currently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt "sage:" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:

```
WARNING: Could not lex literal_block as "pycon". Highlighting skipped.
```
We have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.

There are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.

In my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like

```
Here is a block::

.. highlight:: rest

    stuff
```
But that can be on another ticket.



---

archive/issue_comments_429283.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nA few blocks in Sage look like\n\n```\nTraceback:\n..   <-- should be exactly three dots\nmore stuff\n```\nHaving 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.\n\nAlong the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).",
    "created_at": "2019-03-22T01:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429283",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">Comment 2</div>

A few blocks in Sage look like

```
Traceback:
..   <-- should be exactly three dots
more stuff
```
Having 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.

Along the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).



---

archive/issue_comments_429284.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)**",
    "created_at": "2019-03-22T01:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429284",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)**



---

archive/issue_comments_429285.json:
```json
{
    "body": "Commit: **[1debde6](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)**",
    "created_at": "2019-03-22T01:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429285",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[1debde6](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)**



---

archive/issue_comments_429286.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f\">1debde6</a></td><td><code>trac 27528: remove highlighting.patch for Sphinx</code></td></tr></table>\n",
    "created_at": "2019-03-22T01:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429286",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">Comment 4</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f">1debde6</a></td><td><code>trac 27528: remove highlighting.patch for Sphinx</code></td></tr></table>




---

archive/issue_events_359806.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:52:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359806"
}
```



---

archive/issue_comments_429287.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBy the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.",
    "created_at": "2019-03-22T03:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429287",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">Comment 5</div>

By the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.



---

archive/issue_events_359807.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T05:53:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359807"
}
```



---

archive/issue_events_359808.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T05:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359808"
}
```



---

archive/issue_comments_429288.json:
```json
{
    "body": "Changed commit from **[1debde6](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)** to **[687b338](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)**",
    "created_at": "2019-03-24T22:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429288",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1debde6](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)** to **[687b338](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)**



---

archive/issue_comments_429289.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48b7acd9c132462e57317ededf422269e4e389d3\">48b7acd</a></td><td><code>trac 27528: remove some patches for Sphinx and pygments.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b23b8ccc43bdb63e6606e39cc73b2b4984bdfa7c\">b23b8cc</a></td><td><code>trac 27528: use a custom Sphinx transform to handle <BLANKLINE></code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d\">687b338</a></td><td><code>trac 27528: clean up some code-blocks in the reST documentation.</code></td></tr></table>\n",
    "created_at": "2019-03-24T22:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429289",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48b7acd9c132462e57317ededf422269e4e389d3">48b7acd</a></td><td><code>trac 27528: remove some patches for Sphinx and pygments.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b23b8ccc43bdb63e6606e39cc73b2b4984bdfa7c">b23b8cc</a></td><td><code>trac 27528: use a custom Sphinx transform to handle <BLANKLINE></code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d">687b338</a></td><td><code>trac 27528: clean up some code-blocks in the reST documentation.</code></td></tr></table>




---

archive/issue_events_359809.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T22:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359809"
}
```



---

archive/issue_events_359810.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T22:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359810"
}
```



---

archive/issue_comments_429290.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n-We can accomplish the same thing through a configuration option, as long as we also silence some docbuilding warnings.\n+The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n \n+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n+\n+We also mark some non-Python blocks as what they are, to enable their highlighting.\n+\n``````\n",
    "created_at": "2019-03-24T22:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429290",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
-We can accomplish the same thing through a configuration option, as long as we also silence some docbuilding warnings.
+The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.
 
+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
+
+We also mark some non-Python blocks as what they are, to enable their highlighting.
+
``````




---

archive/issue_comments_429291.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nHere is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.",
    "created_at": "2019-03-24T22:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429291",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">Comment 10</div>

Here is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.



---

archive/issue_comments_429292.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nA few things to check:\n- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.\n- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.\n- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click \"Symbolic Calculus\" and then \"Riemann Mapping\". The method \"complex_to_spiderweb\" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.",
    "created_at": "2019-03-24T23:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429292",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">Comment 11</div>

A few things to check:
- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.
- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.
- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click "Symbolic Calculus" and then "Riemann Mapping". The method "complex_to_spiderweb" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.



---

archive/issue_comments_429293.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nTo do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.",
    "created_at": "2019-03-25T05:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429293",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">Comment 12</div>

To do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.



---

archive/issue_comments_429294.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-03-26T00:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429294",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_429295.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nworks for me nicely. I looked at few random places in various docs, all good.",
    "created_at": "2019-03-26T00:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429295",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">Comment 13</div>

works for me nicely. I looked at few random places in various docs, all good.



---

archive/issue_events_359811.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T00:12:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359811"
}
```



---

archive/issue_events_359812.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T00:12:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359812"
}
```



---

archive/issue_comments_429296.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThank you for the review.\n\nSee #27549 for a followup: more code-block cleanup.",
    "created_at": "2019-03-26T04:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429296",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">Comment 14</div>

Thank you for the review.

See #27549 for a followup: more code-block cleanup.



---

archive/issue_comments_429297.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nRemember to change the package version if you change patches.",
    "created_at": "2019-03-26T09:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429297",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Remember to change the package version if you change patches.



---

archive/issue_events_359813.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:18:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359813"
}
```



---

archive/issue_events_359814.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:18:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359814"
}
```



---

archive/issue_events_359815.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:34:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359815"
}
```



---

archive/issue_events_359816.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:34:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359816"
}
```



---

archive/issue_comments_429298.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nHow about we just mark  this ticket to be merged together with #26451 - which does a version bump?",
    "created_at": "2019-03-26T09:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429298",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

How about we just mark  this ticket to be merged together with #26451 - which does a version bump?



---

archive/issue_events_359817.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:40:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359817"
}
```



---

archive/issue_events_359818.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:40:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359818"
}
```



---

archive/issue_comments_429299.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@dimpase](#comment%3A16):\n> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?\n\nIf it can be merged separately, I see no reason to bundle them.",
    "created_at": "2019-03-26T09:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429299",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@dimpase](#comment%3A16):
> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?

If it can be merged separately, I see no reason to bundle them.



---

archive/issue_events_359819.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:42:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359819"
}
```



---

archive/issue_events_359820.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359820"
}
```



---

archive/issue_comments_429300.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nWhat's the point of doing this? To do more work than needed? Let's just merge them together.",
    "created_at": "2019-03-26T09:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429300",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">Comment 19</div>

What's the point of doing this? To do more work than needed? Let's just merge them together.



---

archive/issue_events_359821.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:43:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359821"
}
```



---

archive/issue_events_359822.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:43:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359822"
}
```



---

archive/issue_comments_429301.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)** to **[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)**",
    "created_at": "2019-03-26T09:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429301",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)** to **[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)**



---

archive/issue_comments_429302.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc\">278fa3b</a></td><td><code>Bump package versions</code></td></tr></table>\n",
    "created_at": "2019-03-26T09:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429302",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">Comment 22</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc">278fa3b</a></td><td><code>Bump package versions</code></td></tr></table>




---

archive/issue_events_359823.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:46:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359823"
}
```



---

archive/issue_events_359824.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:46:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359824"
}
```



---

archive/issue_comments_429303.json:
```json
{
    "body": "Changed commit from **[687b338](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)** to **[278fa3b](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)**",
    "created_at": "2019-03-26T09:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429303",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[687b338](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)** to **[278fa3b](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)**



---

archive/issue_comments_429304.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nSometimes it takes less effort to do the right thing rather than arguing about it...",
    "created_at": "2019-03-26T09:48:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429304",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

Sometimes it takes less effort to do the right thing rather than arguing about it...



---

archive/issue_comments_429305.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nOK",
    "created_at": "2019-03-26T09:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429305",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">Comment 24</div>

OK



---

archive/issue_events_359825.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:59:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359825"
}
```



---

archive/issue_events_359826.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359826"
}
```



---

archive/issue_events_359827.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T10:30:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359827"
}
```



---

archive/issue_events_359828.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T10:30:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359828"
}
```



---

archive/issue_comments_429306.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nLooking at this diff, it seems that indentation is not correct in a few places, for example\n\n```diff\n+  that the user should be aware of.\n+\n+   .. CODE-BLOCK:: rest\n```",
    "created_at": "2019-03-26T10:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429306",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">Comment 25</div>

Looking at this diff, it seems that indentation is not correct in a few places, for example

```diff
+  that the user should be aware of.
+
+   .. CODE-BLOCK:: rest
```



---

archive/issue_comments_429307.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nI also have doubts about\n\n```\nThere are 2 tests in doc/en/developer/coding_in_python.rst that are not being run\n```",
    "created_at": "2019-03-26T10:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429307",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">Comment 26</div>

I also have doubts about

```
There are 2 tests in doc/en/developer/coding_in_python.rst that are not being run
```



---

archive/issue_comments_429308.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nAnd shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?",
    "created_at": "2019-03-26T10:59:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429308",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">Comment 27</div>

And shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?



---

archive/issue_comments_429309.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n",
    "created_at": "2019-03-26T12:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429309",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28" align="right">Comment 28</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>




---

archive/issue_comments_429310.json:
```json
{
    "body": "Changed commit from **[278fa3b](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)** to **[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)**",
    "created_at": "2019-03-26T12:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429310",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[278fa3b](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)** to **[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)**



---

archive/issue_comments_429311.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c\">4cabfa7</a></td><td><code>Fix _test_enough_doctests()</code></td></tr></table>\n",
    "created_at": "2019-03-26T13:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429311",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29" align="right">Comment 29</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c">4cabfa7</a></td><td><code>Fix _test_enough_doctests()</code></td></tr></table>




---

archive/issue_comments_429312.json:
```json
{
    "body": "Changed commit from **[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)** to **[4cabfa7](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)**",
    "created_at": "2019-03-26T13:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429312",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)** to **[4cabfa7](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)**



---

archive/issue_comments_429313.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727\">83436ea</a></td><td><code>Fix usage of IPythonConsoleLexer</code></td></tr></table>\n",
    "created_at": "2019-03-26T13:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429313",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30" align="right">Comment 30</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727">83436ea</a></td><td><code>Fix usage of IPythonConsoleLexer</code></td></tr></table>




---

archive/issue_comments_429314.json:
```json
{
    "body": "Changed commit from **[4cabfa7](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)** to **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**",
    "created_at": "2019-03-26T13:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4cabfa7](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)** to **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**



---

archive/issue_events_359829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T13:15:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359829"
}
```



---

archive/issue_events_359830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T13:15:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359830"
}
```



---

archive/issue_comments_429315.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n \n-To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n \n We also mark some non-Python blocks as what they are, to enable their highlighting.\n-\n``````\n",
    "created_at": "2019-03-26T13:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429315",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
 The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.
 
-To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
 
 We also mark some non-Python blocks as what they are, to enable their highlighting.
-
``````




---

archive/issue_comments_429316.json:
```json
{
    "body": "Changed author from **John Palmieri** to **John Palmieri, Jeroen Demeyer**",
    "created_at": "2019-03-26T13:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429316",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **John Palmieri** to **John Palmieri, Jeroen Demeyer**



---

archive/issue_comments_429317.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nI didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.",
    "created_at": "2019-03-26T13:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429317",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">Comment 32</div>

I didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.



---

archive/issue_comments_429318.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nPlease review the last 3 commits.",
    "created_at": "2019-03-26T14:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429318",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">Comment 33</div>

Please review the last 3 commits.



---

archive/issue_comments_429319.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@sagetrac-git](#comment%3A28):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n\nI thought wrong indentations result in sphinx errors...",
    "created_at": "2019-03-26T14:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429319",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@sagetrac-git](#comment%3A28):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>

I thought wrong indentations result in sphinx errors...



---

archive/issue_comments_429320.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nMy one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)",
    "created_at": "2019-03-26T17:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429320",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">Comment 35</div>

My one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)



---

archive/issue_comments_429321.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nReplying to [@dimpase](#comment%3A34):\n> Replying to [@sagetrac-git](#comment%3A28):\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n\n> |                                                                                                                                                 |                                   |\n> |-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n> |[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|\n> \n> I thought wrong indentations result in sphinx errors...\n\nSometimes it just results in Sphinx silently ignoring the directive.",
    "created_at": "2019-03-26T17:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429321",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">Comment 36</div>

Replying to [@dimpase](#comment%3A34):
> Replying to [@sagetrac-git](#comment%3A28):
> > Branch pushed to git repo; I updated commit sha1. New commits:

> |                                                                                                                                                 |                                   |
> |-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
> |[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|
> 
> I thought wrong indentations result in sphinx errors...

Sometimes it just results in Sphinx silently ignoring the directive.



---

archive/issue_comments_429322.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@jhpalmieri](#comment%3A36):\n> Replying to [@dimpase](#comment%3A34):\n> > Replying to [@sagetrac-git](#comment%3A28):\n> > > Branch pushed to git repo; I updated commit sha1. New commits:\n\n> > |                                                                                                                                                 |                                   |\n> > |-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n> > |[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|\n> > \n> > I thought wrong indentations result in sphinx errors...\n\n> \n> Sometimes it just results in Sphinx silently ignoring the directive.\n\nActually this case looked like\n\n```\ntext\n\n .. CODE-BLOCK:: rest\n\n    more text\n```\nand Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.",
    "created_at": "2019-03-26T18:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429322",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@jhpalmieri](#comment%3A36):
> Replying to [@dimpase](#comment%3A34):
> > Replying to [@sagetrac-git](#comment%3A28):
> > > Branch pushed to git repo; I updated commit sha1. New commits:

> > |                                                                                                                                                 |                                   |
> > |-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
> > |[a323c09](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|
> > 
> > I thought wrong indentations result in sphinx errors...

> 
> Sometimes it just results in Sphinx silently ignoring the directive.

Actually this case looked like

```
text

 .. CODE-BLOCK:: rest

    more text
```
and Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.



---

archive/issue_events_359831.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-26T18:15:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359831"
}
```



---

archive/issue_events_359832.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-26T18:15:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359832"
}
```



---

archive/issue_comments_429323.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nJeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.",
    "created_at": "2019-03-26T18:15:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429323",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">Comment 38</div>

Jeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.



---

archive/issue_comments_429324.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)** to **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**",
    "created_at": "2019-03-30T20:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27528#issuecomment-429324",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)** to **[83436ea](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)**



---

archive/issue_events_359833.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:38:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359833"
}
```



---

archive/issue_events_359834.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a2a8ffedcd3d8c549ce0a9a6b00a424aecf01349",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-30T20:38:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27528",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27528#event-359834"
}
```
