# Issue 27528: Remove the highlighting patch for Sphinx

archive/issues_027291.json:
```json
{
    "body": "The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n\nTo improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n\nWe also mark some non-Python blocks as what they are, to enable their highlighting.\n\nCC:  @timokau\n\nBranch/Commit: 83436ea82a17406bbc3fdd9e8c386208abc93727\n\nReviewer: Dima Pasechnik\n\nAuthor: John Palmieri, Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27528\n\n",
    "closed_at": "2019-03-30T20:38:04Z",
    "created_at": "2019-03-22T01:25:15Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Remove the highlighting patch for Sphinx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27528",
    "user": "https://github.com/jhpalmieri"
}
```
The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.

To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.

We also mark some non-Python blocks as what they are, to enable their highlighting.

CC:  @timokau

Branch/Commit: 83436ea82a17406bbc3fdd9e8c386208abc93727

Reviewer: Dima Pasechnik

Author: John Palmieri, Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27528





---

archive/issue_comments_384294.json:
```json
{
    "body": "<a id='comment:1'></a>We want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.\n\nCurrently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt \"sage:\" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:\n\n```\nWARNING: Could not lex literal_block as \"pycon\". Highlighting skipped.\n```\nWe have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.\n\nThere are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.\n\nIn my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like\n\n```\nHere is a block::\n\n.. highlight:: rest\n\n    stuff\n```\nBut that can be on another ticket.",
    "created_at": "2019-03-22T01:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384294",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>We want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.

Currently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt "sage:" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:

```
WARNING: Could not lex literal_block as "pycon". Highlighting skipped.
```
We have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.

There are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.

In my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like

```
Here is a block::

.. highlight:: rest

    stuff
```
But that can be on another ticket.



---

archive/issue_comments_384295.json:
```json
{
    "body": "<a id='comment:2'></a>A few blocks in Sage look like\n\n```\nTraceback:\n..   <-- should be exactly three dots\nmore stuff\n```\nHaving 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.\n\nAlong the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).",
    "created_at": "2019-03-22T01:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384295",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>A few blocks in Sage look like

```
Traceback:
..   <-- should be exactly three dots
more stuff
```
Having 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.

Along the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).



---

archive/issue_comments_384296.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2019-03-22T01:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384296",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_384297.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-22T01:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384297",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384298.json:
```json
{
    "body": "<a id='comment:5'></a>By the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.",
    "created_at": "2019-03-22T03:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384298",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>By the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.



---

archive/issue_comments_384299.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-24T05:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384299",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_384300.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-03-24T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_384301.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-24T22:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384301",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384302.json:
```json
{
    "body": "<a id='comment:10'></a>Here is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.",
    "created_at": "2019-03-24T22:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384302",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>Here is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.



---

archive/issue_comments_384303.json:
```json
{
    "body": "<a id='comment:11'></a>A few things to check:\n- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.\n- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.\n- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click \"Symbolic Calculus\" and then \"Riemann Mapping\". The method \"complex_to_spiderweb\" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.",
    "created_at": "2019-03-24T23:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384303",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>A few things to check:
- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.
- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.
- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click "Symbolic Calculus" and then "Riemann Mapping". The method "complex_to_spiderweb" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.



---

archive/issue_comments_384304.json:
```json
{
    "body": "<a id='comment:12'></a>To do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.",
    "created_at": "2019-03-25T05:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384304",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>To do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.



---

archive/issue_comments_384305.json:
```json
{
    "body": "<a id='comment:13'></a>works for me nicely. I looked at few random places in various docs, all good.",
    "created_at": "2019-03-26T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384305",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>works for me nicely. I looked at few random places in various docs, all good.



---

archive/issue_comments_384306.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-26T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384306",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384307.json:
```json
{
    "body": "<a id='comment:14'></a>Thank you for the review.\n\nSee #27549 for a followup: more code-block cleanup.",
    "created_at": "2019-03-26T04:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384307",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>Thank you for the review.

See #27549 for a followup: more code-block cleanup.



---

archive/issue_comments_384308.json:
```json
{
    "body": "<a id='comment:15'></a>Remember to change the package version if you change patches.",
    "created_at": "2019-03-26T09:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384308",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Remember to change the package version if you change patches.



---

archive/issue_comments_384309.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-03-26T09:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384309",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_384310.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-03-26T09:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384310",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_384311.json:
```json
{
    "body": "<a id='comment:16'></a>How about we just mark  this ticket to be merged together with #26451 - which does a version bump?",
    "created_at": "2019-03-26T09:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384311",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>How about we just mark  this ticket to be merged together with #26451 - which does a version bump?



---

archive/issue_comments_384312.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-03-26T09:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384312",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_384313.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 dimpase]:\n> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?\n\n\nIf it can be merged separately, I see no reason to bundle them.",
    "created_at": "2019-03-26T09:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384313",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:16 dimpase]:
> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?


If it can be merged separately, I see no reason to bundle them.



---

archive/issue_comments_384314.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-03-26T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384314",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_384315.json:
```json
{
    "body": "<a id='comment:19'></a>What's the point of doing this? To do more work than needed? Let's just merge them together.",
    "created_at": "2019-03-26T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384315",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>What's the point of doing this? To do more work than needed? Let's just merge them together.



---

archive/issue_comments_384316.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-03-26T09:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384316",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_384317.json:
```json
{
    "body": "<a id='comment:22'></a>New commits:",
    "created_at": "2019-03-26T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384317",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>New commits:



---

archive/issue_comments_384318.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-26T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384318",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384319.json:
```json
{
    "body": "<a id='comment:23'></a>Sometimes it takes less effort to do the right thing rather than arguing about it...",
    "created_at": "2019-03-26T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>Sometimes it takes less effort to do the right thing rather than arguing about it...



---

archive/issue_comments_384320.json:
```json
{
    "body": "<a id='comment:24'></a>OK",
    "created_at": "2019-03-26T09:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384320",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>OK



---

archive/issue_comments_384321.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-26T09:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384321",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384322.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-03-26T10:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384322",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_384323.json:
```json
{
    "body": "<a id='comment:25'></a>Looking at this diff, it seems that indentation is not correct in a few places, for example\n\n```diff\n+  that the user should be aware of.\n+\n+   .. CODE-BLOCK:: rest\n```",
    "created_at": "2019-03-26T10:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>Looking at this diff, it seems that indentation is not correct in a few places, for example

```diff
+  that the user should be aware of.
+
+   .. CODE-BLOCK:: rest
```



---

archive/issue_comments_384324.json:
```json
{
    "body": "<a id='comment:26'></a>I also have doubts about\n\n```\nThere are 2 tests in doc/en/developer/coding_in_python.rst that are not being run\n```",
    "created_at": "2019-03-26T10:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384324",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>I also have doubts about

```
There are 2 tests in doc/en/developer/coding_in_python.rst that are not being run
```



---

archive/issue_comments_384325.json:
```json
{
    "body": "<a id='comment:27'></a>And shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?",
    "created_at": "2019-03-26T10:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384325",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>And shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?



---

archive/issue_comments_384326.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-26T12:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384327.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-26T13:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384328.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-26T13:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384329.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-26T13:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384329",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384330.json:
```json
{
    "body": "<a id='comment:32'></a>I didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.",
    "created_at": "2019-03-26T13:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384330",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>I didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.



---

archive/issue_comments_384331.json:
```json
{
    "body": "<a id='comment:33'></a>Please review the last 3 commits.",
    "created_at": "2019-03-26T14:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384331",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>Please review the last 3 commits.



---

archive/issue_comments_384332.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:28 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                   |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n> |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|\n\n\nI thought wrong indentations result in sphinx errors...",
    "created_at": "2019-03-26T14:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384332",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>Replying to [comment:28 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                   |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
> |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|


I thought wrong indentations result in sphinx errors...



---

archive/issue_comments_384333.json:
```json
{
    "body": "<a id='comment:35'></a>My one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)",
    "created_at": "2019-03-26T17:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384333",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>My one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)



---

archive/issue_comments_384334.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:34 dimpase]:\n> Replying to [comment:28 git]:\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n> > |                                                                                                                                           |                                   |\n> > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n> > |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|\n\n> \n> I thought wrong indentations result in sphinx errors...\n\n\nSometimes it just results in Sphinx silently ignoring the directive.",
    "created_at": "2019-03-26T17:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384334",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>Replying to [comment:34 dimpase]:
> Replying to [comment:28 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > |                                                                                                                                           |                                   |
> > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
> > |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|

> 
> I thought wrong indentations result in sphinx errors...


Sometimes it just results in Sphinx silently ignoring the directive.



---

archive/issue_comments_384335.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:36 jhpalmieri]:\n> Replying to [comment:34 dimpase]:\n> > Replying to [comment:28 git]:\n> > > Branch pushed to git repo; I updated commit sha1. New commits:\n> > > |                                                                                                                                           |                                   |\n> > > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n> > > |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|\n\n> > \n> > I thought wrong indentations result in sphinx errors...\n\n> \n> Sometimes it just results in Sphinx silently ignoring the directive.\n\n\nActually this case looked like\n\n```\ntext\n\n .. CODE-BLOCK:: rest\n\n    more text\n```\nand Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.",
    "created_at": "2019-03-26T18:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384335",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>Replying to [comment:36 jhpalmieri]:
> Replying to [comment:34 dimpase]:
> > Replying to [comment:28 git]:
> > > Branch pushed to git repo; I updated commit sha1. New commits:
> > > |                                                                                                                                           |                                   |
> > > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
> > > |[a323c09](https://git.sagemath.org/sage.git/commit/?id=a323c0965f3020045900cdb0fcb7702d4ec56f88)|`Fix a few CODE-BLOCK indentations`|

> > 
> > I thought wrong indentations result in sphinx errors...

> 
> Sometimes it just results in Sphinx silently ignoring the directive.


Actually this case looked like

```
text

 .. CODE-BLOCK:: rest

    more text
```
and Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.



---

archive/issue_comments_384336.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-26T18:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384336",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384337.json:
```json
{
    "body": "<a id='comment:38'></a>Jeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.",
    "created_at": "2019-03-26T18:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384337",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:38'></a>Jeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.



---

archive/issue_comments_384338.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-30T20:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-384338",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068357.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:38:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-68357"
}
```
