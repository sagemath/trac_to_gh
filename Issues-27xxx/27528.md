# Issue 27528: Remove the highlighting patch for Sphinx

archive/issues_027291.json:
```json
{
    "body": "The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n\nTo improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n\nWe also mark some non-Python blocks as what they are, to enable their highlighting.\n\n**CC:**  @timokau\n\n**Branch/Commit:** [83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** John Palmieri, Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/27528\n\n",
    "closed_at": "2019-03-30T20:38:04Z",
    "created_at": "2019-03-22T01:25:15Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Remove the highlighting patch for Sphinx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27528",
    "user": "https://github.com/jhpalmieri"
}
```
The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.

To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.

We also mark some non-Python blocks as what they are, to enable their highlighting.

**CC:**  @timokau

**Branch/Commit:** [83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)

**Reviewer:** Dima Pasechnik

**Author:** John Palmieri, Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/27528





---

archive/issue_comments_429075.json:
```json
{
    "body": "<a id='comment:1'></a>\nWe want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.\n\nCurrently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt \"sage:\" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:\n\n```\nWARNING: Could not lex literal_block as \"pycon\". Highlighting skipped.\n```\nWe have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.\n\nThere are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.\n\nIn my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like\n\n```\nHere is a block::\n\n.. highlight:: rest\n\n    stuff\n```\nBut that can be on another ticket.",
    "created_at": "2019-03-22T01:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429075",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
We want Sage's doctest blocks (and most other literal blocks) to be typeset as Python console code. Setting the default highlighting language to `pycon` does this, and it means that we can then not use the highlighting patch for Sphinx.

Currently in Sage, there are some blocks which are not highlighted correctly. See [this page](http://doc.sagemath.org/html/en/reference/modules/sage/modules/tutorial_free_modules.html): in the first block (containing `CombinatorialFreeModule?`), the prompt "sage:" is not highlighted. With the proposed change, that block will still not be highlighted the way we want, and in fact it will produce a warning:

```
WARNING: Could not lex literal_block as "pycon". Highlighting skipped.
```
We have set up the docbuilding process so that warnings stop it, so we also need to silence this warning.

There are no doubt some blocks in the Sage code which should not be highlighted using `pycon`, but as things stand in current Sage, Sphinx already tries to highlight them using the `default` lexer, which basically means `python3` with a graceful failure if it can't parse it as Python 3: see [the Sphinx docs](https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-highlight_language). Once we set the highlighting language to something other than `default`, we lose the graceful failure, and so we have to silence the warnings.

In my spot-checking, the current non-Python console blocks fail their highlighting and so have no highlighting at all, and that behavior continues with this branch. At some point we could try to modify those blocks: something like

```
Here is a block::

.. highlight:: rest

    stuff
```
But that can be on another ticket.



---

archive/issue_comments_429076.json:
```json
{
    "body": "<a id='comment:2'></a>\nA few blocks in Sage look like\n\n```\nTraceback:\n..   <-- should be exactly three dots\nmore stuff\n```\nHaving 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.\n\nAlong the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).",
    "created_at": "2019-03-22T01:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429076",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
A few blocks in Sage look like

```
Traceback:
..   <-- should be exactly three dots
more stuff
```
Having 2 or 4 dots means that Sphinx can't handle the highlighting: you can see this [here](http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/shifted_primed_tableau.html#sage.combinat.shifted_primed_tableau.ShiftedPrimedTableau.check), where there are 4 dots instead of 3.

Along the same lines, having extra spaces at the end of `NotImplementedError` causes highlighting to fail [here](http://doc.sagemath.org/html/en/reference/power_series/sage/rings/power_series_ring_element.html#sage.rings.power_series_ring_element.PowerSeries.list).



---

archive/issue_comments_429077.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)",
    "created_at": "2019-03-22T01:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429077",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)



---

archive/issue_comments_429078.json:
```json
{
    "body": "**Commit:** [1debde6cf246bd2ed7a5f90aa58c877c6c61586f](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)",
    "created_at": "2019-03-22T01:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429078",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [1debde6cf246bd2ed7a5f90aa58c877c6c61586f](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)



---

archive/issue_comments_429079.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f\">1debde6</a></td><td><code>trac 27528: remove highlighting.patch for Sphinx</code></td></tr></table>\n",
    "created_at": "2019-03-22T01:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429079",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f">1debde6</a></td><td><code>trac 27528: remove highlighting.patch for Sphinx</code></td></tr></table>




---

archive/issue_events_243066.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-22T01:52:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243066"
}
```



---

archive/issue_comments_429080.json:
```json
{
    "body": "<a id='comment:5'></a>\nBy the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.",
    "created_at": "2019-03-22T03:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429080",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
By the way, I've tried this with #26451 (Sphinx 1.8.4), #25680 (Python 3.7.2), and both together. No troubles.



---

archive/issue_events_243067.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T05:53:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243067"
}
```



---

archive/issue_events_243068.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T05:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243068"
}
```



---

archive/issue_comments_429081.json:
```json
{
    "body": "**Changing commit** from \"[1debde6cf246bd2ed7a5f90aa58c877c6c61586f](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)\" to \"[687b3385e80af4efd6ee8db79200c518a731af1d](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)\".",
    "created_at": "2019-03-24T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1debde6cf246bd2ed7a5f90aa58c877c6c61586f](https://github.com/sagemath/sagetrac-mirror/commit/1debde6cf246bd2ed7a5f90aa58c877c6c61586f)" to "[687b3385e80af4efd6ee8db79200c518a731af1d](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)".



---

archive/issue_comments_429082.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48b7acd9c132462e57317ededf422269e4e389d3\">48b7acd</a></td><td><code>trac 27528: remove some patches for Sphinx and pygments.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b23b8ccc43bdb63e6606e39cc73b2b4984bdfa7c\">b23b8cc</a></td><td><code>trac 27528: use a custom Sphinx transform to handle <BLANKLINE></code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d\">687b338</a></td><td><code>trac 27528: clean up some code-blocks in the reST documentation.</code></td></tr></table>\n",
    "created_at": "2019-03-24T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48b7acd9c132462e57317ededf422269e4e389d3">48b7acd</a></td><td><code>trac 27528: remove some patches for Sphinx and pygments.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b23b8ccc43bdb63e6606e39cc73b2b4984bdfa7c">b23b8cc</a></td><td><code>trac 27528: use a custom Sphinx transform to handle <BLANKLINE></code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d">687b338</a></td><td><code>trac 27528: clean up some code-blocks in the reST documentation.</code></td></tr></table>




---

archive/issue_events_243069.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T22:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243069"
}
```



---

archive/issue_events_243070.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-24T22:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243070"
}
```



---

archive/issue_comments_429083.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n-We can accomplish the same thing through a configuration option, as long as we also silence some docbuilding warnings.\n+The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n \n+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n+\n+We also mark some non-Python blocks as what they are, to enable their highlighting.\n+\n``````\n",
    "created_at": "2019-03-24T22:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429083",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
-We can accomplish the same thing through a configuration option, as long as we also silence some docbuilding warnings.
+The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.
 
+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
+
+We also mark some non-Python blocks as what they are, to enable their highlighting.
+
``````




---

archive/issue_comments_429084.json:
```json
{
    "body": "<a id='comment:10'></a>\nHere is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.",
    "created_at": "2019-03-24T22:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429084",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Here is a new approach: I just discovered the IPython lexer, and we should definitely use it rather than Python lexer.



---

archive/issue_comments_429085.json:
```json
{
    "body": "<a id='comment:11'></a>\nA few things to check:\n- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.\n- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.\n- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click \"Symbolic Calculus\" and then \"Riemann Mapping\". The method \"complex_to_spiderweb\" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.",
    "created_at": "2019-03-24T23:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429085",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
A few things to check:
- See http://doc.sagemath.org/html/en/constructions/interface_issues.html for some code blocks for other languages (LaTeX, BibTeX, shell session). These are not currently highlighted, but they will be with this branch. Same goes for various shell session blocks scattered through the developer's guide.
- The first block in the [tour-help](http://doc.sagemath.org/html/en/tutorial/tour_help.html)  section of the tutorial is not currently highlighted, but it will be with this branch.
- double check that `<BLANKLINE>` does not appear in the reference manual. One spot to check: from the main reference manual page, click "Symbolic Calculus" and then "Riemann Mapping". The method "complex_to_spiderweb" (toward the end) has some `<BLANKLINE>`s in the doctest output, and they should be rendered as blank lines in the reference manual.



---

archive/issue_comments_429086.json:
```json
{
    "body": "<a id='comment:12'></a>\nTo do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.",
    "created_at": "2019-03-25T05:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429086",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
To do on another ticket: go through more of the reST docs and perhaps the reference manual, marking the non-sage-doctest blocks using `.. CODE-BLOCK:: language`. I'll open up a followup ticket eventually.



---

archive/issue_comments_429087.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2019-03-26T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429087",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_429088.json:
```json
{
    "body": "<a id='comment:13'></a>\nworks for me nicely. I looked at few random places in various docs, all good.",
    "created_at": "2019-03-26T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429088",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
works for me nicely. I looked at few random places in various docs, all good.



---

archive/issue_events_243071.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T00:12:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243071"
}
```



---

archive/issue_events_243072.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T00:12:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243072"
}
```



---

archive/issue_comments_429089.json:
```json
{
    "body": "<a id='comment:14'></a>\nThank you for the review.\n\nSee #27549 for a followup: more code-block cleanup.",
    "created_at": "2019-03-26T04:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429089",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Thank you for the review.

See #27549 for a followup: more code-block cleanup.



---

archive/issue_comments_429090.json:
```json
{
    "body": "<a id='comment:15'></a>\nRemember to change the package version if you change patches.",
    "created_at": "2019-03-26T09:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429090",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Remember to change the package version if you change patches.



---

archive/issue_events_243073.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:18:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243073"
}
```



---

archive/issue_events_243074.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:18:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243074"
}
```



---

archive/issue_events_243075.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:34:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243075"
}
```



---

archive/issue_events_243076.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:34:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243076"
}
```



---

archive/issue_comments_429091.json:
```json
{
    "body": "<a id='comment:16'></a>\nHow about we just mark  this ticket to be merged together with #26451 - which does a version bump?",
    "created_at": "2019-03-26T09:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429091",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
How about we just mark  this ticket to be merged together with #26451 - which does a version bump?



---

archive/issue_events_243077.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:40:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243077"
}
```



---

archive/issue_events_243078.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:40:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243078"
}
```



---

archive/issue_comments_429092.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [dimpase](#comment%3A16):\n> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?\n\n\nIf it can be merged separately, I see no reason to bundle them.",
    "created_at": "2019-03-26T09:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429092",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [dimpase](#comment%3A16):
> How about we just mark  this ticket to be merged together with #26451 - which does a version bump?


If it can be merged separately, I see no reason to bundle them.



---

archive/issue_events_243079.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:42:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243079"
}
```



---

archive/issue_events_243080.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243080"
}
```



---

archive/issue_comments_429093.json:
```json
{
    "body": "<a id='comment:19'></a>\nWhat's the point of doing this? To do more work than needed? Let's just merge them together.",
    "created_at": "2019-03-26T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429093",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
What's the point of doing this? To do more work than needed? Let's just merge them together.



---

archive/issue_events_243081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:43:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243081"
}
```



---

archive/issue_events_243082.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:43:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243082"
}
```



---

archive/issue_comments_429094.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)\" to \"[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)\".",
    "created_at": "2019-03-26T09:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429094",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/jhpalmieri/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sphinx-highlight)" to "[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)".



---

archive/issue_comments_429095.json:
```json
{
    "body": "<a id='comment:22'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc\">278fa3b</a></td><td><code>Bump package versions</code></td></tr></table>\n",
    "created_at": "2019-03-26T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc">278fa3b</a></td><td><code>Bump package versions</code></td></tr></table>




---

archive/issue_events_243083.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:46:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243083"
}
```



---

archive/issue_events_243084.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T09:46:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243084"
}
```



---

archive/issue_comments_429096.json:
```json
{
    "body": "**Changing commit** from \"[687b3385e80af4efd6ee8db79200c518a731af1d](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)\" to \"[278fa3b3fca010621d41df9d63e0b11801875adc](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)\".",
    "created_at": "2019-03-26T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429096",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[687b3385e80af4efd6ee8db79200c518a731af1d](https://github.com/sagemath/sagetrac-mirror/commit/687b3385e80af4efd6ee8db79200c518a731af1d)" to "[278fa3b3fca010621d41df9d63e0b11801875adc](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)".



---

archive/issue_comments_429097.json:
```json
{
    "body": "<a id='comment:23'></a>\nSometimes it takes less effort to do the right thing rather than arguing about it...",
    "created_at": "2019-03-26T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429097",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Sometimes it takes less effort to do the right thing rather than arguing about it...



---

archive/issue_comments_429098.json:
```json
{
    "body": "<a id='comment:24'></a>\nOK",
    "created_at": "2019-03-26T09:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429098",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
OK



---

archive/issue_events_243085.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:59:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243085"
}
```



---

archive/issue_events_243086.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-26T09:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243086"
}
```



---

archive/issue_events_243087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T10:30:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243087"
}
```



---

archive/issue_events_243088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T10:30:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243088"
}
```



---

archive/issue_comments_429099.json:
```json
{
    "body": "<a id='comment:25'></a>\nLooking at this diff, it seems that indentation is not correct in a few places, for example\n\n```diff\n+  that the user should be aware of.\n+\n+   .. CODE-BLOCK:: rest\n```",
    "created_at": "2019-03-26T10:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429099",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Looking at this diff, it seems that indentation is not correct in a few places, for example

```diff
+  that the user should be aware of.
+
+   .. CODE-BLOCK:: rest
```



---

archive/issue_comments_429100.json:
```json
{
    "body": "<a id='comment:26'></a>\nI also have doubts about\n\n```\nThere are 2 tests in doc/en/developer/coding_in_python.rst that are not being run\n```",
    "created_at": "2019-03-26T10:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429100",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
I also have doubts about

```
There are 2 tests in doc/en/developer/coding_in_python.rst that are not being run
```



---

archive/issue_comments_429101.json:
```json
{
    "body": "<a id='comment:27'></a>\nAnd shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?",
    "created_at": "2019-03-26T10:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
And shouldn't the `in2_regex` for `IPythonConsoleLexer` be customized too to match `....: `?



---

archive/issue_comments_429102.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n",
    "created_at": "2019-03-26T12:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>




---

archive/issue_comments_429103.json:
```json
{
    "body": "**Changing commit** from \"[278fa3b3fca010621d41df9d63e0b11801875adc](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)\" to \"[a323c0965f3020045900cdb0fcb7702d4ec56f88](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)\".",
    "created_at": "2019-03-26T12:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[278fa3b3fca010621d41df9d63e0b11801875adc](https://github.com/sagemath/sagetrac-mirror/commit/278fa3b3fca010621d41df9d63e0b11801875adc)" to "[a323c0965f3020045900cdb0fcb7702d4ec56f88](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)".



---

archive/issue_comments_429104.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c\">4cabfa7</a></td><td><code>Fix _test_enough_doctests()</code></td></tr></table>\n",
    "created_at": "2019-03-26T13:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c">4cabfa7</a></td><td><code>Fix _test_enough_doctests()</code></td></tr></table>




---

archive/issue_comments_429105.json:
```json
{
    "body": "**Changing commit** from \"[a323c0965f3020045900cdb0fcb7702d4ec56f88](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)\" to \"[4cabfa73badacb19731e95d959a1cf4bedcf531c](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)\".",
    "created_at": "2019-03-26T13:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a323c0965f3020045900cdb0fcb7702d4ec56f88](https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88)" to "[4cabfa73badacb19731e95d959a1cf4bedcf531c](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)".



---

archive/issue_comments_429106.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727\">83436ea</a></td><td><code>Fix usage of IPythonConsoleLexer</code></td></tr></table>\n",
    "created_at": "2019-03-26T13:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727">83436ea</a></td><td><code>Fix usage of IPythonConsoleLexer</code></td></tr></table>




---

archive/issue_comments_429107.json:
```json
{
    "body": "**Changing commit** from \"[4cabfa73badacb19731e95d959a1cf4bedcf531c](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)\" to \"[83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)\".",
    "created_at": "2019-03-26T13:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4cabfa73badacb19731e95d959a1cf4bedcf531c](https://github.com/sagemath/sagetrac-mirror/commit/4cabfa73badacb19731e95d959a1cf4bedcf531c)" to "[83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)".



---

archive/issue_events_243089.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T13:15:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243089"
}
```



---

archive/issue_events_243090.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-26T13:15:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243090"
}
```



---

archive/issue_comments_429108.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the \"sage:\" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.\n \n-To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.\n \n We also mark some non-Python blocks as what they are, to enable their highlighting.\n-\n``````\n",
    "created_at": "2019-03-26T13:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429108",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
 The goal of this ticket is to clean up highlighting in the documentation. There are several issues. Right now, we are patching pygments and Sphinx so that they know about the "sage:" prompt. Also, we are telling Sphinx to highlight all code blocks as if they were Python console blocks. There are various other types of code blocks in the Sage docs: Python, Cython, reST, LaTeX, etc., and right now many are not highlighted at all: Sphinx/pygments tries to parse them as the Python console and fails, so does nothing. Even some of the Sage console blocks aren't highlighted correctly, because pygments refuses to parse input like `sage: a?`: valid IPython but not valid Python.
 
-To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when ben building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
+To improve the situation: Sage's console is based more on IPython than on Python, and IPython comes with a lexer to use when building its own documentation. Furthermore, that lexer explicitly allows for customization of the input prompt. So we can get rid of the prompt patches and use IPython's lexer, and it succeeds at highlighting blocks containing `sage: a?` and other IPython-type text. The only disadvantage to this is that IPython's lexer doesn't convert `<BLANKLINE>` in doctest output to a blank line, so we add a Sphinx transform to handle this.
 
 We also mark some non-Python blocks as what they are, to enable their highlighting.
-
``````




---

archive/issue_comments_429109.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Jeroen Demeyer\".",
    "created_at": "2019-03-26T13:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429109",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Jeroen Demeyer".



---

archive/issue_comments_429110.json:
```json
{
    "body": "<a id='comment:32'></a>\nI didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.",
    "created_at": "2019-03-26T13:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429110",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
I didn't understand the rationale for making a difference depending on the Python version running the docbuilder: the sources are the same on Python 2 and Python 3, so the documentation should also be the same. So I'm using the default version (which is currently Python 2) always.



---

archive/issue_comments_429111.json:
```json
{
    "body": "<a id='comment:33'></a>\nPlease review the last 3 commits.",
    "created_at": "2019-03-26T14:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429111",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Please review the last 3 commits.



---

archive/issue_comments_429112.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [git](#comment%3A28):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n\n\nI thought wrong indentations result in sphinx errors...",
    "created_at": "2019-03-26T14:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429112",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Replying to [git](#comment%3A28):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>


I thought wrong indentations result in sphinx errors...



---

archive/issue_comments_429113.json:
```json
{
    "body": "<a id='comment:35'></a>\nMy one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)",
    "created_at": "2019-03-26T17:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429113",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>
My one objection is that the version for the `pygments` package should not say `.p0` since there are no patches any more. Is there anything to be done about this? (Aside from waiting for the next release, that is.)



---

archive/issue_comments_429114.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [dimpase](#comment%3A34):\n> Replying to [git](#comment%3A28):\n> > Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n\n> \n> I thought wrong indentations result in sphinx errors...\n\n\nSometimes it just results in Sphinx silently ignoring the directive.",
    "created_at": "2019-03-26T17:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429114",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
Replying to [dimpase](#comment%3A34):
> Replying to [git](#comment%3A28):
> > Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>

> 
> I thought wrong indentations result in sphinx errors...


Sometimes it just results in Sphinx silently ignoring the directive.



---

archive/issue_comments_429115.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [jhpalmieri](#comment%3A36):\n> Replying to [dimpase](#comment%3A34):\n> > Replying to [git](#comment%3A28):\n> > > Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88\">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>\n\n> > \n> > I thought wrong indentations result in sphinx errors...\n\n> \n> Sometimes it just results in Sphinx silently ignoring the directive.\n\n\nActually this case looked like\n\n```\ntext\n\n .. CODE-BLOCK:: rest\n\n    more text\n```\nand Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.",
    "created_at": "2019-03-26T18:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429115",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>
Replying to [jhpalmieri](#comment%3A36):
> Replying to [dimpase](#comment%3A34):
> > Replying to [git](#comment%3A28):
> > > Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a323c0965f3020045900cdb0fcb7702d4ec56f88">a323c09</a></td><td><code>Fix a few CODE-BLOCK indentations</code></td></tr></table>

> > 
> > I thought wrong indentations result in sphinx errors...

> 
> Sometimes it just results in Sphinx silently ignoring the directive.


Actually this case looked like

```
text

 .. CODE-BLOCK:: rest

    more text
```
and Sphinx interpreted the extra space in front of `.. CODE-BLOCK...` just as indentation, so the code block was highlighted correctly, just indented more than it should have been.



---

archive/issue_events_243091.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-26T18:15:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243091"
}
```



---

archive/issue_events_243092.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-03-26T18:15:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243092"
}
```



---

archive/issue_comments_429116.json:
```json
{
    "body": "<a id='comment:38'></a>\nJeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.",
    "created_at": "2019-03-26T18:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429116",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:38'></a>
Jeroen, thanks for the fixes. There is probably nothing to be done about the pygments version number.



---

archive/issue_comments_429117.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)\" to \"[83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)\".",
    "created_at": "2019-03-30T20:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-429117",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/sphinx-highlight](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sphinx-highlight)" to "[83436ea82a17406bbc3fdd9e8c386208abc93727](https://github.com/sagemath/sagetrac-mirror/commit/83436ea82a17406bbc3fdd9e8c386208abc93727)".



---

archive/issue_events_243093.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:38:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243093"
}
```



---

archive/issue_events_243094.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-30T20:38:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27528#event-243094"
}
```
