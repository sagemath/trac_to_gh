# Issue 27993: Make outer normal fans readily available

archive/issues_027756.json:
```json
{
    "body": "For a polytope `P`, both `NormalFan(P)` and `P.normal_fan()` return the inner normal fan having the inner facet normals as rays. The outer normal fan, using the outer facet normals, is well-known, but not as easy to find in Sage.\n\nAs an example, create the polytope on p.193 of Ziegler's \"Lectures on Polytopes\" with its normal fan:\n\n```\nsage: V=[(-8,-4),(-8,6),(-4,-8),(0,-9),(0,6),(4,-8)]\nsage: P=Polyhedron(V)\nsage: NormalFan(P)\n```\n\nThe result is the inner normal fan of `P`, which is the outer normal fan of `-P`.\n\nThis ticket adds to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`. The description of `NormalFan` is extended by a hint to use `NormalFan(-P)` for the outer normal fan.\n\nAdditionally, this ticket adds in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.\nThis allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.\n\n\nCC:  @jplab\n\nKeywords: NormalFan, polytope, days100\n\nBranch/Commit: 440689c758f36b80c4dd0a9a88eee5c5d60f2b22\n\nReviewer: Jean-Philippe Labb\u00e9, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Julian Ritter\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27993\n\n",
    "closed_at": "2019-07-29T21:54:56Z",
    "created_at": "2019-06-14T14:46:58Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Make outer normal fans readily available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27993",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```
For a polytope `P`, both `NormalFan(P)` and `P.normal_fan()` return the inner normal fan having the inner facet normals as rays. The outer normal fan, using the outer facet normals, is well-known, but not as easy to find in Sage.

As an example, create the polytope on p.193 of Ziegler's "Lectures on Polytopes" with its normal fan:

```
sage: V=[(-8,-4),(-8,6),(-4,-8),(0,-9),(0,6),(4,-8)]
sage: P=Polyhedron(V)
sage: NormalFan(P)
```

The result is the inner normal fan of `P`, which is the outer normal fan of `-P`.

This ticket adds to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`. The description of `NormalFan` is extended by a hint to use `NormalFan(-P)` for the outer normal fan.

Additionally, this ticket adds in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.
This allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.


CC:  @jplab

Keywords: NormalFan, polytope, days100

Branch/Commit: 440689c758f36b80c4dd0a9a88eee5c5d60f2b22

Reviewer: Jean-Philippe Labbé, Frédéric Chapoton

Author: Julian Ritter

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27993





---

archive/issue_comments_542254.json:
```json
{
    "body": "Changing branch from \"\" to \"u/nailuj/normalfan_outer\"",
    "created_at": "2019-06-14T14:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542254",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Changing branch from "" to "u/nailuj/normalfan_outer"



---

archive/issue_comments_542255.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-06-14T14:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542255",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_542256.json:
```json
{
    "body": "Changing commit from \"\" to \"484bf563c383e0b0fc85fd3e2af991dfb41a9932\"",
    "created_at": "2019-06-14T14:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542256",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Changing commit from "" to "484bf563c383e0b0fc85fd3e2af991dfb41a9932"



---

archive/issue_comments_542257.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2019-06-14T14:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542257",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_542258.json:
```json
{
    "body": "<a id='comment:3'></a>Sage 8.8 is to be released fairly soon so unless this is a blocker this should be moved to the next release.",
    "created_at": "2019-06-14T14:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542258",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Sage 8.8 is to be released fairly soon so unless this is a blocker this should be moved to the next release.



---

archive/issue_events_069369.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:51:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27993#event-69369"
}
```



---

archive/issue_comments_542259.json:
```json
{
    "body": "<a id='comment:4'></a>I don't care much about adding `direction` argument, but I have **extremely strong objection** to making it the default. There was a reason why inner normals were used for many, many years (like since 2006) - it is consistent with the literature. I understand that some books/articles use the other way, but when neither way is exceptionally uncommon the default choice is pretty much random personal preference when you first create these classes and methods. Once they were created and used for a long time, there is absolutely no reason to change the default whatever it is.",
    "created_at": "2019-06-14T16:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542259",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>I don't care much about adding `direction` argument, but I have **extremely strong objection** to making it the default. There was a reason why inner normals were used for many, many years (like since 2006) - it is consistent with the literature. I understand that some books/articles use the other way, but when neither way is exceptionally uncommon the default choice is pretty much random personal preference when you first create these classes and methods. Once they were created and used for a long time, there is absolutely no reason to change the default whatever it is.



---

archive/issue_comments_542260.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 novoselt]:\n> I don't care much about adding `direction` argument, but I have **extremely strong objection** to making it the default. There was a reason why inner normals were used for many, many years (like since 2006) - it is consistent with the literature. I understand that some books/articles use the other way, but when neither way is exceptionally uncommon the default choice is pretty much random personal preference when you first create these classes and methods. Once they were created and used for a long time, there is absolutely no reason to change the default whatever it is.\n\n\n+1\n\nI would leave the default as it is and add the `direction` argument to allow to get the variant.",
    "created_at": "2019-06-15T09:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542260",
    "user": "https://github.com/jplab"
}
```

<a id='comment:5'></a>Replying to [comment:4 novoselt]:
> I don't care much about adding `direction` argument, but I have **extremely strong objection** to making it the default. There was a reason why inner normals were used for many, many years (like since 2006) - it is consistent with the literature. I understand that some books/articles use the other way, but when neither way is exceptionally uncommon the default choice is pretty much random personal preference when you first create these classes and methods. Once they were created and used for a long time, there is absolutely no reason to change the default whatever it is.


+1

I would leave the default as it is and add the `direction` argument to allow to get the variant.



---

archive/issue_comments_542261.json:
```json
{
    "body": "<a id='comment:6'></a>Actually, I think now it would be better to allow quick \"direction flip\" either on the polytope or the fan, i.e. make them support `-` operator, instead of making constructors more complicated.",
    "created_at": "2019-06-15T20:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542261",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>Actually, I think now it would be better to allow quick "direction flip" either on the polytope or the fan, i.e. make them support `-` operator, instead of making constructors more complicated.



---

archive/issue_comments_542262.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 novoselt]:\n> Actually, I think now it would be better to allow quick \"direction flip\" either on the polytope or the fan, i.e. make them support `-` operator, instead of making constructors more complicated.\n\n\nThis seems to already be possible for `Polyhedron` objects:\n\n```\nsage: p = polytopes.regular_polygon(5)\nsage: p.vertices()\n(A vertex at (0.5877852522924731?, -0.8090169943749474?),\n A vertex at (0.9510565162951536?, 0.3090169943749474?),\n A vertex at (0, 1),\n A vertex at (-0.5877852522924731?, -0.8090169943749474?),\n A vertex at (-0.9510565162951536?, 0.3090169943749474?))\nsage: (-p).vertices()\n(A vertex at (-0.5877852522924731?, 0.8090169943749474?),\n A vertex at (-0.9510565162951536?, -0.3090169943749474?),\n A vertex at (0, -1),\n A vertex at (0.587785252292474?, 0.8090169943749474?),\n A vertex at (0.9510565162951536?, -0.3090169943749474?))\n```\n\nOr you have something else in mind?\n\nYes, I would use `NormalFan(-P)`  or `NormalFan(P)` depending on whether one wants the inner or outer. This seems like the easiest thing to do. One does not need to go into the `Polyhedron` constructor...",
    "created_at": "2019-06-15T23:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542262",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'></a>Replying to [comment:6 novoselt]:
> Actually, I think now it would be better to allow quick "direction flip" either on the polytope or the fan, i.e. make them support `-` operator, instead of making constructors more complicated.


This seems to already be possible for `Polyhedron` objects:

```
sage: p = polytopes.regular_polygon(5)
sage: p.vertices()
(A vertex at (0.5877852522924731?, -0.8090169943749474?),
 A vertex at (0.9510565162951536?, 0.3090169943749474?),
 A vertex at (0, 1),
 A vertex at (-0.5877852522924731?, -0.8090169943749474?),
 A vertex at (-0.9510565162951536?, 0.3090169943749474?))
sage: (-p).vertices()
(A vertex at (-0.5877852522924731?, 0.8090169943749474?),
 A vertex at (-0.9510565162951536?, -0.3090169943749474?),
 A vertex at (0, -1),
 A vertex at (0.587785252292474?, 0.8090169943749474?),
 A vertex at (0.9510565162951536?, -0.3090169943749474?))
```

Or you have something else in mind?

Yes, I would use `NormalFan(-P)`  or `NormalFan(P)` depending on whether one wants the inner or outer. This seems like the easiest thing to do. One does not need to go into the `Polyhedron` constructor...



---

archive/issue_comments_542263.json:
```json
{
    "body": "<a id='comment:8'></a>That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction=\"outer\")`.",
    "created_at": "2019-06-15T23:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542263",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction="outer")`.



---

archive/issue_comments_542264.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2019-07-17T11:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542264",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_542265.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 novoselt]:\n> That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction=\"outer\")`.\n\n\nI believe that the proposed change would be in the method `.normal_fan()` of `Polyhedron` objects, and not at the level of `NormalFan`, for the reason you mention.\n\nThat said, I would change the description of the ticket as follows:\n\n> I propose to add to `normal_fan` an argument direction set to either `'outer'` or `'inner'` to determine which of the directions to use. The default will stay inner in order to match the default of `NormalFan`.\n\n\nAbove I would keep the current default.\n\n> Additionally, I propose to add in sage.geometry.polyhedron.representation a method Inequality.outer_normal. This allows to obtain the outer normal vector without having to think about the appropriate sign of Inequality.A() whenever dealing with the facet inequalities of a polyhedron. \n\n\nThis is good to me.\n\nFurther, I would suggest to add \n\n> Use `NormalFan(-P)` to get the outer normal fan.\n\n\nin the documentation of `NormalFan`.",
    "created_at": "2019-07-17T11:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542265",
    "user": "https://github.com/jplab"
}
```

<a id='comment:9'></a>Replying to [comment:8 novoselt]:
> That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction="outer")`.


I believe that the proposed change would be in the method `.normal_fan()` of `Polyhedron` objects, and not at the level of `NormalFan`, for the reason you mention.

That said, I would change the description of the ticket as follows:

> I propose to add to `normal_fan` an argument direction set to either `'outer'` or `'inner'` to determine which of the directions to use. The default will stay inner in order to match the default of `NormalFan`.


Above I would keep the current default.

> Additionally, I propose to add in sage.geometry.polyhedron.representation a method Inequality.outer_normal. This allows to obtain the outer normal vector without having to think about the appropriate sign of Inequality.A() whenever dealing with the facet inequalities of a polyhedron. 


This is good to me.

Further, I would suggest to add 

> Use `NormalFan(-P)` to get the outer normal fan.


in the documentation of `NormalFan`.



---

archive/issue_comments_542266.json:
```json
{
    "body": "Changing commit from \"484bf563c383e0b0fc85fd3e2af991dfb41a9932\" to \"b41def5d69156640996e4a6e60d29d17b36bd435\"",
    "created_at": "2019-07-22T12:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "484bf563c383e0b0fc85fd3e2af991dfb41a9932" to "b41def5d69156640996e4a6e60d29d17b36bd435"



---

archive/issue_comments_542267.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-22T12:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_542268.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-22T12:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_542269.json:
```json
{
    "body": "Changing commit from \"b41def5d69156640996e4a6e60d29d17b36bd435\" to \"fd3e89926e9648fb36bb2c087deb24b0c3938ef1\"",
    "created_at": "2019-07-22T12:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b41def5d69156640996e4a6e60d29d17b36bd435" to "fd3e89926e9648fb36bb2c087deb24b0c3938ef1"



---

archive/issue_comments_542270.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 jipilab]:\n> Replying to [comment:8 novoselt]:\n> > That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction=\"outer\")`.\n\n> \n> I believe that the proposed change would be in the method `.normal_fan()` of `Polyhedron` objects, and not at the level of `NormalFan`, for the reason you mention.\n\n\nYes. I stumbled upon this inner-outer issue through `Polyhedron.normal_fan()`. This is why I added jipilab in CC in the first place, and this is where I should have proposed to make `'outer'` the default \u2013 my bad. I'm fine with `'inner'` as default in both files. My main goal was easier access to outer normal fans, which is now available and explained in the docstrings.\n\n> That said, I would change the description of the ticket as follows:\n> \n> > I propose to add to `normal_fan` an argument direction set to either `'outer'` or `'inner'` to determine which of the directions to use. The default will stay inner in order to match the default of `NormalFan`.\n\n\nDone.\n \n> Further, I would suggest to add \n> \n> > Use `NormalFan(-P)` to get the outer normal fan.\n\n> \n> in the documentation of `NormalFan`.\n\n\nDone.",
    "created_at": "2019-07-22T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542270",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:12'></a>Replying to [comment:9 jipilab]:
> Replying to [comment:8 novoselt]:
> > That's exactly what I meant. I think those who care about directions are likely to read the documentation and discover that these are inner normals. After that, if this is not the desired choice for the user, `NormalFan(-P)` seems easier and cleaner to use than `NormalFan(P, direction="outer")`.

> 
> I believe that the proposed change would be in the method `.normal_fan()` of `Polyhedron` objects, and not at the level of `NormalFan`, for the reason you mention.


Yes. I stumbled upon this inner-outer issue through `Polyhedron.normal_fan()`. This is why I added jipilab in CC in the first place, and this is where I should have proposed to make `'outer'` the default – my bad. I'm fine with `'inner'` as default in both files. My main goal was easier access to outer normal fans, which is now available and explained in the docstrings.

> That said, I would change the description of the ticket as follows:
> 
> > I propose to add to `normal_fan` an argument direction set to either `'outer'` or `'inner'` to determine which of the directions to use. The default will stay inner in order to match the default of `NormalFan`.


Done.
 
> Further, I would suggest to add 
> 
> > Use `NormalFan(-P)` to get the outer normal fan.

> 
> in the documentation of `NormalFan`.


Done.



---

archive/issue_comments_542271.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,8 +19,9 @@\n In both cases, the normal vectors obtained are directed towards the interior of the polytope. \n Therefore, the resulting fan differs from what would be obtained when using the outer normal vectors instead.\n \n-I propose to add to `NormalFan` an argument `direction` set to either `'outer'` or `'inner'` to determine which of the directions to use. \n-In line with the definition in Ziegler's book, I would prefer to make `'outer'` the default choice.\n+\n+I propose to add to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`.\n+\n \n Additionally, I propose to add in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.\n This allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.\n``````\n",
    "created_at": "2019-07-22T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542271",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,8 +19,9 @@
 In both cases, the normal vectors obtained are directed towards the interior of the polytope. 
 Therefore, the resulting fan differs from what would be obtained when using the outer normal vectors instead.
 
-I propose to add to `NormalFan` an argument `direction` set to either `'outer'` or `'inner'` to determine which of the directions to use. 
-In line with the definition in Ziegler's book, I would prefer to make `'outer'` the default choice.
+
+I propose to add to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`.
+
 
 Additionally, I propose to add in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.
 This allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.
``````




---

archive/issue_comments_542272.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-22T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542272",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_542273.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jean-Philippe Labb\u00e9\"",
    "created_at": "2019-07-22T15:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542273",
    "user": "https://github.com/jplab"
}
```

Changing reviewer from "" to "Jean-Philippe Labbé"



---

archive/issue_comments_542274.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-07-22T15:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542274",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_542275.json:
```json
{
    "body": "Changing keywords from \"NormalFan, polytope\" to \"NormalFan, polytope, days100\".",
    "created_at": "2019-07-22T15:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542275",
    "user": "https://github.com/jplab"
}
```

Changing keywords from "NormalFan, polytope" to "NormalFan, polytope, days100".



---

archive/issue_comments_542276.json:
```json
{
    "body": "<a id='comment:13'></a>- The optional parameters should receive an appropriate doctest. For example:\n\n   {{{\nsage: p = polytopes.regular_polygon(4,base_ring=QQ).pyramid()\nsage: inner_nf = p.normal_fan()\nsage: inner_nf.rays()\nN( 1,  0,  0),\nN(-1,  1,  1),\nN(-1,  1, -1),\nN(-1, -1, -1),\nN(-1, -1,  1)\nin 3-d lattice N\n\nsage: outer_nf = p.normal_fan(direction='outer')\nsage: outer_nf.rays()\nN(-1,  0,  0),\nN( 1,  1, -1),\nN( 1,  1,  1),\nN( 1, -1,  1),\nN( 1, -1, -1)\nin 3-d lattice N\n}}}\n\n- Further, it would be nice to disallow such things:\n\n```\nsage: outer_nf = p.normal_fan(direction='blabla')\n```\n   by checking that direction is one of the two allowed things (see the volume function for a similar handling).\n\n- Remove the space before the semi-colon in the docstring of `normal_fan`.",
    "created_at": "2019-07-22T15:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542276",
    "user": "https://github.com/jplab"
}
```

<a id='comment:13'></a>- The optional parameters should receive an appropriate doctest. For example:

   {{{
sage: p = polytopes.regular_polygon(4,base_ring=QQ).pyramid()
sage: inner_nf = p.normal_fan()
sage: inner_nf.rays()
N( 1,  0,  0),
N(-1,  1,  1),
N(-1,  1, -1),
N(-1, -1, -1),
N(-1, -1,  1)
in 3-d lattice N

sage: outer_nf = p.normal_fan(direction='outer')
sage: outer_nf.rays()
N(-1,  0,  0),
N( 1,  1, -1),
N( 1,  1,  1),
N( 1, -1,  1),
N( 1, -1, -1)
in 3-d lattice N
}}}

- Further, it would be nice to disallow such things:

```
sage: outer_nf = p.normal_fan(direction='blabla')
```
   by checking that direction is one of the two allowed things (see the volume function for a similar handling).

- Remove the space before the semi-colon in the docstring of `normal_fan`.



---

archive/issue_comments_542277.json:
```json
{
    "body": "Changing commit from \"fd3e89926e9648fb36bb2c087deb24b0c3938ef1\" to \"308dada78b84d1436dca28bd970e768d6ea6c42b\"",
    "created_at": "2019-07-23T07:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fd3e89926e9648fb36bb2c087deb24b0c3938ef1" to "308dada78b84d1436dca28bd970e768d6ea6c42b"



---

archive/issue_comments_542278.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-23T07:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_542279.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-23T08:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542279",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_542280.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 jipilab]:\n> The optional parameters should receive an appropriate doctest. For example:\n> \n>    {{{\n> sage: p = polytopes.regular_polygon(4,base_ring=QQ).pyramid()\n> sage: inner_nf = p.normal_fan()\n> sage: inner_nf.rays()\n> N( 1,  0,  0),\n> N(-1,  1,  1),\n> N(-1,  1, -1),\n> N(-1, -1, -1),\n> N(-1, -1,  1)\n> in 3-d lattice N\n> \n> sage: outer_nf = p.normal_fan(direction='outer')\n> sage: outer_nf.rays()\n> N(-1,  0,  0),\n> N( 1,  1, -1),\n> N( 1,  1,  1),\n> N( 1, -1,  1),\n> N( 1, -1, -1)\n> in 3-d lattice N\n> }}}\n\nI added a 2-d example testing inner, outer, and an invalid direction.\n\n> Further, it would be nice to disallow such things:\n> \n> ```\n> sage: outer_nf = p.normal_fan(direction='blabla')\n> ```\n> by checking that direction is one of the two allowed things (see the volume function for a similar handling).\n\nDone.\n \n> Remove the space before the semi-colon in the docstring of `normal_fan`.\n\nDone.",
    "created_at": "2019-07-23T08:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542280",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:15'></a>Replying to [comment:13 jipilab]:
> The optional parameters should receive an appropriate doctest. For example:
> 
>    {{{
> sage: p = polytopes.regular_polygon(4,base_ring=QQ).pyramid()
> sage: inner_nf = p.normal_fan()
> sage: inner_nf.rays()
> N( 1,  0,  0),
> N(-1,  1,  1),
> N(-1,  1, -1),
> N(-1, -1, -1),
> N(-1, -1,  1)
> in 3-d lattice N
> 
> sage: outer_nf = p.normal_fan(direction='outer')
> sage: outer_nf.rays()
> N(-1,  0,  0),
> N( 1,  1, -1),
> N( 1,  1,  1),
> N( 1, -1,  1),
> N( 1, -1, -1)
> in 3-d lattice N
> }}}

I added a 2-d example testing inner, outer, and an invalid direction.

> Further, it would be nice to disallow such things:
> 
> ```
> sage: outer_nf = p.normal_fan(direction='blabla')
> ```
> by checking that direction is one of the two allowed things (see the volume function for a similar handling).

Done.
 
> Remove the space before the semi-colon in the docstring of `normal_fan`.

Done.



---

archive/issue_comments_542281.json:
```json
{
    "body": "<a id='comment:16'></a>Great!\n\nCould you do one change: the backtick in the error message should be a single quote.\n\nI would also fix the title of the ticket and the description to reflect the actual changes involved.",
    "created_at": "2019-07-23T08:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542281",
    "user": "https://github.com/jplab"
}
```

<a id='comment:16'></a>Great!

Could you do one change: the backtick in the error message should be a single quote.

I would also fix the title of the ticket and the description to reflect the actual changes involved.



---

archive/issue_comments_542282.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-23T13:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_542283.json:
```json
{
    "body": "Changing commit from \"308dada78b84d1436dca28bd970e768d6ea6c42b\" to \"9d20a1d2ef73c9fa4e89dc0657033191d22793fd\"",
    "created_at": "2019-07-23T13:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "308dada78b84d1436dca28bd970e768d6ea6c42b" to "9d20a1d2ef73c9fa4e89dc0657033191d22793fd"



---

archive/issue_comments_542284.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 jipilab]:\n> Could you do one change: the backtick in the error message should be a single quote.\n\nDone.\n\n> I would also fix the title of the ticket and the description to reflect the actual changes involved.\n\nDone.",
    "created_at": "2019-07-23T13:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542284",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:18'></a>Replying to [comment:16 jipilab]:
> Could you do one change: the backtick in the error message should be a single quote.

Done.

> I would also fix the title of the ticket and the description to reflect the actual changes involved.

Done.



---

archive/issue_comments_542285.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,28 +1,17 @@\n-\n+For a polytope `P`, both `NormalFan(P)` and `P.normal_fan()` return the inner normal fan having the inner facet normals as rays. The outer normal fan, using the outer facet normals, is well-known, but not as easy to find in Sage.\n \n As an example, create the polytope on p.193 of Ziegler's \"Lectures on Polytopes\" with its normal fan:\n \n ```\n sage: V=[(-8,-4),(-8,6),(-4,-8),(0,-9),(0,6),(4,-8)]\n sage: P=Polyhedron(V)\n-sage: L=LatticePolytope(V)\n-sage: FanP, FanL = NormalFan(P), NormalFan(L)\n-sage: FanP == FanL\n-True\n+sage: NormalFan(P)\n ```\n \n-The two fans are equal, but they are not the same as the one presented in Ziegler's book.\n-In fact, following to the definition there, `FanP` and `FanL` give the normal fan of `-P`.\n+The result is the inner normal fan of `P`, which is the outer normal fan of `-P`.\n \n-The construction of `NormalFan(polytope)` uses the normal vectors of the facets, given by `polytope.facet_normals()` for a `LatticePolytope` \n-or given by `ieq.A() for ieq in polytope.inequalities()` for a `Polyhedron`.\n-In both cases, the normal vectors obtained are directed towards the interior of the polytope. \n-Therefore, the resulting fan differs from what would be obtained when using the outer normal vectors instead.\n+This ticket adds to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`. The description of `NormalFan` is extended by a hint to use `NormalFan(-P)` for the outer normal fan.\n \n-\n-I propose to add to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`.\n-\n-\n-Additionally, I propose to add in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.\n+Additionally, this ticket adds in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.\n This allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.\n \n``````\n",
    "created_at": "2019-07-23T13:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542285",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,28 +1,17 @@
-
+For a polytope `P`, both `NormalFan(P)` and `P.normal_fan()` return the inner normal fan having the inner facet normals as rays. The outer normal fan, using the outer facet normals, is well-known, but not as easy to find in Sage.
 
 As an example, create the polytope on p.193 of Ziegler's "Lectures on Polytopes" with its normal fan:
 
 ```
 sage: V=[(-8,-4),(-8,6),(-4,-8),(0,-9),(0,6),(4,-8)]
 sage: P=Polyhedron(V)
-sage: L=LatticePolytope(V)
-sage: FanP, FanL = NormalFan(P), NormalFan(L)
-sage: FanP == FanL
-True
+sage: NormalFan(P)
 ```
 
-The two fans are equal, but they are not the same as the one presented in Ziegler's book.
-In fact, following to the definition there, `FanP` and `FanL` give the normal fan of `-P`.
+The result is the inner normal fan of `P`, which is the outer normal fan of `-P`.
 
-The construction of `NormalFan(polytope)` uses the normal vectors of the facets, given by `polytope.facet_normals()` for a `LatticePolytope` 
-or given by `ieq.A() for ieq in polytope.inequalities()` for a `Polyhedron`.
-In both cases, the normal vectors obtained are directed towards the interior of the polytope. 
-Therefore, the resulting fan differs from what would be obtained when using the outer normal vectors instead.
+This ticket adds to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`. The description of `NormalFan` is extended by a hint to use `NormalFan(-P)` for the outer normal fan.
 
-
-I propose to add to `Polyhedron.normal_fan` an argument `direction` set to either `'inner'` or `'outer'` to determine which of the directions to use. The default will stay `'inner'` in order to match the default of `NormalFan`.
-
-
-Additionally, I propose to add in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.
+Additionally, this ticket adds in `sage.geometry.polyhedron.representation` a method `Inequality.outer_normal`.
 This allows to obtain the outer normal vector without having to think about the appropriate sign of `Inequality.A()` whenever dealing with the facet inequalities of a polyhedron.
 
``````




---

archive/issue_comments_542286.json:
```json
{
    "body": "<a id='comment:19'></a>The doctest still has backticks.",
    "created_at": "2019-07-23T20:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542286",
    "user": "https://github.com/jplab"
}
```

<a id='comment:19'></a>The doctest still has backticks.



---

archive/issue_comments_542287.json:
```json
{
    "body": "Changing commit from \"9d20a1d2ef73c9fa4e89dc0657033191d22793fd\" to \"440689c758f36b80c4dd0a9a88eee5c5d60f2b22\"",
    "created_at": "2019-07-24T06:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d20a1d2ef73c9fa4e89dc0657033191d22793fd" to "440689c758f36b80c4dd0a9a88eee5c5d60f2b22"



---

archive/issue_comments_542288.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-24T06:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_542289.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-24T09:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542289",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_542290.json:
```json
{
    "body": "<a id='comment:21'></a>ok, c'est correct",
    "created_at": "2019-07-24T09:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542290",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>ok, c'est correct



---

archive/issue_comments_542291.json:
```json
{
    "body": "Changing reviewer from \"Jean-Philippe Labb\u00e9\" to \"Jean-Philippe Labb\u00e9, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2019-07-24T09:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542291",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "Jean-Philippe Labbé" to "Jean-Philippe Labbé, Frédéric Chapoton"



---

archive/issue_events_069370.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-29T21:54:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27993#event-69370"
}
```



---

archive/issue_comments_542292.json:
```json
{
    "body": "Changing branch from \"u/nailuj/normalfan_outer\" to \"440689c758f36b80c4dd0a9a88eee5c5d60f2b22\"",
    "created_at": "2019-07-29T21:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542292",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/nailuj/normalfan_outer" to "440689c758f36b80c4dd0a9a88eee5c5d60f2b22"



---

archive/issue_comments_542293.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-29T21:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27993",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27993#issuecomment-542293",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
