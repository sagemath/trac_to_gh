# Issue 27915: Planar graph layout does not respect clockwise ordering of neighbors in combinatorial embedding

archive/issues_027915.json:
```json
{
    "body": "Keywords: graph,planar,clockwise,embedding\n\nConsider the claw S<sub>3</sub>:\n\n```\nS3 = Graph([[0,1,2,3],[[0,1],[0,2],[0,3]]])\n```\n\nThe following combinatorial embedding is respected in the planar layout (the neighbors are in the given clockwise order):\n\n```\nS3.set_embedding({0: [1,2,3], 1: [0], 2: [0], 3: [0]})\nS3.layout('planar', save_pos=True)\nS3.show()\n```\n\nWhile this one isn't:\n\n```\nS3.set_embedding({0: [3,2,1], 1: [0], 2: [0], 3: [0]})\nS3.layout('planar', save_pos=True)\nS3.show()\n```\n\nIn the latter, the neighbors are in the *counter*clockwise order (in fact the picture is the same as the former).\n\nStrictly speaking, `layout_planar` (which is called by `layout`) does not promise to use the combinatorial embedding. But it does provide an option `on_embedding` which I assume should allow this:\n\n```\nS3.set_pos(S3.layout_planar(on_embedding={0: [3,2,1], 1: [0], 2: [0], 3: [0]}))\n```\n\nStill, the combinatorial embedding is not respected. I think this is because in `layout_planar` the line `G.is_planar(set_embedding=True)` executed unconditionally (totally ignoring `on_embedding`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/28152\n\n",
    "closed_at": "2019-08-08T21:24:33Z",
    "created_at": "2019-07-10T09:43:27Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Planar graph layout does not respect clockwise ordering of neighbors in combinatorial embedding",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27915",
    "user": "https://github.com/rburing"
}
```
Keywords: graph,planar,clockwise,embedding

Consider the claw S<sub>3</sub>:

```
S3 = Graph([[0,1,2,3],[[0,1],[0,2],[0,3]]])
```

The following combinatorial embedding is respected in the planar layout (the neighbors are in the given clockwise order):

```
S3.set_embedding({0: [1,2,3], 1: [0], 2: [0], 3: [0]})
S3.layout('planar', save_pos=True)
S3.show()
```

While this one isn't:

```
S3.set_embedding({0: [3,2,1], 1: [0], 2: [0], 3: [0]})
S3.layout('planar', save_pos=True)
S3.show()
```

In the latter, the neighbors are in the *counter*clockwise order (in fact the picture is the same as the former).

Strictly speaking, `layout_planar` (which is called by `layout`) does not promise to use the combinatorial embedding. But it does provide an option `on_embedding` which I assume should allow this:

```
S3.set_pos(S3.layout_planar(on_embedding={0: [3,2,1], 1: [0], 2: [0], 3: [0]}))
```

Still, the combinatorial embedding is not respected. I think this is because in `layout_planar` the line `G.is_planar(set_embedding=True)` executed unconditionally (totally ignoring `on_embedding`).

Issue created by migration from https://trac.sagemath.org/ticket/28152





---

archive/issue_comments_393716.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-15T00:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393716",
    "user": "https://github.com/hensc"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393717.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-15T00:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393717",
    "user": "https://github.com/hensc"
}
```

New commits:



---

archive/issue_comments_393718.json:
```json
{
    "body": "A few stylistic comments. Recall that comments must be in 80 columns mode and that we do our best to follow the [pep8](https://www.python.org/dev/peps/pep-0008) conventions.\n\n```diff\n-        TESTS::\n-\n-            Check the dependence of the computed position on the given\n-            combinatorial embedding (:trac:`28152`).\n+        TESTS:\n+\n+        Check the dependence of the computed position on the given\n+        combinatorial embedding (:trac:`28152`)::\n```\n\n```diff\n-    all triangles, and return the set of newly created edges. Also comb_emb\n+    all triangles, and return the set of newly created edges. Also ``comb_emb``\n```\n\npep8\n\n```diff\n-            comb_emb[w].insert(comb_emb[w].index(x),u)\n-            comb_emb[u].insert(comb_emb[u].index(v),w)\n+            comb_emb[w].insert(comb_emb[w].index(x), u)\n+            comb_emb[u].insert(comb_emb[u].index(v), w)\n```\n\n80 columns mode\n\n```diff\n-    # Up to this point we did not take the order of the external face into account.\n-    # Since the combinatorial embedding of a triangulated is only unique up to\n-    # the choice of the outer face and reflection, this might lead to a reflection\n-    # of the Schnyder drawing resulting from this labeling which is not conformal\n-    # with comb_emb any longer. Therefore, we might have to swap the labels 1 and 2.\n+    # Up to this point we did not take the order of the external face into\n+    # account. Since the combinatorial embedding of a triangulation is unique\n+    # up to the choice of the outer face and reflection, this might lead\n+    # to a reflection of the Schnyder drawing resulting from this labeling which\n+    # is not conformal with comb_emb any longer. Therefore, we might have to\n+    # swap the labels 1 and 2.\n```\nI also did minor changes in above text. Please check.\n\nPasses all tests with py3. I have not fully tested yet de functionality.",
    "created_at": "2019-07-15T02:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393718",
    "user": "https://github.com/dcoudert"
}
```

A few stylistic comments. Recall that comments must be in 80 columns mode and that we do our best to follow the [pep8](https://www.python.org/dev/peps/pep-0008) conventions.

```diff
-        TESTS::
-
-            Check the dependence of the computed position on the given
-            combinatorial embedding (:trac:`28152`).
+        TESTS:
+
+        Check the dependence of the computed position on the given
+        combinatorial embedding (:trac:`28152`)::
```

```diff
-    all triangles, and return the set of newly created edges. Also comb_emb
+    all triangles, and return the set of newly created edges. Also ``comb_emb``
```

pep8

```diff
-            comb_emb[w].insert(comb_emb[w].index(x),u)
-            comb_emb[u].insert(comb_emb[u].index(v),w)
+            comb_emb[w].insert(comb_emb[w].index(x), u)
+            comb_emb[u].insert(comb_emb[u].index(v), w)
```

80 columns mode

```diff
-    # Up to this point we did not take the order of the external face into account.
-    # Since the combinatorial embedding of a triangulated is only unique up to
-    # the choice of the outer face and reflection, this might lead to a reflection
-    # of the Schnyder drawing resulting from this labeling which is not conformal
-    # with comb_emb any longer. Therefore, we might have to swap the labels 1 and 2.
+    # Up to this point we did not take the order of the external face into
+    # account. Since the combinatorial embedding of a triangulation is unique
+    # up to the choice of the outer face and reflection, this might lead
+    # to a reflection of the Schnyder drawing resulting from this labeling which
+    # is not conformal with comb_emb any longer. Therefore, we might have to
+    # swap the labels 1 and 2.
```
I also did minor changes in above text. Please check.

Passes all tests with py3. I have not fully tested yet de functionality.



---

archive/issue_comments_393719.json:
```json
{
    "body": "one failing doctest in src/sage/graphs/planarity.pyx, see patchbot report",
    "created_at": "2019-07-15T06:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393719",
    "user": "https://github.com/fchapoton"
}
```

one failing doctest in src/sage/graphs/planarity.pyx, see patchbot report



---

archive/issue_comments_393720.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-07-15T09:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393720",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_393721.json:
```json
{
    "body": "Thanks for the effort so far. I suggest also to add a line of documentation, at least in `layout_planar`, explaining which combinatorial embedding is used when, e.g. \"If `on_embedding` is provided then that combinatorial embedding is used for the layout. Otherwise: if a combinatorial embedding is set (e.g. using `set_embedding`) then that one is used, and if no combinatorial embedding is set then one is computed.\" (modify it to make it a true statement).",
    "created_at": "2019-07-15T09:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393721",
    "user": "https://github.com/rburing"
}
```

Thanks for the effort so far. I suggest also to add a line of documentation, at least in `layout_planar`, explaining which combinatorial embedding is used when, e.g. "If `on_embedding` is provided then that combinatorial embedding is used for the layout. Otherwise: if a combinatorial embedding is set (e.g. using `set_embedding`) then that one is used, and if no combinatorial embedding is set then one is computed." (modify it to make it a true statement).



---

archive/issue_comments_393722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-15T10:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-15T10:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393724.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-15T10:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393725.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-18T19:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393726.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-18T19:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393726",
    "user": "https://github.com/hensc"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_393727.json:
```json
{
    "body": "I fixed the pep8 and also fixed the bug that made the doctest fail.\nNow the patchbot passed all tests.\n\nI also made the documentation more precise about which combinatorial embedding is used. But unfortunately it is not as rburing thought (and I think to be more intuitive, too) that `on_embedding` is always used if it is given. If `set_embedding` is set to `True`, then `on_embedding` is ignored. So the question is if we could/should/want to change this behavior.",
    "created_at": "2019-07-18T20:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393727",
    "user": "https://github.com/hensc"
}
```

I fixed the pep8 and also fixed the bug that made the doctest fail.
Now the patchbot passed all tests.

I also made the documentation more precise about which combinatorial embedding is used. But unfortunately it is not as rburing thought (and I think to be more intuitive, too) that `on_embedding` is always used if it is given. If `set_embedding` is set to `True`, then `on_embedding` is ignored. So the question is if we could/should/want to change this behavior.



---

archive/issue_comments_393728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-21T09:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393729.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-30T10:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393730.json:
```json
{
    "body": "please review",
    "created_at": "2019-08-02T23:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393730",
    "user": "https://github.com/hensc"
}
```

please review



---

archive/issue_comments_393731.json:
```json
{
    "body": "I have only a minor comment. Otherwise seems ok.\n\n```diff\n-            for (v,w) in labels[u]:\n-                if labels[u][(v,w)] == 1:\n-                    labels[u][(v,w)] = 2\n-                elif labels[u][(v,w)] == 2:\n-                    labels[u][(v,w)] = 1\n+            for v, w in labels[u]:\n+                if labels[u][v, w] == 1:\n+                    labels[u][v, w] = 2\n+                elif labels[u][v, w] == 2:\n+                    labels[u][v, w] = 1\n```",
    "created_at": "2019-08-04T13:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393731",
    "user": "https://github.com/dcoudert"
}
```

I have only a minor comment. Otherwise seems ok.

```diff
-            for (v,w) in labels[u]:
-                if labels[u][(v,w)] == 1:
-                    labels[u][(v,w)] = 2
-                elif labels[u][(v,w)] == 2:
-                    labels[u][(v,w)] = 1
+            for v, w in labels[u]:
+                if labels[u][v, w] == 1:
+                    labels[u][v, w] = 2
+                elif labels[u][v, w] == 2:
+                    labels[u][v, w] = 1
```



---

archive/issue_comments_393732.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-05T12:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393732",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393733.json:
```json
{
    "body": "OK, LGTM.",
    "created_at": "2019-08-05T16:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393733",
    "user": "https://github.com/dcoudert"
}
```

OK, LGTM.



---

archive/issue_comments_393734.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-05T16:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393734",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_069913.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-08T21:24:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27915#event-69913"
}
```



---

archive/issue_comments_393735.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-08T21:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27915",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27915#issuecomment-393735",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
