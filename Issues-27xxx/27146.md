# Issue 27146: Speed up initialization code for partitions

archive/issues_026909.json:
```json
{
    "assignees": [],
    "body": "I'm afraid I am in need of a faster way to create an integer partition.  It seems to me that there are two things to improve:\n\n* the (relatively expensive) check whether the argument to `_Partitions` is actually a partition is done twice: once in `Partition.__init__` and, before that, in `Partitions._element_constructor_`.\n\n* it appears that `x in NN` is expensive.\n\nI do not yet know how to proceed.  I think it would be best to have a `check` keyword argument to allow bypassing checks, but also to speed up the checks themselves.\n\nBranch/Commit: **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Martin Rubey**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27146_\n\n",
    "closed_at": "2019-03-04T23:16:27Z",
    "created_at": "2019-01-27T13:27:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up initialization code for partitions",
    "type": "issue",
    "updated_at": "2019-03-04T23:16:27Z",
    "url": "https://github.com/sagemath/sage/issues/27146",
    "user": "https://github.com/mantepse"
}
```
I'm afraid I am in need of a faster way to create an integer partition.  It seems to me that there are two things to improve:

* the (relatively expensive) check whether the argument to `_Partitions` is actually a partition is done twice: once in `Partition.__init__` and, before that, in `Partitions._element_constructor_`.

* it appears that `x in NN` is expensive.

I do not yet know how to proceed.  I think it would be best to have a `check` keyword argument to allow bypassing checks, but also to speed up the checks themselves.

Branch/Commit: **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**

Reviewer: **Travis Scrimshaw**

Author: **Martin Rubey**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/27146_





---

archive/issue_events_373030.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2019-01-27T13:27:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373030"
}
```



---

archive/issue_events_373031.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2019-01-27T13:27:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373031"
}
```



---

archive/issue_events_373032.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2019-01-27T13:27:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373032"
}
```



---

archive/issue_events_373033.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2019-01-27T13:27:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373033"
}
```



---

archive/issue_comments_418945.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nOne bug we might want to fix on the way:\n\n```\nsage: Partition([2,1.0])\n[2, 1.00000000000000]\n```",
    "created_at": "2019-01-27T13:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418945",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:1" align="right">comment:1</div>

One bug we might want to fix on the way:

```
sage: Partition([2,1.0])
[2, 1.00000000000000]
```



---

archive/issue_comments_418946.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAnother one:\n\n```\nsage: Partition([2,True])\n[2, True]\n```",
    "created_at": "2019-01-27T13:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418946",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:2" align="right">comment:2</div>

Another one:

```
sage: Partition([2,True])
[2, True]
```



---

archive/issue_comments_418947.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTwo things: If you really need that level of speed, you should bypass the `_element_constructor_` (as a general rule). Second, fixing those \"bugs\" (I am not sure I would call them that because of ducktyping) will slow things down more and/or be more restrictive on the input (since `True == 1.0 == 1`, which is `in NN`).\n\nHowever, I agree that we should make the check in one place (at least for DRY). However, for subsets of partitions, there are 2 different checks that do go on. So that needs to be considered carefully. My thought right now would be to remove the check in the `Partition.__init__` and assume it is valid by that point. Then we find out if there are any errors and go from there.",
    "created_at": "2019-01-27T15:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418947",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

Two things: If you really need that level of speed, you should bypass the `_element_constructor_` (as a general rule). Second, fixing those "bugs" (I am not sure I would call them that because of ducktyping) will slow things down more and/or be more restrictive on the input (since `True == 1.0 == 1`, which is `in NN`).

However, I agree that we should make the check in one place (at least for DRY). However, for subsets of partitions, there are 2 different checks that do go on. So that needs to be considered carefully. My thought right now would be to remove the check in the `Partition.__init__` and assume it is valid by that point. Then we find out if there are any errors and go from there.



---

archive/issue_comments_418948.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI think we should have\n\n```\nsage: Partition([2,1.0])\n[2, 1]\n```\nand\n\n```\nsage: Partition([2,True])\n[2, 1]\n```",
    "created_at": "2019-01-27T16:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418948",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">comment:4</div>

I think we should have

```
sage: Partition([2,1.0])
[2, 1]
```
and

```
sage: Partition([2,True])
[2, 1]
```



---

archive/issue_comments_418949.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIt probably is better, but I do not think they count as bugs outright. I was mainly pointing out that enforcing that will slow things down by going through `ZZ`.",
    "created_at": "2019-01-27T16:06:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418949",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

It probably is better, but I do not think they count as bugs outright. I was mainly pointing out that enforcing that will slow things down by going through `ZZ`.



---

archive/issue_comments_418950.json:
```json
{
    "body": "Branch: **[u/mantepse/speed_up_initialization_code_for_partitions](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_initialization_code_for_partitions)**",
    "created_at": "2019-01-27T22:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418950",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/speed_up_initialization_code_for_partitions](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_initialization_code_for_partitions)**



---

archive/issue_events_373034.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2019-01-27T22:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373034"
}
```



---

archive/issue_comments_418951.json:
```json
{
    "body": "Commit: **[9d363de](https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95)**",
    "created_at": "2019-01-27T22:16:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418951",
    "user": "https://github.com/mantepse"
}
```

Commit: **[9d363de](https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95)**



---

archive/issue_comments_418952.json:
```json
{
    "body": "Author: **Martin Rubey**",
    "created_at": "2019-01-27T22:16:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418952",
    "user": "https://github.com/mantepse"
}
```

Author: **Martin Rubey**



---

archive/issue_comments_418953.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95\">9d363de</a></td><td><code>speed up and simplify initialisation code</code></td></tr></table>\n",
    "created_at": "2019-01-27T22:16:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418953",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95">9d363de</a></td><td><code>speed up and simplify initialisation code</code></td></tr></table>




---

archive/issue_comments_418954.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI did not change the behaviour concerning conversion to `ZZ`, but I followed your suggestion to skip the check in `__init__`.  Here is a comparison:\n\n```\nsage: l = [list(Partitions(10).random_element()) for _ in range(10000)]\nsage: %timeit map(Partition, l)\n10 loops, best of 3: 95.9 ms per loop\nsage: l = [list(Partitions(10).random_element())+[0]*50 for _ in range(1000)]\nsage: %timeit map(Partition, l)\n10 loops, best of 3: 56.6 ms per loop\nsage: l = [list(Partitions(50).random_element()) for _ in range(1000)]\nsage: %timeit map(Partition, l)\n100 loops, best of 3: 17.4 ms per loop\nsage: l = [list(Partitions(50).random_element())+[0]*50 for _ in range(1000)]\nsage: %timeit map(Partition, l)\n10 loops, best of 3: 67.1 ms per loop\n```\n\n```\nsage: l = [list(Partitions(10).random_element()) for _ in range(10000)]\nsage: %timeit map(Partition, l)\n10 loops, best of 3: 75.1 ms per loop\nsage: l = [list(Partitions(10).random_element())+[0]*50 for _ in range(1000)]\nsage: %timeit map(Partition, l)\n100 loops, best of 3: 18.2 ms per loop\nsage: l = [list(Partitions(50).random_element()) for _ in range(1000)]\nsage: %timeit map(Partition, l)\n100 loops, best of 3: 9.76 ms per loop\nsage: l = [list(Partitions(50).random_element())+[0]*50 for _ in range(1000)]\nsage: %timeit map(Partition, l)\n10 loops, best of 3: 20.7 ms per loop\n```\n\nQuestion: to bypass the `_element_constructor_ `, is\n\n```\ndef _make_partition(l):\n    return _Partitions.element_class(_Partitions, l)\n```\ncorrect?",
    "created_at": "2019-01-27T22:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418954",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:8" align="right">comment:8</div>

I did not change the behaviour concerning conversion to `ZZ`, but I followed your suggestion to skip the check in `__init__`.  Here is a comparison:

```
sage: l = [list(Partitions(10).random_element()) for _ in range(10000)]
sage: %timeit map(Partition, l)
10 loops, best of 3: 95.9 ms per loop
sage: l = [list(Partitions(10).random_element())+[0]*50 for _ in range(1000)]
sage: %timeit map(Partition, l)
10 loops, best of 3: 56.6 ms per loop
sage: l = [list(Partitions(50).random_element()) for _ in range(1000)]
sage: %timeit map(Partition, l)
100 loops, best of 3: 17.4 ms per loop
sage: l = [list(Partitions(50).random_element())+[0]*50 for _ in range(1000)]
sage: %timeit map(Partition, l)
10 loops, best of 3: 67.1 ms per loop
```

```
sage: l = [list(Partitions(10).random_element()) for _ in range(10000)]
sage: %timeit map(Partition, l)
10 loops, best of 3: 75.1 ms per loop
sage: l = [list(Partitions(10).random_element())+[0]*50 for _ in range(1000)]
sage: %timeit map(Partition, l)
100 loops, best of 3: 18.2 ms per loop
sage: l = [list(Partitions(50).random_element()) for _ in range(1000)]
sage: %timeit map(Partition, l)
100 loops, best of 3: 9.76 ms per loop
sage: l = [list(Partitions(50).random_element())+[0]*50 for _ in range(1000)]
sage: %timeit map(Partition, l)
10 loops, best of 3: 20.7 ms per loop
```

Question: to bypass the `_element_constructor_ `, is

```
def _make_partition(l):
    return _Partitions.element_class(_Partitions, l)
```
correct?



---

archive/issue_comments_418955.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThere is a failing test, which is failing because `KBoundedQuotientBases.ParentMethods.__getitem__` contains\n\n```\nc = self._kbounded_partitions.element_class(self._kbounded_partitions, list(c))\n```\nwithout checking that `c` is actually a partition.\n\nI think that this is a bug, do you agree?",
    "created_at": "2019-01-28T11:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418955",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:9" align="right">comment:9</div>

There is a failing test, which is failing because `KBoundedQuotientBases.ParentMethods.__getitem__` contains

```
c = self._kbounded_partitions.element_class(self._kbounded_partitions, list(c))
```
without checking that `c` is actually a partition.

I think that this is a bug, do you agree?



---

archive/issue_comments_418956.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI am currently testing the whole library for more calls to `Partition.__init__` which rely on checks.",
    "created_at": "2019-01-28T11:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418956",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:10" align="right">comment:10</div>

I am currently testing the whole library for more calls to `Partition.__init__` which rely on checks.



---

archive/issue_comments_418957.json:
```json
{
    "body": "Changed commit from **[9d363de](https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95)** to **[6699343](https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc)**",
    "created_at": "2019-01-28T12:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418957",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9d363de](https://github.com/sagemath/sagetrac-mirror/commit/9d363de5dc95430b43bc7e0344e112f8340f4e95)** to **[6699343](https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc)**



---

archive/issue_comments_418958.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc\">6699343</a></td><td><code>fix non-checking code in __getitem__</code></td></tr></table>\n",
    "created_at": "2019-01-28T12:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418958",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc">6699343</a></td><td><code>fix non-checking code in __getitem__</code></td></tr></table>




---

archive/issue_comments_418959.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf\">42ee585</a></td><td><code>further simplification</code></td></tr></table>\n",
    "created_at": "2019-01-28T13:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418959",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf">42ee585</a></td><td><code>further simplification</code></td></tr></table>




---

archive/issue_comments_418960.json:
```json
{
    "body": "Changed commit from **[6699343](https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc)** to **[42ee585](https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf)**",
    "created_at": "2019-01-28T13:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418960",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6699343](https://github.com/sagemath/sagetrac-mirror/commit/6699343107b0be33bffa7e6f64c11976d1399edc)** to **[42ee585](https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf)**



---

archive/issue_comments_418961.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWhat I did was to raise an `Exception` in `Partition.__init__` whenever `mu` would not be a weakly decreasing list of nonnegative integers.  It was only triggered by the code in `k_dual.py`.  Since this code should not be performance critical (for performance, one would use `monomial`, not `__getitem__`), I think it is correct to create the element with checking.",
    "created_at": "2019-01-28T13:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418961",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:13" align="right">comment:13</div>

What I did was to raise an `Exception` in `Partition.__init__` whenever `mu` would not be a weakly decreasing list of nonnegative integers.  It was only triggered by the code in `k_dual.py`.  Since this code should not be performance critical (for performance, one would use `monomial`, not `__getitem__`), I think it is correct to create the element with checking.



---

archive/issue_comments_418962.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nQuestion: I think that `__getitem__` only takes one argument.  Thus, I think it should actually be as simple as this:\n\n```\n        def __getitem__(self, c):\n            if isinstance(c, (int, Integer)):\n                c = self._kbounded_partitions([c])\n            else:\n                c = self._kbounded_partitions(list(c))\n            return self.monomial(c)\n\n```\nDo you agree?",
    "created_at": "2019-01-28T14:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418962",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:14" align="right">comment:14</div>

Question: I think that `__getitem__` only takes one argument.  Thus, I think it should actually be as simple as this:

```
        def __getitem__(self, c):
            if isinstance(c, (int, Integer)):
                c = self._kbounded_partitions([c])
            else:
                c = self._kbounded_partitions(list(c))
            return self.monomial(c)

```
Do you agree?



---

archive/issue_comments_418963.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYour timings in [comment:8](#comment:8) do not (necessarily) represent a fair comparison because you have generated random elements (length matters a lot here). You have to use the same elements.\n\nThe answer is yes to the question in [comment:8](#comment:8).\n\ncomment:9 is not a bug because the current code does check it. There is (currently) no hard semantic rule for where the checks should be done.\n\nI agree with [comment:14](#comment:14) except I would not wrap `c` in a `list` for the second case (e.g., why redo the computation if `c` is an element of `self._kbounded_partitions`).\n\nFor this change:\n\n```diff\n-            return len(x) == 0 or (x[-1] in NN and\n-                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))\n+            z = Integer(0)\n+            try:\n+                return (all(e == Integer(e) >= z for e in x) and\n+                        all(e >= x[i+1] for i, e in enumerate(x[:-1])))\n+            except TypeError:\n+                return False\n```\nI disagree with using `try`-`except` for the length `0` test. IMO, it is confusing as it does not make it clear what it is testing for and it can hide bugs by catching more than it should. Also `e == Integer(e)`, a priori, is redundant with the coercion framework (although it is now more general because it allows conversions). You are also iterating over the list twice, which I believe is generally slower because of possible short-circuiting.\nPerformance critical code should really use `self.element_class` to avoid as much indirection as possible.\n\nI think in general we should assume that there is no `0` in the partition, so `mu.index(0)` will be a much slower check than `mu[-1] == 0`. In particular, the former has the run over the entire list and deal with the exception.",
    "created_at": "2019-01-28T21:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418963",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Your timings in [comment:8](#comment:8) do not (necessarily) represent a fair comparison because you have generated random elements (length matters a lot here). You have to use the same elements.

The answer is yes to the question in [comment:8](#comment:8).

comment:9 is not a bug because the current code does check it. There is (currently) no hard semantic rule for where the checks should be done.

I agree with [comment:14](#comment:14) except I would not wrap `c` in a `list` for the second case (e.g., why redo the computation if `c` is an element of `self._kbounded_partitions`).

For this change:

```diff
-            return len(x) == 0 or (x[-1] in NN and
-                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))
+            z = Integer(0)
+            try:
+                return (all(e == Integer(e) >= z for e in x) and
+                        all(e >= x[i+1] for i, e in enumerate(x[:-1])))
+            except TypeError:
+                return False
```
I disagree with using `try`-`except` for the length `0` test. IMO, it is confusing as it does not make it clear what it is testing for and it can hide bugs by catching more than it should. Also `e == Integer(e)`, a priori, is redundant with the coercion framework (although it is now more general because it allows conversions). You are also iterating over the list twice, which I believe is generally slower because of possible short-circuiting.
Performance critical code should really use `self.element_class` to avoid as much indirection as possible.

I think in general we should assume that there is no `0` in the partition, so `mu.index(0)` will be a much slower check than `mu[-1] == 0`. In particular, the former has the run over the entire list and deal with the exception.



---

archive/issue_comments_418964.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMany thanks for your comments!  Indeed, using the same list changes the timings a little bit, but not very much.\n\nHowever, the following is a fair bit faster - it's the fastest of several combinations I tried - it's a bit unfortunate that it is cheaper to test `if x` than `if not x`.  I'm not sure whether it's better to test the last element for non-negativity first, or weakly decreasing first.  Is this correct and OK for you?\n\n```\n    def __contains__(self, x):\n        if isinstance(x, Partition):\n            return True\n        if isinstance(x, (list, tuple)):\n            if x:\n                try:\n                    return (all(Integer(a) >= b for a, b in zip(x, x[1:]))\n                            and Integer(x[-1]) >= 0)\n                except TypeError:\n                    return False\n            return True\n```\nTiny question: shouldn't `__contains__` return `False` in case, or is `None` indeed sufficient?  I find returning `None` a bit unclear, but that's just me.",
    "created_at": "2019-01-28T23:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418964",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:16" align="right">comment:16</div>

Many thanks for your comments!  Indeed, using the same list changes the timings a little bit, but not very much.

However, the following is a fair bit faster - it's the fastest of several combinations I tried - it's a bit unfortunate that it is cheaper to test `if x` than `if not x`.  I'm not sure whether it's better to test the last element for non-negativity first, or weakly decreasing first.  Is this correct and OK for you?

```
    def __contains__(self, x):
        if isinstance(x, Partition):
            return True
        if isinstance(x, (list, tuple)):
            if x:
                try:
                    return (all(Integer(a) >= b for a, b in zip(x, x[1:]))
                            and Integer(x[-1]) >= 0)
                except TypeError:
                    return False
            return True
```
Tiny question: shouldn't `__contains__` return `False` in case, or is `None` indeed sufficient?  I find returning `None` a bit unclear, but that's just me.



---

archive/issue_comments_418965.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mantepse](#comment:16):\n> Many thanks for your comments!  Indeed, using the same list changes the timings a little bit, but not very much.\n\nIt still should be done (also for memory usage).\n\n> However, the following is a fair bit faster - it's the fastest of several combinations I tried - it's a bit unfortunate that it is cheaper to test `if x` than `if not x`.  I'm not sure whether it's better to test the last element for non-negativity first, or weakly decreasing first.  Is this correct and OK for you?\n\nIt is faster to test `a in ZZ` than `Integer(a)` when the input is an `Integer`:\n\n```\nsage: %timeit 5 in ZZ\n10000000 loops, best of 3: 87.4 ns per loop\nsage: %timeit Integer(5)\n10000000 loops, best of 3: 121 ns per loop\n```\nbut that is not the case for non-`Integer` objects:\n\n```\nsage: %timeit 5.0 in ZZ\n100000 loops, best of 3: 2.41 \u00b5s per loop\nsage: %timeit Integer(5.0)\n1000000 loops, best of 3: 1.36 \u00b5s per loop\nsage: %timeit 5/1 in ZZ\n1000000 loops, best of 3: 705 ns per loop\nsage: %timeit Integer(5/1)\n1000000 loops, best of 3: 479 ns per loop\n```\nMoreover, false results are much faster than handling the `TypeError`:\n\n```\nsage: def test1(x):\n....:     return x in ZZ\n....: def test2(x):\n....:     try:\n....:         return Integer(x)\n....:     except TypeError:\n....:         return False\n....:     \nsage: %timeit test1(1/2)\n1000000 loops, best of 3: 1.22 \u00b5s per loop\nsage: %timeit test2(1/2)\n1000000 loops, best of 3: 1.56 \u00b5s per loop\n```\nIn addition, the same statements about the `try`-`except` block still hold here. So I would not want to use that code. Also, be wary of a tautology: you create a partition, check to see if it is in the parent, which then is true because it is a partition.\n\n> Tiny question: shouldn't `__contains__` return `False` in case, or is `None` indeed sufficient?  I find returning `None` a bit unclear, but that's just me.\n\nIt should return `False`.",
    "created_at": "2019-01-29T01:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418965",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mantepse](#comment:16):
> Many thanks for your comments!  Indeed, using the same list changes the timings a little bit, but not very much.

It still should be done (also for memory usage).

> However, the following is a fair bit faster - it's the fastest of several combinations I tried - it's a bit unfortunate that it is cheaper to test `if x` than `if not x`.  I'm not sure whether it's better to test the last element for non-negativity first, or weakly decreasing first.  Is this correct and OK for you?

It is faster to test `a in ZZ` than `Integer(a)` when the input is an `Integer`:

```
sage: %timeit 5 in ZZ
10000000 loops, best of 3: 87.4 ns per loop
sage: %timeit Integer(5)
10000000 loops, best of 3: 121 ns per loop
```
but that is not the case for non-`Integer` objects:

```
sage: %timeit 5.0 in ZZ
100000 loops, best of 3: 2.41 µs per loop
sage: %timeit Integer(5.0)
1000000 loops, best of 3: 1.36 µs per loop
sage: %timeit 5/1 in ZZ
1000000 loops, best of 3: 705 ns per loop
sage: %timeit Integer(5/1)
1000000 loops, best of 3: 479 ns per loop
```
Moreover, false results are much faster than handling the `TypeError`:

```
sage: def test1(x):
....:     return x in ZZ
....: def test2(x):
....:     try:
....:         return Integer(x)
....:     except TypeError:
....:         return False
....:     
sage: %timeit test1(1/2)
1000000 loops, best of 3: 1.22 µs per loop
sage: %timeit test2(1/2)
1000000 loops, best of 3: 1.56 µs per loop
```
In addition, the same statements about the `try`-`except` block still hold here. So I would not want to use that code. Also, be wary of a tautology: you create a partition, check to see if it is in the parent, which then is true because it is a partition.

> Tiny question: shouldn't `__contains__` return `False` in case, or is `None` indeed sufficient?  I find returning `None` a bit unclear, but that's just me.

It should return `False`.



---

archive/issue_comments_418966.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHi Travis!\n\nI just tried\n\n```\n            return not x or (all(a in ZZ and a >= b for a, b in zip(x, x[1:]))\n                             and x[-1] in ZZ and x[-1] >= 0)\n```\nbut that is significantly slower (by a factor of 1.6, that is) when `x` is a weakly decreasing list of `int`s.\n\nOn the other hand, if `x` is a weakly decreasing list of `Integer`s, it is not (significantly) faster (only by a factor of 0.96).\n\nI will check my timings later today, but maybe it's obvious to you why the new version is not better.  I do think that weakly decreasing lists of integer-like objects (mostly `int` and `Integer`) is the most important input, do you agree?\n\nAside: in case it is better and I made a mistake, `NonNegativeIntegers.__contains__` is not ideal:\n\n```\n    def __contains__(self, elt):\n        try:\n            i = Integer(elt)\n            return  i >= Integer(0) and i == elt\n        except TypeError:\n            return False\n\n```",
    "created_at": "2019-01-29T08:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418966",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:18" align="right">comment:18</div>

Hi Travis!

I just tried

```
            return not x or (all(a in ZZ and a >= b for a, b in zip(x, x[1:]))
                             and x[-1] in ZZ and x[-1] >= 0)
```
but that is significantly slower (by a factor of 1.6, that is) when `x` is a weakly decreasing list of `int`s.

On the other hand, if `x` is a weakly decreasing list of `Integer`s, it is not (significantly) faster (only by a factor of 0.96).

I will check my timings later today, but maybe it's obvious to you why the new version is not better.  I do think that weakly decreasing lists of integer-like objects (mostly `int` and `Integer`) is the most important input, do you agree?

Aside: in case it is better and I made a mistake, `NonNegativeIntegers.__contains__` is not ideal:

```
    def __contains__(self, elt):
        try:
            i = Integer(elt)
            return  i >= Integer(0) and i == elt
        except TypeError:
            return False

```



---

archive/issue_comments_418967.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd\">5f7d09d</a></td><td><code>faster __contains__</code></td></tr></table>\n",
    "created_at": "2019-01-29T08:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418967",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd">5f7d09d</a></td><td><code>faster __contains__</code></td></tr></table>




---

archive/issue_comments_418968.json:
```json
{
    "body": "Changed commit from **[42ee585](https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf)** to **[5f7d09d](https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd)**",
    "created_at": "2019-01-29T08:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418968",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[42ee585](https://github.com/sagemath/sagetrac-mirror/commit/42ee585d4a7c66a297a080c1333559fff84b4ecf)** to **[5f7d09d](https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd)**



---

archive/issue_comments_418969.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAs promised, a check of my timings.  Code:\n\n```\nimport six\nfrom six.moves import zip\nfrom sage.rings.integer import Integer\nfrom sage.rings.all import ZZ\n\ndef test1(x):\n    if x:\n        try:\n            return (all(Integer(a) >= b for a, b in zip(x, x[1:]))\n                    and Integer(x[-1]) >= 0)\n        except TypeError:\n            return False\n    return True\n\ndef test2(x):\n    return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))\n                     and (x[-1] in ZZ) and (x[-1] >= 0))\n```\n\nTimings:\n\n```\nsage: l = [list(Partitions(10).random_element()) for _ in range(100000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 117 ms per loop\nsage: %timeit map(test2, l)\n1 loop, best of 3: 227 ms per loop\nsage: l = [list(Partitions(10).random_element())+[int(0)]*50 for _ in range(10000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 78.4 ms per loop\nsage: %timeit map(test2, l)\n1 loop, best of 3: 211 ms per loop\nsage: l = [map(Integer, Partitions(10).random_element()+[0]*50) for _ in range(10000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 77 ms per loop\nsage: %timeit map(test2, l)\n10 loops, best of 3: 63.3 ms per loop\nsage: l = [list(Partitions(50).random_element()) for _ in range(10000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 23.9 ms per loop\nsage: %timeit map(test2, l)\n10 loops, best of 3: 57.1 ms per loop\nsage: l = [list(Partitions(50).random_element())+[int(0)]*50 for _ in range(10000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 91.4 ms per loop\nsage: %timeit map(test2, l)\n1 loop, best of 3: 246 ms per loop\nsage: l = [map(Integer, Partitions(50).random_element()+[0]*50) for _ in range(10000)]\nsage: %timeit map(test1, l)\n10 loops, best of 3: 89.8 ms per loop\nsage: %timeit map(test2, l)\n10 loops, best of 3: 71.5 ms per loop\n```\n\nConclusion:\n\nFor weakly decreasing lists of integers, `test2` is slightly faster if the input is a list of `Integer`s.  However, `test1` is much faster if the input is a list of `int`s.",
    "created_at": "2019-01-29T13:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418969",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:20" align="right">comment:20</div>

As promised, a check of my timings.  Code:

```
import six
from six.moves import zip
from sage.rings.integer import Integer
from sage.rings.all import ZZ

def test1(x):
    if x:
        try:
            return (all(Integer(a) >= b for a, b in zip(x, x[1:]))
                    and Integer(x[-1]) >= 0)
        except TypeError:
            return False
    return True

def test2(x):
    return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))
                     and (x[-1] in ZZ) and (x[-1] >= 0))
```

Timings:

```
sage: l = [list(Partitions(10).random_element()) for _ in range(100000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 117 ms per loop
sage: %timeit map(test2, l)
1 loop, best of 3: 227 ms per loop
sage: l = [list(Partitions(10).random_element())+[int(0)]*50 for _ in range(10000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 78.4 ms per loop
sage: %timeit map(test2, l)
1 loop, best of 3: 211 ms per loop
sage: l = [map(Integer, Partitions(10).random_element()+[0]*50) for _ in range(10000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 77 ms per loop
sage: %timeit map(test2, l)
10 loops, best of 3: 63.3 ms per loop
sage: l = [list(Partitions(50).random_element()) for _ in range(10000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 23.9 ms per loop
sage: %timeit map(test2, l)
10 loops, best of 3: 57.1 ms per loop
sage: l = [list(Partitions(50).random_element())+[int(0)]*50 for _ in range(10000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 91.4 ms per loop
sage: %timeit map(test2, l)
1 loop, best of 3: 246 ms per loop
sage: l = [map(Integer, Partitions(50).random_element()+[0]*50) for _ in range(10000)]
sage: %timeit map(test1, l)
10 loops, best of 3: 89.8 ms per loop
sage: %timeit map(test2, l)
10 loops, best of 3: 71.5 ms per loop
```

Conclusion:

For weakly decreasing lists of integers, `test2` is slightly faster if the input is a list of `Integer`s.  However, `test1` is much faster if the input is a list of `int`s.



---

archive/issue_comments_418970.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@tscrim](#comment:5):\n> It probably is better, but I do not think they count as bugs outright. I was mainly pointing out that enforcing that will slow things down by going through `ZZ`.\n\nSee also #20147, where the bug is hard to detect visually.  With floats it's much easier to see:\n\n```\nsage: p = Partition([1.0])\nsage: p.to_exp()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-25-02f7e7463ddd> in <module>()\n----> 1 p.to_exp()\n\n/home/martin/sage-develop/local/lib/python2.7/site-packages/sage/combinat/partition.pyc in to_exp(self, k)\n   3608         if len(p) > 0:\n   3609             k = max(k, p[0])\n-> 3610         a = [ZZ.zero()] * k\n   3611         for i in p:\n   3612             a[i-1] += 1\n\nTypeError: can't multiply sequence by non-int of type 'sage.rings.real_mpfr.RealLiteral'\n```",
    "created_at": "2019-02-02T10:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418970",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@tscrim](#comment:5):
> It probably is better, but I do not think they count as bugs outright. I was mainly pointing out that enforcing that will slow things down by going through `ZZ`.

See also #20147, where the bug is hard to detect visually.  With floats it's much easier to see:

```
sage: p = Partition([1.0])
sage: p.to_exp()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-25-02f7e7463ddd> in <module>()
----> 1 p.to_exp()

/home/martin/sage-develop/local/lib/python2.7/site-packages/sage/combinat/partition.pyc in to_exp(self, k)
   3608         if len(p) > 0:
   3609             k = max(k, p[0])
-> 3610         a = [ZZ.zero()] * k
   3611         for i in p:
   3612             a[i-1] += 1

TypeError: can't multiply sequence by non-int of type 'sage.rings.real_mpfr.RealLiteral'
```



---

archive/issue_comments_418971.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis is still not really a bug IMO: garbage-in, garbage-out. However, +1 to cast the input to `ZZ`. It just is likely to incur a (likely very minor) speed penalty.\n\nAnyways, for the testing I think we should assume `ZZ` inputs, and since that is faster (and more natural to read in the code, including less likely to hide an unrelated error), we should go with that. If you are passing `int`'s in, then you should either be casting them to `ZZ` yourself, skipping the containment check, or doing your own optimized checks.",
    "created_at": "2019-02-06T22:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418971",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

This is still not really a bug IMO: garbage-in, garbage-out. However, +1 to cast the input to `ZZ`. It just is likely to incur a (likely very minor) speed penalty.

Anyways, for the testing I think we should assume `ZZ` inputs, and since that is faster (and more natural to read in the code, including less likely to hide an unrelated error), we should go with that. If you are passing `int`'s in, then you should either be casting them to `ZZ` yourself, skipping the containment check, or doing your own optimized checks.



---

archive/issue_comments_418972.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI think I incorporated all your suggestions.\n\nI noticed one alternative:\n\n    Maybe trailing zeros should be removed in `Partitions._element_constructor_` rather than in `Partition.__init__`?\n\nAdvantages of the former:\n\n* all data manipulation happens in one place\n* we avoid copying the partition another time\n\nAdvantages of the latter:\n\n* safer code\n\nThe way I have now implemented the removal of trailing zeros seems to be quite efficient if there are hardly any, which I would expect to be the most common case.",
    "created_at": "2019-02-07T22:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418972",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">comment:23</div>

I think I incorporated all your suggestions.

I noticed one alternative:

    Maybe trailing zeros should be removed in `Partitions._element_constructor_` rather than in `Partition.__init__`?

Advantages of the former:

* all data manipulation happens in one place
* we avoid copying the partition another time

Advantages of the latter:

* safer code

The way I have now implemented the removal of trailing zeros seems to be quite efficient if there are hardly any, which I would expect to be the most common case.



---

archive/issue_comments_418973.json:
```json
{
    "body": "Changed commit from **[5f7d09d](https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd)** to **[1b0dd95](https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22)**",
    "created_at": "2019-02-07T22:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418973",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5f7d09d](https://github.com/sagemath/sagetrac-mirror/commit/5f7d09de404ff48052b9cd07af4c781b765510dd)** to **[1b0dd95](https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22)**



---

archive/issue_comments_418974.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fea5fbb46874fe7b7cb8b3486e9fb0ad0f658a22\">fea5fbb</a></td><td><code>Merge branch 'u/mantepse/speed_up_initialization_code_for_partitions' of git://trac.sagemath.org/sage into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22\">1b0dd95</a></td><td><code>efficient Partition.__init__, make parts ZZs, simplify Partitions.__contains__, fix `__getitem__` in sage.combinat.sf</code></td></tr></table>\n",
    "created_at": "2019-02-07T22:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418974",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fea5fbb46874fe7b7cb8b3486e9fb0ad0f658a22">fea5fbb</a></td><td><code>Merge branch 'u/mantepse/speed_up_initialization_code_for_partitions' of git://trac.sagemath.org/sage into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22">1b0dd95</a></td><td><code>efficient Partition.__init__, make parts ZZs, simplify Partitions.__contains__, fix `__getitem__` in sage.combinat.sf</code></td></tr></table>




---

archive/issue_comments_418975.json:
```json
{
    "body": "Changed commit from **[1b0dd95](https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22)** to **[2a32a98](https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38)**",
    "created_at": "2019-02-08T07:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418975",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1b0dd95](https://github.com/sagemath/sagetrac-mirror/commit/1b0dd95196c3e756f59d2e40dde607d4d8be4b22)** to **[2a32a98](https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38)**



---

archive/issue_comments_418976.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38\">2a32a98</a></td><td><code>fix an error and adapt two doctests</code></td></tr></table>\n",
    "created_at": "2019-02-08T07:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418976",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38">2a32a98</a></td><td><code>fix an error and adapt two doctests</code></td></tr></table>




---

archive/issue_comments_418977.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nCan you do a rebase? I will finish the review afterwards.",
    "created_at": "2019-02-26T03:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418977",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

Can you do a rebase? I will finish the review afterwards.



---

archive/issue_comments_418978.json:
```json
{
    "body": "Changed commit from **[2a32a98](https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38)** to **[427c5a8](https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514)**",
    "created_at": "2019-02-26T06:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418978",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2a32a98](https://github.com/sagemath/sagetrac-mirror/commit/2a32a989f19662e83d21c0ac4365119512279e38)** to **[427c5a8](https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514)**



---

archive/issue_comments_418979.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514\">427c5a8</a></td><td><code>Merge branch 'u/mantepse/speed_up_initialization_code_for_partitions' of git://trac.sagemath.org/sage into HEAD</code></td></tr></table>\n",
    "created_at": "2019-02-26T06:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514">427c5a8</a></td><td><code>Merge branch 'u/mantepse/speed_up_initialization_code_for_partitions' of git://trac.sagemath.org/sage into HEAD</code></td></tr></table>




---

archive/issue_comments_418980.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThanks. This should be the last little bits.\n\nDid you check this on Python3? The `map` no longer returns a list for that, so I think there will be a problem with `mu[-1]`. You might need to wrap that with a `list` as well.\n\nI think a better error message for the `map(ZZ, lst)` would be something like\n\n```\nall parts must be nonnegative integers\n```\nto be a bit more specific about what is failing (since it is separated out).\n\nDid you try also timing it doing the check\n\n```python\npos = len(mu) - 1\nwhile pos >= 0 and not mu[pos]:\n    pos += 1\nCombinatorialElement.__init__(self, parent, mu[:pos])\n```\nI am just wondering about all of those little temporary lists being created.\n\nFor the `__getitem__`, I think we should allow \"fake\" integers (e.g., `2/1 in QQ`) by checking `if c in ZZ`. Although I don't think we were entirely sure this was doing the correct things before:\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: s[2/1]\ns[2]\nsage: _.leading_support()[0]\n2\nsage: _.parent()\nRational Field\nsage: list(2/1)\n[2]\n```\nI believe your current approach will fix this, but we should add a test.",
    "created_at": "2019-02-27T05:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418980",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

Thanks. This should be the last little bits.

Did you check this on Python3? The `map` no longer returns a list for that, so I think there will be a problem with `mu[-1]`. You might need to wrap that with a `list` as well.

I think a better error message for the `map(ZZ, lst)` would be something like

```
all parts must be nonnegative integers
```
to be a bit more specific about what is failing (since it is separated out).

Did you try also timing it doing the check

```python
pos = len(mu) - 1
while pos >= 0 and not mu[pos]:
    pos += 1
CombinatorialElement.__init__(self, parent, mu[:pos])
```
I am just wondering about all of those little temporary lists being created.

For the `__getitem__`, I think we should allow "fake" integers (e.g., `2/1 in QQ`) by checking `if c in ZZ`. Although I don't think we were entirely sure this was doing the correct things before:

```
sage: s = SymmetricFunctions(QQ).s()
sage: s[2/1]
s[2]
sage: _.leading_support()[0]
2
sage: _.parent()
Rational Field
sage: list(2/1)
[2]
```
I believe your current approach will fix this, but we should add a test.



---

archive/issue_comments_418981.json:
```json
{
    "body": "Changed commit from **[427c5a8](https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514)** to **[9d41f42](https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14)**",
    "created_at": "2019-02-27T06:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418981",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[427c5a8](https://github.com/sagemath/sagetrac-mirror/commit/427c5a8ae93743ed8e4ac39cc22463c23fc80514)** to **[9d41f42](https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14)**



---

archive/issue_comments_418982.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14\">9d41f42</a></td><td><code>fix python3 blunder</code></td></tr></table>\n",
    "created_at": "2019-02-27T06:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418982",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14">9d41f42</a></td><td><code>fix python3 blunder</code></td></tr></table>




---

archive/issue_comments_418983.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@tscrim](#comment:28):\n\n> Did you check this on Python3? The `map` no longer returns a list for that, so I think there will be a problem with `mu[-1]`. You might need to wrap that with a `list` as well.\n\nfixed! Thank you! (slightly embarassed :-)\n\n> I think a better error message for the `map(ZZ, lst)` would be something like\n> \n> ```\n> all parts must be nonnegative integers\n> ```\n> to be a bit more specific about what is failing (since it is separated out).\n\nHm, what we are actually testing at\n\n```\n        try:\n            lst = list(map(ZZ, lst))\n        except TypeError:\n            raise ValueError('%s is not an element of %s'%(repr(lst), self))\n```\nis of course that we have an iterable of integers.  Nonnegativity is only checked in the individual `__contains__`.\n\nIs there any good reason that `list(map(ZZ, l))` is three times faster than `list(map(NN, l))`?  If not so, is there any good reason to have the entries of partitions in `ZZ` rather than `NN`?",
    "created_at": "2019-02-28T20:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418983",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@tscrim](#comment:28):

> Did you check this on Python3? The `map` no longer returns a list for that, so I think there will be a problem with `mu[-1]`. You might need to wrap that with a `list` as well.

fixed! Thank you! (slightly embarassed :-)

> I think a better error message for the `map(ZZ, lst)` would be something like
> 
> ```
> all parts must be nonnegative integers
> ```
> to be a bit more specific about what is failing (since it is separated out).

Hm, what we are actually testing at

```
        try:
            lst = list(map(ZZ, lst))
        except TypeError:
            raise ValueError('%s is not an element of %s'%(repr(lst), self))
```
is of course that we have an iterable of integers.  Nonnegativity is only checked in the individual `__contains__`.

Is there any good reason that `list(map(ZZ, l))` is three times faster than `list(map(NN, l))`?  If not so, is there any good reason to have the entries of partitions in `ZZ` rather than `NN`?



---

archive/issue_comments_418984.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nSecond question:\n\nReplying to [@tscrim](#comment:28):\n\n> For the `__getitem__`, I think we should allow \"fake\" integers (e.g., `2/1 in QQ`) by checking `if c in ZZ`. Although I don't think we were entirely sure this was doing the correct things before:\n> \n> ```\n> sage: s = SymmetricFunctions(QQ).s()\n> sage: s[2/1]\n> s[2]\n> sage: _.leading_support()[0]\n> 2\n> sage: _.parent()\n> Rational Field\n> sage: list(2/1)\n> [2]\n> ```\n> I believe your current approach will fix this, but we should add a test.\n\nYes it does.  Do you want a test in each of the `__getitem_ ` methods or only in `sfa.py` for `SymmetricFunctionAlgebra_generic`?",
    "created_at": "2019-02-28T20:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418984",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:31" align="right">comment:31</div>

Second question:

Replying to [@tscrim](#comment:28):

> For the `__getitem__`, I think we should allow "fake" integers (e.g., `2/1 in QQ`) by checking `if c in ZZ`. Although I don't think we were entirely sure this was doing the correct things before:
> 
> ```
> sage: s = SymmetricFunctions(QQ).s()
> sage: s[2/1]
> s[2]
> sage: _.leading_support()[0]
> 2
> sage: _.parent()
> Rational Field
> sage: list(2/1)
> [2]
> ```
> I believe your current approach will fix this, but we should add a test.

Yes it does.  Do you want a test in each of the `__getitem_ ` methods or only in `sfa.py` for `SymmetricFunctionAlgebra_generic`?



---

archive/issue_comments_418985.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@mantepse](#comment:30):\n> Replying to [@tscrim](#comment:28):\n> > I think a better error message for the `map(ZZ, lst)` would be something like\n> > \n> > ```\n> > all parts must be nonnegative integers\n> > ```\n> > to be a bit more specific about what is failing (since it is separated out).\n\n> \n> Hm, what we are actually testing at\n> \n> ```\n>         try:\n>             lst = list(map(ZZ, lst))\n>         except TypeError:\n>             raise ValueError('%s is not an element of %s'%(repr(lst), self))\n> ```\n> is of course that we have an iterable of integers.  Nonnegativity is only checked in the individual `__contains__`.\n\nIf it makes you feel better, you can say \"must be integers\", but that is misleading to the user who sees the error. IMO, it is fine for a weaker test to assert a stronger statement.\n\n> Is there any good reason that `list(map(ZZ, l))` is three times faster than `list(map(NN, l))`?  If not so, is there any good reason to have the entries of partitions in `ZZ` rather than `NN`?\n\nCython and a lot of optimization. So until `NN` gets a similar sort of push (which I highly doubt), I would stick with `ZZ`.",
    "created_at": "2019-03-01T02:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418985",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@mantepse](#comment:30):
> Replying to [@tscrim](#comment:28):
> > I think a better error message for the `map(ZZ, lst)` would be something like
> > 
> > ```
> > all parts must be nonnegative integers
> > ```
> > to be a bit more specific about what is failing (since it is separated out).

> 
> Hm, what we are actually testing at
> 
> ```
>         try:
>             lst = list(map(ZZ, lst))
>         except TypeError:
>             raise ValueError('%s is not an element of %s'%(repr(lst), self))
> ```
> is of course that we have an iterable of integers.  Nonnegativity is only checked in the individual `__contains__`.

If it makes you feel better, you can say "must be integers", but that is misleading to the user who sees the error. IMO, it is fine for a weaker test to assert a stronger statement.

> Is there any good reason that `list(map(ZZ, l))` is three times faster than `list(map(NN, l))`?  If not so, is there any good reason to have the entries of partitions in `ZZ` rather than `NN`?

Cython and a lot of optimization. So until `NN` gets a similar sort of push (which I highly doubt), I would stick with `ZZ`.



---

archive/issue_comments_418986.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@mantepse](#comment:31):\n> Yes it does.  Do you want a test in each of the `__getitem_ ` methods or only in `sfa.py` for `SymmetricFunctionAlgebra_generic`?\n\nJust in `sfa.py` is fine. It is the generic case and mostly a slight warning for people in the future.",
    "created_at": "2019-03-01T02:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418986",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@mantepse](#comment:31):
> Yes it does.  Do you want a test in each of the `__getitem_ ` methods or only in `sfa.py` for `SymmetricFunctionAlgebra_generic`?

Just in `sfa.py` is fine. It is the generic case and mostly a slight warning for people in the future.



---

archive/issue_comments_418987.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI don't understand part of your change\n\n```\n-            return len(x) == 0 or (x[-1] in NN and\n-                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))\n+            return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))\n+                             and (x[-1] in ZZ) and (x[-1] >= 0))\n```\nCalling `x[1:]` creates a copy of the list and would better be avoided. Use `x[i]` and `x[i+1]` as in the former version.",
    "created_at": "2019-03-01T06:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418987",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

I don't understand part of your change

```
-            return len(x) == 0 or (x[-1] in NN and
-                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))
+            return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))
+                             and (x[-1] in ZZ) and (x[-1] >= 0))
```
Calling `x[1:]` creates a copy of the list and would better be avoided. Use `x[i]` and `x[i+1]` as in the former version.



---

archive/issue_comments_418988.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSimilarly\n\n```\n+            while mu and not mu[-1]:\n+                mu = mu[:-1]\n+            CombinatorialElement.__init__(self, parent, mu)\n```\nYou are creating as many lists as there are trailing zeros. Either you first compute where to cut, or you can replace `mu = mu[:-1]` with `del mu[:-1]`.",
    "created_at": "2019-03-01T06:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418988",
    "user": "https://github.com/videlec"
}
```

<div id="comment:35" align="right">comment:35</div>

Similarly

```
+            while mu and not mu[-1]:
+                mu = mu[:-1]
+            CombinatorialElement.__init__(self, parent, mu)
```
You are creating as many lists as there are trailing zeros. Either you first compute where to cut, or you can replace `mu = mu[:-1]` with `del mu[:-1]`.



---

archive/issue_comments_418989.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@videlec](#comment:34):\n> I don't understand part of your change\n> \n> ```\n> -            return len(x) == 0 or (x[-1] in NN and\n> -                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))\n> +            return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))\n> +                             and (x[-1] in ZZ) and (x[-1] >= 0))\n> ```\n> Calling `x[1:]` creates a copy of the list and would better be avoided. Use `x[i]` and `x[i+1]` as in the former version.\n\nYes, I know, but unless I made a mistake (quite possible) testing showed that the new version is faster.  I will check again.",
    "created_at": "2019-03-01T07:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418989",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@videlec](#comment:34):
> I don't understand part of your change
> 
> ```
> -            return len(x) == 0 or (x[-1] in NN and
> -                                   all(x[i] in NN and x[i] >= x[i+1] for i in range(len(x)-1)))
> +            return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))
> +                             and (x[-1] in ZZ) and (x[-1] >= 0))
> ```
> Calling `x[1:]` creates a copy of the list and would better be avoided. Use `x[i]` and `x[i+1]` as in the former version.

Yes, I know, but unless I made a mistake (quite possible) testing showed that the new version is faster.  I will check again.



---

archive/issue_comments_418990.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@videlec](#comment:35):\n> Similarly\n> \n> ```\n> +            while mu and not mu[-1]:\n> +                mu = mu[:-1]\n> +            CombinatorialElement.__init__(self, parent, mu)\n> ```\n> You are creating as many lists as there are trailing zeros. Either you first compute where to cut, or you can replace `mu = mu[:-1]` with `del mu[:-1]`.\n\nOr even better:\n\n```\n    while mu and not mu[-1]:\n        mu.pop()\n```",
    "created_at": "2019-03-01T08:36:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418990",
    "user": "https://github.com/videlec"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@videlec](#comment:35):
> Similarly
> 
> ```
> +            while mu and not mu[-1]:
> +                mu = mu[:-1]
> +            CombinatorialElement.__init__(self, parent, mu)
> ```
> You are creating as many lists as there are trailing zeros. Either you first compute where to cut, or you can replace `mu = mu[:-1]` with `del mu[:-1]`.

Or even better:

```
    while mu and not mu[-1]:
        mu.pop()
```



---

archive/issue_comments_418991.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@videlec](#comment:37):\n\n> Or even better:\n> \n> ```\n>     while mu and not mu[-1]:\n>         mu.pop()\n> ```\n\nThat's what I once had, but I think I am not allowed to modify `mu` at this point.",
    "created_at": "2019-03-01T09:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418991",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@videlec](#comment:37):

> Or even better:
> 
> ```
>     while mu and not mu[-1]:
>         mu.pop()
> ```

That's what I once had, but I think I am not allowed to modify `mu` at this point.



---

archive/issue_comments_418992.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@mantepse](#comment:38):\n> Replying to [@videlec](#comment:37):\n> \n> > Or even better:\n> > \n> > ```\n> >     while mu and not mu[-1]:\n> >         mu.pop()\n> > ```\n\n> \n> That's what I once had, but I think I am not allowed to modify `mu` at this point.\n\nIf that is true (why?) then take a copy before change anything\n\n```\nif mu and not mu[-1]:\n    mu = mu[:-1]\n    while mu and not mu[-1]:\n        mu.pop()\n```",
    "created_at": "2019-03-01T09:43:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418992",
    "user": "https://github.com/videlec"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@mantepse](#comment:38):
> Replying to [@videlec](#comment:37):
> 
> > Or even better:
> > 
> > ```
> >     while mu and not mu[-1]:
> >         mu.pop()
> > ```

> 
> That's what I once had, but I think I am not allowed to modify `mu` at this point.

If that is true (why?) then take a copy before change anything

```
if mu and not mu[-1]:
    mu = mu[:-1]
    while mu and not mu[-1]:
        mu.pop()
```



---

archive/issue_comments_418993.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\n> If that is true (why?) then take a copy before change anything\n> \n> ```\n> if mu and not mu[-1]:\n>     mu = mu[:-1]\n>     while mu and not mu[-1]:\n>         mu.pop()\n> ```\n\nThat's a nice idea!  I won't be able to finish this before the weekend, I certainly want to redo the timings.",
    "created_at": "2019-03-01T09:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418993",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:40" align="right">comment:40</div>

> If that is true (why?) then take a copy before change anything
> 
> ```
> if mu and not mu[-1]:
>     mu = mu[:-1]
>     while mu and not mu[-1]:
>         mu.pop()
> ```

That's a nice idea!  I won't be able to finish this before the weekend, I certainly want to redo the timings.



---

archive/issue_comments_418994.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@mantepse](#comment:36):\n> Replying to [@videlec](#comment:34):\n> > I don't understand part of your change\n> > ...\n\nI now checked\n\n```\ndef test_contains1(x):\n    return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))\n                     and (x[-1] in ZZ) and (x[-1] >= 0))\n\n\ndef test_contains2(x):\n    return not x or (all((x[i] in ZZ) and (x[i] >= x[i+1]) for i in range(len(x)-1))\n                     and (x[-1] in ZZ) and (x[-1] >= 0))\n```\nand the second version is slightly slower (roughly by a factor 1.17), even for very long lists `x` (having more than 1000 elements).  I suspect that copying is faster than adding.",
    "created_at": "2019-03-01T18:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418994",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@mantepse](#comment:36):
> Replying to [@videlec](#comment:34):
> > I don't understand part of your change
> > ...

I now checked

```
def test_contains1(x):
    return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))
                     and (x[-1] in ZZ) and (x[-1] >= 0))


def test_contains2(x):
    return not x or (all((x[i] in ZZ) and (x[i] >= x[i+1]) for i in range(len(x)-1))
                     and (x[-1] in ZZ) and (x[-1] >= 0))
```
and the second version is slightly slower (roughly by a factor 1.17), even for very long lists `x` (having more than 1000 elements).  I suspect that copying is faster than adding.



---

archive/issue_comments_418995.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nYet another question, sorry about that:\n\nI just noticed that `map(ZZ, 4/2)` returns `[2]`, whereas `map(ZZ, 2)` and `map(ZZ, 4.0)` raise errors.  This implies that, with this ticket applied, `Partition(4/2)` returns `[2] ` whereas `Partition(2)` and `Partition(4.0)` raise an error.\n\nDo we want that?  Otherwise, I assume that we want to make `Partition(4/2)` raise an error too, but I don't know how to do that.  It seems bad to have a special case for `QQ`.",
    "created_at": "2019-03-01T19:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418995",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:42" align="right">comment:42</div>

Yet another question, sorry about that:

I just noticed that `map(ZZ, 4/2)` returns `[2]`, whereas `map(ZZ, 2)` and `map(ZZ, 4.0)` raise errors.  This implies that, with this ticket applied, `Partition(4/2)` returns `[2] ` whereas `Partition(2)` and `Partition(4.0)` raise an error.

Do we want that?  Otherwise, I assume that we want to make `Partition(4/2)` raise an error too, but I don't know how to do that.  It seems bad to have a special case for `QQ`.



---

archive/issue_comments_418996.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nIt's not our job to protect against every possible bad input. Garbage in, garbage out.",
    "created_at": "2019-03-01T20:41:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418996",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

It's not our job to protect against every possible bad input. Garbage in, garbage out.



---

archive/issue_comments_418997.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.",
    "created_at": "2019-03-01T22:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418997",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:44" align="right">comment:44</div>

I also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.



---

archive/issue_comments_418998.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@tscrim](#comment:43):\n> It's not our job to protect against every possible bad input. Garbage in, garbage out.\n\nOK, I agree.  But then I think I should do\n\n```\n        C = self.basis().keys()\n        if not isinstance(c, C.element_class):\n            try:\n                c = Integer(c)\n            except TypeError:\n                c = C(c)\n            else:\n                c = C([c])\n        return self.monomial(c)\n```\nin all the `__getitem__` methods.  (Because otherwise `s[2/1]` succeeds by sheer luck (because elements of `QQ` are iterable), but `s[QQbar(2)]` or `s[2.0]` don't.  Do you agree?",
    "created_at": "2019-03-01T22:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418998",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@tscrim](#comment:43):
> It's not our job to protect against every possible bad input. Garbage in, garbage out.

OK, I agree.  But then I think I should do

```
        C = self.basis().keys()
        if not isinstance(c, C.element_class):
            try:
                c = Integer(c)
            except TypeError:
                c = C(c)
            else:
                c = C([c])
        return self.monomial(c)
```
in all the `__getitem__` methods.  (Because otherwise `s[2/1]` succeeds by sheer luck (because elements of `QQ` are iterable), but `s[QQbar(2)]` or `s[2.0]` don't.  Do you agree?



---

archive/issue_comments_418999.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThat is why I said you should check `x in ZZ` in [comment:28](#comment:28).",
    "created_at": "2019-03-01T23:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-418999",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

That is why I said you should check `x in ZZ` in [comment:28](#comment:28).



---

archive/issue_comments_419000.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@mantepse](#comment:41):\n> Replying to [@mantepse](#comment:36):\n> > Replying to [@videlec](#comment:34):\n> > > I don't understand part of your change\n> > > ...\n\n> \n> I now checked\n> \n> ```\n> def test_contains1(x):\n>     return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))\n>                      and (x[-1] in ZZ) and (x[-1] >= 0))\n> \n> \n> def test_contains2(x):\n>     return not x or (all((x[i] in ZZ) and (x[i] >= x[i+1]) for i in range(len(x)-1))\n>                      and (x[-1] in ZZ) and (x[-1] >= 0))\n> ```\n> and the second version is slightly slower (roughly by a factor 1.17), even for very long lists `x` (having more than 1000 elements).  I suspect that copying is faster than adding.\n\nAlso: this is **one** copy against **1000** additions.",
    "created_at": "2019-03-02T08:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419000",
    "user": "https://github.com/videlec"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@mantepse](#comment:41):
> Replying to [@mantepse](#comment:36):
> > Replying to [@videlec](#comment:34):
> > > I don't understand part of your change
> > > ...

> 
> I now checked
> 
> ```
> def test_contains1(x):
>     return not x or (all((a in ZZ) and (a >= b) for a, b in zip(x, x[1:]))
>                      and (x[-1] in ZZ) and (x[-1] >= 0))
> 
> 
> def test_contains2(x):
>     return not x or (all((x[i] in ZZ) and (x[i] >= x[i+1]) for i in range(len(x)-1))
>                      and (x[-1] in ZZ) and (x[-1] >= 0))
> ```
> and the second version is slightly slower (roughly by a factor 1.17), even for very long lists `x` (having more than 1000 elements).  I suspect that copying is faster than adding.

Also: this is **one** copy against **1000** additions.



---

archive/issue_comments_419001.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@tscrim](#comment:44):\n> I also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.\n\nThis is completely wrong. The getitem calls `static PyObject * list_subscript(PyListObject* self, PyObject* item)` which does the copy. Though it is fast since everything happen at C level (there is no copy of the actual objects in the list, just their pointers). In other words, copying a list of 1000 integers should be the exact same speed as copying a list of 1000 complicated graphs.",
    "created_at": "2019-03-02T08:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419001",
    "user": "https://github.com/videlec"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@tscrim](#comment:44):
> I also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.

This is completely wrong. The getitem calls `static PyObject * list_subscript(PyListObject* self, PyObject* item)` which does the copy. Though it is fast since everything happen at C level (there is no copy of the actual objects in the list, just their pointers). In other words, copying a list of 1000 integers should be the exact same speed as copying a list of 1000 complicated graphs.



---

archive/issue_comments_419002.json:
```json
{
    "body": "Changed commit from **[9d41f42](https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14)** to **[1d24606](https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770)**",
    "created_at": "2019-03-02T08:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9d41f42](https://github.com/sagemath/sagetrac-mirror/commit/9d41f423c8e6063fdcd2ffdc56e360e29542ba14)** to **[1d24606](https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770)**



---

archive/issue_comments_419003.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770\">1d24606</a></td><td><code>fix getitem, improve error message, improve removal of trailing zeros</code></td></tr></table>\n",
    "created_at": "2019-03-02T08:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419003",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770">1d24606</a></td><td><code>fix getitem, improve error message, improve removal of trailing zeros</code></td></tr></table>




---

archive/issue_comments_419004.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6\">1940f8d</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2019-03-02T09:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419004",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6">1940f8d</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_419005.json:
```json
{
    "body": "Changed commit from **[1d24606](https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770)** to **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**",
    "created_at": "2019-03-02T09:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1d24606](https://github.com/sagemath/sagetrac-mirror/commit/1d24606b28b36412fec50c69938c6ab29ee39770)** to **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**



---

archive/issue_comments_419006.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@videlec](#comment:48):\n> Replying to [@tscrim](#comment:44):\n> > I also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.\n\n> \n> This is completely wrong. The getitem calls `static PyObject * list_subscript(PyListObject* self, PyObject* item)` which does the copy. Though it is fast since everything happen at C level (there is no copy of the actual objects in the list, just their pointers). In other words, copying a list of 1000 integers should be the exact same speed as copying a list of 1000 complicated graphs.\n\nThanks for clarifying - then the timings are even more surprising!",
    "created_at": "2019-03-02T09:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419006",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@videlec](#comment:48):
> Replying to [@tscrim](#comment:44):
> > I also suspect Python does some stuff lazily with list copying, so `x[1:]` doesn't actually do any copying until you modify the `x[1:]` list.

> 
> This is completely wrong. The getitem calls `static PyObject * list_subscript(PyListObject* self, PyObject* item)` which does the copy. Though it is fast since everything happen at C level (there is no copy of the actual objects in the list, just their pointers). In other words, copying a list of 1000 integers should be the exact same speed as copying a list of 1000 complicated graphs.

Thanks for clarifying - then the timings are even more surprising!



---

archive/issue_comments_419007.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nOff topic: doesn't it take longer to copy a long list than a short list?\n\nActually, copying seems to be roughly linear:\n\n```\nsage: for i in range(1,6):\n....:     l = [randint(1,100) for _ in range(10^i)]\n....:     %timeit l[1:]\n....:     \nThe slowest run took 12.66 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 791 ns per loop\nThe slowest run took 9.37 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.37 \u00b5s per loop\n100000 loops, best of 3: 7.21 \u00b5s per loop\n10000 loops, best of 3: 70.1 \u00b5s per loop\n1000 loops, best of 3: 838 \u00b5s per loop\n```",
    "created_at": "2019-03-02T09:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419007",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:52" align="right">comment:52</div>

Off topic: doesn't it take longer to copy a long list than a short list?

Actually, copying seems to be roughly linear:

```
sage: for i in range(1,6):
....:     l = [randint(1,100) for _ in range(10^i)]
....:     %timeit l[1:]
....:     
The slowest run took 12.66 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 791 ns per loop
The slowest run took 9.37 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.37 µs per loop
100000 loops, best of 3: 7.21 µs per loop
10000 loops, best of 3: 70.1 µs per loop
1000 loops, best of 3: 838 µs per loop
```



---

archive/issue_comments_419008.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@mantepse](#comment:52):\n> Off topic: doesn't it take longer to copy a long list than a short list?\n> \n> Actually, copying seems to be roughly linear:\n> \n> ```\n> sage: for i in range(1,6):\n> ....:     l = [randint(1,100) for _ in range(10^i)]\n> ....:     %timeit l[1:]\n> ....:     \n> The slowest run took 12.66 times longer than the fastest. This could mean that an intermediate result is being cached.\n> 1000000 loops, best of 3: 791 ns per loop\n> The slowest run took 9.37 times longer than the fastest. This could mean that an intermediate result is being cached.\n> 1000000 loops, best of 3: 1.37 \u00b5s per loop\n> 100000 loops, best of 3: 7.21 \u00b5s per loop\n> 10000 loops, best of 3: 70.1 \u00b5s per loop\n> 1000 loops, best of 3: 838 \u00b5s per loop\n> ```\n\nlinear is what is expected.",
    "created_at": "2019-03-02T16:26:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419008",
    "user": "https://github.com/videlec"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@mantepse](#comment:52):
> Off topic: doesn't it take longer to copy a long list than a short list?
> 
> Actually, copying seems to be roughly linear:
> 
> ```
> sage: for i in range(1,6):
> ....:     l = [randint(1,100) for _ in range(10^i)]
> ....:     %timeit l[1:]
> ....:     
> The slowest run took 12.66 times longer than the fastest. This could mean that an intermediate result is being cached.
> 1000000 loops, best of 3: 791 ns per loop
> The slowest run took 9.37 times longer than the fastest. This could mean that an intermediate result is being cached.
> 1000000 loops, best of 3: 1.37 µs per loop
> 100000 loops, best of 3: 7.21 µs per loop
> 10000 loops, best of 3: 70.1 µs per loop
> 1000 loops, best of 3: 838 µs per loop
> ```

linear is what is expected.



---

archive/issue_comments_419009.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-03-03T21:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419009",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_373035.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-03T21:54:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373035"
}
```



---

archive/issue_events_373036.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-03T21:54:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373036"
}
```



---

archive/issue_comments_419010.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nOkay, this is good enough for me. Thanks Martin for your work on this. Thanks Vincent for the explanations.",
    "created_at": "2019-03-03T21:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419010",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:54" align="right">comment:54</div>

Okay, this is good enough for me. Thanks Martin for your work on this. Thanks Vincent for the explanations.



---

archive/issue_comments_419011.json:
```json
{
    "body": "Changed branch from **[u/mantepse/speed_up_initialization_code_for_partitions](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_initialization_code_for_partitions)** to **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**",
    "created_at": "2019-03-04T23:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27146#issuecomment-419011",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mantepse/speed_up_initialization_code_for_partitions](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_initialization_code_for_partitions)** to **[1940f8d](https://github.com/sagemath/sagetrac-mirror/commit/1940f8d7d7d47a8f02acada9034eeef40e25c5e6)**



---

archive/issue_events_373037.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-04T23:16:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373037"
}
```



---

archive/issue_events_373038.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c8b8488a190208884c9be0cce45fc7cf715ff8e1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-04T23:16:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27146#event-373038"
}
```
