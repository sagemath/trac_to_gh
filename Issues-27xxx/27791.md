# Issue 27791: Py3: Minor enhancements in rings.polynomial.multi_polynomial.pyx

archive/issues_027554.json:
```json
{
    "body": "- Replace a doctest with #random with a doctest returning the same result in py2 and py3.\n- Remove unused imports.\n\n**Branch/Commit:** [c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)\n\n**Reviewer:** John Palmieri\n\n**Author:** Vincent Klein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27791\n\n",
    "closed_at": "2019-05-24T18:29:41Z",
    "created_at": "2019-05-07T08:43:50Z",
    "labels": [
        "component: python3",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Py3: Minor enhancements in rings.polynomial.multi_polynomial.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27791",
    "user": "https://github.com/vinklein"
}
```
- Replace a doctest with #random with a doctest returning the same result in py2 and py3.
- Remove unused imports.

**Branch/Commit:** [c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)

**Reviewer:** John Palmieri

**Author:** Vincent Klein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/27791





---

archive/issue_comments_538634.json:
```json
{
    "body": "**Branch:** [u/vklein/27791](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27791)",
    "created_at": "2019-05-07T12:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538634",
    "user": "https://github.com/vinklein"
}
```

**Branch:** [u/vklein/27791](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27791)



---

archive/issue_comments_538635.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906\">2e3024d</a></td><td><code>Trac #27791: Fix multi_polynomial.pyx doctests ...</code></td></tr></table>\n",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538635",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906">2e3024d</a></td><td><code>Trac #27791: Fix multi_polynomial.pyx doctests ...</code></td></tr></table>




---

archive/issue_comments_538636.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-\n+- Fix multi_polynomial.pyx doctests for python3.\n+- Remove unused import\n``````\n",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538636",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-
+- Fix multi_polynomial.pyx doctests for python3.
+- Remove unused import
``````




---

archive/issue_comments_538637.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538637",
    "user": "https://github.com/vinklein"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_538638.json:
```json
{
    "body": "**Commit:** [2e3024db27147dfad22bcc86cb666b41be033906](https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906)",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538638",
    "user": "https://github.com/vinklein"
}
```

**Commit:** [2e3024db27147dfad22bcc86cb666b41be033906](https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906)



---

archive/issue_comments_538639.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it. In particular, once you sort, the previous comment \"Currently, we use a fairly unoptimized method that evaluates one monomial at a time, with no sharing of repeated computations and with useless additions of 0 and multiplications by 1\" is hard to make sense of.",
    "created_at": "2019-05-07T22:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538639",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it. In particular, once you sort, the previous comment "Currently, we use a fairly unoptimized method that evaluates one monomial at a time, with no sharing of repeated computations and with useless additions of 0 and multiplications by 1" is hard to make sense of.



---

archive/issue_comments_538640.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jhpalmieri](#comment%3A3):\n> I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.\n\n\nDoes that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?\n\nIf this is the case what do you think is the best fix ? `#py2` `#py3` tags.",
    "created_at": "2019-05-09T07:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538640",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
Replying to [jhpalmieri](#comment%3A3):
> I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.


Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?

If this is the case what do you think is the best fix ? `#py2` `#py3` tags.



---

archive/issue_comments_538641.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [vklein](#comment%3A4):\n> Replying to [jhpalmieri](#comment%3A3):\n> > I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.\n\n> \n> Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?\n\n\nThis all guesswork on my part, but I think so. The list is just giving the summands in two different orders. \n\n```\n'push 0.0', 'push 12.0', 'load 1', 'load 2', 'dup', 'mul', 'mul', 'mul', 'add',\n```\nsays to store 0, then store 12, take a factor of y (\"load 1\"), take a factor of z (\"load 2\"), duplicate it to get two factors of z, multiply (so you have `z^2`), multiply again (so you have `y z^2`), multiply again (to incorporate the factor of 12), then add to the 0 from the start.\n\nWith Python 3, it starts with the summand `9z^4` instead. The ordering in Python 3 seems to match the order in which the polynomial is actually printed, for what that's worth.\n\n> If this is the case what do you think is the best fix ? `#py2` `#py3` tags.\n\n\nHow about a new doctest: instead of `list(ff)`, do something like this after the comment:\n\n```\nsage: g = (x*y**2*z)._fast_float_()\nsage: list(g)\n[ insert output here ]\n```\nSince there is only one summand, there should be no issues with orderings, and I think it still illustrates the same issue.",
    "created_at": "2019-05-09T15:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538641",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Replying to [vklein](#comment%3A4):
> Replying to [jhpalmieri](#comment%3A3):
> > I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.

> 
> Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?


This all guesswork on my part, but I think so. The list is just giving the summands in two different orders. 

```
'push 0.0', 'push 12.0', 'load 1', 'load 2', 'dup', 'mul', 'mul', 'mul', 'add',
```
says to store 0, then store 12, take a factor of y ("load 1"), take a factor of z ("load 2"), duplicate it to get two factors of z, multiply (so you have `z^2`), multiply again (so you have `y z^2`), multiply again (to incorporate the factor of 12), then add to the 0 from the start.

With Python 3, it starts with the summand `9z^4` instead. The ordering in Python 3 seems to match the order in which the polynomial is actually printed, for what that's worth.

> If this is the case what do you think is the best fix ? `#py2` `#py3` tags.


How about a new doctest: instead of `list(ff)`, do something like this after the comment:

```
sage: g = (x*y**2*z)._fast_float_()
sage: list(g)
[ insert output here ]
```
Since there is only one summand, there should be no issues with orderings, and I think it still illustrates the same issue.



---

archive/issue_comments_538642.json:
```json
{
    "body": "**Changing commit** from \"[2e3024db27147dfad22bcc86cb666b41be033906](https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906)\" to \"[9567cc99949d028dd410dba43afda8ffc0cac2cb](https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb)\".",
    "created_at": "2019-05-10T07:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2e3024db27147dfad22bcc86cb666b41be033906](https://github.com/sagemath/sagetrac-mirror/commit/2e3024db27147dfad22bcc86cb666b41be033906)" to "[9567cc99949d028dd410dba43afda8ffc0cac2cb](https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb)".



---

archive/issue_comments_538643.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb\">9567cc9</a></td><td><code>Trac #27791: Implement reviewer's comment.</code></td></tr></table>\n",
    "created_at": "2019-05-10T07:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538643",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb">9567cc9</a></td><td><code>Trac #27791: Implement reviewer's comment.</code></td></tr></table>




---

archive/issue_comments_538644.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt works ! Thanks for your help.",
    "created_at": "2019-05-10T07:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538644",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:7'></a>
It works ! Thanks for your help.



---

archive/issue_comments_538645.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2019-05-13T09:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538645",
    "user": "https://github.com/vinklein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_538646.json:
```json
{
    "body": "<a id='comment:8'></a>\nMerge failed with 8.8.beta5",
    "created_at": "2019-05-13T09:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538646",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:8'></a>
Merge failed with 8.8.beta5



---

archive/issue_comments_538647.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5\">c532b8d</a></td><td><code>Trac #27791: Fix multi_polynomial.pyx doctests ...</code></td></tr></table>\n",
    "created_at": "2019-05-13T12:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538647",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5">c532b8d</a></td><td><code>Trac #27791: Fix multi_polynomial.pyx doctests ...</code></td></tr></table>




---

archive/issue_comments_538648.json:
```json
{
    "body": "**Changing commit** from \"[9567cc99949d028dd410dba43afda8ffc0cac2cb](https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb)\" to \"[c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)\".",
    "created_at": "2019-05-13T12:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9567cc99949d028dd410dba43afda8ffc0cac2cb](https://github.com/sagemath/sagetrac-mirror/commit/9567cc99949d028dd410dba43afda8ffc0cac2cb)" to "[c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)".



---

archive/issue_comments_538649.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538649",
    "user": "https://github.com/vinklein"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_538650.json:
```json
{
    "body": "<a id='comment:10'></a>\nRebased with 8.8.beta5 which already fix the py3 doctests.",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538650",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:10'></a>
Rebased with 8.8.beta5 which already fix the py3 doctests.



---

archive/issue_events_078141.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "rename": {
        "from": "Py3: Fix doctests in rings.polynomial.multi_polynomial.pyx",
        "to": "Py3: Minor enhancements in rings.polynomial.multi_polynomial.pyx"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27791#event-78141"
}
```



---

archive/issue_comments_538651.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-- Fix multi_polynomial.pyx doctests for python3.\n-- Remove unused import\n+- Replace a doctest with #random with a doctest returning the same result in py2 and py3.\n+- Remove unused imports.\n``````\n",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538651",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-- Fix multi_polynomial.pyx doctests for python3.
-- Remove unused import
+- Replace a doctest with #random with a doctest returning the same result in py2 and py3.
+- Remove unused imports.
``````




---

archive/issue_comments_538652.json:
```json
{
    "body": "<a id='comment:11'></a>\nLooks good to me.",
    "created_at": "2019-05-13T18:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538652",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Looks good to me.



---

archive/issue_comments_538653.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2019-05-13T18:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538653",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_538654.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-05-13T18:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538654",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_538655.json:
```json
{
    "body": "**Changing branch** from \"[u/vklein/27791](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27791)\" to \"[c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)\".",
    "created_at": "2019-05-24T18:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538655",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vklein/27791](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27791)" to "[c532b8de9357aebf4640cdca1db5d553c153d9c5](https://github.com/sagemath/sagetrac-mirror/commit/c532b8de9357aebf4640cdca1db5d553c153d9c5)".



---

archive/issue_events_078142.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-24T18:29:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27791#event-78142"
}
```



---

archive/issue_comments_538656.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-05-24T18:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27791",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27791#issuecomment-538656",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
