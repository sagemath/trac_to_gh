# Issue 27258: spkg-configure.m4 for mpfr

archive/issues_027021.json:
```json
{
    "body": "recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.\n\nthe branch to be merged as a part of #27822\n\nCC:  @embray @kiwifb\n\nKeywords: spkg-configure mpfr\n\nReviewer: Erik Bray, Dima Pasechnik\n\nAuthor: Dima Pasechnik, Erik Bray\n\nBranch: 0329fd951a75cdf6f35c4681615b3aa914897bcf\n\nDependencies: #27641\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/27258\n\n",
    "closed_at": "2019-06-28T10:05:34Z",
    "created_at": "2019-02-12T09:55:35Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "spkg-configure.m4 for mpfr",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27258",
    "user": "https://github.com/dimpase"
}
```
recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.

the branch to be merged as a part of #27822

CC:  @embray @kiwifb

Keywords: spkg-configure mpfr

Reviewer: Erik Bray, Dima Pasechnik

Author: Dima Pasechnik, Erik Bray

Branch: 0329fd951a75cdf6f35c4681615b3aa914897bcf

Dependencies: #27641

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/27258





---

archive/issue_comments_404977.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure\".",
    "created_at": "2019-02-12T09:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404977",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "" to "spkg-configure".



---

archive/issue_comments_404978.json:
```json
{
    "body": "<a id='comment:2'></a>Two stupid questions (I don't think I'm good enough with autoconf to review this ticket, but I'd like to understand the mechanism):\n* Is there a particular reason for using `AC_SEARCH_LIBS` rather that `AC_CHECK_LIB` here?\n* What is the `break` instruction for? Will the generated code be part of a loop that tries several options or something like that? I couldn't locate the corresponding logic.",
    "created_at": "2019-02-12T14:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404978",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:2'></a>Two stupid questions (I don't think I'm good enough with autoconf to review this ticket, but I'd like to understand the mechanism):
* Is there a particular reason for using `AC_SEARCH_LIBS` rather that `AC_CHECK_LIB` here?
* What is the `break` instruction for? Will the generated code be part of a loop that tries several options or something like that? I couldn't locate the corresponding logic.



---

archive/issue_comments_404979.json:
```json
{
    "body": "<a id='comment:3'></a>from autoconf docs:\n\n```\nAC_CHECK_LIB requires some care in usage, and should be avoided in some common cases. Many standard functions like gethostbyname appear in the standard C library on some hosts, and in special libraries like nsl on other hosts. On some hosts the special libraries contain variant implementations that you may not want to use. These days it is normally better to use AC_SEARCH_LIBS([gethostbyname], [nsl]) instead of AC_CHECK_LIB([nsl], [gethostbyname]).\n```\nI guess Erik can comment better than me about the use of `break`.",
    "created_at": "2019-02-12T14:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404979",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>from autoconf docs:

```
AC_CHECK_LIB requires some care in usage, and should be avoided in some common cases. Many standard functions like gethostbyname appear in the standard C library on some hosts, and in special libraries like nsl on other hosts. On some hosts the special libraries contain variant implementations that you may not want to use. These days it is normally better to use AC_SEARCH_LIBS([gethostbyname], [nsl]) instead of AC_CHECK_LIB([nsl], [gethostbyname]).
```
I guess Erik can comment better than me about the use of `break`.



---

archive/issue_comments_404980.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 dimpase]:\n> from autoconf docs:\n> \n> ```\n> AC_CHECK_LIB requires some care in usage, and should be avoided in some common cases. Many standard functions like gethostbyname appear in the standard C library on some hosts, and in special libraries like nsl on other hosts. On some hosts the special libraries contain variant implementations that you may not want to use. These days it is normally better to use AC_SEARCH_LIBS([gethostbyname], [nsl]) instead of AC_CHECK_LIB([nsl], [gethostbyname]).\n> ```\n\n\nThanks. But I think this is purely about the case where the same function can be found in several different libraries.",
    "created_at": "2019-02-12T14:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404980",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>Replying to [comment:3 dimpase]:
> from autoconf docs:
> 
> ```
> AC_CHECK_LIB requires some care in usage, and should be avoided in some common cases. Many standard functions like gethostbyname appear in the standard C library on some hosts, and in special libraries like nsl on other hosts. On some hosts the special libraries contain variant implementations that you may not want to use. These days it is normally better to use AC_SEARCH_LIBS([gethostbyname], [nsl]) instead of AC_CHECK_LIB([nsl], [gethostbyname]).
> ```


Thanks. But I think this is purely about the case where the same function can be found in several different libraries.



---

archive/issue_comments_404981.json:
```json
{
    "body": "<a id='comment:5'></a>mpfrcx's spkg-install hardcodes the location of mpfr to SAGE_LOCAL. So this will need to be fixed.",
    "created_at": "2019-02-25T23:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404981",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>mpfrcx's spkg-install hardcodes the location of mpfr to SAGE_LOCAL. So this will need to be fixed.



---

archive/issue_comments_404982.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2019-02-26T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404982",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_404983.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,12 +1,4 @@\n-something like this:\n-\n-```\n-SAGE_SPKG_CONFIGURE([mpfr], [\n-    AC_CHECK_HEADER(mpfr.h, [], [sage_spkg_install_mpfr=yes])\n-dnl mpfr_free_pool appeared in r11922 (Dec 2017) on MPFR svn \n-    AC_SEARCH_LIBS([mpfr_free_pool], [mpfr], [break], [sage_spkg_install_mpfr=yes])\n-])\n-```\n+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.\n \n Author: Dima Pasechnik\n \n```\n",
    "created_at": "2019-02-26T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404983",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,12 +1,4 @@
-something like this:
-
-```
-SAGE_SPKG_CONFIGURE([mpfr], [
-    AC_CHECK_HEADER(mpfr.h, [], [sage_spkg_install_mpfr=yes])
-dnl mpfr_free_pool appeared in r11922 (Dec 2017) on MPFR svn 
-    AC_SEARCH_LIBS([mpfr_free_pool], [mpfr], [break], [sage_spkg_install_mpfr=yes])
-])
-```
+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.
 
 Author: Dima Pasechnik
 
```




---

archive/issue_comments_404984.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-26T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404984",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404985.json:
```json
{
    "body": "<a id='comment:7'></a>only the last commit is new, the rest are from #27212.",
    "created_at": "2019-02-26T13:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404985",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>only the last commit is new, the rest are from #27212.



---

archive/issue_comments_404986.json:
```json
{
    "body": "<a id='comment:8'></a>Are you sure in all these cases that it's safe to pass `--with-mpfr=\"$SAGE_MPFR_PREFIX\"` when `$SAGE_MPFR_PREFIX` is empty?\n\nI found that a number of packages do not have sensible defaults for `--with-gmp=` passed an empty value, which is why I had to define\n\n```sh\nif [ -n \"$SAGE_GMP_PREFIX\" ]; then\n    export SAGE_CONFIGURE_GMP=\"--with-gmp=$SAGE_GMP_PREFIX\"\nfi\n```\n\nAnd then pass various configure scripts `$SAGE_CONFIGURE_GMP` instead of `--with-gmp=$SAGE_GMP_PREFIX`.\n\nNot saying that's always necessary though; might depend on the package and how it handles an empty value for the flag :(",
    "created_at": "2019-02-26T13:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404986",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Are you sure in all these cases that it's safe to pass `--with-mpfr="$SAGE_MPFR_PREFIX"` when `$SAGE_MPFR_PREFIX` is empty?

I found that a number of packages do not have sensible defaults for `--with-gmp=` passed an empty value, which is why I had to define

```sh
if [ -n "$SAGE_GMP_PREFIX" ]; then
    export SAGE_CONFIGURE_GMP="--with-gmp=$SAGE_GMP_PREFIX"
fi
```

And then pass various configure scripts `$SAGE_CONFIGURE_GMP` instead of `--with-gmp=$SAGE_GMP_PREFIX`.

Not saying that's always necessary though; might depend on the package and how it handles an empty value for the flag :(



---

archive/issue_comments_404987.json:
```json
{
    "body": "<a id='comment:9'></a>On Ubuntu 16.04 I tried `./bootstrap && ./configure`.  On first attempt `mpfr.h` was not detected.  Ok, `apt-get install libmpfr-dev` and tried `./configure` again and it found the headers but failed to find `mpfr_free_pool`.  Apparently the system package (despite the package being named \"libmpfr4\") is version 3.1.4 of MPFR, so maybe it doesn't have `mpfr_free_pool`?\n\nWhy was `mpfr_free_pool` chosen?  Do we have a specific dependency on it?  Or is it possible in principle to use version 3.1.x?  If not then that's fine; if the system package is too old it's too old, so we don't use it.  I'm just curious.",
    "created_at": "2019-02-26T13:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404987",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>On Ubuntu 16.04 I tried `./bootstrap && ./configure`.  On first attempt `mpfr.h` was not detected.  Ok, `apt-get install libmpfr-dev` and tried `./configure` again and it found the headers but failed to find `mpfr_free_pool`.  Apparently the system package (despite the package being named "libmpfr4") is version 3.1.4 of MPFR, so maybe it doesn't have `mpfr_free_pool`?

Why was `mpfr_free_pool` chosen?  Do we have a specific dependency on it?  Or is it possible in principle to use version 3.1.x?  If not then that's fine; if the system package is too old it's too old, so we don't use it.  I'm just curious.



---

archive/issue_comments_404988.json:
```json
{
    "body": "<a id='comment:10'></a>In Ubuntu 18.04 (bionic) it now has \"libmpfr6\" which is v4.0.1 so I might try testing against that next.",
    "created_at": "2019-02-26T13:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404988",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>In Ubuntu 18.04 (bionic) it now has "libmpfr6" which is v4.0.1 so I might try testing against that next.



---

archive/issue_comments_404989.json:
```json
{
    "body": "<a id='comment:11'></a>Got all the way through building sagelib with MPFR 3.1.4, but then at runtime I get\n\n```\nImportError: /home/sage/sage/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so: undefined symbol: mpfr_rootn_ui\n```\n\nwhere `mpfr_rootn_ui` is a function introduced in 4.0.0, as is `mpfr_free_pool`.  ISTM that specific requirement could be worked around, but I'm happy to just say \"ok 4.0.0 is the minimum required MPFR\" for now.\n\nI'll make an Ubuntu 18.04 container and try it in there.",
    "created_at": "2019-02-26T14:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404989",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>Got all the way through building sagelib with MPFR 3.1.4, but then at runtime I get

```
ImportError: /home/sage/sage/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so: undefined symbol: mpfr_rootn_ui
```

where `mpfr_rootn_ui` is a function introduced in 4.0.0, as is `mpfr_free_pool`.  ISTM that specific requirement could be worked around, but I'm happy to just say "ok 4.0.0 is the minimum required MPFR" for now.

I'll make an Ubuntu 18.04 container and try it in there.



---

archive/issue_comments_404990.json:
```json
{
    "body": "<a id='comment:12'></a>Are you saying that the test for `mpfr_free_pool` actually succeeds on MPFR 3.1.4?\nOK, let's switch to testing for `mpfr_rootn_ui` then.",
    "created_at": "2019-02-26T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404990",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Are you saying that the test for `mpfr_free_pool` actually succeeds on MPFR 3.1.4?
OK, let's switch to testing for `mpfr_rootn_ui` then.



---

archive/issue_comments_404991.json:
```json
{
    "body": "<a id='comment:13'></a>Oops, no, I just changed it to `mpfr_init` for the sake of testing against 3.1.4.  mpfr_free_pool is fine (though mpfr_rootn_ui has the advantage of explicitly being used by sage).",
    "created_at": "2019-02-26T15:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404991",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Oops, no, I just changed it to `mpfr_init` for the sake of testing against 3.1.4.  mpfr_free_pool is fine (though mpfr_rootn_ui has the advantage of explicitly being used by sage).



---

archive/issue_comments_404992.json:
```json
{
    "body": "<a id='comment:14'></a>Completed a successful build from scratch and `make ptestlong` on Ubuntu 18.04 using the system mpfr.  So maybe this is OK as-is.",
    "created_at": "2019-02-26T16:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404992",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Completed a successful build from scratch and `make ptestlong` on Ubuntu 18.04 using the system mpfr.  So maybe this is OK as-is.



---

archive/issue_comments_404993.json:
```json
{
    "body": "<a id='comment:15'></a>I've also tested this on Gentoo, on Debian.",
    "created_at": "2019-02-26T17:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404993",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>I've also tested this on Gentoo, on Debian.



---

archive/issue_comments_404994.json:
```json
{
    "body": "<a id='comment:16'></a>Oops, this does break (optional) mpfrcx, one of 4 packages that depend on mpfr.\nSo indeed most likely it needs akin to `$SAGE_CONFIGURE_GMP`.",
    "created_at": "2019-02-26T17:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404994",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Oops, this does break (optional) mpfrcx, one of 4 packages that depend on mpfr.
So indeed most likely it needs akin to `$SAGE_CONFIGURE_GMP`.



---

archive/issue_comments_404995.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-26T17:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404995",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_404996.json:
```json
{
    "body": "<a id='comment:17'></a>and I forgot about the need to SAGE_MPRF_* things in sage-env-config.in. This means that the tests ran with these being empty - mostly OK for system libs, but should be deadly for the case where things should come from SAGE_LOCAL...",
    "created_at": "2019-02-26T17:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404996",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>and I forgot about the need to SAGE_MPRF_* things in sage-env-config.in. This means that the tests ran with these being empty - mostly OK for system libs, but should be deadly for the case where things should come from SAGE_LOCAL...



---

archive/issue_comments_404997.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-26T18:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404998.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-27T22:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404999.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-20T14:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-404999",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405000.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-20T14:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405000",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405001.json:
```json
{
    "body": "<a id='comment:21'></a>merged with the latest #27212 and Sage 8.7.rc0",
    "created_at": "2019-03-20T14:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405001",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>merged with the latest #27212 and Sage 8.7.rc0



---

archive/issue_events_067648.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67648"
}
```



---

archive/issue_comments_405002.json:
```json
{
    "body": "<a id='comment:22'></a>Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405002",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_405003.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-04-04T21:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405003",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405004.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-19T10:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405004",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405005.json:
```json
{
    "body": "Attachment [configure-318.tar.gz](tarball://root/attachments/some-uuid/ticket27258/configure-318.tar.gz) by @dimpase created at 2019-04-19 10:02:53\n\nupdated configure spkg",
    "created_at": "2019-04-19T10:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405005",
    "user": "https://github.com/dimpase"
}
```

Attachment [configure-318.tar.gz](tarball://root/attachments/some-uuid/ticket27258/configure-318.tar.gz) by @dimpase created at 2019-04-19 10:02:53

updated configure spkg



---

archive/issue_comments_405006.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.\n \n+configure tarball: https://trac.sagemath.org/raw-attachment/ticket/27258/configure-318.tar.gz\n \n Author: Dima Pasechnik\n \n```\n",
    "created_at": "2019-04-19T10:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405006",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.
 
+configure tarball: https://trac.sagemath.org/raw-attachment/ticket/27258/configure-318.tar.gz
 
 Author: Dima Pasechnik
 
```




---

archive/issue_comments_405007.json:
```json
{
    "body": "<a id='comment:27'></a>I don't understand why the addition of the `--with-mpfr` flag.  This should already be covered by #27567.",
    "created_at": "2019-05-03T15:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405007",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>I don't understand why the addition of the `--with-mpfr` flag.  This should already be covered by #27567.



---

archive/issue_comments_405008.json:
```json
{
    "body": "<a id='comment:28'></a>It seems like this would also be able to benefit from #27641.  In this case you would want to add the bits that set\n\n```\nAC_SUBST(SAGE_MPFR_INCLUDE, ...)\nAC_SUBST(SAGE_MPFR_PREFIX, ...)\n```\n\nin the \"POST\" argument, since it's something that should *always* be done (the values of those variables would of course still depend on checks performed earlier in the macro).\n\nThis would be similar then to the POST argument added for MPIR in #27641.\n\nThat's a strong part of what it's for: If we have some `AC_SUBST` variables that will be fed into another template file, such as `sage-env-config.in`, we want to ensure that those substitutions are *always* made by mpfr/spkg-configure.m4 regardless what else was determined w.r.t. MPFR.",
    "created_at": "2019-05-03T15:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405008",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>It seems like this would also be able to benefit from #27641.  In this case you would want to add the bits that set

```
AC_SUBST(SAGE_MPFR_INCLUDE, ...)
AC_SUBST(SAGE_MPFR_PREFIX, ...)
```

in the "POST" argument, since it's something that should *always* be done (the values of those variables would of course still depend on checks performed earlier in the macro).

This would be similar then to the POST argument added for MPIR in #27641.

That's a strong part of what it's for: If we have some `AC_SUBST` variables that will be fed into another template file, such as `sage-env-config.in`, we want to ensure that those substitutions are *always* made by mpfr/spkg-configure.m4 regardless what else was determined w.r.t. MPFR.



---

archive/issue_comments_405009.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-08T15:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405010.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 embray]:\n> It seems like this would also be able to benefit from #27641.  In this case you would want to add the bits that set\n> \n> \n> ```\n> AC_SUBST(SAGE_MPFR_INCLUDE, ...)\n> AC_SUBST(SAGE_MPFR_PREFIX, ...)\n> ```\n> \n> in the \"POST\" argument, since it's something that should *always* be done (the values of those variables would of course still depend on checks performed earlier in the macro).\n> \n> This would be similar then to the POST argument added for MPIR in #27641.\n> \n> That's a strong part of what it's for: If we have some `AC_SUBST` variables that will be fed into another template file, such as `sage-env-config.in`, we want to ensure that those substitutions are *always* made by mpfr/spkg-configure.m4 regardless what else was determined w.r.t. MPFR.\n\n\nI don't quite understand this. At present AC_SUBSTs are done if `$with_mpfr` is either `system` or `install`. Can it have any other values? If not, the code is already covered everything. If yes, then it's totally unclear how and where to get meaningful values to use in AC_SUBSTs.\n\nA nice syntactic sugar might be to be able to put the `system` case in one `[...]` block, and `[...]` in another (instead of writing an explicit `case` statement).",
    "created_at": "2019-05-08T15:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405010",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Replying to [comment:28 embray]:
> It seems like this would also be able to benefit from #27641.  In this case you would want to add the bits that set
> 
> 
> ```
> AC_SUBST(SAGE_MPFR_INCLUDE, ...)
> AC_SUBST(SAGE_MPFR_PREFIX, ...)
> ```
> 
> in the "POST" argument, since it's something that should *always* be done (the values of those variables would of course still depend on checks performed earlier in the macro).
> 
> This would be similar then to the POST argument added for MPIR in #27641.
> 
> That's a strong part of what it's for: If we have some `AC_SUBST` variables that will be fed into another template file, such as `sage-env-config.in`, we want to ensure that those substitutions are *always* made by mpfr/spkg-configure.m4 regardless what else was determined w.r.t. MPFR.


I don't quite understand this. At present AC_SUBSTs are done if `$with_mpfr` is either `system` or `install`. Can it have any other values? If not, the code is already covered everything. If yes, then it's totally unclear how and where to get meaningful values to use in AC_SUBSTs.

A nice syntactic sugar might be to be able to put the `system` case in one `[...]` block, and `[...]` in another (instead of writing an explicit `case` statement).



---

archive/issue_comments_405011.json:
```json
{
    "body": "<a id='comment:31'></a>Again, I would just compare with mpir.  In the argument 5 (\"POST\") it checks `$sage_spkg_install_mpir` (as well as `$sage_spkg_install_gmp`) and sets the values that go in sage-env-config accordingly.\n\nI'll take a try at it.",
    "created_at": "2019-05-09T15:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405011",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Again, I would just compare with mpir.  In the argument 5 ("POST") it checks `$sage_spkg_install_mpir` (as well as `$sage_spkg_install_gmp`) and sets the values that go in sage-env-config accordingly.

I'll take a try at it.



---

archive/issue_comments_405012.json:
```json
{
    "body": "<a id='comment:32'></a>Please remove the configure bump from this branch, while you're at it.",
    "created_at": "2019-05-09T15:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405012",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>Please remove the configure bump from this branch, while you're at it.



---

archive/issue_comments_405013.json:
```json
{
    "body": "<a id='comment:33'></a>This worked for me at least insofar as detecting my system mpfr properly.  Now let's see if it builds...\n\n---\nNew commits:",
    "created_at": "2019-05-09T15:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405013",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>This worked for me at least insofar as detecting my system mpfr properly.  Now let's see if it builds...

---
New commits:



---

archive/issue_comments_405014.json:
```json
{
    "body": "<a id='comment:34'></a>Fixed [this](https://git.sagemath.org/sage.git/commit?id=15ba794c6397871ff308fdd5eb213087fb45f36c) by the way.  I wonder if this was causing you any grief...",
    "created_at": "2019-05-09T15:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405014",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>Fixed [this](https://git.sagemath.org/sage.git/commit?id=15ba794c6397871ff308fdd5eb213087fb45f36c) by the way.  I wonder if this was causing you any grief...



---

archive/issue_comments_405015.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-09T15:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405016.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:34 embray]:\n> Fixed [this](https://git.sagemath.org/sage.git/commit?id=15ba794c6397871ff308fdd5eb213087fb45f36c) by the way.  I wonder if this was causing you any grief...\n\n\nI didn't see any fallout from it, and I recall fixing some copy/paste oopsies like this one in `sage-env-config.in`, perhaps it's a result of too many rebases that this one stayed :-)",
    "created_at": "2019-05-09T16:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405016",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>Replying to [comment:34 embray]:
> Fixed [this](https://git.sagemath.org/sage.git/commit?id=15ba794c6397871ff308fdd5eb213087fb45f36c) by the way.  I wonder if this was causing you any grief...


I didn't see any fallout from it, and I recall fixing some copy/paste oopsies like this one in `sage-env-config.in`, perhaps it's a result of too many rebases that this one stayed :-)



---

archive/issue_comments_405017.json:
```json
{
    "body": "<a id='comment:37'></a>Build (from scratch) succeeded with no problem with system gmp+mpfr on Ubuntu 18.04, at least.  I'll run the tests next just to be sure.",
    "created_at": "2019-05-09T16:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405017",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>Build (from scratch) succeeded with no problem with system gmp+mpfr on Ubuntu 18.04, at least.  I'll run the tests next just to be sure.



---

archive/issue_comments_405018.json:
```json
{
    "body": "<a id='comment:38'></a>it seems to conflict with #27642 (in your `m4/sage_spkg_configure.m4`)- can you rebase it? Otherwise, all good.",
    "created_at": "2019-05-09T21:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405018",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>it seems to conflict with #27642 (in your `m4/sage_spkg_configure.m4`)- can you rebase it? Otherwise, all good.



---

archive/issue_comments_405019.json:
```json
{
    "body": "<a id='comment:39'></a>namely, here you only add `$4` and `$5` to `SAGE_SPKG_CONFIGURE` macro, whereas on #27642 you not only add them, but also do\n\n```diff\n+\n+AS_VAR_SET([sage_spkg_name], SPKG_NAME)\n+\n+$4\n+\n+AS_IF([test -n \"`ls \"${SAGE_SPKG_INST}/${sage_spkg_name}\"-* 2>/dev/null`\"],\n+SPKG_INSTALL_VAR[=yes;] SPKG_USE_SYSTEM[=no], [\n m4_ifval(\n [$2],\n [AS_VAR_SET_IF(SPKG_INSTALL_VAR, [], SPKG_INSTALL_VAR[=no])],\n [AS_VAR_SET_IF(SPKG_INSTALL_VAR, [], SPKG_INSTALL_VAR[=yes])])\n+])\n+\n```\nI presume the latter should take the precedence. I'll rebase accordingly.",
    "created_at": "2019-05-10T10:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405019",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>namely, here you only add `$4` and `$5` to `SAGE_SPKG_CONFIGURE` macro, whereas on #27642 you not only add them, but also do

```diff
+
+AS_VAR_SET([sage_spkg_name], SPKG_NAME)
+
+$4
+
+AS_IF([test -n "`ls "${SAGE_SPKG_INST}/${sage_spkg_name}"-* 2>/dev/null`"],
+SPKG_INSTALL_VAR[=yes;] SPKG_USE_SYSTEM[=no], [
 m4_ifval(
 [$2],
 [AS_VAR_SET_IF(SPKG_INSTALL_VAR, [], SPKG_INSTALL_VAR[=no])],
 [AS_VAR_SET_IF(SPKG_INSTALL_VAR, [], SPKG_INSTALL_VAR[=yes])])
+])
+
```
I presume the latter should take the precedence. I'll rebase accordingly.



---

archive/issue_comments_405020.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-10T10:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405021.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-10T11:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405021",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_405022.json:
```json
{
    "body": "<a id='comment:42'></a>I don't know why you pushed that last commit.   I need to rebase #27642, and in turn rebase this on top of that.  Please don't add spurious new commits that duplicate changes from other tickets as it will only make a mess of things later (e.g. become superfluous empty commits).",
    "created_at": "2019-05-10T11:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405022",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>I don't know why you pushed that last commit.   I need to rebase #27642, and in turn rebase this on top of that.  Please don't add spurious new commits that duplicate changes from other tickets as it will only make a mess of things later (e.g. become superfluous empty commits).



---

archive/issue_comments_405023.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-10T11:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405024.json:
```json
{
    "body": "<a id='comment:44'></a>oops, sorry, I didn't realise that #27642 has an old base :-(",
    "created_at": "2019-05-10T11:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405024",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>oops, sorry, I didn't realise that #27642 has an old base :-(



---

archive/issue_comments_405025.json:
```json
{
    "body": "<a id='comment:45'></a>I deleted your last commit; it doesn't really belong on this branch, and it's not strictly related by any means.\n\nThat change is specifically related to #27642 and does not conflict with anything here.",
    "created_at": "2019-05-10T11:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405025",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>I deleted your last commit; it doesn't really belong on this branch, and it's not strictly related by any means.

That change is specifically related to #27642 and does not conflict with anything here.



---

archive/issue_comments_405026.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:32 dimpase]:\n> Please remove the configure bump from this branch, while you're at it.\n\n\nTo be clear, is this because we plan to consolidate this ticket with others?",
    "created_at": "2019-05-10T11:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405026",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>Replying to [comment:32 dimpase]:
> Please remove the configure bump from this branch, while you're at it.


To be clear, is this because we plan to consolidate this ticket with others?



---

archive/issue_comments_405027.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 embray]:\n> Replying to [comment:32 dimpase]:\n> > Please remove the configure bump from this branch, while you're at it.\n\n> \n> To be clear, is this because we plan to consolidate this ticket with others?\n\nyes, indeed, otherwise it's too hard to get into the release.\nIt's fine as long as it's just new `spkg-configure.m4` files, but if it's more then\nthe hell breaks loose.\n\nPerhaps `./bootstrap` should have a remote service to run autoconf ;-)",
    "created_at": "2019-05-10T11:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405027",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>Replying to [comment:46 embray]:
> Replying to [comment:32 dimpase]:
> > Please remove the configure bump from this branch, while you're at it.

> 
> To be clear, is this because we plan to consolidate this ticket with others?

yes, indeed, otherwise it's too hard to get into the release.
It's fine as long as it's just new `spkg-configure.m4` files, but if it's more then
the hell breaks loose.

Perhaps `./bootstrap` should have a remote service to run autoconf ;-)



---

archive/issue_comments_405028.json:
```json
{
    "body": "<a id='comment:48'></a>Ok, I'll tidy this up a bit more and then see if I can incorporate mpc as well.",
    "created_at": "2019-05-10T11:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405028",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'></a>Ok, I'll tidy this up a bit more and then see if I can incorporate mpc as well.



---

archive/issue_comments_405029.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-10T11:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405030.json:
```json
{
    "body": "<a id='comment:50'></a>Okay, I removed the confball update and squashed a bunch of intermediate commits away.  I think this is pretty clean now.  Now let's take a look at mpc...\n\nmpfr and mpc should probably be bundled together--do you think anything else should go with them? ntl maybe?",
    "created_at": "2019-05-10T11:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405030",
    "user": "https://github.com/embray"
}
```

<a id='comment:50'></a>Okay, I removed the confball update and squashed a bunch of intermediate commits away.  I think this is pretty clean now.  Now let's take a look at mpc...

mpfr and mpc should probably be bundled together--do you think anything else should go with them? ntl maybe?



---

archive/issue_comments_405031.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-10T11:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405031",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405032.json:
```json
{
    "body": "<a id='comment:51'></a>perhaps not only mpc, but also ntl, arb, and flint. They all call each other and modify \n`src/bin/sage-env-config.in`...",
    "created_at": "2019-05-10T11:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405032",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>perhaps not only mpc, but also ntl, arb, and flint. They all call each other and modify 
`src/bin/sage-env-config.in`...



---

archive/issue_comments_405033.json:
```json
{
    "body": "<a id='comment:52'></a>I didn't mean to undo your change of dependency without asking, but I don't understand, aren't you using the branch of #27642 here?",
    "created_at": "2019-05-10T11:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405033",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:52'></a>I didn't mean to undo your change of dependency without asking, but I don't understand, aren't you using the branch of #27642 here?



---

archive/issue_comments_405034.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-10T11:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405035.json:
```json
{
    "body": "<a id='comment:54'></a>No, I decided not to--they're not strictly related at all.\n\nI think #27642 will merge cleanly with these other tickets, and still needs more work anyways.",
    "created_at": "2019-05-10T11:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405035",
    "user": "https://github.com/embray"
}
```

<a id='comment:54'></a>No, I decided not to--they're not strictly related at all.

I think #27642 will merge cleanly with these other tickets, and still needs more work anyways.



---

archive/issue_comments_405036.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:53 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                       |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n> |[1948e33](https://git.sagemath.org/sage.git/commit/?id=1948e335c3b5c447c674c8ec27c49f6472556ecf)|`Add one missing SAGE_CONFIGURE_MPFR, for building gcc`|\n\n\nand once `mpc` is added to the picture, one would also need to fix `--with-mpc=\"$SAGE_LOCAL\"` - that's really why it's best to do them all together...",
    "created_at": "2019-05-10T11:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405036",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>Replying to [comment:53 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                       |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
> |[1948e33](https://git.sagemath.org/sage.git/commit/?id=1948e335c3b5c447c674c8ec27c49f6472556ecf)|`Add one missing SAGE_CONFIGURE_MPFR, for building gcc`|


and once `mpc` is added to the picture, one would also need to fix `--with-mpc="$SAGE_LOCAL"` - that's really why it's best to do them all together...



---

archive/issue_comments_405037.json:
```json
{
    "body": "<a id='comment:56'></a>Yeah, I'm adding that in the branch for mpc now.  I agree it makes sense to bundle them together.",
    "created_at": "2019-05-10T12:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405037",
    "user": "https://github.com/embray"
}
```

<a id='comment:56'></a>Yeah, I'm adding that in the branch for mpc now.  I agree it makes sense to bundle them together.



---

archive/issue_comments_405038.json:
```json
{
    "body": "<a id='comment:57'></a>(BTW I'm trying to organize all these spkg-configure tickets under the \"build: configure\" component)",
    "created_at": "2019-05-10T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405038",
    "user": "https://github.com/embray"
}
```

<a id='comment:57'></a>(BTW I'm trying to organize all these spkg-configure tickets under the "build: configure" component)



---

archive/issue_comments_405039.json:
```json
{
    "body": "Changing component from build to build: configure.",
    "created_at": "2019-05-10T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405039",
    "user": "https://github.com/embray"
}
```

Changing component from build to build: configure.



---

archive/issue_comments_405040.json:
```json
{
    "body": "Changing keywords from \"spkg-configure\" to \"spkg-configure mpfr\".",
    "created_at": "2019-05-10T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405040",
    "user": "https://github.com/embray"
}
```

Changing keywords from "spkg-configure" to "spkg-configure mpfr".



---

archive/issue_comments_405041.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-11T10:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405041",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405042.json:
```json
{
    "body": "<a id='comment:58'></a>all clear",
    "created_at": "2019-05-11T10:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405042",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:58'></a>all clear



---

archive/issue_comments_405043.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-05-11T14:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405043",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405044.json:
```json
{
    "body": "<a id='comment:59'></a>Merge conflict, please fix",
    "created_at": "2019-05-11T14:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405044",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:59'></a>Merge conflict, please fix



---

archive/issue_comments_405045.json:
```json
{
    "body": "<a id='comment:60'></a>Volker, we have `u/dimpase/build/mpfr-mpc-ntl`, which is the merged mpfr+mpc - the branch of #27259, also includes this one (#27258), and ntl from #27265.\nThey are modifying many common files, and should be merged together.\nHow do we go about it? We can add a configure bump to `u/dimpase/build/mpfr-mpc-ntl`,\nafter rebasing it appropriately, so that #27258, #27259, and #27265 are all\nmerged together in one go.\n\nWe can open a special ticket for it if you prefer, or deal with it here.",
    "created_at": "2019-05-11T22:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405045",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>Volker, we have `u/dimpase/build/mpfr-mpc-ntl`, which is the merged mpfr+mpc - the branch of #27259, also includes this one (#27258), and ntl from #27265.
They are modifying many common files, and should be merged together.
How do we go about it? We can add a configure bump to `u/dimpase/build/mpfr-mpc-ntl`,
after rebasing it appropriately, so that #27258, #27259, and #27265 are all
merged together in one go.

We can open a special ticket for it if you prefer, or deal with it here.



---

archive/issue_comments_405046.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-13T14:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405047.json:
```json
{
    "body": "<a id='comment:62'></a>Rebased.  Not sure why it had a merge conflict, as there were no conflicts found during rebasing.",
    "created_at": "2019-05-13T14:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405047",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'></a>Rebased.  Not sure why it had a merge conflict, as there were no conflicts found during rebasing.



---

archive/issue_comments_405048.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-05-13T14:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405048",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_405049.json:
```json
{
    "body": "<a id='comment:63'></a>This ticket should probably not be merged by itself.  Instead please merge #27822 which incorporates this one.",
    "created_at": "2019-05-13T15:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405049",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'></a>This ticket should probably not be merged by itself.  Instead please merge #27822 which incorporates this one.



---

archive/issue_events_067649.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-17T11:45:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67649"
}
```



---

archive/issue_comments_405050.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-17T11:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405050",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_405051.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2019-05-20T18:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405051",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_067650.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-20T18:26:16Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67650"
}
```



---

archive/issue_comments_405052.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2019-05-20T18:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405052",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_405053.json:
```json
{
    "body": "<a id='comment:66'></a>The comment:63 did say this should not be merged on its own, didn't?",
    "created_at": "2019-05-20T18:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405053",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:66'></a>The comment:63 did say this should not be merged on its own, didn't?



---

archive/issue_comments_405054.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-20T23:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405054",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_events_067651.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-20T23:32:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67651"
}
```



---

archive/issue_events_067652.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-20T23:32:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67652"
}
```



---

archive/issue_comments_405055.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.\n \n+the branch to be merged as a part of #27822\n \n Author: Dima Pasechnik\n \n```\n",
    "created_at": "2019-05-20T23:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405055",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+recognise system's mpfr version via `mpfr_free_pool` presence, generate `SAGE_MPFR_PREFIX` to be used with `--with-mpfr=` options.
 
+the branch to be merged as a part of #27822
 
 Author: Dima Pasechnik
 
```




---

archive/issue_comments_405056.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-20T23:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405056",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405057.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-06-28T10:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27258#issuecomment-405057",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate



---

archive/issue_events_067653.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-06-28T10:05:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27258",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27258#event-67653"
}
```
