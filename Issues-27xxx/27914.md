# Issue 27914: py3: hash collisions of Laurent polynomials

archive/issues_027677.json:
```json
{
    "body": "This ticket adjusts the hash of multivariate Laurent polynomials, so that it agrees with the hash of univariate Laurent polynomials.\n\nThis solves the following problem: Using Python 3, this doctest in `laurent_polynomial.pyx` fails about 1 out of 4 times.\n\n```\n            sage: L.<w,z> = LaurentPolynomialRing(QQ)\n            sage: len({hash(w^i*z^j) for i in [-2..2] for j in [-2..2]})\n            25\n```\nDue to hash collisions, the result can be smaller than 25 (such as 23 or 21). This gets even worse when using a larger range of monomials.\n\nRegardless of that, it is desirable that univariate and multivariate Laurent polynomials have the same hash anyway. The univariate hash implementation does not seem to have these collisions, so adopting that implementation solves this problem.\n\nFor reference, the univariate and multivariate hashes were implemented in #21272 and #23864.\n\nBranch/Commit: 26eb5fdb2a00b442b289eeced0648993957c0fd9\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Markus Wageringel\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27914\n\n",
    "closed_at": "2019-06-05T18:30:49Z",
    "created_at": "2019-06-01T10:36:02Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: hash collisions of Laurent polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27914",
    "user": "https://github.com/mwageringel"
}
```
This ticket adjusts the hash of multivariate Laurent polynomials, so that it agrees with the hash of univariate Laurent polynomials.

This solves the following problem: Using Python 3, this doctest in `laurent_polynomial.pyx` fails about 1 out of 4 times.

```
            sage: L.<w,z> = LaurentPolynomialRing(QQ)
            sage: len({hash(w^i*z^j) for i in [-2..2] for j in [-2..2]})
            25
```
Due to hash collisions, the result can be smaller than 25 (such as 23 or 21). This gets even worse when using a larger range of monomials.

Regardless of that, it is desirable that univariate and multivariate Laurent polynomials have the same hash anyway. The univariate hash implementation does not seem to have these collisions, so adopting that implementation solves this problem.

For reference, the univariate and multivariate hashes were implemented in #21272 and #23864.

Branch/Commit: 26eb5fdb2a00b442b289eeced0648993957c0fd9

Reviewer: Frédéric Chapoton

Author: Markus Wageringel

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27914





---

archive/issue_comments_540116.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mwageringel/py3_hash_laurent\"",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540116",
    "user": "https://github.com/mwageringel"
}
```

Changing branch from "" to "u/gh-mwageringel/py3_hash_laurent"



---

archive/issue_comments_540117.json:
```json
{
    "body": "Changing author from \"\" to \"Markus Wageringel\"",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540117",
    "user": "https://github.com/mwageringel"
}
```

Changing author from "" to "Markus Wageringel"



---

archive/issue_comments_540118.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540118",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_540119.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540119",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_540120.json:
```json
{
    "body": "Changing commit from \"\" to \"26eb5fdb2a00b442b289eeced0648993957c0fd9\"",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540120",
    "user": "https://github.com/mwageringel"
}
```

Changing commit from "" to "26eb5fdb2a00b442b289eeced0648993957c0fd9"



---

archive/issue_comments_540121.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-02T16:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540121",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_540122.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2019-06-02T16:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540122",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_540123.json:
```json
{
    "body": "<a id='comment:2'></a>ok, let it be",
    "created_at": "2019-06-02T16:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540123",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>ok, let it be



---

archive/issue_comments_540124.json:
```json
{
    "body": "Changing branch from \"u/gh-mwageringel/py3_hash_laurent\" to \"26eb5fdb2a00b442b289eeced0648993957c0fd9\"",
    "created_at": "2019-06-05T18:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540124",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-mwageringel/py3_hash_laurent" to "26eb5fdb2a00b442b289eeced0648993957c0fd9"



---

archive/issue_events_069189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-05T18:30:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27914#event-69189"
}
```



---

archive/issue_comments_540125.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-05T18:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27914#issuecomment-540125",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
