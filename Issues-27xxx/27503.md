# Issue 27503: add a method "tan" for power series

archive/issues_027266.json:
```json
{
    "assignees": [],
    "body": "using the existing sin and cos\n\nCC:  @tscrim\n\nBranch/Commit: **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27503_\n\n",
    "closed_at": "2019-03-25T19:43:03Z",
    "created_at": "2019-03-16T17:06:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "add a method \"tan\" for power series",
    "type": "issue",
    "updated_at": "2019-03-25T19:43:03Z",
    "url": "https://github.com/sagemath/sage/issues/27503",
    "user": "https://github.com/fchapoton"
}
```
using the existing sin and cos

CC:  @tscrim

Branch/Commit: **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**

Reviewer: **Travis Scrimshaw**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/27503_





---

archive/issue_events_359504.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:06:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359504"
}
```



---

archive/issue_events_359505.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:06:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359505"
}
```



---

archive/issue_events_359506.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:06:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359506"
}
```



---

archive/issue_events_359507.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:06:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359507"
}
```



---

archive/issue_events_359508.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359508"
}
```



---

archive/issue_comments_428788.json:
```json
{
    "body": "Branch: **[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)**",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428788",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)**



---

archive/issue_comments_428789.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d\">712d8d3</a></td><td><code>trac 27503 adding tan for power series</code></td></tr></table>\n",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428789",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d">712d8d3</a></td><td><code>trac 27503 adding tan for power series</code></td></tr></table>




---

archive/issue_comments_428790.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428790",
    "user": "https://github.com/fchapoton"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_events_359509.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359509"
}
```



---

archive/issue_events_359510.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359510"
}
```



---

archive/issue_comments_428791.json:
```json
{
    "body": "Commit: **[712d8d3](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)**",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428791",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[712d8d3](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)**



---

archive/issue_comments_428792.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\ngreen bot, please review",
    "created_at": "2019-03-17T08:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428792",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'>Comment 2:</a>
green bot, please review



---

archive/issue_comments_428793.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nA few comments/questions:\n\n- Are we sure that the result of the division has sufficient/correct precision? In other words, do we have to increase the precision of `sin` and/or `cos` to ensure that the `prec-1` term is computed correctly?\n- It would be better to make this change:\n\n  ```diff\n  -        val = self.valuation()\n  -        assert(val >= 1)\n  +        assert(self.valuation() >= 1)\n  ```\n  That way the valuation is not computed if the assert statement is not run (as it is not needed other than a sanity check).\n- Could we change the error message to fit the formatting want for Sage (i.e., following Python with starting with a lower case and no full stop/period)? I know it is inconsistent, but I think it is better when adding code not to exacerbate the problem. (If you think uniformity is better, then feel free to ignore.)\n- You do not need `R = self.parent()`.",
    "created_at": "2019-03-18T10:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428793",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>Comment 3:</a>
A few comments/questions:

- Are we sure that the result of the division has sufficient/correct precision? In other words, do we have to increase the precision of `sin` and/or `cos` to ensure that the `prec-1` term is computed correctly?
- It would be better to make this change:

  ```diff
  -        val = self.valuation()
  -        assert(val >= 1)
  +        assert(self.valuation() >= 1)
  ```
  That way the valuation is not computed if the assert statement is not run (as it is not needed other than a sanity check).
- Could we change the error message to fit the formatting want for Sage (i.e., following Python with starting with a lower case and no full stop/period)? I know it is inconsistent, but I think it is better when adding code not to exacerbate the problem. (If you think uniformity is better, then feel free to ignore.)
- You do not need `R = self.parent()`.



---

archive/issue_comments_428794.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9\">c8a7303</a></td><td><code>trac 27503 fixing some details</code></td></tr></table>\n",
    "created_at": "2019-03-18T16:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428794",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9">c8a7303</a></td><td><code>trac 27503 fixing some details</code></td></tr></table>




---

archive/issue_comments_428795.json:
```json
{
    "body": "Changed commit from **[712d8d3](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)** to **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**",
    "created_at": "2019-03-18T16:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428795",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[712d8d3](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)** to **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**



---

archive/issue_comments_428796.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nFixes made, thx.\n\nConcerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.",
    "created_at": "2019-03-18T16:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428796",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
Fixes made, thx.

Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.



---

archive/issue_comments_428797.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@fchapoton](#comment%3A5):\n> Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.\n\nI agree that it is well-defined. What I am worried about is that the division could introduce some slight difference from the correct value (when done with higher precision). This would be similar to the effects when doing division in `RR`. Although I have played around with some FPS examples, and I cannot get this to occur. So I think my fears are unfounded.\n\nThanks. LGTM.",
    "created_at": "2019-03-18T23:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428797",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@fchapoton](#comment%3A5):
> Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.

I agree that it is well-defined. What I am worried about is that the division could introduce some slight difference from the correct value (when done with higher precision). This would be similar to the effects when doing division in `RR`. Although I have played around with some FPS examples, and I cannot get this to occur. So I think my fears are unfounded.

Thanks. LGTM.



---

archive/issue_comments_428798.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-03-18T23:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428798",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_359511.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-18T23:12:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359511"
}
```



---

archive/issue_events_359512.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-18T23:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359512"
}
```



---

archive/issue_events_359513.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-25T19:43:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359513"
}
```



---

archive/issue_events_359514.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6af1dea82a7a9589f18cbd1f525c3c48d79323a5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-25T19:43:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-359514"
}
```



---

archive/issue_comments_428799.json:
```json
{
    "body": "Changed branch from **[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)** to **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**",
    "created_at": "2019-03-25T19:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428799",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)** to **[c8a7303](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)**
