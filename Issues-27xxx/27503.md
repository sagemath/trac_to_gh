# Issue 27503: add a method "tan" for power series

archive/issues_027266.json:
```json
{
    "assignees": [],
    "body": "using the existing sin and cos\n\n**CC:**  @tscrim\n\n**Branch/Commit:** [c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/27503\n\n",
    "closed_at": "2019-03-25T19:43:03Z",
    "created_at": "2019-03-16T17:06:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/trivial",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "add a method \"tan\" for power series",
    "type": "issue",
    "updated_at": "2019-03-25T19:43:03Z",
    "url": "https://github.com/sagemath/sage/issues/27503",
    "user": "https://github.com/fchapoton"
}
```
using the existing sin and cos

**CC:**  @tscrim

**Branch/Commit:** [c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)

**Reviewer:** Travis Scrimshaw

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/27503





---

archive/issue_events_242879.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242879"
}
```



---

archive/issue_comments_428610.json:
```json
{
    "body": "**Branch:** [u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428610",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)



---

archive/issue_comments_428611.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d\">712d8d3</a></td><td><code>trac 27503 adding tan for power series</code></td></tr></table>\n",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428611",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d">712d8d3</a></td><td><code>trac 27503 adding tan for power series</code></td></tr></table>




---

archive/issue_comments_428612.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428612",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_events_242880.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242880"
}
```



---

archive/issue_events_242881.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-16T17:07:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242881"
}
```



---

archive/issue_comments_428613.json:
```json
{
    "body": "**Commit:** [712d8d35ea83782dd541514b1d21435aa156382d](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)",
    "created_at": "2019-03-16T17:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428613",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [712d8d35ea83782dd541514b1d21435aa156382d](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)



---

archive/issue_comments_428614.json:
```json
{
    "body": "<a id='comment:2'></a>\ngreen bot, please review",
    "created_at": "2019-03-17T08:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428614",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
green bot, please review



---

archive/issue_comments_428615.json:
```json
{
    "body": "<a id='comment:3'></a>\nA few comments/questions:\n\n- Are we sure that the result of the division has sufficient/correct precision? In other words, do we have to increase the precision of `sin` and/or `cos` to ensure that the `prec-1` term is computed correctly?\n- It would be better to make this change:\n\n  ```diff\n  -        val = self.valuation()\n  -        assert(val >= 1)\n  +        assert(self.valuation() >= 1)\n  ```\n  That way the valuation is not computed if the assert statement is not run (as it is not needed other than a sanity check).\n- Could we change the error message to fit the formatting want for Sage (i.e., following Python with starting with a lower case and no full stop/period)? I know it is inconsistent, but I think it is better when adding code not to exacerbate the problem. (If you think uniformity is better, then feel free to ignore.)\n- You do not need `R = self.parent()`.",
    "created_at": "2019-03-18T10:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428615",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
A few comments/questions:

- Are we sure that the result of the division has sufficient/correct precision? In other words, do we have to increase the precision of `sin` and/or `cos` to ensure that the `prec-1` term is computed correctly?
- It would be better to make this change:

  ```diff
  -        val = self.valuation()
  -        assert(val >= 1)
  +        assert(self.valuation() >= 1)
  ```
  That way the valuation is not computed if the assert statement is not run (as it is not needed other than a sanity check).
- Could we change the error message to fit the formatting want for Sage (i.e., following Python with starting with a lower case and no full stop/period)? I know it is inconsistent, but I think it is better when adding code not to exacerbate the problem. (If you think uniformity is better, then feel free to ignore.)
- You do not need `R = self.parent()`.



---

archive/issue_comments_428616.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9\">c8a7303</a></td><td><code>trac 27503 fixing some details</code></td></tr></table>\n",
    "created_at": "2019-03-18T16:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428616",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9">c8a7303</a></td><td><code>trac 27503 fixing some details</code></td></tr></table>




---

archive/issue_comments_428617.json:
```json
{
    "body": "**Changing commit** from \"[712d8d35ea83782dd541514b1d21435aa156382d](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)\" to \"[c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)\".",
    "created_at": "2019-03-18T16:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428617",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[712d8d35ea83782dd541514b1d21435aa156382d](https://github.com/sagemath/sagetrac-mirror/commit/712d8d35ea83782dd541514b1d21435aa156382d)" to "[c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)".



---

archive/issue_comments_428618.json:
```json
{
    "body": "<a id='comment:5'></a>\nFixes made, thx.\n\nConcerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.",
    "created_at": "2019-03-18T16:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428618",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
Fixes made, thx.

Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.



---

archive/issue_comments_428619.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@fchapoton](#comment%3A5):\n> Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.\n\nI agree that it is well-defined. What I am worried about is that the division could introduce some slight difference from the correct value (when done with higher precision). This would be similar to the effects when doing division in `RR`. Although I have played around with some FPS examples, and I cannot get this to occur. So I think my fears are unfounded.\n\nThanks. LGTM.",
    "created_at": "2019-03-18T23:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428619",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Replying to [@fchapoton](#comment%3A5):
> Concerning precision, I do not understand your concern. There is no reason to use more precision. Products and inverses of formal power series are well defined when truncated to a given precision.

I agree that it is well-defined. What I am worried about is that the division could introduce some slight difference from the correct value (when done with higher precision). This would be similar to the effects when doing division in `RR`. Although I have played around with some FPS examples, and I cannot get this to occur. So I think my fears are unfounded.

Thanks. LGTM.



---

archive/issue_comments_428620.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2019-03-18T23:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428620",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_242882.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-18T23:12:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242882"
}
```



---

archive/issue_events_242883.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-18T23:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242883"
}
```



---

archive/issue_events_242884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-25T19:43:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242884"
}
```



---

archive/issue_events_242885.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6af1dea82a7a9589f18cbd1f525c3c48d79323a5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-25T19:43:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27503#event-242885"
}
```



---

archive/issue_comments_428621.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)\" to \"[c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)\".",
    "created_at": "2019-03-25T19:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27503#issuecomment-428621",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/27503](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27503)" to "[c8a7303013e7c78592fbef10d9e2870fe49036c9](https://github.com/sagemath/sagetrac-mirror/commit/c8a7303013e7c78592fbef10d9e2870fe49036c9)".
