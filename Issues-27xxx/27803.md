# Issue 27803: Fix polymake 3.4's lrslib detection, add dependency on ppl

archive/issues_027566.json:
```json
{
    "body": "polymake 3.4 has an updated lrslib detection code that fails to recognize the installed lrslib from Sage on macOS.\n\n\nCC:  @dimpase paffenholz@mathematik.tu-darmstadt.de lorenz@math.tu-berlin.de @vbraun\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nBranch: public/27803-polymake-lrslib-detection\n\nDependencies: #24905\n\nCommit: 59161415289ce3256a260a8d798df7d95071658a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27803\n\n",
    "closed_at": "2019-06-08T06:45:52Z",
    "created_at": "2019-05-09T09:43:03Z",
    "labels": [
        "component: packages: experimental",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Fix polymake 3.4's lrslib detection, add dependency on ppl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27803",
    "user": "https://github.com/mkoeppe"
}
```
polymake 3.4 has an updated lrslib detection code that fails to recognize the installed lrslib from Sage on macOS.


CC:  @dimpase paffenholz@mathematik.tu-darmstadt.de lorenz@math.tu-berlin.de @vbraun

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Branch: public/27803-polymake-lrslib-detection

Dependencies: #24905

Commit: 59161415289ce3256a260a8d798df7d95071658a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27803





---

archive/issue_comments_388483.json:
```json
{
    "body": "<a id='comment:2'></a>Dima - of course, adding `--with-lrs=\"$SAGE_LOCAL\"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.\nWhat should I do?\n\n---\nLast 10 new commits:",
    "created_at": "2019-05-09T09:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388483",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Dima - of course, adding `--with-lrs="$SAGE_LOCAL"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.
What should I do?

---
Last 10 new commits:



---

archive/issue_comments_388484.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 mkoeppe]:\n> Dima - of course, adding `--with-lrs=\"$SAGE_LOCAL\"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.\n> What should I do?\n\n\nNo worries, `lrs` has not been spkg-configurified yet, see #27330 (your help in reviewing there is most welcome, by the way, e.g. all these readline and curses packages...). We should do `lrs` too, I just opened #27804 for this. So we will need to change that hardcoded value of its prefix to whatever configure finds. Already did this for GMP etc, so no big problem\nI gather.",
    "created_at": "2019-05-09T10:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388484",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Replying to [comment:2 mkoeppe]:
> Dima - of course, adding `--with-lrs="$SAGE_LOCAL"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.
> What should I do?


No worries, `lrs` has not been spkg-configurified yet, see #27330 (your help in reviewing there is most welcome, by the way, e.g. all these readline and curses packages...). We should do `lrs` too, I just opened #27804 for this. So we will need to change that hardcoded value of its prefix to whatever configure finds. Already did this for GMP etc, so no big problem
I gather.



---

archive/issue_comments_388485.json:
```json
{
    "body": "<a id='comment:5'></a>ready for review?",
    "created_at": "2019-05-09T11:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388485",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>ready for review?



---

archive/issue_comments_388486.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-09T12:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388486",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388487.json:
```json
{
    "body": "<a id='comment:7'></a>The relevant output (without this patch) from polymake's configure in `build/bundled.log`:\n\n```\n---- lrs ----\n\nCould not compile a test program checking for lrs library.\nThe most probable reasons are that the library is installed at a non-standard location,\nis not configured to build a shared module, or missing at all.\nThe complete error log follows:\n\nld: library not found for -llrs\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nPlease install the library and specify its location using --with-lrs option, if needed.\nPlease remember to enable shared modules when configuring the lrs library!\n```\nAs Benjamin pointed out, the error message does not match the one expected by `bundled/lrs/support/configure.pl` script, which tries to be too helpful.",
    "created_at": "2019-05-09T13:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388487",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>The relevant output (without this patch) from polymake's configure in `build/bundled.log`:

```
---- lrs ----

Could not compile a test program checking for lrs library.
The most probable reasons are that the library is installed at a non-standard location,
is not configured to build a shared module, or missing at all.
The complete error log follows:

ld: library not found for -llrs
clang: error: linker command failed with exit code 1 (use -v to see invocation)

Please install the library and specify its location using --with-lrs option, if needed.
Please remember to enable shared modules when configuring the lrs library!
```
As Benjamin pointed out, the error message does not match the one expected by `bundled/lrs/support/configure.pl` script, which tries to be too helpful.



---

archive/issue_comments_388488.json:
```json
{
    "body": "<a id='comment:9'></a>tests fine.",
    "created_at": "2019-05-10T10:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>tests fine.



---

archive/issue_comments_388489.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-10T10:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388489",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388490.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-08T06:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388490",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: fixed



---

archive/issue_events_068946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-06-08T06:45:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27803#event-68946"
}
```



---

archive/issue_comments_388491.json:
```json
{
    "body": "<a id='comment:11'></a>This branch has been merged already as part of #22704.",
    "created_at": "2019-06-08T06:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27803#issuecomment-388491",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>This branch has been merged already as part of #22704.
