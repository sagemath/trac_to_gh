# Issue 27192: Make the default picklejar location a user location rather than a, potentially, system one

archive/issues_026955.json:
```json
{
    "body": "In `src/sage/misc/persist.pyx` the default picklejar location is set to `SAGE_ROOT/tmp/pickle_jar`. If sage is installed globally it is potentially a location where the user cannot write and in some sage-on-distro `SAGE_ROOT` may end up being undefined.\n\nThis kind of objects clearly belong to the end user and should be saved in `DOT_SAGE`.\n\nBranch/Commit: b19c11711cb1a61b966afb507c2593d16d477ffa\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27192\n\n",
    "closed_at": "2019-02-05T16:57:46Z",
    "created_at": "2019-01-31T22:07:01Z",
    "labels": [
        "component: pickling"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Make the default picklejar location a user location rather than a, potentially, system one",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27192",
    "user": "https://github.com/kiwifb"
}
```
In `src/sage/misc/persist.pyx` the default picklejar location is set to `SAGE_ROOT/tmp/pickle_jar`. If sage is installed globally it is potentially a location where the user cannot write and in some sage-on-distro `SAGE_ROOT` may end up being undefined.

This kind of objects clearly belong to the end user and should be saved in `DOT_SAGE`.

Branch/Commit: b19c11711cb1a61b966afb507c2593d16d477ffa

Reviewer: Jeroen Demeyer

Author: François Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27192





---

archive/issue_comments_516695.json:
```json
{
    "body": "Changing branch from \"\" to \"u/fbissey/picklejar\"",
    "created_at": "2019-01-31T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516695",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "" to "u/fbissey/picklejar"



---

archive/issue_comments_516696.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-31T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516696",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_516697.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2019-01-31T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516697",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "" to "François Bissey"



---

archive/issue_comments_516698.json:
```json
{
    "body": "Changing commit from \"\" to \"ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9\"",
    "created_at": "2019-01-31T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516698",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9"



---

archive/issue_comments_516699.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[ae2b14a](https://github.com/sagemath/sagetrac-mirror/commit/ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9)|`make the default picklejar a user location`|",
    "created_at": "2019-01-31T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516699",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[ae2b14a](https://github.com/sagemath/sagetrac-mirror/commit/ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9)|`make the default picklejar a user location`|



---

archive/issue_comments_516700.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[be575ea](https://github.com/sagemath/sagetrac-mirror/commit/be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1)|`fix tab issue`|",
    "created_at": "2019-02-01T01:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[be575ea](https://github.com/sagemath/sagetrac-mirror/commit/be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1)|`fix tab issue`|



---

archive/issue_comments_516701.json:
```json
{
    "body": "Changing commit from \"ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9\" to \"be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1\"",
    "created_at": "2019-02-01T01:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ae2b14abe549aa8a30ea1281ccb5956b7bd66fe9" to "be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1"



---

archive/issue_comments_516702.json:
```json
{
    "body": "<a id='comment:3'></a>\nI am wondering... should we still support the pickle jar mechanism at all?",
    "created_at": "2019-02-01T15:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516702",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
I am wondering... should we still support the pickle jar mechanism at all?



---

archive/issue_comments_516703.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe doctests don't use the code path with `SAGE_ROOT`. So, if you care about passing doctests without `SAGE_ROOT`, you shouldn't need this ticket.",
    "created_at": "2019-02-01T16:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516703",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
The doctests don't use the code path with `SAGE_ROOT`. So, if you care about passing doctests without `SAGE_ROOT`, you shouldn't need this ticket.



---

archive/issue_comments_516704.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt may not affect doctests but the default is not sane for a system wide install. So I'd rather it be fixed. That being said if you think it should just be removed I am just as happy with that.",
    "created_at": "2019-02-01T18:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516704",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
It may not affect doctests but the default is not sane for a system wide install. So I'd rather it be fixed. That being said if you think it should just be removed I am just as happy with that.



---

archive/issue_comments_516705.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-01T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516705",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_516706.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't really care much. So I'm fine with just changing the path. But if you store it in `DOT_SAGE`, I'd rather drop the `tmp` part. So what about\n\n```\ndir = os.path.join(DOT_SAGE, 'pickle_jar')\n```",
    "created_at": "2019-02-01T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516706",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
I don't really care much. So I'm fine with just changing the path. But if you store it in `DOT_SAGE`, I'd rather drop the `tmp` part. So what about

```
dir = os.path.join(DOT_SAGE, 'pickle_jar')
```



---

archive/issue_comments_516707.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2019-02-01T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516707",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_516708.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am quite OK with that. There will a delay before I push again since my main dev machine is off (power work on campus). I need to set up an alternative.",
    "created_at": "2019-02-01T20:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516708",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I am quite OK with that. There will a delay before I push again since my main dev machine is off (power work on campus). I need to set up an alternative.



---

archive/issue_comments_516709.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[6d6b857](https://github.com/sagemath/sagetrac-mirror/commit/6d6b857e9adad69ee201bf0ff50507a3af87b51e)|`change the default path to the pickle_jar. Do not use \"tmp\" in the path.`|",
    "created_at": "2019-02-01T21:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[6d6b857](https://github.com/sagemath/sagetrac-mirror/commit/6d6b857e9adad69ee201bf0ff50507a3af87b51e)|`change the default path to the pickle_jar. Do not use "tmp" in the path.`|



---

archive/issue_comments_516710.json:
```json
{
    "body": "Changing commit from \"be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1\" to \"6d6b857e9adad69ee201bf0ff50507a3af87b51e\"",
    "created_at": "2019-02-01T21:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "be575ead8863b4ac7a5bdc5a41e4cbbc89d9e1d1" to "6d6b857e9adad69ee201bf0ff50507a3af87b51e"



---

archive/issue_comments_516711.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-01T21:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516711",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_516712.json:
```json
{
    "body": "<a id='comment:10'></a>\nOne more detail: there shouldn't be a need for the slashes here:\n\n```\ndir = os.path.join(DOT_SAGE, '/pickle_jar/')\n```",
    "created_at": "2019-02-03T13:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516712",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
One more detail: there shouldn't be a need for the slashes here:

```
dir = os.path.join(DOT_SAGE, '/pickle_jar/')
```



---

archive/issue_comments_516713.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-03T13:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516713",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_516714.json:
```json
{
    "body": "Changing commit from \"6d6b857e9adad69ee201bf0ff50507a3af87b51e\" to \"00818b878561d96ef6e9efa6e92e3f0d7513ac9a\"",
    "created_at": "2019-02-03T20:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6d6b857e9adad69ee201bf0ff50507a3af87b51e" to "00818b878561d96ef6e9efa6e92e3f0d7513ac9a"



---

archive/issue_comments_516715.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[060546a](https://github.com/sagemath/sagetrac-mirror/commit/060546a8c6cef695d2e3c112b74b6bd9b9ba1ca8)|`Merge branch 'develop' into picklejar`|\n|[9a6b915](https://github.com/sagemath/sagetrac-mirror/commit/9a6b915e75474181b91fb9c839bde7142cd47fc3)|`Merge branch 'u/fbissey/picklejar' of trac.sagemath.org:sage into picklejar`|\n|[00818b8](https://github.com/sagemath/sagetrac-mirror/commit/00818b878561d96ef6e9efa6e92e3f0d7513ac9a)|`remove useless \"/\"`|",
    "created_at": "2019-02-03T20:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[060546a](https://github.com/sagemath/sagetrac-mirror/commit/060546a8c6cef695d2e3c112b74b6bd9b9ba1ca8)|`Merge branch 'develop' into picklejar`|
|[9a6b915](https://github.com/sagemath/sagetrac-mirror/commit/9a6b915e75474181b91fb9c839bde7142cd47fc3)|`Merge branch 'u/fbissey/picklejar' of trac.sagemath.org:sage into picklejar`|
|[00818b8](https://github.com/sagemath/sagetrac-mirror/commit/00818b878561d96ef6e9efa6e92e3f0d7513ac9a)|`remove useless "/"`|



---

archive/issue_comments_516716.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-03T20:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516716",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_516717.json:
```json
{
    "body": "<a id='comment:12'></a>\nDone and rebased on new develop.",
    "created_at": "2019-02-03T20:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516717",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Done and rebased on new develop.



---

archive/issue_comments_516718.json:
```json
{
    "body": "Changing branch from \"u/fbissey/picklejar\" to \"u/jdemeyer/picklejar\"",
    "created_at": "2019-02-04T06:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516718",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/fbissey/picklejar" to "u/jdemeyer/picklejar"



---

archive/issue_comments_516719.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-04T06:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516719",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_516720.json:
```json
{
    "body": "<a id='comment:14'></a>\nSquashed commits for a cleaner git history.\n\n---\nNew commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[b19c117](https://github.com/sagemath/sagetrac-mirror/commit/b19c11711cb1a61b966afb507c2593d16d477ffa)|`Make the default pickle_jar a user location`|",
    "created_at": "2019-02-04T06:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516720",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Squashed commits for a cleaner git history.

---
New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[b19c117](https://github.com/sagemath/sagetrac-mirror/commit/b19c11711cb1a61b966afb507c2593d16d477ffa)|`Make the default pickle_jar a user location`|



---

archive/issue_comments_516721.json:
```json
{
    "body": "Changing commit from \"00818b878561d96ef6e9efa6e92e3f0d7513ac9a\" to \"b19c11711cb1a61b966afb507c2593d16d477ffa\"",
    "created_at": "2019-02-04T06:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516721",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "00818b878561d96ef6e9efa6e92e3f0d7513ac9a" to "b19c11711cb1a61b966afb507c2593d16d477ffa"



---

archive/issue_comments_516722.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-05T16:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516722",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_084456.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-05T16:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27192#event-84456"
}
```



---

archive/issue_comments_516723.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/picklejar\" to \"b19c11711cb1a61b966afb507c2593d16d477ffa\"",
    "created_at": "2019-02-05T16:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27192#issuecomment-516723",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/picklejar" to "b19c11711cb1a61b966afb507c2593d16d477ffa"
