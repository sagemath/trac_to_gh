# Issue 27140: make_any_gap_element() should not be called inside sig_on()

archive/issues_026903.json:
```json
{
    "body": "As explained in #27060, we shouldn't be allocating/deallocating Python objects inside `sig_on()`:\n\n```\n**********************************************************************\nFile \"src/sage/groups/matrix_gps/coxeter_group.py\", line 421, in sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite\nFailed example:\n    [l for l in range(2, 9) if\n     CoxeterGroup([[1,3,2,2,2], [3,1,3,3,2], [2,3,1,2,2],\n                   [2,3,2,1,l], [2,2,2,l,1]]).is_finite()]\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite[2]>\", line 3, in <module>\n        [Integer(2),Integer(3),Integer(2),Integer(1),l], [Integer(2),Integer(2),Integer(2),l,Integer(1)]]).is_finite()]\n      File \"sage/misc/lazy_import.pyx\", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3684)\n        return self.get_object()(*args, **kwds)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_group.py\", line 132, in CoxeterGroup\n        return CoxeterMatrixGroup(data, base_ring, index_set)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py\", line 233, in __classcall_private__\n        data, base_ring, data.index_set())\n      File \"sage/misc/cachefunc.pyx\", line 1005, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6068)\n        w = self.f(*args, **kwds)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/structure/unique_representation.py\", line 1027, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 497, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2151)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py\", line 303, in __init__\n        for i in range(n)]\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py\", line 284, in val\n        return E(2 * x) + ~E(2 * x)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/universal_cyclotomic_field.py\", line 1258, in gen\n        return self.element_class(self, libgap.E(n)**k)\n      File \"sage/libs/gap/element.pyx\", line 1079, in sage.libs.gap.element.GapElement.__pow__ (build/cythonized/sage/libs/gap/element.c:11484)\n        sig_on()\n    SystemError: calling remove_from_pari_stack() inside sig_on()\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite\n    [136 tests, 1 failure, 9.44 s]\n**********************************************************************\n```\n\nCC:  @jdemeyer @embray @tscrim\n\nKeywords: random_fail\n\nBranch/Commit: 1570071f8e10feb946b38f2a03eb5d3f3bcc43ba\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nDependencies: #26992, #27155\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27140\n\n",
    "closed_at": "2019-02-06T10:39:15Z",
    "created_at": "2019-01-27T10:47:55Z",
    "labels": [
        "component: group theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "make_any_gap_element() should not be called inside sig_on()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27140",
    "user": "https://github.com/vbraun"
}
```
As explained in #27060, we shouldn't be allocating/deallocating Python objects inside `sig_on()`:

```
**********************************************************************
File "src/sage/groups/matrix_gps/coxeter_group.py", line 421, in sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite
Failed example:
    [l for l in range(2, 9) if
     CoxeterGroup([[1,3,2,2,2], [3,1,3,3,2], [2,3,1,2,2],
                   [2,3,2,1,l], [2,2,2,l,1]]).is_finite()]
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite[2]>", line 3, in <module>
        [Integer(2),Integer(3),Integer(2),Integer(1),l], [Integer(2),Integer(2),Integer(2),l,Integer(1)]]).is_finite()]
      File "sage/misc/lazy_import.pyx", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3684)
        return self.get_object()(*args, **kwds)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/coxeter_group.py", line 132, in CoxeterGroup
        return CoxeterMatrixGroup(data, base_ring, index_set)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)
        return cls.classcall(cls, *args, **kwds)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py", line 233, in __classcall_private__
        data, base_ring, data.index_set())
      File "sage/misc/cachefunc.pyx", line 1005, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6068)
        w = self.f(*args, **kwds)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/structure/unique_representation.py", line 1027, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 497, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2151)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py", line 303, in __init__
        for i in range(n)]
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/matrix_gps/coxeter_group.py", line 284, in val
        return E(2 * x) + ~E(2 * x)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/universal_cyclotomic_field.py", line 1258, in gen
        return self.element_class(self, libgap.E(n)**k)
      File "sage/libs/gap/element.pyx", line 1079, in sage.libs.gap.element.GapElement.__pow__ (build/cythonized/sage/libs/gap/element.c:11484)
        sig_on()
    SystemError: calling remove_from_pari_stack() inside sig_on()
**********************************************************************
1 item had failures:
   1 of   6 in sage.groups.matrix_gps.coxeter_group.CoxeterMatrixGroup.is_finite
    [136 tests, 1 failure, 9.44 s]
**********************************************************************
```

CC:  @jdemeyer @embray @tscrim

Keywords: random_fail

Branch/Commit: 1570071f8e10feb946b38f2a03eb5d3f3bcc43ba

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Dependencies: #26992, #27155

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27140





---

archive/issue_comments_403023.json:
```json
{
    "body": "<a id='comment:1'></a>This is with the cypari2-2.0.3 update, for the record",
    "created_at": "2019-01-27T10:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403023",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>This is with the cypari2-2.0.3 update, for the record



---

archive/issue_comments_403024.json:
```json
{
    "body": "<a id='comment:2'></a>The problem is that this\n\n```\nmake_any_gap_element(self.parent(), result)\n```\nshould not be run under `sig_on()`.\n\nCC `@`embray because he might know why this is done this way and whether this `make_any_gap_element` call needs to be protected by either `sig_on()` or `GAP_Enter()`.",
    "created_at": "2019-01-27T12:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403024",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>The problem is that this

```
make_any_gap_element(self.parent(), result)
```
should not be run under `sig_on()`.

CC `@`embray because he might know why this is done this way and whether this `make_any_gap_element` call needs to be protected by either `sig_on()` or `GAP_Enter()`.



---

archive/issue_comments_403025.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Not sure whats going on here, seems like pari shouldn't be involved. A destructor running? Doesn't happen when I run the test by hand:\n+As explained in #27060, we shouldn't be allocating/deallocating Python objects inside \\`sig_on()\\`:\n \n \\`\\`\\`\n **********************************************************************\n```\n",
    "created_at": "2019-01-27T12:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403025",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Not sure whats going on here, seems like pari shouldn't be involved. A destructor running? Doesn't happen when I run the test by hand:
+As explained in #27060, we shouldn't be allocating/deallocating Python objects inside \`sig_on()\`:
 
 \`\`\`
 **********************************************************************
```




---

archive/issue_comments_403026.json:
```json
{
    "body": "<a id='comment:3'></a>Note that these GC-related failures are not \"random\" strictly speaking. They are deterministic, but require a very precise set of conditions to reproduce.",
    "created_at": "2019-01-27T12:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403026",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Note that these GC-related failures are not "random" strictly speaking. They are deterministic, but require a very precise set of conditions to reproduce.



---

archive/issue_comments_403027.json:
```json
{
    "body": "<a id='comment:5'></a>For reference, this is the code structure for the PARI interface:\n\n- convert input to PARI\n- `sig_on()`\n- call PARI function\n- `sig_off()`\n- wrap output in Python object\n\nIt should be this way for GAP too.",
    "created_at": "2019-01-27T17:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403027",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>For reference, this is the code structure for the PARI interface:

- convert input to PARI
- `sig_on()`
- call PARI function
- `sig_off()`
- wrap output in Python object

It should be this way for GAP too.



---

archive/issue_comments_403028.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:2 jdemeyer]:\n> The problem is that this\n> \n> ```\n> make_any_gap_element(self.parent(), result)\n> ```\n> should not be run under `sig_on()`.\n> \n> CC `@`embray because he might know why this is done this way and whether this `make_any_gap_element` call needs to be protected by either `sig_on()` or `GAP_Enter()`.\n\n\nI need to take a closer look at the code but I'm sure you're right that it needs to be more precisely bracketed in its use of `sig_on()/sig_off()`.  Some of that will be refactored soon too, especially when I bring in some of the upstream changes that expanded the official \"libgap API\" (I mentioned this also in #27094).",
    "created_at": "2019-01-28T12:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403028",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Replying to [comment:2 jdemeyer]:
> The problem is that this
> 
> ```
> make_any_gap_element(self.parent(), result)
> ```
> should not be run under `sig_on()`.
> 
> CC `@`embray because he might know why this is done this way and whether this `make_any_gap_element` call needs to be protected by either `sig_on()` or `GAP_Enter()`.


I need to take a closer look at the code but I'm sure you're right that it needs to be more precisely bracketed in its use of `sig_on()/sig_off()`.  Some of that will be refactored soon too, especially when I bring in some of the upstream changes that expanded the official "libgap API" (I mentioned this also in #27094).



---

archive/issue_comments_403029.json:
```json
{
    "body": "<a id='comment:8'></a>After reading the GAP code on https://github.com/gap-system/gap/pull/3096, I'm pretty sure that there are race conditions too with the current code structure. For extra safety, we could wrap the `GAP_Enter/GAP_Leave` macros inside `sig_block`/`sig_unblock`.",
    "created_at": "2019-01-28T13:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403029",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>After reading the GAP code on https://github.com/gap-system/gap/pull/3096, I'm pretty sure that there are race conditions too with the current code structure. For extra safety, we could wrap the `GAP_Enter/GAP_Leave` macros inside `sig_block`/`sig_unblock`.



---

archive/issue_comments_403030.json:
```json
{
    "body": "<a id='comment:9'></a>I'm sure there are, but I wouldn't want to go nuts unless there's something provable there.  You don't want to make GAP functions uninterruptible.",
    "created_at": "2019-01-28T13:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403030",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>I'm sure there are, but I wouldn't want to go nuts unless there's something provable there.  You don't want to make GAP functions uninterruptible.



---

archive/issue_comments_403031.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 embray]:\n> You don't want to make GAP functions uninterruptible.\n\n\nNo, I only want to protect `GAP_Enter` and `GAP_Leave`. So something like\n\n```\nsig_on()\nsig_block()\nGAP_Enter()\nsig_unblock()\n<actual GAP call>\nsig_block()\nGAP_Enter()\nsig_unblock()\nsig_off()\n```\nOf course, we could use macros to make this less painfull to write.",
    "created_at": "2019-01-28T13:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403031",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [comment:9 embray]:
> You don't want to make GAP functions uninterruptible.


No, I only want to protect `GAP_Enter` and `GAP_Leave`. So something like

```
sig_on()
sig_block()
GAP_Enter()
sig_unblock()
<actual GAP call>
sig_block()
GAP_Enter()
sig_unblock()
sig_off()
```
Of course, we could use macros to make this less painfull to write.



---

archive/issue_comments_403032.json:
```json
{
    "body": "<a id='comment:11'></a>Yes, I just came back to comment to say I realized that's what you meant.  That makes sense to me.\n\nI was thinking about what you wrote on the PR about `sig_atomic_t` and you're right: I thought it at least guaranteed that simple arithmetic operations involving a read and a write would be atomic, but it makes no such guarantee. It doesn't even work out that way in practice.  Oh well.\n\nI think I thought differently because cysignals, which obviously influenced a lot of this, uses it for `sig_on_count` so it seemed to make sense.  But I think I understand now that in the case of `sig_on_count` it was specifically for setting `sig_on_count = 0` in the case where an interrupt was received before `sig_on()`?",
    "created_at": "2019-01-28T14:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403032",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>Yes, I just came back to comment to say I realized that's what you meant.  That makes sense to me.

I was thinking about what you wrote on the PR about `sig_atomic_t` and you're right: I thought it at least guaranteed that simple arithmetic operations involving a read and a write would be atomic, but it makes no such guarantee. It doesn't even work out that way in practice.  Oh well.

I think I thought differently because cysignals, which obviously influenced a lot of this, uses it for `sig_on_count` so it seemed to make sense.  But I think I understand now that in the case of `sig_on_count` it was specifically for setting `sig_on_count = 0` in the case where an interrupt was received before `sig_on()`?



---

archive/issue_comments_403033.json:
```json
{
    "body": "<a id='comment:13'></a>This fixes the `__pow__` call. For now, I decided to fix only that instead of all such GAP calls. This in order to get #26992 merged and to get some feedback on the general mechanism.\n\n---\nNew commits:",
    "created_at": "2019-02-04T17:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403033",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>This fixes the `__pow__` call. For now, I decided to fix only that instead of all such GAP calls. This in order to get #26992 merged and to get some feedback on the general mechanism.

---
New commits:



---

archive/issue_comments_403034.json:
```json
{
    "body": "<a id='comment:14'></a>As you can see, I also took the opportunity to use the coercion model `_pow_` and `_pow_int` instead of `__pow__`.",
    "created_at": "2019-02-04T17:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403034",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>As you can see, I also took the opportunity to use the coercion model `_pow_` and `_pow_int` instead of `__pow__`.



---

archive/issue_comments_403035.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-04T22:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403035",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403036.json:
```json
{
    "body": "<a id='comment:16'></a>From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.",
    "created_at": "2019-02-05T02:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403036",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.



---

archive/issue_comments_403037.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 tscrim]:\n> From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.\n\n\nThe commit under review is the last one, which doesn't change `util.pyx`",
    "created_at": "2019-02-05T06:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403037",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:16 tscrim]:
> From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.


The commit under review is the last one, which doesn't change `util.pyx`



---

archive/issue_comments_403038.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 jdemeyer]:\n> Replying to [comment:16 tscrim]:\n> > From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.\n\n> \n> The commit under review is the last one, which doesn't change `util.pyx`\n\n\nAh, sorry, I missed the changes to it on #27155 (read too quickly). Actually, I just have one little question: is this meant to be a comment, definition, or just a note to yourself?\n\n```\n    \"\"\"\n    #define sig_GAP_Enter()  {int t = GAP_Enter(); if (!t) sig_error();}\n    \"\"\"\n```",
    "created_at": "2019-02-05T13:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403038",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Replying to [comment:17 jdemeyer]:
> Replying to [comment:16 tscrim]:
> > From a somewhat quick look-over, everything seems fine to me. However, I do not claim to fully understand what goes on in `util.pyx`, so I would like a second opinion (e.g. Erik) before setting to positive.

> 
> The commit under review is the last one, which doesn't change `util.pyx`


Ah, sorry, I missed the changes to it on #27155 (read too quickly). Actually, I just have one little question: is this meant to be a comment, definition, or just a note to yourself?

```
    """
    #define sig_GAP_Enter()  {int t = GAP_Enter(); if (!t) sig_error();}
    """
```



---

archive/issue_comments_403039.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 tscrim]:\n> is this meant to be a comment, definition, or just a note to yourself?\n\n\nSee https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#including-verbatim-c-code and https://github.com/cython/cython/pull/1915",
    "created_at": "2019-02-05T13:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403039",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:18 tscrim]:
> is this meant to be a comment, definition, or just a note to yourself?


See https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#including-verbatim-c-code and https://github.com/cython/cython/pull/1915



---

archive/issue_comments_403040.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-05T13:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403040",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403041.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 jdemeyer]:\n> Replying to [comment:18 tscrim]:\n> > is this meant to be a comment, definition, or just a note to yourself?\n\n> \n> See https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#including-verbatim-c-code and https://github.com/cython/cython/pull/1915\n\n\nThat was what I was thinking, but I didn't know Cython could do that. Thank you.\n\nLGTM.",
    "created_at": "2019-02-05T13:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403041",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 tscrim]:
> > is this meant to be a comment, definition, or just a note to yourself?

> 
> See https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#including-verbatim-c-code and https://github.com/cython/cython/pull/1915


That was what I was thinking, but I didn't know Cython could do that. Thank you.

LGTM.



---

archive/issue_comments_403042.json:
```json
{
    "body": "<a id='comment:21'></a>I seem to recall looking at that code previously and wondering why it *didn't* use the coercion system for `__pow__`.  I trust you to know the right way to handle this.",
    "created_at": "2019-02-05T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403042",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>I seem to recall looking at that code previously and wondering why it *didn't* use the coercion system for `__pow__`.  I trust you to know the right way to handle this.



---

archive/issue_comments_403043.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 tscrim]:\n> That was what I was thinking, but I didn't know Cython could do that. Thank you.\n\n\nThat's because it's relatively new! And long overdue.",
    "created_at": "2019-02-05T15:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403043",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>Replying to [comment:20 tscrim]:
> That was what I was thinking, but I didn't know Cython could do that. Thank you.


That's because it's relatively new! And long overdue.



---

archive/issue_comments_403044.json:
```json
{
    "body": "<a id='comment:23'></a>To the release manager: tickets #26992, #27155 and #27140 should be merged together to avoid test failures.",
    "created_at": "2019-02-05T15:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403044",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>To the release manager: tickets #26992, #27155 and #27140 should be merged together to avoid test failures.



---

archive/issue_events_067396.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-06T10:39:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27140#event-67396"
}
```



---

archive/issue_comments_403045.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-06T10:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27140#issuecomment-403045",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
