# Issue 27562: Fix string formatting in ValueError in sql_db.py

archive/issues_027325.json:
```json
{
    "body": "Keywords: beginner\n\nIn `src/sage/databases/sql_db.py`, lines 465--467 currently read\n\n```\n            if query_dict['table_name'] not in skel:\n                raise ValueError(\"Database has no table\" \\\n                    + str(query_dict['table_name']) + \".\")\n```\nbut should instead read\n\n```\n            if query_dict['table_name'] not in skel:\n                raise ValueError(\"database has no table %s\"\n                                 % query_dict['table_name'])\n```\n\nThe current version in particular lacks a space between\n\"has no table\" and the name, so errors look like:\n\n```\nFile ...\nFailed example:\n    r = SQLQuery(DB, {'table_name':'simon'})\nException raised:\n...\nValueError: Database has no tablesimon.\n```\ninstead of\n\n```\nFile ...\nFailed example:\n    r = SQLQuery(DB, {'table_name':'simon'})\nException raised:\n...\nValueError: database has no table simon\n```\n\nAt line 1400, one should also change\n\n```\n        if table_name in self.__skeleton__:\n            raise ValueError('Database already has a table named' \\\n                + '%s.'%table_name)\n```\nto\n\n```\n        if table_name in self.__skeleton__:\n            raise ValueError('database already has a table named %s'\n                             %table_name)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27562\n\n",
    "closed_at": "2019-07-23T21:03:49Z",
    "created_at": "2019-03-28T21:38:49Z",
    "labels": [
        "component: packages: optional",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Fix string formatting in ValueError in sql_db.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27562",
    "user": "https://github.com/slel"
}
```
Keywords: beginner

In `src/sage/databases/sql_db.py`, lines 465--467 currently read

```
            if query_dict['table_name'] not in skel:
                raise ValueError("Database has no table" \
                    + str(query_dict['table_name']) + ".")
```
but should instead read

```
            if query_dict['table_name'] not in skel:
                raise ValueError("database has no table %s"
                                 % query_dict['table_name'])
```

The current version in particular lacks a space between
"has no table" and the name, so errors look like:

```
File ...
Failed example:
    r = SQLQuery(DB, {'table_name':'simon'})
Exception raised:
...
ValueError: Database has no tablesimon.
```
instead of

```
File ...
Failed example:
    r = SQLQuery(DB, {'table_name':'simon'})
Exception raised:
...
ValueError: database has no table simon
```

At line 1400, one should also change

```
        if table_name in self.__skeleton__:
            raise ValueError('Database already has a table named' \
                + '%s.'%table_name)
```
to

```
        if table_name in self.__skeleton__:
            raise ValueError('database already has a table named %s'
                             %table_name)
```


Issue created by migration from https://trac.sagemath.org/ticket/27562





---

archive/issue_comments_384761.json:
```json
{
    "body": "Changing keywords from \"\" to \"beginner\".",
    "created_at": "2019-03-29T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384761",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "beginner".



---

archive/issue_comments_384762.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2019-03-29T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384762",
    "user": "https://github.com/slel"
}
```

Changing priority from major to minor.



---

archive/issue_comments_384763.json:
```json
{
    "body": "Note: re-using this ticket created by mistake; the one about cycle basis for multiedges is at #27563.",
    "created_at": "2019-03-29T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384763",
    "user": "https://github.com/slel"
}
```

Note: re-using this ticket created by mistake; the one about cycle basis for multiedges is at #27563.



---

archive/issue_comments_384764.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to task.",
    "created_at": "2019-03-29T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384764",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to task.



---

archive/issue_comments_384765.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2019-03-29T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384765",
    "user": "https://github.com/slel"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_384766.json:
```json
{
    "body": "This should be an easy ticket to fix for a beginner.",
    "created_at": "2019-03-29T00:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384766",
    "user": "https://github.com/slel"
}
```

This should be an easy ticket to fix for a beginner.



---

archive/issue_comments_384767.json:
```json
{
    "body": "Replying to [comment:2 slelievre]:\n> This should be an easy ticket to fix for a beginner.\n\n\nAs a beginner I'd like to fix this, if no one else's on it, of course. Is that okay?",
    "created_at": "2019-04-02T18:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384767",
    "user": "https://github.com/beagaliana"
}
```

Replying to [comment:2 slelievre]:
> This should be an easy ticket to fix for a beginner.


As a beginner I'd like to fix this, if no one else's on it, of course. Is that okay?



---

archive/issue_comments_384768.json:
```json
{
    "body": "Sure, please go ahead. Ask questions if you have any doubt.",
    "created_at": "2019-04-03T09:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384768",
    "user": "https://github.com/slel"
}
```

Sure, please go ahead. Ask questions if you have any doubt.



---

archive/issue_comments_384769.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-04-03T16:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384769",
    "user": "https://github.com/beagaliana"
}
```

New commits:



---

archive/issue_comments_384770.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-03T16:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384770",
    "user": "https://github.com/beagaliana"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384771.json:
```json
{
    "body": "please add a doctest to check your new error message",
    "created_at": "2019-04-07T19:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384771",
    "user": "https://github.com/fchapoton"
}
```

please add a doctest to check your new error message



---

archive/issue_comments_384772.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> please add a doctest to check your new error message\n\nI've never added a doctest before so this question might be a bit too simple. I've been reading the general conventions about writing tests but I'm not really sure about where should I add it. I thought I would just write it as a comment starting with something like this  \n\n`Test that :trac:27562 is fixed::` \n\nand then just add the test itself.\n\nThank you!\n\nBea",
    "created_at": "2019-04-13T15:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384772",
    "user": "https://github.com/beagaliana"
}
```

Replying to [comment:9 chapoton]:
> please add a doctest to check your new error message

I've never added a doctest before so this question might be a bit too simple. I've been reading the general conventions about writing tests but I'm not really sure about where should I add it. I thought I would just write it as a comment starting with something like this  

`Test that :trac:27562 is fixed::` 

and then just add the test itself.

Thank you!

Bea



---

archive/issue_comments_384773.json:
```json
{
    "body": "I already got my answer, I'll try to add the doctest asap :-)",
    "created_at": "2019-04-26T12:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384773",
    "user": "https://github.com/beagaliana"
}
```

I already got my answer, I'll try to add the doctest asap :-)



---

archive/issue_comments_384774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-26T15:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384775.json:
```json
{
    "body": "ok, almost good.\n\n* This added piece of doc should not be in the middle of the code, but with the rest of the doc (probably somewhere slightly above the place where you have put it)\n\n* There should be an empty line after the line ending with `::`\n\n* The test lines after any `::` should be indented by 4 more spaces\n\n* The correct syntax for the trac role is `:trac:`27562``",
    "created_at": "2019-04-28T11:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384775",
    "user": "https://github.com/fchapoton"
}
```

ok, almost good.

* This added piece of doc should not be in the middle of the code, but with the rest of the doc (probably somewhere slightly above the place where you have put it)

* There should be an empty line after the line ending with `::`

* The test lines after any `::` should be indented by 4 more spaces

* The correct syntax for the trac role is `:trac:`27562``



---

archive/issue_comments_384776.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-29T12:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384777.json:
```json
{
    "body": "Replying to [comment:13 chapoton]:\n> ok, almost good.\n> \n> * This added piece of doc should not be in the middle of the code, but with the rest of the doc (probably somewhere slightly above the place where you have put it)\n> \n> * There should be an empty line after the line ending with `::`\n> \n> * The test lines after any `::` should be indented by 4 more spaces\n> \n> * The correct syntax for the trac role is `:trac:`27562``\n\n\nThank you for your corrections!\n \nI just changed the doctest, I believe I did everything you suggested so it should be okay by now",
    "created_at": "2019-04-29T12:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384777",
    "user": "https://github.com/beagaliana"
}
```

Replying to [comment:13 chapoton]:
> ok, almost good.
> 
> * This added piece of doc should not be in the middle of the code, but with the rest of the doc (probably somewhere slightly above the place where you have put it)
> 
> * There should be an empty line after the line ending with `::`
> 
> * The test lines after any `::` should be indented by 4 more spaces
> 
> * The correct syntax for the trac role is `:trac:`27562``


Thank you for your corrections!
 
I just changed the doctest, I believe I did everything you suggested so it should be okay by now



---

archive/issue_comments_384778.json:
```json
{
    "body": "Looks better,\n\n* you forgot to remove the \"doc in the middle of the code\"\n\n* just have one (not two) empty line before and after the new piece of doc",
    "created_at": "2019-04-30T06:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384778",
    "user": "https://github.com/fchapoton"
}
```

Looks better,

* you forgot to remove the "doc in the middle of the code"

* just have one (not two) empty line before and after the new piece of doc



---

archive/issue_comments_384779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T10:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384780.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384780",
    "user": "https://github.com/embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_events_068452.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27562#event-68452"
}
```



---

archive/issue_comments_384781.json:
```json
{
    "body": "Minor doctest formatting fixes made. Also made a change to the string formatting of ValueError on line 489 exactly analogous to the ticket.\n\n---\nNew commits:",
    "created_at": "2019-07-16T22:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384781",
    "user": "https://github.com/NebulousOinkler"
}
```

Minor doctest formatting fixes made. Also made a change to the string formatting of ValueError on line 489 exactly analogous to the ticket.

---
New commits:



---

archive/issue_comments_384782.json:
```json
{
    "body": "The removal of ellipses looks strange. Any over traceback in doctests is using `...` \n\nMaybe they were just wrongly indented ?",
    "created_at": "2019-07-17T10:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384782",
    "user": "https://github.com/fchapoton"
}
```

The removal of ellipses looks strange. Any over traceback in doctests is using `...` 

Maybe they were just wrongly indented ?



---

archive/issue_comments_384783.json:
```json
{
    "body": "Replying to [comment:21 chapoton]:\n> Maybe they were just wrongly indented ?\n\n\nYes, that was an issue. I'll return the ellipses to be in line with other doctests.",
    "created_at": "2019-07-17T14:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384783",
    "user": "https://github.com/NebulousOinkler"
}
```

Replying to [comment:21 chapoton]:
> Maybe they were just wrongly indented ?


Yes, that was an issue. I'll return the ellipses to be in line with other doctests.



---

archive/issue_comments_384784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-17T14:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384785.json:
```json
{
    "body": "I have moved the ellipses to the correct place, and then squashed the commits into a single commit: the result is the new branch.\n\nI am setting to positive review.\n\n---\nNew commits:",
    "created_at": "2019-07-18T07:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384785",
    "user": "https://github.com/fchapoton"
}
```

I have moved the ellipses to the correct place, and then squashed the commits into a single commit: the result is the new branch.

I am setting to positive review.

---
New commits:



---

archive/issue_comments_384786.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-18T07:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384786",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384787.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-23T21:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27562#issuecomment-384787",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068453.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-23T21:03:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27562",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27562#event-68453"
}
```
