# Issue 27695: Produce consistent graph6 and dig6 strings in python3

archive/issues_027458.json:
```json
{
    "assignees": [],
    "body": "Currently given a `Graph` (or a `DiGraph`) `G` its graph6 (or dig6)\nrepresentation is produced via the auxiliary method `sage.graphs.generic_graph.GenericGraph._bit_vector`. This method converts vertices to integers from `range(n)` and then produces a binary string recording (directed) edges. The conversion is done basically via `enumerate(self)`. \n\nSuppose that `G` has already vertices labelled by `range(n)`. Then in Python 2 the\nabove conversion does nothing and the correspondence\nposition_in_the_resulting_string --- edges_of_`G` depends uniquely on `n`.\nOn the contrary, since in Python 3 dictionaries are read in insertion order, the\ncorrespondence depends heavily on the way in which `G` is created.\n\nThis makes the resulting string unreliable\n\n```\nsage: dg = DiGraph([(0,1,1)])\nsage: dg.relabel({0:1,1:0})\nsage: DiGraph(dg.dig6_string()) == dg # Python 3\nFalse\nsage: DiGraph(dg.dig6_string()) == dg # Python 2\nTrue\n```\nand creates several doctes failures in `sage.combinat.cluster_algebra_quiver`.\nThis ticket proposes two alternative solutions to this problem.\n\nSolution 1: replace `enumerate(self)` by `enumerate(sorted(self))` in\n`_bit_vector`. This keeps the current behaviour at the price of a (small?)\nslowdown.\n\nSolution 2: enforce the fact that graph6 and dig6 representations make sense\nonly for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.) Then use this directly to access vertices.\n\nTo put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort. \n\n\nCC:  @dcoudert @fchapoton\n\nKeywords: **python3**\n\nBranch/Commit: **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**\n\nReviewer: **Salvatore Stella**\n\nAuthor: **David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27695_\n\n",
    "closed_at": "2019-04-27T17:43:58Z",
    "created_at": "2019-04-17T19:31:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Produce consistent graph6 and dig6 strings in python3",
    "type": "issue",
    "updated_at": "2019-04-27T17:43:58Z",
    "url": "https://github.com/sagemath/sage/issues/27695",
    "user": "https://github.com/etn40ff"
}
```
Currently given a `Graph` (or a `DiGraph`) `G` its graph6 (or dig6)
representation is produced via the auxiliary method `sage.graphs.generic_graph.GenericGraph._bit_vector`. This method converts vertices to integers from `range(n)` and then produces a binary string recording (directed) edges. The conversion is done basically via `enumerate(self)`. 

Suppose that `G` has already vertices labelled by `range(n)`. Then in Python 2 the
above conversion does nothing and the correspondence
position_in_the_resulting_string --- edges_of_`G` depends uniquely on `n`.
On the contrary, since in Python 3 dictionaries are read in insertion order, the
correspondence depends heavily on the way in which `G` is created.

This makes the resulting string unreliable

```
sage: dg = DiGraph([(0,1,1)])
sage: dg.relabel({0:1,1:0})
sage: DiGraph(dg.dig6_string()) == dg # Python 3
False
sage: DiGraph(dg.dig6_string()) == dg # Python 2
True
```
and creates several doctes failures in `sage.combinat.cluster_algebra_quiver`.
This ticket proposes two alternative solutions to this problem.

Solution 1: replace `enumerate(self)` by `enumerate(sorted(self))` in
`_bit_vector`. This keeps the current behaviour at the price of a (small?)
slowdown.

Solution 2: enforce the fact that graph6 and dig6 representations make sense
only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.) Then use this directly to access vertices.

To put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort. 


CC:  @dcoudert @fchapoton

Keywords: **python3**

Branch/Commit: **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**

Reviewer: **Salvatore Stella**

Author: **David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/27695_





---

archive/issue_events_380010.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-17T19:31:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380010"
}
```



---

archive/issue_events_380011.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-17T19:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380011"
}
```



---

archive/issue_events_380012.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-17T19:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380012"
}
```



---

archive/issue_events_380013.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-17T19:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380013"
}
```



---

archive/issue_comments_429399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,7 +25,7 @@\n slowdown.\n \n Solution 2: enforce the fact that graph6 and dig6 representations make sense\n-only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.)\n+only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.) Then use this directly to access vertices.\n \n To put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort. \n \n``````\n",
    "created_at": "2019-04-17T19:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429399",
    "user": "https://github.com/etn40ff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,7 +25,7 @@
 slowdown.
 
 Solution 2: enforce the fact that graph6 and dig6 representations make sense
-only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.)
+only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.) Then use this directly to access vertices.
 
 To put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort. 
 
``````




---

archive/issue_comments_429400.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nConsider the following example with Python2 and Solution 1 (i.e., using `enumerate(sorted(self))`). You get:\n\n```\nsage: G = graphs.RandomTree(20)\nsage: G.graph6_string()\n'S??W??@???o??o@A?O?AG?CG??@_?A??W'\nsage: V = G.vertices()\nsage: shuffle(V)\nsage: G.relabel(perm=V, inplace=True)\nsage: G.graph6_string()\n'So??g??AA??GH???G??_Aa??@o?C???G?'\n```\nThe graph6 string depends on the way vertices are labeled and so cannot be used to check isomorphisms, unless you ask for the graph6 string of a canonical form.\n\nSo what should be done is:\n- fix `canonical_form` for Python3 (#27571)\n- rewrite `cluster_algebra_quiver` to properly check isomorphisms, that is using `canonical_form` and not graph6 string",
    "created_at": "2019-04-18T07:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429400",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:2" align="right">comment:2</div>

Consider the following example with Python2 and Solution 1 (i.e., using `enumerate(sorted(self))`). You get:

```
sage: G = graphs.RandomTree(20)
sage: G.graph6_string()
'S??W??@???o??o@A?O?AG?CG??@_?A??W'
sage: V = G.vertices()
sage: shuffle(V)
sage: G.relabel(perm=V, inplace=True)
sage: G.graph6_string()
'So??g??AA??GH???G??_Aa??@o?C???G?'
```
The graph6 string depends on the way vertices are labeled and so cannot be used to check isomorphisms, unless you ask for the graph6 string of a canonical form.

So what should be done is:
- fix `canonical_form` for Python3 (#27571)
- rewrite `cluster_algebra_quiver` to properly check isomorphisms, that is using `canonical_form` and not graph6 string



---

archive/issue_comments_429401.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI agree that graph6 can't be used to compare arbitrary graphs. Indeed what `cluster_algebra_seed` does is to compute first a \"canonical form\" using some in-house logic rather then using `canonical_form`. I do not know why it was implemented in this way and I am not willing to spend much time fixing this code since I consider it just a step above being deprecated.\n\nHaving said this, I think that the issue with ordered vertices and `_bit_vector` is somewhat orthogonal to the implementation of `canonical_form`. What I mean here is that there should be a way to reconstruct any (di)graph with vertices `range(n)` out of its string encoding and this can only be done if bits in the string encoding have a clear bijection to vertices of the graph. Both solutions I proposed achieve this.",
    "created_at": "2019-04-18T08:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429401",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:3" align="right">comment:3</div>

I agree that graph6 can't be used to compare arbitrary graphs. Indeed what `cluster_algebra_seed` does is to compute first a "canonical form" using some in-house logic rather then using `canonical_form`. I do not know why it was implemented in this way and I am not willing to spend much time fixing this code since I consider it just a step above being deprecated.

Having said this, I think that the issue with ordered vertices and `_bit_vector` is somewhat orthogonal to the implementation of `canonical_form`. What I mean here is that there should be a way to reconstruct any (di)graph with vertices `range(n)` out of its string encoding and this can only be done if bits in the string encoding have a clear bijection to vertices of the graph. Both solutions I proposed achieve this.



---

archive/issue_comments_429402.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYou are confusing the labeling of the vertices and the canonical labels. \nIn the example of #comment:2, the vertices are labeled in [0..n-1], but we get different bit vectors.\n\nNow, if you take the canonical form, you get in Python2 with the current release of Sage:\n\n```\nsage: G = graphs.RandomTree(20)\nsage: G.graph6_string()\n'S?GG?A?GK??G????GO?O???G?IC_APA??'\nsage: V = G.vertices()\nsage: shuffle(V)\nsage: H = G.relabel(perm=V, inplace=False)\nsage: H.graph6_string()\n'SGAA?_???@?@?AQOG????C?A?_??`_P??'\nsage: G.canonical_label().graph6_string()\n'S???????C?GC?A?C???@_K?CK?_?E?E@C'\nsage: H.canonical_label().graph6_string()\n'S???????C?GC?A?C???@_K?CK?_?E?E@C'\n```\nThis is however not working in Python3 as `canonical_label` must be fixed.",
    "created_at": "2019-04-18T09:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429402",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

You are confusing the labeling of the vertices and the canonical labels. 
In the example of #comment:2, the vertices are labeled in [0..n-1], but we get different bit vectors.

Now, if you take the canonical form, you get in Python2 with the current release of Sage:

```
sage: G = graphs.RandomTree(20)
sage: G.graph6_string()
'S?GG?A?GK??G????GO?O???G?IC_APA??'
sage: V = G.vertices()
sage: shuffle(V)
sage: H = G.relabel(perm=V, inplace=False)
sage: H.graph6_string()
'SGAA?_???@?@?AQOG????C?A?_??`_P??'
sage: G.canonical_label().graph6_string()
'S???????C?GC?A?C???@_K?CK?_?E?E@C'
sage: H.canonical_label().graph6_string()
'S???????C?GC?A?C???@_K?CK?_?E?E@C'
```
This is however not working in Python3 as `canonical_label` must be fixed.



---

archive/issue_comments_429403.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNo, I am not making this confusion but I am probably not explaining my point clearly enough. Let me try again.\n\nIn #comment:2 you build two *isomorphic* graphs both labelled by `range(n)` and  `graph6_string` gives different encodings. This is, I think, the correct behaviour.\n\nWhat I am saying is that in Python 3 if you take two copies of the *same* graph built differently you get different encodings. And this in not the correct behaviour.\n\nHere is an example (it is a bit convoluted because I need to force a different ordering of vertices in `H`):\n\n```\nsage: G = DiGraph()\nsage: G.add_vertices([0,1])\nsage: G.add_edge((0,1,'a'))\n\nsage: H = DiGraph()\nsage: H.add_vertices([1,0])\nsage: H.relabel({0:1,1:0})\nsage: H.add_edge((0,1,'a'))\n\nsage: H == G\nTrue\n\nsage: G.dig6_string() == H.dig6_string()\t# Python 2\nTrue\n\nsage: G.dig6_string() == H.dig6_string()\t# Python 3\nFalse\n```\n\nThis issue has nothing to do with `canonical_label`.",
    "created_at": "2019-04-18T10:48:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429403",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:5" align="right">comment:5</div>

No, I am not making this confusion but I am probably not explaining my point clearly enough. Let me try again.

In #comment:2 you build two *isomorphic* graphs both labelled by `range(n)` and  `graph6_string` gives different encodings. This is, I think, the correct behaviour.

What I am saying is that in Python 3 if you take two copies of the *same* graph built differently you get different encodings. And this in not the correct behaviour.

Here is an example (it is a bit convoluted because I need to force a different ordering of vertices in `H`):

```
sage: G = DiGraph()
sage: G.add_vertices([0,1])
sage: G.add_edge((0,1,'a'))

sage: H = DiGraph()
sage: H.add_vertices([1,0])
sage: H.relabel({0:1,1:0})
sage: H.add_edge((0,1,'a'))

sage: H == G
True

sage: G.dig6_string() == H.dig6_string()	# Python 2
True

sage: G.dig6_string() == H.dig6_string()	# Python 3
False
```

This issue has nothing to do with `canonical_label`.



---

archive/issue_comments_429404.json:
```json
{
    "body": "Reviewer: **Salvatore Stella**",
    "created_at": "2019-04-21T09:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429404",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **Salvatore Stella**



---

archive/issue_comments_429405.json:
```json
{
    "body": "Commit: **[`d2985e1`](https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533)**",
    "created_at": "2019-04-21T09:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429405",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`d2985e1`](https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533)**



---

archive/issue_comments_429406.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis will do what you ask for. On the way, it fixes the problems with the Petersen family generator (#26800).\n\nI'm wondering if we should add a specific doctest and what to put in. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533\">d2985e1</a></td><td><code>trac #27695: try to sort vertices in _bit_vector</code></td></tr></table>\n",
    "created_at": "2019-04-21T09:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429406",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

This will do what you ask for. On the way, it fixes the problems with the Petersen family generator (#26800).

I'm wondering if we should add a specific doctest and what to put in. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533">d2985e1</a></td><td><code>trac #27695: try to sort vertices in _bit_vector</code></td></tr></table>




---

archive/issue_comments_429407.json:
```json
{
    "body": "Branch: **[public/graphs/27695_bit_vector](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27695_bit_vector)**",
    "created_at": "2019-04-21T09:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429407",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/graphs/27695_bit_vector](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27695_bit_vector)**



---

archive/issue_comments_429408.json:
```json
{
    "body": "Changed author from **Salvatore Stella** to **David Coudert**",
    "created_at": "2019-04-21T09:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429408",
    "user": "https://github.com/dcoudert"
}
```

Changed author from **Salvatore Stella** to **David Coudert**



---

archive/issue_events_380014.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-04-21T09:04:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380014"
}
```



---

archive/issue_comments_429409.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe pyflakes error reported by the patchbot is fixed in #27628.",
    "created_at": "2019-04-21T15:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429409",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

The pyflakes error reported by the patchbot is fixed in #27628.



---

archive/issue_comments_429410.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe\">d3d37fa</a></td><td><code>Added a test for 27695</code></td></tr></table>\n",
    "created_at": "2019-04-21T19:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429410",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe">d3d37fa</a></td><td><code>Added a test for 27695</code></td></tr></table>




---

archive/issue_comments_429411.json:
```json
{
    "body": "Changed commit from **[`d2985e1`](https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533)** to **[`d3d37fa`](https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe)**",
    "created_at": "2019-04-21T19:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429411",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2985e1`](https://github.com/sagemath/sagetrac-mirror/commit/d2985e1a05a889dbd5badae7949ca78655a17533)** to **[`d3d37fa`](https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe)**



---

archive/issue_comments_429412.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nLooks good to me. I added a test but it is only meaningful in python 3.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe\">d3d37fa</a></td><td><code>Added a test for 27695</code></td></tr></table>\n",
    "created_at": "2019-04-21T19:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429412",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:9" align="right">comment:9</div>

Looks good to me. I added a test but it is only meaningful in python 3.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe">d3d37fa</a></td><td><code>Added a test for 27695</code></td></tr></table>




---

archive/issue_comments_429413.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467\">11e95f7</a></td><td><code>trac #27695: add another doctest</code></td></tr></table>\n",
    "created_at": "2019-04-22T07:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429413",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467">11e95f7</a></td><td><code>trac #27695: add another doctest</code></td></tr></table>




---

archive/issue_comments_429414.json:
```json
{
    "body": "Changed commit from **[`d3d37fa`](https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe)** to **[`11e95f7`](https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467)**",
    "created_at": "2019-04-22T07:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429414",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d3d37fa`](https://github.com/sagemath/sagetrac-mirror/commit/d3d37fa361192b2206a41fed9564424d7d3a2ffe)** to **[`11e95f7`](https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467)**



---

archive/issue_comments_429415.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAn extra doctest to show that #26800 is also fixed.\nFill free to finalize the review.",
    "created_at": "2019-04-22T07:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429415",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:11" align="right">comment:11</div>

An extra doctest to show that #26800 is also fixed.
Fill free to finalize the review.



---

archive/issue_comments_429416.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996\">1db9f00</a></td><td><code>Wrong string in test?</code></td></tr></table>\n",
    "created_at": "2019-04-22T16:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429416",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996">1db9f00</a></td><td><code>Wrong string in test?</code></td></tr></table>




---

archive/issue_comments_429417.json:
```json
{
    "body": "Changed commit from **[`11e95f7`](https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467)** to **[`1db9f00`](https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996)**",
    "created_at": "2019-04-22T16:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429417",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`11e95f7`](https://github.com/sagemath/sagetrac-mirror/commit/11e95f70d4a68aed26e89504c5f142bba3207467)** to **[`1db9f00`](https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996)**



---

archive/issue_comments_429418.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIt looks to me that the _bit_string in the added test was wrong. I changed it.\nIf you agree on this change the ticket is good for me.",
    "created_at": "2019-04-22T16:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429418",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:13" align="right">comment:13</div>

It looks to me that the _bit_string in the added test was wrong. I changed it.
If you agree on this change the ticket is good for me.



---

archive/issue_comments_429419.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere is an inconsistency in between the results of the patchbot and my laptop concerning the above-mentioned bit string. I am recompiling sage just to make sure there is no problem on my side.",
    "created_at": "2019-04-22T18:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429419",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:14" align="right">comment:14</div>

There is an inconsistency in between the results of the patchbot and my laptop concerning the above-mentioned bit string. I am recompiling sage just to make sure there is no problem on my side.



---

archive/issue_comments_429420.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have the same result than the patchbot (and it was in my commit).\nIf you have something different, we must find the cause.",
    "created_at": "2019-04-22T20:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429420",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

I have the same result than the patchbot (and it was in my commit).
If you have something different, we must find the cause.



---

archive/issue_comments_429421.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI can confirm that something is very wrong here. I compiled a fresh version on a different machine (with a similar undelying linux version for the record) and I get\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.8.beta3, Release Date: 2019-04-18               \u2502\n\u2502 Using Python 2.7.15. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n'001100001111000000011010100110100011'\n```\n\nI am waiting for sage with python3 to compile just to make sure it is the same there as well.",
    "created_at": "2019-04-22T20:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429421",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:16" align="right">comment:16</div>

I can confirm that something is very wrong here. I compiled a fresh version on a different machine (with a similar undelying linux version for the record) and I get

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.8.beta3, Release Date: 2019-04-18               │
│ Using Python 2.7.15. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
'001100001111000000011010100110100011'
```

I am waiting for sage with python3 to compile just to make sure it is the same there as well.



---

archive/issue_comments_429422.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe results are in and indeed I get the same result with python 3:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.8.beta3, Release Date: 2019-04-18               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n....: \n'001100001111000000011010100110100011'\n```\n\nCould you please check that we get the same output from `canonical_label`? with both versions of Python I have:\n\n```\nsage: P.canonical_label().edges()\n[(0, 3, None),\n (0, 5, None),\n (0, 8, None),\n (1, 2, None),\n (1, 5, None),\n (1, 7, None),\n (2, 4, None),\n (2, 8, None),\n (3, 4, None),\n (3, 7, None),\n (4, 6, None),\n (5, 6, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n```",
    "created_at": "2019-04-22T20:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429422",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:17" align="right">comment:17</div>

The results are in and indeed I get the same result with python 3:

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.8.beta3, Release Date: 2019-04-18               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
....: 
'001100001111000000011010100110100011'
```

Could you please check that we get the same output from `canonical_label`? with both versions of Python I have:

```
sage: P.canonical_label().edges()
[(0, 3, None),
 (0, 5, None),
 (0, 8, None),
 (1, 2, None),
 (1, 5, None),
 (1, 7, None),
 (2, 4, None),
 (2, 8, None),
 (3, 4, None),
 (3, 7, None),
 (4, 6, None),
 (5, 6, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
```



---

archive/issue_comments_429423.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOupsss, I know, I have bliss... and canonical_label uses bliss by default if installed.\n\nI get with Python 2 and 3:\n\n```\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n....: P.canonical_label().edges()\n....: \n'011010100000011100100010010100100111'\n[(0, 2, None),\n (0, 4, None),\n (0, 6, None),\n (1, 2, None),\n (1, 3, None),\n (1, 7, None),\n (2, 8, None),\n (3, 5, None),\n (3, 6, None),\n (4, 5, None),\n (4, 7, None),\n (5, 8, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n....: P.canonical_label(algorithm='sage')._bit_vector()\n....: P.canonical_label(algorithm='sage').edges()\n'001100001111000000011010100110100011'\nsage: P.canonical_label(algorithm='sage').edges()\n[(0, 3, None),\n (0, 5, None),\n (0, 8, None),\n (1, 2, None),\n (1, 5, None),\n (1, 7, None),\n (2, 4, None),\n (2, 8, None),\n (3, 4, None),\n (3, 7, None),\n (4, 6, None),\n (5, 6, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n```\nSo we must add `algorithm='sage'` to the doctest.\n\nNote that there is no error here with the canonical label. It is not unique and depends on the algorithm. It might become more consistent with #27571.",
    "created_at": "2019-04-22T21:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429423",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:18" align="right">comment:18</div>

Oupsss, I know, I have bliss... and canonical_label uses bliss by default if installed.

I get with Python 2 and 3:

```
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
....: P.canonical_label().edges()
....: 
'011010100000011100100010010100100111'
[(0, 2, None),
 (0, 4, None),
 (0, 6, None),
 (1, 2, None),
 (1, 3, None),
 (1, 7, None),
 (2, 8, None),
 (3, 5, None),
 (3, 6, None),
 (4, 5, None),
 (4, 7, None),
 (5, 8, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
....: P.canonical_label(algorithm='sage')._bit_vector()
....: P.canonical_label(algorithm='sage').edges()
'001100001111000000011010100110100011'
sage: P.canonical_label(algorithm='sage').edges()
[(0, 3, None),
 (0, 5, None),
 (0, 8, None),
 (1, 2, None),
 (1, 5, None),
 (1, 7, None),
 (2, 4, None),
 (2, 8, None),
 (3, 4, None),
 (3, 7, None),
 (4, 6, None),
 (5, 6, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
```
So we must add `algorithm='sage'` to the doctest.

Note that there is no error here with the canonical label. It is not unique and depends on the algorithm. It might become more consistent with #27571.



---

archive/issue_comments_429424.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nFor me with Python 2 on OS X:\n\n```\n$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n001100001111000000011010100110100011\n```\nWith Python 3:\n\n```\n$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n101101100011000010010001011000010110\n```\nMaybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.",
    "created_at": "2019-04-22T21:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429424",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

For me with Python 2 on OS X:

```
$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
001100001111000000011010100110100011
```
With Python 3:

```
$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
101101100011000010010001011000010110
```
Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.



---

archive/issue_comments_429425.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDumb question: do you have this patch applied in python 3?\n\nReplying to [@jhpalmieri](#comment:19):\n> For me with Python 2 on OS X:\n> \n> ```\n> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n> 001100001111000000011010100110100011\n> ```\n> With Python 3:\n> \n> ```\n> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n> 101101100011000010010001011000010110\n> ```\n> Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.",
    "created_at": "2019-04-22T21:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429425",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:20" align="right">comment:20</div>

Dumb question: do you have this patch applied in python 3?

Replying to [@jhpalmieri](#comment:19):
> For me with Python 2 on OS X:
> 
> ```
> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
> 001100001111000000011010100110100011
> ```
> With Python 3:
> 
> ```
> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
> 101101100011000010010001011000010110
> ```
> Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.



---

archive/issue_comments_429426.json:
```json
{
    "body": "Changed commit from **[`1db9f00`](https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996)** to **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**",
    "created_at": "2019-04-22T21:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429426",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1db9f00`](https://github.com/sagemath/sagetrac-mirror/commit/1db9f00f31b24cdbe06352ff6e97ecaa0bd76996)** to **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**



---

archive/issue_comments_429427.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394\">5147873</a></td><td><code>trac #27695: force the algorithm when calling canonical_label</code></td></tr></table>\n",
    "created_at": "2019-04-22T21:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429427",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394">5147873</a></td><td><code>trac #27695: force the algorithm when calling canonical_label</code></td></tr></table>




---

archive/issue_comments_429428.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI added the algorithm to use in the doctest. We should now all get the same result.",
    "created_at": "2019-04-22T21:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429428",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

I added the algorithm to use in the doctest. We should now all get the same result.



---

archive/issue_comments_429429.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNot a dumb question, I just lost my mind there for a bit. I'm back now. It looks good to me. (There are doctest failures with Python 3 for `generic_graph.py`, but I get the same ones with or without this branch, so at least this isn't creating more failures in that file. With this branch, doctests improve somewhat for `combinat/cluster_algebra_quiver/`: 10 total failures in 2 files instead of 19 failures in 3 files.)",
    "created_at": "2019-04-22T23:05:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429429",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

Not a dumb question, I just lost my mind there for a bit. I'm back now. It looks good to me. (There are doctest failures with Python 3 for `generic_graph.py`, but I get the same ones with or without this branch, so at least this isn't creating more failures in that file. With this branch, doctests improve somewhat for `combinat/cluster_algebra_quiver/`: 10 total failures in 2 files instead of 19 failures in 3 files.)



---

archive/issue_events_380015.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-23T07:59:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380015"
}
```



---

archive/issue_events_380016.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2019-04-23T07:59:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380016"
}
```



---

archive/issue_comments_429430.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nLGTM\n\n`@`[jhpalmieri](#comment:9) Thanks for checking, \"fixing\" cluster_algebra_seed is where this patch came from.",
    "created_at": "2019-04-23T07:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429430",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:24" align="right">comment:24</div>

LGTM

`@`[jhpalmieri](#comment:9) Thanks for checking, "fixing" cluster_algebra_seed is where this patch came from.



---

archive/issue_events_380017.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-27T17:43:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380017"
}
```



---

archive/issue_events_380018.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "756aa054ad431df2f2db7b5362d6f6c025061d45",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-04-27T17:43:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27695#event-380018"
}
```



---

archive/issue_comments_429431.json:
```json
{
    "body": "Changed branch from **[public/graphs/27695_bit_vector](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27695_bit_vector)** to **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**",
    "created_at": "2019-04-27T17:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27695#issuecomment-429431",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/27695_bit_vector](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/27695_bit_vector)** to **[`5147873`](https://github.com/sagemath/sagetrac-mirror/commit/5147873b85bd94e1eb77da5c575aa0c1b430e394)**
