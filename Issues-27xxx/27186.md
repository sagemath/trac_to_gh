# Issue 27186: spkg-configure.m4 for libpng

archive/issues_026949.json:
```json
{
    "assignees": [],
    "body": "Also should be done for #27168\n\nNote libpng comes in a number of different ABI versions, usually indicated in the library filename as a suffix like \"12\" (for 1.2.x) up through \"16\" (for 1.6.x), where 16 is the most current and currently supported by Sage.  Distros like Debian has separate packages for each libpng ABI version.\n\nI think to keep it simple we should specifically check for and require libpng16.  I don't know if all of Sage's dependencies support older libpngs.\n\nconfigure tarball: https://trac.sagemath.org/raw-attachment/ticket/27186/configure-318.tar.gz\n\nCC:  @kiwifb\n\nKeywords: **spkg-configure**\n\nBranch: **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27186_\n\n",
    "closed_at": "2019-05-21T12:15:55Z",
    "created_at": "2019-01-31T14:10:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spkg-configure.m4 for libpng",
    "type": "issue",
    "updated_at": "2019-11-22T00:05:16Z",
    "url": "https://github.com/sagemath/sage/issues/27186",
    "user": "https://github.com/embray"
}
```
Also should be done for #27168

Note libpng comes in a number of different ABI versions, usually indicated in the library filename as a suffix like "12" (for 1.2.x) up through "16" (for 1.6.x), where 16 is the most current and currently supported by Sage.  Distros like Debian has separate packages for each libpng ABI version.

I think to keep it simple we should specifically check for and require libpng16.  I don't know if all of Sage's dependencies support older libpngs.

configure tarball: https://trac.sagemath.org/raw-attachment/ticket/27186/configure-318.tar.gz

CC:  @kiwifb

Keywords: **spkg-configure**

Branch: **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**

Reviewer: **Fran√ßois Bissey**

Author: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/27186_





---

archive/issue_events_355349.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-31T14:10:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355349"
}
```



---

archive/issue_events_355350.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-31T14:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355350"
}
```



---

archive/issue_events_355351.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-31T14:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355351"
}
```



---

archive/issue_events_355352.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-31T14:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355352"
}
```



---

archive/issue_comments_422377.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThat said, my Ubuntu build machine has a kinda old libpng12, and while I'm not saying we *should* support that, I'm curious to see if it will work...",
    "created_at": "2019-01-31T14:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422377",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">Comment 1</div>

That said, my Ubuntu build machine has a kinda old libpng12, and while I'm not saying we *should* support that, I'm curious to see if it will work...



---

archive/issue_comments_422378.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAlso, we should probably not use the system libpng at all on OSX (unless in homebrew or something, but I don't know if we explicitly support that yet...)",
    "created_at": "2019-01-31T14:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422378",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">Comment 2</div>

Also, we should probably not use the system libpng at all on OSX (unless in homebrew or something, but I don't know if we explicitly support that yet...)



---

archive/issue_comments_422379.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nWhat's wrong with OSX's system libpng?",
    "created_at": "2019-01-31T14:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422379",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">Comment 3</div>

What's wrong with OSX's system libpng?



---

archive/issue_comments_422380.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nIt's unusable.  See the SPKG.txt for libpng.",
    "created_at": "2019-01-31T14:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422380",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">Comment 4</div>

It's unusable.  See the SPKG.txt for libpng.



---

archive/issue_comments_422381.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nOkay, at least on my Ubuntu 14.04 machine libpng 1.2 worked just fine actually.  Did a full `make ptestlong` from scratch.  Nothing complained.  So maybe we can afford a bit more flexibility here.",
    "created_at": "2019-01-31T16:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422381",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">Comment 5</div>

Okay, at least on my Ubuntu 14.04 machine libpng 1.2 worked just fine actually.  Did a full `make ptestlong` from scratch.  Nothing complained.  So maybe we can afford a bit more flexibility here.



---

archive/issue_comments_422382.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@embray](#comment%3A4):\n> It's unusable.  See the SPKG.txt for libpng.\n\nI don't read it this way. I read it as \"it won't conflict with the one built by Sage\".\nWell, maybe I am wrong - it's perhaps worth trying on OSX.",
    "created_at": "2019-01-31T16:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422382",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@embray](#comment%3A4):
> It's unusable.  See the SPKG.txt for libpng.

I don't read it this way. I read it as "it won't conflict with the one built by Sage".
Well, maybe I am wrong - it's perhaps worth trying on OSX.



---

archive/issue_comments_422383.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI think you are misreading.  The point is that if you just blindly link `-lpng` on OSX without an alternative libpng on the linker path you'll get the `libPng.dylib` used by the system which is not compatible with anything we build that wants to link with libpng.\n\nOne workaround is to explicitly ask for one of the ABI-specific names like `-lpng12` or `-lpng16`, at least on OSX.  That way you might be able to pick up, say, a version from homebrew, but you won't accidentally link to the unusable OSX system lib.",
    "created_at": "2019-01-31T16:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422383",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">Comment 7</div>

I think you are misreading.  The point is that if you just blindly link `-lpng` on OSX without an alternative libpng on the linker path you'll get the `libPng.dylib` used by the system which is not compatible with anything we build that wants to link with libpng.

One workaround is to explicitly ask for one of the ABI-specific names like `-lpng12` or `-lpng16`, at least on OSX.  That way you might be able to pick up, say, a version from homebrew, but you won't accidentally link to the unusable OSX system lib.



---

archive/issue_comments_422384.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nAlthough I may also be misreading some too.  ISTM the libPng.dylib on OSX only comes from the ImageIO framework, whatever that is, so I don't know if it on the linker path by default in the first place.  The problem is just that we can't use the SONAME (or whatever the OSX equivalent is) of libpng when linking modules in our own packages because then it will conflict with anything that uses the ImageIO framework.  This goes to show how little I understand about OSX.",
    "created_at": "2019-01-31T16:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422384",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">Comment 8</div>

Although I may also be misreading some too.  ISTM the libPng.dylib on OSX only comes from the ImageIO framework, whatever that is, so I don't know if it on the linker path by default in the first place.  The problem is just that we can't use the SONAME (or whatever the OSX equivalent is) of libpng when linking modules in our own packages because then it will conflict with anything that uses the ImageIO framework.  This goes to show how little I understand about OSX.



---

archive/issue_comments_422385.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@embray](#comment%3A8):\n> Although I may also be misreading some too.  ISTM the libPng.dylib on OSX only comes from the ImageIO framework, whatever that is, so I don't know if it on the linker path by default in the first place.  The problem is just that we can't use the SONAME (or whatever the OSX equivalent is) of libpng when linking modules in our own packages because then it will conflict with anything that uses the ImageIO framework.  This goes to show how little I understand about OSX.\n\nThis still sounds as if using system's libPng would lead to various library conflicts (with other Sage-installed versions of stuff also available on the system), i.e. if we go far enough with our plan it would not matter...\n\nAnyhow, I just checked that Homebrew also does not use system's libPng, but installs its own libpng16.dylib.\n\nOne way or another, I think we should not block the usage of Homebrew (or conda) libs, i.e. there should not be a rule saying \"we're on OSX! install from source\").\n\nPS. Last time I checked (few months ago), it's possible to build and run Sage under Homebrew. Basically, it's an environment where lots of stuff lives in /usr/local...",
    "created_at": "2019-01-31T17:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422385",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@embray](#comment%3A8):
> Although I may also be misreading some too.  ISTM the libPng.dylib on OSX only comes from the ImageIO framework, whatever that is, so I don't know if it on the linker path by default in the first place.  The problem is just that we can't use the SONAME (or whatever the OSX equivalent is) of libpng when linking modules in our own packages because then it will conflict with anything that uses the ImageIO framework.  This goes to show how little I understand about OSX.

This still sounds as if using system's libPng would lead to various library conflicts (with other Sage-installed versions of stuff also available on the system), i.e. if we go far enough with our plan it would not matter...

Anyhow, I just checked that Homebrew also does not use system's libPng, but installs its own libpng16.dylib.

One way or another, I think we should not block the usage of Homebrew (or conda) libs, i.e. there should not be a rule saying "we're on OSX! install from source").

PS. Last time I checked (few months ago), it's possible to build and run Sage under Homebrew. Basically, it's an environment where lots of stuff lives in /usr/local...



---

archive/issue_comments_422386.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nVolker's OSX buildbot also has a libpng16 that lives in the `/opt/X11` prefix, but I don't think that's a normal thing to have...  OSX doesn't normally have an X installed, does it?",
    "created_at": "2019-01-31T17:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422386",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">Comment 10</div>

Volker's OSX buildbot also has a libpng16 that lives in the `/opt/X11` prefix, but I don't think that's a normal thing to have...  OSX doesn't normally have an X installed, does it?



---

archive/issue_comments_422387.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@embray](#comment%3A10):\n> Volker's OSX buildbot also has a libpng16 that lives in the `/opt/X11` prefix, but I don't think that's a normal thing to have...  OSX doesn't normally have an X installed, does it?\n\nNot since 2010 or so, I guess :-)",
    "created_at": "2019-01-31T17:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422387",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@embray](#comment%3A10):
> Volker's OSX buildbot also has a libpng16 that lives in the `/opt/X11` prefix, but I don't think that's a normal thing to have...  OSX doesn't normally have an X installed, does it?

Not since 2010 or so, I guess :-)



---

archive/issue_comments_422388.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nthe following works:\n\n```bash\nSAGE_SPKG_CONFIGURE([libpng], [\n    dnl First try checking for libpng with pkg-config\n    PKG_CHECK_MODULES([LIBPNG], [libpng16], [], [\n        dnl Fallback to manually grubbing around for headers and libs\n        AC_CHECK_HEADERS([libpng16/png.h], [sage_spkg_install_libpng=no; break], [sage_spkg_install_libpng=yes])\n        AC_SEARCH_LIBS([png_get_io_ptr], [libpng16], [], [sage_spkg_install_libpng=yes])\n    ])\n])\n```",
    "created_at": "2019-02-09T00:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422388",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">Comment 12</div>

the following works:

```bash
SAGE_SPKG_CONFIGURE([libpng], [
    dnl First try checking for libpng with pkg-config
    PKG_CHECK_MODULES([LIBPNG], [libpng16], [], [
        dnl Fallback to manually grubbing around for headers and libs
        AC_CHECK_HEADERS([libpng16/png.h], [sage_spkg_install_libpng=no; break], [sage_spkg_install_libpng=yes])
        AC_SEARCH_LIBS([png_get_io_ptr], [libpng16], [], [sage_spkg_install_libpng=yes])
    ])
])
```



---

archive/issue_comments_422389.json:
```json
{
    "body": "Changed keywords from **** to **spkg-configure**",
    "created_at": "2019-02-12T09:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422389",
    "user": "https://github.com/dimpase"
}
```

Changed keywords from **** to **spkg-configure**



---

archive/issue_comments_422390.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nI found that there is no reason to require libpng16 specifically (unless I'm wrong / there is some optional package I'm missing that requires a newer version)?\n\nI was thinking we might do something pretty similar to this, but instead of *just* `libpng16` we would check first for `libpng16`, and if not found try `libpng14`, then `libpng12`, and then just plain `libpng` (except on macOS where that conflicts with the system's incompatible \"libPng\").",
    "created_at": "2019-02-12T10:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422390",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">Comment 14</div>

I found that there is no reason to require libpng16 specifically (unless I'm wrong / there is some optional package I'm missing that requires a newer version)?

I was thinking we might do something pretty similar to this, but instead of *just* `libpng16` we would check first for `libpng16`, and if not found try `libpng14`, then `libpng12`, and then just plain `libpng` (except on macOS where that conflicts with the system's incompatible "libPng").



---

archive/issue_comments_422391.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nIf that overcomplicates things though, the above is fine.  libpng just tends to be problematic, so I thought it would be good to be flexible in which versions we accept so long as there is no explicit need for 1.6.",
    "created_at": "2019-02-12T10:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422391",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">Comment 15</div>

If that overcomplicates things though, the above is fine.  libpng just tends to be problematic, so I thought it would be good to be flexible in which versions we accept so long as there is no explicit need for 1.6.



---

archive/issue_comments_422392.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nin `build/pkgs/tachyon/patches/Make-config.patch` you see\n\n```\n+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng16 -lz\n-#PNGLIB= -L/usr/local/lib -lpng -lz\n```\nIt suggests that libpng16 is needed.",
    "created_at": "2019-02-12T10:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422392",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

in `build/pkgs/tachyon/patches/Make-config.patch` you see

```
+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng16 -lz
-#PNGLIB= -L/usr/local/lib -lpng -lz
```
It suggests that libpng16 is needed.



---

archive/issue_comments_422393.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nI don't think so: This patch was made because the libpng package in Sage delete the normal `libpng.so -> libpng16.so` symlink that is installed, specifically so as to not conflict with the macOS \"libPng\", but in turn that means that if you compile tachyon in Sage you have to specify `-lpng16`, since `-lpng` does not exist in Sage's lib directory.\n\nI don't think it has to be libpng16 specifically; that patch just specifies `-lpng16` because that's what's in Sage.  I was able to replace this with `-lpng12` and it worked fine.",
    "created_at": "2019-02-12T10:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422393",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">Comment 17</div>

I don't think so: This patch was made because the libpng package in Sage delete the normal `libpng.so -> libpng16.so` symlink that is installed, specifically so as to not conflict with the macOS "libPng", but in turn that means that if you compile tachyon in Sage you have to specify `-lpng16`, since `-lpng` does not exist in Sage's lib directory.

I don't think it has to be libpng16 specifically; that patch just specifies `-lpng16` because that's what's in Sage.  I was able to replace this with `-lpng12` and it worked fine.



---

archive/issue_comments_422394.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nRemoving most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422394",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">Comment 18</div>

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.



---

archive/issue_events_355353.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355353"
}
```



---

archive/issue_events_355354.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355354"
}
```



---

archive/issue_comments_422395.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI looked a bit into OSX libPng, and I see no trace of it on OSX 10.14.\nSo it's probably quite obsolete into in libpng's SPKG.",
    "created_at": "2019-04-14T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422395",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">Comment 19</div>

I looked a bit into OSX libPng, and I see no trace of it on OSX 10.14.
So it's probably quite obsolete into in libpng's SPKG.



---

archive/issue_comments_422396.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-04-15T07:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422396",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_355355.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-15T07:33:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355355"
}
```



---

archive/issue_events_355356.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-15T07:33:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355356"
}
```



---

archive/issue_comments_422397.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/png-config](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/png-config)**",
    "created_at": "2019-04-15T07:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422397",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/png-config](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/png-config)**



---

archive/issue_comments_422398.json:
```json
{
    "body": "Commit: **[590b383](https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6)**",
    "created_at": "2019-04-15T07:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422398",
    "user": "https://github.com/dimpase"
}
```

Commit: **[590b383](https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6)**



---

archive/issue_comments_422399.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6\">590b383</a></td><td><code>spkg-configure for libpng</code></td></tr></table>\n",
    "created_at": "2019-04-15T07:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422399",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">Comment 20</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6">590b383</a></td><td><code>spkg-configure for libpng</code></td></tr></table>




---

archive/issue_comments_422400.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI need to re-review this, but I'm okay with just throwing my hands up and saying to hell with OSX.  If there *is* still an issue we'll find out, and now that we have `--without-system-libpng` at least there's a workaround in place.",
    "created_at": "2019-04-15T16:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422400",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">Comment 21</div>

I need to re-review this, but I'm okay with just throwing my hands up and saying to hell with OSX.  If there *is* still an issue we'll find out, and now that we have `--without-system-libpng` at least there's a workaround in place.



---

archive/issue_comments_422401.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI think Apple's library won't be known to pkg-config, and then AC_SEARCH_LIBS would filter it out. Anyhow it's probably only some post-EOL OSX versions that might potentially be problematic...",
    "created_at": "2019-04-15T18:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422401",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">Comment 22</div>

I think Apple's library won't be known to pkg-config, and then AC_SEARCH_LIBS would filter it out. Anyhow it's probably only some post-EOL OSX versions that might potentially be problematic...



---

archive/issue_comments_422402.json:
```json
{
    "body": "Changed commit from **[590b383](https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6)** to **[cce4eef](https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88)**",
    "created_at": "2019-04-15T20:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422402",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[590b383](https://github.com/sagemath/sagetrac-mirror/commit/590b3833197f436d1e6fec95916d32527e373ec6)** to **[cce4eef](https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88)**



---

archive/issue_comments_422403.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88\">cce4eef</a></td><td><code>spkg-configure for libpng</code></td></tr></table>\n",
    "created_at": "2019-04-15T20:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422403",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23" align="right">Comment 23</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88">cce4eef</a></td><td><code>spkg-configure for libpng</code></td></tr></table>




---

archive/issue_events_355357.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-15T20:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355357"
}
```



---

archive/issue_comments_422404.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9\">4e9fca1</a></td><td><code>spkg-configure for libpng</code></td></tr></table>\n",
    "created_at": "2019-04-15T20:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422404",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25" align="right">Comment 25</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9">4e9fca1</a></td><td><code>spkg-configure for libpng</code></td></tr></table>




---

archive/issue_comments_422405.json:
```json
{
    "body": "Changed commit from **[cce4eef](https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88)** to **[4e9fca1](https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9)**",
    "created_at": "2019-04-15T20:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422405",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cce4eef](https://github.com/sagemath/sagetrac-mirror/commit/cce4eef79a3e6f40f45d385ea754ad50f9d2de88)** to **[4e9fca1](https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9)**



---

archive/issue_comments_422406.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nwe also need to check that zlib, the dependency, comes from the system.",
    "created_at": "2019-04-15T20:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422406",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">Comment 26</div>

we also need to check that zlib, the dependency, comes from the system.



---

archive/issue_comments_422407.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nbut zlib does not need to satisfy the requirements for Sages's libpng.",
    "created_at": "2019-04-16T08:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422407",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">Comment 27</div>

but zlib does not need to satisfy the requirements for Sages's libpng.



---

archive/issue_events_355358.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-16T08:16:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355358"
}
```



---

archive/issue_events_355359.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-16T08:16:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355359"
}
```



---

archive/issue_comments_422408.json:
```json
{
    "body": "Changed commit from **[4e9fca1](https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9)** to **[2f5aaa7](https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48)**",
    "created_at": "2019-04-16T16:32:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422408",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4e9fca1](https://github.com/sagemath/sagetrac-mirror/commit/4e9fca1dd163c19116521bffce526f57162b35a9)** to **[2f5aaa7](https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48)**



---

archive/issue_comments_422409.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d20b81b518d505c95d4e70b289b9147409bfdbf0\">d20b81b</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48\">2f5aaa7</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr></table>\n",
    "created_at": "2019-04-16T16:32:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422409",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28" align="right">Comment 28</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d20b81b518d505c95d4e70b289b9147409bfdbf0">d20b81b</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48">2f5aaa7</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr></table>




---

archive/issue_events_355360.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-16T16:34:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355360"
}
```



---

archive/issue_events_355361.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-16T16:34:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355361"
}
```



---

archive/issue_comments_422410.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nnow we do not try to check for unneeded new functionality in zlib for older libpng's",
    "created_at": "2019-04-16T16:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422410",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">Comment 29</div>

now we do not try to check for unneeded new functionality in zlib for older libpng's



---

archive/issue_comments_422411.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4d89709cd432fa048fa5bb978943ceedfd4c8ca\">f4d8970</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5fa38e5cf37358667af98562983919664e07503\">f5fa38e</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716\">1e8b1a2</a></td><td><code>bumped up configure spkg</code></td></tr></table>\n",
    "created_at": "2019-04-19T11:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422411",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30" align="right">Comment 30</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4d89709cd432fa048fa5bb978943ceedfd4c8ca">f4d8970</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5fa38e5cf37358667af98562983919664e07503">f5fa38e</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716">1e8b1a2</a></td><td><code>bumped up configure spkg</code></td></tr></table>




---

archive/issue_comments_422412.json:
```json
{
    "body": "Changed commit from **[2f5aaa7](https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48)** to **[1e8b1a2](https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716)**",
    "created_at": "2019-04-19T11:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422412",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2f5aaa7](https://github.com/sagemath/sagetrac-mirror/commit/2f5aaa77a5e880069733d2dbd4db9b3b696f6e48)** to **[1e8b1a2](https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716)**



---

archive/issue_comments_422413.json:
```json
{
    "body": "updated configure spkg",
    "created_at": "2019-04-19T11:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422413",
    "user": "https://github.com/dimpase"
}
```

updated configure spkg



---

archive/issue_comments_422414.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nAttachment: **[configure-318.tar.gz](https://github.com/sagemath/sage/files/ticket27186/configure-318.tar.gz)**",
    "created_at": "2019-04-19T11:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422414",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">Comment 31</div>

Attachment: **[configure-318.tar.gz](https://github.com/sagemath/sage/files/ticket27186/configure-318.tar.gz)**



---

archive/issue_comments_422415.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n Note libpng comes in a number of different ABI versions, usually indicated in the library filename as a suffix like \"12\" (for 1.2.x) up through \"16\" (for 1.6.x), where 16 is the most current and currently supported by Sage.  Distros like Debian has separate packages for each libpng ABI version.\n \n I think to keep it simple we should specifically check for and require libpng16.  I don't know if all of Sage's dependencies support older libpngs.\n+\n+configure tarball: https://trac.sagemath.org/raw-attachment/ticket/27186/configure-318.tar.gz\n``````\n",
    "created_at": "2019-04-19T11:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422415",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 Note libpng comes in a number of different ABI versions, usually indicated in the library filename as a suffix like "12" (for 1.2.x) up through "16" (for 1.6.x), where 16 is the most current and currently supported by Sage.  Distros like Debian has separate packages for each libpng ABI version.
 
 I think to keep it simple we should specifically check for and require libpng16.  I don't know if all of Sage's dependencies support older libpngs.
+
+configure tarball: https://trac.sagemath.org/raw-attachment/ticket/27186/configure-318.tar.gz
``````




---

archive/issue_comments_422416.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nI guess should have #27265 as a dependency?",
    "created_at": "2019-04-19T16:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422416",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">Comment 32</div>

I guess should have #27265 as a dependency?



---

archive/issue_comments_422417.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nno, why? neither is a dependency of the other.",
    "created_at": "2019-04-19T16:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422417",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">Comment 33</div>

no, why? neither is a dependency of the other.



---

archive/issue_comments_422418.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nbut there is the bloody mess with configure package versions I am complaining about, sure.",
    "created_at": "2019-04-19T16:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422418",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">Comment 34</div>

but there is the bloody mess with configure package versions I am complaining about, sure.



---

archive/issue_comments_422419.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nonce you start depending on generated stuff, it's like crack ;-)",
    "created_at": "2019-04-19T16:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422419",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:35" align="right">Comment 35</div>

once you start depending on generated stuff, it's like crack ;-)



---

archive/issue_comments_422420.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\n\\\\\nWell, this branch contains the diff:\n\n```diff\ndiff --git a/build/pkgs/configure/package-version.txt b/build/pkgs/configure/package-version.txt\nindex 4dab36b..dda3451 100644\n--- a/build/pkgs/configure/package-version.txt\n+++ b/build/pkgs/configure/package-version.txt\n@@ -1 +1 @@\n-317\n+318\n```\n\nwhich to make sense I thought would need #27265, which supplies configure-317.",
    "created_at": "2019-04-19T16:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422420",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">Comment 36</div>

\\
Well, this branch contains the diff:

```diff
diff --git a/build/pkgs/configure/package-version.txt b/build/pkgs/configure/package-version.txt
index 4dab36b..dda3451 100644
--- a/build/pkgs/configure/package-version.txt
+++ b/build/pkgs/configure/package-version.txt
@@ -1 +1 @@
-317
+318
```

which to make sense I thought would need #27265, which supplies configure-317.



---

archive/issue_comments_422421.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nwell, one has no control over version numbers of configure spkg. for different branches they may clash, be unrelated, etc.",
    "created_at": "2019-04-19T17:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422421",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">Comment 37</div>

well, one has no control over version numbers of configure spkg. for different branches they may clash, be unrelated, etc.



---

archive/issue_comments_422422.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nFor that reason, if nothing else, maybe we should do like I suggested elsewhere and combine several of these together into a single ticket (once we're satisfied that they work individually).",
    "created_at": "2019-04-24T14:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422422",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">Comment 38</div>

For that reason, if nothing else, maybe we should do like I suggested elsewhere and combine several of these together into a single ticket (once we're satisfied that they work individually).



---

archive/issue_comments_422423.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nsure, I'm all for it - but we need more of these actually positively reviewed ;-)",
    "created_at": "2019-04-24T15:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422423",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:39" align="right">Comment 39</div>

sure, I'm all for it - but we need more of these actually positively reviewed ;-)



---

archive/issue_comments_422424.json:
```json
{
    "body": "Changed commit from **[1e8b1a2](https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716)** to **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**",
    "created_at": "2019-05-13T13:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422424",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1e8b1a2](https://github.com/sagemath/sagetrac-mirror/commit/1e8b1a23a0316eb3d34e7c7a80fc6b95f054d716)** to **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**



---

archive/issue_comments_422425.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6e554f8755a08140b67ccad28f72d5c30d1d207\">a6e554f</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc\">adc901c</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr></table>\n",
    "created_at": "2019-05-13T13:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422425",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40" align="right">Comment 40</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6e554f8755a08140b67ccad28f72d5c30d1d207">a6e554f</a></td><td><code>spkg-configure for libpng</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc">adc901c</a></td><td><code>don't check unneeded requirements for system libpng</code></td></tr></table>




---

archive/issue_comments_422426.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nremoved configure bump and rebased over 8.8.beta5 for the ease of reviewing.",
    "created_at": "2019-05-13T13:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422426",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:41" align="right">Comment 41</div>

removed configure bump and rebased over 8.8.beta5 for the ease of reviewing.



---

archive/issue_comments_422427.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2019-05-15T08:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422427",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_events_355362.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-05-15T08:22:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355362"
}
```



---

archive/issue_events_355363.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2019-05-15T08:22:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355363"
}
```



---

archive/issue_comments_422428.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nPart of series of ticket.",
    "created_at": "2019-05-15T08:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422428",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">Comment 42</div>

Part of series of ticket.



---

archive/issue_comments_422429.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nPlease merge together with #27825",
    "created_at": "2019-05-15T08:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422429",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">Comment 43</div>

Please merge together with #27825



---

archive/issue_comments_422430.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nI think the zlib <-> libpng stuff here could still be improved. First, trivia; this should be quoted to avoid syntax errors if the variable has a space in it:\n\n```\nif test x$sage_spkg_install_zlib = xyes; then\n```\n\nNow, the only reason we're checking for `inflateValidate` in zlib is for the benefit of libpng, correct? Because the only place `inflateValidate` is used in our copy of libpng is the following, in `pngrutil.c`:\n\n```\n#if ZLIB_VERNUM >= 0x1290 && \\\n   defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)\n      if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)\n         /* Turn off validation of the ADLER32 checksum in IDAT chunks */\n         ret = inflateValidate(&png_ptr->zstream, 0);\n#endif\n```\n\nIt's wrapped in a zlib version check, so... does anything bad happen if we simply ignore the matter? That is, drop the `inflateValidate` check from the zlib macro, and eliminate the libpng <-> zlib weirdness as a bonus?",
    "created_at": "2019-05-15T15:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422430",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:44" align="right">Comment 44</div>

I think the zlib <-> libpng stuff here could still be improved. First, trivia; this should be quoted to avoid syntax errors if the variable has a space in it:

```
if test x$sage_spkg_install_zlib = xyes; then
```

Now, the only reason we're checking for `inflateValidate` in zlib is for the benefit of libpng, correct? Because the only place `inflateValidate` is used in our copy of libpng is the following, in `pngrutil.c`:

```
#if ZLIB_VERNUM >= 0x1290 && \
   defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)
      if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)
         /* Turn off validation of the ADLER32 checksum in IDAT chunks */
         ret = inflateValidate(&png_ptr->zstream, 0);
#endif
```

It's wrapped in a zlib version check, so... does anything bad happen if we simply ignore the matter? That is, drop the `inflateValidate` check from the zlib macro, and eliminate the libpng <-> zlib weirdness as a bonus?



---

archive/issue_comments_422431.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@orlitzky](#comment%3A44):\n> I think the zlib <-> libpng stuff here could still be improved. First, trivia; this should be quoted to avoid syntax errors if the variable has a space in it:\n> \n> ```\n> if test x$sage_spkg_install_zlib = xyes; then\n> ```\n> \n\n`sage_spkg_install_zlib` is an internal, taking a controlled set of values.\n(`yes`, `no`, `''`, I suppose)\n\n\n> Now, the only reason we're checking for `inflateValidate` in zlib is for the benefit of libpng, correct? Because the only place `inflateValidate` is used in our copy of libpng is the following, in `pngrutil.c`:\n> \n> ```\n> #if ZLIB_VERNUM >= 0x1290 && \\\n>    defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)\n>       if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)\n>          /* Turn off validation of the ADLER32 checksum in IDAT chunks */\n>          ret = inflateValidate(&png_ptr->zstream, 0);\n> #endif\n> ```\n> \n> It's wrapped in a zlib version check, so... does anything bad happen if we simply ignore the matter? That is, drop the `inflateValidate` check from the zlib macro, and eliminate the libpng <-> zlib weirdness as a bonus?\n\n\nWe only check for `inflateValidate` in system's zlib if we cannot use the system's libpng. In this case we need it, as Sage's libpng requires it. This allows us to get away with using older versions of system's libpng/zlib, which are perfectly fine for our purposes.\n\nPS. I think it's a good example of how vendoring of everything leads to a relentless upgrading spiral (cause a vendored version gets broken on one particular system, or due to conflicts with system libraries that happens for one or another reason...)",
    "created_at": "2019-05-15T15:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422431",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@orlitzky](#comment%3A44):
> I think the zlib <-> libpng stuff here could still be improved. First, trivia; this should be quoted to avoid syntax errors if the variable has a space in it:
> 
> ```
> if test x$sage_spkg_install_zlib = xyes; then
> ```
> 

`sage_spkg_install_zlib` is an internal, taking a controlled set of values.
(`yes`, `no`, `''`, I suppose)


> Now, the only reason we're checking for `inflateValidate` in zlib is for the benefit of libpng, correct? Because the only place `inflateValidate` is used in our copy of libpng is the following, in `pngrutil.c`:
> 
> ```
> #if ZLIB_VERNUM >= 0x1290 && \
>    defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)
>       if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)
>          /* Turn off validation of the ADLER32 checksum in IDAT chunks */
>          ret = inflateValidate(&png_ptr->zstream, 0);
> #endif
> ```
> 
> It's wrapped in a zlib version check, so... does anything bad happen if we simply ignore the matter? That is, drop the `inflateValidate` check from the zlib macro, and eliminate the libpng <-> zlib weirdness as a bonus?


We only check for `inflateValidate` in system's zlib if we cannot use the system's libpng. In this case we need it, as Sage's libpng requires it. This allows us to get away with using older versions of system's libpng/zlib, which are perfectly fine for our purposes.

PS. I think it's a good example of how vendoring of everything leads to a relentless upgrading spiral (cause a vendored version gets broken on one particular system, or due to conflicts with system libraries that happens for one or another reason...)



---

archive/issue_comments_422432.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@dimpase](#comment%3A45):\n> We only check for `inflateValidate` in system's zlib if we cannot use the system's libpng. In this case we need it, as Sage's libpng requires it.\n\nBut are you sure? This code is taken *from sage's libpng*:\n\n```\n#if ZLIB_VERNUM >= 0x1290 && \\\n   defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)\n      if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)\n         /* Turn off validation of the ADLER32 checksum in IDAT chunks */\n         ret = inflateValidate(&png_ptr->zstream, 0);\n#endif\n```\n\nand that's the only occurrence of \"inflateValidate\" in the libpng source code. Since that whole block will be ignored for old zlib, I don't think we actually need `inflateValidate` for our libpng.\n\n(inflateValidate was introduced in zlib commit 9852c209 on 2016-09-20, and ZLIB_VERNUM was set to 0x1290 in commit 2fa463bacf on 2016-12-31, so the check above in libpng should work)",
    "created_at": "2019-05-15T15:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422432",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@dimpase](#comment%3A45):
> We only check for `inflateValidate` in system's zlib if we cannot use the system's libpng. In this case we need it, as Sage's libpng requires it.

But are you sure? This code is taken *from sage's libpng*:

```
#if ZLIB_VERNUM >= 0x1290 && \
   defined(PNG_SET_OPTION_SUPPORTED) && defined(PNG_IGNORE_ADLER32)
      if (((png_ptr->options >> PNG_IGNORE_ADLER32) & 3) == PNG_OPTION_ON)
         /* Turn off validation of the ADLER32 checksum in IDAT chunks */
         ret = inflateValidate(&png_ptr->zstream, 0);
#endif
```

and that's the only occurrence of "inflateValidate" in the libpng source code. Since that whole block will be ignored for old zlib, I don't think we actually need `inflateValidate` for our libpng.

(inflateValidate was introduced in zlib commit 9852c209 on 2016-09-20, and ZLIB_VERNUM was set to 0x1290 in commit 2fa463bacf on 2016-12-31, so the check above in libpng should work)



---

archive/issue_comments_422433.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nOh, I see what you're saying now, thanks.\n\nWell, assuming there is one and only zlib, so that  ZLIB_VERNUM correctly identifies the presence of `inflateValidate`, and assuming that a future libpng will not drop this version test for some reason, this test can be dropped.",
    "created_at": "2019-05-15T15:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422433",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:47" align="right">Comment 47</div>

Oh, I see what you're saying now, thanks.

Well, assuming there is one and only zlib, so that  ZLIB_VERNUM correctly identifies the presence of `inflateValidate`, and assuming that a future libpng will not drop this version test for some reason, this test can be dropped.



---

archive/issue_events_355364.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-21T12:15:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355364"
}
```



---

archive/issue_events_355365.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3e1cf317f4d9d8f10d4ac4785619830a07dd56b3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-05-21T12:15:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27186#event-355365"
}
```



---

archive/issue_comments_422434.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/png-config](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/png-config)** to **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**",
    "created_at": "2019-05-21T12:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422434",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/packages/png-config](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/png-config)** to **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)**



---

archive/issue_comments_422435.json:
```json
{
    "body": "Changed commit from **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)** to none",
    "created_at": "2019-07-05T07:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422435",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Changed commit from **[adc901c](https://github.com/sagemath/sagetrac-mirror/commit/adc901cdcb4ae4850a9dcc4a009add6c569903fc)** to none



---

archive/issue_comments_422436.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nLet me point that there is an issue with `inflateValidate` in #27319.",
    "created_at": "2019-07-05T07:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422436",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:49" align="right">Comment 49</div>

Let me point that there is an issue with `inflateValidate` in #27319.



---

archive/issue_comments_422437.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nIt appears to me that this does not work for tachyon. In tachyon's `Make-config.patch`, we do the following:\n\n```\n-USEPNG=\n-PNGINC=\n-PNGLIB=\n+USEPNG= -DUSEPNG\n+PNGINC= -I$(SAGE_LOCAL)/include\n+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng -lz\n```\n\nThis won't work if libpng's headers have not been installed to `$SAGE_LOCAL`. See [#28745 comment:33](https://github.com/sagemath/sage/issues/28745#comment:33).",
    "created_at": "2019-11-21T23:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422437",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:50" align="right">Comment 50</div>

It appears to me that this does not work for tachyon. In tachyon's `Make-config.patch`, we do the following:

```
-USEPNG=
-PNGINC=
-PNGLIB=
+USEPNG= -DUSEPNG
+PNGINC= -I$(SAGE_LOCAL)/include
+PNGLIB= -L$(SAGE_LOCAL)/lib -lpng -lz
```

This won't work if libpng's headers have not been installed to `$SAGE_LOCAL`. See [#28745 comment:33](https://github.com/sagemath/sage/issues/28745#comment:33).



---

archive/issue_comments_422438.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nIt appears that tachyon is ignoring the CFLAGS that were used when ./configure ran.",
    "created_at": "2019-11-21T23:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422438",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:51" align="right">Comment 51</div>

It appears that tachyon is ignoring the CFLAGS that were used when ./configure ran.



---

archive/issue_comments_422439.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nwhat is \u201cnot working\u201d? it certainly is possible to use system libpng everywhere in sage.\ntachyon had to be patched a bit more, iirc, to allow this.\n\n---\nAll I did I  changed `-lpng16` to `-lpng` in `a6e554f8755`\nto accommodate variations in versions. Note that indeed if libpng is not in the default linker path, i.e. a specific `-L` argument must be supplied, then one might need to patch more...\n\nBut otherwise it works, e.g. I have\n\n```\n$ ldd local/bin/tachyon \n\tlinux-vdso.so.1 (0x00007ffc721f4000)\n\tlibpng16.so.16 => /usr/lib64/libpng16.so.16 (0x00007f0c0a62e000)\n\tlibz.so.1 => /lib64/libz.so.1 (0x00007f0c0a610000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f0c0a4d3000)\n\tlibmvec.so.1 => /lib64/libmvec.so.1 (0x00007f0c0a4a7000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f0c0a484000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f0c0a2b4000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f0c0a716000)\n```\non Gentoo",
    "created_at": "2019-11-21T23:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422439",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">Comment 52</div>

what is ‚Äúnot working‚Äù? it certainly is possible to use system libpng everywhere in sage.
tachyon had to be patched a bit more, iirc, to allow this.

---
All I did I  changed `-lpng16` to `-lpng` in `a6e554f8755`
to accommodate variations in versions. Note that indeed if libpng is not in the default linker path, i.e. a specific `-L` argument must be supplied, then one might need to patch more...

But otherwise it works, e.g. I have

```
$ ldd local/bin/tachyon 
	linux-vdso.so.1 (0x00007ffc721f4000)
	libpng16.so.16 => /usr/lib64/libpng16.so.16 (0x00007f0c0a62e000)
	libz.so.1 => /lib64/libz.so.1 (0x00007f0c0a610000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f0c0a4d3000)
	libmvec.so.1 => /lib64/libmvec.so.1 (0x00007f0c0a4a7000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f0c0a484000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f0c0a2b4000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f0c0a716000)
```
on Gentoo



---

archive/issue_comments_422440.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nReplying to [@saraedum](#comment%3A51):\n> It appears that tachyon is ignoring the CFLAGS that were used when ./configure ran.\n\nright. It's quite a mess indeed.",
    "created_at": "2019-11-22T00:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27186",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27186#issuecomment-422440",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:53" align="right">Comment 53</div>

Replying to [@saraedum](#comment%3A51):
> It appears that tachyon is ignoring the CFLAGS that were used when ./configure ran.

right. It's quite a mess indeed.
