# Issue 27495: Use sphinx.ext.extlinks to add Sphinx roles for links to external package docs

archive/issues_027258.json:
```json
{
    "assignees": [],
    "body": "We wish to link to external packages' documentation:\n- if the package documentation is installed locally in the Sage distribution, using the file link \n- in downstream packaging, using a file link appropriate for the doc installation scheme of the system (without having to patch the documentation)\n- if it is not available locally, using an http link to an online version of the package's documentation.\n\nTo this end, we use the [sphinx.ext.extlinks](https://www.sphinx-doc.org/en/master/usage/extensions/extlinks.html) facility, for which we already have infrastructure in `sage.misc.sagedoc`, assigning a Sphinx role to every external document.\n\nWe use a systematic naming scheme for these roles: `:spkg_SPKG_DOC:` where `DOC` is usually just `doc` but if a package has several manuals, it can be used to distinguish them.\n\nIn this ticket, we do this for the documents covered by a previous iteration of this ticket:\n* `:spkg_gc_doc:` `GC garbage collector <@SAGE_SHARE@/doc/gc/overview.html>`_\n* `:spkg_giac_doc:` `Giac/Xcas documentation <@SAGE_SHARE@/doc/giac/index.html>`_ https://www-fourier.ujf-grenoble.fr/~parisse/giac/doc/en/cascmd_en/cascmd_en.html\n* `:spkg_ppl_doc:` `PPL User manual <@SAGE_SHARE@/doc/ppl/ppl-user-1.2-html/index.html>`_  https://www.bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/index.html\n* `:spkg_pplpy_doc:` `Python Wrapper for PPL (pplpy) <@SAGE_SHARE@/doc/pplpy/index.html>`_\n* `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm\n* `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html\n\nThe location of some of the locally installed documentation files can be determined at runtime, see [#27495 comment:58](https://github.com/sagemath/sage/issues/27495#comment:58) for maxima.\nThis should probably go through `sage.feature`.\n\nRelated:\n- #29231 add intersphinx mapping for SciPy\n- https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ\n- #29868 pip-installable packages `sagemath-doc-src`, `sagemath-doc-inventory`, `sagemath-doc-html`, `sagemath-doc-pdf`\n\n\nCC:  @tobihan @kcrisman @kiwifb @embray @haraldschilly @mkoeppe @antonio-rojas @mwageringel @videlec\n\nKeywords: **sd111**\n\nComponent: **documentation**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27495_\n\n",
    "created_at": "2019-03-15T15:01:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use sphinx.ext.extlinks to add Sphinx roles for links to external package docs",
    "type": "issue",
    "updated_at": "2022-08-31T02:51:13Z",
    "url": "https://github.com/sagemath/sage/issues/27495",
    "user": "https://github.com/dimpase"
}
```
We wish to link to external packages' documentation:
- if the package documentation is installed locally in the Sage distribution, using the file link 
- in downstream packaging, using a file link appropriate for the doc installation scheme of the system (without having to patch the documentation)
- if it is not available locally, using an http link to an online version of the package's documentation.

To this end, we use the [sphinx.ext.extlinks](https://www.sphinx-doc.org/en/master/usage/extensions/extlinks.html) facility, for which we already have infrastructure in `sage.misc.sagedoc`, assigning a Sphinx role to every external document.

We use a systematic naming scheme for these roles: `:spkg_SPKG_DOC:` where `DOC` is usually just `doc` but if a package has several manuals, it can be used to distinguish them.

In this ticket, we do this for the documents covered by a previous iteration of this ticket:
* `:spkg_gc_doc:` `GC garbage collector <@SAGE_SHARE@/doc/gc/overview.html>`_
* `:spkg_giac_doc:` `Giac/Xcas documentation <@SAGE_SHARE@/doc/giac/index.html>`_ https://www-fourier.ujf-grenoble.fr/~parisse/giac/doc/en/cascmd_en/cascmd_en.html
* `:spkg_ppl_doc:` `PPL User manual <@SAGE_SHARE@/doc/ppl/ppl-user-1.2-html/index.html>`_  https://www.bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/index.html
* `:spkg_pplpy_doc:` `Python Wrapper for PPL (pplpy) <@SAGE_SHARE@/doc/pplpy/index.html>`_
* `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm
* `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html

The location of some of the locally installed documentation files can be determined at runtime, see [#27495 comment:58](https://github.com/sagemath/sage/issues/27495#comment:58) for maxima.
This should probably go through `sage.feature`.

Related:
- #29231 add intersphinx mapping for SciPy
- https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ
- #29868 pip-installable packages `sagemath-doc-src`, `sagemath-doc-inventory`, `sagemath-doc-html`, `sagemath-doc-pdf`


CC:  @tobihan @kcrisman @kiwifb @embray @haraldschilly @mkoeppe @antonio-rojas @mwageringel @videlec

Keywords: **sd111**

Component: **documentation**

_Issue created by migration from https://trac.sagemath.org/ticket/27495_





---

archive/issue_events_379414.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-15T15:01:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379414"
}
```



---

archive/issue_events_379415.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-15T15:01:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379415"
}
```



---

archive/issue_events_379416.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-15T15:01:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379416"
}
```



---

archive/issue_events_379417.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-15T15:01:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379417"
}
```



---

archive/issue_comments_425557.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-It is possible to provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.\n+To provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.\n \n-Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, so we probably will need to have `index.rst.in` filled in by configure.\n+Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.\n+\n+\n``````\n",
    "created_at": "2019-03-16T09:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425557",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-It is possible to provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.
+To provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.
 
-Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, so we probably will need to have `index.rst.in` filled in by configure.
+Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.
+
+
``````




---

archive/issue_comments_425558.json:
```json
{
    "body": "Commit: **[`f82a7c2`](https://github.com/sagemath/sagetrac-mirror/commit/f82a7c2d22d69c7cf575fa987afb0a1d059338d8)**",
    "created_at": "2019-03-16T09:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425558",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`f82a7c2`](https://github.com/sagemath/sagetrac-mirror/commit/f82a7c2d22d69c7cf575fa987afb0a1d059338d8)**



---

archive/issue_comments_425559.json:
```json
{
    "body": "Branch: **[u/dimpase/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/doc/docrefs)**",
    "created_at": "2019-03-16T09:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425559",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/doc/docrefs)**



---

archive/issue_events_379418.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-16T09:08:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379418"
}
```



---

archive/issue_events_379419.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-16T09:08:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379419"
}
```



---

archive/issue_comments_425560.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-03-16T09:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425560",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_425561.json:
```json
{
    "body": "Changed commit from **[`f82a7c2`](https://github.com/sagemath/sagetrac-mirror/commit/f82a7c2d22d69c7cf575fa987afb0a1d059338d8)** to **[`13c2fd5`](https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04)**",
    "created_at": "2019-03-16T09:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425561",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f82a7c2`](https://github.com/sagemath/sagetrac-mirror/commit/f82a7c2d22d69c7cf575fa987afb0a1d059338d8)** to **[`13c2fd5`](https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04)**



---

archive/issue_comments_425562.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04\"><code>13c2fd5</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr></table>\n",
    "created_at": "2019-03-16T09:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04"><code>13c2fd5</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr></table>




---

archive/issue_comments_425563.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI don't know why it has taken so long to get started with this, to link together all these loose spkg docs in SAGE_LOCAL - something one might not even notice otherwise.\n\nAt least now SageNB docs are nicely linked - and available as HTML, in particular this will be there on the website, I suppose.\n\nLet's get it in quickly, and add more on a followup ticket.",
    "created_at": "2019-03-16T09:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425563",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

I don't know why it has taken so long to get started with this, to link together all these loose spkg docs in SAGE_LOCAL - something one might not even notice otherwise.

At least now SageNB docs are nicely linked - and available as HTML, in particular this will be there on the website, I suppose.

Let's get it in quickly, and add more on a followup ticket.



---

archive/issue_events_379420.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-16T09:30:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379420"
}
```



---

archive/issue_comments_425564.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNice intentions I guess. From the point of view of sage in isolation it looks ok.\n\nI don't use configure in sage-on-gentoo, so I would rather want something that applies from `setup.py`. Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon. But that's not easily fixable without you guys deciding on a standard and applying it across the board. We can wait a few more years before getting there.",
    "created_at": "2019-03-16T09:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425564",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Nice intentions I guess. From the point of view of sage in isolation it looks ok.

I don't use configure in sage-on-gentoo, so I would rather want something that applies from `setup.py`. Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon. But that's not easily fixable without you guys deciding on a standard and applying it across the board. We can wait a few more years before getting there.



---

archive/issue_comments_425565.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5\"><code>85299a3</code></a></td><td><code>linking pplpy docs</code></td></tr></table>\n",
    "created_at": "2019-03-17T00:16:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425565",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5"><code>85299a3</code></a></td><td><code>linking pplpy docs</code></td></tr></table>




---

archive/issue_comments_425566.json:
```json
{
    "body": "Changed commit from **[`13c2fd5`](https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04)** to **[`85299a3`](https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5)**",
    "created_at": "2019-03-17T00:16:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425566",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`13c2fd5`](https://github.com/sagemath/sagetrac-mirror/commit/13c2fd55fad6df1f31126d0fd0fa06d64ee84e04)** to **[`85299a3`](https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5)**



---

archive/issue_comments_425567.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt seems to be a tall order to harmonise naming schemes and locations for docs of all the Sage packages. \n\nI'd rather take what each package provides and in spkg-configure.m4 record this location into a variable (perhaps if the package is not built, but a system version used, then no doc link needs to be generated at all).\n\nAnother important reason for having this is that authors of external packages sometimes are annoyed by Sage incorporating their work silently. This showing/linking of docs will make it less silent...",
    "created_at": "2019-03-17T00:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425567",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

It seems to be a tall order to harmonise naming schemes and locations for docs of all the Sage packages. 

I'd rather take what each package provides and in spkg-configure.m4 record this location into a variable (perhaps if the package is not built, but a system version used, then no doc link needs to be generated at all).

Another important reason for having this is that authors of external packages sometimes are annoyed by Sage incorporating their work silently. This showing/linking of docs will make it less silent...



---

archive/issue_comments_425568.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAs fbissey said, what about doing this with Python instead of `configure`? Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.\n\nOr if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.",
    "created_at": "2019-03-17T01:16:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425568",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

As fbissey said, what about doing this with Python instead of `configure`? Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.

Or if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.



---

archive/issue_comments_425569.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jhpalmieri](#comment:7):\n> As fbissey said, what about doing this with Python instead of `configure`? \n\nWhy? What's wrong with doing it at configuration time?\nShould we redo the whole Sage building process with Python only? :-)\n\nMind you, Python does not have tools for this, autoconf does, as you see.\n\n> Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.\n> \n> Or if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.",
    "created_at": "2019-03-17T08:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425569",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jhpalmieri](#comment:7):
> As fbissey said, what about doing this with Python instead of `configure`? 

Why? What's wrong with doing it at configuration time?
Should we redo the whole Sage building process with Python only? :-)

Mind you, Python does not have tools for this, autoconf does, as you see.

> Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.
> 
> Or if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.



---

archive/issue_comments_425570.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@dimpase](#comment:8):\n> Replying to [@jhpalmieri](#comment:7):\n> > As fbissey said, what about doing this with Python instead of `configure`? \n\n> \n> Why? What's wrong with doing it at configuration time?\n> Should we redo the whole Sage building process with Python only? :-)\n> \n\nThat, you see, is the result of conflating \"sage the distribution\" with \"sage the software\". A confusion made easier by the fact that sage the software is not distributed as a proper package like the rest of its dependencies. The top configure is really mostly for sage the distribution and mingling the top level configure to stuff in sage the software means that you are not wanting sage the software to be pip installable ever.\n\n> Mind you, Python does not have tools for this, autoconf does, as you see.\n> \n> > Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.\n> > \n> > Or if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.\n\nYes I am aware that what you are thinking of is easy with autotools but not trivial with python. But sometimes doing the easy stuff is just painting yourself in a corner in the long run.",
    "created_at": "2019-03-17T08:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425570",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@dimpase](#comment:8):
> Replying to [@jhpalmieri](#comment:7):
> > As fbissey said, what about doing this with Python instead of `configure`? 

> 
> Why? What's wrong with doing it at configuration time?
> Should we redo the whole Sage building process with Python only? :-)
> 

That, you see, is the result of conflating "sage the distribution" with "sage the software". A confusion made easier by the fact that sage the software is not distributed as a proper package like the rest of its dependencies. The top configure is really mostly for sage the distribution and mingling the top level configure to stuff in sage the software means that you are not wanting sage the software to be pip installable ever.

> Mind you, Python does not have tools for this, autoconf does, as you see.
> 
> > Perhaps in `src/sage_setup/docbuild/__init__.py` we could modify `index.rst`, or take `index.rst.in` as input and write `index.rst` as output.
> > 
> > Or if it's just `reference/index.rst` that's relevant, it could be done in `reference/conf.py`.

Yes I am aware that what you are thinking of is easy with autotools but not trivial with python. But sometimes doing the easy stuff is just painting yourself in a corner in the long run.



---

archive/issue_comments_425571.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWe don't have a special manual for Sage the software (sagelib), only for Sage the distro. This ticket makes no attempt to change this situation, it merely improves the existing reference manual, in particular corrects the fact that SageNB docs are no longer available on `http://doc.sagemath.org`.\n\nOne would surely welcome an effort to partition the docs between sagelib and Sage the distro, but arguably a large part of the top `index.rst`, including everything on this ticket, would not belong to sagelib docs.",
    "created_at": "2019-03-17T08:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425571",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

We don't have a special manual for Sage the software (sagelib), only for Sage the distro. This ticket makes no attempt to change this situation, it merely improves the existing reference manual, in particular corrects the fact that SageNB docs are no longer available on `http://doc.sagemath.org`.

One would surely welcome an effort to partition the docs between sagelib and Sage the distro, but arguably a large part of the top `index.rst`, including everything on this ticket, would not belong to sagelib docs.



---

archive/issue_comments_425572.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.\n \n+in particular, this corrects the defect of `http://doc.sagemath.org` that SageNB docs are no longer available there, something that was repeatedly mentioned on sage-dev.\n+ .\n \n``````\n",
    "created_at": "2019-03-17T08:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425572",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.
 
+in particular, this corrects the defect of `http://doc.sagemath.org` that SageNB docs are no longer available there, something that was repeatedly mentioned on sage-dev.
+ .
 
``````




---

archive/issue_comments_425573.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@kiwifb](#comment:4):\n> Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon.\n\n+1, could we make the individual doc locations configurable?",
    "created_at": "2019-03-17T09:22:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425573",
    "user": "https://github.com/timokau"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@kiwifb](#comment:4):
> Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon.

+1, could we make the individual doc locations configurable?



---

archive/issue_comments_425574.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@timokau](#comment:12):\n> Replying to [@kiwifb](#comment:4):\n> > Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon.\n\n> \n> +1, could we make the individual doc locations configurable?\n\nindividual packages have their own ideas where the docs should go. Mostly it is\neither `/usr/share/$PKG/doc` or `/usr/share/doc/$PKG`, but not always. E.g. `cmake` puts docs in `$prefix/doc`. They also don't always have a topmost `index.html`, or quite often only provide pdf docs. Some probably have it configurable, some (most?) probably not.\n\nSome packages have only little English documentation, e.g. `giac`.\n\nThis ticket is not meant to sort this huge mess out. It rather fixes most glaring omissions and provides a heads-up on docs that otherwise merely collect digital dust in `$SAGE_LOCAL`.",
    "created_at": "2019-03-17T09:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425574",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@timokau](#comment:12):
> Replying to [@kiwifb](#comment:4):
> > Link to other packages documentation, all distros will probably want to patch. Note how it is all over the place? There is no way we let things be that messy. Documentation lives under some form of `/usrshare/doc/`, `/usr/share/$PKG/doc` and variations are frowned upon.

> 
> +1, could we make the individual doc locations configurable?

individual packages have their own ideas where the docs should go. Mostly it is
either `/usr/share/$PKG/doc` or `/usr/share/doc/$PKG`, but not always. E.g. `cmake` puts docs in `$prefix/doc`. They also don't always have a topmost `index.html`, or quite often only provide pdf docs. Some probably have it configurable, some (most?) probably not.

Some packages have only little English documentation, e.g. `giac`.

This ticket is not meant to sort this huge mess out. It rather fixes most glaring omissions and provides a heads-up on docs that otherwise merely collect digital dust in `$SAGE_LOCAL`.



---

archive/issue_comments_425575.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment:13):\n> individual packages have their own ideas where the docs should go\n\nI'm not talking about configuring where they are installed (which is a sage-the-distribution concern), but where sage looks for them when they are linked. Distributions don't install the docs of dependencies through sage's build system.",
    "created_at": "2019-03-17T09:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425575",
    "user": "https://github.com/timokau"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment:13):
> individual packages have their own ideas where the docs should go

I'm not talking about configuring where they are installed (which is a sage-the-distribution concern), but where sage looks for them when they are linked. Distributions don't install the docs of dependencies through sage's build system.



---

archive/issue_comments_425576.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@timokau](#comment:14):\n> Replying to [@dimpase](#comment:13):\n> > individual packages have their own ideas where the docs should go\n\n> \n> I'm not talking about configuring where they are installed (which is a sage-the-distribution concern), but where sage looks for them when they are linked. Distributions don't install the docs of dependencies through sage's build system.\n\nI can give templates used in `index.rst.in` more generic names. Please suggest what would be suitable.",
    "created_at": "2019-03-17T09:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425576",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@timokau](#comment:14):
> Replying to [@dimpase](#comment:13):
> > individual packages have their own ideas where the docs should go

> 
> I'm not talking about configuring where they are installed (which is a sage-the-distribution concern), but where sage looks for them when they are linked. Distributions don't install the docs of dependencies through sage's build system.

I can give templates used in `index.rst.in` more generic names. Please suggest what would be suitable.



---

archive/issue_comments_425577.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBeing able to override them with `SAGENB_DOC`, `SINGULAR_DOC` etc. would be helpful. I also currently don't use the `./configure` script, but I don't see any reason I couldn't add that.\n\nI agree that it is a step backwards from the \"pip-installability\" goal though.",
    "created_at": "2019-03-17T10:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425577",
    "user": "https://github.com/timokau"
}
```

<div id="comment:16" align="right">comment:16</div>

Being able to override them with `SAGENB_DOC`, `SINGULAR_DOC` etc. would be helpful. I also currently don't use the `./configure` script, but I don't see any reason I couldn't add that.

I agree that it is a step backwards from the "pip-installability" goal though.



---

archive/issue_comments_425578.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@timokau](#comment:16):\n> Being able to override them with `SAGENB_DOC`, `SINGULAR_DOC` etc. would be helpful. I also currently don't use the `./configure` script, but I don't see any reason I couldn't add that.\n> \n\nOK, will do.\n\n> I agree that it is a step backwards from the \"pip-installability\" goal though.\n\nIt is not really so, as the top level reference manual already has things that are not about `sagelib`, e.g. some of it are to be in the development manual.\n\nI agree though that it's desirable to add one more level to Sage distro docs, something akin to\nhttp://doc.sagemath.org/",
    "created_at": "2019-03-17T10:55:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425578",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@timokau](#comment:16):
> Being able to override them with `SAGENB_DOC`, `SINGULAR_DOC` etc. would be helpful. I also currently don't use the `./configure` script, but I don't see any reason I couldn't add that.
> 

OK, will do.

> I agree that it is a step backwards from the "pip-installability" goal though.

It is not really so, as the top level reference manual already has things that are not about `sagelib`, e.g. some of it are to be in the development manual.

I agree though that it's desirable to add one more level to Sage distro docs, something akin to
http://doc.sagemath.org/



---

archive/issue_comments_425579.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment:8):\n> Replying to [@jhpalmieri](#comment:7):\n> > As fbissey said, what about doing this with Python instead of `configure`? \n\n> \n> Why? What's wrong with doing it at configuration time?\n> Should we redo the whole Sage building process with Python only? :-)\n> \n> Mind you, Python does not have tools for this, autoconf does, as you see.\n\nIt's a search-and-replace; I think Python can handle it. Google led me to this, for example, for a generic search-and-replace:\n\n```\nimport fileinput\n\nfor line in fileinput.FileInput(filename, inplace=True):\n    print(line.replace(text_to_search, replacement_text))\n```",
    "created_at": "2019-03-17T15:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425579",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment:8):
> Replying to [@jhpalmieri](#comment:7):
> > As fbissey said, what about doing this with Python instead of `configure`? 

> 
> Why? What's wrong with doing it at configuration time?
> Should we redo the whole Sage building process with Python only? :-)
> 
> Mind you, Python does not have tools for this, autoconf does, as you see.

It's a search-and-replace; I think Python can handle it. Google led me to this, for example, for a generic search-and-replace:

```
import fileinput

for line in fileinput.FileInput(filename, inplace=True):
    print(line.replace(text_to_search, replacement_text))
```



---

archive/issue_comments_425580.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWe are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.\n\nDoing this in Python probably would mean instead doing these template changes in `spkg-install` scripts instead, and this feels to me like we are mixing up configuration and installation.  This is the stuff we struggle on #27373 (which sort of convinced me that `sage -i` is evil, but that's anther story).",
    "created_at": "2019-03-17T18:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425580",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

We are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.

Doing this in Python probably would mean instead doing these template changes in `spkg-install` scripts instead, and this feels to me like we are mixing up configuration and installation.  This is the stuff we struggle on #27373 (which sort of convinced me that `sage -i` is evil, but that's anther story).



---

archive/issue_comments_425581.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@dimpase](#comment:19):\n> We are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.\n\nSorry, I don't understand what you mean.\n\nAre you expecting to apply the substitutions in files other than `reference/index.rst`? As it stands, the Python file `reference/conf.py` already imports `SAGE_DOC` (for example) from `sage.env`, so it can surely do the same with `SAGE_SHARE`. What makes changing \"@SAGE_SHARE@\" to the value of the appropriate variable configuration rather than installation? It seems to me that the configuration part is putting \"@SAGE_SHARE@\" in the file to begin with. At that point, people can make sure that the appropriate variables are set how they want before they build and install the docs.",
    "created_at": "2019-03-18T01:39:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425581",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@dimpase](#comment:19):
> We are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.

Sorry, I don't understand what you mean.

Are you expecting to apply the substitutions in files other than `reference/index.rst`? As it stands, the Python file `reference/conf.py` already imports `SAGE_DOC` (for example) from `sage.env`, so it can surely do the same with `SAGE_SHARE`. What makes changing "@SAGE_SHARE@" to the value of the appropriate variable configuration rather than installation? It seems to me that the configuration part is putting "@SAGE_SHARE@" in the file to begin with. At that point, people can make sure that the appropriate variables are set how they want before they build and install the docs.



---

archive/issue_comments_425582.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment:20):\n> Replying to [@dimpase](#comment:19):\n> > We are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.\n\n> \n> Sorry, I don't understand what you mean.\n> \n> Are you expecting to apply the substitutions in files other than `reference/index.rst`? \n\nSorry, I should have added more context. I expect to  generate contents of the substitution patterns per package, in `spkg-configure.m4`. It might be that the package isn't even installed, then the contents would contain a pointer to an external URL.\n \n> As it stands, the Python file `reference/conf.py` already imports `SAGE_DOC` (for example) from `sage.env`, so it can surely do the same with `SAGE_SHARE`. What makes changing \"@SAGE_SHARE@\" to the value of the appropriate variable configuration rather than installation? It seems to me that the configuration part is putting \"@SAGE_SHARE@\" in the file to begin with. At that point, people can make sure that the appropriate variables are set how they want before they build and install the docs.\n\nAs I say above, for some packages it might boil down to writing an external URL somewhere into index.rst, with the package itself not even installed. Surely, doing this substitution at installation rather than at configuration would make the whole thing even more complicated than it already is.",
    "created_at": "2019-03-18T09:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425582",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment:20):
> Replying to [@dimpase](#comment:19):
> > We are talking about package-wise configuration settings, and it's easy to move things from `configure.ac` into `spkg-configure.m4` files in `build/pkgs/` files once we are more settled on this.

> 
> Sorry, I don't understand what you mean.
> 
> Are you expecting to apply the substitutions in files other than `reference/index.rst`? 

Sorry, I should have added more context. I expect to  generate contents of the substitution patterns per package, in `spkg-configure.m4`. It might be that the package isn't even installed, then the contents would contain a pointer to an external URL.
 
> As it stands, the Python file `reference/conf.py` already imports `SAGE_DOC` (for example) from `sage.env`, so it can surely do the same with `SAGE_SHARE`. What makes changing "@SAGE_SHARE@" to the value of the appropriate variable configuration rather than installation? It seems to me that the configuration part is putting "@SAGE_SHARE@" in the file to begin with. At that point, people can make sure that the appropriate variables are set how they want before they build and install the docs.

As I say above, for some packages it might boil down to writing an external URL somewhere into index.rst, with the package itself not even installed. Surely, doing this substitution at installation rather than at configuration would make the whole thing even more complicated than it already is.



---

archive/issue_comments_425583.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nCan you *also* do this in `conf.py`, as a backup plan (for the distro people who don't run `./configure`)? Something like the following, which is untested:\n\n```diff\ndiff --git a/src/doc/en/reference/conf.py b/src/doc/en/reference/conf.py\nindex 9e55717545..98aaeecb13 100644\n--- a/src/doc/en/reference/conf.py\n+++ b/src/doc/en/reference/conf.py\n@@ -11,8 +11,10 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import sys, os\n-from sage.env import SAGE_DOC_SRC, SAGE_DOC\n+import sys\n+import os\n+import fileinput\n+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SHARE\n sys.path.append(SAGE_DOC_SRC)\n from common.conf import *\n \n@@ -70,3 +72,11 @@ multidocs_subdoc_list = sorted([x for x in os.listdir(ref_src)\n exclude_patterns += multidocs_subdoc_list + [\n     'sage', 'sagenb', 'options'\n     ]\n+\n+# Convert index.rst.in to index.rst, if this hasn't already been done\n+# by the top-level configure script.\n+if not os.path.exists('index.rst'):\n+    with open('index.rst', 'w') as output:\n+        for line in fileinput.FileInput('index.rst.in'):\n+            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)\n+            output.write(l)\n```",
    "created_at": "2019-03-18T17:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425583",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

Can you *also* do this in `conf.py`, as a backup plan (for the distro people who don't run `./configure`)? Something like the following, which is untested:

```diff
diff --git a/src/doc/en/reference/conf.py b/src/doc/en/reference/conf.py
index 9e55717545..98aaeecb13 100644
--- a/src/doc/en/reference/conf.py
+++ b/src/doc/en/reference/conf.py
@@ -11,8 +11,10 @@
 # All configuration values have a default; values that are commented out
 # serve to show the default.
 
-import sys, os
-from sage.env import SAGE_DOC_SRC, SAGE_DOC
+import sys
+import os
+import fileinput
+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SHARE
 sys.path.append(SAGE_DOC_SRC)
 from common.conf import *
 
@@ -70,3 +72,11 @@ multidocs_subdoc_list = sorted([x for x in os.listdir(ref_src)
 exclude_patterns += multidocs_subdoc_list + [
     'sage', 'sagenb', 'options'
     ]
+
+# Convert index.rst.in to index.rst, if this hasn't already been done
+# by the top-level configure script.
+if not os.path.exists('index.rst'):
+    with open('index.rst', 'w') as output:
+        for line in fileinput.FileInput('index.rst.in'):
+            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)
+            output.write(l)
```



---

archive/issue_comments_425584.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI've tested this a little and it seems to work. I don't know if \n\n```\n\tif not os.path.exists('index.rst'):\n```\nis the right thing, or if instead we should compare modification times for `index.rst` and `index.rst.in`.",
    "created_at": "2019-03-18T18:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425584",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

I've tested this a little and it seems to work. I don't know if 

```
	if not os.path.exists('index.rst'):
```
is the right thing, or if instead we should compare modification times for `index.rst` and `index.rst.in`.



---

archive/issue_comments_425585.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIn your line\n\n```\n* The legacy notebook interface `SageNB <@SAGE_DOC@/sagenb/index.html>`_ (no longer actively maintained; `source repository <https://github.com/sagemath/sagenb>`_).\n```\nthe link to SageNB should use `SAGE_SHARE`, not `SAGE_DOC`.",
    "created_at": "2019-03-18T18:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425585",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

In your line

```
* The legacy notebook interface `SageNB <@SAGE_DOC@/sagenb/index.html>`_ (no longer actively maintained; `source repository <https://github.com/sagemath/sagenb>`_).
```
the link to SageNB should use `SAGE_SHARE`, not `SAGE_DOC`.



---

archive/issue_comments_425586.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment:24):\n> In your line\n> \n> ```\n> * The legacy notebook interface `SageNB <@SAGE_DOC@/sagenb/index.html>`_ (no longer actively maintained; `source repository <https://github.com/sagemath/sagenb>`_).\n> ```\n> the link to SageNB should use `SAGE_SHARE`, not `SAGE_DOC`.\n\nSorry, I'm wrong about this, but I was confused because Sage sets the environment variable `SAGE_DOC` to be `SAGE_SHARE/doc/sage`, and that's not how you define it: you don't include the `sage` at the end. So it would be best to not use `SAGE_DOC` as you are. Please either use `@SAGE_SHARE@/doc` (my preference) or invent a new variable (we have enough already, I think).",
    "created_at": "2019-03-18T19:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425586",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment:24):
> In your line
> 
> ```
> * The legacy notebook interface `SageNB <@SAGE_DOC@/sagenb/index.html>`_ (no longer actively maintained; `source repository <https://github.com/sagemath/sagenb>`_).
> ```
> the link to SageNB should use `SAGE_SHARE`, not `SAGE_DOC`.

Sorry, I'm wrong about this, but I was confused because Sage sets the environment variable `SAGE_DOC` to be `SAGE_SHARE/doc/sage`, and that's not how you define it: you don't include the `sage` at the end. So it would be best to not use `SAGE_DOC` as you are. Please either use `@SAGE_SHARE@/doc` (my preference) or invent a new variable (we have enough already, I think).



---

archive/issue_comments_425587.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jhpalmieri](#comment:23):\n> I've tested this a little and it seems to work. I don't know if \n> \n> ```\n> \tif not os.path.exists('index.rst'):\n> ```\n> is the right thing, or if instead we should compare modification times for `index.rst` and `index.rst.in`.\n\nNo, this is not, one indeed should compare modification times (as an update will update `index.rst.in`, and might not remove stale `index.rst`).",
    "created_at": "2019-03-18T22:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425587",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jhpalmieri](#comment:23):
> I've tested this a little and it seems to work. I don't know if 
> 
> ```
> 	if not os.path.exists('index.rst'):
> ```
> is the right thing, or if instead we should compare modification times for `index.rst` and `index.rst.in`.

No, this is not, one indeed should compare modification times (as an update will update `index.rst.in`, and might not remove stale `index.rst`).



---

archive/issue_comments_425588.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSo you can insert an extra condition \n\n```python\nif os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'):\n   ... # update index.rst\n```\nand this even is supposed to work for py2/3 and for all OS's of interest.",
    "created_at": "2019-03-19T11:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425588",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

So you can insert an extra condition 

```python
if os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'):
   ... # update index.rst
```
and this even is supposed to work for py2/3 and for all OS's of interest.



---

archive/issue_comments_425589.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOkay, this works for me:\n\n```diff\ndiff --git a/src/doc/en/reference/conf.py b/src/doc/en/reference/conf.py\nindex 9e55717545..f8ffa03aa7 100644\n--- a/src/doc/en/reference/conf.py\n+++ b/src/doc/en/reference/conf.py\n@@ -11,8 +11,10 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import sys, os\n-from sage.env import SAGE_DOC_SRC, SAGE_DOC\n+import sys\n+import os\n+import fileinput\n+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SHARE\n sys.path.append(SAGE_DOC_SRC)\n from common.conf import *\n \n@@ -70,3 +72,12 @@ multidocs_subdoc_list = sorted([x for x in os.listdir(ref_src)\n exclude_patterns += multidocs_subdoc_list + [\n     'sage', 'sagenb', 'options'\n     ]\n+\n+# Convert index.rst.in to index.rst, in case this hasn't already been done\n+# by the top-level configure script.\n+if (not os.path.exists('index.rst') or\n+    (os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'))):\n+    with open('index.rst', 'w') as output:\n+        for line in fileinput.FileInput('index.rst.in'):\n+            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)\n+            output.write(l)\n```",
    "created_at": "2019-03-19T17:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425589",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

Okay, this works for me:

```diff
diff --git a/src/doc/en/reference/conf.py b/src/doc/en/reference/conf.py
index 9e55717545..f8ffa03aa7 100644
--- a/src/doc/en/reference/conf.py
+++ b/src/doc/en/reference/conf.py
@@ -11,8 +11,10 @@
 # All configuration values have a default; values that are commented out
 # serve to show the default.
 
-import sys, os
-from sage.env import SAGE_DOC_SRC, SAGE_DOC
+import sys
+import os
+import fileinput
+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SHARE
 sys.path.append(SAGE_DOC_SRC)
 from common.conf import *
 
@@ -70,3 +72,12 @@ multidocs_subdoc_list = sorted([x for x in os.listdir(ref_src)
 exclude_patterns += multidocs_subdoc_list + [
     'sage', 'sagenb', 'options'
     ]
+
+# Convert index.rst.in to index.rst, in case this hasn't already been done
+# by the top-level configure script.
+if (not os.path.exists('index.rst') or
+    (os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'))):
+    with open('index.rst', 'w') as output:
+        for line in fileinput.FileInput('index.rst.in'):
+            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)
+            output.write(l)
```



---

archive/issue_comments_425590.json:
```json
{
    "body": "Changed branch from **[u/dimpase/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/doc/docrefs)** to **[u/jhpalmieri/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doc/docrefs)**",
    "created_at": "2019-03-20T19:36:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425590",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/dimpase/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/doc/docrefs)** to **[u/jhpalmieri/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doc/docrefs)**



---

archive/issue_comments_425591.json:
```json
{
    "body": "Changed commit from **[`85299a3`](https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5)** to **[`122a4c4`](https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9)**",
    "created_at": "2019-03-20T19:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425591",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`85299a3`](https://github.com/sagemath/sagetrac-mirror/commit/85299a30eaae4d781a9e0994507da634c31b02a5)** to **[`122a4c4`](https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9)**



---

archive/issue_comments_425592.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nHere's a branch making my suggested changes.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9\"><code>122a4c4</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr></table>\n",
    "created_at": "2019-03-20T19:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425592",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Here's a branch making my suggested changes.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9"><code>122a4c4</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr></table>




---

archive/issue_comments_425593.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI would also suggest this change, although with my changes, `@SAGE_DOC@` isn't present in `index.rst.in` anymore:\n\n```diff\ndiff --git a/configure.ac b/configure.ac\nindex 0ac744e0d7..3c9417e06d 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -515,7 +515,7 @@ AC_CONFIG_COMMANDS(mkdirs,\n     ])\n \n dnl used in index.rst of Reference Manual\n-AC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc])\n+AC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc/sage])\n AC_SUBST([SAGE_SHARE],[`pwd -P`/$SAGE_LOCAL/share])\n \n AC_OUTPUT()\n```",
    "created_at": "2019-03-20T19:38:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425593",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">comment:31</div>

I would also suggest this change, although with my changes, `@SAGE_DOC@` isn't present in `index.rst.in` anymore:

```diff
diff --git a/configure.ac b/configure.ac
index 0ac744e0d7..3c9417e06d 100644
--- a/configure.ac
+++ b/configure.ac
@@ -515,7 +515,7 @@ AC_CONFIG_COMMANDS(mkdirs,
     ])
 
 dnl used in index.rst of Reference Manual
-AC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc])
+AC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc/sage])
 AC_SUBST([SAGE_SHARE],[`pwd -P`/$SAGE_LOCAL/share])
 
 AC_OUTPUT()
```



---

archive/issue_comments_425594.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01\"><code>a23a345</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr></table>\n",
    "created_at": "2019-03-20T19:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425594",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01"><code>a23a345</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr></table>




---

archive/issue_comments_425595.json:
```json
{
    "body": "Changed commit from **[`122a4c4`](https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9)** to **[`a23a345`](https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01)**",
    "created_at": "2019-03-20T19:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425595",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`122a4c4`](https://github.com/sagemath/sagetrac-mirror/commit/122a4c4427ec37aa41770d3583ef223348ce3ee9)** to **[`a23a345`](https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01)**



---

archive/issue_comments_425596.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425596",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_379421.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379421"
}
```



---

archive/issue_events_379422.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379422"
}
```



---

archive/issue_comments_425597.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nApparently merge fails?\n\nI think this is a fine solution for now, and I don't see why John and Dima can't review each others' contributions to this ticket.",
    "created_at": "2019-06-17T18:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425597",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:34" align="right">comment:34</div>

Apparently merge fails?

I think this is a fine solution for now, and I don't see why John and Dima can't review each others' contributions to this ticket.



---

archive/issue_comments_425598.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nWith 8.8.rc1, both `git merge develop` and `git rebase develop` work fine, so I'm not sure what trac is complaining about.",
    "created_at": "2019-06-17T19:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425598",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

With 8.8.rc1, both `git merge develop` and `git rebase develop` work fine, so I'm not sure what trac is complaining about.



---

archive/issue_comments_425599.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nit might be that different git settings might play a role. Just push a rebased version.",
    "created_at": "2019-06-17T21:38:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425599",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

it might be that different git settings might play a role. Just push a rebased version.



---

archive/issue_comments_425600.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2e60dc1146f973bcdbc43a996e64fb0dd23bc95\"><code>b2e60dc</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2f35947c440466230584be01ec362b7a072127c\"><code>f2f3594</code></a></td><td><code>linking pplpy docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f1cc2746241f5080475155e4bc85cf02947706\"><code>72f1cc2</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe\"><code>7c29a5a</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr></table>\n",
    "created_at": "2019-06-17T22:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425600",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2e60dc1146f973bcdbc43a996e64fb0dd23bc95"><code>b2e60dc</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2f35947c440466230584be01ec362b7a072127c"><code>f2f3594</code></a></td><td><code>linking pplpy docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f1cc2746241f5080475155e4bc85cf02947706"><code>72f1cc2</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe"><code>7c29a5a</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr></table>




---

archive/issue_comments_425601.json:
```json
{
    "body": "Changed commit from **[`a23a345`](https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01)** to **[`7c29a5a`](https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe)**",
    "created_at": "2019-06-17T22:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425601",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a23a345`](https://github.com/sagemath/sagetrac-mirror/commit/a23a345a932b7b741028a44107134ef49d88ea01)** to **[`7c29a5a`](https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe)**



---

archive/issue_comments_425602.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nDone. I don't know if we should not add\n\n```\nAC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc/sage])\n```\nto `configure.ac` since we don't use it anymore. It's still there in case future changes use it.",
    "created_at": "2019-06-17T22:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425602",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">comment:38</div>

Done. I don't know if we should not add

```
AC_SUBST([SAGE_DOC],[`pwd -P`/$SAGE_LOCAL/share/doc/sage])
```
to `configure.ac` since we don't use it anymore. It's still there in case future changes use it.



---

archive/issue_events_379423.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379423"
}
```



---

archive/issue_events_379424.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379424"
}
```



---

archive/issue_comments_425603.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425603",
    "user": "https://github.com/embray"
}
```

<div id="comment:39" align="right">comment:39</div>

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_425604.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nNeeds rebase.",
    "created_at": "2019-12-25T14:36:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425604",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Needs rebase.



---

archive/issue_events_379425.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-12-25T14:36:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379425"
}
```



---

archive/issue_events_379426.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-12-25T14:36:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379426"
}
```



---

archive/issue_comments_425605.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nA question: the branch here currently adds a line\n\n```\n+* `Introduction to Maxima <@SAGE_SHARE@/maxima/5.41.0/doc/html/intromax.html>`_\n```\nto the main reference manual index. This is no longer valid because we are using version 5.42.2 of Maxima. I am inclined to omit this rather than try some clever way of determining the Maxima version in Sage. Opinions?",
    "created_at": "2020-01-01T05:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425605",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

A question: the branch here currently adds a line

```
+* `Introduction to Maxima <@SAGE_SHARE@/maxima/5.41.0/doc/html/intromax.html>`_
```
to the main reference manual index. This is no longer valid because we are using version 5.42.2 of Maxima. I am inclined to omit this rather than try some clever way of determining the Maxima version in Sage. Opinions?



---

archive/issue_comments_425606.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55285d305feea61a1895a0c4a2da41e8a13deeff\"><code>55285d3</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7ec752a28c098bd3d7d2f5cdca211643be44a22\"><code>c7ec752</code></a></td><td><code>linking pplpy docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32dbc747b74010a2751cc2e51957ffa114017424\"><code>32dbc74</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d75a65022ceba597463dd66c92faf24c297473fd\"><code>d75a650</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97\"><code>31f6bf0</code></a></td><td><code>trac 27495: rebased for Sage 9.0</code></td></tr></table>\n",
    "created_at": "2020-01-01T22:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425606",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55285d305feea61a1895a0c4a2da41e8a13deeff"><code>55285d3</code></a></td><td><code>trac 27495: links to external docs in reference index.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7ec752a28c098bd3d7d2f5cdca211643be44a22"><code>c7ec752</code></a></td><td><code>linking pplpy docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32dbc747b74010a2751cc2e51957ffa114017424"><code>32dbc74</code></a></td><td><code>trac 27495: in reference/conf.py, convert index.rst.in to index.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d75a65022ceba597463dd66c92faf24c297473fd"><code>d75a650</code></a></td><td><code>trac 27495: @SAGE_DOC@ should point to the same place as SAGE_DOC</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97"><code>31f6bf0</code></a></td><td><code>trac 27495: rebased for Sage 9.0</code></td></tr></table>




---

archive/issue_comments_425607.json:
```json
{
    "body": "Changed commit from **[`7c29a5a`](https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe)** to **[`31f6bf0`](https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97)**",
    "created_at": "2020-01-01T22:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425607",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7c29a5a`](https://github.com/sagemath/sagetrac-mirror/commit/7c29a5a77460e313603c93f3c0c64aafcf40fffe)** to **[`31f6bf0`](https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97)**



---

archive/issue_events_379427.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379427"
}
```



---

archive/issue_events_379428.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379428"
}
```



---

archive/issue_comments_425608.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425608",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

Ticket retargeted after milestone closed



---

archive/issue_events_379429.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T16:50:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379429"
}
```



---

archive/issue_events_379430.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T16:50:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379430"
}
```



---

archive/issue_comments_425609.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dima Pasechnik, John Palmieri**",
    "created_at": "2020-01-16T16:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425609",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Dima Pasechnik** to **Dima Pasechnik, John Palmieri**



---

archive/issue_comments_425610.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-01-16T16:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425610",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_425611.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n`@MAXIMA_VERSION@` does not get replaced, probably cause `.replace` cannot do more than one pattern per line.",
    "created_at": "2020-01-16T17:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425611",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:46" align="right">comment:46</div>

`@MAXIMA_VERSION@` does not get replaced, probably cause `.replace` cannot do more than one pattern per line.



---

archive/issue_events_379431.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T17:13:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379431"
}
```



---

archive/issue_events_379432.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T17:13:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379432"
}
```



---

archive/issue_comments_425612.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nEven this does not work:\n\n```diff\n--- a/src/doc/en/reference/conf.py\n+++ b/src/doc/en/reference/conf.py\n@@ -17,8 +17,6 @@ from sage.env import SAGE_SHARE\n from sage.docs.conf import *\n from sage.interfaces.maxima import maxima\n \n-MAXIMA_VERSION = maxima.version()\n-\n ref_src = os.path.join(SAGE_DOC_SRC, 'en', 'reference')\n ref_out = os.path.join(SAGE_DOC, 'html', 'en', 'reference')\n \n@@ -80,5 +78,6 @@ if (not os.path.exists('index.rst') or\n     (os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'))):\n     with open('index.rst', 'w') as output:\n         for line in fileinput.FileInput('index.rst.in'):\n-            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE).replace('@MAXIMA_VERSION@', MAXIMA_VERSION)\n+            l0 = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)\n+            l = l0.replace('@MAXIMA_VERSION@', maxima.version()) \n             output.write(l)\n```\n\nJohn, can you look into it? It's your branch after all. Probably it matters that I'm trying it with Python 3 now.",
    "created_at": "2020-01-16T17:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425612",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:47" align="right">comment:47</div>

Even this does not work:

```diff
--- a/src/doc/en/reference/conf.py
+++ b/src/doc/en/reference/conf.py
@@ -17,8 +17,6 @@ from sage.env import SAGE_SHARE
 from sage.docs.conf import *
 from sage.interfaces.maxima import maxima
 
-MAXIMA_VERSION = maxima.version()
-
 ref_src = os.path.join(SAGE_DOC_SRC, 'en', 'reference')
 ref_out = os.path.join(SAGE_DOC, 'html', 'en', 'reference')
 
@@ -80,5 +78,6 @@ if (not os.path.exists('index.rst') or
     (os.path.getmtime('index.rst') <= os.path.getmtime('index.rst.in'))):
     with open('index.rst', 'w') as output:
         for line in fileinput.FileInput('index.rst.in'):
-            l = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE).replace('@MAXIMA_VERSION@', MAXIMA_VERSION)
+            l0 = line.replace('@SAGE_DOC@', SAGE_DOC).replace('@SAGE_SHARE@', SAGE_SHARE)
+            l = l0.replace('@MAXIMA_VERSION@', maxima.version()) 
             output.write(l)
```

John, can you look into it? It's your branch after all. Probably it matters that I'm trying it with Python 3 now.



---

archive/issue_comments_425613.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nIt works for me with OS X and Python 3. I'm not sure what you mean by \"`.replace` cannot do more than one pattern per line\":\n\n```\n$ sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.1.beta0, Release Date: 2020-01-10               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: s = 'abcdef'\nsage: s.replace('a', 'x').replace('b', 'y')\n'xycdef'\n```\nMaybe the timestamps of `index.rst` or `index.rst.in` are off: if `index.rst` is newer, it won't get overwritten. Try `touch index.rst.in`: does that help?",
    "created_at": "2020-01-16T18:19:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425613",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

It works for me with OS X and Python 3. I'm not sure what you mean by "`.replace` cannot do more than one pattern per line":

```
$ sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.1.beta0, Release Date: 2020-01-10               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: s = 'abcdef'
sage: s.replace('a', 'x').replace('b', 'y')
'xycdef'
```
Maybe the timestamps of `index.rst` or `index.rst.in` are off: if `index.rst` is newer, it won't get overwritten. Try `touch index.rst.in`: does that help?



---

archive/issue_comments_425614.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nOh, or maybe `index.rst` was written by `./configure`, in which case the timestamps would be wrong. So do we add a substitution for the Maxima version in `configure.ac`? How would that work?",
    "created_at": "2020-01-16T18:27:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425614",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:49" align="right">comment:49</div>

Oh, or maybe `index.rst` was written by `./configure`, in which case the timestamps would be wrong. So do we add a substitution for the Maxima version in `configure.ac`? How would that work?



---

archive/issue_comments_425615.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@jhpalmieri](#comment:49):\n> Oh, or maybe `index.rst` was written by `./configure`, in which case the timestamps would be wrong. So do we add a substitution for the Maxima version in `configure.ac`? How would that work?\n\nIndeed, `index.rst` is written by `./configure`. But is there any reason for doing this?\n\nIsn't your branch meant to replace this with Python code in `src/doc/en/reference/conf.py`",
    "created_at": "2020-01-16T18:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425615",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@jhpalmieri](#comment:49):
> Oh, or maybe `index.rst` was written by `./configure`, in which case the timestamps would be wrong. So do we add a substitution for the Maxima version in `configure.ac`? How would that work?

Indeed, `index.rst` is written by `./configure`. But is there any reason for doing this?

Isn't your branch meant to replace this with Python code in `src/doc/en/reference/conf.py`



---

archive/issue_comments_425616.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nAt configure time at the moment the only way to get Maxima version is to parse `build/pkgs/maxima/package-version.txt` (the 1st X.Y.Z are the version)\nin `build/pkgs/maxima/spkg-configure.m4`.\n\nAs we go on with adding capabilites to use system packages, we'd be able to call instead `maxima --version` to get it.\n\nSo this is doable, but is more work than after Sage is built.",
    "created_at": "2020-01-16T18:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425616",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

At configure time at the moment the only way to get Maxima version is to parse `build/pkgs/maxima/package-version.txt` (the 1st X.Y.Z are the version)
in `build/pkgs/maxima/spkg-configure.m4`.

As we go on with adding capabilites to use system packages, we'd be able to call instead `maxima --version` to get it.

So this is doable, but is more work than after Sage is built.



---

archive/issue_comments_425617.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI'm happy to remove the changes to `configure.ac` and let Python do all of the work after Sage has been built. This will go against what you said in [comment:21](#comment:21), though. If you give the go ahead, I'll switch to the Python-only approach.",
    "created_at": "2020-01-16T18:53:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425617",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

I'm happy to remove the changes to `configure.ac` and let Python do all of the work after Sage has been built. This will go against what you said in [comment:21](#comment:21), though. If you give the go ahead, I'll switch to the Python-only approach.



---

archive/issue_comments_425618.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI'm in favor of the Python-only approach too, because it would support the goal of having `sagelib` as an ordinary Python package that is able to build its own documentation out of the directory `src/`.",
    "created_at": "2020-01-16T19:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425618",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

I'm in favor of the Python-only approach too, because it would support the goal of having `sagelib` as an ordinary Python package that is able to build its own documentation out of the directory `src/`.



---

archive/issue_comments_425619.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nOne way or another, mixing autoconf with Python the way it's done here is messy. If you like to make it Python-only, please go ahead.",
    "created_at": "2020-01-16T19:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425619",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:54" align="right">comment:54</div>

One way or another, mixing autoconf with Python the way it's done here is messy. If you like to make it Python-only, please go ahead.



---

archive/issue_comments_425620.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979\"><code>dab737d</code></a></td><td><code>trac 27495: add links to external docs in reference/index.rst:</code></td></tr></table>\n",
    "created_at": "2020-01-16T19:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425620",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979"><code>dab737d</code></a></td><td><code>trac 27495: add links to external docs in reference/index.rst:</code></td></tr></table>




---

archive/issue_comments_425621.json:
```json
{
    "body": "Changed commit from **[`31f6bf0`](https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97)** to **[`dab737d`](https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979)**",
    "created_at": "2020-01-16T19:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425621",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`31f6bf0`](https://github.com/sagemath/sagetrac-mirror/commit/31f6bf070afdd2638d12a09fc51b7d76bd48cb97)** to **[`dab737d`](https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979)**



---

archive/issue_comments_425622.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nDone. I also squashed everything into a single commit.",
    "created_at": "2020-01-16T19:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425622",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">comment:56</div>

Done. I also squashed everything into a single commit.



---

archive/issue_events_379433.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-01-16T19:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379433"
}
```



---

archive/issue_events_379434.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-01-16T19:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379434"
}
```



---

archive/issue_comments_425623.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nVery vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories\n\n```\nfbissey@moonloop ~/Work/Overlays/testing/sci-libs/m4ri $ maxima -d\n;;; Loading #P\"/usr/lib64/ecl-16.1.2/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-16.1.2/sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-16.1.2/defsystem.fas\"\n;;; Loading #P\"/usr/lib64/ecl-16.1.2/cmp.fas\"\nmaxima-prefix=/usr\nmaxima-topdir=/usr/share/maxima/5.42.2\nmaxima-imagesdir=/usr/lib64/maxima/5.42.2/binary-ecl\nmaxima-sharedir=/usr/share/maxima/5.42.2/share\nmaxima-srcdir=/usr/share/maxima/5.42.2/src\nmaxima-demodir=/usr/share/maxima/5.42.2/demo\nmaxima-testsdir=/usr/share/maxima/5.42.2/tests\nmaxima-docdir=/usr/share/maxima/5.42.2/doc\nmaxima-infodir=/usr/share/info\nmaxima-htmldir=/usr/share/maxima/5.42.2/doc/html\nmaxima-plotdir=/usr/libexec/maxima/5.42.2\nmaxima-layout-autotools=T\nmaxima-userdir=/home/fbissey/.maxima\nmaxima-tempdir=/tmp\nmaxima-lang-subdir=NIL\nmaxima-objdir=/home/fbissey/.maxima/binary/5_42_2/ecl/16_1_2\n```\nmaxima-docdir is what we are after.",
    "created_at": "2020-01-16T20:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425623",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:58" align="right">comment:58</div>

Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories

```
fbissey@moonloop ~/Work/Overlays/testing/sci-libs/m4ri $ maxima -d
;;; Loading #P"/usr/lib64/ecl-16.1.2/sb-bsd-sockets.fas"
;;; Loading #P"/usr/lib64/ecl-16.1.2/sockets.fas"
;;; Loading #P"/usr/lib64/ecl-16.1.2/defsystem.fas"
;;; Loading #P"/usr/lib64/ecl-16.1.2/cmp.fas"
maxima-prefix=/usr
maxima-topdir=/usr/share/maxima/5.42.2
maxima-imagesdir=/usr/lib64/maxima/5.42.2/binary-ecl
maxima-sharedir=/usr/share/maxima/5.42.2/share
maxima-srcdir=/usr/share/maxima/5.42.2/src
maxima-demodir=/usr/share/maxima/5.42.2/demo
maxima-testsdir=/usr/share/maxima/5.42.2/tests
maxima-docdir=/usr/share/maxima/5.42.2/doc
maxima-infodir=/usr/share/info
maxima-htmldir=/usr/share/maxima/5.42.2/doc/html
maxima-plotdir=/usr/libexec/maxima/5.42.2
maxima-layout-autotools=T
maxima-userdir=/home/fbissey/.maxima
maxima-tempdir=/tmp
maxima-lang-subdir=NIL
maxima-objdir=/home/fbissey/.maxima/binary/5_42_2/ecl/16_1_2
```
maxima-docdir is what we are after.



---

archive/issue_events_379435.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T23:28:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379435"
}
```



---

archive/issue_events_379436.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-16T23:28:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379436"
}
```



---

archive/issue_comments_425624.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nOK, this works.",
    "created_at": "2020-01-16T23:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425624",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:59" align="right">comment:59</div>

OK, this works.



---

archive/issue_comments_425625.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@kiwifb](#comment:58):\n> Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories\n\nTo be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.",
    "created_at": "2020-01-16T23:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425625",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@kiwifb](#comment:58):
> Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories

To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.



---

archive/issue_comments_425626.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@jhpalmieri](#comment:60):\n> Replying to [@kiwifb](#comment:58):\n> > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories\n\n> \n> To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.\n\nMe and my distro buddies think otherwise. I think we would prefer nothing than the current state of this ticket. \n\nI approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.\n\nI am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.\n\nIt may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.",
    "created_at": "2020-01-16T23:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425626",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@jhpalmieri](#comment:60):
> Replying to [@kiwifb](#comment:58):
> > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories

> 
> To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.

Me and my distro buddies think otherwise. I think we would prefer nothing than the current state of this ticket. 

I approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.

I am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.

It may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.



---

archive/issue_events_379437.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-01-16T23:58:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379437"
}
```



---

archive/issue_events_379438.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-01-16T23:58:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379438"
}
```



---

archive/issue_comments_425627.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nYour reply confuses me.\n\nReplying to [@kiwifb](#comment:61):\n> Replying to [@jhpalmieri](#comment:60):\n> > Replying to [@kiwifb](#comment:58):\n> > > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories\n\n> > \n> > To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.\n\n> \n> Me and my distro buddies think otherwise.\n\nSo you think we should include a link to local Maxima documentation?\n\n> I think we would prefer nothing than the current state of this ticket. \n\nOr don't include it?\n\n> I approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.\n> \n> I am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.\n\nSince it's modifying the file `doc/en/reference/index.rst`, it seems like an appropriate place. If we ever have translations of the reference manual, we will have to rethink `doc/en/reference/conf.py` in other ways, too. So I think it's okay to do the work in this file.\n\n> It may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.\n\nIf I omit local Maxima documentation, the only replacement would be of the string `@SAGE_SHARE@`.\n\nSo what exactly are you requesting?",
    "created_at": "2020-01-16T23:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425627",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:62" align="right">comment:62</div>

Your reply confuses me.

Replying to [@kiwifb](#comment:61):
> Replying to [@jhpalmieri](#comment:60):
> > Replying to [@kiwifb](#comment:58):
> > > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories

> > 
> > To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.

> 
> Me and my distro buddies think otherwise.

So you think we should include a link to local Maxima documentation?

> I think we would prefer nothing than the current state of this ticket. 

Or don't include it?

> I approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.
> 
> I am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.

Since it's modifying the file `doc/en/reference/index.rst`, it seems like an appropriate place. If we ever have translations of the reference manual, we will have to rethink `doc/en/reference/conf.py` in other ways, too. So I think it's okay to do the work in this file.

> It may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.

If I omit local Maxima documentation, the only replacement would be of the string `@SAGE_SHARE@`.

So what exactly are you requesting?



---

archive/issue_comments_425628.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jhpalmieri](#comment:62):\n> Your reply confuses me.\n> \n> Replying to [@kiwifb](#comment:61):\n> > Replying to [@jhpalmieri](#comment:60):\n> > > Replying to [@kiwifb](#comment:58):\n> > > > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories\n\n> > > \n> > > To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.\n\n> > \n> > Me and my distro buddies think otherwise.\n\n> \n> So you think we should include a link to local Maxima documentation?\n> \n\nFrom the distro point of view, I don't care either way. From the sage point of view, it is a nice to have.\n\n> > I think we would prefer nothing than the current state of this ticket. \n\n> \n> Or don't include it?\n> \n\nNot in a way that relies on a regular vanilla sage layout. It has no future if sage ever becomes a pip installable package. It has to be smarter and to not rely on preconceptions. I admit that it is harder. Connecting the data parts of two separate packages whatever happens with the packaging is very hard and need forethought.\n\n> > I approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.\n> > \n> > I am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.\n\n> \n> Since it's modifying the file `doc/en/reference/index.rst`, it seems like an appropriate place. If we ever have translations of the reference manual, we will have to rethink `doc/en/reference/conf.py` in other ways, too. So I think it's okay to do the work in this file.\n> \n> > It may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.\n\n> \n> If I omit local Maxima documentation, the only replacement would be of the string `@SAGE_SHARE@`.\n> \n> So what exactly are you requesting?\n\nApart from giving in my tantrum to use the output of `maxima -d` (thanks maxima devs to give me tools to know about your install, that's good forethought). I am suggesting creating a string in `conf.py` and replacing a single value `@MAXIMA_HTLM_DOC_DIR@` in `index.rst`. That way I can replace/patch with something appropriate in `conf.py` much more easily.\n\nI'll look to see how hard it would be to use `maxima -d`.\n\nNote that when I was talking about forethought here, the last problem is that once installed, `sage`'s documentation is static. If you change something in the maxima install the link is likely to break. There is no real solution to that, apart linking to some place on the web and pray it stays there for the life of the deployments.",
    "created_at": "2020-01-17T00:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425628",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jhpalmieri](#comment:62):
> Your reply confuses me.
> 
> Replying to [@kiwifb](#comment:61):
> > Replying to [@jhpalmieri](#comment:60):
> > > Replying to [@kiwifb](#comment:58):
> > > > Very vanilla sage centric. For maxima I would favor parsing the output of `maxima -d` to find the relevant directories

> > > 
> > > To be honest, I don't think it's worth it. I would rather omit a link to local Maxima documentation.

> > 
> > Me and my distro buddies think otherwise.

> 
> So you think we should include a link to local Maxima documentation?
> 

From the distro point of view, I don't care either way. From the sage point of view, it is a nice to have.

> > I think we would prefer nothing than the current state of this ticket. 

> 
> Or don't include it?
> 

Not in a way that relies on a regular vanilla sage layout. It has no future if sage ever becomes a pip installable package. It has to be smarter and to not rely on preconceptions. I admit that it is harder. Connecting the data parts of two separate packages whatever happens with the packaging is very hard and need forethought.

> > I approve doing it in python rather than `configure` - my opinion on `configure` for sage is well known.
> > 
> > I am not sure about running things from `doc/en/reference/conf.py`. May be one day we'll have translation of the reference manual in other languages, we may think again about it then.

> 
> Since it's modifying the file `doc/en/reference/index.rst`, it seems like an appropriate place. If we ever have translations of the reference manual, we will have to rethink `doc/en/reference/conf.py` in other ways, too. So I think it's okay to do the work in this file.
> 
> > It may be easier on distro if you were assembling a single string to replace. Then we could replace with our own more easily.

> 
> If I omit local Maxima documentation, the only replacement would be of the string `@SAGE_SHARE@`.
> 
> So what exactly are you requesting?

Apart from giving in my tantrum to use the output of `maxima -d` (thanks maxima devs to give me tools to know about your install, that's good forethought). I am suggesting creating a string in `conf.py` and replacing a single value `@MAXIMA_HTLM_DOC_DIR@` in `index.rst`. That way I can replace/patch with something appropriate in `conf.py` much more easily.

I'll look to see how hard it would be to use `maxima -d`.

Note that when I was talking about forethought here, the last problem is that once installed, `sage`'s documentation is static. If you change something in the maxima install the link is likely to break. There is no real solution to that, apart linking to some place on the web and pray it stays there for the life of the deployments.



---

archive/issue_comments_425629.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nOf course I was so focused on `maxima` that I thought the other entries were comments :( \n\nToo complicated to do something right for everyone in 5mn. Proceed if you want, we'll come and fix the stuff in distros later.",
    "created_at": "2020-01-17T00:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425629",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:64" align="right">comment:64</div>

Of course I was so focused on `maxima` that I thought the other entries were comments :( 

Too complicated to do something right for everyone in 5mn. Proceed if you want, we'll come and fix the stuff in distros later.



---

archive/issue_comments_425630.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nThe only thing that I will add, is that we have `PPLPY_DOCS` in `env.py` to use with intersphinx (was not happy either with that) and you may as well use it already.",
    "created_at": "2020-01-17T00:39:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425630",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:65" align="right">comment:65</div>

The only thing that I will add, is that we have `PPLPY_DOCS` in `env.py` to use with intersphinx (was not happy either with that) and you may as well use it already.



---

archive/issue_comments_425631.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nfbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?",
    "created_at": "2020-01-17T01:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425631",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

fbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?



---

archive/issue_comments_425632.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@mkoeppe](#comment:66):\n> fbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?\n\nTo be honest, I have no idea. There are so many potential paths that it would be too cumbersome to pass them on the command line (still doable, just no one really wants to do that). It would need to be automated one way or another. Especially if you want every single one to be provided.",
    "created_at": "2020-01-17T01:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425632",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@mkoeppe](#comment:66):
> fbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?

To be honest, I have no idea. There are so many potential paths that it would be too cumbersome to pass them on the command line (still doable, just no one really wants to do that). It would need to be automated one way or another. Especially if you want every single one to be provided.



---

archive/issue_comments_425633.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.\n\nDetecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.",
    "created_at": "2020-01-17T08:43:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425633",
    "user": "https://github.com/timokau"
}
```

<div id="comment:68" align="right">comment:68</div>

I agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.

Detecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.



---

archive/issue_comments_425634.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@timokau](#comment:68):\n> I agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.\n> \n\nthis ticket has nothing to do with maxima or singular documentation being installed\nby Sage, or not. It merely creates links to these docs in the top level of Sage reference manual (hey, Sage should document its components!)\n\nA solution I proposed at the start of this ticket was to create the correct links to docs at configure time. Then already installed Sage components could be analysed and correct links created in a, hopefully, platform/distro-independent way.  \n\nI was told that many distros are allergic to `./configure`, and John cooked up something supposedly better for distros, in pure !Python/Sage, the current branch. \n\nOne of the main purposes of this ticket was to improve doc.sagemath.org, to provide it with these links. I feel this has gone totally in a direction I did not intend.\n\nIf this ticket is useless for distros in its present form then I don't see a reason to do the task at hand with !Python/Sage, it's a wrong tool IMHO.\n(It is configuring things, and we have `./configure` for this task.)\n\n \n\n\n> Detecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.",
    "created_at": "2020-01-17T09:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425634",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@timokau](#comment:68):
> I agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.
> 

this ticket has nothing to do with maxima or singular documentation being installed
by Sage, or not. It merely creates links to these docs in the top level of Sage reference manual (hey, Sage should document its components!)

A solution I proposed at the start of this ticket was to create the correct links to docs at configure time. Then already installed Sage components could be analysed and correct links created in a, hopefully, platform/distro-independent way.  

I was told that many distros are allergic to `./configure`, and John cooked up something supposedly better for distros, in pure !Python/Sage, the current branch. 

One of the main purposes of this ticket was to improve doc.sagemath.org, to provide it with these links. I feel this has gone totally in a direction I did not intend.

If this ticket is useless for distros in its present form then I don't see a reason to do the task at hand with !Python/Sage, it's a wrong tool IMHO.
(It is configuring things, and we have `./configure` for this task.)

 


> Detecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.



---

archive/issue_comments_425635.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@dimpase](#comment:69):\n> Replying to [@timokau](#comment:68):\n> > I agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.\n> > \n\n> \n> this ticket has nothing to do with maxima or singular documentation being installed\n> by Sage, or not. It merely creates links to these docs in the top level of Sage reference manual (hey, Sage should document its components!)\n\nIt should have nothing to do with that, but in its current state it assumes that they are sage-installed or at least at the location they would be if they were sage-installed.\n\n> A solution I proposed at the start of this ticket was to create the correct links to docs at configure time. Then already installed Sage components could be analysed and correct links created in a, hopefully, platform/distro-independent way.  \n> \n> I was told that many distros are allergic to `./configure`, and John cooked up something supposedly better for distros, in pure !Python/Sage, the current branch. \n\nIts pure Python/Sage, but not configurable. That is not better. The ideal solution would not need any configuration (determining the correct paths programmatically). The next best solution would allow configuration in some way (through environment variables, an easily-patchable file, etc.). The least good (for distros) solution doesn't allow any configuration.\n\n> One of the main purposes of this ticket was to improve doc.sagemath.org, to provide it with these links. I feel this has gone totally in a direction I did not intend.\n> \n> If this ticket is useless for distros in its present form then I don't see a reason to do the task at hand with !Python/Sage, it's a wrong tool IMHO.\n> (It is configuring things, and we have `./configure` for this task.)\n> \n>  \n> \n> \n> > Detecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.\n\n> \n\n>",
    "created_at": "2020-01-17T16:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425635",
    "user": "https://github.com/timokau"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@dimpase](#comment:69):
> Replying to [@timokau](#comment:68):
> > I agree with fbissey that the current state of this ticket is a step back from the point of packaging. There is no reason that either the maxima documentation or the singular documentation should live under `SAGE_SHARE`, or even share a common prefix.
> > 

> 
> this ticket has nothing to do with maxima or singular documentation being installed
> by Sage, or not. It merely creates links to these docs in the top level of Sage reference manual (hey, Sage should document its components!)

It should have nothing to do with that, but in its current state it assumes that they are sage-installed or at least at the location they would be if they were sage-installed.

> A solution I proposed at the start of this ticket was to create the correct links to docs at configure time. Then already installed Sage components could be analysed and correct links created in a, hopefully, platform/distro-independent way.  
> 
> I was told that many distros are allergic to `./configure`, and John cooked up something supposedly better for distros, in pure !Python/Sage, the current branch. 

Its pure Python/Sage, but not configurable. That is not better. The ideal solution would not need any configuration (determining the correct paths programmatically). The next best solution would allow configuration in some way (through environment variables, an easily-patchable file, etc.). The least good (for distros) solution doesn't allow any configuration.

> One of the main purposes of this ticket was to improve doc.sagemath.org, to provide it with these links. I feel this has gone totally in a direction I did not intend.
> 
> If this ticket is useless for distros in its present form then I don't see a reason to do the task at hand with !Python/Sage, it's a wrong tool IMHO.
> (It is configuring things, and we have `./configure` for this task.)
> 
>  
> 
> 
> > Detecting the correct dir automagically with `maxima -d` would be perfect. Otherwise there should at the very least be some unique string I could replace with sed for each package. A bit better would be an variable in `env.py`. Best would still be an automatic solution.

> 

>



---

archive/issue_comments_425636.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@timokau](#comment:70):\n> The ideal solution would not need any configuration (determining the correct paths programmatically). The next best solution would allow configuration in some way (through environment variables, an easily-patchable file, etc.). The least good (for distros) solution doesn't allow any configuration.\n\nI would like to suggest to use #29022 as the configuration mechanism for the \"next best solution\".",
    "created_at": "2020-01-17T17:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425636",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@timokau](#comment:70):
> The ideal solution would not need any configuration (determining the correct paths programmatically). The next best solution would allow configuration in some way (through environment variables, an easily-patchable file, etc.). The least good (for distros) solution doesn't allow any configuration.

I would like to suggest to use #29022 as the configuration mechanism for the "next best solution".



---

archive/issue_comments_425637.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nThe easiest solution is to just add links to the web page for the appropriate piece of software. For example the page https://www.singular.uni-kl.de/index.php/singular-manual.html might be pretty stable, whereas I have no idea how to find local Singular documentation programmatically.\n\n(The disadvantage to this is that there will often be version mismatches between what Sage is using and the most up-to-date version.)",
    "created_at": "2020-01-17T18:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425637",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:72" align="right">comment:72</div>

The easiest solution is to just add links to the web page for the appropriate piece of software. For example the page https://www.singular.uni-kl.de/index.php/singular-manual.html might be pretty stable, whereas I have no idea how to find local Singular documentation programmatically.

(The disadvantage to this is that there will often be version mismatches between what Sage is using and the most up-to-date version.)



---

archive/issue_comments_425638.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nI am tempted to create a new page, linked to from the main table of contents, that lists all of Sage's packages, with web pages for each. For Maxima, since we have a well-defined way to do it, we could list the local documentation, too. As we figure out what to do with other packages, we can add their local documentation to that list. So it would look something like:\n\n```\n* alabaster - link to alabaster web page\n* appnope - link to web page\n* arb - \n...\n* maxima: local documentation: .... web page: ...\n...\n```\n\nOpinions?",
    "created_at": "2020-01-18T03:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425638",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:73" align="right">comment:73</div>

I am tempted to create a new page, linked to from the main table of contents, that lists all of Sage's packages, with web pages for each. For Maxima, since we have a well-defined way to do it, we could list the local documentation, too. As we figure out what to do with other packages, we can add their local documentation to that list. So it would look something like:

```
* alabaster - link to alabaster web page
* appnope - link to web page
* arb - 
...
* maxima: local documentation: .... web page: ...
...
```

Opinions?



---

archive/issue_comments_425639.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@kiwifb](#comment:67):\n> Replying to [@mkoeppe](#comment:66):\n> > fbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?\n\n> \n> To be honest, I have no idea. There are so many potential paths that it would be too cumbersome to pass them on the command line (still doable, just no one really wants to do that). It would need to be automated one way or another. Especially if you want every single one to be provided.\n\nI have a new solution for this at #29038 - \"Python package sage_conf: Provides optional configuration information for sagelib\".\nInput from packagers would be appreciated.",
    "created_at": "2020-01-18T17:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425639",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@kiwifb](#comment:67):
> Replying to [@mkoeppe](#comment:66):
> > fbissey, suppose `src/setup.py` provides a command `build_sphinx ` that builds the sage documentation. How would it be invoked to provide the paths?

> 
> To be honest, I have no idea. There are so many potential paths that it would be too cumbersome to pass them on the command line (still doable, just no one really wants to do that). It would need to be automated one way or another. Especially if you want every single one to be provided.

I have a new solution for this at #29038 - "Python package sage_conf: Provides optional configuration information for sagelib".
Input from packagers would be appreciated.



---

archive/issue_events_379439.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:43:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379439"
}
```



---

archive/issue_events_379440.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:43:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379440"
}
```



---

archive/issue_comments_425640.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@jhpalmieri](#comment:73):\n> I am tempted to create a new page, linked to from the main table of contents, that lists all of Sage's packages, with web pages for each. For Maxima, since we have a well-defined way to do it, we could list the local documentation, too. As we figure out what to do with other packages, we can add their local documentation to that list. So it would look something like:\n> \n> ```\n> * alabaster - link to alabaster web page\n> * appnope - link to web page\n> * arb - \n> ...\n> * maxima: local documentation: .... web page: ...\n> ...\n> ```\n> \n> Opinions?\n\nIn #29633, I suggest to generate this page from information in build/pkgs.",
    "created_at": "2020-05-02T02:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425640",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@jhpalmieri](#comment:73):
> I am tempted to create a new page, linked to from the main table of contents, that lists all of Sage's packages, with web pages for each. For Maxima, since we have a well-defined way to do it, we could list the local documentation, too. As we figure out what to do with other packages, we can add their local documentation to that list. So it would look something like:
> 
> ```
> * alabaster - link to alabaster web page
> * appnope - link to web page
> * arb - 
> ...
> * maxima: local documentation: .... web page: ...
> ...
> ```
> 
> Opinions?

In #29633, I suggest to generate this page from information in build/pkgs.



---

archive/issue_comments_425641.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nWith #29633, links to external packages' documentation can now be simply added to `SPKG.rst`",
    "created_at": "2020-05-03T15:12:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425641",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

With #29633, links to external packages' documentation can now be simply added to `SPKG.rst`



---

archive/issue_events_379441.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-03T15:26:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379441"
}
```



---

archive/issue_events_379442.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-03T15:26:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379442"
}
```



---

archive/issue_events_379443.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379443"
}
```



---

archive/issue_events_379444.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379444"
}
```



---

archive/issue_comments_425642.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425642",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">comment:80</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_425643.json:
```json
{
    "body": "Changed keywords from none to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425643",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **sd111**



---

archive/issue_comments_425644.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,18 @@\n-To provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.\n+We wish to link to external packages' documentation:\n+- if the package documentation is installed locally in the Sage distribution, using the file link \n+- in downstream packaging, using a file link appropriate for the doc installation scheme of the system (without having to patch the documentation)\n+- if it is not available locally, using an http link to an online version of the package's documentation.\n \n-Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.\n+To this end, we use the [sphinx.ext.extlinks](https://www.sphinx-doc.org/en/master/usage/extensions/extlinks.html) facility, for which we already have infrastructure in `sage.misc.sagedoc`, assigning a Sphinx role to every external document.\n \n-in particular, this corrects the defect of `http://doc.sagemath.org` that SageNB docs are no longer available there, something that was repeatedly mentioned on sage-dev.\n- .\n+We use a systematic naming scheme for these roles: `:spkg_SPKG_DOC:` where `DOC` is usually just `doc` but if a package has several manuals, it can be used to distinguish them.\n \n+In this ticket, we do this for the documents covered by a previous iteration of this ticket:\n+* `:spkg_gc_doc:` `GC garbage collector <@SAGE_SHARE@/doc/gc/overview.html>`_\n+* `:spkg_giac_doc:` `Giac/Xcas documentation <@SAGE_SHARE@/doc/giac/index.html>`_ https://www-fourier.ujf-grenoble.fr/~parisse/giac/doc/en/cascmd_en/cascmd_en.html\n+* `:spkg_ppl_doc:` `PPL User manual <@SAGE_SHARE@/doc/ppl/ppl-user-1.2-html/index.html>`_  https://www.bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/index.html\n+* `:spkg_pplpy_doc:` `Python Wrapper for PPL (pplpy) <@SAGE_SHARE@/doc/pplpy/index.html>`_\n+* `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm\n+* `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html\n+\n+\n``````\n",
    "created_at": "2021-01-02T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425644",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,18 @@
-To provide links to e.g. sagenb docs there, by putting in full paths to the corresponding files.
+We wish to link to external packages' documentation:
+- if the package documentation is installed locally in the Sage distribution, using the file link 
+- in downstream packaging, using a file link appropriate for the doc installation scheme of the system (without having to patch the documentation)
+- if it is not available locally, using an http link to an online version of the package's documentation.
 
-Unfortunately Sphinx does not seem to provide a way to template data like `$SAGE_LOCAL`, we get `index.rst.in` filled in by configure.
+To this end, we use the [sphinx.ext.extlinks](https://www.sphinx-doc.org/en/master/usage/extensions/extlinks.html) facility, for which we already have infrastructure in `sage.misc.sagedoc`, assigning a Sphinx role to every external document.
 
-in particular, this corrects the defect of `http://doc.sagemath.org` that SageNB docs are no longer available there, something that was repeatedly mentioned on sage-dev.
- .
+We use a systematic naming scheme for these roles: `:spkg_SPKG_DOC:` where `DOC` is usually just `doc` but if a package has several manuals, it can be used to distinguish them.
 
+In this ticket, we do this for the documents covered by a previous iteration of this ticket:
+* `:spkg_gc_doc:` `GC garbage collector <@SAGE_SHARE@/doc/gc/overview.html>`_
+* `:spkg_giac_doc:` `Giac/Xcas documentation <@SAGE_SHARE@/doc/giac/index.html>`_ https://www-fourier.ujf-grenoble.fr/~parisse/giac/doc/en/cascmd_en/cascmd_en.html
+* `:spkg_ppl_doc:` `PPL User manual <@SAGE_SHARE@/doc/ppl/ppl-user-1.2-html/index.html>`_  https://www.bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/index.html
+* `:spkg_pplpy_doc:` `Python Wrapper for PPL (pplpy) <@SAGE_SHARE@/doc/pplpy/index.html>`_
+* `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm
+* `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html
+
+
``````




---

archive/issue_comments_425645.json:
```json
{
    "body": "Changed author from **Dima Pasechnik, John Palmieri** to none",
    "created_at": "2021-01-02T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425645",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Dima Pasechnik, John Palmieri** to none



---

archive/issue_comments_425646.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doc/docrefs)** to none",
    "created_at": "2021-01-02T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425646",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/jhpalmieri/doc/docrefs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/doc/docrefs)** to none



---

archive/issue_comments_425647.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to none",
    "created_at": "2021-01-02T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425647",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Dima Pasechnik** to none



---

archive/issue_events_379445.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-02T20:05:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "title_is": "Use sphinx.ext.extlinks to add Sphinx roles for links to external package docs",
    "title_was": "links to external docs in main reference index.rst",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379445"
}
```



---

archive/issue_comments_425648.json:
```json
{
    "body": "Changed commit from **[`dab737d`](https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979)** to none",
    "created_at": "2021-01-02T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425648",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`dab737d`](https://github.com/sagemath/sagetrac-mirror/commit/dab737d291ae450e680df4f0edfbaa45d2414979)** to none



---

archive/issue_comments_425649.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,4 +15,7 @@\n * `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm\n * `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html\n \n+Related:\n+- #29231 add intersphinx mapping for SciPy\n \n+\n``````\n",
    "created_at": "2021-01-02T20:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425649",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,4 +15,7 @@
 * `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm
 * `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html
 
+Related:
+- #29231 add intersphinx mapping for SciPy
 
+
``````




---

archive/issue_comments_425650.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,6 +15,9 @@\n * `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm\n * `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html\n \n+The location of some of the locally installed documentation files can be determined at runtime, see [#27495 comment:58](https://github.com/sagemath/sage/issues/27495#comment:58) for maxima.\n+This should probably go through `sage.feature`.\n+\n Related:\n - #29231 add intersphinx mapping for SciPy\n \n``````\n",
    "created_at": "2021-01-03T19:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425650",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,6 +15,9 @@
 * `:spkg_singular_doc:` `Singular User Manual <@SAGE_SHARE@/singular/html/index.htm>`_ https://www.singular.uni-kl.de/Manual/4-2-0/index.htm
 * `spkg_maxima_doc`: `Introduction to Maxima <@SAGE_SHARE@/maxima/@MAXIMA_VERSION@/doc/html/intromax.html>`_ https://maxima.sourceforge.io/docs/manual/maxima_0.html
 
+The location of some of the locally installed documentation files can be determined at runtime, see [#27495 comment:58](https://github.com/sagemath/sage/issues/27495#comment:58) for maxima.
+This should probably go through `sage.feature`.
+
 Related:
 - #29231 add intersphinx mapping for SciPy
 
``````




---

archive/issue_events_379446.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379446"
}
```



---

archive/issue_events_379447.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379447"
}
```



---

archive/issue_comments_425651.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425651",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_425652.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,5 +20,6 @@\n \n Related:\n - #29231 add intersphinx mapping for SciPy\n+- https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ\n+- 29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf\n \n-\n``````\n",
    "created_at": "2021-02-17T05:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425652",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,5 +20,6 @@
 
 Related:
 - #29231 add intersphinx mapping for SciPy
+- https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ
+- 29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf
 
-
``````




---

archive/issue_comments_425653.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,5 +21,5 @@\n Related:\n - #29231 add intersphinx mapping for SciPy\n - https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ\n-- 29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf\n+- #29868 pip-installable packages `sagemath-doc-src`, `sagemath-doc-inventory`, `sagemath-doc-html`, `sagemath-doc-pdf`\n \n``````\n",
    "created_at": "2021-02-17T06:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425653",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,5 +21,5 @@
 Related:
 - #29231 add intersphinx mapping for SciPy
 - https://groups.google.com/g/sage-devel/c/oWkFwhinoMc/m/JpighcELBgAJ
-- 29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf
+- #29868 pip-installable packages `sagemath-doc-src`, `sagemath-doc-inventory`, `sagemath-doc-html`, `sagemath-doc-pdf`
 
``````




---

archive/issue_comments_425654.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nJust bikeshedding, but I don't know why the verbose names like `:spkg_giac_doc:` and not just something like `:giac:`.  I understand `giac_doc` is supposed to refer to an SPKG specifically for the GIAC docs, but in the context of the documentation that should be a given anyways.\n\nAlso how does this relate to other Python packages that already use Sphinx, and can use intersphinx instead?",
    "created_at": "2021-02-26T11:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425654",
    "user": "https://github.com/embray"
}
```

<div id="comment:89" align="right">comment:89</div>

Just bikeshedding, but I don't know why the verbose names like `:spkg_giac_doc:` and not just something like `:giac:`.  I understand `giac_doc` is supposed to refer to an SPKG specifically for the GIAC docs, but in the context of the documentation that should be a given anyways.

Also how does this relate to other Python packages that already use Sphinx, and can use intersphinx instead?



---

archive/issue_comments_425655.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@embray](#comment:89):\n> Just bikeshedding, but I don't know why the verbose names like `:spkg_giac_doc:` and not just something like `:giac:`.\n\nFine with me to simplify these names. \n\n> Also how does this relate to other Python packages that already use Sphinx, and can use intersphinx instead?\n\nThe present ticket here is easier and can set the naming convention.\n\nPackages where we can do intersphinx should use a compatible naming convention.",
    "created_at": "2021-02-26T16:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425655",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@embray](#comment:89):
> Just bikeshedding, but I don't know why the verbose names like `:spkg_giac_doc:` and not just something like `:giac:`.

Fine with me to simplify these names. 

> Also how does this relate to other Python packages that already use Sphinx, and can use intersphinx instead?

The present ticket here is easier and can set the naming convention.

Packages where we can do intersphinx should use a compatible naming convention.



---

archive/issue_comments_425656.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27495#issuecomment-425656",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:91" align="right">comment:91</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_379448.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379448"
}
```



---

archive/issue_events_379449.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379449"
}
```



---

archive/issue_events_379450.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379450"
}
```



---

archive/issue_events_379451.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379451"
}
```



---

archive/issue_events_379452.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379452"
}
```



---

archive/issue_events_379453.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379453"
}
```



---

archive/issue_events_379454.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379454"
}
```



---

archive/issue_events_379455.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27495",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27495#event-379455"
}
```
