# Issue 27670: package install can print confusing error messages

archive/issues_027433.json:
```json
{
    "body": "For example, while installing the kash3 package, the output includes the following lines:\n\n```\nusage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]\nsage-spkg-uninstall: error: argument spkg: invalid spkg_type value: 'kash3'\n```\n\nThis is due to the uninstall script throwing incorrect error types. \nAfter applying this ticket's patch, the output reads:\n\n```\nusage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]\nsage-spkg-uninstall: error: argument spkg: 'kash3' is not a known spkg\n```\n\nWhich is at least more sensible.  `kash3` is not known because it is an old-style package that didn't create a directory in `build/pkgs`.\n\nCC:  @embray @slel\n\nKeywords: spkg, uninstall\n\nBranch/Commit: [f0afed6177a8f298d7aadd465a0e4ba137d27f27](https://github.com/sagemath/sagetrac-mirror/commit/f0afed6177a8f298d7aadd465a0e4ba137d27f27)\n\nReviewer: Erik Bray\n\nAuthor: Brent Baccala\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27670\n\n",
    "closed_at": "2019-04-29T11:50:41Z",
    "created_at": "2019-04-15T14:24:04Z",
    "labels": [
        "component: packages: optional",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "package install can print confusing error messages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27670",
    "user": "https://github.com/BrentBaccala"
}
```
For example, while installing the kash3 package, the output includes the following lines:

```
usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]
sage-spkg-uninstall: error: argument spkg: invalid spkg_type value: 'kash3'
```

This is due to the uninstall script throwing incorrect error types. 
After applying this ticket's patch, the output reads:

```
usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]
sage-spkg-uninstall: error: argument spkg: 'kash3' is not a known spkg
```

Which is at least more sensible.  `kash3` is not known because it is an old-style package that didn't create a directory in `build/pkgs`.

CC:  @embray @slel

Keywords: spkg, uninstall

Branch/Commit: [f0afed6177a8f298d7aadd465a0e4ba137d27f27](https://github.com/sagemath/sagetrac-mirror/commit/f0afed6177a8f298d7aadd465a0e4ba137d27f27)

Reviewer: Erik Bray

Author: Brent Baccala

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27670





---

archive/issue_comments_535707.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535707",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_535708.json:
```json
{
    "body": "<a id='comment:1'></a>\n(Wrong branch - fixed below)",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535708",
    "user": "https://github.com/BrentBaccala"
}
```

<a id='comment:1'></a>
(Wrong branch - fixed below)



---

archive/issue_comments_535709.json:
```json
{
    "body": "Changing commit from \"\" to \"c50153a0ceee156c5a38475ba48aabd5571cecb9\"",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535709",
    "user": "https://github.com/BrentBaccala"
}
```

Changing commit from "" to "c50153a0ceee156c5a38475ba48aabd5571cecb9"



---

archive/issue_comments_535710.json:
```json
{
    "body": "Changing branch from \"\" to \"public/27607\"",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535710",
    "user": "https://github.com/BrentBaccala"
}
```

Changing branch from "" to "public/27607"



---

archive/issue_comments_535711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,16 @@\n-This is due to the uninstall script throwing incorrect error types.\n+For example, while installing the kash3 package, the output includes the following lines:\n \n+```\n+usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]\n+sage-spkg-uninstall: error: argument spkg: invalid spkg_type value: 'kash3'\n+```\n+\n+This is due to the uninstall script throwing incorrect error types. \n+After applying this ticket's patch, the output reads:\n+\n+```\n+usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]\n+sage-spkg-uninstall: error: argument spkg: 'kash3' is not a known spkg\n+```\n+\n+Which is at least more sensible.  `kash3` is not known because it is an old-style package that didn't create a directory in `build/pkgs`.\n``````\n",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535711",
    "user": "https://github.com/BrentBaccala"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,16 @@
-This is due to the uninstall script throwing incorrect error types.
+For example, while installing the kash3 package, the output includes the following lines:
 
+```
+usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]
+sage-spkg-uninstall: error: argument spkg: invalid spkg_type value: 'kash3'
+```
+
+This is due to the uninstall script throwing incorrect error types. 
+After applying this ticket's patch, the output reads:
+
+```
+usage: sage-spkg-uninstall [-h] [-v] [-k] spkg [sage_local]
+sage-spkg-uninstall: error: argument spkg: 'kash3' is not a known spkg
+```
+
+Which is at least more sensible.  `kash3` is not known because it is an old-style package that didn't create a directory in `build/pkgs`.
``````




---

archive/issue_comments_535712.json:
```json
{
    "body": "Changing author from \"\" to \"Brent Baccala\"",
    "created_at": "2019-04-16T01:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535712",
    "user": "https://github.com/BrentBaccala"
}
```

Changing author from "" to "Brent Baccala"



---

archive/issue_comments_535713.json:
```json
{
    "body": "Changing branch from \"public/27607\" to \"public/27670\"",
    "created_at": "2019-04-16T01:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535713",
    "user": "https://github.com/BrentBaccala"
}
```

Changing branch from "public/27607" to "public/27670"



---

archive/issue_comments_535714.json:
```json
{
    "body": "Changing commit from \"c50153a0ceee156c5a38475ba48aabd5571cecb9\" to \"f0afed6177a8f298d7aadd465a0e4ba137d27f27\"",
    "created_at": "2019-04-16T01:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535714",
    "user": "https://github.com/BrentBaccala"
}
```

Changing commit from "c50153a0ceee156c5a38475ba48aabd5571cecb9" to "f0afed6177a8f298d7aadd465a0e4ba137d27f27"



---

archive/issue_comments_535715.json:
```json
{
    "body": "Changing branch from \"public/27670\" to \"\"",
    "created_at": "2019-04-16T01:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535715",
    "user": "https://github.com/BrentBaccala"
}
```

Changing branch from "public/27670" to ""



---

archive/issue_comments_535716.json:
```json
{
    "body": "Changing commit from \"f0afed6177a8f298d7aadd465a0e4ba137d27f27\" to \"\"",
    "created_at": "2019-04-16T01:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535716",
    "user": "https://github.com/BrentBaccala"
}
```

Changing commit from "f0afed6177a8f298d7aadd465a0e4ba137d27f27" to ""



---

archive/issue_comments_535717.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[f0afed6](https://github.com/sagemath/sagetrac-mirror/commit/f0afed6177a8f298d7aadd465a0e4ba137d27f27)|`Trac #27670: throw correct error types in uninstall script`|",
    "created_at": "2019-04-16T01:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535717",
    "user": "https://github.com/BrentBaccala"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[f0afed6](https://github.com/sagemath/sagetrac-mirror/commit/f0afed6177a8f298d7aadd465a0e4ba137d27f27)|`Trac #27670: throw correct error types in uninstall script`|



---

archive/issue_comments_535718.json:
```json
{
    "body": "Changing commit from \"\" to \"f0afed6177a8f298d7aadd465a0e4ba137d27f27\"",
    "created_at": "2019-04-16T01:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535718",
    "user": "https://github.com/BrentBaccala"
}
```

Changing commit from "" to "f0afed6177a8f298d7aadd465a0e4ba137d27f27"



---

archive/issue_comments_535719.json:
```json
{
    "body": "Changing branch from \"\" to \"public/27670\"",
    "created_at": "2019-04-16T01:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535719",
    "user": "https://github.com/BrentBaccala"
}
```

Changing branch from "" to "public/27670"



---

archive/issue_comments_535720.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg, uninstall\".",
    "created_at": "2019-04-18T07:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535720",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "spkg, uninstall".



---

archive/issue_comments_535721.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-18T11:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535721",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_535722.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis fix makes sense in its own right so +1.\n\nSupport for old-style SPKGs is deprecated and should be removed completely.\n\nThe only reason it hasn't been completely removed is last time the question came up there was paralysis about what to do about one particularly large package that would need to be hosted somewhere if it were converted to a new-style SPKG.\n\nIn that case it was just a large database, and is so large in fact that I'm not convinced downloading the whole database is the right thing to do in most cases anyways. It should be wrapped in a little queryable web service hosted online somewhere (perhaps even sagemath.org). Someone just needs to do that. I don't think that one package is reason enough to hold up removal of old-style SPKG support though.",
    "created_at": "2019-04-18T11:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535722",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
This fix makes sense in its own right so +1.

Support for old-style SPKGs is deprecated and should be removed completely.

The only reason it hasn't been completely removed is last time the question came up there was paralysis about what to do about one particularly large package that would need to be hosted somewhere if it were converted to a new-style SPKG.

In that case it was just a large database, and is so large in fact that I'm not convinced downloading the whole database is the right thing to do in most cases anyways. It should be wrapped in a little queryable web service hosted online somewhere (perhaps even sagemath.org). Someone just needs to do that. I don't think that one package is reason enough to hold up removal of old-style SPKG support though.



---

archive/issue_comments_535723.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Erik Bray\"",
    "created_at": "2019-04-18T11:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535723",
    "user": "https://github.com/embray"
}
```

Changing reviewer from "" to "Erik Bray"



---

archive/issue_comments_535724.json:
```json
{
    "body": "Changing branch from \"public/27670\" to \"f0afed6177a8f298d7aadd465a0e4ba137d27f27\"",
    "created_at": "2019-04-29T11:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535724",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/27670" to "f0afed6177a8f298d7aadd465a0e4ba137d27f27"



---

archive/issue_comments_535725.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-29T11:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27670#issuecomment-535725",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_077829.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-29T11:50:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27670#event-77829"
}
```
