# Issue 27642: Re-run configure+make after installing an SPKG with sage -i

archive/issues_027405.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis is an idea for fixing #27373.\n\nAs explained in [comment#73](https://github.com/sagemath/sage/issues/27373#comment:73) on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).\n\nThis is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.\n\nFurther, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.\n\nThis also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.\n\nDepends on #27641\n\nCC:  @dimpase\n\nComponent: **build**\n\nAuthor: **Erik Bray**\n\nBranch/Commit: **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642) @ [`e168732`](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27642_\n\n",
    "closed_at": "2019-05-12T21:31:11Z",
    "created_at": "2019-04-11T10:49:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Re-run configure+make after installing an SPKG with sage -i",
    "type": "issue",
    "updated_at": "2019-06-11T10:46:26Z",
    "url": "https://github.com/sagemath/sage/issues/27642",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

This is an idea for fixing #27373.

As explained in [comment#73](https://github.com/sagemath/sage/issues/27373#comment:73) on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).

This is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.

Further, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.

This also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.

Depends on #27641

CC:  @dimpase

Component: **build**

Author: **Erik Bray**

Branch/Commit: **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642) @ [`e168732`](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/27642_





---

archive/issue_events_376407.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376407"
}
```



---

archive/issue_events_376408.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376408"
}
```



---

archive/issue_events_376409.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376409"
}
```



---

archive/issue_events_376410.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376410"
}
```



---

archive/issue_comments_428322.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis branch mostly fixes the bug in #27373 for me.\n\nAs noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315\"><code>687cdf0</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360\"><code>6de961d</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907\"><code>f76d6d5</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7\"><code>5f90ff7</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610\"><code>3dee97c</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e\"><code>0308142</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5\"><code>eea0685</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f29e86037306cd31422e10ab2b9c4d9963ed486\"><code>6f29e86</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2bab81a11e70bdb303ab54799516a6ae948c398\"><code>a2bab81</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15\"><code>a29056a</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428322",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

This branch mostly fixes the bug in #27373 for me.

As noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315"><code>687cdf0</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360"><code>6de961d</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907"><code>f76d6d5</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7"><code>5f90ff7</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610"><code>3dee97c</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e"><code>0308142</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5"><code>eea0685</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f29e86037306cd31422e10ab2b9c4d9963ed486"><code>6f29e86</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2bab81a11e70bdb303ab54799516a6ae948c398"><code>a2bab81</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15"><code>a29056a</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_428323.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428323",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_428324.json:
```json
{
    "body": "Commit: **[`a29056a`](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428324",
    "user": "https://github.com/embray"
}
```

Commit: **[`a29056a`](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)**



---

archive/issue_comments_428325.json:
```json
{
    "body": "Branch: **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428325",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)**



---

archive/issue_comments_428326.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\ncould you rebase it?",
    "created_at": "2019-04-24T13:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428326",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

could you rebase it?



---

archive/issue_comments_428327.json:
```json
{
    "body": "Changed branch from **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)** to **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642)**",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428327",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)** to **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642)**



---

archive/issue_comments_428328.json:
```json
{
    "body": "Changed commit from **[`a29056a`](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)** to **[`248c071`](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)**",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428328",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`a29056a`](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)** to **[`248c071`](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)**



---

archive/issue_comments_428329.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409\"><code>191269e</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9c9a91dd0b142da16409f28ddb1bc476d052b15\"><code>f9c9a91</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0\"><code>248c071</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428329",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409"><code>191269e</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9c9a91dd0b142da16409f28ddb1bc476d052b15"><code>f9c9a91</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0"><code>248c071</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_428330.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nTrying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).",
    "created_at": "2019-05-03T14:50:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428330",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

Trying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).



---

archive/issue_events_376411.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T14:50:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376411"
}
```



---

archive/issue_comments_428331.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409\"><code>191269e</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c24df14e480b860f83e7bbe1d4f1b86f6d42398\"><code>1c24df1</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc8fd7fab0f43c40a8c3f693bc32976af0462960\"><code>dc8fd7f</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9\"><code>4bce1a3</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-03T17:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428331",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409"><code>191269e</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c24df14e480b860f83e7bbe1d4f1b86f6d42398"><code>1c24df1</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc8fd7fab0f43c40a8c3f693bc32976af0462960"><code>dc8fd7f</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9"><code>4bce1a3</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_428332.json:
```json
{
    "body": "Changed commit from **[`248c071`](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)** to **[`4bce1a3`](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)**",
    "created_at": "2019-05-03T17:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428332",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`248c071`](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)** to **[`4bce1a3`](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)**



---

archive/issue_comments_428333.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nrebased over updated  #27641",
    "created_at": "2019-05-03T17:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428333",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

rebased over updated  #27641



---

archive/issue_comments_428334.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-05-03T17:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428334",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_376412.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T17:20:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376412"
}
```



---

archive/issue_events_376413.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T17:20:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376413"
}
```



---

archive/issue_comments_428335.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nnow this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...",
    "created_at": "2019-05-03T17:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428335",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

now this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...



---

archive/issue_comments_428336.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYour rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)",
    "created_at": "2019-05-06T16:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428336",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Your rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)



---

archive/issue_comments_428337.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.\n`",
    "created_at": "2019-05-06T17:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428337",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.
`



---

archive/issue_comments_428338.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMore precisely, you overwrote this change in [#27641 comment:15](https://github.com/sagemath/sage/issues/27641#comment:15)",
    "created_at": "2019-05-06T17:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428338",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

More precisely, you overwrote this change in [#27641 comment:15](https://github.com/sagemath/sage/issues/27641#comment:15)



---

archive/issue_comments_428339.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nRight. That was intentional.  It should *not* be changed.",
    "created_at": "2019-05-07T16:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428339",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Right. That was intentional.  It should *not* be changed.



---

archive/issue_comments_428340.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@embray](#comment%3A11):\n> Right. That was intentional.  It should *not* be changed.\n\nShould I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?",
    "created_at": "2019-05-07T16:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428340",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@embray](#comment%3A11):
> Right. That was intentional.  It should *not* be changed.

Should I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?



---

archive/issue_comments_428341.json:
```json
{
    "body": "Changed commit from **[`4bce1a3`](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)** to **[`18d612d`](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)**",
    "created_at": "2019-05-08T10:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428341",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4bce1a3`](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)** to **[`18d612d`](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)**



---

archive/issue_comments_428342.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267\"><code>18d612d</code></a></td><td><code>leave GMP's spkg-configure.m4 as it was</code></td></tr></table>\n",
    "created_at": "2019-05-08T10:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428342",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267"><code>18d612d</code></a></td><td><code>leave GMP's spkg-configure.m4 as it was</code></td></tr></table>




---

archive/issue_events_376414.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T10:08:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376414"
}
```



---

archive/issue_events_376415.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T10:08:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376415"
}
```



---

archive/issue_comments_428343.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.",
    "created_at": "2019-05-10T11:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428343",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

This is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.



---

archive/issue_events_376416.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-10T11:00:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376416"
}
```



---

archive/issue_events_376417.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-10T11:00:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376417"
}
```



---

archive/issue_comments_428344.json:
```json
{
    "body": "Changed commit from **[`18d612d`](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)** to **[`e168732`](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**",
    "created_at": "2019-05-10T11:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428344",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`18d612d`](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)** to **[`e168732`](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**



---

archive/issue_comments_428345.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9bbdd48eb4a73bcc913c2f3d2ac5eecd15adf52\"><code>d9bbdd4</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3605187face93bd02a16089ce1121a7348ed2a3\"><code>a360518</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e\"><code>e168732</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-10T11:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428345",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9bbdd48eb4a73bcc913c2f3d2ac5eecd15adf52"><code>d9bbdd4</code></a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3605187face93bd02a16089ce1121a7348ed2a3"><code>a360518</code></a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e"><code>e168732</code></a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_428346.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nUpdated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.",
    "created_at": "2019-05-10T11:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428346",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Updated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.



---

archive/issue_events_376418.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:31:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376418"
}
```



---

archive/issue_events_376419.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:31:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-376419"
}
```



---

archive/issue_comments_428347.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nToo late, a previous version of this branch was released in 8.8.beta5",
    "created_at": "2019-05-12T21:31:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428347",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

Too late, a previous version of this branch was released in 8.8.beta5



---

archive/issue_comments_428348.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI am afraid it has to be reverted. It's not good as it is now.",
    "created_at": "2019-05-12T21:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428348",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

I am afraid it has to be reverted. It's not good as it is now.



---

archive/issue_comments_428349.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSee #27820",
    "created_at": "2019-05-13T09:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428349",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

See #27820



---

archive/issue_comments_428350.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?",
    "created_at": "2019-05-13T09:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428350",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?



---

archive/issue_comments_428351.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@embray](#comment%3A21):\n> I'm confused.  How was it merged?  It was not set to positive review,\n\nit was, see [comment:14](#comment%3A14) \n\nI gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump",
    "created_at": "2019-05-13T10:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428351",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@embray](#comment%3A21):
> I'm confused.  How was it merged?  It was not set to positive review,

it was, see [comment:14](#comment%3A14) 

I gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump



---

archive/issue_comments_428352.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI can confirm that this branch is merged in 8.8.rc0.\nSo this is done and dusted.",
    "created_at": "2019-06-11T10:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-428352",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

I can confirm that this branch is merged in 8.8.rc0.
So this is done and dusted.
