# Issue 27642: Re-run configure+make after installing an SPKG with sage -i

archive/issues_027405.json:
```json
{
    "assignees": [],
    "body": "This is an idea for fixing #27373.\n\nAs explained in [comment#73](https://github.com/sagemath/sage/issues/27373#comment:73) on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).\n\nThis is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.\n\nFurther, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.\n\nThis also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.\n\nDepends on #27641\n\nCC:  @dimpase\n\nBranch/Commit: **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642) @ [e168732](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27642_\n\n",
    "closed_at": "2019-05-12T21:31:11Z",
    "created_at": "2019-04-11T10:49:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Re-run configure+make after installing an SPKG with sage -i",
    "type": "issue",
    "updated_at": "2019-06-11T10:46:26Z",
    "url": "https://github.com/sagemath/sage/issues/27642",
    "user": "https://github.com/embray"
}
```
This is an idea for fixing #27373.

As explained in [comment#73](https://github.com/sagemath/sage/issues/27373#comment:73) on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).

This is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.

Further, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.

This also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.

Depends on #27641

CC:  @dimpase

Branch/Commit: **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642) @ [e168732](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**

Reviewer: **Dima Pasechnik**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/27642_





---

archive/issue_events_361156.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361156"
}
```



---

archive/issue_events_361157.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361157"
}
```



---

archive/issue_events_361158.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361158"
}
```



---

archive/issue_events_361159.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-11T10:49:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361159"
}
```



---

archive/issue_comments_431293.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThis branch mostly fixes the bug in #27373 for me.\n\nAs noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315\">687cdf0</a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360\">6de961d</a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907\">f76d6d5</a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7\">5f90ff7</a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610\">3dee97c</a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e\">0308142</a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5\">eea0685</a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f29e86037306cd31422e10ab2b9c4d9963ed486\">6f29e86</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2bab81a11e70bdb303ab54799516a6ae948c398\">a2bab81</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15\">a29056a</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431293",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'>Comment 1:</a>
This branch mostly fixes the bug in #27373 for me.

As noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315">687cdf0</a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360">6de961d</a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907">f76d6d5</a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7">5f90ff7</a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610">3dee97c</a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e">0308142</a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5">eea0685</a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f29e86037306cd31422e10ab2b9c4d9963ed486">6f29e86</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2bab81a11e70bdb303ab54799516a6ae948c398">a2bab81</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15">a29056a</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_431294.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431294",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_431295.json:
```json
{
    "body": "Commit: **[a29056a](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431295",
    "user": "https://github.com/embray"
}
```

Commit: **[a29056a](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)**



---

archive/issue_comments_431296.json:
```json
{
    "body": "Branch: **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)**",
    "created_at": "2019-04-11T10:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431296",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)**



---

archive/issue_comments_431297.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\ncould you rebase it?",
    "created_at": "2019-04-24T13:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431297",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'>Comment 2:</a>
could you rebase it?



---

archive/issue_comments_431298.json:
```json
{
    "body": "Changed branch from **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)** to **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642)**",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431298",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/embray/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-27642)** to **[public/build/ticket-27642](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ticket-27642)**



---

archive/issue_comments_431299.json:
```json
{
    "body": "Changed commit from **[a29056a](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)** to **[248c071](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)**",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431299",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[a29056a](https://github.com/sagemath/sagetrac-mirror/commit/a29056a29dbd0ec6188457c06d1e797644913c15)** to **[248c071](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)**



---

archive/issue_comments_431300.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409\">191269e</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9c9a91dd0b142da16409f28ddb1bc476d052b15\">f9c9a91</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0\">248c071</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-03T14:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431300",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409">191269e</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9c9a91dd0b142da16409f28ddb1bc476d052b15">f9c9a91</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0">248c071</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_431301.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nTrying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).",
    "created_at": "2019-05-03T14:50:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431301",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
Trying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).



---

archive/issue_events_361160.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T14:50:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361160"
}
```



---

archive/issue_comments_431302.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409\">191269e</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c24df14e480b860f83e7bbe1d4f1b86f6d42398\">1c24df1</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc8fd7fab0f43c40a8c3f693bc32976af0462960\">dc8fd7f</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9\">4bce1a3</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-03T17:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431302",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/191269eb7eabf2a6f26bf97a99eacc19b2c9b409">191269e</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c24df14e480b860f83e7bbe1d4f1b86f6d42398">1c24df1</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc8fd7fab0f43c40a8c3f693bc32976af0462960">dc8fd7f</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9">4bce1a3</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_431303.json:
```json
{
    "body": "Changed commit from **[248c071](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)** to **[4bce1a3](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)**",
    "created_at": "2019-05-03T17:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431303",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[248c071](https://github.com/sagemath/sagetrac-mirror/commit/248c071fa16ce48c0c2635b28e84db151d008da0)** to **[4bce1a3](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)**



---

archive/issue_comments_431304.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nrebased over updated  #27641",
    "created_at": "2019-05-03T17:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431304",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'>Comment 6:</a>
rebased over updated  #27641



---

archive/issue_comments_431305.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-05-03T17:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431305",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_361161.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T17:20:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361161"
}
```



---

archive/issue_events_361162.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T17:20:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361162"
}
```



---

archive/issue_comments_431306.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nnow this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...",
    "created_at": "2019-05-03T17:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431306",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
now this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...



---

archive/issue_comments_431307.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nYour rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)",
    "created_at": "2019-05-06T16:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431307",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'>Comment 8:</a>
Your rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)



---

archive/issue_comments_431308.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\n`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.\n`",
    "created_at": "2019-05-06T17:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431308",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'>Comment 9:</a>
`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.
`



---

archive/issue_comments_431309.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nMore precisely, you overwrote this change in [#27641 comment:15](https://github.com/sagemath/sage/issues/27641#comment:15)",
    "created_at": "2019-05-06T17:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431309",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'>Comment 10:</a>
More precisely, you overwrote this change in [#27641 comment:15](https://github.com/sagemath/sage/issues/27641#comment:15)



---

archive/issue_comments_431310.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nRight. That was intentional.  It should *not* be changed.",
    "created_at": "2019-05-07T16:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431310",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'>Comment 11:</a>
Right. That was intentional.  It should *not* be changed.



---

archive/issue_comments_431311.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@embray](#comment%3A11):\n> Right. That was intentional.  It should *not* be changed.\n\nShould I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?",
    "created_at": "2019-05-07T16:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431311",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@embray](#comment%3A11):
> Right. That was intentional.  It should *not* be changed.

Should I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?



---

archive/issue_comments_431312.json:
```json
{
    "body": "Changed commit from **[4bce1a3](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)** to **[18d612d](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)**",
    "created_at": "2019-05-08T10:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431312",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4bce1a3](https://github.com/sagemath/sagetrac-mirror/commit/4bce1a36e95a6b18ed5ade3e4267df4045aa6bc9)** to **[18d612d](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)**



---

archive/issue_comments_431313.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267\">18d612d</a></td><td><code>leave GMP's spkg-configure.m4 as it was</code></td></tr></table>\n",
    "created_at": "2019-05-08T10:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431313",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267">18d612d</a></td><td><code>leave GMP's spkg-configure.m4 as it was</code></td></tr></table>




---

archive/issue_events_361163.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T10:08:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361163"
}
```



---

archive/issue_events_361164.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T10:08:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361164"
}
```



---

archive/issue_comments_431314.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThis is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.",
    "created_at": "2019-05-10T11:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431314",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'>Comment 15:</a>
This is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.



---

archive/issue_events_361165.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-10T11:00:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361165"
}
```



---

archive/issue_events_361166.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-10T11:00:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361166"
}
```



---

archive/issue_comments_431315.json:
```json
{
    "body": "Changed commit from **[18d612d](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)** to **[e168732](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**",
    "created_at": "2019-05-10T11:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[18d612d](https://github.com/sagemath/sagetrac-mirror/commit/18d612df2b6d24200d6910924241c1694cf97267)** to **[e168732](https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e)**



---

archive/issue_comments_431316.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9bbdd48eb4a73bcc913c2f3d2ac5eecd15adf52\">d9bbdd4</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3605187face93bd02a16089ce1121a7348ed2a3\">a360518</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e\">e168732</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>\n",
    "created_at": "2019-05-10T11:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431316",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9bbdd48eb4a73bcc913c2f3d2ac5eecd15adf52">d9bbdd4</a></td><td><code>Add support for unconditional pre- and post-check actions in spkg-configure.m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3605187face93bd02a16089ce1121a7348ed2a3">a360518</a></td><td><code>Refactor the mpir/spkg-configure.m4 (and to a lesser extent the one for gmp) to use the new pre and post arguments to SAGE_SPKG_CONFIGURE</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e16873284b5cec5c813bcf38861e0aa42ff2b93e">e168732</a></td><td><code>Trac #27642: Initial attempt at fix: re-run `configure` and `make all-build` after</code></td></tr></table>




---

archive/issue_comments_431317.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nUpdated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.",
    "created_at": "2019-05-10T11:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431317",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'>Comment 17:</a>
Updated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.



---

archive/issue_events_361167.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:31:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361167"
}
```



---

archive/issue_events_361168.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:31:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27642#event-361168"
}
```



---

archive/issue_comments_431318.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nToo late, a previous version of this branch was released in 8.8.beta5",
    "created_at": "2019-05-12T21:31:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431318",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'>Comment 18:</a>
Too late, a previous version of this branch was released in 8.8.beta5



---

archive/issue_comments_431319.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI am afraid it has to be reverted. It's not good as it is now.",
    "created_at": "2019-05-12T21:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431319",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'>Comment 19:</a>
I am afraid it has to be reverted. It's not good as it is now.



---

archive/issue_comments_431320.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nSee #27820",
    "created_at": "2019-05-13T09:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431320",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'>Comment 20:</a>
See #27820



---

archive/issue_comments_431321.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?",
    "created_at": "2019-05-13T09:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431321",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'>Comment 21:</a>
I'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?



---

archive/issue_comments_431322.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@embray](#comment%3A21):\n> I'm confused.  How was it merged?  It was not set to positive review,\n\nit was, see [comment:14](#comment%3A14) \n\nI gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump",
    "created_at": "2019-05-13T10:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431322",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@embray](#comment%3A21):
> I'm confused.  How was it merged?  It was not set to positive review,

it was, see [comment:14](#comment%3A14) 

I gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump



---

archive/issue_comments_431323.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI can confirm that this branch is merged in 8.8.rc0.\nSo this is done and dusted.",
    "created_at": "2019-06-11T10:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27642#issuecomment-431323",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'>Comment 23:</a>
I can confirm that this branch is merged in 8.8.rc0.
So this is done and dusted.
