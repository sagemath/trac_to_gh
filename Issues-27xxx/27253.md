# Issue 27253: networkx fails to build with SAGE_CHECK="yes"

archive/issues_027016.json:
```json
{
    "body": "After #26326, `networkx` fails to build with `SAGE_CHECK=\"yes\"` unless the optional package `nose` is installed.\n\n```\n[networkx-2.2] Running the test suite for networkx-2.2...\n[networkx-2.2] Testing networkx requires the package nose to be installed\n[networkx-2.2]\n[networkx-2.2] real     0m0.004s\n[networkx-2.2] user     0m0.004s\n[networkx-2.2] sys      0m0.001s\n[networkx-2.2] ************************************************************************\n[networkx-2.2] Error testing package networkx-2.2\n[networkx-2.2] ************************************************************************\n```\n\nKeywords: networkx, nose, build\n\nReviewer: Dima Pasechnik\n\nAuthor: Konrad K. Dabrowski\n\nBranch: e1ce380572fe82b6238f920299a614447f36843c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27253\n\n",
    "closed_at": "2019-02-14T19:45:29Z",
    "created_at": "2019-02-10T21:41:40Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "networkx fails to build with SAGE_CHECK=\"yes\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27253",
    "user": "https://github.com/Konrad127123"
}
```
After #26326, `networkx` fails to build with `SAGE_CHECK="yes"` unless the optional package `nose` is installed.

```
[networkx-2.2] Running the test suite for networkx-2.2...
[networkx-2.2] Testing networkx requires the package nose to be installed
[networkx-2.2]
[networkx-2.2] real     0m0.004s
[networkx-2.2] user     0m0.004s
[networkx-2.2] sys      0m0.001s
[networkx-2.2] ************************************************************************
[networkx-2.2] Error testing package networkx-2.2
[networkx-2.2] ************************************************************************
```

Keywords: networkx, nose, build

Reviewer: Dima Pasechnik

Author: Konrad K. Dabrowski

Branch: e1ce380572fe82b6238f920299a614447f36843c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27253





---

archive/issue_comments_404919.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-10T22:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404919",
    "user": "https://github.com/Konrad127123"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404920.json:
```json
{
    "body": "<a id='comment:2'></a>Suggested fix: add `nose` as a runtime dependency of `networkx`. This means `nose` needs to be a standard package.\n\n---\nNew commits:",
    "created_at": "2019-02-10T22:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404920",
    "user": "https://github.com/Konrad127123"
}
```

<a id='comment:2'></a>Suggested fix: add `nose` as a runtime dependency of `networkx`. This means `nose` needs to be a standard package.

---
New commits:



---

archive/issue_comments_404921.json:
```json
{
    "body": "<a id='comment:3'></a>Can you dig up the info on `nose`'s license. Cause it needs to be GPL-compatible to be standard.",
    "created_at": "2019-02-10T23:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404921",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Can you dig up the info on `nose`'s license. Cause it needs to be GPL-compatible to be standard.



---

archive/issue_comments_404922.json:
```json
{
    "body": "<a id='comment:4'></a>OK, it's fine. See https://github.com/nose-devs/nose/blob/master/lgpl.txt\nCould you please update the nose's SPKG.txt file with this info?",
    "created_at": "2019-02-11T00:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404922",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>OK, it's fine. See https://github.com/nose-devs/nose/blob/master/lgpl.txt
Could you please update the nose's SPKG.txt file with this info?



---

archive/issue_comments_404923.json:
```json
{
    "body": "<a id='comment:5'></a>nose's SPKG.txt already contains\n\n```\n## License\n\nGNU LGPL\n```",
    "created_at": "2019-02-11T10:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404923",
    "user": "https://github.com/Konrad127123"
}
```

<a id='comment:5'></a>nose's SPKG.txt already contains

```
## License

GNU LGPL
```



---

archive/issue_comments_404924.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-11T10:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404924",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404925.json:
```json
{
    "body": "<a id='comment:6'></a>OK, sorry, I was obviously blind :-)",
    "created_at": "2019-02-11T10:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404925",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>OK, sorry, I was obviously blind :-)



---

archive/issue_comments_404926.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-14T19:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404926",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067642.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-14T19:45:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27253#event-67642"
}
```



---

archive/issue_comments_404927.json:
```json
{
    "body": "<a id='comment:8'></a>Guys, test harnesses are not automatically standard packages. Instead the spkg-check script should just abort if nose is not found.",
    "created_at": "2019-02-18T18:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404927",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Guys, test harnesses are not automatically standard packages. Instead the spkg-check script should just abort if nose is not found.



---

archive/issue_comments_404928.json:
```json
{
    "body": "<a id='comment:9'></a>So is `nose` going to be standard (bypassing the required discussion and vote) or is this change going to be reverted?",
    "created_at": "2019-02-19T06:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404928",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>So is `nose` going to be standard (bypassing the required discussion and vote) or is this change going to be reverted?



---

archive/issue_comments_404929.json:
```json
{
    "body": "<a id='comment:10'></a>I think this falls under a situation of a new requirement by a standard package.\nWe have been adding various Python deps like this quite easily...",
    "created_at": "2019-02-19T06:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404929",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>I think this falls under a situation of a new requirement by a standard package.
We have been adding various Python deps like this quite easily...



---

archive/issue_comments_404930.json:
```json
{
    "body": "<a id='comment:11'></a>I view Volker's comment as disagreeing with you. Could you respond to that, please?",
    "created_at": "2019-02-19T16:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404930",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>I view Volker's comment as disagreeing with you. Could you respond to that, please?



---

archive/issue_comments_404931.json:
```json
{
    "body": "<a id='comment:12'></a>Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...\n\nBut please do not offer removing checks just cause you do not want to promote `nose`...",
    "created_at": "2019-02-19T16:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404931",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...

But please do not offer removing checks just cause you do not want to promote `nose`...



---

archive/issue_comments_404932.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 dimpase]:\n> Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...\n\n\nVolker did that.\n \n> But please do not offer removing checks just cause you do not want to promote `nose`...\n\n\nBut you don't like his solution, so you're discarding it. \n\nThe use of `nose` was added at #26326, and that ticket description says quite clearly, \"Note that self tests require `nose` which is optional only.\" So it's not like this situation is a surprise or was unintended when the self-tests were implemented. I would deduce that the intention was: if `nose` is present, use it, otherwise skip the self tests. Or maybe the intention was: most people don't run the self tests, and those that do can install `nose`. In any case, I don't agree that #26326 forces everyone to install `nose`.",
    "created_at": "2019-02-19T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404932",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Replying to [comment:12 dimpase]:
> Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...


Volker did that.
 
> But please do not offer removing checks just cause you do not want to promote `nose`...


But you don't like his solution, so you're discarding it. 

The use of `nose` was added at #26326, and that ticket description says quite clearly, "Note that self tests require `nose` which is optional only." So it's not like this situation is a surprise or was unintended when the self-tests were implemented. I would deduce that the intention was: if `nose` is present, use it, otherwise skip the self tests. Or maybe the intention was: most people don't run the self tests, and those that do can install `nose`. In any case, I don't agree that #26326 forces everyone to install `nose`.



---

archive/issue_comments_404933.json:
```json
{
    "body": "<a id='comment:14'></a>A Dieselgate-style \"solution\" is not a solution. This is already merged, and let us not start track ticket wars caused by a 300K addition to Sage tarballs.",
    "created_at": "2019-02-19T18:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404933",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>A Dieselgate-style "solution" is not a solution. This is already merged, and let us not start track ticket wars caused by a 300K addition to Sage tarballs.



---

archive/issue_comments_404934.json:
```json
{
    "body": "<a id='comment:15'></a>ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.",
    "created_at": "2019-03-20T11:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404934",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.



---

archive/issue_comments_404935.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 embray]:\n> ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.\n\n\nyes, this is a good catch. Should we do a quick gitlab fix?",
    "created_at": "2019-03-20T11:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404935",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Replying to [comment:15 embray]:
> ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.


yes, this is a good catch. Should we do a quick gitlab fix?



---

archive/issue_comments_404936.json:
```json
{
    "body": "<a id='comment:17'></a>Followup in #27515",
    "created_at": "2019-03-20T11:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27253#issuecomment-404936",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Followup in #27515
