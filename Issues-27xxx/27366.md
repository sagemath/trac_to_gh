# Issue 27366: Polyhedron.affine_hull: more output options

archive/issues_027129.json:
```json
{
    "body": "At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.\n\nMoreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.\n\nCC:  @jplab @videlec @kliem\n\nKeywords: polytope\n\nBranch/Commit: [eee1aadd98f1ef91f7a07bd478ac8613a83a94d7](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)\n\nReviewer: Matthias Koeppe, Jonathan Kliem\n\nAuthor: Daniel Krenn, Matthias Koeppe, Jonathan Kliem\n\nDependencies: #30551\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27366\n\n",
    "closed_at": "2021-05-27T20:29:23Z",
    "created_at": "2019-02-26T15:22:11Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Polyhedron.affine_hull: more output options",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27366",
    "user": "https://github.com/dkrenn"
}
```
At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.

Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.

CC:  @jplab @videlec @kliem

Keywords: polytope

Branch/Commit: [eee1aadd98f1ef91f7a07bd478ac8613a83a94d7](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)

Reviewer: Matthias Koeppe, Jonathan Kliem

Author: Daniel Krenn, Matthias Koeppe, Jonathan Kliem

Dependencies: #30551

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27366





---

archive/issue_comments_529069.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dkrenn/affine-hull-more\"",
    "created_at": "2019-02-26T15:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529069",
    "user": "https://github.com/dkrenn"
}
```

Changing branch from "" to "u/dkrenn/affine-hull-more"



---

archive/issue_comments_529070.json:
```json
{
    "body": "Changing commit from \"\" to \"2075a6bc042a4e1bcf9941fa52e542fd29e76124\"",
    "created_at": "2019-02-26T15:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529070",
    "user": "https://github.com/dkrenn"
}
```

Changing commit from "" to "2075a6bc042a4e1bcf9941fa52e542fd29e76124"



---

archive/issue_comments_529071.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[1ca3e2c](https://github.com/sagemath/sagetrac-mirror/commit/1ca3e2c4768707db4448b218ee31c3663d5c5e8b)|`Trac #27329: actually use **kwds as promised in docs`|\n|[4efdb48](https://github.com/sagemath/sagetrac-mirror/commit/4efdb4891eb32710f16b8dd20973f62ee8ba69d5)|`Trac #27329: insert 3 whitespaces (PEP8)`|\n|[74470e2](https://github.com/sagemath/sagetrac-mirror/commit/74470e28c89691c95ed7d9f862e44b1bdc15a9f5)|`Trac #27329: insert an additional doctest enhancing the readability of`|\n|[9bedce6](https://github.com/sagemath/sagetrac-mirror/commit/9bedce610130acbfbeb5904ab67284efde65c200)|`Trac #27366: new output parameters for affine_hull`|\n|[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)|`Trac #27366: use new parameter-options in .volume`|",
    "created_at": "2019-02-26T15:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529071",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[1ca3e2c](https://github.com/sagemath/sagetrac-mirror/commit/1ca3e2c4768707db4448b218ee31c3663d5c5e8b)|`Trac #27329: actually use **kwds as promised in docs`|
|[4efdb48](https://github.com/sagemath/sagetrac-mirror/commit/4efdb4891eb32710f16b8dd20973f62ee8ba69d5)|`Trac #27329: insert 3 whitespaces (PEP8)`|
|[74470e2](https://github.com/sagemath/sagetrac-mirror/commit/74470e28c89691c95ed7d9f862e44b1bdc15a9f5)|`Trac #27329: insert an additional doctest enhancing the readability of`|
|[9bedce6](https://github.com/sagemath/sagetrac-mirror/commit/9bedce610130acbfbeb5904ab67284efde65c200)|`Trac #27366: new output parameters for affine_hull`|
|[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)|`Trac #27366: use new parameter-options in .volume`|



---

archive/issue_comments_529072.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#27329\"",
    "created_at": "2019-02-26T15:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529072",
    "user": "https://github.com/dkrenn"
}
```

Changing dependencies from "" to "#27329"



---

archive/issue_comments_529073.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)|`Trac #27366: fixup (lines forgotten to commit in ~2)`|",
    "created_at": "2019-02-26T15:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)|`Trac #27366: fixup (lines forgotten to commit in ~2)`|



---

archive/issue_comments_529074.json:
```json
{
    "body": "Changing commit from \"2075a6bc042a4e1bcf9941fa52e542fd29e76124\" to \"e9ed7ee67fc08c2368aac374fe126e9989f6271f\"",
    "created_at": "2019-02-26T15:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2075a6bc042a4e1bcf9941fa52e542fd29e76124" to "e9ed7ee67fc08c2368aac374fe126e9989f6271f"



---

archive/issue_comments_529075.json:
```json
{
    "body": "Changing commit from \"e9ed7ee67fc08c2368aac374fe126e9989f6271f\" to \"0cf6bc5b1307db2c4561c9b05babd9e0889e14e0\"",
    "created_at": "2019-02-26T15:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e9ed7ee67fc08c2368aac374fe126e9989f6271f" to "0cf6bc5b1307db2c4561c9b05babd9e0889e14e0"



---

archive/issue_comments_529076.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)|`Trac #27366: docstring fixup`|",
    "created_at": "2019-02-26T15:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)|`Trac #27366: docstring fixup`|



---

archive/issue_comments_529077.json:
```json
{
    "body": "Changing commit from \"0cf6bc5b1307db2c4561c9b05babd9e0889e14e0\" to \"2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69\"",
    "created_at": "2019-03-07T09:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0cf6bc5b1307db2c4561c9b05babd9e0889e14e0" to "2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69"



---

archive/issue_comments_529078.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[f8cb228](https://github.com/sagemath/sagetrac-mirror/commit/f8cb228c757af09b788991a02c9bbc8989773458)|`Trac #27366 factor out parametric_form`|\n|[8fa37df](https://github.com/sagemath/sagetrac-mirror/commit/8fa37df46b34a787eb6cc7cc00b4b97589af8b84)|`Trac #27366 use new .parametric_form`|\n|[294fbe1](https://github.com/sagemath/sagetrac-mirror/commit/294fbe1d3381694e6efbd74b25a6e4337628d392)|`Trac #27366 output affine_map`|\n|[6cf71c7](https://github.com/sagemath/sagetrac-mirror/commit/6cf71c79eb5cc28782fcfc466c7887e3e8da66ea)|`Trac #27366 update .volume (to new parameter set)`|\n|[477923b](https://github.com/sagemath/sagetrac-mirror/commit/477923ba02d85b7c193536397f1665171d4cc799)|`Trac #27366 compute coordinate images`|\n|[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)|`Trac #27366: update docs`|",
    "created_at": "2019-03-07T09:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[f8cb228](https://github.com/sagemath/sagetrac-mirror/commit/f8cb228c757af09b788991a02c9bbc8989773458)|`Trac #27366 factor out parametric_form`|
|[8fa37df](https://github.com/sagemath/sagetrac-mirror/commit/8fa37df46b34a787eb6cc7cc00b4b97589af8b84)|`Trac #27366 use new .parametric_form`|
|[294fbe1](https://github.com/sagemath/sagetrac-mirror/commit/294fbe1d3381694e6efbd74b25a6e4337628d392)|`Trac #27366 output affine_map`|
|[6cf71c7](https://github.com/sagemath/sagetrac-mirror/commit/6cf71c79eb5cc28782fcfc466c7887e3e8da66ea)|`Trac #27366 update .volume (to new parameter set)`|
|[477923b](https://github.com/sagemath/sagetrac-mirror/commit/477923ba02d85b7c193536397f1665171d4cc799)|`Trac #27366 compute coordinate images`|
|[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)|`Trac #27366: update docs`|



---

archive/issue_comments_529079.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)|`Trac #27366: fix no-variables-bug-wrong-parent bug`|",
    "created_at": "2019-03-10T17:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)|`Trac #27366: fix no-variables-bug-wrong-parent bug`|



---

archive/issue_comments_529080.json:
```json
{
    "body": "Changing commit from \"2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69\" to \"3c09477e154b426b44c23a754a19605b1a668951\"",
    "created_at": "2019-03-10T17:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69" to "3c09477e154b426b44c23a754a19605b1a668951"



---

archive/issue_comments_529081.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-10T18:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529081",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_529082.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[82ad45b](https://github.com/sagemath/sagetrac-mirror/commit/82ad45bc966b0aa83369ea78d9db90f354a0b1b2)|`Trac #27366: cache affine hull`|\n|[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)|`Trac #27366: reintegrate parametric form and solve dimension bug`|",
    "created_at": "2019-03-12T11:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[82ad45b](https://github.com/sagemath/sagetrac-mirror/commit/82ad45bc966b0aa83369ea78d9db90f354a0b1b2)|`Trac #27366: cache affine hull`|
|[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)|`Trac #27366: reintegrate parametric form and solve dimension bug`|



---

archive/issue_comments_529083.json:
```json
{
    "body": "Changing commit from \"3c09477e154b426b44c23a754a19605b1a668951\" to \"3bdea15eafc77d3d9cd593933097934ae3d68f1b\"",
    "created_at": "2019-03-12T11:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3c09477e154b426b44c23a754a19605b1a668951" to "3bdea15eafc77d3d9cd593933097934ae3d68f1b"



---

archive/issue_events_077095.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77095"
}
```



---

archive/issue_comments_529084.json:
```json
{
    "body": "<a id='comment:9'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529084",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_077096.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77096"
}
```



---

archive/issue_events_077097.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77097"
}
```



---

archive/issue_comments_529085.json:
```json
{
    "body": "<a id='comment:10'></a>\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529085",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_529086.json:
```json
{
    "body": "<a id='comment:11'></a>\nred branch, needs to be rebased on top of the latest beta",
    "created_at": "2019-08-31T07:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529086",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
red branch, needs to be rebased on top of the latest beta



---

archive/issue_comments_529087.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-31T07:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529087",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_529088.json:
```json
{
    "body": "Changing keywords from \"\" to \"polytope,\".",
    "created_at": "2019-09-03T18:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529088",
    "user": "https://github.com/jplab"
}
```

Changing keywords from "" to "polytope,".



---

archive/issue_comments_529089.json:
```json
{
    "body": "<a id='comment:14'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529089",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_077098.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77098"
}
```



---

archive/issue_events_077099.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77099"
}
```



---

archive/issue_comments_529090.json:
```json
{
    "body": "<a id='comment:15'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529090",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_077100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77100"
}
```



---

archive/issue_events_077101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77101"
}
```



---

archive/issue_events_077102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77102"
}
```



---

archive/issue_events_077103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77103"
}
```



---

archive/issue_events_077104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77104"
}
```



---

archive/issue_events_077105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77105"
}
```



---

archive/issue_comments_529091.json:
```json
{
    "body": "<a id='comment:17'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529091",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_529092.json:
```json
{
    "body": "Changing branch from \"u/dkrenn/affine-hull-more\" to \"u/mkoeppe/affine-hull-more\"",
    "created_at": "2021-04-12T19:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529092",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/dkrenn/affine-hull-more" to "u/mkoeppe/affine-hull-more"



---

archive/issue_comments_529093.json:
```json
{
    "body": "Changing commit from \"3bdea15eafc77d3d9cd593933097934ae3d68f1b\" to \"b407987152fe0d7683a5224d4ec51edc4863f72e\"",
    "created_at": "2021-04-12T19:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529093",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "3bdea15eafc77d3d9cd593933097934ae3d68f1b" to "b407987152fe0d7683a5224d4ec51edc4863f72e"



---

archive/issue_comments_529094.json:
```json
{
    "body": "<a id='comment:19'></a>\nMerged with current develop.\n\n---\nNew commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)|`Merge tag '9.3.rc2' into t/27366/affine-hull-more`|",
    "created_at": "2021-04-12T19:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529094",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Merged with current develop.

---
New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)|`Merge tag '9.3.rc2' into t/27366/affine-hull-more`|



---

archive/issue_comments_529095.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-12T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529095",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_529096.json:
```json
{
    "body": "<a id='comment:20'></a>\nUntested so far...",
    "created_at": "2021-04-12T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529096",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Untested so far...



---

archive/issue_comments_529097.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[d25f7f3](https://github.com/sagemath/sagetrac-mirror/commit/d25f7f3967c18063398dc4ed4bf486599f667d9e)|`Fixup merge`|\n|[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)|`affine_hull -> affine_hull_projection in doctests`|",
    "created_at": "2021-04-13T02:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[d25f7f3](https://github.com/sagemath/sagetrac-mirror/commit/d25f7f3967c18063398dc4ed4bf486599f667d9e)|`Fixup merge`|
|[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)|`affine_hull -> affine_hull_projection in doctests`|



---

archive/issue_comments_529098.json:
```json
{
    "body": "Changing commit from \"b407987152fe0d7683a5224d4ec51edc4863f72e\" to \"7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4\"",
    "created_at": "2021-04-13T02:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b407987152fe0d7683a5224d4ec51edc4863f72e" to "7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4"



---

archive/issue_comments_529099.json:
```json
{
    "body": "Changing dependencies from \"#27329\" to \"\"",
    "created_at": "2021-04-13T20:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529099",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#27329" to ""



---

archive/issue_comments_529100.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)|`Merge tag '9.3.rc3' into t/27366/affine-hull-more`|",
    "created_at": "2021-04-13T20:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529100",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)|`Merge tag '9.3.rc3' into t/27366/affine-hull-more`|



---

archive/issue_comments_529101.json:
```json
{
    "body": "Changing commit from \"7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4\" to \"58e6dcc12549380bc130b9dacebf42bba5ecec4b\"",
    "created_at": "2021-04-13T20:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4" to "58e6dcc12549380bc130b9dacebf42bba5ecec4b"



---

archive/issue_comments_529102.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|\n|[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)|`Polyhedron_base.affine_hull_projection: Document a weaker guarantee of parametric_form`|",
    "created_at": "2021-04-13T21:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|
|[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)|`Polyhedron_base.affine_hull_projection: Document a weaker guarantee of parametric_form`|



---

archive/issue_comments_529103.json:
```json
{
    "body": "Changing commit from \"58e6dcc12549380bc130b9dacebf42bba5ecec4b\" to \"84140398fe84337784834e13f5c4fc5cb73ab667\"",
    "created_at": "2021-04-13T21:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "58e6dcc12549380bc130b9dacebf42bba5ecec4b" to "84140398fe84337784834e13f5c4fc5cb73ab667"



---

archive/issue_comments_529104.json:
```json
{
    "body": "<a id='comment:25'></a>\nI plan to rework this so the output is a bit more straightforward.\n\nWe have `affine_map`, which is the projection that sends the affine hull (k-dimensional affine subspace of R<sup>n</sup>) to R<sup>k</sup>.\n\nWhat's missing is simply its section map that sends back R<sup>k</sup> to the affine hull.\n\nI think both `parametric_form` and `coordinate_images` somehow represent this section map.\n\nAs the section map is affine linear, we should represent it in the same way as `affine_map`: A linear transformation and a shift.",
    "created_at": "2021-04-14T00:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
I plan to rework this so the output is a bit more straightforward.

We have `affine_map`, which is the projection that sends the affine hull (k-dimensional affine subspace of R<sup>n</sup>) to R<sup>k</sup>.

What's missing is simply its section map that sends back R<sup>k</sup> to the affine hull.

I think both `parametric_form` and `coordinate_images` somehow represent this section map.

As the section map is affine linear, we should represent it in the same way as `affine_map`: A linear transformation and a shift.



---

archive/issue_comments_529105.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|\n|[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)|`Polyhedron_base.affine_hull_projection: Replace 'affine_map' by 'projection_map', 'parametric_form'/'coordinate_images' by 'section_map'`|",
    "created_at": "2021-04-14T05:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|
|[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)|`Polyhedron_base.affine_hull_projection: Replace 'affine_map' by 'projection_map', 'parametric_form'/'coordinate_images' by 'section_map'`|



---

archive/issue_comments_529106.json:
```json
{
    "body": "Changing commit from \"84140398fe84337784834e13f5c4fc5cb73ab667\" to \"dba27635d03a6453c07a884199d2f2062aea8ad9\"",
    "created_at": "2021-04-14T05:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "84140398fe84337784834e13f5c4fc5cb73ab667" to "dba27635d03a6453c07a884199d2f2062aea8ad9"



---

archive/issue_comments_529107.json:
```json
{
    "body": "Changing author from \"Daniel Krenn\" to \"Daniel Krenn, Matthias Koeppe\"",
    "created_at": "2021-04-14T05:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529107",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Daniel Krenn" to "Daniel Krenn, Matthias Koeppe"



---

archive/issue_comments_529108.json:
```json
{
    "body": "<a id='comment:27'></a>\nFor the non-orthogonal case, the `section_map` still needs to be computed.\n\nBut comments are already welcome",
    "created_at": "2021-04-14T05:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529108",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
For the non-orthogonal case, the `section_map` still needs to be computed.

But comments are already welcome



---

archive/issue_comments_529109.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-14T05:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529109",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_529110.json:
```json
{
    "body": "Changing commit from \"dba27635d03a6453c07a884199d2f2062aea8ad9\" to \"d49c3136036a247843d4a2b9e83c320ce01f05c5\"",
    "created_at": "2021-04-15T04:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dba27635d03a6453c07a884199d2f2062aea8ad9" to "d49c3136036a247843d4a2b9e83c320ce01f05c5"



---

archive/issue_comments_529111.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\n|[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)|`Polyhedron_base.affine_hull_projection: section map for non-orthogonal case`|",
    "created_at": "2021-04-15T04:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)|`Polyhedron_base.affine_hull_projection: section map for non-orthogonal case`|



---

archive/issue_comments_529112.json:
```json
{
    "body": "Changing commit from \"d49c3136036a247843d4a2b9e83c320ce01f05c5\" to \"d77181b4e6da158661dea4a4fc37269d58489ada\"",
    "created_at": "2021-04-15T04:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d49c3136036a247843d4a2b9e83c320ce01f05c5" to "d77181b4e6da158661dea4a4fc37269d58489ada"



---

archive/issue_comments_529113.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)|`Add doctest`|",
    "created_at": "2021-04-15T04:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)|`Add doctest`|



---

archive/issue_comments_529114.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-15T04:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529114",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_529115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.\n \n-Moreover, we also allow to additionally return some more (internal) data using during creating the affine map. This is a preparation for #27365.\n+Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.\n``````\n",
    "created_at": "2021-04-15T04:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529115",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.
 
-Moreover, we also allow to additionally return some more (internal) data using during creating the affine map. This is a preparation for #27365.
+Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.
``````




---

archive/issue_comments_529116.json:
```json
{
    "body": "<a id='comment:31'></a>\nStill some issues with algebraic numbers:\n\n```\nsage: D = polytopes.dodecahedron()\nsage: D.facets()[0].as_polyhedron().affine_hull_projection()                                                                       \nA 2-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^2 defined as the convex hull of 5 vertices\nsage: D.facets()[0].as_polyhedron().affine_hull_projection(return_all_data=True)  \nTypeError: (-sqrt5 + 1, -2*sqrt5 + 4, 0) fails to convert into the map's domain Vector space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented\n```",
    "created_at": "2021-04-15T06:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529116",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Still some issues with algebraic numbers:

```
sage: D = polytopes.dodecahedron()
sage: D.facets()[0].as_polyhedron().affine_hull_projection()                                                                       
A 2-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^2 defined as the convex hull of 5 vertices
sage: D.facets()[0].as_polyhedron().affine_hull_projection(return_all_data=True)  
TypeError: (-sqrt5 + 1, -2*sqrt5 + 4, 0) fails to convert into the map's domain Vector space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented
```



---

archive/issue_comments_529117.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-15T06:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529117",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_529118.json:
```json
{
    "body": "<a id='comment:32'></a>\nI have a fix almost ready and added a test method.\n\nHowever, there is going to be one more ticket in the dependency chain:\n\n```\nsage: D = polytopes.dodecahedron()                                                                                                                                                  \nsage: D.change_ring(AA) == D                                                                                                                                                        \nFalse\n```",
    "created_at": "2021-04-15T19:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529118",
    "user": "https://github.com/kliem"
}
```

<a id='comment:32'></a>
I have a fix almost ready and added a test method.

However, there is going to be one more ticket in the dependency chain:

```
sage: D = polytopes.dodecahedron()                                                                                                                                                  
sage: D.change_ring(AA) == D                                                                                                                                                        
False
```



---

archive/issue_comments_529119.json:
```json
{
    "body": "<a id='comment:33'></a>\nThe behavior is actually consistent with rings, I still don't like it.\n\nLooks, like this is related to #4621:\n\n```\nsage: D = polytopes.dodecahedron()                                                                                                                                                  \nsage: D.base_ring()                                                                                                                                                                 \nNumber Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?\nsage: sqrt5 = D.base_ring().gens()[0]                                                                                                                                               \nsage: sqrt5 == AA(sqrt5)                                                                                                                                                            \nFalse\nsage: 0*sqrt5 == AA(0)                                                                                                                                                              \nFalse\n```\n\nThis is extremely stupid. At least it should throw an error instead of giving a false negative. But its pointless to be fixed here.\n\nEdit: I realized that equality checks should never throw an error. So it is really hard to do the right thing here. The base ring of algebraic polyhedra has a specified embedding into `RLF`, which makes it incomparable with `AA`.",
    "created_at": "2021-04-15T19:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529119",
    "user": "https://github.com/kliem"
}
```

<a id='comment:33'></a>
The behavior is actually consistent with rings, I still don't like it.

Looks, like this is related to #4621:

```
sage: D = polytopes.dodecahedron()                                                                                                                                                  
sage: D.base_ring()                                                                                                                                                                 
Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?
sage: sqrt5 = D.base_ring().gens()[0]                                                                                                                                               
sage: sqrt5 == AA(sqrt5)                                                                                                                                                            
False
sage: 0*sqrt5 == AA(0)                                                                                                                                                              
False
```

This is extremely stupid. At least it should throw an error instead of giving a false negative. But its pointless to be fixed here.

Edit: I realized that equality checks should never throw an error. So it is really hard to do the right thing here. The base ring of algebraic polyhedra has a specified embedding into `RLF`, which makes it incomparable with `AA`.



---

archive/issue_comments_529120.json:
```json
{
    "body": "Changing author from \"Daniel Krenn, Matthias Koeppe\" to \"Daniel Krenn, Matthias Koeppe, Jonathan Kliem\"",
    "created_at": "2021-04-15T19:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529120",
    "user": "https://github.com/kliem"
}
```

Changing author from "Daniel Krenn, Matthias Koeppe" to "Daniel Krenn, Matthias Koeppe, Jonathan Kliem"



---

archive/issue_comments_529121.json:
```json
{
    "body": "<a id='comment:34'></a>\nUnfortunately, it is still at \"needs work\".\n\nThe test suite fails for `polytopes.Birkhoff(3)` terribly (the section map has incorrect rank).\n\nIt also fails for the 0-dimensional polyhedron, but maybe that is just the way it is.\n\nIt fails for unbounded polyhedron, in particular `Polyhedron(rays=[This is the Trac macro *0, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 1-macro))`.",
    "created_at": "2021-04-15T19:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529121",
    "user": "https://github.com/kliem"
}
```

<a id='comment:34'></a>
Unfortunately, it is still at "needs work".

The test suite fails for `polytopes.Birkhoff(3)` terribly (the section map has incorrect rank).

It also fails for the 0-dimensional polyhedron, but maybe that is just the way it is.

It fails for unbounded polyhedron, in particular `Polyhedron(rays=[This is the Trac macro *0, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 1-macro))`.



---

archive/issue_comments_529122.json:
```json
{
    "body": "<a id='comment:35'></a>\nNew commits:\n|                                                                                                                                          |                                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[ab10ce2](https://github.com/sagemath/sagetrac-mirror/commit/ab10ce252b95caecaff09df9c1e14dbcff1f7826)|`correct base_rings for projection and section map and test suite method`|\n|[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)|`base extend in test; only run defined tests`|",
    "created_at": "2021-04-15T19:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529122",
    "user": "https://github.com/kliem"
}
```

<a id='comment:35'></a>
New commits:
|                                                                                                                                          |                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[ab10ce2](https://github.com/sagemath/sagetrac-mirror/commit/ab10ce252b95caecaff09df9c1e14dbcff1f7826)|`correct base_rings for projection and section map and test suite method`|
|[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)|`base extend in test; only run defined tests`|



---

archive/issue_comments_529123.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/affine-hull-more\" to \"u/gh-kliem/affine-hull-more\"",
    "created_at": "2021-04-15T19:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529123",
    "user": "https://github.com/kliem"
}
```

Changing branch from "u/mkoeppe/affine-hull-more" to "u/gh-kliem/affine-hull-more"



---

archive/issue_comments_529124.json:
```json
{
    "body": "Changing commit from \"d77181b4e6da158661dea4a4fc37269d58489ada\" to \"69ceebcca7df21e39a4ab1bb719cdfaea9b6986d\"",
    "created_at": "2021-04-15T19:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529124",
    "user": "https://github.com/kliem"
}
```

Changing commit from "d77181b4e6da158661dea4a4fc37269d58489ada" to "69ceebcca7df21e39a4ab1bb719cdfaea9b6986d"



---

archive/issue_comments_529125.json:
```json
{
    "body": "<a id='comment:36'></a>\nThanks a lot! Great idea to add the test method",
    "created_at": "2021-04-15T19:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Thanks a lot! Great idea to add the test method



---

archive/issue_comments_529126.json:
```json
{
    "body": "<a id='comment:37'></a>\nI started adding doctests and I realized that they are extremely long and nobody is actually going to check them...",
    "created_at": "2021-04-15T20:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529126",
    "user": "https://github.com/kliem"
}
```

<a id='comment:37'></a>
I started adding doctests and I realized that they are extremely long and nobody is actually going to check them...



---

archive/issue_comments_529127.json:
```json
{
    "body": "Changing branch from \"u/gh-kliem/affine-hull-more\" to \"u/mkoeppe/affine-hull-more\"",
    "created_at": "2021-04-15T23:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529127",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/gh-kliem/affine-hull-more" to "u/mkoeppe/affine-hull-more"



---

archive/issue_comments_529128.json:
```json
{
    "body": "Changing commit from \"69ceebcca7df21e39a4ab1bb719cdfaea9b6986d\" to \"9629620ed8e4e824adace4a7f867059961fce877\"",
    "created_at": "2021-04-15T23:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69ceebcca7df21e39a4ab1bb719cdfaea9b6986d" to "9629620ed8e4e824adace4a7f867059961fce877"



---

archive/issue_comments_529129.json:
```json
{
    "body": "<a id='comment:39'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)|`Polyhedron_base.affine_hull_projection: Fix up use of echelong form`|",
    "created_at": "2021-04-15T23:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)|`Polyhedron_base.affine_hull_projection: Fix up use of echelong form`|



---

archive/issue_comments_529130.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-15T23:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529130",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_529131.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe, ...\"",
    "created_at": "2021-04-15T23:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529131",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe, ..."



---

archive/issue_comments_529132.json:
```json
{
    "body": "Changing commit from \"9629620ed8e4e824adace4a7f867059961fce877\" to \"8c24c5c3590df6dbdf033e7a3c936941e4ff2caa\"",
    "created_at": "2021-04-16T01:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9629620ed8e4e824adace4a7f867059961fce877" to "8c24c5c3590df6dbdf033e7a3c936941e4ff2caa"



---

archive/issue_comments_529133.json:
```json
{
    "body": "<a id='comment:42'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|\n|[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)|`Polyhedron_base.affine_hull_projection: Remove last occurrence of 'parametric_form'`|",
    "created_at": "2021-04-16T01:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)|`Polyhedron_base.affine_hull_projection: Remove last occurrence of 'parametric_form'`|



---

archive/issue_comments_529134.json:
```json
{
    "body": "<a id='comment:43'></a>\nThere is still a doctest that fails terribly. (After fixing an incorrect doctest that I will push in a minute).\n\n```\nsage: p = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                            \nsage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        \nsage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           \nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           \nsage: p1 == p                                                                                                                                                                       \nTrue\nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                \nsage: p1 == p                                                         \nTrue\n```\n\nSomehow linear transformation applied to a 0-dimensional polyhedron isn't stable. The problem really seems to be connected to underlying matrices:\n\n```\nsage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        \nsage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           \nsage: M = data['section_map'][0].matrix().transpose()                                                                                                                               \nsage: V = data['polyhedron'].vertices_matrix()                                                                                                                                      \nsage: M*V                                                                                                                                                                           \n[3.445383e-316]\n[          0.0]\nsage: M*V                                                                                                                                                                           \n[3.445383e-316]\n[          0.0]\nsage: M*V                                                                                                                                                                           \n[3.17525635e-316]\n[            0.0]\nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           \nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[1.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[1.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\n```\n\nApparently, the content of the matrix is never initialized. You might say that multiplication of those matrices isn't well-defined. However, if you think of this as linear maps, there is only one linear map from `RLF^0` to `RLF^2`.",
    "created_at": "2021-04-16T09:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529134",
    "user": "https://github.com/kliem"
}
```

<a id='comment:43'></a>
There is still a doctest that fails terribly. (After fixing an incorrect doctest that I will push in a minute).

```
sage: p = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                            
sage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        
sage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           
sage: p1 == p                                                                                                                                                                       
True
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                
sage: p1 == p                                                         
True
```

Somehow linear transformation applied to a 0-dimensional polyhedron isn't stable. The problem really seems to be connected to underlying matrices:

```
sage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        
sage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           
sage: M = data['section_map'][0].matrix().transpose()                                                                                                                               
sage: V = data['polyhedron'].vertices_matrix()                                                                                                                                      
sage: M*V                                                                                                                                                                           
[3.445383e-316]
[          0.0]
sage: M*V                                                                                                                                                                           
[3.445383e-316]
[          0.0]
sage: M*V                                                                                                                                                                           
[3.17525635e-316]
[            0.0]
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
sage: M*V                                                                                                                                                                           
[1.0]
[0.0]
sage: M*V                                                                                                                                                                           
[0.0]
[1.0]
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
```

Apparently, the content of the matrix is never initialized. You might say that multiplication of those matrices isn't well-defined. However, if you think of this as linear maps, there is only one linear map from `RLF^0` to `RLF^2`.



---

archive/issue_comments_529135.json:
```json
{
    "body": "<a id='comment:44'></a>\nOk, seems to work now.\n\nFixing the problem with real matrices was actually quite easy. The matrix was not initialized as I thought. Should I open a seperate ticket for this?\n\n---\nNew commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[9f5560a](https://github.com/sagemath/sagetrac-mirror/commit/9f5560ae5412fb63f442d80ad85ac1e72a5b17b8)|`initialize empty matrix after trivial multiplication`|\n|[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)|`minimal extension only avoid AA if the base ring is not already AA`|",
    "created_at": "2021-04-16T09:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529135",
    "user": "https://github.com/kliem"
}
```

<a id='comment:44'></a>
Ok, seems to work now.

Fixing the problem with real matrices was actually quite easy. The matrix was not initialized as I thought. Should I open a seperate ticket for this?

---
New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[9f5560a](https://github.com/sagemath/sagetrac-mirror/commit/9f5560ae5412fb63f442d80ad85ac1e72a5b17b8)|`initialize empty matrix after trivial multiplication`|
|[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)|`minimal extension only avoid AA if the base ring is not already AA`|



---

archive/issue_comments_529136.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/affine-hull-more\" to \"u/gh-kliem/affine-hull-more\"",
    "created_at": "2021-04-16T09:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529136",
    "user": "https://github.com/kliem"
}
```

Changing branch from "u/mkoeppe/affine-hull-more" to "u/gh-kliem/affine-hull-more"



---

archive/issue_comments_529137.json:
```json
{
    "body": "Changing commit from \"8c24c5c3590df6dbdf033e7a3c936941e4ff2caa\" to \"f9faa025d7598c07549691ef9c6c922d31caeb8d\"",
    "created_at": "2021-04-16T09:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529137",
    "user": "https://github.com/kliem"
}
```

Changing commit from "8c24c5c3590df6dbdf033e7a3c936941e4ff2caa" to "f9faa025d7598c07549691ef9c6c922d31caeb8d"



---

archive/issue_comments_529138.json:
```json
{
    "body": "<a id='comment:45'></a>\nThanks for fixing this! I think it's fine to keep it on this ticket",
    "created_at": "2021-04-16T15:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529138",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Thanks for fixing this! I think it's fine to keep it on this ticket



---

archive/issue_comments_529139.json:
```json
{
    "body": "<a id='comment:46'></a>\nGreen patchbot.\n\nBut we may want to consider making the result a dataclass (https://docs.python.org/3/library/dataclasses.html) instead of a dictionary",
    "created_at": "2021-04-16T16:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529139",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
Green patchbot.

But we may want to consider making the result a dataclass (https://docs.python.org/3/library/dataclasses.html) instead of a dictionary



---

archive/issue_comments_529140.json:
```json
{
    "body": "<a id='comment:47'></a>\n(depends on #30551 - Drop Python 3.6 support - which is planned for 9.4 anyway)",
    "created_at": "2021-04-16T16:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
(depends on #30551 - Drop Python 3.6 support - which is planned for 9.4 anyway)



---

archive/issue_comments_529141.json:
```json
{
    "body": "<a id='comment:48'></a>\n\n```\nfrom dataclasses import dataclass\nfrom typing import Any\n@dataclass\nclass AffineHullProjectionData:\n   polyhedron: Any\n   projection_linear_map: Any\n   projection_translation: Any\n   section_linear_map: Any\n   section_translation: Any\n```\nNote, unpacking the pairs -- this would be future-proof in case we ever decide to add proper affine linear maps to Sage",
    "created_at": "2021-04-16T19:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529141",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>

```
from dataclasses import dataclass
from typing import Any
@dataclass
class AffineHullProjectionData:
   polyhedron: Any
   projection_linear_map: Any
   projection_translation: Any
   section_linear_map: Any
   section_translation: Any
```
Note, unpacking the pairs -- this would be future-proof in case we ever decide to add proper affine linear maps to Sage



---

archive/issue_comments_529142.json:
```json
{
    "body": "Changing branch from \"u/gh-kliem/affine-hull-more\" to \"u/mkoeppe/affine-hull-more\"",
    "created_at": "2021-04-19T01:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529142",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/gh-kliem/affine-hull-more" to "u/mkoeppe/affine-hull-more"



---

archive/issue_comments_529143.json:
```json
{
    "body": "Changing commit from \"f9faa025d7598c07549691ef9c6c922d31caeb8d\" to \"57fd3e185cf891c27fe93cde9fe9cabb9290468d\"",
    "created_at": "2021-04-19T03:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f9faa025d7598c07549691ef9c6c922d31caeb8d" to "57fd3e185cf891c27fe93cde9fe9cabb9290468d"



---

archive/issue_comments_529144.json:
```json
{
    "body": "<a id='comment:50'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)|`Fixup doctest formatting`|",
    "created_at": "2021-04-19T03:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)|`Fixup doctest formatting`|



---

archive/issue_comments_529145.json:
```json
{
    "body": "<a id='comment:51'></a>\nThis ticket should depend now on #30551, right?\n\nApparently `sage.geometry.polyhedron.base` is a startup module, which is terrible. I chased it down and it seems one needs to do a series of lazy/more careful imports.\n\n- It starts with `sage/schemes/toric/all.py`, which just imports a everything right away.\n- `sage/schemes/toric/variety.py` imports `Cone, is_Cone`. Both of them are only needed twice in the entire module and not even in popular places, it seems. (There are other places where `is_Cone` is just imported in the module, although it is only used in special methods.\n- `sage/geometry/all.py` could just do a lot more lazy imports (I think all of them should be lazy).\n- `sage/geometry/cone.py` could use a lot more careful imports. E.g. `FinitePoset` is imported, but it is only used for the face lattice. In particular the function `is_Cone` could live without all those imports. If your object isn't a cone, you probably won't need them anyway.\n\n  In particular it imports `is_Polyhedron` in `sage.geometry.polyhedron.base`.\n- Again `sage/geometry/polyhedron/base.py` imports a lot of stuff that is definetly not needed for `is_Polyhedron`.\n\nAdding some lazy imports above, I can avoid the import of `sage.geometry.polyhedron.base'.",
    "created_at": "2021-04-20T08:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529145",
    "user": "https://github.com/kliem"
}
```

<a id='comment:51'></a>
This ticket should depend now on #30551, right?

Apparently `sage.geometry.polyhedron.base` is a startup module, which is terrible. I chased it down and it seems one needs to do a series of lazy/more careful imports.

- It starts with `sage/schemes/toric/all.py`, which just imports a everything right away.
- `sage/schemes/toric/variety.py` imports `Cone, is_Cone`. Both of them are only needed twice in the entire module and not even in popular places, it seems. (There are other places where `is_Cone` is just imported in the module, although it is only used in special methods.
- `sage/geometry/all.py` could just do a lot more lazy imports (I think all of them should be lazy).
- `sage/geometry/cone.py` could use a lot more careful imports. E.g. `FinitePoset` is imported, but it is only used for the face lattice. In particular the function `is_Cone` could live without all those imports. If your object isn't a cone, you probably won't need them anyway.

  In particular it imports `is_Polyhedron` in `sage.geometry.polyhedron.base`.
- Again `sage/geometry/polyhedron/base.py` imports a lot of stuff that is definetly not needed for `is_Polyhedron`.

Adding some lazy imports above, I can avoid the import of `sage.geometry.polyhedron.base'.



---

archive/issue_comments_529146.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#30551\"",
    "created_at": "2021-04-20T16:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529146",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#30551"



---

archive/issue_comments_529147.json:
```json
{
    "body": "<a id='comment:53'></a>\nYes, I've added the dependency. But I don't think we need to merge in the branch of that.",
    "created_at": "2021-04-20T16:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529147",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
Yes, I've added the dependency. But I don't think we need to merge in the branch of that.



---

archive/issue_comments_529148.json:
```json
{
    "body": "<a id='comment:54'></a>\nI have opened #31705 for the lazy import improvements",
    "created_at": "2021-04-20T16:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
I have opened #31705 for the lazy import improvements



---

archive/issue_comments_529149.json:
```json
{
    "body": "<a id='comment:55'></a>\n\n```\n                L_section = linear_transformation(matrix(len(pivots), self.ambient_dim(),\n                                                         [E[i] for i in range(len(pivots))]).transpose(),\n                                                  side='right')\n```\nThis is not always an inverse to `A`:\n\n```\nsage: set_random_seed(0)                                                                                                              \nsage: M = random_matrix(ZZ, 5, 5, distribution='uniform')                                                                             \nsage: while True: \n....:     M = random_matrix(ZZ, 5, 5, distribution='uniform')   \n....:     if M.rank() != 5: \n....:         break \n....:                                                                                                                                 \nsage: P = Polyhedron(M)                                                                                                               \nsage: P._test_affine_hull_projection()                                                                                                \n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-23-f3c92d590b2b> in <module>\n----> 1 P._test_affine_hull_projection()\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py in _test_affine_hull_projection(self, tester, verbose, **options)\n  10487             else:\n  10488                 self_extend = self\n> 10489             tester.assertEqual(data.polyhedron.linear_transformation(M)\n  10490                                + data.section_translation,\n  10491                                self_extend)\n\n/usr/lib/python3.8/unittest/case.py in assertEqual(self, first, second, msg)\n    910         \"\"\"\n    911         assertion_func = self._getAssertEqualityFunc(first, second)\n--> 912         assertion_func(first, second, msg=msg)\n    913 \n    914     def assertNotEqual(self, first, second, msg=None):\n\n/usr/lib/python3.8/unittest/case.py in _baseAssertEqual(self, first, second, msg)\n    903             standardMsg = '%s != %s' % _common_shorten_repr(first, second)\n    904             msg = self._formatMessage(msg, standardMsg)\n--> 905             raise self.failureException(msg)\n    906 \n    907     def assertEqual(self, first, second, msg=None):\n\nAssertionError: A 4-dimensional polyhedron in QQ^5 defined as the convex hull of 5 vertices != A 4-dimensional polyhedron in ZZ^5 defined as the convex hull of 5 vertices\n```",
    "created_at": "2021-04-25T06:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529149",
    "user": "https://github.com/kliem"
}
```

<a id='comment:55'></a>

```
                L_section = linear_transformation(matrix(len(pivots), self.ambient_dim(),
                                                         [E[i] for i in range(len(pivots))]).transpose(),
                                                  side='right')
```
This is not always an inverse to `A`:

```
sage: set_random_seed(0)                                                                                                              
sage: M = random_matrix(ZZ, 5, 5, distribution='uniform')                                                                             
sage: while True: 
....:     M = random_matrix(ZZ, 5, 5, distribution='uniform')   
....:     if M.rank() != 5: 
....:         break 
....:                                                                                                                                 
sage: P = Polyhedron(M)                                                                                                               
sage: P._test_affine_hull_projection()                                                                                                
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-23-f3c92d590b2b> in <module>
----> 1 P._test_affine_hull_projection()

~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py in _test_affine_hull_projection(self, tester, verbose, **options)
  10487             else:
  10488                 self_extend = self
> 10489             tester.assertEqual(data.polyhedron.linear_transformation(M)
  10490                                + data.section_translation,
  10491                                self_extend)

/usr/lib/python3.8/unittest/case.py in assertEqual(self, first, second, msg)
    910         """
    911         assertion_func = self._getAssertEqualityFunc(first, second)
--> 912         assertion_func(first, second, msg=msg)
    913 
    914     def assertNotEqual(self, first, second, msg=None):

/usr/lib/python3.8/unittest/case.py in _baseAssertEqual(self, first, second, msg)
    903             standardMsg = '%s != %s' % _common_shorten_repr(first, second)
    904             msg = self._formatMessage(msg, standardMsg)
--> 905             raise self.failureException(msg)
    906 
    907     def assertEqual(self, first, second, msg=None):

AssertionError: A 4-dimensional polyhedron in QQ^5 defined as the convex hull of 5 vertices != A 4-dimensional polyhedron in ZZ^5 defined as the convex hull of 5 vertices
```



---

archive/issue_comments_529150.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-25T06:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529150",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_529151.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/affine-hull-more\" to \"u/gh-kliem/affine-hull-more\"",
    "created_at": "2021-04-25T06:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529151",
    "user": "https://github.com/kliem"
}
```

Changing branch from "u/mkoeppe/affine-hull-more" to "u/gh-kliem/affine-hull-more"



---

archive/issue_comments_529152.json:
```json
{
    "body": "Changing commit from \"57fd3e185cf891c27fe93cde9fe9cabb9290468d\" to \"b17aa8ca5cd80b6895b0d4442c2e473c34b96f29\"",
    "created_at": "2021-04-25T06:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529152",
    "user": "https://github.com/kliem"
}
```

Changing commit from "57fd3e185cf891c27fe93cde9fe9cabb9290468d" to "b17aa8ca5cd80b6895b0d4442c2e473c34b96f29"



---

archive/issue_comments_529153.json:
```json
{
    "body": "<a id='comment:56'></a>\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)|`add another doctest`|",
    "created_at": "2021-04-25T06:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529153",
    "user": "https://github.com/kliem"
}
```

<a id='comment:56'></a>
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)|`add another doctest`|



---

archive/issue_comments_529154.json:
```json
{
    "body": "Changing commit from \"b17aa8ca5cd80b6895b0d4442c2e473c34b96f29\" to \"eee1aadd98f1ef91f7a07bd478ac8613a83a94d7\"",
    "created_at": "2021-04-26T11:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b17aa8ca5cd80b6895b0d4442c2e473c34b96f29" to "eee1aadd98f1ef91f7a07bd478ac8613a83a94d7"



---

archive/issue_comments_529155.json:
```json
{
    "body": "<a id='comment:57'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)|`fix section map`|",
    "created_at": "2021-04-26T11:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)|`fix section map`|



---

archive/issue_comments_529156.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-26T11:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529156",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_529157.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Jonathan Kliem\"",
    "created_at": "2021-04-26T11:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529157",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "Matthias Koeppe, ..." to "Matthias Koeppe, Jonathan Kliem"



---

archive/issue_comments_529158.json:
```json
{
    "body": "<a id='comment:59'></a>\nI'm happy with it now.",
    "created_at": "2021-04-26T11:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529158",
    "user": "https://github.com/kliem"
}
```

<a id='comment:59'></a>
I'm happy with it now.



---

archive/issue_comments_529159.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-26T16:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529159",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_529160.json:
```json
{
    "body": "<a id='comment:60'></a>\nThanks a lot for finding this elegant fix.",
    "created_at": "2021-04-26T16:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Thanks a lot for finding this elegant fix.



---

archive/issue_comments_529161.json:
```json
{
    "body": "Changing keywords from \"polytope,\" to \"polytope\".",
    "created_at": "2021-04-26T16:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529161",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "polytope," to "polytope".



---

archive/issue_events_077106.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:29:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27366#event-77106"
}
```



---

archive/issue_comments_529162.json:
```json
{
    "body": "Changing branch from \"u/gh-kliem/affine-hull-more\" to \"eee1aadd98f1ef91f7a07bd478ac8613a83a94d7\"",
    "created_at": "2021-05-27T20:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529162",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-kliem/affine-hull-more" to "eee1aadd98f1ef91f7a07bd478ac8613a83a94d7"



---

archive/issue_comments_529163.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27366#issuecomment-529163",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
