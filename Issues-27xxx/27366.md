# Issue 27366: Polyhedron.affine_hull: more output options

archive/issues_027129.json:
```json
{
    "assignees": [],
    "body": "At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.\n\nMoreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.\n\nDepends on #30551\n\nCC:  @jplab @videlec @kliem\n\nKeywords: **polytope**\n\nBranch/Commit: **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**\n\nReviewer: **Matthias Koeppe, Jonathan Kliem**\n\nAuthor: **Daniel Krenn, Matthias Koeppe, Jonathan Kliem**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27366_\n\n",
    "closed_at": "2021-05-27T20:29:23Z",
    "created_at": "2019-02-26T15:22:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Polyhedron.affine_hull: more output options",
    "type": "issue",
    "updated_at": "2021-05-27T20:29:23Z",
    "url": "https://github.com/sagemath/sage/issues/27366",
    "user": "https://github.com/dkrenn"
}
```
At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.

Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.

Depends on #30551

CC:  @jplab @videlec @kliem

Keywords: **polytope**

Branch/Commit: **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**

Reviewer: **Matthias Koeppe, Jonathan Kliem**

Author: **Daniel Krenn, Matthias Koeppe, Jonathan Kliem**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/27366_





---

archive/issue_events_375929.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-02-26T15:22:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375929"
}
```



---

archive/issue_events_375930.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-02-26T15:22:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375930"
}
```



---

archive/issue_events_375931.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-02-26T15:22:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375931"
}
```



---

archive/issue_events_375932.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-02-26T15:22:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375932"
}
```



---

archive/issue_comments_423325.json:
```json
{
    "body": "Branch: **[u/dkrenn/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/affine-hull-more)**",
    "created_at": "2019-02-26T15:25:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423325",
    "user": "https://github.com/dkrenn"
}
```

Branch: **[u/dkrenn/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/affine-hull-more)**



---

archive/issue_comments_423326.json:
```json
{
    "body": "Commit: **[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)**",
    "created_at": "2019-02-26T15:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423326",
    "user": "https://github.com/dkrenn"
}
```

Commit: **[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)**



---

archive/issue_comments_423327.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ca3e2c4768707db4448b218ee31c3663d5c5e8b\">1ca3e2c</a></td><td><code>Trac #27329: actually use **kwds as promised in docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4efdb4891eb32710f16b8dd20973f62ee8ba69d5\">4efdb48</a></td><td><code>Trac #27329: insert 3 whitespaces (PEP8)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74470e28c89691c95ed7d9f862e44b1bdc15a9f5\">74470e2</a></td><td><code>Trac #27329: insert an additional doctest enhancing the readability of</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9bedce610130acbfbeb5904ab67284efde65c200\">9bedce6</a></td><td><code>Trac #27366: new output parameters for affine_hull</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124\">2075a6b</a></td><td><code>Trac #27366: use new parameter-options in .volume</code></td></tr></table>\n",
    "created_at": "2019-02-26T15:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423327",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ca3e2c4768707db4448b218ee31c3663d5c5e8b">1ca3e2c</a></td><td><code>Trac #27329: actually use **kwds as promised in docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4efdb4891eb32710f16b8dd20973f62ee8ba69d5">4efdb48</a></td><td><code>Trac #27329: insert 3 whitespaces (PEP8)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74470e28c89691c95ed7d9f862e44b1bdc15a9f5">74470e2</a></td><td><code>Trac #27329: insert an additional doctest enhancing the readability of</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9bedce610130acbfbeb5904ab67284efde65c200">9bedce6</a></td><td><code>Trac #27366: new output parameters for affine_hull</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124">2075a6b</a></td><td><code>Trac #27366: use new parameter-options in .volume</code></td></tr></table>




---

archive/issue_comments_423328.json:
```json
{
    "body": "Dependencies: **#27329**",
    "created_at": "2019-02-26T15:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423328",
    "user": "https://github.com/dkrenn"
}
```

Dependencies: **#27329**



---

archive/issue_comments_423329.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f\">e9ed7ee</a></td><td><code>Trac #27366: fixup (lines forgotten to commit in ~2)</code></td></tr></table>\n",
    "created_at": "2019-02-26T15:32:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423329",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f">e9ed7ee</a></td><td><code>Trac #27366: fixup (lines forgotten to commit in ~2)</code></td></tr></table>




---

archive/issue_comments_423330.json:
```json
{
    "body": "Changed commit from **[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)** to **[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)**",
    "created_at": "2019-02-26T15:32:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423330",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2075a6b](https://github.com/sagemath/sagetrac-mirror/commit/2075a6bc042a4e1bcf9941fa52e542fd29e76124)** to **[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)**



---

archive/issue_comments_423331.json:
```json
{
    "body": "Changed commit from **[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)** to **[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)**",
    "created_at": "2019-02-26T15:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e9ed7ee](https://github.com/sagemath/sagetrac-mirror/commit/e9ed7ee67fc08c2368aac374fe126e9989f6271f)** to **[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)**



---

archive/issue_comments_423332.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0\">0cf6bc5</a></td><td><code>Trac #27366: docstring fixup</code></td></tr></table>\n",
    "created_at": "2019-02-26T15:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0">0cf6bc5</a></td><td><code>Trac #27366: docstring fixup</code></td></tr></table>




---

archive/issue_comments_423333.json:
```json
{
    "body": "Changed commit from **[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)** to **[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)**",
    "created_at": "2019-03-07T09:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423333",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0cf6bc5](https://github.com/sagemath/sagetrac-mirror/commit/0cf6bc5b1307db2c4561c9b05babd9e0889e14e0)** to **[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)**



---

archive/issue_comments_423334.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8cb228c757af09b788991a02c9bbc8989773458\">f8cb228</a></td><td><code>Trac #27366 factor out parametric_form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fa37df46b34a787eb6cc7cc00b4b97589af8b84\">8fa37df</a></td><td><code>Trac #27366 use new .parametric_form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/294fbe1d3381694e6efbd74b25a6e4337628d392\">294fbe1</a></td><td><code>Trac #27366 output affine_map</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6cf71c79eb5cc28782fcfc466c7887e3e8da66ea\">6cf71c7</a></td><td><code>Trac #27366 update .volume (to new parameter set)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/477923ba02d85b7c193536397f1665171d4cc799\">477923b</a></td><td><code>Trac #27366 compute coordinate images</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69\">2bbfdc2</a></td><td><code>Trac #27366: update docs</code></td></tr></table>\n",
    "created_at": "2019-03-07T09:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423334",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8cb228c757af09b788991a02c9bbc8989773458">f8cb228</a></td><td><code>Trac #27366 factor out parametric_form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fa37df46b34a787eb6cc7cc00b4b97589af8b84">8fa37df</a></td><td><code>Trac #27366 use new .parametric_form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/294fbe1d3381694e6efbd74b25a6e4337628d392">294fbe1</a></td><td><code>Trac #27366 output affine_map</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6cf71c79eb5cc28782fcfc466c7887e3e8da66ea">6cf71c7</a></td><td><code>Trac #27366 update .volume (to new parameter set)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/477923ba02d85b7c193536397f1665171d4cc799">477923b</a></td><td><code>Trac #27366 compute coordinate images</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69">2bbfdc2</a></td><td><code>Trac #27366: update docs</code></td></tr></table>




---

archive/issue_comments_423335.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951\">3c09477</a></td><td><code>Trac #27366: fix no-variables-bug-wrong-parent bug</code></td></tr></table>\n",
    "created_at": "2019-03-10T17:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951">3c09477</a></td><td><code>Trac #27366: fix no-variables-bug-wrong-parent bug</code></td></tr></table>




---

archive/issue_comments_423336.json:
```json
{
    "body": "Changed commit from **[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)** to **[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)**",
    "created_at": "2019-03-10T17:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423336",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2bbfdc2](https://github.com/sagemath/sagetrac-mirror/commit/2bbfdc2df0fb5a2ef869ce0c2bb13c7ef8e47d69)** to **[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)**



---

archive/issue_events_375933.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-03-10T18:22:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375933"
}
```



---

archive/issue_comments_423337.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ad45bc966b0aa83369ea78d9db90f354a0b1b2\">82ad45b</a></td><td><code>Trac #27366: cache affine hull</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b\">3bdea15</a></td><td><code>Trac #27366: reintegrate parametric form and solve dimension bug</code></td></tr></table>\n",
    "created_at": "2019-03-12T11:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423337",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ad45bc966b0aa83369ea78d9db90f354a0b1b2">82ad45b</a></td><td><code>Trac #27366: cache affine hull</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b">3bdea15</a></td><td><code>Trac #27366: reintegrate parametric form and solve dimension bug</code></td></tr></table>




---

archive/issue_comments_423338.json:
```json
{
    "body": "Changed commit from **[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)** to **[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)**",
    "created_at": "2019-03-12T11:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423338",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3c09477](https://github.com/sagemath/sagetrac-mirror/commit/3c09477e154b426b44c23a754a19605b1a668951)** to **[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)**



---

archive/issue_events_375934.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375934"
}
```



---

archive/issue_events_375935.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375935"
}
```



---

archive/issue_comments_423339.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423339",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_375936.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375936"
}
```



---

archive/issue_events_375937.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375937"
}
```



---

archive/issue_comments_423340.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423340",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_423341.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nred branch, needs to be rebased on top of the latest beta",
    "created_at": "2019-08-31T07:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423341",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

red branch, needs to be rebased on top of the latest beta



---

archive/issue_events_375938.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-31T07:18:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375938"
}
```



---

archive/issue_events_375939.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-31T07:18:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375939"
}
```



---

archive/issue_comments_423342.json:
```json
{
    "body": "Changed keywords from none to **polytope**",
    "created_at": "2019-09-03T18:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423342",
    "user": "https://github.com/jplab"
}
```

Changed keywords from none to **polytope**



---

archive/issue_comments_423343.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423343",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Ticket retargeted after milestone closed



---

archive/issue_events_375940.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375940"
}
```



---

archive/issue_events_375941.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375941"
}
```



---

archive/issue_comments_423344.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423344",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_375942.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375942"
}
```



---

archive/issue_events_375943.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375943"
}
```



---

archive/issue_events_375944.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375944"
}
```



---

archive/issue_events_375945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375945"
}
```



---

archive/issue_events_375946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375946"
}
```



---

archive/issue_events_375947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375947"
}
```



---

archive/issue_comments_423345.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423345",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_423346.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**",
    "created_at": "2021-04-12T19:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423346",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/dkrenn/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**



---

archive/issue_comments_423347.json:
```json
{
    "body": "Changed commit from **[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)** to **[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)**",
    "created_at": "2021-04-12T19:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423347",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[3bdea15](https://github.com/sagemath/sagetrac-mirror/commit/3bdea15eafc77d3d9cd593933097934ae3d68f1b)** to **[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)**



---

archive/issue_comments_423348.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMerged with current develop.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e\">b407987</a></td><td><code>Merge tag '9.3.rc2' into t/27366/affine-hull-more</code></td></tr></table>\n",
    "created_at": "2021-04-12T19:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423348",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Merged with current develop.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e">b407987</a></td><td><code>Merge tag '9.3.rc2' into t/27366/affine-hull-more</code></td></tr></table>




---

archive/issue_events_375948.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-12T20:25:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375948"
}
```



---

archive/issue_events_375949.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-12T20:25:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375949"
}
```



---

archive/issue_comments_423349.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nUntested so far...",
    "created_at": "2021-04-12T20:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423349",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Untested so far...



---

archive/issue_comments_423350.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d25f7f3967c18063398dc4ed4bf486599f667d9e\">d25f7f3</a></td><td><code>Fixup merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4\">7e0f31d</a></td><td><code>affine_hull -> affine_hull_projection in doctests</code></td></tr></table>\n",
    "created_at": "2021-04-13T02:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423350",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d25f7f3967c18063398dc4ed4bf486599f667d9e">d25f7f3</a></td><td><code>Fixup merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4">7e0f31d</a></td><td><code>affine_hull -> affine_hull_projection in doctests</code></td></tr></table>




---

archive/issue_comments_423351.json:
```json
{
    "body": "Changed commit from **[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)** to **[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)**",
    "created_at": "2021-04-13T02:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423351",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b407987](https://github.com/sagemath/sagetrac-mirror/commit/b407987152fe0d7683a5224d4ec51edc4863f72e)** to **[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)**



---

archive/issue_comments_423352.json:
```json
{
    "body": "Changed dependencies from **#27329** to none",
    "created_at": "2021-04-13T20:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423352",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#27329** to none



---

archive/issue_comments_423353.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b\">58e6dcc</a></td><td><code>Merge tag '9.3.rc3' into t/27366/affine-hull-more</code></td></tr></table>\n",
    "created_at": "2021-04-13T20:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423353",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b">58e6dcc</a></td><td><code>Merge tag '9.3.rc3' into t/27366/affine-hull-more</code></td></tr></table>




---

archive/issue_comments_423354.json:
```json
{
    "body": "Changed commit from **[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)** to **[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)**",
    "created_at": "2021-04-13T20:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423354",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7e0f31d](https://github.com/sagemath/sagetrac-mirror/commit/7e0f31dedcf66d43ed4b15b5e62ab770b774f5f4)** to **[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)**



---

archive/issue_comments_423355.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667\">8414039</a></td><td><code>Polyhedron_base.affine_hull_projection: Document a weaker guarantee of parametric_form</code></td></tr></table>\n",
    "created_at": "2021-04-13T21:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423355",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667">8414039</a></td><td><code>Polyhedron_base.affine_hull_projection: Document a weaker guarantee of parametric_form</code></td></tr></table>




---

archive/issue_comments_423356.json:
```json
{
    "body": "Changed commit from **[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)** to **[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)**",
    "created_at": "2021-04-13T21:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423356",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[58e6dcc](https://github.com/sagemath/sagetrac-mirror/commit/58e6dcc12549380bc130b9dacebf42bba5ecec4b)** to **[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)**



---

archive/issue_comments_423357.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI plan to rework this so the output is a bit more straightforward.\n\nWe have `affine_map`, which is the projection that sends the affine hull (k-dimensional affine subspace of R<sup>n</sup>) to R<sup>k</sup>.\n\nWhat's missing is simply its section map that sends back R<sup>k</sup> to the affine hull.\n\nI think both `parametric_form` and `coordinate_images` somehow represent this section map.\n\nAs the section map is affine linear, we should represent it in the same way as `affine_map`: A linear transformation and a shift.",
    "created_at": "2021-04-14T00:40:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423357",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

I plan to rework this so the output is a bit more straightforward.

We have `affine_map`, which is the projection that sends the affine hull (k-dimensional affine subspace of R<sup>n</sup>) to R<sup>k</sup>.

What's missing is simply its section map that sends back R<sup>k</sup> to the affine hull.

I think both `parametric_form` and `coordinate_images` somehow represent this section map.

As the section map is affine linear, we should represent it in the same way as `affine_map`: A linear transformation and a shift.



---

archive/issue_comments_423358.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9\">dba2763</a></td><td><code>Polyhedron_base.affine_hull_projection: Replace 'affine_map' by 'projection_map', 'parametric_form'/'coordinate_images' by 'section_map'</code></td></tr></table>\n",
    "created_at": "2021-04-14T05:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423358",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9">dba2763</a></td><td><code>Polyhedron_base.affine_hull_projection: Replace 'affine_map' by 'projection_map', 'parametric_form'/'coordinate_images' by 'section_map'</code></td></tr></table>




---

archive/issue_comments_423359.json:
```json
{
    "body": "Changed commit from **[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)** to **[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)**",
    "created_at": "2021-04-14T05:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423359",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8414039](https://github.com/sagemath/sagetrac-mirror/commit/84140398fe84337784834e13f5c4fc5cb73ab667)** to **[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)**



---

archive/issue_comments_423360.json:
```json
{
    "body": "Changed author from **Daniel Krenn** to **Daniel Krenn, Matthias Koeppe**",
    "created_at": "2021-04-14T05:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423360",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Daniel Krenn** to **Daniel Krenn, Matthias Koeppe**



---

archive/issue_comments_423361.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nFor the non-orthogonal case, the `section_map` still needs to be computed.\n\nBut comments are already welcome",
    "created_at": "2021-04-14T05:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423361",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

For the non-orthogonal case, the `section_map` still needs to be computed.

But comments are already welcome



---

archive/issue_events_375950.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-14T05:15:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375950"
}
```



---

archive/issue_events_375951.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-14T05:15:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375951"
}
```



---

archive/issue_comments_423362.json:
```json
{
    "body": "Changed commit from **[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)** to **[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)**",
    "created_at": "2021-04-15T04:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dba2763](https://github.com/sagemath/sagetrac-mirror/commit/dba27635d03a6453c07a884199d2f2062aea8ad9)** to **[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)**



---

archive/issue_comments_423363.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5\">d49c313</a></td><td><code>Polyhedron_base.affine_hull_projection: section map for non-orthogonal case</code></td></tr></table>\n",
    "created_at": "2021-04-15T04:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423363",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5">d49c313</a></td><td><code>Polyhedron_base.affine_hull_projection: section map for non-orthogonal case</code></td></tr></table>




---

archive/issue_comments_423364.json:
```json
{
    "body": "Changed commit from **[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)** to **[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)**",
    "created_at": "2021-04-15T04:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423364",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d49c313](https://github.com/sagemath/sagetrac-mirror/commit/d49c3136036a247843d4a2b9e83c320ce01f05c5)** to **[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)**



---

archive/issue_comments_423365.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada\">d77181b</a></td><td><code>Add doctest</code></td></tr></table>\n",
    "created_at": "2021-04-15T04:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423365",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada">d77181b</a></td><td><code>Add doctest</code></td></tr></table>




---

archive/issue_events_375952.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T04:54:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375952"
}
```



---

archive/issue_events_375953.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T04:54:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375953"
}
```



---

archive/issue_comments_423366.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.\n \n-Moreover, we also allow to additionally return some more (internal) data using during creating the affine map. This is a preparation for #27365.\n+Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.\n``````\n",
    "created_at": "2021-04-15T04:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423366",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 At the moment when calling `.affine_hull`, either the polyhedron or the affine map can be returned. If both needed, parts need to be recomputed, so we extend the parameters to allow returning both at the same time.
 
-Moreover, we also allow to additionally return some more (internal) data using during creating the affine map. This is a preparation for #27365.
+Moreover, we also allow to additionally return the section map, i.e., the right inverse of the projection map. This is a preparation for #27365 and #31659.
``````




---

archive/issue_comments_423367.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nStill some issues with algebraic numbers:\n\n```\nsage: D = polytopes.dodecahedron()\nsage: D.facets()[0].as_polyhedron().affine_hull_projection()                                                                       \nA 2-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^2 defined as the convex hull of 5 vertices\nsage: D.facets()[0].as_polyhedron().affine_hull_projection(return_all_data=True)  \nTypeError: (-sqrt5 + 1, -2*sqrt5 + 4, 0) fails to convert into the map's domain Vector space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented\n```",
    "created_at": "2021-04-15T06:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423367",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Still some issues with algebraic numbers:

```
sage: D = polytopes.dodecahedron()
sage: D.facets()[0].as_polyhedron().affine_hull_projection()                                                                       
A 2-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^2 defined as the convex hull of 5 vertices
sage: D.facets()[0].as_polyhedron().affine_hull_projection(return_all_data=True)  
TypeError: (-sqrt5 + 1, -2*sqrt5 + 4, 0) fails to convert into the map's domain Vector space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented
```



---

archive/issue_events_375954.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T06:07:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375954"
}
```



---

archive/issue_events_375955.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T06:07:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375955"
}
```



---

archive/issue_comments_423368.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI have a fix almost ready and added a test method.\n\nHowever, there is going to be one more ticket in the dependency chain:\n\n```\nsage: D = polytopes.dodecahedron()                                                                                                                                                  \nsage: D.change_ring(AA) == D                                                                                                                                                        \nFalse\n```",
    "created_at": "2021-04-15T19:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423368",
    "user": "https://github.com/kliem"
}
```

<div id="comment:32" align="right">comment:32</div>

I have a fix almost ready and added a test method.

However, there is going to be one more ticket in the dependency chain:

```
sage: D = polytopes.dodecahedron()                                                                                                                                                  
sage: D.change_ring(AA) == D                                                                                                                                                        
False
```



---

archive/issue_comments_423369.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe behavior is actually consistent with rings, I still don't like it.\n\nLooks, like this is related to #4621:\n\n```\nsage: D = polytopes.dodecahedron()                                                                                                                                                  \nsage: D.base_ring()                                                                                                                                                                 \nNumber Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?\nsage: sqrt5 = D.base_ring().gens()[0]                                                                                                                                               \nsage: sqrt5 == AA(sqrt5)                                                                                                                                                            \nFalse\nsage: 0*sqrt5 == AA(0)                                                                                                                                                              \nFalse\n```\n\nThis is extremely stupid. At least it should throw an error instead of giving a false negative. But its pointless to be fixed here.\n\nEdit: I realized that equality checks should never throw an error. So it is really hard to do the right thing here. The base ring of algebraic polyhedra has a specified embedding into `RLF`, which makes it incomparable with `AA`.",
    "created_at": "2021-04-15T19:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423369",
    "user": "https://github.com/kliem"
}
```

<div id="comment:33" align="right">comment:33</div>

The behavior is actually consistent with rings, I still don't like it.

Looks, like this is related to #4621:

```
sage: D = polytopes.dodecahedron()                                                                                                                                                  
sage: D.base_ring()                                                                                                                                                                 
Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?
sage: sqrt5 = D.base_ring().gens()[0]                                                                                                                                               
sage: sqrt5 == AA(sqrt5)                                                                                                                                                            
False
sage: 0*sqrt5 == AA(0)                                                                                                                                                              
False
```

This is extremely stupid. At least it should throw an error instead of giving a false negative. But its pointless to be fixed here.

Edit: I realized that equality checks should never throw an error. So it is really hard to do the right thing here. The base ring of algebraic polyhedra has a specified embedding into `RLF`, which makes it incomparable with `AA`.



---

archive/issue_comments_423370.json:
```json
{
    "body": "Changed author from **Daniel Krenn, Matthias Koeppe** to **Daniel Krenn, Matthias Koeppe, Jonathan Kliem**",
    "created_at": "2021-04-15T19:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423370",
    "user": "https://github.com/kliem"
}
```

Changed author from **Daniel Krenn, Matthias Koeppe** to **Daniel Krenn, Matthias Koeppe, Jonathan Kliem**



---

archive/issue_comments_423371.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nUnfortunately, it is still at \"needs work\".\n\nThe test suite fails for `polytopes.Birkhoff(3)` terribly (the section map has incorrect rank).\n\nIt also fails for the 0-dimensional polyhedron, but maybe that is just the way it is.\n\nIt fails for unbounded polyhedron, in particular `Polyhedron(rays=[This is the Trac macro *0, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 1-macro))`.",
    "created_at": "2021-04-15T19:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423371",
    "user": "https://github.com/kliem"
}
```

<div id="comment:34" align="right">comment:34</div>

Unfortunately, it is still at "needs work".

The test suite fails for `polytopes.Birkhoff(3)` terribly (the section map has incorrect rank).

It also fails for the 0-dimensional polyhedron, but maybe that is just the way it is.

It fails for unbounded polyhedron, in particular `Polyhedron(rays=[This is the Trac macro *0, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 1-macro))`.



---

archive/issue_comments_423372.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab10ce252b95caecaff09df9c1e14dbcff1f7826\">ab10ce2</a></td><td><code>correct base_rings for projection and section map and test suite method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d\">69ceebc</a></td><td><code>base extend in test; only run defined tests</code></td></tr></table>\n",
    "created_at": "2021-04-15T19:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423372",
    "user": "https://github.com/kliem"
}
```

<div id="comment:35"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab10ce252b95caecaff09df9c1e14dbcff1f7826">ab10ce2</a></td><td><code>correct base_rings for projection and section map and test suite method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d">69ceebc</a></td><td><code>base extend in test; only run defined tests</code></td></tr></table>




---

archive/issue_comments_423373.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**",
    "created_at": "2021-04-15T19:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423373",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**



---

archive/issue_comments_423374.json:
```json
{
    "body": "Changed commit from **[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)** to **[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)**",
    "created_at": "2021-04-15T19:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423374",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[d77181b](https://github.com/sagemath/sagetrac-mirror/commit/d77181b4e6da158661dea4a4fc37269d58489ada)** to **[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)**



---

archive/issue_comments_423375.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThanks a lot! Great idea to add the test method",
    "created_at": "2021-04-15T19:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423375",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Thanks a lot! Great idea to add the test method



---

archive/issue_comments_423376.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI started adding doctests and I realized that they are extremely long and nobody is actually going to check them...",
    "created_at": "2021-04-15T20:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423376",
    "user": "https://github.com/kliem"
}
```

<div id="comment:37" align="right">comment:37</div>

I started adding doctests and I realized that they are extremely long and nobody is actually going to check them...



---

archive/issue_comments_423377.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**",
    "created_at": "2021-04-15T23:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423377",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**



---

archive/issue_comments_423378.json:
```json
{
    "body": "Changed commit from **[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)** to **[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)**",
    "created_at": "2021-04-15T23:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423378",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[69ceebc](https://github.com/sagemath/sagetrac-mirror/commit/69ceebcca7df21e39a4ab1bb719cdfaea9b6986d)** to **[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)**



---

archive/issue_comments_423379.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877\">9629620</a></td><td><code>Polyhedron_base.affine_hull_projection: Fix up use of echelong form</code></td></tr></table>\n",
    "created_at": "2021-04-15T23:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423379",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877">9629620</a></td><td><code>Polyhedron_base.affine_hull_projection: Fix up use of echelong form</code></td></tr></table>




---

archive/issue_events_375956.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T23:48:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375956"
}
```



---

archive/issue_events_375957.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T23:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375957"
}
```



---

archive/issue_comments_423380.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, ...**",
    "created_at": "2021-04-15T23:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423380",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe, ...**



---

archive/issue_comments_423381.json:
```json
{
    "body": "Changed commit from **[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)** to **[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)**",
    "created_at": "2021-04-16T01:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423381",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9629620](https://github.com/sagemath/sagetrac-mirror/commit/9629620ed8e4e824adace4a7f867059961fce877)** to **[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)**



---

archive/issue_comments_423382.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa\">8c24c5c</a></td><td><code>Polyhedron_base.affine_hull_projection: Remove last occurrence of 'parametric_form'</code></td></tr></table>\n",
    "created_at": "2021-04-16T01:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423382",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa">8c24c5c</a></td><td><code>Polyhedron_base.affine_hull_projection: Remove last occurrence of 'parametric_form'</code></td></tr></table>




---

archive/issue_comments_423383.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThere is still a doctest that fails terribly. (After fixing an incorrect doctest that I will push in a minute).\n\n```\nsage: p = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                            \nsage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        \nsage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           \nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           \nsage: p1 == p                                                                                                                                                                       \nTrue\nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                \nsage: p1 == p                                                         \nTrue\n```\n\nSomehow linear transformation applied to a 0-dimensional polyhedron isn't stable. The problem really seems to be connected to underlying matrices:\n\n```\nsage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        \nsage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           \nsage: M = data['section_map'][0].matrix().transpose()                                                                                                                               \nsage: V = data['polyhedron'].vertices_matrix()                                                                                                                                      \nsage: M*V                                                                                                                                                                           \n[3.445383e-316]\n[          0.0]\nsage: M*V                                                                                                                                                                           \n[3.445383e-316]\n[          0.0]\nsage: M*V                                                                                                                                                                           \n[3.17525635e-316]\n[            0.0]\nsage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           \nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[1.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[1.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\nsage: M*V                                                                                                                                                                           \n[0.0]\n[0.0]\n```\n\nApparently, the content of the matrix is never initialized. You might say that multiplication of those matrices isn't well-defined. However, if you think of this as linear maps, there is only one linear map from `RLF^0` to `RLF^2`.",
    "created_at": "2021-04-16T09:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423383",
    "user": "https://github.com/kliem"
}
```

<div id="comment:43" align="right">comment:43</div>

There is still a doctest that fails terribly. (After fixing an incorrect doctest that I will push in a minute).

```
sage: p = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                            
sage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        
sage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           
sage: p1 == p                                                                                                                                                                       
True
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                
sage: p1 == p                                                         
True
```

Somehow linear transformation applied to a 0-dimensional polyhedron isn't stable. The problem really seems to be connected to underlying matrices:

```
sage: p = Polyhedron([(0,0)], base_ring=RDF)                                                                                                                                        
sage: data = p.affine_hull_projection(return_all_data=True, orthogonal=True, extend=True)                                                                                           
sage: M = data['section_map'][0].matrix().transpose()                                                                                                                               
sage: V = data['polyhedron'].vertices_matrix()                                                                                                                                      
sage: M*V                                                                                                                                                                           
[3.445383e-316]
[          0.0]
sage: M*V                                                                                                                                                                           
[3.445383e-316]
[          0.0]
sage: M*V                                                                                                                                                                           
[3.17525635e-316]
[            0.0]
sage: p1 = data['polyhedron'].linear_transformation(data['section_map'][0].matrix().transpose()) + data['section_map'][1]                                                           
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
sage: M*V                                                                                                                                                                           
[1.0]
[0.0]
sage: M*V                                                                                                                                                                           
[0.0]
[1.0]
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
sage: M*V                                                                                                                                                                           
[0.0]
[0.0]
```

Apparently, the content of the matrix is never initialized. You might say that multiplication of those matrices isn't well-defined. However, if you think of this as linear maps, there is only one linear map from `RLF^0` to `RLF^2`.



---

archive/issue_comments_423384.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nOk, seems to work now.\n\nFixing the problem with real matrices was actually quite easy. The matrix was not initialized as I thought. Should I open a seperate ticket for this?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f5560ae5412fb63f442d80ad85ac1e72a5b17b8\">9f5560a</a></td><td><code>initialize empty matrix after trivial multiplication</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d\">f9faa02</a></td><td><code>minimal extension only avoid AA if the base ring is not already AA</code></td></tr></table>\n",
    "created_at": "2021-04-16T09:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423384",
    "user": "https://github.com/kliem"
}
```

<div id="comment:44" align="right">comment:44</div>

Ok, seems to work now.

Fixing the problem with real matrices was actually quite easy. The matrix was not initialized as I thought. Should I open a seperate ticket for this?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f5560ae5412fb63f442d80ad85ac1e72a5b17b8">9f5560a</a></td><td><code>initialize empty matrix after trivial multiplication</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d">f9faa02</a></td><td><code>minimal extension only avoid AA if the base ring is not already AA</code></td></tr></table>




---

archive/issue_comments_423385.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**",
    "created_at": "2021-04-16T09:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423385",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**



---

archive/issue_comments_423386.json:
```json
{
    "body": "Changed commit from **[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)** to **[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)**",
    "created_at": "2021-04-16T09:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423386",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[8c24c5c](https://github.com/sagemath/sagetrac-mirror/commit/8c24c5c3590df6dbdf033e7a3c936941e4ff2caa)** to **[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)**



---

archive/issue_comments_423387.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThanks for fixing this! I think it's fine to keep it on this ticket",
    "created_at": "2021-04-16T15:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423387",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Thanks for fixing this! I think it's fine to keep it on this ticket



---

archive/issue_comments_423388.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nGreen patchbot.\n\nBut we may want to consider making the result a dataclass (https://docs.python.org/3/library/dataclasses.html) instead of a dictionary",
    "created_at": "2021-04-16T16:30:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423388",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

Green patchbot.

But we may want to consider making the result a dataclass (https://docs.python.org/3/library/dataclasses.html) instead of a dictionary



---

archive/issue_comments_423389.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\n(depends on #30551 - Drop Python 3.6 support - which is planned for 9.4 anyway)",
    "created_at": "2021-04-16T16:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423389",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

(depends on #30551 - Drop Python 3.6 support - which is planned for 9.4 anyway)



---

archive/issue_comments_423390.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n\n```\nfrom dataclasses import dataclass\nfrom typing import Any\n@dataclass\nclass AffineHullProjectionData:\n   polyhedron: Any\n   projection_linear_map: Any\n   projection_translation: Any\n   section_linear_map: Any\n   section_translation: Any\n```\nNote, unpacking the pairs -- this would be future-proof in case we ever decide to add proper affine linear maps to Sage",
    "created_at": "2021-04-16T19:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423390",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>


```
from dataclasses import dataclass
from typing import Any
@dataclass
class AffineHullProjectionData:
   polyhedron: Any
   projection_linear_map: Any
   projection_translation: Any
   section_linear_map: Any
   section_translation: Any
```
Note, unpacking the pairs -- this would be future-proof in case we ever decide to add proper affine linear maps to Sage



---

archive/issue_comments_423391.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**",
    "created_at": "2021-04-19T01:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423391",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)**



---

archive/issue_comments_423392.json:
```json
{
    "body": "Changed commit from **[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)** to **[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)**",
    "created_at": "2021-04-19T03:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423392",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f9faa02](https://github.com/sagemath/sagetrac-mirror/commit/f9faa025d7598c07549691ef9c6c922d31caeb8d)** to **[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)**



---

archive/issue_comments_423393.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d\">57fd3e1</a></td><td><code>Fixup doctest formatting</code></td></tr></table>\n",
    "created_at": "2021-04-19T03:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423393",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d">57fd3e1</a></td><td><code>Fixup doctest formatting</code></td></tr></table>




---

archive/issue_comments_423394.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nThis ticket should depend now on #30551, right?\n\nApparently `sage.geometry.polyhedron.base` is a startup module, which is terrible. I chased it down and it seems one needs to do a series of lazy/more careful imports.\n\n- It starts with `sage/schemes/toric/all.py`, which just imports a everything right away.\n- `sage/schemes/toric/variety.py` imports `Cone, is_Cone`. Both of them are only needed twice in the entire module and not even in popular places, it seems. (There are other places where `is_Cone` is just imported in the module, although it is only used in special methods.\n- `sage/geometry/all.py` could just do a lot more lazy imports (I think all of them should be lazy).\n- `sage/geometry/cone.py` could use a lot more careful imports. E.g. `FinitePoset` is imported, but it is only used for the face lattice. In particular the function `is_Cone` could live without all those imports. If your object isn't a cone, you probably won't need them anyway.\n\n  In particular it imports `is_Polyhedron` in `sage.geometry.polyhedron.base`.\n- Again `sage/geometry/polyhedron/base.py` imports a lot of stuff that is definetly not needed for `is_Polyhedron`.\n\nAdding some lazy imports above, I can avoid the import of `sage.geometry.polyhedron.base'.",
    "created_at": "2021-04-20T08:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423394",
    "user": "https://github.com/kliem"
}
```

<div id="comment:51" align="right">comment:51</div>

This ticket should depend now on #30551, right?

Apparently `sage.geometry.polyhedron.base` is a startup module, which is terrible. I chased it down and it seems one needs to do a series of lazy/more careful imports.

- It starts with `sage/schemes/toric/all.py`, which just imports a everything right away.
- `sage/schemes/toric/variety.py` imports `Cone, is_Cone`. Both of them are only needed twice in the entire module and not even in popular places, it seems. (There are other places where `is_Cone` is just imported in the module, although it is only used in special methods.
- `sage/geometry/all.py` could just do a lot more lazy imports (I think all of them should be lazy).
- `sage/geometry/cone.py` could use a lot more careful imports. E.g. `FinitePoset` is imported, but it is only used for the face lattice. In particular the function `is_Cone` could live without all those imports. If your object isn't a cone, you probably won't need them anyway.

  In particular it imports `is_Polyhedron` in `sage.geometry.polyhedron.base`.
- Again `sage/geometry/polyhedron/base.py` imports a lot of stuff that is definetly not needed for `is_Polyhedron`.

Adding some lazy imports above, I can avoid the import of `sage.geometry.polyhedron.base'.



---

archive/issue_comments_423395.json:
```json
{
    "body": "Dependencies: **#30551**",
    "created_at": "2021-04-20T16:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423395",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30551**



---

archive/issue_comments_423396.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nYes, I've added the dependency. But I don't think we need to merge in the branch of that.",
    "created_at": "2021-04-20T16:10:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423396",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

Yes, I've added the dependency. But I don't think we need to merge in the branch of that.



---

archive/issue_comments_423397.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI have opened #31705 for the lazy import improvements",
    "created_at": "2021-04-20T16:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423397",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

I have opened #31705 for the lazy import improvements



---

archive/issue_comments_423398.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\n\n```\n                L_section = linear_transformation(matrix(len(pivots), self.ambient_dim(),\n                                                         [E[i] for i in range(len(pivots))]).transpose(),\n                                                  side='right')\n```\nThis is not always an inverse to `A`:\n\n```\nsage: set_random_seed(0)                                                                                                              \nsage: M = random_matrix(ZZ, 5, 5, distribution='uniform')                                                                             \nsage: while True: \n....:     M = random_matrix(ZZ, 5, 5, distribution='uniform')   \n....:     if M.rank() != 5: \n....:         break \n....:                                                                                                                                 \nsage: P = Polyhedron(M)                                                                                                               \nsage: P._test_affine_hull_projection()                                                                                                \n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-23-f3c92d590b2b> in <module>\n----> 1 P._test_affine_hull_projection()\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py in _test_affine_hull_projection(self, tester, verbose, **options)\n  10487             else:\n  10488                 self_extend = self\n> 10489             tester.assertEqual(data.polyhedron.linear_transformation(M)\n  10490                                + data.section_translation,\n  10491                                self_extend)\n\n/usr/lib/python3.8/unittest/case.py in assertEqual(self, first, second, msg)\n    910         \"\"\"\n    911         assertion_func = self._getAssertEqualityFunc(first, second)\n--> 912         assertion_func(first, second, msg=msg)\n    913 \n    914     def assertNotEqual(self, first, second, msg=None):\n\n/usr/lib/python3.8/unittest/case.py in _baseAssertEqual(self, first, second, msg)\n    903             standardMsg = '%s != %s' % _common_shorten_repr(first, second)\n    904             msg = self._formatMessage(msg, standardMsg)\n--> 905             raise self.failureException(msg)\n    906 \n    907     def assertEqual(self, first, second, msg=None):\n\nAssertionError: A 4-dimensional polyhedron in QQ^5 defined as the convex hull of 5 vertices != A 4-dimensional polyhedron in ZZ^5 defined as the convex hull of 5 vertices\n```",
    "created_at": "2021-04-25T06:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423398",
    "user": "https://github.com/kliem"
}
```

<div id="comment:55" align="right">comment:55</div>


```
                L_section = linear_transformation(matrix(len(pivots), self.ambient_dim(),
                                                         [E[i] for i in range(len(pivots))]).transpose(),
                                                  side='right')
```
This is not always an inverse to `A`:

```
sage: set_random_seed(0)                                                                                                              
sage: M = random_matrix(ZZ, 5, 5, distribution='uniform')                                                                             
sage: while True: 
....:     M = random_matrix(ZZ, 5, 5, distribution='uniform')   
....:     if M.rank() != 5: 
....:         break 
....:                                                                                                                                 
sage: P = Polyhedron(M)                                                                                                               
sage: P._test_affine_hull_projection()                                                                                                
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-23-f3c92d590b2b> in <module>
----> 1 P._test_affine_hull_projection()

~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py in _test_affine_hull_projection(self, tester, verbose, **options)
  10487             else:
  10488                 self_extend = self
> 10489             tester.assertEqual(data.polyhedron.linear_transformation(M)
  10490                                + data.section_translation,
  10491                                self_extend)

/usr/lib/python3.8/unittest/case.py in assertEqual(self, first, second, msg)
    910         """
    911         assertion_func = self._getAssertEqualityFunc(first, second)
--> 912         assertion_func(first, second, msg=msg)
    913 
    914     def assertNotEqual(self, first, second, msg=None):

/usr/lib/python3.8/unittest/case.py in _baseAssertEqual(self, first, second, msg)
    903             standardMsg = '%s != %s' % _common_shorten_repr(first, second)
    904             msg = self._formatMessage(msg, standardMsg)
--> 905             raise self.failureException(msg)
    906 
    907     def assertEqual(self, first, second, msg=None):

AssertionError: A 4-dimensional polyhedron in QQ^5 defined as the convex hull of 5 vertices != A 4-dimensional polyhedron in ZZ^5 defined as the convex hull of 5 vertices
```



---

archive/issue_events_375958.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-04-25T06:04:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375958"
}
```



---

archive/issue_events_375959.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-04-25T06:04:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375959"
}
```



---

archive/issue_comments_423399.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**",
    "created_at": "2021-04-25T06:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423399",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/affine-hull-more)** to **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)**



---

archive/issue_comments_423400.json:
```json
{
    "body": "Changed commit from **[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)** to **[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)**",
    "created_at": "2021-04-25T06:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423400",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[57fd3e1](https://github.com/sagemath/sagetrac-mirror/commit/57fd3e185cf891c27fe93cde9fe9cabb9290468d)** to **[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)**



---

archive/issue_comments_423401.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29\">b17aa8c</a></td><td><code>add another doctest</code></td></tr></table>\n",
    "created_at": "2021-04-25T06:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423401",
    "user": "https://github.com/kliem"
}
```

<div id="comment:56"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29">b17aa8c</a></td><td><code>add another doctest</code></td></tr></table>




---

archive/issue_comments_423402.json:
```json
{
    "body": "Changed commit from **[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)** to **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**",
    "created_at": "2021-04-26T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423402",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b17aa8c](https://github.com/sagemath/sagetrac-mirror/commit/b17aa8ca5cd80b6895b0d4442c2e473c34b96f29)** to **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**



---

archive/issue_comments_423403.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7\">eee1aad</a></td><td><code>fix section map</code></td></tr></table>\n",
    "created_at": "2021-04-26T11:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423403",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7">eee1aad</a></td><td><code>fix section map</code></td></tr></table>




---

archive/issue_events_375960.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-04-26T11:11:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375960"
}
```



---

archive/issue_events_375961.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-04-26T11:11:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375961"
}
```



---

archive/issue_comments_423404.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Jonathan Kliem**",
    "created_at": "2021-04-26T11:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423404",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Jonathan Kliem**



---

archive/issue_comments_423405.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI'm happy with it now.",
    "created_at": "2021-04-26T11:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423405",
    "user": "https://github.com/kliem"
}
```

<div id="comment:59" align="right">comment:59</div>

I'm happy with it now.



---

archive/issue_events_375962.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-26T16:59:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375962"
}
```



---

archive/issue_events_375963.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-26T16:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375963"
}
```



---

archive/issue_comments_423406.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nThanks a lot for finding this elegant fix.",
    "created_at": "2021-04-26T16:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423406",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

Thanks a lot for finding this elegant fix.



---

archive/issue_events_375964.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375964"
}
```



---

archive/issue_events_375965.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "cd342061931cfdab8e62518b13f1e128649f06b3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-05-27T20:29:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27366#event-375965"
}
```



---

archive/issue_comments_423407.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**",
    "created_at": "2021-05-27T20:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27366",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27366#issuecomment-423407",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/affine-hull-more](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/affine-hull-more)** to **[eee1aad](https://github.com/sagemath/sagetrac-mirror/commit/eee1aadd98f1ef91f7a07bd478ac8613a83a94d7)**
