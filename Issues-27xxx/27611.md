# Issue 27611: Deprecate to_sage() and structure_sheaf() in Macaulay2 interface

archive/issues_027611.json:
```json
{
    "body": "Keywords: macaulay2, deprecation\n\nFor consistency with other interfaces, the method `to_sage()` for converting `Macaulay2Element`s to Sage should be deprecated and replaced by `sage()`. More precisely, the method `_sage_()` inherited from a super class should be implemented.\n\nSimilarly, the Sage method `structure_sheaf()` should be deprecated in favor of the Macaulay2 function `sheaf()` which provides the same functionality. Since `structure_sheaf()` is implemented for any `Macaulay2Element`, even for elements that do not support it, it unnecessarily pollutes the tab completion menu. In contrast, `sheaf()` only appears in the completion menu if an element supports it.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27848\n\n",
    "closed_at": "2019-06-27T20:13:33Z",
    "created_at": "2019-05-18T12:12:21Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Deprecate to_sage() and structure_sheaf() in Macaulay2 interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27611",
    "user": "https://github.com/mwageringel"
}
```
Keywords: macaulay2, deprecation

For consistency with other interfaces, the method `to_sage()` for converting `Macaulay2Element`s to Sage should be deprecated and replaced by `sage()`. More precisely, the method `_sage_()` inherited from a super class should be implemented.

Similarly, the Sage method `structure_sheaf()` should be deprecated in favor of the Macaulay2 function `sheaf()` which provides the same functionality. Since `structure_sheaf()` is implemented for any `Macaulay2Element`, even for elements that do not support it, it unnecessarily pollutes the tab completion menu. In contrast, `sheaf()` only appears in the completion menu if an element supports it.


Issue created by migration from https://trac.sagemath.org/ticket/27848





---

archive/issue_comments_389156.json:
```json
{
    "body": "I have implemented the deprecations and also fixed all the failing doctests involving Macaulay2, which I tested using Macaulay2 1.11 and 1.13 on OS X.\n\nSince the Macaulay2 description of matrices changed in 1.13, I also added code to ensure these matrices have the correct string representation within Sage (see the commit message for details).\n\nTo run the tests on all files that have optional Macaulay2 doctests, you can use:\n\n```\nsage -t --long --optional=sage,macaulay2 $(grep -i \"optional.*macaulay2\" -r src/sage -l | paste -sd \" \" -)\n```\n\n---\nNew commits:",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389156",
    "user": "https://github.com/mwageringel"
}
```

I have implemented the deprecations and also fixed all the failing doctests involving Macaulay2, which I tested using Macaulay2 1.11 and 1.13 on OS X.

Since the Macaulay2 description of matrices changed in 1.13, I also added code to ensure these matrices have the correct string representation within Sage (see the commit message for details).

To run the tests on all files that have optional Macaulay2 doctests, you can use:

```
sage -t --long --optional=sage,macaulay2 $(grep -i "optional.*macaulay2" -r src/sage -l | paste -sd " " -)
```

---
New commits:



---

archive/issue_comments_389157.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389157",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389158.json:
```json
{
    "body": "With python3-sage, and M2 (version 1.14) installed and working, and this ticket's branch, I get\n\n```\nsage -t --long src/sage/matrix/matrix1.pyx  # 2 doctests failed\nsage -t --long src/sage/interfaces/macaulay2.py  # 2 doctests failed\n```\nSome of these failures may be there without the branch here.",
    "created_at": "2019-06-20T09:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389158",
    "user": "https://github.com/fchapoton"
}
```

With python3-sage, and M2 (version 1.14) installed and working, and this ticket's branch, I get

```
sage -t --long src/sage/matrix/matrix1.pyx  # 2 doctests failed
sage -t --long src/sage/interfaces/macaulay2.py  # 2 doctests failed
```
Some of these failures may be there without the branch here.



---

archive/issue_comments_389159.json:
```json
{
    "body": "The matrix failure should be an easy fix: please replace\n\n```\nentries = map(list, self)\n```\nby \n\n```\nentries = [list(c) for c in self]\n```\nin the macaulay method in the file matrix1.pyx.",
    "created_at": "2019-06-20T10:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389159",
    "user": "https://github.com/fchapoton"
}
```

The matrix failure should be an easy fix: please replace

```
entries = map(list, self)
```
by 

```
entries = [list(c) for c in self]
```
in the macaulay method in the file matrix1.pyx.



---

archive/issue_comments_389160.json:
```json
{
    "body": "The other failure is a \"bytes versus string\" problem.\n\nEDIT:\n\nThis shoud be fixed by replacing\n\n```\nreturn s\n```\nby\n`return bytes_to_str(s)`\nin the\n`_sage_src_` method of the M2 interface.",
    "created_at": "2019-06-20T10:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389160",
    "user": "https://github.com/fchapoton"
}
```

The other failure is a "bytes versus string" problem.

EDIT:

This shoud be fixed by replacing

```
return s
```
by
`return bytes_to_str(s)`
in the
`_sage_src_` method of the M2 interface.



---

archive/issue_comments_389161.json:
```json
{
    "body": "I have made my suggested changes. If you agree with them, you can set this ticket to positive review.\n\n---\nNew commits:",
    "created_at": "2019-06-20T11:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389161",
    "user": "https://github.com/fchapoton"
}
```

I have made my suggested changes. If you agree with them, you can set this ticket to positive review.

---
New commits:



---

archive/issue_comments_389162.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-20T17:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389162",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389163.json:
```json
{
    "body": "Ok, thank you.",
    "created_at": "2019-06-20T17:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389163",
    "user": "https://github.com/mwageringel"
}
```

Ok, thank you.



---

archive/issue_events_069031.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-27T20:13:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27611#event-69031"
}
```



---

archive/issue_comments_389164.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-27T20:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389164",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069032.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27611#event-69032"
}
```



---

archive/issue_comments_389165.json:
```json
{
    "body": "Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27611#issuecomment-389165",
    "user": "https://github.com/embray"
}
```

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.
