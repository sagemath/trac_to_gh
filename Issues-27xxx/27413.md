# Issue 27413: Implement picard group and unit group for non-maximal orders

archive/issues_027176.json:
```json
{
    "body": "The goal of this ticket is to compute the unit group (as a subgroup of the unit group of the maximal order) and to compute the picard group (these are useful for isomorphism-testing and isogeny-enumerating of modabvars.) So the goal is to implement the algorithms here: https://math.uni-paderborn.de/fileadmin/mathematik/AG-Computeralgebra/Publications-klueners/picard.pdf . These have already been implemented in Magma (by the authors of the paper, I believe) so we should double-check with the results there.\n\nNon-maximal orders are not well-supported in Sage (Sage uses PARI for maximal orders but PARI does not have non-maximal orders, except for quadratic number fields). For example, \n\n```\nsage: K.<a> = NumberField(x^2-5)\nsage: O = K.order(a); O.is_maximal()\nFalse\nsage: O.ideal(2)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-10-8da0cc5ea6ab> in <module>()\n----> 1 O.ideal(Integer(2))\n\n/home/klui/sage/local/lib/python2.7/site-packages/sage/rings/number_field/order.pyc in ideal(self, *args, **kwds)\n    232         \"\"\"\n    233         if not self.is_maximal():\n--> 234             raise NotImplementedError(\"ideals of non-maximal orders not yet supported.\")\n    235         I = self.number_field().ideal(*args, **kwds)\n    236         if not I.is_integral():\n\nNotImplementedError: ideals of non-maximal orders not yet supported. \n```\nSo this might be hard.\n\n## Progress\n\nThis current branch can:\n\n* return the underlying free module of a fractional ideal of an order given the generators.\n* compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.\n* intersect fractional ideals of non-maximal orders with non-maximal orders.\n* return the prime factors of an integral ideal of a non-maximal order.\n\n\n## Github\n\nI've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development. But I'll push to this ticket every now and then.\n\nKeywords: class group, unit group, non-maximal order, picard group\n\nBranch: [u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders)\n\nStatus: new\n\nCommit: 3df71d581a10a14a5399b79f666560e1fd2dfc6b\n\nIssue created by migration from https://trac.sagemath.org/ticket/27413\n\n",
    "created_at": "2019-03-04T01:19:11Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "Implement picard group and unit group for non-maximal orders",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27413",
    "user": "https://github.com/kevinywlui"
}
```
The goal of this ticket is to compute the unit group (as a subgroup of the unit group of the maximal order) and to compute the picard group (these are useful for isomorphism-testing and isogeny-enumerating of modabvars.) So the goal is to implement the algorithms here: https://math.uni-paderborn.de/fileadmin/mathematik/AG-Computeralgebra/Publications-klueners/picard.pdf . These have already been implemented in Magma (by the authors of the paper, I believe) so we should double-check with the results there.

Non-maximal orders are not well-supported in Sage (Sage uses PARI for maximal orders but PARI does not have non-maximal orders, except for quadratic number fields). For example, 

```
sage: K.<a> = NumberField(x^2-5)
sage: O = K.order(a); O.is_maximal()
False
sage: O.ideal(2)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-10-8da0cc5ea6ab> in <module>()
----> 1 O.ideal(Integer(2))

/home/klui/sage/local/lib/python2.7/site-packages/sage/rings/number_field/order.pyc in ideal(self, *args, **kwds)
    232         """
    233         if not self.is_maximal():
--> 234             raise NotImplementedError("ideals of non-maximal orders not yet supported.")
    235         I = self.number_field().ideal(*args, **kwds)
    236         if not I.is_integral():

NotImplementedError: ideals of non-maximal orders not yet supported. 
```
So this might be hard.

## Progress

This current branch can:

* return the underlying free module of a fractional ideal of an order given the generators.
* compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.
* intersect fractional ideals of non-maximal orders with non-maximal orders.
* return the prime factors of an integral ideal of a non-maximal order.


## Github

I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development. But I'll push to this ticket every now and then.

Keywords: class group, unit group, non-maximal order, picard group

Branch: [u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders)

Status: new

Commit: 3df71d581a10a14a5399b79f666560e1fd2dfc6b

Issue created by migration from https://trac.sagemath.org/ticket/27413





---

archive/issue_comments_530102.json:
```json
{
    "body": "Changing branch from \"\" to \"u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders\"",
    "created_at": "2019-03-16T18:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530102",
    "user": "https://github.com/kevinywlui"
}
```

Changing branch from "" to "u/klui/implement_picard_group_and_unit_group_for_non_maximal_orders"



---

archive/issue_comments_530103.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[b5aa206](https://github.com/sagemath/sagetrac-mirror/commit/b5aa2064e68da601cac73bfab92c5a97adc7ceb4)|`Add comments to conductor`|\n|[ae37da6](https://github.com/sagemath/sagetrac-mirror/commit/ae37da6ff915a3401c1854de1d8f55f81a555b33)|`Add an OrderIdeal class`|\n|[ce1a7ca](https://github.com/sagemath/sagetrac-mirror/commit/ce1a7caaa7972bde99ed475998b3279163a9895d)|`Use OrderIdeal as base class of NumberFieldIdeal`|\n|[8416412](https://github.com/sagemath/sagetrac-mirror/commit/84164123dc6606d9f3b3dcab1c6db710a53cfd17)|`Generalize free_module to work for OrderIdeals`|\n|[dda08ba](https://github.com/sagemath/sagetrac-mirror/commit/dda08ba2cc484115a7b544951c2e9fa285579536)|`Add a README which I will remove at the end`|\n|[157ab65](https://github.com/sagemath/sagetrac-mirror/commit/157ab65427f4ab96256ac664ff9bb645c30e083b)|`Rename from order_ideal to order_fractional_ideal`|\n|[2f2a91d](https://github.com/sagemath/sagetrac-mirror/commit/2f2a91d664bbf6fb8920467108f9886753f68167)|`Fix a typo`|\n|[80905e6](https://github.com/sagemath/sagetrac-mirror/commit/80905e6c80c6e0ed18b5e71d40d46b59e004b9b5)|`Allow conductor to be returned as ideal of self`|\n|[d2455f2](https://github.com/sagemath/sagetrac-mirror/commit/d2455f263a69bd59af5c86a44a1ff0e5cba6f57d)|`Update README to remind to ask sage-nt`|\n|[9d09ebf](https://github.com/sagemath/sagetrac-mirror/commit/9d09ebf443058d35ad6f0a9178514b8f44b277fb)|`Implement richcmp for ideals`|",
    "created_at": "2019-08-17T20:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[b5aa206](https://github.com/sagemath/sagetrac-mirror/commit/b5aa2064e68da601cac73bfab92c5a97adc7ceb4)|`Add comments to conductor`|
|[ae37da6](https://github.com/sagemath/sagetrac-mirror/commit/ae37da6ff915a3401c1854de1d8f55f81a555b33)|`Add an OrderIdeal class`|
|[ce1a7ca](https://github.com/sagemath/sagetrac-mirror/commit/ce1a7caaa7972bde99ed475998b3279163a9895d)|`Use OrderIdeal as base class of NumberFieldIdeal`|
|[8416412](https://github.com/sagemath/sagetrac-mirror/commit/84164123dc6606d9f3b3dcab1c6db710a53cfd17)|`Generalize free_module to work for OrderIdeals`|
|[dda08ba](https://github.com/sagemath/sagetrac-mirror/commit/dda08ba2cc484115a7b544951c2e9fa285579536)|`Add a README which I will remove at the end`|
|[157ab65](https://github.com/sagemath/sagetrac-mirror/commit/157ab65427f4ab96256ac664ff9bb645c30e083b)|`Rename from order_ideal to order_fractional_ideal`|
|[2f2a91d](https://github.com/sagemath/sagetrac-mirror/commit/2f2a91d664bbf6fb8920467108f9886753f68167)|`Fix a typo`|
|[80905e6](https://github.com/sagemath/sagetrac-mirror/commit/80905e6c80c6e0ed18b5e71d40d46b59e004b9b5)|`Allow conductor to be returned as ideal of self`|
|[d2455f2](https://github.com/sagemath/sagetrac-mirror/commit/d2455f263a69bd59af5c86a44a1ff0e5cba6f57d)|`Update README to remind to ask sage-nt`|
|[9d09ebf](https://github.com/sagemath/sagetrac-mirror/commit/9d09ebf443058d35ad6f0a9178514b8f44b277fb)|`Implement richcmp for ideals`|



---

archive/issue_comments_530104.json:
```json
{
    "body": "Changing commit from \"\" to \"9d09ebf443058d35ad6f0a9178514b8f44b277fb\"",
    "created_at": "2019-08-17T20:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "9d09ebf443058d35ad6f0a9178514b8f44b277fb"



---

archive/issue_comments_530105.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,8 @@\n NotImplementedError: ideals of non-maximal orders not yet supported. \n ```\n So this might be hard.\n+\n+\n+## Github\n+\n+I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development.\n``````\n",
    "created_at": "2019-08-17T20:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530105",
    "user": "https://github.com/kevinywlui"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,8 @@
 NotImplementedError: ideals of non-maximal orders not yet supported. 
 ```
 So this might be hard.
+
+
+## Github
+
+I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development.
``````




---

archive/issue_comments_530106.json:
```json
{
    "body": "Changing commit from \"9d09ebf443058d35ad6f0a9178514b8f44b277fb\" to \"c58a523ebe49defce004c17b2128982854ac8c82\"",
    "created_at": "2019-08-17T23:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d09ebf443058d35ad6f0a9178514b8f44b277fb" to "c58a523ebe49defce004c17b2128982854ac8c82"



---

archive/issue_comments_530107.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[c58a523](https://github.com/sagemath/sagetrac-mirror/commit/c58a523ebe49defce004c17b2128982854ac8c82)|`Implement intersection of orders with ideals`|",
    "created_at": "2019-08-17T23:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[c58a523](https://github.com/sagemath/sagetrac-mirror/commit/c58a523ebe49defce004c17b2128982854ac8c82)|`Implement intersection of orders with ideals`|



---

archive/issue_comments_530108.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,7 +23,15 @@\n ```\n So this might be hard.\n \n+## Progress\n+\n+This current branch can:\n+\n+* return the underlying free module of a fractional ideal of an order given the generators.\n+* compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.\n+* intersect fractional ideals of non-maximal orders with non-maximal orders.\n+\n \n ## Github\n \n-I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development.\n+I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development. But I'll push to this ticket every now and then.\n``````\n",
    "created_at": "2019-08-17T23:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530108",
    "user": "https://github.com/kevinywlui"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,7 +23,15 @@
 ```
 So this might be hard.
 
+## Progress
+
+This current branch can:
+
+* return the underlying free module of a fractional ideal of an order given the generators.
+* compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.
+* intersect fractional ideals of non-maximal orders with non-maximal orders.
+
 
 ## Github
 
-I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development.
+I've been using Github for version control. See https://github.com/kevinywlui/sage/tree/order for the lastest development. But I'll push to this ticket every now and then.
``````




---

archive/issue_comments_530109.json:
```json
{
    "body": "Changing commit from \"c58a523ebe49defce004c17b2128982854ac8c82\" to \"3df71d581a10a14a5399b79f666560e1fd2dfc6b\"",
    "created_at": "2019-08-19T02:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c58a523ebe49defce004c17b2128982854ac8c82" to "3df71d581a10a14a5399b79f666560e1fd2dfc6b"



---

archive/issue_comments_530110.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[e487c7e](https://github.com/sagemath/sagetrac-mirror/commit/e487c7efa3ca706a3603abd09ad19ca735804582)|`Rename from order_ideal to order_fractional_ideal`|\n|[a061edc](https://github.com/sagemath/sagetrac-mirror/commit/a061edcee165ba531d97a17907684611eff6c814)|`Fix a typo`|\n|[ca83717](https://github.com/sagemath/sagetrac-mirror/commit/ca8371791f585dc0149242364eaf14eaf079b1ed)|`Allow conductor to be returned as ideal of self`|\n|[8e9337e](https://github.com/sagemath/sagetrac-mirror/commit/8e9337e01b37c07cdbbe4bffa748a84d26f602b2)|`Update README to remind to ask sage-nt`|\n|[b95b503](https://github.com/sagemath/sagetrac-mirror/commit/b95b5039235bd5d921bac1b20d5525d998311cff)|`Implement richcmp for ideals`|\n|[1adfd9d](https://github.com/sagemath/sagetrac-mirror/commit/1adfd9d4e4f58e29b3b4c86b775a0d72b59943b3)|`Implement intersection of orders with ideals`|\n|[16b453f](https://github.com/sagemath/sagetrac-mirror/commit/16b453fce5def8c89453a29d1a8c5036fb1774ee)|`Implement a hash on fractional ideals`|\n|[eb87920](https://github.com/sagemath/sagetrac-mirror/commit/eb87920fcf8c7308de072c465328b1d624d8b369)|`Fix bug in intersection`|\n|[c1b9b26](https://github.com/sagemath/sagetrac-mirror/commit/c1b9b26cb20ea2e330025fd7f79e1a1c531fe7dc)|`Fix remaining bug from conductor`|\n|[3df71d5](https://github.com/sagemath/sagetrac-mirror/commit/3df71d581a10a14a5399b79f666560e1fd2dfc6b)|`Implemented prime_factors`|",
    "created_at": "2019-08-19T02:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[e487c7e](https://github.com/sagemath/sagetrac-mirror/commit/e487c7efa3ca706a3603abd09ad19ca735804582)|`Rename from order_ideal to order_fractional_ideal`|
|[a061edc](https://github.com/sagemath/sagetrac-mirror/commit/a061edcee165ba531d97a17907684611eff6c814)|`Fix a typo`|
|[ca83717](https://github.com/sagemath/sagetrac-mirror/commit/ca8371791f585dc0149242364eaf14eaf079b1ed)|`Allow conductor to be returned as ideal of self`|
|[8e9337e](https://github.com/sagemath/sagetrac-mirror/commit/8e9337e01b37c07cdbbe4bffa748a84d26f602b2)|`Update README to remind to ask sage-nt`|
|[b95b503](https://github.com/sagemath/sagetrac-mirror/commit/b95b5039235bd5d921bac1b20d5525d998311cff)|`Implement richcmp for ideals`|
|[1adfd9d](https://github.com/sagemath/sagetrac-mirror/commit/1adfd9d4e4f58e29b3b4c86b775a0d72b59943b3)|`Implement intersection of orders with ideals`|
|[16b453f](https://github.com/sagemath/sagetrac-mirror/commit/16b453fce5def8c89453a29d1a8c5036fb1774ee)|`Implement a hash on fractional ideals`|
|[eb87920](https://github.com/sagemath/sagetrac-mirror/commit/eb87920fcf8c7308de072c465328b1d624d8b369)|`Fix bug in intersection`|
|[c1b9b26](https://github.com/sagemath/sagetrac-mirror/commit/c1b9b26cb20ea2e330025fd7f79e1a1c531fe7dc)|`Fix remaining bug from conductor`|
|[3df71d5](https://github.com/sagemath/sagetrac-mirror/commit/3df71d581a10a14a5399b79f666560e1fd2dfc6b)|`Implemented prime_factors`|



---

archive/issue_comments_530111.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,7 @@\n * return the underlying free module of a fractional ideal of an order given the generators.\n * compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.\n * intersect fractional ideals of non-maximal orders with non-maximal orders.\n+* return the prime factors of an integral ideal of a non-maximal order.\n \n \n ## Github\n``````\n",
    "created_at": "2019-08-19T02:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27413#issuecomment-530111",
    "user": "https://github.com/kevinywlui"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,7 @@
 * return the underlying free module of a fractional ideal of an order given the generators.
 * compute the conductor of a non-maximal order as both an ideal of the maximal order and the non-maximal order.
 * intersect fractional ideals of non-maximal orders with non-maximal orders.
+* return the prime factors of an integral ideal of a non-maximal order.
 
 
 ## Github
``````

