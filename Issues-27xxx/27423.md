# Issue 27423: fix constructor of ConvexRationalPolyhedralCone

archive/issues_027186.json:
```json
{
    "body": "CC:  @novoselt\n\nThe class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an \"advanced\" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).\n\nThis ticket stands to fix this possibly problematic behavior. Some options:\n1. reintroduce mutability/immutability in `pplpy`\n2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)\n3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)\n\nIssue created by migration from https://trac.sagemath.org/ticket/27423\n\n",
    "closed_at": "2019-03-07T19:26:53Z",
    "created_at": "2019-03-04T19:23:33Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "fix constructor of ConvexRationalPolyhedralCone",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27423",
    "user": "https://github.com/videlec"
}
```
CC:  @novoselt

The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an "advanced" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).

This ticket stands to fix this possibly problematic behavior. Some options:
1. reintroduce mutability/immutability in `pplpy`
2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)
3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)

Issue created by migration from https://trac.sagemath.org/ticket/27423





---

archive/issue_comments_382619.json:
```json
{
    "body": "How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.",
    "created_at": "2019-03-05T00:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382619",
    "user": "https://github.com/novoselt"
}
```

How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.



---

archive/issue_comments_382620.json:
```json
{
    "body": "Replying to [comment:2 novoselt]:\n> How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.\n\n\n`PPL` (the C++ library) does not implement any mutability flag. This is why it has disappeared in the Python interface `pplpy`. A mutability flag is definitely error prone since you can still modify the polyhedron via C++ access to `thisptr`. Unless you have a serious use case for this immutability flag I am not inclined to reintroduce it.",
    "created_at": "2019-03-05T09:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382620",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:2 novoselt]:
> How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.


`PPL` (the C++ library) does not implement any mutability flag. This is why it has disappeared in the Python interface `pplpy`. A mutability flag is definitely error prone since you can still modify the polyhedron via C++ access to `thisptr`. Unless you have a serious use case for this immutability flag I am not inclined to reintroduce it.



---

archive/issue_comments_382621.json:
```json
{
    "body": "What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.",
    "created_at": "2019-03-05T09:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382621",
    "user": "https://github.com/videlec"
}
```

What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.



---

archive/issue_comments_382622.json:
```json
{
    "body": "Replying to [comment:4 vdelecroix]:\n> What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.\n\n\nIndeed, PPL has copy constructor which I believe does the right thing.",
    "created_at": "2019-03-05T09:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382622",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:4 vdelecroix]:
> What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.


Indeed, PPL has copy constructor which I believe does the right thing.



---

archive/issue_comments_382623.json:
```json
{
    "body": "What if it is not gigantic, but there are 400 millions of them? What's the point to copy it if you specifically produced a PPL object to feed into constructor? Given that it is unlikely to be used \"by accident\", I think it should be kept as is, but the documentation should clearly say that it will be stored in a private attribute and will be assumed not to change.",
    "created_at": "2019-03-05T17:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382623",
    "user": "https://github.com/novoselt"
}
```

What if it is not gigantic, but there are 400 millions of them? What's the point to copy it if you specifically produced a PPL object to feed into constructor? Given that it is unlikely to be used "by accident", I think it should be kept as is, but the documentation should clearly say that it will be stored in a private attribute and will be assumed not to change.



---

archive/issue_comments_382624.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382624",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_382625.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382625",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_382626.json:
```json
{
    "body": "Should it be \"make a copy\" rather than \"take a copy\"?",
    "created_at": "2019-03-06T17:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382626",
    "user": "https://github.com/novoselt"
}
```

Should it be "make a copy" rather than "take a copy"?



---

archive/issue_comments_382627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-06T17:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382628.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-06T17:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382628",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_382629.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-07T19:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-382629",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068112.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-07T19:26:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27423#event-68112"
}
```
