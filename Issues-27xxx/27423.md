# Issue 27423: fix constructor of ConvexRationalPolyhedralCone

archive/issues_027186.json:
```json
{
    "body": "The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an \"advanced\" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).\n\nThis ticket stands to fix this possibly problematic behavior. Some options:\n1. reintroduce mutability/immutability in `pplpy`\n2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)\n3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)\n\n**CC:**  @novoselt\n\n**Branch/Commit:** [d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)\n\n**Reviewer:** Andrey Novoseltsev\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/27423\n\n",
    "closed_at": "2019-03-07T19:26:53Z",
    "created_at": "2019-03-04T19:23:33Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "fix constructor of ConvexRationalPolyhedralCone",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27423",
    "user": "https://github.com/videlec"
}
```
The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an "advanced" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).

This ticket stands to fix this possibly problematic behavior. Some options:
1. reintroduce mutability/immutability in `pplpy`
2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)
3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)

**CC:**  @novoselt

**Branch/Commit:** [d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)

**Reviewer:** Andrey Novoseltsev

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/27423





---

archive/issue_comments_505651.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an \"advanced\" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).\n \n-This ticket stands to fix the behavior.\n+This ticket stands to fix this possibly problematic behavior. Some options:\n+1. reintroduce mutability/immutability in `pplpy`\n+2. make a copy of the polyhedron\n+3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)\n``````\n",
    "created_at": "2019-03-04T19:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505651",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 The class `ConvexRationalPolyhedralCone` (`sage/geometry/cone.py`) has an "advanced" constructor parameter `PPL` that can be set to a `ppl.polyhedron.C_Polyhedron`. However, before #23024, this attribute used to be set immutable in the constructor and this is not the case anymore (since pplpy does not support the mutability/immutability flag).
 
-This ticket stands to fix the behavior.
+This ticket stands to fix this possibly problematic behavior. Some options:
+1. reintroduce mutability/immutability in `pplpy`
+2. make a copy of the polyhedron
+3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)
``````




---

archive/issue_comments_505652.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n This ticket stands to fix this possibly problematic behavior. Some options:\n 1. reintroduce mutability/immutability in `pplpy`\n-2. make a copy of the polyhedron\n+2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)\n 3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)\n``````\n",
    "created_at": "2019-03-05T00:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505652",
    "user": "https://github.com/novoselt"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 This ticket stands to fix this possibly problematic behavior. Some options:
 1. reintroduce mutability/immutability in `pplpy`
-2. make a copy of the polyhedron
+2. ~~make a copy of the polyhedron~~ (this definitely should not be done - the reason for this parameter is to avoid any work when PPL representation is already constructed)
 3. keep it the way it is but fix the [documentation](https://github.com/sagemath/sage/blob/develop/src/sage/geometry/cone.py#L1370-L1373)
``````




---

archive/issue_comments_505653.json:
```json
{
    "body": "<a id='comment:2'></a>\nHow feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.",
    "created_at": "2019-03-05T00:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505653",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.



---

archive/issue_comments_505654.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [novoselt](#comment%3A2):\n> How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.\n\n\n`PPL` (the C++ library) does not implement any mutability flag. This is why it has disappeared in the Python interface `pplpy`. A mutability flag is definitely error prone since you can still modify the polyhedron via C++ access to `thisptr`. Unless you have a serious use case for this immutability flag I am not inclined to reintroduce it.",
    "created_at": "2019-03-05T09:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505654",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Replying to [novoselt](#comment%3A2):
> How feasible is the first option? I imagine what has to be done is adding a flag and then making sure that it is checked in all functions (current and future) that may change the polyhedron.


`PPL` (the C++ library) does not implement any mutability flag. This is why it has disappeared in the Python interface `pplpy`. A mutability flag is definitely error prone since you can still modify the polyhedron via C++ access to `thisptr`. Unless you have a serious use case for this immutability flag I am not inclined to reintroduce it.



---

archive/issue_comments_505655.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhat is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.",
    "created_at": "2019-03-05T09:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505655",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.



---

archive/issue_comments_505656.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [vdelecroix](#comment%3A4):\n> What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.\n\n\nIndeed, PPL has copy constructor which I believe does the right thing.",
    "created_at": "2019-03-05T09:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505656",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Replying to [vdelecroix](#comment%3A4):
> What is the problem with option 2? Copying the whole PPL object (together with all its data) is doable and certainly not expensive unless it is gigantic.


Indeed, PPL has copy constructor which I believe does the right thing.



---

archive/issue_comments_505657.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhat if it is not gigantic, but there are 400 millions of them? What's the point to copy it if you specifically produced a PPL object to feed into constructor? Given that it is unlikely to be used \"by accident\", I think it should be kept as is, but the documentation should clearly say that it will be stored in a private attribute and will be assumed not to change.",
    "created_at": "2019-03-05T17:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505657",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>
What if it is not gigantic, but there are 400 millions of them? What's the point to copy it if you specifically produced a PPL object to feed into constructor? Given that it is unlikely to be used "by accident", I think it should be kept as is, but the documentation should clearly say that it will be stored in a private attribute and will be assumed not to change.



---

archive/issue_comments_505658.json:
```json
{
    "body": "<a id='comment:7'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad\">5a5293c</a></td><td><code>fix documentation of PPL parameter</code></td></tr></table>\n",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505658",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad">5a5293c</a></td><td><code>fix documentation of PPL parameter</code></td></tr></table>




---

archive/issue_comments_505659.json:
```json
{
    "body": "**Commit:** [5a5293c265a8b252e7f1691526540352ef0411ad](https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad)",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505659",
    "user": "https://github.com/videlec"
}
```

**Commit:** [5a5293c265a8b252e7f1691526540352ef0411ad](https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad)



---

archive/issue_comments_505660.json:
```json
{
    "body": "**Author:** Vincent Delecroix",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505660",
    "user": "https://github.com/videlec"
}
```

**Author:** Vincent Delecroix



---

archive/issue_comments_505661.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505661",
    "user": "https://github.com/videlec"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_505662.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/27423](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/27423)",
    "created_at": "2019-03-05T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505662",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/27423](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/27423)



---

archive/issue_comments_505663.json:
```json
{
    "body": "**Reviewer:** Andrey Novoseltsev",
    "created_at": "2019-03-06T17:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505663",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Andrey Novoseltsev



---

archive/issue_comments_505664.json:
```json
{
    "body": "<a id='comment:8'></a>\nShould it be \"make a copy\" rather than \"take a copy\"?",
    "created_at": "2019-03-06T17:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505664",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>
Should it be "make a copy" rather than "take a copy"?



---

archive/issue_comments_505665.json:
```json
{
    "body": "**Changing commit** from \"[5a5293c265a8b252e7f1691526540352ef0411ad](https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad)\" to \"[d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)\".",
    "created_at": "2019-03-06T17:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5a5293c265a8b252e7f1691526540352ef0411ad](https://github.com/sagemath/sagetrac-mirror/commit/5a5293c265a8b252e7f1691526540352ef0411ad)" to "[d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)".



---

archive/issue_comments_505666.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f\">d04b627</a></td><td><code>take -> make</code></td></tr></table>\n",
    "created_at": "2019-03-06T17:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f">d04b627</a></td><td><code>take -> make</code></td></tr></table>




---

archive/issue_comments_505667.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-03-06T17:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505667",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_076932.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-07T19:26:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27423#event-76932"
}
```



---

archive/issue_comments_505668.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/27423](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/27423)\" to \"[d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)\".",
    "created_at": "2019-03-07T19:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27423#issuecomment-505668",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/27423](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/27423)" to "[d04b62728fefc25fa98742552ce9cad2f354ab6f](https://github.com/sagemath/sagetrac-mirror/commit/d04b62728fefc25fa98742552ce9cad2f354ab6f)".
