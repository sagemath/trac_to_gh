# Issue 27529: py3: tiny fix in env.py

archive/issues_027292.json:
```json
{
    "body": "\n\nCC:  @embray @jdemeyer @tscrim @kiwifb\n\nBranch/Commit: 8ebcdc67d8abfec50d7891496bd6f069bd76ad99\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27529\n\n",
    "closed_at": "2019-06-02T22:04:33Z",
    "created_at": "2019-03-22T07:57:21Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: tiny fix in env.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27529",
    "user": "https://github.com/fchapoton"
}
```


CC:  @embray @jdemeyer @tscrim @kiwifb

Branch/Commit: 8ebcdc67d8abfec50d7891496bd6f069bd76ad99

Reviewer: Jeroen Demeyer

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27529





---

archive/issue_comments_532863.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-22T07:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532863",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_532864.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[c6ca0b1](https://github.com/sagemath/sagetrac-mirror/commit/c6ca0b109482c081c79da9cfdb507793148c8fe7)|`py3 tiny fix in env.py`|",
    "created_at": "2019-03-22T07:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532864",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[c6ca0b1](https://github.com/sagemath/sagetrac-mirror/commit/c6ca0b109482c081c79da9cfdb507793148c8fe7)|`py3 tiny fix in env.py`|



---

archive/issue_comments_532865.json:
```json
{
    "body": "Changing commit from \"\" to \"c6ca0b109482c081c79da9cfdb507793148c8fe7\"",
    "created_at": "2019-03-22T07:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532865",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "c6ca0b109482c081c79da9cfdb507793148c8fe7"



---

archive/issue_comments_532866.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/27529\"",
    "created_at": "2019-03-22T07:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532866",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/27529"



---

archive/issue_comments_532867.json:
```json
{
    "body": "<a id='comment:2'></a>\ngreen bot, please review",
    "created_at": "2019-03-22T12:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532867",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
green bot, please review



---

archive/issue_comments_532868.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-22T12:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532868",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_532869.json:
```json
{
    "body": "<a id='comment:3'></a>\nPlease use `sys.executable` instead.",
    "created_at": "2019-03-22T12:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532869",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Please use `sys.executable` instead.



---

archive/issue_comments_532870.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[812181f](https://github.com/sagemath/sagetrac-mirror/commit/812181f084f197c48be617e83f8f2414b6462c0d)|`using sys.executable instead`|",
    "created_at": "2019-03-22T12:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[812181f](https://github.com/sagemath/sagetrac-mirror/commit/812181f084f197c48be617e83f8f2414b6462c0d)|`using sys.executable instead`|



---

archive/issue_comments_532871.json:
```json
{
    "body": "Changing commit from \"c6ca0b109482c081c79da9cfdb507793148c8fe7\" to \"812181f084f197c48be617e83f8f2414b6462c0d\"",
    "created_at": "2019-03-22T12:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c6ca0b109482c081c79da9cfdb507793148c8fe7" to "812181f084f197c48be617e83f8f2414b6462c0d"



---

archive/issue_comments_532872.json:
```json
{
    "body": "<a id='comment:5'></a>\nindeed, better. Thx",
    "created_at": "2019-03-22T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532872",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
indeed, better. Thx



---

archive/issue_comments_532873.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-22T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532873",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_532874.json:
```json
{
    "body": "<a id='comment:6'></a>\nthere is another one in src/sage/doctest/control.py, let us fix it too",
    "created_at": "2019-03-22T12:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532874",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
there is another one in src/sage/doctest/control.py, let us fix it too



---

archive/issue_comments_532875.json:
```json
{
    "body": "Changing commit from \"812181f084f197c48be617e83f8f2414b6462c0d\" to \"83aa62d3846a861c07e9b0a6edd4aeb915eedf65\"",
    "created_at": "2019-03-22T12:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "812181f084f197c48be617e83f8f2414b6462c0d" to "83aa62d3846a861c07e9b0a6edd4aeb915eedf65"



---

archive/issue_comments_532876.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[83aa62d](https://github.com/sagemath/sagetrac-mirror/commit/83aa62d3846a861c07e9b0a6edd4aeb915eedf65)|`another use of sys.executable`|",
    "created_at": "2019-03-22T12:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[83aa62d](https://github.com/sagemath/sagetrac-mirror/commit/83aa62d3846a861c07e9b0a6edd4aeb915eedf65)|`another use of sys.executable`|



---

archive/issue_comments_532877.json:
```json
{
    "body": "<a id='comment:8'></a>\nVery good! Positive review if this passes tests on Python 2 and 3.",
    "created_at": "2019-03-22T12:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532877",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Very good! Positive review if this passes tests on Python 2 and 3.



---

archive/issue_comments_532878.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2019-03-22T12:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532878",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_532879.json:
```json
{
    "body": "<a id='comment:9'></a>\nhmm. The change in doctest control breaks one doctest in python3:\n\n```\nsage -t --long src/sage/doctest/control.py\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 630, in sage.doctest.control.DocTestController.test_safe_directory\nFailed example:\n    DC.test_safe_directory(d)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: refusing to run doctests...\nGot:\n    <BLANKLINE>\n```\nI am not sure what to do :\n- undo this change ?\n- tag the doctest with # py2 ?",
    "created_at": "2019-03-22T14:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532879",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
hmm. The change in doctest control breaks one doctest in python3:

```
sage -t --long src/sage/doctest/control.py
**********************************************************************
File "src/sage/doctest/control.py", line 630, in sage.doctest.control.DocTestController.test_safe_directory
Failed example:
    DC.test_safe_directory(d)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: refusing to run doctests...
Got:
    <BLANKLINE>
```
I am not sure what to do :
- undo this change ?
- tag the doctest with # py2 ?



---

archive/issue_comments_532880.json:
```json
{
    "body": "<a id='comment:10'></a>\nThat's interesting. It means two things if I am not mistaken.\n* python3 does allow you to run stuff from unsafe directories just like python2\n* the doctest and possibly the functionality never worked with python3. That bit must have always called python2.",
    "created_at": "2019-03-22T18:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532880",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
That's interesting. It means two things if I am not mistaken.
* python3 does allow you to run stuff from unsafe directories just like python2
* the doctest and possibly the functionality never worked with python3. That bit must have always called python2.



---

archive/issue_comments_532881.json:
```json
{
    "body": "<a id='comment:11'></a>\n1. `doctest` is not tested by `python3-known-passing.txt`, so that doctest failure doesn't have to prevent merging this ticket. The fix makes sense, despite that it breaks a doctest.\n\n2. I posted about this failure on https://groups.google.com/d/msg/sage-devel/_pH7bjQmw5A/IJz_zlMxAwAJ but that thread didn't come to a conclusion.",
    "created_at": "2019-03-22T20:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532881",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
1. `doctest` is not tested by `python3-known-passing.txt`, so that doctest failure doesn't have to prevent merging this ticket. The fix makes sense, despite that it breaks a doctest.

2. I posted about this failure on https://groups.google.com/d/msg/sage-devel/_pH7bjQmw5A/IJz_zlMxAwAJ but that thread didn't come to a conclusion.



---

archive/issue_comments_532882.json:
```json
{
    "body": "<a id='comment:12'></a>\nI would prefer not to have any new py3-failing file.",
    "created_at": "2019-03-23T06:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532882",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
I would prefer not to have any new py3-failing file.



---

archive/issue_comments_532883.json:
```json
{
    "body": "<a id='comment:13'></a>\nok, let it be. Jeroen, I am setting to positive in your name.",
    "created_at": "2019-03-23T20:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532883",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
ok, let it be. Jeroen, I am setting to positive in your name.



---

archive/issue_comments_532884.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-23T20:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532884",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_532885.json:
```json
{
    "body": "<a id='comment:14'></a>\nI'm also not too happy with this situation, but at least this edited test reflects better the reality that it's failing on Python 3. Note that this specific test has always been somewhat controversial.",
    "created_at": "2019-03-23T21:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532885",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
I'm also not too happy with this situation, but at least this edited test reflects better the reality that it's failing on Python 3. Note that this specific test has always been somewhat controversial.



---

archive/issue_comments_532886.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-03-25T11:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532886",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_532887.json:
```json
{
    "body": "<a id='comment:15'></a>\nPlease squash your commits, and maybe reference this ticket # in the commit message.",
    "created_at": "2019-03-25T11:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532887",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Please squash your commits, and maybe reference this ticket # in the commit message.



---

archive/issue_comments_532888.json:
```json
{
    "body": "<a id='comment:16'></a>\nSee #26457 which discusses the possibility of removing this test altogether, or #25358 (which would conflict with this) for an alternative middle-ground.\n\nI would rather we go ahead and do one of these than make fixes to a test that's dubious in the first place.",
    "created_at": "2019-03-25T11:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532888",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
See #26457 which discusses the possibility of removing this test altogether, or #25358 (which would conflict with this) for an alternative middle-ground.

I would rather we go ahead and do one of these than make fixes to a test that's dubious in the first place.



---

archive/issue_events_077518.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-25T19:43:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27529#event-77518"
}
```



---

archive/issue_comments_532889.json:
```json
{
    "body": "Changing branch from \"u/chapoton/27529\" to \"83aa62d3846a861c07e9b0a6edd4aeb915eedf65\"",
    "created_at": "2019-03-25T19:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532889",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/27529" to "83aa62d3846a861c07e9b0a6edd4aeb915eedf65"



---

archive/issue_comments_532890.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-25T19:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532890",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_532891.json:
```json
{
    "body": "Changing commit from \"83aa62d3846a861c07e9b0a6edd4aeb915eedf65\" to \"\"",
    "created_at": "2019-03-25T19:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532891",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "83aa62d3846a861c07e9b0a6edd4aeb915eedf65" to ""



---

archive/issue_comments_532892.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2019-03-25T19:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532892",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_532893.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2019-03-25T19:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532893",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_532894.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2019-03-26T11:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532894",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_532895.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-03-29T20:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532895",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_532896.json:
```json
{
    "body": "Changing commit from \"\" to \"e928ec7891d2c8d9134dd238c1859dd26f20d67d\"",
    "created_at": "2019-03-29T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532896",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "e928ec7891d2c8d9134dd238c1859dd26f20d67d"



---

archive/issue_comments_532897.json:
```json
{
    "body": "<a id='comment:21'></a>\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[e928ec7](https://github.com/sagemath/sagetrac-mirror/commit/e928ec7891d2c8d9134dd238c1859dd26f20d67d)|`trac #27529 py3 tiny fix in env.py (using sys.executable)`|",
    "created_at": "2019-03-29T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532897",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[e928ec7](https://github.com/sagemath/sagetrac-mirror/commit/e928ec7891d2c8d9134dd238c1859dd26f20d67d)|`trac #27529 py3 tiny fix in env.py (using sys.executable)`|



---

archive/issue_comments_532898.json:
```json
{
    "body": "Changing branch from \"83aa62d3846a861c07e9b0a6edd4aeb915eedf65\" to \"u/chapoton/27529\"",
    "created_at": "2019-03-29T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532898",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "83aa62d3846a861c07e9b0a6edd4aeb915eedf65" to "u/chapoton/27529"



---

archive/issue_comments_532899.json:
```json
{
    "body": "<a id='comment:22'></a>\nWhy don't we split this (already tiny fix) into pieces? The change in `env.py` should be safe, right? The more controversial doctest can be dealt with elsewhere.",
    "created_at": "2019-05-29T02:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532899",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
Why don't we split this (already tiny fix) into pieces? The change in `env.py` should be safe, right? The more controversial doctest can be dealt with elsewhere.



---

archive/issue_comments_532900.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jhpalmieri](#comment%3A22):\n> Why don't we split this (already tiny fix) into pieces? The change in `env.py` should be safe, right? The more controversial doctest can be dealt with elsewhere.\n\n\nWorks for me.",
    "created_at": "2019-05-29T02:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532900",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Replying to [jhpalmieri](#comment%3A22):
> Why don't we split this (already tiny fix) into pieces? The change in `env.py` should be safe, right? The more controversial doctest can be dealt with elsewhere.


Works for me.



---

archive/issue_comments_532901.json:
```json
{
    "body": "<a id='comment:24'></a>\nAnd just to make sure I understand correctly: there are two issues with the tests\n\n```\n    Check that Sage refuses to run doctests from a directory whose\n    permissions are too loose.  We create a world-writable directory\n    inside a safe temporary directory to test this::\n\n        sage: d = os.path.join(tmp_dir(), \"test\")\n        sage: os.mkdir(d)\n        sage: os.chmod(d, 0o777)\n        sage: (out, err, ret) = test_executable([\"sage\", \"-t\", \"nonexisting.py\"], cwd=d)\n        sage: print(err)\n        ...\n        RuntimeError: refusing to run doctests...\n        sage: (out, err, ret) = test_executable([\"sage\", \"-tp\", \"1\", \"nonexisting.py\"], cwd=d)\n        sage: print(err)\n        ...\n        RuntimeError: refusing to run doctests...\n```\nright? First, they don't work at all with Python 3 because of `subprocess.call(['python', ...`, and second, they don't work with an unpatched Python. We can fix the second of these by tagging the doctests `# build`. We could fix the first in a less than ideal way by tagging the doctests `# py2`.",
    "created_at": "2019-05-29T02:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532901",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
And just to make sure I understand correctly: there are two issues with the tests

```
    Check that Sage refuses to run doctests from a directory whose
    permissions are too loose.  We create a world-writable directory
    inside a safe temporary directory to test this::

        sage: d = os.path.join(tmp_dir(), "test")
        sage: os.mkdir(d)
        sage: os.chmod(d, 0o777)
        sage: (out, err, ret) = test_executable(["sage", "-t", "nonexisting.py"], cwd=d)
        sage: print(err)
        ...
        RuntimeError: refusing to run doctests...
        sage: (out, err, ret) = test_executable(["sage", "-tp", "1", "nonexisting.py"], cwd=d)
        sage: print(err)
        ...
        RuntimeError: refusing to run doctests...
```
right? First, they don't work at all with Python 3 because of `subprocess.call(['python', ...`, and second, they don't work with an unpatched Python. We can fix the second of these by tagging the doctests `# build`. We could fix the first in a less than ideal way by tagging the doctests `# py2`.



---

archive/issue_comments_532902.json:
```json
{
    "body": "<a id='comment:25'></a>\nThey would \"work\" if python was python3 which can kind of happen in sage-on-distro. But yes they are the kind of tests the `# build` tag is suitable for. More so than `# py2`.",
    "created_at": "2019-05-29T04:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532902",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
They would "work" if python was python3 which can kind of happen in sage-on-distro. But yes they are the kind of tests the `# build` tag is suitable for. More so than `# py2`.



---

archive/issue_comments_532903.json:
```json
{
    "body": "Changing commit from \"e928ec7891d2c8d9134dd238c1859dd26f20d67d\" to \"8ebcdc67d8abfec50d7891496bd6f069bd76ad99\"",
    "created_at": "2019-05-30T15:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e928ec7891d2c8d9134dd238c1859dd26f20d67d" to "8ebcdc67d8abfec50d7891496bd6f069bd76ad99"



---

archive/issue_comments_532904.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[8ebcdc6](https://github.com/sagemath/sagetrac-mirror/commit/8ebcdc67d8abfec50d7891496bd6f069bd76ad99)|`trac #27529 py3 tiny fix in env.py (using sys.executable)`|",
    "created_at": "2019-05-30T15:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[8ebcdc6](https://github.com/sagemath/sagetrac-mirror/commit/8ebcdc67d8abfec50d7891496bd6f069bd76ad99)|`trac #27529 py3 tiny fix in env.py (using sys.executable)`|



---

archive/issue_comments_532905.json:
```json
{
    "body": "<a id='comment:27'></a>\nHere is a branch with only the changes in env.py. Positive ?",
    "created_at": "2019-05-30T15:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532905",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
Here is a branch with only the changes in env.py. Positive ?



---

archive/issue_comments_532906.json:
```json
{
    "body": "<a id='comment:28'></a>\nI think so. Jeroen already reviewed positively before, and I can confirm that the change fixes the py3 problem with `env.py`.",
    "created_at": "2019-05-30T20:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532906",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
I think so. Jeroen already reviewed positively before, and I can confirm that the change fixes the py3 problem with `env.py`.



---

archive/issue_comments_532907.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-30T20:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532907",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_532908.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-02T22:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532908",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_532909.json:
```json
{
    "body": "Changing branch from \"u/chapoton/27529\" to \"8ebcdc67d8abfec50d7891496bd6f069bd76ad99\"",
    "created_at": "2019-06-02T22:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27529#issuecomment-532909",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/27529" to "8ebcdc67d8abfec50d7891496bd6f069bd76ad99"



---

archive/issue_events_077519.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-02T22:04:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27529",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27529#event-77519"
}
```
