# Issue 27049: py3: some fix in Riemann surfaces

archive/issues_026812.json:
```json
{
    "assignees": [],
    "body": "only partial, there remains 4 failing doctests out of 36\n\nCC:  @tscrim\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, Nils Bruin**\n\nBranch/Commit: **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27049_\n\n",
    "closed_at": "2019-01-24T18:17:31Z",
    "created_at": "2019-01-13T09:31:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: some fix in Riemann surfaces",
    "type": "issue",
    "updated_at": "2019-01-24T18:17:31Z",
    "url": "https://github.com/sagemath/sage/issues/27049",
    "user": "https://github.com/fchapoton"
}
```
only partial, there remains 4 failing doctests out of 36

CC:  @tscrim

Component: **python3**

Author: **Frédéric Chapoton, Nils Bruin**

Branch/Commit: **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/27049_





---

archive/issue_events_368783.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368783"
}
```



---

archive/issue_events_368784.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368784"
}
```



---

archive/issue_events_368785.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368785"
}
```



---

archive/issue_events_368786.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368786"
}
```



---

archive/issue_comments_417134.json:
```json
{
    "body": "Commit: **[`31bceaf`](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)**",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417134",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`31bceaf`](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)**



---

archive/issue_events_368787.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368787"
}
```



---

archive/issue_comments_417135.json:
```json
{
    "body": "Branch: **[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)**",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417135",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)**



---

archive/issue_comments_417136.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8\"><code>31bceaf</code></a></td><td><code>py3 some partial fix for Riemann surfaces</code></td></tr></table>\n",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417136",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8"><code>31bceaf</code></a></td><td><code>py3 some partial fix for Riemann surfaces</code></td></tr></table>




---

archive/issue_comments_417137.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\ngreen bot, please review",
    "created_at": "2019-01-13T14:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417137",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

green bot, please review



---

archive/issue_comments_417138.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nLGTM.",
    "created_at": "2019-01-13T17:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417138",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

LGTM.



---

archive/issue_events_368788.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-13T17:01:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368788"
}
```



---

archive/issue_events_368789.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-13T17:01:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368789"
}
```



---

archive/issue_comments_417139.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-01-13T17:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417139",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_417140.json:
```json
{
    "body": "Changed branch from **[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)** to **[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)**",
    "created_at": "2019-01-14T20:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417140",
    "user": "https://github.com/nbruin"
}
```

Changed branch from **[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)** to **[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)**



---

archive/issue_comments_417141.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nChanged back to using sqrt method. It's much faster because it doesn't have to do all the generic stuff. This is a core routine -- it actually makes a difference if it's fast.\n\n(also -- not a fan of all the trivial whitespace edits. It makes it hard to tell from the diff what has actually changed. If you have to touch a line anyway: sure, go ahead. Otherwise I think it's better to just leave it in the original form and not impose (subjective) aesthetics --PEP8's suggestions are mainly against too much whitespace; less so for too little :-) )\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3\"><code>9176ecb</code></a></td><td><code>Use sqrt method, which is faster and more specific, rather than generic function</code></td></tr></table>\n",
    "created_at": "2019-01-14T21:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417141",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:5" align="right">comment:5</div>

Changed back to using sqrt method. It's much faster because it doesn't have to do all the generic stuff. This is a core routine -- it actually makes a difference if it's fast.

(also -- not a fan of all the trivial whitespace edits. It makes it hard to tell from the diff what has actually changed. If you have to touch a line anyway: sure, go ahead. Otherwise I think it's better to just leave it in the original form and not impose (subjective) aesthetics --PEP8's suggestions are mainly against too much whitespace; less so for too little :-) )

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3"><code>9176ecb</code></a></td><td><code>Use sqrt method, which is faster and more specific, rather than generic function</code></td></tr></table>




---

archive/issue_comments_417142.json:
```json
{
    "body": "Changed commit from **[`31bceaf`](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)** to **[`9176ecb`](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)**",
    "created_at": "2019-01-14T21:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417142",
    "user": "https://github.com/nbruin"
}
```

Changed commit from **[`31bceaf`](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)** to **[`9176ecb`](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)**



---

archive/issue_comments_417143.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nVery minor change, but I guess someone should take a look at it before we set it back to positive review.",
    "created_at": "2019-01-14T21:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417143",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

Very minor change, but I guess someone should take a look at it before we set it back to positive review.



---

archive/issue_events_368790.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2019-01-14T21:33:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368790"
}
```



---

archive/issue_events_368791.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2019-01-14T21:33:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368791"
}
```



---

archive/issue_comments_417144.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIt would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot):\n\n```\nsage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 32 doctests failed\n```",
    "created_at": "2019-01-15T06:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417144",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot):

```
sage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 32 doctests failed
```



---

archive/issue_events_368792.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T06:28:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368792"
}
```



---

archive/issue_events_368793.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T06:28:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368793"
}
```



---

archive/issue_comments_417145.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, Nils Bruin**",
    "created_at": "2019-01-15T06:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417145",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, Nils Bruin**



---

archive/issue_comments_417146.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhatever way, the point of this ticket is to make this module's doctests pass with both python2 and python3. If you want to keep the speed, this may not be so easy.\n\nEDIT: pep8 is official for sage, see\n\nhttps://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style",
    "created_at": "2019-01-15T07:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417146",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

Whatever way, the point of this ticket is to make this module's doctests pass with both python2 and python3. If you want to keep the speed, this may not be so easy.

EDIT: pep8 is official for sage, see

https://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style



---

archive/issue_comments_417147.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tscrim](#comment%3A7):\n> It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot)\n\nThat's strange. I cannot replicate that behaviour. It seems to me this bot is testing python 2, so it doesn't look like a py2/3 issue. Is this bot anomalous? If I had access to a platform where this behaviour occurs, I could probably debug this quite quickly.",
    "created_at": "2019-01-15T07:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417147",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tscrim](#comment%3A7):
> It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot)

That's strange. I cannot replicate that behaviour. It seems to me this bot is testing python 2, so it doesn't look like a py2/3 issue. Is this bot anomalous? If I had access to a platform where this behaviour occurs, I could probably debug this quite quickly.



---

archive/issue_comments_417148.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMaybe this python3-like behaviour is caused by the line\n\n```\nfrom __future__ import division\n```\nthat we really want to add.",
    "created_at": "2019-01-15T07:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417148",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

Maybe this python3-like behaviour is caused by the line

```
from __future__ import division
```
that we really want to add.



---

archive/issue_comments_417149.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> Maybe this python3-like behaviour is caused by the line\n> \n> ```\n> from __future__ import division\n> ```\n> that we really want to add.\n\nApparently only on some platforms then, because I ran this exact branch without problems. It means some divisions need to be encoded differently. \n\nIs it indeed the case that dividing an element of RealField by a python integer may yield a float on some and a RealField element on others if \"division\" is imported? That would be really bad and would make porting a lot harder.",
    "created_at": "2019-01-15T07:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417149",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@fchapoton](#comment%3A10):
> Maybe this python3-like behaviour is caused by the line
> 
> ```
> from __future__ import division
> ```
> that we really want to add.

Apparently only on some platforms then, because I ran this exact branch without problems. It means some divisions need to be encoded differently. 

Is it indeed the case that dividing an element of RealField by a python integer may yield a float on some and a RealField element on others if "division" is imported? That would be really bad and would make porting a lot harder.



---

archive/issue_comments_417150.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI don't know.\n\nWe could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`",
    "created_at": "2019-01-15T07:45:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417150",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

I don't know.

We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`



---

archive/issue_comments_417151.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@fchapoton](#comment%3A12):\n> We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`\n\nNo, if this really is a problem we can replace the \"division by two\" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.",
    "created_at": "2019-01-15T08:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417151",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@fchapoton](#comment%3A12):
> We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`

No, if this really is a problem we can replace the "division by two" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.



---

archive/issue_comments_417152.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140\"><code>0c4d65b</code></a></td><td><code>try to use shift instead of division-by-two, to work around possibly issues with future division. It might be faster too.</code></td></tr></table>\n",
    "created_at": "2019-01-15T08:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417152",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140"><code>0c4d65b</code></a></td><td><code>try to use shift instead of division-by-two, to work around possibly issues with future division. It might be faster too.</code></td></tr></table>




---

archive/issue_comments_417153.json:
```json
{
    "body": "Changed commit from **[`9176ecb`](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)** to **[`0c4d65b`](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)**",
    "created_at": "2019-01-15T08:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417153",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9176ecb`](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)** to **[`0c4d65b`](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)**



---

archive/issue_comments_417154.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nLet's see how the bot fares with this.",
    "created_at": "2019-01-15T08:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417154",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:15" align="right">comment:15</div>

Let's see how the bot fares with this.



---

archive/issue_comments_417155.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\ngot with python2 77 doctests failings in the modified file, for example\n\n```\nFile \"src/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2244, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__\nFailed example:\n    S1+S1+S1\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__[3]>\", line 1, in <module>\n        S1+S1+S1\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2043, in __add__\n        return RiemannSurfaceSum([self,other])\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2168, in __init__\n        PM = s.period_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1562, in period_matrix\n        PM=self.matrix_of_integral_values(differentials)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1499, in matrix_of_integral_values\n        cycles = self.homology_basis()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1170, in homology_basis\n        edgesu = self.upstairs_edges()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 935, in upstairs_edges\n        homotopycont = self.homotopy_continuation(e)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 711, in homotopy_continuation\n        delta = self._compute_delta(path(T), epsilon, wvalues=currw)/path_length\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 650, in _compute_delta\n        lowerbound = self._CC(self._a0) >> 1\n    TypeError: unsupported operand type(s) for >>: 'sage.rings.complex_number.ComplexNumber' and 'int'\n```",
    "created_at": "2019-01-15T08:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417155",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

got with python2 77 doctests failings in the modified file, for example

```
File "src/sage/schemes/riemann_surfaces/riemann_surface.py", line 2244, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__
Failed example:
    S1+S1+S1
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__[3]>", line 1, in <module>
        S1+S1+S1
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 2043, in __add__
        return RiemannSurfaceSum([self,other])
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 2168, in __init__
        PM = s.period_matrix()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1562, in period_matrix
        PM=self.matrix_of_integral_values(differentials)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1499, in matrix_of_integral_values
        cycles = self.homology_basis()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1170, in homology_basis
        edgesu = self.upstairs_edges()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 935, in upstairs_edges
        homotopycont = self.homotopy_continuation(e)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 711, in homotopy_continuation
        delta = self._compute_delta(path(T), epsilon, wvalues=currw)/path_length
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 650, in _compute_delta
        lowerbound = self._CC(self._a0) >> 1
    TypeError: unsupported operand type(s) for >>: 'sage.rings.complex_number.ComplexNumber' and 'int'
```



---

archive/issue_comments_417156.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nDid you try with a python3-built sage ?\n\nReplying to [@nbruin](#comment%3A13):\n> Replying to [@fchapoton](#comment%3A12):\n> > We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`\n\n> \n> No, if this really is a problem we can replace the \"division by two\" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.",
    "created_at": "2019-01-15T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417156",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

Did you try with a python3-built sage ?

Replying to [@nbruin](#comment%3A13):
> Replying to [@fchapoton](#comment%3A12):
> > We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`

> 
> No, if this really is a problem we can replace the "division by two" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.



---

archive/issue_comments_417157.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWhen undoing the bad change in `lowerbound = self._CC(self._a0) >> 1`,\nI still get 36 failing doctests in python3 and 32 failing doctests in python2 (same as the one reported by Travis above)",
    "created_at": "2019-01-15T08:24:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417157",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

When undoing the bad change in `lowerbound = self._CC(self._a0) >> 1`,
I still get 36 failing doctests in python3 and 32 failing doctests in python2 (same as the one reported by Travis above)



---

archive/issue_comments_417158.json:
```json
{
    "body": "Changed commit from **[`0c4d65b`](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)** to **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**",
    "created_at": "2019-01-15T08:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417158",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0c4d65b`](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)** to **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**



---

archive/issue_comments_417159.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca\"><code>f6b68b9</code></a></td><td><code>Use nth_root to take a root (not a fractional exponent)</code></td></tr></table>\n",
    "created_at": "2019-01-15T08:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417159",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca"><code>f6b68b9</code></a></td><td><code>Use nth_root to take a root (not a fractional exponent)</code></td></tr></table>




---

archive/issue_comments_417160.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nBy running \"sage -b\" I was able to replicate the erroneous behaviour :-). Turns out the problem arose from an erroneous \"fractional\" exponent that was never fractional, so this code was actually not behaving as intended before, but doing so silently.\n\nHopefully the problem is solved now.",
    "created_at": "2019-01-15T08:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417160",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:20" align="right">comment:20</div>

By running "sage -b" I was able to replicate the erroneous behaviour :-). Turns out the problem arose from an erroneous "fractional" exponent that was never fractional, so this code was actually not behaving as intended before, but doing so silently.

Hopefully the problem is solved now.



---

archive/issue_comments_417161.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nok, thanks. This seems to work both in python2 and in python3. I have launched my bot on it.",
    "created_at": "2019-01-15T09:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417161",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

ok, thanks. This seems to work both in python2 and in python3. I have launched my bot on it.



---

archive/issue_events_368794.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368794"
}
```



---

archive/issue_events_368795.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368795"
}
```



---

archive/issue_events_368796.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368796"
}
```



---

archive/issue_events_368797.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368797"
}
```



---

archive/issue_comments_417162.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nBot is now green. so this should be good to go. Positive review, everybody ?",
    "created_at": "2019-01-15T10:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417162",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

Bot is now green. so this should be good to go. Positive review, everybody ?



---

archive/issue_comments_417163.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nLGTM.",
    "created_at": "2019-01-15T16:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417163",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

LGTM.



---

archive/issue_events_368798.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T16:08:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368798"
}
```



---

archive/issue_events_368799.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T16:08:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368799"
}
```



---

archive/issue_events_368800.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-24T18:17:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368800"
}
```



---

archive/issue_events_368801.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d5d5fc74526cc388f3315cbf29c146d848aba902",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-24T18:17:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-368801"
}
```



---

archive/issue_comments_417164.json:
```json
{
    "body": "Changed branch from **[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)** to **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**",
    "created_at": "2019-01-24T18:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-417164",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)** to **[`f6b68b9`](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)**
