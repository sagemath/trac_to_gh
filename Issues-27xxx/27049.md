# Issue 27049: py3: some fix in Riemann surfaces

archive/issues_026812.json:
```json
{
    "assignees": [],
    "body": "only partial, there remains 4 failing doctests out of 36\n\n**CC:**  @tscrim\n\n**Branch/Commit:** [f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Nils Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/27049\n\n",
    "closed_at": "2019-01-24T18:17:31Z",
    "created_at": "2019-01-13T09:31:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: some fix in Riemann surfaces",
    "type": "issue",
    "updated_at": "2019-01-24T18:17:31Z",
    "url": "https://github.com/sagemath/sage/issues/27049",
    "user": "https://github.com/fchapoton"
}
```
only partial, there remains 4 failing doctests out of 36

**CC:**  @tscrim

**Branch/Commit:** [f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)

**Reviewer:** Travis Scrimshaw

**Author:** Frédéric Chapoton, Nils Bruin

Issue created by migration from https://trac.sagemath.org/ticket/27049





---

archive/issue_events_324780.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324780"
}
```



---

archive/issue_events_324781.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324781"
}
```



---

archive/issue_events_324782.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324782"
}
```



---

archive/issue_comments_419875.json:
```json
{
    "body": "**Commit:** [31bceafa0eff35a8ad6a2d701c155794af5ecfa8](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419875",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [31bceafa0eff35a8ad6a2d701c155794af5ecfa8](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)



---

archive/issue_events_324783.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-13T09:31:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324783"
}
```



---

archive/issue_comments_419876.json:
```json
{
    "body": "**Branch:** [u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419876",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)



---

archive/issue_comments_419877.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8\">31bceaf</a></td><td><code>py3 some partial fix for Riemann surfaces</code></td></tr></table>\n",
    "created_at": "2019-01-13T09:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419877",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>**Comment 1:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8">31bceaf</a></td><td><code>py3 some partial fix for Riemann surfaces</code></td></tr></table>




---

archive/issue_comments_419878.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\ngreen bot, please review",
    "created_at": "2019-01-13T14:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419878",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'>**Comment 2:**</a>
green bot, please review



---

archive/issue_comments_419879.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nLGTM.",
    "created_at": "2019-01-13T17:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419879",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>**Comment 3:**</a>
LGTM.



---

archive/issue_events_324784.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-13T17:01:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324784"
}
```



---

archive/issue_events_324785.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-13T17:01:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324785"
}
```



---

archive/issue_comments_419880.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2019-01-13T17:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419880",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_419881.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)\" to \"[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)\".",
    "created_at": "2019-01-14T20:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419881",
    "user": "https://github.com/nbruin"
}
```

**Changing branch** from "[u/chapoton/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27049)" to "[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)".



---

archive/issue_comments_419882.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nChanged back to using sqrt method. It's much faster because it doesn't have to do all the generic stuff. This is a core routine -- it actually makes a difference if it's fast.\n\n(also -- not a fan of all the trivial whitespace edits. It makes it hard to tell from the diff what has actually changed. If you have to touch a line anyway: sure, go ahead. Otherwise I think it's better to just leave it in the original form and not impose (subjective) aesthetics --PEP8's suggestions are mainly against too much whitespace; less so for too little :-) )\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3\">9176ecb</a></td><td><code>Use sqrt method, which is faster and more specific, rather than generic function</code></td></tr></table>\n",
    "created_at": "2019-01-14T21:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419882",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'>**Comment 5:**</a>
Changed back to using sqrt method. It's much faster because it doesn't have to do all the generic stuff. This is a core routine -- it actually makes a difference if it's fast.

(also -- not a fan of all the trivial whitespace edits. It makes it hard to tell from the diff what has actually changed. If you have to touch a line anyway: sure, go ahead. Otherwise I think it's better to just leave it in the original form and not impose (subjective) aesthetics --PEP8's suggestions are mainly against too much whitespace; less so for too little :-) )

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3">9176ecb</a></td><td><code>Use sqrt method, which is faster and more specific, rather than generic function</code></td></tr></table>




---

archive/issue_comments_419883.json:
```json
{
    "body": "**Changing commit** from \"[31bceafa0eff35a8ad6a2d701c155794af5ecfa8](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)\" to \"[9176ecb0378e1329e39cc13164b01b5a6eca22b3](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)\".",
    "created_at": "2019-01-14T21:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419883",
    "user": "https://github.com/nbruin"
}
```

**Changing commit** from "[31bceafa0eff35a8ad6a2d701c155794af5ecfa8](https://github.com/sagemath/sagetrac-mirror/commit/31bceafa0eff35a8ad6a2d701c155794af5ecfa8)" to "[9176ecb0378e1329e39cc13164b01b5a6eca22b3](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)".



---

archive/issue_comments_419884.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nVery minor change, but I guess someone should take a look at it before we set it back to positive review.",
    "created_at": "2019-01-14T21:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419884",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'>**Comment 6:**</a>
Very minor change, but I guess someone should take a look at it before we set it back to positive review.



---

archive/issue_events_324786.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2019-01-14T21:33:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324786"
}
```



---

archive/issue_events_324787.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2019-01-14T21:33:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324787"
}
```



---

archive/issue_comments_419885.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nIt would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot):\n\n```\nsage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 32 doctests failed\n```",
    "created_at": "2019-01-15T06:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419885",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>**Comment 7:**</a>
It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot):

```
sage -t --long src/sage/schemes/riemann_surfaces/riemann_surface.py  # 32 doctests failed
```



---

archive/issue_events_324788.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T06:28:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324788"
}
```



---

archive/issue_events_324789.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T06:28:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324789"
}
```



---

archive/issue_comments_419886.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Nils Bruin\".",
    "created_at": "2019-01-15T06:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419886",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Nils Bruin".



---

archive/issue_comments_419887.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nWhatever way, the point of this ticket is to make this module's doctests pass with both python2 and python3. If you want to keep the speed, this may not be so easy.\n\nEDIT: pep8 is official for sage, see\n\nhttps://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style",
    "created_at": "2019-01-15T07:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419887",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'>**Comment 8:**</a>
Whatever way, the point of this ticket is to make this module's doctests pass with both python2 and python3. If you want to keep the speed, this may not be so easy.

EDIT: pep8 is official for sage, see

https://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style



---

archive/issue_comments_419888.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nReplying to [@tscrim](#comment%3A7):\n> It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot)\n\nThat's strange. I cannot replicate that behaviour. It seems to me this bot is testing python 2, so it doesn't look like a py2/3 issue. Is this bot anomalous? If I had access to a platform where this behaviour occurs, I could probably debug this quite quickly.",
    "created_at": "2019-01-15T07:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419888",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'>**Comment 9:**</a>
Replying to [@tscrim](#comment%3A7):
> It would be fine with me except it can have a `float` input, which leads to these doctest failures (according to the patchbot)

That's strange. I cannot replicate that behaviour. It seems to me this bot is testing python 2, so it doesn't look like a py2/3 issue. Is this bot anomalous? If I had access to a platform where this behaviour occurs, I could probably debug this quite quickly.



---

archive/issue_comments_419889.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nMaybe this python3-like behaviour is caused by the line\n\n```\nfrom __future__ import division\n```\nthat we really want to add.",
    "created_at": "2019-01-15T07:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419889",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'>**Comment 10:**</a>
Maybe this python3-like behaviour is caused by the line

```
from __future__ import division
```
that we really want to add.



---

archive/issue_comments_419890.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nReplying to [@fchapoton](#comment%3A10):\n> Maybe this python3-like behaviour is caused by the line\n> \n> ```\n> from __future__ import division\n> ```\n> that we really want to add.\n\nApparently only on some platforms then, because I ran this exact branch without problems. It means some divisions need to be encoded differently. \n\nIs it indeed the case that dividing an element of RealField by a python integer may yield a float on some and a RealField element on others if \"division\" is imported? That would be really bad and would make porting a lot harder.",
    "created_at": "2019-01-15T07:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419890",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'>**Comment 11:**</a>
Replying to [@fchapoton](#comment%3A10):
> Maybe this python3-like behaviour is caused by the line
> 
> ```
> from __future__ import division
> ```
> that we really want to add.

Apparently only on some platforms then, because I ran this exact branch without problems. It means some divisions need to be encoded differently. 

Is it indeed the case that dividing an element of RealField by a python integer may yield a float on some and a RealField element on others if "division" is imported? That would be really bad and would make porting a lot harder.



---

archive/issue_comments_419891.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nI don't know.\n\nWe could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`",
    "created_at": "2019-01-15T07:45:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419891",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'>**Comment 12:**</a>
I don't know.

We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`



---

archive/issue_comments_419892.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nReplying to [@fchapoton](#comment%3A12):\n> We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`\n\nNo, if this really is a problem we can replace the \"division by two\" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.",
    "created_at": "2019-01-15T08:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419892",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:13'>**Comment 13:**</a>
Replying to [@fchapoton](#comment%3A12):
> We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`

No, if this really is a problem we can replace the "division by two" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.



---

archive/issue_comments_419893.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140\">0c4d65b</a></td><td><code>try to use shift instead of division-by-two, to work around possibly issues with future division. It might be faster too.</code></td></tr></table>\n",
    "created_at": "2019-01-15T08:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419893",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>**Comment 14:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140">0c4d65b</a></td><td><code>try to use shift instead of division-by-two, to work around possibly issues with future division. It might be faster too.</code></td></tr></table>




---

archive/issue_comments_419894.json:
```json
{
    "body": "**Changing commit** from \"[9176ecb0378e1329e39cc13164b01b5a6eca22b3](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)\" to \"[0c4d65bc17d3d406ca1f225a27ef49055edc9140](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)\".",
    "created_at": "2019-01-15T08:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419894",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9176ecb0378e1329e39cc13164b01b5a6eca22b3](https://github.com/sagemath/sagetrac-mirror/commit/9176ecb0378e1329e39cc13164b01b5a6eca22b3)" to "[0c4d65bc17d3d406ca1f225a27ef49055edc9140](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)".



---

archive/issue_comments_419895.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nLet's see how the bot fares with this.",
    "created_at": "2019-01-15T08:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419895",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:15'>**Comment 15:**</a>
Let's see how the bot fares with this.



---

archive/issue_comments_419896.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\ngot with python2 77 doctests failings in the modified file, for example\n\n```\nFile \"src/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2244, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__\nFailed example:\n    S1+S1+S1\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__[3]>\", line 1, in <module>\n        S1+S1+S1\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2043, in __add__\n        return RiemannSurfaceSum([self,other])\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 2168, in __init__\n        PM = s.period_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1562, in period_matrix\n        PM=self.matrix_of_integral_values(differentials)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1499, in matrix_of_integral_values\n        cycles = self.homology_basis()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1170, in homology_basis\n        edgesu = self.upstairs_edges()\n      File \"sage/misc/cachefunc.pyx\", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)\n        self.cache = f(self._instance)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 935, in upstairs_edges\n        homotopycont = self.homotopy_continuation(e)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 711, in homotopy_continuation\n        delta = self._compute_delta(path(T), epsilon, wvalues=currw)/path_length\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py\", line 650, in _compute_delta\n        lowerbound = self._CC(self._a0) >> 1\n    TypeError: unsupported operand type(s) for >>: 'sage.rings.complex_number.ComplexNumber' and 'int'\n```",
    "created_at": "2019-01-15T08:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419896",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'>**Comment 16:**</a>
got with python2 77 doctests failings in the modified file, for example

```
File "src/sage/schemes/riemann_surfaces/riemann_surface.py", line 2244, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__
Failed example:
    S1+S1+S1
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.riemann_surfaces.riemann_surface.RiemannSurfaceSum.__add__[3]>", line 1, in <module>
        S1+S1+S1
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 2043, in __add__
        return RiemannSurfaceSum([self,other])
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 2168, in __init__
        PM = s.period_matrix()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1562, in period_matrix
        PM=self.matrix_of_integral_values(differentials)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1499, in matrix_of_integral_values
        cycles = self.homology_basis()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 1170, in homology_basis
        edgesu = self.upstairs_edges()
      File "sage/misc/cachefunc.pyx", line 2314, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12763)
        self.cache = f(self._instance)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 935, in upstairs_edges
        homotopycont = self.homotopy_continuation(e)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 711, in homotopy_continuation
        delta = self._compute_delta(path(T), epsilon, wvalues=currw)/path_length
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/riemann_surfaces/riemann_surface.py", line 650, in _compute_delta
        lowerbound = self._CC(self._a0) >> 1
    TypeError: unsupported operand type(s) for >>: 'sage.rings.complex_number.ComplexNumber' and 'int'
```



---

archive/issue_comments_419897.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nDid you try with a python3-built sage ?\n\nReplying to [@nbruin](#comment%3A13):\n> Replying to [@fchapoton](#comment%3A12):\n> > We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`\n\n> \n> No, if this really is a problem we can replace the \"division by two\" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.",
    "created_at": "2019-01-15T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419897",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>**Comment 17:**</a>
Did you try with a python3-built sage ?

Replying to [@nbruin](#comment%3A13):
> Replying to [@fchapoton](#comment%3A12):
> > We could try to use `**QQ((1,2))`but it will probably be just as slow as `sqrt(...)`

> 
> No, if this really is a problem we can replace the "division by two" by an exponent operation, which would be very fast. I just need to know which operations are the problematic ones. On the computers I have access to, there is no problem, so I can't debug the problem presently.



---

archive/issue_comments_419898.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nWhen undoing the bad change in `lowerbound = self._CC(self._a0) >> 1`,\nI still get 36 failing doctests in python3 and 32 failing doctests in python2 (same as the one reported by Travis above)",
    "created_at": "2019-01-15T08:24:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419898",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'>**Comment 18:**</a>
When undoing the bad change in `lowerbound = self._CC(self._a0) >> 1`,
I still get 36 failing doctests in python3 and 32 failing doctests in python2 (same as the one reported by Travis above)



---

archive/issue_comments_419899.json:
```json
{
    "body": "**Changing commit** from \"[0c4d65bc17d3d406ca1f225a27ef49055edc9140](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)\" to \"[f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)\".",
    "created_at": "2019-01-15T08:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419899",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0c4d65bc17d3d406ca1f225a27ef49055edc9140](https://github.com/sagemath/sagetrac-mirror/commit/0c4d65bc17d3d406ca1f225a27ef49055edc9140)" to "[f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)".



---

archive/issue_comments_419900.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca\">f6b68b9</a></td><td><code>Use nth_root to take a root (not a fractional exponent)</code></td></tr></table>\n",
    "created_at": "2019-01-15T08:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419900",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>**Comment 19:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca">f6b68b9</a></td><td><code>Use nth_root to take a root (not a fractional exponent)</code></td></tr></table>




---

archive/issue_comments_419901.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nBy running \"sage -b\" I was able to replicate the erroneous behaviour :-). Turns out the problem arose from an erroneous \"fractional\" exponent that was never fractional, so this code was actually not behaving as intended before, but doing so silently.\n\nHopefully the problem is solved now.",
    "created_at": "2019-01-15T08:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419901",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:20'>**Comment 20:**</a>
By running "sage -b" I was able to replicate the erroneous behaviour :-). Turns out the problem arose from an erroneous "fractional" exponent that was never fractional, so this code was actually not behaving as intended before, but doing so silently.

Hopefully the problem is solved now.



---

archive/issue_comments_419902.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nok, thanks. This seems to work both in python2 and in python3. I have launched my bot on it.",
    "created_at": "2019-01-15T09:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419902",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'>**Comment 21:**</a>
ok, thanks. This seems to work both in python2 and in python3. I have launched my bot on it.



---

archive/issue_events_324790.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324790"
}
```



---

archive/issue_events_324791.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324791"
}
```



---

archive/issue_events_324792.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324792"
}
```



---

archive/issue_events_324793.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-15T09:08:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324793"
}
```



---

archive/issue_comments_419903.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nBot is now green. so this should be good to go. Positive review, everybody ?",
    "created_at": "2019-01-15T10:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419903",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>**Comment 24:**</a>
Bot is now green. so this should be good to go. Positive review, everybody ?



---

archive/issue_comments_419904.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nLGTM.",
    "created_at": "2019-01-15T16:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419904",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'>**Comment 25:**</a>
LGTM.



---

archive/issue_events_324794.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T16:08:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324794"
}
```



---

archive/issue_events_324795.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-15T16:08:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324795"
}
```



---

archive/issue_events_324796.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-24T18:17:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324796"
}
```



---

archive/issue_events_324797.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d5d5fc74526cc388f3315cbf29c146d848aba902",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-24T18:17:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27049#event-324797"
}
```



---

archive/issue_comments_419905.json:
```json
{
    "body": "**Changing branch** from \"[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)\" to \"[f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)\".",
    "created_at": "2019-01-24T18:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27049",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27049#issuecomment-419905",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/nbruin/27049](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/27049)" to "[f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca](https://github.com/sagemath/sagetrac-mirror/commit/f6b68b9ad9b814bc20cdec7275ebfd4375e8f1ca)".
