# Issue 18904: Automatically test optional non-packages (CPLEX, Gurobi, Maple?, ..)

archive/issues_018667.json:
```json
{
    "body": "CC:  @vbraun @jdemeyer @dcoudert\n\nWith this branch, the default value of `--optional` in `sage -t` is larger than the list of installed new-style optional packages.\n\nIn particular, `cplex` and `gurobi` (which are not optional packages as they are proprietary) are added to the list (some tests are too slow to be run with glpk, e.g. #18871).\n\nMore can be added to that list. If you know a better way to implement it, I am all ears.\n\nNathann\n\nsage-devel thread: https://groups.google.com/d/topic/sage-devel/M98nD7833KM/discussion\n\n\n**Currently handles** Gurobi, Cplex, Maple, Matlab, Macaulay2, Octave, Scilab.\n\n(mathematica cannot be included before #18908 is fixed)\n\nIssue created by migration from https://trac.sagemath.org/ticket/18904\n\n",
    "closed_at": "2016-06-12T12:02:30Z",
    "created_at": "2015-07-15T09:36:21Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Automatically test optional non-packages (CPLEX, Gurobi, Maple?, ..)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18904",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @vbraun @jdemeyer @dcoudert

With this branch, the default value of `--optional` in `sage -t` is larger than the list of installed new-style optional packages.

In particular, `cplex` and `gurobi` (which are not optional packages as they are proprietary) are added to the list (some tests are too slow to be run with glpk, e.g. #18871).

More can be added to that list. If you know a better way to implement it, I am all ears.

Nathann

sage-devel thread: https://groups.google.com/d/topic/sage-devel/M98nD7833KM/discussion


**Currently handles** Gurobi, Cplex, Maple, Matlab, Macaulay2, Octave, Scilab.

(mathematica cannot be included before #18908 is fixed)

Issue created by migration from https://trac.sagemath.org/ticket/18904





---

archive/issue_comments_253857.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-15T09:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253857",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_253858.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-07-15T09:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253858",
    "user": "https://github.com/nathanncohen"
}
```

New commits:



---

archive/issue_comments_253859.json:
```json
{
    "body": "IMHO you should have to explicitly specify the optional packages that we don't distribute (and, therefore, don't know whether they are of a suitable version or working at all, or that the user has a license to start them, etc).",
    "created_at": "2015-07-15T09:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253859",
    "user": "https://github.com/vbraun"
}
```

IMHO you should have to explicitly specify the optional packages that we don't distribute (and, therefore, don't know whether they are of a suitable version or working at all, or that the user has a license to start them, etc).



---

archive/issue_comments_253860.json:
```json
{
    "body": "> IMHO you should have to explicitly specify the optional packages that we don't distribute (and, therefore, don't know whether they are of a suitable version or working at all, or that the user has a license to start them, etc). \n\n\nI am not sure that I understand what you propose. Do you want to have somewhere a list of the packages that we do nto distribute, along with a list of functions testing if they can be used (e.g. detect licenses)? In which file, and how?\n\nFor CPLEX and Gurobi, the tests I used handle the case when the license is wrong.\n\n```\nsage: MixedIntegerLinearProgram(solver='gurobi')\n...\nMIPSolverException: 'Gurobi: HostID mismatch (licensed to 52332a80, hostid is 230063bf) (GRB_ERROR_NO_LICENSE)'\n```\n\nNathann",
    "created_at": "2015-07-15T09:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253860",
    "user": "https://github.com/nathanncohen"
}
```

> IMHO you should have to explicitly specify the optional packages that we don't distribute (and, therefore, don't know whether they are of a suitable version or working at all, or that the user has a license to start them, etc). 


I am not sure that I understand what you propose. Do you want to have somewhere a list of the packages that we do nto distribute, along with a list of functions testing if they can be used (e.g. detect licenses)? In which file, and how?

For CPLEX and Gurobi, the tests I used handle the case when the license is wrong.

```
sage: MixedIntegerLinearProgram(solver='gurobi')
...
MIPSolverException: 'Gurobi: HostID mismatch (licensed to 52332a80, hostid is 230063bf) (GRB_ERROR_NO_LICENSE)'
```

Nathann



---

archive/issue_comments_253861.json:
```json
{
    "body": "say **NO** to blind copy/paste! Do\n\n```\n           for sol in [\"cplex\", \"gurobi\"]:\n                try:\n                    MixedIntegerLinearProgram(solver=sol)\n                        options.optional.add(sol)\n                    except:\n                        pass\n```",
    "created_at": "2015-07-15T10:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253861",
    "user": "https://github.com/dimpase"
}
```

say **NO** to blind copy/paste! Do

```
           for sol in ["cplex", "gurobi"]:
                try:
                    MixedIntegerLinearProgram(solver=sol)
                        options.optional.add(sol)
                    except:
                        pass
```



---

archive/issue_comments_253862.json:
```json
{
    "body": "> say **NO** to blind copy/paste! Do\n\n\nProposing a commit is the trendy way to say *I care*.",
    "created_at": "2015-07-15T10:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253862",
    "user": "https://github.com/nathanncohen"
}
```

> say **NO** to blind copy/paste! Do


Proposing a commit is the trendy way to say *I care*.



---

archive/issue_comments_253863.json:
```json
{
    "body": "Er... I could have done better: \"Nothing says 'I care' like 'here is a commit'\".",
    "created_at": "2015-07-15T10:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253863",
    "user": "https://github.com/nathanncohen"
}
```

Er... I could have done better: "Nothing says 'I care' like 'here is a commit'".



---

archive/issue_comments_253864.json:
```json
{
    "body": "But I'd need write access to your brain then...",
    "created_at": "2015-07-15T10:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253864",
    "user": "https://github.com/dimpase"
}
```

But I'd need write access to your brain then...



---

archive/issue_comments_253865.json:
```json
{
    "body": "> But I'd need write access to your brain then...\n\n\nI am sure that you can manage with a write access to public/*.",
    "created_at": "2015-07-15T10:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253865",
    "user": "https://github.com/nathanncohen"
}
```

> But I'd need write access to your brain then...


I am sure that you can manage with a write access to public/*.



---

archive/issue_comments_253866.json:
```json
{
    "body": "Replying to [comment:8 ncohen]:\n> > But I'd need write access to your brain then...\n\n> \n> I am sure that you can manage with a write access to public/*.\n\n\ndo you pull from public opinion at all?",
    "created_at": "2015-07-15T11:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253866",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:8 ncohen]:
> > But I'd need write access to your brain then...

> 
> I am sure that you can manage with a write access to public/*.


do you pull from public opinion at all?



---

archive/issue_comments_253867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-15T13:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253868.json:
```json
{
    "body": "More interfaces. As I needed a loop for the others, I also converted the MILP test as a loop.\n\nStill ugly, so if somebody has a nice idea to rewrite it better.. `:-/`\n\nNathann",
    "created_at": "2015-07-15T13:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253868",
    "user": "https://github.com/nathanncohen"
}
```

More interfaces. As I needed a loop for the others, I also converted the MILP test as a loop.

Still ugly, so if somebody has a nice idea to rewrite it better.. `:-/`

Nathann



---

archive/issue_comments_253869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-15T13:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_253870.json:
```json
{
    "body": "Replying to [comment:11 ncohen]:\n> More interfaces. As I needed a loop for the others, I also converted the MILP test as a loop.\n> \n> Still ugly, so if somebody has a nice idea to rewrite it better.. `:-/`\n\n\nnot tested (don't know how to test that script in `sage/doctests`):\n\n```python\n        def tryer(s):\n            exec('from sage.interfaces.'+s+' import '+s)\n            try:\n                eval(s+'(1)')\n                options.optional.add(s)\n            except:\n                pass\n\n        for stuff in ['matlab', 'maple', 'macaulay2', 'octave', 'scilab']:\n            tryer(stuff)\n```",
    "created_at": "2015-07-15T13:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253870",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 ncohen]:
> More interfaces. As I needed a loop for the others, I also converted the MILP test as a loop.
> 
> Still ugly, so if somebody has a nice idea to rewrite it better.. `:-/`


not tested (don't know how to test that script in `sage/doctests`):

```python
        def tryer(s):
            exec('from sage.interfaces.'+s+' import '+s)
            try:
                eval(s+'(1)')
                options.optional.add(s)
            except:
                pass

        for stuff in ['matlab', 'maple', 'macaulay2', 'octave', 'scilab']:
            tryer(stuff)
```



---

archive/issue_comments_253871.json:
```json
{
    "body": "> not tested (don't know how to test that script in `sage/doctests`):\n\n\nI thought that I would be hung if I attempted something like that.\n\nNathann",
    "created_at": "2015-07-15T13:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253871",
    "user": "https://github.com/nathanncohen"
}
```

> not tested (don't know how to test that script in `sage/doctests`):


I thought that I would be hung if I attempted something like that.

Nathann



---

archive/issue_comments_253872.json:
```json
{
    "body": "Replying to [comment:14 ncohen]:\n> > not tested (don't know how to test that script in `sage/doctests`):\n\n> \n> I thought that I would be hung if I attempted something like that.\n\nno, to the contrary - cool programmers don't write runnable code, they write code that writes runnable code :-)",
    "created_at": "2015-07-15T14:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253872",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:14 ncohen]:
> > not tested (don't know how to test that script in `sage/doctests`):

> 
> I thought that I would be hung if I attempted something like that.

no, to the contrary - cool programmers don't write runnable code, they write code that writes runnable code :-)



---

archive/issue_comments_253873.json:
```json
{
    "body": "> no, to the contrary - cool programmers don't write runnable code, they write code that writes runnable code :-)\n\n\nWell, considering how ugly my version is, perhaps it is comparatively better. Let's see what Jeroen and Volker think of it.\n\nNathann",
    "created_at": "2015-07-15T14:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253873",
    "user": "https://github.com/nathanncohen"
}
```

> no, to the contrary - cool programmers don't write runnable code, they write code that writes runnable code :-)


Well, considering how ugly my version is, perhaps it is comparatively better. Let's see what Jeroen and Volker think of it.

Nathann



---

archive/issue_comments_253874.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-16T09:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253874",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253875.json:
```json
{
    "body": "Are we sure that we actually *want* to do this? We have no control over those external packages. What if somebody has `magma` but with a version that is not fully compatible with Sage? With Sage's optional packages, that issue does not occur since we have full control over those packages.\n\nA few comments on the code:\n1. Never use `except:`. Use `except Exception:` or some other specific exception class.\n2. Code structure: can we please move all this detect-optional-packages code to a separate function?\n3. Performance: how much time does it take to run all those tests? Note that #13540 has a system for \"lazy\" checking of optional dependencies: the check for a given package is only done if we are actually running a test involving that package.",
    "created_at": "2015-07-16T09:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253875",
    "user": "https://github.com/jdemeyer"
}
```

Are we sure that we actually *want* to do this? We have no control over those external packages. What if somebody has `magma` but with a version that is not fully compatible with Sage? With Sage's optional packages, that issue does not occur since we have full control over those packages.

A few comments on the code:
1. Never use `except:`. Use `except Exception:` or some other specific exception class.
2. Code structure: can we please move all this detect-optional-packages code to a separate function?
3. Performance: how much time does it take to run all those tests? Note that #13540 has a system for "lazy" checking of optional dependencies: the check for a given package is only done if we are actually running a test involving that package.



---

archive/issue_comments_253876.json:
```json
{
    "body": "> Are we sure that we actually *want* to do this?\n\n\nIf you oppose the changes involving `Maple/Matlab` and others then I do not mind removing them for you. We can keep Gurobi and CPLEX for they are only used by Sage if the user explicitly linked them with it.\n\n> 1. Never use `except:`. Use `except Exception:` or some other specific exception class.\n\n\nI thought that here it was pretty safe: I do not want this test to ever break, and if there is something wrong with the mathematica/maple/... interface, then other doctests will have to report it.\n\n> 2. Code structure: can we please move all this detect-optional-packages code to a separate function?\n\n\nI will add a commit.\n\n> 3. Performance: how much time does it take to run all those tests?\n\n\nAlmost nothing, give it a try. That's clearly negligible against the time it takes to run the `sage -b` part of `sage -btp`.\n\n> Note that #13540 has a system for \"lazy\" checking of optional dependencies\n\n\nI do not see a need for that given the time it takes to run those tests. Especially, if you want the maple/matlab/others to be removed from the list.\n\nNathann",
    "created_at": "2015-07-16T09:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253876",
    "user": "https://github.com/nathanncohen"
}
```

> Are we sure that we actually *want* to do this?


If you oppose the changes involving `Maple/Matlab` and others then I do not mind removing them for you. We can keep Gurobi and CPLEX for they are only used by Sage if the user explicitly linked them with it.

> 1. Never use `except:`. Use `except Exception:` or some other specific exception class.


I thought that here it was pretty safe: I do not want this test to ever break, and if there is something wrong with the mathematica/maple/... interface, then other doctests will have to report it.

> 2. Code structure: can we please move all this detect-optional-packages code to a separate function?


I will add a commit.

> 3. Performance: how much time does it take to run all those tests?


Almost nothing, give it a try. That's clearly negligible against the time it takes to run the `sage -b` part of `sage -btp`.

> Note that #13540 has a system for "lazy" checking of optional dependencies


I do not see a need for that given the time it takes to run those tests. Especially, if you want the maple/matlab/others to be removed from the list.

Nathann



---

archive/issue_comments_253877.json:
```json
{
    "body": "Also, do you object my removing the code that checks that the installed version of an optional package is indeed the latest? Now that they are automatically updated, that's rather useless.",
    "created_at": "2015-07-16T09:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253877",
    "user": "https://github.com/nathanncohen"
}
```

Also, do you object my removing the code that checks that the installed version of an optional package is indeed the latest? Now that they are automatically updated, that's rather useless.



---

archive/issue_comments_253878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-16T09:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253878",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_253879.json:
```json
{
    "body": "how about making this ticket depend on #18908  and include mathematica in the list?",
    "created_at": "2015-07-16T09:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253879",
    "user": "https://github.com/dimpase"
}
```

how about making this ticket depend on #18908  and include mathematica in the list?



---

archive/issue_comments_253880.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-16T09:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253880",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253881.json:
```json
{
    "body": "I rewrote this branch by moving everything to a new function, and added a 'Exception'. In this commit all `Maple/Matlab/others` are tested for I believe that we should test them.\n\nIf you object to that and are interested in other's opinion about it (on top of mine), perhaps you should write to sage-devel in the same thread or in a new one. If you oppose it, add a commit to remove the lines (I am tired of fighting endlessly). \n\nI am waiting for your answer to [comment:21] to simplify a couple of lines in the code.\n\n> how about making this ticket depend on #18908 and include mathematica in the list?\n\n\nGiven that Jeroen seems to doubts the wisdom of testing mathematica/maple/..., it seems a bit early to do that. Also, there is nothing inherently wrong in having #18908 add a couple of lines to `control.py` if this ticket is merged first.\n\nNathann",
    "created_at": "2015-07-16T09:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253881",
    "user": "https://github.com/nathanncohen"
}
```

I rewrote this branch by moving everything to a new function, and added a 'Exception'. In this commit all `Maple/Matlab/others` are tested for I believe that we should test them.

If you object to that and are interested in other's opinion about it (on top of mine), perhaps you should write to sage-devel in the same thread or in a new one. If you oppose it, add a commit to remove the lines (I am tired of fighting endlessly). 

I am waiting for your answer to [comment:21] to simplify a couple of lines in the code.

> how about making this ticket depend on #18908 and include mathematica in the list?


Given that Jeroen seems to doubts the wisdom of testing mathematica/maple/..., it seems a bit early to do that. Also, there is nothing inherently wrong in having #18908 add a couple of lines to `control.py` if this ticket is merged first.

Nathann



---

archive/issue_comments_253882.json:
```json
{
    "body": "Can we move the whole rummaging-in-external-interfaces part into a separate file? Right now its in the middle of a function thats already too long and has absolutely nothing to do with external interfaces. Though perhaps this ticket is about code golfing the most fugly solution, in that case go ahead ;-)",
    "created_at": "2015-07-16T09:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253882",
    "user": "https://github.com/vbraun"
}
```

Can we move the whole rummaging-in-external-interfaces part into a separate file? Right now its in the middle of a function thats already too long and has absolutely nothing to do with external interfaces. Though perhaps this ticket is about code golfing the most fugly solution, in that case go ahead ;-)



---

archive/issue_comments_253883.json:
```json
{
    "body": "> Can we move the whole rummaging-in-external-interfaces part into a separate file?\n\n\nRight now the function takes 40 lines and I am still waiting for Jeroen's advice on whether we should cut 20 lines out of it. It is not that I do not enjoy moving this code around every time somebody asks, but I don't see the point of creating a new file for a 20 lines function (10 of which is documentation).\n\nAs reviewers, please settle on what exactly you want to see changed, and I will get to it.\n\nNathann",
    "created_at": "2015-07-16T09:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253883",
    "user": "https://github.com/nathanncohen"
}
```

> Can we move the whole rummaging-in-external-interfaces part into a separate file?


Right now the function takes 40 lines and I am still waiting for Jeroen's advice on whether we should cut 20 lines out of it. It is not that I do not enjoy moving this code around every time somebody asks, but I don't see the point of creating a new file for a 20 lines function (10 of which is documentation).

As reviewers, please settle on what exactly you want to see changed, and I will get to it.

Nathann



---

archive/issue_comments_253884.json:
```json
{
    "body": "Well, is there currently a way to mix automatic and manual management of `--optional` argument to the doctests? If one can do something like `make ptest OPTIONAL+=...` or 'sage -t --optional_extra=...`, with `optional_extra` appending to `--optional` list...",
    "created_at": "2015-07-16T09:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253884",
    "user": "https://github.com/dimpase"
}
```

Well, is there currently a way to mix automatic and manual management of `--optional` argument to the doctests? If one can do something like `make ptest OPTIONAL+=...` or 'sage -t --optional_extra=...`, with `optional_extra` appending to `--optional` list...



---

archive/issue_comments_253885.json:
```json
{
    "body": "> Well, is there currently a way to mix automatic and manual management of `--optional` argument to the doctests?\n\n\n```\n(tmp|\u2026)~/sage/graphs$ sage -btp --optional=sage,optional,Hey .\n...\nUsing --optional=bliss,cbc,ccache,cplex,...,hey\n```",
    "created_at": "2015-07-16T09:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253885",
    "user": "https://github.com/nathanncohen"
}
```

> Well, is there currently a way to mix automatic and manual management of `--optional` argument to the doctests?


```
(tmp|…)~/sage/graphs$ sage -btp --optional=sage,optional,Hey .
...
Using --optional=bliss,cbc,ccache,cplex,...,hey
```



---

archive/issue_comments_253886.json:
```json
{
    "body": "Replying to [comment:21 ncohen]:\n> Also, do you object my removing the code that checks that the installed version of an optional package is indeed the latest? Now that they are automatically updated, that's rather useless.\n\nFor me, you can remove the code.",
    "created_at": "2015-07-16T09:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253886",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 ncohen]:
> Also, do you object my removing the code that checks that the installed version of an optional package is indeed the latest? Now that they are automatically updated, that's rather useless.

For me, you can remove the code.



---

archive/issue_comments_253887.json:
```json
{
    "body": "Replying to [comment:20 ncohen]:\n> We can keep Gurobi and CPLEX for they are only used by Sage if the user explicitly linked them with it.\n\n\nCan you elaborate what you mean with this?",
    "created_at": "2015-07-16T10:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253887",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:20 ncohen]:
> We can keep Gurobi and CPLEX for they are only used by Sage if the user explicitly linked them with it.


Can you elaborate what you mean with this?



---

archive/issue_comments_253888.json:
```json
{
    "body": "Replying to [comment:20 ncohen]:\n> Almost nothing, give it a try.\n\nI don't have those non-open-source packages installed. Ideally it should be tested by people *having the packages installed*. And the fact that it takes time than `./sage -b` is irrelevant. I often just do `./sage -tp` without the `./sage -b` when I'm writing doctests.",
    "created_at": "2015-07-16T10:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253888",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:20 ncohen]:
> Almost nothing, give it a try.

I don't have those non-open-source packages installed. Ideally it should be tested by people *having the packages installed*. And the fact that it takes time than `./sage -b` is irrelevant. I often just do `./sage -tp` without the `./sage -b` when I'm writing doctests.



---

archive/issue_comments_253889.json:
```json
{
    "body": "> Can you elaborate what you mean with this?\n\n\nI mean that CPLEX and Gurobi are not auto-detected from `$PATH` or `$LD_LIBRARY_PATH`. The corresponding cython modules are only built if those instructions are followed:\nhttp://doc.sagemath.org/html/en/thematic_tutorials/linear_programming.html#using-cplex-or-gurobi-through-sage\n\nThus, I believe that it is safe to assume that if Sage can use CPLEX/Gurobi then it means that the user wants it to be linked with Sage. The situation is different when you install Sage on a machine that already has mathematica installed, for it is automatically detected even though the user may not want to use mathematica from Sage.\n\nIf I understood your objections to having automatic tests with mathematica/maple, they do not apply to CPLEX/Gurobi because of this installation procedure.\n\nNathann",
    "created_at": "2015-07-16T10:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253889",
    "user": "https://github.com/nathanncohen"
}
```

> Can you elaborate what you mean with this?


I mean that CPLEX and Gurobi are not auto-detected from `$PATH` or `$LD_LIBRARY_PATH`. The corresponding cython modules are only built if those instructions are followed:
http://doc.sagemath.org/html/en/thematic_tutorials/linear_programming.html#using-cplex-or-gurobi-through-sage

Thus, I believe that it is safe to assume that if Sage can use CPLEX/Gurobi then it means that the user wants it to be linked with Sage. The situation is different when you install Sage on a machine that already has mathematica installed, for it is automatically detected even though the user may not want to use mathematica from Sage.

If I understood your objections to having automatic tests with mathematica/maple, they do not apply to CPLEX/Gurobi because of this installation procedure.

Nathann



---

archive/issue_comments_253890.json:
```json
{
    "body": "> > Almost nothing, give it a try.\n\n{{{\nsage: %time _=DC._default_optional_tags()\nCPU times: user 8 ms, sys: 28 ms, total: 36 ms\nWall time: 350 ms\n}}}\n\nThat's how long you lose. Compare it with the time it takes to doctest control.py (which is not a 'hard' file by any standard)\n\n```\n(tmp|\u2026)~/sage/doctest$ time sage -tp control.py\n...\nsage -tp control.py  2.94s user 0.45s system 74% cpu 4.530 total\n```\n\nAnd of course this become totally negligible if you test several files, a folder, or the whole of Sage.\n\n> I don't have those non-open-source packages installed. Ideally it should be tested by people *having the packages installed*.\n\n\nIf you are talking about CPLEX and Gurobi, then the time it takes to test whether they are present is *REALLY* negligible compared to the time it takes to test for `maple/mathematica/others`. It is more or less equivalent to load a module and interpret the 'nameerror' if the (cython) module does not exist. This is done twice, so the cost is very very small.\n\nFor the interface.* guys, I personally don't have them on my computer but I consider the time it takes to run the tests to be non-important. If you want to use this argument to claim on sage-devel that they should not be tested, however, you are of course allowed to.\n\nOverall, I think that maple/matlab and others should be included in our tests, for otherwise they will break forever. Paying `0.5s` in a `ptestlong` does not stop me. On the other hand I know that it is useless to argue with you when you do not want to hear something, so I am quite ready to sacrifice it if you but ask. Just decide something and explain the outcome to people on sage-devel who would want this to be tested. I did my part.\n\nNathann",
    "created_at": "2015-07-16T10:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253890",
    "user": "https://github.com/nathanncohen"
}
```

> > Almost nothing, give it a try.

{{{
sage: %time _=DC._default_optional_tags()
CPU times: user 8 ms, sys: 28 ms, total: 36 ms
Wall time: 350 ms
}}}

That's how long you lose. Compare it with the time it takes to doctest control.py (which is not a 'hard' file by any standard)

```
(tmp|…)~/sage/doctest$ time sage -tp control.py
...
sage -tp control.py  2.94s user 0.45s system 74% cpu 4.530 total
```

And of course this become totally negligible if you test several files, a folder, or the whole of Sage.

> I don't have those non-open-source packages installed. Ideally it should be tested by people *having the packages installed*.


If you are talking about CPLEX and Gurobi, then the time it takes to test whether they are present is *REALLY* negligible compared to the time it takes to test for `maple/mathematica/others`. It is more or less equivalent to load a module and interpret the 'nameerror' if the (cython) module does not exist. This is done twice, so the cost is very very small.

For the interface.* guys, I personally don't have them on my computer but I consider the time it takes to run the tests to be non-important. If you want to use this argument to claim on sage-devel that they should not be tested, however, you are of course allowed to.

Overall, I think that maple/matlab and others should be included in our tests, for otherwise they will break forever. Paying `0.5s` in a `ptestlong` does not stop me. On the other hand I know that it is useless to argue with you when you do not want to hear something, so I am quite ready to sacrifice it if you but ask. Just decide something and explain the outcome to people on sage-devel who would want this to be tested. I did my part.

Nathann



---

archive/issue_comments_253891.json:
```json
{
    "body": "the more tests are actually being run, the better. If something breaks for someone who has an unblessed by Sage install of a MMA member, it's OK, a good warning...",
    "created_at": "2015-07-16T10:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253891",
    "user": "https://github.com/dimpase"
}
```

the more tests are actually being run, the better. If something breaks for someone who has an unblessed by Sage install of a MMA member, it's OK, a good warning...



---

archive/issue_comments_253892.json:
```json
{
    "body": "> the more tests are actually being run, the better. If something breaks for someone who has an unblessed by Sage install of a MMA member, it's OK, a good warning...\n\n\nAnd that's the only way for us to learn in how many ways such installs can be broken, and act upon it by fixing our interfaces.\n\nBesides, in the case where you really don't have those external softwares installed, checking whether they can be run should be as fast as detecting that the executable cannot be found. So we can also improve that, if we find it too slow.\n\nNathann",
    "created_at": "2015-07-16T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253892",
    "user": "https://github.com/nathanncohen"
}
```

> the more tests are actually being run, the better. If something breaks for someone who has an unblessed by Sage install of a MMA member, it's OK, a good warning...


And that's the only way for us to learn in how many ways such installs can be broken, and act upon it by fixing our interfaces.

Besides, in the case where you really don't have those external softwares installed, checking whether they can be run should be as fast as detecting that the executable cannot be found. So we can also improve that, if we find it too slow.

Nathann



---

archive/issue_comments_253893.json:
```json
{
    "body": "Replying to [comment:32 ncohen]:\n> If I understood your objections to having automatic tests with mathematica/maple, they do not apply to CPLEX/Gurobi because of this installation procedure.\n\n\nAgreed.",
    "created_at": "2015-07-16T10:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253893",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:32 ncohen]:
> If I understood your objections to having automatic tests with mathematica/maple, they do not apply to CPLEX/Gurobi because of this installation procedure.


Agreed.



---

archive/issue_comments_253894.json:
```json
{
    "body": "I am waiting for your answer to [comment:21] to simplify a couple of lines in the code.",
    "created_at": "2015-07-16T10:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253894",
    "user": "https://github.com/nathanncohen"
}
```

I am waiting for your answer to [comment:21] to simplify a couple of lines in the code.



---

archive/issue_comments_253895.json:
```json
{
    "body": "Replying to [comment:37 ncohen]:\n> I am waiting for your answer to [comment:21] to simplify a couple of lines in the code.\n\nSee [comment:29]: yes you can remove that code.",
    "created_at": "2015-07-16T10:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253895",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 ncohen]:
> I am waiting for your answer to [comment:21] to simplify a couple of lines in the code.

See [comment:29]: yes you can remove that code.



---

archive/issue_comments_253896.json:
```json
{
    "body": "> See [comment:29]: yes you can remove that code.\n\n\nI received two emails at once, and only noticed the last one. It would be easier to handle your comments if you were giving them all at once. Thanks for your answer though, I'll update it in a second.\n\nNathann",
    "created_at": "2015-07-16T11:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253896",
    "user": "https://github.com/nathanncohen"
}
```

> See [comment:29]: yes you can remove that code.


I received two emails at once, and only noticed the last one. It would be easier to handle your comments if you were giving them all at once. Thanks for your answer though, I'll update it in a second.

Nathann



---

archive/issue_comments_253897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-16T11:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253898.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-16T14:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253898",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253899.json:
```json
{
    "body": "> `mathematica(1)` is just the way I used to detect whether the software\n> is installed. If we need something more reliable, we can have a\n> `is_mathematica_available()` function somewhere that checks it\n> properly.\n\n\nGood idea!\n\nI'm still thinking if that would be a sufficient solution, but I think you really should introduce functions like that. And I agree with Volker to move these detecting-optional-tags functions to a new file.",
    "created_at": "2015-07-16T14:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253899",
    "user": "https://github.com/jdemeyer"
}
```

> `mathematica(1)` is just the way I used to detect whether the software
> is installed. If we need something more reliable, we can have a
> `is_mathematica_available()` function somewhere that checks it
> properly.


Good idea!

I'm still thinking if that would be a sufficient solution, but I think you really should introduce functions like that. And I agree with Volker to move these detecting-optional-tags functions to a new file.



---

archive/issue_comments_253900.json:
```json
{
    "body": "> Good idea!\n\n\nThis branch does nothing with mathematica, however.\n\n> I'm still thinking if that would be a sufficient solution, but I think you really should introduce functions like that.\n\n\nI will not do it, that's for sure. You can add a commit, though.\n\n> And I agree with Volker to move these detecting-optional-tags functions to a new file.\n\n\nI would like to understand what you have in mind, first. The function that this branch adds is 40 lines long, and it does not seem justified to create a file for that. Or please explain what you think this file should contain and do. If you want `is_X_installed` functions, then I expect that those should be in the interface.* files, and not centralized in a doctest code.\n\nNathann",
    "created_at": "2015-07-16T14:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253900",
    "user": "https://github.com/nathanncohen"
}
```

> Good idea!


This branch does nothing with mathematica, however.

> I'm still thinking if that would be a sufficient solution, but I think you really should introduce functions like that.


I will not do it, that's for sure. You can add a commit, though.

> And I agree with Volker to move these detecting-optional-tags functions to a new file.


I would like to understand what you have in mind, first. The function that this branch adds is 40 lines long, and it does not seem justified to create a file for that. Or please explain what you think this file should contain and do. If you want `is_X_installed` functions, then I expect that those should be in the interface.* files, and not centralized in a doctest code.

Nathann



---

archive/issue_comments_253901.json:
```json
{
    "body": "Replying to [comment:42 ncohen]:\n> If you want `is_X_installed`\n\n\nIt's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.",
    "created_at": "2015-07-16T14:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253901",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:42 ncohen]:
> If you want `is_X_installed`


It's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.



---

archive/issue_comments_253902.json:
```json
{
    "body": "> It's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.\n\n\nTo me it would make more sense to have a `version()` function in sage/interfaces/mathematica.py that would return the version. This can then be analyzed all you want in the doctest code. By the way, do you have any idea of which version should be kept and which ones should be discarded? Or do you only want to make my job more complicated?\n\nNathann",
    "created_at": "2015-07-16T14:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253902",
    "user": "https://github.com/nathanncohen"
}
```

> It's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.


To me it would make more sense to have a `version()` function in sage/interfaces/mathematica.py that would return the version. This can then be analyzed all you want in the doctest code. By the way, do you have any idea of which version should be kept and which ones should be discarded? Or do you only want to make my job more complicated?

Nathann



---

archive/issue_comments_253903.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-16T14:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253903",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253904.json:
```json
{
    "body": "Until somebody can explain why this 40-lines code *must* be moved to a (yet unnamed) new module, or what exactly should be checked if it is not 'magma(1)', ...",
    "created_at": "2015-07-16T14:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253904",
    "user": "https://github.com/nathanncohen"
}
```

Until somebody can explain why this 40-lines code *must* be moved to a (yet unnamed) new module, or what exactly should be checked if it is not 'magma(1)', ...



---

archive/issue_comments_253905.json:
```json
{
    "body": "Replying to [comment:44 ncohen]:\n> > It's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.\n\n> \n> To me it would make more sense to have a `version()` function in sage/interfaces/mathematica.py that would return the version.\n\n\nI would let .version() return -1000 if there is no program available, instead of a separate\nfunction...",
    "created_at": "2015-07-16T15:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253905",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:44 ncohen]:
> > It's not really `is_X_installed`, it's more like `is_the_version_of_X_which_is_installed_sufficient_for_the_doctests`? So, it is very much related to the doctests.

> 
> To me it would make more sense to have a `version()` function in sage/interfaces/mathematica.py that would return the version.


I would let .version() return -1000 if there is no program available, instead of a separate
function...



---

archive/issue_comments_253906.json:
```json
{
    "body": "> I would let .version() return -1000 if there is no program available, instead of a separate\n> function...\n\n\n+1.",
    "created_at": "2015-07-16T15:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253906",
    "user": "https://github.com/nathanncohen"
}
```

> I would let .version() return -1000 if there is no program available, instead of a separate
> function...


+1.



---

archive/issue_comments_253907.json:
```json
{
    "body": "Replying to [comment:45 ncohen]:\n> Until somebody can explain why this 40-lines code *must* be moved to a (yet unnamed) new module\n\n\nhttps://en.wikipedia.org/wiki/Single_responsibility_principle\n\nIs the doctest controller responsible for third-party interfaces?\n\nE.g. page 34 of http://vitoex.googlecode.com/svn/trunk/Read/Clean%20Code.pdf recommends:\n\n\"The first rule of functions is that they should be small. The second rule of functions is that\nthey should be smaller than that. [...] Functions should not be 100 lines long. Functions should hardly ever be 20 lines long.\"",
    "created_at": "2015-07-16T17:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253907",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:45 ncohen]:
> Until somebody can explain why this 40-lines code *must* be moved to a (yet unnamed) new module


https://en.wikipedia.org/wiki/Single_responsibility_principle

Is the doctest controller responsible for third-party interfaces?

E.g. page 34 of http://vitoex.googlecode.com/svn/trunk/Read/Clean%20Code.pdf recommends:

"The first rule of functions is that they should be small. The second rule of functions is that
they should be smaller than that. [...] Functions should not be 100 lines long. Functions should hardly ever be 20 lines long."



---

archive/issue_comments_253908.json:
```json
{
    "body": "> Is the doctest controller responsible for third-party interfaces?\n\n\nWhere else do you expect to see the code which decides which third-party interfaces should be tested? Are third-party interfaces responsible for doctesting? Be serious.\n\n> E.g. page 34 of http://vitoex.googlecode.com/svn/trunk/Read/Clean%20Code.pdf recommends:\n> \n> \"The first rule of functions is that they should be small. The second rule of functions is that\n> they should be smaller than that. [...] Functions should not be 100 lines long. Functions should hardly ever be 20 lines long.\"\n\n\nThat a fortunate coincidence, for my function has around 26 lines of code (the rest is documentation). So I pass this test. Shoud I write myself to sage-devel to ask whether we should enforce a hard line limit of 20 lines per function?\n\nThe other good news for me is that I do not see anything about creating a new file for functions of 20< x < 30 lines.\n\nSo it's still up for review.\n\nI think that you are officially splitting hairs.\n\nNathann",
    "created_at": "2015-07-16T17:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253908",
    "user": "https://github.com/nathanncohen"
}
```

> Is the doctest controller responsible for third-party interfaces?


Where else do you expect to see the code which decides which third-party interfaces should be tested? Are third-party interfaces responsible for doctesting? Be serious.

> E.g. page 34 of http://vitoex.googlecode.com/svn/trunk/Read/Clean%20Code.pdf recommends:
> 
> "The first rule of functions is that they should be small. The second rule of functions is that
> they should be smaller than that. [...] Functions should not be 100 lines long. Functions should hardly ever be 20 lines long."


That a fortunate coincidence, for my function has around 26 lines of code (the rest is documentation). So I pass this test. Shoud I write myself to sage-devel to ask whether we should enforce a hard line limit of 20 lines per function?

The other good news for me is that I do not see anything about creating a new file for functions of 20< x < 30 lines.

So it's still up for review.

I think that you are officially splitting hairs.

Nathann



---

archive/issue_comments_253909.json:
```json
{
    "body": "Replying to [comment:49 ncohen]:\n> > Is the doctest controller responsible for third-party interfaces?\n\n> Where else do you expect to see the code which decides which third-party interfaces should be tested?\n\nIf you can't figure out an existing place that is responsible then your instinct should be to create a new one.",
    "created_at": "2015-07-16T17:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253909",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:49 ncohen]:
> > Is the doctest controller responsible for third-party interfaces?

> Where else do you expect to see the code which decides which third-party interfaces should be tested?

If you can't figure out an existing place that is responsible then your instinct should be to create a new one.



---

archive/issue_comments_253910.json:
```json
{
    "body": "> If you can't figure out an existing place that is responsible then your instinct should be to create a new one.\n\n\nI have no problem figuring this out. There is a place in the doctest code where we define the default list of optional packages that we should test. It is done in the `DoctestController` class defined in `doctest.py`, and I don't see a better place to write the code that builds this list.\n\nNathann",
    "created_at": "2015-07-16T17:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253910",
    "user": "https://github.com/nathanncohen"
}
```

> If you can't figure out an existing place that is responsible then your instinct should be to create a new one.


I have no problem figuring this out. There is a place in the doctest code where we define the default list of optional packages that we should test. It is done in the `DoctestController` class defined in `doctest.py`, and I don't see a better place to write the code that builds this list.

Nathann



---

archive/issue_comments_253911.json:
```json
{
    "body": "What is the `DoctestController` responsible for?",
    "created_at": "2015-07-16T17:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253911",
    "user": "https://github.com/vbraun"
}
```

What is the `DoctestController` responsible for?



---

archive/issue_comments_253912.json:
```json
{
    "body": "> What is the `DoctestController` responsible for?\n\n\nVolker, I do not know what you are trying to achieve on this ticket. What I know is that my goal here is to improve Sage's tests, so that less code gets broken.\n\nThe way we proceed is through a code review (which IIRC never involved a lot of Zen questioning): if you see something wrong with the code, you say what you think needs to be changed and why, so that we can discuss it. The 20lines limit for functions, I'm ashamed to say, it not in this ticket's scope (discuss it on sage-devel).\n\nI now have really important things that I must see to, like tonight's tomato sauce with heaps of basil.\n\nNathann",
    "created_at": "2015-07-16T18:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253912",
    "user": "https://github.com/nathanncohen"
}
```

> What is the `DoctestController` responsible for?


Volker, I do not know what you are trying to achieve on this ticket. What I know is that my goal here is to improve Sage's tests, so that less code gets broken.

The way we proceed is through a code review (which IIRC never involved a lot of Zen questioning): if you see something wrong with the code, you say what you think needs to be changed and why, so that we can discuss it. The 20lines limit for functions, I'm ashamed to say, it not in this ticket's scope (discuss it on sage-devel).

I now have really important things that I must see to, like tonight's tomato sauce with heaps of basil.

Nathann



---

archive/issue_comments_253913.json:
```json
{
    "body": "Replying to [comment:53 ncohen]:\n> if you see something wrong with the code, you say what you think needs to be changed and why, so that we can discuss it.\n\n\nI said it already, but let me repeat: Move the logic for detecting installed / compatible third-party packages to a separate module. This new module shall only be responsible for that one thing.",
    "created_at": "2015-07-16T18:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253913",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:53 ncohen]:
> if you see something wrong with the code, you say what you think needs to be changed and why, so that we can discuss it.


I said it already, but let me repeat: Move the logic for detecting installed / compatible third-party packages to a separate module. This new module shall only be responsible for that one thing.



---

archive/issue_comments_253914.json:
```json
{
    "body": "> I said it already, but let me repeat: Move the logic for detecting installed / compatible third-party packages to a separate module. This new module shall only be responsible for that one thing.\n\n\nIt would be a module containing a 40 lines function only. I do not think that it makes much sense, unless you have more code to move there.\n\nNathann",
    "created_at": "2015-07-16T18:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253914",
    "user": "https://github.com/nathanncohen"
}
```

> I said it already, but let me repeat: Move the logic for detecting installed / compatible third-party packages to a separate module. This new module shall only be responsible for that one thing.


It would be a module containing a 40 lines function only. I do not think that it makes much sense, unless you have more code to move there.

Nathann



---

archive/issue_comments_253915.json:
```json
{
    "body": "Moreover, please note that the code which builds the list of optional packages was already there. Before I was asked to turn this into an independent function, all that this patch did is add 10 lines of code right after other lines that already did a very similar job. So it is a bit surprising to me that all of a sudden this needs to be changed.",
    "created_at": "2015-07-16T18:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253915",
    "user": "https://github.com/nathanncohen"
}
```

Moreover, please note that the code which builds the list of optional packages was already there. Before I was asked to turn this into an independent function, all that this patch did is add 10 lines of code right after other lines that already did a very similar job. So it is a bit surprising to me that all of a sudden this needs to be changed.



---

archive/issue_comments_253916.json:
```json
{
    "body": "I just had an idea: I'm done working on this patch. Whoever wants to see those packages tested can do whatever he likes, for as long as this ticket's original purpose (test Gurobi+CPLEX) works.\n\nHave fun without me.\n\nNathann",
    "created_at": "2015-07-16T18:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253916",
    "user": "https://github.com/nathanncohen"
}
```

I just had an idea: I'm done working on this patch. Whoever wants to see those packages tested can do whatever he likes, for as long as this ticket's original purpose (test Gurobi+CPLEX) works.

Have fun without me.

Nathann



---

archive/issue_comments_253917.json:
```json
{
    "body": "by now, Mathematica can be added to the list. How about instead of using `--optional` make another parameter, say `--optionalplus`. Then most of the issues raised here will be gone.",
    "created_at": "2015-07-31T13:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253917",
    "user": "https://github.com/dimpase"
}
```

by now, Mathematica can be added to the list. How about instead of using `--optional` make another parameter, say `--optionalplus`. Then most of the issues raised here will be gone.



---

archive/issue_comments_253918.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-12T12:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253919.json:
```json
{
    "body": "Replying to [comment:59 dimpase]:\n> by now, Mathematica can be added to the list. How about instead of using `--optional` make another parameter, say `--optionalplus`. Then most of the issues raised here will be gone.\n\n\n+1 (--external? or --thirdparty?)",
    "created_at": "2015-10-31T08:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253919",
    "user": "https://github.com/jjermann"
}
```

Replying to [comment:59 dimpase]:
> by now, Mathematica can be added to the list. How about instead of using `--optional` make another parameter, say `--optionalplus`. Then most of the issues raised here will be gone.


+1 (--external? or --thirdparty?)



---

archive/issue_comments_253920.json:
```json
{
    "body": "`optional=internet` seems useful too, fwiw, see https://groups.google.com/forum/#!topic/sage-devel/qP_3jjVqb5U",
    "created_at": "2015-11-01T00:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253920",
    "user": "https://github.com/kcrisman"
}
```

`optional=internet` seems useful too, fwiw, see https://groups.google.com/forum/#!topic/sage-devel/qP_3jjVqb5U



---

archive/issue_comments_253921.json:
```json
{
    "body": "In #20182, I started a rewrite of this ticket. Check and modify it!",
    "created_at": "2016-03-09T15:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253921",
    "user": "https://github.com/kwankyu"
}
```

In #20182, I started a rewrite of this ticket. Check and modify it!



---

archive/issue_comments_253922.json:
```json
{
    "body": "So is this now a wontfix or duplicate?",
    "created_at": "2016-03-09T16:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253922",
    "user": "https://github.com/kcrisman"
}
```

So is this now a wontfix or duplicate?



---

archive/issue_comments_253923.json:
```json
{
    "body": "Let's wait until #20182 is merged.",
    "created_at": "2016-03-09T16:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253923",
    "user": "https://github.com/jdemeyer"
}
```

Let's wait until #20182 is merged.



---

archive/issue_comments_253924.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-27T04:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253924",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_052769.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2016-04-27T04:21:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18904#event-52769"
}
```



---

archive/issue_events_052770.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-12T12:02:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18904#event-52770"
}
```



---

archive/issue_comments_253925.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-12T12:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18904#issuecomment-253925",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
