# Issue 18606: p-adic extensions created with "the same" polynomials may not be the same

archive/issues_018369.json:
```json
{
    "body": "The follow snippet of code shows the bug:\n\n```\nsage: x = QQ['x'].gen()\nsage: F = Qp(5,20)\nsage: K = F.extension(x^2-F(13),names = 'g')\nsage: R = MatrixSpace(K,1,1)\nsage: K1 = F.extension(x^2-13,names = 'g')\nsage: Matrix(K1,1,1,[K1(0)])\n```\n\nYou would expect the last line to **never** fail, but it does in this case, and the exception raised is not informative:\n\n```\nNotImplementedError: Conversion from different p-adic extensions not yet supported\n```\n\nThe reason is the following:\n\n```\nsage: K is K1\nFalse\nsage: hash(K) == hash(K1)\nTrue\n```\n\nSince MatrixSpace has unique representation, the second time that it is called it returns the space over K, not over K1 (this uses the hash of the key values). In the same initialization, it refuses to see K1(0) as an element of K, and the exception is raised.\n\nI think that what should be done to avoid this problem is to convert the defining polynomial of the extension to a polynomial over the base when sanitising the keys.\n\n\nCC:  @roed314 @JohnCremona\n\nKeywords: padics, extensions, hash, sd87\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: David Roe\n\nBranch: c1cfe4a898ea67805a1e21e2bf5c9752ea80330b\n\nCommit: c1cfe4a898ea67805a1e21e2bf5c9752ea80330b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18606\n\n",
    "closed_at": "2017-09-24T13:13:34Z",
    "created_at": "2015-06-04T10:17:49Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "p-adic extensions created with \"the same\" polynomials may not be the same",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18606",
    "user": "https://github.com/mmasdeu"
}
```
The follow snippet of code shows the bug:

```
sage: x = QQ['x'].gen()
sage: F = Qp(5,20)
sage: K = F.extension(x^2-F(13),names = 'g')
sage: R = MatrixSpace(K,1,1)
sage: K1 = F.extension(x^2-13,names = 'g')
sage: Matrix(K1,1,1,[K1(0)])
```

You would expect the last line to **never** fail, but it does in this case, and the exception raised is not informative:

```
NotImplementedError: Conversion from different p-adic extensions not yet supported
```

The reason is the following:

```
sage: K is K1
False
sage: hash(K) == hash(K1)
True
```

Since MatrixSpace has unique representation, the second time that it is called it returns the space over K, not over K1 (this uses the hash of the key values). In the same initialization, it refuses to see K1(0) as an element of K, and the exception is raised.

I think that what should be done to avoid this problem is to convert the defining polynomial of the extension to a polynomial over the base when sanitising the keys.


CC:  @roed314 @JohnCremona

Keywords: padics, extensions, hash, sd87

Reviewer: Frédéric Chapoton

Author: David Roe

Branch: c1cfe4a898ea67805a1e21e2bf5c9752ea80330b

Commit: c1cfe4a898ea67805a1e21e2bf5c9752ea80330b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18606





---

archive/issue_comments_249063.json:
```json
{
    "body": "Changing keywords from \"padics, extensions, hash\" to \"padics, extensions, hash, sd87\".",
    "created_at": "2017-07-17T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249063",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "padics, extensions, hash" to "padics, extensions, hash, sd87".



---

archive/issue_comments_249064.json:
```json
{
    "body": "<a id='comment:1'></a>Also see #23331",
    "created_at": "2017-07-17T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249064",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>Also see #23331



---

archive/issue_comments_249065.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249065",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_249066.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249066",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-22T18:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249067",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_052232.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-22T18:51:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18606#event-52232"
}
```



---

archive/issue_comments_249068.json:
```json
{
    "body": "<a id='comment:4'></a>ok",
    "created_at": "2017-09-22T18:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249068",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>ok



---

archive/issue_events_052233.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-24T13:13:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18606#event-52233"
}
```



---

archive/issue_comments_249069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-24T13:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-249069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
