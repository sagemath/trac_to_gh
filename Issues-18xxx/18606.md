# Issue 18606: p-adic extensions created with "the same" polynomials may not be the same

archive/issues_018369.json:
```json
{
    "body": "The follow snippet of code shows the bug:\n\n```\nsage: x = QQ['x'].gen()\nsage: F = Qp(5,20)\nsage: K = F.extension(x^2-F(13),names = 'g')\nsage: R = MatrixSpace(K,1,1)\nsage: K1 = F.extension(x^2-13,names = 'g')\nsage: Matrix(K1,1,1,[K1(0)])\n```\n\nYou would expect the last line to **never** fail, but it does in this case, and the exception raised is not informative:\n\n```\nNotImplementedError: Conversion from different p-adic extensions not yet supported\n```\n\nThe reason is the following:\n\n```\nsage: K is K1\nFalse\nsage: hash(K) == hash(K1)\nTrue\n```\n\nSince MatrixSpace has unique representation, the second time that it is called it returns the space over K, not over K1 (this uses the hash of the key values). In the same initialization, it refuses to see K1(0) as an element of K, and the exception is raised.\n\nI think that what should be done to avoid this problem is to convert the defining polynomial of the extension to a polynomial over the base when sanitising the keys.\n\n\n**CC:**  @roed314 @JohnCremona\n\n**Keywords:** padics, extensions, hash, sd87\n\n**Branch/Commit:** [c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** David Roe\n\nIssue created by migration from https://trac.sagemath.org/ticket/18606\n\n",
    "closed_at": "2017-09-24T13:13:34Z",
    "created_at": "2015-06-04T10:17:49Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "p-adic extensions created with \"the same\" polynomials may not be the same",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18606",
    "user": "https://github.com/mmasdeu"
}
```
The follow snippet of code shows the bug:

```
sage: x = QQ['x'].gen()
sage: F = Qp(5,20)
sage: K = F.extension(x^2-F(13),names = 'g')
sage: R = MatrixSpace(K,1,1)
sage: K1 = F.extension(x^2-13,names = 'g')
sage: Matrix(K1,1,1,[K1(0)])
```

You would expect the last line to **never** fail, but it does in this case, and the exception raised is not informative:

```
NotImplementedError: Conversion from different p-adic extensions not yet supported
```

The reason is the following:

```
sage: K is K1
False
sage: hash(K) == hash(K1)
True
```

Since MatrixSpace has unique representation, the second time that it is called it returns the space over K, not over K1 (this uses the hash of the key values). In the same initialization, it refuses to see K1(0) as an element of K, and the exception is raised.

I think that what should be done to avoid this problem is to convert the defining polynomial of the extension to a polynomial over the base when sanitising the keys.


**CC:**  @roed314 @JohnCremona

**Keywords:** padics, extensions, hash, sd87

**Branch/Commit:** [c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)

**Reviewer:** Frédéric Chapoton

**Author:** David Roe

Issue created by migration from https://trac.sagemath.org/ticket/18606





---

archive/issue_comments_312879.json:
```json
{
    "body": "**Changing keywords** from \"padics, extensions, hash\" to \"padics, extensions, hash, sd87\".",
    "created_at": "2017-07-17T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312879",
    "user": "https://github.com/roed314"
}
```

**Changing keywords** from "padics, extensions, hash" to "padics, extensions, hash, sd87".



---

archive/issue_comments_312880.json:
```json
{
    "body": "<a id='comment:1'></a>\nAlso see #23331",
    "created_at": "2017-07-17T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312880",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>
Also see #23331



---

archive/issue_comments_312881.json:
```json
{
    "body": "**Branch:** [u/roed/same_poly](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/same_poly)",
    "created_at": "2017-09-20T17:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312881",
    "user": "https://github.com/roed314"
}
```

**Branch:** [u/roed/same_poly](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/same_poly)



---

archive/issue_comments_312882.json:
```json
{
    "body": "**Commit:** [c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312882",
    "user": "https://github.com/roed314"
}
```

**Commit:** [c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)



---

archive/issue_comments_312883.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b\">c1cfe4a</a></td><td><code>Add doctest to show 18606 resolved</code></td></tr></table>\n",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312883",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b">c1cfe4a</a></td><td><code>Add doctest to show 18606 resolved</code></td></tr></table>




---

archive/issue_comments_312884.json:
```json
{
    "body": "**Author:** David Roe",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312884",
    "user": "https://github.com/roed314"
}
```

**Author:** David Roe



---

archive/issue_comments_312885.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-09-20T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312885",
    "user": "https://github.com/roed314"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_312886.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-09-22T18:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312886",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_059660.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-22T18:51:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18606#event-59660"
}
```



---

archive/issue_comments_312887.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2017-09-22T18:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312887",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_312888.json:
```json
{
    "body": "<a id='comment:4'></a>\nok",
    "created_at": "2017-09-22T18:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312888",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
ok



---

archive/issue_events_059661.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-24T13:13:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18606#event-59661"
}
```



---

archive/issue_comments_312889.json:
```json
{
    "body": "**Changing branch** from \"[u/roed/same_poly](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/same_poly)\" to \"[c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)\".",
    "created_at": "2017-09-24T13:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18606#issuecomment-312889",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/roed/same_poly](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/same_poly)" to "[c1cfe4a898ea67805a1e21e2bf5c9752ea80330b](https://github.com/sagemath/sagetrac-mirror/commit/c1cfe4a898ea67805a1e21e2bf5c9752ea80330b)".
