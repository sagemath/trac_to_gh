# Issue 18194: Speedup of calculation of Macdonald H and Ht bases

archive/issues_017957.json:
```json
{
    "assignees": [],
    "body": "A formula of F. Bergeron and M. Haiman gives a Pieri rule for `h_r^\\perp {\\tilde H}_\\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.\n\nFor instance a command that takes a relatively long time to compute is\n\n```\nsage: %time H([3,2]).nabla(q=H.q,t=1/H.t)\nCPU times: user 2.75 s, sys: 86.6 ms, total: 2.83 s\nWall time: 2.95 s\nq^4/t^2*McdH[3, 2]\n```\nand with the new implementation the same command has the timing\n\n```\nCPU times: user 184 ms, sys: 18.7 ms, total: 203 ms\nWall time: 196 ms\n```\n\nOne reason that some of the computations in the `H` and `Ht` bases take a long time is that the entire basis a given degree is cached and so subsequent computations will be faster.  However it seems that the new implementation is cached more efficiently and is faster.\n\nThis ticket also catches an problem in `sage.combinat.nscf_qsym.qsym` where `to_symmetric_function` constructs an element with support in compositions.\n\nCC:  @sagetrac-sage-combinat @darijgr @tscrim @anneschilling\n\nKeywords: **sf, days67, sage-combinat**\n\nBranch/Commit: **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Mike Zabrocki**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18194_\n\n",
    "closed_at": "2015-04-26T02:21:40Z",
    "created_at": "2015-04-14T19:47:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speedup of calculation of Macdonald H and Ht bases",
    "type": "issue",
    "updated_at": "2015-04-26T02:21:40Z",
    "url": "https://github.com/sagemath/sage/issues/18194",
    "user": "https://github.com/zabrocki"
}
```
A formula of F. Bergeron and M. Haiman gives a Pieri rule for `h_r^\perp {\tilde H}_\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.

For instance a command that takes a relatively long time to compute is

```
sage: %time H([3,2]).nabla(q=H.q,t=1/H.t)
CPU times: user 2.75 s, sys: 86.6 ms, total: 2.83 s
Wall time: 2.95 s
q^4/t^2*McdH[3, 2]
```
and with the new implementation the same command has the timing

```
CPU times: user 184 ms, sys: 18.7 ms, total: 203 ms
Wall time: 196 ms
```

One reason that some of the computations in the `H` and `Ht` bases take a long time is that the entire basis a given degree is cached and so subsequent computations will be faster.  However it seems that the new implementation is cached more efficiently and is faster.

This ticket also catches an problem in `sage.combinat.nscf_qsym.qsym` where `to_symmetric_function` constructs an element with support in compositions.

CC:  @sagetrac-sage-combinat @darijgr @tscrim @anneschilling

Keywords: **sf, days67, sage-combinat**

Branch/Commit: **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**

Reviewer: **Travis Scrimshaw**

Author: **Mike Zabrocki**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/18194_





---

archive/issue_events_256387.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-14T19:47:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256387"
}
```



---

archive/issue_events_256388.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-14T19:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256388"
}
```



---

archive/issue_events_256389.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-14T19:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256389"
}
```



---

archive/issue_comments_248880.json:
```json
{
    "body": "Changed keywords from **Macdonald symmetric functions** to **sf, days67, sage-combinat**",
    "created_at": "2015-04-14T19:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248880",
    "user": "https://github.com/zabrocki"
}
```

Changed keywords from **Macdonald symmetric functions** to **sf, days67, sage-combinat**



---

archive/issue_comments_248881.json:
```json
{
    "body": "Changed commit from **[`9ba7893`](https://github.com/sagemath/sagetrac-mirror/commit/9ba7893a61e4783b106cd13ad61e1190d77d901d)** to **[`72e121e`](https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee)**",
    "created_at": "2015-04-14T21:15:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248881",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9ba7893`](https://github.com/sagemath/sagetrac-mirror/commit/9ba7893a61e4783b106cd13ad61e1190d77d901d)** to **[`72e121e`](https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee)**



---

archive/issue_comments_248882.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee\"><code>72e121e</code></a></td><td><code>Merge branch 'master' into public/combinat/zabrocki/mac_speedup</code></td></tr></table>\n",
    "created_at": "2015-04-14T21:15:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248882",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee"><code>72e121e</code></a></td><td><code>Merge branch 'master' into public/combinat/zabrocki/mac_speedup</code></td></tr></table>




---

archive/issue_comments_248883.json:
```json
{
    "body": "Changed commit from **[`72e121e`](https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee)** to **[`6ced308`](https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf)**",
    "created_at": "2015-04-14T21:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248883",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`72e121e`](https://github.com/sagemath/sagetrac-mirror/commit/72e121eeff5cf5f598a2e2d8a550030bf91281ee)** to **[`6ced308`](https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf)**



---

archive/issue_comments_248884.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf\"><code>6ced308</code></a></td><td><code>changed doc tests with odd negatives in fractions</code></td></tr></table>\n",
    "created_at": "2015-04-14T21:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248884",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf"><code>6ced308</code></a></td><td><code>changed doc tests with odd negatives in fractions</code></td></tr></table>




---

archive/issue_events_256390.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-14T21:34:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256390"
}
```



---

archive/issue_events_256391.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-14T21:34:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256391"
}
```



---

archive/issue_comments_248885.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nTime tests (former implementation)\n\n```\nsage: %time qt_kostka([3,3,2],[4,2,2])\nCPU times: user 1min 49s, sys: 418 ms, total: 1min 50s\nWall time: 1min 49s\n```\n(new implementation):\n\n```\nsage: %time qt_kostka([3,3,2],[4,2,2])\nCPU times: user 3.69 s, sys: 238 ms, total: 3.93 s\nWall time: 3.77 s\n```\n\n###\n\n(former implementation):\n\n```\nsage: %time s[1,1,1,1,1,1].nabla()\nCPU times: user 6.33 s, sys: 125 ms, total: 6.45 s\nWall time: 6.39 s\n```\n(new implementation):\n\n```\nsage: %time s[1,1,1,1,1,1].nabla()\nCPU times: user 1.15 s, sys: 69 ms, total: 1.22 s\nWall time: 1.17 s\n```",
    "created_at": "2015-04-14T21:52:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248885",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:5" align="right">comment:5</div>

Time tests (former implementation)

```
sage: %time qt_kostka([3,3,2],[4,2,2])
CPU times: user 1min 49s, sys: 418 ms, total: 1min 50s
Wall time: 1min 49s
```
(new implementation):

```
sage: %time qt_kostka([3,3,2],[4,2,2])
CPU times: user 3.69 s, sys: 238 ms, total: 3.93 s
Wall time: 3.77 s
```

###

(former implementation):

```
sage: %time s[1,1,1,1,1,1].nabla()
CPU times: user 6.33 s, sys: 125 ms, total: 6.45 s
Wall time: 6.39 s
```
(new implementation):

```
sage: %time s[1,1,1,1,1,1].nabla()
CPU times: user 1.15 s, sys: 69 ms, total: 1.22 s
Wall time: 1.17 s
```



---

archive/issue_comments_248886.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104\"><code>b6bad1b</code></a></td><td><code>corrections to the docstring, delete the cache for H</code></td></tr></table>\n",
    "created_at": "2015-04-14T22:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248886",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104"><code>b6bad1b</code></a></td><td><code>corrections to the docstring, delete the cache for H</code></td></tr></table>




---

archive/issue_comments_248887.json:
```json
{
    "body": "Changed commit from **[`6ced308`](https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf)** to **[`b6bad1b`](https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104)**",
    "created_at": "2015-04-14T22:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248887",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6ced308`](https://github.com/sagemath/sagetrac-mirror/commit/6ced308a68c1e9fe271e2dcc94fc3af6ab2eb2cf)** to **[`b6bad1b`](https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104)**



---

archive/issue_comments_248888.json:
```json
{
    "body": "Changed author from **zabrocki** to **Mike Zabrocki**",
    "created_at": "2015-04-15T02:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248888",
    "user": "https://github.com/zabrocki"
}
```

Changed author from **zabrocki** to **Mike Zabrocki**



---

archive/issue_comments_248889.json:
```json
{
    "body": "Changed commit from **[`b6bad1b`](https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104)** to **[`a70a531`](https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146)**",
    "created_at": "2015-04-19T17:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248889",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6bad1b`](https://github.com/sagemath/sagetrac-mirror/commit/b6bad1b52fd4661a42c1bab46a01c50b35ba8104)** to **[`a70a531`](https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146)**



---

archive/issue_comments_248890.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146\"><code>a70a531</code></a></td><td><code>corrections to references and documentation</code></td></tr></table>\n",
    "created_at": "2015-04-19T17:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248890",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146"><code>a70a531</code></a></td><td><code>corrections to references and documentation</code></td></tr></table>




---

archive/issue_comments_248891.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\ntwo failing doctests, see patchbot report",
    "created_at": "2015-04-20T06:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248891",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

two failing doctests, see patchbot report



---

archive/issue_events_256392.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-20T06:52:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256392"
}
```



---

archive/issue_events_256393.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-20T06:52:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256393"
}
```



---

archive/issue_comments_248892.json:
```json
{
    "body": "Changed branch from **[public/combinat/zabrocki/mac_speedup](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/zabrocki/mac_speedup)** to **[public/combinat/mac_speedup-18194](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/mac_speedup-18194)**",
    "created_at": "2015-04-20T06:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248892",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[public/combinat/zabrocki/mac_speedup](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/zabrocki/mac_speedup)** to **[public/combinat/mac_speedup-18194](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/mac_speedup-18194)**



---

archive/issue_comments_248893.json:
```json
{
    "body": "Changed commit from **[`a70a531`](https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146)** to **[`9196d33`](https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136)**",
    "created_at": "2015-04-20T06:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248893",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`a70a531`](https://github.com/sagemath/sagetrac-mirror/commit/a70a5314dbc203c66a08f1f070b739112921a146)** to **[`9196d33`](https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136)**



---

archive/issue_comments_248894.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI did some cleanup of the docstrings and imports. However there are some doctest failures:\n\n```\n----------------------------------------------------------------------\nsage -t ../../tests/book_schilling_zabrocki_kschur_primer.py  # 1 doctest failed\nsage -t ../../structure/parent.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```\nThe second one is slightly worrysome in that the coercion path has gotten longer, but it is not so bad. The first one is much more serious as I (and the patchbot) get a division by zero error on this test:\n\n```\nsage: Sym = SymmetricFunctions(FractionField(QQ['q']))\nsage: Mac = Sym.macdonald(t=0)\nsage: H = Mac.H()\nsage: s = Sym.schur()\nsage: for la in Partitions(3):\n....:    print \"H\",la, \"=\", s(H(la))\n```\nI suspect your computational assumptions are not always being met and lead to this error.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71c9ae0bd14cffdcff827a8c0490dbc482f29b2e\"><code>71c9ae0</code></a></td><td><code>Merge branch 'public/combinat/zabrocki/mac_speedup' of trac.sagemath.org:sage into public/combinat/zabrocki/mac_speedup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136\"><code>9196d33</code></a></td><td><code>Some cleanup of the docstrings and line lengths.</code></td></tr></table>\n",
    "created_at": "2015-04-20T06:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248894",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

I did some cleanup of the docstrings and imports. However there are some doctest failures:

```
----------------------------------------------------------------------
sage -t ../../tests/book_schilling_zabrocki_kschur_primer.py  # 1 doctest failed
sage -t ../../structure/parent.pyx  # 1 doctest failed
----------------------------------------------------------------------
```
The second one is slightly worrysome in that the coercion path has gotten longer, but it is not so bad. The first one is much more serious as I (and the patchbot) get a division by zero error on this test:

```
sage: Sym = SymmetricFunctions(FractionField(QQ['q']))
sage: Mac = Sym.macdonald(t=0)
sage: H = Mac.H()
sage: s = Sym.schur()
sage: for la in Partitions(3):
....:    print "H",la, "=", s(H(la))
```
I suspect your computational assumptions are not always being met and lead to this error.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71c9ae0bd14cffdcff827a8c0490dbc482f29b2e"><code>71c9ae0</code></a></td><td><code>Merge branch 'public/combinat/zabrocki/mac_speedup' of trac.sagemath.org:sage into public/combinat/zabrocki/mac_speedup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136"><code>9196d33</code></a></td><td><code>Some cleanup of the docstrings and line lengths.</code></td></tr></table>




---

archive/issue_comments_248895.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2015-04-20T06:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248895",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_248896.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI had not tested `t=0` or `q=0` and should have.  The reason it is failing is because there were a few places where I calculated \"f[X(t-1)]\" using `f.theta_qt(1/t,0)`.  There are ways around this because I can also use `f.omega_qt(t,0)`",
    "created_at": "2015-04-20T10:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248896",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:13" align="right">comment:13</div>

I had not tested `t=0` or `q=0` and should have.  The reason it is failing is because there were a few places where I calculated "f[X(t-1)]" using `f.theta_qt(1/t,0)`.  There are ways around this because I can also use `f.omega_qt(t,0)`



---

archive/issue_comments_248897.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff\"><code>5e4ad59</code></a></td><td><code>changed theta_qt with 1/q and 1/t to omega_qt plus adjustments to doc strings</code></td></tr></table>\n",
    "created_at": "2015-04-20T14:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248897",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff"><code>5e4ad59</code></a></td><td><code>changed theta_qt with 1/q and 1/t to omega_qt plus adjustments to doc strings</code></td></tr></table>




---

archive/issue_comments_248898.json:
```json
{
    "body": "Changed commit from **[`9196d33`](https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136)** to **[`5e4ad59`](https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff)**",
    "created_at": "2015-04-20T14:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248898",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9196d33`](https://github.com/sagemath/sagetrac-mirror/commit/9196d339a8adafb0c011d0f0ddb4172fbcbdd136)** to **[`5e4ad59`](https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff)**



---

archive/issue_comments_248899.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe fact that there is a change in the coercion path from `J` to `H` is to be expected because the new implementation takes `H` and `Ht` to and from the monomial basis while `J`, `P` and `Q` must pass through the Schur basis.  However, I do not know why the path it finds from Schur to monomial passes through homogeneous and the power basis.\n\n```\nsage: copy(H._internal_coerce_map_from(J))\nComposite map:\n  From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald J basis\n  To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald H basis\n  Defn:   Generic morphism:\n          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald J basis\n          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Schur basis\n        then\n          Generic morphism:\n          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Schur basis\n          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the homogeneous basis\n        then\n          Generic morphism:\n          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the homogeneous basis\n          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the powersum basis\n        then\n          Generic morphism:\n          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the powersum basis\n          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the monomial basis\n        then\n          Generic morphism:\n          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the monomial basis\n          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald H basis\n```\n\nWhat is the technique for ensuring that Sage finds the shortest coercion path?",
    "created_at": "2015-04-20T14:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248899",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:15" align="right">comment:15</div>

The fact that there is a change in the coercion path from `J` to `H` is to be expected because the new implementation takes `H` and `Ht` to and from the monomial basis while `J`, `P` and `Q` must pass through the Schur basis.  However, I do not know why the path it finds from Schur to monomial passes through homogeneous and the power basis.

```
sage: copy(H._internal_coerce_map_from(J))
Composite map:
  From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald J basis
  To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald H basis
  Defn:   Generic morphism:
          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald J basis
          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Schur basis
        then
          Generic morphism:
          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Schur basis
          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the homogeneous basis
        then
          Generic morphism:
          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the homogeneous basis
          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the powersum basis
        then
          Generic morphism:
          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the powersum basis
          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the monomial basis
        then
          Generic morphism:
          From: Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the monomial basis
          To:   Symmetric Functions over Fraction Field of Multivariate Polynomial Ring in q, t over Rational Field in the Macdonald H basis
```

What is the technique for ensuring that Sage finds the shortest coercion path?



---

archive/issue_comments_248900.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nUnfortunately I don't think there is a way to do so unless you explicitly specify the coercion. IIRC, there are known issues with finding efficient paths. Often times it comes from finding some path depending upon prior object creation (i.e., the monomial basis was perhaps [not] created this time whereas previously it was not?). It might lead to some slowdown, but it may not be a significant part of the computation.",
    "created_at": "2015-04-20T15:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248900",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Unfortunately I don't think there is a way to do so unless you explicitly specify the coercion. IIRC, there are known issues with finding efficient paths. Often times it comes from finding some path depending upon prior object creation (i.e., the monomial basis was perhaps [not] created this time whereas previously it was not?). It might lead to some slowdown, but it may not be a significant part of the computation.



---

archive/issue_comments_248901.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI'm willing to leave that as the coercion path because one would not normally convert from `Q`, `P` or `J` bases to `Ht` or `H` bases.  Where there might see a slowdown is between the `Qp` and `H` or `Ht` because `copy(H._internal_coerce_map_from(Qp))` has the extra two steps (although the reverse direction does not) and for mathematical reasons one *might* want to convert between these bases.\n\nI could write the `_self_to_s` and `_s_to_self` functions and add those as coercions, but mathematically they are equivalent to converting between the Schur and monomial basis.",
    "created_at": "2015-04-20T16:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248901",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:17" align="right">comment:17</div>

I'm willing to leave that as the coercion path because one would not normally convert from `Q`, `P` or `J` bases to `Ht` or `H` bases.  Where there might see a slowdown is between the `Qp` and `H` or `Ht` because `copy(H._internal_coerce_map_from(Qp))` has the extra two steps (although the reverse direction does not) and for mathematical reasons one *might* want to convert between these bases.

I could write the `_self_to_s` and `_s_to_self` functions and add those as coercions, but mathematically they are equivalent to converting between the Schur and monomial basis.



---

archive/issue_comments_248902.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nYou could just explicitly compose the respective coercions and set that composition as the coercion map as well (this is what the coercion framework essentially does).",
    "created_at": "2015-04-20T17:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248902",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

You could just explicitly compose the respective coercions and set that composition as the coercion map as well (this is what the coercion framework essentially does).



---

archive/issue_comments_248903.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0\"><code>54336b9</code></a></td><td><code>add coercion from s to H/Ht because coercion was passing through h and p bases</code></td></tr></table>\n",
    "created_at": "2015-04-21T01:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248903",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0"><code>54336b9</code></a></td><td><code>add coercion from s to H/Ht because coercion was passing through h and p bases</code></td></tr></table>




---

archive/issue_comments_248904.json:
```json
{
    "body": "Changed commit from **[`5e4ad59`](https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff)** to **[`54336b9`](https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0)**",
    "created_at": "2015-04-21T01:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248904",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5e4ad59`](https://github.com/sagemath/sagetrac-mirror/commit/5e4ad59ff71c603797f7fd58d36a714a66ee6cff)** to **[`54336b9`](https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0)**



---

archive/issue_events_256394.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-21T01:38:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256394"
}
```



---

archive/issue_events_256395.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-21T01:38:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256395"
}
```



---

archive/issue_comments_248905.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI added the `_self_to_s` and `_s_to_self` methods.  This restores old coercion paths because I registered these coercions before the ones to and from the `m` basis (if I did it in a different order the coercion paths were different).",
    "created_at": "2015-04-21T01:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248905",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:20" align="right">comment:20</div>

I added the `_self_to_s` and `_s_to_self` methods.  This restores old coercion paths because I registered these coercions before the ones to and from the `m` basis (if I did it in a different order the coercion paths were different).



---

archive/issue_events_256396.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-21T13:23:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256396"
}
```



---

archive/issue_events_256397.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-21T13:23:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256397"
}
```



---

archive/issue_comments_248906.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI have no good explanation yet, but the commits that I made in comment 14 added a full second (roughly 3.7 -> 4.7) on the computation of the `qt_kostka` computation that I listed the timing above.\n\n```\nsage: qt_kostka = sage.combinat.sf.macdonald.qt_kostka\nsage: %time qt_kostka([3,3,2],[4,2,2])\nCPU times: user 4.68 s, sys: 85.8 ms, total: 4.77 s\nWall time: 4.72 s\n```\nI am also having issues with the docstring viewer.  Is this a problem with 6.7.beta1?",
    "created_at": "2015-04-21T13:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248906",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:21" align="right">comment:21</div>

I have no good explanation yet, but the commits that I made in comment 14 added a full second (roughly 3.7 -> 4.7) on the computation of the `qt_kostka` computation that I listed the timing above.

```
sage: qt_kostka = sage.combinat.sf.macdonald.qt_kostka
sage: %time qt_kostka([3,3,2],[4,2,2])
CPU times: user 4.68 s, sys: 85.8 ms, total: 4.77 s
Wall time: 4.72 s
```
I am also having issues with the docstring viewer.  Is this a problem with 6.7.beta1?



---

archive/issue_comments_248907.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm doing some profiling now (`%prun`). How are the docstrings behaving?",
    "created_at": "2015-04-21T16:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248907",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm doing some profiling now (`%prun`). How are the docstrings behaving?



---

archive/issue_comments_248908.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nHere's at 9196d33:\n\n```\n         1354375 function calls (1342455 primitive calls) in 18.690 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n      484    8.666    0.018   10.441    0.022 {method 'subs' of 'sage.structure.element.Element' objects}\n    19061    1.364    0.000    1.460    0.000 fraction_field.py:293(<lambda>)\n6231/2951    1.089    0.000   15.034    0.005 {sum}\n    25/23    0.832    0.033    2.594    0.113 {sage.combinat.dict_addition.dict_linear_combination}\n     1289    0.475    0.000    1.076    0.001 macdonald.py:722(<genexpr>)\n1859/1005    0.393    0.000    1.577    0.002 macdonald.py:1388(<genexpr>)\n     4664    0.294    0.000    0.323    0.000 free_module.py:2028(<genexpr>)\n    14485    0.270    0.000    0.702    0.000 partition.py:608(__init__)\n    62071    0.245    0.000    0.357    0.000 combinat.py:1069(__hash__)\n     1958    0.229    0.000   14.979    0.008 macdonald.py:1245(<genexpr>)\n      484    0.225    0.000    1.215    0.003 {sage.libs.symmetrica.symmetrica.t_MONOMIAL_SCHUR_symmetrica}\n    82819    0.210    0.000    0.210    0.000 non_negative_integers.py:94(__contains__)\n  840/701    0.188    0.000    2.481    0.004 macdonald.py:1391(<genexpr>)\n      642    0.177    0.000    0.179    0.000 dynamic_class.py:324(dynamic_class_internal)\n    14620    0.173    0.000    0.469    0.000 partition.py:5049(__contains__)\n    47261    0.172    0.000    0.258    0.000 partition.py:632(<genexpr>)\n     8878    0.162    0.000    1.227    0.000 partition.py:552(__classcall_private__)\n   183978    0.160    0.000    0.160    0.000 rational_field.py:825(is_finite)\n   102278    0.158    0.000    0.158    0.000 {isinstance}\n   194018    0.133    0.000    0.133    0.000 rational_field.py:814(is_field)\n    10814    0.123    0.000    1.104    0.000 partition.py:5030(_element_constructor_)\n    35558    0.123    0.000    0.184    0.000 partition.py:5081(<genexpr>)\n  835/356    0.123    0.000    1.987    0.006 macdonald.py:677(cmunu)\n     1474    0.121    0.000    0.136    0.000 free_module.py:670(support)\n     1487    0.105    0.000    0.109    0.000 macdonald.py:636(<genexpr>)\n       22    0.104    0.005   15.518    0.705 macdonald.py:1244(<dictcomp>)\n      290    0.092    0.000    0.164    0.001 macdonald.py:669(<genexpr>)\n      290    0.082    0.000    0.144    0.000 macdonald.py:672(<genexpr>)\n22609/20887    0.080    0.000    0.112    0.000 combinat.py:951(__eq__)\n     3497    0.077    0.000    0.440    0.000 free_module.py:1976(_from_dict)\n    15893    0.076    0.000    0.076    0.000 combinat.py:821(__init__)\n    24936    0.071    0.000    0.583    0.000 {all}\n      968    0.066    0.000    0.085    0.000 free_module.py:519(_coefficient_fast)\n    73371    0.066    0.000    0.095    0.000 {len}\n    67171    0.066    0.000    0.066    0.000 fraction_field.py:463(ring)\n 2331/484    0.058    0.000    4.225    0.009 macdonald.py:1338(_Lmunu)\n```\nWith the current branch:\n\n```\n         1666331 function calls (1654153 primitive calls) in 24.257 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n      968   12.717    0.013   16.142    0.017 {method 'subs' of 'sage.structure.element.Element' objects}\n    37990    2.681    0.000    2.871    0.000 fraction_field.py:293(<lambda>)\n6231/2951    1.070    0.000   20.717    0.007 {sum}\n    25/23    0.833    0.033    2.509    0.109 {sage.combinat.dict_addition.dict_linear_combination}\n     1289    0.476    0.000    1.074    0.001 macdonald.py:722(<genexpr>)\n1859/1005    0.397    0.000    1.578    0.002 macdonald.py:1453(<genexpr>)\n     4664    0.294    0.000    0.322    0.000 free_module.py:2028(<genexpr>)\n    14485    0.275    0.000    0.711    0.000 partition.py:608(__init__)\n   281963    0.253    0.000    0.253    0.000 rational_field.py:825(is_finite)\n    62071    0.245    0.000    0.360    0.000 combinat.py:1069(__hash__)\n     1958    0.232    0.000   20.663    0.011 macdonald.py:1304(<genexpr>)\n    82819    0.218    0.000    0.218    0.000 non_negative_integers.py:94(__contains__)\n   291562    0.195    0.000    0.195    0.000 rational_field.py:814(is_field)\n  840/701    0.189    0.000    2.463    0.004 macdonald.py:1456(<genexpr>)\n      642    0.172    0.000    0.174    0.000 dynamic_class.py:324(dynamic_class_internal)\n    47261    0.172    0.000    0.261    0.000 partition.py:632(<genexpr>)\n     8878    0.161    0.000    1.196    0.000 partition.py:552(__classcall_private__)\n   104289    0.159    0.000    0.159    0.000 {isinstance}\n    14620    0.144    0.000    0.434    0.000 partition.py:5049(__contains__)\n      484    0.140    0.000    1.127    0.002 {sage.libs.symmetrica.symmetrica.t_MONOMIAL_SCHUR_symmetrica}\n    35558    0.126    0.000    0.190    0.000 partition.py:5081(<genexpr>)\n    10814    0.124    0.000    1.076    0.000 partition.py:5030(_element_constructor_)\n     1474    0.122    0.000    0.137    0.000 free_module.py:670(support)\n  835/356    0.122    0.000    1.966    0.006 macdonald.py:677(cmunu)\n     1487    0.107    0.000    0.111    0.000 macdonald.py:636(<genexpr>)\n       22    0.106    0.005   21.207    0.964 macdonald.py:1303(<dictcomp>)\n   105995    0.103    0.000    0.103    0.000 fraction_field.py:463(ring)\n     3445    0.083    0.000    0.112    0.000 {method 'sub' of '_sre.SRE_Pattern' objects}\n22609/20887    0.082    0.000    0.114    0.000 combinat.py:951(__eq__)\n    15893    0.076    0.000    0.076    0.000 combinat.py:821(__init__)\n      290    0.075    0.000    0.146    0.001 macdonald.py:669(<genexpr>)\n     3497    0.074    0.000    0.440    0.000 free_module.py:1976(_from_dict)\n    24936    0.072    0.000    0.592    0.000 {all}\n      290    0.071    0.000    0.135    0.000 macdonald.py:672(<genexpr>)\n      968    0.067    0.000    0.085    0.000 free_module.py:519(_coefficient_fast)\n    73394    0.066    0.000    0.095    0.000 {len}\n     1968    0.065    0.000    0.067    0.000 fraction_field.py:412(_repr_)\n```\nSo the issue is doing the 2 substitutions, which are quite expensive, instead of 1. (Although it's quite worrisome the sheer number of calls to certain things, like `is_finite`, but they are minor in terms of speed).",
    "created_at": "2015-04-21T16:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248908",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Here's at 9196d33:

```
         1354375 function calls (1342455 primitive calls) in 18.690 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
      484    8.666    0.018   10.441    0.022 {method 'subs' of 'sage.structure.element.Element' objects}
    19061    1.364    0.000    1.460    0.000 fraction_field.py:293(<lambda>)
6231/2951    1.089    0.000   15.034    0.005 {sum}
    25/23    0.832    0.033    2.594    0.113 {sage.combinat.dict_addition.dict_linear_combination}
     1289    0.475    0.000    1.076    0.001 macdonald.py:722(<genexpr>)
1859/1005    0.393    0.000    1.577    0.002 macdonald.py:1388(<genexpr>)
     4664    0.294    0.000    0.323    0.000 free_module.py:2028(<genexpr>)
    14485    0.270    0.000    0.702    0.000 partition.py:608(__init__)
    62071    0.245    0.000    0.357    0.000 combinat.py:1069(__hash__)
     1958    0.229    0.000   14.979    0.008 macdonald.py:1245(<genexpr>)
      484    0.225    0.000    1.215    0.003 {sage.libs.symmetrica.symmetrica.t_MONOMIAL_SCHUR_symmetrica}
    82819    0.210    0.000    0.210    0.000 non_negative_integers.py:94(__contains__)
  840/701    0.188    0.000    2.481    0.004 macdonald.py:1391(<genexpr>)
      642    0.177    0.000    0.179    0.000 dynamic_class.py:324(dynamic_class_internal)
    14620    0.173    0.000    0.469    0.000 partition.py:5049(__contains__)
    47261    0.172    0.000    0.258    0.000 partition.py:632(<genexpr>)
     8878    0.162    0.000    1.227    0.000 partition.py:552(__classcall_private__)
   183978    0.160    0.000    0.160    0.000 rational_field.py:825(is_finite)
   102278    0.158    0.000    0.158    0.000 {isinstance}
   194018    0.133    0.000    0.133    0.000 rational_field.py:814(is_field)
    10814    0.123    0.000    1.104    0.000 partition.py:5030(_element_constructor_)
    35558    0.123    0.000    0.184    0.000 partition.py:5081(<genexpr>)
  835/356    0.123    0.000    1.987    0.006 macdonald.py:677(cmunu)
     1474    0.121    0.000    0.136    0.000 free_module.py:670(support)
     1487    0.105    0.000    0.109    0.000 macdonald.py:636(<genexpr>)
       22    0.104    0.005   15.518    0.705 macdonald.py:1244(<dictcomp>)
      290    0.092    0.000    0.164    0.001 macdonald.py:669(<genexpr>)
      290    0.082    0.000    0.144    0.000 macdonald.py:672(<genexpr>)
22609/20887    0.080    0.000    0.112    0.000 combinat.py:951(__eq__)
     3497    0.077    0.000    0.440    0.000 free_module.py:1976(_from_dict)
    15893    0.076    0.000    0.076    0.000 combinat.py:821(__init__)
    24936    0.071    0.000    0.583    0.000 {all}
      968    0.066    0.000    0.085    0.000 free_module.py:519(_coefficient_fast)
    73371    0.066    0.000    0.095    0.000 {len}
    67171    0.066    0.000    0.066    0.000 fraction_field.py:463(ring)
 2331/484    0.058    0.000    4.225    0.009 macdonald.py:1338(_Lmunu)
```
With the current branch:

```
         1666331 function calls (1654153 primitive calls) in 24.257 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
      968   12.717    0.013   16.142    0.017 {method 'subs' of 'sage.structure.element.Element' objects}
    37990    2.681    0.000    2.871    0.000 fraction_field.py:293(<lambda>)
6231/2951    1.070    0.000   20.717    0.007 {sum}
    25/23    0.833    0.033    2.509    0.109 {sage.combinat.dict_addition.dict_linear_combination}
     1289    0.476    0.000    1.074    0.001 macdonald.py:722(<genexpr>)
1859/1005    0.397    0.000    1.578    0.002 macdonald.py:1453(<genexpr>)
     4664    0.294    0.000    0.322    0.000 free_module.py:2028(<genexpr>)
    14485    0.275    0.000    0.711    0.000 partition.py:608(__init__)
   281963    0.253    0.000    0.253    0.000 rational_field.py:825(is_finite)
    62071    0.245    0.000    0.360    0.000 combinat.py:1069(__hash__)
     1958    0.232    0.000   20.663    0.011 macdonald.py:1304(<genexpr>)
    82819    0.218    0.000    0.218    0.000 non_negative_integers.py:94(__contains__)
   291562    0.195    0.000    0.195    0.000 rational_field.py:814(is_field)
  840/701    0.189    0.000    2.463    0.004 macdonald.py:1456(<genexpr>)
      642    0.172    0.000    0.174    0.000 dynamic_class.py:324(dynamic_class_internal)
    47261    0.172    0.000    0.261    0.000 partition.py:632(<genexpr>)
     8878    0.161    0.000    1.196    0.000 partition.py:552(__classcall_private__)
   104289    0.159    0.000    0.159    0.000 {isinstance}
    14620    0.144    0.000    0.434    0.000 partition.py:5049(__contains__)
      484    0.140    0.000    1.127    0.002 {sage.libs.symmetrica.symmetrica.t_MONOMIAL_SCHUR_symmetrica}
    35558    0.126    0.000    0.190    0.000 partition.py:5081(<genexpr>)
    10814    0.124    0.000    1.076    0.000 partition.py:5030(_element_constructor_)
     1474    0.122    0.000    0.137    0.000 free_module.py:670(support)
  835/356    0.122    0.000    1.966    0.006 macdonald.py:677(cmunu)
     1487    0.107    0.000    0.111    0.000 macdonald.py:636(<genexpr>)
       22    0.106    0.005   21.207    0.964 macdonald.py:1303(<dictcomp>)
   105995    0.103    0.000    0.103    0.000 fraction_field.py:463(ring)
     3445    0.083    0.000    0.112    0.000 {method 'sub' of '_sre.SRE_Pattern' objects}
22609/20887    0.082    0.000    0.114    0.000 combinat.py:951(__eq__)
    15893    0.076    0.000    0.076    0.000 combinat.py:821(__init__)
      290    0.075    0.000    0.146    0.001 macdonald.py:669(<genexpr>)
     3497    0.074    0.000    0.440    0.000 free_module.py:1976(_from_dict)
    24936    0.072    0.000    0.592    0.000 {all}
      290    0.071    0.000    0.135    0.000 macdonald.py:672(<genexpr>)
      968    0.067    0.000    0.085    0.000 free_module.py:519(_coefficient_fast)
    73394    0.066    0.000    0.095    0.000 {len}
     1968    0.065    0.000    0.067    0.000 fraction_field.py:412(_repr_)
```
So the issue is doing the 2 substitutions, which are quite expensive, instead of 1. (Although it's quite worrisome the sheer number of calls to certain things, like `is_finite`, but they are minor in terms of speed).



---

archive/issue_comments_248909.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThe command `from sphinx.ext import doctest` raises the error `AttributeError: 'module' object has no attribute 'DocTestParser'` (but this is triggered by typing ?? after anything).  Is this a problem with this branch or I need to build from scratch?  This is clearly not related to changes to sf.",
    "created_at": "2015-04-21T16:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248909",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:24" align="right">comment:24</div>

The command `from sphinx.ext import doctest` raises the error `AttributeError: 'module' object has no attribute 'DocTestParser'` (but this is triggered by typing ?? after anything).  Is this a problem with this branch or I need to build from scratch?  This is clearly not related to changes to sf.



---

archive/issue_comments_248910.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nWe need the two subs though for this to work properly because if `t=0` then you can't substitute `t->1/t` (as one would need to in order to compute the `H` values from the `Ht` values), it needs to be done symbolically and then substitute the value for `t` afterwards.  \nIf the main culprit is are the subs then one workaround is that I can figure out the formulas for the functions `cmunu` which work for the `H` basis and create a separate cache for the `H` functions.  This is not ideal because then it memorizes the values for `H` and `Ht` bases separately.  On current branch it computes `Ht` values first and them computes `H` values with `t->1/t`.",
    "created_at": "2015-04-21T16:47:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248910",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:25" align="right">comment:25</div>

We need the two subs though for this to work properly because if `t=0` then you can't substitute `t->1/t` (as one would need to in order to compute the `H` values from the `Ht` values), it needs to be done symbolically and then substitute the value for `t` afterwards.  
If the main culprit is are the subs then one workaround is that I can figure out the formulas for the functions `cmunu` which work for the `H` basis and create a separate cache for the `H` functions.  This is not ideal because then it memorizes the values for `H` and `Ht` bases separately.  On current branch it computes `Ht` values first and them computes `H` values with `t->1/t`.



---

archive/issue_comments_248911.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAre you running Sage from `$SAGE_ROOT/src/sage`? This has been known to cause problems.\n\nPerhaps what we should do is special case the `t=0` cases when we end up doing a `t -> 1/t` substitution?",
    "created_at": "2015-04-21T17:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248911",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

Are you running Sage from `$SAGE_ROOT/src/sage`? This has been known to cause problems.

Perhaps what we should do is special case the `t=0` cases when we end up doing a `t -> 1/t` substitution?



---

archive/issue_comments_248912.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThanks, the `$SAGE_ROOT/src/sage` was exactly the problem.\n\nAt t=0, `H(mu).subs(t=0) == Qp(mu.conjugate()).subs(t=q).omega()`\n\nThat doesn't quite cut it for the `Ht` basis, but then maybe we never have to invert `t`.  I'll see if I can cover all cases this way.",
    "created_at": "2015-04-21T18:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248912",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:27" align="right">comment:27</div>

Thanks, the `$SAGE_ROOT/src/sage` was exactly the problem.

At t=0, `H(mu).subs(t=0) == Qp(mu.conjugate()).subs(t=q).omega()`

That doesn't quite cut it for the `Ht` basis, but then maybe we never have to invert `t`.  I'll see if I can cover all cases this way.



---

archive/issue_comments_248913.json:
```json
{
    "body": "Changed commit from **[`54336b9`](https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0)** to **[`7867101`](https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c)**",
    "created_at": "2015-04-22T01:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248913",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`54336b9`](https://github.com/sagemath/sagetrac-mirror/commit/54336b9146a247b6ee7ae97e47d07e0a5d5c41d0)** to **[`7867101`](https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c)**



---

archive/issue_comments_248914.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c\"><code>7867101</code></a></td><td><code>restored older _self_to_m in H basis, covered t=0 separately using hall-littlewood Qp</code></td></tr></table>\n",
    "created_at": "2015-04-22T01:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248914",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c"><code>7867101</code></a></td><td><code>restored older _self_to_m in H basis, covered t=0 separately using hall-littlewood Qp</code></td></tr></table>




---

archive/issue_comments_248915.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf\"><code>b1e92f4</code></a></td><td><code>readjusted _self_to_s and _s_to_self in Ht and H bases</code></td></tr></table>\n",
    "created_at": "2015-04-22T01:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248915",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf"><code>b1e92f4</code></a></td><td><code>readjusted _self_to_s and _s_to_self in Ht and H bases</code></td></tr></table>




---

archive/issue_comments_248916.json:
```json
{
    "body": "Changed commit from **[`7867101`](https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c)** to **[`b1e92f4`](https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf)**",
    "created_at": "2015-04-22T01:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248916",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7867101`](https://github.com/sagemath/sagetrac-mirror/commit/78671017d905c8a5a67f4855a3b2acf74edf370c)** to **[`b1e92f4`](https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf)**



---

archive/issue_comments_248917.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThis version seems to have the faster timings.  I did as you suggested and handled the `t==0` case separately and this only needs to happen in the `H` basis (the `Ht` basis doesn't invert `t` so does not need to be handled separately).  To handle the `t==0` case separately I use the Hall-Littlewood `Qp` basis.  That corner case will probably run even faster than before but I didn't test it beyond ensuring that it works.",
    "created_at": "2015-04-22T01:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248917",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:30" align="right">comment:30</div>

This version seems to have the faster timings.  I did as you suggested and handled the `t==0` case separately and this only needs to happen in the `H` basis (the `Ht` basis doesn't invert `t` so does not need to be handled separately).  To handle the `t==0` case separately I use the Hall-Littlewood `Qp` basis.  That corner case will probably run even faster than before but I didn't test it beyond ensuring that it works.



---

archive/issue_events_256398.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-22T01:29:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256398"
}
```



---

archive/issue_events_256399.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2015-04-22T01:29:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256399"
}
```



---

archive/issue_comments_248918.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThis is way over my head -- sorry, Mike...\n\nBut there is one thing I can suggest: correcting \"rational polynomial\" to \"rational functional\". Even if the former would have been a better notion, were it not also a synonym for a polynomial over `QQ`...",
    "created_at": "2015-04-22T01:39:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248918",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:31" align="right">comment:31</div>

This is way over my head -- sorry, Mike...

But there is one thing I can suggest: correcting "rational polynomial" to "rational functional". Even if the former would have been a better notion, were it not also a synonym for a polynomial over `QQ`...



---

archive/issue_events_256400.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2015-04-22T01:39:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256400"
}
```



---

archive/issue_events_256401.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2015-04-22T01:39:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256401"
}
```



---

archive/issue_comments_248919.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8\"><code>59394c6</code></a></td><td><code>corrected reference to rational polynomials</code></td></tr></table>\n",
    "created_at": "2015-04-22T01:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248919",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8"><code>59394c6</code></a></td><td><code>corrected reference to rational polynomials</code></td></tr></table>




---

archive/issue_comments_248920.json:
```json
{
    "body": "Changed commit from **[`b1e92f4`](https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf)** to **[`59394c6`](https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8)**",
    "created_at": "2015-04-22T01:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248920",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b1e92f4`](https://github.com/sagemath/sagetrac-mirror/commit/b1e92f40a5771d11c6e6244a7c68c55a58672eaf)** to **[`59394c6`](https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8)**



---

archive/issue_comments_248921.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nIt took me while to figure out precisely what you were referring to.  I changed to fraction field of polynomials in q and t.",
    "created_at": "2015-04-22T01:50:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248921",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:34" align="right">comment:34</div>

It took me while to figure out precisely what you were referring to.  I changed to fraction field of polynomials in q and t.



---

archive/issue_comments_248922.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSome timing tests.  On branch \u200b54336b9\n\n```\nsage: H = SymmetricFunctions(QQ['q','t'].fraction_field()).macdonald(t=0).H()\nsage: s = H.symmetric_function_ring().s()\nsage: %time H(s[4,3,2,1])\nCPU times: user 14.6 s, sys: 113 ms, total: 14.7 s\nWall time: 14.7 s\n```\n\non current branch\n\n```\nsage: %time H(s[4,3,2,1])\nCPU times: user 667 ms, sys: 66.2 ms, total: 734 ms\nWall time: 719 ms\n```\n\nThis is a huge improvement for this corner case.  For arbitrary `t` case on branch 54336b9\n\n```\nsage: H = SymmetricFunctions(QQ['q','t'].fraction_field()).macdonald().H()\nsage: s = H.symmetric_function_ring().s()\nsage: %time H(s[4,3,2,1])\nCPU times: user 1min 8s, sys: 213 ms, total: 1min 8s\nWall time: 1min 8s\n```\n\nWhile on the current branch\n\n```\nsage: %time H(s[4,3,2,1])\nCPU times: user 59.5 s, sys: 172 ms, total: 59.7 s\nWall time: 59.6 s\n```\n\nThis is a small but healthy improvement.  Timings for the `Ht` basis and applications of `nabla` seem to be similar on both of these branches.  These computations would not run in a reasonable amount of time without this ticket.",
    "created_at": "2015-04-22T14:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248922",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:35" align="right">comment:35</div>

Some timing tests.  On branch ​54336b9

```
sage: H = SymmetricFunctions(QQ['q','t'].fraction_field()).macdonald(t=0).H()
sage: s = H.symmetric_function_ring().s()
sage: %time H(s[4,3,2,1])
CPU times: user 14.6 s, sys: 113 ms, total: 14.7 s
Wall time: 14.7 s
```

on current branch

```
sage: %time H(s[4,3,2,1])
CPU times: user 667 ms, sys: 66.2 ms, total: 734 ms
Wall time: 719 ms
```

This is a huge improvement for this corner case.  For arbitrary `t` case on branch 54336b9

```
sage: H = SymmetricFunctions(QQ['q','t'].fraction_field()).macdonald().H()
sage: s = H.symmetric_function_ring().s()
sage: %time H(s[4,3,2,1])
CPU times: user 1min 8s, sys: 213 ms, total: 1min 8s
Wall time: 1min 8s
```

While on the current branch

```
sage: %time H(s[4,3,2,1])
CPU times: user 59.5 s, sys: 172 ms, total: 59.7 s
Wall time: 59.6 s
```

This is a small but healthy improvement.  Timings for the `Ht` basis and applications of `nabla` seem to be similar on both of these branches.  These computations would not run in a reasonable amount of time without this ticket.



---

archive/issue_comments_248923.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThat's quite a huge speedup. Do you want me to go through the code en masse and do some old-fashion profiling and tuning or just merge this in as-is?",
    "created_at": "2015-04-22T18:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248923",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:36" align="right">comment:36</div>

That's quite a huge speedup. Do you want me to go through the code en masse and do some old-fashion profiling and tuning or just merge this in as-is?



---

archive/issue_comments_248924.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThe major speed enhancement here is mathematical (the formula for computing the Macdonald symmetric functions).  If you want to tune it up I can see we might get a few seconds here and there.  Here are the places I can see algorithmic improvements:\n\n* `cmunu`, `cmunu1` and `Bmu` are a cached functions.  Are there improvements to be gained from using a global dictionary cache rather than a `@cached_function`?\n* carefully look at `_self_to_m`.  That would be my main concern where efficiency gains are to be had.  This function uses `_Lmunu` and this is the coefficient of the monomial symmetric function in a Macdonald symmetric function.",
    "created_at": "2015-04-23T01:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248924",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:37" align="right">comment:37</div>

The major speed enhancement here is mathematical (the formula for computing the Macdonald symmetric functions).  If you want to tune it up I can see we might get a few seconds here and there.  Here are the places I can see algorithmic improvements:

* `cmunu`, `cmunu1` and `Bmu` are a cached functions.  Are there improvements to be gained from using a global dictionary cache rather than a `@cached_function`?
* carefully look at `_self_to_m`.  That would be my main concern where efficiency gains are to be had.  This function uses `_Lmunu` and this is the coefficient of the monomial symmetric function in a Macdonald symmetric function.



---

archive/issue_comments_248925.json:
```json
{
    "body": "Changed commit from **[`59394c6`](https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8)** to **[`5ff5d5a`](https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96)**",
    "created_at": "2015-04-23T03:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248925",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`59394c6`](https://github.com/sagemath/sagetrac-mirror/commit/59394c6119e33ab5faa37ff4538643ab64f724b8)** to **[`5ff5d5a`](https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96)**



---

archive/issue_comments_248926.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96\"><code>5ff5d5a</code></a></td><td><code>Some old-fashion tuning.</code></td></tr></table>\n",
    "created_at": "2015-04-23T03:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248926",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96"><code>5ff5d5a</code></a></td><td><code>Some old-fashion tuning.</code></td></tr></table>




---

archive/issue_comments_248927.json:
```json
{
    "body": "Changed commit from **[`5ff5d5a`](https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96)** to **[`0cb8353`](https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf)**",
    "created_at": "2015-04-23T03:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248927",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5ff5d5a`](https://github.com/sagemath/sagetrac-mirror/commit/5ff5d5a0a7d875290b4cd3a24745166ce05bcf96)** to **[`0cb8353`](https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf)**



---

archive/issue_comments_248928.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf\"><code>0cb8353</code></a></td><td><code>Fixing non-imports and a strange doctest failure.</code></td></tr></table>\n",
    "created_at": "2015-04-23T03:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248928",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf"><code>0cb8353</code></a></td><td><code>Fixing non-imports and a strange doctest failure.</code></td></tr></table>




---

archive/issue_comments_248929.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nOkay, so I've managed to gain another 5~10% it seems but doing some mild code duplication with specialization. I've also had to fix this doctest in `sfa.py`:\n\n```\nsage: all( GR_def2(lam) == h.gessel_reutenauer(lam)\n....:      for n in range(5) for lam in Partitions(n) )\n```\nby explicitly casting the left-hand side to `h` as it now seems to ignore the equality check by coercion. However this worked for me on a smaller example, so something subtle seems to have changed with 5ff5d5a... I will look into this tomorrow for sure, but I will try tonight (after dinner).",
    "created_at": "2015-04-23T04:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248929",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:40" align="right">comment:40</div>

Okay, so I've managed to gain another 5~10% it seems but doing some mild code duplication with specialization. I've also had to fix this doctest in `sfa.py`:

```
sage: all( GR_def2(lam) == h.gessel_reutenauer(lam)
....:      for n in range(5) for lam in Partitions(n) )
```
by explicitly casting the left-hand side to `h` as it now seems to ignore the equality check by coercion. However this worked for me on a smaller example, so something subtle seems to have changed with 5ff5d5a... I will look into this tomorrow for sure, but I will try tonight (after dinner).



---

archive/issue_comments_248930.json:
```json
{
    "body": "Changed commit from **[`0cb8353`](https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf)** to **[`0a09d0f`](https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2)**",
    "created_at": "2015-04-23T04:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248930",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0cb8353`](https://github.com/sagemath/sagetrac-mirror/commit/0cb83533bfe821ae24dad1d95e7dc5d520fb1fdf)** to **[`0a09d0f`](https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2)**



---

archive/issue_comments_248931.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2\"><code>0a09d0f</code></a></td><td><code>Fix for conversion from NCSF to Sym.</code></td></tr></table>\n",
    "created_at": "2015-04-23T04:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248931",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2"><code>0a09d0f</code></a></td><td><code>Fix for conversion from NCSF to Sym.</code></td></tr></table>




---

archive/issue_comments_248932.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nA combination of \"it's bugging me\" and some clever testing made me realize that `to_symmetric_function` is returning compositions instead of partitions! Now why this is just being realized with my recent set of changes, I have no idea. Anyways, it's fixed and I'm okay with the state of things. At least, I couldn't figure out a way to twist out some more speed without doing some moderate cythonization and changing fraction field elements. There might be some gain from doing some of the arithmetic on the polynomial ring and then converting the numerator and denominator to the fraction field, but I'm too hungry and don't know if there will be a sizable enough gain to warrant such an experiment (at this point).",
    "created_at": "2015-04-23T04:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248932",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

A combination of "it's bugging me" and some clever testing made me realize that `to_symmetric_function` is returning compositions instead of partitions! Now why this is just being realized with my recent set of changes, I have no idea. Anyways, it's fixed and I'm okay with the state of things. At least, I couldn't figure out a way to twist out some more speed without doing some moderate cythonization and changing fraction field elements. There might be some gain from doing some of the arithmetic on the polynomial ring and then converting the numerator and denominator to the fraction field, but I'm too hungry and don't know if there will be a sizable enough gain to warrant such an experiment (at this point).



---

archive/issue_comments_248933.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nWell I see some clever ways that you have added a bit of efficiency, but unfortunately I am not seeing a speedup on at least one computation.  On 59394c6\n\n```\nsage: s = SymmetricFunctions(QQ['q','t'].fraction_field()).s()\nsage: %time s[3,3,3,3].nabla()\nCPU times: user 4min 8s, sys: 512 ms, total: 4min 8s\nWall time: 4min 8s\n```\non current branch\n\n```\nsage: %time s[3,3,3,3].nabla()\nCPU times: user 4min 29s, sys: 454 ms, total: 4min 29s\nWall time: 4min 29s\n```\nThis computation uses only the `Ht` basis (it does a conversion to the `Ht`, multiply by eigenvalue, then from `Ht` to `s`).",
    "created_at": "2015-04-23T11:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248933",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:43" align="right">comment:43</div>

Well I see some clever ways that you have added a bit of efficiency, but unfortunately I am not seeing a speedup on at least one computation.  On 59394c6

```
sage: s = SymmetricFunctions(QQ['q','t'].fraction_field()).s()
sage: %time s[3,3,3,3].nabla()
CPU times: user 4min 8s, sys: 512 ms, total: 4min 8s
Wall time: 4min 8s
```
on current branch

```
sage: %time s[3,3,3,3].nabla()
CPU times: user 4min 29s, sys: 454 ms, total: 4min 29s
Wall time: 4min 29s
```
This computation uses only the `Ht` basis (it does a conversion to the `Ht`, multiply by eigenvalue, then from `Ht` to `s`).



---

archive/issue_comments_248934.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8\"><code>5ce7e9c</code></a></td><td><code>delete Bmu since it is no longer used, plus two minor changes shave seconds off previous test</code></td></tr></table>\n",
    "created_at": "2015-04-23T15:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248934",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8"><code>5ce7e9c</code></a></td><td><code>delete Bmu since it is no longer used, plus two minor changes shave seconds off previous test</code></td></tr></table>




---

archive/issue_comments_248935.json:
```json
{
    "body": "Changed commit from **[`0a09d0f`](https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2)** to **[`5ce7e9c`](https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8)**",
    "created_at": "2015-04-23T15:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248935",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0a09d0f`](https://github.com/sagemath/sagetrac-mirror/commit/0a09d0f615166b8f65af971a61805663e81f3ff2)** to **[`5ce7e9c`](https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8)**



---

archive/issue_comments_248936.json:
```json
{
    "body": "Changed commit from **[`5ce7e9c`](https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8)** to **[`b9447fd`](https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785)**",
    "created_at": "2015-04-23T16:23:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248936",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5ce7e9c`](https://github.com/sagemath/sagetrac-mirror/commit/5ce7e9c80f2886161816f526fb3574f3c75712b8)** to **[`b9447fd`](https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785)**



---

archive/issue_comments_248937.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c52abe98ec76e46281239b06388d0c01a7e9ea06\"><code>c52abe9</code></a></td><td><code>Reverting some changes for speed.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c3a2386197beaef203560c70283418e4b0444f6\"><code>6c3a238</code></a></td><td><code>Merge branch 'public/combinat/mac_speedup-18194' of trac.sagemath.org:sage into public/combinat/mac_speedup-18194</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785\"><code>b9447fd</code></a></td><td><code>Trying to get a little bit more.</code></td></tr></table>\n",
    "created_at": "2015-04-23T16:23:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248937",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c52abe98ec76e46281239b06388d0c01a7e9ea06"><code>c52abe9</code></a></td><td><code>Reverting some changes for speed.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c3a2386197beaef203560c70283418e4b0444f6"><code>6c3a238</code></a></td><td><code>Merge branch 'public/combinat/mac_speedup-18194' of trac.sagemath.org:sage into public/combinat/mac_speedup-18194</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785"><code>b9447fd</code></a></td><td><code>Trying to get a little bit more.</code></td></tr></table>




---

archive/issue_comments_248938.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nSo in small scale, just calling the element directly is faster, but at this scale, doing `subs` is actually faster because of some preprocessing it seems to do. *shrugs* I also did some other things which should be faster.\n\nThe testing I did previously was on `H(s[3,2,2,1])`, and looking at the profile, the coercions between bases are faster, but some other parts of the computation seems to be slower (for reasons currently unknown to me).",
    "created_at": "2015-04-23T16:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248938",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

So in small scale, just calling the element directly is faster, but at this scale, doing `subs` is actually faster because of some preprocessing it seems to do. *shrugs* I also did some other things which should be faster.

The testing I did previously was on `H(s[3,2,2,1])`, and looking at the profile, the coercions between bases are faster, but some other parts of the computation seems to be slower (for reasons currently unknown to me).



---

archive/issue_comments_248939.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de\"><code>da67e9a</code></a></td><td><code>changed the sum back for more speed</code></td></tr></table>\n",
    "created_at": "2015-04-23T18:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248939",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de"><code>da67e9a</code></a></td><td><code>changed the sum back for more speed</code></td></tr></table>




---

archive/issue_comments_248940.json:
```json
{
    "body": "Changed commit from **[`b9447fd`](https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785)** to **[`da67e9a`](https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de)**",
    "created_at": "2015-04-23T18:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248940",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b9447fd`](https://github.com/sagemath/sagetrac-mirror/commit/b9447fd4de5991d0e147e538371123c221e14785)** to **[`da67e9a`](https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de)**



---

archive/issue_comments_248941.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI know that your sum looks faster (by changing `mu in x.support...` to `c, mu in x`), but this seems to cut off 20 seconds in my test computation.\n\n```\nsage: %time s[3,3,3,3].nabla()\nCPU times: user 4min 5s, sys: 389 ms, total: 4min 6s\nWall time: 4min 6s\n```",
    "created_at": "2015-04-23T18:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248941",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:48" align="right">comment:48</div>

I know that your sum looks faster (by changing `mu in x.support...` to `c, mu in x`), but this seems to cut off 20 seconds in my test computation.

```
sage: %time s[3,3,3,3].nabla()
CPU times: user 4min 5s, sys: 389 ms, total: 4min 6s
Wall time: 4min 6s
```



---

archive/issue_comments_248942.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReally? O_o I really don't believe that is faster because `homogeneous component` is:\n\n```python\ndegree_on_basis = self.parent().degree_on_basis\nreturn self.parent().sum_of_terms((i, c)\n                                  for (i, c) in self\n                                  if degree_on_basis(i) == n)\n```\nPlus there is a `sorted` being called in `support`, not to mention the intermediate element created. I don't see how we'd be doing fewer terms in the sum.\n\nAhhh...here's a thought, it's the call to `sorted` that results in the speedup because the smaller elements result in fewer terms that have to be resolved until the end. I'm going to experiment, but if that's true, then that's one subtle issue.\n\nAlthough that call to `QQqt` is superfluous as `_Lmunu` returns an element of `QQqt`.",
    "created_at": "2015-04-23T18:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248942",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

Really? O_o I really don't believe that is faster because `homogeneous component` is:

```python
degree_on_basis = self.parent().degree_on_basis
return self.parent().sum_of_terms((i, c)
                                  for (i, c) in self
                                  if degree_on_basis(i) == n)
```
Plus there is a `sorted` being called in `support`, not to mention the intermediate element created. I don't see how we'd be doing fewer terms in the sum.

Ahhh...here's a thought, it's the call to `sorted` that results in the speedup because the smaller elements result in fewer terms that have to be resolved until the end. I'm going to experiment, but if that's true, then that's one subtle issue.

Although that call to `QQqt` is superfluous as `_Lmunu` returns an element of `QQqt`.



---

archive/issue_comments_248943.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49\"><code>b2d3ea7</code></a></td><td><code>Getting some more time.</code></td></tr></table>\n",
    "created_at": "2015-04-23T18:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248943",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49"><code>b2d3ea7</code></a></td><td><code>Getting some more time.</code></td></tr></table>




---

archive/issue_comments_248944.json:
```json
{
    "body": "Changed commit from **[`da67e9a`](https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de)** to **[`b2d3ea7`](https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49)**",
    "created_at": "2015-04-23T18:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248944",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`da67e9a`](https://github.com/sagemath/sagetrac-mirror/commit/da67e9a2aa6c6c99a48ec6897c8726bc899982de)** to **[`b2d3ea7`](https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49)**



---

archive/issue_comments_248945.json:
```json
{
    "body": "Changed commit from **[`b2d3ea7`](https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49)** to **[`5424fac`](https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4)**",
    "created_at": "2015-04-23T18:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248945",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b2d3ea7`](https://github.com/sagemath/sagetrac-mirror/commit/b2d3ea7f504b5a2c363402ff2d0e2e7b4f844c49)** to **[`5424fac`](https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4)**



---

archive/issue_comments_248946.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4\"><code>5424fac</code></a></td><td><code>Removing useless call to QQqt.</code></td></tr></table>\n",
    "created_at": "2015-04-23T18:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248946",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4"><code>5424fac</code></a></td><td><code>Removing useless call to QQqt.</code></td></tr></table>




---

archive/issue_comments_248947.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nA couple comments on the cmunu1(mu, nu) function:\n\nThe comments on lines 640-641 of macdonald.py are obsolete, right?\n\nYou use prod(...) and QQqt(prod(...)). I have not done any profiling, but wouldn't QQqt.prod(...) be the \"right\" way in both situations?\n\nOn line 936, what is \\mu'? The conjugate?",
    "created_at": "2015-04-23T19:10:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248947",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:52" align="right">comment:52</div>

A couple comments on the cmunu1(mu, nu) function:

The comments on lines 640-641 of macdonald.py are obsolete, right?

You use prod(...) and QQqt(prod(...)). I have not done any profiling, but wouldn't QQqt.prod(...) be the "right" way in both situations?

On line 936, what is \mu'? The conjugate?



---

archive/issue_comments_248948.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nYes, it is the call to `sorted` that causes the slowdown, which does make sense because the coefficients we obtain have fewer terms (at least, that's my assumption). Quite a subtle issue IMO (perhaps this is more expected to you?). This version is faster than your version in my testing with `s[3,2,2].nabla()` and `H(s[3,2,2,1])`. If this is faster, then I think we can set this to positive review. (BTW, we are wanting to remove the call to `sorted` in `support`)",
    "created_at": "2015-04-23T19:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248948",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:53" align="right">comment:53</div>

Yes, it is the call to `sorted` that causes the slowdown, which does make sense because the coefficients we obtain have fewer terms (at least, that's my assumption). Quite a subtle issue IMO (perhaps this is more expected to you?). This version is faster than your version in my testing with `s[3,2,2].nabla()` and `H(s[3,2,2,1])`. If this is faster, then I think we can set this to positive review. (BTW, we are wanting to remove the call to `sorted` in `support`)



---

archive/issue_comments_248949.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nStrangely, this is not faster.\n\n```\nsage: %time s[3,3,3,3].nabla()\nCPU times: user 4min 11s, sys: 555 ms, total: 4min 12s\nWall time: 4min 12s\n```",
    "created_at": "2015-04-23T19:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248949",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:54" align="right">comment:54</div>

Strangely, this is not faster.

```
sage: %time s[3,3,3,3].nabla()
CPU times: user 4min 11s, sys: 555 ms, total: 4min 12s
Wall time: 4min 12s
```



---

archive/issue_comments_248950.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\n*bangs head into the nearest wall* I'll have to test and profile on a larger example then...",
    "created_at": "2015-04-23T20:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248950",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:55" align="right">comment:55</div>

*bangs head into the nearest wall* I'll have to test and profile on a larger example then...



---

archive/issue_comments_248951.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nFor the record, this is what I get.\nCurrent version:\n\n```\nsage: %time s[3,2,2].nabla()\nCPU times: user 7.61 s, sys: 73.2 ms, total: 7.68 s\nWall time: 7.6 s\n```\nYour commit:\n\n```\nsage: %time s[3,2,2].nabla()\nCPU times: user 7.7 s, sys: 25.1 ms, total: 7.72 s\nWall time: 7.68 s\n```\nCurrent:\n\n```\nsage: %time s[3,2,2,1].nabla()\nCPU times: user 27.4 s, sys: 74.8 ms, total: 27.5 s\nWall time: 27.5 s\n```\nYours:\n\n```\nsage: %time s[3,2,2,1].nabla()\nCPU times: user 27.5 s, sys: 42.3 ms, total: 27.5 s\nWall time: 27.5 s\n```\nFrom profiling, the current branch of the above example has fewer function calls by ~5%, and at the very least, this should not increase the time when they do the same functionality (except for checking for coefficients of 0). For smaller partitions, the recent commit seems to be faster, but the larger ones it slows down. I don't understand and am missing something. Perhaps we should just revert back to `da67e9a` and go with that.",
    "created_at": "2015-04-23T20:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248951",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:56" align="right">comment:56</div>

For the record, this is what I get.
Current version:

```
sage: %time s[3,2,2].nabla()
CPU times: user 7.61 s, sys: 73.2 ms, total: 7.68 s
Wall time: 7.6 s
```
Your commit:

```
sage: %time s[3,2,2].nabla()
CPU times: user 7.7 s, sys: 25.1 ms, total: 7.72 s
Wall time: 7.68 s
```
Current:

```
sage: %time s[3,2,2,1].nabla()
CPU times: user 27.4 s, sys: 74.8 ms, total: 27.5 s
Wall time: 27.5 s
```
Yours:

```
sage: %time s[3,2,2,1].nabla()
CPU times: user 27.5 s, sys: 42.3 ms, total: 27.5 s
Wall time: 27.5 s
```
From profiling, the current branch of the above example has fewer function calls by ~5%, and at the very least, this should not increase the time when they do the same functionality (except for checking for coefficients of 0). For smaller partitions, the recent commit seems to be faster, but the larger ones it slows down. I don't understand and am missing something. Perhaps we should just revert back to `da67e9a` and go with that.



---

archive/issue_comments_248952.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI am no longer convinced `da67e9a` is faster.  I ran about 15-20 timings of `s[3,3,3,3].nabla()` and sometimes it was faster, sometimes it wasn't.  They seem about the same, but if you say there are ~5% less function calls with current, lets go with that.",
    "created_at": "2015-04-23T23:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248952",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:57" align="right">comment:57</div>

I am no longer convinced `da67e9a` is faster.  I ran about 15-20 timings of `s[3,3,3,3].nabla()` and sometimes it was faster, sometimes it wasn't.  They seem about the same, but if you say there are ~5% less function calls with current, lets go with that.



---

archive/issue_comments_248953.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI closed all other applications and windows, dimmed the lights, very quietly breathed through my nose and ran some more timing tests.  Current: 3.55, 3.53 and 3.55 and on branch `da67e9a`: 3.55, 3.54 and 3.56.  My conclusion: close enough.",
    "created_at": "2015-04-24T12:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248953",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:58" align="right">comment:58</div>

I closed all other applications and windows, dimmed the lights, very quietly breathed through my nose and ran some more timing tests.  Current: 3.55, 3.53 and 3.55 and on branch `da67e9a`: 3.55, 3.54 and 3.56.  My conclusion: close enough.



---

archive/issue_comments_248954.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nOne typo in the doctests, see patchbot reports",
    "created_at": "2015-04-24T19:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248954",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:59" align="right">comment:59</div>

One typo in the doctests, see patchbot reports



---

archive/issue_comments_248955.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51579f6687822f226960a50cdb5b8db319b3dbaf\"><code>51579f6</code></a></td><td><code>Merge branch 'public/combinat/mac_speedup-18194' of trac.sagemath.org:sage into public/combinat/mac_speedup-18194</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e\"><code>f85548e</code></a></td><td><code>Fixing my stupid typo and not checking.</code></td></tr></table>\n",
    "created_at": "2015-04-25T06:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248955",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51579f6687822f226960a50cdb5b8db319b3dbaf"><code>51579f6</code></a></td><td><code>Merge branch 'public/combinat/mac_speedup-18194' of trac.sagemath.org:sage into public/combinat/mac_speedup-18194</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e"><code>f85548e</code></a></td><td><code>Fixing my stupid typo and not checking.</code></td></tr></table>




---

archive/issue_comments_248956.json:
```json
{
    "body": "Changed commit from **[`5424fac`](https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4)** to **[`f85548e`](https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e)**",
    "created_at": "2015-04-25T06:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248956",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5424fac`](https://github.com/sagemath/sagetrac-mirror/commit/5424fac7ab4d98e1526536956a00157c2dbcb2c4)** to **[`f85548e`](https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e)**



---

archive/issue_comments_248957.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1\"><code>23dea68</code></a></td><td><code>Some documentation tweaks per Darij's comment.</code></td></tr></table>\n",
    "created_at": "2015-04-25T06:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248957",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1"><code>23dea68</code></a></td><td><code>Some documentation tweaks per Darij's comment.</code></td></tr></table>




---

archive/issue_comments_248958.json:
```json
{
    "body": "Changed commit from **[`f85548e`](https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e)** to **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**",
    "created_at": "2015-04-25T06:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248958",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f85548e`](https://github.com/sagemath/sagetrac-mirror/commit/f85548eccd9accc367a868e26ce3b783a2b1cb1e)** to **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**



---

archive/issue_comments_248959.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI'd ask if you put on some mood music, but that would've disrupted the timings. :P I also addressed [Darij's questions](#comment%3A52).\n\nDarij, I found that running `prod` is faster than `QQqt.prod` on this scale because the C/cython implementation of the `prod` function plus the one coercion beats the python implementation of the `prod` method without a coercion.\n\nSo I think we're at positive review?",
    "created_at": "2015-04-25T06:26:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248959",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:62" align="right">comment:62</div>

I'd ask if you put on some mood music, but that would've disrupted the timings. :P I also addressed [Darij's questions](#comment%3A52).

Darij, I found that running `prod` is faster than `QQqt.prod` on this scale because the C/cython implementation of the `prod` function plus the one coercion beats the python implementation of the `prod` method without a coercion.

So I think we're at positive review?



---

archive/issue_comments_248960.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nOuch, this speaks badly of our OOP. Thanks for timing!",
    "created_at": "2015-04-25T06:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248960",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:63" align="right">comment:63</div>

Ouch, this speaks badly of our OOP. Thanks for timing!



---

archive/issue_comments_248961.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nIt's not OOP per say, it's just Python vs. Cython. Usually performing the coercion is the slow step. However, in this case because the multiplication is slow and frequent. The little python difference adds up.",
    "created_at": "2015-04-25T06:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248961",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:64" align="right">comment:64</div>

It's not OOP per say, it's just Python vs. Cython. Usually performing the coercion is the slow step. However, in this case because the multiplication is slow and frequent. The little python difference adds up.



---

archive/issue_comments_248962.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nWhat I mean is that the implementation in Sage makes the OOP-friendly methods slower than the hacky ducktyped ones. It's not a good state to be in... Is there a way to implement `M.sum` and `R.prod` in Cython without refactoring the whole classes?",
    "created_at": "2015-04-25T06:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248962",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:65" align="right">comment:65</div>

What I mean is that the implementation in Sage makes the OOP-friendly methods slower than the hacky ducktyped ones. It's not a good state to be in... Is there a way to implement `M.sum` and `R.prod` in Cython without refactoring the whole classes?



---

archive/issue_comments_248963.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nThat's not quite being fair to Sage as: the built-in python version is just as ducktyped, it is a shortcoming of support in Cython to not be able to handle multiple inheritance, and `M.sum` and `M.prod` don't guarantee the result is in `M`. If you want the builtin/cython speed, then call `prod(args, M.one())` (the coercion really is non-existent in terms of time here).",
    "created_at": "2015-04-25T06:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248963",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:66" align="right">comment:66</div>

That's not quite being fair to Sage as: the built-in python version is just as ducktyped, it is a shortcoming of support in Cython to not be able to handle multiple inheritance, and `M.sum` and `M.prod` don't guarantee the result is in `M`. If you want the builtin/cython speed, then call `prod(args, M.one())` (the coercion really is non-existent in terms of time here).



---

archive/issue_comments_248964.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nAh, nice trick with `M.one()`.",
    "created_at": "2015-04-25T06:50:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248964",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:67" align="right">comment:67</div>

Ah, nice trick with `M.one()`.



---

archive/issue_comments_248965.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI am pleased.  I think it is ready for positive review.  Thanks for all the effort put into it.",
    "created_at": "2015-04-25T13:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248965",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:68" align="right">comment:68</div>

I am pleased.  I think it is ready for positive review.  Thanks for all the effort put into it.



---

archive/issue_comments_248966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-A formula of F. Bergeron, A. Garsia and M. Haiman gives a Pieri rule for `h_r^\\perp {\\tilde H}_\\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.\n+A formula of F. Bergeron and M. Haiman gives a Pieri rule for `h_r^\\perp {\\tilde H}_\\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.\n \n For instance a command that takes a relatively long time to compute is\n \n@@ -16,3 +16,5 @@\n ```\n \n One reason that some of the computations in the `H` and `Ht` bases take a long time is that the entire basis a given degree is cached and so subsequent computations will be faster.  However it seems that the new implementation is cached more efficiently and is faster.\n+\n+This ticket also catches an problem in `sage.combinat.nscf_qsym.qsym` where `to_symmetric_function` constructs an element with support in compositions.\n``````\n",
    "created_at": "2015-04-25T13:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248966",
    "user": "https://github.com/zabrocki"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-A formula of F. Bergeron, A. Garsia and M. Haiman gives a Pieri rule for `h_r^\perp {\tilde H}_\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.
+A formula of F. Bergeron and M. Haiman gives a Pieri rule for `h_r^\perp {\tilde H}_\mu` and this formula can be used to compute the `H` and `Ht` bases much quicker than previous implementations.  The current implementation computes the `H` and `Ht` basis through the `J` basis and this basis is implemented through creation operators.
 
 For instance a command that takes a relatively long time to compute is
 
@@ -16,3 +16,5 @@
 ```
 
 One reason that some of the computations in the `H` and `Ht` bases take a long time is that the entire basis a given degree is cached and so subsequent computations will be faster.  However it seems that the new implementation is cached more efficiently and is faster.
+
+This ticket also catches an problem in `sage.combinat.nscf_qsym.qsym` where `to_symmetric_function` constructs an element with support in compositions.
``````




---

archive/issue_comments_248967.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThanks for all your testing and timings too.",
    "created_at": "2015-04-25T16:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248967",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:70" align="right">comment:70</div>

Thanks for all your testing and timings too.



---

archive/issue_events_256402.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-04-25T16:05:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256402"
}
```



---

archive/issue_events_256403.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-04-25T16:05:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256403"
}
```



---

archive/issue_events_256404.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-26T02:21:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256404"
}
```



---

archive/issue_events_256405.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "689d2aed2995e11d6951b561bf084e57eb74752e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-26T02:21:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18194#event-256405"
}
```



---

archive/issue_comments_248968.json:
```json
{
    "body": "Changed branch from **[public/combinat/mac_speedup-18194](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/mac_speedup-18194)** to **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**",
    "created_at": "2015-04-26T02:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18194#issuecomment-248968",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/combinat/mac_speedup-18194](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/mac_speedup-18194)** to **[`23dea68`](https://github.com/sagemath/sagetrac-mirror/commit/23dea68c64c8fb1e5957d6396bb0f98c4fa850d1)**
