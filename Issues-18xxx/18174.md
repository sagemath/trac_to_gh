# Issue 18174: Generalize base class construction for functorial construction categories

archive/issues_017937.json:
```json
{
    "body": "This ticket implements the following syntactic sugar for functorial\nconstruction categories::\n\n```\n    GradedModules(K)  ->  Modules(K).Graded()\n    Modules.Graded(K) ->  Modules(K).Graded()\n```\nThis makes them behave consistently with `CategoryWithAxiom`.\n\nAs is noted in the code, the internal logic is very similar, but there\nseemed at this point to be no good way to avoid the duplication.\n\nThe first syntactic sugar was actually already partially implemented\nfor `GradedModulesCategory`, so half of the work is just generalizing\nexisting code.\n\nThe syntactic sugar is not valid for construction categories that take\nextra arguments like `Algebras`, since there is no generic way to\ndecide what the argument should be used for:\n\n```\n    Sets.Algebras(K)  ->   Sets(K).Algebras() or Sets().Algebras(K) ?\n```\n\n\nAssignee: @tscrim\n\nCC:  @nthiery\n\nKeywords: sd67\n\nBranch: [c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)\n\nReviewer: Nicolas M. Thi\u00e9ry\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18174\n\n",
    "closed_at": "2015-04-15T06:07:30Z",
    "created_at": "2015-04-12T17:37:42Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Generalize base class construction for functorial construction categories",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18174",
    "user": "https://github.com/tscrim"
}
```
This ticket implements the following syntactic sugar for functorial
construction categories::

```
    GradedModules(K)  ->  Modules(K).Graded()
    Modules.Graded(K) ->  Modules(K).Graded()
```
This makes them behave consistently with `CategoryWithAxiom`.

As is noted in the code, the internal logic is very similar, but there
seemed at this point to be no good way to avoid the duplication.

The first syntactic sugar was actually already partially implemented
for `GradedModulesCategory`, so half of the work is just generalizing
existing code.

The syntactic sugar is not valid for construction categories that take
extra arguments like `Algebras`, since there is no generic way to
decide what the argument should be used for:

```
    Sets.Algebras(K)  ->   Sets(K).Algebras() or Sets().Algebras(K) ?
```


Assignee: @tscrim

CC:  @nthiery

Keywords: sd67

Branch: [c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)

Reviewer: Nicolas M. Thiéry

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18174





---

archive/issue_comments_318401.json:
```json
{
    "body": "Branch: [public/categories/functorial_magic-18174](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/functorial_magic-18174)",
    "created_at": "2015-04-12T17:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318401",
    "user": "https://github.com/tscrim"
}
```

Branch: [public/categories/functorial_magic-18174](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/functorial_magic-18174)



---

archive/issue_comments_318402.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-12T17:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318402",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318403.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[0e78e25](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)|`Implement generic functorial construction base class magic.`|",
    "created_at": "2015-04-12T17:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318403",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[0e78e25](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)|`Implement generic functorial construction base class magic.`|



---

archive/issue_comments_318404.json:
```json
{
    "body": "Commit: [0e78e25fbd6bee9af1bf5606411f8146075b739f](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)",
    "created_at": "2015-04-12T17:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318404",
    "user": "https://github.com/tscrim"
}
```

Commit: [0e78e25fbd6bee9af1bf5606411f8146075b739f](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)



---

archive/issue_comments_318405.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[1604162](https://github.com/sagemath/sagetrac-mirror/commit/16041629491785b68b0597f990cfc43e5fd16c00)|`18174: small doc improvements`|\n|[c35a270](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)|`18174: more doc improvements + uniformization with CategoryWithAxiom`|",
    "created_at": "2015-04-12T21:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[1604162](https://github.com/sagemath/sagetrac-mirror/commit/16041629491785b68b0597f990cfc43e5fd16c00)|`18174: small doc improvements`|
|[c35a270](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)|`18174: more doc improvements + uniformization with CategoryWithAxiom`|



---

archive/issue_comments_318406.json:
```json
{
    "body": "Changing commit from \"[0e78e25fbd6bee9af1bf5606411f8146075b739f](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)\" to \"[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)\"",
    "created_at": "2015-04-12T21:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[0e78e25fbd6bee9af1bf5606411f8146075b739f](https://github.com/sagemath/sagetrac-mirror/commit/0e78e25fbd6bee9af1bf5606411f8146075b739f)" to "[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)"



---

archive/issue_comments_318407.json:
```json
{
    "body": "<a id='comment:3'></a>\nLGTM",
    "created_at": "2015-04-12T22:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318407",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
LGTM



---

archive/issue_comments_318408.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-12T22:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318408",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318409.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor the record: all long tests pass up to some failures/timeouts I often get on my test machine:\n\n```\nsage -t --long src/sage/misc/cachefunc.pyx  # 1 doctest failed\nsage -t --long src/sage/tests/cmdline.py  # 1 doctest failed\nsage -t --long src/sage/dev/sagedev.py  # Timed out\nsage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py  # Timed out\nsage -t --long src/sage/modular/arithgroup/arithgroup_perm.py  # Timed out\nsage -t --long src/doc/en/tutorial/interfaces.rst  # 10 doctests failed\n```",
    "created_at": "2015-04-12T23:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318409",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
For the record: all long tests pass up to some failures/timeouts I often get on my test machine:

```
sage -t --long src/sage/misc/cachefunc.pyx  # 1 doctest failed
sage -t --long src/sage/tests/cmdline.py  # 1 doctest failed
sage -t --long src/sage/dev/sagedev.py  # Timed out
sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py  # Timed out
sage -t --long src/sage/modular/arithgroup/arithgroup_perm.py  # Timed out
sage -t --long src/doc/en/tutorial/interfaces.rst  # 10 doctests failed
```



---

archive/issue_comments_318410.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,24 @@\n-We generalize the magic functions in `GradedModulesCategory` so we can don't have to copy `_base_category_class` with minor changes and `__classcall__` in order to have separate files for categories created by a functorial construction.\n+This ticket implements the following syntactic sugar for functorial\n+construction categories::\n+\n+```\n+    GradedModules(K)  ->  Modules(K).Graded()\n+    Modules.Graded(K) ->  Modules(K).Graded()\n+```\n+This makes them behave consistently with `CategoryWithAxiom`.\n+\n+As is noted in the code, the internal logic is very similar, but there\n+seemed at this point to be no good way to avoid the duplication.\n+\n+The first syntactic sugar was actually already partially implemented\n+for `GradedModulesCategory`, so half of the work is just generalizing\n+existing code.\n+\n+The syntactic sugar is not valid for construction categories that take\n+extra arguments like `Algebras`, since there is no generic way to\n+decide what the argument should be used for:\n+\n+```\n+    Sets.Algebras(K)  ->   Sets(K).Algebras() or Sets().Algebras(K) ?\n+```\n+\n``````\n",
    "created_at": "2015-04-13T12:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318410",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,24 @@
-We generalize the magic functions in `GradedModulesCategory` so we can don't have to copy `_base_category_class` with minor changes and `__classcall__` in order to have separate files for categories created by a functorial construction.
+This ticket implements the following syntactic sugar for functorial
+construction categories::
+
+```
+    GradedModules(K)  ->  Modules(K).Graded()
+    Modules.Graded(K) ->  Modules(K).Graded()
+```
+This makes them behave consistently with `CategoryWithAxiom`.
+
+As is noted in the code, the internal logic is very similar, but there
+seemed at this point to be no good way to avoid the duplication.
+
+The first syntactic sugar was actually already partially implemented
+for `GradedModulesCategory`, so half of the work is just generalizing
+existing code.
+
+The syntactic sugar is not valid for construction categories that take
+extra arguments like `Algebras`, since there is no generic way to
+decide what the argument should be used for:
+
+```
+    Sets.Algebras(K)  ->   Sets(K).Algebras() or Sets().Algebras(K) ?
+```
+
``````




---

archive/issue_comments_318411.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd67\".",
    "created_at": "2015-04-13T16:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318411",
    "user": "https://github.com/nthiery"
}
```

Changing keywords from "" to "sd67".



---

archive/issue_comments_318412.json:
```json
{
    "body": "Changing branch from \"[public/categories/functorial_magic-18174](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/functorial_magic-18174)\" to \"[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)\"",
    "created_at": "2015-04-15T06:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318412",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/categories/functorial_magic-18174](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/functorial_magic-18174)" to "[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)"



---

archive/issue_comments_318413.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-15T06:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318413",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058471.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-15T06:07:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18174#event-58471"
}
```



---

archive/issue_comments_318414.json:
```json
{
    "body": "Changing commit from \"[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)\" to \"\"",
    "created_at": "2015-05-27T13:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318414",
    "user": "https://github.com/kcrisman"
}
```

Changing commit from "[c35a27022e3199f3b2f05d3550e747b4cdd574b5](https://github.com/sagemath/sagetrac-mirror/commit/c35a27022e3199f3b2f05d3550e747b4cdd574b5)" to ""



---

archive/issue_comments_318415.json:
```json
{
    "body": "Changing reviewer from \"Nicolas Thi\u00e9ry\" to \"Nicolas M. Thi\u00e9ry\"",
    "created_at": "2015-05-27T13:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18174#issuecomment-318415",
    "user": "https://github.com/kcrisman"
}
```

Changing reviewer from "Nicolas Thiéry" to "Nicolas M. Thiéry"
