# Issue 18340: PARI/GP does not gracefully handle out-of-memory

archive/issues_018103.json:
```json
{
    "body": "The following will eat all your memory:\n\n```\n$ ( ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py )\n```\nThis sets the stack size to \"unlimited\". The `gp` process which is executed by this doctest will then use a very large amount of memory.\n\nThis happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n\nThis can be solved by upgrading PARI/GP.\n\n**Upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz)\n\n---\n\nSee https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion\n\n(Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)\n\nCC:  @jdemeyer\n\nKeywords: PARI gp ptestlong doctesting lseries_ell.py\n\nBranch/Commit: [5249809481c4366e0ea5f9efc0f89b27ce7bc7fd](https://github.com/sagemath/sagetrac-mirror/commit/5249809481c4366e0ea5f9efc0f89b27ce7bc7fd)\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Vincent Delecroix, John Cremona, Leif Leonhardy\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18340\n\n",
    "closed_at": "2015-05-04T19:04:39Z",
    "created_at": "2015-04-29T22:17:28Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "PARI/GP does not gracefully handle out-of-memory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18340",
    "user": "https://github.com/novoselt"
}
```
The following will eat all your memory:

```
$ ( ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py )
```
This sets the stack size to "unlimited". The `gp` process which is executed by this doctest will then use a very large amount of memory.

This happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)

This can be solved by upgrading PARI/GP.

**Upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz)

---

See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion

(Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)

CC:  @jdemeyer

Keywords: PARI gp ptestlong doctesting lseries_ell.py

Branch/Commit: [5249809481c4366e0ea5f9efc0f89b27ce7bc7fd](https://github.com/sagemath/sagetrac-mirror/commit/5249809481c4366e0ea5f9efc0f89b27ce7bc7fd)

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Vincent Delecroix, John Cremona, Leif Leonhardy

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18340





---

archive/issue_events_058841.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "rename": {
        "from": "Memory issues while testing",
        "to": "Memory issues while testing (gp process)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18340#event-58841"
}
```



---

archive/issue_comments_322778.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis has also been reported on sage-release; it happens presumably since the last update of PARI.",
    "created_at": "2015-04-30T00:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322778",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
This has also been reported on sage-release; it happens presumably since the last update of PARI.



---

archive/issue_comments_322779.json:
```json
{
    "body": "Changing keywords from \"\" to \"PARI gp ptestlong doctesting\".",
    "created_at": "2015-04-30T00:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322779",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "PARI gp ptestlong doctesting".



---

archive/issue_comments_322780.json:
```json
{
    "body": "<a id='comment:2'></a>\nFor me, on one machine it happens each time I run `make ptestlong` unless I delete `~/.sage/timings*` before doing so.  (Deleting these files \"disables\" the IMHO useless and rather counter-productive *sorting of doctests by previous runtime*.)\n\nJohn C. reported it happened to him even with `make testlong`, i.e., without testing in parallel.",
    "created_at": "2015-04-30T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322780",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
For me, on one machine it happens each time I run `make ptestlong` unless I delete `~/.sage/timings*` before doing so.  (Deleting these files "disables" the IMHO useless and rather counter-productive *sorting of doctests by previous runtime*.)

John C. reported it happened to him even with `make testlong`, i.e., without testing in parallel.



---

archive/issue_comments_322781.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,11 @@\n See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion\n+\n+---\n+\n+Work-around I currently use (with `bash`):\n+\n+```\n+$ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory\n+                                       # of *each* (sub)process to ~4MB\n+```\n+Interestingly, all test pass despite the greedy `gp` process getting killed.\n``````\n",
    "created_at": "2015-04-30T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322781",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,11 @@
 See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion
+
+---
+
+Work-around I currently use (with `bash`):
+
+```
+$ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory
+                                       # of *each* (sub)process to ~4MB
+```
+Interestingly, all test pass despite the greedy `gp` process getting killed.
``````




---

archive/issue_comments_322782.json:
```json
{
    "body": "<a id='comment:3'></a>\nOoops, GB, not MB... 8)",
    "created_at": "2015-04-30T00:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322782",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Ooops, GB, not MB... 8)



---

archive/issue_comments_322783.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,6 @@\n \n ```\n $ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory\n-                                       # of *each* (sub)process to ~4MB\n+                                       # of *each* (sub)process to ~4GB\n ```\n Interestingly, all test pass despite the greedy `gp` process getting killed.\n``````\n",
    "created_at": "2015-04-30T00:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322783",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,6 @@
 
 ```
 $ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory
-                                       # of *each* (sub)process to ~4MB
+                                       # of *each* (sub)process to ~4GB
 ```
 Interestingly, all test pass despite the greedy `gp` process getting killed.
``````




---

archive/issue_comments_322784.json:
```json
{
    "body": "Changing keywords from \"PARI gp ptestlong doctesting\" to \"PARI gp ptestlong doctesting lseries_ell.py\".",
    "created_at": "2015-04-30T00:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322784",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "PARI gp ptestlong doctesting" to "PARI gp ptestlong doctesting lseries_ell.py".



---

archive/issue_comments_322785.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion\n+\n+(Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)\n \n ---\n \n``````\n",
    "created_at": "2015-04-30T00:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322785",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion
+
+(Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)
 
 ---
 
``````




---

archive/issue_comments_322786.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhy don't we always limit doctesting by some sensible number (4GB per process seems fine to me) and report failed tests if it is triggered? It is one thing when my old laptop get unresponsive with a new version of Sage, it is a completely different story when \"my\" server goes down which is used by several researches and hundreds of students.",
    "created_at": "2015-04-30T00:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322786",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
Why don't we always limit doctesting by some sensible number (4GB per process seems fine to me) and report failed tests if it is triggered? It is one thing when my old laptop get unresponsive with a new version of Sage, it is a completely different story when "my" server goes down which is used by several researches and hundreds of students.



---

archive/issue_comments_322787.json:
```json
{
    "body": "<a id='comment:6'></a>\nWell, whether `ulimit` works depends on the OS AFAIK.\n\nAnd as I said, I do not even get a \"Killed\" from Sage; the doctest passes even though its child process got killed.\n\nI haven't yet been able to reproduce this other than by running `make ptestlong`;  `./sage -tp --long --warn-long 0.0001 src/sage/schemes/elliptic_curves/` for example doesn't show the behaviour even on an already loaded machine.",
    "created_at": "2015-04-30T01:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322787",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Well, whether `ulimit` works depends on the OS AFAIK.

And as I said, I do not even get a "Killed" from Sage; the doctest passes even though its child process got killed.

I haven't yet been able to reproduce this other than by running `make ptestlong`;  `./sage -tp --long --warn-long 0.0001 src/sage/schemes/elliptic_curves/` for example doesn't show the behaviour even on an already loaded machine.



---

archive/issue_comments_322788.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [leif](#comment%3A6):\n> I haven't yet been able to reproduce this other than by running `make ptestlong`;  `./sage -tp --long --warn-long 0.0001 src/sage/schemes/elliptic_curves/` for example doesn't show the behaviour even on an already loaded machine.\n\n\nVaguely thought of that already, and we indeed need (GNU) `make`, and a sufficiently old one:\n\n```sh\necho \"WARNING:  'gp' may eat up up to ~16GB with the following\"\n(ulimit -v 16000000; printf \"all:\\n\\t./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py\\n\" | make -f -)\n```\n\nWith `make` 3.81, `gp` runs amok; with `make` 4.1, everything's fine.\n\n(We had a similar issue with ECL and/or GAP quite a while ago IIRC, and the `make` version without issues was 3.82 and later I think.)",
    "created_at": "2015-04-30T02:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322788",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Replying to [leif](#comment%3A6):
> I haven't yet been able to reproduce this other than by running `make ptestlong`;  `./sage -tp --long --warn-long 0.0001 src/sage/schemes/elliptic_curves/` for example doesn't show the behaviour even on an already loaded machine.


Vaguely thought of that already, and we indeed need (GNU) `make`, and a sufficiently old one:

```sh
echo "WARNING:  'gp' may eat up up to ~16GB with the following"
(ulimit -v 16000000; printf "all:\n\t./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py\n" | make -f -)
```

With `make` 3.81, `gp` runs amok; with `make` 4.1, everything's fine.

(We had a similar issue with ECL and/or GAP quite a while ago IIRC, and the `make` version without issues was 3.82 and later I think.)



---

archive/issue_comments_322789.json:
```json
{
    "body": "<a id='comment:8'></a>\n\n```\nnovoselt@sagenb:~$ make --version\nGNU Make 3.81\nCopyright (C) 2006  Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.\n\nThis program built for x86_64-pc-linux-gnu\n```\nECL fails some tests on this machine unless I compile with some flags for Bulldozer... I guess updating to jessie may help, but I can't risk breaking things right before the term starts.",
    "created_at": "2015-04-30T02:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322789",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>

```
novoselt@sagenb:~$ make --version
GNU Make 3.81
Copyright (C) 2006  Free Software Foundation, Inc.
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.

This program built for x86_64-pc-linux-gnu
```
ECL fails some tests on this machine unless I compile with some flags for Bulldozer... I guess updating to jessie may help, but I can't risk breaking things right before the term starts.



---

archive/issue_comments_322790.json:
```json
{
    "body": "<a id='comment:9'></a>\nIn case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n\nFixed in 3.82, as I guessed.\n\nNote that not just Ubuntu 10.04, but also 12.04 and even 14.04!!! (just checked and couldn't believe) still come with the dead old and broken version 3.81 of 2006.",
    "created_at": "2015-04-30T03:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322790",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
In case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)

Fixed in 3.82, as I guessed.

Note that not just Ubuntu 10.04, but also 12.04 and even 14.04!!! (just checked and couldn't believe) still come with the dead old and broken version 3.81 of 2006.



---

archive/issue_comments_322791.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [novoselt](#comment%3A8):\n> {{{\n> novoselt`@`sagenb:~$ make --version\n> GNU Make 3.81\n> Copyright (C) 2006  Free Software Foundation, Inc.\n> This is free software; see the source for copying conditions.\n> There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\n> PARTICULAR PURPOSE.\n> \n> This program built for x86_64-pc-linux-gnu\n> }}}\n> ECL fails some tests on this machine unless I compile with some flags for Bulldozer... I guess updating to jessie may help, but I can't risk breaking things right before the term starts.\n\n\nWell, just grab some newer version (3.82, 4.0 or 4.1) from [http://ftp.gnu.org/gnu/make/](http://ftp.gnu.org/gnu/make/), untar it, and run `configure && make && sudo make install` (by default into `/usr/local`).",
    "created_at": "2015-04-30T03:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322791",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Replying to [novoselt](#comment%3A8):
> {{{
> novoselt`@`sagenb:~$ make --version
> GNU Make 3.81
> Copyright (C) 2006  Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.
> There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
> PARTICULAR PURPOSE.
> 
> This program built for x86_64-pc-linux-gnu
> }}}
> ECL fails some tests on this machine unless I compile with some flags for Bulldozer... I guess updating to jessie may help, but I can't risk breaking things right before the term starts.


Well, just grab some newer version (3.82, 4.0 or 4.1) from [http://ftp.gnu.org/gnu/make/](http://ftp.gnu.org/gnu/make/), untar it, and run `configure && make && sudo make install` (by default into `/usr/local`).



---

archive/issue_comments_322792.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [leif](#comment%3A9):\n> In case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n\n\nHmmm, I'm still not sure whether it's really this.  Ubuntu apparently patched their `make`, as it does **not** touch the resource limits, while my GNU make 4.1 limits the stack size to 8MB (soft):\n\n```sh\nfor make in /usr/local/bin/make /usr/bin/make; do $make --version | head -1; printf \"all:\\n\\t: ; ulimit -sH\\n\\t: ; ulimit -sS\\n\" | $make -f -; done\nGNU Make 4.1\n: ; ulimit -sH\nunlimited\n: ; ulimit -sS\n8192\nGNU Make 3.81\n: ; ulimit -sH\nunlimited\n: ; ulimit -sS\nunlimited\n```\n\nAnother cause could be GNU make 3.81 messing up file descriptors somehow.",
    "created_at": "2015-04-30T04:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322792",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [leif](#comment%3A9):
> In case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)


Hmmm, I'm still not sure whether it's really this.  Ubuntu apparently patched their `make`, as it does **not** touch the resource limits, while my GNU make 4.1 limits the stack size to 8MB (soft):

```sh
for make in /usr/local/bin/make /usr/bin/make; do $make --version | head -1; printf "all:\n\t: ; ulimit -sH\n\t: ; ulimit -sS\n" | $make -f -; done
GNU Make 4.1
: ; ulimit -sH
unlimited
: ; ulimit -sS
8192
GNU Make 3.81
: ; ulimit -sH
unlimited
: ; ulimit -sS
unlimited
```

Another cause could be GNU make 3.81 messing up file descriptors somehow.



---

archive/issue_comments_322793.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A10):\n> Well, just grab some newer version (3.82, 4.0 or 4.1) from [http://ftp.gnu.org/gnu/make/](http://ftp.gnu.org/gnu/make/), untar it, and run `configure && make && sudo make install` (by default into `/usr/local`).\n\n\nAlternatively, I can just not test Sage. But it does not fix the issue for other users. If it is a bug in `make`, but it is a widely adopted version, it still makes sense to work around it. Wheezy is likely to be around for another 3 years.",
    "created_at": "2015-04-30T04:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322793",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A10):
> Well, just grab some newer version (3.82, 4.0 or 4.1) from [http://ftp.gnu.org/gnu/make/](http://ftp.gnu.org/gnu/make/), untar it, and run `configure && make && sudo make install` (by default into `/usr/local`).


Alternatively, I can just not test Sage. But it does not fix the issue for other users. If it is a bug in `make`, but it is a widely adopted version, it still makes sense to work around it. Wheezy is likely to be around for another 3 years.



---

archive/issue_comments_322794.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [leif](#comment%3A11):\n> Replying to [leif](#comment%3A9):\n> > In case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n\n> \n> Hmmm, I'm still not sure whether it's really this.  Ubuntu apparently patched their `make`, as it does **not** touch the resource limits, while my GNU make 4.1 limits the stack size to 8MB (soft):\n> \n> ```\n> #!sh\n> for make in /usr/local/bin/make /usr/bin/make; do $make --version | head -1; printf \"all:\\n\\t: ; ulimit -sH\\n\\t: ; ulimit -sS\\n\" | $make -f -; done\n> GNU Make 4.1\n> : ; ulimit -sH\n> unlimited\n> : ; ulimit -sS\n> 8192\n> GNU Make 3.81\n> : ; ulimit -sH\n> unlimited\n> : ; ulimit -sS\n> unlimited\n> ```\n\n\nWhat is the `ulimit -s` outside of `make`? I get\n\n```\njdemeyer@tamiyo:~$ ulimit -s\n8192\n```\nso if `make` changes that to `unlimited`, that's [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010) indeed.",
    "created_at": "2015-04-30T05:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322794",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [leif](#comment%3A11):
> Replying to [leif](#comment%3A9):
> > In case it's really GNU make's fault: [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)

> 
> Hmmm, I'm still not sure whether it's really this.  Ubuntu apparently patched their `make`, as it does **not** touch the resource limits, while my GNU make 4.1 limits the stack size to 8MB (soft):
> 
> ```
> #!sh
> for make in /usr/local/bin/make /usr/bin/make; do $make --version | head -1; printf "all:\n\t: ; ulimit -sH\n\t: ; ulimit -sS\n" | $make -f -; done
> GNU Make 4.1
> : ; ulimit -sH
> unlimited
> : ; ulimit -sS
> 8192
> GNU Make 3.81
> : ; ulimit -sH
> unlimited
> : ; ulimit -sS
> unlimited
> ```


What is the `ulimit -s` outside of `make`? I get

```
jdemeyer@tamiyo:~$ ulimit -s
8192
```
so if `make` changes that to `unlimited`, that's [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010) indeed.



---

archive/issue_comments_322795.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [novoselt](#comment%3A12):\n> If it is a bug in `make`, but it is a widely adopted version, it still makes sense to work around it. Wheezy is likely to be around for another 3 years.\n\nThe fixed version of GNU `make` has been released almost 5 years ago. There is really no excuse for still using `make` 3.81. Like leif said, you can easily install that manually outside of the distro.",
    "created_at": "2015-04-30T05:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322795",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [novoselt](#comment%3A12):
> If it is a bug in `make`, but it is a widely adopted version, it still makes sense to work around it. Wheezy is likely to be around for another 3 years.

The fixed version of GNU `make` has been released almost 5 years ago. There is really no excuse for still using `make` 3.81. Like leif said, you can easily install that manually outside of the distro.



---

archive/issue_events_058842.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "rename": {
        "from": "Memory issues while testing (gp process)",
        "to": "If given unlimited stack, gp uses it all"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18340#event-58842"
}
```



---

archive/issue_comments_322796.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,14 @@\n+The following will eat all your memory:\n+\n+```\n+$ ( ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py )\n+```\n+This sets the stack size to \"unlimited\". The `gp` process which is executed by this doctest will then use a very large amount of memory.\n+\n+This happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n+\n+---\n+\n See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion\n \n (Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)\n-\n----\n-\n-Work-around I currently use (with `bash`):\n-\n-```\n-$ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory\n-                                       # of *each* (sub)process to ~4GB\n-```\n-Interestingly, all test pass despite the greedy `gp` process getting killed.\n``````\n",
    "created_at": "2015-04-30T08:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322796",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,14 @@
+The following will eat all your memory:
+
+```
+$ ( ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py )
+```
+This sets the stack size to "unlimited". The `gp` process which is executed by this doctest will then use a very large amount of memory.
+
+This happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)
+
+---
+
 See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion
 
 (Older) Thread on sage-release: [http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757](http://thread.gmane.org/gmane.comp.mathematics.sage.release/2757)
-
----
-
-Work-around I currently use (with `bash`):
-
-```
-$ (ulimit -v 4000000; make ptestlong)  # e.g.; limits virtual memory
-                                       # of *each* (sub)process to ~4GB
-```
-Interestingly, all test pass despite the greedy `gp` process getting killed.
``````




---

archive/issue_comments_322797.json:
```json
{
    "body": "<a id='comment:15'></a>\nI can confirm the issue.",
    "created_at": "2015-04-30T08:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322797",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
I can confirm the issue.



---

archive/issue_comments_322798.json:
```json
{
    "body": "<a id='comment:16'></a>\nI'm now trying to see why `gp` uses so much stack memory.",
    "created_at": "2015-04-30T08:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322798",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
I'm now trying to see why `gp` uses so much stack memory.



---

archive/issue_comments_322799.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-04-30T08:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322799",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_322800.json:
```json
{
    "body": "<a id='comment:17'></a>\nOK, this is my analysis: at some point, the dokchitser `gp` script is really trying to compute a vector of length `348804762364674`. This obviously fails with a PARI stack overflow (this \"stack\" has nothing to do with the `ulimit -s` stack). As a result, Sage tries to increase `gp`'s memory with the `allocatemem()` command. But since this vector is really too big, it fails no matter how much memory is allocated. At some point, allocating more memory from the system fails and it seems that PARI/GP does not gracefully handle this out-of-memory condition.\n\nThe solution: upgrade PARI/GP.",
    "created_at": "2015-04-30T08:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322800",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
OK, this is my analysis: at some point, the dokchitser `gp` script is really trying to compute a vector of length `348804762364674`. This obviously fails with a PARI stack overflow (this "stack" has nothing to do with the `ulimit -s` stack). As a result, Sage tries to increase `gp`'s memory with the `allocatemem()` command. But since this vector is really too big, it fails no matter how much memory is allocated. At some point, allocating more memory from the system fails and it seems that PARI/GP does not gracefully handle this out-of-memory condition.

The solution: upgrade PARI/GP.



---

archive/issue_comments_322801.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,10 @@\n \n This happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)\n \n+This can be solved by upgrading PARI/GP.\n+\n+**Upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz)\n+\n ---\n \n See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion\n``````\n",
    "created_at": "2015-04-30T09:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322801",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,10 @@
 
 This happens in particular with GNU `make` < 3.82 due to [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010)
 
+This can be solved by upgrading PARI/GP.
+
+**Upstream**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.8-1545-gd04cdd3.tar.gz)
+
 ---
 
 See https://groups.google.com/d/topic/sage-devel/ydDfHsCxpAc/discussion
``````




---

archive/issue_comments_322802.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/if_given_unlimited_stack__gp_uses_it_all\"",
    "created_at": "2015-04-30T09:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322802",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/if_given_unlimited_stack__gp_uses_it_all"



---

archive/issue_comments_322803.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis fixes the issue, currently running `make ptestlong`.\n\n---\nNew commits:\n|                                                                                                                                          |                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[84ebf31](https://github.com/sagemath/sagetrac-mirror/commit/84ebf31d352e519253a07247c9fe2d3c3fa85b6a)|`Upgrade PARI/GP`|",
    "created_at": "2015-04-30T09:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
This fixes the issue, currently running `make ptestlong`.

---
New commits:
|                                                                                                                                          |                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[84ebf31](https://github.com/sagemath/sagetrac-mirror/commit/84ebf31d352e519253a07247c9fe2d3c3fa85b6a)|`Upgrade PARI/GP`|



---

archive/issue_comments_322804.json:
```json
{
    "body": "Changing commit from \"\" to \"84ebf31d352e519253a07247c9fe2d3c3fa85b6a\"",
    "created_at": "2015-04-30T09:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322804",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "84ebf31d352e519253a07247c9fe2d3c3fa85b6a"



---

archive/issue_comments_322805.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-30T09:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322805",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322806.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis is **not** floating point noise\n\n```diff\n sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')\n- 85.1885681951527\n+ 84.1818153922297\n```\nThe value of the integral computed with gsl is\n\n```\nsage: numerical_integral(sin(x)+sin(x^2)+x,0,13)\n(85.18856819515268, 1.3572929447036586e-09)\n```\nSo Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.",
    "created_at": "2015-04-30T10:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322806",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
This is **not** floating point noise

```diff
 sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')
- 85.1885681951527
+ 84.1818153922297
```
The value of the integral computed with gsl is

```
sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)
(85.18856819515268, 1.3572929447036586e-09)
```
So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.



---

archive/issue_comments_322807.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[da46c95](https://github.com/sagemath/sagetrac-mirror/commit/da46c953bd22e80790ec6437cfe529484c858dec)|`Auto-generated PARI files should depend on decl.pxi`|",
    "created_at": "2015-04-30T10:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[da46c95](https://github.com/sagemath/sagetrac-mirror/commit/da46c953bd22e80790ec6437cfe529484c858dec)|`Auto-generated PARI files should depend on decl.pxi`|



---

archive/issue_comments_322808.json:
```json
{
    "body": "Changing commit from \"84ebf31d352e519253a07247c9fe2d3c3fa85b6a\" to \"da46c953bd22e80790ec6437cfe529484c858dec\"",
    "created_at": "2015-04-30T10:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "84ebf31d352e519253a07247c9fe2d3c3fa85b6a" to "da46c953bd22e80790ec6437cfe529484c858dec"



---

archive/issue_comments_322809.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-30T10:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322809",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_322810.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2015-04-30T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322810",
    "user": "https://github.com/jdemeyer"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_comments_322811.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vdelecroix](#comment%3A21):\n> This is **not** floating point noise\n> \n> ```diff\n>  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')\n> - 85.1885681951527\n> + 84.1818153922297\n> ```\n> The value of the integral computed with gsl is\n> \n> ```\n> sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)\n> (85.18856819515268, 1.3572929447036586e-09)\n> ```\n> So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.\n\nIt's much worse. Note the `85` became `84`.",
    "created_at": "2015-04-30T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322811",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [vdelecroix](#comment%3A21):
> This is **not** floating point noise
> 
> ```diff
>  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')
> - 85.1885681951527
> + 84.1818153922297
> ```
> The value of the integral computed with gsl is
> 
> ```
> sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)
> (85.18856819515268, 1.3572929447036586e-09)
> ```
> So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.

It's much worse. Note the `85` became `84`.



---

archive/issue_comments_322812.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [jdemeyer](#comment%3A24):\n> Replying to [vdelecroix](#comment%3A21):\n> > This is **not** floating point noise\n> > \n> > ```diff\n> >  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')\n> > - 85.1885681951527\n> > + 84.1818153922297\n> > ```\n> > The value of the integral computed with gsl is\n> > \n> > ```\n> > sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)\n> > (85.18856819515268, 1.3572929447036586e-09)\n> > ```\n> > So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.\n\n> It's much worse. Note the `85` became `84`.\n\nIndeed! I can confirm the behavior on the freshly compiled pari master `development 17795-d04cdd3`.",
    "created_at": "2015-04-30T10:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322812",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
Replying to [jdemeyer](#comment%3A24):
> Replying to [vdelecroix](#comment%3A21):
> > This is **not** floating point noise
> > 
> > ```diff
> >  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')
> > - 85.1885681951527
> > + 84.1818153922297
> > ```
> > The value of the integral computed with gsl is
> > 
> > ```
> > sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)
> > (85.18856819515268, 1.3572929447036586e-09)
> > ```
> > So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.

> It's much worse. Note the `85` became `84`.

Indeed! I can confirm the behavior on the freshly compiled pari master `development 17795-d04cdd3`.



---

archive/issue_comments_322813.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [vdelecroix](#comment%3A25):\n> Replying to [jdemeyer](#comment%3A24):\n> > Replying to [vdelecroix](#comment%3A21):\n> > > This is **not** floating point noise\n> > > \n> > > ```diff\n> > >  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')\n> > > - 85.1885681951527\n> > > + 84.1818153922297\n> > > ```\n> > > The value of the integral computed with gsl is\n> > > \n> > > ```\n> > > sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)\n> > > (85.18856819515268, 1.3572929447036586e-09)\n> > > ```\n> > > So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.\n\n> > It's much worse. Note the `85` became `84`.\n> \n> Indeed! I can confirm the behavior on the freshly compiled pari master `development 17795-d04cdd3`.\n\n\nThis is rather disjoint from this ticket, I opened #18342 to track the issue.",
    "created_at": "2015-04-30T10:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322813",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
Replying to [vdelecroix](#comment%3A25):
> Replying to [jdemeyer](#comment%3A24):
> > Replying to [vdelecroix](#comment%3A21):
> > > This is **not** floating point noise
> > > 
> > > ```diff
> > >  sage: pari('intnum(x=0,13,sin(x)+sin(x^2) + x)')
> > > - 85.1885681951527
> > > + 84.1818153922297
> > > ```
> > > The value of the integral computed with gsl is
> > > 
> > > ```
> > > sage: numerical_integral(sin(x)+sin(x^2)+x,0,13)
> > > (85.18856819515268, 1.3572929447036586e-09)
> > > ```
> > > So Pari was right up to 10<sup>-11</sup> and now it gets down to 10<sup>-4</sup>. This is not acceptable.

> > It's much worse. Note the `85` became `84`.
> 
> Indeed! I can confirm the behavior on the freshly compiled pari master `development 17795-d04cdd3`.


This is rather disjoint from this ticket, I opened #18342 to track the issue.



---

archive/issue_comments_322814.json:
```json
{
    "body": "<a id='comment:27'></a>\nThere are also doctest failures in `src/sage/calculus/calculus.py` due to this.",
    "created_at": "2015-04-30T11:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322814",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
There are also doctest failures in `src/sage/calculus/calculus.py` due to this.



---

archive/issue_comments_322815.json:
```json
{
    "body": "Changing commit from \"da46c953bd22e80790ec6437cfe529484c858dec\" to \"23a01103840dd8dd37197f7a18c9b1ac8635bd47\"",
    "created_at": "2015-04-30T11:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da46c953bd22e80790ec6437cfe529484c858dec" to "23a01103840dd8dd37197f7a18c9b1ac8635bd47"



---

archive/issue_comments_322816.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[23a0110](https://github.com/sagemath/sagetrac-mirror/commit/23a01103840dd8dd37197f7a18c9b1ac8635bd47)|`Fix call to PARI qfminim() in shortest_vector()`|",
    "created_at": "2015-04-30T11:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[23a0110](https://github.com/sagemath/sagetrac-mirror/commit/23a01103840dd8dd37197f7a18c9b1ac8635bd47)|`Fix call to PARI qfminim() in shortest_vector()`|



---

archive/issue_comments_322817.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [jdemeyer](#comment%3A13):\n> What is the `ulimit -s` outside of `make`? I get\n> \n> ```\n> jdemeyer@tamiyo:~$ ulimit -s\n> 8192\n> ```\n> so if `make` changes that to `unlimited`, that's [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010) indeed.\n\n\nYep, missed that:  Outside of `make`, the stack size is (already) soft-limited to 8MB, which GNU make 3.81 in the distros resets to `unlimited`.\n\nThe original bug report was actually about the opposite:  Changing it from `unlimited` to some huge value.\n\nBut the real bug is that (the old) `make` touches the resource limits of (non-`make`) subprocesses at all.",
    "created_at": "2015-04-30T13:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322817",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Replying to [jdemeyer](#comment%3A13):
> What is the `ulimit -s` outside of `make`? I get
> 
> ```
> jdemeyer@tamiyo:~$ ulimit -s
> 8192
> ```
> so if `make` changes that to `unlimited`, that's [https://savannah.gnu.org/bugs/?22010](https://savannah.gnu.org/bugs/?22010) indeed.


Yep, missed that:  Outside of `make`, the stack size is (already) soft-limited to 8MB, which GNU make 3.81 in the distros resets to `unlimited`.

The original bug report was actually about the opposite:  Changing it from `unlimited` to some huge value.

But the real bug is that (the old) `make` touches the resource limits of (non-`make`) subprocesses at all.



---

archive/issue_comments_322818.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[11ce981](https://github.com/sagemath/sagetrac-mirror/commit/11ce9814729ea25384715b293ea3711f0354b6a2)|`More integration doctest fixes`|",
    "created_at": "2015-05-02T06:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[11ce981](https://github.com/sagemath/sagetrac-mirror/commit/11ce9814729ea25384715b293ea3711f0354b6a2)|`More integration doctest fixes`|



---

archive/issue_comments_322819.json:
```json
{
    "body": "Changing commit from \"23a01103840dd8dd37197f7a18c9b1ac8635bd47\" to \"11ce9814729ea25384715b293ea3711f0354b6a2\"",
    "created_at": "2015-05-02T06:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "23a01103840dd8dd37197f7a18c9b1ac8635bd47" to "11ce9814729ea25384715b293ea3711f0354b6a2"



---

archive/issue_comments_322820.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-02T06:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322820",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_058843.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "rename": {
        "from": "If given unlimited stack, gp uses it all",
        "to": "PARI/GP does not gracefully handle out-of-memory"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18340#event-58843"
}
```



---

archive/issue_comments_322821.json:
```json
{
    "body": "<a id='comment:33'></a>\nBut *\"PARI/GP does not gracefully handle out-of-memory\"* is *\"Fixed upstream, but not in a stable release\"*, right?",
    "created_at": "2015-05-02T15:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322821",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'></a>
But *"PARI/GP does not gracefully handle out-of-memory"* is *"Fixed upstream, but not in a stable release"*, right?



---

archive/issue_comments_322822.json:
```json
{
    "body": "Changing upstream from \"Not yet reported upstream; Will do shortly.\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2015-05-02T16:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322822",
    "user": "https://github.com/jdemeyer"
}
```

Changing upstream from "Not yet reported upstream; Will do shortly." to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_322823.json:
```json
{
    "body": "<a id='comment:35'></a>\nUsing bzip2 would save 0.5 MB... (2.9 MB vs. 3.4 MB)",
    "created_at": "2015-05-02T16:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322823",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
Using bzip2 would save 0.5 MB... (2.9 MB vs. 3.4 MB)



---

archive/issue_comments_322824.json:
```json
{
    "body": "<a id='comment:36'></a>\nWith Sage 6.7.beta3 and GCC 5.1.0 on Linux x86_64, PARI and eclib pass their test suites (Lcalc no longer has one), and ptestlong passes modulo one unrelated test (I already reported for 6.7.beta3 on sage-release).\n\nAlso\n\n```sh\n(ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py)\n```\nworks as expected.\n\nHaven't looked very closely at the patches though.\n\nThe changed behaviour of PARI's `intnum()` should IMHO be documented, on #18342, where also the doctest could be changed (not just its output).",
    "created_at": "2015-05-02T17:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322824",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:36'></a>
With Sage 6.7.beta3 and GCC 5.1.0 on Linux x86_64, PARI and eclib pass their test suites (Lcalc no longer has one), and ptestlong passes modulo one unrelated test (I already reported for 6.7.beta3 on sage-release).

Also

```sh
(ulimit -s unlimited; ./sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py)
```
works as expected.

Haven't looked very closely at the patches though.

The changed behaviour of PARI's `intnum()` should IMHO be documented, on #18342, where also the doctest could be changed (not just its output).



---

archive/issue_comments_322825.json:
```json
{
    "body": "<a id='comment:37'></a>\nP.S.:\n\nThese aren't new, i.e., no regression:\n\n```\n../src/modules/mpqs.c:376:16: warning: array subscript is above array bounds [-Warray-bounds]\n../src/modules/mpqs.c:378:22: warning: array subscript is above array bounds [-Warray-bounds]\n../src/modules/mpqs.c:380:24: warning: array subscript is above array bounds [-Warray-bounds]\n../src/modules/mpqs.c:380:24: warning: array subscript is above array bounds [-Warray-bounds]\n../src/modules/mpqs.c:381:14: warning: array subscript is above array bounds [-Warray-bounds]\n```",
    "created_at": "2015-05-02T17:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322825",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>
P.S.:

These aren't new, i.e., no regression:

```
../src/modules/mpqs.c:376:16: warning: array subscript is above array bounds [-Warray-bounds]
../src/modules/mpqs.c:378:22: warning: array subscript is above array bounds [-Warray-bounds]
../src/modules/mpqs.c:380:24: warning: array subscript is above array bounds [-Warray-bounds]
../src/modules/mpqs.c:380:24: warning: array subscript is above array bounds [-Warray-bounds]
../src/modules/mpqs.c:381:14: warning: array subscript is above array bounds [-Warray-bounds]
```



---

archive/issue_comments_322826.json:
```json
{
    "body": "<a id='comment:38'></a>\nOk, patches look reasonable as well.",
    "created_at": "2015-05-02T17:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322826",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
Ok, patches look reasonable as well.



---

archive/issue_comments_322827.json:
```json
{
    "body": "<a id='comment:39'></a>\nJust triggered a build on a (slow) x86 machine; this will presumably take at least half a day...",
    "created_at": "2015-05-02T21:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322827",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:39'></a>
Just triggered a build on a (slow) x86 machine; this will presumably take at least half a day...



---

archive/issue_comments_322828.json:
```json
{
    "body": "<a id='comment:40'></a>\nLooks good to me -- all tests pass (64 bit).  If Leif's test passes OK on a 32-bit machine let's approve this.  Thanks, Jeroen.",
    "created_at": "2015-05-03T10:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322828",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:40'></a>
Looks good to me -- all tests pass (64 bit).  If Leif's test passes OK on a 32-bit machine let's approve this.  Thanks, Jeroen.



---

archive/issue_comments_322829.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [leif](#comment%3A39):\n> Just triggered a build on a (slow) x86 machine; this will presumably take at least half a day...\n\n\nThat was probably an estimate for a few releases ago; the last test run is still in progress...",
    "created_at": "2015-05-03T22:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322829",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'></a>
Replying to [leif](#comment%3A39):
> Just triggered a build on a (slow) x86 machine; this will presumably take at least half a day...


That was probably an estimate for a few releases ago; the last test run is still in progress...



---

archive/issue_comments_322830.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-04T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322830",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_322831.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [leif](#comment%3A41):\n> Replying to [leif](#comment%3A39):\n> > Just triggered a build on a (slow) x86 machine; this will presumably take at least half a day...\n\n> \n> That was probably an estimate for a few releases ago; the last test run is still in progress...\n\n\nIt finally finished without errors.  (This was on a Pentium4 Prescott, Ubuntu 10.04.4, FSF GCC 4.8.2 with `-O3`, native build, FWIW.)\n\n\n\n\nI haven't tested building with FLTK, but it looks as if PARI's \"configure\" would meanwhile work.",
    "created_at": "2015-05-04T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322831",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:42'></a>
Replying to [leif](#comment%3A41):
> Replying to [leif](#comment%3A39):
> > Just triggered a build on a (slow) x86 machine; this will presumably take at least half a day...

> 
> That was probably an estimate for a few releases ago; the last test run is still in progress...


It finally finished without errors.  (This was on a Pentium4 Prescott, Ubuntu 10.04.4, FSF GCC 4.8.2 with `-O3`, native build, FWIW.)




I haven't tested building with FLTK, but it looks as if PARI's "configure" would meanwhile work.



---

archive/issue_comments_322832.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix, John Cremona, Leif Leonhardy\"",
    "created_at": "2015-05-04T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322832",
    "user": "https://github.com/nexttime"
}
```

Changing reviewer from "" to "Vincent Delecroix, John Cremona, Leif Leonhardy"



---

archive/issue_comments_322833.json:
```json
{
    "body": "<a id='comment:43'></a>\nOoops, just noticed `get_fltk.patch` should then also get removed from `patches/README.txt`, but that's really a minor issue.",
    "created_at": "2015-05-04T06:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322833",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Ooops, just noticed `get_fltk.patch` should then also get removed from `patches/README.txt`, but that's really a minor issue.



---

archive/issue_comments_322834.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-05-04T06:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_322835.json:
```json
{
    "body": "<a id='comment:44'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[5249809](https://github.com/sagemath/sagetrac-mirror/commit/5249809481c4366e0ea5f9efc0f89b27ce7bc7fd)|`Remove mention of get_fltk.patch`|",
    "created_at": "2015-05-04T06:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[5249809](https://github.com/sagemath/sagetrac-mirror/commit/5249809481c4366e0ea5f9efc0f89b27ce7bc7fd)|`Remove mention of get_fltk.patch`|



---

archive/issue_comments_322836.json:
```json
{
    "body": "Changing commit from \"11ce9814729ea25384715b293ea3711f0354b6a2\" to \"5249809481c4366e0ea5f9efc0f89b27ce7bc7fd\"",
    "created_at": "2015-05-04T06:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "11ce9814729ea25384715b293ea3711f0354b6a2" to "5249809481c4366e0ea5f9efc0f89b27ce7bc7fd"



---

archive/issue_comments_322837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-04T06:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322837",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_058844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-04T19:04:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18340#event-58844"
}
```



---

archive/issue_comments_322838.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/if_given_unlimited_stack__gp_uses_it_all\" to \"5249809481c4366e0ea5f9efc0f89b27ce7bc7fd\"",
    "created_at": "2015-05-04T19:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322838",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/if_given_unlimited_stack__gp_uses_it_all" to "5249809481c4366e0ea5f9efc0f89b27ce7bc7fd"



---

archive/issue_comments_322839.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-04T19:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18340#issuecomment-322839",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
