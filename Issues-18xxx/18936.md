# Issue 18936: Poset plot won't accept heights argument

archive/issues_018699.json:
```json
{
    "body": "The current code for plotting a ~~ranked~~ poset doesn't check if the argument heights is None before creating its own heights dictionary. It then passes this dictionary to the Graph plotting function, which throws \"TypeError: plot() got multiple values for keyword argument 'heights'\".\n\nCC:  @jm58660\n\nKeywords: Poset, plot\n\nBranch/Commit: cfdb3f61fda71d5fa91f18702939a3c474c1f1f0\n\nReviewer: Jori M\u00e4ntysalo\n\nAuthor: Robert Harron\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18936\n\n",
    "closed_at": "2015-12-28T11:08:05Z",
    "created_at": "2015-07-22T01:01:12Z",
    "labels": [
        "component: combinatorics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Poset plot won't accept heights argument",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18936",
    "user": "https://github.com/rharron"
}
```
The current code for plotting a ~~ranked~~ poset doesn't check if the argument heights is None before creating its own heights dictionary. It then passes this dictionary to the Graph plotting function, which throws "TypeError: plot() got multiple values for keyword argument 'heights'".

CC:  @jm58660

Keywords: Poset, plot

Branch/Commit: cfdb3f61fda71d5fa91f18702939a3c474c1f1f0

Reviewer: Jori MÃ¤ntysalo

Author: Robert Harron

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18936





---

archive/issue_comments_254606.json:
```json
{
    "body": "<a id='comment:1'></a>I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights=\"junk\")` gives same error.",
    "created_at": "2015-07-22T03:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254606",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:1'></a>I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights="junk")` gives same error.



---

archive/issue_comments_254607.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 jmantysalo]:\n> I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights=\"junk\")` gives same error.\n\n\nQuite right, I hadn't realized. But yeah the problem is that the heights keyword isn't popped off of kwds. I've been working on a fix and the first thing it does is pop heights off.",
    "created_at": "2015-07-22T03:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254607",
    "user": "https://github.com/rharron"
}
```

<a id='comment:2'></a>Replying to [comment:1 jmantysalo]:
> I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights="junk")` gives same error.


Quite right, I hadn't realized. But yeah the problem is that the heights keyword isn't popped off of kwds. I've been working on a fix and the first thing it does is pop heights off.



---

archive/issue_comments_254608.json:
```json
{
    "body": "<a id='comment:3'></a>What you actually want to do? Maybe something like\n\n```\ng = Posets.PentagonPoset()._hasse_diagram\ng.plot(save_pos=True, layout='acyclic')\ng.set_pos({0: [62, 18], 1: [27, (162+90)/2], 2: [94, 90], 3: [99, 162], 4: [63, 234]})\ng\n```",
    "created_at": "2015-07-22T03:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254608",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>What you actually want to do? Maybe something like

```
g = Posets.PentagonPoset()._hasse_diagram
g.plot(save_pos=True, layout='acyclic')
g.set_pos({0: [62, 18], 1: [27, (162+90)/2], 2: [94, 90], 3: [99, 162], 4: [63, 234]})
g
```



---

archive/issue_comments_254609.json:
```json
{
    "body": "<a id='comment:4'></a>About plotting in general: There is `element_labels` but `vertex_size`. Plotting poset is not fully \"poset-aware\". There are options that don't make sense, something like `xaxis`.\n\nAbout not ranked posets, an idea: Let us define `grank` for connected poset. First find (some) longest chain of poset and let it's elements have granks 0, 1, 2.... Now define grank of other elements so that they are average of distances to elements of the longest chain. If for example there is \"side-chain\" of element a and b from longesth paht grank element 2 to longest path grank element 6, then a will have grank ((2+1)+(6-2))/2 and b will have grank ((2+2)+(6-1))/2. And now set vertical position of elements according to grank.",
    "created_at": "2015-07-22T05:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254609",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>About plotting in general: There is `element_labels` but `vertex_size`. Plotting poset is not fully "poset-aware". There are options that don't make sense, something like `xaxis`.

About not ranked posets, an idea: Let us define `grank` for connected poset. First find (some) longest chain of poset and let it's elements have granks 0, 1, 2.... Now define grank of other elements so that they are average of distances to elements of the longest chain. If for example there is "side-chain" of element a and b from longesth paht grank element 2 to longest path grank element 6, then a will have grank ((2+1)+(6-2))/2 and b will have grank ((2+2)+(6-1))/2. And now set vertical position of elements according to grank.



---

archive/issue_comments_254610.json:
```json
{
    "body": "<a id='comment:5'></a>What I originally set out to do was plot the subgroup lattice of a group so that subgroups of the same order are at the same height. So, I created the subgroup poset and tried passing the appropriate height dictionary and came across the error this ticket is about.\n\nOf course, having fixed this problem, things still don't turn out so nicely since, for instance,\n\n```\nP = Poset([[1,2,3,4],[5],[5],[5],[5],[]])\nheights = {1:[0], 2:[1,2,3], 3:[4], 4:[5]}\nP.plot(heights=heights)\n```\n\ngives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?",
    "created_at": "2015-07-22T05:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254610",
    "user": "https://github.com/rharron"
}
```

<a id='comment:5'></a>What I originally set out to do was plot the subgroup lattice of a group so that subgroups of the same order are at the same height. So, I created the subgroup poset and tried passing the appropriate height dictionary and came across the error this ticket is about.

Of course, having fixed this problem, things still don't turn out so nicely since, for instance,

```
P = Poset([[1,2,3,4],[5],[5],[5],[5],[]])
heights = {1:[0], 2:[1,2,3], 3:[4], 4:[5]}
P.plot(heights=heights)
```

gives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?



---

archive/issue_comments_254611.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 robharron]:\n\n> gives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?\n\n\nAFAIK there is no good solution. There is some paper about drawing lattices, but Sage draws them just like all posets. And I have seen same problem, at least on https://groups.google.com/forum/#!search/Poset.show%28%29$20and$20symmetry/sage-support/-FGCEL0MJag/WZLONmtbBt0J I asked about something similar.\n\nI think that in general this is a hard problem. However, it should not be that hard to at least try arranging elements on same level to minimize this problem.",
    "created_at": "2015-07-22T06:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254611",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'></a>Replying to [comment:5 robharron]:

> gives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?


AFAIK there is no good solution. There is some paper about drawing lattices, but Sage draws them just like all posets. And I have seen same problem, at least on https://groups.google.com/forum/#!search/Poset.show%28%29$20and$20symmetry/sage-support/-FGCEL0MJag/WZLONmtbBt0J I asked about something similar.

I think that in general this is a hard problem. However, it should not be that hard to at least try arranging elements on same level to minimize this problem.



---

archive/issue_comments_254612.json:
```json
{
    "body": "<a id='comment:9'></a>Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.",
    "created_at": "2015-07-22T09:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254612",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.



---

archive/issue_comments_254613.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jmantysalo]:\n> Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.\n\n\nYeah, that's somewhat orthogonal to this ticket, though. The ticket here is about a fairly simple bug and I think the code I pushed fixes it, though I'm waiting for patchbot to do a full doctest. The example you mention is a problem with the plotting function of graphs, the only thing the poset plotting function does to heights is create a heights parameter from the poset rank function, if it exists.",
    "created_at": "2015-07-22T23:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254613",
    "user": "https://github.com/rharron"
}
```

<a id='comment:11'></a>Replying to [comment:9 jmantysalo]:
> Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.


Yeah, that's somewhat orthogonal to this ticket, though. The ticket here is about a fairly simple bug and I think the code I pushed fixes it, though I'm waiting for patchbot to do a full doctest. The example you mention is a problem with the plotting function of graphs, the only thing the poset plotting function does to heights is create a heights parameter from the poset rank function, if it exists.



---

archive/issue_comments_254614.json:
```json
{
    "body": "<a id='comment:12'></a>I think that this patch can go. You left it as new, not needs_review - are you planning some other changes?\n\nThe whole plot and (re)labeling is a mess. For example with this patch\n\n```\nP = Poset({0: [1,2], 1:[3]})\nP = P.relabel(lambda x: chr(ord('a')+x))\nheights = {1 : [0], 2 : [1], 3 : [2, 3]}\nP.plot(heights=heights)\n```\n\ngives `KeyError: 'a'`.",
    "created_at": "2015-08-17T16:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254614",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>I think that this patch can go. You left it as new, not needs_review - are you planning some other changes?

The whole plot and (re)labeling is a mess. For example with this patch

```
P = Poset({0: [1,2], 1:[3]})
P = P.relabel(lambda x: chr(ord('a')+x))
heights = {1 : [0], 2 : [1], 3 : [2, 3]}
P.plot(heights=heights)
```

gives `KeyError: 'a'`.



---

archive/issue_comments_254615.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 jmantysalo]:\n\nI left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?",
    "created_at": "2015-08-17T19:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254615",
    "user": "https://github.com/rharron"
}
```

<a id='comment:13'></a>Replying to [comment:12 jmantysalo]:

I left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?



---

archive/issue_comments_254616.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 robharron]:\n\n> I left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?\n\n\nI don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.",
    "created_at": "2015-08-17T20:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254616",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:14'></a>Replying to [comment:13 robharron]:

> I left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?


I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.



---

archive/issue_comments_254617.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 jmantysalo]:\n\n> I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.\n\n\nOkay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?",
    "created_at": "2015-08-17T20:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254617",
    "user": "https://github.com/rharron"
}
```

<a id='comment:15'></a>Replying to [comment:14 jmantysalo]:

> I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.


Okay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?



---

archive/issue_comments_254618.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 robharron]:\n> Replying to [comment:14 jmantysalo]:\n> \n> > I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.\n\n> \n> Okay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?\n\n\nI don't know about that.\n\nContrary to what I said I am now running tests *without* `dot2tex`. After this is done I should have time to installa `dot2tex` and run long tests on `posets/*` and all short tests. To me it is enought testing.\n\nI think that you can put this to needs_review. Then I'll mark this as positive_review, assuming the tests succeeded.",
    "created_at": "2015-08-18T05:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254618",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:16'></a>Replying to [comment:15 robharron]:
> Replying to [comment:14 jmantysalo]:
> 
> > I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.

> 
> Okay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?


I don't know about that.

Contrary to what I said I am now running tests *without* `dot2tex`. After this is done I should have time to installa `dot2tex` and run long tests on `posets/*` and all short tests. To me it is enought testing.

I think that you can put this to needs_review. Then I'll mark this as positive_review, assuming the tests succeeded.



---

archive/issue_comments_254619.json:
```json
{
    "body": "<a id='comment:17'></a>Tests passed. However, after installing `dot2tex` it does no difference to say `P.show(heights=heights)` or `P.show()`. I guess if suffices to document this -- in any case, Sage with this patch is better than Sage without this.",
    "created_at": "2015-08-18T07:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254619",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:17'></a>Tests passed. However, after installing `dot2tex` it does no difference to say `P.show(heights=heights)` or `P.show()`. I guess if suffices to document this -- in any case, Sage with this patch is better than Sage without this.



---

archive/issue_comments_254620.json:
```json
{
    "body": "<a id='comment:18'></a>Just pinging... If you change this to needs_review, I will change it to positive_review.\n\nYou can make a new ticket for `dot2tex` thing.",
    "created_at": "2015-09-18T09:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254620",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:18'></a>Just pinging... If you change this to needs_review, I will change it to positive_review.

You can make a new ticket for `dot2tex` thing.



---

archive/issue_comments_254621.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-18T23:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254621",
    "user": "https://github.com/rharron"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_254622.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-19T11:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254622",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254623.json:
```json
{
    "body": "<a id='comment:20'></a>Still passed tests.",
    "created_at": "2015-11-19T11:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254623",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:20'></a>Still passed tests.



---

archive/issue_comments_254624.json:
```json
{
    "body": "<a id='comment:21'></a>merge conflict, try with next beta",
    "created_at": "2015-11-19T16:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254624",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>merge conflict, try with next beta



---

archive/issue_comments_254625.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-11-19T16:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254625",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254626.json:
```json
{
    "body": "<a id='comment:23'></a>`robharron`, please check. I resolved the conflict.\n\n---\nNew commits:",
    "created_at": "2015-11-23T13:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254626",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:23'></a>`robharron`, please check. I resolved the conflict.

---
New commits:



---

archive/issue_events_052823.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-11-23T13:40:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18936#event-52823"
}
```



---

archive/issue_comments_254627.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-23T13:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254627",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254628.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-27T16:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254628",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_052824.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-28T11:08:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18936#event-52824"
}
```



---

archive/issue_comments_254629.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-28T11:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18936#issuecomment-254629",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
