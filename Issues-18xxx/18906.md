# Issue 18906: Refactor min spanning tree

archive/issues_018669.json:
```json
{
    "body": "CC:  @nathanncohen @dcoudert\n\nKeywords: Minimum spanning tree\n\nSolve some strange behaviors / bugs in minimum spanning tree routines.\n\nUsually, if the graph is weighted, the weight is ignored, and the `weight_function` argument is used. If this argument is not provided, the (rather counterintuitive) behavior is to set all weights to 1 (so that any spanning tree can be outputted). However, if Kruskal algorithm is used, and `check` is set to `True`, then edge weights are used, instead.\n\n```\nsage: g = Graph(weighted=True)\nsage: g.add_edges([[0,1,1],[1,2,1],[2,0,10]])\nsage: g.min_spanning_tree(algorithm='Kruskal')\n[(0, 1, 1), (0, 2, 10)]\nsage: g.min_spanning_tree(algorithm='Prim_fringe')\n[(0, 1), (0, 2)]\nsage: g.min_spanning_tree(algorithm='Prim_edge')\n[(0, 1, 1), (0, 2, 10)]\nsage: sage: g.min_spanning_tree(algorithm='Kruskal', check=True)\n[(0, 1, 1), (1, 2, 1)]\n\n```\nThis example also shows that the outputs are different.\n\nMoreover, NetworkX algorithm does not work:\n\n```\nsage: g.min_spanning_tree(algorithm='NetworkX')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-27-b461ae20ba97> in <module>()\n----> 1 g.min_spanning_tree(algorithm='NetworkX')\n\n/home/michele/Programmi/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in min_spanning_tree(self, weight_function, algorithm, starting_vertex, check)\n   3433             import networkx\n   3434             G = networkx.Graph([(u, v, dict(weight=weight_function((u, v)))) for u, v, l in self.edge_iterator()])\n-> 3435             return list(networkx.mst(G))\n   3436         else:\n   3437             raise NotImplementedError(\"Minimum Spanning Tree algorithm '%s' is not implemented.\" % algorithm)\n\nTypeError: 'module' object is not callable\n\n```\nThis ticket will change this behavior, by defining a specific order in the choice of weights:\n\n* if the function weight_function is provided, it is used as default;\n* if the function weight_function is None (default) and the graph is weighted, the edge weights are used;\n* otherwise, all weights are set to 1.\n\nMoreover, it will fix NetworkX problems, and it will standardize the output. \n\nFinally, it will modify Kruskal algorithm as follows:\n\n* now, the input can only be an undirected graph, so that the behavior is much more clear, and the documentation becomes much smaller;\n* we moved the code to remove self-loops and multiple edges in a separate routine, because it will be used by Boost.\n\nThis is a first step before the inclusion of Boost minimum spanning tree algorithms.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18906\n\n",
    "closed_at": "2015-07-27T15:15:49Z",
    "created_at": "2015-07-15T12:38:52Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Refactor min spanning tree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18906",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```
CC:  @nathanncohen @dcoudert

Keywords: Minimum spanning tree

Solve some strange behaviors / bugs in minimum spanning tree routines.

Usually, if the graph is weighted, the weight is ignored, and the `weight_function` argument is used. If this argument is not provided, the (rather counterintuitive) behavior is to set all weights to 1 (so that any spanning tree can be outputted). However, if Kruskal algorithm is used, and `check` is set to `True`, then edge weights are used, instead.

```
sage: g = Graph(weighted=True)
sage: g.add_edges([[0,1,1],[1,2,1],[2,0,10]])
sage: g.min_spanning_tree(algorithm='Kruskal')
[(0, 1, 1), (0, 2, 10)]
sage: g.min_spanning_tree(algorithm='Prim_fringe')
[(0, 1), (0, 2)]
sage: g.min_spanning_tree(algorithm='Prim_edge')
[(0, 1, 1), (0, 2, 10)]
sage: sage: g.min_spanning_tree(algorithm='Kruskal', check=True)
[(0, 1, 1), (1, 2, 1)]

```
This example also shows that the outputs are different.

Moreover, NetworkX algorithm does not work:

```
sage: g.min_spanning_tree(algorithm='NetworkX')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-27-b461ae20ba97> in <module>()
----> 1 g.min_spanning_tree(algorithm='NetworkX')

/home/michele/Programmi/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in min_spanning_tree(self, weight_function, algorithm, starting_vertex, check)
   3433             import networkx
   3434             G = networkx.Graph([(u, v, dict(weight=weight_function((u, v)))) for u, v, l in self.edge_iterator()])
-> 3435             return list(networkx.mst(G))
   3436         else:
   3437             raise NotImplementedError("Minimum Spanning Tree algorithm '%s' is not implemented." % algorithm)

TypeError: 'module' object is not callable

```
This ticket will change this behavior, by defining a specific order in the choice of weights:

* if the function weight_function is provided, it is used as default;
* if the function weight_function is None (default) and the graph is weighted, the edge weights are used;
* otherwise, all weights are set to 1.

Moreover, it will fix NetworkX problems, and it will standardize the output. 

Finally, it will modify Kruskal algorithm as follows:

* now, the input can only be an undirected graph, so that the behavior is much more clear, and the documentation becomes much smaller;
* we moved the code to remove self-loops and multiple edges in a separate routine, because it will be used by Boost.

This is a first step before the inclusion of Boost minimum spanning tree algorithms.

Issue created by migration from https://trac.sagemath.org/ticket/18906





---

archive/issue_comments_253974.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2015-07-15T13:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253974",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_253975.json:
```json
{
    "body": "Changing keywords from \"\" to \"Minimum spanning tree\".",
    "created_at": "2015-07-15T13:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253975",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing keywords from "" to "Minimum spanning tree".



---

archive/issue_comments_253976.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-07-15T13:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253976",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_253977.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-15T14:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253977",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_253978.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-07-15T14:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253978",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

New commits:



---

archive/issue_comments_253979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-15T15:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253980.json:
```json
{
    "body": "I like this patch, and I didn't know that it had bugs.\n\nWouldn't it be nicer if edges were sorted (including end-vertices) ? You could use e.g. `sorted( (u,v,l) if u<v else (v,u,l) for u,v,l in edges )`. It adds some computation time, but that would give an additional value (i.e., we can assume that...). In fact, I assume that some algorithms are already doing it. For others, it might be sufficient to add a test before inserting in list `edges`.",
    "created_at": "2015-07-15T16:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253980",
    "user": "https://github.com/dcoudert"
}
```

I like this patch, and I didn't know that it had bugs.

Wouldn't it be nicer if edges were sorted (including end-vertices) ? You could use e.g. `sorted( (u,v,l) if u<v else (v,u,l) for u,v,l in edges )`. It adds some computation time, but that would give an additional value (i.e., we can assume that...). In fact, I assume that some algorithms are already doing it. For others, it might be sufficient to add a test before inserting in list `edges`.



---

archive/issue_comments_253981.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-15T17:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253981",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253982.json:
```json
{
    "body": "Good to go.",
    "created_at": "2015-07-15T21:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253982",
    "user": "https://github.com/dcoudert"
}
```

Good to go.



---

archive/issue_comments_253983.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-15T21:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253983",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_253984.json:
```json
{
    "body": "Hello!\n\nI just realized I need some more modifications on the code to deal with multiple edges, before implementing the Boost version. I will submit the new version as soon as possible!\n\nSee you,\n\nMichele",
    "created_at": "2015-07-16T06:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253984",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

I just realized I need some more modifications on the code to deal with multiple edges, before implementing the Boost version. I will submit the new version as soon as possible!

See you,

Michele



---

archive/issue_comments_253985.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-07-16T06:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253985",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_253986.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-16T08:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253986",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253987.json:
```json
{
    "body": "Hello!\n\nI have made two more changes to the Kruskal algorithm, specified in the description:\n\n* now, the input can only be an undirected graph, so that the  behavior is much more clear, and the documentation becomes much smaller;\n* we moved the code to remove self-loops and multiple edges in a separate routine, because it will be used by Boost.\n\nSorry for the \"late\" decision, but I realized this was better only after I submitted the previous code.\n\nMichele",
    "created_at": "2015-07-16T08:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253987",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

I have made two more changes to the Kruskal algorithm, specified in the description:

* now, the input can only be an undirected graph, so that the  behavior is much more clear, and the documentation becomes much smaller;
* we moved the code to remove self-loops and multiple edges in a separate routine, because it will be used by Boost.

Sorry for the "late" decision, but I realized this was better only after I submitted the previous code.

Michele



---

archive/issue_comments_253988.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-16T08:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253988",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253989.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-16T08:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_253990.json:
```json
{
    "body": "There is no need for a new method `simplify` since we already have method `to_simple` in `generic_graph.py`.\nI however fully agree that the `to_simple` method is incorrect since it starts with `g=self.to_undirected()`... O_o\n\nThe best is to improve `to_simple`, and possibly also `allow_loops`, `allow_multiple_edges`, `remove_loops`, `multiple_edges`, etc. but first `to_simple`.",
    "created_at": "2015-07-16T11:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253990",
    "user": "https://github.com/dcoudert"
}
```

There is no need for a new method `simplify` since we already have method `to_simple` in `generic_graph.py`.
I however fully agree that the `to_simple` method is incorrect since it starts with `g=self.to_undirected()`... O_o

The best is to improve `to_simple`, and possibly also `allow_loops`, `allow_multiple_edges`, `remove_loops`, `multiple_edges`, etc. but first `to_simple`.



---

archive/issue_comments_253991.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-16T13:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253992.json:
```json
{
    "body": "> There is no need for a new method `simplify` since we already have method `to_simple` in `generic_graph.py`.\n\n\nYou are right: I removed the method, and I call the `to_simple` routine.\n\n> I however fully agree that the `to_simple` method is incorrect since it starts with `g=self.to_undirected()`... O_o\n> \n> The best is to improve `to_simple`, and possibly also `allow_loops`, `allow_multiple_edges`, `remove_loops`, `multiple_edges`, etc. but first `to_simple`.\n\n\nI have improved `to_simple` and `allow_multiple_edges`: the user can choose if the graph is converted to an undirected graph, and which label should be kept (the minimum, the maximum, or any label).",
    "created_at": "2015-07-16T14:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253992",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

> There is no need for a new method `simplify` since we already have method `to_simple` in `generic_graph.py`.


You are right: I removed the method, and I call the `to_simple` routine.

> I however fully agree that the `to_simple` method is incorrect since it starts with `g=self.to_undirected()`... O_o
> 
> The best is to improve `to_simple`, and possibly also `allow_loops`, `allow_multiple_edges`, `remove_loops`, `multiple_edges`, etc. but first `to_simple`.


I have improved `to_simple` and `allow_multiple_edges`: the user can choose if the graph is converted to an undirected graph, and which label should be kept (the minimum, the maximum, or any label).



---

archive/issue_comments_253993.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-16T14:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253994.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-16T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253994",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_253995.json:
```json
{
    "body": "It's much better now.\nI ran successfully `sage -t -l src/sage/graphs/` (except for the error solved in #18911)\nThe doc builds properly and looks good.\nThanks.",
    "created_at": "2015-07-16T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253995",
    "user": "https://github.com/dcoudert"
}
```

It's much better now.
I ran successfully `sage -t -l src/sage/graphs/` (except for the error solved in #18911)
The doc builds properly and looks good.
Thanks.



---

archive/issue_comments_253996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-27T15:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18906#issuecomment-253996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052772.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-27T15:15:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18906",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18906#event-52772"
}
```
