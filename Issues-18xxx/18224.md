# Issue 18224: Univariate g-algebras are broken

archive/issues_017987.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: singular, plural, g-algebra, gr\u00f6bner\n\nThis works:\n\n```\nsage: F.<x,y> = FreeAlgebra(QQ)\nsage: F.g_algebra({})\nNoncommutative Multivariate Polynomial Ring in x, y over Rational Field, nc-relations: {}\n```\n\nThis does not:\n\n```\nsage: F.<x> = FreeAlgebra(QQ)\nsage: F.g_algebra({})\n// ** commutative ring with 1 variable\nException KeyError: (The ring pointer -0x4f6e5368,) in 'sage.libs.singular.ring.singular_ring_delete' ignored\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-54-9d158958de5f> in <module>()\n----> 1 F.g_algebra({})\n\n/home/skraeling/sage/local/lib/python2.7/site-packages/sage/algebras/free_algebra.pyc in g_algebra(self, relations, names, order, check)\n    875         from sage.rings.polynomial.plural import g_Algebra\n    876         return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),\n--> 877                          order=order, check=check)\n    878 \n    879     def poincare_birkhoff_witt_basis(self):\n\n/home/skraeling/sage/src/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1291)()\n    364         key, kwds = self.create_key_and_extra_args(*args, **kwds)\n    365         version = self.get_version(sage_version)\n--> 366         return self.get_object(version, key, kwds)\n    367 \n    368     cpdef get_object(self, version, key, extra_args):\n\n/home/skraeling/sage/src/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:1665)()\n    408         except KeyError:\n    409             pass\n--> 410         obj = self.create_object(version, key, **extra_args)\n    411         self._cache[version, cache_key] = obj\n    412         try:\n\n/home/skraeling/sage/src/sage/rings/polynomial/plural.pyx in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:4621)()\n    171         base_ring,names,c,d,order,category = key\n    172         check = extra_args.get('check')\n--> 173         return NCPolynomialRing_plural(base_ring, names, c,d, order, category, check)\n    174     def create_key_and_extra_args(self, base_ring, c,d, names=None, order=None,\n    175                                  category=None,check=None):\n\n/home/skraeling/sage/src/sage/rings/polynomial/plural.pyx in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:5841)()\n    347         if check:\n    348             from sage.libs.singular.function_factory import ff\n--> 349             test = ff.nctools__lib.ndcond(ring = self)\n    350             if (len(test) != 1) or (test[0] != 0):\n    351                 raise ValueError(\"NDC check failed!\")\n\n/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:13927)()\n   1296                 isinstance(ring, NCPolynomialRing_plural)):\n   1297             raise TypeError(\"Cannot call Singular function '%s' with ring parameter of type '%s'\"%(self._name,type(ring)))\n-> 1298         return call_function(self, args, ring, interruptible, attributes)\n   1299 \n   1300     def _sage_doc_(self):\n\n/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:15723)()\n   1488             (self._name, \"\\n \".join(error_messages)))\n   1489 \n-> 1490     res = argument_list.to_python(_res)\n   1491 \n   1492     if self.call_handler.free_res():\n\n/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.Converter.to_python (build/cythonized/sage/libs/singular/function.cpp:11738)()\n    944         cdef Resolution res_resolution\n    945         if rtyp == IDEAL_CMD:\n--> 946             return singular_ideal_to_sage_sequence(<ideal*>to_convert.data, self._singular_ring, self._sage_ring)\n    947 \n    948         elif rtyp == POLY_CMD:\n\n/home/skraeling/sage/src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx in sage.rings.polynomial.multi_polynomial_ideal_libsingular.singular_ideal_to_sage_sequence (build/cythonized/sage/rings/polynomial/multi_polynomial_ideal_libsingular.cpp:3032)()\n    102     else:\n    103         for j from 0 <= j < IDELEMS(i):\n--> 104             p = new_MP(parent, p_Copy(i.m[j], r))\n    105             l.append( p )\n    106 \n\nTypeError: Cannot convert sage.rings.polynomial.plural.NCPolynomialRing_plural to sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular\n```\n\nThanks Travis for isolating this bug.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18224\n\n",
    "created_at": "2015-04-16T16:15:21Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Univariate g-algebras are broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18224",
    "user": "https://github.com/darijgr"
}
```
CC:  @tscrim

Keywords: singular, plural, g-algebra, gr√∂bner

This works:

```
sage: F.<x,y> = FreeAlgebra(QQ)
sage: F.g_algebra({})
Noncommutative Multivariate Polynomial Ring in x, y over Rational Field, nc-relations: {}
```

This does not:

```
sage: F.<x> = FreeAlgebra(QQ)
sage: F.g_algebra({})
// ** commutative ring with 1 variable
Exception KeyError: (The ring pointer -0x4f6e5368,) in 'sage.libs.singular.ring.singular_ring_delete' ignored
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-54-9d158958de5f> in <module>()
----> 1 F.g_algebra({})

/home/skraeling/sage/local/lib/python2.7/site-packages/sage/algebras/free_algebra.pyc in g_algebra(self, relations, names, order, check)
    875         from sage.rings.polynomial.plural import g_Algebra
    876         return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),
--> 877                          order=order, check=check)
    878 
    879     def poincare_birkhoff_witt_basis(self):

/home/skraeling/sage/src/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1291)()
    364         key, kwds = self.create_key_and_extra_args(*args, **kwds)
    365         version = self.get_version(sage_version)
--> 366         return self.get_object(version, key, kwds)
    367 
    368     cpdef get_object(self, version, key, extra_args):

/home/skraeling/sage/src/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:1665)()
    408         except KeyError:
    409             pass
--> 410         obj = self.create_object(version, key, **extra_args)
    411         self._cache[version, cache_key] = obj
    412         try:

/home/skraeling/sage/src/sage/rings/polynomial/plural.pyx in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:4621)()
    171         base_ring,names,c,d,order,category = key
    172         check = extra_args.get('check')
--> 173         return NCPolynomialRing_plural(base_ring, names, c,d, order, category, check)
    174     def create_key_and_extra_args(self, base_ring, c,d, names=None, order=None,
    175                                  category=None,check=None):

/home/skraeling/sage/src/sage/rings/polynomial/plural.pyx in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:5841)()
    347         if check:
    348             from sage.libs.singular.function_factory import ff
--> 349             test = ff.nctools__lib.ndcond(ring = self)
    350             if (len(test) != 1) or (test[0] != 0):
    351                 raise ValueError("NDC check failed!")

/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:13927)()
   1296                 isinstance(ring, NCPolynomialRing_plural)):
   1297             raise TypeError("Cannot call Singular function '%s' with ring parameter of type '%s'"%(self._name,type(ring)))
-> 1298         return call_function(self, args, ring, interruptible, attributes)
   1299 
   1300     def _sage_doc_(self):

/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:15723)()
   1488             (self._name, "\n ".join(error_messages)))
   1489 
-> 1490     res = argument_list.to_python(_res)
   1491 
   1492     if self.call_handler.free_res():

/home/skraeling/sage/src/sage/libs/singular/function.pyx in sage.libs.singular.function.Converter.to_python (build/cythonized/sage/libs/singular/function.cpp:11738)()
    944         cdef Resolution res_resolution
    945         if rtyp == IDEAL_CMD:
--> 946             return singular_ideal_to_sage_sequence(<ideal*>to_convert.data, self._singular_ring, self._sage_ring)
    947 
    948         elif rtyp == POLY_CMD:

/home/skraeling/sage/src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx in sage.rings.polynomial.multi_polynomial_ideal_libsingular.singular_ideal_to_sage_sequence (build/cythonized/sage/rings/polynomial/multi_polynomial_ideal_libsingular.cpp:3032)()
    102     else:
    103         for j from 0 <= j < IDELEMS(i):
--> 104             p = new_MP(parent, p_Copy(i.m[j], r))
    105             l.append( p )
    106 

TypeError: Cannot convert sage.rings.polynomial.plural.NCPolynomialRing_plural to sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular
```

Thanks Travis for isolating this bug.

Issue created by migration from https://trac.sagemath.org/ticket/18224


