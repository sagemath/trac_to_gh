# Issue 18739: Wrap PARI functions for converting relative number field elements

archive/issues_018502.json:
```json
{
    "body": "Wrap the PARI library functions `nf_rnfeq`, `eltabstorel`, `eltabstorel_lift` and `eltreltoabs`.  These provide a slightly lower-level interface to `rnfeltabstorel` and `rnfeltreltoabs`, and have the advantage that one can avoid initialising a full PARI `rnf` structure.  This functionality will be used in a follow-up ticket.\n\n**Keywords:** pari\n\n**Branch/Commit:** [5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\n\n**Author:** Peter Bruin\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18739\n\n",
    "closed_at": "2015-07-03T22:14:21Z",
    "created_at": "2015-06-19T19:21:49Z",
    "labels": [
        "component: interfaces",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Wrap PARI functions for converting relative number field elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18739",
    "user": "https://github.com/pjbruin"
}
```
Wrap the PARI library functions `nf_rnfeq`, `eltabstorel`, `eltabstorel_lift` and `eltreltoabs`.  These provide a slightly lower-level interface to `rnfeltabstorel` and `rnfeltreltoabs`, and have the advantage that one can avoid initialising a full PARI `rnf` structure.  This functionality will be used in a follow-up ticket.

**Keywords:** pari

**Branch/Commit:** [5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)

**Reviewer:** Frédéric Chapoton, Jeroen Demeyer

**Author:** Peter Bruin

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/18739





---

archive/issue_comments_333829.json:
```json
{
    "body": "**Branch:** [u/pbruin/18739-pari_rnf_conversion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18739-pari_rnf_conversion)",
    "created_at": "2015-06-19T19:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333829",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/18739-pari_rnf_conversion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18739-pari_rnf_conversion)



---

archive/issue_comments_333830.json:
```json
{
    "body": "**Commit:** [5055d694d750f40db8f931d12abcff0d74233ed5](https://github.com/sagemath/sagetrac-mirror/commit/5055d694d750f40db8f931d12abcff0d74233ed5)",
    "created_at": "2015-06-19T19:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333830",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [5055d694d750f40db8f931d12abcff0d74233ed5](https://github.com/sagemath/sagetrac-mirror/commit/5055d694d750f40db8f931d12abcff0d74233ed5)



---

archive/issue_comments_333831.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-06-19T19:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333831",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_333832.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good to me.\n\nI have used this opportunity to\n- correct one typo in the doc (missing `::`)\n- put all `raise` statements into python3 syntax.\n\nI you agree with these cosmetic changes, you can set a positive review on my behalf.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c\">566770a</a></td><td><code>Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00\">88fbd3d</a></td><td><code>trac #18379 doc typo in pari/gen</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303\">d27251d</a></td><td><code>trac #18739 raise into py3 syntax</code></td></tr></table>\n",
    "created_at": "2015-06-25T07:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333832",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
Looks good to me.

I have used this opportunity to
- correct one typo in the doc (missing `::`)
- put all `raise` statements into python3 syntax.

I you agree with these cosmetic changes, you can set a positive review on my behalf.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c">566770a</a></td><td><code>Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00">88fbd3d</a></td><td><code>trac #18379 doc typo in pari/gen</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303">d27251d</a></td><td><code>trac #18739 raise into py3 syntax</code></td></tr></table>




---

archive/issue_comments_333833.json:
```json
{
    "body": "**Changing commit** from \"[5055d694d750f40db8f931d12abcff0d74233ed5](https://github.com/sagemath/sagetrac-mirror/commit/5055d694d750f40db8f931d12abcff0d74233ed5)\" to \"[d27251de48beac243d5c3b1d8e6f4b607c375303](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)\".",
    "created_at": "2015-06-25T07:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333833",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[5055d694d750f40db8f931d12abcff0d74233ed5](https://github.com/sagemath/sagetrac-mirror/commit/5055d694d750f40db8f931d12abcff0d74233ed5)" to "[d27251de48beac243d5c3b1d8e6f4b607c375303](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)".



---

archive/issue_comments_333834.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2015-06-25T07:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333834",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_333835.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/18739-pari_rnf_conversion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18739-pari_rnf_conversion)\" to \"[public/ticket/18739](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/18739)\".",
    "created_at": "2015-06-25T07:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333835",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/pbruin/18739-pari_rnf_conversion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18739-pari_rnf_conversion)" to "[public/ticket/18739](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/18739)".



---

archive/issue_comments_333836.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think you can remove `__xor__` completely, since it's inherited from `Element`.",
    "created_at": "2015-06-25T07:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333836",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
I think you can remove `__xor__` completely, since it's inherited from `Element`.



---

archive/issue_comments_333837.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-06-25T07:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333837",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_333838.json:
```json
{
    "body": "<a id='comment:4'></a>\nThose functions you are adding should not be part of the public interface of `gen`, they are unsafe:\n\n```\nsage: pari(0).eltabstorel(0)\n...\nSignalError: Segmentation fault\n```\n\nIf you really want to add them to `gen`, add an underscore (`_eltabstorel` instead of `eltabstorel`) to the method name and add a `WARNING` in the documentation that these are unsafe.",
    "created_at": "2015-06-25T07:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333838",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Those functions you are adding should not be part of the public interface of `gen`, they are unsafe:

```
sage: pari(0).eltabstorel(0)
...
SignalError: Segmentation fault
```

If you really want to add them to `gen`, add an underscore (`_eltabstorel` instead of `eltabstorel`) to the method name and add a `WARNING` in the documentation that these are unsafe.



---

archive/issue_comments_333839.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Those functions you are adding should not be part of the public interface of `gen`, they are unsafe:\n> \n> ```\n> sage: pari(0).eltabstorel(0)\n> ...\n> SignalError: Segmentation fault\n> ```\n\nI can change this, but there are more methods like this:\n\n```\nsage: pari(0).pr_get_e()\n...\nSignalError: Segmentation fault\n```\nMaybe we should at some point make a better separation between functions that are also in GP (and do extra input checking) and PARI library functions (that crash when given wrong input).",
    "created_at": "2015-06-25T08:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333839",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
Replying to [jdemeyer](#comment%3A4):
> Those functions you are adding should not be part of the public interface of `gen`, they are unsafe:
> 
> ```
> sage: pari(0).eltabstorel(0)
> ...
> SignalError: Segmentation fault
> ```

I can change this, but there are more methods like this:

```
sage: pari(0).pr_get_e()
...
SignalError: Segmentation fault
```
Maybe we should at some point make a better separation between functions that are also in GP (and do extra input checking) and PARI library functions (that crash when given wrong input).



---

archive/issue_comments_333840.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [pbruin](#comment%3A5):\n> \n> ```\n> sage: pari(0).pr_get_e()\n> ...\n> SignalError: Segmentation fault\n> ```\n\nI consider this a bug.\n\nI think adding an underscore to all non-safe methods is an easy and good solution.",
    "created_at": "2015-06-25T08:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333840",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [pbruin](#comment%3A5):
> 
> ```
> sage: pari(0).pr_get_e()
> ...
> SignalError: Segmentation fault
> ```

I consider this a bug.

I think adding an underscore to all non-safe methods is an easy and good solution.



---

archive/issue_comments_333841.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d\">5373b8e</a></td><td><code>Trac 18739: reviewer comments</code></td></tr></table>\n",
    "created_at": "2015-07-01T22:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d">5373b8e</a></td><td><code>Trac 18739: reviewer comments</code></td></tr></table>




---

archive/issue_comments_333842.json:
```json
{
    "body": "**Changing commit** from \"[d27251de48beac243d5c3b1d8e6f4b607c375303](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)\" to \"[5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)\".",
    "created_at": "2015-07-01T22:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d27251de48beac243d5c3b1d8e6f4b607c375303](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)" to "[5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)".



---

archive/issue_comments_333843.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-07-01T22:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333843",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_333844.json:
```json
{
    "body": "**Changing reviewer** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\".",
    "created_at": "2015-07-01T22:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333844",
    "user": "https://github.com/pjbruin"
}
```

**Changing reviewer** from "Frédéric Chapoton" to "Frédéric Chapoton, Jeroen Demeyer".



---

archive/issue_comments_333845.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-07-02T08:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333845",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_333846.json:
```json
{
    "body": "<a id='comment:9'></a>\nPlease replace\n\n```\nThis method may raise errors or\nreturn undefined results if called with invalid arguments.\n```\nby\n\n```\nThis method may segfault or\nreturn undefined results if called with invalid arguments.\n```\n\nModulo this, I give the ticket positive_review.",
    "created_at": "2015-07-02T08:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333846",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Please replace

```
This method may raise errors or
return undefined results if called with invalid arguments.
```
by

```
This method may segfault or
return undefined results if called with invalid arguments.
```

Modulo this, I give the ticket positive_review.



---

archive/issue_comments_333847.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jdemeyer](#comment%3A9):\n> Please replace\n> \n> ```\n> This method may raise errors or\n> return undefined results if called with invalid arguments.\n> ```\n> by\n> \n> ```\n> This method may segfault or\n> return undefined results if called with invalid arguments.\n> ```\n\nI thought about phrasing it like that, but to me \"segfault\" (besides perhaps being somewhat cryptic to many users) makes it sound like Sage crashes if this is called with the wrong arguments.  In fact, the segmentation fault is caught and a `SignalError` is raised.  Also, it is entirely possible that PARI will throw other kinds of errors for certain inputs.",
    "created_at": "2015-07-02T20:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333847",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>
Replying to [jdemeyer](#comment%3A9):
> Please replace
> 
> ```
> This method may raise errors or
> return undefined results if called with invalid arguments.
> ```
> by
> 
> ```
> This method may segfault or
> return undefined results if called with invalid arguments.
> ```

I thought about phrasing it like that, but to me "segfault" (besides perhaps being somewhat cryptic to many users) makes it sound like Sage crashes if this is called with the wrong arguments.  In fact, the segmentation fault is caught and a `SignalError` is raised.  Also, it is entirely possible that PARI will throw other kinds of errors for certain inputs.



---

archive/issue_comments_333848.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-07-03T07:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333848",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_333849.json:
```json
{
    "body": "<a id='comment:11'></a>\nAfter some further thought, I still think \"raise errors\" is better than \"segfault\".  We could write a longer warning to explain what could happen on bad input, but I don't think it is worth the effort...",
    "created_at": "2015-07-03T07:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333849",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:11'></a>
After some further thought, I still think "raise errors" is better than "segfault".  We could write a longer warning to explain what could happen on bad input, but I don't think it is worth the effort...



---

archive/issue_comments_333850.json:
```json
{
    "body": "<a id='comment:12'></a>\nI still don't agree (whether or not Sage catches the segfault, it's still a segfault which should be avoided at all costs), but I won't obstruct...",
    "created_at": "2015-07-03T08:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333850",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
I still don't agree (whether or not Sage catches the segfault, it's still a segfault which should be avoided at all costs), but I won't obstruct...



---

archive/issue_comments_333851.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-07-03T08:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333851",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_333852.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-07-03T22:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333852",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_059662.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-03T22:14:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18739#event-59662"
}
```



---

archive/issue_comments_333853.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket/18739](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/18739)\" to \"[5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)\".",
    "created_at": "2015-07-03T22:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18739#issuecomment-333853",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ticket/18739](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/18739)" to "[5373b8eeeeca1aef7816c85ccdf36d576850375d](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)".
