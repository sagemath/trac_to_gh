# Issue 18834: Use Sage to compute clustering coefficient

archive/issues_018597.json:
```json
{
    "body": "Will have to be rebased+adapted over #18811.\n\n```\nsage: g = graphs.CompleteGraph(500)\nsage: %time _=g.clustering_coeff(implementation=\"boost\")\nCPU times: user 7.62 s, sys: 8 ms, total: 7.62 s\nWall time: 7.63 s\nsage: %time _=g.clustering_coeff()\nCPU times: user 340 ms, sys: 0 ns, total: 340 ms\nWall time: 328 ms\nsage: %time _=g.clustering_coeff(implementation=\"dense_copy\")\nCPU times: user 56 ms, sys: 4 ms, total: 60 ms\nWall time: 61.3 ms\n```\n\nDepends on #18811\n\n**CC:**  borassi @dcoudert\n\n**Branch/Commit:** [8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)\n\n**Reviewer:** David Coudert\n\n**Author:** Nathann Cohen\n\nIssue created by migration from https://trac.sagemath.org/ticket/18834\n\n",
    "closed_at": "2015-07-07T10:28:54Z",
    "created_at": "2015-07-01T12:48:41Z",
    "labels": [
        "component: graph theory",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "title": "Use Sage to compute clustering coefficient",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/18834",
    "user": "https://github.com/nathanncohen"
}
```
Will have to be rebased+adapted over #18811.

```
sage: g = graphs.CompleteGraph(500)
sage: %time _=g.clustering_coeff(implementation="boost")
CPU times: user 7.62 s, sys: 8 ms, total: 7.62 s
Wall time: 7.63 s
sage: %time _=g.clustering_coeff()
CPU times: user 340 ms, sys: 0 ns, total: 340 ms
Wall time: 328 ms
sage: %time _=g.clustering_coeff(implementation="dense_copy")
CPU times: user 56 ms, sys: 4 ms, total: 60 ms
Wall time: 61.3 ms
```

Depends on #18811

**CC:**  borassi @dcoudert

**Branch/Commit:** [8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)

**Reviewer:** David Coudert

**Author:** Nathann Cohen

Issue created by migration from https://trac.sagemath.org/ticket/18834





---

archive/issue_comments_265785.json:
```json
{
    "body": "**Branch:** [u/ncohen/18834](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/18834)",
    "created_at": "2015-07-01T12:48:57Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265785",
    "user": "https://github.com/nathanncohen"
}
```

**Branch:** [u/ncohen/18834](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/18834)



---

archive/issue_comments_265786.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275\">5a40d92</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>\n",
    "created_at": "2015-07-01T12:49:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275">5a40d92</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>




---

archive/issue_comments_265787.json:
```json
{
    "body": "**Commit:** [5a40d920d6a8c6585424329958b8b54a30c76275](https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275)",
    "created_at": "2015-07-01T12:49:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [5a40d920d6a8c6585424329958b8b54a30c76275](https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275)



---

archive/issue_events_169316.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-01T18:26:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18834#event-169316"
}
```



---

archive/issue_comments_265788.json:
```json
{
    "body": "**Author:** Nathann Cohen",
    "created_at": "2015-07-01T18:26:20Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265788",
    "user": "https://github.com/nathanncohen"
}
```

**Author:** Nathann Cohen



---

archive/issue_comments_265789.json:
```json
{
    "body": "**Changing commit** from \"[5a40d920d6a8c6585424329958b8b54a30c76275](https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275)\" to \"[dba89c2c25a22a1dd66e53abde9ae8e619723556](https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556)\".",
    "created_at": "2015-07-01T18:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5a40d920d6a8c6585424329958b8b54a30c76275](https://github.com/sagemath/sagetrac-mirror/commit/5a40d920d6a8c6585424329958b8b54a30c76275)" to "[dba89c2c25a22a1dd66e53abde9ae8e619723556](https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556)".



---

archive/issue_comments_265790.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/283c61be9357902ff555843b27c0ffed6fed6ea4\">283c61b</a></td><td><code>First draft</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18bd01ab82cf0b9d064d4fe680f17df908bed0da\">18bd01a</a></td><td><code>Applied Nathann's suggestions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99bd994335f70455d898c83f1a13b3d38e8f5064\">99bd994</a></td><td><code>Few corrections in the reference manual</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40df844cee8e59bc4bb57f5d7f4374e009053cb3\">40df844</a></td><td><code>trac #18811: Review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c8d49bc6d0101f897c489124d52c5e4a252a959\">6c8d49b</a></td><td><code>More reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556\">dba89c2</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>\n",
    "created_at": "2015-07-01T18:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/283c61be9357902ff555843b27c0ffed6fed6ea4">283c61b</a></td><td><code>First draft</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18bd01ab82cf0b9d064d4fe680f17df908bed0da">18bd01a</a></td><td><code>Applied Nathann's suggestions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99bd994335f70455d898c83f1a13b3d38e8f5064">99bd994</a></td><td><code>Few corrections in the reference manual</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40df844cee8e59bc4bb57f5d7f4374e009053cb3">40df844</a></td><td><code>trac #18811: Review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c8d49bc6d0101f897c489124d52c5e4a252a959">6c8d49b</a></td><td><code>More reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556">dba89c2</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>




---

archive/issue_comments_265791.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,14 @@\n Will have to be rebased+adapted over #18811.\n+\n+```\n+sage: g = graphs.CompleteGraph(500)\n+sage: %time _=g.clustering_coeff(implementation=\"boost\")\n+CPU times: user 7.62 s, sys: 8 ms, total: 7.62 s\n+Wall time: 7.63 s\n+sage: %time _=g.clustering_coeff()\n+CPU times: user 340 ms, sys: 0 ns, total: 340 ms\n+Wall time: 328 ms\n+sage: %time _=g.clustering_coeff(implementation=\"dense_copy\")\n+CPU times: user 56 ms, sys: 4 ms, total: 60 ms\n+Wall time: 61.3 ms\n+```\n``````\n",
    "created_at": "2015-07-01T20:27:21Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265791",
    "user": "https://github.com/nathanncohen"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,14 @@
 Will have to be rebased+adapted over #18811.
+
+```
+sage: g = graphs.CompleteGraph(500)
+sage: %time _=g.clustering_coeff(implementation="boost")
+CPU times: user 7.62 s, sys: 8 ms, total: 7.62 s
+Wall time: 7.63 s
+sage: %time _=g.clustering_coeff()
+CPU times: user 340 ms, sys: 0 ns, total: 340 ms
+Wall time: 328 ms
+sage: %time _=g.clustering_coeff(implementation="dense_copy")
+CPU times: user 56 ms, sys: 4 ms, total: 60 ms
+Wall time: 61.3 ms
+```
``````




---

archive/issue_comments_265792.json:
```json
{
    "body": "**Changing commit** from \"[dba89c2c25a22a1dd66e53abde9ae8e619723556](https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556)\" to \"[e25d6a4407c2c8cb5092fceed80ab86146134327](https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327)\".",
    "created_at": "2015-07-02T08:15:45Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dba89c2c25a22a1dd66e53abde9ae8e619723556](https://github.com/sagemath/sagetrac-mirror/commit/dba89c2c25a22a1dd66e53abde9ae8e619723556)" to "[e25d6a4407c2c8cb5092fceed80ab86146134327](https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327)".



---

archive/issue_comments_265793.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c365d0294528fac6b0487b48996da831efc96c44\">c365d02</a></td><td><code>Removed \"vertices is None\" from boost_clustering_coeff</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/582ce3466d9dff303532a84f9738cdd4f581d5a9\">582ce34</a></td><td><code>Changed for v in G.vertices() => for v in G</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327\">e25d6a4</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>\n",
    "created_at": "2015-07-02T08:15:45Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c365d0294528fac6b0487b48996da831efc96c44">c365d02</a></td><td><code>Removed "vertices is None" from boost_clustering_coeff</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/582ce3466d9dff303532a84f9738cdd4f581d5a9">582ce34</a></td><td><code>Changed for v in G.vertices() => for v in G</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327">e25d6a4</a></td><td><code>trac #18834: Use Sage to compute clustering coefficient</code></td></tr></table>




---

archive/issue_comments_265794.json:
```json
{
    "body": "<a id='comment:7'></a>\nrebased on top of #18811.",
    "created_at": "2015-07-02T08:16:09Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265794",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
rebased on top of #18811.



---

archive/issue_comments_265795.json:
```json
{
    "body": "<a id='comment:8'></a>\nFor me the patch is good to go (and the boost method is pretty fast in fact).\nHowever, the patch could be rebased on beta7 to solve the patchbot issue.",
    "created_at": "2015-07-03T16:41:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265795",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
For me the patch is good to go (and the boost method is pretty fast in fact).
However, the patch could be rebased on beta7 to solve the patchbot issue.



---

archive/issue_comments_265796.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826\">6274bff</a></td><td><code>trac #18834: Merged with 6.8.beta7</code></td></tr></table>\n",
    "created_at": "2015-07-03T17:07:14Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826">6274bff</a></td><td><code>trac #18834: Merged with 6.8.beta7</code></td></tr></table>




---

archive/issue_comments_265797.json:
```json
{
    "body": "**Changing commit** from \"[e25d6a4407c2c8cb5092fceed80ab86146134327](https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327)\" to \"[6274bff716b13f4ef7b3e1745d8dcbf761336826](https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826)\".",
    "created_at": "2015-07-03T17:07:14Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e25d6a4407c2c8cb5092fceed80ab86146134327](https://github.com/sagemath/sagetrac-mirror/commit/e25d6a4407c2c8cb5092fceed80ab86146134327)" to "[6274bff716b13f4ef7b3e1745d8dcbf761336826](https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826)".



---

archive/issue_comments_265798.json:
```json
{
    "body": "<a id='comment:10'></a>\nDone! But what do you mean by 'boost is pretty fast'?? Sage is 100x faster `O_o`",
    "created_at": "2015-07-03T17:08:03Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265798",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>
Done! But what do you mean by 'boost is pretty fast'?? Sage is 100x faster `O_o`



---

archive/issue_comments_265799.json:
```json
{
    "body": "<a id='comment:11'></a>\nOn a clique that's for sure, but on other kinds of graphs...\n\n```\nsage: g = graphs.RandomBarabasiAlbert(1000,2)\nsage: %timeit _=g.clustering_coeff(implementation=\"boost\")\n1000 loops, best of 3: 1.9 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"dense_copy\")\n100 loops, best of 3: 7.34 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"sparse_copy\")\n100 loops, best of 3: 13.9 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"networkx\")\n100 loops, best of 3: 19.3 ms per loop\n\nsage: g = graphs.RandomBarabasiAlbert(10000,2)\nsage: %timeit _=g.clustering_coeff(implementation=\"boost\")\n10 loops, best of 3: 38 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"dense_copy\")\n10 loops, best of 3: 143 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"sparse_copy\")\n10 loops, best of 3: 148 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"networkx\")\n1 loops, best of 3: 248 ms per loop\n```",
    "created_at": "2015-07-03T17:24:17Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265799",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:11'></a>
On a clique that's for sure, but on other kinds of graphs...

```
sage: g = graphs.RandomBarabasiAlbert(1000,2)
sage: %timeit _=g.clustering_coeff(implementation="boost")
1000 loops, best of 3: 1.9 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="dense_copy")
100 loops, best of 3: 7.34 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="sparse_copy")
100 loops, best of 3: 13.9 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="networkx")
100 loops, best of 3: 19.3 ms per loop

sage: g = graphs.RandomBarabasiAlbert(10000,2)
sage: %timeit _=g.clustering_coeff(implementation="boost")
10 loops, best of 3: 38 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="dense_copy")
10 loops, best of 3: 143 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="sparse_copy")
10 loops, best of 3: 148 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="networkx")
1 loops, best of 3: 248 ms per loop
```



---

archive/issue_comments_265800.json:
```json
{
    "body": "<a id='comment:12'></a>\nAlso, I have an issue:\n\n```\nsage: g = graphs.RandomGNP(1000,.1)\nsage: N = 1000\nsage: g = graphs.RandomGNP(N, log(N)/N)\nsage: g.order(), g.size()\n(1000, 3567)\nsage: %timeit _=g.clustering_coeff(implementation=\"boost\")\n100 loops, best of 3: 2.78 ms per loop\nsage: %timeit _=g.clustering_coeff(implementation=\"dense_copy\")\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n<ipython-input-31-cd519bf674aa> in <module>()\n----> 1 get_ipython().magic(u'timeit _=g.clustering_coeff(implementation=\"dense_copy\")')\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)\n   2305         magic_name, _, magic_arg_s = arg_s.partition(' ')\n   2306         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)\n-> 2307         return self.run_line_magic(magic_name, magic_arg_s)\n   2308 \n   2309     #-------------------------------------------------------------------------\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)\n   2226                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals\n   2227             with self.builtin_trap:\n-> 2228                 result = fn(*args,**kwargs)\n   2229             return result\n   2230 \n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, line, cell)\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)\n    191     # but it's overkill for just that one bit of state.\n    192     def magic_deco(arg):\n--> 193         call = lambda f, *a, **k: f(*a, **k)\n    194 \n    195         if callable(arg):\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, line, cell)\n   1034             number = 1\n   1035             for _ in range(1, 10):\n-> 1036                 time_number = timer.timeit(number)\n   1037                 worst_tuning = max(worst_tuning, time_number / number)\n   1038                 if time_number >= 0.2:\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, number)\n    130         gc.disable()\n    131         try:\n--> 132             timing = self.inner(it, self.timer)\n    133         finally:\n    134             if gcold:\n\n<magic-timeit> in inner(_it, _timer)\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in clustering_coeff(self, nodes, weight, implementation, return_vertex_weights)\n  12437             from sage.rings.integer import Integer\n  12438             return {v:Integer(count)/((self.degree(v)*(self.degree(v)-1))/2)\n> 12439                     for v,count in triangles_count(self).iteritems()}\n  12440 \n  12441     def cluster_transitivity(self):\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <dictcomp>((v, count))\n  12437             from sage.rings.integer import Integer\n  12438             return {v:Integer(count)/((self.degree(v)*(self.degree(v)-1))/2)\n> 12439                     for v,count in triangles_count(self).iteritems()}\n  12440 \n  12441     def cluster_transitivity(self):\n\n/Users/dcoudert/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (/Users/dcoudert/sage/src/build/cythonized/sage/structure/element.c:17310)()\n   1991         if have_same_parent_c(self, right):\n   1992             return (<RingElement>self)._div_(<RingElement>right)\n-> 1993         return coercion_model.bin_op(self, right, div)\n   1994 \n   1995     cpdef RingElement _div_(self, RingElement right):\n\n/Users/dcoudert/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/dcoudert/sage/src/build/cythonized/sage/structure/coerce.c:8195)()\n    994         try:\n    995             xy = self.canonical_coercion(x,y)\n--> 996             return PyObject_CallObject(op, xy)\n    997         except TypeError as err:\n    998             if xy is not None:\n\n/Users/dcoudert/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (/Users/dcoudert/sage/src/build/cythonized/sage/structure/element.c:17293)()\n   1990         \"\"\"\n   1991         if have_same_parent_c(self, right):\n-> 1992             return (<RingElement>self)._div_(<RingElement>right)\n   1993         return coercion_model.bin_op(self, right, div)\n   1994 \n\n/Users/dcoudert/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer._div_ (/Users/dcoudert/sage/src/build/cythonized/sage/rings/integer.c:11621)()\n   1728         # This is vastly faster than doing it here, since here\n   1729         # we can't cimport rationals.\n-> 1730         return the_integer_ring._div(self, right)\n   1731 \n   1732     def __floordiv__(x, y):\n\n/Users/dcoudert/sage/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (/Users/dcoudert/sage/src/build/cythonized/sage/rings/integer_ring.c:4894)()\n    420         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)\n    421         if mpz_sgn(right.value) == 0:\n--> 422             raise ZeroDivisionError('Rational division by zero')\n    423         mpz_set(mpq_numref(x.value), left.value)\n    424         mpz_set(mpq_denref(x.value), right.value)\n\nZeroDivisionError: Rational division by zero\n```\nI'll send you the graph by mail if you want to investigate.",
    "created_at": "2015-07-03T17:26:51Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265800",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>
Also, I have an issue:

```
sage: g = graphs.RandomGNP(1000,.1)
sage: N = 1000
sage: g = graphs.RandomGNP(N, log(N)/N)
sage: g.order(), g.size()
(1000, 3567)
sage: %timeit _=g.clustering_coeff(implementation="boost")
100 loops, best of 3: 2.78 ms per loop
sage: %timeit _=g.clustering_coeff(implementation="dense_copy")
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
<ipython-input-31-cd519bf674aa> in <module>()
----> 1 get_ipython().magic(u'timeit _=g.clustering_coeff(implementation="dense_copy")')

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)
   2305         magic_name, _, magic_arg_s = arg_s.partition(' ')
   2306         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)
-> 2307         return self.run_line_magic(magic_name, magic_arg_s)
   2308 
   2309     #-------------------------------------------------------------------------

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)
   2226                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals
   2227             with self.builtin_trap:
-> 2228                 result = fn(*args,**kwargs)
   2229             return result
   2230 

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, line, cell)

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)
    191     # but it's overkill for just that one bit of state.
    192     def magic_deco(arg):
--> 193         call = lambda f, *a, **k: f(*a, **k)
    194 
    195         if callable(arg):

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, line, cell)
   1034             number = 1
   1035             for _ in range(1, 10):
-> 1036                 time_number = timer.timeit(number)
   1037                 worst_tuning = max(worst_tuning, time_number / number)
   1038                 if time_number >= 0.2:

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in timeit(self, number)
    130         gc.disable()
    131         try:
--> 132             timing = self.inner(it, self.timer)
    133         finally:
    134             if gcold:

<magic-timeit> in inner(_it, _timer)

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in clustering_coeff(self, nodes, weight, implementation, return_vertex_weights)
  12437             from sage.rings.integer import Integer
  12438             return {v:Integer(count)/((self.degree(v)*(self.degree(v)-1))/2)
> 12439                     for v,count in triangles_count(self).iteritems()}
  12440 
  12441     def cluster_transitivity(self):

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in <dictcomp>((v, count))
  12437             from sage.rings.integer import Integer
  12438             return {v:Integer(count)/((self.degree(v)*(self.degree(v)-1))/2)
> 12439                     for v,count in triangles_count(self).iteritems()}
  12440 
  12441     def cluster_transitivity(self):

/Users/dcoudert/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (/Users/dcoudert/sage/src/build/cythonized/sage/structure/element.c:17310)()
   1991         if have_same_parent_c(self, right):
   1992             return (<RingElement>self)._div_(<RingElement>right)
-> 1993         return coercion_model.bin_op(self, right, div)
   1994 
   1995     cpdef RingElement _div_(self, RingElement right):

/Users/dcoudert/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/Users/dcoudert/sage/src/build/cythonized/sage/structure/coerce.c:8195)()
    994         try:
    995             xy = self.canonical_coercion(x,y)
--> 996             return PyObject_CallObject(op, xy)
    997         except TypeError as err:
    998             if xy is not None:

/Users/dcoudert/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (/Users/dcoudert/sage/src/build/cythonized/sage/structure/element.c:17293)()
   1990         """
   1991         if have_same_parent_c(self, right):
-> 1992             return (<RingElement>self)._div_(<RingElement>right)
   1993         return coercion_model.bin_op(self, right, div)
   1994 

/Users/dcoudert/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer._div_ (/Users/dcoudert/sage/src/build/cythonized/sage/rings/integer.c:11621)()
   1728         # This is vastly faster than doing it here, since here
   1729         # we can't cimport rationals.
-> 1730         return the_integer_ring._div(self, right)
   1731 
   1732     def __floordiv__(x, y):

/Users/dcoudert/sage/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (/Users/dcoudert/sage/src/build/cythonized/sage/rings/integer_ring.c:4894)()
    420         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)
    421         if mpz_sgn(right.value) == 0:
--> 422             raise ZeroDivisionError('Rational division by zero')
    423         mpz_set(mpq_numref(x.value), left.value)
    424         mpz_set(mpq_denref(x.value), right.value)

ZeroDivisionError: Rational division by zero
```
I'll send you the graph by mail if you want to investigate.



---

archive/issue_comments_265801.json:
```json
{
    "body": "<a id='comment:13'></a>\n> On a clique that's for sure, but on other kinds of graphs...\n\n\nOh.. Wow..\n\nHMmmm.. It seems that those graphs are stuffed with degree-2 vertices. I wonder how they do that `O_o`\n\nNathann",
    "created_at": "2015-07-03T17:29:44Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265801",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>
> On a clique that's for sure, but on other kinds of graphs...


Oh.. Wow..

HMmmm.. It seems that those graphs are stuffed with degree-2 vertices. I wonder how they do that `O_o`

Nathann



---

archive/issue_comments_265802.json:
```json
{
    "body": "<a id='comment:14'></a>\nI assume they iterate over the edges, which is what I would do on a sparse graph.",
    "created_at": "2015-07-03T17:31:00Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265802",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>
I assume they iterate over the edges, which is what I would do on a sparse graph.



---

archive/issue_comments_265803.json:
```json
{
    "body": "<a id='comment:15'></a>\nThey probably do a dichotomic search where I do a linear search. I'll try to see tomorrow evening (I will sleep in an airport) if I can do something about that.",
    "created_at": "2015-07-03T23:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265803",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'></a>
They probably do a dichotomic search where I do a linear search. I'll try to see tomorrow evening (I will sleep in an airport) if I can do something about that.



---

archive/issue_comments_265804.json:
```json
{
    "body": "**Changing commit** from \"[6274bff716b13f4ef7b3e1745d8dcbf761336826](https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826)\" to \"[a5b7092b804e504c0dd5487bc368cf9d54082e4e](https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e)\".",
    "created_at": "2015-07-04T20:48:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6274bff716b13f4ef7b3e1745d8dcbf761336826](https://github.com/sagemath/sagetrac-mirror/commit/6274bff716b13f4ef7b3e1745d8dcbf761336826)" to "[a5b7092b804e504c0dd5487bc368cf9d54082e4e](https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e)".



---

archive/issue_comments_265805.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e\">a5b7092</a></td><td><code>trac #18834: Division by zero</code></td></tr></table>\n",
    "created_at": "2015-07-04T20:48:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e">a5b7092</a></td><td><code>trac #18834: Division by zero</code></td></tr></table>




---

archive/issue_comments_265806.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce\">8c25063</a></td><td><code>trac #18834: Division by zero</code></td></tr></table>\n",
    "created_at": "2015-07-05T13:12:46Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce">8c25063</a></td><td><code>trac #18834: Division by zero</code></td></tr></table>




---

archive/issue_comments_265807.json:
```json
{
    "body": "**Changing commit** from \"[a5b7092b804e504c0dd5487bc368cf9d54082e4e](https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e)\" to \"[8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)\".",
    "created_at": "2015-07-05T13:12:46Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a5b7092b804e504c0dd5487bc368cf9d54082e4e](https://github.com/sagemath/sagetrac-mirror/commit/a5b7092b804e504c0dd5487bc368cf9d54082e4e)" to "[8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)".



---

archive/issue_comments_265808.json:
```json
{
    "body": "<a id='comment:18'></a>\nA more correct fix.\n\nAbout the difference in timings:\n\n```\nsage: g=graphs.RandomBarabasiAlbert(10000,2)\nsage: %timeit _ = g.clustering_coeff()\n10 loops, best of 3: 96.8 ms per loop\nsage: from sage.graphs.base.static_sparse_graph import triangles_count\nsage: %timeit _ = triangles_count(g)\n10 loops, best of 3: 70 ms per loop\n```\n\nIt seems that a nontrivial part of the difference in timing is taken by the construction of the.... final dictionary. Profiling the method does not show a major cost of the actual algorithm.. So well, it seems that this graph is so easy to deal with that returning the result is not negligible `:-P`\n\nNathann",
    "created_at": "2015-07-05T13:15:21Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265808",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>
A more correct fix.

About the difference in timings:

```
sage: g=graphs.RandomBarabasiAlbert(10000,2)
sage: %timeit _ = g.clustering_coeff()
10 loops, best of 3: 96.8 ms per loop
sage: from sage.graphs.base.static_sparse_graph import triangles_count
sage: %timeit _ = triangles_count(g)
10 loops, best of 3: 70 ms per loop
```

It seems that a nontrivial part of the difference in timing is taken by the construction of the.... final dictionary. Profiling the method does not show a major cost of the actual algorithm.. So well, it seems that this graph is so easy to deal with that returning the result is not negligible `:-P`

Nathann



---

archive/issue_comments_265809.json:
```json
{
    "body": "<a id='comment:19'></a>\nFor me the patch is now good to go!",
    "created_at": "2015-07-06T20:08:29Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265809",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>
For me the patch is now good to go!



---

archive/issue_comments_265810.json:
```json
{
    "body": "**Reviewer:** David Coudert",
    "created_at": "2015-07-06T20:08:29Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265810",
    "user": "https://github.com/dcoudert"
}
```

**Reviewer:** David Coudert



---

archive/issue_events_169317.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-07-06T20:08:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18834#event-169317"
}
```



---

archive/issue_events_169318.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-07-06T20:08:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18834#event-169318"
}
```



---

archive/issue_comments_265811.json:
```json
{
    "body": "<a id='comment:20'></a>\nThanks !\n\nNathann",
    "created_at": "2015-07-07T06:57:09Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265811",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:20'></a>
Thanks !

Nathann



---

archive/issue_events_169319.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-07T10:28:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18834#event-169319"
}
```



---

archive/issue_events_169320.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e8c5a2ac3e13c37f12ca616d7d800e05ffe70c9e",
    "created_at": "2015-07-07T10:28:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18834#event-169320"
}
```



---

archive/issue_comments_265812.json:
```json
{
    "body": "**Changing branch** from \"[u/ncohen/18834](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/18834)\" to \"[8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)\".",
    "created_at": "2015-07-07T10:28:54Z",
    "issue": "https://github.com/sagemath/sage/issues/18834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18834#issuecomment-265812",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/ncohen/18834](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/18834)" to "[8c25063de223a611c202d937d828c78cf0db8bce](https://github.com/sagemath/sagetrac-mirror/commit/8c25063de223a611c202d937d828c78cf0db8bce)".
