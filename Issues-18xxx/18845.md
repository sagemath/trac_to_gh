# Issue 18845: Update NTL to 9.2.0

archive/issues_018608.json:
```json
{
    "body": "See:\n* http://www.shoup.net/ntl/ntl-9.2.0.tar.gz\n\nLibtoolized tarball:\n* http://boxen.math.washington.edu/home/jpflori/upstream/ntl-9.2.0.tar.bz2\n\nCC:  @kiwifb @jdemeyer\n\nReviewer: Volker Braun\n\nAuthor: Jean-Pierre Flori\n\nBranch: 4fd99b370fca63dd04213519f614df7721314fba\n\nDependencies: #18866, #18867\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18845\n\n",
    "closed_at": "2015-07-09T19:55:55Z",
    "created_at": "2015-07-03T08:11:04Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Update NTL to 9.2.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18845",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
See:
* http://www.shoup.net/ntl/ntl-9.2.0.tar.gz

Libtoolized tarball:
* http://boxen.math.washington.edu/home/jpflori/upstream/ntl-9.2.0.tar.bz2

CC:  @kiwifb @jdemeyer

Reviewer: Volker Braun

Author: Jean-Pierre Flori

Branch: 4fd99b370fca63dd04213519f614df7721314fba

Dependencies: #18866, #18867

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18845





---

archive/issue_comments_269550.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,5 +1,8 @@\n See:\n * http://www.shoup.net/ntl/ntl-9.2.0.tar.gz\n+\n+Libtoolized tarball:\n+* http://boxen.math.washington.edu/home/jpflori/upstream/ntl-9.2.0.tar.bz2\n \n Comment: 1\n \n```\n",
    "created_at": "2015-07-03T08:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269550",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,5 +1,8 @@
 See:
 * http://www.shoup.net/ntl/ntl-9.2.0.tar.gz
+
+Libtoolized tarball:
+* http://boxen.math.washington.edu/home/jpflori/upstream/ntl-9.2.0.tar.bz2
 
 Comment: 1
 
```




---

archive/issue_comments_269551.json:
```json
{
    "body": "<a id='comment:2'></a>CCing s-o-g folk as they already worked hard to include an uptodate NTL there.",
    "created_at": "2015-07-03T08:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269551",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>CCing s-o-g folk as they already worked hard to include an uptodate NTL there.



---

archive/issue_comments_269552.json:
```json
{
    "body": "<a id='comment:3'></a>I've updated three fuzzy/failing patching.\n\nI've not touched the error callback patch which does not apply ass we have two solutions:\n* update our patch,\n* use the native NTL error callback mechanism, this can arguably be done elsewhere if the former solution is trivial.\n\nThere should still be trouble with flint, singular and friends.\nFrom what I read flint is fixed in git master.\nNo clear idea about Singular. From what I read there is a fix upstream, but is it available for 3.x as we are stuck with that at the moment, or only for 4.x?\n\n---\nNew commits:",
    "created_at": "2015-07-03T08:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269552",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>I've updated three fuzzy/failing patching.

I've not touched the error callback patch which does not apply ass we have two solutions:
* update our patch,
* use the native NTL error callback mechanism, this can arguably be done elsewhere if the former solution is trivial.

There should still be trouble with flint, singular and friends.
From what I read flint is fixed in git master.
No clear idea about Singular. From what I read there is a fix upstream, but is it available for 3.x as we are stuck with that at the moment, or only for 4.x?

---
New commits:



---

archive/issue_comments_269553.json:
```json
{
    "body": "<a id='comment:4'></a>`flint` will build against it but not `singular`, I am not even sure `singular-4` will. I would need to check my inbox from when we looked at it in Gentoo with the guy that bumped `ntl` to 9.x.",
    "created_at": "2015-07-03T09:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269553",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>`flint` will build against it but not `singular`, I am not even sure `singular-4` will. I would need to check my inbox from when we looked at it in Gentoo with the guy that bumped `ntl` to 9.x.



---

archive/issue_comments_269554.json:
```json
{
    "body": "<a id='comment:5'></a>`singular-4` has a fix in master: https://github.com/Singular/Sources/commit/de688442dfe449992dc14a000bca0691ecc7e106 that may be back portable.",
    "created_at": "2015-07-03T10:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269554",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>`singular-4` has a fix in master: https://github.com/Singular/Sources/commit/de688442dfe449992dc14a000bca0691ecc7e106 that may be back portable.



---

archive/issue_comments_269555.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 fbissey]:\n> `singular-4` has a fix in master: https://github.com/Singular/Sources/commit/de688442dfe449992dc14a000bca0691ecc7e106 that may be back portable.\n\nYes, it seems it just applies as is (with offset).",
    "created_at": "2015-07-06T14:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269555",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Replying to [comment:5 fbissey]:
> `singular-4` has a fix in master: https://github.com/Singular/Sources/commit/de688442dfe449992dc14a000bca0691ecc7e106 that may be back portable.

Yes, it seems it just applies as is (with offset).



---

archive/issue_comments_269556.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T15:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269557.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T16:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269558.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T17:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269559.json:
```json
{
    "body": "<a id='comment:10'></a>There is something wrong with my modifs to David's code.\nIf someone could have a look, nothing jumps to me now...",
    "created_at": "2015-07-06T21:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269559",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:10'></a>There is something wrong with my modifs to David's code.
If someone could have a look, nothing jumps to me now...



---

archive/issue_comments_269560.json:
```json
{
    "body": "<a id='comment:11'></a>My changes look pretty similar to the ones here:\n* https://vabs.archlinux-br.org/x86_64/community-testing/S/sagemath-6.7-2/ntl9.patch\nexcept for using `NTL::mulmod_t` instead of `NTL::wide_double`.",
    "created_at": "2015-07-06T21:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269560",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:11'></a>My changes look pretty similar to the ones here:
* https://vabs.archlinux-br.org/x86_64/community-testing/S/sagemath-6.7-2/ntl9.patch
except for using `NTL::mulmod_t` instead of `NTL::wide_double`.



---

archive/issue_comments_269561.json:
```json
{
    "body": "<a id='comment:12'></a>No idea what the difference is I am afraid.",
    "created_at": "2015-07-06T21:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269561",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>No idea what the difference is I am afraid.



---

archive/issue_comments_269562.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T21:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269563.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 fbissey]:\n> No idea what the difference is I am afraid.\n\nCould you test this on a usual arch?\nCurrently, I only have Sage installed on a POWER7...",
    "created_at": "2015-07-06T21:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269563",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:14'></a>Replying to [comment:12 fbissey]:
> No idea what the difference is I am afraid.

Could you test this on a usual arch?
Currently, I only have Sage installed on a POWER7...



---

archive/issue_comments_269564.json:
```json
{
    "body": "<a id='comment:15'></a>I'll have a look on my mac.",
    "created_at": "2015-07-06T21:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269564",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>I'll have a look on my mac.



---

archive/issue_comments_269565.json:
```json
{
    "body": "<a id='comment:16'></a>Taking longer than expected I wasn't completely up to date to beta7 (was on beta5). Will let you know when it is all done.",
    "created_at": "2015-07-06T22:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269565",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>Taking longer than expected I wasn't completely up to date to beta7 (was on beta5). Will let you know when it is all done.



---

archive/issue_comments_269566.json:
```json
{
    "body": "<a id='comment:17'></a>OK, I almost fell like I should have done a new build from scratch.\n\n```\nMirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/sage/rings/arith.py\nRunning doctests with ID 2015-07-07-17-26-18-c6eb7fbc.\nGit branch: ntl92\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file.\nsage -t --long --warn-long 34.4 src/sage/rings/arith.py\n**********************************************************************\nFile \"src/sage/rings/arith.py\", line 294, in sage.rings.arith.bernoulli\nFailed example:\n    union([len(union(x))==1 for x in vals])  # long time (depends on previous line)\nExpected:\n    [True]\nGot:\n    [False, True]\n**********************************************************************\nFile \"src/sage/rings/arith.py\", line 299, in sage.rings.arith.bernoulli\nFailed example:\n    union([len(union(x))==1 for x in vals])  # long time (depends on previous line)\nExpected:\n    [True]\nGot:\n    [False, True]\n**********************************************************************\n1 item had failures:\n   2 of  16 in sage.rings.arith.bernoulli\n    [785 tests, 2 failures, 51.51 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 34.4 src/sage/rings/arith.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 51.7 seconds\n    cpu time: 38.6 seconds\n    cumulative wall time: 51.5 seconds\nMirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx\nRunning doctests with ID 2015-07-07-19-02-38-d29775f0.\nGit branch: ntl92\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file.\nsage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx\n**********************************************************************\nFile \"src/sage/rings/bernmm.pyx\", line 68, in sage.rings.bernmm.bernmm_bern_rat\nFailed example:\n    lst1 == lst2\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/bernmm.pyx\", line 70, in sage.rings.bernmm.bernmm_bern_rat\nFailed example:\n    [ Zmod(101)(t) for t in lst1 ]\nExpected:\n    [77, 72, 89, 98, 86]\nGot:\n    [99, 0, 44, 42, 57]\n**********************************************************************\n1 item had failures:\n   2 of  13 in sage.rings.bernmm.bernmm_bern_rat\n    [23 tests, 2 failures, 0.79 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 1.2 seconds\n    cumulative wall time: 0.8 seconds\nMirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst\nRunning doctests with ID 2015-07-07-19-02-58-71d664dd.\nGit branch: ntl92\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file.\nsage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst\", line 212, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other\nWarning, slow doctest:\n    w2 = bernoulli(100000, algorithm='pari')   # long time (6s on sage.math, 2011)\nTest ran for 55.38 s\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst\", line 213, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other\nFailed example:\n    w1 == w2  # long time\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  42 in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other\n    [34 tests, 1 failure, 62.40 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 62.4 seconds\n    cpu time: 67.9 seconds\n    cumulative wall time: 62.4 seconds\n```",
    "created_at": "2015-07-07T07:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269566",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>OK, I almost fell like I should have done a new build from scratch.

```
Mirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/sage/rings/arith.py
Running doctests with ID 2015-07-07-17-26-18-c6eb7fbc.
Git branch: ntl92
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file.
sage -t --long --warn-long 34.4 src/sage/rings/arith.py
**********************************************************************
File "src/sage/rings/arith.py", line 294, in sage.rings.arith.bernoulli
Failed example:
    union([len(union(x))==1 for x in vals])  # long time (depends on previous line)
Expected:
    [True]
Got:
    [False, True]
**********************************************************************
File "src/sage/rings/arith.py", line 299, in sage.rings.arith.bernoulli
Failed example:
    union([len(union(x))==1 for x in vals])  # long time (depends on previous line)
Expected:
    [True]
Got:
    [False, True]
**********************************************************************
1 item had failures:
   2 of  16 in sage.rings.arith.bernoulli
    [785 tests, 2 failures, 51.51 s]
----------------------------------------------------------------------
sage -t --long --warn-long 34.4 src/sage/rings/arith.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 51.7 seconds
    cpu time: 38.6 seconds
    cumulative wall time: 51.5 seconds
Mirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx
Running doctests with ID 2015-07-07-19-02-38-d29775f0.
Git branch: ntl92
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file.
sage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx
**********************************************************************
File "src/sage/rings/bernmm.pyx", line 68, in sage.rings.bernmm.bernmm_bern_rat
Failed example:
    lst1 == lst2
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/bernmm.pyx", line 70, in sage.rings.bernmm.bernmm_bern_rat
Failed example:
    [ Zmod(101)(t) for t in lst1 ]
Expected:
    [77, 72, 89, 98, 86]
Got:
    [99, 0, 44, 42, 57]
**********************************************************************
1 item had failures:
   2 of  13 in sage.rings.bernmm.bernmm_bern_rat
    [23 tests, 2 failures, 0.79 s]
----------------------------------------------------------------------
sage -t --long --warn-long 34.4 src/sage/rings/bernmm.pyx  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 1.2 seconds
    cumulative wall time: 0.8 seconds
Mirage:sage-6.8.beta5 fbissey$ ./sage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst
Running doctests with ID 2015-07-07-19-02-58-71d664dd.
Git branch: ntl92
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file.
sage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst", line 212, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other
Warning, slow doctest:
    w2 = bernoulli(100000, algorithm='pari')   # long time (6s on sage.math, 2011)
Test ran for 55.38 s
**********************************************************************
File "src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst", line 213, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other
Failed example:
    w1 == w2  # long time
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  42 in doc.en.thematic_tutorials.explicit_methods_in_number_theory.birds_other
    [34 tests, 1 failure, 62.40 s]
----------------------------------------------------------------------
sage -t --long --warn-long 34.4 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/birds_other.rst  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 62.4 seconds
    cpu time: 67.9 seconds
    cumulative wall time: 62.4 seconds
```



---

archive/issue_comments_269567.json:
```json
{
    "body": "<a id='comment:18'></a>You get the same errors as I do.\n\nAnd I cannot get NTL to build with `NTL_LEGACY_SP_MULMOD=on` to check that the old `double` implem is still fine.\nBuild fails with `#if with no expression` just as in #3486 or https://groups.google.com/forum/#!topic/sage-devel/4r8HrQVOSe4",
    "created_at": "2015-07-07T10:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269567",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:18'></a>You get the same errors as I do.

And I cannot get NTL to build with `NTL_LEGACY_SP_MULMOD=on` to check that the old `double` implem is still fine.
Build fails with `#if with no expression` just as in #3486 or https://groups.google.com/forum/#!topic/sage-devel/4r8HrQVOSe4



---

archive/issue_comments_269568.json:
```json
{
    "body": "<a id='comment:19'></a>For info, the corresponding part of NTL doc is at:\n* http://www.shoup.net/ntl/doc/ZZ.cpp.html#modarith",
    "created_at": "2015-07-07T10:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269568",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>For info, the corresponding part of NTL doc is at:
* http://www.shoup.net/ntl/doc/ZZ.cpp.html#modarith



---

archive/issue_comments_269569.json:
```json
{
    "body": "<a id='comment:20'></a>My inability to try `NTL_LEGACY_SP_MULMOD` is caused by the fact that `InitSettings` does not build when it is set because of the typo:\n\n```\n static inline long MulMod2(long a, long b, long n, wide_double bninv)\n{\n   return MulMod2_legacy(a, b, n, ninv);\n}\n```",
    "created_at": "2015-07-07T10:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269569",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:20'></a>My inability to try `NTL_LEGACY_SP_MULMOD` is caused by the fact that `InitSettings` does not build when it is set because of the typo:

```
 static inline long MulMod2(long a, long b, long n, wide_double bninv)
{
   return MulMod2_legacy(a, b, n, ninv);
}
```



---

archive/issue_comments_269570.json:
```json
{
    "body": "<a id='comment:21'></a>Upstream bug then.",
    "created_at": "2015-07-07T10:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269570",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>Upstream bug then.



---

archive/issue_comments_269571.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T11:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269572.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 fbissey]:\n> Upstream bug then.\n\nSure, I just sent a report to Victor Shoup.\n\nNote that it does not explain the failure in `bernmm` code with the new sp implem in (new) NTL.\nIt will just allow us to check that `bernmm` works as expected with the old sp implem in (new) NTL.",
    "created_at": "2015-07-07T11:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269572",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:23'></a>Replying to [comment:21 fbissey]:
> Upstream bug then.

Sure, I just sent a report to Victor Shoup.

Note that it does not explain the failure in `bernmm` code with the new sp implem in (new) NTL.
It will just allow us to check that `bernmm` works as expected with the old sp implem in (new) NTL.



---

archive/issue_comments_269573.json:
```json
{
    "body": "<a id='comment:24'></a>And it works just fine.\n\nYou can try NTL built with the legacy sp implem at `u/jpflori/ticket/18845legacy`.",
    "created_at": "2015-07-07T11:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269573",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>And it works just fine.

You can try NTL built with the legacy sp implem at `u/jpflori/ticket/18845legacy`.



---

archive/issue_comments_269574.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 jpflori]:\n> Replying to [comment:21 fbissey]:\n> > Upstream bug then.\n\n> Sure, I just sent a report to Victor Shoup.\n> \n\nAnd he will fix it asap.",
    "created_at": "2015-07-07T11:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269574",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:25'></a>Replying to [comment:23 jpflori]:
> Replying to [comment:21 fbissey]:
> > Upstream bug then.

> Sure, I just sent a report to Victor Shoup.
> 

And he will fix it asap.



---

archive/issue_comments_269575.json:
```json
{
    "body": "<a id='comment:26'></a>Do you think you can fix the `bernmm` problem? If not, using the old the \"legacy\" implementation is better than not merging this ticket.",
    "created_at": "2015-07-07T12:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269575",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>Do you think you can fix the `bernmm` problem? If not, using the old the "legacy" implementation is better than not merging this ticket.



---

archive/issue_comments_269576.json:
```json
{
    "body": "<a id='comment:27'></a>If this is true:\n\n```\nNTL provides its own error callback framework\n```\nwe should use it.",
    "created_at": "2015-07-07T12:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269576",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>If this is true:

```
NTL provides its own error callback framework
```
we should use it.



---

archive/issue_comments_269577.json:
```json
{
    "body": "<a id='comment:28'></a>OK, we still need the patch to the callback, but not for the reason stated. So, please\nreplace\n\n```\nNTL provides its own error callback framework, but it is simpler\nthan the one provided by this patch: there is no context object.\n```\nby\n\n```\nNTL provides its own error callback framework, but it's not suitable\nfor Sage since we don't want to see the error message printed, we want\nthe error message to be part of the callback function.\n```",
    "created_at": "2015-07-07T12:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269577",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>OK, we still need the patch to the callback, but not for the reason stated. So, please
replace

```
NTL provides its own error callback framework, but it is simpler
than the one provided by this patch: there is no context object.
```
by

```
NTL provides its own error callback framework, but it's not suitable
for Sage since we don't want to see the error message printed, we want
the error message to be part of the callback function.
```



---

archive/issue_comments_269578.json:
```json
{
    "body": "<a id='comment:29'></a>I just sent an e-mail to Shoup about the callback function.",
    "created_at": "2015-07-07T12:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269578",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>I just sent an e-mail to Shoup about the callback function.



---

archive/issue_comments_269579.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:26 jdemeyer]:\n> Do you think you can fix the `bernmm` problem? If not, using the old the \"legacy\" implementation is better than not merging this ticket.\n\nI'd say not quickly and I'm away for one week starting tonight.\n\nI really have no idea why it does not work with the current patch.\nThe only way I see to understand this is to print everything bern_modp does to find the problem.\nA small couple of problematic values is `k = 128` and `p = 7` (or another small prime).\n\nSo unless you see some obvious mistake in what I did, we can postpone the use of the new (and recommended upstream) sp implem for later.\nWe'll just need to remove one line in `spkg-install`.",
    "created_at": "2015-07-07T13:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269579",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:30'></a>Replying to [comment:26 jdemeyer]:
> Do you think you can fix the `bernmm` problem? If not, using the old the "legacy" implementation is better than not merging this ticket.

I'd say not quickly and I'm away for one week starting tonight.

I really have no idea why it does not work with the current patch.
The only way I see to understand this is to print everything bern_modp does to find the problem.
A small couple of problematic values is `k = 128` and `p = 7` (or another small prime).

So unless you see some obvious mistake in what I did, we can postpone the use of the new (and recommended upstream) sp implem for later.
We'll just need to remove one line in `spkg-install`.



---

archive/issue_comments_269580.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:29 jdemeyer]:\n> I just sent an e-mail to Shoup about the callback function.\n\nThanks, I already mentioned that twice during our exchanges with Shoup but never really explained to him the difference between our and his error callback.\n\nIf by any chance you know why the `C++ new` patch for Singular is needed, I'd be happy you tell Shoup and I.",
    "created_at": "2015-07-07T13:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269580",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:31'></a>Replying to [comment:29 jdemeyer]:
> I just sent an e-mail to Shoup about the callback function.

Thanks, I already mentioned that twice during our exchanges with Shoup but never really explained to him the difference between our and his error callback.

If by any chance you know why the `C++ new` patch for Singular is needed, I'd be happy you tell Shoup and I.



---

archive/issue_comments_269581.json:
```json
{
    "body": "<a id='comment:32'></a>Also note that NTL now provides exception handling though I've not activated it here.",
    "created_at": "2015-07-07T13:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269581",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:32'></a>Also note that NTL now provides exception handling though I've not activated it here.



---

archive/issue_comments_269582.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T13:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269583.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:28 jdemeyer]:\n> OK, we still need the patch to the callback, but not for the reason stated. So, please\n> replace\n> \n> ```\n> NTL provides its own error callback framework, but it is simpler\n> than the one provided by this patch: there is no context object.\n> ```\n> by\n> \n> ```\n> NTL provides its own error callback framework, but it's not suitable\n> for Sage since we don't want to see the error message printed, we want\n> the error message to be part of the callback function.\n> ```\n\nDone.\n\nI've also merged the changes from the legacy branch.",
    "created_at": "2015-07-07T13:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269583",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:34'></a>Replying to [comment:28 jdemeyer]:
> OK, we still need the patch to the callback, but not for the reason stated. So, please
> replace
> 
> ```
> NTL provides its own error callback framework, but it is simpler
> than the one provided by this patch: there is no context object.
> ```
> by
> 
> ```
> NTL provides its own error callback framework, but it's not suitable
> for Sage since we don't want to see the error message printed, we want
> the error message to be part of the callback function.
> ```

Done.

I've also merged the changes from the legacy branch.



---

archive/issue_comments_269584.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T13:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269585.json:
```json
{
    "body": "<a id='comment:36'></a>Shoup answered that he will update the callback function such that it will be good enough for Sage.",
    "created_at": "2015-07-07T13:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269585",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Shoup answered that he will update the callback function such that it will be good enough for Sage.



---

archive/issue_comments_269586.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-07T15:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269586",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_269587.json:
```json
{
    "body": "<a id='comment:38'></a>\n```\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-config/src/doc/common/builder.py\", line 1619, in <module>\n    import sage.all\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/all.py\", line 103, in <module>\n    import sage.symbolic.pynac\nImportError: /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/pynac.so: undefined symbol: _ZN3NTL5ErrorEPKc\n```",
    "created_at": "2015-07-07T17:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269587",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
```
Traceback (most recent call last):
  File "/usr/local/src/sage-config/src/doc/common/builder.py", line 1619, in <module>
    import sage.all
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/all.py", line 103, in <module>
    import sage.symbolic.pynac
ImportError: /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/pynac.so: undefined symbol: _ZN3NTL5ErrorEPKc
```



---

archive/issue_comments_269588.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-07T17:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269588",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_269589.json:
```json
{
    "body": "<a id='comment:39'></a>It's a dependency problem: that module should depend on NTL, but it doesn't.",
    "created_at": "2015-07-07T17:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269589",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>It's a dependency problem: that module should depend on NTL, but it doesn't.



---

archive/issue_comments_269590.json:
```json
{
    "body": "<a id='comment:40'></a>Strange:\n\n```\n[sage.git]$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath Version 6.8.beta7, Release Date: 2015-07-02               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: import sage.symbolic.pynac\nsage:\n```\nand\n\n```\n[sage.git]$ nm local/lib/python/site-packages/sage/symbolic/pynac.so |grep NTL\n000000000000c610 t 00000058.plt_call._ZN3NTL13TerminalErrorEPKc+0\n000000000000d088 t 00000058.plt_call._ZN3NTL14BlockConstructEPNS_4ZZ_pEl+0\n000000000000ca20 t 00000058.plt_call._ZN3NTL3VecINS_4ZZ_pEE10AllocateToEl+0\n000000000000c7a0 t 00000058.plt_call._ZN3NTL3VecINS_5ZZ_pEEE10AllocateToEl+0\n000000000000d074 t 00000058.plt_call._ZN3NTL5ZZ_pX9normalizeEv+0\n000000000000c55c t 00000058.plt_call._ZN3NTL6ZZ_pEX9normalizeEv+0\n000000000000c764 t 00000058.plt_call._ZNK3NTL11ZZ_pContext7restoreEv+0\n0000000000078cf0 D _Z19ZZ_pEX_conv_modulusRN3NTL6ZZ_pEXERKS0_RKNS_11ZZ_pContextE\n                 U _ZN3NTL13TerminalErrorEPKc\n                 U _ZN3NTL14BlockConstructEPNS_4ZZ_pEl\n0000000000078cd0 W _ZN3NTL3VecINS_4ZZ_pEE10AllocateToEl\n0000000000078ce0 W _ZN3NTL3VecINS_5ZZ_pEEE10AllocateToEl\n                 U _ZN3NTL5ZZ_pX9normalizeEv\n                 U _ZN3NTL6ZZ_pEX9normalizeEv\n                 U _ZN3NTL8ZZ_pInfoE\n                 U _ZNK3NTL11ZZ_pContext7restoreEv\n```\n\nPlain `Error` does not exist anymore in NTL 9.x.",
    "created_at": "2015-07-07T17:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269590",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:40'></a>Strange:

```
[sage.git]$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath Version 6.8.beta7, Release Date: 2015-07-02               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: import sage.symbolic.pynac
sage:
```
and

```
[sage.git]$ nm local/lib/python/site-packages/sage/symbolic/pynac.so |grep NTL
000000000000c610 t 00000058.plt_call._ZN3NTL13TerminalErrorEPKc+0
000000000000d088 t 00000058.plt_call._ZN3NTL14BlockConstructEPNS_4ZZ_pEl+0
000000000000ca20 t 00000058.plt_call._ZN3NTL3VecINS_4ZZ_pEE10AllocateToEl+0
000000000000c7a0 t 00000058.plt_call._ZN3NTL3VecINS_5ZZ_pEEE10AllocateToEl+0
000000000000d074 t 00000058.plt_call._ZN3NTL5ZZ_pX9normalizeEv+0
000000000000c55c t 00000058.plt_call._ZN3NTL6ZZ_pEX9normalizeEv+0
000000000000c764 t 00000058.plt_call._ZNK3NTL11ZZ_pContext7restoreEv+0
0000000000078cf0 D _Z19ZZ_pEX_conv_modulusRN3NTL6ZZ_pEXERKS0_RKNS_11ZZ_pContextE
                 U _ZN3NTL13TerminalErrorEPKc
                 U _ZN3NTL14BlockConstructEPNS_4ZZ_pEl
0000000000078cd0 W _ZN3NTL3VecINS_4ZZ_pEE10AllocateToEl
0000000000078ce0 W _ZN3NTL3VecINS_5ZZ_pEEE10AllocateToEl
                 U _ZN3NTL5ZZ_pX9normalizeEv
                 U _ZN3NTL6ZZ_pEX9normalizeEv
                 U _ZN3NTL8ZZ_pInfoE
                 U _ZNK3NTL11ZZ_pContext7restoreEv
```

Plain `Error` does not exist anymore in NTL 9.x.



---

archive/issue_comments_269591.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:39 jdemeyer]:\n> It's a dependency problem: that module should depend on NTL, but it doesn't.\n\nI see.\nCan you fix this or should I do it?",
    "created_at": "2015-07-07T17:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269591",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:41'></a>Replying to [comment:39 jdemeyer]:
> It's a dependency problem: that module should depend on NTL, but it doesn't.

I see.
Can you fix this or should I do it?



---

archive/issue_comments_269592.json:
```json
{
    "body": "<a id='comment:42'></a>Hmm, it's strange that this module isn't actually linked against `ntl`:\n\n```\ng++ -pthread -shared -L/usr/local/src/sage-config/local/lib build/temp.linux-x86_64-2.7/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/pynac.o -L/usr/local/src/sage-config/local/lib -L/usr/local/src/sage-config/local/lib -lgsl -lgmp -lcblas -latlas -lpynac -lstdc++ -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/symbolic/pynac.so\n```",
    "created_at": "2015-07-07T17:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269592",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>Hmm, it's strange that this module isn't actually linked against `ntl`:

```
g++ -pthread -shared -L/usr/local/src/sage-config/local/lib build/temp.linux-x86_64-2.7/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/pynac.o -L/usr/local/src/sage-config/local/lib -L/usr/local/src/sage-config/local/lib -lgsl -lgmp -lcblas -latlas -lpynac -lstdc++ -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/symbolic/pynac.so
```



---

archive/issue_comments_269593.json:
```json
{
    "body": "<a id='comment:43'></a>I'm lost here... regardless of this ticket, the module `sage.symbolic.pynac` is *not* linked against NTL, but it does contain those NTL symbols.",
    "created_at": "2015-07-07T18:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269593",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>I'm lost here... regardless of this ticket, the module `sage.symbolic.pynac` is *not* linked against NTL, but it does contain those NTL symbols.



---

archive/issue_comments_269594.json:
```json
{
    "body": "<a id='comment:44'></a>C++ templates black magic ? :)\n\nActually I had a quick look at the pyx file and found nothing about NTL...",
    "created_at": "2015-07-07T22:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269594",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:44'></a>C++ templates black magic ? :)

Actually I had a quick look at the pyx file and found nothing about NTL...



---

archive/issue_comments_269595.json:
```json
{
    "body": "<a id='comment:45'></a>Had a quick look earlier this morning, the only way `ntl` can get pulled is by a chain of include files that are not obvious to follow. `sage.symbolic.pynac` import some stuff from `sage.rings` and I think something in `rings.pxd` import some `ntl` stuff eventually. I will look for where precise `NTL` symbols are used next.",
    "created_at": "2015-07-07T22:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269595",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>Had a quick look earlier this morning, the only way `ntl` can get pulled is by a chain of include files that are not obvious to follow. `sage.symbolic.pynac` import some stuff from `sage.rings` and I think something in `rings.pxd` import some `ntl` stuff eventually. I will look for where precise `NTL` symbols are used next.



---

archive/issue_comments_269596.json:
```json
{
    "body": "<a id='comment:46'></a>I'll be in a hidden valley for one week and though I might reply here, I won't have any ssh connection and any chance to fix this, so feel free to close the ticket without my help!",
    "created_at": "2015-07-07T22:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269596",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:46'></a>I'll be in a hidden valley for one week and though I might reply here, I won't have any ssh connection and any chance to fix this, so feel free to close the ticket without my help!



---

archive/issue_comments_269597.json:
```json
{
    "body": "<a id='comment:47'></a>It seems that the module is really underlinked:\n\n```\n$ ./sage --python\nPython 2.7.9 (default, Jul  5 2015, 21:49:10) \n[GCC 4.8.4] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sage.symbolic.pynac\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nImportError: /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/pynac.so: undefined symbol: _ZN3NTL8ZZ_pInfoE\n```\nThe only reason there is no error in Sage is that NTL was imported before (by some other module imported earlier).",
    "created_at": "2015-07-08T06:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269597",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>It seems that the module is really underlinked:

```
$ ./sage --python
Python 2.7.9 (default, Jul  5 2015, 21:49:10) 
[GCC 4.8.4] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import sage.symbolic.pynac
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/pynac.so: undefined symbol: _ZN3NTL8ZZ_pInfoE
```
The only reason there is no error in Sage is that NTL was imported before (by some other module imported earlier).



---

archive/issue_comments_269598.json:
```json
{
    "body": "<a id='comment:48'></a>There are *many* modules with the same linking problem. I think it's pointless to fix that problem without cleaning up the whole NTL interface (which is a big mess).\n\nThat leaves the problem of the dependency checking: I opened #18866 for that.",
    "created_at": "2015-07-08T08:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269598",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>There are *many* modules with the same linking problem. I think it's pointless to fix that problem without cleaning up the whole NTL interface (which is a big mess).

That leaves the problem of the dependency checking: I opened #18866 for that.



---

archive/issue_comments_269599.json:
```json
{
    "body": "<a id='comment:50'></a>New commits:",
    "created_at": "2015-07-08T09:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269599",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>New commits:



---

archive/issue_comments_269600.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-08T09:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269601.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-08T12:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269601",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_269602.json:
```json
{
    "body": "<a id='comment:53'></a>All doctests pass (but I haven't actually reviewed the changes)",
    "created_at": "2015-07-08T12:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269602",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'></a>All doctests pass (but I haven't actually reviewed the changes)



---

archive/issue_comments_269603.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-08T22:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269603",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_269604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-09T19:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269604",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052667.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T19:55:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18845#event-52667"
}
```



---

archive/issue_comments_269605.json:
```json
{
    "body": "<a id='comment:56'></a>Follow-up: #18875",
    "created_at": "2015-07-09T20:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18845#issuecomment-269605",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'></a>Follow-up: #18875
