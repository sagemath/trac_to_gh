# Issue 18540: Make DirichletGroup a new-style parent

archive/issues_018303.json:
```json
{
    "body": "The purpose of this ticket is to upgrade `DirichletGroup` from an old-style `ParentWithMultiplicativeAbelianGens` to a proper `Parent`.\n\nAt the same time, we place `DirichletGroup` in the category of Abelian groups.\n\nKeywords: Dirichlet group\n\nBranch/Commit: 3a2a89bb893a95c3ecd4c2731dee45e190464881\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18540\n\n",
    "closed_at": "2015-06-22T22:25:15Z",
    "created_at": "2015-05-28T21:57:08Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Make DirichletGroup a new-style parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18540",
    "user": "https://github.com/pjbruin"
}
```
The purpose of this ticket is to upgrade `DirichletGroup` from an old-style `ParentWithMultiplicativeAbelianGens` to a proper `Parent`.

At the same time, we place `DirichletGroup` in the category of Abelian groups.

Keywords: Dirichlet group

Branch/Commit: 3a2a89bb893a95c3ecd4c2731dee45e190464881

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18540





---

archive/issue_comments_328787.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-28T22:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328787",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_328788.json:
```json
{
    "body": "Changing commit from \"\" to \"5c32c32a91defb5416edcb9db9dfd61b71bc8c0a\"",
    "created_at": "2015-05-28T22:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328788",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "5c32c32a91defb5416edcb9db9dfd61b71bc8c0a"



---

archive/issue_comments_328789.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/18540-DirichletGroup_Parent\"",
    "created_at": "2015-05-28T22:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328789",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/18540-DirichletGroup_Parent"



---

archive/issue_comments_328790.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-29T05:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328790",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_328791.json:
```json
{
    "body": "Changing work_issues from \"\" to \"unpickling of old instances\"",
    "created_at": "2015-05-29T05:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328791",
    "user": "https://github.com/pjbruin"
}
```

Changing work_issues from "" to "unpickling of old instances"



---

archive/issue_comments_328792.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[1285b0e](https://github.com/sagemath/sagetrac-mirror/commit/1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd)|`Trac 18540: implement __setstate__ to fix unpickling of old instances`|",
    "created_at": "2015-05-29T12:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[1285b0e](https://github.com/sagemath/sagetrac-mirror/commit/1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd)|`Trac 18540: implement __setstate__ to fix unpickling of old instances`|



---

archive/issue_comments_328793.json:
```json
{
    "body": "Changing commit from \"5c32c32a91defb5416edcb9db9dfd61b71bc8c0a\" to \"1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd\"",
    "created_at": "2015-05-29T12:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5c32c32a91defb5416edcb9db9dfd61b71bc8c0a" to "1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd"



---

archive/issue_comments_328794.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-29T12:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328794",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_328795.json:
```json
{
    "body": "Changing work_issues from \"unpickling of old instances\" to \"\"",
    "created_at": "2015-05-29T12:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328795",
    "user": "https://github.com/pjbruin"
}
```

Changing work_issues from "unpickling of old instances" to ""



---

archive/issue_comments_328796.json:
```json
{
    "body": "<a id='comment:5'></a>\nA couple of comments:\n\n- Is `Groups().Commutative()` the best category? The `list` function seems like they should be in finite groups and that they are is finitely generated. I would say the category should be `Groups().Commutative().Finite().FinitelyGenerated()` (or at least a join with `EnumeratedSets`).\n\n- While I doubt it was used, the `__cmp__` did put a total ordering on the parents which I think we should keep by implementing a `__lt__` (and using ``@`total_ordering`).\n\nLooks good otherwise.",
    "created_at": "2015-05-30T22:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328796",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
A couple of comments:

- Is `Groups().Commutative()` the best category? The `list` function seems like they should be in finite groups and that they are is finitely generated. I would say the category should be `Groups().Commutative().Finite().FinitelyGenerated()` (or at least a join with `EnumeratedSets`).

- While I doubt it was used, the `__cmp__` did put a total ordering on the parents which I think we should keep by implementing a `__lt__` (and using ``@`total_ordering`).

Looks good otherwise.



---

archive/issue_comments_328797.json:
```json
{
    "body": "Changing commit from \"1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd\" to \"b92b5b00d366e547a862a857783470a9e2ac71c6\"",
    "created_at": "2015-06-01T12:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1285b0e4cf67dcfc910fd911a19dd2f637ff8fcd" to "b92b5b00d366e547a862a857783470a9e2ac71c6"



---

archive/issue_comments_328798.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[b92b5b0](https://github.com/sagemath/sagetrac-mirror/commit/b92b5b00d366e547a862a857783470a9e2ac71c6)|`Trac 18540: refine category of Dirichlet group if possible`|",
    "created_at": "2015-06-01T12:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[b92b5b0](https://github.com/sagemath/sagetrac-mirror/commit/b92b5b00d366e547a862a857783470a9e2ac71c6)|`Trac 18540: refine category of Dirichlet group if possible`|



---

archive/issue_comments_328799.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A5):\n> A couple of comments:\n> \n> - Is `Groups().Commutative()` the best category? The `list` function seems like they should be in finite groups and that they are is finitely generated. I would say the category should be `Groups().Commutative().Finite().FinitelyGenerated()` (or at least a join with `EnumeratedSets`).\n \nDone, but only if we know that the group of *n*-th roots of unity in the base ring is finite.  This is currently still the case for all Dirichlet groups that we can construct, but in the future we may admit base rings where this is not the case (the profinite completion of **Z**, for example).\n> - While I doubt it was used, the `__cmp__` did put a total ordering on the parents which I think we should keep by implementing a `__lt__` (and using ``@`total_ordering`).\n \nI don't like this very much.  First, the previous implementation actually does not make sense since it depends on a total ordering of all rings.  Second, I cannot imagine why one would like to totally order all Dirichlet groups over all rings.",
    "created_at": "2015-06-01T12:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328799",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A5):
> A couple of comments:
> 
> - Is `Groups().Commutative()` the best category? The `list` function seems like they should be in finite groups and that they are is finitely generated. I would say the category should be `Groups().Commutative().Finite().FinitelyGenerated()` (or at least a join with `EnumeratedSets`).
 
Done, but only if we know that the group of *n*-th roots of unity in the base ring is finite.  This is currently still the case for all Dirichlet groups that we can construct, but in the future we may admit base rings where this is not the case (the profinite completion of **Z**, for example).
> - While I doubt it was used, the `__cmp__` did put a total ordering on the parents which I think we should keep by implementing a `__lt__` (and using ``@`total_ordering`).
 
I don't like this very much.  First, the previous implementation actually does not make sense since it depends on a total ordering of all rings.  Second, I cannot imagine why one would like to totally order all Dirichlet groups over all rings.



---

archive/issue_comments_328800.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-06-22T09:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328800",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_328801.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-22T09:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328801",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_328802.json:
```json
{
    "body": "<a id='comment:8'></a>\n1. In the docstring of `DirichletGroup_class`, could you replace\n\n```\nGroup of Dirichlet characters modulo `N` over a ring `R`.\n```\nby\n\n```\nGroup of Dirichlet characters modulo `N` with values in a ring `R`.\n```\n(or something similar)\n\n2. In the check\n\n```\nif isinstance(x, (int, rings.Integer)) and x == 1:\n```\nI think it is better to remove `isinstance(x, (int, rings.Integer))` and allow any kind of `1` (but then you will probably need to add a `try`/`except` in case that `x == 1` fails).",
    "created_at": "2015-06-22T09:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328802",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
1. In the docstring of `DirichletGroup_class`, could you replace

```
Group of Dirichlet characters modulo `N` over a ring `R`.
```
by

```
Group of Dirichlet characters modulo `N` with values in a ring `R`.
```
(or something similar)

2. In the check

```
if isinstance(x, (int, rings.Integer)) and x == 1:
```
I think it is better to remove `isinstance(x, (int, rings.Integer))` and allow any kind of `1` (but then you will probably need to add a `try`/`except` in case that `x == 1` fails).



---

archive/issue_comments_328803.json:
```json
{
    "body": "<a id='comment:9'></a>\nI have no further comments. If you make the above changes and doctests still pass, you can set this to positive_review.",
    "created_at": "2015-06-22T09:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I have no further comments. If you make the above changes and doctests still pass, you can set this to positive_review.



---

archive/issue_comments_328804.json:
```json
{
    "body": "<a id='comment:10'></a>\nAdditional remark: it would be good to fix these `pyflakes` warnings:\n\n```\n$ pyflakes src/sage/modular/dirichlet.py\nsrc/sage/modular/dirichlet.py:550: 'latex' imported but unused\nsrc/sage/modular/dirichlet.py:800: local variable 'R' is assigned to but never used\nsrc/sage/modular/dirichlet.py:1691: local variable 'R' is assigned to but never used\nsrc/sage/modular/dirichlet.py:2312: local variable 'n' is assigned to but never used\nsrc/sage/modular/dirichlet.py:2314: local variable 'p' is assigned to but never used\nsrc/sage/modular/dirichlet.py:2376: local variable 'one' is assigned to but never used\nsrc/sage/modular/dirichlet.py:2377: local variable 'zeta' is assigned to but never used\n```",
    "created_at": "2015-06-22T12:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328804",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Additional remark: it would be good to fix these `pyflakes` warnings:

```
$ pyflakes src/sage/modular/dirichlet.py
src/sage/modular/dirichlet.py:550: 'latex' imported but unused
src/sage/modular/dirichlet.py:800: local variable 'R' is assigned to but never used
src/sage/modular/dirichlet.py:1691: local variable 'R' is assigned to but never used
src/sage/modular/dirichlet.py:2312: local variable 'n' is assigned to but never used
src/sage/modular/dirichlet.py:2314: local variable 'p' is assigned to but never used
src/sage/modular/dirichlet.py:2376: local variable 'one' is assigned to but never used
src/sage/modular/dirichlet.py:2377: local variable 'zeta' is assigned to but never used
```



---

archive/issue_comments_328805.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[3a2a89b](https://github.com/sagemath/sagetrac-mirror/commit/3a2a89bb893a95c3ecd4c2731dee45e190464881)|`Trac 18540: reviewer comments`|",
    "created_at": "2015-06-22T15:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[3a2a89b](https://github.com/sagemath/sagetrac-mirror/commit/3a2a89bb893a95c3ecd4c2731dee45e190464881)|`Trac 18540: reviewer comments`|



---

archive/issue_comments_328806.json:
```json
{
    "body": "Changing commit from \"b92b5b00d366e547a862a857783470a9e2ac71c6\" to \"3a2a89bb893a95c3ecd4c2731dee45e190464881\"",
    "created_at": "2015-06-22T15:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b92b5b00d366e547a862a857783470a9e2ac71c6" to "3a2a89bb893a95c3ecd4c2731dee45e190464881"



---

archive/issue_comments_328807.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-06-22T15:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328807",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_059276.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-22T22:25:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18540#event-59276"
}
```



---

archive/issue_comments_328808.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-22T22:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328808",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_328809.json:
```json
{
    "body": "Changing branch from \"u/pbruin/18540-DirichletGroup_Parent\" to \"3a2a89bb893a95c3ecd4c2731dee45e190464881\"",
    "created_at": "2015-06-22T22:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18540#issuecomment-328809",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/18540-DirichletGroup_Parent" to "3a2a89bb893a95c3ecd4c2731dee45e190464881"
