# Issue 18935: Finite field linear function to polynomial

archive/issues_018698.json:
```json
{
    "body": "Adding a method which converts a linear function over a finite field in the form of a matrix into a polynomial over that finite field.\nThis method uses dual bases to perform this calculation in milliseconds over fields such as `GF(3^8)`, whereas a naive Lagrange interpolation calculation can take several minutes to get the same result. \n\nCC:  @rbeezer @malb simonking\n\nKeywords: finite field, polynomial\n\nBranch: [u/tgagne/finite_field_matrix_to_polynomial](https://github.com/sagemath/sagetrac-mirror/tree/u/tgagne/finite_field_matrix_to_polynomial)\n\nReviewer: Vincent Delecroix\n\nAuthor: Thomas Gagne\n\nStatus: needs_work\n\nDependencies: #18714\n\nCommit: 1608ecbe6702539fdbcbfef4f6b27dbe39d275dc\n\nIssue created by migration from https://trac.sagemath.org/ticket/18935\n\n",
    "created_at": "2015-07-21T22:06:28Z",
    "labels": [
        "component: finite rings",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Finite field linear function to polynomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18935",
    "user": "https://github.com/ThomasGagne"
}
```
Adding a method which converts a linear function over a finite field in the form of a matrix into a polynomial over that finite field.
This method uses dual bases to perform this calculation in milliseconds over fields such as `GF(3^8)`, whereas a naive Lagrange interpolation calculation can take several minutes to get the same result. 

CC:  @rbeezer @malb simonking

Keywords: finite field, polynomial

Branch: [u/tgagne/finite_field_matrix_to_polynomial](https://github.com/sagemath/sagetrac-mirror/tree/u/tgagne/finite_field_matrix_to_polynomial)

Reviewer: Vincent Delecroix

Author: Thomas Gagne

Status: needs_work

Dependencies: #18714

Commit: 1608ecbe6702539fdbcbfef4f6b27dbe39d275dc

Issue created by migration from https://trac.sagemath.org/ticket/18935





---

archive/issue_comments_338859.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tgagne/finite_field_matrix_to_polynomial\"",
    "created_at": "2015-07-21T22:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338859",
    "user": "https://github.com/ThomasGagne"
}
```

Changing branch from "" to "u/tgagne/finite_field_matrix_to_polynomial"



---

archive/issue_comments_338860.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-21T22:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338860",
    "user": "https://github.com/ThomasGagne"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338861.json:
```json
{
    "body": "Changing commit from \"\" to \"1608ecbe6702539fdbcbfef4f6b27dbe39d275dc\"",
    "created_at": "2015-07-21T22:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338861",
    "user": "https://github.com/ThomasGagne"
}
```

Changing commit from "" to "1608ecbe6702539fdbcbfef4f6b27dbe39d275dc"



---

archive/issue_comments_338862.json:
```json
{
    "body": "Changing dependencies from \"\" to \"3a14bb2edd87281873d4f2b49d1c5d210c4a4a3c\"",
    "created_at": "2015-07-21T22:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338862",
    "user": "https://github.com/ThomasGagne"
}
```

Changing dependencies from "" to "3a14bb2edd87281873d4f2b49d1c5d210c4a4a3c"



---

archive/issue_comments_338863.json:
```json
{
    "body": "Changing author from \"\" to \"Thomas Gagne\"",
    "created_at": "2015-07-21T22:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338863",
    "user": "https://github.com/ThomasGagne"
}
```

Changing author from "" to "Thomas Gagne"



---

archive/issue_comments_338864.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe dependency should be a trac ticket, not a commit. Do you have a ticket for your dependency? If yes, write the ticket number there. If no, just remove the dependency.",
    "created_at": "2015-07-23T08:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338864",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
The dependency should be a trac ticket, not a commit. Do you have a ticket for your dependency? If yes, write the ticket number there. If no, just remove the dependency.



---

archive/issue_comments_338865.json:
```json
{
    "body": "Changing dependencies from \"3a14bb2edd87281873d4f2b49d1c5d210c4a4a3c\" to \"#18714\"",
    "created_at": "2015-07-23T19:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338865",
    "user": "https://github.com/ThomasGagne"
}
```

Changing dependencies from "3a14bb2edd87281873d4f2b49d1c5d210c4a4a3c" to "#18714"



---

archive/issue_comments_338866.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jdemeyer](#comment%3A2):\n> The dependency should be a trac ticket, not a commit. Do you have a ticket for your dependency? If yes, write the ticket number there. If no, just remove the dependency.\n\nWhoops! Thanks for pointing that out!",
    "created_at": "2015-07-23T19:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338866",
    "user": "https://github.com/ThomasGagne"
}
```

<a id='comment:4'></a>
Replying to [jdemeyer](#comment%3A2):
> The dependency should be a trac ticket, not a commit. Do you have a ticket for your dependency? If yes, write the ticket number there. If no, just remove the dependency.

Whoops! Thanks for pointing that out!



---

archive/issue_events_060048.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-11-28T15:18:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18935#event-60048"
}
```



---

archive/issue_comments_338867.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-11-28T15:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338867",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_338868.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhy `base_matrix_to_polynomial` and not simply `matrix_to_polynomial`?\n\n`poly(el)` is simpler than `poly.subs(x=el)`\n\nThis test is really bad\n\n```\nnot all([matrix[i,j] in self.base_ring() for i in range(n) for j in range(n)])\n```\nYou have several better options\n- `matrix.base_ring() == self`\n- `matrix = matrix.change_ring(self)` (this might make an unneeded copy)\n\nIf `var` is already an element of a polynomial ring then you should not recreate another one. In particular, I might want to work over QQ[x,y] and obtain a polynomial in the variable x in this specific ring. I would simply do\n\n```\nif isinstance(var, str):\n    from sage.rings.polynomial.polynomial_ring import polygen\n    var = polygen(self)\n```\n\nIf the matrix is sparse you are doing a lot of unwanted computations. I would actually separate\n\n```\nif matrix.is_sparse():\n    entries = matrix.nonzero_positions()\nelse:\n    entries = ((i,j) for i in range(n) for j in range(n))\n\nfor i,j in entries:\n    # do the looping\n```\nAnd add a test with a huge matrix with very few coefficients like\n\n```\nsage: M = matrix(GF(3,4), 1000, sparse=True)\nsage: M[0,3] = 1\n```\n\nThe operation `gen**i` is actually very fast. So I would avoid computing the list `basis` and replace `basis[i]` with `gen**i`\n\nYou should not compute a list and then make a sum of elements. Do everything at once\n\n```\ns = 0\nfor i in range(10):\n    s += 1\n```\nis much better than\n\n```\nl = []\nfor i in range(10):\n    l.append(i)\ns = sum(l)\n```",
    "created_at": "2015-11-28T15:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338868",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Why `base_matrix_to_polynomial` and not simply `matrix_to_polynomial`?

`poly(el)` is simpler than `poly.subs(x=el)`

This test is really bad

```
not all([matrix[i,j] in self.base_ring() for i in range(n) for j in range(n)])
```
You have several better options
- `matrix.base_ring() == self`
- `matrix = matrix.change_ring(self)` (this might make an unneeded copy)

If `var` is already an element of a polynomial ring then you should not recreate another one. In particular, I might want to work over QQ[x,y] and obtain a polynomial in the variable x in this specific ring. I would simply do

```
if isinstance(var, str):
    from sage.rings.polynomial.polynomial_ring import polygen
    var = polygen(self)
```

If the matrix is sparse you are doing a lot of unwanted computations. I would actually separate

```
if matrix.is_sparse():
    entries = matrix.nonzero_positions()
else:
    entries = ((i,j) for i in range(n) for j in range(n))

for i,j in entries:
    # do the looping
```
And add a test with a huge matrix with very few coefficients like

```
sage: M = matrix(GF(3,4), 1000, sparse=True)
sage: M[0,3] = 1
```

The operation `gen**i` is actually very fast. So I would avoid computing the list `basis` and replace `basis[i]` with `gen**i`

You should not compute a list and then make a sum of elements. Do everything at once

```
s = 0
for i in range(10):
    s += 1
```
is much better than

```
l = []
for i in range(10):
    l.append(i)
s = sum(l)
```



---

archive/issue_comments_338869.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-28T15:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18935#issuecomment-338869",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.
