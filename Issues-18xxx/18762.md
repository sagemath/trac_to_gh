# Issue 18762: Create coercion between diagram algebras and the symmetric group algebra

archive/issues_018525.json:
```json
{
    "body": "There is a natural embedding of elements of the symmetric group algebra into diagram algebras, especially the partition algebra and the Brauer algebra. Therefore, there should be a morphism registered to the coercion model to allow for symmetric group algebra elements to be coerced into the appropriate diagram algebras. This morphism is pretty straight forward and will only take a few lines to implement. \n\nCC:  @alauve @srdoty @saliola @tscrim\n\nKeywords: diagram algebra, partition algebra, days65\n\nBranch/Commit: 14f80d3624d95079c896cb5efe8f29988834e1ac\n\nReviewer: Travis Scrimshaw\n\nAuthor: George H. Seelinger\n\nDependencies: #18720\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18762\n\n",
    "closed_at": "2015-10-12T22:53:02Z",
    "created_at": "2015-06-22T19:29:29Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Create coercion between diagram algebras and the symmetric group algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18762",
    "user": "https://github.com/ghseeli"
}
```
There is a natural embedding of elements of the symmetric group algebra into diagram algebras, especially the partition algebra and the Brauer algebra. Therefore, there should be a morphism registered to the coercion model to allow for symmetric group algebra elements to be coerced into the appropriate diagram algebras. This morphism is pretty straight forward and will only take a few lines to implement. 

CC:  @alauve @srdoty @saliola @tscrim

Keywords: diagram algebra, partition algebra, days65

Branch/Commit: 14f80d3624d95079c896cb5efe8f29988834e1ac

Reviewer: Travis Scrimshaw

Author: George H. Seelinger

Dependencies: #18720

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18762





---

archive/issue_comments_330820.json:
```json
{
    "body": "Changing branch from \"\" to \"u/ghseeli/create_coercion_between_diagram_algebras_and_the_symmetric_group_algebra\"",
    "created_at": "2015-06-23T00:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330820",
    "user": "https://github.com/ghseeli"
}
```

Changing branch from "" to "u/ghseeli/create_coercion_between_diagram_algebras_and_the_symmetric_group_algebra"



---

archive/issue_comments_330821.json:
```json
{
    "body": "Changing commit from \"\" to \"28ee71f199a7162aa57408864e451f8a3477fcbf\"",
    "created_at": "2015-06-23T00:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330821",
    "user": "https://github.com/ghseeli"
}
```

Changing commit from "" to "28ee71f199a7162aa57408864e451f8a3477fcbf"



---

archive/issue_comments_330822.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2015-06-23T00:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330822",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_330823.json:
```json
{
    "body": "<a id='comment:3'></a>Alright, so, the code at present does not work. For some reason, I get an MRO error when I try to initialize the SymmetricGroupAlgebra with the same base ring as the DiagramAlgebra. Does anyone have any suggestions about how to fix this?",
    "created_at": "2015-06-23T00:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330823",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:3'></a>Alright, so, the code at present does not work. For some reason, I get an MRO error when I try to initialize the SymmetricGroupAlgebra with the same base ring as the DiagramAlgebra. Does anyone have any suggestions about how to fix this?



---

archive/issue_comments_330824.json:
```json
{
    "body": "Changing commit from \"28ee71f199a7162aa57408864e451f8a3477fcbf\" to \"69bd5dbdd4cb11875dc5ab79cd3a8735633f3226\"",
    "created_at": "2015-06-23T00:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "28ee71f199a7162aa57408864e451f8a3477fcbf" to "69bd5dbdd4cb11875dc5ab79cd3a8735633f3226"



---

archive/issue_comments_330825.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-23T00:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330826.json:
```json
{
    "body": "<a id='comment:5'></a>An MRO error is extremely strange. I will take a look at this as soon as I can.",
    "created_at": "2015-06-23T01:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330826",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>An MRO error is extremely strange. I will take a look at this as soon as I can.



---

archive/issue_comments_330827.json:
```json
{
    "body": "<a id='comment:6'></a>Is this a bug in the SymmetricGroupAlgebra?\n\n```\nsage: SymmetricGroupAlgebra(SR,3,category = FiniteDimensionalAlgebrasWithBasis(SR))\nTraceback\n...\nTypeError: Cannot create a consistent method resolution\norder (MRO) for bases MagmaticAlgebras.subcategory_class, UnitalAlgebras.WithBasis.subcategory_class, AdditiveMagmas.Algebras.subcategory_class\n```\nBut, in a completely new Sage session:\n\n```\nsage: SymmetricGroupAlgebra(SR,3)\nSymmetric group algebra of order 3 over Symbolic Ring\nsage: SymmetricGroupAlgebra(SR,3,category = FiniteDimensionalAlgebrasWithBasis(SR))\nSymmetric group algebra of order 3 over Symbolic Ring\n```\nI have no idea what could be going on here. Is it some clever caching that somehow makes things work? In any event, this is the cause of the issue, I think.\n\n(I tried this in sage6.8beta5)",
    "created_at": "2015-06-26T17:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330827",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:6'></a>Is this a bug in the SymmetricGroupAlgebra?

```
sage: SymmetricGroupAlgebra(SR,3,category = FiniteDimensionalAlgebrasWithBasis(SR))
Traceback
...
TypeError: Cannot create a consistent method resolution
order (MRO) for bases MagmaticAlgebras.subcategory_class, UnitalAlgebras.WithBasis.subcategory_class, AdditiveMagmas.Algebras.subcategory_class
```
But, in a completely new Sage session:

```
sage: SymmetricGroupAlgebra(SR,3)
Symmetric group algebra of order 3 over Symbolic Ring
sage: SymmetricGroupAlgebra(SR,3,category = FiniteDimensionalAlgebrasWithBasis(SR))
Symmetric group algebra of order 3 over Symbolic Ring
```
I have no idea what could be going on here. Is it some clever caching that somehow makes things work? In any event, this is the cause of the issue, I think.

(I tried this in sage6.8beta5)



---

archive/issue_comments_330828.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-26T17:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330829.json:
```json
{
    "body": "Changing commit from \"69bd5dbdd4cb11875dc5ab79cd3a8735633f3226\" to \"22c7116a9e7355b0b351a9d7dd733e8423fcdcf2\"",
    "created_at": "2015-06-26T17:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69bd5dbdd4cb11875dc5ab79cd3a8735633f3226" to "22c7116a9e7355b0b351a9d7dd733e8423fcdcf2"



---

archive/issue_comments_330830.json:
```json
{
    "body": "<a id='comment:8'></a>Oh wow, that's very interesting behavior...However it is not quite proper input as the category of the Weyl group `W`. Yet it should behave correctly and consistently, or at least give a better error message.",
    "created_at": "2015-06-27T05:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330830",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Oh wow, that's very interesting behavior...However it is not quite proper input as the category of the Weyl group `W`. Yet it should behave correctly and consistently, or at least give a better error message.



---

archive/issue_comments_330831.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-07-04T02:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_330832.json:
```json
{
    "body": "Changing commit from \"22c7116a9e7355b0b351a9d7dd733e8423fcdcf2\" to \"e138144a3975a51a005f06df98c6ef1b0fad1753\"",
    "created_at": "2015-07-04T02:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "22c7116a9e7355b0b351a9d7dd733e8423fcdcf2" to "e138144a3975a51a005f06df98c6ef1b0fad1753"



---

archive/issue_events_052506.json:
```json
{
    "actor": "https://github.com/ghseeli",
    "created_at": "2015-08-06T00:33:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18762#event-52506"
}
```



---

archive/issue_comments_330833.json:
```json
{
    "body": "Changing commit from \"e138144a3975a51a005f06df98c6ef1b0fad1753\" to \"d4d3a091c747cf5ed31f02eb10d6f3298445aecd\"",
    "created_at": "2015-08-16T23:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e138144a3975a51a005f06df98c6ef1b0fad1753" to "d4d3a091c747cf5ed31f02eb10d6f3298445aecd"



---

archive/issue_comments_330834.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-08-16T23:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_330835.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-16T23:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330835",
    "user": "https://github.com/ghseeli"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330836.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-25T02:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330837.json:
```json
{
    "body": "Changing commit from \"d4d3a091c747cf5ed31f02eb10d6f3298445aecd\" to \"2adcfeffa5d87f137ee9010fb69087a2b76e98a7\"",
    "created_at": "2015-08-25T02:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d4d3a091c747cf5ed31f02eb10d6f3298445aecd" to "2adcfeffa5d87f137ee9010fb69087a2b76e98a7"



---

archive/issue_comments_330838.json:
```json
{
    "body": "<a id='comment:14'></a>This currently breaks the requirements of a coercion in that the coercion map must be defined on all elements of the domain. So it will need to be a conversion, which you can implement in the `_element_constructor_` method by\n\n```python\nif isinstance(x, SymmetricGroupAlgebra.Element) and other_conditions_on_parent(x):\n    return convert_to_element_of_self(x)\n```\nFor those diagram algebras which this is well-defined on the entire domain, you can make the call to ``self`` a coercion in the constructor or implement:\n\n```python\ndef _coerce_map_from_(self, P):\n    if isinstance(P, SymmetricGroupAlgebra) and other_conditions(P):\n        return True\n    return super(self, DiagramAlgebra)._coerce_map_from_(P)\n```",
    "created_at": "2015-08-28T22:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330838",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>This currently breaks the requirements of a coercion in that the coercion map must be defined on all elements of the domain. So it will need to be a conversion, which you can implement in the `_element_constructor_` method by

```python
if isinstance(x, SymmetricGroupAlgebra.Element) and other_conditions_on_parent(x):
    return convert_to_element_of_self(x)
```
For those diagram algebras which this is well-defined on the entire domain, you can make the call to ``self`` a coercion in the constructor or implement:

```python
def _coerce_map_from_(self, P):
    if isinstance(P, SymmetricGroupAlgebra) and other_conditions(P):
        return True
    return super(self, DiagramAlgebra)._coerce_map_from_(P)
```



---

archive/issue_comments_330839.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-19T03:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330839",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330840.json:
```json
{
    "body": "<a id='comment:15'></a>Hello,\n\nJust some sided remarks.\n\n- You have more commits than the number of lines you modified! Moreover most of your commit messages are completely useless. The git history is important since it is used to find out which commit is responsible for a given change. You would better start a new (clean) branch from scratch.\n- methods must be documented (see [the developer guide](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings))\n\nVincent",
    "created_at": "2015-09-19T03:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330840",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>Hello,

Just some sided remarks.

- You have more commits than the number of lines you modified! Moreover most of your commit messages are completely useless. The git history is important since it is used to find out which commit is responsible for a given change. You would better start a new (clean) branch from scratch.
- methods must be documented (see [the developer guide](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings))

Vincent



---

archive/issue_comments_330841.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [vdelecroix](#comment%3A15):\n> - You have more commits than the number of lines you modified! Moreover most of your commit messages are completely useless. The git history is important since it is used to find out which commit is responsible for a given change. You would better start a new (clean) branch from scratch.\n\n\nThis comment is completely off base. First, learn to use `git blame` and `git log filename` (or `git log -p filename`). Second, the commit messages tell about the changes (although there are some of them that are really long; git practices want the first lines to be short). You are being way too precious about the git history.",
    "created_at": "2015-09-19T14:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330841",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>Replying to [vdelecroix](#comment%3A15):
> - You have more commits than the number of lines you modified! Moreover most of your commit messages are completely useless. The git history is important since it is used to find out which commit is responsible for a given change. You would better start a new (clean) branch from scratch.


This comment is completely off base. First, learn to use `git blame` and `git log filename` (or `git log -p filename`). Second, the commit messages tell about the changes (although there are some of them that are really long; git practices want the first lines to be short). You are being way too precious about the git history.



---

archive/issue_comments_330842.json:
```json
{
    "body": "<a id='comment:17'></a>Vincent,\n\nThank you for your feedback. I had intended to change the status from needs_review to needs_work when Travis made his comments 3 weeks ago, so I am sorry you felt compelled to review something that was already in need of a lot of work. I understand that methods must be documented and I will do so accordingly before there is a positive review. However, first, I needed to establish what is going on here, (see the earlier comments about weird coercion behavior) and that is still somewhat (?) in the air. I do agree that my git comments are rather terse, but at the same time, as you note, most of them are rather small and thus looking at the diff should be more than enough to get an idea of what is happening. Furthermore, as someone who develops software semi-professionally, it is not unusual that the number of commits exceeds the number of lines changed. Most software developers would say that the number of lines affected has little correlation with content. Finally, a lot of these commits are due to the age of the ticket. New versions of the beta need to be merged into the branch so that the feature doesn't depart from the current beta. I am sorry that my development cycle has been so slow that this has been necessary. I hope to finish this ticket soon. Thank you for your feedback and I hope you will be more satisfied with the end result when it goes back up for review.\n\nBest,\nGeorge",
    "created_at": "2015-09-22T02:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330842",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:17'></a>Vincent,

Thank you for your feedback. I had intended to change the status from needs_review to needs_work when Travis made his comments 3 weeks ago, so I am sorry you felt compelled to review something that was already in need of a lot of work. I understand that methods must be documented and I will do so accordingly before there is a positive review. However, first, I needed to establish what is going on here, (see the earlier comments about weird coercion behavior) and that is still somewhat (?) in the air. I do agree that my git comments are rather terse, but at the same time, as you note, most of them are rather small and thus looking at the diff should be more than enough to get an idea of what is happening. Furthermore, as someone who develops software semi-professionally, it is not unusual that the number of commits exceeds the number of lines changed. Most software developers would say that the number of lines affected has little correlation with content. Finally, a lot of these commits are due to the age of the ticket. New versions of the beta need to be merged into the branch so that the feature doesn't depart from the current beta. I am sorry that my development cycle has been so slow that this has been necessary. I hope to finish this ticket soon. Thank you for your feedback and I hope you will be more satisfied with the end result when it goes back up for review.

Best,
George



---

archive/issue_comments_330843.json:
```json
{
    "body": "<a id='comment:18'></a>Hello,\n\nReplying to [ghseeli](#comment%3A17):\n> Finally, a lot of these commits are due to the age of the ticket. New versions of the beta need to be merged into the branch so that the feature doesn't depart from the current beta.\n\n\nThere is no need to merge the last beta.\n\nBut anyway, the most important is to do how you feel. And take for the best other's comments to get a better Sage software.\n\nVincent",
    "created_at": "2015-09-22T10:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330843",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Hello,

Replying to [ghseeli](#comment%3A17):
> Finally, a lot of these commits are due to the age of the ticket. New versions of the beta need to be merged into the branch so that the feature doesn't depart from the current beta.


There is no need to merge the last beta.

But anyway, the most important is to do how you feel. And take for the best other's comments to get a better Sage software.

Vincent



---

archive/issue_comments_330844.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-10T23:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330845.json:
```json
{
    "body": "Changing commit from \"2adcfeffa5d87f137ee9010fb69087a2b76e98a7\" to \"6e7cb2173baacb6b5bbb8b29ec7cafb57c4ad6c7\"",
    "created_at": "2015-10-10T23:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2adcfeffa5d87f137ee9010fb69087a2b76e98a7" to "6e7cb2173baacb6b5bbb8b29ec7cafb57c4ad6c7"



---

archive/issue_comments_330846.json:
```json
{
    "body": "<a id='comment:20'></a>Alright, I have now added conversions instead of coercions where appropriate. Furthermore, I have included some appropriate unit tests. I was wondering, should I also include some negative unit tests? As in, verify an error is raised when someone tries to instantiate an invalid algebra element using an inappropriate symmetric group algebra element?\n\nThank you!",
    "created_at": "2015-10-10T23:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330846",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:20'></a>Alright, I have now added conversions instead of coercions where appropriate. Furthermore, I have included some appropriate unit tests. I was wondering, should I also include some negative unit tests? As in, verify an error is raised when someone tries to instantiate an invalid algebra element using an inappropriate symmetric group algebra element?

Thank you!



---

archive/issue_comments_330847.json:
```json
{
    "body": "<a id='comment:21'></a>Yes, these are also useful to verify that you are checking things properly. Also you should make sure to test corner cases.",
    "created_at": "2015-10-10T23:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330847",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>Yes, these are also useful to verify that you are checking things properly. Also you should make sure to test corner cases.



---

archive/issue_comments_330848.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-11T00:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330849.json:
```json
{
    "body": "Changing commit from \"6e7cb2173baacb6b5bbb8b29ec7cafb57c4ad6c7\" to \"ea857ff335ac439123ef7b7891bdd8909e5c3fb4\"",
    "created_at": "2015-10-11T00:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330849",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6e7cb2173baacb6b5bbb8b29ec7cafb57c4ad6c7" to "ea857ff335ac439123ef7b7891bdd8909e5c3fb4"



---

archive/issue_comments_330850.json:
```json
{
    "body": "<a id='comment:23'></a>Alright, I added some negative unit tests. However, I am now having trouble getting the following test to pass:\n\n\n```\nsage: R.<x> = QQ[]\nsage: BA = BrauerAlgebra(2, x, R)\nsage: BA.ambient().has_coerce_map_from(BA)\nTrue\n```\n\nHowever, when I run these commands in Sage, the result comes out as expected. Any ideas on why this is happening?",
    "created_at": "2015-10-11T00:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330850",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:23'></a>Alright, I added some negative unit tests. However, I am now having trouble getting the following test to pass:


```
sage: R.<x> = QQ[]
sage: BA = BrauerAlgebra(2, x, R)
sage: BA.ambient().has_coerce_map_from(BA)
True
```

However, when I run these commands in Sage, the result comes out as expected. Any ideas on why this is happening?



---

archive/issue_comments_330851.json:
```json
{
    "body": "<a id='comment:24'></a>My guess is that we have the coercion situation `BA -> X -> A` where `X` is some intermediate object that makes the coercion chain. At some point in the doctests:\n\n1 - `BA` and `A` have been created, but `X` has not.\n2 - There is a check in some way for if there is a coercion from `BA` to `A`, which there is not. (This can be something as innocuous as `A(x)` where `x in BA`).\n3 - The result of 2 is cached, so even when `X` is created, there is no check to see if there is a coercion path from `BA` to `A`.\n\nHowever that is just a quick guess from the symptoms. I will take a more detailed look over the next few days.\n\nSide note in case you didn't notice, you have `TESTS:` block which should be `TESTS::`.",
    "created_at": "2015-10-11T03:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330851",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>My guess is that we have the coercion situation `BA -> X -> A` where `X` is some intermediate object that makes the coercion chain. At some point in the doctests:

1 - `BA` and `A` have been created, but `X` has not.
2 - There is a check in some way for if there is a coercion from `BA` to `A`, which there is not. (This can be something as innocuous as `A(x)` where `x in BA`).
3 - The result of 2 is cached, so even when `X` is created, there is no check to see if there is a coercion path from `BA` to `A`.

However that is just a quick guess from the symptoms. I will take a more detailed look over the next few days.

Side note in case you didn't notice, you have `TESTS:` block which should be `TESTS::`.



---

archive/issue_comments_330852.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-11T17:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330853.json:
```json
{
    "body": "Changing commit from \"ea857ff335ac439123ef7b7891bdd8909e5c3fb4\" to \"a4c199d2842865c6385e6938b67974f39ebd8876\"",
    "created_at": "2015-10-11T17:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ea857ff335ac439123ef7b7891bdd8909e5c3fb4" to "a4c199d2842865c6385e6938b67974f39ebd8876"



---

archive/issue_comments_330854.json:
```json
{
    "body": "Changing branch from \"u/ghseeli/create_coercion_between_diagram_algebras_and_the_symmetric_group_algebra\" to \"u/tscrim/diagram_algebras_SGA-18762\"",
    "created_at": "2015-10-12T00:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330854",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/ghseeli/create_coercion_between_diagram_algebras_and_the_symmetric_group_algebra" to "u/tscrim/diagram_algebras_SGA-18762"



---

archive/issue_comments_330855.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-12T00:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330855",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330856.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2015-10-12T00:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330856",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_events_052507.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-12T00:43:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18762#event-52507"
}
```



---

archive/issue_events_052508.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-12T00:43:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18762#event-52508"
}
```



---

archive/issue_comments_330857.json:
```json
{
    "body": "<a id='comment:26'></a>Okay, so I figured out what was going on.\n\n<technical>What was happening was you were creating a coercion from a subalgebra to the ambient algebra, but the ambient algebra could be garbage collected because the morphism (which only holds a strong reference to the *codomain*) could be collected and the subalgebra didn't have a strong reference to the ambient algebra. When the ambient algebra was recreated, the morphism was not, and so there was no coercion registered (which is done in the codomains). I reworked things so the lift morphism was strongly referenced, and hence the ambient algebra, by the subalgebra.</technical>\n\nI also reworked the morphisms to the Sage standard practice and expanded coercions to allow when there is also a coercion of base rings. There were also some other misc issues that I fixed as well.\n\nIf you're happy with my changes, then you can set a positive review.\n\n---\nNew commits:",
    "created_at": "2015-10-12T00:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330857",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>Okay, so I figured out what was going on.

<technical>What was happening was you were creating a coercion from a subalgebra to the ambient algebra, but the ambient algebra could be garbage collected because the morphism (which only holds a strong reference to the *codomain*) could be collected and the subalgebra didn't have a strong reference to the ambient algebra. When the ambient algebra was recreated, the morphism was not, and so there was no coercion registered (which is done in the codomains). I reworked things so the lift morphism was strongly referenced, and hence the ambient algebra, by the subalgebra.</technical>

I also reworked the morphisms to the Sage standard practice and expanded coercions to allow when there is also a coercion of base rings. There were also some other misc issues that I fixed as well.

If you're happy with my changes, then you can set a positive review.

---
New commits:



---

archive/issue_comments_330858.json:
```json
{
    "body": "Changing commit from \"a4c199d2842865c6385e6938b67974f39ebd8876\" to \"14f80d3624d95079c896cb5efe8f29988834e1ac\"",
    "created_at": "2015-10-12T00:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330858",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "a4c199d2842865c6385e6938b67974f39ebd8876" to "14f80d3624d95079c896cb5efe8f29988834e1ac"



---

archive/issue_comments_330859.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-12T02:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330859",
    "user": "https://github.com/ghseeli"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330860.json:
```json
{
    "body": "<a id='comment:28'></a>Alright, I now set the ticket to a positive review. Thank you again for all your help Travis! I feel like I am learning a lot more about the internals of Sage.",
    "created_at": "2015-10-12T02:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330860",
    "user": "https://github.com/ghseeli"
}
```

<a id='comment:28'></a>Alright, I now set the ticket to a positive review. Thank you again for all your help Travis! I feel like I am learning a lot more about the internals of Sage.



---

archive/issue_comments_330861.json:
```json
{
    "body": "<a id='comment:29'></a>Thanks for your contributions. Feel free to cc me on any future tickets you work on (I suspect I will find them to be useful).",
    "created_at": "2015-10-12T02:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330861",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>Thanks for your contributions. Feel free to cc me on any future tickets you work on (I suspect I will find them to be useful).



---

archive/issue_comments_330862.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T22:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330862",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_330863.json:
```json
{
    "body": "Changing branch from \"u/tscrim/diagram_algebras_SGA-18762\" to \"14f80d3624d95079c896cb5efe8f29988834e1ac\"",
    "created_at": "2015-10-12T22:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18762#issuecomment-330863",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/tscrim/diagram_algebras_SGA-18762" to "14f80d3624d95079c896cb5efe8f29988834e1ac"



---

archive/issue_events_052509.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-12T22:53:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18762",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18762#event-52509"
}
```
