# Issue 18732: Add tableau query functions glp_eval_tab_row, glp_eval_tab_col to GLPK backend

archive/issues_018495.json:
```json
{
    "assignees": [],
    "body": "Expose the GLPK functions glp_eval_tab_row, glp_eval_tab_col in Sage's GLPKBackend class.\n\nSee [GLPK manual](http://fossies.org/linux/glpk/doc/glpk.pdf), section 4.3 \"Simplex tableau routines\".\n\nOne needs these functions if one wants to implement tableau cutting planes such as Gomory's fractional cut.\n\n\n\nCC:  @nathanncohen @yuan-zhou @uduse @jdemeyer\n\nKeywords: **glpk**\n\nBranch/Commit: **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**\n\nReviewer: **Nathann Cohen**\n\nAuthor: **Yuan Zhou, Matthias Koeppe**\n\nComponent: **numerical**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18732_\n\n",
    "closed_at": "2015-06-24T11:37:10Z",
    "created_at": "2015-06-19T03:05:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20numerical",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20programming"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add tableau query functions glp_eval_tab_row, glp_eval_tab_col to GLPK backend",
    "type": "issue",
    "updated_at": "2015-06-24T11:37:10Z",
    "url": "https://github.com/sagemath/sage/issues/18732",
    "user": "https://github.com/mkoeppe"
}
```
Expose the GLPK functions glp_eval_tab_row, glp_eval_tab_col in Sage's GLPKBackend class.

See [GLPK manual](http://fossies.org/linux/glpk/doc/glpk.pdf), section 4.3 "Simplex tableau routines".

One needs these functions if one wants to implement tableau cutting planes such as Gomory's fractional cut.



CC:  @nathanncohen @yuan-zhou @uduse @jdemeyer

Keywords: **glpk**

Branch/Commit: **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**

Reviewer: **Nathann Cohen**

Author: **Yuan Zhou, Matthias Koeppe**

Component: **numerical**

_Issue created by migration from https://trac.sagemath.org/ticket/18732_





---

archive/issue_events_263704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263704"
}
```



---

archive/issue_events_263705.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20numerical",
    "label_color": "0000ff",
    "label_name": "c: numerical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263705"
}
```



---

archive/issue_events_263706.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263706"
}
```



---

archive/issue_events_263707.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263707"
}
```



---

archive/issue_events_263708.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20programming",
    "label_color": "0000ff",
    "label_name": "c: linear programming",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263708"
}
```



---

archive/issue_comments_261222.json:
```json
{
    "body": "Changed author from **ncohen, yzh** to none",
    "created_at": "2015-06-19T03:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261222",
    "user": "https://github.com/yuan-zhou"
}
```

Changed author from **ncohen, yzh** to none



---

archive/issue_comments_261223.json:
```json
{
    "body": "Branch: **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**",
    "created_at": "2015-06-21T10:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261223",
    "user": "https://github.com/yuan-zhou"
}
```

Branch: **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**



---

archive/issue_comments_261224.json:
```json
{
    "body": "Commit: **[`380dfb5`](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)**",
    "created_at": "2015-06-21T10:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261224",
    "user": "https://github.com/nathanncohen"
}
```

Commit: **[`380dfb5`](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)**



---

archive/issue_comments_261225.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHello !\n\nCould you allocate memory *after* raising an exception? Otherwise, those exceptions trigger memory leaks.\n\n`sig_on` and `sig_off` should always appear in pairs, but perhaps you should use `sig_check` in this special case?\nhttp://www.sagemath.org/documentation/html/en/developer/coding_in_cython.html#interrupt-and-signal-handling\n\nCan you check that the pointers you allocate are not 'null'?\n\nNathann\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e\"><code>380dfb5</code></a></td><td><code>Add tableau query functions eval_tab_row, eval_tab_col to GLPK backend.</code></td></tr></table>\n",
    "created_at": "2015-06-21T10:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261225",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

Hello !

Could you allocate memory *after* raising an exception? Otherwise, those exceptions trigger memory leaks.

`sig_on` and `sig_off` should always appear in pairs, but perhaps you should use `sig_check` in this special case?
http://www.sagemath.org/documentation/html/en/developer/coding_in_cython.html#interrupt-and-signal-handling

Can you check that the pointers you allocate are not 'null'?

Nathann

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e"><code>380dfb5</code></a></td><td><code>Add tableau query functions eval_tab_row, eval_tab_col to GLPK backend.</code></td></tr></table>




---

archive/issue_comments_261226.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nBonjour Nathann,\n\nThanks for the reference! It says that `sig_str` behaves the same as `sig_on`. I just mimic the code in the `GLPKBackend.solve` and `GLPKBackend.row` methods.\n\nDoes one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?\n\nHow to check that the pointers are not 'null'?\n\nYuan",
    "created_at": "2015-06-21T11:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261226",
    "user": "https://github.com/yuan-zhou"
}
```

<div id="comment:5" align="right">comment:5</div>

Bonjour Nathann,

Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`. I just mimic the code in the `GLPKBackend.solve` and `GLPKBackend.row` methods.

Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?

How to check that the pointers are not 'null'?

Yuan



---

archive/issue_comments_261227.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHelloooooo,\n\n> Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`.\n\nOh. My mistake. I did not notice `sig_str`, and did not even know about it. Sorry.\n\n> Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?\n\nWell, if you allocate memory somewhere and the function ends, then it is never deallocated. If you can avoid this easily, it is better to do it.\n\n> How to check that the pointers are not 'null'?\n\nwith \"if my_pointer == NULL\" ?\n\nNathann",
    "created_at": "2015-06-21T11:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261227",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">comment:6</div>

Helloooooo,

> Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`.

Oh. My mistake. I did not notice `sig_str`, and did not even know about it. Sorry.

> Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?

Well, if you allocate memory somewhere and the function ends, then it is never deallocated. If you can avoid this easily, it is better to do it.

> How to check that the pointers are not 'null'?

with "if my_pointer == NULL" ?

Nathann



---

archive/issue_comments_261228.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a\"><code>1cf22a9</code></a></td><td><code>Fix memory leaks and check null pointer in eval_tab_row(), eval_tab_col().</code></td></tr></table>\n",
    "created_at": "2015-06-21T22:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261228",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a"><code>1cf22a9</code></a></td><td><code>Fix memory leaks and check null pointer in eval_tab_row(), eval_tab_col().</code></td></tr></table>




---

archive/issue_comments_261229.json:
```json
{
    "body": "Changed commit from **[`380dfb5`](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)** to **[`1cf22a9`](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)**",
    "created_at": "2015-06-21T22:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261229",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`380dfb5`](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)** to **[`1cf22a9`](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)**



---

archive/issue_comments_261230.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt now raises `MIPSolverException` if GLPK returns an error message \"basis factorization does not exist\". Memory checks are also added. Please review.",
    "created_at": "2015-06-21T22:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261230",
    "user": "https://github.com/yuan-zhou"
}
```

<div id="comment:8" align="right">comment:8</div>

It now raises `MIPSolverException` if GLPK returns an error message "basis factorization does not exist". Memory checks are also added. Please review.



---

archive/issue_events_263709.json:
```json
{
    "actor": "https://github.com/yuan-zhou",
    "created_at": "2015-06-21T22:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263709"
}
```



---

archive/issue_events_263710.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-22T21:44:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263710"
}
```



---

archive/issue_events_263711.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-22T21:44:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263711"
}
```



---

archive/issue_comments_261231.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        if c_indices == NULL:\n+            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(int)))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_values == NULL:\n+            sage_free(c_indices)\n+            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(double)))\n```\n\ncan be replaced by \n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_indices == NULL or c_values == NULL:\n+            raise MemoryError\n```\n\nThis occurs twice.\n\n`for 0 < j <= i:` is \"old-style\", you should use \"for j in range(i)\" instead, which is translated into the very same C code.\n\nFinally, this piece of code had bad side-effects:\n\n```\n+        try:\n+            sig_on()\n+            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)\n+            sig_off()\n+        except Exception:\n+            sage_free(c_indices)\n+            sage_free(c_values)\n+            raise MIPSolverException('GLPK : basis factorization does not exist')\n```\n\nIndeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a \"GLPK: basis factorization does not exist\". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.\n\nI don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. \n\nNathann",
    "created_at": "2015-06-22T21:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261231",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:9" align="right">comment:9</div>


```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        if c_indices == NULL:
+            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(int)))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_values == NULL:
+            sage_free(c_indices)
+            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(double)))
```

can be replaced by 

```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_indices == NULL or c_values == NULL:
+            raise MemoryError
```

This occurs twice.

`for 0 < j <= i:` is "old-style", you should use "for j in range(i)" instead, which is translated into the very same C code.

Finally, this piece of code had bad side-effects:

```
+        try:
+            sig_on()
+            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)
+            sig_off()
+        except Exception:
+            sage_free(c_indices)
+            sage_free(c_values)
+            raise MIPSolverException('GLPK : basis factorization does not exist')
```

Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a "GLPK: basis factorization does not exist". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.

I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. 

Nathann



---

archive/issue_comments_261232.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nathanncohen](#comment:9):\n> \n> ```\n> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n> +        if c_indices == NULL:\n> +            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(int)))\n> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n> +        if c_values == NULL:\n> +            sage_free(c_indices)\n> +            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(double)))\n> ```\n> \n> can be replaced by \n> \n> ```\n> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n> +        if c_indices == NULL or c_values == NULL:\n> +            raise MemoryError\n> ```\n> \n> This occurs twice.\n\nNathann, if the second allocation fails, your version would leak the memory of the first allocation. \n\n\n\n> `for 0 < j <= i:` is \"old-style\", you should use \"for j in range(i)\" instead, which is translated into the very same C code.\n> \n> Finally, this piece of code had bad side-effects:\n> \n> ```\n> +        try:\n> +            sig_on()\n> +            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)\n> +            sig_off()\n> +        except Exception:\n> +            sage_free(c_indices)\n> +            sage_free(c_values)\n> +            raise MIPSolverException('GLPK : basis factorization does not exist')\n> ```\n> \n> Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a \"GLPK: basis factorization does not exist\". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.\n> \n> I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. \n\nsig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. \n\nIs there a way to distinguish which signal was caught?",
    "created_at": "2015-06-22T22:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261232",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nathanncohen](#comment:9):
> 
> ```
> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
> +        if c_indices == NULL:
> +            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(int)))
> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
> +        if c_values == NULL:
> +            sage_free(c_indices)
> +            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(double)))
> ```
> 
> can be replaced by 
> 
> ```
> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
> +        if c_indices == NULL or c_values == NULL:
> +            raise MemoryError
> ```
> 
> This occurs twice.

Nathann, if the second allocation fails, your version would leak the memory of the first allocation. 



> `for 0 < j <= i:` is "old-style", you should use "for j in range(i)" instead, which is translated into the very same C code.
> 
> Finally, this piece of code had bad side-effects:
> 
> ```
> +        try:
> +            sig_on()
> +            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)
> +            sig_off()
> +        except Exception:
> +            sage_free(c_indices)
> +            sage_free(c_values)
> +            raise MIPSolverException('GLPK : basis factorization does not exist')
> ```
> 
> Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a "GLPK: basis factorization does not exist". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.
> 
> I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. 

sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. 

Is there a way to distinguish which signal was caught?



---

archive/issue_comments_261233.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n> Nathann, if the second allocation fails, your version would leak the memory of the first allocation. \n\nSorry, I wrote this yesterday evening just before going to sleep and I was exhausted:\n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_indices == NULL or c_values == NULL:\n+            sage_free(c_indices)\n+            sage_free(c_values)\n+            raise MemoryError\n```\n\n> sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. \n\nOh, okay. Sorry.\n\n> Is there a way to distinguish which signal was caught?\n\nJust type \"raise\" instead of \"raise <something>\". It will raise what was caught. You can also use this model:\n\n```\ntry:\n    your_glpk_function(...)\nelse: # only executed if everything went well\n    <copy the C data wherever you need>\nfinally: #whatever happens\n    <free the memory>\nreturn <whatever you need> \n```\n\nAlso, I don't think you should both with a loop of 'append'. Something like `values = [c_values[j] for j in range(i)]` works fine.\n\nNathann",
    "created_at": "2015-06-23T07:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261233",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

> Nathann, if the second allocation fails, your version would leak the memory of the first allocation. 

Sorry, I wrote this yesterday evening just before going to sleep and I was exhausted:

```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_indices == NULL or c_values == NULL:
+            sage_free(c_indices)
+            sage_free(c_values)
+            raise MemoryError
```

> sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. 

Oh, okay. Sorry.

> Is there a way to distinguish which signal was caught?

Just type "raise" instead of "raise <something>". It will raise what was caught. You can also use this model:

```
try:
    your_glpk_function(...)
else: # only executed if everything went well
    <copy the C data wherever you need>
finally: #whatever happens
    <free the memory>
return <whatever you need> 
```

Also, I don't think you should both with a loop of 'append'. Something like `values = [c_values[j] for j in range(i)]` works fine.

Nathann



---

archive/issue_comments_261234.json:
```json
{
    "body": "Changed branch from **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**",
    "created_at": "2015-06-23T07:42:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261234",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**



---

archive/issue_comments_261235.json:
```json
{
    "body": "Changed commit from **[`1cf22a9`](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)** to **[`3eeebfc`](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)**",
    "created_at": "2015-06-23T07:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1cf22a9`](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)** to **[`3eeebfc`](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)**



---

archive/issue_comments_261236.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65\"><code>3eeebfc</code></a></td><td><code>Restructure with try..except..else..finally. Use list comprehension instead of append.</code></td></tr></table>\n",
    "created_at": "2015-06-23T07:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65"><code>3eeebfc</code></a></td><td><code>Restructure with try..except..else..finally. Use list comprehension instead of append.</code></td></tr></table>




---

archive/issue_comments_261237.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks for the suggestions; I've made these changes. Needs review.",
    "created_at": "2015-06-23T07:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261237",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks for the suggestions; I've made these changes. Needs review.



---

archive/issue_events_263712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T07:55:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263712"
}
```



---

archive/issue_events_263713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T07:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263713"
}
```



---

archive/issue_comments_261238.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n`except Exception: raise` is useless, isn't it?\n\nCould you also update the malloc blocks?",
    "created_at": "2015-06-23T08:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261238",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

`except Exception: raise` is useless, isn't it?

Could you also update the malloc blocks?



---

archive/issue_comments_261239.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/268eceb146ae99da8f970906be5ea36b8755ded5\"><code>268eceb</code></a></td><td><code>Simplify memory allocation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0\"><code>e2b25e2</code></a></td><td><code>Simplify try statements</code></td></tr></table>\n",
    "created_at": "2015-06-23T18:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261239",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/268eceb146ae99da8f970906be5ea36b8755ded5"><code>268eceb</code></a></td><td><code>Simplify memory allocation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0"><code>e2b25e2</code></a></td><td><code>Simplify try statements</code></td></tr></table>




---

archive/issue_comments_261240.json:
```json
{
    "body": "Changed commit from **[`3eeebfc`](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)** to **[`e2b25e2`](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)**",
    "created_at": "2015-06-23T18:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261240",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3eeebfc`](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)** to **[`e2b25e2`](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)**



---

archive/issue_comments_261241.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@nathanncohen](#comment:16):\n> `except Exception: raise` is useless, isn't it?\n\nYou are right, of course. I've removed it.\n\n> Could you also update the malloc blocks?\n\nDone.",
    "created_at": "2015-06-23T18:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261241",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@nathanncohen](#comment:16):
> `except Exception: raise` is useless, isn't it?

You are right, of course. I've removed it.

> Could you also update the malloc blocks?

Done.



---

archive/issue_comments_261242.json:
```json
{
    "body": "Reviewer: **Nathann Cohen**",
    "created_at": "2015-06-23T21:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261242",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Nathann Cohen**



---

archive/issue_comments_261243.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHello !\n\nI made some modifications, in a commit at public/18732:\n\n- The first line of each docstring must be a short sentence describing what the function does\n\n- Some inequations could be turned into latex formulas\n\n- A row/col problem? Please check\n\n  ```\n  -        cdef int n = glp_get_num_rows(self.lp)\n  +        cdef int n = glp_get_num_cols(self.lp)\n  ```\n\nIf you agree with this, you can set the ticket's status to `positive_review`.\n\nNathann\n\nP.S.: Please fill the 'author' field.",
    "created_at": "2015-06-23T21:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261243",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:19" align="right">comment:19</div>

Hello !

I made some modifications, in a commit at public/18732:

- The first line of each docstring must be a short sentence describing what the function does

- Some inequations could be turned into latex formulas

- A row/col problem? Please check

  ```
  -        cdef int n = glp_get_num_rows(self.lp)
  +        cdef int n = glp_get_num_cols(self.lp)
  ```

If you agree with this, you can set the ticket's status to `positive_review`.

Nathann

P.S.: Please fill the 'author' field.



---

archive/issue_comments_261244.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)**",
    "created_at": "2015-06-23T23:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261244",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)**



---

archive/issue_comments_261245.json:
```json
{
    "body": "Author: **Yuan Zhou, Matthias Koeppe**",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261245",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Yuan Zhou, Matthias Koeppe**



---

archive/issue_comments_261246.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI agree with your changes. Thanks!\n\nI have made another minor change to the docstrings to correctly reflect the type of exception that is raised.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5a15613f7c1079c59dbfa0404d1beb5add20abb\"><code>f5a1561</code></a></td><td><code>trac #18732: superficial changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4\"><code>3c0da60</code></a></td><td><code>Update docstrings regarding exceptions raised</code></td></tr></table>\n",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261246",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

I agree with your changes. Thanks!

I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5a15613f7c1079c59dbfa0404d1beb5add20abb"><code>f5a1561</code></a></td><td><code>trac #18732: superficial changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4"><code>3c0da60</code></a></td><td><code>Update docstrings regarding exceptions raised</code></td></tr></table>




---

archive/issue_comments_261247.json:
```json
{
    "body": "Changed commit from **[`e2b25e2`](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)** to **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261247",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`e2b25e2`](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)** to **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**



---

archive/issue_events_263714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T23:53:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263714"
}
```



---

archive/issue_events_263715.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T23:53:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263715"
}
```



---

archive/issue_comments_261248.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.\n\n+1\n\nNathann",
    "created_at": "2015-06-24T07:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261248",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">comment:22</div>

> I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.

+1

Nathann



---

archive/issue_comments_261249.json:
```json
{
    "body": "Changed branch from **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)** to **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**",
    "created_at": "2015-06-24T11:37:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-261249",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)** to **[`3c0da60`](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**



---

archive/issue_events_263716.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-24T11:37:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263716"
}
```



---

archive/issue_events_263717.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "046eaebec803e10eaead5600b480e2fc0131d73f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-24T11:37:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-263717"
}
```
