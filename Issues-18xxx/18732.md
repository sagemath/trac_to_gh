# Issue 18732: Add tableau query functions glp_eval_tab_row, glp_eval_tab_col to GLPK backend

archive/issues_018495.json:
```json
{
    "assignees": [],
    "body": "Expose the GLPK functions glp_eval_tab_row, glp_eval_tab_col in Sage's GLPKBackend class.\n\nSee [GLPK manual](http://fossies.org/linux/glpk/doc/glpk.pdf), section 4.3 \"Simplex tableau routines\".\n\nOne needs these functions if one wants to implement tableau cutting planes such as Gomory's fractional cut.\n\n\n\nCC:  @nathanncohen @yuan-zhou zwang @jdemeyer\n\nKeywords: **LP, glpk**\n\nBranch/Commit: **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**\n\nReviewer: **Nathann Cohen**\n\nAuthor: **Yuan Zhou, Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18732_\n\n",
    "closed_at": "2015-06-24T11:37:10Z",
    "created_at": "2015-06-19T03:05:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20numerical",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add tableau query functions glp_eval_tab_row, glp_eval_tab_col to GLPK backend",
    "type": "issue",
    "updated_at": "2015-06-24T11:37:10Z",
    "url": "https://github.com/sagemath/sage/issues/18732",
    "user": "https://github.com/mkoeppe"
}
```
Expose the GLPK functions glp_eval_tab_row, glp_eval_tab_col in Sage's GLPKBackend class.

See [GLPK manual](http://fossies.org/linux/glpk/doc/glpk.pdf), section 4.3 "Simplex tableau routines".

One needs these functions if one wants to implement tableau cutting planes such as Gomory's fractional cut.



CC:  @nathanncohen @yuan-zhou zwang @jdemeyer

Keywords: **LP, glpk**

Branch/Commit: **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**

Reviewer: **Nathann Cohen**

Author: **Yuan Zhou, Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/18732_





---

archive/issue_events_239356.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239356"
}
```



---

archive/issue_events_239357.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20numerical",
    "label_color": "0000ff",
    "label_name": "component: numerical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239357"
}
```



---

archive/issue_events_239358.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239358"
}
```



---

archive/issue_events_239359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-19T03:05:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239359"
}
```



---

archive/issue_comments_263827.json:
```json
{
    "body": "Changed author from **ncohen, yzh** to none",
    "created_at": "2015-06-19T03:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263827",
    "user": "https://github.com/yuan-zhou"
}
```

Changed author from **ncohen, yzh** to none



---

archive/issue_comments_263828.json:
```json
{
    "body": "Branch: **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**",
    "created_at": "2015-06-21T10:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263828",
    "user": "https://github.com/yuan-zhou"
}
```

Branch: **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**



---

archive/issue_comments_263829.json:
```json
{
    "body": "Commit: **[380dfb5](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)**",
    "created_at": "2015-06-21T10:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263829",
    "user": "https://github.com/nathanncohen"
}
```

Commit: **[380dfb5](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)**



---

archive/issue_comments_263830.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nHello !\n\nCould you allocate memory *after* raising an exception? Otherwise, those exceptions trigger memory leaks.\n\n`sig_on` and `sig_off` should always appear in pairs, but perhaps you should use `sig_check` in this special case?\nhttp://www.sagemath.org/documentation/html/en/developer/coding_in_cython.html#interrupt-and-signal-handling\n\nCan you check that the pointers you allocate are not 'null'?\n\nNathann\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e\">380dfb5</a></td><td><code>Add tableau query functions eval_tab_row, eval_tab_col to GLPK backend.</code></td></tr></table>\n",
    "created_at": "2015-06-21T10:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263830",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'>Comment 4:</a>
Hello !

Could you allocate memory *after* raising an exception? Otherwise, those exceptions trigger memory leaks.

`sig_on` and `sig_off` should always appear in pairs, but perhaps you should use `sig_check` in this special case?
http://www.sagemath.org/documentation/html/en/developer/coding_in_cython.html#interrupt-and-signal-handling

Can you check that the pointers you allocate are not 'null'?

Nathann

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e">380dfb5</a></td><td><code>Add tableau query functions eval_tab_row, eval_tab_col to GLPK backend.</code></td></tr></table>




---

archive/issue_comments_263831.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBonjour Nathann,\n\nThanks for the reference! It says that `sig_str` behaves the same as `sig_on`. I just mimic the code in the `GLPKBackend.solve` and `GLPKBackend.row` methods.\n\nDoes one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?\n\nHow to check that the pointers are not 'null'?\n\nYuan",
    "created_at": "2015-06-21T11:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263831",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:5'>Comment 5:</a>
Bonjour Nathann,

Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`. I just mimic the code in the `GLPKBackend.solve` and `GLPKBackend.row` methods.

Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?

How to check that the pointers are not 'null'?

Yuan



---

archive/issue_comments_263832.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nHelloooooo,\n\n> Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`.\n\nOh. My mistake. I did not notice `sig_str`, and did not even know about it. Sorry.\n\n> Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?\n\nWell, if you allocate memory somewhere and the function ends, then it is never deallocated. If you can avoid this easily, it is better to do it.\n\n> How to check that the pointers are not 'null'?\n\nwith \"if my_pointer == NULL\" ?\n\nNathann",
    "created_at": "2015-06-21T11:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263832",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'>Comment 6:</a>
Helloooooo,

> Thanks for the reference! It says that `sig_str` behaves the same as `sig_on`.

Oh. My mistake. I did not notice `sig_str`, and did not even know about it. Sorry.

> Does one need to deallocate the memory if an Error is raised between `sig_on` and `sig_off`?

Well, if you allocate memory somewhere and the function ends, then it is never deallocated. If you can avoid this easily, it is better to do it.

> How to check that the pointers are not 'null'?

with "if my_pointer == NULL" ?

Nathann



---

archive/issue_comments_263833.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a\">1cf22a9</a></td><td><code>Fix memory leaks and check null pointer in eval_tab_row(), eval_tab_col().</code></td></tr></table>\n",
    "created_at": "2015-06-21T22:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263833",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a">1cf22a9</a></td><td><code>Fix memory leaks and check null pointer in eval_tab_row(), eval_tab_col().</code></td></tr></table>




---

archive/issue_comments_263834.json:
```json
{
    "body": "Changed commit from **[380dfb5](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)** to **[1cf22a9](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)**",
    "created_at": "2015-06-21T22:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263834",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[380dfb5](https://github.com/sagemath/sagetrac-mirror/commit/380dfb55b3966cd836fa1fbdc8325a9b3df8920e)** to **[1cf22a9](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)**



---

archive/issue_comments_263835.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIt now raises `MIPSolverException` if GLPK returns an error message \"basis factorization does not exist\". Memory checks are also added. Please review.",
    "created_at": "2015-06-21T22:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263835",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:8'>Comment 8:</a>
It now raises `MIPSolverException` if GLPK returns an error message "basis factorization does not exist". Memory checks are also added. Please review.



---

archive/issue_events_239360.json:
```json
{
    "actor": "https://github.com/yuan-zhou",
    "created_at": "2015-06-21T22:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239360"
}
```



---

archive/issue_events_239361.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-22T21:44:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239361"
}
```



---

archive/issue_events_239362.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-22T21:44:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239362"
}
```



---

archive/issue_comments_263836.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        if c_indices == NULL:\n+            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(int)))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_values == NULL:\n+            sage_free(c_indices)\n+            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(double)))\n```\n\ncan be replaced by \n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_indices == NULL or c_values == NULL:\n+            raise MemoryError\n```\n\nThis occurs twice.\n\n`for 0 < j <= i:` is \"old-style\", you should use \"for j in range(i)\" instead, which is translated into the very same C code.\n\nFinally, this piece of code had bad side-effects:\n\n```\n+        try:\n+            sig_on()\n+            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)\n+            sig_off()\n+        except Exception:\n+            sage_free(c_indices)\n+            sage_free(c_values)\n+            raise MIPSolverException('GLPK : basis factorization does not exist')\n```\n\nIndeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a \"GLPK: basis factorization does not exist\". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.\n\nI don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. \n\nNathann",
    "created_at": "2015-06-22T21:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263836",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'>Comment 9:</a>

```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        if c_indices == NULL:
+            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(int)))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_values == NULL:
+            sage_free(c_indices)
+            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(double)))
```

can be replaced by 

```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_indices == NULL or c_values == NULL:
+            raise MemoryError
```

This occurs twice.

`for 0 < j <= i:` is "old-style", you should use "for j in range(i)" instead, which is translated into the very same C code.

Finally, this piece of code had bad side-effects:

```
+        try:
+            sig_on()
+            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)
+            sig_off()
+        except Exception:
+            sage_free(c_indices)
+            sage_free(c_values)
+            raise MIPSolverException('GLPK : basis factorization does not exist')
```

Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a "GLPK: basis factorization does not exist". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.

I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. 

Nathann



---

archive/issue_comments_263837.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@nathanncohen](#comment%3A9):\n> \n> ```\n> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n> +        if c_indices == NULL:\n> +            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(int)))\n> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n> +        if c_values == NULL:\n> +            sage_free(c_indices)\n> +            raise MemoryError(\"failed to allocate %s bytes\" % ((n+1)*sizeof(double)))\n> ```\n> \n> can be replaced by \n> \n> ```\n> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n> +        if c_indices == NULL or c_values == NULL:\n> +            raise MemoryError\n> ```\n> \n> This occurs twice.\n\nNathann, if the second allocation fails, your version would leak the memory of the first allocation. \n\n\n\n> `for 0 < j <= i:` is \"old-style\", you should use \"for j in range(i)\" instead, which is translated into the very same C code.\n> \n> Finally, this piece of code had bad side-effects:\n> \n> ```\n> +        try:\n> +            sig_on()\n> +            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)\n> +            sig_off()\n> +        except Exception:\n> +            sage_free(c_indices)\n> +            sage_free(c_values)\n> +            raise MIPSolverException('GLPK : basis factorization does not exist')\n> ```\n> \n> Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a \"GLPK: basis factorization does not exist\". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.\n> \n> I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. \n\nsig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. \n\nIs there a way to distinguish which signal was caught?",
    "created_at": "2015-06-22T22:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@nathanncohen](#comment%3A9):
> 
> ```
> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
> +        if c_indices == NULL:
> +            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(int)))
> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
> +        if c_values == NULL:
> +            sage_free(c_indices)
> +            raise MemoryError("failed to allocate %s bytes" % ((n+1)*sizeof(double)))
> ```
> 
> can be replaced by 
> 
> ```
> +        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
> +        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
> +        if c_indices == NULL or c_values == NULL:
> +            raise MemoryError
> ```
> 
> This occurs twice.

Nathann, if the second allocation fails, your version would leak the memory of the first allocation. 



> `for 0 < j <= i:` is "old-style", you should use "for j in range(i)" instead, which is translated into the very same C code.
> 
> Finally, this piece of code had bad side-effects:
> 
> ```
> +        try:
> +            sig_on()
> +            i = glp_eval_tab_row(self.lp, k + 1, c_indices, c_values)
> +            sig_off()
> +        except Exception:
> +            sage_free(c_indices)
> +            sage_free(c_values)
> +            raise MIPSolverException('GLPK : basis factorization does not exist')
> ```
> 
> Indeed, as it catches everything and only raises MIPSolverException, it can transform a KeyboardInterrupt into a "GLPK: basis factorization does not exist". And of course the C function `glp_eval_tab_row` cannot be expected to raise any exception.
> 
> I don't think that it is worth adding a sig_on/sig_off in this function, considering how short it is. 

sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. 

Is there a way to distinguish which signal was caught?



---

archive/issue_comments_263838.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\n> Nathann, if the second allocation fails, your version would leak the memory of the first allocation. \n\nSorry, I wrote this yesterday evening just before going to sleep and I was exhausted:\n\n```\n+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))\n+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))\n+        if c_indices == NULL or c_values == NULL:\n+            sage_free(c_indices)\n+            sage_free(c_values)\n+            raise MemoryError\n```\n\n> sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. \n\nOh, okay. Sorry.\n\n> Is there a way to distinguish which signal was caught?\n\nJust type \"raise\" instead of \"raise <something>\". It will raise what was caught. You can also use this model:\n\n```\ntry:\n    your_glpk_function(...)\nelse: # only executed if everything went well\n    <copy the C data wherever you need>\nfinally: #whatever happens\n    <free the memory>\nreturn <whatever you need> \n```\n\nAlso, I don't think you should both with a loop of 'append'. Something like `values = [c_values[j] for j in range(i)]` works fine.\n\nNathann",
    "created_at": "2015-06-23T07:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263838",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'>Comment 12:</a>
> Nathann, if the second allocation fails, your version would leak the memory of the first allocation. 

Sorry, I wrote this yesterday evening just before going to sleep and I was exhausted:

```
+        cdef int * c_indices = <int*> sage_malloc((n+1)*sizeof(int))
+        cdef double * c_values = <double*> sage_malloc((n+1)*sizeof(double))
+        if c_indices == NULL or c_values == NULL:
+            sage_free(c_indices)
+            sage_free(c_values)
+            raise MemoryError
```

> sig_on/sig_off catches all kinds of signals, and here it is used to catch SIGABRT, which GLPK invokes via abort() whenever there is an error. 

Oh, okay. Sorry.

> Is there a way to distinguish which signal was caught?

Just type "raise" instead of "raise <something>". It will raise what was caught. You can also use this model:

```
try:
    your_glpk_function(...)
else: # only executed if everything went well
    <copy the C data wherever you need>
finally: #whatever happens
    <free the memory>
return <whatever you need> 
```

Also, I don't think you should both with a loop of 'append'. Something like `values = [c_values[j] for j in range(i)]` works fine.

Nathann



---

archive/issue_comments_263839.json:
```json
{
    "body": "Changed branch from **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**",
    "created_at": "2015-06-23T07:42:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263839",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/yzh/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)**



---

archive/issue_comments_263840.json:
```json
{
    "body": "Changed commit from **[1cf22a9](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)** to **[3eeebfc](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)**",
    "created_at": "2015-06-23T07:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263840",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1cf22a9](https://github.com/sagemath/sagetrac-mirror/commit/1cf22a926b785affdf53e33ea30c539850ae406a)** to **[3eeebfc](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)**



---

archive/issue_comments_263841.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65\">3eeebfc</a></td><td><code>Restructure with try..except..else..finally. Use list comprehension instead of append.</code></td></tr></table>\n",
    "created_at": "2015-06-23T07:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263841",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65">3eeebfc</a></td><td><code>Restructure with try..except..else..finally. Use list comprehension instead of append.</code></td></tr></table>




---

archive/issue_comments_263842.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThanks for the suggestions; I've made these changes. Needs review.",
    "created_at": "2015-06-23T07:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263842",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Thanks for the suggestions; I've made these changes. Needs review.



---

archive/issue_events_239363.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T07:55:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239363"
}
```



---

archive/issue_events_239364.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T07:55:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239364"
}
```



---

archive/issue_comments_263843.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\n`except Exception: raise` is useless, isn't it?\n\nCould you also update the malloc blocks?",
    "created_at": "2015-06-23T08:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263843",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'>Comment 16:</a>
`except Exception: raise` is useless, isn't it?

Could you also update the malloc blocks?



---

archive/issue_comments_263844.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/268eceb146ae99da8f970906be5ea36b8755ded5\">268eceb</a></td><td><code>Simplify memory allocation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0\">e2b25e2</a></td><td><code>Simplify try statements</code></td></tr></table>\n",
    "created_at": "2015-06-23T18:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263844",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/268eceb146ae99da8f970906be5ea36b8755ded5">268eceb</a></td><td><code>Simplify memory allocation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0">e2b25e2</a></td><td><code>Simplify try statements</code></td></tr></table>




---

archive/issue_comments_263845.json:
```json
{
    "body": "Changed commit from **[3eeebfc](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)** to **[e2b25e2](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)**",
    "created_at": "2015-06-23T18:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263845",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3eeebfc](https://github.com/sagemath/sagetrac-mirror/commit/3eeebfcaf555629b3041d0ad4e10fd097365de65)** to **[e2b25e2](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)**



---

archive/issue_comments_263846.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@nathanncohen](#comment%3A16):\n> `except Exception: raise` is useless, isn't it?\n\nYou are right, of course. I've removed it.\n\n> Could you also update the malloc blocks?\n\nDone.",
    "created_at": "2015-06-23T18:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263846",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@nathanncohen](#comment%3A16):
> `except Exception: raise` is useless, isn't it?

You are right, of course. I've removed it.

> Could you also update the malloc blocks?

Done.



---

archive/issue_comments_263847.json:
```json
{
    "body": "Reviewer: **Nathann Cohen**",
    "created_at": "2015-06-23T21:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263847",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Nathann Cohen**



---

archive/issue_comments_263848.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nHello !\n\nI made some modifications, in a commit at public/18732:\n\n- The first line of each docstring must be a short sentence describing what the function does\n\n- Some inequations could be turned into latex formulas\n\n- A row/col problem? Please check\n\n  ```\n  -        cdef int n = glp_get_num_rows(self.lp)\n  +        cdef int n = glp_get_num_cols(self.lp)\n  ```\n\nIf you agree with this, you can set the ticket's status to `positive_review`.\n\nNathann\n\nP.S.: Please fill the 'author' field.",
    "created_at": "2015-06-23T21:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263848",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:19'>Comment 19:</a>
Hello !

I made some modifications, in a commit at public/18732:

- The first line of each docstring must be a short sentence describing what the function does

- Some inequations could be turned into latex formulas

- A row/col problem? Please check

  ```
  -        cdef int n = glp_get_num_rows(self.lp)
  +        cdef int n = glp_get_num_cols(self.lp)
  ```

If you agree with this, you can set the ticket's status to `positive_review`.

Nathann

P.S.: Please fill the 'author' field.



---

archive/issue_comments_263849.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)**",
    "created_at": "2015-06-23T23:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263849",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/add_tableau_query_functions_glp_eval_tab_row__glp_eval_tab_col_to_glpk_backend)** to **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)**



---

archive/issue_comments_263850.json:
```json
{
    "body": "Author: **Yuan Zhou, Matthias Koeppe**",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263850",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Yuan Zhou, Matthias Koeppe**



---

archive/issue_comments_263851.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI agree with your changes. Thanks!\n\nI have made another minor change to the docstrings to correctly reflect the type of exception that is raised.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5a15613f7c1079c59dbfa0404d1beb5add20abb\">f5a1561</a></td><td><code>trac #18732: superficial changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4\">3c0da60</a></td><td><code>Update docstrings regarding exceptions raised</code></td></tr></table>\n",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
I agree with your changes. Thanks!

I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5a15613f7c1079c59dbfa0404d1beb5add20abb">f5a1561</a></td><td><code>trac #18732: superficial changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4">3c0da60</a></td><td><code>Update docstrings regarding exceptions raised</code></td></tr></table>




---

archive/issue_comments_263852.json:
```json
{
    "body": "Changed commit from **[e2b25e2](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)** to **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**",
    "created_at": "2015-06-23T23:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263852",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[e2b25e2](https://github.com/sagemath/sagetrac-mirror/commit/e2b25e2ace4888a84140b1f52165cea19653f9e0)** to **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**



---

archive/issue_events_239365.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T23:53:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239365"
}
```



---

archive/issue_events_239366.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2015-06-23T23:53:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239366"
}
```



---

archive/issue_comments_263853.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n> I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.\n\n+1\n\nNathann",
    "created_at": "2015-06-24T07:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263853",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'>Comment 22:</a>
> I have made another minor change to the docstrings to correctly reflect the type of exception that is raised.

+1

Nathann



---

archive/issue_comments_263854.json:
```json
{
    "body": "Changed branch from **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)** to **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**",
    "created_at": "2015-06-24T11:37:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18732#issuecomment-263854",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/18732](https://github.com/sagemath/sagetrac-mirror/tree/public/18732)** to **[3c0da60](https://github.com/sagemath/sagetrac-mirror/commit/3c0da609a36bd5832cf6a9f11895e993971731c4)**



---

archive/issue_events_239367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-24T11:37:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239367"
}
```



---

archive/issue_events_239368.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "046eaebec803e10eaead5600b480e2fc0131d73f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-24T11:37:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18732",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18732#event-239368"
}
```
