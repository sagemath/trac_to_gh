# Issue 18438: Race between building and using python

archive/issues_018201.json:
```json
{
    "body": "I think what happened below is that the build system tried to use the sage-download-file script while Python was in the process of being installed. Rebuild works. We should probably use sage-native-execute python:\n\n```\nFound local metadata for ntl-6.2.1.p0\nAttempting to download package ntl-6.2.1.p0\nCould not find platform dependent libraries <exec_prefix>\nConsider setting $PYTHONHOME to <prefix>[:<exec_prefix>]\nTraceback (most recent call last):\n  File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/src/bin/sage-download-file\", line 11, in <module>\n    import contextlib\n  File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py\", line 4, in <module>\n    from functools import wraps\n  File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/functools.py\", line 10, in <module>\n    from _functools import partial, reduce\nImportError: No module named _functools\nError: spkg file '/mnt/disk/home/buildslave-sage/slave/sage_git/build/upstream/ntl-6.2.1.tar.bz2' not found.\nThis shouldn't happen, it is a bug in the sage-spkg script.\n```\n\nAssignee: @embray\n\nKeywords: random_fail\n\nBranch/Commit: d84bfb620292949c4b84d10baf15e45888a6a390\n\nReviewer: Dima Pasechnik\n\nAuthor: Volker Braun, Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18438\n\n",
    "closed_at": "2018-09-15T09:05:05Z",
    "created_at": "2015-05-18T08:15:51Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Race between building and using python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18438",
    "user": "https://github.com/vbraun"
}
```
I think what happened below is that the build system tried to use the sage-download-file script while Python was in the process of being installed. Rebuild works. We should probably use sage-native-execute python:

```
Found local metadata for ntl-6.2.1.p0
Attempting to download package ntl-6.2.1.p0
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
Traceback (most recent call last):
  File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/src/bin/sage-download-file", line 11, in <module>
    import contextlib
  File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py", line 4, in <module>
    from functools import wraps
  File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/functools.py", line 10, in <module>
    from _functools import partial, reduce
ImportError: No module named _functools
Error: spkg file '/mnt/disk/home/buildslave-sage/slave/sage_git/build/upstream/ntl-6.2.1.tar.bz2' not found.
This shouldn't happen, it is a bug in the sage-spkg script.
```

Assignee: @embray

Keywords: random_fail

Branch/Commit: d84bfb620292949c4b84d10baf15e45888a6a390

Reviewer: Dima Pasechnik

Author: Volker Braun, Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18438





---

archive/issue_comments_321484.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/race_between_building_and_using_python\"",
    "created_at": "2015-05-18T23:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321484",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/race_between_building_and_using_python"



---

archive/issue_comments_321485.json:
```json
{
    "body": "Changing commit from \"\" to \"7f5bbf96e9e3eec11dcb6b1adbfaff8f3893fd29\"",
    "created_at": "2015-05-18T23:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321485",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "7f5bbf96e9e3eec11dcb6b1adbfaff8f3893fd29"



---

archive/issue_comments_321486.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2015-05-18T23:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321486",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_321487.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2015-05-18T23:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321487",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_321488.json:
```json
{
    "body": "<a id='comment:3'></a>`sage-native-execute` doesn't get rid of the whole Sage environment, we need something slightly different here that keeps `SAGE_ROOT` but resets `PATH`. This is now named `sage-system-python`",
    "created_at": "2015-05-18T23:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321488",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>`sage-native-execute` doesn't get rid of the whole Sage environment, we need something slightly different here that keeps `SAGE_ROOT` but resets `PATH`. This is now named `sage-system-python`



---

archive/issue_comments_321489.json:
```json
{
    "body": "<a id='comment:4'></a>There's way more necessary to use the system python! If you don't reset library paths and python search paths, you're setting yourself up for failure. #9386 is just some sh-style issues away from finalization and will provide proper environment reset tools, in a fairly efficient manner. Perhaps it's better to build on that? If you want to preserve SAGE_ROOT, you could remove it from the to-be-restored list, or set `export SAGE_SAVED_SAGE_ROOT=$SAGE_ROOT` (which means we should perhaps document a process to tweak restores).",
    "created_at": "2015-05-19T04:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321489",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>There's way more necessary to use the system python! If you don't reset library paths and python search paths, you're setting yourself up for failure. #9386 is just some sh-style issues away from finalization and will provide proper environment reset tools, in a fairly efficient manner. Perhaps it's better to build on that? If you want to preserve SAGE_ROOT, you could remove it from the to-be-restored list, or set `export SAGE_SAVED_SAGE_ROOT=$SAGE_ROOT` (which means we should perhaps document a process to tweak restores).



---

archive/issue_comments_321490.json:
```json
{
    "body": "<a id='comment:5'></a>Well if #9386 can be finished then that would be great... but it didn't appear to be that close.",
    "created_at": "2015-05-19T06:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321490",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>Well if #9386 can be finished then that would be great... but it didn't appear to be that close.



---

archive/issue_comments_321491.json:
```json
{
    "body": "<a id='comment:6'></a>From experience I know that if you are going to run a different python, you'll have to set PYTHONPATH and PYTHONHOME to the appropiate (previous) values too. I ran into this problem with a start-up script (in python) for magma. It didn't use anything fancy from Python, but at some point my system python and sage python (or their c-libs) were sufficiently different that the sage python libraries (picked up via PYTHONPATH, which was normally unset on my system) prevented python from running successfully.",
    "created_at": "2015-05-20T15:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321491",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'></a>From experience I know that if you are going to run a different python, you'll have to set PYTHONPATH and PYTHONHOME to the appropiate (previous) values too. I ran into this problem with a start-up script (in python) for magma. It didn't use anything fancy from Python, but at some point my system python and sage python (or their c-libs) were sufficiently different that the sage python libraries (picked up via PYTHONPATH, which was normally unset on my system) prevented python from running successfully.



---

archive/issue_comments_321492.json:
```json
{
    "body": "<a id='comment:7'></a>The system python ought to work without (=unset) PYTHONPATH/PYTHONHOME, which is what the sage-system-python script does. Of course in more complicated setups you'll need the right values...",
    "created_at": "2015-05-20T22:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321492",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>The system python ought to work without (=unset) PYTHONPATH/PYTHONHOME, which is what the sage-system-python script does. Of course in more complicated setups you'll need the right values...



---

archive/issue_comments_321493.json:
```json
{
    "body": "<a id='comment:8'></a>Here is another failure with more context:\n\n```\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fnmatch.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fork1.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_format.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fpformat.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fractions.pyFound local metadata for ntl-6.2.1.p0\nCould not find platform dependent libraries <exec_prefix>\nConsider setting $PYTHONHOME to <prefix>[:<exec_prefix>]\nTraceback (most recent call last):\n  File \"/mnt/disk/home/release/Sage/src/bin/sage-download-file\", line 11, in <module>\n    import contextlib\n  File \"/mnt/disk/home/release/Sage/local/lib/python2.7/contextlib.py\", line 4, in <module>\n    from functools import wraps\n  File \"/mnt/disk/home/release/Sage/local/lib/python2.7/functools.py\", line 10, in <module>\n    from _functools import partial, reduce\nImportError: No module named _functools\nMakefile:1260: recipe for target '/mnt/disk/home/release/Sage/local/var/lib/sage/installed/ntl-6.2.1.p0' failed\nmake[2]: *** [/mnt/disk/home/release/Sage/local/var/lib/sage/installed/ntl-6.2.1.p0] Error 1\nmake[2]: *** Waiting for unfinished jobs....\n ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_frozen.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_ftplib.py ...\nCompiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_funcattrs.py ...\n```",
    "created_at": "2015-06-28T12:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321493",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Here is another failure with more context:

```
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fnmatch.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fork1.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_format.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fpformat.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_fractions.pyFound local metadata for ntl-6.2.1.p0
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
Traceback (most recent call last):
  File "/mnt/disk/home/release/Sage/src/bin/sage-download-file", line 11, in <module>
    import contextlib
  File "/mnt/disk/home/release/Sage/local/lib/python2.7/contextlib.py", line 4, in <module>
    from functools import wraps
  File "/mnt/disk/home/release/Sage/local/lib/python2.7/functools.py", line 10, in <module>
    from _functools import partial, reduce
ImportError: No module named _functools
Makefile:1260: recipe for target '/mnt/disk/home/release/Sage/local/var/lib/sage/installed/ntl-6.2.1.p0' failed
make[2]: *** [/mnt/disk/home/release/Sage/local/var/lib/sage/installed/ntl-6.2.1.p0] Error 1
make[2]: *** Waiting for unfinished jobs....
 ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_frozen.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_ftplib.py ...
Compiling /mnt/disk/home/release/Sage/local/lib/python2.7/test/test_funcattrs.py ...
```



---

archive/issue_events_051923.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-30T12:00:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18438#event-51923"
}
```



---

archive/issue_comments_321494.json:
```json
{
    "body": "<a id='comment:9'></a>See also #26083 for a similar report with some additional context.  This has been becoming more common as we integrate more Python tools into `sage-spkg`.  I feel that long term `sage-spkg` should be rewritten entirely in Python, but even that would not completely fix this problem.  I agree with the general approach of preferring to use the system Python for the build system; otherwise trying to use tools in `$SAGE_LOCAL` to build `$SAGE_LOCAL` is destined to result in problems.",
    "created_at": "2018-08-30T12:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321494",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>See also #26083 for a similar report with some additional context.  This has been becoming more common as we integrate more Python tools into `sage-spkg`.  I feel that long term `sage-spkg` should be rewritten entirely in Python, but even that would not completely fix this problem.  I agree with the general approach of preferring to use the system Python for the build system; otherwise trying to use tools in `$SAGE_LOCAL` to build `$SAGE_LOCAL` is destined to result in problems.



---

archive/issue_comments_321495.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2018-08-30T12:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321495",
    "user": "https://github.com/embray"
}
```

Changing priority from major to critical.



---

archive/issue_comments_321496.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-09-12T12:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321496",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_321497.json:
```json
{
    "body": "<a id='comment:10'></a>The original branch for this doesn't totally make sense anymore, but I'm testing out a new implementation (which is actually much simpler now that Sage doesn't set PYTHONPATH, PYTHONHOME, LD_LIBRARY_PATH, etc.)  But we also have more build scripts now that rely on Python so many of them also need to be updated.",
    "created_at": "2018-09-12T12:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321497",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>The original branch for this doesn't totally make sense anymore, but I'm testing out a new implementation (which is actually much simpler now that Sage doesn't set PYTHONPATH, PYTHONHOME, LD_LIBRARY_PATH, etc.)  But we also have more build scripts now that rely on Python so many of them also need to be updated.



---

archive/issue_comments_321498.json:
```json
{
    "body": "Changing author from \"Volker Braun\" to \"Volker Braun, Erik Bray\"",
    "created_at": "2018-09-12T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321498",
    "user": "https://github.com/embray"
}
```

Changing author from "Volker Braun" to "Volker Braun, Erik Bray"



---

archive/issue_comments_321499.json:
```json
{
    "body": "Changing commit from \"7f5bbf96e9e3eec11dcb6b1adbfaff8f3893fd29\" to \"39fa36329240bae075cd6c0116ce5b493ab557c7\"",
    "created_at": "2018-09-12T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321499",
    "user": "https://github.com/embray"
}
```

Changing commit from "7f5bbf96e9e3eec11dcb6b1adbfaff8f3893fd29" to "39fa36329240bae075cd6c0116ce5b493ab557c7"



---

archive/issue_comments_321500.json:
```json
{
    "body": "Changing branch from \"u/vbraun/race_between_building_and_using_python\" to \"u/embray/ticket-18438\"",
    "created_at": "2018-09-12T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321500",
    "user": "https://github.com/embray"
}
```

Changing branch from "u/vbraun/race_between_building_and_using_python" to "u/embray/ticket-18438"



---

archive/issue_comments_321501.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-12T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321501",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321502.json:
```json
{
    "body": "<a id='comment:11'></a>I've tested this a few times now on a 16 core machine with different variations of `make -j` from 8 to 16, so there should have been a high likelihood of reproducing the problem (as I confirmed against the unmodified 8.4.beta4), but with this patch I did not have any problems, as expected.\n\n---\nNew commits:",
    "created_at": "2018-09-12T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321502",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>I've tested this a few times now on a 16 core machine with different variations of `make -j` from 8 to 16, so there should have been a high likelihood of reproducing the problem (as I confirmed against the unmodified 8.4.beta4), but with this patch I did not have any problems, as expected.

---
New commits:



---

archive/issue_comments_321503.json:
```json
{
    "body": "<a id='comment:12'></a>Huh. I just tried this on a different system and ran into a teensy problem: It seems, for some reason, that `sage-pip-install` is now using the system pip rather than the one installed in Sage.  Which is odd because I deliberately did *not* update `sage-pip-install`.  It's *supposed* to use Sage's Python online.",
    "created_at": "2018-09-12T12:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321503",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Huh. I just tried this on a different system and ran into a teensy problem: It seems, for some reason, that `sage-pip-install` is now using the system pip rather than the one installed in Sage.  Which is odd because I deliberately did *not* update `sage-pip-install`.  It's *supposed* to use Sage's Python online.



---

archive/issue_comments_321504.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-12T12:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321504",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321505.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-12T13:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321506.json:
```json
{
    "body": "Changing commit from \"39fa36329240bae075cd6c0116ce5b493ab557c7\" to \"e6c18f1697ae33c024a006443eb04715569fe701\"",
    "created_at": "2018-09-12T13:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "39fa36329240bae075cd6c0116ce5b493ab557c7" to "e6c18f1697ae33c024a006443eb04715569fe701"



---

archive/issue_comments_321507.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-12T13:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321507",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321508.json:
```json
{
    "body": "<a id='comment:14'></a>I'm not wild about the workaround in `sage-pip-install` and am open to other ideas.  On the other hand, maybe it's not all bad, as it really emphasizes and ensures that `sage-pip-install` is run with Sage's Python.",
    "created_at": "2018-09-12T13:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321508",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>I'm not wild about the workaround in `sage-pip-install` and am open to other ideas.  On the other hand, maybe it's not all bad, as it really emphasizes and ensures that `sage-pip-install` is run with Sage's Python.



---

archive/issue_comments_321509.json:
```json
{
    "body": "Changing commit from \"e6c18f1697ae33c024a006443eb04715569fe701\" to \"ddafa36338450833a5cdd86eb3fecb16ad0bff0e\"",
    "created_at": "2018-09-12T13:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e6c18f1697ae33c024a006443eb04715569fe701" to "ddafa36338450833a5cdd86eb3fecb16ad0bff0e"



---

archive/issue_comments_321510.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-12T13:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321511.json:
```json
{
    "body": "<a id='comment:16'></a>(Decided to squash to a single commit)",
    "created_at": "2018-09-12T13:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321511",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>(Decided to squash to a single commit)



---

archive/issue_comments_321512.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-12T13:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321512",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321513.json:
```json
{
    "body": "<a id='comment:17'></a>The `sage-flock` thing still causes things to break when installing cypari.  Not sure why I never had this problem in earlier testing.  Maybe I already had `$SAGE_LOCAL` on my `$PATH` to start with for some reason.",
    "created_at": "2018-09-12T13:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321513",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>The `sage-flock` thing still causes things to break when installing cypari.  Not sure why I never had this problem in earlier testing.  Maybe I already had `$SAGE_LOCAL` on my `$PATH` to start with for some reason.



---

archive/issue_comments_321514.json:
```json
{
    "body": "Changing commit from \"ddafa36338450833a5cdd86eb3fecb16ad0bff0e\" to \"d84bfb620292949c4b84d10baf15e45888a6a390\"",
    "created_at": "2018-09-12T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ddafa36338450833a5cdd86eb3fecb16ad0bff0e" to "d84bfb620292949c4b84d10baf15e45888a6a390"



---

archive/issue_comments_321515.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-12T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321516.json:
```json
{
    "body": "<a id='comment:19'></a>I think this is a better middle-ground.  It make sure to run the system Python, but otherwise keeps Sage's `$PATH` configuration.\n\nIf/when this has otherwise positive review I'll squash the commits again.",
    "created_at": "2018-09-12T14:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321516",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>I think this is a better middle-ground.  It make sure to run the system Python, but otherwise keeps Sage's `$PATH` configuration.

If/when this has otherwise positive review I'll squash the commits again.



---

archive/issue_comments_321517.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-12T14:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321517",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321518.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2018-09-14T09:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321518",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_321519.json:
```json
{
    "body": "<a id='comment:20'></a>looks good to me.",
    "created_at": "2018-09-14T09:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321519",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>looks good to me.



---

archive/issue_comments_321520.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-14T09:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321520",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321521.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-18438\" to \"d84bfb620292949c4b84d10baf15e45888a6a390\"",
    "created_at": "2018-09-15T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321521",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-18438" to "d84bfb620292949c4b84d10baf15e45888a6a390"



---

archive/issue_comments_321522.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-15T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18438#issuecomment-321522",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051924.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-15T09:05:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18438",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18438#event-51924"
}
```
