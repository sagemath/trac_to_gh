# Issue 18092: evaluating symbolic expressions (without conversion to SR, i.e., staying in ring of values)

archive/issues_017855.json:
```json
{
    "body": "This ticket proposes a new method `evaluate` which can evaluate symbolic expressions at values coming from a ring which not coerces into `SR`. The result again lives in the ring of the values. This forces the calculation to be done completely in the given ring (and not in the symbolic ring, where sometimes one does not know exactly what's going on).\n\nFor example:\n\n```\nsage: P.<p> = ZZ[[]]\nsage: E = x.evaluate(x=p)\nsage: E, E.parent()\n(p, Power Series Ring in p over Integer Ring)\n```\nwhich is not possible with `subs`\n\n```\nsage: P.<p> = ZZ[[]]\nsage: x.subs(x=p)\nTraceback (most recent call last):\n...\nTypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring\n\nsage: E = x.evaluate(x=p)\nsage: E, E.parent()\np, Power Series Ring in p over Integer Ring)\n```\n\n\nCC:  @cheuberg @mezzarobba\n\nKeywords: sd66\n\nBranch: [u/dkrenn/SR/eval](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/SR/eval)\n\nCommit: [276f0f3d3583c66c7e137350c578e8588c9b236d](https://github.com/sagemath/sagetrac-mirror/commit/276f0f3d3583c66c7e137350c578e8588c9b236d)\n\nAuthor: Daniel Krenn\n\nStatus: needs_info\n\nIssue created by migration from https://trac.sagemath.org/ticket/18092\n\n",
    "created_at": "2015-03-31T12:06:24Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "evaluating symbolic expressions (without conversion to SR, i.e., staying in ring of values)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18092",
    "user": "https://github.com/dkrenn"
}
```
This ticket proposes a new method `evaluate` which can evaluate symbolic expressions at values coming from a ring which not coerces into `SR`. The result again lives in the ring of the values. This forces the calculation to be done completely in the given ring (and not in the symbolic ring, where sometimes one does not know exactly what's going on).

For example:

```
sage: P.<p> = ZZ[[]]
sage: E = x.evaluate(x=p)
sage: E, E.parent()
(p, Power Series Ring in p over Integer Ring)
```
which is not possible with `subs`

```
sage: P.<p> = ZZ[[]]
sage: x.subs(x=p)
Traceback (most recent call last):
...
TypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring

sage: E = x.evaluate(x=p)
sage: E, E.parent()
p, Power Series Ring in p over Integer Ring)
```


CC:  @cheuberg @mezzarobba

Keywords: sd66

Branch: [u/dkrenn/SR/eval](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/SR/eval)

Commit: [276f0f3d3583c66c7e137350c578e8588c9b236d](https://github.com/sagemath/sagetrac-mirror/commit/276f0f3d3583c66c7e137350c578e8588c9b236d)

Author: Daniel Krenn

Status: needs_info

Issue created by migration from https://trac.sagemath.org/ticket/18092





---

archive/issue_comments_316277.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dkrenn/SR/eval\"",
    "created_at": "2015-03-31T12:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316277",
    "user": "https://github.com/dkrenn"
}
```

Changing branch from "" to "u/dkrenn/SR/eval"



---

archive/issue_comments_316278.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-31T12:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316278",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316279.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[9f8d483](https://github.com/sagemath/sagetrac-mirror/commit/9f8d483c72b90ff60f25ccdca4a0da21e9ae7f72)|`create method eval`|\n|[68b65ca](https://github.com/sagemath/sagetrac-mirror/commit/68b65ca8502acc7a0ae98cb47dad2da46939e134)|`rename eval to evaluate`|\n|[24348f7](https://github.com/sagemath/sagetrac-mirror/commit/24348f7bdaed084d2426d0bc4b645ccf0de034e7)|`docstring: output clearified`|\n|[c3d0670](https://github.com/sagemath/sagetrac-mirror/commit/c3d0670b3ff2813675f66f761bd8afba54409b17)|`rename ring to convert_to`|\n|[6449f20](https://github.com/sagemath/sagetrac-mirror/commit/6449f203d95c4bb4ae4ba42639b8697f9d376fd5)|`implement automatic detection when convert_to=None`|\n|[cd29dca](https://github.com/sagemath/sagetrac-mirror/commit/cd29dca3caea91043740bbd8c977a3a00906a380)|`examples rewritten`|\n|[bc2bb47](https://github.com/sagemath/sagetrac-mirror/commit/bc2bb479c170d0e8de59c0052692a6e6641a3762)|`add seealso-block`|\n|[9419e1f](https://github.com/sagemath/sagetrac-mirror/commit/9419e1f0667f2c476f7800eab7da471586aede89)|`fix typo`|\n|[9e83cb2](https://github.com/sagemath/sagetrac-mirror/commit/9e83cb2f3188ff2c5e5dd2d5f621b82f1be36b23)|`docstring for helper function _evaluate_`|\n|[c3696a8](https://github.com/sagemath/sagetrac-mirror/commit/c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796)|`fix links in doc`|",
    "created_at": "2015-03-31T12:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316279",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[9f8d483](https://github.com/sagemath/sagetrac-mirror/commit/9f8d483c72b90ff60f25ccdca4a0da21e9ae7f72)|`create method eval`|
|[68b65ca](https://github.com/sagemath/sagetrac-mirror/commit/68b65ca8502acc7a0ae98cb47dad2da46939e134)|`rename eval to evaluate`|
|[24348f7](https://github.com/sagemath/sagetrac-mirror/commit/24348f7bdaed084d2426d0bc4b645ccf0de034e7)|`docstring: output clearified`|
|[c3d0670](https://github.com/sagemath/sagetrac-mirror/commit/c3d0670b3ff2813675f66f761bd8afba54409b17)|`rename ring to convert_to`|
|[6449f20](https://github.com/sagemath/sagetrac-mirror/commit/6449f203d95c4bb4ae4ba42639b8697f9d376fd5)|`implement automatic detection when convert_to=None`|
|[cd29dca](https://github.com/sagemath/sagetrac-mirror/commit/cd29dca3caea91043740bbd8c977a3a00906a380)|`examples rewritten`|
|[bc2bb47](https://github.com/sagemath/sagetrac-mirror/commit/bc2bb479c170d0e8de59c0052692a6e6641a3762)|`add seealso-block`|
|[9419e1f](https://github.com/sagemath/sagetrac-mirror/commit/9419e1f0667f2c476f7800eab7da471586aede89)|`fix typo`|
|[9e83cb2](https://github.com/sagemath/sagetrac-mirror/commit/9e83cb2f3188ff2c5e5dd2d5f621b82f1be36b23)|`docstring for helper function _evaluate_`|
|[c3696a8](https://github.com/sagemath/sagetrac-mirror/commit/c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796)|`fix links in doc`|



---

archive/issue_comments_316280.json:
```json
{
    "body": "Changing commit from \"\" to \"c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796\"",
    "created_at": "2015-03-31T12:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316280",
    "user": "https://github.com/dkrenn"
}
```

Changing commit from "" to "c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796"



---

archive/issue_comments_316281.json:
```json
{
    "body": "Changing author from \"\" to \"Daniel Krenn\"",
    "created_at": "2015-03-31T12:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316281",
    "user": "https://github.com/dkrenn"
}
```

Changing author from "" to "Daniel Krenn"



---

archive/issue_comments_316282.json:
```json
{
    "body": "<a id='comment:4'></a>\n\n```\n+        The reason is that :meth:`subs` convert its arguments to the\n+        symbolic ring, so we even have::\n+\n+            sage: x.subs(x=RIF(3.42)).parent()\n+            Symbolic Ring\n+\n+        The :meth:`evaluate`-method prevents this conversion and\n```\nI think you misunderstand. `x` is not converted, it is wrapped in an expression:\n\n```\nsage: x.subs(x=RIF(3.42)).pyobject().parent()\nReal Interval Field with 53 bits of precision\n```\nI have no idea if your idea is worth the effort, but suspect that not if it is only based on the necessity to prevent \"conversion\".",
    "created_at": "2015-03-31T12:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316282",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>

```
+        The reason is that :meth:`subs` convert its arguments to the
+        symbolic ring, so we even have::
+
+            sage: x.subs(x=RIF(3.42)).parent()
+            Symbolic Ring
+
+        The :meth:`evaluate`-method prevents this conversion and
```
I think you misunderstand. `x` is not converted, it is wrapped in an expression:

```
sage: x.subs(x=RIF(3.42)).pyobject().parent()
Real Interval Field with 53 bits of precision
```
I have no idea if your idea is worth the effort, but suspect that not if it is only based on the necessity to prevent "conversion".



---

archive/issue_comments_316283.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-`subs` of a symbolic expression converts its values to the symbolic ring before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.\n+`subs` of a symbolic expression wraps its values to the symbolic ring (if possible) before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.\n \n ```\n sage: E = (1+x).evaluate(x=RIF(3.42))\n@@ -7,4 +7,17 @@\n sage: E.parent()\n Real Interval Field with 53 bits of precision\n ```\n+While in the example above you can come over this by doing a conversion afterwards, it changes with power series:\n \n+```\n+sage: P.<p> = ZZ[[]]\n+sage: x.subs(x=p)\n+Traceback (most recent call last):\n+...\n+TypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring\n+\n+sage: E = x.evaluate(x=p)\n+sage: E, E.parent()\n+p, Power Series Ring in p over Integer Ring)\n+```\n+\n``````\n",
    "created_at": "2015-03-31T13:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316283",
    "user": "https://github.com/dkrenn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-`subs` of a symbolic expression converts its values to the symbolic ring before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.
+`subs` of a symbolic expression wraps its values to the symbolic ring (if possible) before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.
 
 ```
 sage: E = (1+x).evaluate(x=RIF(3.42))
@@ -7,4 +7,17 @@
 sage: E.parent()
 Real Interval Field with 53 bits of precision
 ```
+While in the example above you can come over this by doing a conversion afterwards, it changes with power series:
 
+```
+sage: P.<p> = ZZ[[]]
+sage: x.subs(x=p)
+Traceback (most recent call last):
+...
+TypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring
+
+sage: E = x.evaluate(x=p)
+sage: E, E.parent()
+p, Power Series Ring in p over Integer Ring)
+```
+
``````




---

archive/issue_comments_316284.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [rws](#comment%3A4):\n> I think you misunderstand. `x` is not converted, it is wrapped in an expression:\n\n\nOk, I used the wrong word; however, this example was to point out the differences between the two commands.\n\n> {{{\n> sage: x.subs(x=RIF(3.42)).pyobject().parent()\n> Real Interval Field with 53 bits of precision\n> }}}\n> I have no idea if your idea is worth the effort, but suspect that not if it is only based on the necessity to prevent \"conversion\".\n\n\n`subs` is not possible with something that does go into the symbolic ring, like power series:\n\n```\nsage: P.<p> = ZZ[[]]\nsage: x.subs(x=p)\nTraceback (most recent call last):\n...\nTypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring\n\nsage: E = x.evaluate(x=p)\nsage: E, E.parent()\np, Power Series Ring in p over Integer Ring)\n```",
    "created_at": "2015-03-31T13:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316284",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:5'></a>
Replying to [rws](#comment%3A4):
> I think you misunderstand. `x` is not converted, it is wrapped in an expression:


Ok, I used the wrong word; however, this example was to point out the differences between the two commands.

> {{{
> sage: x.subs(x=RIF(3.42)).pyobject().parent()
> Real Interval Field with 53 bits of precision
> }}}
> I have no idea if your idea is worth the effort, but suspect that not if it is only based on the necessity to prevent "conversion".


`subs` is not possible with something that does go into the symbolic ring, like power series:

```
sage: P.<p> = ZZ[[]]
sage: x.subs(x=p)
Traceback (most recent call last):
...
TypeError: no canonical coercion from Power Series Ring in p over Integer Ring to Symbolic Ring

sage: E = x.evaluate(x=p)
sage: E, E.parent()
p, Power Series Ring in p over Integer Ring)
```



---

archive/issue_comments_316285.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd66\".",
    "created_at": "2015-03-31T13:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316285",
    "user": "https://github.com/dkrenn"
}
```

Changing keywords from "" to "sd66".



---

archive/issue_comments_316286.json:
```json
{
    "body": "<a id='comment:7'></a>\nI thought everything coerces to `SR`? Maybe this is just a coercion bug?",
    "created_at": "2015-03-31T13:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316286",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
I thought everything coerces to `SR`? Maybe this is just a coercion bug?



---

archive/issue_comments_316287.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [rws](#comment%3A7):\n> I thought everything coerces to `SR`? Maybe this is just a coercion bug?\n\n\nIMHO, not everything coerces into `SR` and this for a good reason. But this is not (or should not) under discussion here.\n\nThe following is not possible at with subs:\n\n``` \nsage: sage: P.<p> = ZZ[[]]\nsage: var('a,b')\n(a, b)\nsage: (a+b).subs({a: p, b: p^2})\n```\n`evaluate` can do.",
    "created_at": "2015-03-31T14:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316287",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:8'></a>
Replying to [rws](#comment%3A7):
> I thought everything coerces to `SR`? Maybe this is just a coercion bug?


IMHO, not everything coerces into `SR` and this for a good reason. But this is not (or should not) under discussion here.

The following is not possible at with subs:

``` 
sage: sage: P.<p> = ZZ[[]]
sage: var('a,b')
(a, b)
sage: (a+b).subs({a: p, b: p^2})
```
`evaluate` can do.



---

archive/issue_comments_316288.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-03-31T14:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316288",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_316289.json:
```json
{
    "body": "<a id='comment:10'></a>\nHello,\n\nWhy not\n\n```\nsage: E = (1+x).subs(x=RIF(3.42))\nsage: E.parent()\nsage: F = E.pyobject()\nsage: F\n4.4200000000000000?\nsage: F.parent()\nReal Interval Field with 53 bits of precision\n```\n\nVincent",
    "created_at": "2015-03-31T14:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316289",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
Hello,

Why not

```
sage: E = (1+x).subs(x=RIF(3.42))
sage: E.parent()
sage: F = E.pyobject()
sage: F
4.4200000000000000?
sage: F.parent()
Real Interval Field with 53 bits of precision
```

Vincent



---

archive/issue_comments_316290.json:
```json
{
    "body": "Changing commit from \"c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796\" to \"7e0be7f3a76c98d5ec3e5250947aec814467048b\"",
    "created_at": "2015-03-31T15:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c3696a81f65df6e64c5e2bcbdf8905d4f2d5b796" to "7e0be7f3a76c98d5ec3e5250947aec814467048b"



---

archive/issue_comments_316291.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[ba59f5d](https://github.com/sagemath/sagetrac-mirror/commit/ba59f5dfa7b4b98c09f7256da0eccc69c6796e56)|`additional example: inserting power series`|\n|[7e0be7f](https://github.com/sagemath/sagetrac-mirror/commit/7e0be7f3a76c98d5ec3e5250947aec814467048b)|`correct bug when evaluating user-defined functions`|",
    "created_at": "2015-03-31T15:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[ba59f5d](https://github.com/sagemath/sagetrac-mirror/commit/ba59f5dfa7b4b98c09f7256da0eccc69c6796e56)|`additional example: inserting power series`|
|[7e0be7f](https://github.com/sagemath/sagetrac-mirror/commit/7e0be7f3a76c98d5ec3e5250947aec814467048b)|`correct bug when evaluating user-defined functions`|



---

archive/issue_comments_316292.json:
```json
{
    "body": "<a id='comment:12'></a>\nadded a doctest and corrected a small bug",
    "created_at": "2015-03-31T15:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316292",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:12'></a>
added a doctest and corrected a small bug



---

archive/issue_comments_316293.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vdelecroix](#comment%3A10):\n> Why not\n> \n> ```\n> sage: E = (1+x).subs(x=RIF(3.42))\n> sage: E.parent()\n> sage: F = E.pyobject()\n> sage: F\n> 4.4200000000000000?\n> sage: F.parent()\n> Real Interval Field with 53 bits of precision\n> ```\n\n\nOk, I see. Maybe RIFs are not a good example since they coerce into SR. Power series are better\" example; since there problems.\n\nI'll rewrite the description of the ticket and the examples.",
    "created_at": "2015-03-31T15:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316293",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:13'></a>
Replying to [vdelecroix](#comment%3A10):
> Why not
> 
> ```
> sage: E = (1+x).subs(x=RIF(3.42))
> sage: E.parent()
> sage: F = E.pyobject()
> sage: F
> 4.4200000000000000?
> sage: F.parent()
> Real Interval Field with 53 bits of precision
> ```


Ok, I see. Maybe RIFs are not a good example since they coerce into SR. Power series are better" example; since there problems.

I'll rewrite the description of the ticket and the examples.



---

archive/issue_comments_316294.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe general idea is that the result of arithmetic only depends on the parents of the input data, not on the values of the input data (because the idea is that these things implement maps, which have domains and codomains). When you evaluate a SR element at a non-symbolic value, you don't know if the result can live in the parent of the original result (e.g., `(sin(x)+y).subs(y=1)`).\n\nThe appropriate solution is probably to first *convert* your symbolic expression to a parent where the parent is the desired thing, e.g.\n\n```\nsage: f = SR(1+x)\nsage: R.<t>= ZZ[[]]\nsage: P=R['x']\nsage: P(f)(x=t^2+O(t^3))\n```\nThis also has other advantages: in principle, when you do this with RIF, you might end up with an evaluation routine that takes into account that the coefficients are not exact and hence it could choose some more stable way of doing the evaluation (I think that's hypothetical--likely no such effort is made right now, but it could).",
    "created_at": "2015-03-31T15:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316294",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:14'></a>
The general idea is that the result of arithmetic only depends on the parents of the input data, not on the values of the input data (because the idea is that these things implement maps, which have domains and codomains). When you evaluate a SR element at a non-symbolic value, you don't know if the result can live in the parent of the original result (e.g., `(sin(x)+y).subs(y=1)`).

The appropriate solution is probably to first *convert* your symbolic expression to a parent where the parent is the desired thing, e.g.

```
sage: f = SR(1+x)
sage: R.<t>= ZZ[[]]
sage: P=R['x']
sage: P(f)(x=t^2+O(t^3))
```
This also has other advantages: in principle, when you do this with RIF, you might end up with an evaluation routine that takes into account that the coefficients are not exact and hence it could choose some more stable way of doing the evaluation (I think that's hypothetical--likely no such effort is made right now, but it could).



---

archive/issue_comments_316295.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,14 @@\n-`subs` of a symbolic expression wraps its values to the symbolic ring (if possible) before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.\n+This ticket proposes a new method `evaluate` which can evaluate symbolic expressions at values coming from a ring which not coerces into `SR`. The result again lives in the ring of the values. This forces the calculation to be done completely in the given ring (and not in the symbolic ring, where sometimes one does not know exactly what's going on).\n+\n+For example:\n \n ```\n-sage: E = (1+x).evaluate(x=RIF(3.42))\n-sage: E\n-4.4200000000000000?\n-sage: E.parent()\n-Real Interval Field with 53 bits of precision\n+sage: P.<p> = ZZ[[]]\n+sage: E = x.evaluate(x=p)\n+sage: E, E.parent()\n+(p, Power Series Ring in p over Integer Ring)\n ```\n-While in the example above you can come over this by doing a conversion afterwards, it changes with power series:\n+which is not possible with `subs`\n \n ```\n sage: P.<p> = ZZ[[]]\n``````\n",
    "created_at": "2015-03-31T15:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316295",
    "user": "https://github.com/dkrenn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,14 @@
-`subs` of a symbolic expression wraps its values to the symbolic ring (if possible) before performing the actual substitution. This ticket proposes a new method `evaluate` which comes over this.
+This ticket proposes a new method `evaluate` which can evaluate symbolic expressions at values coming from a ring which not coerces into `SR`. The result again lives in the ring of the values. This forces the calculation to be done completely in the given ring (and not in the symbolic ring, where sometimes one does not know exactly what's going on).
+
+For example:
 
 ```
-sage: E = (1+x).evaluate(x=RIF(3.42))
-sage: E
-4.4200000000000000?
-sage: E.parent()
-Real Interval Field with 53 bits of precision
+sage: P.<p> = ZZ[[]]
+sage: E = x.evaluate(x=p)
+sage: E, E.parent()
+(p, Power Series Ring in p over Integer Ring)
 ```
-While in the example above you can come over this by doing a conversion afterwards, it changes with power series:
+which is not possible with `subs`
 
 ```
 sage: P.<p> = ZZ[[]]
``````




---

archive/issue_comments_316296.json:
```json
{
    "body": "Changing commit from \"7e0be7f3a76c98d5ec3e5250947aec814467048b\" to \"276f0f3d3583c66c7e137350c578e8588c9b236d\"",
    "created_at": "2015-03-31T15:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7e0be7f3a76c98d5ec3e5250947aec814467048b" to "276f0f3d3583c66c7e137350c578e8588c9b236d"



---

archive/issue_comments_316297.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[276f0f3](https://github.com/sagemath/sagetrac-mirror/commit/276f0f3d3583c66c7e137350c578e8588c9b236d)|`rewrite documentation (examples) after discussion on trac`|",
    "created_at": "2015-03-31T15:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[276f0f3](https://github.com/sagemath/sagetrac-mirror/commit/276f0f3d3583c66c7e137350c578e8588c9b236d)|`rewrite documentation (examples) after discussion on trac`|



---

archive/issue_comments_316298.json:
```json
{
    "body": "<a id='comment:17'></a>\nrewritten documentation of function",
    "created_at": "2015-03-31T15:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316298",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:17'></a>
rewritten documentation of function



---

archive/issue_comments_316299.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [nbruin](#comment%3A14):\n> The general idea is that the result of arithmetic only depends on the parents of the input data, not on the values of the input data (because the idea is that these things implement maps, which have domains and codomains). When you evaluate a SR element at a non-symbolic value, you don't know if the result can live in the parent of the original result (e.g., `(sin(x)+y).subs(y=1)`).\n\n\nTrue.\n\n> The appropriate solution is probably to first *convert* your symbolic expression to a parent where the parent is the desired thing, e.g.\n> \n> ```\n> sage: f = SR(1+x)\n> sage: R.<t>= ZZ[[]]\n> sage: P=R['x']\n> sage: P(f)(x=t^2+O(t^3))\n> ```\n\n\nWhat if\n\n```\nf = SR(1+2^x)\n```\nor something worse (including e.g. exp, log, sin, ... or other functions)? There are no parents (except SR) for any of these constructs.",
    "created_at": "2015-03-31T15:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316299",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:18'></a>
Replying to [nbruin](#comment%3A14):
> The general idea is that the result of arithmetic only depends on the parents of the input data, not on the values of the input data (because the idea is that these things implement maps, which have domains and codomains). When you evaluate a SR element at a non-symbolic value, you don't know if the result can live in the parent of the original result (e.g., `(sin(x)+y).subs(y=1)`).


True.

> The appropriate solution is probably to first *convert* your symbolic expression to a parent where the parent is the desired thing, e.g.
> 
> ```
> sage: f = SR(1+x)
> sage: R.<t>= ZZ[[]]
> sage: P=R['x']
> sage: P(f)(x=t^2+O(t^3))
> ```


What if

```
f = SR(1+2^x)
```
or something worse (including e.g. exp, log, sin, ... or other functions)? There are no parents (except SR) for any of these constructs.



---

archive/issue_comments_316300.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dkrenn](#comment%3A18):\n> What if\n> \n> ```\n> f = SR(1+2^x)\n> ```\n> or something worse (including e.g. exp, log, sin, ... or other functions)? There are no parents (except SR) for any of these constructs.\n\nAnd indeed it's tricky to evaluate the result. What is `2^<power series>`? I guess `exp(log(2)*x)`, which requires a ring that contains both `log(2)` and inverses of all integers., so that doesn't work in `Z[This is the Trac macro *t* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#t-macro)`. I think Sage is right in putting the onus on the user to first find a parent in which the expression fits and where the evaluation behaviour is the desired one.\n\nAnyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.",
    "created_at": "2015-03-31T16:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316300",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:19'></a>
Replying to [dkrenn](#comment%3A18):
> What if
> 
> ```
> f = SR(1+2^x)
> ```
> or something worse (including e.g. exp, log, sin, ... or other functions)? There are no parents (except SR) for any of these constructs.

And indeed it's tricky to evaluate the result. What is `2^<power series>`? I guess `exp(log(2)*x)`, which requires a ring that contains both `log(2)` and inverses of all integers., so that doesn't work in `Z[This is the Trac macro *t* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#t-macro)`. I think Sage is right in putting the onus on the user to first find a parent in which the expression fits and where the evaluation behaviour is the desired one.

Anyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.



---

archive/issue_comments_316301.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [nbruin](#comment%3A19):\n> Anyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.\n\n\nOk, I'll make some experiments and run some tests to see if it satisfies my needs.\n\nThanks",
    "created_at": "2015-03-31T19:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316301",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:20'></a>
Replying to [nbruin](#comment%3A19):
> Anyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.


Ok, I'll make some experiments and run some tests to see if it satisfies my needs.

Thanks



---

archive/issue_comments_316302.json:
```json
{
    "body": "<a id='comment:21'></a>\nHello,\n\nWould this ticket solve the following issue (from #9787)?\n\n```\nsage: parent(exp(1.2))\nReal Field with 53 bits of precision\nsage: f(x) = exp(x)\nsage: parent(f(1.2))\nSymbolic Ring\n```\n\nVincent",
    "created_at": "2015-04-20T11:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316302",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
Hello,

Would this ticket solve the following issue (from #9787)?

```
sage: parent(exp(1.2))
Real Field with 53 bits of precision
sage: f(x) = exp(x)
sage: parent(f(1.2))
Symbolic Ring
```

Vincent



---

archive/issue_comments_316303.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [vdelecroix](#comment%3A21):\n> Hello,\n> \n> Would this ticket solve the following issue (from #9787)?\n> \n> ```\n> sage: parent(exp(1.2))\n> Real Field with 53 bits of precision\n> sage: f(x) = exp(x)\n> sage: parent(f(1.2))\n> Symbolic Ring\n> ```\n\n\nYes.\n\n```\nsage: f(x).evaluate({x: 1.2}).parent()\nReal Field with 53 bits of precision\n```",
    "created_at": "2015-04-20T11:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316303",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:22'></a>
Replying to [vdelecroix](#comment%3A21):
> Hello,
> 
> Would this ticket solve the following issue (from #9787)?
> 
> ```
> sage: parent(exp(1.2))
> Real Field with 53 bits of precision
> sage: f(x) = exp(x)
> sage: parent(f(1.2))
> Symbolic Ring
> ```


Yes.

```
sage: f(x).evaluate({x: 1.2}).parent()
Real Field with 53 bits of precision
```



---

archive/issue_comments_316304.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [dkrenn](#comment%3A22):\n> Replying to [vdelecroix](#comment%3A21):\n> > Hello,\n> > \n> > Would this ticket solve the following issue (from #9787)?\n> > \n> > ```\n> > sage: parent(exp(1.2))\n> > Real Field with 53 bits of precision\n> > sage: f(x) = exp(x)\n> > sage: parent(f(1.2))\n> > Symbolic Ring\n> > ```\n\n> \n> Yes.\n> \n> ```\n> sage: f(x).evaluate({x: 1.2}).parent()\n> Real Field with 53 bits of precision\n> ```\n\n\nSorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?",
    "created_at": "2015-04-20T11:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316304",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Replying to [dkrenn](#comment%3A22):
> Replying to [vdelecroix](#comment%3A21):
> > Hello,
> > 
> > Would this ticket solve the following issue (from #9787)?
> > 
> > ```
> > sage: parent(exp(1.2))
> > Real Field with 53 bits of precision
> > sage: f(x) = exp(x)
> > sage: parent(f(1.2))
> > Symbolic Ring
> > ```

> 
> Yes.
> 
> ```
> sage: f(x).evaluate({x: 1.2}).parent()
> Real Field with 53 bits of precision
> ```


Sorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?



---

archive/issue_comments_316305.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vdelecroix](#comment%3A23):\n> Replying to [dkrenn](#comment%3A22):\n> > Replying to [vdelecroix](#comment%3A21):\n> > > Would this ticket solve the following issue (from #9787)?\n> > > \n> > > ```\n> > > sage: parent(exp(1.2))\n> > > Real Field with 53 bits of precision\n> > > sage: f(x) = exp(x)\n> > > sage: parent(f(1.2))\n> > > Symbolic Ring\n> > > ```\n\n> > [...]\n> Sorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?\n\n\nNo, not modified by this ticket.",
    "created_at": "2015-04-20T11:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316305",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:24'></a>
Replying to [vdelecroix](#comment%3A23):
> Replying to [dkrenn](#comment%3A22):
> > Replying to [vdelecroix](#comment%3A21):
> > > Would this ticket solve the following issue (from #9787)?
> > > 
> > > ```
> > > sage: parent(exp(1.2))
> > > Real Field with 53 bits of precision
> > > sage: f(x) = exp(x)
> > > sage: parent(f(1.2))
> > > Symbolic Ring
> > > ```

> > [...]
> Sorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?


No, not modified by this ticket.



---

archive/issue_comments_316306.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [dkrenn](#comment%3A24):\n> Replying to [vdelecroix](#comment%3A23):\n> > Replying to [dkrenn](#comment%3A22):\n> > > Replying to [vdelecroix](#comment%3A21):\n> > > > Would this ticket solve the following issue (from #9787)?\n\n> ...\n> > Sorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?\n  \n> \n> No, not modified by this ticket.\n\n\nI saw too late your answer on #9878 ;-)\n\nBy the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. But\n\n```\nsage: f(x) = 2*x\nsage: f.subs(x=3)\nx |--> 6\n```\nie, `f` remains a function. It is hopefully not changed into a number.",
    "created_at": "2015-04-20T11:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316306",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
Replying to [dkrenn](#comment%3A24):
> Replying to [vdelecroix](#comment%3A23):
> > Replying to [dkrenn](#comment%3A22):
> > > Replying to [vdelecroix](#comment%3A21):
> > > > Would this ticket solve the following issue (from #9787)?

> ...
> > Sorry. This was not my question. What would be `parent(f(1.2))`? Is this modified by this ticket?
  
> 
> No, not modified by this ticket.


I saw too late your answer on #9878 ;-)

By the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. But

```
sage: f(x) = 2*x
sage: f.subs(x=3)
x |--> 6
```
ie, `f` remains a function. It is hopefully not changed into a number.



---

archive/issue_comments_316307.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [vdelecroix](#comment%3A25):\n> By the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. \n\n\nIn the following it does the same as subs:\n\n```\nsage:  sage: f(x) = 2*x\nsage:  sage: f(x).subs(x=3)\n6\nsage:  sage: f(x).evaluate(x=3)\n6\n```\n\n> But\n> \n> ```\n> sage: f(x) = 2*x\n> sage: f.subs(x=3)\n> x |--> 6\n> ```\n> ie, `f` remains a function. It is hopefully not changed into a number.\n\n\nIndeed, this changes (I wasn't aware of this up to now):\n\n```\nsage:  sage: f.evaluate(x=3)\n6\n```\nThis is because `evaluate` uses\n\n```\nsage: f.operator()\n<built-in function mul>\nsage: f.operands()\n[x, 2]\n```\nFrom this, `f` is equal to `2*x`. Sage sees these two as equal as well:\n\n```\nsage: bool(f == 2*x)\nTrue\n```",
    "created_at": "2015-04-20T12:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316307",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:26'></a>
Replying to [vdelecroix](#comment%3A25):
> By the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. 


In the following it does the same as subs:

```
sage:  sage: f(x) = 2*x
sage:  sage: f(x).subs(x=3)
6
sage:  sage: f(x).evaluate(x=3)
6
```

> But
> 
> ```
> sage: f(x) = 2*x
> sage: f.subs(x=3)
> x |--> 6
> ```
> ie, `f` remains a function. It is hopefully not changed into a number.


Indeed, this changes (I wasn't aware of this up to now):

```
sage:  sage: f.evaluate(x=3)
6
```
This is because `evaluate` uses

```
sage: f.operator()
<built-in function mul>
sage: f.operands()
[x, 2]
```
From this, `f` is equal to `2*x`. Sage sees these two as equal as well:

```
sage: bool(f == 2*x)
True
```



---

archive/issue_comments_316308.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [dkrenn](#comment%3A26):\n> Replying to [vdelecroix](#comment%3A25):\n> > By the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. \n\n> \n> From this, `f` is equal to `2*x`. Sage sees these two as equal as well:\n> \n> ```\n> sage: bool(f == 2*x)\n> True\n> ```\n\n\nArgh. Definitely a bug to me. Another bug is that the variable defining a function should be transparent. And currently\n\n```\nsage: f(x) = 2*x\nsage: g(y) = 2*y\nsage: bool(f == g)\nFalse\n```\n\nVincent",
    "created_at": "2015-04-20T12:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316308",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>
Replying to [dkrenn](#comment%3A26):
> Replying to [vdelecroix](#comment%3A25):
> > By the way, let me repeat another question from #9878. I found the behavior of `evaluate` in your [comment:22](#comment%3A22) very weird. I thought it was a modification of `.subs` in order to take care of the parent. 

> 
> From this, `f` is equal to `2*x`. Sage sees these two as equal as well:
> 
> ```
> sage: bool(f == 2*x)
> True
> ```


Argh. Definitely a bug to me. Another bug is that the variable defining a function should be transparent. And currently

```
sage: f(x) = 2*x
sage: g(y) = 2*y
sage: bool(f == g)
False
```

Vincent



---

archive/issue_comments_316309.json:
```json
{
    "body": "<a id='comment:28'></a>\nPlease Cc: me with any ticket you open regarding `Expression.nonzero()` or pynac.",
    "created_at": "2015-04-20T12:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316309",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Please Cc: me with any ticket you open regarding `Expression.nonzero()` or pynac.



---

archive/issue_comments_316310.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [vdelecroix](#comment%3A27):\n\n```\nsage: f(x) = 2*x\n```\n> > From this, `f` is equal to `2*x`. Sage sees these two as equal as well:\n> > \n> > ```\n> > sage: bool(f == 2*x)\n> > True\n> > ```\n\n> \n> Argh. Definitely a bug to me. Another bug is that the variable defining a function should be transparent. And currently\n> \n> ```\n> sage: f(x) = 2*x\n> sage: g(y) = 2*y\n> sage: bool(f == g)\n> False\n> ```\n\n\nThis is now #18259.",
    "created_at": "2015-04-20T12:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316310",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:29'></a>
Replying to [vdelecroix](#comment%3A27):

```
sage: f(x) = 2*x
```
> > From this, `f` is equal to `2*x`. Sage sees these two as equal as well:
> > 
> > ```
> > sage: bool(f == 2*x)
> > True
> > ```

> 
> Argh. Definitely a bug to me. Another bug is that the variable defining a function should be transparent. And currently
> 
> ```
> sage: f(x) = 2*x
> sage: g(y) = 2*y
> sage: bool(f == g)
> False
> ```


This is now #18259.



---

archive/issue_comments_316311.json:
```json
{
    "body": "<a id='comment:30'></a>\nAs to the original `subs` error, nbruin has explained why there is no general solution, a workaround for polynomials would be\n\n```\nsage: P.<p> = ZZ[[]]\nsage: x.power_series(ZZ)\nx + O(x^2)\nsage: P(_)\np + O(p^2)\n```\nI believe a more general way to have all possibilities of both `SR` and the series rings is to fix conversions between them, and use a series ring over `SR`. This depends on #17659, please review.",
    "created_at": "2015-06-20T07:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316311",
    "user": "https://github.com/rwst"
}
```

<a id='comment:30'></a>
As to the original `subs` error, nbruin has explained why there is no general solution, a workaround for polynomials would be

```
sage: P.<p> = ZZ[[]]
sage: x.power_series(ZZ)
x + O(x^2)
sage: P(_)
p + O(p^2)
```
I believe a more general way to have all possibilities of both `SR` and the series rings is to fix conversions between them, and use a series ring over `SR`. This depends on #17659, please review.



---

archive/issue_comments_316312.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [nbruin](#comment%3A19):\n> Anyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.\n\n\nI had another instance where I needed a version of `.subs` like in this ticket, because there is no coercion from a number field to the symbolic ring.\n\n```\nsage: K.<omega> = NumberField(x^4 + 1)\nsage: var('u')\nsage: z = u/(u + 1)^2\nsage: z.subs(u=omega)\nTraceback (most recent call last):\n...\nTypeError: no canonical coercion from Number Field\nin omega with defining polynomial x^16 + 1 to\nSymbolic Ring\n```\nUsing `fast_callable` works in this case:\n\n```\nsage: fast_callable(z, vars=[u])(omega)\n1/2*omega^3 - 1/2*omega + 1\n```\n\nIt works, but the solution is hard to find and the notation a bit cumbersome.\n\nI see several solutions:\n1. adding a link to `fast_callable` and some examples from this ticket to the documentation of `subs`.\n2. indeed create a method as proposed here which acts as a wrapper for `fast_callable`.\n\nOpinions?",
    "created_at": "2016-02-11T15:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316312",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:31'></a>
Replying to [nbruin](#comment%3A19):
> Anyway, `fast_callable` takes a best effort approach towards compiling a program that tries to perform the evaluation, so that might be your best bet.


I had another instance where I needed a version of `.subs` like in this ticket, because there is no coercion from a number field to the symbolic ring.

```
sage: K.<omega> = NumberField(x^4 + 1)
sage: var('u')
sage: z = u/(u + 1)^2
sage: z.subs(u=omega)
Traceback (most recent call last):
...
TypeError: no canonical coercion from Number Field
in omega with defining polynomial x^16 + 1 to
Symbolic Ring
```
Using `fast_callable` works in this case:

```
sage: fast_callable(z, vars=[u])(omega)
1/2*omega^3 - 1/2*omega + 1
```

It works, but the solution is hard to find and the notation a bit cumbersome.

I see several solutions:
1. adding a link to `fast_callable` and some examples from this ticket to the documentation of `subs`.
2. indeed create a method as proposed here which acts as a wrapper for `fast_callable`.

Opinions?



---

archive/issue_comments_316313.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [rws](#comment%3A30):\n> I believe a more general way to have all possibilities of both `SR` and the series rings is to fix conversions between them, and use a series ring over `SR`. This depends on #17659, please review.\n\n\nIs it realistic to hope that all conversions will exist? Do they always make sense?",
    "created_at": "2016-02-11T15:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316313",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:32'></a>
Replying to [rws](#comment%3A30):
> I believe a more general way to have all possibilities of both `SR` and the series rings is to fix conversions between them, and use a series ring over `SR`. This depends on #17659, please review.


Is it realistic to hope that all conversions will exist? Do they always make sense?



---

archive/issue_comments_316314.json:
```json
{
    "body": "<a id='comment:33'></a>\nI am now neutral or positive on this ticket. Still,\n\n>Is it realistic to hope that all conversions will exist? Do they always make sense?\n\nI suspect many will and do. You can easily find out by reviewing #16203 and #17402.",
    "created_at": "2016-02-11T16:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18092#issuecomment-316314",
    "user": "https://github.com/rwst"
}
```

<a id='comment:33'></a>
I am now neutral or positive on this ticket. Still,

>Is it realistic to hope that all conversions will exist? Do they always make sense?

I suspect many will and do. You can easily find out by reviewing #16203 and #17402.
