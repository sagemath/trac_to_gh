# Issue 18086: Twists of newforms

archive/issues_017849.json:
```json
{
    "assignees": [],
    "body": "As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  This ticket implements a method `Newform.twist()`, which returns the twisted form as a `Newform`.\n\nDepends on #6837\nDepends on #18436\nDepends on #18479\n\nCC:  @categorie\n\nKeywords: **twist newform Dirichlet character**\n\nBranch: **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**\n\nReviewer: **Chris Wuthrich, David Loeffler**\n\nAuthor: **Peter Bruin**\n\nComponent: **modular forms**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18086_\n\n",
    "closed_at": "2015-06-03T23:22:46Z",
    "created_at": "2015-03-30T13:02:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Twists of newforms",
    "type": "issue",
    "updated_at": "2015-06-11T08:18:03Z",
    "url": "https://github.com/sagemath/sage/issues/18086",
    "user": "https://github.com/pjbruin"
}
```
As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  This ticket implements a method `Newform.twist()`, which returns the twisted form as a `Newform`.

Depends on #6837
Depends on #18436
Depends on #18479

CC:  @categorie

Keywords: **twist newform Dirichlet character**

Branch: **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**

Reviewer: **Chris Wuthrich, David Loeffler**

Author: **Peter Bruin**

Component: **modular forms**

_Issue created by migration from https://trac.sagemath.org/ticket/18086_





---

archive/issue_events_254886.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-30T13:02:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254886"
}
```



---

archive/issue_events_254887.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-30T13:02:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
    "label_color": "0000ff",
    "label_name": "c: modular forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254887"
}
```



---

archive/issue_events_254888.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-30T13:02:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254888"
}
```



---

archive/issue_events_254889.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-30T13:02:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254889"
}
```



---

archive/issue_comments_246541.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWorking on this; the main challenge is determining the level of the twisted form.",
    "created_at": "2015-04-02T13:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246541",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:1" align="right">comment:1</div>

Working on this; the main challenge is determining the level of the twisted form.



---

archive/issue_comments_246542.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2015-04-02T13:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246542",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_246543.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nA first version; this is still unable to compute the level in many cases.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f415597ad04c7741745e87d1c57134e41c9a27a0\"><code>f415597</code></a></td><td><code>trac 6837: implement twist of modular form by a Dirichlet character</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57b7688fc9be86cd5412a8e82000046c7230884e\"><code>57b7688</code></a></td><td><code>Trac 6837: improve docstring formatting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20ab273c2943414fd7c36e3871c7dcb1797e3237\"><code>20ab273</code></a></td><td><code>Trac 6837: slightly simplify ModularForm_abstract.twist()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd741ea7ef7a15acfc262ba6ed76122d3d0e995c\"><code>fd741ea</code></a></td><td><code>Trac 6837: take a lower level for the twisted form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05847072d6ff20dd2ce94014e4453a7d7ad93542\"><code>0584707</code></a></td><td><code>Trac 6837: expand documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68354fb8c939810698fd732424737647aac529ce\"><code>68354fb</code></a></td><td><code>Trac 6837: twist of cusp form should be a cusp form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/766ef0575cba1f0f59853807c4fb7fedca7b94c2\"><code>766ef05</code></a></td><td><code>Trac 6837: update/expand doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09d70e89916ebfc30e6d29aba6ace76e3c539539\"><code>09d70e8</code></a></td><td><code>Trac 6837: always use Atkin-Li formula for the level of the twisted form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a53ee1fd0ba49dcad00d30b4d1c322780c19292a\"><code>a53ee1f</code></a></td><td><code>Trac 18068: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae\"><code>dc9a9cc</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>\n",
    "created_at": "2015-04-02T14:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246543",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:2" align="right">comment:2</div>

A first version; this is still unable to compute the level in many cases.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f415597ad04c7741745e87d1c57134e41c9a27a0"><code>f415597</code></a></td><td><code>trac 6837: implement twist of modular form by a Dirichlet character</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57b7688fc9be86cd5412a8e82000046c7230884e"><code>57b7688</code></a></td><td><code>Trac 6837: improve docstring formatting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20ab273c2943414fd7c36e3871c7dcb1797e3237"><code>20ab273</code></a></td><td><code>Trac 6837: slightly simplify ModularForm_abstract.twist()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd741ea7ef7a15acfc262ba6ed76122d3d0e995c"><code>fd741ea</code></a></td><td><code>Trac 6837: take a lower level for the twisted form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05847072d6ff20dd2ce94014e4453a7d7ad93542"><code>0584707</code></a></td><td><code>Trac 6837: expand documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68354fb8c939810698fd732424737647aac529ce"><code>68354fb</code></a></td><td><code>Trac 6837: twist of cusp form should be a cusp form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/766ef0575cba1f0f59853807c4fb7fedca7b94c2"><code>766ef05</code></a></td><td><code>Trac 6837: update/expand doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09d70e89916ebfc30e6d29aba6ace76e3c539539"><code>09d70e8</code></a></td><td><code>Trac 6837: always use Atkin-Li formula for the level of the twisted form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a53ee1fd0ba49dcad00d30b4d1c322780c19292a"><code>a53ee1f</code></a></td><td><code>Trac 18068: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae"><code>dc9a9cc</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>




---

archive/issue_comments_246544.json:
```json
{
    "body": "Branch: **[u/pbruin/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18086-Newform_twist)**",
    "created_at": "2015-04-02T14:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246544",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18086-Newform_twist)**



---

archive/issue_comments_246545.json:
```json
{
    "body": "Commit: **[`dc9a9cc`](https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae)**",
    "created_at": "2015-04-02T14:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246545",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`dc9a9cc`](https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae)**



---

archive/issue_comments_246546.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44c21d58531707c124943e772bb5a5697e55e6c6\"><code>44c21d5</code></a></td><td><code>Trac 18086: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d\"><code>2e66ac6</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>\n",
    "created_at": "2015-04-02T14:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246546",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44c21d58531707c124943e772bb5a5697e55e6c6"><code>44c21d5</code></a></td><td><code>Trac 18086: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d"><code>2e66ac6</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>




---

archive/issue_comments_246547.json:
```json
{
    "body": "Changed commit from **[`dc9a9cc`](https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae)** to **[`2e66ac6`](https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d)**",
    "created_at": "2015-04-02T14:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246547",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dc9a9cc`](https://github.com/sagemath/sagetrac-mirror/commit/dc9a9cc8b08d912974bed3001873f8487903b3ae)** to **[`2e66ac6`](https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d)**



---

archive/issue_comments_246548.json:
```json
{
    "body": "Changed commit from **[`2e66ac6`](https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d)** to **[`5284dda`](https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030)**",
    "created_at": "2015-04-09T11:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246548",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e66ac6`](https://github.com/sagemath/sagetrac-mirror/commit/2e66ac6a56894901ef8039135e8e3df0e16e445d)** to **[`5284dda`](https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030)**



---

archive/issue_comments_246549.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e576ad46ca1427fde0e570371d1c5ef670a863ed\"><code>e576ad4</code></a></td><td><code>Trac 6837: replace Unicode dash by ASCII hyphen</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d3c8a2d6a36e93cb51ec760dc9c04eb64f80894\"><code>2d3c8a2</code></a></td><td><code>Trac 6837: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9e849abc4a30368f408ead521d61ef53b26d26a\"><code>d9e849a</code></a></td><td><code>Trac 6837: handle forms without character</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f5694a40ca5adba4b249b7349913cdae7652eb6\"><code>5f5694a</code></a></td><td><code>Trac 6837: use the right base ring for the twisted form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030\"><code>5284dda</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>\n",
    "created_at": "2015-04-09T11:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246549",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e576ad46ca1427fde0e570371d1c5ef670a863ed"><code>e576ad4</code></a></td><td><code>Trac 6837: replace Unicode dash by ASCII hyphen</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d3c8a2d6a36e93cb51ec760dc9c04eb64f80894"><code>2d3c8a2</code></a></td><td><code>Trac 6837: move ModularForm_abstract.twist() to ModularFormElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9e849abc4a30368f408ead521d61ef53b26d26a"><code>d9e849a</code></a></td><td><code>Trac 6837: handle forms without character</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f5694a40ca5adba4b249b7349913cdae7652eb6"><code>5f5694a</code></a></td><td><code>Trac 6837: use the right base ring for the twisted form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030"><code>5284dda</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>




---

archive/issue_comments_246550.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n-As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.\n-\n-Ater #6837, the method `Newform.twist()` (inherited from `ModularForm_abstract`) fails because newforms do not have an `is_cuspidal()` method.  Instead of fixing this directly, `Newform` should have its own `twist()` method, which should return the twisted form as a `Newform`.\n+As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  More precisely, the class `Newform` should have a `twist()` method, which should return the twisted form as a `Newform`.\n``````\n",
    "created_at": "2015-04-15T22:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246550",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1 @@
-As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.
-
-Ater #6837, the method `Newform.twist()` (inherited from `ModularForm_abstract`) fails because newforms do not have an `is_cuspidal()` method.  Instead of fixing this directly, `Newform` should have its own `twist()` method, which should return the twisted form as a `Newform`.
+As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  More precisely, the class `Newform` should have a `twist()` method, which should return the twisted form as a `Newform`.
``````




---

archive/issue_comments_246551.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440\"><code>f1533dd</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>\n",
    "created_at": "2015-04-27T21:15:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246551",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440"><code>f1533dd</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr></table>




---

archive/issue_comments_246552.json:
```json
{
    "body": "Changed commit from **[`5284dda`](https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030)** to **[`f1533dd`](https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440)**",
    "created_at": "2015-04-27T21:15:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246552",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5284dda`](https://github.com/sagemath/sagetrac-mirror/commit/5284dda20fd2c4932e36899f8d3394eebc435030)** to **[`f1533dd`](https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440)**



---

archive/issue_comments_246553.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nCalculating the level of the twisted form is still only implemented in the cases where [Atkin-Li, Theorem 3.1] applies.  However, I currently don't have time to find out if this can easily be done in greater generality, and the current implementation suffices for #18061, which depends on this ticket.",
    "created_at": "2015-04-27T21:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246553",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Calculating the level of the twisted form is still only implemented in the cases where [Atkin-Li, Theorem 3.1] applies.  However, I currently don't have time to find out if this can easily be done in greater generality, and the current implementation suffices for #18061, which depends on this ticket.



---

archive/issue_events_254890.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-04-27T21:20:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254890"
}
```



---

archive/issue_comments_246554.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  More precisely, the class `Newform` should have a `twist()` method, which should return the twisted form as a `Newform`.\n+As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  This ticket implements a method `Newform.twist()`, which returns the twisted form as a `Newform`.\n``````\n",
    "created_at": "2015-04-27T21:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246554",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  More precisely, the class `Newform` should have a `twist()` method, which should return the twisted form as a `Newform`.
+As a follow-up to #6837, twists of newforms by Dirichlet characters should be implemented.  This ticket implements a method `Newform.twist()`, which returns the twisted form as a `Newform`.
``````




---

archive/issue_comments_246555.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nTwo issues. One a very small missing second ` after check in the docstring.\nThe other will need more work:\n\n```\nsage: M = CuspForms(Gamma1(13),2)\nsage: f = M.newforms('a')[0]\nsage: G = DirichletGroup(3)\nsage: chi = G.0\nsage: f.twist(chi)\n```\nreturns\n\n```\nTypeError: no common canonical parent for objects with parents: 'Number Field in a0 with defining polynomial x^2 + 3*x + 3' and 'Cyclotomic Field of order 2 and degree 1'\n```\n\nIt appears when the form has coefficients outside ZZ.\n\n\nBy the way, this could be another nice example.\n\n```\nsage: D = Newforms(1,12)[0]\nsage: G = DirichletGroup(3)\nsage: chi = G.0\nsage: D.twist(chi)\n```",
    "created_at": "2015-05-16T14:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246555",
    "user": "https://github.com/categorie"
}
```

<div id="comment:9" align="right">comment:9</div>

Two issues. One a very small missing second ` after check in the docstring.
The other will need more work:

```
sage: M = CuspForms(Gamma1(13),2)
sage: f = M.newforms('a')[0]
sage: G = DirichletGroup(3)
sage: chi = G.0
sage: f.twist(chi)
```
returns

```
TypeError: no common canonical parent for objects with parents: 'Number Field in a0 with defining polynomial x^2 + 3*x + 3' and 'Cyclotomic Field of order 2 and degree 1'
```

It appears when the form has coefficients outside ZZ.


By the way, this could be another nice example.

```
sage: D = Newforms(1,12)[0]
sage: G = DirichletGroup(3)
sage: chi = G.0
sage: D.twist(chi)
```



---

archive/issue_comments_246556.json:
```json
{
    "body": "Reviewer: **Chris Wuthrich**",
    "created_at": "2015-05-16T14:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246556",
    "user": "https://github.com/categorie"
}
```

Reviewer: **Chris Wuthrich**



---

archive/issue_events_254891.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2015-05-16T14:38:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254891"
}
```



---

archive/issue_events_254892.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2015-05-16T14:38:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254892"
}
```



---

archive/issue_comments_246557.json:
```json
{
    "body": "Changed commit from **[`f1533dd`](https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440)** to **[`dd977f2`](https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879)**",
    "created_at": "2015-05-18T08:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246557",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1533dd`](https://github.com/sagemath/sagetrac-mirror/commit/f1533dde29e01cbca26cb57e51a680a3853c6440)** to **[`dd977f2`](https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879)**



---

archive/issue_comments_246558.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a38e707bc54952c8ac5f84353c2d3566b206fb69\"><code>a38e707</code></a></td><td><code>Trac 18436: fix dimension formulae for modular forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa6227f905e5e4160c832a2759c72457f3274fee\"><code>aa6227f</code></a></td><td><code>Merge branch 'ticket/18436-dimension_formulae' into ticket/18086-Newform_twist</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879\"><code>dd977f2</code></a></td><td><code>Trac 18086: reviewer comments</code></td></tr></table>\n",
    "created_at": "2015-05-18T08:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246558",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a38e707bc54952c8ac5f84353c2d3566b206fb69"><code>a38e707</code></a></td><td><code>Trac 18436: fix dimension formulae for modular forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa6227f905e5e4160c832a2759c72457f3274fee"><code>aa6227f</code></a></td><td><code>Merge branch 'ticket/18436-dimension_formulae' into ticket/18086-Newform_twist</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879"><code>dd977f2</code></a></td><td><code>Trac 18086: reviewer comments</code></td></tr></table>




---

archive/issue_comments_246559.json:
```json
{
    "body": "Changed dependencies from **#6837** to **#6837, #18436**",
    "created_at": "2015-05-18T08:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246559",
    "user": "https://github.com/pjbruin"
}
```

Changed dependencies from **#6837** to **#6837, #18436**



---

archive/issue_comments_246560.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@categorie](#comment%3A9):\n> Two issues. One a very small missing second ` after check in the docstring.\n\nDone, thanks,\n> The other will need more work:\n> \n> ```\n> sage: M = CuspForms(Gamma1(13),2)\n> sage: f = M.newforms('a')[0]\n> sage: G = DirichletGroup(3)\n> sage: chi = G.0\n> sage: f.twist(chi)\n> ```\n> returns\n> \n> ```\n> TypeError: no common canonical parent for objects with parents: 'Number Field in a0 with defining polynomial x^2 + 3*x + 3' and 'Cyclotomic Field of order 2 and degree 1'\n> ```\n> \n> It appears when the form has coefficients outside ZZ.\n\nThis is because the field of values of `chi` and the field of coefficients of `f` are not compatible (this may be a bad example; `chi.base_ring()` is `CyclotomicField(2)`, which is actually `QQ` but not recognised as such).  In such cases, one could try to take a compositum, but I think it is better to leave it to the user to specify the correct field.\n\nI added youe example, but with `chi` having coefficients in `QQ`.  Unfortunately, this uncovered a new bug; see #18436.\n\n> By the way, this could be another nice example.\n> \n> ```\n> sage: D = Newforms(1,12)[0]\n> sage: G = DirichletGroup(3)\n> sage: chi = G.0\n> sage: D.twist(chi)\n> ```\n\nThis is actually the first doctest in a different guise.  I added another one to check that twisting by the trivial character (with values in `QQ`) does not change the form.",
    "created_at": "2015-05-18T08:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246560",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@categorie](#comment%3A9):
> Two issues. One a very small missing second ` after check in the docstring.

Done, thanks,
> The other will need more work:
> 
> ```
> sage: M = CuspForms(Gamma1(13),2)
> sage: f = M.newforms('a')[0]
> sage: G = DirichletGroup(3)
> sage: chi = G.0
> sage: f.twist(chi)
> ```
> returns
> 
> ```
> TypeError: no common canonical parent for objects with parents: 'Number Field in a0 with defining polynomial x^2 + 3*x + 3' and 'Cyclotomic Field of order 2 and degree 1'
> ```
> 
> It appears when the form has coefficients outside ZZ.

This is because the field of values of `chi` and the field of coefficients of `f` are not compatible (this may be a bad example; `chi.base_ring()` is `CyclotomicField(2)`, which is actually `QQ` but not recognised as such).  In such cases, one could try to take a compositum, but I think it is better to leave it to the user to specify the correct field.

I added youe example, but with `chi` having coefficients in `QQ`.  Unfortunately, this uncovered a new bug; see #18436.

> By the way, this could be another nice example.
> 
> ```
> sage: D = Newforms(1,12)[0]
> sage: G = DirichletGroup(3)
> sage: chi = G.0
> sage: D.twist(chi)
> ```

This is actually the first doctest in a different guise.  I added another one to check that twisting by the trivial character (with values in `QQ`) does not change the form.



---

archive/issue_events_254893.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-18T08:36:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254893"
}
```



---

archive/issue_events_254894.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-18T08:36:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254894"
}
```



---

archive/issue_comments_246561.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHere's a bug I found while testing your Atkin--Lehner ticket:\n\n```\nsage: f = Newforms(Gamma1(25), names='a')[1]\nsage: eps = f.character()\nsage: f.twist(eps)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: No compatible natural embeddings found for Complex Lazy Field and Number Field in a1 with defining polynomial x^8 + 5*x^7 + 11*x^6 + 10*x^5 + x^4 + 10*x^3 + 26*x^2 - 10*x + 1\n```",
    "created_at": "2015-05-22T15:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246561",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:13" align="right">comment:13</div>

Here's a bug I found while testing your Atkin--Lehner ticket:

```
sage: f = Newforms(Gamma1(25), names='a')[1]
sage: eps = f.character()
sage: f.twist(eps)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: No compatible natural embeddings found for Complex Lazy Field and Number Field in a1 with defining polynomial x^8 + 5*x^7 + 11*x^6 + 10*x^5 + x^4 + 10*x^3 + 26*x^2 - 10*x + 1
```



---

archive/issue_comments_246562.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@loefflerd](#comment%3A13):\n> Here's a bug I found while testing your Atkin--Lehner ticket:\n> \n> ```\n> sage: f = Newforms(Gamma1(25), names='a')[1]\n> sage: eps = f.character()\n> sage: f.twist(eps)\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> ...\n> TypeError: No compatible natural embeddings found for Complex Lazy Field and Number Field in a1 with defining polynomial x^8 + 5*x^7 + 11*x^6 + 10*x^5 + x^4 + 10*x^3 + 26*x^2 - 10*x + 1\n> ```\n\nThis is in fact caused by a bug in `DirichletCharacter.minimize_base_ring()`: in the above setting, typing\n\n```\nsage: eps.minimize_base_ring()\n```\ngives the same error.  This method is called via the `ModularForms` constructor, so e.g. `ModularForms(eps, 2)` also fails.",
    "created_at": "2015-05-22T17:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246562",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@loefflerd](#comment%3A13):
> Here's a bug I found while testing your Atkin--Lehner ticket:
> 
> ```
> sage: f = Newforms(Gamma1(25), names='a')[1]
> sage: eps = f.character()
> sage: f.twist(eps)
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> ...
> TypeError: No compatible natural embeddings found for Complex Lazy Field and Number Field in a1 with defining polynomial x^8 + 5*x^7 + 11*x^6 + 10*x^5 + x^4 + 10*x^3 + 26*x^2 - 10*x + 1
> ```

This is in fact caused by a bug in `DirichletCharacter.minimize_base_ring()`: in the above setting, typing

```
sage: eps.minimize_base_ring()
```
gives the same error.  This method is called via the `ModularForms` constructor, so e.g. `ModularForms(eps, 2)` also fails.



---

archive/issue_comments_246563.json:
```json
{
    "body": "Work Issues: **speed**",
    "created_at": "2015-05-23T07:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246563",
    "user": "https://github.com/pjbruin"
}
```

Work Issues: **speed**



---

archive/issue_events_254895.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:17:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254895"
}
```



---

archive/issue_events_254896.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:17:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254896"
}
```



---

archive/issue_comments_246564.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe following is much slower than it should be (about 6.7 seconds on the system I tested this on):\n\n```\nsage: F = Newforms(299,names='a')[0]\nsage: F.twist(F.character())\nq + a0*q^2 + a0*q^3 + (-a0 - 1)*q^4 + (-a0 - 1)*q^5 + O(q^6)\n```\nThis is caused by a lot of unnecessary computations of roots of unity in various number fields; see David's [#18061 comment:16](https://github.com/sagemath/sage/issues/18061#comment:16).",
    "created_at": "2015-05-23T07:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246564",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:15" align="right">comment:15</div>

The following is much slower than it should be (about 6.7 seconds on the system I tested this on):

```
sage: F = Newforms(299,names='a')[0]
sage: F.twist(F.character())
q + a0*q^2 + a0*q^3 + (-a0 - 1)*q^4 + (-a0 - 1)*q^5 + O(q^6)
```
This is caused by a lot of unnecessary computations of roots of unity in various number fields; see David's [#18061 comment:16](https://github.com/sagemath/sage/issues/18061#comment:16).



---

archive/issue_comments_246565.json:
```json
{
    "body": "Changed dependencies from **#6837, #18436** to **#6837, #18436, #18479**",
    "created_at": "2015-05-23T07:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246565",
    "user": "https://github.com/pjbruin"
}
```

Changed dependencies from **#6837, #18436** to **#6837, #18436, #18479**



---

archive/issue_events_254897.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-27T22:40:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254897"
}
```



---

archive/issue_events_254898.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-27T22:40:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254898"
}
```



---

archive/issue_comments_246566.json:
```json
{
    "body": "Changed work issues from **speed** to none",
    "created_at": "2015-05-27T22:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246566",
    "user": "https://github.com/pjbruin"
}
```

Changed work issues from **speed** to none



---

archive/issue_comments_246567.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt turns out that the slowness in [comment:15](#comment%3A15) can be solved by improving the construction of Dirichlet groups so as to avoid computing roots of unity until they are needed.  (This basically comes down to allowing Dirichlet groups without a user-specified root of unity.)  Since the problem is orthogonal to this ticket, I will create a different ticket to solve it, and I am setting this one back to needs_review.  (It probably won't be necessary to make either ticket depend on the other.)",
    "created_at": "2015-05-27T22:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246567",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

It turns out that the slowness in [comment:15](#comment%3A15) can be solved by improving the construction of Dirichlet groups so as to avoid computing roots of unity until they are needed.  (This basically comes down to allowing Dirichlet groups without a user-specified root of unity.)  Since the problem is orthogonal to this ticket, I will create a different ticket to solve it, and I am setting this one back to needs_review.  (It probably won't be necessary to make either ticket depend on the other.)



---

archive/issue_comments_246568.json:
```json
{
    "body": "Changed branch from **[u/pbruin/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18086-Newform_twist)** to **[u/davidloeffler/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-Newform_twist)**",
    "created_at": "2015-06-03T08:41:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246568",
    "user": "https://github.com/loefflerd"
}
```

Changed branch from **[u/pbruin/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18086-Newform_twist)** to **[u/davidloeffler/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-Newform_twist)**



---

archive/issue_comments_246569.json:
```json
{
    "body": "Changed commit from **[`dd977f2`](https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879)** to **[`2e82464`](https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8)**",
    "created_at": "2015-06-03T08:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246569",
    "user": "https://github.com/loefflerd"
}
```

Changed commit from **[`dd977f2`](https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879)** to **[`2e82464`](https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8)**



---

archive/issue_comments_246570.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI rebased the trac branch on top of #18479. (I hope I did this right, I'm not very good at git yet!)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2358aa1645f503e510c8c352d7e7ada1a5c3e173\"><code>2358aa1</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8\"><code>2e82464</code></a></td><td><code>Trac 18086: reviewer comments</code></td></tr></table>\n",
    "created_at": "2015-06-03T08:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246570",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:19" align="right">comment:19</div>

I rebased the trac branch on top of #18479. (I hope I did this right, I'm not very good at git yet!)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2358aa1645f503e510c8c352d7e7ada1a5c3e173"><code>2358aa1</code></a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8"><code>2e82464</code></a></td><td><code>Trac 18086: reviewer comments</code></td></tr></table>




---

archive/issue_comments_246571.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOops, I seem to have broken something and I can't work out why -- this Git branch won't compile. Sorry, I don't know how to fix this! Any offers?",
    "created_at": "2015-06-03T08:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246571",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:20" align="right">comment:20</div>

Oops, I seem to have broken something and I can't work out why -- this Git branch won't compile. Sorry, I don't know how to fix this! Any offers?



---

archive/issue_comments_246572.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI won't claim to be an gitexpert, but I guess a \"merge\" is better than a \"rebase\" when other people are involved. The commit at which the two branches merge then tells you exactly what went on.\n\nIn this case the two involve disjoint set of files so it should be straight forward. So I am surprised this does not work.\n\nYour branch (merged into the 6.8.beta1) compiles fine for me. I will try on it own later. Where does your compilation get a problem ?",
    "created_at": "2015-06-03T09:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246572",
    "user": "https://github.com/categorie"
}
```

<div id="comment:21" align="right">comment:21</div>

I won't claim to be an gitexpert, but I guess a "merge" is better than a "rebase" when other people are involved. The commit at which the two branches merge then tells you exactly what went on.

In this case the two involve disjoint set of files so it should be straight forward. So I am surprised this does not work.

Your branch (merged into the 6.8.beta1) compiles fine for me. I will try on it own later. Where does your compilation get a problem ?



---

archive/issue_comments_246573.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWhen I try compiling this branch, it raises an error at sage/ext/interrupt/interrupt.pxd and refuses to continue.",
    "created_at": "2015-06-03T10:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246573",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:22" align="right">comment:22</div>

When I try compiling this branch, it raises an error at sage/ext/interrupt/interrupt.pxd and refuses to continue.



---

archive/issue_comments_246574.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNo, I can't reproduce this. It all works fine for me on that branch. That file should not have been touched and should not compile. Probably you best abandon your branch and start a new one pulling from the trac and try compiling again.",
    "created_at": "2015-06-03T10:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246574",
    "user": "https://github.com/categorie"
}
```

<div id="comment:23" align="right">comment:23</div>

No, I can't reproduce this. It all works fine for me on that branch. That file should not have been touched and should not compile. Probably you best abandon your branch and start a new one pulling from the trac and try compiling again.



---

archive/issue_comments_246575.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI worked out the problem. The point is that the current \"develop\" branch doesn't actually build on my machine -- as is sometimes the case with unreleased betas -- and the branch at #18479 hangs off develop, not master.",
    "created_at": "2015-06-03T12:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246575",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:24" align="right">comment:24</div>

I worked out the problem. The point is that the current "develop" branch doesn't actually build on my machine -- as is sometimes the case with unreleased betas -- and the branch at #18479 hangs off develop, not master.



---

archive/issue_comments_246576.json:
```json
{
    "body": "Changed branch from **[u/davidloeffler/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-Newform_twist)** to **[u/davidloeffler/18086-twists-merged](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-twists-merged)**",
    "created_at": "2015-06-03T13:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246576",
    "user": "https://github.com/loefflerd"
}
```

Changed branch from **[u/davidloeffler/18086-Newform_twist](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-Newform_twist)** to **[u/davidloeffler/18086-twists-merged](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-twists-merged)**



---

archive/issue_comments_246577.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a\"><code>d57edf4</code></a></td><td><code>Trac 18086: fix two small bugs involving Dirichlet characters revealed in testing</code></td></tr></table>\n",
    "created_at": "2015-06-03T14:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246577",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a"><code>d57edf4</code></a></td><td><code>Trac 18086: fix two small bugs involving Dirichlet characters revealed in testing</code></td></tr></table>




---

archive/issue_comments_246578.json:
```json
{
    "body": "Changed commit from **[`2e82464`](https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8)** to **[`d57edf4`](https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a)**",
    "created_at": "2015-06-03T14:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246578",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e82464`](https://github.com/sagemath/sagetrac-mirror/commit/2e82464519f002200db7d6fb1bd9ee56f49b67b8)** to **[`d57edf4`](https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a)**



---

archive/issue_comments_246579.json:
```json
{
    "body": "Changed reviewer from **Chris Wuthrich** to **Chris Wuthrich, David Loeffler**",
    "created_at": "2015-06-03T14:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246579",
    "user": "https://github.com/loefflerd"
}
```

Changed reviewer from **Chris Wuthrich** to **Chris Wuthrich, David Loeffler**



---

archive/issue_comments_246580.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nRight, I created a new branch which has only the relevant commits on top of current \"master\", using the rather useful \"git cherry-pick\" command, and now I'm testing that. \n\nBut I don't think the example from comment 14 is fixed yet. With #18479 in place, calling `eps.minimize_base_ring()` works fine, but still `f.twist(eps)` returns exactly the same error. I've traced this to sloppy coding in some dimension counting functions. I also spotted another error in `minimize_base_ring()`, unrelated to #18479, when the coefficient field is a relative number field. \n\nWith these two changes the code looks sound. Peter: if you're happy with these changes, please set the ticket to positive review.",
    "created_at": "2015-06-03T14:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246580",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:27" align="right">comment:27</div>

Right, I created a new branch which has only the relevant commits on top of current "master", using the rather useful "git cherry-pick" command, and now I'm testing that. 

But I don't think the example from comment 14 is fixed yet. With #18479 in place, calling `eps.minimize_base_ring()` works fine, but still `f.twist(eps)` returns exactly the same error. I've traced this to sloppy coding in some dimension counting functions. I also spotted another error in `minimize_base_ring()`, unrelated to #18479, when the coefficient field is a relative number field. 

With these two changes the code looks sound. Peter: if you're happy with these changes, please set the ticket to positive review.



---

archive/issue_comments_246581.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAargh! Now it won't merge and I can't work out why! This is giving me a serious headache.",
    "created_at": "2015-06-03T14:21:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246581",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:28" align="right">comment:28</div>

Aargh! Now it won't merge and I can't work out why! This is giving me a serious headache.



---

archive/issue_comments_246582.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nDavid\n\nI got a merge conflict with #18436. But relax, probably Peter is better than all of us and can fix all of it in no time. \n\na small doc string thingy:\n\nCheck a bug spotted at #18086 is fixed::\n\nshould use :trac:`18086` instead.",
    "created_at": "2015-06-03T14:35:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246582",
    "user": "https://github.com/categorie"
}
```

<div id="comment:29" align="right">comment:29</div>

David

I got a merge conflict with #18436. But relax, probably Peter is better than all of us and can fix all of it in no time. 

a small doc string thingy:

Check a bug spotted at #18086 is fixed::

should use :trac:`18086` instead.



---

archive/issue_comments_246583.json:
```json
{
    "body": "Changed branch from **[u/davidloeffler/18086-twists-merged](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-twists-merged)** to **[u/davidloeffler/18086-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-rebased)**",
    "created_at": "2015-06-03T16:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246583",
    "user": "https://github.com/loefflerd"
}
```

Changed branch from **[u/davidloeffler/18086-twists-merged](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-twists-merged)** to **[u/davidloeffler/18086-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-rebased)**



---

archive/issue_comments_246584.json:
```json
{
    "body": "Changed commit from **[`d57edf4`](https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a)** to **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**",
    "created_at": "2015-06-03T16:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246584",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d57edf4`](https://github.com/sagemath/sagetrac-mirror/commit/d57edf416adaace77e013e71223b1b5bae7d686a)** to **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**



---

archive/issue_comments_246585.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb\"><code>751bf48</code></a></td><td><code>Trac 18086: fixed a small Dirichlet character bug</code></td></tr></table>\n",
    "created_at": "2015-06-03T16:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246585",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb"><code>751bf48</code></a></td><td><code>Trac 18086: fixed a small Dirichlet character bug</code></td></tr></table>




---

archive/issue_comments_246586.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nOK, so it turns out that:\n- the reason I couldn't get the develop branch to compile was that I was using \"sage -b\" to recompile after switching between branches, which is not robust when there are changes to packages; it seems to be safer to use \"make\";\n- two of the three changes in the patch I uploaded earlier had already been fixed by other patches of Peter's, which was the cause of the conflict.\n\nI've now uploaded a patch with the one extra change that Peter hadn't already fixed -- `minimize_base_ring` returns an error when the base is a relative number field, which is relevant if you create a newform in a space with a specified character, so the Hecke eigenvalue field is a relative field with the coefficient field of the character as its base. Now I think we're now good to go.",
    "created_at": "2015-06-03T16:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246586",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:32" align="right">comment:32</div>

OK, so it turns out that:
- the reason I couldn't get the develop branch to compile was that I was using "sage -b" to recompile after switching between branches, which is not robust when there are changes to packages; it seems to be safer to use "make";
- two of the three changes in the patch I uploaded earlier had already been fixed by other patches of Peter's, which was the cause of the conflict.

I've now uploaded a patch with the one extra change that Peter hadn't already fixed -- `minimize_base_ring` returns an error when the base is a relative number field, which is relevant if you create a newform in a space with a specified character, so the Hecke eigenvalue field is a relative field with the coefficient field of the character as its base. Now I think we're now good to go.



---

archive/issue_events_254899.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-06-03T18:37:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254899"
}
```



---

archive/issue_events_254900.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-06-03T18:37:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254900"
}
```



---

archive/issue_comments_246587.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI saw the git-related messages come by but didn't have time to look into it.  I think the way you solved it is good, although the branch at #18061 is now less tidy than it would have been if you had used merging instead of rebasing.  (The situation might have been clearer if I had merged #18479; I don't always find it easy to decide if and when dependencies should be merged into a branch.)\n\nThanks to both of you for the review!",
    "created_at": "2015-06-03T18:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246587",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:33" align="right">comment:33</div>

I saw the git-related messages come by but didn't have time to look into it.  I think the way you solved it is good, although the branch at #18061 is now less tidy than it would have been if you had used merging instead of rebasing.  (The situation might have been clearer if I had merged #18479; I don't always find it easy to decide if and when dependencies should be merged into a branch.)

Thanks to both of you for the review!



---

archive/issue_events_254901.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-03T23:22:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254901"
}
```



---

archive/issue_events_254902.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1ffefc623738af81c5c1f71a10b7cac6356c39b4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-03T23:22:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18086#event-254902"
}
```



---

archive/issue_comments_246588.json:
```json
{
    "body": "Changed branch from **[u/davidloeffler/18086-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-rebased)** to **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**",
    "created_at": "2015-06-03T23:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246588",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/davidloeffler/18086-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18086-rebased)** to **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)**



---

archive/issue_comments_246589.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSee #18672 for a follow-up.",
    "created_at": "2015-06-11T08:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246589",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:35" align="right">comment:35</div>

See #18672 for a follow-up.



---

archive/issue_comments_246590.json:
```json
{
    "body": "Changed commit from **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)** to none",
    "created_at": "2015-06-11T08:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18086#issuecomment-246590",
    "user": "https://github.com/loefflerd"
}
```

Changed commit from **[`751bf48`](https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb)** to none
