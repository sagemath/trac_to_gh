# Issue 18946: unweighted matroid intersection using blocking flow approach

archive/issues_018709.json:
```json
{
    "assignees": [],
    "body": "Implement a unweighted matroid intersection algorithm that uses O(sqrt(p)rn) independence queries by adopting a blocking flow like technique, where r is the rank, p is the size of the maximum common independent set. \nIt is a bit better than the augmenting paths algorithm, which takes O(prn) queries. However, it's expected to perform worse when p is small, since the constant overhead is a bit larger.\n\nWilliam H Cunningham. 1986. Improved bounds for matroid partition and intersection algorithms. SIAM J. Comput. 15, 4 (November 1986), 948-957. DOI=10.1137/0215066 http://dx.doi.org/10.1137/0215066\n\nCC:  @sagetrac-Stefan @sagetrac-yomcat @sagetrac-Rudi\n\nComponent: **matroid theory**\n\nAuthor: **Chao Xu**\n\nBranch/Commit: **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**\n\nReviewer: **Stefan van Zwam**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18946_\n\n",
    "closed_at": "2015-09-14T18:59:40Z",
    "created_at": "2015-07-24T03:47:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20matroid%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "unweighted matroid intersection using blocking flow approach",
    "type": "issue",
    "updated_at": "2015-09-14T18:59:40Z",
    "url": "https://github.com/sagemath/sage/issues/18946",
    "user": "https://github.com/chaoxu"
}
```
Implement a unweighted matroid intersection algorithm that uses O(sqrt(p)rn) independence queries by adopting a blocking flow like technique, where r is the rank, p is the size of the maximum common independent set. 
It is a bit better than the augmenting paths algorithm, which takes O(prn) queries. However, it's expected to perform worse when p is small, since the constant overhead is a bit larger.

William H Cunningham. 1986. Improved bounds for matroid partition and intersection algorithms. SIAM J. Comput. 15, 4 (November 1986), 948-957. DOI=10.1137/0215066 http://dx.doi.org/10.1137/0215066

CC:  @sagetrac-Stefan @sagetrac-yomcat @sagetrac-Rudi

Component: **matroid theory**

Author: **Chao Xu**

Branch/Commit: **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**

Reviewer: **Stefan van Zwam**

_Issue created by migration from https://trac.sagemath.org/ticket/18946_





---

archive/issue_events_266585.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266585"
}
```



---

archive/issue_events_266586.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20matroid%20theory",
    "label_color": "0000ff",
    "label_name": "c: matroid theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266586"
}
```



---

archive/issue_events_266587.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266587"
}
```



---

archive/issue_events_266588.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266588"
}
```



---

archive/issue_comments_266082.json:
```json
{
    "body": "Branch: **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)**",
    "created_at": "2015-07-24T03:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266082",
    "user": "https://github.com/chaoxu"
}
```

Branch: **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)**



---

archive/issue_comments_266083.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f\"><code>c9fb292</code></a></td><td><code>removed an debugging print out</code></td></tr></table>\n",
    "created_at": "2015-07-24T03:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266083",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f"><code>c9fb292</code></a></td><td><code>removed an debugging print out</code></td></tr></table>




---

archive/issue_comments_266084.json:
```json
{
    "body": "Commit: **[`c9fb292`](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)**",
    "created_at": "2015-07-24T03:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266084",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`c9fb292`](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)**



---

archive/issue_events_266589.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:59:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266589"
}
```



---

archive/issue_comments_266085.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHere is a run time comparison if the maximum common independent set is large.\n\n```\nsage: M = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())\nsage: N = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())\nsage: %time len(M.intersection(N))\nCPU times: user 446 ms, sys: 2.05 ms, total: 448 ms\nWall time: 450 ms\n998\nsage: %time len(M._intersection_unweighted(N))\nCPU times: user 316 ms, sys: 569 us, total: 317 ms\nWall time: 317 ms\n998\n```\n\nI have done tests on random matroids and  `intersection(N)` seems to  `_intersection_unweighted(N)`. so far so good.",
    "created_at": "2015-07-24T03:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266085",
    "user": "https://github.com/chaoxu"
}
```

<div id="comment:3" align="right">comment:3</div>

Here is a run time comparison if the maximum common independent set is large.

```
sage: M = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())
sage: N = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())
sage: %time len(M.intersection(N))
CPU times: user 446 ms, sys: 2.05 ms, total: 448 ms
Wall time: 450 ms
998
sage: %time len(M._intersection_unweighted(N))
CPU times: user 316 ms, sys: 569 us, total: 317 ms
Wall time: 317 ms
998
```

I have done tests on random matroids and  `intersection(N)` seems to  `_intersection_unweighted(N)`. so far so good.



---

archive/issue_events_266590.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-19T01:53:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266590"
}
```



---

archive/issue_events_266591.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-19T01:53:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266591"
}
```



---

archive/issue_comments_266086.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe runtime seems to depend a lot on the type of matroid.\n\n```\nsage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 929 ms, sys: 122 ms, total: 1.05 s\nWall time: 1.05 s\nsage: %time X = M1._intersection_unweighted(M2)\nCPU times: user 332 ms, sys: 1.68 ms, total: 334 ms\nWall time: 334 ms\nsage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 37 s, sys: 201 ms, total: 37.2 s\nWall time: 37.2 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 5min 1s, sys: 217 ms, total: 5min 1s\nWall time: 5min 2s\n```\n\nYour method is not accessible to end users; mention it in the documentation of the intersection method. After adding that documentation (where you could say something like \"a method that might be faster, depending on the matroids involved\"), I would say it's good to go in",
    "created_at": "2015-08-20T22:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266086",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:5" align="right">comment:5</div>

The runtime seems to depend a lot on the type of matroid.

```
sage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 929 ms, sys: 122 ms, total: 1.05 s
Wall time: 1.05 s
sage: %time X = M1._intersection_unweighted(M2)
CPU times: user 332 ms, sys: 1.68 ms, total: 334 ms
Wall time: 334 ms
sage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 37 s, sys: 201 ms, total: 37.2 s
Wall time: 37.2 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 5min 1s, sys: 217 ms, total: 5min 1s
Wall time: 5min 2s
```

Your method is not accessible to end users; mention it in the documentation of the intersection method. After adding that documentation (where you could say something like "a method that might be faster, depending on the matroids involved"), I would say it's good to go in



---

archive/issue_events_266592.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-08-20T22:40:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266592"
}
```



---

archive/issue_events_266593.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-08-20T22:40:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266593"
}
```



---

archive/issue_comments_266087.json:
```json
{
    "body": "Changed commit from **[`c9fb292`](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)** to **[`195feb8`](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)**",
    "created_at": "2015-08-21T23:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266087",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c9fb292`](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)** to **[`195feb8`](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)**



---

archive/issue_comments_266088.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e217d9e3d72a39b87366af1e617cb9f0666f742d\"><code>e217d9e</code></a></td><td><code>faster construction of the graph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25\"><code>195feb8</code></a></td><td><code>update docs</code></td></tr></table>\n",
    "created_at": "2015-08-21T23:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266088",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e217d9e3d72a39b87366af1e617cb9f0666f742d"><code>e217d9e</code></a></td><td><code>faster construction of the graph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25"><code>195feb8</code></a></td><td><code>update docs</code></td></tr></table>




---

archive/issue_events_266594.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-08-21T23:08:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266594"
}
```



---

archive/issue_events_266595.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-08-21T23:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266595"
}
```



---

archive/issue_comments_266089.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis is extremely strange. \nThere are 2 steps in the algorithm. First one is construct the level graph, then do many augmentation in a batch. \nThe bad running time comes from the \"construct the level graph\" in my code. I have no idea why is my version so much slower. (probably due to ordering of the elements, since it actually use fewer  `_closure()` tests)\n\nI replaced it with the one in `_intersection_augmentation()` and apparently solved this problem.\n\nThis update was done quickly, hence this probably need more testing.\n\n```\nsage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 44.6 s, sys: 481 ms, total: 45 s\nWall time: 45.3 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 39 s, sys: 52.2 ms, total: 39 s\nWall time: 37.2 s\nsage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 1.52 s, sys: 332 ms, total: 1.85 s\nWall time: 1.85 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 191 ms, sys: 2.93 ms, total: 194 ms\nWall time: 194 ms\n```",
    "created_at": "2015-08-21T23:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266089",
    "user": "https://github.com/chaoxu"
}
```

<div id="comment:8" align="right">comment:8</div>

This is extremely strange. 
There are 2 steps in the algorithm. First one is construct the level graph, then do many augmentation in a batch. 
The bad running time comes from the "construct the level graph" in my code. I have no idea why is my version so much slower. (probably due to ordering of the elements, since it actually use fewer  `_closure()` tests)

I replaced it with the one in `_intersection_augmentation()` and apparently solved this problem.

This update was done quickly, hence this probably need more testing.

```
sage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 44.6 s, sys: 481 ms, total: 45 s
Wall time: 45.3 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 39 s, sys: 52.2 ms, total: 39 s
Wall time: 37.2 s
sage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 1.52 s, sys: 332 ms, total: 1.85 s
Wall time: 1.85 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 191 ms, sys: 2.93 ms, total: 194 ms
Wall time: 194 ms
```



---

archive/issue_comments_266090.json:
```json
{
    "body": "Reviewer: **Stefan van Zwam**",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266090",
    "user": "https://github.com/sagetrac-Stefan"
}
```

Reviewer: **Stefan van Zwam**



---

archive/issue_comments_266091.json:
```json
{
    "body": "Author: **Chao Xu**",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266091",
    "user": "https://github.com/sagetrac-Stefan"
}
```

Author: **Chao Xu**



---

archive/issue_events_266596.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-02T15:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266596"
}
```



---

archive/issue_events_266597.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-02T15:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266597"
}
```



---

archive/issue_comments_266092.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI did a bunch of tests, and the output was always correct. Also, timing tests now show a consistent speedup. It's good to go in as far as I'm concerned!\n\n```\nsage: def test():\n    for i in xrange(1000):\n            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())\n            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())\n            X = M1.intersection(M2)\n....:         \nsage: %time test()\nCPU times: user 21min 49s, sys: 25.8 s, total: 22min 15s\nWall time: 22min 17s\nsage: def test2():\n    for i in xrange(1000):\n            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())\n            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())\n            X = M1._intersection_unweighted(M2)\n....:         \nsage: %time test2()\nCPU times: user 11min 43s, sys: 936 ms, total: 11min 44s\nWall time: 11min 44s\n```",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266092",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:9" align="right">comment:9</div>

I did a bunch of tests, and the output was always correct. Also, timing tests now show a consistent speedup. It's good to go in as far as I'm concerned!

```
sage: def test():
    for i in xrange(1000):
            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())
            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())
            X = M1.intersection(M2)
....:         
sage: %time test()
CPU times: user 21min 49s, sys: 25.8 s, total: 22min 15s
Wall time: 22min 17s
sage: def test2():
    for i in xrange(1000):
            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())
            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())
            X = M1._intersection_unweighted(M2)
....:         
sage: %time test2()
CPU times: user 11min 43s, sys: 936 ms, total: 11min 44s
Wall time: 11min 44s
```



---

archive/issue_comments_266093.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMerge conflict, merge in latest beta",
    "created_at": "2015-09-04T18:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266093",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

Merge conflict, merge in latest beta



---

archive/issue_events_266598.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-04T18:48:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266598"
}
```



---

archive/issue_events_266599.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-04T18:48:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266599"
}
```



---

archive/issue_comments_266094.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683e908e3deaf203eddccd4241e2c520993dc5a9\"><code>683e908</code></a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3\"><code>5514ef8</code></a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr></table>\n",
    "created_at": "2015-09-04T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266094",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683e908e3deaf203eddccd4241e2c520993dc5a9"><code>683e908</code></a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3"><code>5514ef8</code></a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr></table>




---

archive/issue_comments_266095.json:
```json
{
    "body": "Changed commit from **[`195feb8`](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)** to **[`5514ef8`](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)**",
    "created_at": "2015-09-04T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266095",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`195feb8`](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)** to **[`5514ef8`](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)**



---

archive/issue_events_266600.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-04T23:17:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266600"
}
```



---

archive/issue_events_266601.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-04T23:17:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266601"
}
```



---

archive/issue_comments_266096.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI don't think that last merge went as planned. I can't get it to compile, and after a \"git trac try 18946\" typing \"git diff master\" gives a long list of changes unrelated to this ticket.",
    "created_at": "2015-09-11T15:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266096",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:13" align="right">comment:13</div>

I don't think that last merge went as planned. I can't get it to compile, and after a "git trac try 18946" typing "git diff master" gives a long list of changes unrelated to this ticket.



---

archive/issue_events_266602.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-11T15:29:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266602"
}
```



---

archive/issue_events_266603.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-11T15:29:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266603"
}
```



---

archive/issue_comments_266097.json:
```json
{
    "body": "Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)** to none",
    "created_at": "2015-09-11T21:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266097",
    "user": "https://github.com/chaoxu"
}
```

Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)** to none



---

archive/issue_comments_266098.json:
```json
{
    "body": "Changed commit from **[`5514ef8`](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)** to none",
    "created_at": "2015-09-11T21:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266098",
    "user": "https://github.com/chaoxu"
}
```

Changed commit from **[`5514ef8`](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)** to none



---

archive/issue_comments_266099.json:
```json
{
    "body": "Branch: **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)**",
    "created_at": "2015-09-11T21:11:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266099",
    "user": "https://github.com/chaoxu"
}
```

Branch: **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)**



---

archive/issue_comments_266100.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI tried to branch from the current develop, and made the same updates.\n\nThe code would look ok with \"git diff develop\".\nOr should I actually work with master?",
    "created_at": "2015-09-11T21:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266100",
    "user": "https://github.com/chaoxu"
}
```

<div id="comment:16" align="right">comment:16</div>

I tried to branch from the current develop, and made the same updates.

The code would look ok with "git diff develop".
Or should I actually work with master?



---

archive/issue_events_266604.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-11T21:17:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266604"
}
```



---

archive/issue_events_266605.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-11T21:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266605"
}
```



---

archive/issue_comments_266101.json:
```json
{
    "body": "Commit: **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**",
    "created_at": "2015-09-11T21:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266101",
    "user": "https://github.com/chaoxu"
}
```

Commit: **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**



---

archive/issue_events_266606.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-09-11T23:03:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266606"
}
```



---

archive/issue_events_266607.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-09-11T23:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266607"
}
```



---

archive/issue_comments_266102.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWe typically work with the `develop` branch. If you work with `master`, chances are that when time comes to merge the ticket, it won't work. Basing the ready for review ticket on the latest Sage beta is the best way to assume that things will go OK.",
    "created_at": "2015-09-11T23:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266102",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

We typically work with the `develop` branch. If you work with `master`, chances are that when time comes to merge the ticket, it won't work. Basing the ready for review ticket on the latest Sage beta is the best way to assume that things will go OK.



---

archive/issue_comments_266103.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nMy bad, I was in a hurry and messed up between the two. Code looks fine and Sage builds and runs. Positive review!",
    "created_at": "2015-09-12T21:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266103",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:18" align="right">comment:18</div>

My bad, I was in a hurry and messed up between the two. Code looks fine and Sage builds and runs. Positive review!



---

archive/issue_events_266608.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-12T21:22:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266608"
}
```



---

archive/issue_events_266609.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-12T21:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266609"
}
```



---

archive/issue_comments_266104.json:
```json
{
    "body": "Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)** to **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**",
    "created_at": "2015-09-14T18:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-266104",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)** to **[`37f2c3b`](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**



---

archive/issue_events_266610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-14T18:59:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266610"
}
```



---

archive/issue_events_266611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d998d4fb33561880c24bdff4e1778cbd9c681624",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-09-14T18:59:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-266611"
}
```
