# Issue 18946: unweighted matroid intersection using blocking flow approach

archive/issues_018709.json:
```json
{
    "assignees": [],
    "body": "Implement a unweighted matroid intersection algorithm that uses O(sqrt(p)rn) independence queries by adopting a blocking flow like technique, where r is the rank, p is the size of the maximum common independent set. \nIt is a bit better than the augmenting paths algorithm, which takes O(prn) queries. However, it's expected to perform worse when p is small, since the constant overhead is a bit larger.\n\nWilliam H Cunningham. 1986. Improved bounds for matroid partition and intersection algorithms. SIAM J. Comput. 15, 4 (November 1986), 948-957. DOI=10.1137/0215066 http://dx.doi.org/10.1137/0215066\n\nCC:  Stefan yomcat Rudi\n\nBranch/Commit: **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**\n\nReviewer: **Stefan van Zwam**\n\nAuthor: **Chao Xu**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18946_\n\n",
    "closed_at": "2015-09-14T18:59:40Z",
    "created_at": "2015-07-24T03:47:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20matroid%20theory",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "unweighted matroid intersection using blocking flow approach",
    "type": "issue",
    "updated_at": "2015-09-14T18:59:40Z",
    "url": "https://github.com/sagemath/sage/issues/18946",
    "user": "https://github.com/chaoxu"
}
```
Implement a unweighted matroid intersection algorithm that uses O(sqrt(p)rn) independence queries by adopting a blocking flow like technique, where r is the rank, p is the size of the maximum common independent set. 
It is a bit better than the augmenting paths algorithm, which takes O(prn) queries. However, it's expected to perform worse when p is small, since the constant overhead is a bit larger.

William H Cunningham. 1986. Improved bounds for matroid partition and intersection algorithms. SIAM J. Comput. 15, 4 (November 1986), 948-957. DOI=10.1137/0215066 http://dx.doi.org/10.1137/0215066

CC:  Stefan yomcat Rudi

Branch/Commit: **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**

Reviewer: **Stefan van Zwam**

Author: **Chao Xu**

_Issue created by migration from https://trac.sagemath.org/ticket/18946_





---

archive/issue_events_242140.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242140"
}
```



---

archive/issue_events_242141.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20matroid%20theory",
    "label_color": "0000ff",
    "label_name": "component: matroid theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242141"
}
```



---

archive/issue_events_242142.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242142"
}
```



---

archive/issue_events_242143.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242143"
}
```



---

archive/issue_comments_268691.json:
```json
{
    "body": "Branch: **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)**",
    "created_at": "2015-07-24T03:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268691",
    "user": "https://github.com/chaoxu"
}
```

Branch: **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)**



---

archive/issue_comments_268692.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f\">c9fb292</a></td><td><code>removed an debugging print out</code></td></tr></table>\n",
    "created_at": "2015-07-24T03:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268692",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f">c9fb292</a></td><td><code>removed an debugging print out</code></td></tr></table>




---

archive/issue_comments_268693.json:
```json
{
    "body": "Commit: **[c9fb292](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)**",
    "created_at": "2015-07-24T03:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268693",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[c9fb292](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)**



---

archive/issue_events_242144.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-07-24T03:59:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242144"
}
```



---

archive/issue_comments_268694.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nHere is a run time comparison if the maximum common independent set is large.\n\n```\nsage: M = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())\nsage: N = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())\nsage: %time len(M.intersection(N))\nCPU times: user 446 ms, sys: 2.05 ms, total: 448 ms\nWall time: 450 ms\n998\nsage: %time len(M._intersection_unweighted(N))\nCPU times: user 316 ms, sys: 569 us, total: 317 ms\nWall time: 317 ms\n998\n```\n\nI have done tests on random matroids and  `intersection(N)` seems to  `_intersection_unweighted(N)`. so far so good.",
    "created_at": "2015-07-24T03:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268694",
    "user": "https://github.com/chaoxu"
}
```

<a id='comment:3'>Comment 3:</a>
Here is a run time comparison if the maximum common independent set is large.

```
sage: M = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())
sage: N = Matroid(MatrixSpace(GF(2), 1000,1000).random_element())
sage: %time len(M.intersection(N))
CPU times: user 446 ms, sys: 2.05 ms, total: 448 ms
Wall time: 450 ms
998
sage: %time len(M._intersection_unweighted(N))
CPU times: user 316 ms, sys: 569 us, total: 317 ms
Wall time: 317 ms
998
```

I have done tests on random matroids and  `intersection(N)` seems to  `_intersection_unweighted(N)`. so far so good.



---

archive/issue_events_242145.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-19T01:53:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242145"
}
```



---

archive/issue_events_242146.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-19T01:53:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242146"
}
```



---

archive/issue_comments_268695.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThe runtime seems to depend a lot on the type of matroid.\n\n```\nsage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 929 ms, sys: 122 ms, total: 1.05 s\nWall time: 1.05 s\nsage: %time X = M1._intersection_unweighted(M2)\nCPU times: user 332 ms, sys: 1.68 ms, total: 334 ms\nWall time: 334 ms\nsage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 37 s, sys: 201 ms, total: 37.2 s\nWall time: 37.2 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 5min 1s, sys: 217 ms, total: 5min 1s\nWall time: 5min 2s\n```\n\nYour method is not accessible to end users; mention it in the documentation of the intersection method. After adding that documentation (where you could say something like \"a method that might be faster, depending on the matroids involved\"), I would say it's good to go in",
    "created_at": "2015-08-20T22:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268695",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<a id='comment:5'>Comment 5:</a>
The runtime seems to depend a lot on the type of matroid.

```
sage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 929 ms, sys: 122 ms, total: 1.05 s
Wall time: 1.05 s
sage: %time X = M1._intersection_unweighted(M2)
CPU times: user 332 ms, sys: 1.68 ms, total: 334 ms
Wall time: 334 ms
sage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 37 s, sys: 201 ms, total: 37.2 s
Wall time: 37.2 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 5min 1s, sys: 217 ms, total: 5min 1s
Wall time: 5min 2s
```

Your method is not accessible to end users; mention it in the documentation of the intersection method. After adding that documentation (where you could say something like "a method that might be faster, depending on the matroids involved"), I would say it's good to go in



---

archive/issue_events_242147.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-08-20T22:40:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242147"
}
```



---

archive/issue_events_242148.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-08-20T22:40:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242148"
}
```



---

archive/issue_comments_268696.json:
```json
{
    "body": "Changed commit from **[c9fb292](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)** to **[195feb8](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)**",
    "created_at": "2015-08-21T23:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268696",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c9fb292](https://github.com/sagemath/sagetrac-mirror/commit/c9fb292e9d2155ddc647e83970204a256ae53b3f)** to **[195feb8](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)**



---

archive/issue_comments_268697.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e217d9e3d72a39b87366af1e617cb9f0666f742d\">e217d9e</a></td><td><code>faster construction of the graph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25\">195feb8</a></td><td><code>update docs</code></td></tr></table>\n",
    "created_at": "2015-08-21T23:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268697",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e217d9e3d72a39b87366af1e617cb9f0666f742d">e217d9e</a></td><td><code>faster construction of the graph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25">195feb8</a></td><td><code>update docs</code></td></tr></table>




---

archive/issue_events_242149.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-08-21T23:08:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242149"
}
```



---

archive/issue_events_242150.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-08-21T23:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242150"
}
```



---

archive/issue_comments_268698.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThis is extremely strange. \nThere are 2 steps in the algorithm. First one is construct the level graph, then do many augmentation in a batch. \nThe bad running time comes from the \"construct the level graph\" in my code. I have no idea why is my version so much slower. (probably due to ordering of the elements, since it actually use fewer  `_closure()` tests)\n\nI replaced it with the one in `_intersection_augmentation()` and apparently solved this problem.\n\nThis update was done quickly, hence this probably need more testing.\n\n```\nsage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 44.6 s, sys: 481 ms, total: 45 s\nWall time: 45.3 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 39 s, sys: 52.2 ms, total: 39 s\nWall time: 37.2 s\nsage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: M2 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())\nsage: %time X = M1.intersection(M2)\nCPU times: user 1.52 s, sys: 332 ms, total: 1.85 s\nWall time: 1.85 s\nsage: %time X2 = M1._intersection_unweighted(M2)\nCPU times: user 191 ms, sys: 2.93 ms, total: 194 ms\nWall time: 194 ms\n```",
    "created_at": "2015-08-21T23:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268698",
    "user": "https://github.com/chaoxu"
}
```

<a id='comment:8'>Comment 8:</a>
This is extremely strange. 
There are 2 steps in the algorithm. First one is construct the level graph, then do many augmentation in a batch. 
The bad running time comes from the "construct the level graph" in my code. I have no idea why is my version so much slower. (probably due to ordering of the elements, since it actually use fewer  `_closure()` tests)

I replaced it with the one in `_intersection_augmentation()` and apparently solved this problem.

This update was done quickly, hence this probably need more testing.

```
sage: M1 = Matroid(MatrixSpace(GF(7), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(3), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 44.6 s, sys: 481 ms, total: 45 s
Wall time: 45.3 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 39 s, sys: 52.2 ms, total: 39 s
Wall time: 37.2 s
sage: M1 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: M2 = Matroid(MatrixSpace(GF(2), 500, 2000).random_element())
sage: %time X = M1.intersection(M2)
CPU times: user 1.52 s, sys: 332 ms, total: 1.85 s
Wall time: 1.85 s
sage: %time X2 = M1._intersection_unweighted(M2)
CPU times: user 191 ms, sys: 2.93 ms, total: 194 ms
Wall time: 194 ms
```



---

archive/issue_comments_268699.json:
```json
{
    "body": "Reviewer: **Stefan van Zwam**",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268699",
    "user": "https://github.com/sagetrac-Stefan"
}
```

Reviewer: **Stefan van Zwam**



---

archive/issue_comments_268700.json:
```json
{
    "body": "Author: **Chao Xu**",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268700",
    "user": "https://github.com/sagetrac-Stefan"
}
```

Author: **Chao Xu**



---

archive/issue_events_242151.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-02T15:45:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242151"
}
```



---

archive/issue_events_242152.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-02T15:45:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242152"
}
```



---

archive/issue_comments_268701.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI did a bunch of tests, and the output was always correct. Also, timing tests now show a consistent speedup. It's good to go in as far as I'm concerned!\n\n```\nsage: def test():\n    for i in xrange(1000):\n            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())\n            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())\n            X = M1.intersection(M2)\n....:         \nsage: %time test()\nCPU times: user 21min 49s, sys: 25.8 s, total: 22min 15s\nWall time: 22min 17s\nsage: def test2():\n    for i in xrange(1000):\n            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())\n            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())\n            X = M1._intersection_unweighted(M2)\n....:         \nsage: %time test2()\nCPU times: user 11min 43s, sys: 936 ms, total: 11min 44s\nWall time: 11min 44s\n```",
    "created_at": "2015-09-02T15:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268701",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<a id='comment:9'>Comment 9:</a>
I did a bunch of tests, and the output was always correct. Also, timing tests now show a consistent speedup. It's good to go in as far as I'm concerned!

```
sage: def test():
    for i in xrange(1000):
            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())
            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())
            X = M1.intersection(M2)
....:         
sage: %time test()
CPU times: user 21min 49s, sys: 25.8 s, total: 22min 15s
Wall time: 22min 17s
sage: def test2():
    for i in xrange(1000):
            M1 = Matroid(MatrixSpace(GF(7), 50, 2000).random_element())
            M2 = Matroid(MatrixSpace(GF(3), 50, 2000).random_element())
            X = M1._intersection_unweighted(M2)
....:         
sage: %time test2()
CPU times: user 11min 43s, sys: 936 ms, total: 11min 44s
Wall time: 11min 44s
```



---

archive/issue_comments_268702.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nMerge conflict, merge in latest beta",
    "created_at": "2015-09-04T18:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268702",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>Comment 10:</a>
Merge conflict, merge in latest beta



---

archive/issue_events_242153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-04T18:48:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242153"
}
```



---

archive/issue_events_242154.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-04T18:48:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242154"
}
```



---

archive/issue_comments_268703.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683e908e3deaf203eddccd4241e2c520993dc5a9\">683e908</a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3\">5514ef8</a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr></table>\n",
    "created_at": "2015-09-04T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268703",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683e908e3deaf203eddccd4241e2c520993dc5a9">683e908</a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3">5514ef8</a></td><td><code>Merge branch 'develop' into u/chaoxu/faster-abstract-matroid-intersection</code></td></tr></table>




---

archive/issue_comments_268704.json:
```json
{
    "body": "Changed commit from **[195feb8](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)** to **[5514ef8](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)**",
    "created_at": "2015-09-04T23:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[195feb8](https://github.com/sagemath/sagetrac-mirror/commit/195feb847638db2c2b1763a1283c9ef31a81fa25)** to **[5514ef8](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)**



---

archive/issue_events_242155.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-04T23:17:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242155"
}
```



---

archive/issue_events_242156.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-04T23:17:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242156"
}
```



---

archive/issue_comments_268705.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI don't think that last merge went as planned. I can't get it to compile, and after a \"git trac try 18946\" typing \"git diff master\" gives a long list of changes unrelated to this ticket.",
    "created_at": "2015-09-11T15:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268705",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<a id='comment:13'>Comment 13:</a>
I don't think that last merge went as planned. I can't get it to compile, and after a "git trac try 18946" typing "git diff master" gives a long list of changes unrelated to this ticket.



---

archive/issue_events_242157.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-11T15:29:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242157"
}
```



---

archive/issue_events_242158.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-11T15:29:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242158"
}
```



---

archive/issue_comments_268706.json:
```json
{
    "body": "Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)** to none",
    "created_at": "2015-09-11T21:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268706",
    "user": "https://github.com/chaoxu"
}
```

Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection)** to none



---

archive/issue_comments_268707.json:
```json
{
    "body": "Changed commit from **[5514ef8](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)** to none",
    "created_at": "2015-09-11T21:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268707",
    "user": "https://github.com/chaoxu"
}
```

Changed commit from **[5514ef8](https://github.com/sagemath/sagetrac-mirror/commit/5514ef89326e9dc7cba4580f817a1e4cd95087d3)** to none



---

archive/issue_comments_268708.json:
```json
{
    "body": "Branch: **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)**",
    "created_at": "2015-09-11T21:11:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268708",
    "user": "https://github.com/chaoxu"
}
```

Branch: **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)**



---

archive/issue_comments_268709.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nI tried to branch from the current develop, and made the same updates.\n\nThe code would look ok with \"git diff develop\".\nOr should I actually work with master?",
    "created_at": "2015-09-11T21:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268709",
    "user": "https://github.com/chaoxu"
}
```

<a id='comment:16'>Comment 16:</a>
I tried to branch from the current develop, and made the same updates.

The code would look ok with "git diff develop".
Or should I actually work with master?



---

archive/issue_events_242159.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-11T21:17:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242159"
}
```



---

archive/issue_events_242160.json:
```json
{
    "actor": "https://github.com/chaoxu",
    "created_at": "2015-09-11T21:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242160"
}
```



---

archive/issue_comments_268710.json:
```json
{
    "body": "Commit: **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**",
    "created_at": "2015-09-11T21:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268710",
    "user": "https://github.com/chaoxu"
}
```

Commit: **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**



---

archive/issue_events_242161.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-09-11T23:03:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242161"
}
```



---

archive/issue_events_242162.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-09-11T23:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242162"
}
```



---

archive/issue_comments_268711.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nWe typically work with the `develop` branch. If you work with `master`, chances are that when time comes to merge the ticket, it won't work. Basing the ready for review ticket on the latest Sage beta is the best way to assume that things will go OK.",
    "created_at": "2015-09-11T23:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268711",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'>Comment 17:</a>
We typically work with the `develop` branch. If you work with `master`, chances are that when time comes to merge the ticket, it won't work. Basing the ready for review ticket on the latest Sage beta is the best way to assume that things will go OK.



---

archive/issue_comments_268712.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nMy bad, I was in a hurry and messed up between the two. Code looks fine and Sage builds and runs. Positive review!",
    "created_at": "2015-09-12T21:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268712",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<a id='comment:18'>Comment 18:</a>
My bad, I was in a hurry and messed up between the two. Code looks fine and Sage builds and runs. Positive review!



---

archive/issue_events_242163.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-12T21:22:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242163"
}
```



---

archive/issue_events_242164.json:
```json
{
    "actor": "https://github.com/sagetrac-Stefan",
    "created_at": "2015-09-12T21:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242164"
}
```



---

archive/issue_comments_268713.json:
```json
{
    "body": "Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)** to **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**",
    "created_at": "2015-09-14T18:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18946#issuecomment-268713",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chaoxu/faster-abstract-matroid-intersection-new](https://github.com/sagemath/sagetrac-mirror/tree/u/chaoxu/faster-abstract-matroid-intersection-new)** to **[37f2c3b](https://github.com/sagemath/sagetrac-mirror/commit/37f2c3bf0ac81d4e422bdcdb5f2ede05c512cab8)**



---

archive/issue_events_242165.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-14T18:59:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242165"
}
```



---

archive/issue_events_242166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d998d4fb33561880c24bdff4e1778cbd9c681624",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-09-14T18:59:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18946#event-242166"
}
```
