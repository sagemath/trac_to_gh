# Issue 18312: Posets: 50x faster is_incomparable_chain_free

archive/issues_018312.json:
```json
{
    "body": "CC:  @nathanncohen\n\nWhen dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run\n\n```\nlen([P for P in P6 if P.is_incomparable_chain_free(2,2)])\n```\n\nbut\n\n```\nA=Posets.ChainPoset(2).disjoint_union(Posets.ChainPoset(2))\nlen([P for P in P6 if not P.has_isomorphic_subposet(A)])\n```\n\ntakes less than one second.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18549\n\n",
    "closed_at": "2015-06-02T14:42:05Z",
    "created_at": "2015-05-29T17:27:26Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Posets: 50x faster is_incomparable_chain_free",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18312",
    "user": "https://github.com/jm58660"
}
```
CC:  @nathanncohen

When dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run

```
len([P for P in P6 if P.is_incomparable_chain_free(2,2)])
```

but

```
A=Posets.ChainPoset(2).disjoint_union(Posets.ChainPoset(2))
len([P for P in P6 if not P.has_isomorphic_subposet(A)])
```

takes less than one second.

Issue created by migration from https://trac.sagemath.org/ticket/18549





---

archive/issue_comments_248018.json:
```json
{
    "body": "An optimization question: Which is more propably for a random poset to have: incomparable chains of size `n` and `n`, or of size `n-1` and `n+1`? It sounds reasonable to except latter one.\n\nIf it so, the parameter (when it is a list of tuples) should be sorted descending by difference of elements of the tuple. We want to return ``False`` as soon as possible.",
    "created_at": "2015-05-29T18:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248018",
    "user": "https://github.com/jm58660"
}
```

An optimization question: Which is more propably for a random poset to have: incomparable chains of size `n` and `n`, or of size `n-1` and `n+1`? It sounds reasonable to except latter one.

If it so, the parameter (when it is a list of tuples) should be sorted descending by difference of elements of the tuple. We want to return ``False`` as soon as possible.



---

archive/issue_comments_248019.json:
```json
{
    "body": "I do not know the answer to the question you ask `O_o`",
    "created_at": "2015-05-29T22:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248019",
    "user": "https://github.com/nathanncohen"
}
```

I do not know the answer to the question you ask `O_o`



---

archive/issue_comments_248020.json:
```json
{
    "body": "This does harm to nobody. Massive speedup might happen only when `dot2tex` is installed. But everyone will save several microseconds with this patch.\n\n---\nNew commits:",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248020",
    "user": "https://github.com/jm58660"
}
```

This does harm to nobody. Massive speedup might happen only when `dot2tex` is installed. But everyone will save several microseconds with this patch.

---
New commits:



---

archive/issue_comments_248021.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248021",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_events_052140.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-05-30T07:18:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18312#event-52140"
}
```



---

archive/issue_comments_248022.json:
```json
{
    "body": "Hello !\n\nI've got no problem with the branch, but could you remove this 'TODO' from the code and opena  ticket instead?\n\nI personally don't believe that Sage should do things like that. It should do what it is asked to do: even if we knew what the most 'probable' pattern is in general, we have no clue what the user's input is.\n\nIf you want some cheap speedup, here is one: you can pre-compute 'height' and remove from the list all pairs with an element larger than 'height'. That would 'always' work, and be rather cheap. \n\nNathann",
    "created_at": "2015-05-30T07:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248022",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

I've got no problem with the branch, but could you remove this 'TODO' from the code and opena  ticket instead?

I personally don't believe that Sage should do things like that. It should do what it is asked to do: even if we knew what the most 'probable' pattern is in general, we have no clue what the user's input is.

If you want some cheap speedup, here is one: you can pre-compute 'height' and remove from the list all pairs with an element larger than 'height'. That would 'always' work, and be rather cheap. 

Nathann



---

archive/issue_comments_248023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-30T15:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248024.json:
```json
{
    "body": "Removed todo-note. I'll think optimization later in new ticket.",
    "created_at": "2015-05-30T15:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248024",
    "user": "https://github.com/jm58660"
}
```

Removed todo-note. I'll think optimization later in new ticket.



---

archive/issue_comments_248025.json:
```json
{
    "body": "Thanks,\n\nNathann",
    "created_at": "2015-05-30T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248025",
    "user": "https://github.com/nathanncohen"
}
```

Thanks,

Nathann



---

archive/issue_comments_248026.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-30T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248026",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248027.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-02T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18312#issuecomment-248027",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-02T14:42:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18312",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18312#event-52141"
}
```
