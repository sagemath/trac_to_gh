# Issue 18217: Various Cython code fixes

archive/issues_017980.json:
```json
{
    "body": "Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment` and this one:\n\n```\nwarning: sage/repl/readline_extra_commands.pyx:173:65: Obtaining 'char *' from externally modifiable global Python value\n```\n\nCC:  jpflori\n\nBranch/Commit: e86d27196b9cee5e2d53c282a51f401e2a00182a\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18217\n\n",
    "closed_at": "2015-04-22T03:22:14Z",
    "created_at": "2015-04-16T08:20:24Z",
    "labels": [
        "component: cython"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Various Cython code fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18217",
    "user": "https://github.com/jdemeyer"
}
```
Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment` and this one:

```
warning: sage/repl/readline_extra_commands.pyx:173:65: Obtaining 'char *' from externally modifiable global Python value
```

CC:  jpflori

Branch/Commit: e86d27196b9cee5e2d53c282a51f401e2a00182a

Reviewer: Frédéric Chapoton

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18217





---

archive/issue_comments_315693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Some improvements to Cython code in Sage. This ticket together with #17890 should fix all Cythonize warnings except `referenced before assignment`.\n+Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment`.\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2015-04-16T08:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315693",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Some improvements to Cython code in Sage. This ticket together with #17890 should fix all Cythonize warnings except `referenced before assignment`.
+Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment`.
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_315694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment` and this one:\n \n+```\n+warning: sage/repl/readline_extra_commands.pyx:173:65: Obtaining 'char *' from externally modifiable global Python value\n+```\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2015-04-16T09:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315694",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
+Some improvements to Cython code in Sage. This ticket together with #17890 and #18121 should fix all Cythonize warnings except `referenced before assignment` and this one:
 
+```
+warning: sage/repl/readline_extra_commands.pyx:173:65: Obtaining 'char *' from externally modifiable global Python value
+```
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_315695.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/various_cython_code_fixes\"",
    "created_at": "2015-04-16T09:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315695",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/various_cython_code_fixes"



---

archive/issue_comments_315696.json:
```json
{
    "body": "Changing commit from \"\" to \"e86d27196b9cee5e2d53c282a51f401e2a00182a\"",
    "created_at": "2015-04-16T09:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315696",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "e86d27196b9cee5e2d53c282a51f401e2a00182a"



---

archive/issue_comments_315697.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-16T09:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315697",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315698.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2015-04-16T09:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315698",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_315699.json:
```json
{
    "body": "<a id='comment:6'></a>I don't quite understand this change:\n\n```diff\n@@ -43,7 +40,6 @@ cdef int c_sage_inputhook() nogil except *:\n         with gil:\n             sage_inputhook()\n             sig_check()\n-    return 0\n \n def install():\n     \"\"\"\n```\nDoesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?",
    "created_at": "2015-04-19T17:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315699",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I don't quite understand this change:

```diff
@@ -43,7 +40,6 @@ cdef int c_sage_inputhook() nogil except *:
         with gil:
             sage_inputhook()
             sig_check()
-    return 0
 
 def install():
     """
```
Doesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?



---

archive/issue_comments_315700.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 tscrim]:\n> I don't quite understand this change:\n> \n> ```diff\n> -    return 0\n> ```\n> Doesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?\n\n\nWhen a Python function always returns `None`, you usually don't put an explicit `return None` at the end either. This function *always* returns 0, so why write it explicitly? The only reason why the return value is `int` is for exception handling. Mentally, this function should really be `void c_sage_inputhook()`.\n\nSide comment: I once asked Cython upstream to include a new type for situations like these (`vint` would be a good name, for `void + int`, analogous to `bint` for `bool + int`), but they didn't like that.",
    "created_at": "2015-04-20T16:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 tscrim]:
> I don't quite understand this change:
> 
> ```diff
> -    return 0
> ```
> Doesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?


When a Python function always returns `None`, you usually don't put an explicit `return None` at the end either. This function *always* returns 0, so why write it explicitly? The only reason why the return value is `int` is for exception handling. Mentally, this function should really be `void c_sage_inputhook()`.

Side comment: I once asked Cython upstream to include a new type for situations like these (`vint` would be a good name, for `void + int`, analogous to `bint` for `bool + int`), but they didn't like that.



---

archive/issue_comments_315701.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2015-04-21T19:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315701",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_315702.json:
```json
{
    "body": "<a id='comment:8'></a>Ok ; I do not feel very competent here. Nevertheless, I have looked at the changes,\nand they look reasonable and innocent enough.\n\nGiven that the patchbot has given a green light, I would be ready to propose a positive\nreview. But maybe you would like a more serious review ?",
    "created_at": "2015-04-21T19:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315702",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Ok ; I do not feel very competent here. Nevertheless, I have looked at the changes,
and they look reasonable and innocent enough.

Given that the patchbot has given a green light, I would be ready to propose a positive
review. But maybe you would like a more serious review ?



---

archive/issue_comments_315703.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-21T19:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315703",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315704.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 chapoton]:\n> But maybe you would like a more serious review ?\n\nTo be honest, I also think the code looks good (I am the author after all). So I'm interpreting your comment as \"positive_review\".",
    "created_at": "2015-04-21T19:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315704",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:8 chapoton]:
> But maybe you would like a more serious review ?

To be honest, I also think the code looks good (I am the author after all). So I'm interpreting your comment as "positive_review".



---

archive/issue_events_051480.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-22T03:22:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18217#event-51480"
}
```



---

archive/issue_comments_315705.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-22T03:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315705",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_315706.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/various_cython_code_fixes\" to \"e86d27196b9cee5e2d53c282a51f401e2a00182a\"",
    "created_at": "2015-04-22T03:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18217#issuecomment-315706",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/various_cython_code_fixes" to "e86d27196b9cee5e2d53c282a51f401e2a00182a"
