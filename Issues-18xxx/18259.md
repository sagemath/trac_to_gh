# Issue 18259: comparison of symbolic functions

archive/issues_018022.json:
```json
{
    "body": "We have the following strange (wrong) behavior:\n\n```\nsage: f(x) = 2*x\nsage: bool(f == 2*x)\nTrue\n```\nOn the other hand we have\n\n```\nsage: f(x) = 2*x\nsage: g(y) = 2*y\nsage: bool(f == g)\nFalse\n```\n\n**CC:**  @rwst @videlec\n\nIssue created by migration from https://trac.sagemath.org/ticket/18259\n\n",
    "created_at": "2015-04-20T12:46:33Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "comparison of symbolic functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18259",
    "user": "https://github.com/dkrenn"
}
```
We have the following strange (wrong) behavior:

```
sage: f(x) = 2*x
sage: bool(f == 2*x)
True
```
On the other hand we have

```
sage: f(x) = 2*x
sage: g(y) = 2*y
sage: bool(f == g)
False
```

**CC:**  @rwst @videlec

Issue created by migration from https://trac.sagemath.org/ticket/18259





---

archive/issue_comments_252862.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis came up in #18092.",
    "created_at": "2015-04-20T12:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18259",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18259#issuecomment-252862",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:1'></a>
This came up in #18092.



---

archive/issue_comments_252863.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis is a consequence of how coercion and comparison are implemented:\n\n```\nsage: var('y')\ny\nsage: f(x)=x*y\nsage: A=x*y\nsage: cSR=parent(f)\nsage: cSR.coerce_map_from(SR)\nConversion map:\n  From: Symbolic Ring\n  To:   Callable function ring with arguments (x,)\nsage: SR.coerce_map_from(cSR) is None\nTrue\n```\nSo, A coerces into the parent of f (and not the other way around): That means that for equality testing, A is coerced into the parent of f and then the comparison is done: comparison testing in sage is defined to be \"equal up to coercion\" (which probably necessarily breaks in all kinds of particular cases).\n\nIf you do *not* want these things to compare equal then you should break the coercion. That might be reasonable. Conversion can still exist. Currently you can do:\n\n```\nsage: f+y^2\nx |--> x*y + y^2\n```\nwithout coercion but with conversion, this would need to be:\n\n```\nsage: f+cSR(y^2)\nx |--> x*y + y^2\n```\nwhich does not seem unreasonable to me.",
    "created_at": "2015-04-21T15:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18259",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18259#issuecomment-252863",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
This is a consequence of how coercion and comparison are implemented:

```
sage: var('y')
y
sage: f(x)=x*y
sage: A=x*y
sage: cSR=parent(f)
sage: cSR.coerce_map_from(SR)
Conversion map:
  From: Symbolic Ring
  To:   Callable function ring with arguments (x,)
sage: SR.coerce_map_from(cSR) is None
True
```
So, A coerces into the parent of f (and not the other way around): That means that for equality testing, A is coerced into the parent of f and then the comparison is done: comparison testing in sage is defined to be "equal up to coercion" (which probably necessarily breaks in all kinds of particular cases).

If you do *not* want these things to compare equal then you should break the coercion. That might be reasonable. Conversion can still exist. Currently you can do:

```
sage: f+y^2
x |--> x*y + y^2
```
without coercion but with conversion, this would need to be:

```
sage: f+cSR(y^2)
x |--> x*y + y^2
```
which does not seem unreasonable to me.



---

archive/issue_comments_252864.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [nbruin](#comment%3A2):\nHi Niles,\n\nWhy not modifying the comparison codes for Callable function ring?\n\n> If you do *not* want these things to compare equal then you should break the coercion. That might be reasonable. Conversion can still exist. Currently you can do:\n> \n> ```\n> sage: f+y^2\n> x |--> x*y + y^2\n> ```\n> without coercion but with conversion, this would need to be:\n> \n> ```\n> sage: f+cSR(y^2)\n> x |--> x*y + y^2\n> ```\n> which does not seem unreasonable to me.\n\n\nI definitely would like to be able to do `f+1` without an error!\n\nVincent",
    "created_at": "2015-04-21T15:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18259",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18259#issuecomment-252864",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Replying to [nbruin](#comment%3A2):
Hi Niles,

Why not modifying the comparison codes for Callable function ring?

> If you do *not* want these things to compare equal then you should break the coercion. That might be reasonable. Conversion can still exist. Currently you can do:
> 
> ```
> sage: f+y^2
> x |--> x*y + y^2
> ```
> without coercion but with conversion, this would need to be:
> 
> ```
> sage: f+cSR(y^2)
> x |--> x*y + y^2
> ```
> which does not seem unreasonable to me.


I definitely would like to be able to do `f+1` without an error!

Vincent



---

archive/issue_comments_252865.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [vdelecroix](#comment%3A3):\n> Why not modifying the comparison codes for Callable function ring?\n\n[...]\n> I definitely would like to be able to do `f+1` without an error!\n\n\nThe second would probably still work if the integers still coerce into `cSR` (and since `cSR` inherits from `SR` it would be a lot of work to break that). But it's a direct consequence that if `f+1` works then `bool( cSR(1) == 1)` will be true, basically because `cSR(1)-1` is then 0 (instead of an error), which is what happens in the example in the ticket too.\n\nIf you're going to change the comparison for the callable function ring you'd be letting `cSR` behave completely different from other sage parents. It would also be a lot of work because currently comparison on `cSR` is just inherited from `SR`.\n\nThe implementation of comparison tests on `SR` only comes into play after the coercion framework has had its way with the arguments.",
    "created_at": "2015-04-21T16:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18259",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18259#issuecomment-252865",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>
Replying to [vdelecroix](#comment%3A3):
> Why not modifying the comparison codes for Callable function ring?

[...]
> I definitely would like to be able to do `f+1` without an error!


The second would probably still work if the integers still coerce into `cSR` (and since `cSR` inherits from `SR` it would be a lot of work to break that). But it's a direct consequence that if `f+1` works then `bool( cSR(1) == 1)` will be true, basically because `cSR(1)-1` is then 0 (instead of an error), which is what happens in the example in the ticket too.

If you're going to change the comparison for the callable function ring you'd be letting `cSR` behave completely different from other sage parents. It would also be a lot of work because currently comparison on `cSR` is just inherited from `SR`.

The implementation of comparison tests on `SR` only comes into play after the coercion framework has had its way with the arguments.
