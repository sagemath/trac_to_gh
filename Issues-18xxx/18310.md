# Issue 18310: Finite dimensional modules with basis: improved conversions to vectors and matrices

archive/issues_018073.json:
```json
{
    "body": "This ticket:\n\n- Implements the option `sparse` for `CombinatorialFreeModule.Element._vector_`\n- Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements\n- Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`\n\nThis is a follow up to #11111.\n\nIt's based on #16659 due to a trivial syntactic conflict. Since #16659\nis likely to be positive reviewed very soon, it's probably not worth\nit making it independent.\n\n\nCC:  @hivert @saliola @avirmaux sage-combinat @tscrim @darijgr\n\nReviewer: Travis Scrimshaw\n\nAuthor: Nicolas M. Thi\u00e9ry\n\nBranch: public/categories/fin_dim_modules_with_basis_vector_matrix-18310\n\nStatus: needs_work\n\nCommit: f4f4e20ce84e476c401738cadbc6b6b88bc43043\n\nIssue created by migration from https://trac.sagemath.org/ticket/18310\n\n",
    "created_at": "2015-04-27T10:21:30Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Finite dimensional modules with basis: improved conversions to vectors and matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18310",
    "user": "https://github.com/nthiery"
}
```
This ticket:

- Implements the option `sparse` for `CombinatorialFreeModule.Element._vector_`
- Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements
- Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`

This is a follow up to #11111.

It's based on #16659 due to a trivial syntactic conflict. Since #16659
is likely to be positive reviewed very soon, it's probably not worth
it making it independent.


CC:  @hivert @saliola @avirmaux sage-combinat @tscrim @darijgr

Reviewer: Travis Scrimshaw

Author: Nicolas M. Thiéry

Branch: public/categories/fin_dim_modules_with_basis_vector_matrix-18310

Status: needs_work

Commit: f4f4e20ce84e476c401738cadbc6b6b88bc43043

Issue created by migration from https://trac.sagemath.org/ticket/18310





---

archive/issue_comments_259052.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n - Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements\n - Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`\n \n+This is a follow up to #11111\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/18310\n``````\n",
    "created_at": "2015-04-27T10:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259052",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,8 @@
 - Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements
 - Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`
 
+This is a follow up to #11111
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/18310
``````




---

archive/issue_comments_259053.json:
```json
{
    "body": "<a id='comment:4'></a>Last 10 new commits:",
    "created_at": "2015-04-27T15:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259053",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>Last 10 new commits:



---

archive/issue_comments_259054.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n+This ticket:\n+\n+- Implements the option `sparse` for `CombinatorialFreeModule.Element._vector_`\n+- Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements\n+- Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`\n+\n+This is a follow up to #11111.\n+\n+It's based on #16659 due to a trivial syntactic conflict. Since #16659\n+is likely to be positive reviewed very soon, it's probably not worth\n+it making it independent.\n \n \n Comment: 1\n``````\n",
    "created_at": "2015-04-27T15:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259054",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
+This ticket:
+
+- Implements the option `sparse` for `CombinatorialFreeModule.Element._vector_`
+- Implements `Modules.WithBasis.FiniteDimensional.ParentMethods.matrix` for building a matrix from a list of elements
+- Refactors `Modules.WithBasis.FiniteDimensional.MorphismMethods.matrix` to use the latter and accept the option `sparse`
+
+This is a follow up to #11111.
+
+It's based on #16659 due to a trivial syntactic conflict. Since #16659
+is likely to be positive reviewed very soon, it's probably not worth
+it making it independent.
 
 
 Comment: 1
``````




---

archive/issue_comments_259055.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-27T16:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259056.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-27T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259056",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_259057.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good overall; I made some minor doc formatting tweaks. This was something Darij and I wondered about when looking at Lie algebras (something I will need to change on that ticket). However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?\n\n---\nNew commits:",
    "created_at": "2015-05-16T22:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259057",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Looks good overall; I made some minor doc formatting tweaks. This was something Darij and I wondered about when looking at Lie algebras (something I will need to change on that ticket). However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?

---
New commits:



---

archive/issue_comments_259058.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-17T20:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259059.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 tscrim]:\n> Looks good overall; I made some minor doc formatting tweaks.\n\n\nI am happy with them; thanks! Isn't triple quoting of strings kind of\noverkill? Not that I really mind, but it's kind of heavy handed and\nreally Sphinx should do that for us ...\n\n> However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?\n\n\nOops; just a marker I had left for myself and I later forgot. There is\na basic implementation now! Back to needs review.\n\nCheers,",
    "created_at": "2015-05-17T20:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259059",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>Replying to [comment:7 tscrim]:
> Looks good overall; I made some minor doc formatting tweaks.


I am happy with them; thanks! Isn't triple quoting of strings kind of
overkill? Not that I really mind, but it's kind of heavy handed and
really Sphinx should do that for us ...

> However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?


Oops; just a marker I had left for myself and I later forgot. There is
a basic implementation now! Back to needs review.

Cheers,



---

archive/issue_comments_259060.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-18T04:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259060",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_259061.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 nthiery]:\n> Replying to [comment:7 tscrim]:\n> > Looks good overall; I made some minor doc formatting tweaks.\n\n> \n> I am happy with them; thanks! Isn't triple quoting of strings kind of\n> overkill? Not that I really mind, but it's kind of heavy handed and\n> really Sphinx should do that for us ...\n\n\nIt's 2 backticks and then a quote, so it gives it that nice code look in the (non-interactive) doc (I prefer this because it is meant to reflect exact user input).\n\n> > However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?\n\n> \n> Oops; just a marker I had left for myself and I later forgot. There is\n> a basic implementation now! Back to needs review.\n\n\nThanks. Positive review.",
    "created_at": "2015-05-18T04:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259061",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Replying to [comment:9 nthiery]:
> Replying to [comment:7 tscrim]:
> > Looks good overall; I made some minor doc formatting tweaks.

> 
> I am happy with them; thanks! Isn't triple quoting of strings kind of
> overkill? Not that I really mind, but it's kind of heavy handed and
> really Sphinx should do that for us ...


It's 2 backticks and then a quote, so it gives it that nice code look in the (non-interactive) doc (I prefer this because it is meant to reflect exact user input).

> > However I have a question about the `column` attribute in `FDModWithBasis.ParentMethods.matrix`. You currently have `assert not columns` in the method. Did you want that to be a `NotImplementedError`, or did you want to have that do something in this ticket?

> 
> Oops; just a marker I had left for myself and I later forgot. There is
> a basic implementation now! Back to needs review.


Thanks. Positive review.



---

archive/issue_comments_259062.json:
```json
{
    "body": "<a id='comment:11'></a>The `base_ring` argument of `matrix()` is not documented in the `INPUT` block.\n\nIMHO, this belongs in the discussion on Trac, not in the docstring, especially the reference to a future hypothetical fix for #18312:\n\n```\nConstructing a sparse matrix with this method is currently\nreally much faster than building it from sparse vectors;\nsee :trac:`18312`::\n\n    sage: n = 10^3; F = CombinatorialFreeModule(QQ, range(n)); vectors = [F.zero()]*n\n    sage: %timeit m = F.matrix(vectors, sparse=True) # not tested\n    The slowest run ...\n    1000 loops, best of 3: 466 \u00b5s per loop\n    sage: %timeit m = matrix(QQ, [v._vector_(sparse=True) for v in vectors], sparse=True) # not tested\n    1 loops, best of 3: 1.19 s per loop\n\nWhen :trac:`18312` will be fixed, using this method is\nlikely to still save some constant time factor.\n```\n\nAnd finally a question: is this new code relevant only for combinatorial free modules or also \"normal\" free modules?",
    "created_at": "2015-05-18T07:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259062",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>The `base_ring` argument of `matrix()` is not documented in the `INPUT` block.

IMHO, this belongs in the discussion on Trac, not in the docstring, especially the reference to a future hypothetical fix for #18312:

```
Constructing a sparse matrix with this method is currently
really much faster than building it from sparse vectors;
see :trac:`18312`::

    sage: n = 10^3; F = CombinatorialFreeModule(QQ, range(n)); vectors = [F.zero()]*n
    sage: %timeit m = F.matrix(vectors, sparse=True) # not tested
    The slowest run ...
    1000 loops, best of 3: 466 µs per loop
    sage: %timeit m = matrix(QQ, [v._vector_(sparse=True) for v in vectors], sparse=True) # not tested
    1 loops, best of 3: 1.19 s per loop

When :trac:`18312` will be fixed, using this method is
likely to still save some constant time factor.
```

And finally a question: is this new code relevant only for combinatorial free modules or also "normal" free modules?



---

archive/issue_comments_259063.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-05-18T07:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259063",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_259064.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-18T09:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259065.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 jdemeyer]:\n> And finally a question: is this new code relevant only for combinatorial free modules or also \"normal\" free modules?\n\n\nAnswering my own question: for normal free modules, it seems that `matrix()` just returns `basis_matrix()`. That's an annoying inconsistency. I actually see no reason to have this `matrix()` alias for `basis_matrix()`.\n\nProposal: define `matrix(*args, **kwds)` in free modules which calls `basis_matrix()` if no arguments are given (this should be deprecated) and calls the modified(*) categories implementation if any argument is supplied.\n\n(*) The `base_ring` of the resulting matrix should be the `coordinate_ring`, not the `base_ring` of the free module.",
    "created_at": "2015-05-18T09:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259065",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:11 jdemeyer]:
> And finally a question: is this new code relevant only for combinatorial free modules or also "normal" free modules?


Answering my own question: for normal free modules, it seems that `matrix()` just returns `basis_matrix()`. That's an annoying inconsistency. I actually see no reason to have this `matrix()` alias for `basis_matrix()`.

Proposal: define `matrix(*args, **kwds)` in free modules which calls `basis_matrix()` if no arguments are given (this should be deprecated) and calls the modified(*) categories implementation if any argument is supplied.

(*) The `base_ring` of the resulting matrix should be the `coordinate_ring`, not the `base_ring` of the free module.



---

archive/issue_comments_259066.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 jdemeyer]:\n> The `base_ring` argument of `matrix()` is not documented in the `INPUT` block.\n\n\nOops, fixed. Thanks!\n\n> IMHO, this belongs in the discussion on Trac, not in the docstring, especially the reference to a future hypothetical fix for #18312:\n\n\nI don't agree. This is not a discussion about how to implement this\nticket, but an information for the user, indicating the relevance of\nthis method in the short and long term. She has little chance to find\nthis information if it's only on trac.\n\n> And finally a question: is this new code relevant only for\n> combinatorial free modules or also \"normal\" free modules?\n\n\nIt's meant for any FiniteDimensionalModulesWithBasis. When \"normal\"\nfree modules will finally be in this category, they will benefit from\nthis code; one of the thing to settle for this is the syntax to\niterate through the terms. Up to this syntax detail, I believe this\ngeneric code from this ticket should work properly.\n\nAh, this raises a good point: FreeModule already defines a `matrix`\nmethod, so we have a name conflict. Any good alternative name\nsuggestion?\n\nCheers,\n                             Nicolas",
    "created_at": "2015-05-18T09:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259066",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>Replying to [comment:11 jdemeyer]:
> The `base_ring` argument of `matrix()` is not documented in the `INPUT` block.


Oops, fixed. Thanks!

> IMHO, this belongs in the discussion on Trac, not in the docstring, especially the reference to a future hypothetical fix for #18312:


I don't agree. This is not a discussion about how to implement this
ticket, but an information for the user, indicating the relevance of
this method in the short and long term. She has little chance to find
this information if it's only on trac.

> And finally a question: is this new code relevant only for
> combinatorial free modules or also "normal" free modules?


It's meant for any FiniteDimensionalModulesWithBasis. When "normal"
free modules will finally be in this category, they will benefit from
this code; one of the thing to settle for this is the syntax to
iterate through the terms. Up to this syntax detail, I believe this
generic code from this ticket should work properly.

Ah, this raises a good point: FreeModule already defines a `matrix`
method, so we have a name conflict. Any good alternative name
suggestion?

Cheers,
                             Nicolas



---

archive/issue_comments_259067.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 nthiery]:\n> but an information for the user, indicating the relevance of\n> this method in the short and long term. She has little chance to find\n> this information if it's only on trac.\n\n\nCompromise: at least remove the sentence `When :trac:`18312` will be fixed, using this method is likely to still save some constant time factor.`",
    "created_at": "2015-05-18T09:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259067",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:14 nthiery]:
> but an information for the user, indicating the relevance of
> this method in the short and long term. She has little chance to find
> this information if it's only on trac.


Compromise: at least remove the sentence `When :trac:`18312` will be fixed, using this method is likely to still save some constant time factor.`



---

archive/issue_comments_259068.json:
```json
{
    "body": "<a id='comment:16'></a>Hi Jeroen!\n\nReplying to [comment:15 jdemeyer]:\n> Replying to [comment:14 nthiery]:\n> > but an information for the user, indicating the relevance of\n> > this method in the short and long term. She has little chance to find\n> > this information if it's only on trac.\n\n> \n> Compromise: at least remove the sentence `When :trac:`18312` will be fixed, using this method is likely to still save some constant time factor.`\n\n\nWith the idea that we will update the comment when `18312` will be fixed? That sounds very reasonable indeed. I am just slightly hesitant, because I would not want the user to believe that this method is just a workaround, when it's actually a way to better express a typical intention, to give a chance to the system to better optimize it. If you think it does not read that way I am happy to remove this sentence.",
    "created_at": "2015-05-18T11:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259068",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:16'></a>Hi Jeroen!

Replying to [comment:15 jdemeyer]:
> Replying to [comment:14 nthiery]:
> > but an information for the user, indicating the relevance of
> > this method in the short and long term. She has little chance to find
> > this information if it's only on trac.

> 
> Compromise: at least remove the sentence `When :trac:`18312` will be fixed, using this method is likely to still save some constant time factor.`


With the idea that we will update the comment when `18312` will be fixed? That sounds very reasonable indeed. I am just slightly hesitant, because I would not want the user to believe that this method is just a workaround, when it's actually a way to better express a typical intention, to give a chance to the system to better optimize it. If you think it does not read that way I am happy to remove this sentence.



---

archive/issue_comments_259069.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:13 jdemeyer]:\n> Answering my own question: for normal free modules, it seems that `matrix()` just returns `basis_matrix()`. That's an annoying inconsistency. I actually see no reason to have this `matrix()` alias for `basis_matrix()`.\n> \n> Proposal: define `matrix(*args, **kwds)` in free modules which calls `basis_matrix()` if no arguments are given (this should be deprecated) and calls the modified(*) categories implementation if any argument is supplied.\n\n\n+1.\n\nDo you agree that this should go in #10672 rather than here? It would\nbe weird to have matrix call a method that is not yet available from\nthe categories. As a first step, we could just deprecate\n`FreeModule.matrix` for now. What do you think?\n\n> (*) The `base_ring` of the resulting matrix should be the `coordinate_ring`, not the `base_ring` of the free module.\n\n\nGasp, another inconsistency: most other modules in Sage (polynomial\nrings, matrix space, ...) don't define coordinate_ring: there it's\nassumed that the coefficients of elements live in `base_ring`.  Ok,\nclarifying this is for #10672 since it's not about this specific\nmethod, but about all uses of `base_ring`.\n\nThanks for the thoughts\n\nCheers,\n                               Nicolas",
    "created_at": "2015-05-18T12:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259069",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:17'></a>Replying to [comment:13 jdemeyer]:
> Answering my own question: for normal free modules, it seems that `matrix()` just returns `basis_matrix()`. That's an annoying inconsistency. I actually see no reason to have this `matrix()` alias for `basis_matrix()`.
> 
> Proposal: define `matrix(*args, **kwds)` in free modules which calls `basis_matrix()` if no arguments are given (this should be deprecated) and calls the modified(*) categories implementation if any argument is supplied.


+1.

Do you agree that this should go in #10672 rather than here? It would
be weird to have matrix call a method that is not yet available from
the categories. As a first step, we could just deprecate
`FreeModule.matrix` for now. What do you think?

> (*) The `base_ring` of the resulting matrix should be the `coordinate_ring`, not the `base_ring` of the free module.


Gasp, another inconsistency: most other modules in Sage (polynomial
rings, matrix space, ...) don't define coordinate_ring: there it's
assumed that the coefficients of elements live in `base_ring`.  Ok,
clarifying this is for #10672 since it's not about this specific
method, but about all uses of `base_ring`.

Thanks for the thoughts

Cheers,
                               Nicolas



---

archive/issue_comments_259070.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 nthiery]:\n> Gasp, another inconsistency: most other modules in Sage (polynomial\n> rings, matrix space, ...) don't define coordinate_ring: there it's\n> assumed that the coefficients of elements live in `base_ring`.\n\nThat's easily worked around by defining `coordinate_ring` as an alias of `base_ring` in the category code. Then it can be overridden in specific cases where needed.",
    "created_at": "2015-05-18T13:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259070",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:17 nthiery]:
> Gasp, another inconsistency: most other modules in Sage (polynomial
> rings, matrix space, ...) don't define coordinate_ring: there it's
> assumed that the coefficients of elements live in `base_ring`.

That's easily worked around by defining `coordinate_ring` as an alias of `base_ring` in the category code. Then it can be overridden in specific cases where needed.



---

archive/issue_comments_259071.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:\n> Replying to [comment:17 nthiery]:\n> > Gasp, another inconsistency: most other modules in Sage (polynomial\n> > rings, matrix space, ...) don't define coordinate_ring: there it's\n> > assumed that the coefficients of elements live in `base_ring`.\n\n> That's easily worked around by defining `coordinate_ring` as an alias of `base_ring` in the category code. Then it can be overridden in specific cases where needed.\n\nYes. And making sure all the category (and users) code calls `coordinate_ring` instead of `base_ring` whenever appropriate. That's certainly doable, but we want to make sure we want this feature generally before adding this little additional layer of complexity.\nAnyway, that's for #10672.",
    "created_at": "2015-05-18T14:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259071",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 nthiery]:
> > Gasp, another inconsistency: most other modules in Sage (polynomial
> > rings, matrix space, ...) don't define coordinate_ring: there it's
> > assumed that the coefficients of elements live in `base_ring`.

> That's easily worked around by defining `coordinate_ring` as an alias of `base_ring` in the category code. Then it can be overridden in specific cases where needed.

Yes. And making sure all the category (and users) code calls `coordinate_ring` instead of `base_ring` whenever appropriate. That's certainly doable, but we want to make sure we want this feature generally before adding this little additional layer of complexity.
Anyway, that's for #10672.



---

archive/issue_comments_259072.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-26T05:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259073.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-26T05:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259073",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259074.json:
```json
{
    "body": "<a id='comment:21'></a>I rebased this over 8.1.beta9, but I'm not sure if there is anything that needs to be addressed from the conversion above. Jeroen, do you happen to remember or can recreate?",
    "created_at": "2017-10-26T05:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259074",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>I rebased this over 8.1.beta9, but I'm not sure if there is anything that needs to be addressed from the conversion above. Jeroen, do you happen to remember or can recreate?



---

archive/issue_events_051654.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-26T05:17:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51654"
}
```



---

archive/issue_comments_259075.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-29T22:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259076.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-07-04T05:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259076",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_259077.json:
```json
{
    "body": "<a id='comment:23'></a>Is this ticket still relevant? It would need rebasing",
    "created_at": "2020-07-04T05:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259077",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Is this ticket still relevant? It would need rebasing



---

archive/issue_events_051655.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-04T05:16:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51655"
}
```



---

archive/issue_events_051656.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-04T05:16:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51656"
}
```



---

archive/issue_comments_259078.json:
```json
{
    "body": "<a id='comment:24'></a>I am pretty sure it is still relevant as this adds extra features like the ability to specify sparseness.",
    "created_at": "2020-07-04T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259078",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>I am pretty sure it is still relevant as this adds extra features like the ability to specify sparseness.



---

archive/issue_comments_259079.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-07-05T23:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259080.json:
```json
{
    "body": "<a id='comment:26'></a>Squashed. Still on top of 8.3.rc3",
    "created_at": "2020-07-05T23:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259080",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Squashed. Still on top of 8.3.rc3



---

archive/issue_comments_259081.json:
```json
{
    "body": "<a id='comment:27'></a>Merging 9.2.beta3 creates some merge conflicts that look like they will be easy to resolve ... for people who know this code well",
    "created_at": "2020-07-05T23:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259081",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Merging 9.2.beta3 creates some merge conflicts that look like they will be easy to resolve ... for people who know this code well



---

archive/issue_comments_259082.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2020-07-05T23:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259082",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_events_051657.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51657"
}
```



---

archive/issue_events_051658.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51658"
}
```



---

archive/issue_events_051659.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51659"
}
```



---

archive/issue_events_051660.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51660"
}
```



---

archive/issue_comments_259083.json:
```json
{
    "body": "<a id='comment:30'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259083",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_259084.json:
```json
{
    "body": "<a id='comment:31'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18310#issuecomment-259084",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_051661.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51661"
}
```



---

archive/issue_events_051662.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51662"
}
```



---

archive/issue_events_051663.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51663"
}
```



---

archive/issue_events_051664.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51664"
}
```



---

archive/issue_events_051665.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51665"
}
```



---

archive/issue_events_051666.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51666"
}
```



---

archive/issue_events_051667.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51667"
}
```



---

archive/issue_events_051668.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18310",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18310#event-51668"
}
```
