# Issue 18375: Drop the NetworkX graph backend

archive/issues_018138.json:
```json
{
    "body": "This branch deprecates the `NetworkX` backend for graphs. Indeed, while it made\nsense to keep a `NetworkXGraphBackend` when Sage's default data structure\nswitched from `networkx` to `c_graphs`, we do not *need* it anymore.\n\nThis does not mean that Sage should not have a `NetworkX` data structure (though\nthere is little use). On the other hand, `NetworkX` is the only reason why we\nhave a `Backend` layer in Sage's graph data structures, as all others are\n`CGraph` backends.\n\nThus, in order to simplify the hierarchy of classes for graph data structures,\nit is easier to uniformize our data structures first. When this series of\npatches will be finished and when the graph backends will be in a clearer and\nsimpler state, it will be possible to implement a new `NetworkX` backend.\n\nIt makes little sense, however, to rewrite the current networkx backend as a\n`c_graph` backend when it will have to be rewritten again later during the\nrefactoring.\n\nTechnical info:\n\n- The main problem in this branch was the handling of (old) graph pickles. As\n  the classes themselves are being deprecated, the `__setstate__` functions\n  detect whenever an attribute uses a deprecated class, and in this case convert\n  it into a non-deprecated data structure (sparse graph, by default).\n\n- Two `random_stress` functions are removed, as they work by comparing the\n  behaviour of `c_graph` and `networkx` backend. This is not as terrible as it\n  sounds, for graphs are tested extensively in many places of Sage (I am often\n  surprised to find out where they are used when code breaks)\n\nCC:  @dcoudert borassi @videlec\n\nBranch/Commit: 98c86a41330a3cffacbedc1743467db9aa08117b\n\nReviewer: David Coudert\n\nAuthor: Nathann Cohen\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18375\n\n",
    "closed_at": "2015-05-27T22:09:32Z",
    "created_at": "2015-05-06T19:49:34Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Drop the NetworkX graph backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18375",
    "user": "https://github.com/nathanncohen"
}
```
This branch deprecates the `NetworkX` backend for graphs. Indeed, while it made
sense to keep a `NetworkXGraphBackend` when Sage's default data structure
switched from `networkx` to `c_graphs`, we do not *need* it anymore.

This does not mean that Sage should not have a `NetworkX` data structure (though
there is little use). On the other hand, `NetworkX` is the only reason why we
have a `Backend` layer in Sage's graph data structures, as all others are
`CGraph` backends.

Thus, in order to simplify the hierarchy of classes for graph data structures,
it is easier to uniformize our data structures first. When this series of
patches will be finished and when the graph backends will be in a clearer and
simpler state, it will be possible to implement a new `NetworkX` backend.

It makes little sense, however, to rewrite the current networkx backend as a
`c_graph` backend when it will have to be rewritten again later during the
refactoring.

Technical info:

- The main problem in this branch was the handling of (old) graph pickles. As
  the classes themselves are being deprecated, the `__setstate__` functions
  detect whenever an attribute uses a deprecated class, and in this case convert
  it into a non-deprecated data structure (sparse graph, by default).

- Two `random_stress` functions are removed, as they work by comparing the
  behaviour of `c_graph` and `networkx` backend. This is not as terrible as it
  sounds, for graphs are tested extensively in many places of Sage (I am often
  surprised to find out where they are used when code breaks)

CC:  @dcoudert borassi @videlec

Branch/Commit: 98c86a41330a3cffacbedc1743467db9aa08117b

Reviewer: David Coudert

Author: Nathann Cohen

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18375





---

archive/issue_comments_244246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-06T19:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244246",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_244247.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-06T19:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_244248.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-07T05:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_244249.json:
```json
{
    "body": "<a id='comment:4'></a>You do not like these `random_stress` functions?",
    "created_at": "2015-05-08T22:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244249",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>You do not like these `random_stress` functions?



---

archive/issue_comments_244250.json:
```json
{
    "body": "<a id='comment:5'></a>> You do not like these `random_stress` functions?\n\n\nNot much. They could have used more doc. But more importantly, they do not work without a networkx backend.",
    "created_at": "2015-05-09T06:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244250",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>> You do not like these `random_stress` functions?


Not much. They could have used more doc. But more importantly, they do not work without a networkx backend.



---

archive/issue_comments_244251.json:
```json
{
    "body": "<a id='comment:6'></a>I did long tests on the graph module and it is OK. The doc also builds properly.\n\nShould I test something else to ensure that this patch is working well? In particular, how can I test the pickle stuff.",
    "created_at": "2015-05-26T18:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244251",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>I did long tests on the graph module and it is OK. The doc also builds properly.

Should I test something else to ensure that this patch is working well? In particular, how can I test the pickle stuff.



---

archive/issue_comments_244252.json:
```json
{
    "body": "<a id='comment:7'></a>Dumb questions that I get scared about when I see this ticket:  What if people are working with NX stuff and want to use them in Sage easily?  Does this make this impossible?  Also, are you suggesting dropping NX as a standard package (assuming it still is one)?",
    "created_at": "2015-05-27T00:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244252",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>Dumb questions that I get scared about when I see this ticket:  What if people are working with NX stuff and want to use them in Sage easily?  Does this make this impossible?  Also, are you suggesting dropping NX as a standard package (assuming it still is one)?



---

archive/issue_comments_244253.json:
```json
{
    "body": "<a id='comment:8'></a>> Dumb questions that I get scared about when I see this ticket:  What if people are working with NX stuff and want to use them in Sage easily?  Does this make this impossible?  Also, are you suggesting dropping NX as a standard package (assuming it still is one)?\n\n\nThis ticket removes a feature you probably did not know even existed:\n\n```\nsage: Graph([(1,2),(3,4)])._backend\n<type 'sage.graphs.base.sparse_graph.SparseGraphBackend'>\nsage: Graph([(1,2),(3,4)],implementation=\"networkx\")._backend\n<class 'sage.graphs.base.graph_backends.NetworkXGraphBackend'>\n```\n\nThe 'networkx' backend only means that inside of the graph class, at a level you are not supposed to reach except when you write low-level graph functions, the graph is stored as a netowrkx object.\n\nThat changes nothing to the fact that networkx is still available in Sage. You can import it, call it, and still get a networkx copy of your graphs with `Graph.networkx_graph()`. And Sage itself still uses networkx in many places: the stupidest example of that is `graphs.CompleteGraph`. Believe it or not, in order to build a complete graph Sage calls networkx' function `networkx.complete_graph(n)`.\n\nNathann",
    "created_at": "2015-05-27T07:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244253",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>> Dumb questions that I get scared about when I see this ticket:  What if people are working with NX stuff and want to use them in Sage easily?  Does this make this impossible?  Also, are you suggesting dropping NX as a standard package (assuming it still is one)?


This ticket removes a feature you probably did not know even existed:

```
sage: Graph([(1,2),(3,4)])._backend
<type 'sage.graphs.base.sparse_graph.SparseGraphBackend'>
sage: Graph([(1,2),(3,4)],implementation="networkx")._backend
<class 'sage.graphs.base.graph_backends.NetworkXGraphBackend'>
```

The 'networkx' backend only means that inside of the graph class, at a level you are not supposed to reach except when you write low-level graph functions, the graph is stored as a netowrkx object.

That changes nothing to the fact that networkx is still available in Sage. You can import it, call it, and still get a networkx copy of your graphs with `Graph.networkx_graph()`. And Sage itself still uses networkx in many places: the stupidest example of that is `graphs.CompleteGraph`. Believe it or not, in order to build a complete graph Sage calls networkx' function `networkx.complete_graph(n)`.

Nathann



---

archive/issue_comments_244254.json:
```json
{
    "body": "<a id='comment:9'></a>> Should I test something else to ensure that this patch is working well? In particular, how can I test the pickle stuff.\n\n\nIt gets tested automatically. It is done in `sage.structure.sage_object`. You can also do it manually with:\n\n```\nsage: sage.structure.sage_object.unpickle_all()\n```\n\nNathann",
    "created_at": "2015-05-27T07:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244254",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>> Should I test something else to ensure that this patch is working well? In particular, how can I test the pickle stuff.


It gets tested automatically. It is done in `sage.structure.sage_object`. You can also do it manually with:

```
sage: sage.structure.sage_object.unpickle_all()
```

Nathann



---

archive/issue_comments_244255.json:
```json
{
    "body": "<a id='comment:10'></a>I did a ./sage -t --long src/sage/  and all tests pass.\n\nI also tried\n\n```\nsage: sage.structure.sage_object.unpickle_all()\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:3035: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/18375 for details.\n  exec(code_obj, self.user_global_ns, self.user_ns)\n/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/1000 for details.\n  #!/usr/bin/env python\n/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.\nSee http://trac.sagemath.org/8920 for details.\n  #!/usr/bin/env python\n/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead\nSee http://trac.sagemath.org/17451 for details.\n  #!/usr/bin/env python\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.py:632: DeprecationWarning: The \"pari_mod\" finite field implementation is deprecated\nSee http://trac.sagemath.org/17297 for details.\n  K = FiniteField_ext_pari(order, name, modulus)\n/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: MatrixSpace_ZZ_2x2 is deprecated. Please use MatrixSpace(ZZ,2) instead\nSee http://trac.sagemath.org/17824 for details.\n  #!/usr/bin/env python\nSuccessfully unpickled 586 objects.\nFailed to unpickle 0 objects.\n```\n\nSo the patch is working well.\n\nHowever, in the doc, on page /reference/graphs/sage/graphs/base/overview.html  the section `The backends` could be updated, at least to mention that the networkx backend is deprecated.",
    "created_at": "2015-05-27T11:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244255",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>I did a ./sage -t --long src/sage/  and all tests pass.

I also tried

```
sage: sage.structure.sage_object.unpickle_all()
/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:3035: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/18375 for details.
  exec(code_obj, self.user_global_ns, self.user_ns)
/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/1000 for details.
  #!/usr/bin/env python
/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.
See http://trac.sagemath.org/8920 for details.
  #!/usr/bin/env python
/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead
See http://trac.sagemath.org/17451 for details.
  #!/usr/bin/env python
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.py:632: DeprecationWarning: The "pari_mod" finite field implementation is deprecated
See http://trac.sagemath.org/17297 for details.
  K = FiniteField_ext_pari(order, name, modulus)
/Users/dcoudert/sage/src/bin/sage-ipython:1: DeprecationWarning: MatrixSpace_ZZ_2x2 is deprecated. Please use MatrixSpace(ZZ,2) instead
See http://trac.sagemath.org/17824 for details.
  #!/usr/bin/env python
Successfully unpickled 586 objects.
Failed to unpickle 0 objects.
```

So the patch is working well.

However, in the doc, on page /reference/graphs/sage/graphs/base/overview.html  the section `The backends` could be updated, at least to mention that the networkx backend is deprecated.



---

archive/issue_comments_244256.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-27T11:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244256",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_244257.json:
```json
{
    "body": "<a id='comment:11'></a>> However, in the doc, on page /reference/graphs/sage/graphs/base/overview.html  the section `The backends` could be updated, at least to mention that the networkx backend is deprecated.\n\n\nArg. Right.\n\nNathann",
    "created_at": "2015-05-27T11:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244257",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>> However, in the doc, on page /reference/graphs/sage/graphs/base/overview.html  the section `The backends` could be updated, at least to mention that the networkx backend is deprecated.


Arg. Right.

Nathann



---

archive/issue_comments_244258.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T11:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_244259.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-27T11:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244259",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_244260.json:
```json
{
    "body": "<a id='comment:13'></a>I updated the doc, which does not mention the netowrkx backend anymore. Note that it is not \"deprecated\", but totally dropped. Users will still see a deprecation warning for a year, but in the backscene the CGraph backend is the one that will be used.\n\nNathann",
    "created_at": "2015-05-27T11:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244260",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>I updated the doc, which does not mention the netowrkx backend anymore. Note that it is not "deprecated", but totally dropped. Users will still see a deprecation warning for a year, but in the backscene the CGraph backend is the one that will be used.

Nathann



---

archive/issue_comments_244261.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-27T12:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244261",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_244262.json:
```json
{
    "body": "<a id='comment:14'></a>For me the patch is now good to go.",
    "created_at": "2015-05-27T12:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244262",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>For me the patch is now good to go.



---

archive/issue_comments_244263.json:
```json
{
    "body": "<a id='comment:15'></a>Thanks !",
    "created_at": "2015-05-27T12:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244263",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'></a>Thanks !



---

archive/issue_comments_244264.json:
```json
{
    "body": "<a id='comment:16'></a>> This ticket removes a feature you probably did not know even existed:\n> The 'networkx' backend only means that inside of the graph class, at a level you are not supposed to reach except when you write low-level graph functions, the graph is stored as a netowrkx object.\n\nOkay, I am fine with that - actually I *did* know that feature existed.\n> Believe it or not, in order to build a complete graph Sage calls networkx' function `networkx.complete_graph(n)`.\n\nYes, in fact I think there are other places where that occurs :)  Thanks for the clarification!",
    "created_at": "2015-05-27T12:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244264",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>> This ticket removes a feature you probably did not know even existed:
> The 'networkx' backend only means that inside of the graph class, at a level you are not supposed to reach except when you write low-level graph functions, the graph is stored as a netowrkx object.

Okay, I am fine with that - actually I *did* know that feature existed.
> Believe it or not, in order to build a complete graph Sage calls networkx' function `networkx.complete_graph(n)`.

Yes, in fact I think there are other places where that occurs :)  Thanks for the clarification!



---

archive/issue_events_051812.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-27T22:09:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18375#event-51812"
}
```



---

archive/issue_comments_244265.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-27T22:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-244265",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
