# Issue 18032: Broken copy, plot in sandpile

archive/issues_017795.json:
```json
{
    "body": "The inherited copy method does not work\n\n```\nsage: g = {0:[1,2], 1:[0,3], 2:[0,3], 3:[1,2]}\nsage: G = Sandpile(g,3)\nsage: G.copy()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-11-3cacdf1124d3> in <module>()\n----> 1 G.copy()\n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __copy__(self, weighted, implementation, data_structure, sparse, immutable)\n   1025                            boundary=copy(self._boundary), weighted=weighted,\n   1026                            implementation=implementation,\n-> 1027                            data_structure=data_structure)\n   1028 \n   1029         attributes_to_copy = ('_assoc', '_embedding')\n\nTypeError: __init__() got an unexpected keyword argument 'weighted'\n```\nThis messes up other inherited methods, e.g. `plot`\n\nCC:  @nathanncohen @dimpase mhampton dperkinson\n\nKeywords: sd66\n\nBranch/Commit: e4c701d3c7c713de540b8e351674093a9ceb6266\n\nReviewer: Nathann Cohen\n\nAuthor: Peter Wicks Stringfield, Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18032\n\n",
    "closed_at": "2015-04-14T19:43:43Z",
    "created_at": "2015-03-21T14:45:19Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Broken copy, plot in sandpile",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18032",
    "user": "https://github.com/vbraun"
}
```
The inherited copy method does not work

```
sage: g = {0:[1,2], 1:[0,3], 2:[0,3], 3:[1,2]}
sage: G = Sandpile(g,3)
sage: G.copy()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-11-3cacdf1124d3> in <module>()
----> 1 G.copy()

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __copy__(self, weighted, implementation, data_structure, sparse, immutable)
   1025                            boundary=copy(self._boundary), weighted=weighted,
   1026                            implementation=implementation,
-> 1027                            data_structure=data_structure)
   1028 
   1029         attributes_to_copy = ('_assoc', '_embedding')

TypeError: __init__() got an unexpected keyword argument 'weighted'
```
This messes up other inherited methods, e.g. `plot`

CC:  @nathanncohen @dimpase mhampton dperkinson

Keywords: sd66

Branch/Commit: e4c701d3c7c713de540b8e351674093a9ceb6266

Reviewer: Nathann Cohen

Author: Peter Wicks Stringfield, Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18032





---

archive/issue_comments_310892.json:
```json
{
    "body": "<a id='comment:1'></a>\nIf somebody actually knows this file, it would be nice to think of what should be done with `random_dag`, `random_digraph` and `random_tree`, which are all exported into the global namespace (and we have `graphs.<tab>` for these things already).",
    "created_at": "2015-03-21T15:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310892",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>
If somebody actually knows this file, it would be nice to think of what should be done with `random_dag`, `random_digraph` and `random_tree`, which are all exported into the global namespace (and we have `graphs.<tab>` for these things already).



---

archive/issue_comments_310893.json:
```json
{
    "body": "<a id='comment:2'></a>\nBut please post your conclusion on the `random_*` methods on a separate ticket.",
    "created_at": "2015-03-21T16:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310893",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
But please post your conclusion on the `random_*` methods on a separate ticket.



---

archive/issue_comments_310894.json:
```json
{
    "body": "<a id='comment:3'></a>\nOf course of course, this belongs to a separate ticket. I do not believe in opening tickets which I do not address myself, so I hoped that the guy who will know that file and work on this ticket can do something about that too.\n\nBut in another ticket, of course.\n\nNathann",
    "created_at": "2015-03-21T16:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310894",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
Of course of course, this belongs to a separate ticket. I do not believe in opening tickets which I do not address myself, so I hoped that the guy who will know that file and work on this ticket can do something about that too.

But in another ticket, of course.

Nathann



---

archive/issue_comments_310895.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe inherited __copy__ method was broken because Sandpile changed the signature of __init__.\n\nI fixed this by moving the part of __copy__ that depends on __init__'s signature into its own function and overriding it in Sandpile.\n\nThis could also be fixed by copy+pasting the entire __copy__ method into Sandpile and tweaking it a bit. I think that's uglier than this though, though maybe not by much.\n\nWhat does everyone else think?",
    "created_at": "2015-03-29T19:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310895",
    "user": "https://trac.sagemath.org/admin/accounts/users/peterwicksstringfield"
}
```

<a id='comment:5'></a>
The inherited __copy__ method was broken because Sandpile changed the signature of __init__.

I fixed this by moving the part of __copy__ that depends on __init__'s signature into its own function and overriding it in Sandpile.

This could also be fixed by copy+pasting the entire __copy__ method into Sandpile and tweaking it a bit. I think that's uglier than this though, though maybe not by much.

What does everyone else think?



---

archive/issue_comments_310896.json:
```json
{
    "body": "Changing branch from \"\" to \"u/peterwicksstringfield/ticket/18032\"",
    "created_at": "2015-03-29T19:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310896",
    "user": "https://trac.sagemath.org/admin/accounts/users/peterwicksstringfield"
}
```

Changing branch from "" to "u/peterwicksstringfield/ticket/18032"



---

archive/issue_comments_310897.json:
```json
{
    "body": "Changing commit from \"\" to \"595a889044e8910542c992f1d6783cb03500fdac\"",
    "created_at": "2015-03-29T19:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "595a889044e8910542c992f1d6783cb03500fdac"



---

archive/issue_comments_310898.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[a15b92f](http://git.sagemath.org/sage.git/commit/?id=a15b92f7e0fe83cf39064c334d26195b7ff5a056)|`Fix minor typo.`|\n|[595a889](http://git.sagemath.org/sage.git/commit/?id=595a889044e8910542c992f1d6783cb03500fdac)|`Fix trac #18032 by making sandpiles copyable.`|",
    "created_at": "2015-03-29T19:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[a15b92f](http://git.sagemath.org/sage.git/commit/?id=a15b92f7e0fe83cf39064c334d26195b7ff5a056)|`Fix minor typo.`|
|[595a889](http://git.sagemath.org/sage.git/commit/?id=595a889044e8910542c992f1d6783cb03500fdac)|`Fix trac #18032 by making sandpiles copyable.`|



---

archive/issue_comments_310899.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-30T14:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310899",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_310900.json:
```json
{
    "body": "<a id='comment:7'></a>\nHello,\n\nThere are several problems with your code:\n\n- Why do you add this new `_make_copy` method in `GenericGraph`? I am not sure\n  that I understand your goal, but I suspect that you may want to learn about\n  the 'super' function of Python:\n\n  http://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods\n\n  Perhaps you only want to call `super().__copy__()` somewhere?\n\n- The way you added `*args` and `**kwds` to the `__init__` method of !Sandpile,\n  the constructor now accepts anything as input,\n  e.g. `Sandpile(heyheyhey=\"heyheyhey\")` which has no meaning. When you use such\n  a syntax, please ensure that one of the two following points is verified:\n\n  a) The method checks that all the arguments that it is given are actually used,\n    and raises an exception otherwise\n\n  b) The method forwards all of `args` and `kwds` to another function\n\n  This way we make sure that all arguments are read at least once, and that none\n  of the input is ignored. This is especially useful to detect typos like\n  `Sandpile(weithged=True)`, which would otherwise return no warning.\n\n- All functions should have an INPUT and a TEST section:\n\n  http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content\n\nNathann",
    "created_at": "2015-03-30T14:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310900",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
Hello,

There are several problems with your code:

- Why do you add this new `_make_copy` method in `GenericGraph`? I am not sure
  that I understand your goal, but I suspect that you may want to learn about
  the 'super' function of Python:

  http://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods

  Perhaps you only want to call `super().__copy__()` somewhere?

- The way you added `*args` and `**kwds` to the `__init__` method of !Sandpile,
  the constructor now accepts anything as input,
  e.g. `Sandpile(heyheyhey="heyheyhey")` which has no meaning. When you use such
  a syntax, please ensure that one of the two following points is verified:

  a) The method checks that all the arguments that it is given are actually used,
    and raises an exception otherwise

  b) The method forwards all of `args` and `kwds` to another function

  This way we make sure that all arguments are read at least once, and that none
  of the input is ignored. This is especially useful to detect typos like
  `Sandpile(weithged=True)`, which would otherwise return no warning.

- All functions should have an INPUT and a TEST section:

  http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content

Nathann



---

archive/issue_comments_310901.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-30T14:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310901",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_310902.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd66\".",
    "created_at": "2015-03-30T14:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310902",
    "user": "https://github.com/nathanncohen"
}
```

Changing keywords from "" to "sd66".



---

archive/issue_comments_310903.json:
```json
{
    "body": "Changing branch from \"u/peterwicksstringfield/ticket/18032\" to \"u/vbraun/ticket/18032\"",
    "created_at": "2015-04-09T00:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310903",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/peterwicksstringfield/ticket/18032" to "u/vbraun/ticket/18032"



---

archive/issue_comments_310904.json:
```json
{
    "body": "<a id='comment:11'></a>\nI added a override for copy. \n\nI don't like the `GenericGraph.__copy__` implementation, for starters its not making a copy. If you want to provide a way to change backends then call the ctor, or provide an appropriately-named method. A copy is not something with completely different innards that happens to compare equal. In any case, its best to not touch it from the Sandpile side.\n\n---\nNew commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[c500bfa](http://git.sagemath.org/sage.git/commit/?id=c500bfa13492c6c51ea52a5b9c0b91fe7b47806a)|`Make Sandpiles copyable`|",
    "created_at": "2015-04-09T00:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310904",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
I added a override for copy. 

I don't like the `GenericGraph.__copy__` implementation, for starters its not making a copy. If you want to provide a way to change backends then call the ctor, or provide an appropriately-named method. A copy is not something with completely different innards that happens to compare equal. In any case, its best to not touch it from the Sandpile side.

---
New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[c500bfa](http://git.sagemath.org/sage.git/commit/?id=c500bfa13492c6c51ea52a5b9c0b91fe7b47806a)|`Make Sandpiles copyable`|



---

archive/issue_comments_310905.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Wicks Stringfield, Volker Braun\"",
    "created_at": "2015-04-09T00:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310905",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Peter Wicks Stringfield, Volker Braun"



---

archive/issue_comments_310906.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-09T00:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310906",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310907.json:
```json
{
    "body": "Changing commit from \"595a889044e8910542c992f1d6783cb03500fdac\" to \"c500bfa13492c6c51ea52a5b9c0b91fe7b47806a\"",
    "created_at": "2015-04-09T00:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310907",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "595a889044e8910542c992f1d6783cb03500fdac" to "c500bfa13492c6c51ea52a5b9c0b91fe7b47806a"



---

archive/issue_comments_310908.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2015-04-09T06:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310908",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_310909.json:
```json
{
    "body": "<a id='comment:12'></a>\nHelloooooo,\n\nLooks good. About the graph's `copy` function, you will appreciate that `G.copy()` does precisely what you expect. Then, if you ask it to do more it will do... What you ask it to `:-P`\n\nNathann",
    "created_at": "2015-04-09T06:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310909",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>
Helloooooo,

Looks good. About the graph's `copy` function, you will appreciate that `G.copy()` does precisely what you expect. Then, if you ask it to do more it will do... What you ask it to `:-P`

Nathann



---

archive/issue_comments_310910.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-09T06:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310910",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310911.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [ncohen](#comment%3A12):\n> Looks good. About the graph's `copy` function, you will appreciate that `G.copy()` does precisely what you expect. Then, if you ask it to do more it will do... What you ask it to `:-P`\n\n\nNo, `G.copy` does not do what I expect it to do. I've never before seen a copy method with a dozen arguments. I expect it to make a copy of ``self``, and I expect it to do nothing else.  \n\nBy the same argument, how about we rename `Matrix.change_ring` to `Matrix.copy` since a) the changed-ring matrix is still `==` comparable, and b) you could pass in the same ring to make a copy. But I hope you can agree that this would be ridiculous.",
    "created_at": "2015-04-09T07:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310911",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>
Replying to [ncohen](#comment%3A12):
> Looks good. About the graph's `copy` function, you will appreciate that `G.copy()` does precisely what you expect. Then, if you ask it to do more it will do... What you ask it to `:-P`


No, `G.copy` does not do what I expect it to do. I've never before seen a copy method with a dozen arguments. I expect it to make a copy of ``self``, and I expect it to do nothing else.  

By the same argument, how about we rename `Matrix.change_ring` to `Matrix.copy` since a) the changed-ring matrix is still `==` comparable, and b) you could pass in the same ring to make a copy. But I hope you can agree that this would be ridiculous.



---

archive/issue_comments_310912.json:
```json
{
    "body": "<a id='comment:15'></a>\nHello,\n\n> No, `G.copy` does not do what I expect it to do.\n\n\nYou misread. I was talking about `G.copy()` (no arguments). It does exactly what you expect it to.\n\nDo you think that it is a problem for a `copy` function to take optional arguments? If so, can you explain why?\n\nI do not believe that there is any risk of confusion possible, the meaning of `G.copy(immutable=True)` or `G.copy(data_structure=\"static_sparse_graph\")` is rather obvious to anybody who reads it.\n\nNathann",
    "created_at": "2015-04-09T08:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310912",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'></a>
Hello,

> No, `G.copy` does not do what I expect it to do.


You misread. I was talking about `G.copy()` (no arguments). It does exactly what you expect it to.

Do you think that it is a problem for a `copy` function to take optional arguments? If so, can you explain why?

I do not believe that there is any risk of confusion possible, the meaning of `G.copy(immutable=True)` or `G.copy(data_structure="static_sparse_graph")` is rather obvious to anybody who reads it.

Nathann



---

archive/issue_comments_310913.json:
```json
{
    "body": "<a id='comment:16'></a>\nIs `G.copy` implementing deep copy or shallow copy? The answer is clearly \"neither\" (or, more precisely, deep copy plus a grab bag of stuff that is not copy). So it should be labeled more accurately. Then people that subclass GenericGraph wouldn't be so confused by it, this ticket is plain evidence that it is confusing. I overrode `__copy__` which now means that the grab bag of non-copy stuff is gone from Sandpile. I say good riddance. But it does make it inconsistent with what is going on in the base class.",
    "created_at": "2015-04-09T08:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310913",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
Is `G.copy` implementing deep copy or shallow copy? The answer is clearly "neither" (or, more precisely, deep copy plus a grab bag of stuff that is not copy). So it should be labeled more accurately. Then people that subclass GenericGraph wouldn't be so confused by it, this ticket is plain evidence that it is confusing. I overrode `__copy__` which now means that the grab bag of non-copy stuff is gone from Sandpile. I say good riddance. But it does make it inconsistent with what is going on in the base class.



---

archive/issue_comments_310914.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe problem that you met here is not related to copy. The problem is that `SandPile` inherits from `Graph`, but that its `__init__` function does not accept all arguments that `Graph.__init__` accepts.\n\nNathann",
    "created_at": "2015-04-09T08:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310914",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>
The problem that you met here is not related to copy. The problem is that `SandPile` inherits from `Graph`, but that its `__init__` function does not accept all arguments that `Graph.__init__` accepts.

Nathann



---

archive/issue_comments_310915.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-09T09:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310915",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_310916.json:
```json
{
    "body": "<a id='comment:18'></a>\nI know, but that is fair game in OOP. The standard lore is that you need to provide a copy ctor (`__copy__`) if you change the ctor (`__init__`) arguments. Then you can always make copies as needed. The ctor makes instances (and its arguments may change in subclasses), the copy ctor makes identical (as far as possible) copies (and takes the same = no arguments all the time).\n\nEven with this ticket `Sandpile.copy == GenericGraph.__copy__` still doesn't work. That is fine with me since it doesn't make a copy anyways. But `plot()` also calls `copy(immutable=False)`, so plot is still broken. Why can't we plot immutable graphs to start with? Also, copies should be mutable, that usually the point of copying the immutable object. See e.g.:\n\n```\nsage: v = vector([1, 2, 3])\nsage: v.is_immutable()\nFalse\nsage: v.set_immutable()\nsage: v.is_immutable()\nTrue\nsage: copy(v).is_immutable()\nFalse\n```",
    "created_at": "2015-04-09T09:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310916",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
I know, but that is fair game in OOP. The standard lore is that you need to provide a copy ctor (`__copy__`) if you change the ctor (`__init__`) arguments. Then you can always make copies as needed. The ctor makes instances (and its arguments may change in subclasses), the copy ctor makes identical (as far as possible) copies (and takes the same = no arguments all the time).

Even with this ticket `Sandpile.copy == GenericGraph.__copy__` still doesn't work. That is fine with me since it doesn't make a copy anyways. But `plot()` also calls `copy(immutable=False)`, so plot is still broken. Why can't we plot immutable graphs to start with? Also, copies should be mutable, that usually the point of copying the immutable object. See e.g.:

```
sage: v = vector([1, 2, 3])
sage: v.is_immutable()
False
sage: v.set_immutable()
sage: v.is_immutable()
True
sage: copy(v).is_immutable()
False
```



---

archive/issue_comments_310917.json:
```json
{
    "body": "<a id='comment:19'></a>\nWell, add a `**kwds` to the constructor, forward everything to `super().__init__` and you are done.\n\nNathann",
    "created_at": "2015-04-09T09:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310917",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:19'></a>
Well, add a `**kwds` to the constructor, forward everything to `super().__init__` and you are done.

Nathann



---

archive/issue_comments_310918.json:
```json
{
    "body": "<a id='comment:20'></a>\nNuuh, `GenericGraph.copy` will still not pass positional arguments to `Sandpile.__init__`.",
    "created_at": "2015-04-09T09:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310918",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
Nuuh, `GenericGraph.copy` will still not pass positional arguments to `Sandpile.__init__`.



---

archive/issue_comments_310919.json:
```json
{
    "body": "<a id='comment:21'></a>\n> Nuuh, `GenericGraph.copy` will still not pass positional arguments to `Sandpile.__init__`.\n\n\nIf your `copy` accept `**kwds` and you forward everything to the constructor then it should work, shouldn't it?\n\nNathann",
    "created_at": "2015-04-09T09:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310919",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>
> Nuuh, `GenericGraph.copy` will still not pass positional arguments to `Sandpile.__init__`.


If your `copy` accept `**kwds` and you forward everything to the constructor then it should work, shouldn't it?

Nathann



---

archive/issue_comments_310920.json:
```json
{
    "body": "<a id='comment:22'></a>\nIn other words I also have to override `copy` in addition to `__copy__`. How very convenient. This is why Peter originally factored out the `self.__class__` call inside `__copy__`, to provide a hook to override this call. It is all a logical consequence of having `__copy__` do non-copy stuff...",
    "created_at": "2015-04-09T09:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310920",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
In other words I also have to override `copy` in addition to `__copy__`. How very convenient. This is why Peter originally factored out the `self.__class__` call inside `__copy__`, to provide a hook to override this call. It is all a logical consequence of having `__copy__` do non-copy stuff...



---

archive/issue_comments_310921.json:
```json
{
    "body": "<a id='comment:23'></a>\n> In other words I also have to override `copy` in addition to `__copy__`. How very convenient. This is why Peter originally factored out the `self.__class__` call inside `__copy__`, to provide a hook to override this call. It is all a logical consequence of having `__copy__` do non-copy stuff...\n\n\nThe same would have happened with any other function. If a class B inherits from A but B.f has fewer arguments than A.f, then of course something is going to break.\n\nNow, if you look at `Sandpile.<tab>` and most methods do not make sense to you, then perhaps `Sandpile` should not inherit from `Graph` but merely have a `._graph` variable.\n\nNathann",
    "created_at": "2015-04-09T09:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310921",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:23'></a>
> In other words I also have to override `copy` in addition to `__copy__`. How very convenient. This is why Peter originally factored out the `self.__class__` call inside `__copy__`, to provide a hook to override this call. It is all a logical consequence of having `__copy__` do non-copy stuff...


The same would have happened with any other function. If a class B inherits from A but B.f has fewer arguments than A.f, then of course something is going to break.

Now, if you look at `Sandpile.<tab>` and most methods do not make sense to you, then perhaps `Sandpile` should not inherit from `Graph` but merely have a `._graph` variable.

Nathann



---

archive/issue_comments_310922.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [ncohen](#comment%3A23):\n> The same would have happened with any other function. If a class B inherits from A but B.f has fewer arguments than A.f, then of course something is going to break.\n\n\nExcept that `__copy__` isn't supposed to have any arguments, and if Graphs would follow that simple rule then we wouldn't have the problem.",
    "created_at": "2015-04-09T09:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310922",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>
Replying to [ncohen](#comment%3A23):
> The same would have happened with any other function. If a class B inherits from A but B.f has fewer arguments than A.f, then of course something is going to break.


Except that `__copy__` isn't supposed to have any arguments, and if Graphs would follow that simple rule then we wouldn't have the problem.



---

archive/issue_comments_310923.json:
```json
{
    "body": "<a id='comment:25'></a>\n> Except that `__copy__` isn't supposed to have any arguments, and if Graphs would follow that simple rule then we wouldn't have the problem. \n\n\nFeel free to replace `GenericGraph.__copy__` by a new function with no arguments that calls `.copy()` (with no argument). I fail to see how that is an improvement, but if that makes it simpler for you I do not mind.\n\nNathann",
    "created_at": "2015-04-09T09:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310923",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:25'></a>
> Except that `__copy__` isn't supposed to have any arguments, and if Graphs would follow that simple rule then we wouldn't have the problem. 


Feel free to replace `GenericGraph.__copy__` by a new function with no arguments that calls `.copy()` (with no argument). I fail to see how that is an improvement, but if that makes it simpler for you I do not mind.

Nathann



---

archive/issue_comments_310924.json:
```json
{
    "body": "<a id='comment:26'></a>\nThats not an improvement since `plot()` still calls `G.copy()` (which shouldn't have been called copy) instead of `G.__copy__()`  to make a copy.",
    "created_at": "2015-04-09T10:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310924",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
Thats not an improvement since `plot()` still calls `G.copy()` (which shouldn't have been called copy) instead of `G.__copy__()`  to make a copy.



---

archive/issue_comments_310925.json:
```json
{
    "body": "<a id='comment:27'></a>\n> Thats not an improvement since `plot()` still calls `G.copy()`\n\n\nI agree. Which totally proves that the problem is not that `__copy__` takes arguments, but that you inherit a function which you overwrite while accepting fewer arguments.\n\nI think that the easiest is to accept `**kwds` in your copy function and to forward it to the constructor. Same in the constructor, which will forward everything to `Graph.__init__`.\n\nNathann",
    "created_at": "2015-04-09T10:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310925",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:27'></a>
> Thats not an improvement since `plot()` still calls `G.copy()`


I agree. Which totally proves that the problem is not that `__copy__` takes arguments, but that you inherit a function which you overwrite while accepting fewer arguments.

I think that the easiest is to accept `**kwds` in your copy function and to forward it to the constructor. Same in the constructor, which will forward everything to `Graph.__init__`.

Nathann



---

archive/issue_comments_310926.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [ncohen](#comment%3A27):\n> I agree. Which totally proves that the problem is not that `__copy__` takes arguments, but that you inherit a function which you overwrite while accepting fewer arguments.\n\n\nBut `__copy__` is not supposed to take arguments precisely because you would then fall into this trap.",
    "created_at": "2015-04-09T10:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310926",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
Replying to [ncohen](#comment%3A27):
> I agree. Which totally proves that the problem is not that `__copy__` takes arguments, but that you inherit a function which you overwrite while accepting fewer arguments.


But `__copy__` is not supposed to take arguments precisely because you would then fall into this trap.



---

archive/issue_comments_310927.json:
```json
{
    "body": "<a id='comment:29'></a>\n> But `__copy__` is not supposed to take arguments precisely because you would then fall into this trap.\n\n\nI fail to see why this problem could happen with `__copy__` and not with other functions.\n\nNathann",
    "created_at": "2015-04-09T10:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310927",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:29'></a>
> But `__copy__` is not supposed to take arguments precisely because you would then fall into this trap.


I fail to see why this problem could happen with `__copy__` and not with other functions.

Nathann



---

archive/issue_comments_310928.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[e4c701d](http://git.sagemath.org/sage.git/commit/?id=e4c701d3c7c713de540b8e351674093a9ceb6266)|`Implement GenericGraph.__copy__`|",
    "created_at": "2015-04-09T12:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[e4c701d](http://git.sagemath.org/sage.git/commit/?id=e4c701d3c7c713de540b8e351674093a9ceb6266)|`Implement GenericGraph.__copy__`|



---

archive/issue_comments_310929.json:
```json
{
    "body": "Changing commit from \"c500bfa13492c6c51ea52a5b9c0b91fe7b47806a\" to \"e4c701d3c7c713de540b8e351674093a9ceb6266\"",
    "created_at": "2015-04-09T12:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c500bfa13492c6c51ea52a5b9c0b91fe7b47806a" to "e4c701d3c7c713de540b8e351674093a9ceb6266"



---

archive/issue_comments_310930.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-09T12:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310930",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310931.json:
```json
{
    "body": "<a id='comment:31'></a>\nMaybe its clearer now, just fixing `GenericGraph.__copy__` also fixes the Sandpile plotting.",
    "created_at": "2015-04-09T12:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310931",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
Maybe its clearer now, just fixing `GenericGraph.__copy__` also fixes the Sandpile plotting.



---

archive/issue_comments_310932.json:
```json
{
    "body": "<a id='comment:32'></a>\nYou are making the default behaviour of `copy` to *change* the backend?\n\nNathann",
    "created_at": "2015-04-09T12:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310932",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:32'></a>
You are making the default behaviour of `copy` to *change* the backend?

Nathann



---

archive/issue_comments_310933.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-09T12:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310933",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_310934.json:
```json
{
    "body": "<a id='comment:33'></a>\nOnly if necessary (i.e. only if the current backend doesn't support mutable graphs). The expected behavior of copy is that the copy is mutable.",
    "created_at": "2015-04-10T10:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310934",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
Only if necessary (i.e. only if the current backend doesn't support mutable graphs). The expected behavior of copy is that the copy is mutable.



---

archive/issue_comments_310935.json:
```json
{
    "body": "<a id='comment:34'></a>\n> The expected behavior of copy is that the copy is mutable.\n\n\nNo.\n\n```\nsage: copy((1,2,3))\n(1, 2, 3)\n```\n\nNathann",
    "created_at": "2015-04-10T10:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310935",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:34'></a>
> The expected behavior of copy is that the copy is mutable.


No.

```
sage: copy((1,2,3))
(1, 2, 3)
```

Nathann



---

archive/issue_comments_310936.json:
```json
{
    "body": "<a id='comment:35'></a>\nIts a Sage convention, not a Python convention. Python doesn't have a concept of (imm)mutability for a single class, just completely different classes. Of course copy has to return an instance of the same class.",
    "created_at": "2015-04-10T10:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310936",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
Its a Sage convention, not a Python convention. Python doesn't have a concept of (imm)mutability for a single class, just completely different classes. Of course copy has to return an instance of the same class.



---

archive/issue_comments_310937.json:
```json
{
    "body": "<a id='comment:36'></a>\n> Its a Sage convention, not a Python convention. Python doesn't have a concept of (imm)mutability for a single class, just completely different classes. Of course copy has to return an instance of the same class.\n\n\nI disagree with the change that you propose. Now as you have a way to fix your bug with 4 lines of code please implement that.\n\nNathann",
    "created_at": "2015-04-10T10:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310937",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:36'></a>
> Its a Sage convention, not a Python convention. Python doesn't have a concept of (imm)mutability for a single class, just completely different classes. Of course copy has to return an instance of the same class.


I disagree with the change that you propose. Now as you have a way to fix your bug with 4 lines of code please implement that.

Nathann



---

archive/issue_comments_310938.json:
```json
{
    "body": "<a id='comment:37'></a>\nIts the same interface that vectors and matrices have. If you disagree with these too then fine. But my change is a big improvement to the graph code.",
    "created_at": "2015-04-10T10:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310938",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>
Its the same interface that vectors and matrices have. If you disagree with these too then fine. But my change is a big improvement to the graph code.



---

archive/issue_comments_310939.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-10T19:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310939",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_310940.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310940",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_310941.json:
```json
{
    "body": "Changing branch from \"u/vbraun/ticket/18032\" to \"e4c701d3c7c713de540b8e351674093a9ceb6266\"",
    "created_at": "2015-04-14T19:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18032#issuecomment-310941",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/ticket/18032" to "e4c701d3c7c713de540b8e351674093a9ceb6266"



---

archive/issue_events_051205.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:43:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18032",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18032#event-51205"
}
```
