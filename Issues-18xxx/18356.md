# Issue 18356: special resultants ``composed_sum`` and ``composed_product``

archive/issues_018119.json:
```json
{
    "body": "Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division of two polynomias. That is the polynomial whose roots are the sum (resp. difference, product, division) of the roots of the two polynomials.\n\nTwo implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. For the latter algorithm, only polynomial with coefficient in `ZZ` or `QQ` are supported. However, this algorithm is asymptotically faster than using the `resultant` method.\n\nFor instance\n\n```\nsage: p1 = minpoly(cos(pi/43))\nsage: p2 = minpoly(cos(pi/47))\nsage: time r1 = p1.composed_op(p2, operator.add)\nCPU times: user 108 ms, sys: 4 ms, total: 112 ms\nWall time: 111 ms\nsage: time r2 = p1.composed_op(p2, operator.add, algorithm=\"resultant\")\nCPU times: user 47.1 s, sys: 0 ns, total: 47.1 s\nWall time: 47.1 s\nsage: r1 == r2\nTrue\nsage: r1.is_irreducible()\nTrue\n```\nIn the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n\nReference:\n\n [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, \"Fast Computation of special resultants\", Journal of Symbolic Computation 41 (2006), 1-29\n\nReviewer: Vincent Delecroix, Marc Mezzarobba\n\nAuthor: Mario Pernici, Vincent Delecroix\n\nBranch: c6b1c35de85957fc501d6f34b4de6b8def0a8ea0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18356\n\n",
    "closed_at": "2016-05-19T22:39:02Z",
    "created_at": "2015-05-03T17:41:29Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "special resultants ``composed_sum`` and ``composed_product``",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18356",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```
Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division of two polynomias. That is the polynomial whose roots are the sum (resp. difference, product, division) of the roots of the two polynomials.

Two implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. For the latter algorithm, only polynomial with coefficient in `ZZ` or `QQ` are supported. However, this algorithm is asymptotically faster than using the `resultant` method.

For instance

```
sage: p1 = minpoly(cos(pi/43))
sage: p2 = minpoly(cos(pi/47))
sage: time r1 = p1.composed_op(p2, operator.add)
CPU times: user 108 ms, sys: 4 ms, total: 112 ms
Wall time: 111 ms
sage: time r2 = p1.composed_op(p2, operator.add, algorithm="resultant")
CPU times: user 47.1 s, sys: 0 ns, total: 47.1 s
Wall time: 47.1 s
sage: r1 == r2
True
sage: r1.is_irreducible()
True
```
In the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`

Reference:

 [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, "Fast Computation of special resultants", Journal of Symbolic Computation 41 (2006), 1-29

Reviewer: Vincent Delecroix, Marc Mezzarobba

Author: Mario Pernici, Vincent Delecroix

Branch: c6b1c35de85957fc501d6f34b4de6b8def0a8ea0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18356





---

archive/issue_comments_319306.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pernici/ticket/18356\"",
    "created_at": "2015-05-03T17:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319306",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Changing branch from "" to "u/pernici/ticket/18356"



---

archive/issue_comments_319307.json:
```json
{
    "body": "<a id='comment:2'></a>Here is a benchmark\n\n```\ndef bench(p, op, n):\n    print 'p=', p\n    for n in range(1, n):\n        q = p^n\n        p1 = q*(q + 1)\n        p2 = (q + 2)*(q + 3)\n        f = getattr(p1, 'composed_sum') if op == '+' else getattr(p1, 'composed_product')\n        t0 = time(); r1 = f(p2, \"resultant\",op)\n        t1 = time(); r2 = f(p2, \"BFSS\", op)\n        t2 = time()\n        assert r1.monic() == r2\n        print 'op = %s n=%d resultant:%.4f BFSS:%.4f' %(op, n,t1-t0,t2-t1)\n\n```\nHere are some results; in the case of sparse polynomials the resultant performs\nbetter than in the case of dense polynomials\n\n```\np= x^4\nop = + n=1 resultant:0.0020 BFSS:0.0141\nop = + n=2 resultant:0.0146 BFSS:0.0350\nop = + n=3 resultant:0.0790 BFSS:0.1117\nop = + n=4 resultant:0.2977 BFSS:0.2673\nop = + n=5 resultant:0.9597 BFSS:0.5701\nop = + n=6 resultant:2.7090 BFSS:1.1049\nop = + n=7 resultant:7.3010 BFSS:2.0877\n\np= x^4 + 7*x^3 + 3*x^2 + 9*x + 11\nop = + n=1 resultant:0.0171 BFSS:0.0170\nop = + n=2 resultant:1.0814 BFSS:0.0852\nop = + n=3 resultant:22.6607 BFSS:0.3979\n```",
    "created_at": "2015-05-03T18:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319307",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:2'></a>Here is a benchmark

```
def bench(p, op, n):
    print 'p=', p
    for n in range(1, n):
        q = p^n
        p1 = q*(q + 1)
        p2 = (q + 2)*(q + 3)
        f = getattr(p1, 'composed_sum') if op == '+' else getattr(p1, 'composed_product')
        t0 = time(); r1 = f(p2, "resultant",op)
        t1 = time(); r2 = f(p2, "BFSS", op)
        t2 = time()
        assert r1.monic() == r2
        print 'op = %s n=%d resultant:%.4f BFSS:%.4f' %(op, n,t1-t0,t2-t1)

```
Here are some results; in the case of sparse polynomials the resultant performs
better than in the case of dense polynomials

```
p= x^4
op = + n=1 resultant:0.0020 BFSS:0.0141
op = + n=2 resultant:0.0146 BFSS:0.0350
op = + n=3 resultant:0.0790 BFSS:0.1117
op = + n=4 resultant:0.2977 BFSS:0.2673
op = + n=5 resultant:0.9597 BFSS:0.5701
op = + n=6 resultant:2.7090 BFSS:1.1049
op = + n=7 resultant:7.3010 BFSS:2.0877

p= x^4 + 7*x^3 + 3*x^2 + 9*x + 11
op = + n=1 resultant:0.0171 BFSS:0.0170
op = + n=2 resultant:1.0814 BFSS:0.0852
op = + n=3 resultant:22.6607 BFSS:0.3979
```



---

archive/issue_comments_319308.json:
```json
{
    "body": "Changing commit from \"\" to \"3806e8403764abf4d391161f836f0ec422201cc5\"",
    "created_at": "2015-05-03T18:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319308",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Changing commit from "" to "3806e8403764abf4d391161f836f0ec422201cc5"



---

archive/issue_comments_319309.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-03T18:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319309",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_319310.json:
```json
{
    "body": "<a id='comment:4'></a>Hi,\n\nIf you look at the branch field in the ticket description you will see that it is red. It means that there is a merge conflict with the last beta. What you have to do is not to start from the stable release but from the development release (the name of the branch on the server is \"develop\"). Do you know how to do that?\n\nVincent",
    "created_at": "2015-05-03T18:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319310",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>Hi,

If you look at the branch field in the ticket description you will see that it is red. It means that there is a merge conflict with the last beta. What you have to do is not to start from the stable release but from the development release (the name of the branch on the server is "develop"). Do you know how to do that?

Vincent



---

archive/issue_comments_319311.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-03T18:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319311",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319312.json:
```json
{
    "body": "<a id='comment:5'></a>I had a look at the branch, just some comment\n\n1. It is better to use `Return XYZ` rather than `Compute XYZ` in the one line description of functions. What the function is internally doing is mostly a technical question. What you want to know when reading the documentation is what does the function return.\n\n2. This is old cython\n\n```\ncdef int i\nfor i from 0 <= i <= n:\n    ...\n```\n  you can just write\n\n```\ncdef int i\nfor i in range(n):\n    ...\n```\n  this will be transformed into a C loop by Cython.\n \n3. In `hadamard_product` I would defined precisely what is the pointwise product. If you have a naive look to wikipedia, the pointwise product of two functions `f` and `g` is just `x -> f(x)g(x)`.\n\nVincent",
    "created_at": "2015-05-03T19:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319312",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>I had a look at the branch, just some comment

1. It is better to use `Return XYZ` rather than `Compute XYZ` in the one line description of functions. What the function is internally doing is mostly a technical question. What you want to know when reading the documentation is what does the function return.

2. This is old cython

```
cdef int i
for i from 0 <= i <= n:
    ...
```
  you can just write

```
cdef int i
for i in range(n):
    ...
```
  this will be transformed into a C loop by Cython.
 
3. In `hadamard_product` I would defined precisely what is the pointwise product. If you have a naive look to wikipedia, the pointwise product of two functions `f` and `g` is just `x -> f(x)g(x)`.

Vincent



---

archive/issue_comments_319313.json:
```json
{
    "body": "<a id='comment:6'></a>Hi Vincent,\n  I opened  #18373 based on the development branch, replacing this ticket.\n  I followed your suggestions here and in #18242 :\n\n    In `newton_sum` the ring `R` is added as an argument\n\n    Avoided using fraction fields (apart from ``R(QQ(1)/p1)`` there was also a division by `x`).\n\n    Eliminated duplicate code, merging `composed_add` and `composed_product`.\n\n    I did some benchmark; there is a strong dependence on the sparseness of the polynomials.\n    The resultant algorithm is faster with some polynomials with few coefficients and high degree.\n    By default `composed_op` selects which algorithm to use, based on the degree and the number\n    of nonvanishing coefficients.\n    The dependence on the size of the coefficients does not seem to make much difference.\n\n    I eliminated `hadamard_product`.",
    "created_at": "2015-05-06T17:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319313",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:6'></a>Hi Vincent,
  I opened  #18373 based on the development branch, replacing this ticket.
  I followed your suggestions here and in #18242 :

    In `newton_sum` the ring `R` is added as an argument

    Avoided using fraction fields (apart from ``R(QQ(1)/p1)`` there was also a division by `x`).

    Eliminated duplicate code, merging `composed_add` and `composed_product`.

    I did some benchmark; there is a strong dependence on the sparseness of the polynomials.
    The resultant algorithm is faster with some polynomials with few coefficients and high degree.
    By default `composed_op` selects which algorithm to use, based on the degree and the number
    of nonvanishing coefficients.
    The dependence on the size of the coefficients does not seem to make much difference.

    I eliminated `hadamard_product`.



---

archive/issue_comments_319314.json:
```json
{
    "body": "<a id='comment:7'></a>Hello,\n\nYou should **not** open a new ticket each time you create a branch. Now we have three duplicated tickets!! Delete #18373 (i.e. remove the branch field and set the milestone to `sage-duplicate/invalid/won't fix`) and simply modify the branch of this ticket.\n\nVincent",
    "created_at": "2015-05-07T08:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319314",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Hello,

You should **not** open a new ticket each time you create a branch. Now we have three duplicated tickets!! Delete #18373 (i.e. remove the branch field and set the milestone to `sage-duplicate/invalid/won't fix`) and simply modify the branch of this ticket.

Vincent



---

archive/issue_comments_319315.json:
```json
{
    "body": "<a id='comment:8'></a>Sorry for this mess.\n\nFor this ticket I worked with the stable release. Then I downloaded the development release,\nmade a branch there, and tried to modify this ticket with\n`./sage -dev push --ticket 18356` but I got an error message\n\n```\nNot pushing your changes because they would discard some of the commits on the\nremote branch \"u/pernici/ticket/18356\".\n```\nand did not know how to proceed, so I opened #18373 .\nCan I delete this ticked and keep #18373 ?",
    "created_at": "2015-05-07T09:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319315",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:8'></a>Sorry for this mess.

For this ticket I worked with the stable release. Then I downloaded the development release,
made a branch there, and tried to modify this ticket with
`./sage -dev push --ticket 18356` but I got an error message

```
Not pushing your changes because they would discard some of the commits on the
remote branch "u/pernici/ticket/18356".
```
and did not know how to proceed, so I opened #18373 .
Can I delete this ticked and keep #18373 ?



---

archive/issue_comments_319316.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 pernici]:\n> For this ticket I worked with the stable release. Then I downloaded the development release,\n> made a branch there, and tried to modify this ticket with\n> `./sage -dev push --ticket 18356` but I got an error message\n> \n> ```\n> Not pushing your changes because they would discard some of the commits on the\n> remote branch \"u/pernici/ticket/18356\".\n> ```\n> and did not know how to proceed, so I opened #18373 .\n\n\nYou should have asked.\n\n> Can I delete this ticked and keep #18373 ?\n\n\nIf you want me to review it, no. There are comments here that are precious for the history. Moreover, if you do not know how to properly pull and push with git, choosing your solution will not help you.\n\nYou should first stop using the sage dev scripts which are deprecated since at least two version of sage. Then you can read the [manual](http://sagemath.org/doc/developer/) and start either using the `git trac` command or using `git` by itself. Everything is explained in details.\n\nVincent",
    "created_at": "2015-05-07T10:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319316",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 pernici]:
> For this ticket I worked with the stable release. Then I downloaded the development release,
> made a branch there, and tried to modify this ticket with
> `./sage -dev push --ticket 18356` but I got an error message
> 
> ```
> Not pushing your changes because they would discard some of the commits on the
> remote branch "u/pernici/ticket/18356".
> ```
> and did not know how to proceed, so I opened #18373 .


You should have asked.

> Can I delete this ticked and keep #18373 ?


If you want me to review it, no. There are comments here that are precious for the history. Moreover, if you do not know how to properly pull and push with git, choosing your solution will not help you.

You should first stop using the sage dev scripts which are deprecated since at least two version of sage. Then you can read the [manual](http://sagemath.org/doc/developer/) and start either using the `git trac` command or using `git` by itself. Everything is explained in details.

Vincent



---

archive/issue_comments_319317.json:
```json
{
    "body": "Changing commit from \"3806e8403764abf4d391161f836f0ec422201cc5\" to \"1898678cfccd18df76b57a015c03d96fb44542ae\"",
    "created_at": "2015-05-08T09:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3806e8403764abf4d391161f836f0ec422201cc5" to "1898678cfccd18df76b57a015c03d96fb44542ae"



---

archive/issue_comments_319318.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-08T09:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319319.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,26 @@\n-Added ``composed_sum`` and ``composed_product``, implementing\n+Added `composed_op` to compute the composed sum and the composed product, implementing\n the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,\n \"Fast Computation of special resultants\",\n Journal of Symbolic Computation 41 (2006), 1-29\n in the case of polynomials on integer or rational ring.\n-This algorithm is asymptotically faster than using the ``resultant``\n-method.\n+This algorithm is asymptotically faster than using the `resultant` method.\n+\n+For instance\n+\n+```\n+sage: p1 = minpoly(cos(pi/43))\n+sage: p2 = minpoly(cos(pi/47))\n+sage: time r1 = p1.composed_op(p2, '+')\n+Wall time: 105 ms\n+sage: time r2 = p1.composed_op(p2, '+', algorithm=\"resultant\")\n+Wall time: 53.4 s\n+sage: r1 == r2.monic()\n+sage: r1.is_irreducible()\n+True\n+```\n+\n+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-05-08T10:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319319",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,26 @@
-Added ``composed_sum`` and ``composed_product``, implementing
+Added `composed_op` to compute the composed sum and the composed product, implementing
 the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,
 "Fast Computation of special resultants",
 Journal of Symbolic Computation 41 (2006), 1-29
 in the case of polynomials on integer or rational ring.
-This algorithm is asymptotically faster than using the ``resultant``
-method.
+This algorithm is asymptotically faster than using the `resultant` method.
+
+For instance
+
+```
+sage: p1 = minpoly(cos(pi/43))
+sage: p2 = minpoly(cos(pi/47))
+sage: time r1 = p1.composed_op(p2, '+')
+Wall time: 105 ms
+sage: time r2 = p1.composed_op(p2, '+', algorithm="resultant")
+Wall time: 53.4 s
+sage: r1 == r2.monic()
+sage: r1.is_irreducible()
+True
+```
+
+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`
+
 
 Comment: 1
 
``````




---

archive/issue_comments_319320.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-08T10:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319320",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319321.json:
```json
{
    "body": "<a id='comment:13'></a>Hello,\n\nThanks for using this ticket.\n\n4. In the description of the function you wrote a very precise definition. But then, in the `NOTE`, you claim that the two algorithms might behave differently...\n\n5. Why do you only check the parent for `p1`?\n\n```\nif p1.parent().base_ring() not in (ZZ, QQ):\n    raise ValueError('implemented only for polynomials on\n                       integer or rational ring')\n```\n  Moreover, why is it only in the case of `BFSS`?\n\n6. What is this argument `_cached_QQ`!? You can certainly not use that. Note that in `sage.rings.qqbar` there is already `QQxy`, `QQxy_x` and `QQxy_y` defined. So either it is time critical in which case you could create a function like\n\n```\n_QQxy = None\ndef QQxy_with_gens():\n    global _QQxy\n    if _QQxy is None:\n        from sage.rings.rational_field import QQ\n        R = QQ['x', 'y']\n        _QQxy = (R, R.gen(0), R.gen(1))\n    return _QQxy\n```\n  and move it near the `PolynomialRing` function. Then this function should be also used in `sage.ring.qqbar`. You can also try to see why calling `PolynomialRing` is so slow.\n\n7. It would be more natural to me if `op` would be an operator and not a string. In other words, one of\n\n```\nsage: import operator\nsage: operator.add\n<built-in function add>\nsage: operator.sub\n<built-in function sub>\nsage: operator.mul\n<built-in function mul>\nsage: operator.div\n<built-in function div>\n```\n  It can be checked in the method with\n\n```\nif op is operator.add:\n    ...\nelif op is operator.sub:\n    ...\n```\n  It is a very personal feeling, what do you think?\n\n8. This takes time\n\n```\nfrom sage.rings.power_series_ring import PowerSeriesRing\nfrom sage.rings.big_oh import O as big_O\n```\n  so you would better move it where it is used, i.e. in the case where `algorithm=BFSS`. Similarly, in `newton_sum` you should move `from sage.rings.power_series_ring import PowerSeriesRing`\n\n9. You can use the fact that bool is a subtype of int when you decide the algorithm\n\n```\nsage: sum(bool(i) for i in [0,1,3,0,2,0,4])\n4\n```\n\n9. In `newton_sum` the argument `prec` and `R` are redundant. But I do not know how to do better.",
    "created_at": "2015-05-08T10:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319321",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Hello,

Thanks for using this ticket.

4. In the description of the function you wrote a very precise definition. But then, in the `NOTE`, you claim that the two algorithms might behave differently...

5. Why do you only check the parent for `p1`?

```
if p1.parent().base_ring() not in (ZZ, QQ):
    raise ValueError('implemented only for polynomials on
                       integer or rational ring')
```
  Moreover, why is it only in the case of `BFSS`?

6. What is this argument `_cached_QQ`!? You can certainly not use that. Note that in `sage.rings.qqbar` there is already `QQxy`, `QQxy_x` and `QQxy_y` defined. So either it is time critical in which case you could create a function like

```
_QQxy = None
def QQxy_with_gens():
    global _QQxy
    if _QQxy is None:
        from sage.rings.rational_field import QQ
        R = QQ['x', 'y']
        _QQxy = (R, R.gen(0), R.gen(1))
    return _QQxy
```
  and move it near the `PolynomialRing` function. Then this function should be also used in `sage.ring.qqbar`. You can also try to see why calling `PolynomialRing` is so slow.

7. It would be more natural to me if `op` would be an operator and not a string. In other words, one of

```
sage: import operator
sage: operator.add
<built-in function add>
sage: operator.sub
<built-in function sub>
sage: operator.mul
<built-in function mul>
sage: operator.div
<built-in function div>
```
  It can be checked in the method with

```
if op is operator.add:
    ...
elif op is operator.sub:
    ...
```
  It is a very personal feeling, what do you think?

8. This takes time

```
from sage.rings.power_series_ring import PowerSeriesRing
from sage.rings.big_oh import O as big_O
```
  so you would better move it where it is used, i.e. in the case where `algorithm=BFSS`. Similarly, in `newton_sum` you should move `from sage.rings.power_series_ring import PowerSeriesRing`

9. You can use the fact that bool is a subtype of int when you decide the algorithm

```
sage: sum(bool(i) for i in [0,1,3,0,2,0,4])
4
```

9. In `newton_sum` the argument `prec` and `R` are redundant. But I do not know how to do better.



---

archive/issue_comments_319322.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-08T10:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319322",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319323.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-12T15:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319324.json:
```json
{
    "body": "Changing commit from \"1898678cfccd18df76b57a015c03d96fb44542ae\" to \"5f888c83095eab89acbd96ee09e067918a60c258\"",
    "created_at": "2015-05-12T15:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319324",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1898678cfccd18df76b57a015c03d96fb44542ae" to "5f888c83095eab89acbd96ee09e067918a60c258"



---

archive/issue_comments_319325.json:
```json
{
    "body": "<a id='comment:15'></a>Hello,\n\nI made changes according to your comments:\n\n4. The description corresponds to the monic form; now by default\n   the result of `composed_op` is in monic form.\n\n5. Added the check that `p1` and `p2` are on the same polynomial ring.\n\n6. Put `QQxy_with_gens` in place of `cached_QQ`.\n\n7. Used `operator.add`, etc. \n\n8. Moved the import statements.\n\n9. Used `bool`.\n\n10. Eliminated the `prec` argument in `newton_sum`.\n\nOther changes:\n\n  previously `composed_op` returned a polynomial in `x` regardless\n  of the variable name of the input polynomials; fixing this gave\n  a speed-up of the \"resultant\" algorithm for small polynomials.\n\n  added some more checks on the input polynomials\n\n  eliminated the call to `integral` in the case of `operator.add`",
    "created_at": "2015-05-12T16:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319325",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:15'></a>Hello,

I made changes according to your comments:

4. The description corresponds to the monic form; now by default
   the result of `composed_op` is in monic form.

5. Added the check that `p1` and `p2` are on the same polynomial ring.

6. Put `QQxy_with_gens` in place of `cached_QQ`.

7. Used `operator.add`, etc. 

8. Moved the import statements.

9. Used `bool`.

10. Eliminated the `prec` argument in `newton_sum`.

Other changes:

  previously `composed_op` returned a polynomial in `x` regardless
  of the variable name of the input polynomials; fixing this gave
  a speed-up of the "resultant" algorithm for small polynomials.

  added some more checks on the input polynomials

  eliminated the call to `integral` in the case of `operator.add`



---

archive/issue_comments_319326.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,25 @@\n+Added `composed_op` to compute the composed sum and the composed product, implementing\n+the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,\n+\"Fast Computation of special resultants\",\n+Journal of Symbolic Computation 41 (2006), 1-29\n+in the case of polynomials on integer or rational ring.\n+This algorithm is asymptotically faster than using the `resultant` method.\n+\n+For instance\n+\n+```\n+sage: p1 = minpoly(cos(pi/43))\n+sage: p2 = minpoly(cos(pi/47))\n+sage: time r1 = p1.composed_op(p2, operator.add)\n+Wall time: 105 ms\n+sage: time r2 = p1.composed_op(p2, operator.add, algorithm=\"resultant\")\n+Wall time: 53.4 s\n+sage: r1 == r2\n+sage: r1.is_irreducible()\n+True\n+```\n+\n+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n \n \n Comment: 1\n``````\n",
    "created_at": "2015-05-12T16:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319326",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,25 @@
+Added `composed_op` to compute the composed sum and the composed product, implementing
+the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,
+"Fast Computation of special resultants",
+Journal of Symbolic Computation 41 (2006), 1-29
+in the case of polynomials on integer or rational ring.
+This algorithm is asymptotically faster than using the `resultant` method.
+
+For instance
+
+```
+sage: p1 = minpoly(cos(pi/43))
+sage: p2 = minpoly(cos(pi/47))
+sage: time r1 = p1.composed_op(p2, operator.add)
+Wall time: 105 ms
+sage: time r2 = p1.composed_op(p2, operator.add, algorithm="resultant")
+Wall time: 53.4 s
+sage: r1 == r2
+sage: r1.is_irreducible()
+True
+```
+
+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`
 
 
 Comment: 1
``````




---

archive/issue_comments_319327.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,25 @@\n+Added `composed_op` to compute the composed sum and the composed product, implementing\n+the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,\n+\"Fast Computation of special resultants\",\n+Journal of Symbolic Computation 41 (2006), 1-29\n+in the case of polynomials on the rational ring.\n+This algorithm is asymptotically faster than using the `resultant` method.\n+\n+For instance\n+\n+```\n+sage: p1 = minpoly(cos(pi/43))\n+sage: p2 = minpoly(cos(pi/47))\n+sage: time r1 = p1.composed_op(p2, operator.add)\n+Wall time: 105 ms\n+sage: time r2 = p1.composed_op(p2, operator.add, algorithm=\"resultant\")\n+Wall time: 53.4 s\n+sage: r1 == r2\n+sage: r1.is_irreducible()\n+True\n+```\n+\n+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n \n \n Comment: 1\n``````\n",
    "created_at": "2015-05-12T16:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319327",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,25 @@
+Added `composed_op` to compute the composed sum and the composed product, implementing
+the algorithm in A. Bostan, P. Flajolet, B. Salvy and E. Schost,
+"Fast Computation of special resultants",
+Journal of Symbolic Computation 41 (2006), 1-29
+in the case of polynomials on the rational ring.
+This algorithm is asymptotically faster than using the `resultant` method.
+
+For instance
+
+```
+sage: p1 = minpoly(cos(pi/43))
+sage: p2 = minpoly(cos(pi/47))
+sage: time r1 = p1.composed_op(p2, operator.add)
+Wall time: 105 ms
+sage: time r2 = p1.composed_op(p2, operator.add, algorithm="resultant")
+Wall time: 53.4 s
+sage: r1 == r2
+sage: r1.is_irreducible()
+True
+```
+
+so `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`
 
 
 Comment: 1
``````




---

archive/issue_comments_319328.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-12T16:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319328",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319329.json:
```json
{
    "body": "<a id='comment:18'></a>The algorithm for `newton_sum` is not the one from BFSS. It is the Schoenage formula. Isn't it? There is no inversion in BFSS.\n\nVincent",
    "created_at": "2015-05-14T13:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319329",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>The algorithm for `newton_sum` is not the one from BFSS. It is the Schoenage formula. Isn't it? There is no inversion in BFSS.

Vincent



---

archive/issue_comments_319330.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-05-14T13:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319330",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_319331.json:
```json
{
    "body": "<a id='comment:19'></a>The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.\nI will change it to the latter form, which is simpler and slightly faster.\nIn either case there is no inversion, there is reversion though.\n\nLemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to\nSchoenage's paper, or is it sufficient to write \"See [BFSS] and references within.\" ?",
    "created_at": "2015-05-14T18:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319331",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:19'></a>The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.
I will change it to the latter form, which is simpler and slightly faster.
In either case there is no inversion, there is reversion though.

Lemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to
Schoenage's paper, or is it sufficient to write "See [BFSS] and references within." ?



---

archive/issue_comments_319332.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 pernici]:\n> The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.\n> I will change it to the latter form, which is simpler and slightly faster.\n> In either case there is no inversion, there is reversion though.\n\n\nAs far as I understand Lemma 1 is precisely Schoenage formula (but I did not open the relevant paper). The algorithm of BFSS is Proposition 1. The inversion is only computed up to the degree of the polynomial. Then there are some iterations that depends on `prec`. Am I wrong?\n\n> Lemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to\n> Schoenage's paper, or is it sufficient to write \"See [BFSS] and references within.\" ?\n\n\nI think it would make sense.\n\nAbout the name, what do you think about `newton_series` instead? It would make the result clearer. And please, add the mathematical definition in the function.\n\nVincent",
    "created_at": "2015-05-14T18:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319332",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Replying to [comment:19 pernici]:
> The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.
> I will change it to the latter form, which is simpler and slightly faster.
> In either case there is no inversion, there is reversion though.


As far as I understand Lemma 1 is precisely Schoenage formula (but I did not open the relevant paper). The algorithm of BFSS is Proposition 1. The inversion is only computed up to the degree of the polynomial. Then there are some iterations that depends on `prec`. Am I wrong?

> Lemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to
> Schoenage's paper, or is it sufficient to write "See [BFSS] and references within." ?


I think it would make sense.

About the name, what do you think about `newton_series` instead? It would make the result clearer. And please, add the mathematical definition in the function.

Vincent



---

archive/issue_comments_319333.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:\n> Replying to [comment:19 pernici]:\n> > The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.\n> > I will change it to the latter form, which is simpler and slightly faster.\n> > In either case there is no inversion, there is reversion though.\n\n> As far as I understand Lemma 1 is precisely Schoenage formula (but I did not open the relevant paper). The algorithm of BFSS is Proposition 1. The inversion is only computed up to the degree of the polynomial. Then there are some iterations that depends on `prec`. Am I wrong?\n\nYou are right. I used that formula, not the algorithm following it.\n\n> > Lemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to\n> > Schoenage's paper, or is it sufficient to write \"See [BFSS] and references within.\" ?\n\n> \n> I think it would make sense.\n> \n> About the name, what do you think about `newton_series` instead? It would make the result clearer. And please, add the mathematical definition in the function.\n\n \nA problem with calling it `newton_series` is that `newton_sum` returns a polynomial, not a series.",
    "created_at": "2015-05-14T19:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319333",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:
> Replying to [comment:19 pernici]:
> > The algorithm for `newton_sum` is slightly changed with respect to the one written in BFSS, Lemma 1.
> > I will change it to the latter form, which is simpler and slightly faster.
> > In either case there is no inversion, there is reversion though.

> As far as I understand Lemma 1 is precisely Schoenage formula (but I did not open the relevant paper). The algorithm of BFSS is Proposition 1. The inversion is only computed up to the degree of the polynomial. Then there are some iterations that depends on `prec`. Am I wrong?

You are right. I used that formula, not the algorithm following it.

> > Lemma 1 comes from Schoenage, who used it in a numerical context. Should I put the reference to
> > Schoenage's paper, or is it sufficient to write "See [BFSS] and references within." ?

> 
> I think it would make sense.
> 
> About the name, what do you think about `newton_series` instead? It would make the result clearer. And please, add the mathematical definition in the function.

 
A problem with calling it `newton_series` is that `newton_sum` returns a polynomial, not a series.



---

archive/issue_comments_319334.json:
```json
{
    "body": "Changing commit from \"5f888c83095eab89acbd96ee09e067918a60c258\" to \"1fe9b052c8f1e49f9b0480f40dfa1937ef9f8dcf\"",
    "created_at": "2015-05-15T09:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5f888c83095eab89acbd96ee09e067918a60c258" to "1fe9b052c8f1e49f9b0480f40dfa1937ef9f8dcf"



---

archive/issue_comments_319335.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-15T09:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319336.json:
```json
{
    "body": "<a id='comment:23'></a>I eliminated `newton_sum`, since it can be inlined, and it is not yet clear to me which arguments\n`newton_sum` should have (`prec` or `R`), nor what it should return (a polynomial or a series).\n\nImplementing `composed_op` using `flint` would be faster. For instance in sage it is not\nimplemented `mullow`, present in `flint` `nmod_poly`, so that one has to compute the product of the\npolynomials and then truncate.",
    "created_at": "2015-05-15T09:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319336",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:23'></a>I eliminated `newton_sum`, since it can be inlined, and it is not yet clear to me which arguments
`newton_sum` should have (`prec` or `R`), nor what it should return (a polynomial or a series).

Implementing `composed_op` using `flint` would be faster. For instance in sage it is not
implemented `mullow`, present in `flint` `nmod_poly`, so that one has to compute the product of the
polynomials and then truncate.



---

archive/issue_comments_319337.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 pernici]:\n> I eliminated `newton_sum`, since it can be inlined, and it is not yet clear to me which arguments\n> `newton_sum` should have (`prec` or `R`), nor what it should return (a polynomial or a series).\n\n\nindeed\n\n> Implementing `composed_op` using `flint` would be faster. For instance in sage it is not\n> implemented `mullow`, present in `flint` `nmod_poly`, so that one has to compute the product of the\n> polynomials and then truncate.\n\n\nsee #18420 (needs review)",
    "created_at": "2015-05-15T09:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319337",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>Replying to [comment:23 pernici]:
> I eliminated `newton_sum`, since it can be inlined, and it is not yet clear to me which arguments
> `newton_sum` should have (`prec` or `R`), nor what it should return (a polynomial or a series).


indeed

> Implementing `composed_op` using `flint` would be faster. For instance in sage it is not
> implemented `mullow`, present in `flint` `nmod_poly`, so that one has to compute the product of the
> polynomials and then truncate.


see #18420 (needs review)



---

archive/issue_comments_319338.json:
```json
{
    "body": "<a id='comment:25'></a>I will try to implement `composed_op` in `polynomial_rational_flint.pyx`; for the moment I have an\nimplementation of `composed_mul`; for small polynomials (degree 2) it is a few times faster than the resultant algorithm, 20x faster than the previous implementation of the BFSS algorithm. \n\nTherefore the resultant algorithm will be taken away. \n\nFor large polynomials the implementation in `polynomial_rational_flint.pyx`\nis currently slow; the reason is that there is no `hadamard_product` for polynomials in Flint,\nand my implementation is very slow. I have to study something of Flint to do better.\nOnce I fix this I expect that the two implementations of BFSS will be equally fast for large polynomials.",
    "created_at": "2015-05-18T12:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319338",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:25'></a>I will try to implement `composed_op` in `polynomial_rational_flint.pyx`; for the moment I have an
implementation of `composed_mul`; for small polynomials (degree 2) it is a few times faster than the resultant algorithm, 20x faster than the previous implementation of the BFSS algorithm. 

Therefore the resultant algorithm will be taken away. 

For large polynomials the implementation in `polynomial_rational_flint.pyx`
is currently slow; the reason is that there is no `hadamard_product` for polynomials in Flint,
and my implementation is very slow. I have to study something of Flint to do better.
Once I fix this I expect that the two implementations of BFSS will be equally fast for large polynomials.



---

archive/issue_comments_319339.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 pernici]:\n> I will try to implement `composed_op` in `polynomial_rational_flint.pyx`; for the moment I have an\n> implementation of `composed_mul`; for small polynomials (degree 2) it is a few times faster than the resultant algorithm, 20x faster than the previous implementation of the BFSS algorithm. \n\n\nDid you have a look at #18420 that I already mentioned in [comment:23 comment:23]?! There is no need to implement your methods in `polynomial_rational_flint.pyx`. Just use `_mul_trunc_` that is implemented in #18420.\n\nVincent",
    "created_at": "2015-05-18T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319339",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>Replying to [comment:25 pernici]:
> I will try to implement `composed_op` in `polynomial_rational_flint.pyx`; for the moment I have an
> implementation of `composed_mul`; for small polynomials (degree 2) it is a few times faster than the resultant algorithm, 20x faster than the previous implementation of the BFSS algorithm. 


Did you have a look at #18420 that I already mentioned in [comment:23 comment:23]?! There is no need to implement your methods in `polynomial_rational_flint.pyx`. Just use `_mul_trunc_` that is implemented in #18420.

Vincent



---

archive/issue_comments_319340.json:
```json
{
    "body": "<a id='comment:27'></a>I tried some benchmark with some small polynomials in #18420; \nI find that `p1._mul_trunc_(p2, prec)`\nis slightly faster than `(p1*p2).truncate(prec)`, with polynomials of degree `prec-1`.\n\nI will look further at #18420, but it is not the way to speed up `composed_op`,\nas the following benchmark shows.\n\n```\ndef test2():\n    K.<x> = QQ[]\n    p1 = x^2 - 2\n    p2 = x^2 - 3\n    t0 = time()\n    r = p1.composed_op(p2, operator.mul, algorithm='BFSS')\n    #r = p1.composed_mul(p2)\n    t1 = time()\n    print 'r=', r\n    print '%.6f' %(t1 - t0)\n```\n\nHere are the results for the best out of 10 runs:\n\ncomposed_op 'BFSS':\nup to PowerSeriesRing(...) included: 0.000524 \nnewton_sums: 0.001369 \nhadamard prod: 0.000030 \nintegral: 0.000073 \nexp: 0.001195 \nreverse: 0.000002\ntotal: 0.003264\n\nOnly the newton sums could use `_mul_trunc_`, although it is not clear to me how\nto do it best; anyway it would make it only slightly faster. But even if the newton sums\ntook zero time, this algorithm would be slower than the resultant algorithm and much\nslower than `composed_mul`\n\n`composed_op` 'resultant': 0.000584\n\n`composed_mul`: 0.000026",
    "created_at": "2015-05-18T16:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319340",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:27'></a>I tried some benchmark with some small polynomials in #18420; 
I find that `p1._mul_trunc_(p2, prec)`
is slightly faster than `(p1*p2).truncate(prec)`, with polynomials of degree `prec-1`.

I will look further at #18420, but it is not the way to speed up `composed_op`,
as the following benchmark shows.

```
def test2():
    K.<x> = QQ[]
    p1 = x^2 - 2
    p2 = x^2 - 3
    t0 = time()
    r = p1.composed_op(p2, operator.mul, algorithm='BFSS')
    #r = p1.composed_mul(p2)
    t1 = time()
    print 'r=', r
    print '%.6f' %(t1 - t0)
```

Here are the results for the best out of 10 runs:

composed_op 'BFSS':
up to PowerSeriesRing(...) included: 0.000524 
newton_sums: 0.001369 
hadamard prod: 0.000030 
integral: 0.000073 
exp: 0.001195 
reverse: 0.000002
total: 0.003264

Only the newton sums could use `_mul_trunc_`, although it is not clear to me how
to do it best; anyway it would make it only slightly faster. But even if the newton sums
took zero time, this algorithm would be slower than the resultant algorithm and much
slower than `composed_mul`

`composed_op` 'resultant': 0.000584

`composed_mul`: 0.000026



---

archive/issue_comments_319341.json:
```json
{
    "body": "<a id='comment:28'></a>Hi,\n\nDid you completely avoid the power series ring? We should provide more methods to polynomial like:\n- `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial\nAs FLINT has some native implementation, we should use it where it makes sense. But this should be done in another ticket.\n\nIn all your code, you know in advance the precision needed. Right?\n\nVincent",
    "created_at": "2015-05-18T19:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319341",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Hi,

Did you completely avoid the power series ring? We should provide more methods to polynomial like:
- `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial
As FLINT has some native implementation, we should use it where it makes sense. But this should be done in another ticket.

In all your code, you know in advance the precision needed. Right?

Vincent



---

archive/issue_comments_319342.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 vdelecroix]:\n> Hi,\n> \n> Did you completely avoid the power series ring? We should provide more methods to polynomial like:\n> - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial\n\n\nYes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.\n\n> As FLINT has some native implementation, we should use it where it makes sense. But this should be done in another ticket.\n> \n> In all your code, you know in advance the precision needed. Right?\n> \n\n\nYes.",
    "created_at": "2015-05-18T21:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319342",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:29'></a>Replying to [comment:28 vdelecroix]:
> Hi,
> 
> Did you completely avoid the power series ring? We should provide more methods to polynomial like:
> - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial


Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.

> As FLINT has some native implementation, we should use it where it makes sense. But this should be done in another ticket.
> 
> In all your code, you know in advance the precision needed. Right?
> 


Yes.



---

archive/issue_comments_319343.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 pernici]:\n> Replying to [comment:28 vdelecroix]:\n> > Hi,\n> > \n> > Did you completely avoid the power series ring? We should provide more methods to polynomial like:\n> > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial\n\n> \n> Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.\n\n\nI think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.",
    "created_at": "2015-05-19T06:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319343",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>Replying to [comment:29 pernici]:
> Replying to [comment:28 vdelecroix]:
> > Hi,
> > 
> > Did you completely avoid the power series ring? We should provide more methods to polynomial like:
> > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial

> 
> Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.


I think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.



---

archive/issue_comments_319344.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 vdelecroix]:\n> Replying to [comment:29 pernici]:\n> > Replying to [comment:28 vdelecroix]:\n> > > Hi,\n> > > \n> > > Did you completely avoid the power series ring? We should provide more methods to polynomial like:\n> > > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial\n\n> > \n> > Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.\n\n> \n> I think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.\n\n\nI have rewritten `composed_op` using `inverse_series`, `exp_series`, methods in `polynomial_element.pyx`\n(without default implementation yet), using `_mul_trunc_` in #18420 as a template.\nIt is faster than the \"resultant\" algorithm in all the cases tested.\n\nI think that `inverse_series`, `exp_series`, etc. in `polynomial_element.pyx`\nshould always return a polynomial.\n\nI could open a ticket on implementing these methods, depending on #18420.\nDo you think that it is ok?",
    "created_at": "2015-05-19T11:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319344",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:31'></a>Replying to [comment:30 vdelecroix]:
> Replying to [comment:29 pernici]:
> > Replying to [comment:28 vdelecroix]:
> > > Hi,
> > > 
> > > Did you completely avoid the power series ring? We should provide more methods to polynomial like:
> > > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial

> > 
> > Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.

> 
> I think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.


I have rewritten `composed_op` using `inverse_series`, `exp_series`, methods in `polynomial_element.pyx`
(without default implementation yet), using `_mul_trunc_` in #18420 as a template.
It is faster than the "resultant" algorithm in all the cases tested.

I think that `inverse_series`, `exp_series`, etc. in `polynomial_element.pyx`
should always return a polynomial.

I could open a ticket on implementing these methods, depending on #18420.
Do you think that it is ok?



---

archive/issue_comments_319345.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 pernici]:\n> Replying to [comment:30 vdelecroix]:\n> > Replying to [comment:29 pernici]:\n> > > Replying to [comment:28 vdelecroix]:\n> > > > Hi,\n> > > > \n> > > > Did you completely avoid the power series ring? We should provide more methods to polynomial like:\n> > > > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial\n\n> > > \n> > > Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.\n\n> > \n> > I think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.\n\n> \n> I have rewritten `composed_op` using `inverse_series`, `exp_series`, methods in `polynomial_element.pyx`\n> (without default implementation yet), using `_mul_trunc_` in #18420 as a template.\n> It is faster than the \"resultant\" algorithm in all the cases tested.\n> \n> I think that `inverse_series`, `exp_series`, etc. in `polynomial_element.pyx`\n> should always return a polynomial.\n\n\nFor a programmer this is clear. But not a user. If you ask `inverse_series` you expect a series... but I do not have a strong opinion. A possible alternative is to write:\n\n- one global `def inverse_series(self, prec, as_polynomial=False)` in `polynomial_element.pyx`\n  that would use\n- several `cpdef Polynomial _inverse_series(self, long prec)` that return polynomials.\n\n> I could open a ticket on implementing these methods, depending on #18420.\n> Do you think that it is ok?\n\n\nI think it would be good. Power series are by far too slow to be usable. Please put me in cc.\n\nVincent",
    "created_at": "2015-05-19T13:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319345",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>Replying to [comment:31 pernici]:
> Replying to [comment:30 vdelecroix]:
> > Replying to [comment:29 pernici]:
> > > Replying to [comment:28 vdelecroix]:
> > > > Hi,
> > > > 
> > > > Did you completely avoid the power series ring? We should provide more methods to polynomial like:
> > > > - `inverse_series(self, prec, as_polynomial=False)`: return the inverse series and if `as_polynomial` is true returns it as a polynomial

> > > 
> > > Yes, I used `fmpq_poly_inv_series`, `fmpq_poly_exp_series`, so the power series ring is not used.

> > 
> > I think this is bad. This will make your code specific over Q. You might consider implementing (in an other ticket) an `inverse_series` and an `exp_series` method on polynoms that handle the option of returning a polynom. This method would have a default implementation in `polynomial_element.pyx` and specialized one for the FLINT classes.

> 
> I have rewritten `composed_op` using `inverse_series`, `exp_series`, methods in `polynomial_element.pyx`
> (without default implementation yet), using `_mul_trunc_` in #18420 as a template.
> It is faster than the "resultant" algorithm in all the cases tested.
> 
> I think that `inverse_series`, `exp_series`, etc. in `polynomial_element.pyx`
> should always return a polynomial.


For a programmer this is clear. But not a user. If you ask `inverse_series` you expect a series... but I do not have a strong opinion. A possible alternative is to write:

- one global `def inverse_series(self, prec, as_polynomial=False)` in `polynomial_element.pyx`
  that would use
- several `cpdef Polynomial _inverse_series(self, long prec)` that return polynomials.

> I could open a ticket on implementing these methods, depending on #18420.
> Do you think that it is ok?


I think it would be good. Power series are by far too slow to be usable. Please put me in cc.

Vincent



---

archive/issue_comments_319346.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-23T10:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319346",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319347.json:
```json
{
    "body": "Changing commit from \"1fe9b052c8f1e49f9b0480f40dfa1937ef9f8dcf\" to \"dcb3748ffdc3748b6968cf91c188f8ab266ab626\"",
    "created_at": "2015-05-23T10:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1fe9b052c8f1e49f9b0480f40dfa1937ef9f8dcf" to "dcb3748ffdc3748b6968cf91c188f8ab266ab626"



---

archive/issue_comments_319348.json:
```json
{
    "body": "<a id='comment:34'></a>Eliminated `QQxy_with_gens`, used to optimize the \"resultant\" algorithm, since the latter will\nnot be used anyway after introducing `inverse_series`, `exp_series` in the \"BFSS\" algorithm.",
    "created_at": "2015-05-23T10:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319348",
    "user": "https://trac.sagemath.org/admin/accounts/users/pernici"
}
```

<a id='comment:34'></a>Eliminated `QQxy_with_gens`, used to optimize the "resultant" algorithm, since the latter will
not be used anyway after introducing `inverse_series`, `exp_series` in the "BFSS" algorithm.



---

archive/issue_comments_319349.json:
```json
{
    "body": "<a id='comment:35'></a>See #19005 and #19006 for respectively `inverse_series` and `exp_series`.",
    "created_at": "2015-08-09T17:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319349",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>See #19005 and #19006 for respectively `inverse_series` and `exp_series`.



---

archive/issue_events_051779.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-18T19:13:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18356#event-51779"
}
```



---

archive/issue_comments_319350.json:
```json
{
    "body": "<a id='comment:36'></a>New commits:",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319350",
    "user": "https://github.com/videlec"
}
```

<a id='comment:36'></a>New commits:



---

archive/issue_comments_319351.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division. Two implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. Currently, only polynomial with coefficient in `QQ` are supported. This algorithm is asymptotically faster than using the `resultant` method.\n \n+For instance\n+\n+```\n+sage: p1 = minpoly(cos(pi/43))\n+sage: p2 = minpoly(cos(pi/47))\n+sage: time r1 = p1.composed_op(p2, operator.add)\n+CPU times: user 108 ms, sys: 4 ms, total: 112 ms\n+Wall time: 111 ms\n+sage: time r2 = p1.composed_op(p2, operator.add, algorithm=\"resultant\")\n+CPU times: user 47.1 s, sys: 0 ns, total: 47.1 s\n+Wall time: 47.1 s\n+sage: r1 == r2\n+True\n+sage: r1.is_irreducible()\n+True\n+```\n+In the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n+\n+Reference:\n+\n+ [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, \"Fast Computation of special resultants\", Journal of Symbolic Computation 41 (2006), 1-29\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319351",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,26 @@
+Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division. Two implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. Currently, only polynomial with coefficient in `QQ` are supported. This algorithm is asymptotically faster than using the `resultant` method.
 
+For instance
+
+```
+sage: p1 = minpoly(cos(pi/43))
+sage: p2 = minpoly(cos(pi/47))
+sage: time r1 = p1.composed_op(p2, operator.add)
+CPU times: user 108 ms, sys: 4 ms, total: 112 ms
+Wall time: 111 ms
+sage: time r2 = p1.composed_op(p2, operator.add, algorithm="resultant")
+CPU times: user 47.1 s, sys: 0 ns, total: 47.1 s
+Wall time: 47.1 s
+sage: r1 == r2
+True
+sage: r1.is_irreducible()
+True
+```
+In the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`
+
+Reference:
+
+ [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, "Fast Computation of special resultants", Journal of Symbolic Computation 41 (2006), 1-29
 
 Comment: 1
 
``````




---

archive/issue_comments_319352.json:
```json
{
    "body": "Changing commit from \"dcb3748ffdc3748b6968cf91c188f8ab266ab626\" to \"885eb5d695818eeeed34362e37e5271960896c8b\"",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319352",
    "user": "https://github.com/videlec"
}
```

Changing commit from "dcb3748ffdc3748b6968cf91c188f8ab266ab626" to "885eb5d695818eeeed34362e37e5271960896c8b"



---

archive/issue_comments_319353.json:
```json
{
    "body": "Changing author from \"\" to \"Marco Pernici, Vincent Delecroix\"",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319353",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Marco Pernici, Vincent Delecroix"



---

archive/issue_comments_319354.json:
```json
{
    "body": "Changing branch from \"u/pernici/ticket/18356\" to \"u/vdelecroix/18356\"",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319354",
    "user": "https://github.com/videlec"
}
```

Changing branch from "u/pernici/ticket/18356" to "u/vdelecroix/18356"



---

archive/issue_comments_319355.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-01-18T19:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319355",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_319356.json:
```json
{
    "body": "<a id='comment:37'></a>I cherry picked the commit of the old branch and added to commits on top of it:\n- `de9f047`: documentation improvements\n- `\u200b885eb5d`: avoid `PowerSeriesRing` (using #19005 and #19006) and some more cdef declarations",
    "created_at": "2016-01-18T19:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319356",
    "user": "https://github.com/videlec"
}
```

<a id='comment:37'></a>I cherry picked the commit of the old branch and added to commits on top of it:
- `de9f047`: documentation improvements
- `885eb5d`: avoid `PowerSeriesRing` (using #19005 and #19006) and some more cdef declarations



---

archive/issue_comments_319357.json:
```json
{
    "body": "Utils for benchmarks between BFSS and resultant",
    "created_at": "2016-01-18T20:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319357",
    "user": "https://github.com/videlec"
}
```

Utils for benchmarks between BFSS and resultant



---

archive/issue_comments_319358.json:
```json
{
    "body": "<a id='comment:38'></a>Attachment [composed_op_benchmark.py](tarball://root/attachments/some-uuid/ticket18356/composed_op_benchmark.py) by @videlec created at 2016-01-18 20:25:23\n\nSome benchmarks (see [attachment:composed_op_benchmark.py]) that shows that the threshold between the algorithms should depend on the operator\n\n```\np1 = x^3 - x^2 - x - 1\np2 = x^3 + x^2 + x + 1\noperation     BFSS      resultant  better\noperator.add  0.199ms   0.188ms    resultant x1.06\noperator.sub  0.129ms   0.184ms    BFSS x1.43\noperator.mul  0.102ms   0.187ms    BFSS x1.82\noperator.div  0.106ms   0.177ms    BFSS x1.67\n\np1 = x^4 - x^2 - 1\np2 = x^4 - x^2 - 3\noperation     BFSS      resultant  better\noperator.add  0.254ms   0.174ms    resultant x1.46\noperator.sub  0.194ms   0.176ms    resultant x1.11\noperator.mul  0.127ms   0.167ms    BFSS x1.32\noperator.div  0.145ms   0.170ms    BFSS x1.17\n\np1 = x^8 - x - 1\np2 = x^8 - x^2 - 3\noperation     BFSS      resultant  better\noperator.add  0.992ms   2.647ms    BFSS x2.67\noperator.sub  0.908ms   2.632ms    BFSS x2.90\noperator.mul  0.350ms   0.271ms    resultant x1.29\noperator.div  0.408ms   0.214ms    resultant x1.91\n\np1 = x^8 - 3*x - 1\np2 = x^2 - 3\noperation     BFSS      resultant  better\noperator.add  0.274ms   0.177ms    resultant x1.55\noperator.sub  0.186ms   0.185ms    resultant x1.01\noperator.mul  0.106ms   0.170ms    BFSS x1.61\noperator.div  0.125ms   0.168ms    BFSS x1.35\n```",
    "created_at": "2016-01-18T20:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319358",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>Attachment [composed_op_benchmark.py](tarball://root/attachments/some-uuid/ticket18356/composed_op_benchmark.py) by @videlec created at 2016-01-18 20:25:23

Some benchmarks (see [attachment:composed_op_benchmark.py]) that shows that the threshold between the algorithms should depend on the operator

```
p1 = x^3 - x^2 - x - 1
p2 = x^3 + x^2 + x + 1
operation     BFSS      resultant  better
operator.add  0.199ms   0.188ms    resultant x1.06
operator.sub  0.129ms   0.184ms    BFSS x1.43
operator.mul  0.102ms   0.187ms    BFSS x1.82
operator.div  0.106ms   0.177ms    BFSS x1.67

p1 = x^4 - x^2 - 1
p2 = x^4 - x^2 - 3
operation     BFSS      resultant  better
operator.add  0.254ms   0.174ms    resultant x1.46
operator.sub  0.194ms   0.176ms    resultant x1.11
operator.mul  0.127ms   0.167ms    BFSS x1.32
operator.div  0.145ms   0.170ms    BFSS x1.17

p1 = x^8 - x - 1
p2 = x^8 - x^2 - 3
operation     BFSS      resultant  better
operator.add  0.992ms   2.647ms    BFSS x2.67
operator.sub  0.908ms   2.632ms    BFSS x2.90
operator.mul  0.350ms   0.271ms    resultant x1.29
operator.div  0.408ms   0.214ms    resultant x1.91

p1 = x^8 - 3*x - 1
p2 = x^2 - 3
operation     BFSS      resultant  better
operator.add  0.274ms   0.177ms    resultant x1.55
operator.sub  0.186ms   0.185ms    resultant x1.01
operator.mul  0.106ms   0.170ms    BFSS x1.61
operator.div  0.125ms   0.168ms    BFSS x1.35
```



---

archive/issue_comments_319359.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-19T12:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319360.json:
```json
{
    "body": "Changing commit from \"885eb5d695818eeeed34362e37e5271960896c8b\" to \"1ec84bb78d9e3a5a1e1c966d78e1797ec70afac0\"",
    "created_at": "2016-01-19T12:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "885eb5d695818eeeed34362e37e5271960896c8b" to "1ec84bb78d9e3a5a1e1c966d78e1797ec70afac0"



---

archive/issue_comments_319361.json:
```json
{
    "body": "Changing commit from \"1ec84bb78d9e3a5a1e1c966d78e1797ec70afac0\" to \"bfb6379a8ab8b59d37cb99204f40322b911fab90\"",
    "created_at": "2016-01-25T04:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1ec84bb78d9e3a5a1e1c966d78e1797ec70afac0" to "bfb6379a8ab8b59d37cb99204f40322b911fab90"



---

archive/issue_comments_319362.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-25T04:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319363.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division of two polynomias. That is the polynomial whose roots are the sum (resp. difference, product, division) of the roots of the two polynomials.\n \n+Two implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. For the latter algorithm, only polynomial with coefficient in `ZZ` or `QQ` are supported. However, this algorithm is asymptotically faster than using the `resultant` method.\n+\n+For instance\n+\n+```\n+sage: p1 = minpoly(cos(pi/43))\n+sage: p2 = minpoly(cos(pi/47))\n+sage: time r1 = p1.composed_op(p2, operator.add)\n+CPU times: user 108 ms, sys: 4 ms, total: 112 ms\n+Wall time: 111 ms\n+sage: time r2 = p1.composed_op(p2, operator.add, algorithm=\"resultant\")\n+CPU times: user 47.1 s, sys: 0 ns, total: 47.1 s\n+Wall time: 47.1 s\n+sage: r1 == r2\n+True\n+sage: r1.is_irreducible()\n+True\n+```\n+In the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`\n+\n+Reference:\n+\n+ [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, \"Fast Computation of special resultants\", Journal of Symbolic Computation 41 (2006), 1-29\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-01-25T04:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319363",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,28 @@
+Add a new operation `composed_op` on polynomials to compute the composed sum, difference, product and division of two polynomias. That is the polynomial whose roots are the sum (resp. difference, product, division) of the roots of the two polynomials.
 
+Two implementations are proposed. The straightforward one using resultants and the algorithm from [BFSS]. For the latter algorithm, only polynomial with coefficient in `ZZ` or `QQ` are supported. However, this algorithm is asymptotically faster than using the `resultant` method.
+
+For instance
+
+```
+sage: p1 = minpoly(cos(pi/43))
+sage: p2 = minpoly(cos(pi/47))
+sage: time r1 = p1.composed_op(p2, operator.add)
+CPU times: user 108 ms, sys: 4 ms, total: 112 ms
+Wall time: 111 ms
+sage: time r2 = p1.composed_op(p2, operator.add, algorithm="resultant")
+CPU times: user 47.1 s, sys: 0 ns, total: 47.1 s
+Wall time: 47.1 s
+sage: r1 == r2
+True
+sage: r1.is_irreducible()
+True
+```
+In the example above, `r1` is the minimal polynomial of `cos(pi/43) + cos(pi/47)`
+
+Reference:
+
+ [BFSS] A. Bostan, P. Flajolet, B. Salvy and E. Schost, "Fast Computation of special resultants", Journal of Symbolic Computation 41 (2006), 1-29
 
 Comment: 1
 
``````




---

archive/issue_events_051780.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-05-18T13:03:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18356#event-51780"
}
```



---

archive/issue_events_051781.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-05-18T13:03:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18356#event-51781"
}
```



---

archive/issue_comments_319364.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/18356\" to \"public/ticket/18356-composed-op\"",
    "created_at": "2016-05-18T13:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319364",
    "user": "https://github.com/mezzarobba"
}
```

Changing branch from "u/vdelecroix/18356" to "public/ticket/18356-composed-op"



---

archive/issue_comments_319365.json:
```json
{
    "body": "Changing commit from \"bfb6379a8ab8b59d37cb99204f40322b911fab90\" to \"a4d2df69e9dae4715093d18c991f0427b7f16bf9\"",
    "created_at": "2016-05-18T13:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319365",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "bfb6379a8ab8b59d37cb99204f40322b911fab90" to "a4d2df69e9dae4715093d18c991f0427b7f16bf9"



---

archive/issue_comments_319366.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix, Marc Mezzarobba\"",
    "created_at": "2016-05-18T13:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319366",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "" to "Vincent Delecroix, Marc Mezzarobba"



---

archive/issue_comments_319367.json:
```json
{
    "body": "<a id='comment:42'></a>I think that the code is good to go except for a few details which I tried to fix. Please set the ticket to positive_review if you are okay with my changes.\n\n---\nNew commits:",
    "created_at": "2016-05-18T13:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319367",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:42'></a>I think that the code is good to go except for a few details which I tried to fix. Please set the ticket to positive_review if you are okay with my changes.

---
New commits:



---

archive/issue_comments_319368.json:
```json
{
    "body": "Changing commit from \"a4d2df69e9dae4715093d18c991f0427b7f16bf9\" to \"c6b1c35de85957fc501d6f34b4de6b8def0a8ea0\"",
    "created_at": "2016-05-18T13:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a4d2df69e9dae4715093d18c991f0427b7f16bf9" to "c6b1c35de85957fc501d6f34b4de6b8def0a8ea0"



---

archive/issue_comments_319369.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-18T13:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_319370.json:
```json
{
    "body": "<a id='comment:44'></a>Cool! Thank you!",
    "created_at": "2016-05-18T13:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319370",
    "user": "https://github.com/videlec"
}
```

<a id='comment:44'></a>Cool! Thank you!



---

archive/issue_comments_319371.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-18T13:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319371",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_319372.json:
```json
{
    "body": "Changing branch from \"public/ticket/18356-composed-op\" to \"c6b1c35de85957fc501d6f34b4de6b8def0a8ea0\"",
    "created_at": "2016-05-19T22:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319372",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/18356-composed-op" to "c6b1c35de85957fc501d6f34b4de6b8def0a8ea0"



---

archive/issue_events_051782.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-19T22:39:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18356#event-51782"
}
```



---

archive/issue_comments_319373.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-19T22:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319373",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_319374.json:
```json
{
    "body": "Changing commit from \"c6b1c35de85957fc501d6f34b4de6b8def0a8ea0\" to \"\"",
    "created_at": "2016-07-14T07:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319374",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "c6b1c35de85957fc501d6f34b4de6b8def0a8ea0" to ""



---

archive/issue_comments_319375.json:
```json
{
    "body": "Changing author from \"Marco Pernici, Vincent Delecroix\" to \"Mario Pernici, Vincent Delecroix\"",
    "created_at": "2016-07-14T07:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18356#issuecomment-319375",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "Marco Pernici, Vincent Delecroix" to "Mario Pernici, Vincent Delecroix"
