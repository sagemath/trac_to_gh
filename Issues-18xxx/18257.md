# Issue 18257: fix symbolic/pynac.pyx doctests

archive/issues_018020.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nSeveral doctests in `symbolic/pynac.pyx` iterate over `range(get_ginac_serial(), get_ginac_serial()+100)`. You guess it (sigh), `100` is arbitrary and, right now with some new tickets that introduce new functions, it has become too small, leading to unrelated doctest fails in `symbolic/pynac.pyx`. This ticket should make sure that this does not happen again.\n\nCC:  @kcrisman\n\nComponent: **symbolics**\n\nAuthor: **Ralf Stephan**\n\nBranch/Commit: **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**\n\nReviewer: **Karl-Dieter Crisman**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18257_\n\n",
    "closed_at": "2015-06-02T20:18:15Z",
    "created_at": "2015-04-20T07:54:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix symbolic/pynac.pyx doctests",
    "type": "issue",
    "updated_at": "2015-06-02T20:18:15Z",
    "url": "https://github.com/sagemath/sage/issues/18257",
    "user": "https://github.com/rwst"
}
```
<div id="comment:0"></div>

Several doctests in `symbolic/pynac.pyx` iterate over `range(get_ginac_serial(), get_ginac_serial()+100)`. You guess it (sigh), `100` is arbitrary and, right now with some new tickets that introduce new functions, it has become too small, leading to unrelated doctest fails in `symbolic/pynac.pyx`. This ticket should make sure that this does not happen again.

CC:  @kcrisman

Component: **symbolics**

Author: **Ralf Stephan**

Branch/Commit: **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**

Reviewer: **Karl-Dieter Crisman**

_Issue created by migration from https://trac.sagemath.org/ticket/18257_





---

archive/issue_events_257229.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T07:54:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257229"
}
```



---

archive/issue_events_257230.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T07:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257230"
}
```



---

archive/issue_events_257231.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T07:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257231"
}
```



---

archive/issue_events_257232.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T07:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257232"
}
```



---

archive/issue_comments_250347.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI agree that this is worth fixing permanently, but unless there is an obvious fix we shouldn't let this hold up adding more symbolic functions.",
    "created_at": "2015-05-22T12:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250347",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

I agree that this is worth fixing permanently, but unless there is an obvious fix we shouldn't let this hold up adding more symbolic functions.



---

archive/issue_events_257233.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-05-22T12:48:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257233"
}
```



---

archive/issue_events_257234.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-05-22T12:48:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257234"
}
```



---

archive/issue_comments_250348.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@kcrisman](#comment%3A1):\n> I agree that this is worth fixing permanently, but unless there is an obvious fix we shouldn't let this hold up adding more symbolic functions.\n\nThis is not really difficult.\n\nThe central database is a dictionary globally defined in `symbolic/function.pyx` named `sfunction_serial_dict`. It has pairs with key of type `unsigned` and values of `Function` objects (which can be `GinacFunctions` or `BuiltinFunctions`). Accordingly this database is filled with all known Pynac `function`s (which have the `GinacFunction` fa\u00e7ade) first and then those defined via `BuiltinFunction`. The `unsigned` key is the serial number which, on each new function registration, is incremented by one, namely in `GiNaC::function::register_new()`(https://github.com/pynac/pynac/blob/master/ginac/function.cpp#L1445) by just adding to the Pynac registry and reporting its size minus one. After the GiNaC functions have been added, the global `GINAC_FN_SERIAL` is set which is then accessed via `get_ginac_serial()` to get the start key of the Sage defined functions.\n\nThere is a problem if ever a function is deregistered. Can this happen? No mechanism in Pynac exists for this at the moment, so it's  not a practical consideration.\n\nSo the solution is easy: instead of simply adding `100` to the start point, we try all keys from the start key to the latest key used---this need not be a static variable set on registration. Since functions are never deregistered the latest is, again, just the size of the GiNaC registry minus one. This can be had from a call to `g_registered_functions().size()` in `symbolic/pynac.pyx`. \n\n```\ncdef get_fn_serial_c():\n    return g_registered_functions().size()\n\ndef get_fn_serial():\n    return get_fn_serial_c()\n\nsage: from sage.symbolic.pynac import get_fn_serial\nsage: get_fn_serial()\n127\nsage: from sage.symbolic.pynac import get_ginac_serial\nsage: get_ginac_serial()\n40\nsage: from sage.symbolic.function import get_sfunction_from_serial\nsage: for i in range(get_ginac_serial(), get_fn_serial()):\n    print get_sfunction_from_serial(i)\n... // prints all known functions\nsage: print get_sfunction_from_serial(get_fn_serial()+1)\nNone\n```",
    "created_at": "2015-05-25T08:37:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250348",
    "user": "https://github.com/rwst"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@kcrisman](#comment%3A1):
> I agree that this is worth fixing permanently, but unless there is an obvious fix we shouldn't let this hold up adding more symbolic functions.

This is not really difficult.

The central database is a dictionary globally defined in `symbolic/function.pyx` named `sfunction_serial_dict`. It has pairs with key of type `unsigned` and values of `Function` objects (which can be `GinacFunctions` or `BuiltinFunctions`). Accordingly this database is filled with all known Pynac `function`s (which have the `GinacFunction` fa√ßade) first and then those defined via `BuiltinFunction`. The `unsigned` key is the serial number which, on each new function registration, is incremented by one, namely in `GiNaC::function::register_new()`(https://github.com/pynac/pynac/blob/master/ginac/function.cpp#L1445) by just adding to the Pynac registry and reporting its size minus one. After the GiNaC functions have been added, the global `GINAC_FN_SERIAL` is set which is then accessed via `get_ginac_serial()` to get the start key of the Sage defined functions.

There is a problem if ever a function is deregistered. Can this happen? No mechanism in Pynac exists for this at the moment, so it's  not a practical consideration.

So the solution is easy: instead of simply adding `100` to the start point, we try all keys from the start key to the latest key used---this need not be a static variable set on registration. Since functions are never deregistered the latest is, again, just the size of the GiNaC registry minus one. This can be had from a call to `g_registered_functions().size()` in `symbolic/pynac.pyx`. 

```
cdef get_fn_serial_c():
    return g_registered_functions().size()

def get_fn_serial():
    return get_fn_serial_c()

sage: from sage.symbolic.pynac import get_fn_serial
sage: get_fn_serial()
127
sage: from sage.symbolic.pynac import get_ginac_serial
sage: get_ginac_serial()
40
sage: from sage.symbolic.function import get_sfunction_from_serial
sage: for i in range(get_ginac_serial(), get_fn_serial()):
    print get_sfunction_from_serial(i)
... // prints all known functions
sage: print get_sfunction_from_serial(get_fn_serial()+1)
None
```



---

archive/issue_comments_250349.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAs they say the first thing that goes down the drain is the planning. The above solution does not account for user defined Python functions that do not inherit from `BuiltinFunction` or `Function`.",
    "created_at": "2015-05-25T09:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250349",
    "user": "https://github.com/rwst"
}
```

<div id="comment:3" align="right">comment:3</div>

As they say the first thing that goes down the drain is the planning. The above solution does not account for user defined Python functions that do not inherit from `BuiltinFunction` or `Function`.



---

archive/issue_comments_250350.json:
```json
{
    "body": "Branch: **[u/rws/fix_symbolic_pynac_pyx_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/fix_symbolic_pynac_pyx_doctests)**",
    "created_at": "2015-05-25T13:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250350",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/fix_symbolic_pynac_pyx_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/fix_symbolic_pynac_pyx_doctests)**



---

archive/issue_events_257235.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T13:38:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257235"
}
```



---

archive/issue_events_257236.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T13:38:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257236"
}
```



---

archive/issue_events_257237.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T13:38:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257237"
}
```



---

archive/issue_comments_250351.json:
```json
{
    "body": "Commit: **[`13ba99d`](https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b)**",
    "created_at": "2015-05-25T13:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250351",
    "user": "https://github.com/rwst"
}
```

Commit: **[`13ba99d`](https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b)**



---

archive/issue_comments_250352.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNo, that was an off-by-one error. Please review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b\"><code>13ba99d</code></a></td><td><code>18257: fix symbolic/pynac.pyx doctests</code></td></tr></table>\n",
    "created_at": "2015-05-25T13:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250352",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

No, that was an off-by-one error. Please review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b"><code>13ba99d</code></a></td><td><code>18257: fix symbolic/pynac.pyx doctests</code></td></tr></table>




---

archive/issue_events_257238.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T13:38:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257238"
}
```



---

archive/issue_events_257239.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-05-25T13:38:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257239"
}
```



---

archive/issue_comments_250353.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nTrivial - duplicate lines in test\n\n```\n+        sage: from sage.symbolic.pynac import get_fn_serial\n+        sage: from sage.symbolic.function import get_sfunction_from_serial\n+        sage: from sage.symbolic.pynac import get_fn_serial\n```\nThis patch seems reasonable.  What was [comment:3](#comment%3A3) about?  I sense that it was a red herring, but if it could be useful for test-driving this I would love to try it.  I assume that since this isn't actually called in Sage but is really just for doctesting, it shouldn't have any speed implications.",
    "created_at": "2015-05-28T15:14:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250353",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

Trivial - duplicate lines in test

```
+        sage: from sage.symbolic.pynac import get_fn_serial
+        sage: from sage.symbolic.function import get_sfunction_from_serial
+        sage: from sage.symbolic.pynac import get_fn_serial
```
This patch seems reasonable.  What was [comment:3](#comment%3A3) about?  I sense that it was a red herring, but if it could be useful for test-driving this I would love to try it.  I assume that since this isn't actually called in Sage but is really just for doctesting, it shouldn't have any speed implications.



---

archive/issue_comments_250354.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73\"><code>52ccd47</code></a></td><td><code>18257: fix typo</code></td></tr></table>\n",
    "created_at": "2015-05-29T07:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250354",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73"><code>52ccd47</code></a></td><td><code>18257: fix typo</code></td></tr></table>




---

archive/issue_comments_250355.json:
```json
{
    "body": "Changed commit from **[`13ba99d`](https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**",
    "created_at": "2015-05-29T07:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250355",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`13ba99d`](https://github.com/sagemath/sagetrac-mirror/commit/13ba99da6b01b2b94ee67a50169567def261898b)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**



---

archive/issue_comments_250356.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2015-05-29T07:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250356",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_250357.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@kcrisman](#comment%3A6):\n> ...  What was [comment:3](#comment%3A3) about?  I sense that it was a red herring, but if it could be useful for test-driving this I would love to try it.  I assume that since this isn't actually called in Sage but is really just for doctesting, it shouldn't have any speed implications.\n\nIt's taken care of in the doctests.",
    "created_at": "2015-05-29T07:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250357",
    "user": "https://github.com/rwst"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@kcrisman](#comment%3A6):
> ...  What was [comment:3](#comment%3A3) about?  I sense that it was a red herring, but if it could be useful for test-driving this I would love to try it.  I assume that since this isn't actually called in Sage but is really just for doctesting, it shouldn't have any speed implications.

It's taken care of in the doctests.



---

archive/issue_comments_250358.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'm not sure why but I still get\n\n```\nsage -t src/sage/symbolic/pynac.pyx\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 512, in sage.symbolic.pynac.py_latex_function_pystring\nFailed example:\n    get_sfunction_from_serial(i) == foo\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 514, in sage.symbolic.pynac.py_latex_function_pystring\nFailed example:\n    py_latex_function_pystring(i, (x,y^z))\nExpected:\n    'my args are: x, y^z'\nGot:\n    '\\\\mathrm{bar}\\\\left(x, y^{z}\\\\right)'\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 603, in sage.symbolic.pynac.py_print_fderivative_for_doctests\nFailed example:\n    get_sfunction_from_serial(i) == foo\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 605, in sage.symbolic.pynac.py_print_fderivative_for_doctests\nFailed example:\n    py_print_fderivative(i, (0, 1, 0, 1), (x, y^z))\nExpected:\n    D[0, 1, 0, 1]func_with_args(x, y^z)\nGot:\n    D[0, 1, 0, 1](foo)(x, y^z)\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 665, in sage.symbolic.pynac.py_latex_fderivative_for_doctests\nFailed example:\n    get_sfunction_from_serial(i) == foo\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/symbolic/pynac.pyx\", line 667, in sage.symbolic.pynac.py_latex_fderivative_for_doctests\nFailed example:\n    py_latex_fderivative(i, (0, 1, 0, 1), (x, y^z))\nExpected:\n    D[0, 1, 0, 1]func_with_args(x, y^z)\nGot:\n    D[0, 1, 0, 1]\\left(\\mathrm{bar}\\right)\\left(x, y^{z}\\right)\n**********************************************************************\n```\nwhen I have both this ticket and #15024 together.  Did I do something wrong?  (Note: this is based off of 6.8.beta1, if it matters.)",
    "created_at": "2015-05-29T13:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250358",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">comment:10</div>

I'm not sure why but I still get

```
sage -t src/sage/symbolic/pynac.pyx
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 512, in sage.symbolic.pynac.py_latex_function_pystring
Failed example:
    get_sfunction_from_serial(i) == foo
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 514, in sage.symbolic.pynac.py_latex_function_pystring
Failed example:
    py_latex_function_pystring(i, (x,y^z))
Expected:
    'my args are: x, y^z'
Got:
    '\\mathrm{bar}\\left(x, y^{z}\\right)'
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 603, in sage.symbolic.pynac.py_print_fderivative_for_doctests
Failed example:
    get_sfunction_from_serial(i) == foo
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 605, in sage.symbolic.pynac.py_print_fderivative_for_doctests
Failed example:
    py_print_fderivative(i, (0, 1, 0, 1), (x, y^z))
Expected:
    D[0, 1, 0, 1]func_with_args(x, y^z)
Got:
    D[0, 1, 0, 1](foo)(x, y^z)
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 665, in sage.symbolic.pynac.py_latex_fderivative_for_doctests
Failed example:
    get_sfunction_from_serial(i) == foo
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 667, in sage.symbolic.pynac.py_latex_fderivative_for_doctests
Failed example:
    py_latex_fderivative(i, (0, 1, 0, 1), (x, y^z))
Expected:
    D[0, 1, 0, 1]func_with_args(x, y^z)
Got:
    D[0, 1, 0, 1]\left(\mathrm{bar}\right)\left(x, y^{z}\right)
**********************************************************************
```
when I have both this ticket and #15024 together.  Did I do something wrong?  (Note: this is based off of 6.8.beta1, if it matters.)



---

archive/issue_comments_250359.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCannot confirm in a first attempt (I branched from #18257, merged #15024 with `git trac pull`, then merged develop).",
    "created_at": "2015-05-29T15:05:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250359",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">comment:11</div>

Cannot confirm in a first attempt (I branched from #18257, merged #15024 with `git trac pull`, then merged develop).



---

archive/issue_comments_250360.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSame branch does work with pynac-0.3.9 (in case you left that installed and that was the difference between us).",
    "created_at": "2015-05-29T15:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250360",
    "user": "https://github.com/rwst"
}
```

<div id="comment:12" align="right">comment:12</div>

Same branch does work with pynac-0.3.9 (in case you left that installed and that was the difference between us).



---

archive/issue_comments_250361.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nYour line numbers also don't match #18257.",
    "created_at": "2015-05-29T15:12:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250361",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Your line numbers also don't match #18257.



---

archive/issue_comments_250362.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOkay, I'll trash the branches I made locally and try again - may not be immediately, I'm at a conference.",
    "created_at": "2015-05-29T18:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250362",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:14" align="right">comment:14</div>

Okay, I'll trash the branches I made locally and try again - may not be immediately, I'm at a conference.



---

archive/issue_comments_250363.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2015-06-01T14:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250363",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_events_257240.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-06-01T14:18:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257240"
}
```



---

archive/issue_events_257241.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-06-01T14:18:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257241"
}
```



---

archive/issue_comments_250364.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI must have either not merged this one or perhaps in the wrong order or something... Anyway, all systems are go, and as expected #15024 fails without this and works with it.  Great!",
    "created_at": "2015-06-01T14:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250364",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">comment:15</div>

I must have either not merged this one or perhaps in the wrong order or something... Anyway, all systems are go, and as expected #15024 fails without this and works with it.  Great!



---

archive/issue_events_257242.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T14:36:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257242"
}
```



---

archive/issue_events_257243.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T14:36:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257243"
}
```



---

archive/issue_comments_250365.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHold on. I have a necessary addition because of a commit in Pynac where I removed the registry entries for some defunct functions which makes two of the doctest here fail. This would fit in nicely here.",
    "created_at": "2015-06-01T14:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250365",
    "user": "https://github.com/rwst"
}
```

<div id="comment:16" align="right">comment:16</div>

Hold on. I have a necessary addition because of a commit in Pynac where I removed the registry entries for some defunct functions which makes two of the doctest here fail. This would fit in nicely here.



---

archive/issue_comments_250366.json:
```json
{
    "body": "Changed commit from **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)** to **[`557badf`](https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1)**",
    "created_at": "2015-06-01T14:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)** to **[`557badf`](https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1)**



---

archive/issue_comments_250367.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1\"><code>557badf</code></a></td><td><code>adjust doctest because of upstream changes</code></td></tr></table>\n",
    "created_at": "2015-06-01T14:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1"><code>557badf</code></a></td><td><code>adjust doctest because of upstream changes</code></td></tr></table>




---

archive/issue_comments_250368.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCould you please have a last quick look?",
    "created_at": "2015-06-01T14:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250368",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

Could you please have a last quick look?



---

archive/issue_events_257244.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T14:50:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257244"
}
```



---

archive/issue_events_257245.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T14:50:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257245"
}
```



---

archive/issue_comments_250369.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI don't understand why this fails, though?  (I mean it shouldn't currently, nothing failed for me.) Surely it would be better to put that commit with the next Pynac upgrade ticket?  Easier for the reviewer to test, then (i.e. first upgrade Pynac, run tests (fail), then add branch, watch tests pass).",
    "created_at": "2015-06-01T14:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250369",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

I don't understand why this fails, though?  (I mean it shouldn't currently, nothing failed for me.) Surely it would be better to put that commit with the next Pynac upgrade ticket?  Easier for the reviewer to test, then (i.e. first upgrade Pynac, run tests (fail), then add branch, watch tests pass).



---

archive/issue_comments_250370.json:
```json
{
    "body": "Changed branch from **[u/rws/fix_symbolic_pynac_pyx_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/fix_symbolic_pynac_pyx_doctests)** to **[u/rws/18257](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18257)**",
    "created_at": "2015-06-01T15:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250370",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/fix_symbolic_pynac_pyx_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/fix_symbolic_pynac_pyx_doctests)** to **[u/rws/18257](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18257)**



---

archive/issue_events_257246.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T15:22:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257246"
}
```



---

archive/issue_events_257247.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-01T15:22:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257247"
}
```



---

archive/issue_comments_250371.json:
```json
{
    "body": "Changed commit from **[`557badf`](https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**",
    "created_at": "2015-06-01T15:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250371",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`557badf`](https://github.com/sagemath/sagetrac-mirror/commit/557badf1a587f24e500dd12196b14bf59a144dd1)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**



---

archive/issue_events_257248.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-02T20:18:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257248"
}
```



---

archive/issue_events_257249.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3ad7e1fa60e9b2a6d4fc71bc934f17e54edc8f77",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-02T20:18:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18257#event-257249"
}
```



---

archive/issue_comments_250372.json:
```json
{
    "body": "Changed branch from **[u/rws/18257](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18257)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**",
    "created_at": "2015-06-02T20:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18257#issuecomment-250372",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/18257](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18257)** to **[`52ccd47`](https://github.com/sagemath/sagetrac-mirror/commit/52ccd47dee6b0cb6da2ad6f3855942c84a36ac73)**
