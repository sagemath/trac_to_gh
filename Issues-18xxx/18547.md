# Issue 18547: Improve polynomial powering in positive characteristic

archive/issues_018310.json:
```json
{
    "assignees": [],
    "body": "Before:\n\n```python\nsage: R.<x> = PolynomialRing(GF(5), sparse=True)\nsage: (1+x)^(5^10)\n... (hangs for ever)\n```\n\nAfter:\n\n```python\nsage: R.<x> = PolynomialRing(GF(5), sparse=True)\nsage: (1+x)^(5^10)\nx^9765625 + 1\n```\n\n**Notes.**\n1. I've tried to be careful with quite extensive tests not to slow down the computations for \"easy\" cases. This explains the threshold values in the code.\n2. This is related to #7253 and #12660. Though, there is another problem for non-sparse polynomials: Simply assigning the value and printing the polynomial take a very long time. Compare the timings for\n\n    ```python\n    sage: R.<x> = ZZ[]\n    sage: 1+x^5^10\n    x^9765625 + 1\n    ```\n    and \n\n    ```python\n    sage: R.<x> = GF(5)[]\n    sage: 1+x^5^10\n    x^9765625 + 1\n    ```\n    Thus for tickets #7253 and #12660 to be closed, it remains to handle this other problem, but this is not the purpose of this ticket.\n\n\n\nKeywords: **polynomial, powering**\n\nBranch/Commit: **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Bruno Grenet**\n\nComponent: **commutative algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18547_\n\n",
    "closed_at": "2015-09-07T21:34:55Z",
    "created_at": "2015-05-29T15:18:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve polynomial powering in positive characteristic",
    "type": "issue",
    "updated_at": "2015-09-07T21:34:55Z",
    "url": "https://github.com/sagemath/sage/issues/18547",
    "user": "https://github.com/bgrenet"
}
```
Before:

```python
sage: R.<x> = PolynomialRing(GF(5), sparse=True)
sage: (1+x)^(5^10)
... (hangs for ever)
```

After:

```python
sage: R.<x> = PolynomialRing(GF(5), sparse=True)
sage: (1+x)^(5^10)
x^9765625 + 1
```

**Notes.**
1. I've tried to be careful with quite extensive tests not to slow down the computations for "easy" cases. This explains the threshold values in the code.
2. This is related to #7253 and #12660. Though, there is another problem for non-sparse polynomials: Simply assigning the value and printing the polynomial take a very long time. Compare the timings for

    ```python
    sage: R.<x> = ZZ[]
    sage: 1+x^5^10
    x^9765625 + 1
    ```
    and 

    ```python
    sage: R.<x> = GF(5)[]
    sage: 1+x^5^10
    x^9765625 + 1
    ```
    Thus for tickets #7253 and #12660 to be closed, it remains to handle this other problem, but this is not the purpose of this ticket.



Keywords: **polynomial, powering**

Branch/Commit: **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**

Reviewer: **Jeroen Demeyer**

Author: **Bruno Grenet**

Component: **commutative algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/18547_





---

archive/issue_events_263641.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-05-29T15:18:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263641"
}
```



---

archive/issue_events_263642.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-05-29T15:18:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263642"
}
```



---

archive/issue_events_263643.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-05-29T15:18:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263643"
}
```



---

archive/issue_events_263644.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-05-29T15:18:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263644"
}
```



---

archive/issue_comments_257461.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb\">a8ecb3e</a></td><td><code>Special code for positive characteristic</code></td></tr></table>\n",
    "created_at": "2015-05-29T15:20:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257461",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb">a8ecb3e</a></td><td><code>Special code for positive characteristic</code></td></tr></table>




---

archive/issue_comments_257462.json:
```json
{
    "body": "Commit: **[a8ecb3e](https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb)**",
    "created_at": "2015-05-29T15:20:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257462",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[a8ecb3e](https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb)**



---

archive/issue_events_263645.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-05-29T15:20:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263645"
}
```



---

archive/issue_comments_257463.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df\">8f4125b</a></td><td><code>Typo in the doc</code></td></tr></table>\n",
    "created_at": "2015-05-29T15:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257463",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df">8f4125b</a></td><td><code>Typo in the doc</code></td></tr></table>




---

archive/issue_comments_257464.json:
```json
{
    "body": "Changed commit from **[a8ecb3e](https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb)** to **[8f4125b](https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df)**",
    "created_at": "2015-05-29T15:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257464",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a8ecb3e](https://github.com/sagemath/sagetrac-mirror/commit/a8ecb3e0c9e353370b2a3754a7d6fc46891da4cb)** to **[8f4125b](https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df)**



---

archive/issue_events_263646.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-29T19:31:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263646"
}
```



---

archive/issue_events_263647.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-29T19:31:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263647"
}
```



---

archive/issue_comments_257465.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYour added doctest still takes `# long time` (28s on my computer). You should shorten the test to take less than 1s: `5^8` instead of `5^10` would be better.",
    "created_at": "2015-05-29T19:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257465",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Your added doctest still takes `# long time` (28s on my computer). You should shorten the test to take less than 1s: `5^8` instead of `5^10` would be better.



---

archive/issue_comments_257466.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't get it, it seems that the doctest doesn't even use the new code. It's equally slow with or without this patch...",
    "created_at": "2015-05-29T19:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257466",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't get it, it seems that the doctest doesn't even use the new code. It's equally slow with or without this patch...



---

archive/issue_comments_257467.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think it does use the code.  But what's happening is that in the line\n\n```\n                return self.subs({x:x**(q*p)}) * self**r\n```\n`x**(q*p)` is taking (almost) all the time.  And this comes from the section of the code dealing with powers of the polynomial generator, in particular the line\n\n```\n            return self.parent()(v, check=False)\n```\nwhere `v` is defined in the previous line as\n\n```\n                v = [R.zero()]*right + [R.one()]\n```\nwith `R` being the base ring.  It just takes a long time to create a non-sparse polynomial of this size.",
    "created_at": "2015-05-30T09:18:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257467",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:6" align="right">comment:6</div>

I think it does use the code.  But what's happening is that in the line

```
                return self.subs({x:x**(q*p)}) * self**r
```
`x**(q*p)` is taking (almost) all the time.  And this comes from the section of the code dealing with powers of the polynomial generator, in particular the line

```
            return self.parent()(v, check=False)
```
where `v` is defined in the previous line as

```
                v = [R.zero()]*right + [R.one()]
```
with `R` being the base ring.  It just takes a long time to create a non-sparse polynomial of this size.



---

archive/issue_comments_257468.json:
```json
{
    "body": "Changed commit from **[8f4125b](https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df)** to **[139ac60](https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028)**",
    "created_at": "2015-06-01T09:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257468",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8f4125b](https://github.com/sagemath/sagetrac-mirror/commit/8f4125bc4d368738cf734d023086c33bc9bf62df)** to **[139ac60](https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028)**



---

archive/issue_comments_257469.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028\">139ac60</a></td><td><code>Correct doctest</code></td></tr></table>\n",
    "created_at": "2015-06-01T09:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257469",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028">139ac60</a></td><td><code>Correct doctest</code></td></tr></table>




---

archive/issue_comments_257470.json:
```json
{
    "body": "Changed commit from **[139ac60](https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028)** to **[3088973](https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77)**",
    "created_at": "2015-06-01T09:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257470",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[139ac60](https://github.com/sagemath/sagetrac-mirror/commit/139ac601f9635d3f613613d2b0537964fe942028)** to **[3088973](https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77)**



---

archive/issue_comments_257471.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77\">3088973</a></td><td><code>Special code only works for field... of course!</code></td></tr></table>\n",
    "created_at": "2015-06-01T09:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257471",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77">3088973</a></td><td><code>Special code only works for field... of course!</code></td></tr></table>




---

archive/issue_comments_257472.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:5):\n> I don't get it, it seems that the doctest doesn't even use the new code. It's equally slow with or without this patch...\n\nRight, because my doctest was wrong: The code is intended for sparse polynomials. I have not really been able yet to determine what is precisely going on for dense polynomial. Though, as indicated by [fwclarke](#comment:6) and mentioned in my note 2. in the description, there is another problem for dense polynomial, namely that creating a large polynomial over a finite field takes a very long time. It is not the purpose of this ticket to correct this, even though it should be corrected!\n\nThis patch thus improves the situation for *sparse polynomials only*. The code is indeed not used for dense polynomials over `Zmod(k)` for any `k` since specific code appears in `src/sage/rings/polynomial/polynomial_template.pxi` for this case.\n\n**Important note:** I forgot to test whether the base ring is a field, which is of course mandatory. I correct this mistake in my latest commit.",
    "created_at": "2015-06-01T09:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257472",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:5):
> I don't get it, it seems that the doctest doesn't even use the new code. It's equally slow with or without this patch...

Right, because my doctest was wrong: The code is intended for sparse polynomials. I have not really been able yet to determine what is precisely going on for dense polynomial. Though, as indicated by [fwclarke](#comment:6) and mentioned in my note 2. in the description, there is another problem for dense polynomial, namely that creating a large polynomial over a finite field takes a very long time. It is not the purpose of this ticket to correct this, even though it should be corrected!

This patch thus improves the situation for *sparse polynomials only*. The code is indeed not used for dense polynomials over `Zmod(k)` for any `k` since specific code appears in `src/sage/rings/polynomial/polynomial_template.pxi` for this case.

**Important note:** I forgot to test whether the base ring is a field, which is of course mandatory. I correct this mistake in my latest commit.



---

archive/issue_events_263648.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-06-01T09:50:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263648"
}
```



---

archive/issue_events_263649.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-06-01T09:50:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263649"
}
```



---

archive/issue_comments_257473.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYou added 3 cases here:\n\n```\nif self.parent().base_ring().is_finite():\n    return ...\nif self.parent().is_sparse():\n    ...\nelse:\n    ...\n```\nYou should add a doctest for each of these 3 cases (and perhaps replace the second `if` by `elif` for clarity).",
    "created_at": "2015-06-01T11:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257473",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

You added 3 cases here:

```
if self.parent().base_ring().is_finite():
    return ...
if self.parent().is_sparse():
    ...
else:
    ...
```
You should add a doctest for each of these 3 cases (and perhaps replace the second `if` by `elif` for clarity).



---

archive/issue_events_263650.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-01T11:39:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263650"
}
```



---

archive/issue_events_263651.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-01T11:39:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263651"
}
```



---

archive/issue_comments_257474.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@bgrenet](#comment:9):\n> **Important note:** I forgot to test whether the base ring is a field, which is of course mandatory.\n\nWhy is this \"of course\" mandatory? You need that the characteristic is a prime number, not that the base ring is a field.",
    "created_at": "2015-06-01T11:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257474",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@bgrenet](#comment:9):
> **Important note:** I forgot to test whether the base ring is a field, which is of course mandatory.

Why is this "of course" mandatory? You need that the characteristic is a prime number, not that the base ring is a field.



---

archive/issue_comments_257475.json:
```json
{
    "body": "Changed commit from **[3088973](https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77)** to **[7760a43](https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c)**",
    "created_at": "2015-06-01T16:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257475",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3088973](https://github.com/sagemath/sagetrac-mirror/commit/3088973f9fadcd82960950ed3c8320886ae9ed77)** to **[7760a43](https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c)**



---

archive/issue_comments_257476.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c\">7760a43</a></td><td><code>Correct algorithm + adapted doctests</code></td></tr></table>\n",
    "created_at": "2015-06-01T16:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257476",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c">7760a43</a></td><td><code>Correct algorithm + adapted doctests</code></td></tr></table>




---

archive/issue_events_263652.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-06-01T16:12:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263652"
}
```



---

archive/issue_events_263653.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-06-01T16:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263653"
}
```



---

archive/issue_comments_257477.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe algorithm I proposed was completely wrong: If `p` is the characteristic and `n=p * q + r`, I used the **wrong** identity `f(x)^n = f(x^{p*q}) * f(x)^r` instead of the correct `f(x)^n = f(x<sup>p)</sup>q * f(x)^r`. \n\nIn the commit, I correct this mistake, and in the same time I take [jdemeyer](#comment:10)'s comments into account:\n- I add doctests for the different possibilities. (Note that I wrote code for the case where the base ring is a finite field and the polynomials are in dense representation, though as I wrote [above](#comment:9) this code is not used since there is specific code in `polynomial_template.pxi`. Thus there is no doctest for this case.)\n- \"Of course\", it is not \"of course mandatory\" for the base ring to be a finite field...\n\nFurthermore, I improve the code not using `self.subs(...)`, but rather doing the computations myself.",
    "created_at": "2015-06-01T16:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257477",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:13" align="right">comment:13</div>

The algorithm I proposed was completely wrong: If `p` is the characteristic and `n=p * q + r`, I used the **wrong** identity `f(x)^n = f(x^{p*q}) * f(x)^r` instead of the correct `f(x)^n = f(x<sup>p)</sup>q * f(x)^r`. 

In the commit, I correct this mistake, and in the same time I take [jdemeyer](#comment:10)'s comments into account:
- I add doctests for the different possibilities. (Note that I wrote code for the case where the base ring is a finite field and the polynomials are in dense representation, though as I wrote [above](#comment:9) this code is not used since there is specific code in `polynomial_template.pxi`. Thus there is no doctest for this case.)
- "Of course", it is not "of course mandatory" for the base ring to be a finite field...

Furthermore, I improve the code not using `self.subs(...)`, but rather doing the computations myself.



---

archive/issue_events_263654.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-08-28T20:07:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263654"
}
```



---

archive/issue_events_263655.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-08-28T20:07:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263655"
}
```



---

archive/issue_comments_257478.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere should be an empty line after\n\n```\nCheck that the algorithm used is indeed correct::\n```",
    "created_at": "2015-08-28T20:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257478",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

There should be an empty line after

```
Check that the algorithm used is indeed correct::
```



---

archive/issue_comments_257479.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6\">959947d</a></td><td><code>trac 18547: add missing empty line</code></td></tr></table>\n",
    "created_at": "2015-08-29T08:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257479",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6">959947d</a></td><td><code>trac 18547: add missing empty line</code></td></tr></table>




---

archive/issue_comments_257480.json:
```json
{
    "body": "Changed commit from **[7760a43](https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c)** to **[959947d](https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6)**",
    "created_at": "2015-08-29T08:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257480",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7760a43](https://github.com/sagemath/sagetrac-mirror/commit/7760a4306328684b58752e095b84991c66a3996c)** to **[959947d](https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6)**



---

archive/issue_comments_257481.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@fchapoton](#comment:14):\n> There should be an empty line after\n> \n> ```\n> Check that the algorithm used is indeed correct::\n> ```\n\nDone!",
    "created_at": "2015-08-29T08:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257481",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@fchapoton](#comment:14):
> There should be an empty line after
> 
> ```
> Check that the algorithm used is indeed correct::
> ```

Done!



---

archive/issue_events_263656.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-08-29T08:56:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263656"
}
```



---

archive/issue_events_263657.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-08-29T08:56:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263657"
}
```



---

archive/issue_comments_257482.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think this test is much too weak:\n\n```\nsage: R.<x> = PolynomialRing(GF(17), sparse=True)\nsage: for d in [17, 264, 516]:\n....: assert((1+x)^d == generic_power(1+x,d))\n```\n\n(but I'll wait to suggest a better test until I understand the code better).",
    "created_at": "2015-08-30T11:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257482",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

I think this test is much too weak:

```
sage: R.<x> = PolynomialRing(GF(17), sparse=True)
sage: for d in [17, 264, 516]:
....: assert((1+x)^d == generic_power(1+x,d))
```

(but I'll wait to suggest a better test until I understand the code better).



---

archive/issue_events_263658.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-08-30T11:38:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263658"
}
```



---

archive/issue_events_263659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-08-30T11:38:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263659"
}
```



---

archive/issue_comments_257483.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nPlease justify in the code why\n\n```\n# characteristic 2 is special\n```",
    "created_at": "2015-08-30T11:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257483",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Please justify in the code why

```
# characteristic 2 is special
```



---

archive/issue_events_263660.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-08-30T11:38:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263660"
}
```



---

archive/issue_events_263661.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-08-30T11:38:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263661"
}
```



---

archive/issue_comments_257484.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.",
    "created_at": "2015-08-30T11:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257484",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.



---

archive/issue_comments_257485.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAnd I'm not too happy with this either:\n\n```\nself.base_ring().is_field()\n```\n\nChecking whether some complicated ring is a field might be an expensive operation. I prefer\n\n```\nself.base_ring() in IntegralDomains\n```",
    "created_at": "2015-08-30T11:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257485",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

And I'm not too happy with this either:

```
self.base_ring().is_field()
```

Checking whether some complicated ring is a field might be an expensive operation. I prefer

```
self.base_ring() in IntegralDomains
```



---

archive/issue_comments_257486.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7788e843acd44a6e23f16559589315cde131e4b5\">7788e84</a></td><td><code>Merge branch 'u/bruno/polynomial_powering_positive_characteristic' of git://trac.sagemath.org/sage into t18547_poly_power_positive_char</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a452c7471e57e0ae4ecaef43a68ce3c3b3b71a9\">3a452c7</a></td><td><code>trac 18547: characteristic 2 is not special</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58\">5a4965c</a></td><td><code>trac 18547: is_field() replaced by in IntegralDomains</code></td></tr></table>\n",
    "created_at": "2015-08-31T12:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257486",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7788e843acd44a6e23f16559589315cde131e4b5">7788e84</a></td><td><code>Merge branch 'u/bruno/polynomial_powering_positive_characteristic' of git://trac.sagemath.org/sage into t18547_poly_power_positive_char</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a452c7471e57e0ae4ecaef43a68ce3c3b3b71a9">3a452c7</a></td><td><code>trac 18547: characteristic 2 is not special</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58">5a4965c</a></td><td><code>trac 18547: is_field() replaced by in IntegralDomains</code></td></tr></table>




---

archive/issue_comments_257487.json:
```json
{
    "body": "Changed commit from **[959947d](https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6)** to **[5a4965c](https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58)**",
    "created_at": "2015-08-31T12:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257487",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[959947d](https://github.com/sagemath/sagetrac-mirror/commit/959947d37b22e0c806e5e2034760abdc10d967b6)** to **[5a4965c](https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58)**



---

archive/issue_comments_257488.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI didn't say you had to remove this:\n\n```\nif ... or p.is_prime()\n```",
    "created_at": "2015-08-31T13:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257488",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

I didn't say you had to remove this:

```
if ... or p.is_prime()
```



---

archive/issue_comments_257489.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment:18):\n> Please justify in the code why\n> \n> ```\n> # characteristic 2 is special\n> ```\n\nI had run some tests and my conclusion that was using `generic_power` was faster in characteristic 2. (Note that binary exponentiation is well suited to this characteristic.) I am not able to reproduce this behavior though, so I removed the special case.\n\nReplying to [@jdemeyer](#comment:20):\n> And I'm not too happy with this either:\n> \n> ```\n> self.base_ring().is_field()\n> ```\n> \n> Checking whether some complicated ring is a field might be an expensive operation. I prefer\n> \n> ```\n> self.base_ring() in IntegralDomains\n> ```\n\nDone.\n\nReplying to [@jdemeyer](#comment:19):\n> I suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.\n\nActually, the current code is faster for finite fields. With the special case:\n\n```python\nsage: R.<x> = PolynomialRing(GF(17),sparse=True)\nsage: p = R.random_element(100)\nsage: %timeit p^(17^5)\nThe slowest run took 11.13 times longer than the fastest. This could mean that an intermediate result is being cached \n1000 loops, best of 3: 159 \u00b5s per loop\n```\n\nWithout the special case, with the same `p`:\n\n```python\n%timeit p^(17^5)\nThe slowest run took 26.59 times longer than the fastest. This could mean that an intermediate result is being cached \n1000 loops, best of 3: 249 \u00b5s per loop\n```\n\nI may refactor the code though so that it is less redundant. Tell me what you think.\n\nReplying to [@jdemeyer](#comment:17):\n> I think this test is much too weak\n\nI am happy if you find a good way to test this function!",
    "created_at": "2015-08-31T13:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257489",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment:18):
> Please justify in the code why
> 
> ```
> # characteristic 2 is special
> ```

I had run some tests and my conclusion that was using `generic_power` was faster in characteristic 2. (Note that binary exponentiation is well suited to this characteristic.) I am not able to reproduce this behavior though, so I removed the special case.

Replying to [@jdemeyer](#comment:20):
> And I'm not too happy with this either:
> 
> ```
> self.base_ring().is_field()
> ```
> 
> Checking whether some complicated ring is a field might be an expensive operation. I prefer
> 
> ```
> self.base_ring() in IntegralDomains
> ```

Done.

Replying to [@jdemeyer](#comment:19):
> I suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.

Actually, the current code is faster for finite fields. With the special case:

```python
sage: R.<x> = PolynomialRing(GF(17),sparse=True)
sage: p = R.random_element(100)
sage: %timeit p^(17^5)
The slowest run took 11.13 times longer than the fastest. This could mean that an intermediate result is being cached 
1000 loops, best of 3: 159 µs per loop
```

Without the special case, with the same `p`:

```python
%timeit p^(17^5)
The slowest run took 26.59 times longer than the fastest. This could mean that an intermediate result is being cached 
1000 loops, best of 3: 249 µs per loop
```

I may refactor the code though so that it is less redundant. Tell me what you think.

Replying to [@jdemeyer](#comment:17):
> I think this test is much too weak

I am happy if you find a good way to test this function!



---

archive/issue_comments_257490.json:
```json
{
    "body": "Changed commit from **[5a4965c](https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58)** to **[ba484df](https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0)**",
    "created_at": "2015-08-31T13:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257490",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a4965c](https://github.com/sagemath/sagetrac-mirror/commit/5a4965ccb5a4b03b5abcca65d0daeb4a96190a58)** to **[ba484df](https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0)**



---

archive/issue_comments_257491.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0\">ba484df</a></td><td><code>trac 18547: restore is_prime(), previously removed as an error</code></td></tr></table>\n",
    "created_at": "2015-08-31T13:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257491",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0">ba484df</a></td><td><code>trac 18547: restore is_prime(), previously removed as an error</code></td></tr></table>




---

archive/issue_comments_257492.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment:22):\n> I didn't say you had to remove this:\n> \n> ```\n> if ... or p.is_prime()\n> ```\n\nRight, my mistake!",
    "created_at": "2015-08-31T13:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257492",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment:22):
> I didn't say you had to remove this:
> 
> ```
> if ... or p.is_prime()
> ```

Right, my mistake!



---

archive/issue_events_263662.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-08-31T13:06:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263662"
}
```



---

archive/issue_events_263663.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-08-31T13:06:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263663"
}
```



---

archive/issue_events_263664.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-01T08:19:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263664"
}
```



---

archive/issue_events_263665.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-01T08:19:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263665"
}
```



---

archive/issue_comments_257493.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@bgrenet](#comment:23):\n> I am happy if you find a good way to test this function!\n\nYou have many cases and they should all be tested:\n\n```\nsage: R1 = PolynomialRing(GF(8, 'a'), 'x')\nsage: R2 = PolynomialRing(GF(9, 'b'), 'x', sparse=True)\nsage: R3 = PolynomialRing(R2, 'y')\nsage: R4 = PolynomialRing(R1, 'y', sparse=True)\nsage: for d in range(40):  # long time\n....:     for R in [R1, R2, R3, R4]:\n....:         a = R.random_element()\n....:         assert a^d == generic_power(a, d)\n```",
    "created_at": "2015-09-01T08:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257493",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@bgrenet](#comment:23):
> I am happy if you find a good way to test this function!

You have many cases and they should all be tested:

```
sage: R1 = PolynomialRing(GF(8, 'a'), 'x')
sage: R2 = PolynomialRing(GF(9, 'b'), 'x', sparse=True)
sage: R3 = PolynomialRing(R2, 'y')
sage: R4 = PolynomialRing(R1, 'y', sparse=True)
sage: for d in range(40):  # long time
....:     for R in [R1, R2, R3, R4]:
....:         a = R.random_element()
....:         assert a^d == generic_power(a, d)
```



---

archive/issue_comments_257494.json:
```json
{
    "body": "Changed commit from **[ba484df](https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0)** to **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**",
    "created_at": "2015-09-01T13:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257494",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ba484df](https://github.com/sagemath/sagetrac-mirror/commit/ba484dfa38afe24d10d2df1927e5a301e8a13dd0)** to **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**



---

archive/issue_comments_257495.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8d11a6e71684531def6fef495caed30a6584800\">e8d11a6</a></td><td><code>Trac 18547: better doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa\">41dd905</a></td><td><code>Trac 18547: Refactor and correct code</code></td></tr></table>\n",
    "created_at": "2015-09-01T13:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257495",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8d11a6e71684531def6fef495caed30a6584800">e8d11a6</a></td><td><code>Trac 18547: better doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa">41dd905</a></td><td><code>Trac 18547: Refactor and correct code</code></td></tr></table>




---

archive/issue_comments_257496.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment:26):\n> Replying to [@bgrenet](#comment:23):\n> > I am happy if you find a good way to test this function!\n\n> You have many cases and they should all be tested:\n> \n> ```\n> sage: R1 = PolynomialRing(GF(8, 'a'), 'x')\n> sage: R2 = PolynomialRing(GF(9, 'b'), 'x', sparse=True)\n> sage: R3 = PolynomialRing(R2, 'y')\n> sage: R4 = PolynomialRing(R1, 'y', sparse=True)\n> sage: for d in range(40):  # long time\n> ....:     for R in [R1, R2, R3, R4]:\n> ....:         a = R.random_element()\n> ....:         assert a^d == generic_power(a, d)\n> ```\n\nI introduced your proposed doctest, with the following change: Since I put a threshold `20` on the exponent before using the new code (for efficiency reasons), the loop is `for d in range(20,40)`.\n\nReplying to [@bgrenet](#comment:23):\n> Replying to [@jdemeyer](#comment:19):\n> > I suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.\n\n>\n> Actually, the current code is faster for finite fields.\n\nActually, the code was not correct for non-prime finite fields... (The special case should have been for prime finite fields only.) So I finally followed your advice and removed the special case. In the same time, I refactored a bit the code.",
    "created_at": "2015-09-01T13:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257496",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment:26):
> Replying to [@bgrenet](#comment:23):
> > I am happy if you find a good way to test this function!

> You have many cases and they should all be tested:
> 
> ```
> sage: R1 = PolynomialRing(GF(8, 'a'), 'x')
> sage: R2 = PolynomialRing(GF(9, 'b'), 'x', sparse=True)
> sage: R3 = PolynomialRing(R2, 'y')
> sage: R4 = PolynomialRing(R1, 'y', sparse=True)
> sage: for d in range(40):  # long time
> ....:     for R in [R1, R2, R3, R4]:
> ....:         a = R.random_element()
> ....:         assert a^d == generic_power(a, d)
> ```

I introduced your proposed doctest, with the following change: Since I put a threshold `20` on the exponent before using the new code (for efficiency reasons), the loop is `for d in range(20,40)`.

Replying to [@bgrenet](#comment:23):
> Replying to [@jdemeyer](#comment:19):
> > I suggest to remove the special case for finite fields. The generic code should work just fine for finite fields.

>
> Actually, the current code is faster for finite fields.

Actually, the code was not correct for non-prime finite fields... (The special case should have been for prime finite fields only.) So I finally followed your advice and removed the special case. In the same time, I refactored a bit the code.



---

archive/issue_events_263666.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-01T13:43:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263666"
}
```



---

archive/issue_events_263667.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-01T13:43:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263667"
}
```



---

archive/issue_comments_257497.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-09-07T12:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257497",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_263668.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-07T12:40:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263668"
}
```



---

archive/issue_events_263669.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-07T12:40:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263669"
}
```



---

archive/issue_events_263670.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-07T21:34:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263670"
}
```



---

archive/issue_events_263671.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1761131f306bc9e260ec6d0fe8a5aada2798d2f2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-09-07T21:34:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18547#event-263671"
}
```



---

archive/issue_comments_257498.json:
```json
{
    "body": "Changed branch from **[u/bruno/polynomial_powering_positive_characteristic](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/polynomial_powering_positive_characteristic)** to **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**",
    "created_at": "2015-09-07T21:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18547#issuecomment-257498",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/bruno/polynomial_powering_positive_characteristic](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/polynomial_powering_positive_characteristic)** to **[41dd905](https://github.com/sagemath/sagetrac-mirror/commit/41dd9054555eaaf7567fac4ec56d95d05b039daa)**
