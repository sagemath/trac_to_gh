# Issue 18238: Options ignored in show() of 3D objects

archive/issues_018001.json:
```json
{
    "body": "Since Sage 6.6, the options passed to show() are not taken into account in 3D rendering:\n\n```\nsage: show(sphere(), figsize=10, frame=False, aspect_ratio=(1,1,0.5))\n```\nyields exactly the same result as\n\n```\nsage: show(sphere())\n```\nSee this [sage-devel post](https://groups.google.com/d/msg/sage-devel/gcNhbllumg4/ECy5_wUgRqcJ).\n\n**CC:**  @vbraun @nathanncohen\n\n**Branch/Commit:** [2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)\n\n**Reviewer:** Volker Braun, Karl-Dieter Crisman, Vincent Delecroix\n\n**Author:** Eric Gourgoulhon, Volker Braun\n\nIssue created by migration from https://trac.sagemath.org/ticket/18238\n\n",
    "closed_at": "2015-04-19T11:05:12Z",
    "created_at": "2015-04-17T12:54:49Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Options ignored in show() of 3D objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18238",
    "user": "https://github.com/egourgoulhon"
}
```
Since Sage 6.6, the options passed to show() are not taken into account in 3D rendering:

```
sage: show(sphere(), figsize=10, frame=False, aspect_ratio=(1,1,0.5))
```
yields exactly the same result as

```
sage: show(sphere())
```
See this [sage-devel post](https://groups.google.com/d/msg/sage-devel/gcNhbllumg4/ECy5_wUgRqcJ).

**CC:**  @vbraun @nathanncohen

**Branch/Commit:** [2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)

**Reviewer:** Volker Braun, Karl-Dieter Crisman, Vincent Delecroix

**Author:** Eric Gourgoulhon, Volker Braun

Issue created by migration from https://trac.sagemath.org/ticket/18238





---

archive/issue_comments_253943.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9\">ff3731d</a></td><td><code>Fix the ignored options bug in 3D show() (cf. trac #18238).</code></td></tr></table>\n",
    "created_at": "2015-04-17T12:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253943",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9">ff3731d</a></td><td><code>Fix the ignored options bug in 3D show() (cf. trac #18238).</code></td></tr></table>




---

archive/issue_comments_253944.json:
```json
{
    "body": "**Commit:** [ff3731d4078f7db2caf2b62cb8cc45b777753ef9](https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9)",
    "created_at": "2015-04-17T12:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253944",
    "user": "https://github.com/egourgoulhon"
}
```

**Commit:** [ff3731d4078f7db2caf2b62cb8cc45b777753ef9](https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9)



---

archive/issue_comments_253945.json:
```json
{
    "body": "**Author:** Eric Gourgoulhon",
    "created_at": "2015-04-17T12:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253945",
    "user": "https://github.com/egourgoulhon"
}
```

**Author:** Eric Gourgoulhon



---

archive/issue_comments_253946.json:
```json
{
    "body": "**Branch:** [public/18238](https://github.com/sagemath/sagetrac-mirror/tree/public/18238)",
    "created_at": "2015-04-17T12:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253946",
    "user": "https://github.com/egourgoulhon"
}
```

**Branch:** [public/18238](https://github.com/sagemath/sagetrac-mirror/tree/public/18238)



---

archive/issue_events_166970.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2015-04-17T13:01:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166970"
}
```



---

archive/issue_comments_253947.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2015-04-17T13:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253947",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_events_166971.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T13:54:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166971"
}
```



---

archive/issue_events_166972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T13:54:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166972"
}
```



---

archive/issue_comments_253948.json:
```json
{
    "body": "<a id='comment:3'></a>\nlgtm",
    "created_at": "2015-04-17T13:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253948",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
lgtm



---

archive/issue_events_166973.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T14:06:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166973"
}
```



---

archive/issue_events_166974.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T14:06:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166974"
}
```



---

archive/issue_comments_253949.json:
```json
{
    "body": "<a id='comment:4'></a>\nHellooooooooooo,\n\nThe problem is fixed indeed, but the way this `_process_viewing_options` function works it only stores in `opt` the function that are actually used later. It is well implemented: your original dictionary has been stripped of what is now in 'opt', but as a result we get:\n\n```\nsage: show(sphere(), heyheyhey=35) # no problem\n```\n\nCould you raise an exception whenever `kwds` is not empty after `_process_viewing_options` reduced it? Sometimes you type `fgisize=4` and can look for a while before you notice what exactly is going wrong.\n\nThanks,\n\nNathann",
    "created_at": "2015-04-17T14:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253949",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Hellooooooooooo,

The problem is fixed indeed, but the way this `_process_viewing_options` function works it only stores in `opt` the function that are actually used later. It is well implemented: your original dictionary has been stripped of what is now in 'opt', but as a result we get:

```
sage: show(sphere(), heyheyhey=35) # no problem
```

Could you raise an exception whenever `kwds` is not empty after `_process_viewing_options` reduced it? Sometimes you type `fgisize=4` and can look for a while before you notice what exactly is going wrong.

Thanks,

Nathann



---

archive/issue_comments_253950.json:
```json
{
    "body": "<a id='comment:5'></a>\nshow shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.",
    "created_at": "2015-04-17T14:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253950",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
show shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.



---

archive/issue_comments_253951.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello,\n\n> show shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.\n\n\nIn the code there is a dictionary `kwds` which potentially contains parameters given by the user, yet it is never used.\n\nIt is easy to make everything work even when different viewers are available: if viewer X is used, send it all the arguments given by the user. If there is one that it does not understand, it will raise an exception.\n\nNathann",
    "created_at": "2015-04-17T14:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253951",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>
Hello,

> show shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.


In the code there is a dictionary `kwds` which potentially contains parameters given by the user, yet it is never used.

It is easy to make everything work even when different viewers are available: if viewer X is used, send it all the arguments given by the user. If there is one that it does not understand, it will raise an exception.

Nathann



---

archive/issue_comments_253952.json:
```json
{
    "body": "<a id='comment:7'></a>\nAs I said, that is not desirable here since we might change the viewer depending on UI capabilities.\n\nThere should be some framework for keyword options, especially for plottig options, that can deal with this. But right now we have nothing better than passing dictionaries around, so we can't easily validate if **some** viewer uses an argument or not.",
    "created_at": "2015-04-17T14:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253952",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
As I said, that is not desirable here since we might change the viewer depending on UI capabilities.

There should be some framework for keyword options, especially for plottig options, that can deal with this. But right now we have nothing better than passing dictionaries around, so we can't easily validate if **some** viewer uses an argument or not.



---

archive/issue_events_166975.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T14:35:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166975"
}
```



---

archive/issue_events_166976.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T14:35:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166976"
}
```



---

archive/issue_comments_253953.json:
```json
{
    "body": "<a id='comment:9'></a>\nHello,\n\n> As I said, that is not desirable here since we might change the viewer depending on UI capabilities.\n> \n> There should be some framework for keyword options, especially for plottig options, that can deal with this. But right now we have nothing better than passing dictionaries around, so we can't easily validate if **some** viewer uses an argument or not.\n\n\nWe do not have to validate it in this function. Here is an example\n\n```\ndef viewerA(some_option=4):\n    print \"Plot with some_option={}\".format(some_option)\n\ndef viewerB(some_other_option=4):\n    print \"Plot with some_other_option={}\".format(some_other_option)\n\ndef plot(viewer=\"A\",**args):\n    r\"\"\"\n    Plot an object with the selected viewer.\n\n    All other options are forwarded to the actual viewer. See their\n    documentation for more information.\n    \"\"\"\n    if viewer==\"A\":\n        viewerA(**args)\n    elif viewer==\"B\":\n        viewerB(**args)\n    else:\n        raise ValueError(\"viewer must be A or B\")\n```\n\nAs you can see no verification is done in the generic 'plot'. Then, everything works as expected:\n\n```\nsage: plot(\"A\",some_option=4)\nPlot with some_option=4\nsage: plot(\"B\",some_other_option=4)\nPlot with some_other_option=4\nsage: plot(\"A\",some_other_option=4)\n...\nTypeError: viewerA() got an unexpected keyword argument 'some_other_option'\n```\n\nNathann",
    "created_at": "2015-04-17T14:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253953",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>
Hello,

> As I said, that is not desirable here since we might change the viewer depending on UI capabilities.
> 
> There should be some framework for keyword options, especially for plottig options, that can deal with this. But right now we have nothing better than passing dictionaries around, so we can't easily validate if **some** viewer uses an argument or not.


We do not have to validate it in this function. Here is an example

```
def viewerA(some_option=4):
    print "Plot with some_option={}".format(some_option)

def viewerB(some_other_option=4):
    print "Plot with some_other_option={}".format(some_other_option)

def plot(viewer="A",**args):
    r"""
    Plot an object with the selected viewer.

    All other options are forwarded to the actual viewer. See their
    documentation for more information.
    """
    if viewer=="A":
        viewerA(**args)
    elif viewer=="B":
        viewerB(**args)
    else:
        raise ValueError("viewer must be A or B")
```

As you can see no verification is done in the generic 'plot'. Then, everything works as expected:

```
sage: plot("A",some_option=4)
Plot with some_option=4
sage: plot("B",some_other_option=4)
Plot with some_other_option=4
sage: plot("A",some_other_option=4)
...
TypeError: viewerA() got an unexpected keyword argument 'some_other_option'
```

Nathann



---

archive/issue_events_166977.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T14:41:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166977"
}
```



---

archive/issue_events_166978.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T14:41:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166978"
}
```



---

archive/issue_comments_253954.json:
```json
{
    "body": "<a id='comment:10'></a>\nAs I said, that is not desirable here since we might change the viewer (A/B) depending on UI capabilities.",
    "created_at": "2015-04-17T15:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253954",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
As I said, that is not desirable here since we might change the viewer (A/B) depending on UI capabilities.



---

archive/issue_events_166979.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T15:56:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166979"
}
```



---

archive/issue_events_166980.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-17T15:56:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166980"
}
```



---

archive/issue_comments_253955.json:
```json
{
    "body": "<a id='comment:12'></a>\n> As I said, that is not desirable here since we might change the viewer (A/B) depending on UI capabilities. \n\n\nHow is that a problem? As the endfunctions will accept a different set of parameters they will also raise exceptions for the parameters that they do not accept, won't they?",
    "created_at": "2015-04-17T16:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253955",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>
> As I said, that is not desirable here since we might change the viewer (A/B) depending on UI capabilities. 


How is that a problem? As the endfunctions will accept a different set of parameters they will also raise exceptions for the parameters that they do not accept, won't they?



---

archive/issue_events_166981.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T16:33:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166981"
}
```



---

archive/issue_events_166982.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-04-17T16:33:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166982"
}
```



---

archive/issue_comments_253956.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [vbraun](#comment%3A5):\n> show shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.\n\n\nThen there is something wrong. The point of the method `_process_viewing_options` is precisely to **select** the valid keywords and modify some of their values. The remaining keywords are just ignored (as Nathann already mentioned). And as far as I see, `_process_viewing_options` is one method in `Graphics3d` which is completely independent of the viewer. And it makes sense to have viewer specific options.\n\nAnd in `_save_image_png` (line 1367-1397), it seems to me that we have the very same kind of problem\n\n```\nopts = self._process_viewing_options(kwds)\nviewer = opts['viewer']\n    ...\n    render = self._rich_repr_tachyon(OutputImagePng, **kwds)\n    ...\n    scene = self._rich_repr_jmol(**kwds)\n    ...\n```",
    "created_at": "2015-04-17T17:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253956",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Replying to [vbraun](#comment%3A5):
> show shouldn't validate keyword arguments since it may have to fall back to another viewer. E.g if you don't have java then it'll fall back to tachyon and has to ignore jmol-specific arguments.


Then there is something wrong. The point of the method `_process_viewing_options` is precisely to **select** the valid keywords and modify some of their values. The remaining keywords are just ignored (as Nathann already mentioned). And as far as I see, `_process_viewing_options` is one method in `Graphics3d` which is completely independent of the viewer. And it makes sense to have viewer specific options.

And in `_save_image_png` (line 1367-1397), it seems to me that we have the very same kind of problem

```
opts = self._process_viewing_options(kwds)
viewer = opts['viewer']
    ...
    render = self._rich_repr_tachyon(OutputImagePng, **kwds)
    ...
    scene = self._rich_repr_jmol(**kwds)
    ...
```



---

archive/issue_comments_253957.json:
```json
{
    "body": "<a id='comment:15'></a>\nHi!  I don't have tons of time, but I have a few questions.\n1. It looks like what happened here is that there was some error somewhere in all the zillions of viewing changes that should have used the dictionary `opts` and instead used the dictionary `kwds`, but that the current branch fixes this oversight.  Is that correct?  If so, that sounds awesome.\n2. Is the comment above correct that `kwds` is incorrectly used and `opts` should be in another function too?  Or is that referring to some other issue?  In that event this should be \"needs work\", of course.\n3. Is the issue about unhandled keywords (possibly for sending to other viewer commands) a new regression in 6.6?  I get\n\n```\n\n$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.5, Release Date: 2015-02-17                         \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: show(sphere(), heyheyhey=35) \nsage: \n```\n  with no problems (also tested in 6.4.1) so I assume that, although I can see both sides of this argument (validation/not validating), maybe this isn't the place to have that discussion, and a new ticket is warranted for that.\n\nOkay, grading and writing an exam beckon and must be finished within 1.5 hours, so I hope this helps clarify things.  (?)",
    "created_at": "2015-04-17T17:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253957",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
Hi!  I don't have tons of time, but I have a few questions.
1. It looks like what happened here is that there was some error somewhere in all the zillions of viewing changes that should have used the dictionary `opts` and instead used the dictionary `kwds`, but that the current branch fixes this oversight.  Is that correct?  If so, that sounds awesome.
2. Is the comment above correct that `kwds` is incorrectly used and `opts` should be in another function too?  Or is that referring to some other issue?  In that event this should be "needs work", of course.
3. Is the issue about unhandled keywords (possibly for sending to other viewer commands) a new regression in 6.6?  I get

```

$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.5, Release Date: 2015-02-17                         │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: show(sphere(), heyheyhey=35) 
sage: 
```
  with no problems (also tested in 6.4.1) so I assume that, although I can see both sides of this argument (validation/not validating), maybe this isn't the place to have that discussion, and a new ticket is warranted for that.

Okay, grading and writing an exam beckon and must be finished within 1.5 hours, so I hope this helps clarify things.  (?)



---

archive/issue_comments_253958.json:
```json
{
    "body": "<a id='comment:16'></a>\nI agree that there are a couple of places where I used kwds instead of pts when refactoring. This is what this ticket is about.\n\nThe entire option handling for plots is IMHO badly done. Its quite complicated and independent from the actual plotting, so it should be factored out and tested separately. \n\nAs for `_process_viewing_options`, its not clear to me whether it is supposed to remove ALL valid keywords or only the ones for the particular viewer. I can read the code to see what it does right now, and you can probably build a bandaid around it to warn about unused options, but thats IMHO not a well-designed solution.",
    "created_at": "2015-04-17T17:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253958",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
I agree that there are a couple of places where I used kwds instead of pts when refactoring. This is what this ticket is about.

The entire option handling for plots is IMHO badly done. Its quite complicated and independent from the actual plotting, so it should be factored out and tested separately. 

As for `_process_viewing_options`, its not clear to me whether it is supposed to remove ALL valid keywords or only the ones for the particular viewer. I can read the code to see what it does right now, and you can probably build a bandaid around it to warn about unused options, but thats IMHO not a well-designed solution.



---

archive/issue_comments_253959.json:
```json
{
    "body": "**Changing commit** from \"[ff3731d4078f7db2caf2b62cb8cc45b777753ef9](https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9)\" to \"[c5eef589461ef5650c84fa237f2445573a52a4a4](https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4)\".",
    "created_at": "2015-04-17T17:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ff3731d4078f7db2caf2b62cb8cc45b777753ef9](https://github.com/sagemath/sagetrac-mirror/commit/ff3731d4078f7db2caf2b62cb8cc45b777753ef9)" to "[c5eef589461ef5650c84fa237f2445573a52a4a4](https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4)".



---

archive/issue_comments_253960.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4\">c5eef58</a></td><td><code>fix some more option handlin in 3d plots</code></td></tr></table>\n",
    "created_at": "2015-04-17T17:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4">c5eef58</a></td><td><code>fix some more option handlin in 3d plots</code></td></tr></table>




---

archive/issue_comments_253961.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491\">b156ca5</a></td><td><code>Use zoom instead of zoom*100</code></td></tr></table>\n",
    "created_at": "2015-04-17T18:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491">b156ca5</a></td><td><code>Use zoom instead of zoom*100</code></td></tr></table>




---

archive/issue_comments_253962.json:
```json
{
    "body": "**Changing commit** from \"[c5eef589461ef5650c84fa237f2445573a52a4a4](https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4)\" to \"[b156ca504d368899f3a50dd0ffffebac0839b491](https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491)\".",
    "created_at": "2015-04-17T18:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c5eef589461ef5650c84fa237f2445573a52a4a4](https://github.com/sagemath/sagetrac-mirror/commit/c5eef589461ef5650c84fa237f2445573a52a4a4)" to "[b156ca504d368899f3a50dd0ffffebac0839b491](https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491)".



---

archive/issue_comments_253963.json:
```json
{
    "body": "<a id='comment:19'></a>\nIs the zoom*100 no longer necessary?  It was fairly recently.",
    "created_at": "2015-04-17T18:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253963",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
Is the zoom*100 no longer necessary?  It was fairly recently.



---

archive/issue_comments_253964.json:
```json
{
    "body": "<a id='comment:20'></a>\n`zoom` is already passed in `**opts`. I just removed the wonky convention of passing 100*zoom instead of zoom in `export_jmol`. This is also the only place in Sage that calls `export_jmol`. And of course the zoom argument is not documented in `export_jmol`, so we don't even have to change the docs...",
    "created_at": "2015-04-18T01:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253964",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
`zoom` is already passed in `**opts`. I just removed the wonky convention of passing 100*zoom instead of zoom in `export_jmol`. This is also the only place in Sage that calls `export_jmol`. And of course the zoom argument is not documented in `export_jmol`, so we don't even have to change the docs...



---

archive/issue_events_166983.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-18T01:46:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166983"
}
```



---

archive/issue_events_166984.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-18T01:46:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166984"
}
```



---

archive/issue_comments_253965.json:
```json
{
    "body": "**Changing reviewer** from \"Volker Braun\" to \"Volker Braun, Karl-Dieter Crisman, Vincent Delecroix\".",
    "created_at": "2015-04-18T03:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253965",
    "user": "https://github.com/kcrisman"
}
```

**Changing reviewer** from "Volker Braun" to "Volker Braun, Karl-Dieter Crisman, Vincent Delecroix".



---

archive/issue_comments_253966.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes, I see now what you did.  I can't test it now, but I think the code pieces look fine as they are, and if Vincent or Eric were to finish the review that would be great.  See #18245 for the discussion about undesired options still working.",
    "created_at": "2015-04-18T03:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253966",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
Yes, I see now what you did.  I can't test it now, but I think the code pieces look fine as they are, and if Vincent or Eric were to finish the review that would be great.  See #18245 for the discussion about undesired options still working.



---

archive/issue_comments_253967.json:
```json
{
    "body": "**Changing author** from \"Eric Gourgoulhon\" to \"Eric Gourgoulhon, Volker Braun\".",
    "created_at": "2015-04-18T03:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253967",
    "user": "https://github.com/kcrisman"
}
```

**Changing author** from "Eric Gourgoulhon" to "Eric Gourgoulhon, Volker Braun".



---

archive/issue_comments_253968.json:
```json
{
    "body": "<a id='comment:23'></a>\nlooks good to me.",
    "created_at": "2015-04-18T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253968",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
looks good to me.



---

archive/issue_comments_253969.json:
```json
{
    "body": "<a id='comment:24'></a>\nThere is still an issue: the option `figsize` seems ineffective with jmol, while it was effective in Sage 6.5. For tachyon viewer, that's OK.",
    "created_at": "2015-04-18T10:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253969",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:24'></a>
There is still an issue: the option `figsize` seems ineffective with jmol, while it was effective in Sage 6.5. For tachyon viewer, that's OK.



---

archive/issue_comments_253970.json:
```json
{
    "body": "**Changing commit** from \"[b156ca504d368899f3a50dd0ffffebac0839b491](https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491)\" to \"[2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)\".",
    "created_at": "2015-04-18T12:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253970",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b156ca504d368899f3a50dd0ffffebac0839b491](https://github.com/sagemath/sagetrac-mirror/commit/b156ca504d368899f3a50dd0ffffebac0839b491)" to "[2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)".



---

archive/issue_comments_253971.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982\">2d5eea9</a></td><td><code>Correct the treatment of the option figsize for jmol</code></td></tr></table>\n",
    "created_at": "2015-04-18T12:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253971",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982">2d5eea9</a></td><td><code>Correct the treatment of the option figsize for jmol</code></td></tr></table>




---

archive/issue_comments_253972.json:
```json
{
    "body": "<a id='comment:26'></a>\nWith the above commit, the option `figsize` is effective again for jmol in Sage notebook. It is still ineffective in the IPython notebook though, but this is not a regression since in Sage 6.5, there were no jmol rendering at all in that notebook.",
    "created_at": "2015-04-18T12:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253972",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>
With the above commit, the option `figsize` is effective again for jmol in Sage notebook. It is still ineffective in the IPython notebook though, but this is not a regression since in Sage 6.5, there were no jmol rendering at all in that notebook.



---

archive/issue_events_166985.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T01:49:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166985"
}
```



---

archive/issue_events_166986.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T01:49:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166986"
}
```



---

archive/issue_comments_253973.json:
```json
{
    "body": "<a id='comment:27'></a>\nThats terrible, `JmolData.export_image` doesn't handle separate x/y figsize and then internally forces a square aspect ratio. Oh well...",
    "created_at": "2015-04-19T01:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253973",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
Thats terrible, `JmolData.export_image` doesn't handle separate x/y figsize and then internally forces a square aspect ratio. Oh well...



---

archive/issue_comments_253974.json:
```json
{
    "body": "**Changing branch** from \"[public/18238](https://github.com/sagemath/sagetrac-mirror/tree/public/18238)\" to \"[2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)\".",
    "created_at": "2015-04-19T11:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18238#issuecomment-253974",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/18238](https://github.com/sagemath/sagetrac-mirror/tree/public/18238)" to "[2d5eea9285b4447a9ecfe346acfdd6f7f82a0982](https://github.com/sagemath/sagetrac-mirror/commit/2d5eea9285b4447a9ecfe346acfdd6f7f82a0982)".



---

archive/issue_events_166987.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T11:05:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166987"
}
```



---

archive/issue_events_166988.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T11:05:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18238",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18238#event-166988"
}
```
