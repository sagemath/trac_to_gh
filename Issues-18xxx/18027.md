# Issue 18027: Move interrupts to Cython

archive/issues_017790.json:
```json
{
    "body": "This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)\n\nWe also clean up where possible. In particular:\n1. drop support for i386 CPUs without MMX.\n2. remove `set_sage_signal_handler_message()` which is no longer used and not needed since `sig_error()`.\n\n**CC:**  jpflori\n\n**Branch:** [6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Jean-Pierre Flori\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/18027\n\n",
    "closed_at": "2015-05-23T06:10:24Z",
    "created_at": "2015-03-21T12:21:48Z",
    "labels": [
        "component: cython",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "title": "Move interrupts to Cython",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/18027",
    "user": "https://github.com/jdemeyer"
}
```
This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)

We also clean up where possible. In particular:
1. drop support for i386 CPUs without MMX.
2. remove `set_sage_signal_handler_message()` which is no longer used and not needed since `sig_error()`.

**CC:**  jpflori

**Branch:** [6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Jean-Pierre Flori

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/18027





---

archive/issue_comments_247781.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/move_interrupts_to_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/move_interrupts_to_cython)",
    "created_at": "2015-03-21T12:23:01Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247781",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/move_interrupts_to_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/move_interrupts_to_cython)



---

archive/issue_comments_247782.json:
```json
{
    "body": "**Commit:** [26c3b8bb5553853161550a35e330860e740f1ecd](https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd)",
    "created_at": "2015-03-21T14:13:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247782",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [26c3b8bb5553853161550a35e330860e740f1ecd](https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd)



---

archive/issue_comments_247783.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff8b9fd18562be12020ce35477e05044374d5683\">ff8b9fd</a></td><td><code>Disable broken Cython caching</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b95de698683d59ab22f7ab10d0268d8e0e420a5\">6b95de6</a></td><td><code>Merge commit 'ce992d2ac5a68a4dd7328dc088f68007e4b5e4cd'; commit 'ff8b9fd18562be12020ce35477e05044374d5683' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9727fd0feddae2113f674d3365b141ec84fde9ed\">9727fd0</a></td><td><code>Add upstreamed Cython patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd\">26c3b8b</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-21T14:13:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff8b9fd18562be12020ce35477e05044374d5683">ff8b9fd</a></td><td><code>Disable broken Cython caching</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b95de698683d59ab22f7ab10d0268d8e0e420a5">6b95de6</a></td><td><code>Merge commit 'ce992d2ac5a68a4dd7328dc088f68007e4b5e4cd'; commit 'ff8b9fd18562be12020ce35477e05044374d5683' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9727fd0feddae2113f674d3365b141ec84fde9ed">9727fd0</a></td><td><code>Add upstreamed Cython patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd">26c3b8b</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247784.json:
```json
{
    "body": "**Changing dependencies** from \"#17851, #18007\" to \"#17851, #18007, #18030\".",
    "created_at": "2015-03-21T15:12:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247784",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#17851, #18007" to "#17851, #18007, #18030".



---

archive/issue_comments_247785.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9aadb701eaed57ca58515207a9022baaee043887\">9aadb70</a></td><td><code>Clean-up stdsage.pxi includes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5137c4b6e7c47067e535a91495c8bc8808f1f140\">5137c4b</a></td><td><code>Directly cimport PY_NEW</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd606a09ef3940546f3be84866121e3fcedfd194\">bd606a0</a></td><td><code>Merge commit 'ff8b9fd18562be12020ce35477e05044374d5683' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408\">2e3c1d9</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-21T16:50:43Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9aadb701eaed57ca58515207a9022baaee043887">9aadb70</a></td><td><code>Clean-up stdsage.pxi includes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5137c4b6e7c47067e535a91495c8bc8808f1f140">5137c4b</a></td><td><code>Directly cimport PY_NEW</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd606a09ef3940546f3be84866121e3fcedfd194">bd606a0</a></td><td><code>Merge commit 'ff8b9fd18562be12020ce35477e05044374d5683' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408">2e3c1d9</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247786.json:
```json
{
    "body": "**Changing commit** from \"[26c3b8bb5553853161550a35e330860e740f1ecd](https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd)\" to \"[2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408](https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408)\".",
    "created_at": "2015-03-21T16:50:43Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[26c3b8bb5553853161550a35e330860e740f1ecd](https://github.com/sagemath/sagetrac-mirror/commit/26c3b8bb5553853161550a35e330860e740f1ecd)" to "[2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408](https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408)".



---

archive/issue_comments_247787.json:
```json
{
    "body": "**Changing commit** from \"[2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408](https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408)\" to \"[5fd2ab5d6a612693d95c59adcc41a29926f742b8](https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8)\".",
    "created_at": "2015-03-21T19:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408](https://github.com/sagemath/sagetrac-mirror/commit/2e3c1d9d0f97bce616d5831f7b29a79ffc7b2408)" to "[5fd2ab5d6a612693d95c59adcc41a29926f742b8](https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8)".



---

archive/issue_comments_247788.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8\">5fd2ab5</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-21T19:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8">5fd2ab5</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247789.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Work in progress...\n+**Work in progress!**\n+\n+This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)\n``````\n",
    "created_at": "2015-03-21T20:41:07Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247789",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Work in progress...
+**Work in progress!**
+
+This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)
``````




---

archive/issue_comments_247790.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2015-03-21T20:41:07Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247790",
    "user": "https://github.com/jdemeyer"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_247791.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-**Work in progress!**\n+**Work in progress! **\n \n This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)\n``````\n",
    "created_at": "2015-03-21T20:41:27Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247791",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-**Work in progress!**
+**Work in progress! **
 
 This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)
``````




---

archive/issue_comments_247792.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65\">72c18cd</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-21T22:58:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65">72c18cd</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247793.json:
```json
{
    "body": "**Changing commit** from \"[5fd2ab5d6a612693d95c59adcc41a29926f742b8](https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8)\" to \"[72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65](https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65)\".",
    "created_at": "2015-03-21T22:58:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5fd2ab5d6a612693d95c59adcc41a29926f742b8](https://github.com/sagemath/sagetrac-mirror/commit/5fd2ab5d6a612693d95c59adcc41a29926f742b8)" to "[72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65](https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65)".



---

archive/issue_comments_247794.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd\">82ecada</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-22T11:08:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd">82ecada</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247795.json:
```json
{
    "body": "**Changing commit** from \"[72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65](https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65)\" to \"[82ecadac9a24d222e017a1064732a72d83e18edd](https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd)\".",
    "created_at": "2015-03-22T11:08:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65](https://github.com/sagemath/sagetrac-mirror/commit/72c18cddc5de380e52b8d3fe1ad7cdf1cf329b65)" to "[82ecadac9a24d222e017a1064732a72d83e18edd](https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd)".



---

archive/issue_comments_247796.json:
```json
{
    "body": "**Changing dependencies** from \"#17851, #18007, #18030\" to \"#17851, #18007, #18030, #18037\".",
    "created_at": "2015-03-22T22:47:39Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247796",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#17851, #18007, #18030" to "#17851, #18007, #18030, #18037".



---

archive/issue_comments_247797.json:
```json
{
    "body": "**Changing commit** from \"[82ecadac9a24d222e017a1064732a72d83e18edd](https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd)\" to \"[f5efcfc0484b66e55c788691cbfef86c05bb8285](https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285)\".",
    "created_at": "2015-03-23T12:20:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[82ecadac9a24d222e017a1064732a72d83e18edd](https://github.com/sagemath/sagetrac-mirror/commit/82ecadac9a24d222e017a1064732a72d83e18edd)" to "[f5efcfc0484b66e55c788691cbfef86c05bb8285](https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285)".



---

archive/issue_comments_247798.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8ed24a0fbbad472f7161f5d61706ad21edd0eba\">b8ed24a</a></td><td><code>Use alarm() instead of interrupt_after_delay()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43d96bc52dc52d15649cf1742daaa45ab791ba85\">43d96bc</a></td><td><code>Merge dependencies</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285\">f5efcfc</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-23T12:20:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8ed24a0fbbad472f7161f5d61706ad21edd0eba">b8ed24a</a></td><td><code>Use alarm() instead of interrupt_after_delay()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43d96bc52dc52d15649cf1742daaa45ab791ba85">43d96bc</a></td><td><code>Merge dependencies</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285">f5efcfc</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247799.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n **Work in progress! **\n \n This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)\n+\n+We also clean up where possible. In particular:\n+1. drop support for i386 CPUs without MMX.\n+2. remove `set_sage_signal_handler_message()` which is no longer used and not needed since `sig_error()`.\n``````\n",
    "created_at": "2015-03-23T20:27:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247799",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 **Work in progress! **
 
 This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)
+
+We also clean up where possible. In particular:
+1. drop support for i386 CPUs without MMX.
+2. remove `set_sage_signal_handler_message()` which is no longer used and not needed since `sig_error()`.
``````




---

archive/issue_comments_247800.json:
```json
{
    "body": "**Changing commit** from \"[f5efcfc0484b66e55c788691cbfef86c05bb8285](https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285)\" to \"[a1c8ae2b41585186b0859da8fa6b3931ccdf01ee](https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee)\".",
    "created_at": "2015-03-24T07:22:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f5efcfc0484b66e55c788691cbfef86c05bb8285](https://github.com/sagemath/sagetrac-mirror/commit/f5efcfc0484b66e55c788691cbfef86c05bb8285)" to "[a1c8ae2b41585186b0859da8fa6b3931ccdf01ee](https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee)".



---

archive/issue_comments_247801.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee\">a1c8ae2</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-03-24T07:22:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee">a1c8ae2</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_events_161696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-24T07:27:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161696"
}
```



---

archive/issue_comments_247802.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-**Work in progress! **\n-\n This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)\n \n We also clean up where possible. In particular:\n``````\n",
    "created_at": "2015-03-24T21:52:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247802",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-**Work in progress! **
-
 This needs two upstream patches, one which is accepted in master and [api_mangle.patch](https://github.com/cython/cython/pull/374)
 
 We also clean up where possible. In particular:
``````




---

archive/issue_comments_247803.json:
```json
{
    "body": "<a id='comment:16'></a>\n(NOTE: despite the red link in the Trac interface, the branch merges cleanly)",
    "created_at": "2015-03-27T11:25:48Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
(NOTE: despite the red link in the Trac interface, the branch merges cleanly)



---

archive/issue_comments_247804.json:
```json
{
    "body": "**Changing commit** from \"[a1c8ae2b41585186b0859da8fa6b3931ccdf01ee](https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee)\" to \"[468332c1763303337312354da81762c3c3296a95](https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95)\".",
    "created_at": "2015-04-15T08:33:22Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a1c8ae2b41585186b0859da8fa6b3931ccdf01ee](https://github.com/sagemath/sagetrac-mirror/commit/a1c8ae2b41585186b0859da8fa6b3931ccdf01ee)" to "[468332c1763303337312354da81762c3c3296a95](https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95)".



---

archive/issue_comments_247805.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba7c49627287610b702606a03ee38813b0233bb4\">ba7c496</a></td><td><code>Merge commit 'c98c51a982ee78488a5ff2b01ffe5dfb996ef969' into t/18030/ticket/18030</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d18d587f40faf6c67af66aee90130892282aab4\">8d18d58</a></td><td><code>Add includes to cryptominisat.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71c60acea7fccc3a159b5e8c852d7ef948e8cb04\">71c60ac</a></td><td><code>Merge commit 'e56aeb2c9a190813096a0f7db1683d3d5bc774d1' into t/18030/ticket/18030</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b55b277f371a0aba7683ea0614e2ec1d818d92b3\">b55b277</a></td><td><code>Add missing includes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00db4b2ce1e441578db6c939af4f399c2736ccd8\">00db4b2</a></td><td><code>Merge tag '6.7.beta0' into t/18030/ticket/18030</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95\">468332c</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-04-15T08:33:22Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba7c49627287610b702606a03ee38813b0233bb4">ba7c496</a></td><td><code>Merge commit 'c98c51a982ee78488a5ff2b01ffe5dfb996ef969' into t/18030/ticket/18030</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d18d587f40faf6c67af66aee90130892282aab4">8d18d58</a></td><td><code>Add includes to cryptominisat.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71c60acea7fccc3a159b5e8c852d7ef948e8cb04">71c60ac</a></td><td><code>Merge commit 'e56aeb2c9a190813096a0f7db1683d3d5bc774d1' into t/18030/ticket/18030</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b55b277f371a0aba7683ea0614e2ec1d818d92b3">b55b277</a></td><td><code>Add missing includes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00db4b2ce1e441578db6c939af4f399c2736ccd8">00db4b2</a></td><td><code>Merge tag '6.7.beta0' into t/18030/ticket/18030</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95">468332c</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247806.json:
```json
{
    "body": "**Changing dependencies** from \"#17851, #18007, #18030, #18037\" to \"#18030\".",
    "created_at": "2015-04-15T08:43:00Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247806",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#17851, #18007, #18030, #18037" to "#18030".



---

archive/issue_comments_247807.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45\">bd877b8</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-04-22T10:13:09Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45">bd877b8</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247808.json:
```json
{
    "body": "**Changing commit** from \"[468332c1763303337312354da81762c3c3296a95](https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95)\" to \"[bd877b899103fa693266a1a55140d1d5454a2d45](https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45)\".",
    "created_at": "2015-04-22T10:13:09Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[468332c1763303337312354da81762c3c3296a95](https://github.com/sagemath/sagetrac-mirror/commit/468332c1763303337312354da81762c3c3296a95)" to "[bd877b899103fa693266a1a55140d1d5454a2d45](https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45)".



---

archive/issue_comments_247809.json:
```json
{
    "body": "<a id='comment:21'></a>\nRebased to 6.7.beta2.",
    "created_at": "2015-04-22T10:17:48Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247809",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Rebased to 6.7.beta2.



---

archive/issue_comments_247810.json:
```json
{
    "body": "<a id='comment:22'></a>\nI'm simplifying the changes to `src/module_list.py` and `src/setup.py`",
    "created_at": "2015-04-22T10:22:45Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247810",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
I'm simplifying the changes to `src/module_list.py` and `src/setup.py`



---

archive/issue_events_161697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T10:22:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161697"
}
```



---

archive/issue_events_161698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T10:22:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161698"
}
```



---

archive/issue_comments_247811.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e\">68c43af</a></td><td><code>Move interrupts to Cython</code></td></tr></table>\n",
    "created_at": "2015-04-22T10:39:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e">68c43af</a></td><td><code>Move interrupts to Cython</code></td></tr></table>




---

archive/issue_comments_247812.json:
```json
{
    "body": "**Changing commit** from \"[bd877b899103fa693266a1a55140d1d5454a2d45](https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45)\" to \"[68c43afcf922bb5cd776623a0222d289b4d0223e](https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e)\".",
    "created_at": "2015-04-22T10:39:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bd877b899103fa693266a1a55140d1d5454a2d45](https://github.com/sagemath/sagetrac-mirror/commit/bd877b899103fa693266a1a55140d1d5454a2d45)" to "[68c43afcf922bb5cd776623a0222d289b4d0223e](https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e)".



---

archive/issue_events_161699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T10:40:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161699"
}
```



---

archive/issue_events_161700.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T10:40:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161700"
}
```



---

archive/issue_comments_247813.json:
```json
{
    "body": "**Changing dependencies** from \"#18030\" to \"\".",
    "created_at": "2015-04-22T10:40:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247813",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#18030" to "".



---

archive/issue_comments_247814.json:
```json
{
    "body": "**Changing commit** from \"[68c43afcf922bb5cd776623a0222d289b4d0223e](https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e)\" to \"[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)\".",
    "created_at": "2015-04-28T06:04:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[68c43afcf922bb5cd776623a0222d289b4d0223e](https://github.com/sagemath/sagetrac-mirror/commit/68c43afcf922bb5cd776623a0222d289b4d0223e)" to "[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)".



---

archive/issue_comments_247815.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d\">6d738d6</a></td><td><code>Merge tag '6.7.beta3' into HEAD</code></td></tr></table>\n",
    "created_at": "2015-04-28T06:04:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d">6d738d6</a></td><td><code>Merge tag '6.7.beta3' into HEAD</code></td></tr></table>




---

archive/issue_comments_247816.json:
```json
{
    "body": "<a id='comment:27'></a>\nDo you have any other reason to remove x86 CPUs without MMX support execpt that it is very old?\nI guess some other parts of sage might not work on such CPU anyway, do you have any hint?\nI at least remember that our ATLAS base configuration requires an FPU or even MMX.",
    "created_at": "2015-05-18T21:01:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247816",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:27'></a>
Do you have any other reason to remove x86 CPUs without MMX support execpt that it is very old?
I guess some other parts of sage might not work on such CPU anyway, do you have any hint?
I at least remember that our ATLAS base configuration requires an FPU or even MMX.



---

archive/issue_comments_247817.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jpflori](#comment%3A27):\n> Do you have any other reason to remove x86 CPUs without MMX support execpt that it is very old?\n\nThe reason is to simplify the code.\n\n> I guess some other parts of sage might not work on such CPU anyway, do you have any hint?\n\nNo idea...",
    "created_at": "2015-05-18T21:27:58Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247817",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [jpflori](#comment%3A27):
> Do you have any other reason to remove x86 CPUs without MMX support execpt that it is very old?

The reason is to simplify the code.

> I guess some other parts of sage might not work on such CPU anyway, do you have any hint?

No idea...



---

archive/issue_comments_247818.json:
```json
{
    "body": "<a id='comment:29'></a>\nI think it's dangerous to use stuff from the\n\n```\n#include \"build/cythonized/sage/ext/interrupt/interrupt_api.h\"\n```\nOn top of that, it occurs in a file meant to be included itsef as soon as one wants to use signal related stuff.",
    "created_at": "2015-05-22T13:01:01Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247818",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>
I think it's dangerous to use stuff from the

```
#include "build/cythonized/sage/ext/interrupt/interrupt_api.h"
```
On top of that, it occurs in a file meant to be included itsef as soon as one wants to use signal related stuff.



---

archive/issue_comments_247819.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [jpflori](#comment%3A29):\n> I think it's dangerous to use stuff from the\n> \n> ```\n> #include \"build/cythonized/sage/ext/interrupt/interrupt_api.h\"\n> ```\n\nWhy dangerous? These `_api.h` files are a standard and documented Cython mechanism to use Cython functions from C code: [http://docs.cython.org/src/userguide/external_C_code.html#c-api-declarations](http://docs.cython.org/src/userguide/external_C_code.html#c-api-declarations)",
    "created_at": "2015-05-22T15:04:26Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247819",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [jpflori](#comment%3A29):
> I think it's dangerous to use stuff from the
> 
> ```
> #include "build/cythonized/sage/ext/interrupt/interrupt_api.h"
> ```

Why dangerous? These `_api.h` files are a standard and documented Cython mechanism to use Cython functions from C code: [http://docs.cython.org/src/userguide/external_C_code.html#c-api-declarations](http://docs.cython.org/src/userguide/external_C_code.html#c-api-declarations)



---

archive/issue_comments_247820.json:
```json
{
    "body": "<a id='comment:31'></a>\nTo explain the usage of `interrupt_api.h` better: the global variable `_signals` (and some functions like `_sig_on_interrupt_received`) which used to be implemented in `c_lib` are now implemented in Cython. For technical reasons, `sig_on()` MUST be a macro and therefore it can only reasonably be implemented in a `.h` file. But `sig_on()` needs access to `_signals`. So we need a mechanism to access the Cython global variable `_signals` in the C header `macros.h`. We use the standard `cdef api` mechanism for this.",
    "created_at": "2015-05-22T15:22:16Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247820",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
To explain the usage of `interrupt_api.h` better: the global variable `_signals` (and some functions like `_sig_on_interrupt_received`) which used to be implemented in `c_lib` are now implemented in Cython. For technical reasons, `sig_on()` MUST be a macro and therefore it can only reasonably be implemented in a `.h` file. But `sig_on()` needs access to `_signals`. So we need a mechanism to access the Cython global variable `_signals` in the C header `macros.h`. We use the standard `cdef api` mechanism for this.



---

archive/issue_comments_247821.json:
```json
{
    "body": "<a id='comment:32'></a>\nMy only issue is the place where this header lives: `build/`.\nWhat if I decide to empty this directory and then recompile a file including `interrupts.pxi`?",
    "created_at": "2015-05-22T15:24:05Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247821",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:32'></a>
My only issue is the place where this header lives: `build/`.
What if I decide to empty this directory and then recompile a file including `interrupts.pxi`?



---

archive/issue_comments_247822.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jpflori](#comment%3A32):\n> My only issue is the place where this header lives: `build/`.\n> What if I decide to empty this directory and then recompile a file including `interrupts.pxi`?\n\n\nCython generates the file `interrupt_api.h`. If you empty the `build` directory, the file will be regenerated just like all the other files in the `build` directory.",
    "created_at": "2015-05-22T15:59:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247822",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [jpflori](#comment%3A32):
> My only issue is the place where this header lives: `build/`.
> What if I decide to empty this directory and then recompile a file including `interrupts.pxi`?


Cython generates the file `interrupt_api.h`. If you empty the `build` directory, the file will be regenerated just like all the other files in the `build` directory.



---

archive/issue_comments_247823.json:
```json
{
    "body": "<a id='comment:34'></a>\nAh, in that case it is fine.\nI for no reason though it was only generated when interrupt.pyx was cythonized.",
    "created_at": "2015-05-22T16:02:53Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247823",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:34'></a>
Ah, in that case it is fine.
I for no reason though it was only generated when interrupt.pyx was cythonized.



---

archive/issue_comments_247824.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jpflori](#comment%3A34):\n> I for no reason though it was only generated when interrupt.pyx was cythonized.\n\nYou are right, it *is* only generated when `interrupt.pyx` is Cythonized.\n\nThat's not a problem however: if you delete the `build` directory, then `interrupt.pyx` will be Cythonized and the file will be generated.",
    "created_at": "2015-05-22T16:49:58Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247824",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [jpflori](#comment%3A34):
> I for no reason though it was only generated when interrupt.pyx was cythonized.

You are right, it *is* only generated when `interrupt.pyx` is Cythonized.

That's not a problem however: if you delete the `build` directory, then `interrupt.pyx` will be Cythonized and the file will be generated.



---

archive/issue_comments_247825.json:
```json
{
    "body": "<a id='comment:36'></a>\nYes indeed, and I don't like this Cython behavior.\nYou have to keep the build directory alive to avoid rebuilding everything.\n\nAnyway, I'll leave with  it for this ticket.",
    "created_at": "2015-05-22T19:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247825",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:36'></a>
Yes indeed, and I don't like this Cython behavior.
You have to keep the build directory alive to avoid rebuilding everything.

Anyway, I'll leave with  it for this ticket.



---

archive/issue_events_161701.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2015-05-22T19:17:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161701"
}
```



---

archive/issue_events_161702.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2015-05-22T19:17:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161702"
}
```



---

archive/issue_comments_247826.json:
```json
{
    "body": "**Reviewer:** Jean-Pierre Flori",
    "created_at": "2015-05-22T19:17:08Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247826",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Reviewer:** Jean-Pierre Flori



---

archive/issue_events_161703.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-23T06:10:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161703"
}
```



---

archive/issue_events_161704.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-23T06:10:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18027#event-161704"
}
```



---

archive/issue_comments_247827.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/move_interrupts_to_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/move_interrupts_to_cython)\" to \"[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)\".",
    "created_at": "2015-05-23T06:10:24Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247827",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/move_interrupts_to_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/move_interrupts_to_cython)" to "[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)".



---

archive/issue_comments_247828.json:
```json
{
    "body": "**Changing commit** from \"[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)\" to \"\".",
    "created_at": "2015-05-23T08:52:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247828",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[6d738d6e869b869ccaf68a5db6a166542647dd7d](https://github.com/sagemath/sagetrac-mirror/commit/6d738d6e869b869ccaf68a5db6a166542647dd7d)" to "".



---

archive/issue_comments_247829.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [jpflori](#comment%3A36):\n> Yes indeed, and I don't like this Cython behavior.\n> You have to keep the build directory alive to avoid rebuilding everything.\n\nI really don't understand your problem.\n\nDeleting the `src/build` directory in Sage is the same as `make clean` in a typical software package. And when you do `make clean`, you have to rebuild everything if you do `make` later.\n\nAnd when you *don't* delete the `build` directory, Cython+distutils has proper dependency checking: only needed files are rebuilt.",
    "created_at": "2015-05-23T08:52:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247829",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Replying to [jpflori](#comment%3A36):
> Yes indeed, and I don't like this Cython behavior.
> You have to keep the build directory alive to avoid rebuilding everything.

I really don't understand your problem.

Deleting the `src/build` directory in Sage is the same as `make clean` in a typical software package. And when you do `make clean`, you have to rebuild everything if you do `make` later.

And when you *don't* delete the `build` directory, Cython+distutils has proper dependency checking: only needed files are rebuilt.



---

archive/issue_comments_247830.json:
```json
{
    "body": "<a id='comment:40'></a>\nI'll surely open a follow up ticket about that `build` directory question once I have figured out to deal with it. I am not completely sure you have totally broken all \"global\" sage install and whether or not making those install carry at least a fragment of the build folder will fix it properly.\nWho else needs to have their build folder kept?\nIt joins a basket of issues that I have duct-taped in sage-on-gentoo for years to have doctest and spyx files to work properly. If I had spent more time on fixing the installation of sage headers and various auxiliary files rather than the duct tape we wouldn't be there today.\n\nThat's a sample\n\n```\n    1 item had failures:\n       1 of   4 in sage.doctest.tests.sig_on\n        [2 tests, 1 failure, ...]\n    ----------------------------------------------------------------------\n    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed\n    ----------------------------------------------------------------------\n    ...\n    1\nGot:\n    Running doctests with ID 2015-05-24-22-01-48-66399ec6.\n    Doctesting 1 file.\n    sage -t --warn-long 0.0 sig_on.rst\n    **********************************************************************\n    File \"sig_on.rst\", line 3, in sage.doctest.tests.sig_on\n    Failed example:\n        cython('sig_on()')\n    Exception raised:\n        Traceback (most recent call last):\n          File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n            self.compile_and_execute(example, compiler, test.globs)\n          File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n            exec(compiled, globs)\n          File \"<doctest sage.doctest.tests.sig_on[0]>\", line 1, in <module>\n            cython('sig_on()')\n          File \"sage/misc/cython_c.pyx\", line 63, in sage.misc.cython_c.cython (build/cythonized/sage/misc/cython_c.c:949)\n            sage.server.support.cython_import_all(tmpfile, globals(),\n          File \"/usr/lib64/python2.7/site-packages/sage/server/support.py\", line 85, in cython_import_all\n            create_local_c_file=create_local_c_file)\n          File \"/usr/lib64/python2.7/site-packages/sage/server/support.py\", line 62, in cython_import\n            **kwds)\n          File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 519, in cython\n            raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n        RuntimeError: Error compiling /home/fbissey/.sage/temp/QCD-nzi3/10231/tmp_FdPxlK.spyx:\n        running build\n        running build_ext\n        building '_home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0' extension\n        creating build\n        creating build/temp.linux-x86_64-2.7\n        x86_64-pc-linux-gnu-gcc -pthread -fPIC -I/usr/include/csage -I/usr/include -I/usr/include/python2.7 -I/usr/lib/python/site-packages/numpy/core/include -I/usr/share/sage/src/sage/ext -I/usr/share/sage/src -I/usr/share/sage/src/sage/gsl -I/home/fbissey/.sage/temp/QCD-nzi3/10231 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.c -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.o -w -O2\n    <BLANKLINE>\n        In file included from _home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.c:248:0:\n        /usr/share/sage/src/sage/ext/interrupt/pxi.h:7:63: fatal error: build/cythonized/sage/ext/interrupt/interrupt_api.h: No such file or directory\n         #include \"build/cythonized/sage/ext/interrupt/interrupt_api.h\"\n                                                                       ^\n        compilation terminated.\n        error: command 'x86_64-pc-linux-gnu-gcc' failed with exit status 1\n    <BLANKLINE>\n    **********************************************************************\n    1 item had failures:\n       1 of   4 in sage.doctest.tests.sig_on\n        [2 tests, 1 failure, 0.86 s]\n    ----------------------------------------------------------------------\n    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.9 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.9 seconds\n    1\n**********************************************************************\n1 item had failures:\n   1 of  45 in sage.doctest.test\n    [44 tests, 1 failure, 98.40 s]\n----------------------------------------------------------------------\nsage -t --long /usr/share/sage/src/sage/doctest/test.py  # 1 doctest failed\n```",
    "created_at": "2015-05-24T11:07:53Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247830",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>
I'll surely open a follow up ticket about that `build` directory question once I have figured out to deal with it. I am not completely sure you have totally broken all "global" sage install and whether or not making those install carry at least a fragment of the build folder will fix it properly.
Who else needs to have their build folder kept?
It joins a basket of issues that I have duct-taped in sage-on-gentoo for years to have doctest and spyx files to work properly. If I had spent more time on fixing the installation of sage headers and various auxiliary files rather than the duct tape we wouldn't be there today.

That's a sample

```
    1 item had failures:
       1 of   4 in sage.doctest.tests.sig_on
        [2 tests, 1 failure, ...]
    ----------------------------------------------------------------------
    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed
    ----------------------------------------------------------------------
    ...
    1
Got:
    Running doctests with ID 2015-05-24-22-01-48-66399ec6.
    Doctesting 1 file.
    sage -t --warn-long 0.0 sig_on.rst
    **********************************************************************
    File "sig_on.rst", line 3, in sage.doctest.tests.sig_on
    Failed example:
        cython('sig_on()')
    Exception raised:
        Traceback (most recent call last):
          File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
            self.compile_and_execute(example, compiler, test.globs)
          File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
            exec(compiled, globs)
          File "<doctest sage.doctest.tests.sig_on[0]>", line 1, in <module>
            cython('sig_on()')
          File "sage/misc/cython_c.pyx", line 63, in sage.misc.cython_c.cython (build/cythonized/sage/misc/cython_c.c:949)
            sage.server.support.cython_import_all(tmpfile, globals(),
          File "/usr/lib64/python2.7/site-packages/sage/server/support.py", line 85, in cython_import_all
            create_local_c_file=create_local_c_file)
          File "/usr/lib64/python2.7/site-packages/sage/server/support.py", line 62, in cython_import
            **kwds)
          File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 519, in cython
            raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
        RuntimeError: Error compiling /home/fbissey/.sage/temp/QCD-nzi3/10231/tmp_FdPxlK.spyx:
        running build
        running build_ext
        building '_home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0' extension
        creating build
        creating build/temp.linux-x86_64-2.7
        x86_64-pc-linux-gnu-gcc -pthread -fPIC -I/usr/include/csage -I/usr/include -I/usr/include/python2.7 -I/usr/lib/python/site-packages/numpy/core/include -I/usr/share/sage/src/sage/ext -I/usr/share/sage/src -I/usr/share/sage/src/sage/gsl -I/home/fbissey/.sage/temp/QCD-nzi3/10231 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.c -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.o -w -O2
    <BLANKLINE>
        In file included from _home_fbissey__sage_temp_QCD_nzi3_10231_tmp_FdPxlK_spyx_0.c:248:0:
        /usr/share/sage/src/sage/ext/interrupt/pxi.h:7:63: fatal error: build/cythonized/sage/ext/interrupt/interrupt_api.h: No such file or directory
         #include "build/cythonized/sage/ext/interrupt/interrupt_api.h"
                                                                       ^
        compilation terminated.
        error: command 'x86_64-pc-linux-gnu-gcc' failed with exit status 1
    <BLANKLINE>
    **********************************************************************
    1 item had failures:
       1 of   4 in sage.doctest.tests.sig_on
        [2 tests, 1 failure, 0.86 s]
    ----------------------------------------------------------------------
    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed
    ----------------------------------------------------------------------
    Total time for all tests: 0.9 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.9 seconds
    1
**********************************************************************
1 item had failures:
   1 of  45 in sage.doctest.test
    [44 tests, 1 failure, 98.40 s]
----------------------------------------------------------------------
sage -t --long /usr/share/sage/src/sage/doctest/test.py  # 1 doctest failed
```



---

archive/issue_comments_247831.json:
```json
{
    "body": "<a id='comment:41'></a>\nI understand your problem now: you need the `build` folder for `cython()` to work properly (why didn't you just tell me this?)",
    "created_at": "2015-05-24T13:10:06Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247831",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
I understand your problem now: you need the `build` folder for `cython()` to work properly (why didn't you just tell me this?)



---

archive/issue_comments_247832.json:
```json
{
    "body": "<a id='comment:42'></a>\nTo be honest, while I saw the ticket yesterday and suspected problems, I only found the extent a few hours ago. I cooled off a little bit before commenting, possibly not enough.",
    "created_at": "2015-05-24T13:45:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247832",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
To be honest, while I saw the ticket yesterday and suspected problems, I only found the extent a few hours ago. I cooled off a little bit before commenting, possibly not enough.



---

archive/issue_comments_247833.json:
```json
{
    "body": "<a id='comment:43'></a>\nBut it is a symptom for a larger problem sage keep a lot of stuff in the sources that should really be installed. Headers and a few c/cpp files here and there. I had that conversation with Burcin a long time ago. I have been going on with shipping a copy of the sources in sage-on-gentoo and I probably could try to ship that single file but it should be just a stop gap to better solution.",
    "created_at": "2015-05-24T21:09:18Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247833",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
But it is a symptom for a larger problem sage keep a lot of stuff in the sources that should really be installed. Headers and a few c/cpp files here and there. I had that conversation with Burcin a long time ago. I have been going on with shipping a copy of the sources in sage-on-gentoo and I probably could try to ship that single file but it should be just a stop gap to better solution.



---

archive/issue_comments_247834.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [fbissey](#comment%3A43):\n> But it is a symptom for a larger problem sage keep a lot of stuff in the sources that should really be installed. Headers and a few c/cpp files here and there.\n\n\nAnd `.pxd`/`.pxi` files also I guess...\n\nIt wouldn't be too hard to install all needed files, it's just that somebody has to do it.",
    "created_at": "2015-05-24T21:37:47Z",
    "issue": "https://github.com/sagemath/sage/issues/18027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18027#issuecomment-247834",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>
Replying to [fbissey](#comment%3A43):
> But it is a symptom for a larger problem sage keep a lot of stuff in the sources that should really be installed. Headers and a few c/cpp files here and there.


And `.pxd`/`.pxi` files also I guess...

It wouldn't be too hard to install all needed files, it's just that somebody has to do it.
