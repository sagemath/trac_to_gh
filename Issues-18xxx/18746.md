# Issue 18746: Cutwidth of a graph

archive/issues_018509.json:
```json
{
    "assignees": [],
    "body": "This ticket implements a first method for computing the cutwidth of (small) graphs.\nIn an other ticket, I will add a MILP formulation for comparison purpose.\n\nCC:  @nathanncohen\n\nBranch/Commit: **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**\n\nReviewer: **Nathann Cohen**\n\nAuthor: **David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18746_\n\n",
    "closed_at": "2015-06-30T23:12:26Z",
    "created_at": "2015-06-20T08:18:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Cutwidth of a graph",
    "type": "issue",
    "updated_at": "2015-06-30T23:12:26Z",
    "url": "https://github.com/sagemath/sage/issues/18746",
    "user": "https://github.com/dcoudert"
}
```
This ticket implements a first method for computing the cutwidth of (small) graphs.
In an other ticket, I will add a MILP formulation for comparison purpose.

CC:  @nathanncohen

Branch/Commit: **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**

Reviewer: **Nathann Cohen**

Author: **David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/18746_





---

archive/issue_events_263910.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-20T08:18:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263910"
}
```



---

archive/issue_events_263911.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-20T08:18:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263911"
}
```



---

archive/issue_events_263912.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-20T08:18:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263912"
}
```



---

archive/issue_events_263913.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-20T08:18:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263913"
}
```



---

archive/issue_comments_261518.json:
```json
{
    "body": "Branch: **[public/18746](https://github.com/sagemath/sagetrac-mirror/tree/public/18746)**",
    "created_at": "2015-06-20T10:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261518",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/18746](https://github.com/sagemath/sagetrac-mirror/tree/public/18746)**



---

archive/issue_comments_261519.json:
```json
{
    "body": "Commit: **[`165c0b6`](https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229)**",
    "created_at": "2015-06-20T10:25:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261519",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`165c0b6`](https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229)**



---

archive/issue_comments_261520.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a0cfa1211752cd795185e44b3d5233b03d888a5\"><code>0a0cfa1</code></a></td><td><code>trac #18746: preparation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5d9faa621cfdbf14c5f2122f1e6d071303f525\"><code>bf5d9fa</code></a></td><td><code>trac #18746: add int_to_vertices to fast digraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06007fcc56a7df4aeb8305e85144405da3260db6\"><code>06007fc</code></a></td><td><code>trac #18746: creation of the module and doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/507a3bc36cf47387ff0f45f37c23bc4a149d4183\"><code>507a3bc</code></a></td><td><code>trac #18746: add method for measuring the width of a layout</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbad95aafc4f99deca7a9081eaf1a6590651dbcd\"><code>cbad95a</code></a></td><td><code>trac #18746: Dynamic programming algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/542e3476955c9d6c10a09516161c7ce6c9b32f35\"><code>542e347</code></a></td><td><code>trac #18746: front end method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/189bde80e6435dc9645d960ec1e4b16b0860992a\"><code>189bde8</code></a></td><td><code>trac #18746: typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229\"><code>165c0b6</code></a></td><td><code>trac #18746: various minor issues</code></td></tr></table>\n",
    "created_at": "2015-06-20T10:25:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261520",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a0cfa1211752cd795185e44b3d5233b03d888a5"><code>0a0cfa1</code></a></td><td><code>trac #18746: preparation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5d9faa621cfdbf14c5f2122f1e6d071303f525"><code>bf5d9fa</code></a></td><td><code>trac #18746: add int_to_vertices to fast digraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06007fcc56a7df4aeb8305e85144405da3260db6"><code>06007fc</code></a></td><td><code>trac #18746: creation of the module and doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/507a3bc36cf47387ff0f45f37c23bc4a149d4183"><code>507a3bc</code></a></td><td><code>trac #18746: add method for measuring the width of a layout</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbad95aafc4f99deca7a9081eaf1a6590651dbcd"><code>cbad95a</code></a></td><td><code>trac #18746: Dynamic programming algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/542e3476955c9d6c10a09516161c7ce6c9b32f35"><code>542e347</code></a></td><td><code>trac #18746: front end method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/189bde80e6435dc9645d960ec1e4b16b0860992a"><code>189bde8</code></a></td><td><code>trac #18746: typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229"><code>165c0b6</code></a></td><td><code>trac #18746: various minor issues</code></td></tr></table>




---

archive/issue_comments_261521.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWe could certainly share more code with the `vertex_separation_exp` methods. To do so, we should change the type `int8_t` used in `vertex_separation_exp` to `uint8_t` which is needed for cutwidth since the numbers are larger than for vertex separation. Let me know if I should do such change (and certainly add a .pxd file).",
    "created_at": "2015-06-20T10:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261521",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

We could certainly share more code with the `vertex_separation_exp` methods. To do so, we should change the type `int8_t` used in `vertex_separation_exp` to `uint8_t` which is needed for cutwidth since the numbers are larger than for vertex separation. Let me know if I should do such change (and certainly add a .pxd file).



---

archive/issue_events_263914.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-20T10:32:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263914"
}
```



---

archive/issue_comments_261522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n This ticket implements a first method for computing the cutwidth of (small) graphs.\n+In an other ticket, I will add a MILP formulation for comparison purpose.\n``````\n",
    "created_at": "2015-06-20T10:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261522",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
 This ticket implements a first method for computing the cutwidth of (small) graphs.
+In an other ticket, I will add a MILP formulation for comparison purpose.
``````




---

archive/issue_comments_261523.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHelloooooooo,\n\nSeveral remarks:\n\n- You can rewrite `dict( (u,i) for i,u in enumerate(L) )` as\n  ` {u:i for i,v in enumerate(L) `\n\n- In\n  ` cpt += popcount32( (Sbar&g.graph[i]) * ((S>>i)&1) ) `\n  Instead of multiplying by `((S>>i)&1)`, which is 0 or 1, you can do\n  ` cpt += popcount32( (Sbar&g.graph[i]) & (-((S>>i)&1)) ) `\n  given that 0 in binary is '0...0' and that -1 is '1.....1'.\n\n  This being said, there may be time to save by not re-computing the cost from\n  scratch (considering all n vertices) but by computing only the difference from\n  the previous cost, caused by the addition of the last vertex in the ordering.\n\n- About\n\n  ```\n  +    This method differs from method\n  +    `sage.graphs.graph_decompositions.vertex_separation.exists` by a single\n  +    line. We can certainly combine codes.\n  ```\n  Something with templates, like it is done in #18395?\n\n- About\n\n  ```\n  +\n  +    This is a copy/paste of method\n  +    `sage.graphs.graph_decompositions.vertex_separation.find_order` and so we\n  +    can certainly directly import it.\n  ```\n  If all you need is to change `int8_t` into `uint8_t` `vertex_separation_exp` then yes of course!\n\nHave fuuuuuuun,\n\nNathann",
    "created_at": "2015-06-26T10:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261523",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

Helloooooooo,

Several remarks:

- You can rewrite `dict( (u,i) for i,u in enumerate(L) )` as
  ` {u:i for i,v in enumerate(L) `

- In
  ` cpt += popcount32( (Sbar&g.graph[i]) * ((S>>i)&1) ) `
  Instead of multiplying by `((S>>i)&1)`, which is 0 or 1, you can do
  ` cpt += popcount32( (Sbar&g.graph[i]) & (-((S>>i)&1)) ) `
  given that 0 in binary is '0...0' and that -1 is '1.....1'.

  This being said, there may be time to save by not re-computing the cost from
  scratch (considering all n vertices) but by computing only the difference from
  the previous cost, caused by the addition of the last vertex in the ordering.

- About

  ```
  +    This method differs from method
  +    `sage.graphs.graph_decompositions.vertex_separation.exists` by a single
  +    line. We can certainly combine codes.
  ```
  Something with templates, like it is done in #18395?

- About

  ```
  +
  +    This is a copy/paste of method
  +    `sage.graphs.graph_decompositions.vertex_separation.find_order` and so we
  +    can certainly directly import it.
  ```
  If all you need is to change `int8_t` into `uint8_t` `vertex_separation_exp` then yes of course!

Have fuuuuuuun,

Nathann



---

archive/issue_comments_261524.json:
```json
{
    "body": "Changed commit from **[`165c0b6`](https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229)** to **[`d92f30f`](https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299)**",
    "created_at": "2015-06-27T12:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261524",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`165c0b6`](https://github.com/sagemath/sagetrac-mirror/commit/165c0b64eeb569161e862603535e2ef2592c2229)** to **[`d92f30f`](https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299)**



---

archive/issue_comments_261525.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a08116e9e300c637f10fb62c17b4f8373922b00\"><code>5a08116</code></a></td><td><code>trac #18746: Merged with 6.8.beta6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27d7342e7bbba4fc0dc10884c2d884d44e7e6fcb\"><code>27d7342</code></a></td><td><code>trac #18746: simple corrections</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ae616a468525f20d35d3ba409c522c8a5d49a09\"><code>4ae616a</code></a></td><td><code>trac #18746: change int8_t to uint8_t in vertex_separation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9aa0943dec0e7687bce8ace88837f5edcbbddb22\"><code>9aa0943</code></a></td><td><code>trac #18746: add missing sig_off to solve test errors -- weird</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299\"><code>d92f30f</code></a></td><td><code>trac #18746: use method find_order from vertex_separation</code></td></tr></table>\n",
    "created_at": "2015-06-27T12:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261525",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a08116e9e300c637f10fb62c17b4f8373922b00"><code>5a08116</code></a></td><td><code>trac #18746: Merged with 6.8.beta6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27d7342e7bbba4fc0dc10884c2d884d44e7e6fcb"><code>27d7342</code></a></td><td><code>trac #18746: simple corrections</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ae616a468525f20d35d3ba409c522c8a5d49a09"><code>4ae616a</code></a></td><td><code>trac #18746: change int8_t to uint8_t in vertex_separation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9aa0943dec0e7687bce8ace88837f5edcbbddb22"><code>9aa0943</code></a></td><td><code>trac #18746: add missing sig_off to solve test errors -- weird</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299"><code>d92f30f</code></a></td><td><code>trac #18746: use method find_order from vertex_separation</code></td></tr></table>




---

archive/issue_comments_261526.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHello,\n\nI have performed several modifications and I'm now using the `find_order` method of `vertex_separation`.\n\nI don't know how to use the templates (and I'm unable to find this in #18395).\n\nI agree that we can certainly speed-up method `compute_edge_cut`. The best operation to compute the number of edges from `S+i` to `V\\(S+i)` is `count_S + degree[i] - 2*popcount32(S&g.graph[i])`, where `count_S` is the number of edges from `S` to `V\\S`. However, we don't store the number of edges from `S` to `V\\S`, so I don't know how to do this incremental process.\n\nDavid.",
    "created_at": "2015-06-27T12:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261526",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

Hello,

I have performed several modifications and I'm now using the `find_order` method of `vertex_separation`.

I don't know how to use the templates (and I'm unable to find this in #18395).

I agree that we can certainly speed-up method `compute_edge_cut`. The best operation to compute the number of edges from `S+i` to `V\(S+i)` is `count_S + degree[i] - 2*popcount32(S&g.graph[i])`, where `count_S` is the number of edges from `S` to `V\S`. However, we don't store the number of edges from `S` to `V\S`, so I don't know how to do this incremental process.

David.



---

archive/issue_comments_261527.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n> I have performed several modifications and I'm now using the `find_order` method of `vertex_separation`.\n\nOkay ! Note that replacing the import 'fily.pyx' with a cimport is not totally free. If you cimport functions, those functions will not be inlined (in particular popcount32).\n\n> I don't know how to use the templates (and I'm unable to find this in #18395).\n\nI just added a merge commit (that branch was in conflict with the latest beta). The trick that is used in that ticket is the following: the function `run_spring` takes an argument of type `dimension_t` (a fused type). We do not care what the value of this parameter is, only its type matters (`D_TWO` or `D_THREE`), for the function will be compiled twice, once for each type.\n\nInside the function, depending on the *type* of this variable, the value of `dim` is determined. As it never changes throughout the function, all tests 'if dim == 2' are resolved at compile-time. You could use the same trick to be able to pick different cost functions for free (at runtime), but admittedly the trick is more a 'hack'.\n\n> I agree that we can certainly speed-up method `compute_edge_cut`. The best operation to compute the number of edges from `S+i` to `V\\(S+i)` is `count_S + degree[i] - 2*popcount32(S&g.graph[i])`, where `count_S` is the number of edges from `S` to `V\\S`. However, we don't store the number of edges from `S` to `V\\S`, so I don't know how to do this incremental process.\n\nWell, it is the 'current cost' that is computed in 'exists', isn't it? We can just add an argument 'previous_cost' to 'exists', and then whenever 'exists' (which computed 'current_cost') calls 'exists', it can pass its 'current_cost' as a 'previous_cost'?.. This way 'exists' only has to compute the difference.\n\nNathann",
    "created_at": "2015-06-27T16:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261527",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:7" align="right">comment:7</div>

> I have performed several modifications and I'm now using the `find_order` method of `vertex_separation`.

Okay ! Note that replacing the import 'fily.pyx' with a cimport is not totally free. If you cimport functions, those functions will not be inlined (in particular popcount32).

> I don't know how to use the templates (and I'm unable to find this in #18395).

I just added a merge commit (that branch was in conflict with the latest beta). The trick that is used in that ticket is the following: the function `run_spring` takes an argument of type `dimension_t` (a fused type). We do not care what the value of this parameter is, only its type matters (`D_TWO` or `D_THREE`), for the function will be compiled twice, once for each type.

Inside the function, depending on the *type* of this variable, the value of `dim` is determined. As it never changes throughout the function, all tests 'if dim == 2' are resolved at compile-time. You could use the same trick to be able to pick different cost functions for free (at runtime), but admittedly the trick is more a 'hack'.

> I agree that we can certainly speed-up method `compute_edge_cut`. The best operation to compute the number of edges from `S+i` to `V\(S+i)` is `count_S + degree[i] - 2*popcount32(S&g.graph[i])`, where `count_S` is the number of edges from `S` to `V\S`. However, we don't store the number of edges from `S` to `V\S`, so I don't know how to do this incremental process.

Well, it is the 'current cost' that is computed in 'exists', isn't it? We can just add an argument 'previous_cost' to 'exists', and then whenever 'exists' (which computed 'current_cost') calls 'exists', it can pass its 'current_cost' as a 'previous_cost'?.. This way 'exists' only has to compute the difference.

Nathann



---

archive/issue_comments_261528.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba946f8b6ecc768b85869ade8e046deac678be3f\"><code>ba946f8</code></a></td><td><code>trac #18746: incremental cost computation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c\"><code>d1e49ec</code></a></td><td><code>trac #18746: resolve test error</code></td></tr></table>\n",
    "created_at": "2015-06-28T17:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261528",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba946f8b6ecc768b85869ade8e046deac678be3f"><code>ba946f8</code></a></td><td><code>trac #18746: incremental cost computation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c"><code>d1e49ec</code></a></td><td><code>trac #18746: resolve test error</code></td></tr></table>




---

archive/issue_comments_261529.json:
```json
{
    "body": "Changed commit from **[`d92f30f`](https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299)** to **[`d1e49ec`](https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c)**",
    "created_at": "2015-06-28T17:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261529",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d92f30f`](https://github.com/sagemath/sagetrac-mirror/commit/d92f30f684949592f36e53e4c03c3bf73c583299)** to **[`d1e49ec`](https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c)**



---

archive/issue_comments_261530.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHello,\n\nI have improved the cost computation. It is now incremental and so faster.\n\nI don't see how I can avoid the cimport of popcount32. If I want to reuse the `find_order` method from `vertex_separation`, I need a .pxd file. Since `FastDigraph` is an input parameter of the method, it should appear in that .pxd file, right?\nDo you have a better solution in mind? The only alternative I see is to not share the code.\n\nFor the fuse type / template stuff, since now the methods have different inputs, it is may be too complicated for the possible benefit. You agree?\n\nDavid.",
    "created_at": "2015-06-28T17:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261530",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:9" align="right">comment:9</div>

Hello,

I have improved the cost computation. It is now incremental and so faster.

I don't see how I can avoid the cimport of popcount32. If I want to reuse the `find_order` method from `vertex_separation`, I need a .pxd file. Since `FastDigraph` is an input parameter of the method, it should appear in that .pxd file, right?
Do you have a better solution in mind? The only alternative I see is to not share the code.

For the fuse type / template stuff, since now the methods have different inputs, it is may be too complicated for the possible benefit. You agree?

David.



---

archive/issue_comments_261531.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHello David,\n\nI added a commit on top on top of your public branch (hoping that you will nto\nmind). It does the following things:\n\n- Unimportant things\n\n- remove a 'verbose' flag that you do not use\n\n- Simplify the test for connectivity (rather unimportant too)\n\n- use `cw` in the recursive call to `cutwidth`\n\n- use `cut_off` in the call to `cutwidth_dyn`\n\n- You could not guess how much time I spent over your \"fake simple loop\", only\n  to figure out that you wanted to be able to use 'break'. It really takes a lot\n  of time. I swear. When you use tricks like that, *please* say it explicitly in\n  a comment.\n\n  More technically: I first added a comment above the loop to make it clearer,\n  then thought that it was making things very very complicated to avoid a\n  copy/paste of the three lines needed before the 'return'. Besides, your code\n  did not free the memory when it was interrupted with a CTRL+C.\n\n  I rewrote it with a try/except and with two nested loops. Three lines are\n  copy/pasted, but I find this a much better deal in terms of readability than a\n  fake nested loop. Plus it frees the memory.\n\n- In 'exists', I renamed `count_S` to `cost_S`. Same here. You have no idea how\n  many questions can be raised in the head of somebody reading the code and not\n  understanding what you do with this variable called 'count_S' which, which\n  turns out to not count S at all. My interpretation of this variable is that it\n  stores the cost of `S`. Please check.\n\n- When you want to multiply something by two, please use `*2` and not `<<1`. It\n  makes your meaning much clearer. Gcc generates the same code anyway.\n\n- About:\n\n  ```\n  -    cdef int mini = (1<<g.n)-1\n  +    cdef int mini = (<uint8_t> -1)\n  ```\n  I also wondered for a moment why you defined this specific value for `mini`. I\n  ended up convincing myself that you just wanted \"a big constant\".\n\n- I made a slightly unrelated modification to a distant 'doctest' file. Here is\n  why: this code 'injects' in any Sage file, when you run the tests, a check\n  that there are as many `sig_on` as `sig_off`. You will see it if you run the\n  tests on `cutwidth.pyx` after removing one of the `sig_off` (for instance the\n  one that appears inside of the return, in the nested loop).\n\n  It indicates that a doctest is broken, at some line in `cutwidth.pyx`. Of\n  course, this doctest is not really there so you are looking for a line that\n  does not really exists. I added a comment to it, so that its meaning is\n  clearer when you get an error in a `sage -t`.\n\nCould you also document the parameters of the 'exists' function, and the\nexpected behavior? I was surprised that a variable named 'cost' was actually\nused as \"max_admissible_cost\".\n\nThanks,\n\nNathann",
    "created_at": "2015-06-29T17:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261531",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

Hello David,

I added a commit on top on top of your public branch (hoping that you will nto
mind). It does the following things:

- Unimportant things

- remove a 'verbose' flag that you do not use

- Simplify the test for connectivity (rather unimportant too)

- use `cw` in the recursive call to `cutwidth`

- use `cut_off` in the call to `cutwidth_dyn`

- You could not guess how much time I spent over your "fake simple loop", only
  to figure out that you wanted to be able to use 'break'. It really takes a lot
  of time. I swear. When you use tricks like that, *please* say it explicitly in
  a comment.

  More technically: I first added a comment above the loop to make it clearer,
  then thought that it was making things very very complicated to avoid a
  copy/paste of the three lines needed before the 'return'. Besides, your code
  did not free the memory when it was interrupted with a CTRL+C.

  I rewrote it with a try/except and with two nested loops. Three lines are
  copy/pasted, but I find this a much better deal in terms of readability than a
  fake nested loop. Plus it frees the memory.

- In 'exists', I renamed `count_S` to `cost_S`. Same here. You have no idea how
  many questions can be raised in the head of somebody reading the code and not
  understanding what you do with this variable called 'count_S' which, which
  turns out to not count S at all. My interpretation of this variable is that it
  stores the cost of `S`. Please check.

- When you want to multiply something by two, please use `*2` and not `<<1`. It
  makes your meaning much clearer. Gcc generates the same code anyway.

- About:

  ```
  -    cdef int mini = (1<<g.n)-1
  +    cdef int mini = (<uint8_t> -1)
  ```
  I also wondered for a moment why you defined this specific value for `mini`. I
  ended up convincing myself that you just wanted "a big constant".

- I made a slightly unrelated modification to a distant 'doctest' file. Here is
  why: this code 'injects' in any Sage file, when you run the tests, a check
  that there are as many `sig_on` as `sig_off`. You will see it if you run the
  tests on `cutwidth.pyx` after removing one of the `sig_off` (for instance the
  one that appears inside of the return, in the nested loop).

  It indicates that a doctest is broken, at some line in `cutwidth.pyx`. Of
  course, this doctest is not really there so you are looking for a line that
  does not really exists. I added a comment to it, so that its meaning is
  clearer when you get an error in a `sage -t`.

Could you also document the parameters of the 'exists' function, and the
expected behavior? I was surprised that a variable named 'cost' was actually
used as "max_admissible_cost".

Thanks,

Nathann



---

archive/issue_comments_261532.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7\"><code>7c70b55</code></a></td><td><code>trac #18746: Reviewer's commit</code></td></tr></table>\n",
    "created_at": "2015-06-29T17:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261532",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7"><code>7c70b55</code></a></td><td><code>trac #18746: Reviewer's commit</code></td></tr></table>




---

archive/issue_comments_261533.json:
```json
{
    "body": "Changed commit from **[`d1e49ec`](https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c)** to **[`7c70b55`](https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7)**",
    "created_at": "2015-06-29T17:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261533",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d1e49ec`](https://github.com/sagemath/sagetrac-mirror/commit/d1e49ecf1085fc3c407cef28b0457713b349ad9c)** to **[`7c70b55`](https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7)**



---

archive/issue_comments_261534.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58\"><code>b536ed4</code></a></td><td><code>trac #18746: documentation improvements</code></td></tr></table>\n",
    "created_at": "2015-06-29T20:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261534",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58"><code>b536ed4</code></a></td><td><code>trac #18746: documentation improvements</code></td></tr></table>




---

archive/issue_comments_261535.json:
```json
{
    "body": "Changed commit from **[`7c70b55`](https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7)** to **[`b536ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58)**",
    "created_at": "2015-06-29T20:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261535",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7c70b55`](https://github.com/sagemath/sagetrac-mirror/commit/7c70b555f824ad9a6876f394cd79a65cce0022c7)** to **[`b536ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58)**



---

archive/issue_comments_261536.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI'm so sorry that you spend so much time understanding this code. In fact the `exists` method is almost a copy/paste  of the method you did for vertex separation/pathwidth, and I have omitted to extend the documentation. Sorry.\n\n\n>   More technically: I first added a comment above the loop to make it clearer,\n>   then thought that it was making things very very complicated to avoid a\n>   copy/paste of the three lines needed before the 'return'. Besides, your code\n>   did not free the memory when it was interrupted with a CTRL+C.\n> \n>   I rewrote it with a try/except and with two nested loops. Three lines are\n>   copy/pasted, but I find this a much better deal in terms of readability than a\n>   fake nested loop. Plus it frees the memory.\n\nAre you sure that the `finally` part is executed even after the `return` instruction in the `try` ? Shouldn't I add a `sage_free` before that return ?\n \n> - In 'exists', I renamed `count_S` to `cost_S`. Same here. You have no idea how\n>   many questions can be raised in the head of somebody reading the code and not\n>   understanding what you do with this variable called 'count_S' which, which\n>   turns out to not count S at all. My interpretation of this variable is that it\n>   stores the cost of `S`. Please check.\n\nI have renamed `cost` -> `k` to be consistent with the `cutwidth_dyn` method. It should be easier to follow.\n \n> - When you want to multiply something by two, please use `*2` and not `<<1`. It\n>   makes your meaning much clearer. Gcc generates the same code anyway.\n\nOK. I wasn't sure of that.\n\n> - About:\n> \n>   ```\n>   -    cdef int mini = (1<<g.n)-1\n>   +    cdef int mini = (<uint8_t> -1)\n>   ```\n>   I also wondered for a moment why you defined this specific value for `mini`. I\n>   ended up convincing myself that you just wanted \"a big constant\".\n\nRight. For vertex separation it was sufficient to initialize it with `g.n`, but here the maximum value can reach `n^2/2` (luckily, since `n\\leq 31`, the maximum possible value, `15*16=240`, can be stored in an `uint8_t`.\n\n \n> - I made a slightly unrelated modification to a distant 'doctest' file. Here is\n>   why: this code 'injects' in any Sage file, when you run the tests, a check\n>   that there are as many `sig_on` as `sig_off`. You will see it if you run the\n>   tests on `cutwidth.pyx` after removing one of the `sig_off` (for instance the\n>   one that appears inside of the return, in the nested loop).\n> \n>   It indicates that a doctest is broken, at some line in `cutwidth.pyx`. Of\n>   course, this doctest is not really there so you are looking for a line that\n>   does not really exists. I added a comment to it, so that its meaning is\n>   clearer when you get an error in a `sage -t`.\n\nok. This is admittedly easier that to create a one line ticket. \n\n> Could you also document the parameters of the 'exists' function, and the\n> expected behavior? I was surprised that a variable named 'cost' was actually\n> used as \"max_admissible_cost\".\n\nI tried to improve both the module documentation and the computation steps.\n\n> Thanks,\n\nThanks to you.\n\nDavid.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58\"><code>b536ed4</code></a></td><td><code>trac #18746: documentation improvements</code></td></tr></table>\n",
    "created_at": "2015-06-29T21:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261536",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:13" align="right">comment:13</div>

I'm so sorry that you spend so much time understanding this code. In fact the `exists` method is almost a copy/paste  of the method you did for vertex separation/pathwidth, and I have omitted to extend the documentation. Sorry.


>   More technically: I first added a comment above the loop to make it clearer,
>   then thought that it was making things very very complicated to avoid a
>   copy/paste of the three lines needed before the 'return'. Besides, your code
>   did not free the memory when it was interrupted with a CTRL+C.
> 
>   I rewrote it with a try/except and with two nested loops. Three lines are
>   copy/pasted, but I find this a much better deal in terms of readability than a
>   fake nested loop. Plus it frees the memory.

Are you sure that the `finally` part is executed even after the `return` instruction in the `try` ? Shouldn't I add a `sage_free` before that return ?
 
> - In 'exists', I renamed `count_S` to `cost_S`. Same here. You have no idea how
>   many questions can be raised in the head of somebody reading the code and not
>   understanding what you do with this variable called 'count_S' which, which
>   turns out to not count S at all. My interpretation of this variable is that it
>   stores the cost of `S`. Please check.

I have renamed `cost` -> `k` to be consistent with the `cutwidth_dyn` method. It should be easier to follow.
 
> - When you want to multiply something by two, please use `*2` and not `<<1`. It
>   makes your meaning much clearer. Gcc generates the same code anyway.

OK. I wasn't sure of that.

> - About:
> 
>   ```
>   -    cdef int mini = (1<<g.n)-1
>   +    cdef int mini = (<uint8_t> -1)
>   ```
>   I also wondered for a moment why you defined this specific value for `mini`. I
>   ended up convincing myself that you just wanted "a big constant".

Right. For vertex separation it was sufficient to initialize it with `g.n`, but here the maximum value can reach `n^2/2` (luckily, since `n\leq 31`, the maximum possible value, `15*16=240`, can be stored in an `uint8_t`.

 
> - I made a slightly unrelated modification to a distant 'doctest' file. Here is
>   why: this code 'injects' in any Sage file, when you run the tests, a check
>   that there are as many `sig_on` as `sig_off`. You will see it if you run the
>   tests on `cutwidth.pyx` after removing one of the `sig_off` (for instance the
>   one that appears inside of the return, in the nested loop).
> 
>   It indicates that a doctest is broken, at some line in `cutwidth.pyx`. Of
>   course, this doctest is not really there so you are looking for a line that
>   does not really exists. I added a comment to it, so that its meaning is
>   clearer when you get an error in a `sage -t`.

ok. This is admittedly easier that to create a one line ticket. 

> Could you also document the parameters of the 'exists' function, and the
> expected behavior? I was surprised that a variable named 'cost' was actually
> used as "max_admissible_cost".

I tried to improve both the module documentation and the computation steps.

> Thanks,

Thanks to you.

David.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58"><code>b536ed4</code></a></td><td><code>trac #18746: documentation improvements</code></td></tr></table>




---

archive/issue_comments_261537.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHellooooooo,\n\n> Are you sure that the `finally` part is executed even after the `return` instruction in the `try` ?\n\nYepyep, 'unfortunately'. I needed it recently, and... Well, it works `:-P`\n\n```\nsage: def a():\n....:     try:\n....:         return 1\n....:     finally:\n....:         print \"Hey\"\nsage: a()\nHey\n1\n```\n\nNathann",
    "created_at": "2015-06-30T09:22:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261537",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:14" align="right">comment:14</div>

Hellooooooo,

> Are you sure that the `finally` part is executed even after the `return` instruction in the `try` ?

Yepyep, 'unfortunately'. I needed it recently, and... Well, it works `:-P`

```
sage: def a():
....:     try:
....:         return 1
....:     finally:
....:         print "Hey"
sage: a()
Hey
1
```

Nathann



---

archive/issue_events_263915.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T09:42:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263915"
}
```



---

archive/issue_events_263916.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T09:42:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263916"
}
```



---

archive/issue_comments_261538.json:
```json
{
    "body": "Reviewer: **Nathann Cohen**",
    "created_at": "2015-06-30T09:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261538",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Nathann Cohen**



---

archive/issue_comments_261539.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOKayyyyyyyyyyyyy ! I looked at it again and it looks good. Thanks for the update!\n\nAssuming that you have no problem with my commit, I switch this to `positive_review`. THaaaaaanks,\n\nNathann",
    "created_at": "2015-06-30T09:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261539",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

OKayyyyyyyyyyyyy ! I looked at it again and it looks good. Thanks for the update!

Assuming that you have no problem with my commit, I switch this to `positive_review`. THaaaaaanks,

Nathann



---

archive/issue_events_263917.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-30T10:02:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263917"
}
```



---

archive/issue_events_263918.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2015-06-30T10:02:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263918"
}
```



---

archive/issue_comments_261540.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHello,\n\nThanks for the review and the commit !\nUnfortunately, I see from the patchbot that we have many errors due to the counting of `sig_on`/ sig_off`. So I assume we have no choice but opening a specific ticket, right?\n\nD.\n\n```\nsage -t --long src/sage/doctest/sources.py\n**********************************************************************\nFile \"src/sage/doctest/sources.py\", line 694, in sage.doctest.sources.FileDocTestSource._test_enough_doctests\nFailed example:\n    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time\n        path = os.path.relpath(path)\n        dirs.sort(); files.sort()\n        for F in files:\n            _, ext = os.path.splitext(F)\n            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):\n                filename = os.path.join(path, F)\n                FDS = FileDocTestSource(filename, DocTestDefaults(long=True,optional=True))\n                FDS._test_enough_doctests(verbose=False)\nExpected:\n    There are 7 tests in sage/combinat/dyck_word.py that are not being run\n    There are 4 tests in sage/combinat/finite_state_machine.py that are not being run\n    There are 6 tests in sage/combinat/interval_posets.py that are not being run\n    There are 18 tests in sage/combinat/partition.py that are not being run\n    There are 15 tests in sage/combinat/permutation.py that are not being run\n    There are 14 tests in sage/combinat/skew_partition.py that are not being run\n    There are 18 tests in sage/combinat/tableau.py that are not being run\n    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run\n    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run\n    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\n    There are 3 tests in sage/rings/invariant_theory.py that are not being run\nGot:\n    There are 7 tests in sage/combinat/dyck_word.py that are not being run\n    There are 4 tests in sage/combinat/finite_state_machine.py that are not being run\n    There are 6 tests in sage/combinat/interval_posets.py that are not being run\n    There are 18 tests in sage/combinat/partition.py that are not being run\n    There are 15 tests in sage/combinat/permutation.py that are not being run\n    There are 14 tests in sage/combinat/skew_partition.py that are not being run\n    There are 18 tests in sage/combinat/tableau.py that are not being run\n    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run\n    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run\n    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\n    There are 3 tests in sage/rings/invariant_theory.py that are not being run\n    There are 1 unexpected tests being run in doc/en/developer/coding_in_cython.rst\n    There are 3 unexpected tests being run in doc/en/developer/coding_in_other.rst\n    There are 1 unexpected tests being run in doc/en/developer/coding_in_python.rst\n    There are 1 unexpected tests being run in doc/en/thematic_tutorials/coding_theory.rst\n**********************************************************************\nFile \"src/sage/doctest/sources.py\", line 1456, in sage.doctest.sources.RestSource.parse_docstring\nFailed example:\n    for ex in tests[1].examples:\n        print ex.sage_source,\nExpected:\n    test1()\n    test2()\n    sig_on_count()\nGot:\n    test1()\n    test2()\n    sig_on_count() # check sig_on/off pairings\n**********************************************************************\n2 items had failures:\n   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests\n   1 of  14 in sage.doctest.sources.RestSource.parse_docstring\n    [339 tests, 2 failures, 100.78 s]\nsage -t --long src/sage/doctest/test.py\n**********************************************************************\nFile \"src/sage/doctest/test.py\", line 273, in sage.doctest.test\nFailed example:\n    subprocess.call([\"sage\", \"-t\",  \"--warn-long\", \"0\", \"sig_on.rst\"], **kwds)  # long time\nExpected:\n    Running doctests...\n    Doctesting 1 file.\n    sage -t --warn-long 0.0 sig_on.rst\n    **********************************************************************\n    File \"sig_on.rst\", line 5, in sage.doctest.tests.sig_on\n    Failed example:\n        sig_on_count()\n    Expected:\n        0\n    Got:\n        1\n    **********************************************************************\n    1 item had failures:\n       1 of   4 in sage.doctest.tests.sig_on\n        [2 tests, 1 failure, ...]\n    ----------------------------------------------------------------------\n    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed\n    ----------------------------------------------------------------------\n    ...\n    1\nGot:\n    Running doctests with ID 2015-06-29-23-32-47-2a7e60db.\n    Git branch: patchbot/ticket_merged\n    Using --optional=ccache,gcc,mpir,python2,sage,scons\n    Doctesting 1 file.\n    sage -t --warn-long 0.0 sig_on.rst\n    **********************************************************************\n    File \"sig_on.rst\", line 5, in sage.doctest.tests.sig_on\n    Failed example:\n        sig_on_count() # check sig_on/off pairings\n    Expected:\n        0\n    Got:\n        1\n    **********************************************************************\n    1 item had failures:\n       1 of   4 in sage.doctest.tests.sig_on\n        [2 tests, 1 failure, 1.61 s]\n    ----------------------------------------------------------------------\n    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed\n    ----------------------------------------------------------------------\n    Total time for all tests: 1.7 seconds\n        cpu time: 0.1 seconds\n        cumulative wall time: 1.6 seconds\n    1\n**********************************************************************\n1 item had failures:\n   1 of  45 in sage.doctest.test\n    [44 tests, 1 failure, 71.79 s]\nsage -t --long src/sage/doctest/forker.py\n**********************************************************************\nFile \"src/sage/doctest/forker.py\", line 2035, in sage.doctest.forker.DocTestTask\nFailed example:\n    ntests, results = DTT(options=DD)\nExpected nothing\nGot:\n    **********************************************************************\n    File \"/home/sage/sage-devel/src/sage/doctest/sources.py\", line 1456, in sage.doctest.sources.RestSource.parse_docstring\n    Failed example:\n        for ex in tests[1].examples:\n            print ex.sage_source,\n    Expected:\n        test1()\n        test2()\n        sig_on_count()\n    Got:\n        test1()\n        test2()\n        sig_on_count() # check sig_on/off pairings\n    **********************************************************************\n    1 item had failures:\n       1 of  14 in sage.doctest.sources.RestSource.parse_docstring\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.doctest.forker.DocTestTask\n    [439 tests, 1 failure, 13.16 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/doctest/sources.py  # 2 doctests failed\nsage -t --long src/sage/doctest/test.py  # 1 doctest failed\nsage -t --long src/sage/doctest/forker.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2015-06-30T10:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261540",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

Hello,

Thanks for the review and the commit !
Unfortunately, I see from the patchbot that we have many errors due to the counting of `sig_on`/ sig_off`. So I assume we have no choice but opening a specific ticket, right?

D.

```
sage -t --long src/sage/doctest/sources.py
**********************************************************************
File "src/sage/doctest/sources.py", line 694, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time
        path = os.path.relpath(path)
        dirs.sort(); files.sort()
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, DocTestDefaults(long=True,optional=True))
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 7 tests in sage/combinat/dyck_word.py that are not being run
    There are 4 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 6 tests in sage/combinat/interval_posets.py that are not being run
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 15 tests in sage/combinat/permutation.py that are not being run
    There are 14 tests in sage/combinat/skew_partition.py that are not being run
    There are 18 tests in sage/combinat/tableau.py that are not being run
    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run
    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run
    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 3 tests in sage/rings/invariant_theory.py that are not being run
Got:
    There are 7 tests in sage/combinat/dyck_word.py that are not being run
    There are 4 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 6 tests in sage/combinat/interval_posets.py that are not being run
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 15 tests in sage/combinat/permutation.py that are not being run
    There are 14 tests in sage/combinat/skew_partition.py that are not being run
    There are 18 tests in sage/combinat/tableau.py that are not being run
    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run
    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run
    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 3 tests in sage/rings/invariant_theory.py that are not being run
    There are 1 unexpected tests being run in doc/en/developer/coding_in_cython.rst
    There are 3 unexpected tests being run in doc/en/developer/coding_in_other.rst
    There are 1 unexpected tests being run in doc/en/developer/coding_in_python.rst
    There are 1 unexpected tests being run in doc/en/thematic_tutorials/coding_theory.rst
**********************************************************************
File "src/sage/doctest/sources.py", line 1456, in sage.doctest.sources.RestSource.parse_docstring
Failed example:
    for ex in tests[1].examples:
        print ex.sage_source,
Expected:
    test1()
    test2()
    sig_on_count()
Got:
    test1()
    test2()
    sig_on_count() # check sig_on/off pairings
**********************************************************************
2 items had failures:
   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests
   1 of  14 in sage.doctest.sources.RestSource.parse_docstring
    [339 tests, 2 failures, 100.78 s]
sage -t --long src/sage/doctest/test.py
**********************************************************************
File "src/sage/doctest/test.py", line 273, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t",  "--warn-long", "0", "sig_on.rst"], **kwds)  # long time
Expected:
    Running doctests...
    Doctesting 1 file.
    sage -t --warn-long 0.0 sig_on.rst
    **********************************************************************
    File "sig_on.rst", line 5, in sage.doctest.tests.sig_on
    Failed example:
        sig_on_count()
    Expected:
        0
    Got:
        1
    **********************************************************************
    1 item had failures:
       1 of   4 in sage.doctest.tests.sig_on
        [2 tests, 1 failure, ...]
    ----------------------------------------------------------------------
    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed
    ----------------------------------------------------------------------
    ...
    1
Got:
    Running doctests with ID 2015-06-29-23-32-47-2a7e60db.
    Git branch: patchbot/ticket_merged
    Using --optional=ccache,gcc,mpir,python2,sage,scons
    Doctesting 1 file.
    sage -t --warn-long 0.0 sig_on.rst
    **********************************************************************
    File "sig_on.rst", line 5, in sage.doctest.tests.sig_on
    Failed example:
        sig_on_count() # check sig_on/off pairings
    Expected:
        0
    Got:
        1
    **********************************************************************
    1 item had failures:
       1 of   4 in sage.doctest.tests.sig_on
        [2 tests, 1 failure, 1.61 s]
    ----------------------------------------------------------------------
    sage -t --warn-long 0.0 sig_on.rst  # 1 doctest failed
    ----------------------------------------------------------------------
    Total time for all tests: 1.7 seconds
        cpu time: 0.1 seconds
        cumulative wall time: 1.6 seconds
    1
**********************************************************************
1 item had failures:
   1 of  45 in sage.doctest.test
    [44 tests, 1 failure, 71.79 s]
sage -t --long src/sage/doctest/forker.py
**********************************************************************
File "src/sage/doctest/forker.py", line 2035, in sage.doctest.forker.DocTestTask
Failed example:
    ntests, results = DTT(options=DD)
Expected nothing
Got:
    **********************************************************************
    File "/home/sage/sage-devel/src/sage/doctest/sources.py", line 1456, in sage.doctest.sources.RestSource.parse_docstring
    Failed example:
        for ex in tests[1].examples:
            print ex.sage_source,
    Expected:
        test1()
        test2()
        sig_on_count()
    Got:
        test1()
        test2()
        sig_on_count() # check sig_on/off pairings
    **********************************************************************
    1 item had failures:
       1 of  14 in sage.doctest.sources.RestSource.parse_docstring
**********************************************************************
1 item had failures:
   1 of  14 in sage.doctest.forker.DocTestTask
    [439 tests, 1 failure, 13.16 s]
----------------------------------------------------------------------
sage -t --long src/sage/doctest/sources.py  # 2 doctests failed
sage -t --long src/sage/doctest/test.py  # 1 doctest failed
sage -t --long src/sage/doctest/forker.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_261541.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nArggggggggggg.... Okay `T_T`",
    "created_at": "2015-06-30T10:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261541",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

Arggggggggggg.... Okay `T_T`



---

archive/issue_comments_261542.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb\"><code>551d0f0</code></a></td><td><code>trac #18746: Remove modifications to doctest.py</code></td></tr></table>\n",
    "created_at": "2015-06-30T10:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261542",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb"><code>551d0f0</code></a></td><td><code>trac #18746: Remove modifications to doctest.py</code></td></tr></table>




---

archive/issue_comments_261543.json:
```json
{
    "body": "Changed commit from **[`b536ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58)** to **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**",
    "created_at": "2015-06-30T10:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261543",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b536ed4`](https://github.com/sagemath/sagetrac-mirror/commit/b536ed4dbb5e44f705ddd12c429b9473ec24cc58)** to **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**



---

archive/issue_events_263919.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T10:10:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263919"
}
```



---

archive/issue_events_263920.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T10:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263920"
}
```



---

archive/issue_comments_261544.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThank you.",
    "created_at": "2015-06-30T10:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261544",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">comment:20</div>

Thank you.



---

archive/issue_events_263921.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-30T23:12:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263921"
}
```



---

archive/issue_events_263922.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4aab35405e7e6e0ee883c84880d9bd36bd27f54a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-30T23:12:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18746#event-263922"
}
```



---

archive/issue_comments_261545.json:
```json
{
    "body": "Changed branch from **[public/18746](https://github.com/sagemath/sagetrac-mirror/tree/public/18746)** to **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**",
    "created_at": "2015-06-30T23:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18746#issuecomment-261545",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/18746](https://github.com/sagemath/sagetrac-mirror/tree/public/18746)** to **[`551d0f0`](https://github.com/sagemath/sagetrac-mirror/commit/551d0f0ab9c7942e4d8d61bc2f18808011698dfb)**
