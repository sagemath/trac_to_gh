# Issue 18513: Make <package>/type file mandatory

archive/issues_018276.json:
```json
{
    "body": "With this branch, \"make\" is interrupted if some package does not define a 'type' file, or if its content is unexpected.\n\nNathann\n\nCC:  @jdemeyer @vbraun\n\nBranch/Commit: a77b2226906dec5b8201155bd465bdf09b8021f8\n\nReviewer: Jeroen Demeyer\n\nAuthor: Nathann Cohen\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18513\n\n",
    "closed_at": "2015-05-27T20:03:16Z",
    "created_at": "2015-05-26T09:01:51Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Make <package>/type file mandatory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18513",
    "user": "https://github.com/nathanncohen"
}
```
With this branch, "make" is interrupted if some package does not define a 'type' file, or if its content is unexpected.

Nathann

CC:  @jdemeyer @vbraun

Branch/Commit: a77b2226906dec5b8201155bd465bdf09b8021f8

Reviewer: Jeroen Demeyer

Author: Nathann Cohen

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18513





---

archive/issue_comments_323414.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-26T09:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323414",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_323415.json:
```json
{
    "body": "Changing branch from \"\" to \"public/18513\"",
    "created_at": "2015-05-26T09:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323415",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "" to "public/18513"



---

archive/issue_comments_323416.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T09:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323417.json:
```json
{
    "body": "Changing commit from \"\" to \"e8caa274577da75eadd532065cac08bd71eac316\"",
    "created_at": "2015-05-26T09:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "e8caa274577da75eadd532065cac08bd71eac316"



---

archive/issue_comments_323418.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-26T09:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323419.json:
```json
{
    "body": "Changing commit from \"e8caa274577da75eadd532065cac08bd71eac316\" to \"066e88edb1a2278184f583406bb92aa2981d60f1\"",
    "created_at": "2015-05-26T09:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e8caa274577da75eadd532065cac08bd71eac316" to "066e88edb1a2278184f583406bb92aa2981d60f1"



---

archive/issue_comments_323420.json:
```json
{
    "body": "<a id='comment:4'></a>lgtm but can we also have an error message?",
    "created_at": "2015-05-26T09:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323420",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>lgtm but can we also have an error message?



---

archive/issue_comments_323421.json:
```json
{
    "body": "<a id='comment:5'></a>Well, there is one generated by 'cat' when the file does not exist, and it prints something specific about what the content of the 'type' file should be when it is invalid.\n\nDo you want something 'hand-made' when the file does not exist?\n\nNathann",
    "created_at": "2015-05-26T09:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323421",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Well, there is one generated by 'cat' when the file does not exist, and it prints something specific about what the content of the 'type' file should be when it is invalid.

Do you want something 'hand-made' when the file does not exist?

Nathann



---

archive/issue_comments_323422.json:
```json
{
    "body": "<a id='comment:6'></a>If I just see cat erroring out then it looks like a bug in the build system. And you catch the error anyways, so why not print something like \"the package type must declare its 'type' file\"?",
    "created_at": "2015-05-26T09:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323422",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>If I just see cat erroring out then it looks like a bug in the build system. And you catch the error anyways, so why not print something like "the package type must declare its 'type' file"?



---

archive/issue_comments_323423.json:
```json
{
    "body": "<a id='comment:7'></a>Needs to be rebased over #17607.",
    "created_at": "2015-05-26T09:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323423",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Needs to be rebased over #17607.



---

archive/issue_comments_323424.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-26T09:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323424",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_323425.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#17607\"",
    "created_at": "2015-05-26T09:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323425",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#17607"



---

archive/issue_comments_323426.json:
```json
{
    "body": "<a id='comment:8'></a>I actually think that this is pretty clear, it explicitly says which file is missing:\n\n```\n$ rm build/pkgs/r/type  # Just for testing\n$ make\ncd build && \\\n\"../build/pipestatus\" \\\n        \"env SAGE_PARALLEL_SPKG_BUILD='' ./install all 2>&1\" \\\n        \"tee -a ../logs/install.log\"\ncat: /usr/local/src/sage-config/build/pkgs/r/type: No such file or directory\nMakefile:19: recipe for target 'build' failed\nmake: *** [build] Error 1\n```\nHowever, to reduce confusion, it doesn't hurt to add an extra error message.",
    "created_at": "2015-05-26T09:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323426",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I actually think that this is pretty clear, it explicitly says which file is missing:

```
$ rm build/pkgs/r/type  # Just for testing
$ make
cd build && \
"../build/pipestatus" \
        "env SAGE_PARALLEL_SPKG_BUILD='' ./install all 2>&1" \
        "tee -a ../logs/install.log"
cat: /usr/local/src/sage-config/build/pkgs/r/type: No such file or directory
Makefile:19: recipe for target 'build' failed
make: *** [build] Error 1
```
However, to reduce confusion, it doesn't hurt to add an extra error message.



---

archive/issue_comments_323427.json:
```json
{
    "body": "<a id='comment:9'></a>> Needs to be rebased over #17607.\n\n\nWhat the hell is this? You created a `python2standard` and `python3standard` package type?",
    "created_at": "2015-05-26T09:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323427",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>> Needs to be rebased over #17607.


What the hell is this? You created a `python2standard` and `python3standard` package type?



---

archive/issue_comments_323428.json:
```json
{
    "body": "Changing commit from \"066e88edb1a2278184f583406bb92aa2981d60f1\" to \"79a41b9cd4a69815eceafb8f14f190bb06e0fdd6\"",
    "created_at": "2015-05-26T09:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "066e88edb1a2278184f583406bb92aa2981d60f1" to "79a41b9cd4a69815eceafb8f14f190bb06e0fdd6"



---

archive/issue_comments_323429.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-26T09:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323430.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [ncohen](#comment%3A9):\n> You created a `python2standard` and `python3standard` package type?\n\nWell, I hope the *You* doesn't refer to me, since I am innocent.",
    "created_at": "2015-05-26T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323430",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [ncohen](#comment%3A9):
> You created a `python2standard` and `python3standard` package type?

Well, I hope the *You* doesn't refer to me, since I am innocent.



---

archive/issue_comments_323431.json:
```json
{
    "body": "<a id='comment:12'></a>There does not seem to be a conflict with #17607. But I find what was done there *VERY* dirty. A 'clean' way out would have been to\n1) Create a 'standard' virtual 'Python' package with dependency on 'python_2_or_3'\n2) Make python2 and python3 optional\n3) Create in build/install a rule 'python_2_or_3' depending on python2 or python3.\n\nThere would have been no need of adding two new types, and no need to change filtered_packages_list.\n\nNathann",
    "created_at": "2015-05-26T10:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323431",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>There does not seem to be a conflict with #17607. But I find what was done there *VERY* dirty. A 'clean' way out would have been to
1) Create a 'standard' virtual 'Python' package with dependency on 'python_2_or_3'
2) Make python2 and python3 optional
3) Create in build/install a rule 'python_2_or_3' depending on python2 or python3.

There would have been no need of adding two new types, and no need to change filtered_packages_list.

Nathann



---

archive/issue_comments_323432.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-26T10:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323432",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_323433.json:
```json
{
    "body": "<a id='comment:13'></a>> Well, I hope the *You* doesn't refer to me, since I am innocent.\n\nSo you are innocent.\n\nI set this ticket back to needs_review, as there is apaprently no conflict with #17607.\n\nNathann",
    "created_at": "2015-05-26T10:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323433",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>> Well, I hope the *You* doesn't refer to me, since I am innocent.

So you are innocent.

I set this ticket back to needs_review, as there is apaprently no conflict with #17607.

Nathann



---

archive/issue_comments_323434.json:
```json
{
    "body": "<a id='comment:14'></a>Can you replace\n\n```\nfiltered_packages_list all > /dev/null\n```\nby\n\n```\nfiltered_packages_list none\n```\nbecause of efficiency reasons? With the first variant, you are executing a lot of stuff which you don't use.",
    "created_at": "2015-05-26T12:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323434",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Can you replace

```
filtered_packages_list all > /dev/null
```
by

```
filtered_packages_list none
```
because of efficiency reasons? With the first variant, you are executing a lot of stuff which you don't use.



---

archive/issue_comments_323435.json:
```json
{
    "body": "<a id='comment:15'></a>Even simpler: you can replace\n\n```\nfiltered_packages_list all > /dev/null\nif [ $? -ne 0 ]; then\n    exit 1\nfi\n```\nby\n\n```\nfiltered_packages_list none || exit $?\n```",
    "created_at": "2015-05-26T13:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323435",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Even simpler: you can replace

```
filtered_packages_list all > /dev/null
if [ $? -ne 0 ]; then
    exit 1
fi
```
by

```
filtered_packages_list none || exit $?
```



---

archive/issue_comments_323436.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-26T13:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323437.json:
```json
{
    "body": "Changing commit from \"79a41b9cd4a69815eceafb8f14f190bb06e0fdd6\" to \"e9054a633a2cad1adf61f409cc6023d3552f9aaa\"",
    "created_at": "2015-05-26T13:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "79a41b9cd4a69815eceafb8f14f190bb06e0fdd6" to "e9054a633a2cad1adf61f409cc6023d3552f9aaa"



---

archive/issue_comments_323438.json:
```json
{
    "body": "<a id='comment:17'></a>> With the first variant, you are executing a lot of stuff which you don't use.\n\n\nDone. In my first version of that function an error was raised when the argument was anything which is not a valid type.\n\nNathann",
    "created_at": "2015-05-26T13:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323438",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>> With the first variant, you are executing a lot of stuff which you don't use.


Done. In my first version of that function an error was raised when the argument was anything which is not a valid type.

Nathann



---

archive/issue_comments_323439.json:
```json
{
    "body": "<a id='comment:18'></a>> Even simpler: you can replace\n\n\nSigh ....",
    "created_at": "2015-05-26T13:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323439",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>> Even simpler: you can replace


Sigh ....



---

archive/issue_comments_323440.json:
```json
{
    "body": "Changing dependencies from \"#17607\" to \"\"",
    "created_at": "2015-05-26T13:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323440",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#17607" to ""



---

archive/issue_comments_323441.json:
```json
{
    "body": "Changing commit from \"e9054a633a2cad1adf61f409cc6023d3552f9aaa\" to \"a77b2226906dec5b8201155bd465bdf09b8021f8\"",
    "created_at": "2015-05-26T13:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e9054a633a2cad1adf61f409cc6023d3552f9aaa" to "a77b2226906dec5b8201155bd465bdf09b8021f8"



---

archive/issue_comments_323442.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-26T13:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323443.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-26T20:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323443",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_323444.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-05-26T20:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323444",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_323445.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-27T20:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323445",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052043.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-27T20:03:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18513#event-52043"
}
```



---

archive/issue_comments_323446.json:
```json
{
    "body": "Changing branch from \"public/18513\" to \"a77b2226906dec5b8201155bd465bdf09b8021f8\"",
    "created_at": "2015-05-27T20:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18513#issuecomment-323446",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/18513" to "a77b2226906dec5b8201155bd465bdf09b8021f8"
