# Issue 18210: numerical bug in incomplete gamma function

archive/issues_017973.json:
```json
{
    "assignees": [],
    "body": "Wrong values from incomplete gamma:\n\n```\n$ ./sage -v\nSageMath Version 6.7.beta1, Release Date: 2015-04-15\n\n$ ./sage\nsage: gamma(60, 30).numerical_approx()\n-1.28306738270893e74\n```\nReason is a bug in Pari:\n\n```\n? \\p 50\n   realprecision = 57 significant digits (50 digits displayed)\n? incgam(60,30)\n%2 = 1.3868299023788799504133735635863795825413935892945 E80\n? \\p 30\n   realprecision = 38 significant digits (30 digits displayed)\n? incgam(60,30)\n%3 = -1.23084064495468737276106696496 E74\n```\n\nPrevious description:\n\nThe following code:\n\n\n```\nsage: var('R k')\n(R, k)\nsage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)\nsage: plot(integrated.subs(k=41), (R,0,6))\n```\n\ngives a Seg fault error and crashes Sage entirely:\n\n line 134:  4216 Segmentation fault      (core dumped)\n\nI believe it comes from the symbolic computation because the following code is working:\n\n\n```\nsage: var('R k')\n(R, k)\nsage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)\nsage: plot(integrated.subs(k=41.), (R,0,6))\n```\n\n(Note the 41. instead of 41)\n\nI have no idea where this comes from but it's really bad, because whatever is going wrong, crashing Sage is bad!\n \n\n\n\n\nKeywords: **sd67**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18210_\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2015-04-15T18:26:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "numerical bug in incomplete gamma function",
    "type": "issue",
    "updated_at": "2017-01-21T18:03:11Z",
    "url": "https://github.com/sagemath/sage/issues/18210",
    "user": "https://github.com/VivianePons"
}
```
Wrong values from incomplete gamma:

```
$ ./sage -v
SageMath Version 6.7.beta1, Release Date: 2015-04-15

$ ./sage
sage: gamma(60, 30).numerical_approx()
-1.28306738270893e74
```
Reason is a bug in Pari:

```
? \p 50
   realprecision = 57 significant digits (50 digits displayed)
? incgam(60,30)
%2 = 1.3868299023788799504133735635863795825413935892945 E80
? \p 30
   realprecision = 38 significant digits (30 digits displayed)
? incgam(60,30)
%3 = -1.23084064495468737276106696496 E74
```

Previous description:

The following code:


```
sage: var('R k')
(R, k)
sage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)
sage: plot(integrated.subs(k=41), (R,0,6))
```

gives a Seg fault error and crashes Sage entirely:

 line 134:  4216 Segmentation fault      (core dumped)

I believe it comes from the symbolic computation because the following code is working:


```
sage: var('R k')
(R, k)
sage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)
sage: plot(integrated.subs(k=41.), (R,0,6))
```

(Note the 41. instead of 41)

I have no idea where this comes from but it's really bad, because whatever is going wrong, crashing Sage is bad!
 




Keywords: **sd67**

Upstream: **Fixed upstream, in a later stable release.**

_Issue created by migration from https://trac.sagemath.org/ticket/18210_





---

archive/issue_events_241180.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2015-04-15T18:26:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241180"
}
```



---

archive/issue_events_241181.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2015-04-15T18:26:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241181"
}
```



---

archive/issue_events_241182.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2015-04-15T18:26:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241182"
}
```



---

archive/issue_comments_251668.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nMore funny stuff:\n\n\n```\nsage: a = 319830986772877770815625*sqrt(pi)\nsage: b = 1048576*gamma(41/2, 41/2*x)\nsage: f = a - b\nsage: plot(f, (R,0,1))  # works fine\nsage: plot(f / sqrt(pi), (R,0,1))  # BOOM\n```",
    "created_at": "2015-04-15T18:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251668",
    "user": "https://github.com/VivianePons"
}
```

<a id='comment:1'>Comment 1:</a>
More funny stuff:


```
sage: a = 319830986772877770815625*sqrt(pi)
sage: b = 1048576*gamma(41/2, 41/2*x)
sage: f = a - b
sage: plot(f, (R,0,1))  # works fine
sage: plot(f / sqrt(pi), (R,0,1))  # BOOM
```



---

archive/issue_comments_251669.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis is recent because on 6.5beta1 the error doesn't occur.\n\nIt looks like some infinite recursion in ginac. Excerpt from traceback obtained from `sage -gdb` after segv has occurred:\n\n```\n...\n#12573 0x00007fffc8185e3d in GiNaC::mul::eval(int) const ()\n   from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n#12574 0x00007fffc80f170b in GiNaC::ex::construct_from_basic(GiNaC::basic const&) () from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n#12575 0x00007fffc80acb59 in GiNaC::ex::ex(GiNaC::basic const&) ()\n   from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n#12576 0x00007fffc8185e3d in GiNaC::mul::eval(int) const ()\n   from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n#12577 0x00007fffc80f170b in GiNaC::ex::construct_from_basic(GiNaC::basic const&) () from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n#12578 0x00007fffc80acb59 in GiNaC::ex::ex(GiNaC::basic const&) ()\n   from /usr/local/sage/sage-git/local/lib/libpynac.so.1\n...\n```",
    "created_at": "2015-04-15T18:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251669",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'>Comment 2:</a>
This is recent because on 6.5beta1 the error doesn't occur.

It looks like some infinite recursion in ginac. Excerpt from traceback obtained from `sage -gdb` after segv has occurred:

```
...
#12573 0x00007fffc8185e3d in GiNaC::mul::eval(int) const ()
   from /usr/local/sage/sage-git/local/lib/libpynac.so.1
#12574 0x00007fffc80f170b in GiNaC::ex::construct_from_basic(GiNaC::basic const&) () from /usr/local/sage/sage-git/local/lib/libpynac.so.1
#12575 0x00007fffc80acb59 in GiNaC::ex::ex(GiNaC::basic const&) ()
   from /usr/local/sage/sage-git/local/lib/libpynac.so.1
#12576 0x00007fffc8185e3d in GiNaC::mul::eval(int) const ()
   from /usr/local/sage/sage-git/local/lib/libpynac.so.1
#12577 0x00007fffc80f170b in GiNaC::ex::construct_from_basic(GiNaC::basic const&) () from /usr/local/sage/sage-git/local/lib/libpynac.so.1
#12578 0x00007fffc80acb59 in GiNaC::ex::ex(GiNaC::basic const&) ()
   from /usr/local/sage/sage-git/local/lib/libpynac.so.1
...
```



---

archive/issue_comments_251670.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThe original discussion is here: https://groups.google.com/d/msg/sage-support/7ex6McLE7AA/mvZ5Rq-D1FAJ",
    "created_at": "2015-04-15T18:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251670",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:3'>Comment 3:</a>
The original discussion is here: https://groups.google.com/d/msg/sage-support/7ex6McLE7AA/mvZ5Rq-D1FAJ



---

archive/issue_comments_251671.json:
```json
{
    "body": "Attachment: **[working-graph-2012.png.gz](https://github.com/sagemath/sage/files/ticket18210/working-graph-2012.png.gz)**\n\nAttachment: **[broken-graph-2015.png.gz](https://github.com/sagemath/sage/files/ticket18210/broken-graph-2015.png.gz)**",
    "created_at": "2015-04-15T19:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251671",
    "user": "https://github.com/sagetrac-buck"
}
```

Attachment: **[working-graph-2012.png.gz](https://github.com/sagemath/sage/files/ticket18210/working-graph-2012.png.gz)**

Attachment: **[broken-graph-2015.png.gz](https://github.com/sagemath/sage/files/ticket18210/broken-graph-2015.png.gz)**



---

archive/issue_comments_251672.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI think there's more to it than that even. Using the limited-precision numerics, I get this plot:\n\n![](broken-graph-2015.png)\ufffc\ufffc\n\nIn 2012, when the exact numerics still worked, I got this graph:\n\n<img src=\"working-graph-2012.png\" width=600px>\ufffc\ufffc",
    "created_at": "2015-04-15T19:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251672",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:4'>Comment 4:</a>
I think there's more to it than that even. Using the limited-precision numerics, I get this plot:

![](broken-graph-2015.png)￼￼

In 2012, when the exact numerics still worked, I got this graph:

<img src="working-graph-2012.png" width=600px>￼￼



---

archive/issue_events_241183.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-04-15T20:49:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241183"
}
```



---

archive/issue_comments_251673.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nInterestingly, neither the first snippet in the description nor the BOOM snippet in [comment:1](#comment%3A1) will crash on 6.7beta1/OpenSuSE. What machine/system is that, Viviane/buck/nbruin?",
    "created_at": "2015-04-16T06:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251673",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'>Comment 6:</a>
Interestingly, neither the first snippet in the description nor the BOOM snippet in [comment:1](#comment%3A1) will crash on 6.7beta1/OpenSuSE. What machine/system is that, Viviane/buck/nbruin?



---

archive/issue_comments_251674.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI'm on OS X 10.10.3",
    "created_at": "2015-04-16T17:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251674",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:7'>Comment 7:</a>
I'm on OS X 10.10.3



---

archive/issue_comments_251675.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nRight, I just tried on 6.7 and indeed it is not crashing!\n\nBuck I'd be happy to know if you obtain plot that \"make sense\" on 6.7. Sorry for the extra compiling, to get 6.7, just checkout the develop ranch and do a git pull. Let me know if you have problems.",
    "created_at": "2015-04-16T22:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251675",
    "user": "https://github.com/VivianePons"
}
```

<a id='comment:8'>Comment 8:</a>
Right, I just tried on 6.7 and indeed it is not crashing!

Buck I'd be happy to know if you obtain plot that "make sense" on 6.7. Sorry for the extra compiling, to get 6.7, just checkout the develop ranch and do a git pull. Let me know if you have problems.



---

archive/issue_comments_251676.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@rwst](#comment%3A6):\n> Interestingly, neither the first snippet in the description nor the BOOM snippet in [comment:1](#comment%3A1) will crash on 6.7beta1/OpenSuSE. What machine/system is that, Viviane/buck/nbruin?\n\n(on fedora) 6.7beta1 doesn't segfault anymore either. I haven't checked if the precision issues remain.",
    "created_at": "2015-04-17T04:54:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251676",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@rwst](#comment%3A6):
> Interestingly, neither the first snippet in the description nor the BOOM snippet in [comment:1](#comment%3A1) will crash on 6.7beta1/OpenSuSE. What machine/system is that, Viviane/buck/nbruin?

(on fedora) 6.7beta1 doesn't segfault anymore either. I haven't checked if the precision issues remain.



---

archive/issue_comments_251677.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nNo crash on OSX/6.7.beta1 either. Any crashes on 6.7beta1 at all?",
    "created_at": "2015-04-17T06:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251677",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'>Comment 10:</a>
No crash on OSX/6.7.beta1 either. Any crashes on 6.7beta1 at all?



---

archive/issue_comments_251678.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI also get no segfault in 6.7, but the numerical issue persists.\nSeparate issue I suppose.",
    "created_at": "2015-04-18T00:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251678",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:11'>Comment 11:</a>
I also get no segfault in 6.7, but the numerical issue persists.
Separate issue I suppose.



---

archive/issue_comments_251679.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [buck](#comment%3A11):\n> I also get no segfault in 6.7, but the numerical issue persists.\n> Separate issue I suppose.\n\nSince no one can reproduce the crash on a recent Sage we will use this ticket for the numeric issue. I tried the code in the sage-devel posting but had no glitches in the graph. Can you please give a fully contained code snipped that shows the glitches on a recent Sage system?",
    "created_at": "2015-04-19T06:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251679",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [buck](#comment%3A11):
> I also get no segfault in 6.7, but the numerical issue persists.
> Separate issue I suppose.

Since no one can reproduce the crash on a recent Sage we will use this ticket for the numeric issue. I tried the code in the sage-devel posting but had no glitches in the graph. Can you please give a fully contained code snipped that shows the glitches on a recent Sage system?



---

archive/issue_comments_251680.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\n@rwst: This is a reposting of my sage-support thread [here](https://groups.google.com/forum/#!topic/sage-support/E2YW4ddcwQI) where I gave some small reproductions of the problem.\n\n---\n\n\nThe incomplete gamma function is resulting in negative outputs with positive real input, which shouldn't happen.\n\n\n```\nsage: gamma(60, 30).numerical_approx()\n-1.28306738270893e74\n```\n\n\nAttached is a notebook showing the same in graphical form.\n\nIf I feed in numbers of a higher precision, I get the correct result:\n\n\n```\nsage: R10 = RealField(200)\nsage: gamma(R10(60), R10(30)).numerical_approx()\n1.38682990237888e80\n```\n\n\nMy final problem is that there doesn't seem to be any way to get higher precision numbers to feed all the way through the plot function:\n\n\n```\nsage: show(plot3d(log(gamma(k, k*x)), (x, R10(0), R10(5/2)), (k, R10(1), R10(101))))\nLaunched jmol viewer for Graphics3d Object\n```\n\n(you would see a 3d graph with a bite out of it where the precision issue exists)\n\n\n---\n\nI'm able to reproduce it today on the latest sage:\n\n```\n$ ./sage -v\nSageMath Version 6.7.beta1, Release Date: 2015-04-15\n\n$ ./sage\nsage: gamma(60, 30).numerical_approx()\n-1.28306738270893e74\n```",
    "created_at": "2015-04-19T21:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251680",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:13'>Comment 13:</a>
@rwst: This is a reposting of my sage-support thread [here](https://groups.google.com/forum/#!topic/sage-support/E2YW4ddcwQI) where I gave some small reproductions of the problem.

---


The incomplete gamma function is resulting in negative outputs with positive real input, which shouldn't happen.


```
sage: gamma(60, 30).numerical_approx()
-1.28306738270893e74
```


Attached is a notebook showing the same in graphical form.

If I feed in numbers of a higher precision, I get the correct result:


```
sage: R10 = RealField(200)
sage: gamma(R10(60), R10(30)).numerical_approx()
1.38682990237888e80
```


My final problem is that there doesn't seem to be any way to get higher precision numbers to feed all the way through the plot function:


```
sage: show(plot3d(log(gamma(k, k*x)), (x, R10(0), R10(5/2)), (k, R10(1), R10(101))))
Launched jmol viewer for Graphics3d Object
```

(you would see a 3d graph with a bite out of it where the precision issue exists)


---

I'm able to reproduce it today on the latest sage:

```
$ ./sage -v
SageMath Version 6.7.beta1, Release Date: 2015-04-15

$ ./sage
sage: gamma(60, 30).numerical_approx()
-1.28306738270893e74
```



---

archive/issue_comments_251681.json:
```json
{
    "body": "Attachment: **[unstable incomplete gamma.ipynb.json.gz](https://github.com/sagemath/sage/files/ticket18210/b8b8aabaa8271947ec87728a4368df50.gz)**\n\ndemo of the gamma function's instability",
    "created_at": "2015-04-19T21:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251681",
    "user": "https://github.com/sagetrac-buck"
}
```

Attachment: **[unstable incomplete gamma.ipynb.json.gz](https://github.com/sagemath/sage/files/ticket18210/b8b8aabaa8271947ec87728a4368df50.gz)**

demo of the gamma function's instability



---

archive/issue_comments_251682.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+Wrong values from incomplete gamma:\n+\n+```\n+$ ./sage -v\n+SageMath Version 6.7.beta1, Release Date: 2015-04-15\n+\n+$ ./sage\n+sage: gamma(60, 30).numerical_approx()\n+-1.28306738270893e74\n+```\n+Reason is a bug in Pari:\n+\n+```\n+? \\p 50\n+   realprecision = 57 significant digits (50 digits displayed)\n+? incgam(60,30)\n+%2 = 1.3868299023788799504133735635863795825413935892945 E80\n+? \\p 30\n+   realprecision = 38 significant digits (30 digits displayed)\n+? incgam(60,30)\n+%3 = -1.23084064495468737276106696496 E74\n+```\n+\n+Previous description:\n+\n The following code:\n \n \n``````\n",
    "created_at": "2015-04-20T13:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251682",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+Wrong values from incomplete gamma:
+
+```
+$ ./sage -v
+SageMath Version 6.7.beta1, Release Date: 2015-04-15
+
+$ ./sage
+sage: gamma(60, 30).numerical_approx()
+-1.28306738270893e74
+```
+Reason is a bug in Pari:
+
+```
+? \p 50
+   realprecision = 57 significant digits (50 digits displayed)
+? incgam(60,30)
+%2 = 1.3868299023788799504133735635863795825413935892945 E80
+? \p 30
+   realprecision = 38 significant digits (30 digits displayed)
+? incgam(60,30)
+%3 = -1.23084064495468737276106696496 E74
+```
+
+Previous description:
+
 The following code:
 
 
``````




---

archive/issue_events_241184.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-20T13:00:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "title_is": "numerical bug in incomplete gamma function",
    "title_was": "Symbolic computation of Gamma related function crashes Sage",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241184"
}
```



---

archive/issue_comments_251683.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBTW this will be fixed with #16697 (needs review) because there we switched to mpmath for numerics. You can already use this in Sage via:\n\n```\nsage: from sage.libs.mpmath import utils as mpmath_utils\nsage: import mpmath\nsage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)\n1.28307801824120e74\n```\nThis ticket may be closed therefore (after the Pari devs have ack'ed the bug) as duplicate of #16697 (augmenting its description with the bug).",
    "created_at": "2015-04-20T13:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251683",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'>Comment 15:</a>
BTW this will be fixed with #16697 (needs review) because there we switched to mpmath for numerics. You can already use this in Sage via:

```
sage: from sage.libs.mpmath import utils as mpmath_utils
sage: import mpmath
sage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)
1.28307801824120e74
```
This ticket may be closed therefore (after the Pari devs have ack'ed the bug) as duplicate of #16697 (augmenting its description with the bug).



---

archive/issue_comments_251684.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2015-04-20T13:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251684",
    "user": "https://github.com/rwst"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_251685.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@rwst](#comment%3A15):\n> \n> ```\n> sage: from sage.libs.mpmath import utils as mpmath_utils\n> sage: import mpmath\n> sage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)\n> 1.28307801824120e74\n> ```\n\nAh no, that is wrong as well. I'll report to Johansson too.",
    "created_at": "2015-04-20T13:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251685",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@rwst](#comment%3A15):
> 
> ```
> sage: from sage.libs.mpmath import utils as mpmath_utils
> sage: import mpmath
> sage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)
> 1.28307801824120e74
> ```

Ah no, that is wrong as well. I'll report to Johansson too.



---

archive/issue_comments_251686.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**",
    "created_at": "2015-04-20T14:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251686",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**



---

archive/issue_comments_251687.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThe upstream tickets are:\n* Pari/GP: http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1689PARI/GP\n* mpmath: https://github.com/fredrik-johansson/mpmath/issues/311\n\nThanks for the report!",
    "created_at": "2015-04-20T14:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251687",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'>Comment 17:</a>
The upstream tickets are:
* Pari/GP: http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1689PARI/GP
* mpmath: https://github.com/fredrik-johansson/mpmath/issues/311

Thanks for the report!



---

archive/issue_comments_251688.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nNo, mpmath is correct. I confused lower/upper. So, as said, use the #16697 branch or better, review it:\n\n```\nsage: gamma(60,30).n()\n1.38682990237888e80\n```",
    "created_at": "2015-04-20T14:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251688",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'>Comment 18:</a>
No, mpmath is correct. I confused lower/upper. So, as said, use the #16697 branch or better, review it:

```
sage: gamma(60,30).n()
1.38682990237888e80
```



---

archive/issue_comments_251689.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI was wrong referring to #16697 because this is a different bug. This issue is still open upstream.",
    "created_at": "2015-07-29T08:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251689",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'>Comment 19:</a>
I was wrong referring to #16697 because this is a different bug. This issue is still open upstream.



---

archive/issue_comments_251690.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2015-07-29T08:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251690",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_251691.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nrws, could you please copy the relevant bits from #16697?\n\nI'm going to work to close this in coming weeks.",
    "created_at": "2015-07-29T15:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251691",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:20'>Comment 20:</a>
rws, could you please copy the relevant bits from #16697?

I'm going to work to close this in coming weeks.



---

archive/issue_comments_251692.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nDiscusion migrated from #16697\n\n---\n\nby buck:\n\n... this patch doesn't fix the numerical instability in incomplete gamma as promised elsewhere.\n\n```\nsage: gamma_inc_lower(25, 14.5).n()\n-6.63538851954338e22\nsage: gamma_inc_lower(25, 14.5).n(algorithm='mpmath')\n-6.63538851954338e22\nsage: gamma_inc_lower(25, 14.5).n(algorithm='pari')\n-6.63538851954338e22\n```\n\n\nby buck:\n\nOf note, gamma (even incomplete) is strictly positive in the reals; it's an integral of a strictly positive function.\n\n\u200bhttps://en.wikipedia.org/wiki/Incomplete_gamma_function#Definition\n\n\nby buck:\n\nWolfram gives the value of the same as 4.7e21, which seems correct.\n\u200bhttp://www.wolframalpha.com/input/?i=Gamma%5B25%2C+0%2C+14.5%5D\n\n\nby buck:\n\nActually, if I ask pari directly, it gets the correct value, so maybe the algorithm argument is broken?\n\n```\nsage: pari('gamma(25) - incgam(25, 14.5)')\n4.71197173824555 E21\nsage: pari('incgamc(25, 14.5)')\n4.71197173824555 E21\n```\n\n\nby buck:\n\n\nSame story if I ask mpmath directly. I can't imagine what's wrong.\n\n```\nsage: call(mpmath.gammainc, 25, 0, 14.5)\n4.71197173824555e21\n```\n\n\nby rws:\n\nReplying to buck:\n> Same story if I ask mpmath directly. I can't imagine what's wrong.\n\n'algorithm' isn't propagated to evalf so we always get the buggy pari values. As we would have to switch the default anyway as soon as a later pari version fixes the bug, I'll now simply disable pari. We'll have to live with mpmath's 53 bits for now.\n\n\nby rws:\n\nReplying to buck:\n> Actually, if I ask pari directly, it gets the correct value, so maybe the algorithm argument is broken?\n> \n> ```\n> sage: pari('gamma(25) - incgam(25, 14.5)')\n> 4.71197173824555 E21\n> sage: pari('incgamc(25, 14.5)')\n> 4.71197173824555 E21\n> ```\n\nThis works because it uses the gp interface (the libpari might be broken on our side). Ah, that's two different bugs. However, even if it is in our interface to libpari and we fix this, or if we use the gp interface, there is still the unfixed pari bug at\n\u200bhttp://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1689PARI/GP\n\n\nby rws:\n\nActually the 53-bit restriction applies only to larger values, so all is not lost.",
    "created_at": "2015-07-30T01:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251692",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:21'>Comment 21:</a>
Discusion migrated from #16697

---

by buck:

... this patch doesn't fix the numerical instability in incomplete gamma as promised elsewhere.

```
sage: gamma_inc_lower(25, 14.5).n()
-6.63538851954338e22
sage: gamma_inc_lower(25, 14.5).n(algorithm='mpmath')
-6.63538851954338e22
sage: gamma_inc_lower(25, 14.5).n(algorithm='pari')
-6.63538851954338e22
```


by buck:

Of note, gamma (even incomplete) is strictly positive in the reals; it's an integral of a strictly positive function.

​https://en.wikipedia.org/wiki/Incomplete_gamma_function#Definition


by buck:

Wolfram gives the value of the same as 4.7e21, which seems correct.
​http://www.wolframalpha.com/input/?i=Gamma%5B25%2C+0%2C+14.5%5D


by buck:

Actually, if I ask pari directly, it gets the correct value, so maybe the algorithm argument is broken?

```
sage: pari('gamma(25) - incgam(25, 14.5)')
4.71197173824555 E21
sage: pari('incgamc(25, 14.5)')
4.71197173824555 E21
```


by buck:


Same story if I ask mpmath directly. I can't imagine what's wrong.

```
sage: call(mpmath.gammainc, 25, 0, 14.5)
4.71197173824555e21
```


by rws:

Replying to buck:
> Same story if I ask mpmath directly. I can't imagine what's wrong.

'algorithm' isn't propagated to evalf so we always get the buggy pari values. As we would have to switch the default anyway as soon as a later pari version fixes the bug, I'll now simply disable pari. We'll have to live with mpmath's 53 bits for now.


by rws:

Replying to buck:
> Actually, if I ask pari directly, it gets the correct value, so maybe the algorithm argument is broken?
> 
> ```
> sage: pari('gamma(25) - incgam(25, 14.5)')
> 4.71197173824555 E21
> sage: pari('incgamc(25, 14.5)')
> 4.71197173824555 E21
> ```

This works because it uses the gp interface (the libpari might be broken on our side). Ah, that's two different bugs. However, even if it is in our interface to libpari and we fix this, or if we use the gp interface, there is still the unfixed pari bug at
​http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1689PARI/GP


by rws:

Actually the 53-bit restriction applies only to larger values, so all is not lost.



---

archive/issue_comments_251693.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n@rwst: Could you expand on the \"two different bugs\" and link them (and/or create tickets for them)?\n\nAlso, could you explain why \"because it uses the gp interface\" would obscure the negative-number return value?",
    "created_at": "2015-07-30T01:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251693",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:22'>Comment 22:</a>
@rwst: Could you expand on the "two different bugs" and link them (and/or create tickets for them)?

Also, could you explain why "because it uses the gp interface" would obscure the negative-number return value?



---

archive/issue_comments_251694.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [buck](#comment%3A22):\n> @rwst: Could you expand on the \"two different bugs\" and link them (and/or create tickets for them)?\n\nOkay, this ticket is the `(60,30)` bug from [comment:13](#comment%3A13), i.e. `gamma(60, 30).numerical_approx()`. The other one is the fact that `gamma(25,14.5)` and `CC(25).gamma_inc(14.5)`, which both use libpari, give\n\n```\nsage: CC(25).gamma_inc(14.5)\n6.86802286928673e23\nsage: gamma(25,14.5)\n6.86802286928673e23\n```\nwhile \n\n```\nsage: pari('incgam(25, 14.5)')\n6.15736429994994 E23\n```\nBut then, we see also \n\n```\nsage: pari('incgam(60,30)')\n-1.23084064495469 E74\nsage: gamma(60,30).n()\n-1.28306738270893e74\n```\nso there is a mismatch between the two interfaces, and the gp interface is sometimes right where libpari is wrong.\n> Also, could you explain why \"because it uses the gp interface\" would obscure the negative-number return value?\n\nBecause the gp interface is sometimes right, apparently.\n\nHowever, I don't think it useful to open two tickets as long as we don't know if there really are two different bugs.",
    "created_at": "2015-07-30T06:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251694",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [buck](#comment%3A22):
> @rwst: Could you expand on the "two different bugs" and link them (and/or create tickets for them)?

Okay, this ticket is the `(60,30)` bug from [comment:13](#comment%3A13), i.e. `gamma(60, 30).numerical_approx()`. The other one is the fact that `gamma(25,14.5)` and `CC(25).gamma_inc(14.5)`, which both use libpari, give

```
sage: CC(25).gamma_inc(14.5)
6.86802286928673e23
sage: gamma(25,14.5)
6.86802286928673e23
```
while 

```
sage: pari('incgam(25, 14.5)')
6.15736429994994 E23
```
But then, we see also 

```
sage: pari('incgam(60,30)')
-1.23084064495469 E74
sage: gamma(60,30).n()
-1.28306738270893e74
```
so there is a mismatch between the two interfaces, and the gp interface is sometimes right where libpari is wrong.
> Also, could you explain why "because it uses the gp interface" would obscure the negative-number return value?

Because the gp interface is sometimes right, apparently.

However, I don't think it useful to open two tickets as long as we don't know if there really are two different bugs.



---

archive/issue_comments_251695.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThe bug reported in the OP seems gone; I can't reproduce the segfault.\nCan we change the topic of the bug to strictly about the numerical issue?\nThat seems to be what most of the discussion was about.",
    "created_at": "2015-07-30T16:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251695",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:24'>Comment 24:</a>
The bug reported in the OP seems gone; I can't reproduce the segfault.
Can we change the topic of the bug to strictly about the numerical issue?
That seems to be what most of the discussion was about.



---

archive/issue_comments_251696.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\n@rwst: I'll spend some time digging into this myself, and produce a pari and/or gp patch if I can, but I'm a bit lost as to where to start. Could you give some clues as to how I might pointpoint the issue, what code I should look at patching?",
    "created_at": "2015-07-30T16:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251696",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:25'>Comment 25:</a>
@rwst: I'll spend some time digging into this myself, and produce a pari and/or gp patch if I can, but I'm a bit lost as to where to start. Could you give some clues as to how I might pointpoint the issue, what code I should look at patching?



---

archive/issue_comments_251697.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nIn my opinion the Pari bug (which shows itself when using the GP/Pari program without Sage) should be fixed first. This means looking into the Pari code and reporting to its developers on that ticket already given in [comment:17](#comment%3A17). After that it remains to be seen what's still wrong. For completeness Sage's libpari interface is in `libs/pari`.",
    "created_at": "2015-07-31T06:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251697",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'>Comment 26:</a>
In my opinion the Pari bug (which shows itself when using the GP/Pari program without Sage) should be fixed first. This means looking into the Pari code and reporting to its developers on that ticket already given in [comment:17](#comment%3A17). After that it remains to be seen what's still wrong. For completeness Sage's libpari interface is in `libs/pari`.



---

archive/issue_comments_251698.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nKarim Belabas of Pari just sent:\n\n```\nI believe the problem is now fixed in master by the following commit\n(rewritten from Henri Cohen's proposed patch)\n\ncommit 4276cc667123a92373c4aff7195eb728dd39f6e1\nAuthor: Karim Belabas <Karim.Belabas@math.u-bordeaux1.fr>\nDate:   Fri Jan 15 15:58:17 2016 +0100\n\n    HC140- incgam(30,60) < 0. More generally, wrong results for s >> 1 [#1689]\n\nSorry it took so long. Please test and report problems !\n```",
    "created_at": "2016-01-16T14:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251698",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'>Comment 27:</a>
Karim Belabas of Pari just sent:

```
I believe the problem is now fixed in master by the following commit
(rewritten from Henri Cohen's proposed patch)

commit 4276cc667123a92373c4aff7195eb728dd39f6e1
Author: Karim Belabas <Karim.Belabas@math.u-bordeaux1.fr>
Date:   Fri Jan 15 15:58:17 2016 +0100

    HC140- incgam(30,60) < 0. More generally, wrong results for s >> 1 [#1689]

Sorry it took so long. Please test and report problems !
```



---

archive/issue_comments_251699.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThanks! Building master sagemath branch now...",
    "created_at": "2016-01-16T18:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251699",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:28'>Comment 28:</a>
Thanks! Building master sagemath branch now...



---

archive/issue_comments_251700.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nI still get the same broken graph in sage master.\n\nSage is at a1b60f2c3e06171caa4aa044a73ea58236686d30 and pari is at 'GP/PARI CALCULATOR Version 2.8.0 (development git-6157df4)'.\n\n\nI can't tell immediately if that's before or after the referenced pari commit above.",
    "created_at": "2016-01-17T22:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251700",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:29'>Comment 29:</a>
I still get the same broken graph in sage master.

Sage is at a1b60f2c3e06171caa4aa044a73ea58236686d30 and pari is at 'GP/PARI CALCULATOR Version 2.8.0 (development git-6157df4)'.


I can't tell immediately if that's before or after the referenced pari commit above.



---

archive/issue_comments_251701.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nAh after cloning pari, it's apparent that the installed sage version is four months behind the fixing commit.\n\nI'll try to find in the docs how to get sage to install this newer version.",
    "created_at": "2016-01-17T22:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251701",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:30'>Comment 30:</a>
Ah after cloning pari, it's apparent that the installed sage version is four months behind the fixing commit.

I'll try to find in the docs how to get sage to install this newer version.



---

archive/issue_comments_251702.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nProcedure:\n\n```sh\ncd $PARI_ROOT\nTAG=$(git describe)     \ngit archive HEAD -o $TAG.tar.gz --prefix=$TAG/\nmv pari-2.8-2230-g450ce38.tar.gz $SAGE_ROOT/upstream/ \ncd $SAGE_ROOT\n./sage --fix-pkg-checksums\n./sage -i -f -c pari\n```\n\n\nChanges to sage: (I had to touch up one of the patches to get it to apply.)\n\n```diff \ndiff --git a/build/pkgs/pari/checksums.ini b/build/pkgs/pari/checksums.ini\nindex c62c530..aabe08d 100644\n--- a/build/pkgs/pari/checksums.ini\n+++ b/build/pkgs/pari/checksums.ini\n@@ -1,4 +1,4 @@\n tarball=pari-VERSION.tar.gz\n-sha1=fa23e0c8b6e38a356048d19224dc9b9658d77724\n-md5=c753faaa4780de5ad8d461f0ffd70ecf\n-cksum=1220765312\n+sha1=55299bfe042da491648897e830030083809d9967\n+md5=97738f8e92bba498f7dfd723c8e9d910\n+cksum=1221580104\ndiff --git a/build/pkgs/pari/package-version.txt b/build/pkgs/pari/package-version.txt\nindex 2b25bd1..5fdd71e 100644\n--- a/build/pkgs/pari/package-version.txt\n+++ b/build/pkgs/pari/package-version.txt\n@@ -1 +1 @@\n-2.8-1813-g6157df4.p0\n+2.8-2230-g450ce38\ndiff --git a/build/pkgs/pari/patches/public_memory_functions.patch b/build/pkgs/pari/patches/public_memory_functions.patch\nindex b3726d7..ee14fa4 100644\n--- a/build/pkgs/pari/patches/public_memory_functions.patch\n+++ b/build/pkgs/pari/patches/public_memory_functions.patch\n@@ -9,9 +9,9 @@ index 7067183..4ede6ed 100644\n +void *  pari_mainstack_malloc(size_t size);\n +void    pari_mainstack_mfree(void *s, size_t size);\n +void    pari_mainstack_free(struct pari_mainstack *st);\n- void    paristack_alloc(size_t rsize, size_t vsize);\n  void    paristack_newrsize(ulong newsize);\n  void    paristack_resize(ulong newsize);\n+ void    paristack_setsize(size_t rsize, size_t vsize);\n diff --git a/src/language/init.c b/src/language/init.c\n index 7b5922d..2a578d7 100644\n --- a/src/language/init.c\n```\n\nI also had to install bison to get the build to run, which I hadn't installed before, but I *had* built pari before (I think!) so I believe that's a new build dependency there?\n\nResult: `Successfully installed pari-2.8-2230-g450ce38; The PARI self-tests all passed`\n\nThe sage console fails to start however, with `ImportError: sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so: undefined symbol: gp_algcenter`",
    "created_at": "2016-01-17T23:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251702",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:31'>Comment 31:</a>
Procedure:

```sh
cd $PARI_ROOT
TAG=$(git describe)     
git archive HEAD -o $TAG.tar.gz --prefix=$TAG/
mv pari-2.8-2230-g450ce38.tar.gz $SAGE_ROOT/upstream/ 
cd $SAGE_ROOT
./sage --fix-pkg-checksums
./sage -i -f -c pari
```


Changes to sage: (I had to touch up one of the patches to get it to apply.)

```diff 
diff --git a/build/pkgs/pari/checksums.ini b/build/pkgs/pari/checksums.ini
index c62c530..aabe08d 100644
--- a/build/pkgs/pari/checksums.ini
+++ b/build/pkgs/pari/checksums.ini
@@ -1,4 +1,4 @@
 tarball=pari-VERSION.tar.gz
-sha1=fa23e0c8b6e38a356048d19224dc9b9658d77724
-md5=c753faaa4780de5ad8d461f0ffd70ecf
-cksum=1220765312
+sha1=55299bfe042da491648897e830030083809d9967
+md5=97738f8e92bba498f7dfd723c8e9d910
+cksum=1221580104
diff --git a/build/pkgs/pari/package-version.txt b/build/pkgs/pari/package-version.txt
index 2b25bd1..5fdd71e 100644
--- a/build/pkgs/pari/package-version.txt
+++ b/build/pkgs/pari/package-version.txt
@@ -1 +1 @@
-2.8-1813-g6157df4.p0
+2.8-2230-g450ce38
diff --git a/build/pkgs/pari/patches/public_memory_functions.patch b/build/pkgs/pari/patches/public_memory_functions.patch
index b3726d7..ee14fa4 100644
--- a/build/pkgs/pari/patches/public_memory_functions.patch
+++ b/build/pkgs/pari/patches/public_memory_functions.patch
@@ -9,9 +9,9 @@ index 7067183..4ede6ed 100644
 +void *  pari_mainstack_malloc(size_t size);
 +void    pari_mainstack_mfree(void *s, size_t size);
 +void    pari_mainstack_free(struct pari_mainstack *st);
- void    paristack_alloc(size_t rsize, size_t vsize);
  void    paristack_newrsize(ulong newsize);
  void    paristack_resize(ulong newsize);
+ void    paristack_setsize(size_t rsize, size_t vsize);
 diff --git a/src/language/init.c b/src/language/init.c
 index 7b5922d..2a578d7 100644
 --- a/src/language/init.c
```

I also had to install bison to get the build to run, which I hadn't installed before, but I *had* built pari before (I think!) so I believe that's a new build dependency there?

Result: `Successfully installed pari-2.8-2230-g450ce38; The PARI self-tests all passed`

The sage console fails to start however, with `ImportError: sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so: undefined symbol: gp_algcenter`



---

archive/issue_comments_251703.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nSubsequent `make` fails during pari autoregen:\n\n```\npython -c \"from sage_setup.autogen.pari import rebuild; rebuild()\"\nGenerating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan Col Colrev (DEBUGLEVEL) Euler I List Map Mat Mod (O) \n...\ngaloispermtopol galoissubcyclo galoissubfields galoissubgroups gamma gammah gammamellininvTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"sage_setup/autogen/pari/__init__.py\", line 5, in rebuild\n    G()\n  File \"sage_setup/autogen/pari/generator.py\", line 247, in __call__\n    self.handle_pari_function(**v)\n  File \"sage_setup/autogen/pari/generator.py\", line 173, in handle_pari_function\n    args, ret = parse_prototype(prototype, help)\n  File \"sage_setup/autogen/pari/parser.py\", line 204, in parse_prototype\n    raise ValueError('unknown prototype character %r' % c)\nValueError: unknown prototype character 'b'\n```\n\nI note that the build gets into a weird state afterward because the file being generated (`src/sage/libs/pari/auto_gen.pxi`) is written to even though its generation failed. We could avoid this state by making a patch like so:\n\n\n```diff\ndiff --git a/src/sage_setup/autogen/pari/generator.py b/src/sage_setup/autogen/pari/generator.py\nindex 7aa9990..9b78d88 100644\n--- a/src/sage_setup/autogen/pari/generator.py\n+++ b/src/sage_setup/autogen/pari/generator.py\n@@ -233,9 +233,9 @@ class PariFunctionGenerator(object):\n         D = sorted(D.values(), key=lambda d: d['function'])\n         sys.stdout.write(\"Generating PARI functions:\")\n \n-        self.gen_file = open(self.gen_filename, 'w')\n+        self.gen_file = open(self.gen_filename + '.tmp', 'w')\n         self.gen_file.write(gen_banner)\n-        self.instance_file = open(self.instance_filename, 'w')\n+        self.instance_file = open(self.instance_filename + '.tmp', 'w')\n         self.instance_file.write(instance_banner)\n \n         for v in D:\n@@ -249,3 +249,7 @@ class PariFunctionGenerator(object):\n \n         self.gen_file.close()\n         self.instance_file.close()\n+\n+        # All done? Let's commit.\n+        os.rename(self.gen_filename + '.tmp', self.gen_filename)\n+        os.rename(self.instance_filename + '.tmp', self.instance_filename)\n```\n\nI'm out of my depth at this point. I think I need help from someone that actually know what pari is at all =X",
    "created_at": "2016-01-17T23:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251703",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:32'>Comment 32:</a>
Subsequent `make` fails during pari autoregen:

```
python -c "from sage_setup.autogen.pari import rebuild; rebuild()"
Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan Col Colrev (DEBUGLEVEL) Euler I List Map Mat Mod (O) 
...
galoispermtopol galoissubcyclo galoissubfields galoissubgroups gamma gammah gammamellininvTraceback (most recent call last):
  File "<string>", line 1, in <module>
  File "sage_setup/autogen/pari/__init__.py", line 5, in rebuild
    G()
  File "sage_setup/autogen/pari/generator.py", line 247, in __call__
    self.handle_pari_function(**v)
  File "sage_setup/autogen/pari/generator.py", line 173, in handle_pari_function
    args, ret = parse_prototype(prototype, help)
  File "sage_setup/autogen/pari/parser.py", line 204, in parse_prototype
    raise ValueError('unknown prototype character %r' % c)
ValueError: unknown prototype character 'b'
```

I note that the build gets into a weird state afterward because the file being generated (`src/sage/libs/pari/auto_gen.pxi`) is written to even though its generation failed. We could avoid this state by making a patch like so:


```diff
diff --git a/src/sage_setup/autogen/pari/generator.py b/src/sage_setup/autogen/pari/generator.py
index 7aa9990..9b78d88 100644
--- a/src/sage_setup/autogen/pari/generator.py
+++ b/src/sage_setup/autogen/pari/generator.py
@@ -233,9 +233,9 @@ class PariFunctionGenerator(object):
         D = sorted(D.values(), key=lambda d: d['function'])
         sys.stdout.write("Generating PARI functions:")
 
-        self.gen_file = open(self.gen_filename, 'w')
+        self.gen_file = open(self.gen_filename + '.tmp', 'w')
         self.gen_file.write(gen_banner)
-        self.instance_file = open(self.instance_filename, 'w')
+        self.instance_file = open(self.instance_filename + '.tmp', 'w')
         self.instance_file.write(instance_banner)
 
         for v in D:
@@ -249,3 +249,7 @@ class PariFunctionGenerator(object):
 
         self.gen_file.close()
         self.instance_file.close()
+
+        # All done? Let's commit.
+        os.rename(self.gen_filename + '.tmp', self.gen_filename)
+        os.rename(self.instance_filename + '.tmp', self.instance_filename)
```

I'm out of my depth at this point. I think I need help from someone that actually know what pari is at all =X



---

archive/issue_comments_251704.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nI believe I've fixed the `ValueError: unknown prototype character 'b'` issue. Pari recently added the concept of \"bit precision\", which (I believe) is the natural precision format in sage, so needs no conversion:\n\n```diff\ndiff --git a/src/sage_setup/autogen/pari/args.py b/src/sage_setup/autogen/pari/args.py\nindex 57356b4..a2749df 100644\n--- a/src/sage_setup/autogen/pari/args.py\n+++ b/src/sage_setup/autogen/pari/args.py\n@@ -254,6 +254,16 @@ class PariArgumentPrec(PariArgumentClass):\n         s = \"        {name} = prec_bits_to_words({name})\\n\"\n         return s.format(name=self.name)\n \n+class PariArgumentBitPrec(PariArgumentClass):\n+    def _typerepr(self):\n+        return \"bitprec\"\n+    def ctype(self):\n+        return \"long\"\n+    def always_default(self):\n+        return \"0\"\n+    def get_argument_name(self, namesiter):\n+        return \"bitprecision\"\n+\n class PariArgumentSeriesPrec(PariArgumentClass):\n     def _typerepr(self):\n         return \"serprec\"\n@@ -277,6 +287,7 @@ pari_arg_types = {\n         'U': PariArgumentULong,\n         'n': PariArgumentVariable,\n         'p': PariArgumentPrec,\n+        'b': PariArgumentBitPrec,\n         'P': PariArgumentSeriesPrec,\n \n     # Codes which are known but not actually supported for Sage\n```\n\nThere's again a further issue that I don't understand yet:\n\n```\nCompiling sage/libs/pari/pari_instance.pyx because it depends on sage/libs/pari/auto_instance.pxi.\n[1/2] Cythonizing sage/libs/pari/gen.pyx\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            \n            [0 0 -2 -1]\n        \"\"\"\n        cdef GEN _al = al.g\n        pari_catch_sig_on()\n        cdef GEN _ret = algmultable(_al)\n                                  ^\n------------------------------------------------------------\n\nsage/libs/pari/auto_gen.pxi:1558:35: Call with wrong number of arguments (expected 2, got 1)\n```\n\nOn brief inspection, I don't see that the number of arguments should have changed.",
    "created_at": "2016-01-18T01:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251704",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:33'>Comment 33:</a>
I believe I've fixed the `ValueError: unknown prototype character 'b'` issue. Pari recently added the concept of "bit precision", which (I believe) is the natural precision format in sage, so needs no conversion:

```diff
diff --git a/src/sage_setup/autogen/pari/args.py b/src/sage_setup/autogen/pari/args.py
index 57356b4..a2749df 100644
--- a/src/sage_setup/autogen/pari/args.py
+++ b/src/sage_setup/autogen/pari/args.py
@@ -254,6 +254,16 @@ class PariArgumentPrec(PariArgumentClass):
         s = "        {name} = prec_bits_to_words({name})\n"
         return s.format(name=self.name)
 
+class PariArgumentBitPrec(PariArgumentClass):
+    def _typerepr(self):
+        return "bitprec"
+    def ctype(self):
+        return "long"
+    def always_default(self):
+        return "0"
+    def get_argument_name(self, namesiter):
+        return "bitprecision"
+
 class PariArgumentSeriesPrec(PariArgumentClass):
     def _typerepr(self):
         return "serprec"
@@ -277,6 +287,7 @@ pari_arg_types = {
         'U': PariArgumentULong,
         'n': PariArgumentVariable,
         'p': PariArgumentPrec,
+        'b': PariArgumentBitPrec,
         'P': PariArgumentSeriesPrec,
 
     # Codes which are known but not actually supported for Sage
```

There's again a further issue that I don't understand yet:

```
Compiling sage/libs/pari/pari_instance.pyx because it depends on sage/libs/pari/auto_instance.pxi.
[1/2] Cythonizing sage/libs/pari/gen.pyx

Error compiling Cython file:
------------------------------------------------------------
...
            
            [0 0 -2 -1]
        """
        cdef GEN _al = al.g
        pari_catch_sig_on()
        cdef GEN _ret = algmultable(_al)
                                  ^
------------------------------------------------------------

sage/libs/pari/auto_gen.pxi:1558:35: Call with wrong number of arguments (expected 2, got 1)
```

On brief inspection, I don't see that the number of arguments should have changed.



---

archive/issue_comments_251705.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nWhile this is great work I believe you should open a separate Pari upgrade ticket for this.",
    "created_at": "2016-01-18T06:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251705",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'>Comment 34:</a>
While this is great work I believe you should open a separate Pari upgrade ticket for this.



---

archive/issue_comments_251706.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\n@rwst Yes I didn't anticipate this would be such work. Will do.",
    "created_at": "2016-01-18T06:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251706",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:35'>Comment 35:</a>
@rwst Yes I didn't anticipate this would be such work. Will do.



---

archive/issue_comments_251707.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nPari upgrade work migrated to #19905.",
    "created_at": "2016-01-18T06:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251707",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:36'>Comment 36:</a>
Pari upgrade work migrated to #19905.



---

archive/issue_comments_251708.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nI was finally able to integrate pari master-branch with sage, and while the problem is much improved, it's not fixed. Here's the graph from the original bug report, using newest pari:\n\n![](broken-graph-2016.png)\ufffc\ufffc\n\n\nThose discontinuities are false. An example bad value:\n\n```\nsage: gamma(100, 7.01)\n-2.71843697211100e151\n```\nI will report this upstream, and attach a worksheet showing more detail.",
    "created_at": "2016-01-18T22:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251708",
    "user": "https://github.com/sagetrac-buck"
}
```

<a id='comment:37'>Comment 37:</a>
I was finally able to integrate pari master-branch with sage, and while the problem is much improved, it's not fixed. Here's the graph from the original bug report, using newest pari:

![](broken-graph-2016.png)￼￼


Those discontinuities are false. An example bad value:

```
sage: gamma(100, 7.01)
-2.71843697211100e151
```
I will report this upstream, and attach a worksheet showing more detail.



---

archive/issue_comments_251709.json:
```json
{
    "body": "Attachment: **[unstable incomplete gamma.pdf.gz](https://github.com/sagemath/sage/files/ticket18210/d2f40433fe2550cb2042cc960f4f662e.gz)**",
    "created_at": "2016-01-18T22:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251709",
    "user": "https://github.com/sagetrac-buck"
}
```

Attachment: **[unstable incomplete gamma.pdf.gz](https://github.com/sagemath/sage/files/ticket18210/d2f40433fe2550cb2042cc960f4f662e.gz)**



---

archive/issue_comments_251710.json:
```json
{
    "body": "Attachment: **[unstable incomplete gamma.ipynb.gz](https://github.com/sagemath/sage/files/ticket18210/64e3a837a60eee20f0806dd584d48f78.gz)**\n\nAttachment: **[broken-graph-2016.png.gz](https://github.com/sagemath/sage/files/ticket18210/broken-graph-2016.png.gz)**",
    "created_at": "2016-01-18T22:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251710",
    "user": "https://github.com/sagetrac-buck"
}
```

Attachment: **[unstable incomplete gamma.ipynb.gz](https://github.com/sagemath/sage/files/ticket18210/64e3a837a60eee20f0806dd584d48f78.gz)**

Attachment: **[broken-graph-2016.png.gz](https://github.com/sagemath/sage/files/ticket18210/broken-graph-2016.png.gz)**



---

archive/issue_comments_251711.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nThis ticket seems to be solved now in Sage 7.3.beta9.\n\nTrying the code from the ticket description...\n\n```\n$ ./sage -v\nSageMath version 7.3.beta9, Release Date: 2016-07-22\n$ ./sage -q\nsage: gamma(60, 30).numerical_approx()\n1.38682990237888e80\n```\n\n```\nsage: %gp\n\n  --> Switching to PARI/GP interpreter <--\n\npari: \\p 50\nrealprecision = 57 significant digits (50 digits displayed)\npari: incgam(60,30)\n1.3868299023788801161747839921239559320835799009004 E80\npari: \\p 30\nrealprecision = 38 significant digits (30 digits displayed)\npari: incgam(60,30)\n1.38682990237888011617478399212 E80\npari: <ctrl-D>\n\n  --> Exiting back to Sage <--\n\n```\n\n```\nsage: _ = var('R k')\nsage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)\nsage: plot(integrated.subs(k=41), (R,0,6))\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\nsage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)\nsage: plot(integrated.subs(k=41.), (R,0,6))\nLaunched png viewer for Graphics object consisting of 2 graphics primitives\n```\n\n```\nsage: from sage.libs.mpmath import utils as mpmath_utils\nsage: import mpmath\nsage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)\n1.28307801824120e74\n```\n\nReplying to [buck](#comment%3A37):\n> I was finally able to integrate pari master-branch with sage, and while the problem is much improved, it's not fixed.\n> Here's the graph from the original bug report, using newest pari:\n\nTrying that now seems to work for me, I get nice graphs with no spikes.\n\n```\nsage: sum(\n....:     plot(\n....:         integrated(k=k),\n....:         (x, 0, 2.5),\n....:         ymax=1.6,\n....:         color=color,\n....:         legend_label='k=%i' % k,\n....:         figsize=6,\n....:         aspect_ratio=1.0,\n....:     )\n....:     for k, color in zip(\n....:         [21, 22, 23, 26, 31, 41],\n....:         ['blue', 'brown', 'red', 'green', 'black', 'yellow', 'orange'],\n....:     )\n....: )\nLaunched png viewer for Graphics object consisting of 6 graphics primitives\n```\n\n> Those discontinuities are false. An example bad value:\n> \n> ```\n> sage: gamma(100, 7.01)\n> -2.71843697211100e151\n> ```\n> I will report this upstream, and attach a worksheet showing more detail.\n\nWhat is the correct value? I get the following in Sage 7.3.beta9.\n\n```\nsage: gamma(100, 7.01)\n9.33262154439442e155\n```",
    "created_at": "2016-07-27T15:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251711",
    "user": "https://github.com/slel"
}
```

<a id='comment:38'>Comment 38:</a>
This ticket seems to be solved now in Sage 7.3.beta9.

Trying the code from the ticket description...

```
$ ./sage -v
SageMath version 7.3.beta9, Release Date: 2016-07-22
$ ./sage -q
sage: gamma(60, 30).numerical_approx()
1.38682990237888e80
```

```
sage: %gp

  --> Switching to PARI/GP interpreter <--

pari: \p 50
realprecision = 57 significant digits (50 digits displayed)
pari: incgam(60,30)
1.3868299023788801161747839921239559320835799009004 E80
pari: \p 30
realprecision = 38 significant digits (30 digits displayed)
pari: incgam(60,30)
1.38682990237888011617478399212 E80
pari: <ctrl-D>

  --> Exiting back to Sage <--

```

```
sage: _ = var('R k')
sage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)
sage: plot(integrated.subs(k=41), (R,0,6))
Launched png viewer for Graphics object consisting of 1 graphics primitive
sage: integrated = -(gamma(1/2*k, 1/2*R*k) - gamma(1/2*k))/gamma(1/2*k)
sage: plot(integrated.subs(k=41.), (R,0,6))
Launched png viewer for Graphics object consisting of 2 graphics primitives
```

```
sage: from sage.libs.mpmath import utils as mpmath_utils
sage: import mpmath
sage: mpmath_utils.call(mpmath.gammainc, 60, 0, 30)
1.28307801824120e74
```

Replying to [buck](#comment%3A37):
> I was finally able to integrate pari master-branch with sage, and while the problem is much improved, it's not fixed.
> Here's the graph from the original bug report, using newest pari:

Trying that now seems to work for me, I get nice graphs with no spikes.

```
sage: sum(
....:     plot(
....:         integrated(k=k),
....:         (x, 0, 2.5),
....:         ymax=1.6,
....:         color=color,
....:         legend_label='k=%i' % k,
....:         figsize=6,
....:         aspect_ratio=1.0,
....:     )
....:     for k, color in zip(
....:         [21, 22, 23, 26, 31, 41],
....:         ['blue', 'brown', 'red', 'green', 'black', 'yellow', 'orange'],
....:     )
....: )
Launched png viewer for Graphics object consisting of 6 graphics primitives
```

> Those discontinuities are false. An example bad value:
> 
> ```
> sage: gamma(100, 7.01)
> -2.71843697211100e151
> ```
> I will report this upstream, and attach a worksheet showing more detail.

What is the correct value? I get the following in Sage 7.3.beta9.

```
sage: gamma(100, 7.01)
9.33262154439442e155
```



---

archive/issue_comments_251712.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nReplying to [@slel](#comment%3A38):\n> This ticket seems to be solved now in Sage 7.3.beta9.\n\nAgree.\n\n> What is the correct value? I get the following in Sage 7.3.beta9.\n> \n> ```\n> sage: gamma(100, 7.01)\n> 9.33262154439442e155\n> ```\n\n```\nsage: ComplexBallField(200)(100).gamma(ComplexBallField(200)(701/100))\n[9.3326215443944152681699238856266700490715968264381621468593e+155 +/- 4.56e+96]\n```",
    "created_at": "2016-10-22T13:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251712",
    "user": "https://github.com/rwst"
}
```

<a id='comment:39'>Comment 39:</a>
Replying to [@slel](#comment%3A38):
> This ticket seems to be solved now in Sage 7.3.beta9.

Agree.

> What is the correct value? I get the following in Sage 7.3.beta9.
> 
> ```
> sage: gamma(100, 7.01)
> 9.33262154439442e155
> ```

```
sage: ComplexBallField(200)(100).gamma(ComplexBallField(200)(701/100))
[9.3326215443944152681699238856266700490715968264381621468593e+155 +/- 4.56e+96]
```



---

archive/issue_comments_251713.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2016-10-22T13:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18210#issuecomment-251713",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**



---

archive/issue_events_241185.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-10-22T13:36:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241185"
}
```



---

archive/issue_events_241186.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-10-22T13:36:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241186"
}
```



---

archive/issue_events_241187.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-10-22T13:36:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241187"
}
```



---

archive/issue_events_241188.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-10-22T13:36:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241188"
}
```



---

archive/issue_events_241189.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2016-10-22T15:24:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241189"
}
```



---

archive/issue_events_241190.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2016-10-22T15:24:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241190"
}
```



---

archive/issue_events_241191.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241191"
}
```



---

archive/issue_events_241192.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18210",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18210#event-241192"
}
```
