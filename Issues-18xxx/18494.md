# Issue 18494: Install sage headers and auxiliary files (.h/.pxd/.pxi files)

archive/issues_018257.json:
```json
{
    "assignees": [],
    "body": "Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.\n\n\n\nCC:  @sagetrac-jpflori @strogdon @frederichan-IMJPRG\n\nBranch/Commit: **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Fran\u00e7ois Bissey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18494_\n\n",
    "closed_at": "2015-06-12T18:23:51Z",
    "created_at": "2015-05-25T02:41:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Install sage headers and auxiliary files (.h/.pxd/.pxi files)",
    "type": "issue",
    "updated_at": "2015-06-12T18:23:51Z",
    "url": "https://github.com/sagemath/sage/issues/18494",
    "user": "https://github.com/kiwifb"
}
```
Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.



CC:  @sagetrac-jpflori @strogdon @frederichan-IMJPRG

Branch/Commit: **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**

Reviewer: **Jeroen Demeyer**

Author: **François Bissey**

_Issue created by migration from https://trac.sagemath.org/ticket/18494_





---

archive/issue_events_245044.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-25T02:41:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245044"
}
```



---

archive/issue_events_245045.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-25T02:41:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20distribution",
    "label_color": "000080",
    "label_name": "component: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245045"
}
```



---

archive/issue_events_245046.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-25T02:41:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245046"
}
```



---

archive/issue_events_245047.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-25T02:41:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245047"
}
```



---

archive/issue_comments_257795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Currently sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary to the good functioning  of sage are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of sage's build directory. It would be good if sage could just work without relying on the presence of it source and build directory. \n+Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of Sage's `build` directory. It would be good if sage could just work without relying on the presence of it source and build directory.\n``````\n",
    "created_at": "2015-05-25T06:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257795",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Currently sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary to the good functioning  of sage are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of sage's build directory. It would be good if sage could just work without relying on the presence of it source and build directory. 
+Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of Sage's `build` directory. It would be good if sage could just work without relying on the presence of it source and build directory.
``````




---

archive/issue_events_245048.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-05-25T06:53:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "title_is": "Install sage headers and auxiliary files (.h/.pxd/.pxi files)",
    "title_was": "Install sage headers and auxiliary files (.pxi/pxd)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245048"
}
```



---

archive/issue_comments_257796.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of Sage's `build` directory. It would be good if sage could just work without relying on the presence of it source and build directory.\n+Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.\n``````\n",
    "created_at": "2015-05-25T06:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257796",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of Sage's `build` directory. It would be good if sage could just work without relying on the presence of it source and build directory.
+Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.
``````




---

archive/issue_comments_257797.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI think we only really need the headers that are in `sage/ext/` and its sub-folders. That would include stuff like `ccobject.h` of p_group_cohomology recent fame. We may want to restrict headers to public interfaces to try to prevent that kind of stuff in the future. Apart from the `.pxi` and `.pxd` we would need the `.pyx` if we want to be able to run the doctests without the sources, that's possibly one step further after this ticket.",
    "created_at": "2015-05-25T09:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257797",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">Comment 4</div>

I think we only really need the headers that are in `sage/ext/` and its sub-folders. That would include stuff like `ccobject.h` of p_group_cohomology recent fame. We may want to restrict headers to public interfaces to try to prevent that kind of stuff in the future. Apart from the `.pxi` and `.pxd` we would need the `.pyx` if we want to be able to run the doctests without the sources, that's possibly one step further after this ticket.



---

archive/issue_comments_257798.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@kiwifb](#comment%3A4):\n> we would need the `.pyx` if we want to be able to run the doctests without the sources\n\nAnd the `.py` files of course, but I don't think we want that...",
    "created_at": "2015-05-25T13:38:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257798",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@kiwifb](#comment%3A4):
> we would need the `.pyx` if we want to be able to run the doctests without the sources

And the `.py` files of course, but I don't think we want that...



---

archive/issue_comments_257799.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nI'll take the last point as sarcasm. In any case I discovered that `interrupt_api.h` is not the only interesting generated header file that need shipping. `interrupt_api.h` wants `interrupt.h` which is generated in the same folder.",
    "created_at": "2015-05-25T21:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257799",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">Comment 6</div>

I'll take the last point as sarcasm. In any case I discovered that `interrupt_api.h` is not the only interesting generated header file that need shipping. `interrupt_api.h` wants `interrupt.h` which is generated in the same folder.



---

archive/issue_comments_257800.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nFields notes: \n* One would expect all `.py` files to be installed but `src/sage/doctest/tests/nodoctest.py` isn't.\n* `sage/misc/lazy_import_cache.py` has a test for the presence of `src` in the value of `get_cache_file()` I am not quite sure what is the point of this or why it needs to point to `SAGE_SRC` honestly. But that's out of this ticket's scope.\n\nFound that out in sage-on-gentoo by installing manually all headers, pxi, pxd, .pyx, .rst files plus generated headers, fixing pxi.h, not installing the sources at all and pointing `SAGE_SRC` to `/usr/lib64/python2.7/site-packages`. I am relatively impressed at how well that went but I know for a fact that some doctests were not run by my `sage -t --long --all` command (there is one doctest currently timing out on my sage-on-gentoo install and it was definitely not run). \n\nNow I have to seriously find a way of mostly generating all that stuff and to put it in `data_files` in `setup.py`.",
    "created_at": "2015-05-26T02:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257800",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

Fields notes: 
* One would expect all `.py` files to be installed but `src/sage/doctest/tests/nodoctest.py` isn't.
* `sage/misc/lazy_import_cache.py` has a test for the presence of `src` in the value of `get_cache_file()` I am not quite sure what is the point of this or why it needs to point to `SAGE_SRC` honestly. But that's out of this ticket's scope.

Found that out in sage-on-gentoo by installing manually all headers, pxi, pxd, .pyx, .rst files plus generated headers, fixing pxi.h, not installing the sources at all and pointing `SAGE_SRC` to `/usr/lib64/python2.7/site-packages`. I am relatively impressed at how well that went but I know for a fact that some doctests were not run by my `sage -t --long --all` command (there is one doctest currently timing out on my sage-on-gentoo install and it was definitely not run). 

Now I have to seriously find a way of mostly generating all that stuff and to put it in `data_files` in `setup.py`.



---

archive/issue_comments_257801.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@jdemeyer](#comment%3A5):\n> And the `.py` files of course, but I don't think we want that...\n\nWell, what I really wanted to say is that we shouldn't rely on the *installed* `.py` or `.pyx` files for doctests. I don't see it as a problem if running doctests requires the sources.",
    "created_at": "2015-05-26T09:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257801",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@jdemeyer](#comment%3A5):
> And the `.py` files of course, but I don't think we want that...

Well, what I really wanted to say is that we shouldn't rely on the *installed* `.py` or `.pyx` files for doctests. I don't see it as a problem if running doctests requires the sources.



---

archive/issue_comments_257802.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@kiwifb](#comment%3A6):\n> I'll take the last point as sarcasm. In any case I discovered that `interrupt_api.h` is not the only interesting generated header file that need shipping. `interrupt_api.h` wants `interrupt.h` which is generated in the same folder.\n\nTrue, I forgot about that. In any case, it doesn't change much: just treat those 2 files the same, as auto-generated by Cython.",
    "created_at": "2015-05-26T09:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257802",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@kiwifb](#comment%3A6):
> I'll take the last point as sarcasm. In any case I discovered that `interrupt_api.h` is not the only interesting generated header file that need shipping. `interrupt_api.h` wants `interrupt.h` which is generated in the same folder.

True, I forgot about that. In any case, it doesn't change much: just treat those 2 files the same, as auto-generated by Cython.



---

archive/issue_comments_257803.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThe bit about `pxi.h` is annoying. Once installed it needs the reference to `build/cythonized...` removed to be usable with an installed `interrupt_api.h` but it is necessary during the building phase unless `setup.py` is modified to have a specific build directory in `include_dirs`. Any other suggestions?",
    "created_at": "2015-05-26T10:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257803",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">Comment 10</div>

The bit about `pxi.h` is annoying. Once installed it needs the reference to `build/cythonized...` removed to be usable with an installed `interrupt_api.h` but it is necessary during the building phase unless `setup.py` is modified to have a specific build directory in `include_dirs`. Any other suggestions?



---

archive/issue_comments_257804.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIs there a way to change the order of operations? The following would work:\n\n1. Cythonize\n2. Install headers\n3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)",
    "created_at": "2015-05-26T10:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257804",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">Comment 11</div>

Is there a way to change the order of operations? The following would work:

1. Cythonize
2. Install headers
3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)



---

archive/issue_comments_257805.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI am not sure about \"installing\" the header but copying them in `SAGE_SRC` instead in step 2 would be sufficient (may be that's what you actually meant) if that can be done. I'll look into it.",
    "created_at": "2015-05-26T10:23:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257805",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

I am not sure about "installing" the header but copying them in `SAGE_SRC` instead in step 2 would be sufficient (may be that's what you actually meant) if that can be done. I'll look into it.



---

archive/issue_comments_257806.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@kiwifb](#comment%3A12):\n> I am not sure about \"installing\" the header but copying them in `SAGE_SRC` instead in step 2 would be sufficient\n\nI wouldn't copy stuff to `SAGE_SRC`. The build system should treat the source directory as read-only as much as possible.\n\nWhen you talked about \"an installed `interrupt_api.h`\" in [comment:10], which installation location did you mean?",
    "created_at": "2015-05-26T10:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257806",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@kiwifb](#comment%3A12):
> I am not sure about "installing" the header but copying them in `SAGE_SRC` instead in step 2 would be sufficient

I wouldn't copy stuff to `SAGE_SRC`. The build system should treat the source directory as read-only as much as possible.

When you talked about "an installed `interrupt_api.h`" in [comment:10], which installation location did you mean?



---

archive/issue_comments_257807.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nUltimately I was thinking `SAGE_LOCAL/lib/python2.7/site-packages/sage/ext/interrupt/`, site-packages is the final installation destination. I get what you mean by keeping source pristine, we would like building out of source as much as possible, must have hurt to mess up with that to autogenerate the pari stuff, of course you can argue that you prepared the source before putting it through `setup.py`.\n\nIn any case I am not sure what would effectively be a two passes approach is a good idea.",
    "created_at": "2015-05-26T11:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257807",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">Comment 14</div>

Ultimately I was thinking `SAGE_LOCAL/lib/python2.7/site-packages/sage/ext/interrupt/`, site-packages is the final installation destination. I get what you mean by keeping source pristine, we would like building out of source as much as possible, must have hurt to mess up with that to autogenerate the pari stuff, of course you can argue that you prepared the source before putting it through `setup.py`.

In any case I am not sure what would effectively be a two passes approach is a good idea.



---

archive/issue_comments_257808.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@kiwifb](#comment%3A14):\n> In any case I am not sure what would effectively be a two passes approach is a good idea.\n\nWell, you need to install the headers in any case. Does it make a big difference to do it before or after building extension modules?",
    "created_at": "2015-05-26T11:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257808",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@kiwifb](#comment%3A14):
> In any case I am not sure what would effectively be a two passes approach is a good idea.

Well, you need to install the headers in any case. Does it make a big difference to do it before or after building extension modules?



---

archive/issue_comments_257809.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@jdemeyer](#comment%3A15):\n> Replying to [@kiwifb](#comment%3A14):\n> > In any case I am not sure what would effectively be a two passes approach is a good idea.\n\n> Well, you need to install the headers in any case. Does it make a big difference to do it before or after building extension modules?\n\nIt does to me, it means that I need to make two ebuilds because I cannot break the order \"prepare/configure/build/install/merge\". I don't think it matters much to add an entry to `include_dirs` in `setup.py`. It is not used for anything but building/installing unlike `cython.py`.",
    "created_at": "2015-05-26T12:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257809",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@jdemeyer](#comment%3A15):
> Replying to [@kiwifb](#comment%3A14):
> > In any case I am not sure what would effectively be a two passes approach is a good idea.

> Well, you need to install the headers in any case. Does it make a big difference to do it before or after building extension modules?

It does to me, it means that I need to make two ebuilds because I cannot break the order "prepare/configure/build/install/merge". I don't think it matters much to add an entry to `include_dirs` in `setup.py`. It is not used for anything but building/installing unlike `cython.py`.



---

archive/issue_comments_257810.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nIn `cython.py`\n\n```\ninclude_dirs = [os.path.join(SAGE_LOCAL,'include','csage'),\n                os.path.join(SAGE_LOCAL,'include'), \\\n                os.path.join(SAGE_LOCAL,'include','python'+platform.python_version().rsplit('.', 1)[0]), \\\n                os.path.join(SAGE_LOCAL,'lib','python','site-packages','numpy','core','include'), \\\n                os.path.join(SAGE_SRC,'sage','ext'), \\\n                os.path.join(SAGE_SRC), \\\n                os.path.join(SAGE_SRC,'sage','gsl')]\n```\nAny ideas why we add `SAGE_SRC` and `SAGE_SRC/sage/gsl`? Neither has any headers in it although I am guessing `gsl` may have had once.",
    "created_at": "2015-05-26T22:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257810",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">Comment 17</div>

In `cython.py`

```
include_dirs = [os.path.join(SAGE_LOCAL,'include','csage'),
                os.path.join(SAGE_LOCAL,'include'), \
                os.path.join(SAGE_LOCAL,'include','python'+platform.python_version().rsplit('.', 1)[0]), \
                os.path.join(SAGE_LOCAL,'lib','python','site-packages','numpy','core','include'), \
                os.path.join(SAGE_SRC,'sage','ext'), \
                os.path.join(SAGE_SRC), \
                os.path.join(SAGE_SRC,'sage','gsl')]
```
Any ideas why we add `SAGE_SRC` and `SAGE_SRC/sage/gsl`? Neither has any headers in it although I am guessing `gsl` may have had once.



---

archive/issue_comments_257811.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThe correct list of include dirs is the one in `src/setup.py`. We should define them in one place and use the same list for `setup.py` and `cython.py`.",
    "created_at": "2015-05-27T05:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257811",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

The correct list of include dirs is the one in `src/setup.py`. We should define them in one place and use the same list for `setup.py` and `cython.py`.



---

archive/issue_comments_257812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.\n+\n+\n``````\n",
    "created_at": "2015-05-30T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257812",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Currently, Sage doesn't install any files other than `.py` and compiled cython code. Headers and other auxiliary files that are necessary for compiling user code (such as the `cython()` command or certain optional packages) are kept in the `src` directory and we rely on its presence. Since #18027 we also rely on the presence of the `src/build/cythonized` directory. It would be good if sage could just work without relying on the presence of it source and build directory.
+
+
``````




---

archive/issue_comments_257813.json:
```json
{
    "body": "Branch: **[u/fbissey/headers_install](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/headers_install)**",
    "created_at": "2015-05-30T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257813",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/headers_install](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/headers_install)**



---

archive/issue_events_245049.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-30T03:15:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245049"
}
```



---

archive/issue_comments_257814.json:
```json
{
    "body": "Commit: **[d76f95f](https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4)**",
    "created_at": "2015-05-30T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257814",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[d76f95f](https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4)**



---

archive/issue_comments_257815.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2015-05-30T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257815",
    "user": "https://github.com/kiwifb"
}
```

Author: **François Bissey**



---

archive/issue_comments_257816.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI disagree. include dirs being the same in `setup.py` and `cython.py` is on the nice to have list but there is no compelling reason why install time and runtime absolutely have to match. In this particular case having the same list in `cython.py` has in `setup.py` means that you want to use the source instead of the installed files at runtime. I don't find that compelling. I cannot really accept a cythonize/\"install headers\"/build/\"final install\" routine which could put the two in agreement. I think that's undue complication an breaking of standard building procedures.\n\nSo what the current branch does:\n* clean up the \"cythonized\" path from `pxi.h`\n* clean `cython.py` so it use installed include directories rather than source ones. Prune useless directories as well and use python mechanism as much as possible rather than path \"knowledge\" (potentially help python2.3 as well)\n* add cythonized include path in `setup.py` so that `pxi.h` can find the generated include files at build time\n* add sections to `setup.py` to install header files under `sage/ext` including the generated headers. Also install all `.pxi` and `.pxd` files\n* also replace one instance of path knowledge by python mechanism in `source.py`\n\nThere is more that could be done but I don't want to extend the scope of the ticket. I have bled a little on one extra file as it is.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4\">d76f95f</a></td><td><code>Instll headers and px{i,d} files. Makes cython.py use installed files rather than source, small clean up of path determination.</code></td></tr></table>\n",
    "created_at": "2015-05-30T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257816",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">Comment 19</div>

I disagree. include dirs being the same in `setup.py` and `cython.py` is on the nice to have list but there is no compelling reason why install time and runtime absolutely have to match. In this particular case having the same list in `cython.py` has in `setup.py` means that you want to use the source instead of the installed files at runtime. I don't find that compelling. I cannot really accept a cythonize/"install headers"/build/"final install" routine which could put the two in agreement. I think that's undue complication an breaking of standard building procedures.

So what the current branch does:
* clean up the "cythonized" path from `pxi.h`
* clean `cython.py` so it use installed include directories rather than source ones. Prune useless directories as well and use python mechanism as much as possible rather than path "knowledge" (potentially help python2.3 as well)
* add cythonized include path in `setup.py` so that `pxi.h` can find the generated include files at build time
* add sections to `setup.py` to install header files under `sage/ext` including the generated headers. Also install all `.pxi` and `.pxd` files
* also replace one instance of path knowledge by python mechanism in `source.py`

There is more that could be done but I don't want to extend the scope of the ticket. I have bled a little on one extra file as it is.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4">d76f95f</a></td><td><code>Instll headers and px{i,d} files. Makes cython.py use installed files rather than source, small clean up of path determination.</code></td></tr></table>




---

archive/issue_events_245050.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-30T05:24:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245050"
}
```



---

archive/issue_events_245051.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-30T05:24:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245051"
}
```



---

archive/issue_comments_257817.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nSome unexpected doctest failures to remedy, I hadn't tested sage_setup and got unexpected stuff in the notebook.",
    "created_at": "2015-05-30T05:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257817",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">Comment 20</div>

Some unexpected doctest failures to remedy, I hadn't tested sage_setup and got unexpected stuff in the notebook.



---

archive/issue_comments_257818.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nHi, is there any chance to review #9552 first and base this ticket on that?",
    "created_at": "2015-05-30T07:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257818",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">Comment 21</div>

Hi, is there any chance to review #9552 first and base this ticket on that?



---

archive/issue_comments_257819.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function\n\n```\n@cached_function\ndef sage_include_directories(sage_lib_dir):\n    \"\"\"\n    Return the list of include directories for compiling Sage extension modules.\n    \"\"\"\n    import numpy   # not a global import!\n    return [.......]\n```\nreturning the include directories for `cython()` if `sage_lib_dir` is `SAGE_LIB` and returning the include directories for `src/setup.py` if `sage_lib_dir` is `SAGE_SRC`. I haven't thought about is that much, but I think that's the right direction to go.\n\nAnd I do indeed agree that `sage/gsl` should be removed.",
    "created_at": "2015-05-30T07:58:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257819",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">Comment 22</div>

I would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function

```
@cached_function
def sage_include_directories(sage_lib_dir):
    """
    Return the list of include directories for compiling Sage extension modules.
    """
    import numpy   # not a global import!
    return [.......]
```
returning the include directories for `cython()` if `sage_lib_dir` is `SAGE_LIB` and returning the include directories for `src/setup.py` if `sage_lib_dir` is `SAGE_SRC`. I haven't thought about is that much, but I think that's the right direction to go.

And I do indeed agree that `sage/gsl` should be removed.



---

archive/issue_comments_257820.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nAnd what is so special about the two files `sage/libs/linkages/padics/*.pxi`?",
    "created_at": "2015-05-30T08:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257820",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

And what is so special about the two files `sage/libs/linkages/padics/*.pxi`?



---

archive/issue_comments_257821.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nMinor remark: please fix your indentation (multiples of 4 spaces) and\n\n```\n[\"add\", \"a\", \"space\", \"after\", \"commas\", \"in\", \"a\", \"list\"]\n```",
    "created_at": "2015-05-30T08:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257821",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">Comment 24</div>

Minor remark: please fix your indentation (multiples of 4 spaces) and

```
["add", "a", "space", "after", "commas", "in", "a", "list"]
```



---

archive/issue_comments_257822.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nI don't understand the two cases here:\n\n```\nif 'ext' in package:\n  python_package_data[package] = ['*.pyx', '*.pxd', '*.pxi','*.h']\nelse:\n  python_package_data[package] = ['*.pyx', '*.pxd', '*.pxi']\n```",
    "created_at": "2015-05-30T08:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257822",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">Comment 25</div>

I don't understand the two cases here:

```
if 'ext' in package:
  python_package_data[package] = ['*.pyx', '*.pxd', '*.pxi','*.h']
else:
  python_package_data[package] = ['*.pyx', '*.pxd', '*.pxi']
```



---

archive/issue_comments_257823.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nI originally thought only the headers in `sage/ext` and under where necessary but I hadn't put that theory through a harsh test yet. I am fixing that in the next iteration.",
    "created_at": "2015-05-30T08:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257823",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:26" align="right">Comment 26</div>

I originally thought only the headers in `sage/ext` and under where necessary but I hadn't put that theory through a harsh test yet. I am fixing that in the next iteration.



---

archive/issue_comments_257824.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nAlso, although installing `.pyx` files will not hurt, I wonder whether we really want to do that: I don't think that ordinary users are expected to run doctests...",
    "created_at": "2015-05-30T08:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257824",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">Comment 27</div>

Also, although installing `.pyx` files will not hurt, I wonder whether we really want to do that: I don't think that ordinary users are expected to run doctests...



---

archive/issue_comments_257825.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nI would not like to see every `pyx` file duplicated either...",
    "created_at": "2015-05-30T09:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257825",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:29" align="right">Comment 29</div>

I would not like to see every `pyx` file duplicated either...



---

archive/issue_comments_257826.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@jdemeyer](#comment%3A11):\n> Is there a way to change the order of operations? The following would work:\n> \n> 1. Cythonize\n> 2. Install headers\n> 3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)\n\nAt some point we also had #14397.\nNot sure if there was a followup to this ticket.",
    "created_at": "2015-05-30T09:31:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257826",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@jdemeyer](#comment%3A11):
> Is there a way to change the order of operations? The following would work:
> 
> 1. Cythonize
> 2. Install headers
> 3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)

At some point we also had #14397.
Not sure if there was a followup to this ticket.



---

archive/issue_comments_257827.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@sagetrac-jpflori](#comment%3A30):\n> Replying to [@jdemeyer](#comment%3A11):\n> > Is there a way to change the order of operations? The following would work:\n> > \n> > 1. Cythonize\n> > 2. Install headers\n> > 3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)\n\n> At some point we also had #14397.\n> Not sure if there was a followup to this ticket.\n\nHum, I guess so... and that is just what we do now with the `cythonized` directory.",
    "created_at": "2015-05-30T09:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257827",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@sagetrac-jpflori](#comment%3A30):
> Replying to [@jdemeyer](#comment%3A11):
> > Is there a way to change the order of operations? The following would work:
> > 
> > 1. Cythonize
> > 2. Install headers
> > 3. Compile modules (using the headers installed in step 2, not the ones generated in step 1)

> At some point we also had #14397.
> Not sure if there was a followup to this ticket.

Hum, I guess so... and that is just what we do now with the `cythonized` directory.



---

archive/issue_comments_257828.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nHum... Well there are several point of views about that but I will remove it because I consider it out of scope, it shouldn't have been in that commit. \n\nMy point of view is that sage should stand on its own without the sources. As it is the doctest are only runnable once sage is installed. Ideally we could run the doctest after building but before installing. But I'll keep that bit as my own special case, separate, only in the sage-on-gentoo tree if I want to run the doctests without the source being present.",
    "created_at": "2015-05-30T09:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257828",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">Comment 32</div>

Hum... Well there are several point of views about that but I will remove it because I consider it out of scope, it shouldn't have been in that commit. 

My point of view is that sage should stand on its own without the sources. As it is the doctest are only runnable once sage is installed. Ideally we could run the doctest after building but before installing. But I'll keep that bit as my own special case, separate, only in the sage-on-gentoo tree if I want to run the doctests without the source being present.



---

archive/issue_comments_257829.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nDid I just make sage automatically load `numpy` by importing it in `cython.py`?\n\n```\nsage -t --long src/sage/tests/startup.py\n**********************************************************************\nFile \"src/sage/tests/startup.py\", line 6, in sage.tests.startup\nFailed example:\n    'numpy' in sys.modules\nExpected:\n    False\nGot:\n    True\n```",
    "created_at": "2015-05-30T09:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257829",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">Comment 33</div>

Did I just make sage automatically load `numpy` by importing it in `cython.py`?

```
sage -t --long src/sage/tests/startup.py
**********************************************************************
File "src/sage/tests/startup.py", line 6, in sage.tests.startup
Failed example:
    'numpy' in sys.modules
Expected:
    False
Got:
    True
```



---

archive/issue_comments_257830.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@kiwifb](#comment%3A33):\n> Did I just make sage automatically load `numpy` by importing it in `cython.py`?\n\nSee [comment:22]",
    "created_at": "2015-05-30T10:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257830",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@kiwifb](#comment%3A33):
> Did I just make sage automatically load `numpy` by importing it in `cython.py`?

See [comment:22]



---

archive/issue_comments_257831.json:
```json
{
    "body": "Changed commit from **[d76f95f](https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4)** to **[df1d445](https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5)**",
    "created_at": "2015-05-30T10:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257831",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d76f95f](https://github.com/sagemath/sagetrac-mirror/commit/d76f95f41bb890dc742fe20a3c5880e765ea2fe4)** to **[df1d445](https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5)**



---

archive/issue_comments_257832.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5\">df1d445</a></td><td><code>Revert changes breaking doctest in sagenb and forcing numpy import. Ship all headers and do not ship .pyx files.</code></td></tr></table>\n",
    "created_at": "2015-05-30T10:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257832",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35" align="right">Comment 35</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5">df1d445</a></td><td><code>Revert changes breaking doctest in sagenb and forcing numpy import. Ship all headers and do not ship .pyx files.</code></td></tr></table>




---

archive/issue_comments_257833.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nStill have to fix `sage_setup`. Curiously in `sage/doctest/sources.py` changing `sp` from `SAGE_LOCAL/lib/python/site-packages` to `SAGE_LOCAL/lib/python2.7/site-packages` (or `SAGE_LIB`) breaks doctesting of sagenb - in \"vanilla\" sage but not sage-on-gentoo. This was extra baggage to this ticket so I won't pursue it.",
    "created_at": "2015-05-30T10:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257833",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">Comment 36</div>

Still have to fix `sage_setup`. Curiously in `sage/doctest/sources.py` changing `sp` from `SAGE_LOCAL/lib/python/site-packages` to `SAGE_LOCAL/lib/python2.7/site-packages` (or `SAGE_LIB`) breaks doctesting of sagenb - in "vanilla" sage but not sage-on-gentoo. This was extra baggage to this ticket so I won't pursue it.



---

archive/issue_comments_257834.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@jdemeyer](#comment%3A34):\n> Replying to [@kiwifb](#comment%3A33):\n> > Did I just make sage automatically load `numpy` by importing it in `cython.py`?\n\n> See [comment:22]\n\nSorry somehow a bunch of notifications didn't make it into my inbox. I will review #9952 and I'll certainly rebase on top once it is done.",
    "created_at": "2015-05-30T11:03:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257834",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@jdemeyer](#comment%3A34):
> Replying to [@kiwifb](#comment%3A33):
> > Did I just make sage automatically load `numpy` by importing it in `cython.py`?

> See [comment:22]

Sorry somehow a bunch of notifications didn't make it into my inbox. I will review #9952 and I'll certainly rebase on top once it is done.



---

archive/issue_comments_257835.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@jdemeyer](#comment%3A22):\n> I would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function\n> \n> ```\n> @cached_function\n> def sage_include_directories(sage_lib_dir):\n>     \"\"\"\n>     Return the list of include directories for compiling Sage extension modules.\n>     \"\"\"\n>     import numpy   # not a global import!\n>     return [.......]\n> ```\n> returning the include directories for `cython()` if `sage_lib_dir` is `SAGE_LIB` and returning the include directories for `src/setup.py` if `sage_lib_dir` is `SAGE_SRC`. I haven't thought about is that much, but I think that's the right direction to go.\n> \n\nThat would be clever. I'll try that.\n\nIt is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory so to package them I either have to do it as a `data_files`  or introduce a special case in `package_data`. Any chance of them being obsolete?\n\nI'll check my space after commas and correct the surroundings. I usually follow the style of what I change rather than move to a new style but I guess the space after comma should really be the standard.",
    "created_at": "2015-05-30T11:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257835",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@jdemeyer](#comment%3A22):
> I would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function
> 
> ```
> @cached_function
> def sage_include_directories(sage_lib_dir):
>     """
>     Return the list of include directories for compiling Sage extension modules.
>     """
>     import numpy   # not a global import!
>     return [.......]
> ```
> returning the include directories for `cython()` if `sage_lib_dir` is `SAGE_LIB` and returning the include directories for `src/setup.py` if `sage_lib_dir` is `SAGE_SRC`. I haven't thought about is that much, but I think that's the right direction to go.
> 

That would be clever. I'll try that.

It is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory so to package them I either have to do it as a `data_files`  or introduce a special case in `package_data`. Any chance of them being obsolete?

I'll check my space after commas and correct the surroundings. I usually follow the style of what I change rather than move to a new style but I guess the space after comma should really be the standard.



---

archive/issue_comments_257836.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nReplying to [@kiwifb](#comment%3A38):\n> It is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory\n\nWould it help to just add a `__init__.py` file?\n\n> Any chance of them being obsolete?\n\nNo, `mpz.pxi` is not obsolete (and `API.pxi` is really just documentation)",
    "created_at": "2015-05-30T14:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257836",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">Comment 39</div>

Replying to [@kiwifb](#comment%3A38):
> It is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory

Would it help to just add a `__init__.py` file?

> Any chance of them being obsolete?

No, `mpz.pxi` is not obsolete (and `API.pxi` is really just documentation)



---

archive/issue_comments_257837.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nReplying to [@jdemeyer](#comment%3A39):\n> Replying to [@kiwifb](#comment%3A38):\n> > It is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory\n\n> Would it help to just add a `__init__.py` file?\n> \n\nIt should. That should put the folder in `python_packages` so it should work. Putting on my list.",
    "created_at": "2015-05-30T21:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257837",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">Comment 40</div>

Replying to [@jdemeyer](#comment%3A39):
> Replying to [@kiwifb](#comment%3A38):
> > It is actually quite hard to work out which `.pxi`/`.pxd` will never be used which why I included the `padics` files. There is no other python sources in that directory

> Would it help to just add a `__init__.py` file?
> 

It should. That should put the folder in `python_packages` so it should work. Putting on my list.



---

archive/issue_comments_257838.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nHow close are we of getting #17854 merged we have many item queued that clearly touch the same files. I think finishing #17854 should be the top priority there are two many things that will either depends on it or need to be rebased after it or its dependencies are merged.",
    "created_at": "2015-05-30T22:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257838",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">Comment 41</div>

How close are we of getting #17854 merged we have many item queued that clearly touch the same files. I think finishing #17854 should be the top priority there are two many things that will either depends on it or need to be rebased after it or its dependencies are merged.



---

archive/issue_comments_257839.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nReplying to [@kiwifb](#comment%3A41):\n> How close are we of getting #17854 merged we have many item queued that clearly touch the same files. I think finishing #17854 should be the top priority there are two many things that will either depends on it or need to be rebased after it or its dependencies are merged.\n\nI cannot really say but I see the last dependency of #17854 is getting rid of something NTL related.\nOur NTL wrapping code is really terrible with regards to what Cython can now do and we should definitely rewrite it all using actual C++ bindings.\nThis is not so difficult but very time consuming...\nSo maybe waiting for #17854 is not the right thing to do.",
    "created_at": "2015-05-30T22:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257839",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:42" align="right">Comment 42</div>

Replying to [@kiwifb](#comment%3A41):
> How close are we of getting #17854 merged we have many item queued that clearly touch the same files. I think finishing #17854 should be the top priority there are two many things that will either depends on it or need to be rebased after it or its dependencies are merged.

I cannot really say but I see the last dependency of #17854 is getting rid of something NTL related.
Our NTL wrapping code is really terrible with regards to what Cython can now do and we should definitely rewrite it all using actual C++ bindings.
This is not so difficult but very time consuming...
So maybe waiting for #17854 is not the right thing to do.



---

archive/issue_comments_257840.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nI see. I have a vested interest in `libcsage` going away and it shows in some of my eagerness. Anyone has an idea why sage trac messages (including the digest) arrive in my inbox as \"read\"? Very annoying.",
    "created_at": "2015-05-31T00:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257840",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:43" align="right">Comment 43</div>

I see. I have a vested interest in `libcsage` going away and it shows in some of my eagerness. Anyone has an idea why sage trac messages (including the digest) arrive in my inbox as "read"? Very annoying.



---

archive/issue_comments_257841.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@kiwifb](#comment%3A41):\n> How close are we of getting #17854 merged\n\nSince it's needs_review, that only depends on whether or not somebody wants to review it.",
    "created_at": "2015-05-31T08:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257841",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@kiwifb](#comment%3A41):
> How close are we of getting #17854 merged

Since it's needs_review, that only depends on whether or not somebody wants to review it.



---

archive/issue_comments_257842.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@sagetrac-jpflori](#comment%3A42):\n> Our NTL wrapping code is really terrible with regards to what Cython can now do and we should definitely rewrite it all using actual C++ bindings.\n> This is not so difficult but very time consuming...\n\nI agree completely with the above statement. Note that #18367 doesn't really clean-up the NTL interface, it just moves it from `c_lib` to the Sage library.",
    "created_at": "2015-05-31T08:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257842",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@sagetrac-jpflori](#comment%3A42):
> Our NTL wrapping code is really terrible with regards to what Cython can now do and we should definitely rewrite it all using actual C++ bindings.
> This is not so difficult but very time consuming...

I agree completely with the above statement. Note that #18367 doesn't really clean-up the NTL interface, it just moves it from `c_lib` to the Sage library.



---

archive/issue_comments_257843.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@jdemeyer](#comment%3A45):\n> Replying to [@kiwifb](#comment%3A41):\n> > How close are we of getting #17854 merged\n\n> Since it's needs_review, that only depends on whether or not somebody wants to review it.\n\nIt seems to need re-basing but #18367 seems to be clean and ready for a run on the patchbot as far as I can see.",
    "created_at": "2015-05-31T08:43:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257843",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@jdemeyer](#comment%3A45):
> Replying to [@kiwifb](#comment%3A41):
> > How close are we of getting #17854 merged

> Since it's needs_review, that only depends on whether or not somebody wants to review it.

It seems to need re-basing but #18367 seems to be clean and ready for a run on the patchbot as far as I can see.



---

archive/issue_comments_257844.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nReplying to [@kiwifb](#comment%3A47):\n> It seems to need re-basing\n\nIt merges cleanly for me... don't get confused by the red Trac link.",
    "created_at": "2015-05-31T08:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257844",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">Comment 48</div>

Replying to [@kiwifb](#comment%3A47):
> It seems to need re-basing

It merges cleanly for me... don't get confused by the red Trac link.



---

archive/issue_comments_257845.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nReplying to [@jdemeyer](#comment%3A48):\n> Replying to [@kiwifb](#comment%3A47):\n> > It seems to need re-basing\n\n> It merges cleanly for me... don't get confused by the red Trac link.\n\nOK, regardless I have noticed that #18450 is also needed and in need of review. And there seem to be no progress with upstream cython on that one, which puts a damper on the whole thing.",
    "created_at": "2015-05-31T08:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257845",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:49" align="right">Comment 49</div>

Replying to [@jdemeyer](#comment%3A48):
> Replying to [@kiwifb](#comment%3A47):
> > It seems to need re-basing

> It merges cleanly for me... don't get confused by the red Trac link.

OK, regardless I have noticed that #18450 is also needed and in need of review. And there seem to be no progress with upstream cython on that one, which puts a damper on the whole thing.



---

archive/issue_comments_257846.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nReplying to [@kiwifb](#comment%3A49):\n> OK, regardless I have noticed that #18450 is also needed and in need of review.\n\nIt is not really needed for #18450, it's mostly a dependency to avoid conflicts.\n\n> And there seem to be no progress with upstream cython on that one\n\nMy personal opinion is that we shouldn't care too much about what upstream thinks. Note that upstream Cython has not given a **single reason** why they are against my feature on #18450.",
    "created_at": "2015-05-31T09:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257846",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">Comment 50</div>

Replying to [@kiwifb](#comment%3A49):
> OK, regardless I have noticed that #18450 is also needed and in need of review.

It is not really needed for #18450, it's mostly a dependency to avoid conflicts.

> And there seem to be no progress with upstream cython on that one

My personal opinion is that we shouldn't care too much about what upstream thinks. Note that upstream Cython has not given a **single reason** why they are against my feature on #18450.



---

archive/issue_comments_257847.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nReplying to [@kiwifb](#comment%3A49):\n> And there seem to be no progress with upstream cython on that one, which puts a damper on the whole thing.\n\nBut a very tiny damper regardless. It's trivial to fix #18450 such that it does not depend on the non-accepted Cython patch.",
    "created_at": "2015-05-31T09:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257847",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">Comment 51</div>

Replying to [@kiwifb](#comment%3A49):
> And there seem to be no progress with upstream cython on that one, which puts a damper on the whole thing.

But a very tiny damper regardless. It's trivial to fix #18450 such that it does not depend on the non-accepted Cython patch.



---

archive/issue_comments_257848.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nReplying to [@jdemeyer](#comment%3A50):\n> Replying to [@kiwifb](#comment%3A49):\n> > OK, regardless I have noticed that #18450 is also needed and in need of review.\n\n> It is not really needed for #18450, it's mostly a dependency to avoid conflicts.\n> \n> > And there seem to be no progress with upstream cython on that one\n\n> My personal opinion is that we shouldn't care too much about what upstream thinks. Note that upstream Cython has not given a **single reason** why they are against my feature on #18450.\n\nYes very strange conversation I have to agree. Upstream think their reasons are obvious. Unfortunately while I am sure you don't care it makes my other life a bit too \"interesting\". \n\nBut I should start re-writing stuff for this ticket, if there are conflicts we'll sort them out when we work out the merge order.",
    "created_at": "2015-05-31T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257848",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:52" align="right">Comment 52</div>

Replying to [@jdemeyer](#comment%3A50):
> Replying to [@kiwifb](#comment%3A49):
> > OK, regardless I have noticed that #18450 is also needed and in need of review.

> It is not really needed for #18450, it's mostly a dependency to avoid conflicts.
> 
> > And there seem to be no progress with upstream cython on that one

> My personal opinion is that we shouldn't care too much about what upstream thinks. Note that upstream Cython has not given a **single reason** why they are against my feature on #18450.

Yes very strange conversation I have to agree. Upstream think their reasons are obvious. Unfortunately while I am sure you don't care it makes my other life a bit too "interesting". 

But I should start re-writing stuff for this ticket, if there are conflicts we'll sort them out when we work out the merge order.



---

archive/issue_comments_257849.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nReplying to [@jdemeyer](#comment%3A22):\n> I would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function\n> \n> ```\n> @cached_function\n> def sage_include_directories(sage_lib_dir):\n>     \"\"\"\n>     Return the list of include directories for compiling Sage extension modules.\n>     \"\"\"\n>     import numpy   # not a global import!\n>     return [.......]\n> ```\n\nLeast you think I am not working on this. My attention had to be divided between a number of things but I am still working on this. Any recommendation on where to put this function? We do not want to put it in `cython.py` because we don't want to import any bits of it in `setup.py` (bad things will happen to you if you do). I don't want to put it anywhere in `sage_setup` because it should only be used at build time not runtime, same for `module_list.py`. `env.py` could be interesting if I can get away with it. The other possibilities: \n* its own file\n* something I haven't thought about\n\nopinions?",
    "created_at": "2015-06-02T23:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257849",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:53" align="right">Comment 53</div>

Replying to [@jdemeyer](#comment%3A22):
> I would still like to use as much as possible the same headers in `src/setup.py` and in `cython.py`. You could make a function
> 
> ```
> @cached_function
> def sage_include_directories(sage_lib_dir):
>     """
>     Return the list of include directories for compiling Sage extension modules.
>     """
>     import numpy   # not a global import!
>     return [.......]
> ```

Least you think I am not working on this. My attention had to be divided between a number of things but I am still working on this. Any recommendation on where to put this function? We do not want to put it in `cython.py` because we don't want to import any bits of it in `setup.py` (bad things will happen to you if you do). I don't want to put it anywhere in `sage_setup` because it should only be used at build time not runtime, same for `module_list.py`. `env.py` could be interesting if I can get away with it. The other possibilities: 
* its own file
* something I haven't thought about

opinions?



---

archive/issue_comments_257850.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nActually, `env.py` sounds like a good suggestion. You'll need to move `SAGE_INC` (currently defined in `setup.py`) also to `env.py`.\n\nI'd wait for 6.8.beta3 though to be safe with merge conflicts.",
    "created_at": "2015-06-03T05:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257850",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">Comment 54</div>

Actually, `env.py` sounds like a good suggestion. You'll need to move `SAGE_INC` (currently defined in `setup.py`) also to `env.py`.

I'd wait for 6.8.beta3 though to be safe with merge conflicts.



---

archive/issue_comments_257851.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nIn `src/setup.py`, it would be good to define a new variable for the `build/cythonized` directory.",
    "created_at": "2015-06-03T08:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257851",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">Comment 55</div>

In `src/setup.py`, it would be good to define a new variable for the `build/cythonized` directory.



---

archive/issue_comments_257852.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nOK, I'll wait beta3 to put the work to \"need review\" but I could already present stuff for scrutiny, it is quite advanced now. Bringing `SAGE_INC` to the `sage.env` sounds a good idea, hopefully it will be its final destination (I am sure it started in `module_list.py`). If you think a variable for `build/cythonized` would be useful I can throw that in, suggestion for the name?",
    "created_at": "2015-06-03T09:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257852",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:56" align="right">Comment 56</div>

OK, I'll wait beta3 to put the work to "need review" but I could already present stuff for scrutiny, it is quite advanced now. Bringing `SAGE_INC` to the `sage.env` sounds a good idea, hopefully it will be its final destination (I am sure it started in `module_list.py`). If you think a variable for `build/cythonized` would be useful I can throw that in, suggestion for the name?



---

archive/issue_comments_257853.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nReplying to [@kiwifb](#comment%3A56):\n> If you think a variable for `build/cythonized` would be useful I can throw that in, suggestion for the name?\n\n`SAGE_CYTHONIZED`?",
    "created_at": "2015-06-03T09:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257853",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">Comment 57</div>

Replying to [@kiwifb](#comment%3A56):
> If you think a variable for `build/cythonized` would be useful I can throw that in, suggestion for the name?

`SAGE_CYTHONIZED`?



---

archive/issue_comments_257854.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nReplying to [@kiwifb](#comment%3A56):\n> OK, I'll wait beta3 to put the work to \"need review\" but I could already present stuff for scrutiny, it is quite advanced now.\n\nFor me, you don't need to wait to put it to needs_review, just be aware of #9552, #18450, #18367 (and #17854 which isn't reviewed yet).",
    "created_at": "2015-06-03T09:34:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257854",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">Comment 58</div>

Replying to [@kiwifb](#comment%3A56):
> OK, I'll wait beta3 to put the work to "need review" but I could already present stuff for scrutiny, it is quite advanced now.

For me, you don't need to wait to put it to needs_review, just be aware of #9552, #18450, #18367 (and #17854 which isn't reviewed yet).



---

archive/issue_comments_257855.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nI should be able to rebase/update everything in the next couple of days, including this little surprise\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 231, in sage.misc.cython.pyx_preparse\nFailed example:\n    module = sage.misc.cython.import_test(\"trac11680\")  # long time (7s on sage.math, 2012)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.cython.pyx_preparse[9]>\", line 1, in <module>\n        module = sage.misc.cython.import_test(\"trac11680\")  # long time (7s on sage.math, 2012)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 810, in import_test\n        return compile_and_load(TESTS[name])\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 763, in compile_and_load\n        return cython_import(file, create_local_c_file=False)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 687, in cython_import\n        **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 480, in cython\n        raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error compiling /home/fbissey/.sage/temp/QCD-nzi3/31051/tmp_zyUtdw.pyx:\n    running build\n    running build_ext\n    building '_home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0' extension\n    creating build\n    creating build/temp.linux-x86_64-2.7\n    x86_64-pc-linux-gnu-gcc -pthread -fPIC -I/usr/lib64/python2.7/site-packages/sage/libs/flint -I/usr//include/flint -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/home/fbissey/.sage/temp/QCD-nzi3/31051 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.c -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.o -w -O2 -O3 -ggdb\n\n    _home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.c:258:37: fatal error: sage/libs/ntl/ntlwrap.cpp: No such file or directory\n     #include \"sage/libs/ntl/ntlwrap.cpp\"\n                                         ^\n    compilation terminated.\n    error: command 'x86_64-pc-linux-gnu-gcc' failed with exit status 1\n```\nSo that is one extra file to ship, the only one of its kind.",
    "created_at": "2015-06-05T19:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257855",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:59" align="right">Comment 59</div>

I should be able to rebase/update everything in the next couple of days, including this little surprise

```
File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 231, in sage.misc.cython.pyx_preparse
Failed example:
    module = sage.misc.cython.import_test("trac11680")  # long time (7s on sage.math, 2012)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.cython.pyx_preparse[9]>", line 1, in <module>
        module = sage.misc.cython.import_test("trac11680")  # long time (7s on sage.math, 2012)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 810, in import_test
        return compile_and_load(TESTS[name])
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 763, in compile_and_load
        return cython_import(file, create_local_c_file=False)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 687, in cython_import
        **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 480, in cython
        raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error compiling /home/fbissey/.sage/temp/QCD-nzi3/31051/tmp_zyUtdw.pyx:
    running build
    running build_ext
    building '_home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0' extension
    creating build
    creating build/temp.linux-x86_64-2.7
    x86_64-pc-linux-gnu-gcc -pthread -fPIC -I/usr/lib64/python2.7/site-packages/sage/libs/flint -I/usr//include/flint -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/home/fbissey/.sage/temp/QCD-nzi3/31051 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.c -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.o -w -O2 -O3 -ggdb

    _home_fbissey__sage_temp_QCD_nzi3_31051_tmp_zyUtdw_pyx_0.c:258:37: fatal error: sage/libs/ntl/ntlwrap.cpp: No such file or directory
     #include "sage/libs/ntl/ntlwrap.cpp"
                                         ^
    compilation terminated.
    error: command 'x86_64-pc-linux-gnu-gcc' failed with exit status 1
```
So that is one extra file to ship, the only one of its kind.



---

archive/issue_comments_257856.json:
```json
{
    "body": "Changed commit from **[df1d445](https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5)** to **[9ddcb7a](https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1)**",
    "created_at": "2015-06-06T11:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257856",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[df1d445](https://github.com/sagemath/sagetrac-mirror/commit/df1d4458f6190415e72d2533b5e5780985b035d5)** to **[9ddcb7a](https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1)**



---

archive/issue_comments_257857.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nPushed newer version of the work, I am still testing things so I am not putting to review but feedback welcome. After that work, I still feel unsatisfied. Like a few year ago I thought the usage of `SAGE_ROOT` was excessive in sage, I now think the usage of `SAGE_SRC` is excessive. It is legit for doctesting but there are some cases where the sources are used at runtime when installed files should be used. On the whole with this commit things should work if you set `SAGE_SRC=SAGE_LIB` with the possible exception of `cython` debugging which I would have to check.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1\">9ddcb7a</a></td><td><code>trac 18494, re-organize things to install the headers and other auxiliary files necessary to run sage, without the build directory or the source directory if</code></td></tr></table>\n",
    "created_at": "2015-06-06T11:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257857",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:60" align="right">Comment 60</div>

Pushed newer version of the work, I am still testing things so I am not putting to review but feedback welcome. After that work, I still feel unsatisfied. Like a few year ago I thought the usage of `SAGE_ROOT` was excessive in sage, I now think the usage of `SAGE_SRC` is excessive. It is legit for doctesting but there are some cases where the sources are used at runtime when installed files should be used. On the whole with this commit things should work if you set `SAGE_SRC=SAGE_LIB` with the possible exception of `cython` debugging which I would have to check.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1">9ddcb7a</a></td><td><code>trac 18494, re-organize things to install the headers and other auxiliary files necessary to run sage, without the build directory or the source directory if</code></td></tr></table>




---

archive/issue_comments_257858.json:
```json
{
    "body": "Changed branch from **[u/fbissey/headers_install](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/headers_install)** to **[u/fbissey/trac18494](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac18494)**",
    "created_at": "2015-06-06T11:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257858",
    "user": "https://github.com/kiwifb"
}
```

Changed branch from **[u/fbissey/headers_install](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/headers_install)** to **[u/fbissey/trac18494](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac18494)**



---

archive/issue_comments_257859.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0\">912f8ca</a></td><td><code>Fix the cython include path doctest (properly this time). Make SAGE_CYTHONIZED relative instead of absolute and fixing removing tabs from env.py.</code></td></tr></table>\n",
    "created_at": "2015-06-06T21:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257859",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61" align="right">Comment 61</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0">912f8ca</a></td><td><code>Fix the cython include path doctest (properly this time). Make SAGE_CYTHONIZED relative instead of absolute and fixing removing tabs from env.py.</code></td></tr></table>




---

archive/issue_comments_257860.json:
```json
{
    "body": "Changed commit from **[9ddcb7a](https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1)** to **[912f8ca](https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0)**",
    "created_at": "2015-06-06T21:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257860",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9ddcb7a](https://github.com/sagemath/sagetrac-mirror/commit/9ddcb7a38ca4caa5f98cfbb896ff6edbfed9a4a1)** to **[912f8ca](https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0)**



---

archive/issue_comments_257861.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nFixed the last few doctests, I am putting this to needs_review.",
    "created_at": "2015-06-06T21:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257861",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">Comment 62</div>

Fixed the last few doctests, I am putting this to needs_review.



---

archive/issue_events_245052.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-06T21:19:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245052"
}
```



---

archive/issue_events_245053.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-06T21:19:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245053"
}
```



---

archive/issue_comments_257862.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nPatchbot seem to like it. I am waiting for review before moving back to #17630 based on this ticket.",
    "created_at": "2015-06-08T09:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257862",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:63" align="right">Comment 63</div>

Patchbot seem to like it. I am waiting for review before moving back to #17630 based on this ticket.



---

archive/issue_comments_257863.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nTo allow for future auto-generation of `python_data_files`, I would prefer to start out with a list\n\n```\ncython_generated_files = [\n    os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt_api.h'),\n    os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')\n]\n```\nand then generate `python_data_files` from that. That would also be more readable than the \n`[(()[()()])]` nesting.",
    "created_at": "2015-06-08T10:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257863",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">Comment 64</div>

To allow for future auto-generation of `python_data_files`, I would prefer to start out with a list

```
cython_generated_files = [
    os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt_api.h'),
    os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')
]
```
and then generate `python_data_files` from that. That would also be more readable than the 
`[(()[()()])]` nesting.



---

archive/issue_comments_257864.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nSome formatting issues:\n1. use 4 space indents in `for package in python_packages:`\n2. format the docstring of `def sage_include_directories():` according to [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings)\n3. remove the redundant `\\` in `def sage_include_directories()`",
    "created_at": "2015-06-08T10:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257864",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:65" align="right">Comment 65</div>

Some formatting issues:
1. use 4 space indents in `for package in python_packages:`
2. format the docstring of `def sage_include_directories():` according to [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings)
3. remove the redundant `\` in `def sage_include_directories()`



---

archive/issue_events_245054.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-08T10:16:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245054"
}
```



---

archive/issue_events_245055.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-08T10:16:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245055"
}
```



---

archive/issue_comments_257865.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\n`SAGE_CYTHONIZED` should use an absolute path (relative to `SAGE_SRC`)",
    "created_at": "2015-06-08T10:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257865",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:66" align="right">Comment 66</div>

`SAGE_CYTHONIZED` should use an absolute path (relative to `SAGE_SRC`)



---

archive/issue_comments_257866.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nInstead of an argument `phase='runtime'` (whose intentions are not so clear to me), I would prefer to see something more explicit like `use_sources=False`. Using a boolean will also avoid the need for\n\n```\nelse:\n    raise ValueError('phase not recognised')\n    return               # <--- This line is redundant by the way\n```",
    "created_at": "2015-06-08T10:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257866",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">Comment 67</div>

Instead of an argument `phase='runtime'` (whose intentions are not so clear to me), I would prefer to see something more explicit like `use_sources=False`. Using a boolean will also avoid the need for

```
else:
    raise ValueError('phase not recognised')
    return               # <--- This line is redundant by the way
```



---

archive/issue_comments_257867.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [@jdemeyer](#comment%3A66):\n> `SAGE_CYTHONIZED` should use an absolute path (relative to `SAGE_SRC`)\n\nOk I initially did that and reverted because it broke a doctest (`sage/repl/interpreter.py`) but I have no objection to making it absolute and fixing the doctest instead. \n\nAll comments sound good to me, I guess my vocabulary on \"phase\" is packaging speak, your suggestion is simpler.",
    "created_at": "2015-06-08T10:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257867",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [@jdemeyer](#comment%3A66):
> `SAGE_CYTHONIZED` should use an absolute path (relative to `SAGE_SRC`)

Ok I initially did that and reverted because it broke a doctest (`sage/repl/interpreter.py`) but I have no objection to making it absolute and fixing the doctest instead. 

All comments sound good to me, I guess my vocabulary on "phase" is packaging speak, your suggestion is simpler.



---

archive/issue_comments_257868.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nIn `src/sage_setup/clean.py`, rename `extensions` as `skip_extensions`.",
    "created_at": "2015-06-08T10:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257868",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:69" align="right">Comment 69</div>

In `src/sage_setup/clean.py`, rename `extensions` as `skip_extensions`.



---

archive/issue_comments_257869.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nReplace `opj(x)` by `x`",
    "created_at": "2015-06-08T10:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257869",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">Comment 70</div>

Replace `opj(x)` by `x`



---

archive/issue_comments_257870.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nI am experiencing a difficulty while writing an \"examples\" section. The example works fine from the sage prompt but during doctesting I get\n\n```\nsage -t --long src/sage/env.py\n**********************************************************************\nFile \"src/sage/env.py\", line 164, in sage.env.sage_include_directories\nFailed example:\n    sage.env.sage_include_directories()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.env.sage_include_directories[1]>\", line 1, in <module>\n        sage.env.sage_include_directories()\n    AttributeError: 'module' object has no attribute 'sage_include_directories'\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.env.sage_include_directories\n    [12 tests, 1 failure, 0.01 s]\n```\nThe code tested is\n\n```\nsage: import sage.env\nsage: sage.env.sage_include_directories()\n['/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/include',\n '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/include/python2.7',\n '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages/numpy/core/include',\n '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages',\n '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages/sage/ext']\n```",
    "created_at": "2015-06-08T12:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257870",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:71" align="right">Comment 71</div>

I am experiencing a difficulty while writing an "examples" section. The example works fine from the sage prompt but during doctesting I get

```
sage -t --long src/sage/env.py
**********************************************************************
File "src/sage/env.py", line 164, in sage.env.sage_include_directories
Failed example:
    sage.env.sage_include_directories()
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.env.sage_include_directories[1]>", line 1, in <module>
        sage.env.sage_include_directories()
    AttributeError: 'module' object has no attribute 'sage_include_directories'
**********************************************************************
1 item had failures:
   1 of   3 in sage.env.sage_include_directories
    [12 tests, 1 failure, 0.01 s]
```
The code tested is

```
sage: import sage.env
sage: sage.env.sage_include_directories()
['/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/include',
 '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/include/python2.7',
 '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages/numpy/core/include',
 '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages',
 '/home/fbissey/sandbox/git-fork/sage-6.8.beta3/local/lib/python2.7/site-packages/sage/ext']
```



---

archive/issue_comments_257871.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nIt was the wrong `sage` being executed... Commits coming.",
    "created_at": "2015-06-08T13:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257871",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:72" align="right">Comment 72</div>

It was the wrong `sage` being executed... Commits coming.



---

archive/issue_comments_257872.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472\">1bc95ae</a></td><td><code>Incorporate Jeroen's feedback.</code></td></tr></table>\n",
    "created_at": "2015-06-08T13:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257872",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73" align="right">Comment 73</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472">1bc95ae</a></td><td><code>Incorporate Jeroen's feedback.</code></td></tr></table>




---

archive/issue_comments_257873.json:
```json
{
    "body": "Changed commit from **[912f8ca](https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0)** to **[1bc95ae](https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472)**",
    "created_at": "2015-06-08T13:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257873",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[912f8ca](https://github.com/sagemath/sagetrac-mirror/commit/912f8ca84b2de02848e0834c97649339cf018ed0)** to **[1bc95ae](https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472)**



---

archive/issue_comments_257874.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006\">769b69e</a></td><td><code>small adjustment in cython.py</code></td></tr></table>\n",
    "created_at": "2015-06-08T13:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257874",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74" align="right">Comment 74</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006">769b69e</a></td><td><code>small adjustment in cython.py</code></td></tr></table>




---

archive/issue_comments_257875.json:
```json
{
    "body": "Changed commit from **[1bc95ae](https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472)** to **[769b69e](https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006)**",
    "created_at": "2015-06-08T13:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257875",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1bc95ae](https://github.com/sagemath/sagetrac-mirror/commit/1bc95ae3b7a76c2d59d955bef67535d97ac2f472)** to **[769b69e](https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006)**



---

archive/issue_events_245056.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-08T13:14:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245056"
}
```



---

archive/issue_events_245057.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-08T13:14:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245057"
}
```



---

archive/issue_comments_257876.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-06-08T14:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257876",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_245058.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-08T14:00:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245058"
}
```



---

archive/issue_events_245059.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-08T14:00:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245059"
}
```



---

archive/issue_comments_257877.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nCan you make `use_sources` an actual boolean, not a string with value \"True\" or \"False\"?",
    "created_at": "2015-06-08T14:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257877",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:76" align="right">Comment 76</div>

Can you make `use_sources` an actual boolean, not a string with value "True" or "False"?



---

archive/issue_comments_257878.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nI don't want to assume that all `cython_generated_files` are in `sage/ext/interrupt`, so I don't like this:\n\n```\npython_data_files = [\n    (os.path.join(SAGE_LIB, 'sage', 'ext', 'interrupt'), cython_generated_files)\n]\n```\n\nEventually, also files like `src/build/cythonized/sage/modular/arithgroup/farey_symbol.h` should be installed in the correct directory.",
    "created_at": "2015-06-08T14:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257878",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:77" align="right">Comment 77</div>

I don't want to assume that all `cython_generated_files` are in `sage/ext/interrupt`, so I don't like this:

```
python_data_files = [
    (os.path.join(SAGE_LIB, 'sage', 'ext', 'interrupt'), cython_generated_files)
]
```

Eventually, also files like `src/build/cythonized/sage/modular/arithgroup/farey_symbol.h` should be installed in the correct directory.



---

archive/issue_comments_257879.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nReplying to [@jdemeyer](#comment%3A77):\n> I don't want to assume that all `cython_generated_files` are in `sage/ext/interrupt`, so I don't like this:\n> \n> ```\n> python_data_files = [\n>     (os.path.join(SAGE_LIB, 'sage', 'ext', 'interrupt'), cython_generated_files)\n> ]\n> ```\n> \n> Eventually, also files like `src/build/cythonized/sage/modular/arithgroup/farey_symbol.h` should be installed in the correct directory.\n\nI guess we could use a slice but that wouldn't be as clean as using a dictionary or specifically named variable. I would go for the dictionary.",
    "created_at": "2015-06-08T21:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257879",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:78" align="right">Comment 78</div>

Replying to [@jdemeyer](#comment%3A77):
> I don't want to assume that all `cython_generated_files` are in `sage/ext/interrupt`, so I don't like this:
> 
> ```
> python_data_files = [
>     (os.path.join(SAGE_LIB, 'sage', 'ext', 'interrupt'), cython_generated_files)
> ]
> ```
> 
> Eventually, also files like `src/build/cythonized/sage/modular/arithgroup/farey_symbol.h` should be installed in the correct directory.

I guess we could use a slice but that wouldn't be as clean as using a dictionary or specifically named variable. I would go for the dictionary.



---

archive/issue_comments_257880.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">Comment 79</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b\">d57f9ec</a></td><td><code>Use true boolean in env.py. Generate python_data_files from a dictionary.</code></td></tr></table>\n",
    "created_at": "2015-06-09T00:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257880",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79" align="right">Comment 79</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b">d57f9ec</a></td><td><code>Use true boolean in env.py. Generate python_data_files from a dictionary.</code></td></tr></table>




---

archive/issue_comments_257881.json:
```json
{
    "body": "Changed commit from **[769b69e](https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006)** to **[d57f9ec](https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b)**",
    "created_at": "2015-06-09T00:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257881",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[769b69e](https://github.com/sagemath/sagetrac-mirror/commit/769b69edf7811fd16ed2bf90bd8fe376e17b5006)** to **[d57f9ec](https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b)**



---

archive/issue_comments_257882.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nOK moved to a new design but I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.",
    "created_at": "2015-06-09T00:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257882",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:80" align="right">Comment 80</div>

OK moved to a new design but I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.



---

archive/issue_events_245060.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-09T00:39:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245060"
}
```



---

archive/issue_events_245061.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-09T00:39:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245061"
}
```



---

archive/issue_comments_257883.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nseeking new review, would very much wants this or something close to it in the next beta/rc.",
    "created_at": "2015-06-11T01:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257883",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:81" align="right">Comment 81</div>

seeking new review, would very much wants this or something close to it in the next beta/rc.



---

archive/issue_comments_257884.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\nReplying to [@kiwifb](#comment%3A80):\n> I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.\n\nI agree and what you did is not quite what I had in mind: the point is that the `ext/interrupt` should be *computed* from the `os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')` part.\n\nOn the other hard, if you're tired of making these changes, they could be postponed to a follow-up ticket.",
    "created_at": "2015-06-11T06:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257884",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:82" align="right">Comment 82</div>

Replying to [@kiwifb](#comment%3A80):
> I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.

I agree and what you did is not quite what I had in mind: the point is that the `ext/interrupt` should be *computed* from the `os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')` part.

On the other hard, if you're tired of making these changes, they could be postponed to a follow-up ticket.



---

archive/issue_comments_257885.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nReplying to [@jdemeyer](#comment%3A82):\n> Replying to [@kiwifb](#comment%3A80):\n> > I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.\n\n> I agree and what you did is not quite what I had in mind: the point is that the `ext/interrupt` should be *computed* from the `os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')` part.\n> \n> On the other hard, if you're tired of making these changes, they could be postponed to a follow-up ticket.\n\nI see what you have in mind now. I may have an idea how to do something like that, but I am giving myself a time limit. If I cannot work it out in the next 24hours, it'll be a follow up ticket.",
    "created_at": "2015-06-11T08:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257885",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:83" align="right">Comment 83</div>

Replying to [@jdemeyer](#comment%3A82):
> Replying to [@kiwifb](#comment%3A80):
> > I feel I just pushed the old ugliness of `python_data_files` in `cython_generated_files` with better documentation.

> I agree and what you did is not quite what I had in mind: the point is that the `ext/interrupt` should be *computed* from the `os.path.join(SAGE_CYTHONIZED, 'sage', 'ext', 'interrupt', 'interrupt.h')` part.
> 
> On the other hard, if you're tired of making these changes, they could be postponed to a follow-up ticket.

I see what you have in mind now. I may have an idea how to do something like that, but I am giving myself a time limit. If I cannot work it out in the next 24hours, it'll be a follow up ticket.



---

archive/issue_comments_257886.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\nI think this is important also for #12375 and #18514.",
    "created_at": "2015-06-11T11:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257886",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">Comment 84</div>

I think this is important also for #12375 and #18514.



---

archive/issue_events_245062.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T11:54:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245062"
}
```



---

archive/issue_events_245063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T11:54:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245063"
}
```



---

archive/issue_events_245064.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T11:55:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245064"
}
```



---

archive/issue_events_245065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T11:55:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245065"
}
```



---

archive/issue_comments_257887.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nReplying to [@kiwifb](#comment%3A83):\n> I see what you have in mind now. I may have an idea how to do something like that, but I am giving myself a time limit. If I cannot work it out in the next 24hours, it'll be a follow up ticket.\n\nExcellent. I'll set this ticket to needs_work now. Feel free to set it back to needs_review (with or without making further changes).",
    "created_at": "2015-06-11T11:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257887",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">Comment 85</div>

Replying to [@kiwifb](#comment%3A83):
> I see what you have in mind now. I may have an idea how to do something like that, but I am giving myself a time limit. If I cannot work it out in the next 24hours, it'll be a follow up ticket.

Excellent. I'll set this ticket to needs_work now. Feel free to set it back to needs_review (with or without making further changes).



---

archive/issue_comments_257888.json:
```json
{
    "body": "Changed commit from **[d57f9ec](https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b)** to **[4e745ce](https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef)**",
    "created_at": "2015-06-11T12:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257888",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d57f9ec](https://github.com/sagemath/sagetrac-mirror/commit/d57f9ecea507a155bc32f15113191386bbc9223b)** to **[4e745ce](https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef)**



---

archive/issue_comments_257889.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef\">4e745ce</a></td><td><code>Get SAGE_CYTHONIZED ffiles to generate package_data al by themselves</code></td></tr></table>\n",
    "created_at": "2015-06-11T12:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257889",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:86" align="right">Comment 86</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef">4e745ce</a></td><td><code>Get SAGE_CYTHONIZED ffiles to generate package_data al by themselves</code></td></tr></table>




---

archive/issue_comments_257890.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nSeems to be working from the list of files now.",
    "created_at": "2015-06-11T12:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257890",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:87" align="right">Comment 87</div>

Seems to be working from the list of files now.



---

archive/issue_events_245066.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-11T12:57:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245066"
}
```



---

archive/issue_events_245067.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-11T12:57:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245067"
}
```



---

archive/issue_comments_257891.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">Comment 88</div>\n\nThis comments needs to be updated:\n\n```\n# This is stored as a dictionary with the key being the directory to install the file under sage.\n```",
    "created_at": "2015-06-11T13:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257891",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:88" align="right">Comment 88</div>

This comments needs to be updated:

```
# This is stored as a dictionary with the key being the directory to install the file under sage.
```



---

archive/issue_comments_257892.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">Comment 89</div>\n\n`INPUTS` and `OUTPUTS` should be `INPUT` and `OUTPUT`.",
    "created_at": "2015-06-11T13:26:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257892",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:89" align="right">Comment 89</div>

`INPUTS` and `OUTPUTS` should be `INPUT` and `OUTPUT`.



---

archive/issue_comments_257893.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\n\n```\nsage -t --long src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    shell.run_cell('1/0')\nExpected:\n    ---------------------------------------------------------------------------\n    .../sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (.../build/cythonized/sage/rings/integer_ring.c:...)()\n        ...         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)\n        ...         if mpz_sgn(right.value) == 0:\n        ...             raise ZeroDivisionError('Rational division by zero')\n        ...         mpz_set(mpq_numref(x.value), left.value)\n        ...         mpz_set(mpq_denref(x.value), right.value)\n    <BLANKLINE>\n    ZeroDivisionError: Rational division by zero\nGot:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-6f88eab09598> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18132)()\n       2034                 return (<RingElement>self)._idiv_(<RingElement>right)\n       2035             else:\n    -> 2036                 return (<RingElement>self)._div_(<RingElement>right)\n       2037         global coercion_model\n       2038         return coercion_model.bin_op(self, right, div)\n    <BLANKLINE>\n    /usr/local/src/sage-config/src/sage/rings/integer.pyx in sage.rings.integer.Integer._div_ (build/cythonized/sage/rings/integer.c:12151)()\n       1748         # This is vastly faster than doing it here, since here\n       1749         # we can't cimport rationals.\n    -> 1750         return the_integer_ring._div(self, right)\n       1751 \n       1752     def __floordiv__(x, y):\n    <BLANKLINE>\n    /usr/local/src/sage-config/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (build/cythonized/sage/rings/integer_ring.c:4900)()\n        420         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)\n        421         if mpz_sgn(right.value) == 0:\n    --> 422             raise ZeroDivisionError('Rational division by zero')\n        423         mpz_set(mpq_numref(x.value), left.value)\n        424         mpz_set(mpq_denref(x.value), right.value)\n    <BLANKLINE>\n    ZeroDivisionError: Rational division by zero\n**********************************************************************\n```",
    "created_at": "2015-06-11T15:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257893",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">Comment 90</div>


```
sage -t --long src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    shell.run_cell('1/0')
Expected:
    ---------------------------------------------------------------------------
    .../sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (.../build/cythonized/sage/rings/integer_ring.c:...)()
        ...         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)
        ...         if mpz_sgn(right.value) == 0:
        ...             raise ZeroDivisionError('Rational division by zero')
        ...         mpz_set(mpq_numref(x.value), left.value)
        ...         mpz_set(mpq_denref(x.value), right.value)
    <BLANKLINE>
    ZeroDivisionError: Rational division by zero
Got:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-6f88eab09598> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18132)()
       2034                 return (<RingElement>self)._idiv_(<RingElement>right)
       2035             else:
    -> 2036                 return (<RingElement>self)._div_(<RingElement>right)
       2037         global coercion_model
       2038         return coercion_model.bin_op(self, right, div)
    <BLANKLINE>
    /usr/local/src/sage-config/src/sage/rings/integer.pyx in sage.rings.integer.Integer._div_ (build/cythonized/sage/rings/integer.c:12151)()
       1748         # This is vastly faster than doing it here, since here
       1749         # we can't cimport rationals.
    -> 1750         return the_integer_ring._div(self, right)
       1751 
       1752     def __floordiv__(x, y):
    <BLANKLINE>
    /usr/local/src/sage-config/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (build/cythonized/sage/rings/integer_ring.c:4900)()
        420         cdef rational.Rational x = rational.Rational.__new__(rational.Rational)
        421         if mpz_sgn(right.value) == 0:
    --> 422             raise ZeroDivisionError('Rational division by zero')
        423         mpz_set(mpq_numref(x.value), left.value)
        424         mpz_set(mpq_denref(x.value), right.value)
    <BLANKLINE>
    ZeroDivisionError: Rational division by zero
**********************************************************************
```



---

archive/issue_events_245068.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T15:44:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245068"
}
```



---

archive/issue_events_245069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-11T15:44:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245069"
}
```



---

archive/issue_comments_257894.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">Comment 92</div>\n\nReplying to [@jdemeyer](#comment%3A89):\n> `INPUTS` and `OUTPUTS` should be `INPUT` and `OUTPUT`.\n\nI really need to get some glasses, and stop reading stuff in the middle of the night too. The failing doctest shouldn't be. It probably means `sage/rings/integer_ring.pyx` hasn't been rebuilt after you patched. I thought touching setup.py would trigger that.",
    "created_at": "2015-06-11T21:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257894",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:92" align="right">Comment 92</div>

Replying to [@jdemeyer](#comment%3A89):
> `INPUTS` and `OUTPUTS` should be `INPUT` and `OUTPUT`.

I really need to get some glasses, and stop reading stuff in the middle of the night too. The failing doctest shouldn't be. It probably means `sage/rings/integer_ring.pyx` hasn't been rebuilt after you patched. I thought touching setup.py would trigger that.



---

archive/issue_comments_257895.json:
```json
{
    "body": "Changed commit from **[4e745ce](https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef)** to **[f4b868b](https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb)**",
    "created_at": "2015-06-11T21:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257895",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4e745ce](https://github.com/sagemath/sagetrac-mirror/commit/4e745ce5c0d80d3f7043910bd9c8c2f1908dd2ef)** to **[f4b868b](https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb)**



---

archive/issue_comments_257896.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">Comment 93</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb\">f4b868b</a></td><td><code>Final (cross fingers) clean up of comments and documentation sections</code></td></tr></table>\n",
    "created_at": "2015-06-11T21:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257896",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:93" align="right">Comment 93</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb">f4b868b</a></td><td><code>Final (cross fingers) clean up of comments and documentation sections</code></td></tr></table>




---

archive/issue_comments_257897.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">Comment 94</div>\n\nI am putting this back to \"need_review\" unless someone really wants to do something to trigger the rebuild of `sage/rings/integer_ring.pyx` that I haven't touched but for which the building directory is doctested in a completely unrelated file, I think it should go in.",
    "created_at": "2015-06-11T21:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257897",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:94" align="right">Comment 94</div>

I am putting this back to "need_review" unless someone really wants to do something to trigger the rebuild of `sage/rings/integer_ring.pyx` that I haven't touched but for which the building directory is doctested in a completely unrelated file, I think it should go in.



---

archive/issue_events_245070.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-11T21:49:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245070"
}
```



---

archive/issue_events_245071.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-06-11T21:49:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245071"
}
```



---

archive/issue_comments_257898.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">Comment 95</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285\">56929a9</a></td><td><code>Alter the interpreter.py doctest so it will pass whether sage/rings/integer_ring.pyx is rebuilt or not</code></td></tr></table>\n",
    "created_at": "2015-06-11T23:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257898",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95" align="right">Comment 95</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285">56929a9</a></td><td><code>Alter the interpreter.py doctest so it will pass whether sage/rings/integer_ring.pyx is rebuilt or not</code></td></tr></table>




---

archive/issue_comments_257899.json:
```json
{
    "body": "Changed commit from **[f4b868b](https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb)** to **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**",
    "created_at": "2015-06-11T23:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257899",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f4b868b](https://github.com/sagemath/sagetrac-mirror/commit/f4b868b4f34c5bf7de22c3f66db695c83baa61eb)** to **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**



---

archive/issue_comments_257900.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">Comment 96</div>\n\nJust one more push, changing the doctest a little bit means that it will pass whether or not we have a rebuild of `integer_ring.pyx` and it doesn't impact what the test is designed to do I believe.",
    "created_at": "2015-06-11T23:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257900",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:96" align="right">Comment 96</div>

Just one more push, changing the doctest a little bit means that it will pass whether or not we have a rebuild of `integer_ring.pyx` and it doesn't impact what the test is designed to do I believe.



---

archive/issue_comments_257901.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">Comment 97</div>\n\nReplying to [@kiwifb](#comment%3A92):\n> It probably means `sage/rings/integer_ring.pyx` hasn't been rebuilt after you patched. I thought touching setup.py would trigger that.\n\nNo, changing `setup.py` triggers re-compilation of everything (i.e. running of `gcc`) but not re-cythonizing. The usual trick to do that is to change what's in the `.cython_version` file, see line 545 of `setup.py`.",
    "created_at": "2015-06-12T04:51:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257901",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:97" align="right">Comment 97</div>

Replying to [@kiwifb](#comment%3A92):
> It probably means `sage/rings/integer_ring.pyx` hasn't been rebuilt after you patched. I thought touching setup.py would trigger that.

No, changing `setup.py` triggers re-compilation of everything (i.e. running of `gcc`) but not re-cythonizing. The usual trick to do that is to change what's in the `.cython_version` file, see line 545 of `setup.py`.



---

archive/issue_comments_257902.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">Comment 98</div>\n\nI guess this is good to go now.",
    "created_at": "2015-06-12T05:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257902",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:98" align="right">Comment 98</div>

I guess this is good to go now.



---

archive/issue_events_245072.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-12T05:04:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245072"
}
```



---

archive/issue_events_245073.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-12T05:04:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245073"
}
```



---

archive/issue_comments_257903.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">Comment 99</div>\n\nSorry for the delay but I  still have problems with trac12375. I have tried to isolate the problem:\n(can you reproduce it?)\n\nsetup.py:\n\n```\n#!/usr/bin/env sage -python\nfrom sage.env import *\nimport os\n\n###\ntry:\n    # Sage >= 6.8\n    from sage.env import sage_include_directories\nexcept ImportError:\n    # Sage < 6.8\n    def sage_include_directories(source=True):\n        return [\n            os.path.join(SAGE_LOCAL, \"include\"),\n            os.path.join(SAGE_LOCAL, \"include\", \"csage\"),\n            os.path.join(SAGE_SRC),\n            os.path.join(SAGE_SRC, \"sage\", \"ext\"),\n            ]\n###\n\nfrom distutils.core import setup\nfrom distutils.extension import Extension\n\n\ncmdclass = { }\next_modules = [ ]\n\ninclude_dirs=sage_include_directories(True)\n\nfrom Cython.Distutils import build_ext\n\next_modules+=[Extension(\n                   \"giacpy\",                 # name of extension\n                   [\"giacpy.pyx\"], #  our Cython source\n                   include_dirs=include_dirs,\n                   language=\"c++\")]\ncmdclass={'build_ext': build_ext}\n\n\nsetup(\n    ext_modules=ext_modules,\n    cmdclass=cmdclass\n    )\n```\n\nand giacpy.pyx\n\n```\nfrom sage.rings.integer cimport Integer\nfrom sage.env import * ##without this line it builts\ninclude 'sage/ext/interrupt.pxi'\ninclude 'sage/ext/stdsage.pxi'\n```\n\ngives:\n\n```\ngiacpy.cpp: In function \u2018int __pyx_import_star_set(PyObject*, PyObject*, char*)\u2019:\ngiacpy.cpp:3635:55: error: \u2018__pyx_convert__from_py_sage_signals_t\u2019 was not declared in this scope\n     _signals = __pyx_convert__from_py_sage_signals_t(o); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L2_error;};\n                \n```",
    "created_at": "2015-06-12T10:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257903",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:99" align="right">Comment 99</div>

Sorry for the delay but I  still have problems with trac12375. I have tried to isolate the problem:
(can you reproduce it?)

setup.py:

```
#!/usr/bin/env sage -python
from sage.env import *
import os

###
try:
    # Sage >= 6.8
    from sage.env import sage_include_directories
except ImportError:
    # Sage < 6.8
    def sage_include_directories(source=True):
        return [
            os.path.join(SAGE_LOCAL, "include"),
            os.path.join(SAGE_LOCAL, "include", "csage"),
            os.path.join(SAGE_SRC),
            os.path.join(SAGE_SRC, "sage", "ext"),
            ]
###

from distutils.core import setup
from distutils.extension import Extension


cmdclass = { }
ext_modules = [ ]

include_dirs=sage_include_directories(True)

from Cython.Distutils import build_ext

ext_modules+=[Extension(
                   "giacpy",                 # name of extension
                   ["giacpy.pyx"], #  our Cython source
                   include_dirs=include_dirs,
                   language="c++")]
cmdclass={'build_ext': build_ext}


setup(
    ext_modules=ext_modules,
    cmdclass=cmdclass
    )
```

and giacpy.pyx

```
from sage.rings.integer cimport Integer
from sage.env import * ##without this line it builts
include 'sage/ext/interrupt.pxi'
include 'sage/ext/stdsage.pxi'
```

gives:

```
giacpy.cpp: In function ‘int __pyx_import_star_set(PyObject*, PyObject*, char*)’:
giacpy.cpp:3635:55: error: ‘__pyx_convert__from_py_sage_signals_t’ was not declared in this scope
     _signals = __pyx_convert__from_py_sage_signals_t(o); if (PyErr_Occurred()) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L2_error;};
                
```



---

archive/issue_comments_257904.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nTwo remarks, in `setup.py` you have\n\n```\ninclude_dirs=sage_include_directories(True)\n```\nIt should be \n\n```\ninclude_dirs=sage_include_directories()\n```\nIn `giacpy.pyx` why would you need `from sage.env import *`? What do you need from this?",
    "created_at": "2015-06-12T10:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257904",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:0" align="right">Comment 0</div>

Two remarks, in `setup.py` you have

```
include_dirs=sage_include_directories(True)
```
It should be 

```
include_dirs=sage_include_directories()
```
In `giacpy.pyx` why would you need `from sage.env import *`? What do you need from this?



---

archive/issue_comments_257905.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nI have tried with and without True and got the same pb. But removing\nfrom sage.env import * doesn't help my original program, I have just tried to obtain a small code with the same error message.",
    "created_at": "2015-06-12T11:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257905",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:1" align="right">Comment 1</div>

I have tried with and without True and got the same pb. But removing
from sage.env import * doesn't help my original program, I have just tried to obtain a small code with the same error message.



---

archive/issue_comments_257906.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nDid it work at all before you included this ticket?",
    "created_at": "2015-06-12T11:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257906",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">Comment 2</div>

Did it work at all before you included this ticket?



---

archive/issue_comments_257907.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nit works for instance with sage 6.7. What I have notice on this small example:\n\n```\nrm giacpy.cpp; /usr/local/sage/sage setup.py build_ext\n```\nbuilts (on sage 6.7) but not:\n\n```\nrm giacpy.cpp; /home/fred/dev/sage/develop/sage/sage setup.py build_ext\n```\n(on my git)",
    "created_at": "2015-06-12T11:53:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257907",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:3" align="right">Comment 3</div>

it works for instance with sage 6.7. What I have notice on this small example:

```
rm giacpy.cpp; /usr/local/sage/sage setup.py build_ext
```
builts (on sage 6.7) but not:

```
rm giacpy.cpp; /home/fred/dev/sage/develop/sage/sage setup.py build_ext
```
(on my git)



---

archive/issue_comments_257908.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\n@frederichan-IMJPRG: it would help if you give us the exact and complete code you have trouble with: update #12375, rebase it on top of #18494 and then we can talk.",
    "created_at": "2015-06-12T11:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257908",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">Comment 4</div>

@frederichan-IMJPRG: it would help if you give us the exact and complete code you have trouble with: update #12375, rebase it on top of #18494 and then we can talk.



---

archive/issue_comments_257909.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nNB: it doesn't work with sage 6.8beta3 without your ticket. It just mean the this ticket doesn't solve my pb.",
    "created_at": "2015-06-12T11:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257909",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:5" align="right">Comment 5</div>

NB: it doesn't work with sage 6.8beta3 without your ticket. It just mean the this ticket doesn't solve my pb.



---

archive/issue_comments_257910.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">Comment 106</div>\n\nReplying to [@frederichan-IMJPRG](#comment%3A105):\n> NB: it doesn't work with sage 6.8beta3 without your ticket. It just mean the this ticket doesn't solve my pb.\n\nYes, I understood that. I'm saying that, regardless of earlier Sage versions, the best way forward is to use #18494 anyway.",
    "created_at": "2015-06-12T12:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257910",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:106" align="right">Comment 106</div>

Replying to [@frederichan-IMJPRG](#comment%3A105):
> NB: it doesn't work with sage 6.8beta3 without your ticket. It just mean the this ticket doesn't solve my pb.

Yes, I understood that. I'm saying that, regardless of earlier Sage versions, the best way forward is to use #18494 anyway.



---

archive/issue_comments_257911.json:
```json
{
    "body": "Changed branch from **[u/fbissey/trac18494](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac18494)** to **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**",
    "created_at": "2015-06-12T18:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18494#issuecomment-257911",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/trac18494](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/trac18494)** to **[56929a9](https://github.com/sagemath/sagetrac-mirror/commit/56929a9f831d77d5022fe8969ca8365db0487285)**



---

archive/issue_events_245074.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-12T18:23:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245074"
}
```



---

archive/issue_events_245075.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "054cb7babee36e9cb458f3243819f4c756cf006c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-06-12T18:23:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18494",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18494#event-245075"
}
```
