# Issue 18505: Enhance matrix similarity check

archive/issues_018268.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThe addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.\n\nCC:  @ThomasGagne @tscrim @videlec @rbeezer\n\nComponent: **linear algebra**\n\nKeywords: **matrix is_similar similarity**\n\nAuthor: **Rob Beezer**\n\nBranch/Commit: **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**\n\nReviewer: **Vincent Delecroix, Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18505_\n\n",
    "closed_at": "2017-01-18T20:40:07Z",
    "created_at": "2015-05-25T22:33:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Enhance matrix similarity check",
    "type": "issue",
    "updated_at": "2017-01-18T20:40:07Z",
    "url": "https://github.com/sagemath/sage/issues/18505",
    "user": "https://github.com/rbeezer"
}
```
<div id="comment:0"></div>

The addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.

CC:  @ThomasGagne @tscrim @videlec @rbeezer

Component: **linear algebra**

Keywords: **matrix is_similar similarity**

Author: **Rob Beezer**

Branch/Commit: **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**

Reviewer: **Vincent Delecroix, Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/18505_





---

archive/issue_events_260543.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260543"
}
```



---

archive/issue_events_260544.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260544"
}
```



---

archive/issue_events_260545.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260545"
}
```



---

archive/issue_events_260546.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260546"
}
```



---

archive/issue_events_260547.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:39:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260547"
}
```



---

archive/issue_comments_255517.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a\"><code>465e228</code></a></td><td><code>18505: enhance matrix similarity check</code></td></tr></table>\n",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255517",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a"><code>465e228</code></a></td><td><code>18505: enhance matrix similarity check</code></td></tr></table>




---

archive/issue_comments_255518.json:
```json
{
    "body": "Commit: **[`465e228`](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255518",
    "user": "https://github.com/rbeezer"
}
```

Commit: **[`465e228`](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)**



---

archive/issue_comments_255519.json:
```json
{
    "body": "Author: **Rob Beezer**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255519",
    "user": "https://github.com/rbeezer"
}
```

Author: **Rob Beezer**



---

archive/issue_comments_255520.json:
```json
{
    "body": "Branch: **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255520",
    "user": "https://github.com/rbeezer"
}
```

Branch: **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)**



---

archive/issue_events_260548.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260548"
}
```



---

archive/issue_events_260549.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260549"
}
```



---

archive/issue_events_260550.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260550"
}
```



---

archive/issue_events_260551.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260551"
}
```



---

archive/issue_comments_255521.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2015-08-06T15:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255521",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_255522.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHello,\n\nThis looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.\n\n1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`\n\n2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields\n\n```\nsage: QQ.algebraic_closure()\nAlgebraic Field\nsage: GF(3).algebraic_closure()\nAlgebraic closure of Finite Field of size 3\n```\n   Though, I do not know whether your code would work in this case.\n\n3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.\n\n```\nsage: m = matrix(ZZ,2,[0,1,1,1])\nsage: a = matrix(ZZ,2,[1,1,0,1])\nsage: b = matrix(ZZ,2,[1,0,1,1])\nsage: c = a*b*b*a*~b\nsage: m2 = c * m * ~c\nsage: m.is_similar(m2)\nTrue\nsage: m.is_similar(m2, True)\n(\n      [   1.000000000000000?               0.?e-18]\nTrue, [  0.7894736842105263? -0.05263157894736842?]\n)\n```\n  (sided note: the above command used to return `(False, matrix)`... see item 0)\n\n4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.\n\n6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?\n\nMore to come...\n\nVincent",
    "created_at": "2015-08-06T15:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255522",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">comment:3</div>

Hello,

This looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.

1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`

2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields

```
sage: QQ.algebraic_closure()
Algebraic Field
sage: GF(3).algebraic_closure()
Algebraic closure of Finite Field of size 3
```
   Though, I do not know whether your code would work in this case.

3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.

```
sage: m = matrix(ZZ,2,[0,1,1,1])
sage: a = matrix(ZZ,2,[1,1,0,1])
sage: b = matrix(ZZ,2,[1,0,1,1])
sage: c = a*b*b*a*~b
sage: m2 = c * m * ~c
sage: m.is_similar(m2)
True
sage: m.is_similar(m2, True)
(
      [   1.000000000000000?               0.?e-18]
True, [  0.7894736842105263? -0.05263157894736842?]
)
```
  (sided note: the above command used to return `(False, matrix)`... see item 0)

4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.

6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?

More to come...

Vincent



---

archive/issue_events_260552.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260552"
}
```



---

archive/issue_events_260553.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260553"
}
```



---

archive/issue_comments_255523.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI have some of the suggested changes.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c6c6a1944f7b23b5a81ad9d9e0f4e7d0302e52a\"><code>0c6c6a1</code></a></td><td><code>Trac #18505: (review) new style doctest continuation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80b4746937f132a1ab2217fdc8b33bca04c2748\"><code>e80b474</code></a></td><td><code>Trac #18505: (review) fix return value</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2386df551a87efb579474e5d2522b8d97804294f\"><code>2386df5</code></a></td><td><code>Trac #18505: (review) optimization</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e7b3c40019b907a57b6c25cf620651ff309e6a7\"><code>1e7b3c4</code></a></td><td><code>Merge branch 'public/18505' in 7.4.rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb15ba6bb154a6d87152d5dcf910fab5e23ff97a\"><code>bb15ba6</code></a></td><td><code>trac 18505 towards a better is_similar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59\"><code>25e0913</code></a></td><td><code>trac 18505 details</code></td></tr></table>\n",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255523",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

I have some of the suggested changes.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c6c6a1944f7b23b5a81ad9d9e0f4e7d0302e52a"><code>0c6c6a1</code></a></td><td><code>Trac #18505: (review) new style doctest continuation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80b4746937f132a1ab2217fdc8b33bca04c2748"><code>e80b474</code></a></td><td><code>Trac #18505: (review) fix return value</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2386df551a87efb579474e5d2522b8d97804294f"><code>2386df5</code></a></td><td><code>Trac #18505: (review) optimization</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e7b3c40019b907a57b6c25cf620651ff309e6a7"><code>1e7b3c4</code></a></td><td><code>Merge branch 'public/18505' in 7.4.rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb15ba6bb154a6d87152d5dcf910fab5e23ff97a"><code>bb15ba6</code></a></td><td><code>trac 18505 towards a better is_similar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59"><code>25e0913</code></a></td><td><code>trac 18505 details</code></td></tr></table>




---

archive/issue_comments_255524.json:
```json
{
    "body": "Changed commit from **[`465e228`](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)** to **[`25e0913`](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)**",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255524",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`465e228`](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)** to **[`25e0913`](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)**



---

archive/issue_comments_255525.json:
```json
{
    "body": "Changed branch from **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)** to **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)**",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255525",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)** to **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)**



---

archive/issue_events_260554.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260554"
}
```



---

archive/issue_events_260555.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260555"
}
```



---

archive/issue_comments_255526.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@videlec](#comment%3A3):\n> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\nStrong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.",
    "created_at": "2016-10-15T13:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255526",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@videlec](#comment%3A3):
> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.



---

archive/issue_comments_255527.json:
```json
{
    "body": "Changed commit from **[`25e0913`](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)** to **[`08ddbd1`](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)**",
    "created_at": "2016-10-15T17:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255527",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`25e0913`](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)** to **[`08ddbd1`](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)**



---

archive/issue_comments_255528.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b\"><code>08ddbd1</code></a></td><td><code>trac 18505 back to False for mismatched sizes</code></td></tr></table>\n",
    "created_at": "2016-10-15T17:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255528",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b"><code>08ddbd1</code></a></td><td><code>trac 18505 back to False for mismatched sizes</code></td></tr></table>




---

archive/issue_comments_255529.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAs a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.",
    "created_at": "2016-10-15T17:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255529",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

As a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.



---

archive/issue_comments_255530.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI don't particularly like it, but I can live with that (which means it must be a good compromise :P).",
    "created_at": "2016-10-15T18:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255530",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

I don't particularly like it, but I can live with that (which means it must be a good compromise :P).



---

archive/issue_events_260556.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T20:01:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260556"
}
```



---

archive/issue_events_260557.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T20:01:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260557"
}
```



---

archive/issue_comments_255531.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nsetting to **major**, because I am going to need this.",
    "created_at": "2016-10-15T20:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255531",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

setting to **major**, because I am going to need this.



---

archive/issue_comments_255532.json:
```json
{
    "body": "Changed commit from **[`08ddbd1`](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)** to **[`e12f614`](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)**",
    "created_at": "2016-10-15T20:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255532",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`08ddbd1`](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)** to **[`e12f614`](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)**



---

archive/issue_comments_255533.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e\"><code>e12f614</code></a></td><td><code>trac 18505 adding a new kind of example</code></td></tr></table>\n",
    "created_at": "2016-10-15T20:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e"><code>e12f614</code></a></td><td><code>trac 18505 adding a new kind of example</code></td></tr></table>




---

archive/issue_comments_255534.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhile I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?",
    "created_at": "2016-10-15T22:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255534",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

While I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?



---

archive/issue_comments_255535.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@tscrim](#comment%3A5):\n> Replying to [@videlec](#comment%3A3):\n> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> \n> \n> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n\nIt is not only a burden. It is a problem of well defined specifications.\n\nWith your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nWith your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n\n```\nsage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\nsage: from collections import defaultdict\nsage: d = defaultdict(list)\nsage: for e in elts: d[e.parent()].append(e)\nsage: d[RR]\n[3.40000000000000, 0.000000000000000]\nsage: d[ZZ]\n[1, 5]\nsage: d[QQ]\n[2/3, 5/2]\n```",
    "created_at": "2016-10-16T17:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255535",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@tscrim](#comment%3A5):
> Replying to [@videlec](#comment%3A3):
> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> 
> 
> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.

It is not only a burden. It is a problem of well defined specifications.

With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.

```
sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
sage: from collections import defaultdict
sage: d = defaultdict(list)
sage: for e in elts: d[e.parent()].append(e)
sage: d[RR]
[3.40000000000000, 0.000000000000000]
sage: d[ZZ]
[1, 5]
sage: d[QQ]
[2/3, 5/2]
```



---

archive/issue_comments_255536.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI am ready to go back to raising error for square matrices of different sizes.\n\nBut first, do yo have any other comment ?\n\nThe thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.",
    "created_at": "2016-10-16T19:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255536",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

I am ready to go back to raising error for square matrices of different sizes.

But first, do yo have any other comment ?

The thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.



---

archive/issue_comments_255537.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@videlec](#comment%3A12):\n> Replying to [@tscrim](#comment%3A5):\n> > Replying to [@videlec](#comment%3A3):\n> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> > \n> > \n> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n> \n> \n> It is not only a burden. It is a problem of well defined specifications.\n> \n> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nThe specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nI am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n\nYou're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n> \n> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n> \n> ```\n> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\n> sage: from collections import defaultdict\n> sage: d = defaultdict(list)\n> sage: for e in elts: d[e.parent()].append(e)\n> sage: d[RR]\n> [3.40000000000000, 0.000000000000000]\n> sage: d[ZZ]\n> [1, 5]\n> sage: d[QQ]\n> [2/3, 5/2]\n> ```\n\nYou've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.\n\nActually, does anyone know what the other Ma's do?",
    "created_at": "2016-10-17T02:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255537",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@videlec](#comment%3A12):
> Replying to [@tscrim](#comment%3A5):
> > Replying to [@videlec](#comment%3A3):
> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> > 
> > 
> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.
> 
> 
> It is not only a burden. It is a problem of well defined specifications.
> 
> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.

You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.
> 
> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.
> 
> ```
> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
> sage: from collections import defaultdict
> sage: d = defaultdict(list)
> sage: for e in elts: d[e.parent()].append(e)
> sage: d[RR]
> [3.40000000000000, 0.000000000000000]
> sage: d[ZZ]
> [1, 5]
> sage: d[QQ]
> [2/3, 5/2]
> ```

You've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.

Actually, does anyone know what the other Ma's do?



---

archive/issue_comments_255538.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@tscrim](#comment%3A14):\n> Replying to [@videlec](#comment%3A12):\n> > Replying to [@tscrim](#comment%3A5):\n> > > Replying to [@videlec](#comment%3A3):\n> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> > > \n> > > \n> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n> > \n> > \n> > It is not only a burden. It is a problem of well defined specifications.\n> > \n> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n> \n> \n> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nFor me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nAs you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n\nWhat you are suggesting is a `is_similar` with the following behavior\n\n```\ndef is_similar(self, other):\n    try:\n        return self.is_conjugate(other)\n    except Exception:\n        return False\n```\nwhere the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\n> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> \n> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n\nYou are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n\n```\nsage: identity_matrix(10) == 1\nTrue\n```\n\n> Actually, does anyone know what the other Ma's do?\n\nAt least I found\n\n* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.",
    "created_at": "2016-10-17T06:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255538",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@tscrim](#comment%3A14):
> Replying to [@videlec](#comment%3A12):
> > Replying to [@tscrim](#comment%3A5):
> > > Replying to [@videlec](#comment%3A3):
> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> > > 
> > > 
> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.
> > 
> > 
> > It is not only a burden. It is a problem of well defined specifications.
> > 
> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).
> 
> 
> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.

What you are suggesting is a `is_similar` with the following behavior

```
def is_similar(self, other):
    try:
        return self.is_conjugate(other)
    except Exception:
        return False
```
where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> 
> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.

You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage

```
sage: identity_matrix(10) == 1
True
```

> Actually, does anyone know what the other Ma's do?

At least I found

* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.



---

archive/issue_comments_255539.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@videlec](#comment%3A15):\n> Replying to [@tscrim](#comment%3A14):\n> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n> \n> \n> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nThe natural algebra in this case would be the product algebra over a common (larger) base ring.\n\n> As you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n> \n> What you are suggesting is a `is_similar` with the following behavior\n> \n> ```\n> def is_similar(self, other):\n>     try:\n>         return self.is_conjugate(other)\n>     except Exception:\n>         return False\n> ```\n> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\nI think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.\n\n> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> > \n> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n> \n> \n> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n> \n> ```\n> sage: identity_matrix(10) == 1\n> True\n> ```\n\nI guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?\n\nMore I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.\n\n> > Actually, does anyone know what the other Ma's do?\n> \n> \n> At least I found\n> \n> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.\n\nMaple returns `false`. I couldn't find anything on Mathematica either.",
    "created_at": "2016-10-17T14:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255539",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@videlec](#comment%3A15):
> Replying to [@tscrim](#comment%3A14):
> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?
> 
> 
> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

The natural algebra in this case would be the product algebra over a common (larger) base ring.

> As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.
> 
> What you are suggesting is a `is_similar` with the following behavior
> 
> ```
> def is_similar(self, other):
>     try:
>         return self.is_conjugate(other)
>     except Exception:
>         return False
> ```
> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

I think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.

> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> > 
> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.
> 
> 
> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage
> 
> ```
> sage: identity_matrix(10) == 1
> True
> ```

I guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?

More I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.

> > Actually, does anyone know what the other Ma's do?
> 
> 
> At least I found
> 
> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.

Maple returns `false`. I couldn't find anything on Mathematica either.



---

archive/issue_comments_255540.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?\n\nThere will be a conflict with an existing ticket tackling \"... --> .....:\" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(",
    "created_at": "2016-10-19T19:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255540",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

I would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?

There will be a conflict with an existing ticket tackling "... --> .....:" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(



---

archive/issue_comments_255541.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe reference for the algorithms used by m*gma is\n\n```\nAllan Steel.\nA New Algorithm for the Computation of Canonical Forms of Matrices over Fields.\nJ. Symbolic Comp., 24(3):409--432, 1997. \n```",
    "created_at": "2016-10-19T19:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255541",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

The reference for the algorithms used by m*gma is

```
Allan Steel.
A New Algorithm for the Computation of Canonical Forms of Matrices over Fields.
J. Symbolic Comp., 24(3):409--432, 1997. 
```



---

archive/issue_comments_255542.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.",
    "created_at": "2016-10-19T21:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255542",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

I strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.



---

archive/issue_comments_255543.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)\n\nBut I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!",
    "created_at": "2016-10-24T19:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255543",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

I must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)

But I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!



---

archive/issue_comments_255544.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think we should bring it to a discussion/vote on sage-devel.",
    "created_at": "2016-10-24T19:17:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255544",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

I think we should bring it to a discussion/vote on sage-devel.



---

archive/issue_comments_255545.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI have started a vote on sage-devel.",
    "created_at": "2016-10-27T08:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255545",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

I have started a vote on sage-devel.



---

archive/issue_comments_255546.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nIf I count correctly, the result of the vote is\n\n```\nAA = 6\nBB = 3\n?A = 1\n```\nso I am going to go back to raising errors in both cases.\n\nI somebody wants to remove the \"is_similar\" method for non-square matrices, it should be in another ticket.",
    "created_at": "2016-11-01T08:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255546",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

If I count correctly, the result of the vote is

```
AA = 6
BB = 3
?A = 1
```
so I am going to go back to raising errors in both cases.

I somebody wants to remove the "is_similar" method for non-square matrices, it should be in another ticket.



---

archive/issue_comments_255547.json:
```json
{
    "body": "Changed branch from **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)** to **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)**",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255547",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)** to **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)**



---

archive/issue_comments_255548.json:
```json
{
    "body": "Changed commit from **[`e12f614`](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)** to **[`4740a42`](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)**",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255548",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`e12f614`](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)** to **[`4740a42`](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)**



---

archive/issue_comments_255549.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/914fb4f524f69323c25ded43354b8f7863131863\"><code>914fb4f</code></a></td><td><code>Merge branch 'public/18505' in 7.5.b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d\"><code>4740a42</code></a></td><td><code>trac 18505 back to raising errors</code></td></tr></table>\n",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255549",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/914fb4f524f69323c25ded43354b8f7863131863"><code>914fb4f</code></a></td><td><code>Merge branch 'public/18505' in 7.5.b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d"><code>4740a42</code></a></td><td><code>trac 18505 back to raising errors</code></td></tr></table>




---

archive/issue_comments_255550.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nbot is green, please review",
    "created_at": "2016-11-02T18:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255550",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

bot is green, please review



---

archive/issue_comments_255551.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.",
    "created_at": "2016-11-02T19:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255551",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:26" align="right">comment:26</div>

I've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.



---

archive/issue_comments_255552.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI was going to put this on the sage-devel vote, but it looks like the topic got locked.\n\n#####\n\nThanks to Vincent, Travis and Fr\u00e9d\u00e9ric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.\n\nI have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.",
    "created_at": "2016-11-02T19:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255552",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:27" align="right">comment:27</div>

I was going to put this on the sage-devel vote, but it looks like the topic got locked.

#####

Thanks to Vincent, Travis and Frédéric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.

I have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.



---

archive/issue_comments_255553.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nVincent, would you give a positive review ?",
    "created_at": "2016-11-09T20:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255553",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:28" align="right">comment:28</div>

Vincent, would you give a positive review ?



---

archive/issue_comments_255554.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nplease, somebody ? this is ready and useful !",
    "created_at": "2016-11-11T20:42:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255554",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:29" align="right">comment:29</div>

please, somebody ? this is ready and useful !



---

archive/issue_comments_255555.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWhy did this change\n\n```diff\n+        A matrix over the integers will be promoted to a\n+        matrix over the rationals, but may need to be manually\n+        promoted to the algebraic numbers.  ::\n+\n             sage: A = matrix(ZZ, 2, 2, range(4))\n             sage: B = matrix(QQbar, 2, 2, range(4))\n             sage: A.is_similar(B)\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: matrices need to have entries with identical fraction fields,\n+            not Rational Field and Algebraic Field\n+            sage: A.change_ring(QQbar).is_similar(B)\n             True\n```\nThere is a natural coercion here.",
    "created_at": "2016-11-12T20:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255555",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

Why did this change

```diff
+        A matrix over the integers will be promoted to a
+        matrix over the rationals, but may need to be manually
+        promoted to the algebraic numbers.  ::
+
             sage: A = matrix(ZZ, 2, 2, range(4))
             sage: B = matrix(QQbar, 2, 2, range(4))
             sage: A.is_similar(B)
+            Traceback (most recent call last):
+            ...
+            TypeError: matrices need to have entries with identical fraction fields,
+            not Rational Field and Algebraic Field
+            sage: A.change_ring(QQbar).is_similar(B)
             True
```
There is a natural coercion here.



---

archive/issue_events_260558.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-11-12T20:58:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260558"
}
```



---

archive/issue_events_260559.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-11-12T20:58:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260559"
}
```



---

archive/issue_comments_255556.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n\n```\nsage: cm = get_coercion_model()\nsage: m1 = matrix(ZZ, 2, range(4))\nsage: m2 = matrix(QQbar, 2, range(4))\nsage: mm1, mm2 = cm.canonical_coercion(m1, m2)\nsage: mm1.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\nsage: mm2.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\n```",
    "created_at": "2016-11-12T21:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255556",
    "user": "https://github.com/videlec"
}
```

<div id="comment:31" align="right">comment:31</div>


```
sage: cm = get_coercion_model()
sage: m1 = matrix(ZZ, 2, range(4))
sage: m2 = matrix(QQbar, 2, range(4))
sage: mm1, mm2 = cm.canonical_coercion(m1, m2)
sage: mm1.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
sage: mm2.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
```



---

archive/issue_comments_255557.json:
```json
{
    "body": "Changed commit from **[`4740a42`](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)** to **[`bfedf0e`](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)**",
    "created_at": "2016-11-18T14:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255557",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4740a42`](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)** to **[`bfedf0e`](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)**



---

archive/issue_comments_255558.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de86aefb05f04dfb5dc3310c30c339393a111e73\"><code>de86aef</code></a></td><td><code>Merge branch 'u/chapoton/18505' in 7.5.b3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99\"><code>bfedf0e</code></a></td><td><code>trac 18505 trying to introduce coercion in the game</code></td></tr></table>\n",
    "created_at": "2016-11-18T14:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255558",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de86aefb05f04dfb5dc3310c30c339393a111e73"><code>de86aef</code></a></td><td><code>Merge branch 'u/chapoton/18505' in 7.5.b3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99"><code>bfedf0e</code></a></td><td><code>trac 18505 trying to introduce coercion in the game</code></td></tr></table>




---

archive/issue_comments_255559.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nHere is a commit trying to involve coercion if possible. Not tested yet.",
    "created_at": "2016-11-18T14:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255559",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:33" align="right">comment:33</div>

Here is a commit trying to involve coercion if possible. Not tested yet.



---

archive/issue_comments_255560.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nLooks good. But you can avoid complications with\n\n```\nif parent(A) != parent(B):\n    coercion\n```\nat the very begining. But we would loose specific error message for different sizes.",
    "created_at": "2016-11-18T14:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255560",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Looks good. But you can avoid complications with

```
if parent(A) != parent(B):
    coercion
```
at the very begining. But we would loose specific error message for different sizes.



---

archive/issue_comments_255561.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSince `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.",
    "created_at": "2016-11-18T14:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255561",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Since `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.



---

archive/issue_comments_255562.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1\"><code>86a80c2</code></a></td><td><code>trac 18505 using have_same_parent</code></td></tr></table>\n",
    "created_at": "2016-11-18T16:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1"><code>86a80c2</code></a></td><td><code>trac 18505 using have_same_parent</code></td></tr></table>




---

archive/issue_comments_255563.json:
```json
{
    "body": "Changed commit from **[`bfedf0e`](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)** to **[`86a80c2`](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)**",
    "created_at": "2016-11-18T16:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255563",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bfedf0e`](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)** to **[`86a80c2`](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)**



---

archive/issue_comments_255564.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI am not fond of the idea of starting by comparing parents. Better keep the useful error messages.\n\nHere is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results",
    "created_at": "2016-11-18T16:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255564",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:37" align="right">comment:37</div>

I am not fond of the idea of starting by comparing parents. Better keep the useful error messages.

Here is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results



---

archive/issue_comments_255565.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThere is also the `@coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...",
    "created_at": "2016-11-18T17:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255565",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:38" align="right">comment:38</div>

There is also the `@coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...



---

archive/issue_comments_255566.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25\"><code>6b168e4</code></a></td><td><code>trac 18505 fixing details</code></td></tr></table>\n",
    "created_at": "2016-11-18T17:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255566",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25"><code>6b168e4</code></a></td><td><code>trac 18505 fixing details</code></td></tr></table>




---

archive/issue_comments_255567.json:
```json
{
    "body": "Changed commit from **[`86a80c2`](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)** to **[`6b168e4`](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)**",
    "created_at": "2016-11-18T17:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255567",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`86a80c2`](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)** to **[`6b168e4`](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)**



---

archive/issue_events_260560.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-18T17:52:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260560"
}
```



---

archive/issue_events_260561.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-18T17:52:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260561"
}
```



---

archive/issue_comments_255568.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nok, please review",
    "created_at": "2016-11-18T17:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255568",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:40" align="right">comment:40</div>

ok, please review



---

archive/issue_comments_255569.json:
```json
{
    "body": "Changed commit from **[`6b168e4`](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)** to **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**",
    "created_at": "2016-11-18T19:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255569",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6b168e4`](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)** to **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**



---

archive/issue_comments_255570.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c\"><code>92aac67</code></a></td><td><code>trac 18505 fix rubric in doc</code></td></tr></table>\n",
    "created_at": "2016-11-18T19:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255570",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c"><code>92aac67</code></a></td><td><code>trac 18505 fix rubric in doc</code></td></tr></table>




---

archive/issue_comments_255571.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nping ?",
    "created_at": "2016-11-25T10:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255571",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:42" align="right">comment:42</div>

ping ?



---

archive/issue_comments_255572.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\n*ping* !",
    "created_at": "2016-12-08T09:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255572",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:43" align="right">comment:43</div>

*ping* !



---

archive/issue_comments_255573.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\n**P I N  G** ?",
    "created_at": "2016-12-30T18:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255573",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:44" align="right">comment:44</div>

**P I N  G** ?



---

archive/issue_comments_255574.json:
```json
{
    "body": "Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Travis Scrimshaw**",
    "created_at": "2017-01-01T00:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255574",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Travis Scrimshaw**



---

archive/issue_comments_255575.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nEverything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.",
    "created_at": "2017-01-01T00:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255575",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Everything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.



---

archive/issue_comments_255576.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nAs a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of \"is_similar\" which gives the change-of-basis matrix over any field, **once this ticket is closed**.",
    "created_at": "2017-01-03T20:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255576",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:46" align="right">comment:46</div>

As a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of "is_similar" which gives the change-of-basis matrix over any field, **once this ticket is closed**.



---

archive/issue_events_260562.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-01-07T20:57:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260562"
}
```



---

archive/issue_events_260563.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-01-07T20:57:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260563"
}
```



---

archive/issue_comments_255577.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nLet it go and happy new year!",
    "created_at": "2017-01-07T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255577",
    "user": "https://github.com/videlec"
}
```

<div id="comment:47" align="right">comment:47</div>

Let it go and happy new year!



---

archive/issue_events_260564.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-13T12:30:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260564"
}
```



---

archive/issue_events_260565.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-13T12:30:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260565"
}
```



---

archive/issue_events_260566.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-18T20:40:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260566"
}
```



---

archive/issue_events_260567.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "76ab75743e4826497cbad159fc0d0bf3f3ea994c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-18T20:40:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-260567"
}
```



---

archive/issue_comments_255578.json:
```json
{
    "body": "Changed branch from **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)** to **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**",
    "created_at": "2017-01-18T20:40:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-255578",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)** to **[`92aac67`](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**
