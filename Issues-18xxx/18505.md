# Issue 18505: Enhance matrix similarity check

archive/issues_018268.json:
```json
{
    "assignees": [],
    "body": "The addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.\n\nCC:  @ThomasGagne @tscrim @videlec @rbeezer\n\nKeywords: **matrix is_similar similarity**\n\nBranch/Commit: **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**\n\nReviewer: **Vincent Delecroix, Travis Scrimshaw**\n\nAuthor: **Rob Beezer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18505_\n\n",
    "closed_at": "2017-01-18T20:40:07Z",
    "created_at": "2015-05-25T22:33:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Enhance matrix similarity check",
    "type": "issue",
    "updated_at": "2017-01-18T20:40:07Z",
    "url": "https://github.com/sagemath/sage/issues/18505",
    "user": "https://github.com/rbeezer"
}
```
The addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.

CC:  @ThomasGagne @tscrim @videlec @rbeezer

Keywords: **matrix is_similar similarity**

Branch/Commit: **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**

Reviewer: **Vincent Delecroix, Travis Scrimshaw**

Author: **Rob Beezer**

_Issue created by migration from https://trac.sagemath.org/ticket/18505_





---

archive/issue_events_245193.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245193"
}
```



---

archive/issue_events_245194.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245194"
}
```



---

archive/issue_events_245195.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245195"
}
```



---

archive/issue_events_245196.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:33:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245196"
}
```



---

archive/issue_events_245197.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2015-05-25T22:39:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245197"
}
```



---

archive/issue_comments_258110.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a\">465e228</a></td><td><code>18505: enhance matrix similarity check</code></td></tr></table>\n",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258110",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a">465e228</a></td><td><code>18505: enhance matrix similarity check</code></td></tr></table>




---

archive/issue_comments_258111.json:
```json
{
    "body": "Commit: **[465e228](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258111",
    "user": "https://github.com/rbeezer"
}
```

Commit: **[465e228](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)**



---

archive/issue_comments_258112.json:
```json
{
    "body": "Author: **Rob Beezer**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258112",
    "user": "https://github.com/rbeezer"
}
```

Author: **Rob Beezer**



---

archive/issue_comments_258113.json:
```json
{
    "body": "Branch: **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)**",
    "created_at": "2015-05-25T22:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258113",
    "user": "https://github.com/rbeezer"
}
```

Branch: **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)**



---

archive/issue_events_245198.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245198"
}
```



---

archive/issue_events_245199.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245199"
}
```



---

archive/issue_events_245200.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245200"
}
```



---

archive/issue_events_245201.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-06T15:15:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245201"
}
```



---

archive/issue_comments_258114.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2015-08-06T15:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258114",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_258115.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nHello,\n\nThis looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.\n\n1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`\n\n2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields\n\n```\nsage: QQ.algebraic_closure()\nAlgebraic Field\nsage: GF(3).algebraic_closure()\nAlgebraic closure of Finite Field of size 3\n```\n   Though, I do not know whether your code would work in this case.\n\n3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.\n\n```\nsage: m = matrix(ZZ,2,[0,1,1,1])\nsage: a = matrix(ZZ,2,[1,1,0,1])\nsage: b = matrix(ZZ,2,[1,0,1,1])\nsage: c = a*b*b*a*~b\nsage: m2 = c * m * ~c\nsage: m.is_similar(m2)\nTrue\nsage: m.is_similar(m2, True)\n(\n      [   1.000000000000000?               0.?e-18]\nTrue, [  0.7894736842105263? -0.05263157894736842?]\n)\n```\n  (sided note: the above command used to return `(False, matrix)`... see item 0)\n\n4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.\n\n6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?\n\nMore to come...\n\nVincent",
    "created_at": "2015-08-06T15:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258115",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'>Comment 3:</a>
Hello,

This looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.

1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`

2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields

```
sage: QQ.algebraic_closure()
Algebraic Field
sage: GF(3).algebraic_closure()
Algebraic closure of Finite Field of size 3
```
   Though, I do not know whether your code would work in this case.

3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.

```
sage: m = matrix(ZZ,2,[0,1,1,1])
sage: a = matrix(ZZ,2,[1,1,0,1])
sage: b = matrix(ZZ,2,[1,0,1,1])
sage: c = a*b*b*a*~b
sage: m2 = c * m * ~c
sage: m.is_similar(m2)
True
sage: m.is_similar(m2, True)
(
      [   1.000000000000000?               0.?e-18]
True, [  0.7894736842105263? -0.05263157894736842?]
)
```
  (sided note: the above command used to return `(False, matrix)`... see item 0)

4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.

6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?

More to come...

Vincent



---

archive/issue_events_245202.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245202"
}
```



---

archive/issue_events_245203.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245203"
}
```



---

archive/issue_comments_258116.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI have some of the suggested changes.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c6c6a1944f7b23b5a81ad9d9e0f4e7d0302e52a\">0c6c6a1</a></td><td><code>Trac #18505: (review) new style doctest continuation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80b4746937f132a1ab2217fdc8b33bca04c2748\">e80b474</a></td><td><code>Trac #18505: (review) fix return value</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2386df551a87efb579474e5d2522b8d97804294f\">2386df5</a></td><td><code>Trac #18505: (review) optimization</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e7b3c40019b907a57b6c25cf620651ff309e6a7\">1e7b3c4</a></td><td><code>Merge branch 'public/18505' in 7.4.rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb15ba6bb154a6d87152d5dcf910fab5e23ff97a\">bb15ba6</a></td><td><code>trac 18505 towards a better is_similar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59\">25e0913</a></td><td><code>trac 18505 details</code></td></tr></table>\n",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258116",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'>Comment 4:</a>
I have some of the suggested changes.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c6c6a1944f7b23b5a81ad9d9e0f4e7d0302e52a">0c6c6a1</a></td><td><code>Trac #18505: (review) new style doctest continuation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80b4746937f132a1ab2217fdc8b33bca04c2748">e80b474</a></td><td><code>Trac #18505: (review) fix return value</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2386df551a87efb579474e5d2522b8d97804294f">2386df5</a></td><td><code>Trac #18505: (review) optimization</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e7b3c40019b907a57b6c25cf620651ff309e6a7">1e7b3c4</a></td><td><code>Merge branch 'public/18505' in 7.4.rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb15ba6bb154a6d87152d5dcf910fab5e23ff97a">bb15ba6</a></td><td><code>trac 18505 towards a better is_similar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59">25e0913</a></td><td><code>trac 18505 details</code></td></tr></table>




---

archive/issue_comments_258117.json:
```json
{
    "body": "Changed commit from **[465e228](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)** to **[25e0913](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)**",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258117",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[465e228](https://github.com/sagemath/sagetrac-mirror/commit/465e2287bbe34ddcfe4190799e33b5ccf5ec980a)** to **[25e0913](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)**



---

archive/issue_comments_258118.json:
```json
{
    "body": "Changed branch from **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)** to **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)**",
    "created_at": "2016-10-15T13:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258118",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/rbeezer/is-similar](https://github.com/sagemath/sagetrac-mirror/tree/u/rbeezer/is-similar)** to **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)**



---

archive/issue_events_245204.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245204"
}
```



---

archive/issue_events_245205.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T13:01:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245205"
}
```



---

archive/issue_comments_258119.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@videlec](#comment%3A3):\n> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\nStrong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.",
    "created_at": "2016-10-15T13:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258119",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@videlec](#comment%3A3):
> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.



---

archive/issue_comments_258120.json:
```json
{
    "body": "Changed commit from **[25e0913](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)** to **[08ddbd1](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)**",
    "created_at": "2016-10-15T17:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258120",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[25e0913](https://github.com/sagemath/sagetrac-mirror/commit/25e0913f65ed127c9d2d6fc9f967eef390c1af59)** to **[08ddbd1](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)**



---

archive/issue_comments_258121.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b\">08ddbd1</a></td><td><code>trac 18505 back to False for mismatched sizes</code></td></tr></table>\n",
    "created_at": "2016-10-15T17:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258121",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b">08ddbd1</a></td><td><code>trac 18505 back to False for mismatched sizes</code></td></tr></table>




---

archive/issue_comments_258122.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nAs a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.",
    "created_at": "2016-10-15T17:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258122",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'>Comment 7:</a>
As a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.



---

archive/issue_comments_258123.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI don't particularly like it, but I can live with that (which means it must be a good compromise :P).",
    "created_at": "2016-10-15T18:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258123",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'>Comment 8:</a>
I don't particularly like it, but I can live with that (which means it must be a good compromise :P).



---

archive/issue_events_245206.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T20:01:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245206"
}
```



---

archive/issue_events_245207.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-10-15T20:01:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245207"
}
```



---

archive/issue_comments_258124.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nsetting to **major**, because I am going to need this.",
    "created_at": "2016-10-15T20:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258124",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'>Comment 9:</a>
setting to **major**, because I am going to need this.



---

archive/issue_comments_258125.json:
```json
{
    "body": "Changed commit from **[08ddbd1](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)** to **[e12f614](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)**",
    "created_at": "2016-10-15T20:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258125",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[08ddbd1](https://github.com/sagemath/sagetrac-mirror/commit/08ddbd1db45dc11166891b361a853999d44a9a5b)** to **[e12f614](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)**



---

archive/issue_comments_258126.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e\">e12f614</a></td><td><code>trac 18505 adding a new kind of example</code></td></tr></table>\n",
    "created_at": "2016-10-15T20:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258126",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e">e12f614</a></td><td><code>trac 18505 adding a new kind of example</code></td></tr></table>




---

archive/issue_comments_258127.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nWhile I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?",
    "created_at": "2016-10-15T22:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258127",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'>Comment 11:</a>
While I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?



---

archive/issue_comments_258128.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@tscrim](#comment%3A5):\n> Replying to [@videlec](#comment%3A3):\n> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n> \n> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n\nIt is not only a burden. It is a problem of well defined specifications.\n\nWith your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nWith your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n\n```\nsage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\nsage: from collections import defaultdict\nsage: d = defaultdict(list)\nsage: for e in elts: d[e.parent()].append(e)\nsage: d[RR]\n[3.40000000000000, 0.000000000000000]\nsage: d[ZZ]\n[1, 5]\nsage: d[QQ]\n[2/3, 5/2]\n```",
    "created_at": "2016-10-16T17:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258128",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@tscrim](#comment%3A5):
> Replying to [@videlec](#comment%3A3):
> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

> 
> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.

It is not only a burden. It is a problem of well defined specifications.

With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.

```
sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
sage: from collections import defaultdict
sage: d = defaultdict(list)
sage: for e in elts: d[e.parent()].append(e)
sage: d[RR]
[3.40000000000000, 0.000000000000000]
sage: d[ZZ]
[1, 5]
sage: d[QQ]
[2/3, 5/2]
```



---

archive/issue_comments_258129.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI am ready to go back to raising error for square matrices of different sizes.\n\nBut first, do yo have any other comment ?\n\nThe thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.",
    "created_at": "2016-10-16T19:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258129",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>Comment 13:</a>
I am ready to go back to raising error for square matrices of different sizes.

But first, do yo have any other comment ?

The thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.



---

archive/issue_comments_258130.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@videlec](#comment%3A12):\n> Replying to [@tscrim](#comment%3A5):\n> > Replying to [@videlec](#comment%3A3):\n> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n> > \n> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n\n> \n> It is not only a burden. It is a problem of well defined specifications.\n> \n> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nThe specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nI am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n\nYou're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n> \n> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n> \n> ```\n> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\n> sage: from collections import defaultdict\n> sage: d = defaultdict(list)\n> sage: for e in elts: d[e.parent()].append(e)\n> sage: d[RR]\n> [3.40000000000000, 0.000000000000000]\n> sage: d[ZZ]\n> [1, 5]\n> sage: d[QQ]\n> [2/3, 5/2]\n> ```\n\nYou've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.\n\nActually, does anyone know what the other Ma's do?",
    "created_at": "2016-10-17T02:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258130",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@videlec](#comment%3A12):
> Replying to [@tscrim](#comment%3A5):
> > Replying to [@videlec](#comment%3A3):
> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

> > 
> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.

> 
> It is not only a burden. It is a problem of well defined specifications.
> 
> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.

You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.
> 
> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.
> 
> ```
> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
> sage: from collections import defaultdict
> sage: d = defaultdict(list)
> sage: for e in elts: d[e.parent()].append(e)
> sage: d[RR]
> [3.40000000000000, 0.000000000000000]
> sage: d[ZZ]
> [1, 5]
> sage: d[QQ]
> [2/3, 5/2]
> ```

You've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.

Actually, does anyone know what the other Ma's do?



---

archive/issue_comments_258131.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@tscrim](#comment%3A14):\n> Replying to [@videlec](#comment%3A12):\n> > Replying to [@tscrim](#comment%3A5):\n> > > Replying to [@videlec](#comment%3A3):\n> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n> > > \n> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n\n> > \n> > It is not only a burden. It is a problem of well defined specifications.\n> > \n> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\n> \n> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nFor me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nAs you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n\nWhat you are suggesting is a `is_similar` with the following behavior\n\n```\ndef is_similar(self, other):\n    try:\n        return self.is_conjugate(other)\n    except Exception:\n        return False\n```\nwhere the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\n> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> \n> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n\nYou are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n\n```\nsage: identity_matrix(10) == 1\nTrue\n```\n\n> Actually, does anyone know what the other Ma's do?\n\nAt least I found\n\n* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.",
    "created_at": "2016-10-17T06:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258131",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@tscrim](#comment%3A14):
> Replying to [@videlec](#comment%3A12):
> > Replying to [@tscrim](#comment%3A5):
> > > Replying to [@videlec](#comment%3A3):
> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

> > > 
> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.

> > 
> > It is not only a burden. It is a problem of well defined specifications.
> > 
> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

> 
> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.

What you are suggesting is a `is_similar` with the following behavior

```
def is_similar(self, other):
    try:
        return self.is_conjugate(other)
    except Exception:
        return False
```
where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> 
> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.

You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage

```
sage: identity_matrix(10) == 1
True
```

> Actually, does anyone know what the other Ma's do?

At least I found

* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.



---

archive/issue_comments_258132.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@videlec](#comment%3A15):\n> Replying to [@tscrim](#comment%3A14):\n> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\n> \n> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nThe natural algebra in this case would be the product algebra over a common (larger) base ring.\n\n> As you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n> \n> What you are suggesting is a `is_similar` with the following behavior\n> \n> ```\n> def is_similar(self, other):\n>     try:\n>         return self.is_conjugate(other)\n>     except Exception:\n>         return False\n> ```\n> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\nI think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.\n\n> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> > \n> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n\n> \n> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n> \n> ```\n> sage: identity_matrix(10) == 1\n> True\n> ```\n\nI guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?\n\nMore I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.\n\n> > Actually, does anyone know what the other Ma's do?\n\n> \n> At least I found\n> \n> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.\n\nMaple returns `false`. I couldn't find anything on Mathematica either.",
    "created_at": "2016-10-17T14:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258132",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@videlec](#comment%3A15):
> Replying to [@tscrim](#comment%3A14):
> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

> 
> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3](#comment%3A3)). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

The natural algebra in this case would be the product algebra over a common (larger) base ring.

> As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.
> 
> What you are suggesting is a `is_similar` with the following behavior
> 
> ```
> def is_similar(self, other):
>     try:
>         return self.is_conjugate(other)
>     except Exception:
>         return False
> ```
> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

I think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.

> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> > 
> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.

> 
> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage
> 
> ```
> sage: identity_matrix(10) == 1
> True
> ```

I guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?

More I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.

> > Actually, does anyone know what the other Ma's do?

> 
> At least I found
> 
> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.

Maple returns `false`. I couldn't find anything on Mathematica either.



---

archive/issue_comments_258133.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?\n\nThere will be a conflict with an existing ticket tackling \"... --> .....:\" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(",
    "created_at": "2016-10-19T19:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258133",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>Comment 17:</a>
I would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?

There will be a conflict with an existing ticket tackling "... --> .....:" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(



---

archive/issue_comments_258134.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nThe reference for the algorithms used by m*gma is\n\n```\nAllan Steel.\nA New Algorithm for the Computation of Canonical Forms of Matrices over Fields.\nJ. Symbolic Comp., 24(3):409--432, 1997. \n```",
    "created_at": "2016-10-19T19:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258134",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'>Comment 18:</a>
The reference for the algorithms used by m*gma is

```
Allan Steel.
A New Algorithm for the Computation of Canonical Forms of Matrices over Fields.
J. Symbolic Comp., 24(3):409--432, 1997. 
```



---

archive/issue_comments_258135.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.",
    "created_at": "2016-10-19T21:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258135",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'>Comment 19:</a>
I strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.



---

archive/issue_comments_258136.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nI must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)\n\nBut I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!",
    "created_at": "2016-10-24T19:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258136",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'>Comment 20:</a>
I must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)

But I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!



---

archive/issue_comments_258137.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI think we should bring it to a discussion/vote on sage-devel.",
    "created_at": "2016-10-24T19:17:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258137",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'>Comment 21:</a>
I think we should bring it to a discussion/vote on sage-devel.



---

archive/issue_comments_258138.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI have started a vote on sage-devel.",
    "created_at": "2016-10-27T08:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258138",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'>Comment 22:</a>
I have started a vote on sage-devel.



---

archive/issue_comments_258139.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nIf I count correctly, the result of the vote is\n\n```\nAA = 6\nBB = 3\n?A = 1\n```\nso I am going to go back to raising errors in both cases.\n\nI somebody wants to remove the \"is_similar\" method for non-square matrices, it should be in another ticket.",
    "created_at": "2016-11-01T08:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258139",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'>Comment 23:</a>
If I count correctly, the result of the vote is

```
AA = 6
BB = 3
?A = 1
```
so I am going to go back to raising errors in both cases.

I somebody wants to remove the "is_similar" method for non-square matrices, it should be in another ticket.



---

archive/issue_comments_258140.json:
```json
{
    "body": "Changed branch from **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)** to **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)**",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258140",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[public/18505](https://github.com/sagemath/sagetrac-mirror/tree/public/18505)** to **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)**



---

archive/issue_comments_258141.json:
```json
{
    "body": "Changed commit from **[e12f614](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)** to **[4740a42](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)**",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258141",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[e12f614](https://github.com/sagemath/sagetrac-mirror/commit/e12f61466cecddd78679ebcd2cb3395d0fa9712e)** to **[4740a42](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)**



---

archive/issue_comments_258142.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/914fb4f524f69323c25ded43354b8f7863131863\">914fb4f</a></td><td><code>Merge branch 'public/18505' in 7.5.b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d\">4740a42</a></td><td><code>trac 18505 back to raising errors</code></td></tr></table>\n",
    "created_at": "2016-11-01T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258142",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>Comment 24:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/914fb4f524f69323c25ded43354b8f7863131863">914fb4f</a></td><td><code>Merge branch 'public/18505' in 7.5.b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d">4740a42</a></td><td><code>trac 18505 back to raising errors</code></td></tr></table>




---

archive/issue_comments_258143.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nbot is green, please review",
    "created_at": "2016-11-02T18:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258143",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'>Comment 25:</a>
bot is green, please review



---

archive/issue_comments_258144.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nI've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.",
    "created_at": "2016-11-02T19:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258144",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:26'>Comment 26:</a>
I've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.



---

archive/issue_comments_258145.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI was going to put this on the sage-devel vote, but it looks like the topic got locked.\n\n#####\n\nThanks to Vincent, Travis and Fr\u00e9d\u00e9ric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.\n\nI have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.",
    "created_at": "2016-11-02T19:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258145",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:27'>Comment 27:</a>
I was going to put this on the sage-devel vote, but it looks like the topic got locked.

#####

Thanks to Vincent, Travis and Frdric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.

I have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.



---

archive/issue_comments_258146.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nVincent, would you give a positive review ?",
    "created_at": "2016-11-09T20:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258146",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'>Comment 28:</a>
Vincent, would you give a positive review ?



---

archive/issue_comments_258147.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nplease, somebody ? this is ready and useful !",
    "created_at": "2016-11-11T20:42:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258147",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'>Comment 29:</a>
please, somebody ? this is ready and useful !



---

archive/issue_comments_258148.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nWhy did this change\n\n```diff\n+        A matrix over the integers will be promoted to a\n+        matrix over the rationals, but may need to be manually\n+        promoted to the algebraic numbers.  ::\n+\n             sage: A = matrix(ZZ, 2, 2, range(4))\n             sage: B = matrix(QQbar, 2, 2, range(4))\n             sage: A.is_similar(B)\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: matrices need to have entries with identical fraction fields,\n+            not Rational Field and Algebraic Field\n+            sage: A.change_ring(QQbar).is_similar(B)\n             True\n```\nThere is a natural coercion here.",
    "created_at": "2016-11-12T20:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258148",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'>Comment 30:</a>
Why did this change

```diff
+        A matrix over the integers will be promoted to a
+        matrix over the rationals, but may need to be manually
+        promoted to the algebraic numbers.  ::
+
             sage: A = matrix(ZZ, 2, 2, range(4))
             sage: B = matrix(QQbar, 2, 2, range(4))
             sage: A.is_similar(B)
+            Traceback (most recent call last):
+            ...
+            TypeError: matrices need to have entries with identical fraction fields,
+            not Rational Field and Algebraic Field
+            sage: A.change_ring(QQbar).is_similar(B)
             True
```
There is a natural coercion here.



---

archive/issue_events_245208.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-11-12T20:58:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245208"
}
```



---

archive/issue_events_245209.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-11-12T20:58:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245209"
}
```



---

archive/issue_comments_258149.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\n\n```\nsage: cm = get_coercion_model()\nsage: m1 = matrix(ZZ, 2, range(4))\nsage: m2 = matrix(QQbar, 2, range(4))\nsage: mm1, mm2 = cm.canonical_coercion(m1, m2)\nsage: mm1.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\nsage: mm2.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\n```",
    "created_at": "2016-11-12T21:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258149",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'>Comment 31:</a>

```
sage: cm = get_coercion_model()
sage: m1 = matrix(ZZ, 2, range(4))
sage: m2 = matrix(QQbar, 2, range(4))
sage: mm1, mm2 = cm.canonical_coercion(m1, m2)
sage: mm1.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
sage: mm2.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
```



---

archive/issue_comments_258150.json:
```json
{
    "body": "Changed commit from **[4740a42](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)** to **[bfedf0e](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)**",
    "created_at": "2016-11-18T14:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258150",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4740a42](https://github.com/sagemath/sagetrac-mirror/commit/4740a42f06a41777a12a544a4d853fbb5a41111d)** to **[bfedf0e](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)**



---

archive/issue_comments_258151.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de86aefb05f04dfb5dc3310c30c339393a111e73\">de86aef</a></td><td><code>Merge branch 'u/chapoton/18505' in 7.5.b3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99\">bfedf0e</a></td><td><code>trac 18505 trying to introduce coercion in the game</code></td></tr></table>\n",
    "created_at": "2016-11-18T14:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258151",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de86aefb05f04dfb5dc3310c30c339393a111e73">de86aef</a></td><td><code>Merge branch 'u/chapoton/18505' in 7.5.b3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99">bfedf0e</a></td><td><code>trac 18505 trying to introduce coercion in the game</code></td></tr></table>




---

archive/issue_comments_258152.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nHere is a commit trying to involve coercion if possible. Not tested yet.",
    "created_at": "2016-11-18T14:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258152",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'>Comment 33:</a>
Here is a commit trying to involve coercion if possible. Not tested yet.



---

archive/issue_comments_258153.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nLooks good. But you can avoid complications with\n\n```\nif parent(A) != parent(B):\n    coercion\n```\nat the very begining. But we would loose specific error message for different sizes.",
    "created_at": "2016-11-18T14:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258153",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'>Comment 34:</a>
Looks good. But you can avoid complications with

```
if parent(A) != parent(B):
    coercion
```
at the very begining. But we would loose specific error message for different sizes.



---

archive/issue_comments_258154.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nSince `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.",
    "created_at": "2016-11-18T14:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258154",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'>Comment 35:</a>
Since `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.



---

archive/issue_comments_258155.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1\">86a80c2</a></td><td><code>trac 18505 using have_same_parent</code></td></tr></table>\n",
    "created_at": "2016-11-18T16:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258155",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1">86a80c2</a></td><td><code>trac 18505 using have_same_parent</code></td></tr></table>




---

archive/issue_comments_258156.json:
```json
{
    "body": "Changed commit from **[bfedf0e](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)** to **[86a80c2](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)**",
    "created_at": "2016-11-18T16:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258156",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bfedf0e](https://github.com/sagemath/sagetrac-mirror/commit/bfedf0e4e274d44d67fb59e5d46f45bf4e829b99)** to **[86a80c2](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)**



---

archive/issue_comments_258157.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nI am not fond of the idea of starting by comparing parents. Better keep the useful error messages.\n\nHere is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results",
    "created_at": "2016-11-18T16:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258157",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'>Comment 37:</a>
I am not fond of the idea of starting by comparing parents. Better keep the useful error messages.

Here is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results



---

archive/issue_comments_258158.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nThere is also the `@coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...",
    "created_at": "2016-11-18T17:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258158",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'>Comment 38:</a>
There is also the `@coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...



---

archive/issue_comments_258159.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25\">6b168e4</a></td><td><code>trac 18505 fixing details</code></td></tr></table>\n",
    "created_at": "2016-11-18T17:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258159",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25">6b168e4</a></td><td><code>trac 18505 fixing details</code></td></tr></table>




---

archive/issue_comments_258160.json:
```json
{
    "body": "Changed commit from **[86a80c2](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)** to **[6b168e4](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)**",
    "created_at": "2016-11-18T17:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258160",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[86a80c2](https://github.com/sagemath/sagetrac-mirror/commit/86a80c221ff6c178fc49f0f53f87690b5e2659f1)** to **[6b168e4](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)**



---

archive/issue_events_245210.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-18T17:52:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245210"
}
```



---

archive/issue_events_245211.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-18T17:52:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245211"
}
```



---

archive/issue_comments_258161.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nok, please review",
    "created_at": "2016-11-18T17:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258161",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:40'>Comment 40:</a>
ok, please review



---

archive/issue_comments_258162.json:
```json
{
    "body": "Changed commit from **[6b168e4](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)** to **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**",
    "created_at": "2016-11-18T19:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258162",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6b168e4](https://github.com/sagemath/sagetrac-mirror/commit/6b168e482d4ced7992a9370748c7642e34c41a25)** to **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**



---

archive/issue_comments_258163.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c\">92aac67</a></td><td><code>trac 18505 fix rubric in doc</code></td></tr></table>\n",
    "created_at": "2016-11-18T19:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258163",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'>Comment 41:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c">92aac67</a></td><td><code>trac 18505 fix rubric in doc</code></td></tr></table>




---

archive/issue_comments_258164.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nping ?",
    "created_at": "2016-11-25T10:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258164",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:42'>Comment 42:</a>
ping ?



---

archive/issue_comments_258165.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\n*ping* !",
    "created_at": "2016-12-08T09:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258165",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'>Comment 43:</a>
*ping* !



---

archive/issue_comments_258166.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\n**P I N  G** ?",
    "created_at": "2016-12-30T18:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258166",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:44'>Comment 44:</a>
**P I N  G** ?



---

archive/issue_comments_258167.json:
```json
{
    "body": "Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Travis Scrimshaw**",
    "created_at": "2017-01-01T00:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258167",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Travis Scrimshaw**



---

archive/issue_comments_258168.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nEverything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.",
    "created_at": "2017-01-01T00:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258168",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:45'>Comment 45:</a>
Everything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.



---

archive/issue_comments_258169.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nAs a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of \"is_similar\" which gives the change-of-basis matrix over any field, **once this ticket is closed**.",
    "created_at": "2017-01-03T20:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258169",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'>Comment 46:</a>
As a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of "is_similar" which gives the change-of-basis matrix over any field, **once this ticket is closed**.



---

archive/issue_events_245212.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-01-07T20:57:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245212"
}
```



---

archive/issue_events_245213.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-01-07T20:57:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245213"
}
```



---

archive/issue_comments_258170.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nLet it go and happy new year!",
    "created_at": "2017-01-07T20:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258170",
    "user": "https://github.com/videlec"
}
```

<a id='comment:47'>Comment 47:</a>
Let it go and happy new year!



---

archive/issue_events_245214.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-13T12:30:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245214"
}
```



---

archive/issue_events_245215.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-13T12:30:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245215"
}
```



---

archive/issue_events_245216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-18T20:40:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245216"
}
```



---

archive/issue_events_245217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "76ab75743e4826497cbad159fc0d0bf3f3ea994c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-18T20:40:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18505#event-245217"
}
```



---

archive/issue_comments_258171.json:
```json
{
    "body": "Changed branch from **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)** to **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**",
    "created_at": "2017-01-18T20:40:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18505#issuecomment-258171",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/18505](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18505)** to **[92aac67](https://github.com/sagemath/sagetrac-mirror/commit/92aac674bdb0473642219588ecb66b198144c76c)**
