# Issue 18600: Fix several methods for sparse polynomials

archive/issues_018363.json:
```json
{
    "body": "In tickets #18518 and #18585, I've fixed some problems in two methods of the class `Polynomial` to make them work with high-degree sparse polynomials. Globally, many methods in this class are written with dense polynomials (or at least low-degree polynomials) in mind. \n\nThe purpose of this ticket is to provide fixes for some of these methods. The list of the methods I've treated is:\n\n- `denominator`: in #18518\n- `_cmp_`: in #18585\n\n- `integral`: new method in `Polynomial_generic_sparse` + correct a slight bug in `Polynomial`\n- `is_nilpotent`: fix in `Polynomial`\n- `is_unit`: fix in `Polynomial`\n- `padded_list`: fix in `Polynomial`\n- `newton_slopes`: new method in `Polynomial_generic_sparse`\n- `reverse`: new method in `Polynomial_generic_sparse` \n- `shift`: fix in `Polynomial_generic_sparse`\n- `truncate`: new method in `Polynomial_generic_sparse`\n- `norm`: fix in `Polynomial`\n\nOther methods remain to be treated, but they won't be fixed in this ticket. Most importantly is the method `__call__`, but I prefer to wait for #18282 to be closed.\n\nKeywords: sparse polynomial\n\nBranch/Commit: 4a4448604662733d1dc1ddf7e1f867e54be23af2\n\nReviewer: Vincent Delecroix\n\nAuthor: Bruno Grenet\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18600\n\n",
    "closed_at": "2015-09-15T22:30:53Z",
    "created_at": "2015-06-03T13:46:50Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Fix several methods for sparse polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18600",
    "user": "https://github.com/bgrenet"
}
```
In tickets #18518 and #18585, I've fixed some problems in two methods of the class `Polynomial` to make them work with high-degree sparse polynomials. Globally, many methods in this class are written with dense polynomials (or at least low-degree polynomials) in mind. 

The purpose of this ticket is to provide fixes for some of these methods. The list of the methods I've treated is:

- `denominator`: in #18518
- `_cmp_`: in #18585

- `integral`: new method in `Polynomial_generic_sparse` + correct a slight bug in `Polynomial`
- `is_nilpotent`: fix in `Polynomial`
- `is_unit`: fix in `Polynomial`
- `padded_list`: fix in `Polynomial`
- `newton_slopes`: new method in `Polynomial_generic_sparse`
- `reverse`: new method in `Polynomial_generic_sparse` 
- `shift`: fix in `Polynomial_generic_sparse`
- `truncate`: new method in `Polynomial_generic_sparse`
- `norm`: fix in `Polynomial`

Other methods remain to be treated, but they won't be fixed in this ticket. Most importantly is the method `__call__`, but I prefer to wait for #18282 to be closed.

Keywords: sparse polynomial

Branch/Commit: 4a4448604662733d1dc1ddf7e1f867e54be23af2

Reviewer: Vincent Delecroix

Author: Bruno Grenet

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18600





---

archive/issue_comments_330474.json:
```json
{
    "body": "Changing commit from \"\" to \"ecffcef63b5d0e298af36bd487df165bbf6a42dd\"",
    "created_at": "2015-06-03T14:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "ecffcef63b5d0e298af36bd487df165bbf6a42dd"



---

archive/issue_comments_330475.json:
```json
{
    "body": "<a id='comment:1'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[14952d6](https://github.com/sagemath/sagetrac-mirror/commit/14952d61c9d8b90e9926aa721294360ca5ba683a)|`Correct bug in `integral``|\n|[e05d331](https://github.com/sagemath/sagetrac-mirror/commit/e05d331aecbbca0bb661dda63a28081b1f8db472)|`Adapt `is_nilpotent` to sparse polynomials`|\n|[fcd29ce](https://github.com/sagemath/sagetrac-mirror/commit/fcd29ce99fdf20d8d44b3d3af20e610036d9fd2b)|`Adapt `is_unit` to sparse polynomials`|\n|[74a3147](https://github.com/sagemath/sagetrac-mirror/commit/74a31475fbaf43b0c7c4bdad63f39baea999d0ef)|`Adapt `padded_list` to sparse polynomials`|\n|[aa10b1f](https://github.com/sagemath/sagetrac-mirror/commit/aa10b1fa288cd75eafe3d84abf92ac8bfd1b2bc6)|`Adapt `norm` to sparse polynomials`|\n|[d706667](https://github.com/sagemath/sagetrac-mirror/commit/d706667ed575fd6b841a1eaef302c5ef453e9c0b)|`Adapt `reverse` to sparse polynomials`|\n|[1e1d21b](https://github.com/sagemath/sagetrac-mirror/commit/1e1d21b7a14e15ef37a6b8fca833298fbbb1f056)|`Adapt `integral` to sparse polynomials`|\n|[dbc2ba0](https://github.com/sagemath/sagetrac-mirror/commit/dbc2ba09385c25df46c33747075d35dc0e35eea8)|`Adapt `shift` to sparse polynomials`|\n|[19b1371](https://github.com/sagemath/sagetrac-mirror/commit/19b1371896d7ff71cb9eb3fa289b0d6bddb2787f)|`Adapt `newton_slopes` to sparse polynomials`|\n|[ecffcef](https://github.com/sagemath/sagetrac-mirror/commit/ecffcef63b5d0e298af36bd487df165bbf6a42dd)|`Adapt `truncate` to sparse polynomials`|",
    "created_at": "2015-06-03T14:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[14952d6](https://github.com/sagemath/sagetrac-mirror/commit/14952d61c9d8b90e9926aa721294360ca5ba683a)|`Correct bug in `integral``|
|[e05d331](https://github.com/sagemath/sagetrac-mirror/commit/e05d331aecbbca0bb661dda63a28081b1f8db472)|`Adapt `is_nilpotent` to sparse polynomials`|
|[fcd29ce](https://github.com/sagemath/sagetrac-mirror/commit/fcd29ce99fdf20d8d44b3d3af20e610036d9fd2b)|`Adapt `is_unit` to sparse polynomials`|
|[74a3147](https://github.com/sagemath/sagetrac-mirror/commit/74a31475fbaf43b0c7c4bdad63f39baea999d0ef)|`Adapt `padded_list` to sparse polynomials`|
|[aa10b1f](https://github.com/sagemath/sagetrac-mirror/commit/aa10b1fa288cd75eafe3d84abf92ac8bfd1b2bc6)|`Adapt `norm` to sparse polynomials`|
|[d706667](https://github.com/sagemath/sagetrac-mirror/commit/d706667ed575fd6b841a1eaef302c5ef453e9c0b)|`Adapt `reverse` to sparse polynomials`|
|[1e1d21b](https://github.com/sagemath/sagetrac-mirror/commit/1e1d21b7a14e15ef37a6b8fca833298fbbb1f056)|`Adapt `integral` to sparse polynomials`|
|[dbc2ba0](https://github.com/sagemath/sagetrac-mirror/commit/dbc2ba09385c25df46c33747075d35dc0e35eea8)|`Adapt `shift` to sparse polynomials`|
|[19b1371](https://github.com/sagemath/sagetrac-mirror/commit/19b1371896d7ff71cb9eb3fa289b0d6bddb2787f)|`Adapt `newton_slopes` to sparse polynomials`|
|[ecffcef](https://github.com/sagemath/sagetrac-mirror/commit/ecffcef63b5d0e298af36bd487df165bbf6a42dd)|`Adapt `truncate` to sparse polynomials`|



---

archive/issue_comments_330476.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,18 @@\n In tickets #18518 and #18585, I've fixed some problems in two methods of the class `Polynomial` to make them work with high-degree sparse polynomials. Globally, many methods in this class are written with dense polynomials (or at least low-degree polynomials) in mind. \n \n-The purpose of this ticket is to provide easy fixes for many of these methods. The list of the methods I've treated is:\n-- `denominator` in #18518\n-- `_cmp_` in #18585\n-- `integral`\n-- `is_nilpotent`\n-- `padded_list`\n-- `newton_slopes`\n-- `reverse`\n-- `shift`\n-- `truncate`\n-- `norm`\n+The purpose of this ticket is to provide fixes for some of these methods. The list of the methods I've treated is:\n \n-For `integral`, I also correct some bug that affects all polynomials (dense as well as sparse).\n+- `denominator`: in #18518\n+- `_cmp_`: in #18585\n \n-**Note.** This is a work in progress.\n+- `integral`: new method in `Polynomial_generic_sparse` + correct a slight bug in `Polynomial`\n+- `is_nilpotent`: fix in `Polynomial`\n+- `is_unit`: fix in `Polynomial`\n+- `padded_list`: fix in `Polynomial`\n+- `newton_slopes`: new method in `Polynomial_generic_sparse`\n+- `reverse`: new method in `Polynomial_generic_sparse` \n+- `shift`: fix in `Polynomial_generic_sparse`\n+- `truncate`: new method in `Polynomial_generic_sparse`\n+- `norm`: fix in `Polynomial`\n+\n+Other methods remain to be treated, but they won't be fixed in this ticket. Most importantly is the method `__call__`, but I prefer to wait for #18282 to be closed.\n``````\n",
    "created_at": "2015-06-03T14:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330476",
    "user": "https://github.com/bgrenet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,18 @@
 In tickets #18518 and #18585, I've fixed some problems in two methods of the class `Polynomial` to make them work with high-degree sparse polynomials. Globally, many methods in this class are written with dense polynomials (or at least low-degree polynomials) in mind. 
 
-The purpose of this ticket is to provide easy fixes for many of these methods. The list of the methods I've treated is:
-- `denominator` in #18518
-- `_cmp_` in #18585
-- `integral`
-- `is_nilpotent`
-- `padded_list`
-- `newton_slopes`
-- `reverse`
-- `shift`
-- `truncate`
-- `norm`
+The purpose of this ticket is to provide fixes for some of these methods. The list of the methods I've treated is:
 
-For `integral`, I also correct some bug that affects all polynomials (dense as well as sparse).
+- `denominator`: in #18518
+- `_cmp_`: in #18585
 
-**Note.** This is a work in progress.
+- `integral`: new method in `Polynomial_generic_sparse` + correct a slight bug in `Polynomial`
+- `is_nilpotent`: fix in `Polynomial`
+- `is_unit`: fix in `Polynomial`
+- `padded_list`: fix in `Polynomial`
+- `newton_slopes`: new method in `Polynomial_generic_sparse`
+- `reverse`: new method in `Polynomial_generic_sparse` 
+- `shift`: fix in `Polynomial_generic_sparse`
+- `truncate`: new method in `Polynomial_generic_sparse`
+- `norm`: fix in `Polynomial`
+
+Other methods remain to be treated, but they won't be fixed in this ticket. Most importantly is the method `__call__`, but I prefer to wait for #18282 to be closed.
``````




---

archive/issue_comments_330477.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-03T14:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330477",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330478.json:
```json
{
    "body": "<a id='comment:3'></a>\nHello,\n\nSome technical comments:\n\n* `integral`\n\n    What about `Q = self.base_ring().fraction_field()` instead of `Q = (self.constant_coefficient()/1).parent()`?\n\n    The `.change_ring` method is very slow but this has nothing to do with this ticket.\n\n* `is_unit`\n\n    Why do you care that the base ring being an integral domain? Is `1` not a unit in `Z/4Z`? Sage thinks it is\n\n```\nsage: Zmod(4)(1).is_unit()\nTrue\n```\n\n* `reverse`\n\n    You can use `for k,v in self.__coeffs.iteritems()`\n\n* `integral` for sparse\n\n    idem: use `iteritems`. In other words, replace\n\n```\nQ({k:self.__coeffs[k].integral(var) for k in self.__coeffs.keys()})\n```\n    with\n\n```\nQ({k:v.integral(var) for k,v in self.__coeffs.iteritems()})\n```\n   I found strange that in one case you defined the dictionary `d` and then `return Q(d)` while in the other you do everything at once.\n\nVincent",
    "created_at": "2015-08-03T16:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330478",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Hello,

Some technical comments:

* `integral`

    What about `Q = self.base_ring().fraction_field()` instead of `Q = (self.constant_coefficient()/1).parent()`?

    The `.change_ring` method is very slow but this has nothing to do with this ticket.

* `is_unit`

    Why do you care that the base ring being an integral domain? Is `1` not a unit in `Z/4Z`? Sage thinks it is

```
sage: Zmod(4)(1).is_unit()
True
```

* `reverse`

    You can use `for k,v in self.__coeffs.iteritems()`

* `integral` for sparse

    idem: use `iteritems`. In other words, replace

```
Q({k:self.__coeffs[k].integral(var) for k in self.__coeffs.keys()})
```
    with

```
Q({k:v.integral(var) for k,v in self.__coeffs.iteritems()})
```
   I found strange that in one case you defined the dictionary `d` and then `return Q(d)` while in the other you do everything at once.

Vincent



---

archive/issue_comments_330479.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-03T16:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330479",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330480.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-08-03T16:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330480",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_events_059395.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-03T16:28:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18600#event-59395"
}
```



---

archive/issue_comments_330481.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[390b3ea](https://github.com/sagemath/sagetrac-mirror/commit/390b3ea9595b5ab1a4f96af875f754b349e79686)|`integral: reviewer comments + add check=False`|\n|[809bc3e](https://github.com/sagemath/sagetrac-mirror/commit/809bc3ea6da046dd4bf7582c44ea8ef90319ea73)|`reverse: reviewer's comment + check=False`|",
    "created_at": "2015-08-04T09:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[390b3ea](https://github.com/sagemath/sagetrac-mirror/commit/390b3ea9595b5ab1a4f96af875f754b349e79686)|`integral: reviewer comments + add check=False`|
|[809bc3e](https://github.com/sagemath/sagetrac-mirror/commit/809bc3ea6da046dd4bf7582c44ea8ef90319ea73)|`reverse: reviewer's comment + check=False`|



---

archive/issue_comments_330482.json:
```json
{
    "body": "Changing commit from \"ecffcef63b5d0e298af36bd487df165bbf6a42dd\" to \"809bc3ea6da046dd4bf7582c44ea8ef90319ea73\"",
    "created_at": "2015-08-04T09:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ecffcef63b5d0e298af36bd487df165bbf6a42dd" to "809bc3ea6da046dd4bf7582c44ea8ef90319ea73"



---

archive/issue_comments_330483.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [vdelecroix](#comment%3A3):\n> * `integral`\n> \n>     What about `Q = self.base_ring().fraction_field()` instead of `Q = (self.constant_coefficient()/1).parent()`?\n\n \nRight, I do not remember why I wrote it in such a weird way... Corrected!\n \n> \n>     The `.change_ring` method is very slow but this has nothing to do with this ticket.\n\n \nAnd actually, a large part is already taken to simply build the new polynomial ring. For instance, on my laptop, `change_ring` takes approximately 12\u00b5s, of which 9\u00b5s are taken for building the new `PolynomialRing`. Yet the extra 3\u00b5s shouldn't exist...\n \n> \n> * `is_unit`\n> \n>     Why do you care that the base ring being an integral domain? Is `1` not a unit in `Z/4Z`? Sage thinks it is\n> \n> ```\n> sage: Zmod(4)(1).is_unit()\n> True\n> ```\n\n \nYou may have overlooked the code: If the base ring is an integral domain and the input polynomial has degree > 0, it cannot be a unit so I directly return `False`. I test the nilpotency of the coefficients only if the base ring is not an integral domain.\n \n> * `reverse`\n> \n>     You can use `for k,v in self.__coeffs.iteritems()`\n> \n> * `integral` for sparse\n> \n>     idem: use `iteritems`. In other words, replace\n> \n> ```\n> Q({k:self.__coeffs[k].integral(var) for k in self.__coeffs.keys()})\n> ```\n>     with\n> \n> ```\n> Q({k:v.integral(var) for k,v in self.__coeffs.iteritems()})\n> ```\n>    I found strange that in one case you defined the dictionary `d` and then `return Q(d)` while in the other you do everything at once.\n\n \nComments taken into account.",
    "created_at": "2015-08-04T09:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330483",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:5'></a>
Replying to [vdelecroix](#comment%3A3):
> * `integral`
> 
>     What about `Q = self.base_ring().fraction_field()` instead of `Q = (self.constant_coefficient()/1).parent()`?

 
Right, I do not remember why I wrote it in such a weird way... Corrected!
 
> 
>     The `.change_ring` method is very slow but this has nothing to do with this ticket.

 
And actually, a large part is already taken to simply build the new polynomial ring. For instance, on my laptop, `change_ring` takes approximately 12µs, of which 9µs are taken for building the new `PolynomialRing`. Yet the extra 3µs shouldn't exist...
 
> 
> * `is_unit`
> 
>     Why do you care that the base ring being an integral domain? Is `1` not a unit in `Z/4Z`? Sage thinks it is
> 
> ```
> sage: Zmod(4)(1).is_unit()
> True
> ```

 
You may have overlooked the code: If the base ring is an integral domain and the input polynomial has degree > 0, it cannot be a unit so I directly return `False`. I test the nilpotency of the coefficients only if the base ring is not an integral domain.
 
> * `reverse`
> 
>     You can use `for k,v in self.__coeffs.iteritems()`
> 
> * `integral` for sparse
> 
>     idem: use `iteritems`. In other words, replace
> 
> ```
> Q({k:self.__coeffs[k].integral(var) for k in self.__coeffs.keys()})
> ```
>     with
> 
> ```
> Q({k:v.integral(var) for k,v in self.__coeffs.iteritems()})
> ```
>    I found strange that in one case you defined the dictionary `d` and then `return Q(d)` while in the other you do everything at once.

 
Comments taken into account.



---

archive/issue_comments_330484.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-04T09:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330484",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330485.json:
```json
{
    "body": "Changing commit from \"809bc3ea6da046dd4bf7582c44ea8ef90319ea73\" to \"29331f254d9255c23c673393c6fd0121c04d9d6c\"",
    "created_at": "2015-08-07T20:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330485",
    "user": "https://github.com/videlec"
}
```

Changing commit from "809bc3ea6da046dd4bf7582c44ea8ef90319ea73" to "29331f254d9255c23c673393c6fd0121c04d9d6c"



---

archive/issue_comments_330486.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello,\n\nFor non integral domain, there are some failures for `integral`\n\n```\nsage: x = polygen(Zmod(4))\nsage: p = x**4 + 1\nsage: p.integral()\nTraceback (most recent call last):\n...\nZeroDivisionError: Inverse does not exist.\n```\nAnd for more complicated rings as well\n\n```\nsage: Sx.<x> = ZZ[]\nsage: Sxy.<y> = Sx[]\nsage: Sxyz.<z> = Sxy[]\nsage: p = 1 + x*y + x*z + y*z^2\nsage: p.integral(y)\nTraceback (most recent call last):\n...\nTypeError: no conversion of this rational to integer\n```\nMoreover, you kept the `self.constant_coefficient()/1`. In some cases (like the one above) there is no fraction field, so it makes sense to ask for the result of the division. But this is also accessible from the coercion model\n\n```\nsage: cm = get_coercion_model()\nsage: cm.division_parent(ZZ)\nRational Field\nsage: cm.division_parent(Zmod(4))\nRing of integers modulo 4\n```\nThat way you avoid a useless division (and a coercion since you used `1` instead of `base_ring.one()`).\n\nThat being said, there are plenty of broken thing in the coercion model. I ended up with a relatively robust solution but not ideal. In order to be improved, one has to work more on the coercion model and the polynomial division.\n\nTell me what you think.\n\nVincent\n\n---\nNew commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[29331f2](https://github.com/sagemath/sagetrac-mirror/commit/29331f254d9255c23c673393c6fd0121c04d9d6c)|`trac #18600: better parent for integral of polynomials`|",
    "created_at": "2015-08-07T20:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330486",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Hello,

For non integral domain, there are some failures for `integral`

```
sage: x = polygen(Zmod(4))
sage: p = x**4 + 1
sage: p.integral()
Traceback (most recent call last):
...
ZeroDivisionError: Inverse does not exist.
```
And for more complicated rings as well

```
sage: Sx.<x> = ZZ[]
sage: Sxy.<y> = Sx[]
sage: Sxyz.<z> = Sxy[]
sage: p = 1 + x*y + x*z + y*z^2
sage: p.integral(y)
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```
Moreover, you kept the `self.constant_coefficient()/1`. In some cases (like the one above) there is no fraction field, so it makes sense to ask for the result of the division. But this is also accessible from the coercion model

```
sage: cm = get_coercion_model()
sage: cm.division_parent(ZZ)
Rational Field
sage: cm.division_parent(Zmod(4))
Ring of integers modulo 4
```
That way you avoid a useless division (and a coercion since you used `1` instead of `base_ring.one()`).

That being said, there are plenty of broken thing in the coercion model. I ended up with a relatively robust solution but not ideal. In order to be improved, one has to work more on the coercion model and the polynomial division.

Tell me what you think.

Vincent

---
New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[29331f2](https://github.com/sagemath/sagetrac-mirror/commit/29331f254d9255c23c673393c6fd0121c04d9d6c)|`trac #18600: better parent for integral of polynomials`|



---

archive/issue_comments_330487.json:
```json
{
    "body": "Changing branch from \"u/bruno/polynomial_sparse\" to \"public/18600\"",
    "created_at": "2015-08-07T20:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330487",
    "user": "https://github.com/videlec"
}
```

Changing branch from "u/bruno/polynomial_sparse" to "public/18600"



---

archive/issue_comments_330488.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-08-07T20:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330488",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_330489.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe coercion model is really something I do not understand yet in Sage, so I trust what you wrote. Simply, in the following change, isn't it faster (and cleaner to some extent) to first define the underlying list of coefficients rather than defining the zero polynomial before adding monomials to it? \n\n```diff\n-        coeffs = self.list()\n-        v = [0] + [coeffs[n]/(n+1) for n from 0 <= n <= degree]\n-        return S(v)\n+        p = S.zero()\n+        for n in range(degree+1):\n+            if self[n]:\n+                p += cm.bin_op(Q(self[n]), n+1, operator.div) * S.gen()**(n+1)\n+        return p\n```\n\nWhat about something as the following?\n\n```python\n    coeffs = [self.zero()] * (degree + 2)\n    for n in range(degree+1):\n        if self[n]:\n            coeffs[n+1] = cm.bin_op(Q(self[n]), n+1, operator.div)\n    return S(coeffs)\n```\n\n*Note. I'm going in vacations and won't be able to interact much until August 24.*",
    "created_at": "2015-08-08T07:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330489",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:7'></a>
The coercion model is really something I do not understand yet in Sage, so I trust what you wrote. Simply, in the following change, isn't it faster (and cleaner to some extent) to first define the underlying list of coefficients rather than defining the zero polynomial before adding monomials to it? 

```diff
-        coeffs = self.list()
-        v = [0] + [coeffs[n]/(n+1) for n from 0 <= n <= degree]
-        return S(v)
+        p = S.zero()
+        for n in range(degree+1):
+            if self[n]:
+                p += cm.bin_op(Q(self[n]), n+1, operator.div) * S.gen()**(n+1)
+        return p
```

What about something as the following?

```python
    coeffs = [self.zero()] * (degree + 2)
    for n in range(degree+1):
        if self[n]:
            coeffs[n+1] = cm.bin_op(Q(self[n]), n+1, operator.div)
    return S(coeffs)
```

*Note. I'm going in vacations and won't be able to interact much until August 24.*



---

archive/issue_comments_330490.json:
```json
{
    "body": "Changing commit from \"29331f254d9255c23c673393c6fd0121c04d9d6c\" to \"e75ab73b3b2e0bc3a40105640d0572b1b6af9cea\"",
    "created_at": "2015-08-08T21:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "29331f254d9255c23c673393c6fd0121c04d9d6c" to "e75ab73b3b2e0bc3a40105640d0572b1b6af9cea"



---

archive/issue_comments_330491.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[e75ab73](https://github.com/sagemath/sagetrac-mirror/commit/e75ab73b3b2e0bc3a40105640d0572b1b6af9cea)|`Trac #18600: simpler polynomial construction`|",
    "created_at": "2015-08-08T21:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[e75ab73](https://github.com/sagemath/sagetrac-mirror/commit/e75ab73b3b2e0bc3a40105640d0572b1b6af9cea)|`Trac #18600: simpler polynomial construction`|



---

archive/issue_comments_330492.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe current branch passes all the tests. As far as I can tell, this ticket can now be positive reviewed. Is it appropriate if I set it myself? I am quite reluctant since I wrote most of the code, and also sine you didn't set it to `needs_review`.",
    "created_at": "2015-08-26T13:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330492",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:9'></a>
The current branch passes all the tests. As far as I can tell, this ticket can now be positive reviewed. Is it appropriate if I set it myself? I am quite reluctant since I wrote most of the code, and also sine you didn't set it to `needs_review`.



---

archive/issue_comments_330493.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-09-04T00:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330493",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_330494.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-04T00:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330494",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330495.json:
```json
{
    "body": "<a id='comment:11'></a>\n- `The integral is always chosen so the constant term is 0.` -> `... so that ...`\n- inconsistency between dense and sparse\n\n```\nsage: R.<x> = PolynomialRing(Zmod(4), sparse=False)\nsage: p = x**4 + 1\nsage: p.integral()\nx^5 + x\nsage: R.<x> = PolynomialRing(Zmod(4), sparse=True)\nsage: p = x**4 + 1\nsage: p.integral()\nTraceback (most recent call last):\n...\nTypeError: self must be an integral domain.\n```",
    "created_at": "2015-09-04T00:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330495",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
- `The integral is always chosen so the constant term is 0.` -> `... so that ...`
- inconsistency between dense and sparse

```
sage: R.<x> = PolynomialRing(Zmod(4), sparse=False)
sage: p = x**4 + 1
sage: p.integral()
x^5 + x
sage: R.<x> = PolynomialRing(Zmod(4), sparse=True)
sage: p = x**4 + 1
sage: p.integral()
Traceback (most recent call last):
...
TypeError: self must be an integral domain.
```



---

archive/issue_comments_330496.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vdelecroix](#comment%3A11):\n> - inconsistency between dense and sparse\n> \n> ```\n> sage: R.<x> = PolynomialRing(Zmod(4), sparse=False)\n> sage: p = x**4 + 1\n> sage: p.integral()\n> x^5 + x\n> sage: R.<x> = PolynomialRing(Zmod(4), sparse=True)\n> sage: p = x**4 + 1\n> sage: p.integral()\n> Traceback (most recent call last):\n> ...\n> TypeError: self must be an integral domain.\n> ```\n\n\nRight, I should mimick what you did for the dense case. Before I do this, I actually have a question on what you wrote:\n\n```python\n        cm = sage.structure.element.get_coercion_model()\n        try:\n            S = cm.bin_op(R.one(), ZZ.one(), operator.div).parent()\n            Q = S.base_ring()\n        except TypeError:\n            Q = (R.base_ring().one()/ZZ.one()).parent()\n            S = R.change_ring(Q)\n```\nI don't get what you consider `ZZ.one()` instead of `R.one()` or even better `R.base_ring.one()`. I have the following behavior:\n\n```python\nsage: R.<x> = Zmod(4)[]\nsage: cm.bin_op(R.one(),ZZ.one(),operator.div).parent()\nTraceback (most recent call last):\n...\nTypeError: self must be an integral domain.\nsage: cm.bin_op(R.one(),R.one(),operator.div).parent()\nTraceback (most recent call last):\n...\nTypeError: self must be an integral domain.\nsage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()\nUnivariate Polynomial Ring in x over Ring of integers modulo 4\n```\n\nand\n\n```python\nsage: R.<x> = ZZ[]\nsage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()\nUnivariate Polynomial Ring in x over Rational Field\nsage: R.<x> = ZZ['y'][]\nsage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()\nUnivariate Polynomial Ring in x over Fraction Field of Univariate Polynomial Ring in y over Integer Ring\n```\n\nIf I understand correctly, using `R.base_ring.one()` may fix the issue of your `TODO`. What do you think of this?",
    "created_at": "2015-09-04T09:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330496",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:12'></a>
Replying to [vdelecroix](#comment%3A11):
> - inconsistency between dense and sparse
> 
> ```
> sage: R.<x> = PolynomialRing(Zmod(4), sparse=False)
> sage: p = x**4 + 1
> sage: p.integral()
> x^5 + x
> sage: R.<x> = PolynomialRing(Zmod(4), sparse=True)
> sage: p = x**4 + 1
> sage: p.integral()
> Traceback (most recent call last):
> ...
> TypeError: self must be an integral domain.
> ```


Right, I should mimick what you did for the dense case. Before I do this, I actually have a question on what you wrote:

```python
        cm = sage.structure.element.get_coercion_model()
        try:
            S = cm.bin_op(R.one(), ZZ.one(), operator.div).parent()
            Q = S.base_ring()
        except TypeError:
            Q = (R.base_ring().one()/ZZ.one()).parent()
            S = R.change_ring(Q)
```
I don't get what you consider `ZZ.one()` instead of `R.one()` or even better `R.base_ring.one()`. I have the following behavior:

```python
sage: R.<x> = Zmod(4)[]
sage: cm.bin_op(R.one(),ZZ.one(),operator.div).parent()
Traceback (most recent call last):
...
TypeError: self must be an integral domain.
sage: cm.bin_op(R.one(),R.one(),operator.div).parent()
Traceback (most recent call last):
...
TypeError: self must be an integral domain.
sage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()
Univariate Polynomial Ring in x over Ring of integers modulo 4
```

and

```python
sage: R.<x> = ZZ[]
sage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()
Univariate Polynomial Ring in x over Rational Field
sage: R.<x> = ZZ['y'][]
sage: cm.bin_op(R.one(),R.base_ring().one(),operator.div).parent()
Univariate Polynomial Ring in x over Fraction Field of Univariate Polynomial Ring in y over Integer Ring
```

If I understand correctly, using `R.base_ring.one()` may fix the issue of your `TODO`. What do you think of this?



---

archive/issue_comments_330497.json:
```json
{
    "body": "<a id='comment:13'></a>\nActually, this yields other problems... And with my proposal, you get the following behavior which may not be wanted:\n\n```python\nsage: A.<a1, a2> = PolynomialRing(ZZ)\nsage: B.<b> = PolynomialRing(A)\nsage: C.<c> = PowerSeriesRing(B)\nsage: R.<x> = PolynomialRing(C)\nsage: f = a2*x^2 + c*x - a1*b\nsage: f.parent()\nUnivariate Polynomial Ring in x over Power Series Ring in c over Univariate Polynomial Ring in b over Multivariate Polynomial Ring in a1, a2 over Integer Ring\nsage: f.integral().parent()\nUnivariate Polynomial Ring in x over Fraction Field of Power Series Ring in c over Univariate Polynomial Ring in b over Multivariate Polynomial Ring in a1, a2 over Integer Ring\n```",
    "created_at": "2015-09-04T13:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330497",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:13'></a>
Actually, this yields other problems... And with my proposal, you get the following behavior which may not be wanted:

```python
sage: A.<a1, a2> = PolynomialRing(ZZ)
sage: B.<b> = PolynomialRing(A)
sage: C.<c> = PowerSeriesRing(B)
sage: R.<x> = PolynomialRing(C)
sage: f = a2*x^2 + c*x - a1*b
sage: f.parent()
Univariate Polynomial Ring in x over Power Series Ring in c over Univariate Polynomial Ring in b over Multivariate Polynomial Ring in a1, a2 over Integer Ring
sage: f.integral().parent()
Univariate Polynomial Ring in x over Fraction Field of Power Series Ring in c over Univariate Polynomial Ring in b over Multivariate Polynomial Ring in a1, a2 over Integer Ring
```



---

archive/issue_comments_330498.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|\n|[c4575ff](https://github.com/sagemath/sagetrac-mirror/commit/c4575ff54cbefa02da3f488021470839ffd1e347)|`Merge branch 'public/18600' of git://trac.sagemath.org/sage into t18600_sparse_polys`|\n|[6a8fb14](https://github.com/sagemath/sagetrac-mirror/commit/6a8fb145b6ed55a1d73dd18ebaa89bd3c4d7bccd)|`#18600: \"... so the constant term is 0\" -> \"... so that...\"`|\n|[f2b57e3](https://github.com/sagemath/sagetrac-mirror/commit/f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b)|`#18600: Handle non integral domains for sparse poly`|",
    "created_at": "2015-09-04T14:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|[c4575ff](https://github.com/sagemath/sagetrac-mirror/commit/c4575ff54cbefa02da3f488021470839ffd1e347)|`Merge branch 'public/18600' of git://trac.sagemath.org/sage into t18600_sparse_polys`|
|[6a8fb14](https://github.com/sagemath/sagetrac-mirror/commit/6a8fb145b6ed55a1d73dd18ebaa89bd3c4d7bccd)|`#18600: "... so the constant term is 0" -> "... so that..."`|
|[f2b57e3](https://github.com/sagemath/sagetrac-mirror/commit/f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b)|`#18600: Handle non integral domains for sparse poly`|



---

archive/issue_comments_330499.json:
```json
{
    "body": "Changing commit from \"e75ab73b3b2e0bc3a40105640d0572b1b6af9cea\" to \"f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b\"",
    "created_at": "2015-09-04T14:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e75ab73b3b2e0bc3a40105640d0572b1b6af9cea" to "f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b"



---

archive/issue_comments_330500.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-04T14:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330500",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330501.json:
```json
{
    "body": "<a id='comment:16'></a>\n- ` if not isinstance(degree, int) and not isinstance(degree, Integer)` -> `not isinstance(degree, (int,Integer))`.\n\n- after `OUTPUT:` in the docstring of `newton_slopes` you should add a line break\n\n- you can do one liners (you are not obliged though)\n\n```\nd = {degree-k: v for k,v in self.__coeffs.iteritems() if degree >= k}\n```\n\n- why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?",
    "created_at": "2015-09-04T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330501",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
- ` if not isinstance(degree, int) and not isinstance(degree, Integer)` -> `not isinstance(degree, (int,Integer))`.

- after `OUTPUT:` in the docstring of `newton_slopes` you should add a line break

- you can do one liners (you are not obliged though)

```
d = {degree-k: v for k,v in self.__coeffs.iteritems() if degree >= k}
```

- why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?



---

archive/issue_comments_330502.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-04T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330502",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330503.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[ef2d432](https://github.com/sagemath/sagetrac-mirror/commit/ef2d432fcd405893326e3541a1f6a1b7016f708d)|`#18600: merged two 'isinstance'`|\n|[d7038a4](https://github.com/sagemath/sagetrac-mirror/commit/d7038a41f5228a41fce4ed11ca9811447d57076f)|`#18600: Docstring formatting`|\n|[e021276](https://github.com/sagemath/sagetrac-mirror/commit/e021276b5e043e066842b4e6e3644d489626deab)|`#18600: one-liners`|",
    "created_at": "2015-09-08T13:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[ef2d432](https://github.com/sagemath/sagetrac-mirror/commit/ef2d432fcd405893326e3541a1f6a1b7016f708d)|`#18600: merged two 'isinstance'`|
|[d7038a4](https://github.com/sagemath/sagetrac-mirror/commit/d7038a41f5228a41fce4ed11ca9811447d57076f)|`#18600: Docstring formatting`|
|[e021276](https://github.com/sagemath/sagetrac-mirror/commit/e021276b5e043e066842b4e6e3644d489626deab)|`#18600: one-liners`|



---

archive/issue_comments_330504.json:
```json
{
    "body": "Changing commit from \"f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b\" to \"e021276b5e043e066842b4e6e3644d489626deab\"",
    "created_at": "2015-09-08T13:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f2b57e3c6d4ad560d378d87bad8490f9efbb4b0b" to "e021276b5e043e066842b4e6e3644d489626deab"



---

archive/issue_comments_330505.json:
```json
{
    "body": "<a id='comment:18'></a>\nWhen writing a comment like this\n\n```\n# But it does not work in all cases!!\n```\nyou should be explicit about the cases where it does not work. Just saying \"it sometimes does not work\" is not sufficient justification.",
    "created_at": "2015-09-08T13:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330505",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
When writing a comment like this

```
# But it does not work in all cases!!
```
you should be explicit about the cases where it does not work. Just saying "it sometimes does not work" is not sufficient justification.



---

archive/issue_comments_330506.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [vdelecroix](#comment%3A16):\n> - ` if not isinstance(degree, int) and not isinstance(degree, Integer)` -> `not isinstance(degree, (int,Integer))`.\n\n\nDone.\n\n> - after `OUTPUT:` in the docstring of `newton_slopes` you should add a line break\n\n\nDone.\n\n> - you can do one liners (you are not obliged though)\n> \n> ```\n> d = {degree-k: v for k,v in self.__coeffs.iteritems() if degree >= k}\n> ```\n\n\nDone.\n \n> - why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?\n\n\nThe rationale is that for very sparse polynomials, one may want to get the newton slopes in a \"compressed\" format, that is as a list of segments defined by their slope and length rather than as a (very long) list of length-1 segments solely defined by their slope. I decided to implement this \"compressed\" output for sparse polynomials only since this feature seem(ed) mostly useful for sparse polynomials. \n\nA modification I could do is to move my implementation in the `Polynomial` class. Do yo think it would be the right thing to do?",
    "created_at": "2015-09-08T13:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330506",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:19'></a>
Replying to [vdelecroix](#comment%3A16):
> - ` if not isinstance(degree, int) and not isinstance(degree, Integer)` -> `not isinstance(degree, (int,Integer))`.


Done.

> - after `OUTPUT:` in the docstring of `newton_slopes` you should add a line break


Done.

> - you can do one liners (you are not obliged though)
> 
> ```
> d = {degree-k: v for k,v in self.__coeffs.iteritems() if degree >= k}
> ```


Done.
 
> - why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?


The rationale is that for very sparse polynomials, one may want to get the newton slopes in a "compressed" format, that is as a list of segments defined by their slope and length rather than as a (very long) list of length-1 segments solely defined by their slope. I decided to implement this "compressed" output for sparse polynomials only since this feature seem(ed) mostly useful for sparse polynomials. 

A modification I could do is to move my implementation in the `Polynomial` class. Do yo think it would be the right thing to do?



---

archive/issue_comments_330507.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [bruno](#comment%3A19):\n> Replying to [vdelecroix](#comment%3A16):\n> > - why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?\n \n> \n> The rationale is that for very sparse polynomials, one may want to get the newton slopes in a \"compressed\" format, that is as a list of segments defined by their slope and length rather than as a (very long) list of length-1 segments solely defined by their slope. I decided to implement this \"compressed\" output for sparse polynomials only since this feature seem(ed) mostly useful for sparse polynomials. \n> \n> A modification I could do is to move my implementation in the `Polynomial` class. Do yo think it would be the right thing to do?\n\n\nI understand the need of the argument. But if it also makes sense at the level of `Polynomial` then yes, do it there. That way there will only be one implementation and one signature.\n\nVincent",
    "created_at": "2015-09-08T23:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330507",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>
Replying to [bruno](#comment%3A19):
> Replying to [vdelecroix](#comment%3A16):
> > - why are you keeping a method `newton_slopes` in both `polynomial_element.Polynomial` and `polynomial_element_generic.Polynomial_generic_sparse`? The algorithm does not seem to use much about the sparse structure. Moreover, why their arguments differ?
 
> 
> The rationale is that for very sparse polynomials, one may want to get the newton slopes in a "compressed" format, that is as a list of segments defined by their slope and length rather than as a (very long) list of length-1 segments solely defined by their slope. I decided to implement this "compressed" output for sparse polynomials only since this feature seem(ed) mostly useful for sparse polynomials. 
> 
> A modification I could do is to move my implementation in the `Polynomial` class. Do yo think it would be the right thing to do?


I understand the need of the argument. But if it also makes sense at the level of `Polynomial` then yes, do it there. That way there will only be one implementation and one signature.

Vincent



---

archive/issue_comments_330508.json:
```json
{
    "body": "Changing commit from \"e021276b5e043e066842b4e6e3644d489626deab\" to \"4a4448604662733d1dc1ddf7e1f867e54be23af2\"",
    "created_at": "2015-09-09T09:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330508",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e021276b5e043e066842b4e6e3644d489626deab" to "4a4448604662733d1dc1ddf7e1f867e54be23af2"



---

archive/issue_comments_330509.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[4a44486](https://github.com/sagemath/sagetrac-mirror/commit/4a4448604662733d1dc1ddf7e1f867e54be23af2)|`#18600: Move newton_slopes to class Polynomial`|",
    "created_at": "2015-09-09T09:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[4a44486](https://github.com/sagemath/sagetrac-mirror/commit/4a4448604662733d1dc1ddf7e1f867e54be23af2)|`#18600: Move newton_slopes to class Polynomial`|



---

archive/issue_comments_330510.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-09T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330510",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330511.json:
```json
{
    "body": "<a id='comment:22'></a>\nI moved the implementation to `Polynomial`. It actually make more sense.",
    "created_at": "2015-09-09T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330511",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:22'></a>
I moved the implementation to `Polynomial`. It actually make more sense.



---

archive/issue_comments_330512.json:
```json
{
    "body": "<a id='comment:23'></a>\nLet it go. These are nice improvements to sparse polynomials. Thanks.",
    "created_at": "2015-09-15T01:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330512",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Let it go. These are nice improvements to sparse polynomials. Thanks.



---

archive/issue_comments_330513.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-15T01:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330513",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330514.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks for the help!",
    "created_at": "2015-09-15T09:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330514",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:24'></a>
Thanks for the help!



---

archive/issue_comments_330515.json:
```json
{
    "body": "Changing branch from \"public/18600\" to \"4a4448604662733d1dc1ddf7e1f867e54be23af2\"",
    "created_at": "2015-09-15T22:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330515",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/18600" to "4a4448604662733d1dc1ddf7e1f867e54be23af2"



---

archive/issue_comments_330516.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-15T22:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18600#issuecomment-330516",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059396.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-15T22:30:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18600",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18600#event-59396"
}
```
