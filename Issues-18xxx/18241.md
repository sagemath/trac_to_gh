# Issue 18241: Great speedup in polytopes construction with generic backend

archive/issues_018004.json:
```json
{
    "body": "Construction of polytopes with number field coordinates are very slow. There are several reasons for that:\n- quadratic number field element hash is slow (already solved in #18215)\n- `NumberField.__cmp__` is slow\n- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`\n\nAfter applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got\n\nBefore\n\n```\nsage: %runfile polyhedron_test.py\nsage: %time gr = great_rhombicuboctahedron()\nCPU times: user 4.66 s, sys: 24 ms, total: 4.68 s\nWall time: 4.66 s\n```\nAfter\n\n```\nsage: %runfile polyhedron_test.py\nsage: %time gr = great_rhombicuboctahedron()\nCPU times: user 292 ms, sys: 28 ms, total: 320 ms\nWall time: 306 ms\n```\n\n(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))\n\nModifications with the branch:\n\n1. In the double description file\n     - use `itertools` instead of whatever `sage/combinat/*`\n     - use `base_ring.zero()` and `base_ring.one()` instead of the Python integer `0` and `1`. That prevents many coercions.\n     - make the method `add_inequality` so that the object is changed **inplace** instead of returning a new instance. I had to change the type of the attribute from `tuples` to `lists`.\n     - add a cache for matrix spaces (see #18231). These are the methods `_matrix_space` and `_matrix`\n     - implement a cache for the method `.zero_set` (note that this was needed because the object is no more immutable, `self.A` will grow in `add_inequality`)\n\n2. Start with a trivial case in `NumberField.__cmp__`.\n\nCC:  @vbraun @nathanncohen\n\nBranch/Commit: c5b15bf0297ee8626e9dcadf75a325aad49673af\n\nReviewer: Nathann Cohen\n\nAuthor: Vincent Delecroix\n\nDependencies: #18215\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18241\n\n",
    "closed_at": "2015-04-19T16:44:59Z",
    "created_at": "2015-04-17T14:24:46Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Great speedup in polytopes construction with generic backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18241",
    "user": "https://github.com/videlec"
}
```
Construction of polytopes with number field coordinates are very slow. There are several reasons for that:
- quadratic number field element hash is slow (already solved in #18215)
- `NumberField.__cmp__` is slow
- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`

After applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got

Before

```
sage: %runfile polyhedron_test.py
sage: %time gr = great_rhombicuboctahedron()
CPU times: user 4.66 s, sys: 24 ms, total: 4.68 s
Wall time: 4.66 s
```
After

```
sage: %runfile polyhedron_test.py
sage: %time gr = great_rhombicuboctahedron()
CPU times: user 292 ms, sys: 28 ms, total: 320 ms
Wall time: 306 ms
```

(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))

Modifications with the branch:

1. In the double description file
     - use `itertools` instead of whatever `sage/combinat/*`
     - use `base_ring.zero()` and `base_ring.one()` instead of the Python integer `0` and `1`. That prevents many coercions.
     - make the method `add_inequality` so that the object is changed **inplace** instead of returning a new instance. I had to change the type of the attribute from `tuples` to `lists`.
     - add a cache for matrix spaces (see #18231). These are the methods `_matrix_space` and `_matrix`
     - implement a cache for the method `.zero_set` (note that this was needed because the object is no more immutable, `self.A` will grow in `add_inequality`)

2. Start with a trivial case in `NumberField.__cmp__`.

CC:  @vbraun @nathanncohen

Branch/Commit: c5b15bf0297ee8626e9dcadf75a325aad49673af

Reviewer: Nathann Cohen

Author: Vincent Delecroix

Dependencies: #18215

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18241





---

archive/issue_comments_316409.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/18241\"",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316409",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/18241"



---

archive/issue_comments_316410.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316410",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_316411.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n Construction of polytopes with number field coordinates are very slow. There are several reasons for that:\n - quadratic number field element hash is slow (already solved in #18215)\n - `NumberField.__cmp__` is slow\n-- we can avoid many useless copies and recomputation in the algorithm `Vrep2Hrep` and `Hrep2Vrep`\n+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`\n \n After applying the branch the speedup is really cool...\n \n``````\n",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316411",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 Construction of polytopes with number field coordinates are very slow. There are several reasons for that:
 - quadratic number field element hash is slow (already solved in #18215)
 - `NumberField.__cmp__` is slow
-- we can avoid many useless copies and recomputation in the algorithm `Vrep2Hrep` and `Hrep2Vrep`
+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`
 
 After applying the branch the speedup is really cool...
 
``````




---

archive/issue_comments_316412.json:
```json
{
    "body": "Changing commit from \"\" to \"99c670831a4064246d2cdb2aec32a3e51fd4fd7c\"",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316412",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "99c670831a4064246d2cdb2aec32a3e51fd4fd7c"



---

archive/issue_comments_316413.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316413",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316414.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-04-17T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316414",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Vincent Delecroix"



---

archive/issue_comments_316415.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [polyhedron_test.py](tarball://root/attachments/some-uuid/ticket18241/polyhedron_test.py) by @videlec created at 2015-04-17 14:42:30",
    "created_at": "2015-04-17T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316415",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>Attachment [polyhedron_test.py](tarball://root/attachments/some-uuid/ticket18241/polyhedron_test.py) by @videlec created at 2015-04-17 14:42:30



---

archive/issue_comments_316416.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+Construction of polytopes with number field coordinates are very slow. There are several reasons for that:\n+- quadratic number field element hash is slow (already solved in #18215)\n+- `NumberField.__cmp__` is slow\n+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`\n \n+After applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got\n+\n+Before\n+\n+```\n+sage: %runfile polyhedron_test.py\n+sage: %time gr = great_rhombicuboctahedron()\n+CPU times: user 4.66 s, sys: 24 ms, total: 4.68 s\n+Wall time: 4.66 s\n+```\n+After\n+\n+```\n+sage: %runfile polyhedron_test.py\n+sage: %time gr = great_rhombicuboctahedron()\n+CPU times: user 292 ms, sys: 28 ms, total: 320 ms\n+Wall time: 306 ms\n+```\n+\n+(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))\n \n Dependencies: #18215\n \n``````\n",
    "created_at": "2015-04-17T14:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316416",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,28 @@
+Construction of polytopes with number field coordinates are very slow. There are several reasons for that:
+- quadratic number field element hash is slow (already solved in #18215)
+- `NumberField.__cmp__` is slow
+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`
 
+After applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got
+
+Before
+
+```
+sage: %runfile polyhedron_test.py
+sage: %time gr = great_rhombicuboctahedron()
+CPU times: user 4.66 s, sys: 24 ms, total: 4.68 s
+Wall time: 4.66 s
+```
+After
+
+```
+sage: %runfile polyhedron_test.py
+sage: %time gr = great_rhombicuboctahedron()
+CPU times: user 292 ms, sys: 28 ms, total: 320 ms
+Wall time: 306 ms
+```
+
+(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))
 
 Dependencies: #18215
 
``````




---

archive/issue_comments_316417.json:
```json
{
    "body": "<a id='comment:3'></a>Could you say in the ticket's description what the branch does?\n\nEvery single thing that you do without explanation, the reviewer has to figure out from the diff file.",
    "created_at": "2015-04-18T08:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316417",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Could you say in the ticket's description what the branch does?

Every single thing that you do without explanation, the reviewer has to figure out from the diff file.



---

archive/issue_comments_316418.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 ncohen]:\n> Could you say in the ticket's description what the branch does?\n> \n> Every single thing that you do without explanation, the reviewer has to figure out from the diff file.\n\n\ndone!",
    "created_at": "2015-04-18T09:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316418",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>Replying to [comment:3 ncohen]:
> Could you say in the ticket's description what the branch does?
> 
> Every single thing that you do without explanation, the reviewer has to figure out from the diff file.


done!



---

archive/issue_comments_316419.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,39 @@\n+Construction of polytopes with number field coordinates are very slow. There are several reasons for that:\n+- quadratic number field element hash is slow (already solved in #18215)\n+- `NumberField.__cmp__` is slow\n+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`\n \n+After applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got\n+\n+Before\n+\n+```\n+sage: %runfile polyhedron_test.py\n+sage: %time gr = great_rhombicuboctahedron()\n+CPU times: user 4.66 s, sys: 24 ms, total: 4.68 s\n+Wall time: 4.66 s\n+```\n+After\n+\n+```\n+sage: %runfile polyhedron_test.py\n+sage: %time gr = great_rhombicuboctahedron()\n+CPU times: user 292 ms, sys: 28 ms, total: 320 ms\n+Wall time: 306 ms\n+```\n+\n+(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))\n+\n+Modifications with the branch:\n+\n+1. In the double description file\n+     - use `itertools` instead of whatever `sage/combinat/*`\n+     - use `base_ring.zero()` and `base_ring.one()` instead of the Python integer `0` and `1`. That prevents many coercions.\n+     - make the method `add_inequality` so that the object is changed **inplace** instead of returning a new instance. I had to change the type of the attribute from `tuples` to `lists`.\n+     - add a cache for matrix spaces (see #18231). These are the methods `_matrix_space` and `_matrix`\n+     - implement a cache for the method `.zero_set` (note that this was needed because the object is no more immutable, `self.A` will grow in `add_inequality`)\n+\n+2. Start with a trivial case in `NumberField.__cmp__`.\n \n Dependencies: #18215\n \n``````\n",
    "created_at": "2015-04-18T09:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316419",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,39 @@
+Construction of polytopes with number field coordinates are very slow. There are several reasons for that:
+- quadratic number field element hash is slow (already solved in #18215)
+- `NumberField.__cmp__` is slow
+- we can avoid many useless copies and recomputations in the algorithm `Vrep2Hrep` and `Hrep2Vrep`
 
+After applying the branch the speedup is really cool. Using [polyhedron_test.py](http://trac.sagemath.org/attachment/ticket/18241/polyhedron_test.py) I got
+
+Before
+
+```
+sage: %runfile polyhedron_test.py
+sage: %time gr = great_rhombicuboctahedron()
+CPU times: user 4.66 s, sys: 24 ms, total: 4.68 s
+Wall time: 4.66 s
+```
+After
+
+```
+sage: %runfile polyhedron_test.py
+sage: %time gr = great_rhombicuboctahedron()
+CPU times: user 292 ms, sys: 28 ms, total: 320 ms
+Wall time: 306 ms
+```
+
+(But I am still not able to build the [600-cell](http://en.wikipedia.org/wiki/600-cell))
+
+Modifications with the branch:
+
+1. In the double description file
+     - use `itertools` instead of whatever `sage/combinat/*`
+     - use `base_ring.zero()` and `base_ring.one()` instead of the Python integer `0` and `1`. That prevents many coercions.
+     - make the method `add_inequality` so that the object is changed **inplace** instead of returning a new instance. I had to change the type of the attribute from `tuples` to `lists`.
+     - add a cache for matrix spaces (see #18231). These are the methods `_matrix_space` and `_matrix`
+     - implement a cache for the method `.zero_set` (note that this was needed because the object is no more immutable, `self.A` will grow in `add_inequality`)
+
+2. Start with a trivial case in `NumberField.__cmp__`.
 
 Dependencies: #18215
 
``````




---

archive/issue_comments_316420.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-18T10:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316420",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316421.json:
```json
{
    "body": "<a id='comment:5'></a>Looks like your mutable object is also hashable\n {{{\nsage: DD.__hash__()\n1042963791458606606\nsage: DD.add_inequality(vector([1,0,0]))\nsage: DD.__hash__()\n-1000165618804906370\n}}}",
    "created_at": "2015-04-18T10:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316421",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Looks like your mutable object is also hashable
 {{{
sage: DD.__hash__()
1042963791458606606
sage: DD.add_inequality(vector([1,0,0]))
sage: DD.__hash__()
-1000165618804906370
}}}



---

archive/issue_comments_316422.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 ncohen]:\n> Looks like your mutable object is also hashable\n>  {{{\n> sage: DD.__hash__()\n> 1042963791458606606\n> sage: DD.add_inequality(vector([1,0,0]))\n> sage: DD.__hash__()\n> -1000165618804906370\n> }}}\n\n\nF!**!**!** Sage objects!\n\n```\ncdef class SageObject:\n...\n    def __hash__(self):\n        return hash(self.__repr__())\n```",
    "created_at": "2015-04-18T10:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316422",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:5 ncohen]:
> Looks like your mutable object is also hashable
>  {{{
> sage: DD.__hash__()
> 1042963791458606606
> sage: DD.add_inequality(vector([1,0,0]))
> sage: DD.__hash__()
> -1000165618804906370
> }}}


F!**!**!** Sage objects!

```
cdef class SageObject:
...
    def __hash__(self):
        return hash(self.__repr__())
```



---

archive/issue_comments_316423.json:
```json
{
    "body": "<a id='comment:7'></a>Unless all SageObject must be immutable, I guess that it should be removed (in another ticket that will become another war)",
    "created_at": "2015-04-18T10:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316423",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>Unless all SageObject must be immutable, I guess that it should be removed (in another ticket that will become another war)



---

archive/issue_comments_316424.json:
```json
{
    "body": "<a id='comment:8'></a>Actually, no... \n\n```\nsage: class A:\n....:     pass\nsage: hash(A())\n-9223363253024015589\n```\n\nWe should probably make `SageObject.__hash__` raise a `NotImplementedError`",
    "created_at": "2015-04-18T10:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316424",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>Actually, no... 

```
sage: class A:
....:     pass
sage: hash(A())
-9223363253024015589
```

We should probably make `SageObject.__hash__` raise a `NotImplementedError`



---

archive/issue_comments_316425.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 ncohen]:\n> Actually, no... \n> \n> \n> ```\n> sage: class A:\n> ....:     pass\n> sage: hash(A())\n> -9223363253024015589\n> ```\n> \n> We should probably make `SageObject.__hash__` raise a `NotImplementedError`\n\n\nOr\n\n```\nclass A:\n    __hash__ = None\n```",
    "created_at": "2015-04-18T10:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316425",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 ncohen]:
> Actually, no... 
> 
> 
> ```
> sage: class A:
> ....:     pass
> sage: hash(A())
> -9223363253024015589
> ```
> 
> We should probably make `SageObject.__hash__` raise a `NotImplementedError`


Or

```
class A:
    __hash__ = None
```



---

archive/issue_comments_316426.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-18T10:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316426",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316427.json:
```json
{
    "body": "Changing commit from \"99c670831a4064246d2cdb2aec32a3e51fd4fd7c\" to \"3c573aef7df1659213bec2614f9ba2b788c1f4fa\"",
    "created_at": "2015-04-18T10:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "99c670831a4064246d2cdb2aec32a3e51fd4fd7c" to "3c573aef7df1659213bec2614f9ba2b788c1f4fa"



---

archive/issue_comments_316428.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-18T10:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316428",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_316429.json:
```json
{
    "body": "<a id='comment:12'></a>About this branch:\n\n- `zero_set`: why don't you just call `DD.zero_set.clear_cache()` instead of rewriting the caching mechanism? If you do want to keep this `self.cache` please make the name more specific.\n\n- `A_matrix` : returns a pointer toward a mutable internal object.\n\n- Err\n  {{{\n  Add an inequality to the double description with the inequality ``a``\n  added.\n  }}}\n\n- I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?\n\nNathann",
    "created_at": "2015-04-18T13:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316429",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>About this branch:

- `zero_set`: why don't you just call `DD.zero_set.clear_cache()` instead of rewriting the caching mechanism? If you do want to keep this `self.cache` please make the name more specific.

- `A_matrix` : returns a pointer toward a mutable internal object.

- Err
  {{{
  Add an inequality to the double description with the inequality ``a``
  added.
  }}}

- I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?

Nathann



---

archive/issue_comments_316430.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 ncohen]:\n> About this branch:\n> \n> - `zero_set`: why don't you just call `DD.zero_set.clear_cache()` instead of rewriting the caching mechanism? If you do want to keep this `self.cache` please make the name more specific.\n\n\nNope. If you call the function with the same `ray` argument you do not want to recompute it from scratch.\n \n> - I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?\n\n\nMe neither. That's why I opened #18231. The function just constructs a matrix, why the name is badly chosen? You will get the very same answer as calling `matrix(self.problem.base_ring(), data)`. Except that it is faster. What about `.build_matrix` and `.build_matrix_space`?\n\nI do not understand you remark about the `if`.",
    "created_at": "2015-04-18T13:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316430",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Replying to [comment:12 ncohen]:
> About this branch:
> 
> - `zero_set`: why don't you just call `DD.zero_set.clear_cache()` instead of rewriting the caching mechanism? If you do want to keep this `self.cache` please make the name more specific.


Nope. If you call the function with the same `ray` argument you do not want to recompute it from scratch.
 
> - I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?


Me neither. That's why I opened #18231. The function just constructs a matrix, why the name is badly chosen? You will get the very same answer as calling `matrix(self.problem.base_ring(), data)`. Except that it is faster. What about `.build_matrix` and `.build_matrix_space`?

I do not understand you remark about the `if`.



---

archive/issue_comments_316431.json:
```json
{
    "body": "<a id='comment:14'></a>Hello,\n\n> Nope. If you call the function with the same `ray` argument you do not want to recompute it from scratch.\n\n\nOh, okay. Then change the cache's name please\n\n> > - I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?\n \n> \n> Me neither. That's why I opened #18231.\n\n\nThen should it be really fixed inside of this class? Or do we keep this code as it is and try to solve the #18231 instead.\n\n> The function just constructs a matrix, why the name is badly chosen? You will get the very same answer as calling `matrix(self.problem.base_ring(), data)`. Except that it is faster.\n\n\nPrecisely because the name does not reflect the difference. `matrix_from_cached_vector_space` does.\n\n> What about `.build_matrix` and `.build_matrix_space`?\n\n\nI hate this class already.\n\n> I do not understand you remark about the `if`.\n\n\nOh. Well, because all that 'matrix' does is a if. If it is not a function of its own, you just have to copy this 'if' around.\n\nNathann",
    "created_at": "2015-04-18T13:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316431",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Hello,

> Nope. If you call the function with the same `ray` argument you do not want to recompute it from scratch.


Oh, okay. Then change the cache's name please

> > - I do not like this '_matrix' function very much. Its name is not very clear (`matrix_from_cached_vector_space`?) but what about just doing this 'if' twice (it is called twice)?
 
> 
> Me neither. That's why I opened #18231.


Then should it be really fixed inside of this class? Or do we keep this code as it is and try to solve the #18231 instead.

> The function just constructs a matrix, why the name is badly chosen? You will get the very same answer as calling `matrix(self.problem.base_ring(), data)`. Except that it is faster.


Precisely because the name does not reflect the difference. `matrix_from_cached_vector_space` does.

> What about `.build_matrix` and `.build_matrix_space`?


I hate this class already.

> I do not understand you remark about the `if`.


Oh. Well, because all that 'matrix' does is a if. If it is not a function of its own, you just have to copy this 'if' around.

Nathann



---

archive/issue_comments_316432.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-18T13:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316432",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316433.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-18T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316434.json:
```json
{
    "body": "Changing commit from \"3c573aef7df1659213bec2614f9ba2b788c1f4fa\" to \"770ad60c6812e524b6d957b2179bd486e2d3896e\"",
    "created_at": "2015-04-18T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3c573aef7df1659213bec2614f9ba2b788c1f4fa" to "770ad60c6812e524b6d957b2179bd486e2d3896e"



---

archive/issue_comments_316435.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-18T14:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316435",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_316436.json:
```json
{
    "body": "<a id='comment:17'></a>- I get rid of `def _matrix` and move `Problem._matrix_space -> DoubleDescription.matrix_space`.\n- I changed `.cache -> .zero_set_cache`\n- I modified the output of `zero_set` to return Python sets instead of tuple (since the most important operation on them is the intersection)\n\nNeeds review again.",
    "created_at": "2015-04-18T14:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316436",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>- I get rid of `def _matrix` and move `Problem._matrix_space -> DoubleDescription.matrix_space`.
- I changed `.cache -> .zero_set_cache`
- I modified the output of `zero_set` to return Python sets instead of tuple (since the most important operation on them is the intersection)

Needs review again.



---

archive/issue_comments_316437.json:
```json
{
    "body": "<a id='comment:18'></a>Yoooooooooooooo !\n\nLooks good, almost good to go. Just two things:\n\n- This sentence repeats itself\n  {{{\n  Add an inequality to the double description with the inequality ``a``\n  added.\n  }}}\n- What is the difference between those two lines?\n  {{{\n  lines = self._linear_subspace.matrix().rows()\n  lines = self._linear_subspace.basis_matrix().rows()\n  }}}\n\nNathann",
    "created_at": "2015-04-18T16:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316437",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>Yoooooooooooooo !

Looks good, almost good to go. Just two things:

- This sentence repeats itself
  {{{
  Add an inequality to the double description with the inequality ``a``
  added.
  }}}
- What is the difference between those two lines?
  {{{
  lines = self._linear_subspace.matrix().rows()
  lines = self._linear_subspace.basis_matrix().rows()
  }}}

Nathann



---

archive/issue_comments_316438.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-18T16:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316438",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_316439.json:
```json
{
    "body": "<a id='comment:20'></a>Hello,\n\nReplying to [comment:18 ncohen]:\n> - What is the difference between those two lines?\n>   {{{\n>   lines = self._linear_subspace.matrix().rows()\n>   lines = self._linear_subspace.basis_matrix().rows()\n>   }}}\n\n\n`linear_subspace.matrix` calls `linear_subspace.basis_matrix`. Having aliases is cool, but avoiding using them is cooler ;-)\n\nVincent",
    "created_at": "2015-04-18T16:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316439",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Hello,

Replying to [comment:18 ncohen]:
> - What is the difference between those two lines?
>   {{{
>   lines = self._linear_subspace.matrix().rows()
>   lines = self._linear_subspace.basis_matrix().rows()
>   }}}


`linear_subspace.matrix` calls `linear_subspace.basis_matrix`. Having aliases is cool, but avoiding using them is cooler ;-)

Vincent



---

archive/issue_comments_316440.json:
```json
{
    "body": "Changing commit from \"770ad60c6812e524b6d957b2179bd486e2d3896e\" to \"c5b15bf0297ee8626e9dcadf75a325aad49673af\"",
    "created_at": "2015-04-18T16:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "770ad60c6812e524b6d957b2179bd486e2d3896e" to "c5b15bf0297ee8626e9dcadf75a325aad49673af"



---

archive/issue_comments_316441.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-18T16:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-18T16:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316442",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_316443.json:
```json
{
    "body": "<a id='comment:23'></a>Okayyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy",
    "created_at": "2015-04-18T16:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316443",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:23'></a>Okayyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy



---

archive/issue_comments_316444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-18T16:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316444",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_316445.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 ncohen]:\n> Okayyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\n\n\nGreat! Thanks. It becomes reasonable to start using the generic backend.\n\nNext step: avoid the recomputation of vertices! The algorithm is currently\n\n```\nINPUT: vertices\nOUTPUT: (vertices, hyperplanes)\nALGO:\n  1. compute hyperplanes from vertices (with no redundancy)\n  2. recompute vertices from hyperplanes (with no redundancy)\n  3. return (vertices, hyperplanes)\n```\nAnd it is precisely step 2 which takes an infinite amount of time for the 600-cell!",
    "created_at": "2015-04-18T16:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316445",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>Replying to [comment:23 ncohen]:
> Okayyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy


Great! Thanks. It becomes reasonable to start using the generic backend.

Next step: avoid the recomputation of vertices! The algorithm is currently

```
INPUT: vertices
OUTPUT: (vertices, hyperplanes)
ALGO:
  1. compute hyperplanes from vertices (with no redundancy)
  2. recompute vertices from hyperplanes (with no redundancy)
  3. return (vertices, hyperplanes)
```
And it is precisely step 2 which takes an infinite amount of time for the 600-cell!



---

archive/issue_comments_316446.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-18T23:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316446",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_316447.json:
```json
{
    "body": "<a id='comment:25'></a>reviewer name",
    "created_at": "2015-04-18T23:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316447",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>reviewer name



---

archive/issue_comments_316448.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-19T05:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316448",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_316449.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2015-04-19T05:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316449",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_316450.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/18241\" to \"c5b15bf0297ee8626e9dcadf75a325aad49673af\"",
    "created_at": "2015-04-19T16:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316450",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vdelecroix/18241" to "c5b15bf0297ee8626e9dcadf75a325aad49673af"



---

archive/issue_comments_316451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-19T16:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18241#issuecomment-316451",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051535.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-19T16:44:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18241",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18241#event-51535"
}
```
