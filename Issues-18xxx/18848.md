# Issue 18848: do not save() objects we cannot load()

archive/issues_018611.json:
```json
{
    "assignees": [],
    "body": "currently \n\n```\nsage: x=singular(2)\nsage: x.save(\"blah\")\n```\nresults in `blah.sobj` we cannot load().\n\ncf. [sage-devel post](https://groups.google.com/d/msg/sage-devel/O3YTL7_EHuU/slaR3NlYqQAJ)\n\nCC:  @nathanncohen @vbraun\n\nBranch/Commit: **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**\n\nReviewer: **Volker Braun**\n\nAuthor: **Simon King**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18848_\n\n",
    "closed_at": "2015-07-09T21:58:07Z",
    "created_at": "2015-07-03T09:58:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "do not save() objects we cannot load()",
    "type": "issue",
    "updated_at": "2015-07-09T21:58:07Z",
    "url": "https://github.com/sagemath/sage/issues/18848",
    "user": "https://github.com/dimpase"
}
```
currently 

```
sage: x=singular(2)
sage: x.save("blah")
```
results in `blah.sobj` we cannot load().

cf. [sage-devel post](https://groups.google.com/d/msg/sage-devel/O3YTL7_EHuU/slaR3NlYqQAJ)

CC:  @nathanncohen @vbraun

Branch/Commit: **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**

Reviewer: **Volker Braun**

Author: **Simon King**

_Issue created by migration from https://trac.sagemath.org/ticket/18848_





---

archive/issue_events_240839.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-03T09:58:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240839"
}
```



---

archive/issue_events_240840.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-03T09:58:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240840"
}
```



---

archive/issue_events_240841.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-03T09:58:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240841"
}
```



---

archive/issue_events_240842.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-03T09:58:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240842"
}
```



---

archive/issue_comments_266386.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nBlindly doing `save(x.sage(),\"blah\")` is not quite right, as this would e.g. break saving/loading Python objects (something that works just fine).\n\nIdeas?",
    "created_at": "2015-07-03T10:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266386",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'>Comment 1:</a>
Blindly doing `save(x.sage(),"blah")` is not quite right, as this would e.g. break saving/loading Python objects (something that works just fine).

Ideas?



---

archive/issue_comments_266387.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nReplying to [@dimpase](#comment%3A1):\n> Blindly doing `save(x.sage(),\"blah\")` is not quite right, as this would e.g. break saving/loading Python objects (something that works just fine).\n\nWell, each object has a `__reduce__` method. In the case of `sage.interfaces.interface.InterfaceElement.__reduce__`, this is\n\n```python\n    def __reduce__(self):\n        return reduce_load, (self.parent(), self._reduce())\n```\nand\n\n```python\n    def _reduce(self):\n        return repr(self)\n```\n\nThe latter should change (by default) to\n\n```python\n    def _reduce(self):\n        return self.sage()\n```\n\nBut then, it is still needed to fix something, since `SingularElement` has its own `__reduce__` method, that explicitly makes sure that the result will be invalid:\n\n```python\n    def __reduce__(self):\n        \"\"\"\n        Note that the result of the returned reduce_load is an invalid\n        Singular object.\n\n        EXAMPLES::\n\n            sage: singular(2).__reduce__()\n            (<function reduce_load at 0x...>, ())\n        \"\"\"\n        return reduce_load, ()  # default is an invalid object\n```\n\nAnd finally, one should remove the stupid custom `reduce_load` methods. There is a default one:\n\n```python\ndef reduce_load(parent, x):\n    return parent(x)\n```\nbut the Singular and GAP interfaces override it to, for example,\n\n```python\ndef reduce_load():\n    \"\"\"\n    Returns an invalid GAP element. Note that this is the object\n    returned when a GAP element is unpickled.\n\n    EXAMPLES::\n\n        sage: from sage.interfaces.gap import reduce_load\n        sage: reduce_load()\n        <repr(<sage.interfaces.gap.GapElement at 0x...>) failed: ValueError: The session in which this object was defined is no longer running.>\n        sage: loads(dumps(gap(2)))\n        <repr(<sage.interfaces.gap.GapElement at 0x...>) failed: ValueError: The session in which this object was defined is no longer running.>\n    \"\"\"\n    return GapElement(None, None)\n```\n\nSo, summary of the status quo: Several interfaces explicitly override the default to make sure that pickling does NOT work. And the default currently is not good enough to ensure pickling, since the default relies on string representations.\n\nSummary of the proposed solution: Interfaces should rely on the default pickling, as long as they don't have anything substantial to say about pickling. And the default should rely on the `.sage()` method, whose functionality should be improved in some cases.",
    "created_at": "2015-07-03T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266387",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'>Comment 3:</a>
Replying to [@dimpase](#comment%3A1):
> Blindly doing `save(x.sage(),"blah")` is not quite right, as this would e.g. break saving/loading Python objects (something that works just fine).

Well, each object has a `__reduce__` method. In the case of `sage.interfaces.interface.InterfaceElement.__reduce__`, this is

```python
    def __reduce__(self):
        return reduce_load, (self.parent(), self._reduce())
```
and

```python
    def _reduce(self):
        return repr(self)
```

The latter should change (by default) to

```python
    def _reduce(self):
        return self.sage()
```

But then, it is still needed to fix something, since `SingularElement` has its own `__reduce__` method, that explicitly makes sure that the result will be invalid:

```python
    def __reduce__(self):
        """
        Note that the result of the returned reduce_load is an invalid
        Singular object.

        EXAMPLES::

            sage: singular(2).__reduce__()
            (<function reduce_load at 0x...>, ())
        """
        return reduce_load, ()  # default is an invalid object
```

And finally, one should remove the stupid custom `reduce_load` methods. There is a default one:

```python
def reduce_load(parent, x):
    return parent(x)
```
but the Singular and GAP interfaces override it to, for example,

```python
def reduce_load():
    """
    Returns an invalid GAP element. Note that this is the object
    returned when a GAP element is unpickled.

    EXAMPLES::

        sage: from sage.interfaces.gap import reduce_load
        sage: reduce_load()
        <repr(<sage.interfaces.gap.GapElement at 0x...>) failed: ValueError: The session in which this object was defined is no longer running.>
        sage: loads(dumps(gap(2)))
        <repr(<sage.interfaces.gap.GapElement at 0x...>) failed: ValueError: The session in which this object was defined is no longer running.>
    """
    return GapElement(None, None)
```

So, summary of the status quo: Several interfaces explicitly override the default to make sure that pickling does NOT work. And the default currently is not good enough to ensure pickling, since the default relies on string representations.

Summary of the proposed solution: Interfaces should rely on the default pickling, as long as they don't have anything substantial to say about pickling. And the default should rely on the `.sage()` method, whose functionality should be improved in some cases.



---

archive/issue_comments_266388.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nOr perhaps one should do a compromise: If `self.sage()` throws an error, then we should try if the string representation is good enough to reconstruct the object. If it does then use it, otherwise throw an error upon pickling.\n\nIt would be better than nothing. But it could be quite costly to first check, for each interface element to be pickled, if the string representation is good enough.",
    "created_at": "2015-07-03T10:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266388",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'>Comment 4:</a>
Or perhaps one should do a compromise: If `self.sage()` throws an error, then we should try if the string representation is good enough to reconstruct the object. If it does then use it, otherwise throw an error upon pickling.

It would be better than nothing. But it could be quite costly to first check, for each interface element to be pickled, if the string representation is good enough.



---

archive/issue_comments_266389.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nPPS: In the case of GAP elements, string representation sometimes is not good enough, and GAP does not support pickling by default. But there was some thread on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/_C2-vekHnSY) concerning that point. It was mentioned that with the IO package of GAP, which is GPL3, pickling of individual objects can be achieved. Perhaps we can make it a standard package?",
    "created_at": "2015-07-03T10:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266389",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'>Comment 5:</a>
PPS: In the case of GAP elements, string representation sometimes is not good enough, and GAP does not support pickling by default. But there was some thread on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/_C2-vekHnSY) concerning that point. It was mentioned that with the IO package of GAP, which is GPL3, pickling of individual objects can be achieved. Perhaps we can make it a standard package?



---

archive/issue_comments_266390.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nPPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.",
    "created_at": "2015-07-03T11:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266390",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'>Comment 6:</a>
PPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.



---

archive/issue_comments_266391.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@simon-king-jena](#comment%3A6):\n> PPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.\n\none can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.\n\nNo idea about Singular though.",
    "created_at": "2015-07-03T11:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266391",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@simon-king-jena](#comment%3A6):
> PPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.

one can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.

No idea about Singular though.



---

archive/issue_comments_266392.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@dimpase](#comment%3A7):\n> Replying to [@simon-king-jena](#comment%3A6):\n> > PPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.\n\n> \n> one can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.\n\nHaha! So, it is \"write only memory\"...\n\n> No idea about Singular though.\n\nSee [dump](http://www.singular.uni-kl.de/Manual/latest/sing_284.htm#SEC323).",
    "created_at": "2015-07-03T11:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266392",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@dimpase](#comment%3A7):
> Replying to [@simon-king-jena](#comment%3A6):
> > PPPS: Both Singular and GAP can dump a complete session. I don't know if that has been wrapped in Sage's interface. But it could be useful for some. Not for pickling individual objects, though.

> 
> one can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.

Haha! So, it is "write only memory"...

> No idea about Singular though.

See [dump](http://www.singular.uni-kl.de/Manual/latest/sing_284.htm#SEC323).



---

archive/issue_comments_266393.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@simon-king-jena](#comment%3A8):\n> Replying to [@dimpase](#comment%3A7):\n> > one can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.\n\n> \n> Haha! So, it is \"write only memory\"...\n\n\nI had a look, and it seems that really it is impossible to load a workspace into a running session (overriding all previously assigned variables of the session). One can only start a new session that is using the saved workspace. Doh...",
    "created_at": "2015-07-03T12:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266393",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@simon-king-jena](#comment%3A8):
> Replying to [@dimpase](#comment%3A7):
> > one can save GAP's workspace via `gap.save_workspace(...)`, but there is no mechanism in Sage to load GAP with such a custom-made workspace; although this is doable.

> 
> Haha! So, it is "write only memory"...


I had a look, and it seems that really it is impossible to load a workspace into a running session (overriding all previously assigned variables of the session). One can only start a new session that is using the saved workspace. Doh...



---

archive/issue_comments_266394.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nSomething totally different: Why is there a `.save()` and `.dumps()` method? Since `__reduce__` is implemented, `save(Foo, \"bar\")` would be the recommended way to store `Foo` in \"bar.sobj\", and `Foo.save(\"bar\")` isn't really adding anything. Can we deprecate these methods?",
    "created_at": "2015-07-03T12:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266394",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'>Comment 10:</a>
Something totally different: Why is there a `.save()` and `.dumps()` method? Since `__reduce__` is implemented, `save(Foo, "bar")` would be the recommended way to store `Foo` in "bar.sobj", and `Foo.save("bar")` isn't really adding anything. Can we deprecate these methods?



---

archive/issue_comments_266395.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@simon-king-jena](#comment%3A10):\n> Something totally different: Why is there a `.save()` and `.dumps()` method? Since `__reduce__` is implemented, `save(Foo, \"bar\")` would be the recommended way to store `Foo` in \"bar.sobj\", and `Foo.save(\"bar\")` isn't really adding anything. Can we deprecate these methods?\n\nThese are not defined on the level of sage.interfaces, but sage.structure.sage_object. So, I guess I better don't touch it...",
    "created_at": "2015-07-03T20:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266395",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@simon-king-jena](#comment%3A10):
> Something totally different: Why is there a `.save()` and `.dumps()` method? Since `__reduce__` is implemented, `save(Foo, "bar")` would be the recommended way to store `Foo` in "bar.sobj", and `Foo.save("bar")` isn't really adding anything. Can we deprecate these methods?

These are not defined on the level of sage.interfaces, but sage.structure.sage_object. So, I guess I better don't touch it...



---

archive/issue_comments_266396.json:
```json
{
    "body": "Branch: **[u/SimonKing/do_not_save___objects_we_cannot_load__](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/do_not_save___objects_we_cannot_load__)**",
    "created_at": "2015-07-03T20:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266396",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/do_not_save___objects_we_cannot_load__](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/do_not_save___objects_we_cannot_load__)**



---

archive/issue_comments_266397.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI think the attached branch is a step to the right direction. It implements most of what I announced above:\n- `sage.interfaces.gap` and `sage.interfaces.singular` do not override the pickling protocol from `sage.interfaces.interface`.\n-. The default pickling tries to convert the interface element to a Sage object. Unpickling converts this element back to an interface element. If conversion to a Sage object fails with a `NotImplementedError`, then the string representation is used, as a last resort.\n- I added to `SingularElement._sage_()` the forgotten case of integers.\n\nI am not sure if it solves the problem to the extent possible. For example, one still can not unpickle a string in gap or singular:\n\n```\nsage: loads(dumps(singular('\"a\"')))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: (TypeError(SingularError('Singular error:\\n   ? `a` is undefined\\n   ? error occurred in or before STDIN line 14: ``',),), <function reduce_load at 0x7f08e40a1500>, (Singular, 'a'))\n```\nReason is: The corresponding Sage object of `singular('\"a\"')` is the string `\"a\"`, but the evaluation `singular(\"a\")` fails.\n\nIt has failed before. So, I am not sure if it is absolutely critical to fix this. Possible semi-fixes are:\n- `singular('\"a\"').sage()` should return the string `\"'a'\"`, not just `\"a\"`. But this wouldn't be the correct answer.\n- Alternatively, `singular(\"a\")` could first try if there is an object in singular whose name is \"a\", and return `singular(\"'a'\")` if that fails. That's bad, because think of what happens if the name `a` **is** defined in Singular...\n\nA real fix would be to modify the `_reduce()` method so that it recognises whether `self` is a string in the respective interface. I.e., there would be a new method `is_string()`, and we would do\n\n```python\ndef _reduce(self):\n    if self.is_string():\n        return repr(repr(self))\n    try:\n        return self.sage()\n    except NotImplementedError:\n        return repr(self)\n```\nAnd `is_string()` would of course be implemented in each interface, such as testing `self.type()==\"string\"` in the case of `SingularElement` or `bool(self.IsString())` in the case of `GapElement`.\n\nDo you think we should care about strings?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807\">547f511</a></td><td><code>Improve pickling for InterfaceElement</code></td></tr></table>\n",
    "created_at": "2015-07-03T21:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266397",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'>Comment 13:</a>
I think the attached branch is a step to the right direction. It implements most of what I announced above:
- `sage.interfaces.gap` and `sage.interfaces.singular` do not override the pickling protocol from `sage.interfaces.interface`.
-. The default pickling tries to convert the interface element to a Sage object. Unpickling converts this element back to an interface element. If conversion to a Sage object fails with a `NotImplementedError`, then the string representation is used, as a last resort.
- I added to `SingularElement._sage_()` the forgotten case of integers.

I am not sure if it solves the problem to the extent possible. For example, one still can not unpickle a string in gap or singular:

```
sage: loads(dumps(singular('"a"')))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: (TypeError(SingularError('Singular error:\n   ? `a` is undefined\n   ? error occurred in or before STDIN line 14: ``',),), <function reduce_load at 0x7f08e40a1500>, (Singular, 'a'))
```
Reason is: The corresponding Sage object of `singular('"a"')` is the string `"a"`, but the evaluation `singular("a")` fails.

It has failed before. So, I am not sure if it is absolutely critical to fix this. Possible semi-fixes are:
- `singular('"a"').sage()` should return the string `"'a'"`, not just `"a"`. But this wouldn't be the correct answer.
- Alternatively, `singular("a")` could first try if there is an object in singular whose name is "a", and return `singular("'a'")` if that fails. That's bad, because think of what happens if the name `a` **is** defined in Singular...

A real fix would be to modify the `_reduce()` method so that it recognises whether `self` is a string in the respective interface. I.e., there would be a new method `is_string()`, and we would do

```python
def _reduce(self):
    if self.is_string():
        return repr(repr(self))
    try:
        return self.sage()
    except NotImplementedError:
        return repr(self)
```
And `is_string()` would of course be implemented in each interface, such as testing `self.type()=="string"` in the case of `SingularElement` or `bool(self.IsString())` in the case of `GapElement`.

Do you think we should care about strings?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807">547f511</a></td><td><code>Improve pickling for InterfaceElement</code></td></tr></table>




---

archive/issue_comments_266398.json:
```json
{
    "body": "Commit: **[547f511](https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807)**",
    "created_at": "2015-07-03T21:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266398",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[547f511](https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807)**



---

archive/issue_events_240843.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-03T21:16:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240843"
}
```



---

archive/issue_comments_266399.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2015-07-03T21:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266399",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_266400.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c\">2445264</a></td><td><code>Allow pickling for more types of interface elements, and preserve backwards compatibility</code></td></tr></table>\n",
    "created_at": "2015-07-04T14:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266400",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c">2445264</a></td><td><code>Allow pickling for more types of interface elements, and preserve backwards compatibility</code></td></tr></table>




---

archive/issue_comments_266401.json:
```json
{
    "body": "Changed commit from **[547f511](https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807)** to **[2445264](https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c)**",
    "created_at": "2015-07-04T14:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266401",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[547f511](https://github.com/sagemath/sagetrac-mirror/commit/547f511ff186696ac2617c6324852c59b079c807)** to **[2445264](https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c)**



---

archive/issue_comments_266402.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nWith the new commit, many interface elements became picklable that haven't been before. Previously, elements of the r or singular or gap or pari or maxima interface would unpickle as invalid. But, as demonstrated in the new tests, now they can be pickled and unpickled.\n\nOne missing case are strings in maxima. In fact, a string in maxima is not converted to a string in Sage, but it is attempted to transform it into an expression, which for what ever reason fails.\n\nDo you know how to recognise a string in maxima? I.e., is there a command in maxima that tells whether a variable is a string?\n\nIn any case, I believe the current branch extends the pickling capabilities of interface elements considerably.",
    "created_at": "2015-07-04T14:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266402",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'>Comment 15:</a>
With the new commit, many interface elements became picklable that haven't been before. Previously, elements of the r or singular or gap or pari or maxima interface would unpickle as invalid. But, as demonstrated in the new tests, now they can be pickled and unpickled.

One missing case are strings in maxima. In fact, a string in maxima is not converted to a string in Sage, but it is attempted to transform it into an expression, which for what ever reason fails.

Do you know how to recognise a string in maxima? I.e., is there a command in maxima that tells whether a variable is a string?

In any case, I believe the current branch extends the pickling capabilities of interface elements considerably.



---

archive/issue_comments_266403.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nWhat I don't understand is why Lisp interface does not suffer from this issue:\n\n```\nsage: x=lisp(1)\nsage: x\n1\nsage: type(x)\n<class 'sage.interfaces.lisp.LispElement'>\nsage: x.save(\"/tmp/foo\")\nsage: load(\"/tmp/foo\")\n1\nsage: y=load(\"/tmp/foo\")\nsage: y==x\nTrue\n```\nAnd in fact `/tmp/foo.sobj` is loadable in a fresh Sage session.",
    "created_at": "2015-07-04T15:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266403",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'>Comment 16:</a>
What I don't understand is why Lisp interface does not suffer from this issue:

```
sage: x=lisp(1)
sage: x
1
sage: type(x)
<class 'sage.interfaces.lisp.LispElement'>
sage: x.save("/tmp/foo")
sage: load("/tmp/foo")
1
sage: y=load("/tmp/foo")
sage: y==x
True
```
And in fact `/tmp/foo.sobj` is loadable in a fresh Sage session.



---

archive/issue_comments_266404.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThat works because it actually has something implemented:\n\n```\nsage: explain_pickle(lisp(1).dumps())\npg_reduce_load = unpickle_global('sage.interfaces.interface', 'reduce_load')\npg_reduce_load_Lisp = unpickle_global('sage.interfaces.lisp', 'reduce_load_Lisp')\npg = unpickle_instantiate(pg_reduce_load_Lisp, ())\npg_reduce_load(pg, '1')\n```\nAnd if you look at `reduce_load_Lisp`, it simply returns `lisp` so the pickle consists of the instructions \"execute `lisp(1)`\", which indeed reconstructs the object. If you try to do this with more complicated objects, you'll see it go wrong for whatever reason (mainly because the lisp interface is very rudimentary):\n\n```\nsage: a=lisp(\"'(1 2)\")\nsage: a\n(1 2)\nsage: loads(a.dumps())\n1\n```\nwhich is explained by the fact that `lisp('(1 2)')` doesn't produce something that equals `a`.",
    "created_at": "2015-07-04T16:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266404",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:17'>Comment 17:</a>
That works because it actually has something implemented:

```
sage: explain_pickle(lisp(1).dumps())
pg_reduce_load = unpickle_global('sage.interfaces.interface', 'reduce_load')
pg_reduce_load_Lisp = unpickle_global('sage.interfaces.lisp', 'reduce_load_Lisp')
pg = unpickle_instantiate(pg_reduce_load_Lisp, ())
pg_reduce_load(pg, '1')
```
And if you look at `reduce_load_Lisp`, it simply returns `lisp` so the pickle consists of the instructions "execute `lisp(1)`", which indeed reconstructs the object. If you try to do this with more complicated objects, you'll see it go wrong for whatever reason (mainly because the lisp interface is very rudimentary):

```
sage: a=lisp("'(1 2)")
sage: a
(1 2)
sage: loads(a.dumps())
1
```
which is explained by the fact that `lisp('(1 2)')` doesn't produce something that equals `a`.



---

archive/issue_comments_266405.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nDima, what do you mean by \"this issue\"?\n\nReplying to [@nbruin](#comment%3A17):\n> That works because it actually has something implemented:\n> \n> ```\n> sage: explain_pickle(lisp(1).dumps())\n> pg_reduce_load = unpickle_global('sage.interfaces.interface', 'reduce_load')\n> pg_reduce_load_Lisp = unpickle_global('sage.interfaces.lisp', 'reduce_load_Lisp')\n> pg = unpickle_instantiate(pg_reduce_load_Lisp, ())\n> pg_reduce_load(pg, '1')\n> ```\n> And if you look at `reduce_load_Lisp`, it simply returns `lisp` so the pickle consists of the instructions \"execute `lisp(1)`\", which indeed reconstructs the object.\n\nWell, this is how it used to work all the time. Each interface \"Foo\" has a `__reduce__` method that returns `reduce_load_Foo`, and `reduce_load_Foo()` returns `Foo()`. And each ELEMENT (!) of Foo (not Foo itself) also used to have a `__reduce__` method. The default was that the `__reduce__` method returns `reduce_load, (self.parent(), self._reduce())`, and `reduce_load(P, R)` did then return `P(R)`, thus, unpickling the element.\n\nThe issue was that\n1. often the string representation of an element is not valid input to the interface and\n2. several sub-classes of `InterfaceElement` overrode `__reduce__` and `reduce_load`, making absolutely sure that under no circumstances pickling could work (not even when the string representation happened to be suitable for pickling).\n\nThat's what my branch changed (plus some improvements for conversion from InterfaceElement to Sage, which is now used for pickling instead of string representation).",
    "created_at": "2015-07-04T16:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266405",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'>Comment 18:</a>
Dima, what do you mean by "this issue"?

Replying to [@nbruin](#comment%3A17):
> That works because it actually has something implemented:
> 
> ```
> sage: explain_pickle(lisp(1).dumps())
> pg_reduce_load = unpickle_global('sage.interfaces.interface', 'reduce_load')
> pg_reduce_load_Lisp = unpickle_global('sage.interfaces.lisp', 'reduce_load_Lisp')
> pg = unpickle_instantiate(pg_reduce_load_Lisp, ())
> pg_reduce_load(pg, '1')
> ```
> And if you look at `reduce_load_Lisp`, it simply returns `lisp` so the pickle consists of the instructions "execute `lisp(1)`", which indeed reconstructs the object.

Well, this is how it used to work all the time. Each interface "Foo" has a `__reduce__` method that returns `reduce_load_Foo`, and `reduce_load_Foo()` returns `Foo()`. And each ELEMENT (!) of Foo (not Foo itself) also used to have a `__reduce__` method. The default was that the `__reduce__` method returns `reduce_load, (self.parent(), self._reduce())`, and `reduce_load(P, R)` did then return `P(R)`, thus, unpickling the element.

The issue was that
1. often the string representation of an element is not valid input to the interface and
2. several sub-classes of `InterfaceElement` overrode `__reduce__` and `reduce_load`, making absolutely sure that under no circumstances pickling could work (not even when the string representation happened to be suitable for pickling).

That's what my branch changed (plus some improvements for conversion from InterfaceElement to Sage, which is now used for pickling instead of string representation).



---

archive/issue_comments_266406.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f\">123f295</a></td><td><code>Fix doctests</code></td></tr></table>\n",
    "created_at": "2015-07-04T17:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266406",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f">123f295</a></td><td><code>Fix doctests</code></td></tr></table>




---

archive/issue_comments_266407.json:
```json
{
    "body": "Changed commit from **[2445264](https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c)** to **[123f295](https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f)**",
    "created_at": "2015-07-04T17:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266407",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2445264](https://github.com/sagemath/sagetrac-mirror/commit/2445264ab24d28344b7bb850c2bdaef446f1e65c)** to **[123f295](https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f)**



---

archive/issue_comments_266408.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nThere were tests to be fixed. Actually one of the failing tests tried to make sure that the unpickled element is invalid...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f\">123f295</a></td><td><code>Fix doctests</code></td></tr></table>\n",
    "created_at": "2015-07-04T17:21:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266408",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:20'>Comment 20:</a>
There were tests to be fixed. Actually one of the failing tests tried to make sure that the unpickled element is invalid...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f">123f295</a></td><td><code>Fix doctests</code></td></tr></table>




---

archive/issue_comments_266409.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI am just wondering: Should we perhaps get rid of `reduce_load`? After all, an interface is callable, and hence there is no need to have a function that calls the interface when we can do it directly.",
    "created_at": "2015-07-04T18:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266409",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'>Comment 21:</a>
I am just wondering: Should we perhaps get rid of `reduce_load`? After all, an interface is callable, and hence there is no need to have a function that calls the interface when we can do it directly.



---

archive/issue_comments_266410.json:
```json
{
    "body": "Changed commit from **[123f295](https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f)** to **[595df96](https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce)**",
    "created_at": "2015-07-04T18:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266410",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[123f295](https://github.com/sagemath/sagetrac-mirror/commit/123f29504557ae471ac9d55b0c5a6fbad587c30f)** to **[595df96](https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce)**



---

archive/issue_comments_266411.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce\">595df96</a></td><td><code>Remove reduce_load from sage.interfaces.interface</code></td></tr></table>\n",
    "created_at": "2015-07-04T18:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266411",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>Comment 22:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce">595df96</a></td><td><code>Remove reduce_load from sage.interfaces.interface</code></td></tr></table>




---

archive/issue_comments_266412.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196\">d123d33</a></td><td><code>Add one doctest</code></td></tr></table>\n",
    "created_at": "2015-07-05T08:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266412",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196">d123d33</a></td><td><code>Add one doctest</code></td></tr></table>




---

archive/issue_comments_266413.json:
```json
{
    "body": "Changed commit from **[595df96](https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce)** to **[d123d33](https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196)**",
    "created_at": "2015-07-05T08:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266413",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[595df96](https://github.com/sagemath/sagetrac-mirror/commit/595df9606f14cffa7f8131aedb6daeaf1b08c1ce)** to **[d123d33](https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196)**



---

archive/issue_comments_266414.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2015-07-08T22:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266414",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_240844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-08T22:56:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240844"
}
```



---

archive/issue_events_240845.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-08T22:56:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240845"
}
```



---

archive/issue_comments_266415.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nFails on 32-bit linux:\n\n```\nsage -t --long src/sage/interfaces/gp.py\n**********************************************************************\nFile \"src/sage/interfaces/gp.py\", line 878, in sage.interfaces.gp.GpElement._reduce\nFailed example:\n    loads(dumps(E))  # indirect doctest\nExpected:\n    [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]),\n    [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]\nGot:\n    [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([96, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]\n**********************************************************************\nFile \"src/sage/interfaces/gp.py\", line 881, in sage.interfaces.gp.GpElement._reduce\nFailed example:\n    E.sage()\nExpected:\n    [1,\n     2,\n     3,\n     4,\n     5,\n     9,\n     11,\n     29,\n     35,\n     -183,\n     -3429,\n     -10351,\n     6128487/10351,\n     [1],\n     [[128, -1]],\n     [0, 0, 0, 0, 0, 0, 0, 0]]\nGot:\n    [1,\n     2,\n     3,\n     4,\n     5,\n     9,\n     11,\n     29,\n     35,\n     -183,\n     -3429,\n     -10351,\n     6128487/10351,\n     [1],\n     [[96, -1]],\n     [0, 0, 0, 0, 0, 0, 0, 0]]\n**********************************************************************\n1 item had failures:\n   2 of   4 in sage.interfaces.gp.GpElement._reduce\n    [155 tests, 2 failures, 7.53 s]\n```",
    "created_at": "2015-07-09T07:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266415",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'>Comment 25:</a>
Fails on 32-bit linux:

```
sage -t --long src/sage/interfaces/gp.py
**********************************************************************
File "src/sage/interfaces/gp.py", line 878, in sage.interfaces.gp.GpElement._reduce
Failed example:
    loads(dumps(E))  # indirect doctest
Expected:
    [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]),
    [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]
Got:
    [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([96, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]
**********************************************************************
File "src/sage/interfaces/gp.py", line 881, in sage.interfaces.gp.GpElement._reduce
Failed example:
    E.sage()
Expected:
    [1,
     2,
     3,
     4,
     5,
     9,
     11,
     29,
     35,
     -183,
     -3429,
     -10351,
     6128487/10351,
     [1],
     [[128, -1]],
     [0, 0, 0, 0, 0, 0, 0, 0]]
Got:
    [1,
     2,
     3,
     4,
     5,
     9,
     11,
     29,
     35,
     -183,
     -3429,
     -10351,
     6128487/10351,
     [1],
     [[96, -1]],
     [0, 0, 0, 0, 0, 0, 0, 0]]
**********************************************************************
1 item had failures:
   2 of   4 in sage.interfaces.gp.GpElement._reduce
    [155 tests, 2 failures, 7.53 s]
```



---

archive/issue_events_240846.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T07:44:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240846"
}
```



---

archive/issue_events_240847.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T07:44:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240847"
}
```



---

archive/issue_comments_266416.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@vbraun](#comment%3A25):\n> Fails on 32-bit linux:\n\nI did not change the `_sage_()` method for !GPElement, if I recall correctly. Thus, the fact that things changed from yielding `[128, -1]` to `[96, -1]` has been there before. And now I wonder if that's a bug, or if the different answer just tells something about internal gp data structures that depend on the architecture. In the latter case, we should replace `[128, -1]` by `[..., -1]` in the expected answer.",
    "created_at": "2015-07-09T08:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266416",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@vbraun](#comment%3A25):
> Fails on 32-bit linux:

I did not change the `_sage_()` method for !GPElement, if I recall correctly. Thus, the fact that things changed from yielding `[128, -1]` to `[96, -1]` has been there before. And now I wonder if that's a bug, or if the different answer just tells something about internal gp data structures that depend on the architecture. In the latter case, we should replace `[128, -1]` by `[..., -1]` in the expected answer.



---

archive/issue_comments_266417.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI guess it would be better to ask on sage-nt or sage-algebra, since it appears to be about elliptic curves.",
    "created_at": "2015-07-09T09:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266417",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:27'>Comment 27:</a>
I guess it would be better to ask on sage-nt or sage-algebra, since it appears to be about elliptic curves.



---

archive/issue_comments_266418.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nVolker, before I ask sage-nt, can you show me the result of\n\n```\nsage: gp('ellinit([1,2,3,4,5])')\n[1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]\n```\non 32-bit linux?\n\nIf it gives `[..., [Vecsmall([96, -1])], ...]`, then the problem is very likely a different internal representation, and we should just replace `[128, -1]` by `[..., -1]`. If it isn't, and the different answer only occurs upon pickling, then we have a serious problem.",
    "created_at": "2015-07-09T09:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266418",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:28'>Comment 28:</a>
Volker, before I ask sage-nt, can you show me the result of

```
sage: gp('ellinit([1,2,3,4,5])')
[1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]
```
on 32-bit linux?

If it gives `[..., [Vecsmall([96, -1])], ...]`, then the problem is very likely a different internal representation, and we should just replace `[128, -1]` by `[..., -1]`. If it isn't, and the different answer only occurs upon pickling, then we have a serious problem.



---

archive/issue_comments_266419.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nPS: Or even better, we should just replace the test by \n\n```\nsage: E = gp('ellinit([1,2,3,4,5])')\nsage: loads(dumps(E)) == E\nTrue\n```\nI'll commit and push it now.",
    "created_at": "2015-07-09T09:37:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266419",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:29'>Comment 29:</a>
PS: Or even better, we should just replace the test by 

```
sage: E = gp('ellinit([1,2,3,4,5])')
sage: loads(dumps(E)) == E
True
```
I'll commit and push it now.



---

archive/issue_comments_266420.json:
```json
{
    "body": "Changed commit from **[d123d33](https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196)** to **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**",
    "created_at": "2015-07-09T09:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266420",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d123d33](https://github.com/sagemath/sagetrac-mirror/commit/d123d33c89ff4524ecf960d894ea07a1f0e96196)** to **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**



---

archive/issue_comments_266421.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384\">bb63cd2</a></td><td><code>Make a test architecture independent</code></td></tr></table>\n",
    "created_at": "2015-07-09T09:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266421",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384">bb63cd2</a></td><td><code>Make a test architecture independent</code></td></tr></table>




---

archive/issue_events_240848.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-09T09:40:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240848"
}
```



---

archive/issue_events_240849.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2015-07-09T09:40:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240849"
}
```



---

archive/issue_comments_266422.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@simon-king-jena](#comment%3A28):\n> Volker, before I ask sage-nt, can you show me the result of\n> \n> ```\n> sage: gp('ellinit([1,2,3,4,5])')\n> [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]\n> ```\n> on 32-bit linux?\n> \n> If it gives `[..., [Vecsmall([96, -1])], ...]`, then the problem is very likely a different internal representation, and we should just replace `[128, -1]` by `[..., -1]`. If it isn't, and the different answer only occurs upon pickling, then we have a serious problem.\n\nhere you are:\n\n```\nsage: gp('ellinit([1,2,3,4,5])')\n[1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([96, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]\n```\non\n\n```\ndima@arando:~/sage/dev/sage$ uname -a\nLinux arando 3.13.0-40-generic #69-Ubuntu SMP Thu Nov 13 17:56:26 UTC 2014 i686 i686 i686 GNU/Linux\n```\n\nIndeed, you see `[Vecsmall([96, -1])]` there!\n\n(most probably the same machine Volker was referring to).",
    "created_at": "2015-07-09T10:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266422",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@simon-king-jena](#comment%3A28):
> Volker, before I ask sage-nt, can you show me the result of
> 
> ```
> sage: gp('ellinit([1,2,3,4,5])')
> [1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([128, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]
> ```
> on 32-bit linux?
> 
> If it gives `[..., [Vecsmall([96, -1])], ...]`, then the problem is very likely a different internal representation, and we should just replace `[128, -1]` by `[..., -1]`. If it isn't, and the different answer only occurs upon pickling, then we have a serious problem.

here you are:

```
sage: gp('ellinit([1,2,3,4,5])')
[1, 2, 3, 4, 5, 9, 11, 29, 35, -183, -3429, -10351, 6128487/10351, Vecsmall([1]), [Vecsmall([96, -1])], [0, 0, 0, 0, 0, 0, 0, 0]]
```
on

```
dima@arando:~/sage/dev/sage$ uname -a
Linux arando 3.13.0-40-generic #69-Ubuntu SMP Thu Nov 13 17:56:26 UTC 2014 i686 i686 i686 GNU/Linux
```

Indeed, you see `[Vecsmall([96, -1])]` there!

(most probably the same machine Volker was referring to).



---

archive/issue_comments_266423.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@dimpase](#comment%3A32):\n> Indeed, you see `[Vecsmall([96, -1])]` there!\n\nOK. In that case, the string representation is machine dependent, and we have to use a\n\n```\n sage: loads(dumps(E)) == E\n True\n```\ntest (which is cleaner anyway).\n\nThe main point of my test was to show that pickling of the gp interface does not rely on the sage-representation of a gp-element, but on the string representation (whereas by this ticket all other interfaces use the sage-representation when available). So, in the most recent commit, I change the test into\n\n```\n sage: E == gp(E.sage())\n False\n```\nwhich hopefully is the same on 32-bit.\n\nIn other words: Needs review again...",
    "created_at": "2015-07-09T11:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266423",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@dimpase](#comment%3A32):
> Indeed, you see `[Vecsmall([96, -1])]` there!

OK. In that case, the string representation is machine dependent, and we have to use a

```
 sage: loads(dumps(E)) == E
 True
```
test (which is cleaner anyway).

The main point of my test was to show that pickling of the gp interface does not rely on the sage-representation of a gp-element, but on the string representation (whereas by this ticket all other interfaces use the sage-representation when available). So, in the most recent commit, I change the test into

```
 sage: E == gp(E.sage())
 False
```
which hopefully is the same on 32-bit.

In other words: Needs review again...



---

archive/issue_events_240850.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T19:53:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240850"
}
```



---

archive/issue_events_240851.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T19:53:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240851"
}
```



---

archive/issue_comments_266424.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/do_not_save___objects_we_cannot_load__](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/do_not_save___objects_we_cannot_load__)** to **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**",
    "created_at": "2015-07-09T21:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18848#issuecomment-266424",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/do_not_save___objects_we_cannot_load__](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/do_not_save___objects_we_cannot_load__)** to **[bb63cd2](https://github.com/sagemath/sagetrac-mirror/commit/bb63cd205f7150776d04f5e1e7ec02438b8dc384)**



---

archive/issue_events_240852.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-09T21:58:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240852"
}
```



---

archive/issue_events_240853.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "302442078da04fd008fca068b658177baa5b8303",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-07-09T21:58:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18848",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18848#event-240853"
}
```
