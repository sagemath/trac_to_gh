# Issue 18740: Reduce overhead for relative number field elements

archive/issues_018503.json:
```json
{
    "body": "We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.\n\nSummary of changes:\n- new method `NumberFieldElement._pari_polynomial`;\n- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);\n- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;\n- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;\n- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.\n\n\nKeywords: relative number field pari\n\nBranch/Commit: e59e8ec7b0ac671167d7df8acd00631cb1fcdc76\n\nReviewer: Vincent Delecroix\n\nAuthor: Peter Bruin\n\nDependencies: #18727, #18739\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18740\n\n",
    "closed_at": "2015-08-19T01:19:20Z",
    "created_at": "2015-06-19T20:03:49Z",
    "labels": [
        "component: number fields",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Reduce overhead for relative number field elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18740",
    "user": "https://github.com/pjbruin"
}
```
We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.

Summary of changes:
- new method `NumberFieldElement._pari_polynomial`;
- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);
- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;
- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;
- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.


Keywords: relative number field pari

Branch/Commit: e59e8ec7b0ac671167d7df8acd00631cb1fcdc76

Reviewer: Vincent Delecroix

Author: Peter Bruin

Dependencies: #18727, #18739

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18740





---

archive/issue_comments_267681.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-19T20:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267681",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_267682.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-01T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267682",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_267683.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-03T08:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_267684.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_267685.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-03T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267685",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_267686.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267686",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_052470.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-15T16:43:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18740#event-52470"
}
```



---

archive/issue_comments_267687.json:
```json
{
    "body": "<a id='comment:6'></a>Hello Peter,\n\nInstead of\n\n```\nf = pari(self._coefficients()).Polrev()\nreturn f.change_variable_name(name)\n```\nyou can do\n\n```\nreturn pari(self._coefficients()).Polrev(name)\n```\nthat would avoid a copy.\n\nWhy did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\nVincent",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267687",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Hello Peter,

Instead of

```
f = pari(self._coefficients()).Polrev()
return f.change_variable_name(name)
```
you can do

```
return pari(self._coefficients()).Polrev(name)
```
that would avoid a copy.

Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

Vincent



---

archive/issue_comments_267688.json:
```json
{
    "body": "<a id='comment:7'></a>Salut Vincent,\n> Instead of\n> \n> ```\n> f = pari(self._coefficients()).Polrev()\n> return f.change_variable_name(name)\n> ```\n> you can do\n> \n> ```\n> return pari(self._coefficients()).Polrev(name)\n> ```\n> that would avoid a copy.\n\nOK, I will change this.\n\n> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\nThe reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.",
    "created_at": "2015-08-17T10:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267688",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>Salut Vincent,
> Instead of
> 
> ```
> f = pari(self._coefficients()).Polrev()
> return f.change_variable_name(name)
> ```
> you can do
> 
> ```
> return pari(self._coefficients()).Polrev(name)
> ```
> that would avoid a copy.

OK, I will change this.

> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.



---

archive/issue_comments_267689.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T10:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_267690.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-17T10:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267690",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_267691.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267691",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_267692.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 pbruin]:\n> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\n> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.\n\nI agree that your way is better.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267692",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Replying to [comment:7 pbruin]:
> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.

I agree that your way is better.



---

archive/issue_comments_267693.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-19T01:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-267693",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052471.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-19T01:19:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18740#event-52471"
}
```
