# Issue 18740: Reduce overhead for relative number field elements

archive/issues_018503.json:
```json
{
    "body": "We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.\n\nSummary of changes:\n- new method `NumberFieldElement._pari_polynomial`;\n- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);\n- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;\n- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;\n- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.\n\n\nKeywords: relative number field pari\n\nBranch/Commit: [e59e8ec7b0ac671167d7df8acd00631cb1fcdc76](https://github.com/sagemath/sagetrac-mirror/commit/e59e8ec7b0ac671167d7df8acd00631cb1fcdc76)\n\nReviewer: Vincent Delecroix\n\nAuthor: Peter Bruin\n\nDependencies: #18727, #18739\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18740\n\n",
    "closed_at": "2015-08-19T01:19:20Z",
    "created_at": "2015-06-19T20:03:49Z",
    "labels": [
        "component: number fields",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Reduce overhead for relative number field elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18740",
    "user": "https://github.com/pjbruin"
}
```
We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.

Summary of changes:
- new method `NumberFieldElement._pari_polynomial`;
- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);
- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;
- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;
- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.


Keywords: relative number field pari

Branch/Commit: [e59e8ec7b0ac671167d7df8acd00631cb1fcdc76](https://github.com/sagemath/sagetrac-mirror/commit/e59e8ec7b0ac671167d7df8acd00631cb1fcdc76)

Reviewer: Vincent Delecroix

Author: Peter Bruin

Dependencies: #18727, #18739

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18740





---

archive/issue_comments_333880.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-19T20:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333880",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_333881.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/18740-relative_number_fields\"",
    "created_at": "2015-06-19T20:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333881",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/18740-relative_number_fields"



---

archive/issue_comments_333882.json:
```json
{
    "body": "Changing commit from \"\" to \"cddcaafd5aa1d6cdc860a3624ca247283eed985a\"",
    "created_at": "2015-06-19T20:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333882",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "cddcaafd5aa1d6cdc860a3624ca247283eed985a"



---

archive/issue_comments_333883.json:
```json
{
    "body": "Changing work_issues from \"\" to \"method names changed in #18739\"",
    "created_at": "2015-07-01T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333883",
    "user": "https://github.com/pjbruin"
}
```

Changing work_issues from "" to "method names changed in #18739"



---

archive/issue_comments_333884.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-01T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333884",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333885.json:
```json
{
    "body": "Changing commit from \"cddcaafd5aa1d6cdc860a3624ca247283eed985a\" to \"e6dd7a1198fe621fcc3b9c84a20948db2a257307\"",
    "created_at": "2015-07-03T08:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333885",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cddcaafd5aa1d6cdc860a3624ca247283eed985a" to "e6dd7a1198fe621fcc3b9c84a20948db2a257307"



---

archive/issue_comments_333886.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[566770a](https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c)|`Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5`|\n|[88fbd3d](https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00)|`trac #18379 doc typo in pari/gen`|\n|[d27251d](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)|`trac #18739 raise into py3 syntax`|\n|[5373b8e](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)|`Trac 18739: reviewer comments`|\n|[08be591](https://github.com/sagemath/sagetrac-mirror/commit/08be59107d802145e9f29395d0f48e2eee84590f)|`Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields`|\n|[e6dd7a1](https://github.com/sagemath/sagetrac-mirror/commit/e6dd7a1198fe621fcc3b9c84a20948db2a257307)|`Trac 18740: update after renaming of methods in Trac 18739`|",
    "created_at": "2015-07-03T08:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[566770a](https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c)|`Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5`|
|[88fbd3d](https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00)|`trac #18379 doc typo in pari/gen`|
|[d27251d](https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303)|`trac #18739 raise into py3 syntax`|
|[5373b8e](https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d)|`Trac 18739: reviewer comments`|
|[08be591](https://github.com/sagemath/sagetrac-mirror/commit/08be59107d802145e9f29395d0f48e2eee84590f)|`Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields`|
|[e6dd7a1](https://github.com/sagemath/sagetrac-mirror/commit/e6dd7a1198fe621fcc3b9c84a20948db2a257307)|`Trac 18740: update after renaming of methods in Trac 18739`|



---

archive/issue_comments_333887.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|\n|[bf87651](https://github.com/sagemath/sagetrac-mirror/commit/bf87651ae81026fefe9e3c194556c55864f3b1c4)|`Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields`|\n|[c661096](https://github.com/sagemath/sagetrac-mirror/commit/c661096b45e80a7227eba537ae1f7dc9e3836c1d)|`Trac 18740: reduce overhead for relative number field elements`|",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
|[bf87651](https://github.com/sagemath/sagetrac-mirror/commit/bf87651ae81026fefe9e3c194556c55864f3b1c4)|`Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields`|
|[c661096](https://github.com/sagemath/sagetrac-mirror/commit/c661096b45e80a7227eba537ae1f7dc9e3836c1d)|`Trac 18740: reduce overhead for relative number field elements`|



---

archive/issue_comments_333888.json:
```json
{
    "body": "Changing commit from \"e6dd7a1198fe621fcc3b9c84a20948db2a257307\" to \"c661096b45e80a7227eba537ae1f7dc9e3836c1d\"",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e6dd7a1198fe621fcc3b9c84a20948db2a257307" to "c661096b45e80a7227eba537ae1f7dc9e3836c1d"



---

archive/issue_comments_333889.json:
```json
{
    "body": "Changing work_issues from \"method names changed in #18739\" to \"\"",
    "created_at": "2015-07-03T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333889",
    "user": "https://github.com/pjbruin"
}
```

Changing work_issues from "method names changed in #18739" to ""



---

archive/issue_comments_333890.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-03T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333890",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333891.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333891",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_059663.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-15T16:43:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18740#event-59663"
}
```



---

archive/issue_comments_333892.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello Peter,\n\nInstead of\n\n```\nf = pari(self._coefficients()).Polrev()\nreturn f.change_variable_name(name)\n```\nyou can do\n\n```\nreturn pari(self._coefficients()).Polrev(name)\n```\nthat would avoid a copy.\n\nWhy did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\nVincent",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333892",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Hello Peter,

Instead of

```
f = pari(self._coefficients()).Polrev()
return f.change_variable_name(name)
```
you can do

```
return pari(self._coefficients()).Polrev(name)
```
that would avoid a copy.

Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

Vincent



---

archive/issue_comments_333893.json:
```json
{
    "body": "<a id='comment:7'></a>\nSalut Vincent,\n> Instead of\n> \n> ```\n> f = pari(self._coefficients()).Polrev()\n> return f.change_variable_name(name)\n> ```\n> you can do\n> \n> ```\n> return pari(self._coefficients()).Polrev(name)\n> ```\n> that would avoid a copy.\n\nOK, I will change this.\n\n> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\nThe reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.",
    "created_at": "2015-08-17T10:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333893",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
Salut Vincent,
> Instead of
> 
> ```
> f = pari(self._coefficients()).Polrev()
> return f.change_variable_name(name)
> ```
> you can do
> 
> ```
> return pari(self._coefficients()).Polrev(name)
> ```
> that would avoid a copy.

OK, I will change this.

> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.



---

archive/issue_comments_333894.json:
```json
{
    "body": "Changing commit from \"c661096b45e80a7227eba537ae1f7dc9e3836c1d\" to \"e59e8ec7b0ac671167d7df8acd00631cb1fcdc76\"",
    "created_at": "2015-08-17T10:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c661096b45e80a7227eba537ae1f7dc9e3836c1d" to "e59e8ec7b0ac671167d7df8acd00631cb1fcdc76"



---

archive/issue_comments_333895.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[e59e8ec](https://github.com/sagemath/sagetrac-mirror/commit/e59e8ec7b0ac671167d7df8acd00631cb1fcdc76)|`Trac 18740: speed up NumberFieldElement._pari_polynomial()`|",
    "created_at": "2015-08-17T10:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[e59e8ec](https://github.com/sagemath/sagetrac-mirror/commit/e59e8ec7b0ac671167d7df8acd00631cb1fcdc76)|`Trac 18740: speed up NumberFieldElement._pari_polynomial()`|



---

archive/issue_comments_333896.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-17T10:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333896",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333897.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333897",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_333898.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333898",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_333899.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [pbruin](#comment%3A7):\n> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\n> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.\n\nI agree that your way is better.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333899",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
Replying to [pbruin](#comment%3A7):
> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.

I agree that your way is better.



---

archive/issue_comments_333900.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-19T01:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333900",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-19T01:19:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18740#event-59664"
}
```



---

archive/issue_comments_333901.json:
```json
{
    "body": "Changing branch from \"u/pbruin/18740-relative_number_fields\" to \"e59e8ec7b0ac671167d7df8acd00631cb1fcdc76\"",
    "created_at": "2015-08-19T01:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18740#issuecomment-333901",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/18740-relative_number_fields" to "e59e8ec7b0ac671167d7df8acd00631cb1fcdc76"
