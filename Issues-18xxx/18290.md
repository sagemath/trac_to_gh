# Issue 18290: enhanced sets and cartesian products

archive/issues_018053.json:
```json
{
    "body": "CC:  @nathanncohen @nthiery\n\nKeywords: cartesian_product\n\nWe implement several missing features of sets, enumerated sets and their cartesian products.\n\nWe add methods `is_empty` and `is_finite` to all sets.\n\nWe implement most of the methods for cartesian products of sets and enumerated sets (cardinality, rank/unrank, iteration).\n\nFor example, all commands below were hanging\n\n```\nsage: C = cartesian_product([Permutations(7), Permutations(9)])\nsage: C.cardinality()\n1828915200\nsage: C.unrank(143872745)\n([1, 5, 3, 6, 2, 4, 7], [5, 3, 2, 4, 7, 8, 9, 6, 1])\nsage: C.rank(_)\n143872745\nsage: C.random_element()   # random\n([4, 2, 6, 7, 1, 3, 5], [4, 7, 2, 8, 6, 3, 9, 5, 1])\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/18290\n\n",
    "closed_at": "2015-05-13T20:11:33Z",
    "created_at": "2015-04-23T14:59:28Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "enhanced sets and cartesian products",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18290",
    "user": "https://github.com/videlec"
}
```
CC:  @nathanncohen @nthiery

Keywords: cartesian_product

We implement several missing features of sets, enumerated sets and their cartesian products.

We add methods `is_empty` and `is_finite` to all sets.

We implement most of the methods for cartesian products of sets and enumerated sets (cardinality, rank/unrank, iteration).

For example, all commands below were hanging

```
sage: C = cartesian_product([Permutations(7), Permutations(9)])
sage: C.cardinality()
1828915200
sage: C.unrank(143872745)
([1, 5, 3, 6, 2, 4, 7], [5, 3, 2, 4, 7, 8, 9, 6, 1])
sage: C.rank(_)
143872745
sage: C.random_element()   # random
([4, 2, 6, 7, 1, 3, 5], [4, 7, 2, 8, 6, 3, 9, 5, 1])
```

Issue created by migration from https://trac.sagemath.org/ticket/18290





---

archive/issue_comments_242815.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-23T15:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242815",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_242816.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-23T15:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242816",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_242817.json:
```json
{
    "body": "Changing keywords from \"\" to \"cartesian_product\".",
    "created_at": "2015-04-23T15:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242817",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "cartesian_product".



---

archive/issue_comments_242818.json:
```json
{
    "body": "HMmmmmmmm `O_o`\n\nI don't know enough about this code to be helpful, but computing the cardinality of those sets seems to be too much. Isn't there a 'is_empty' functio in those classes that you could use instead? And you probably should call `is_empty` before the `is_finite`. Deciding emptyness is probably easier than deciding if it is finite?... Or perhaps not, in some weird cases? `^^;;`",
    "created_at": "2015-04-23T15:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242818",
    "user": "https://github.com/nathanncohen"
}
```

HMmmmmmmm `O_o`

I don't know enough about this code to be helpful, but computing the cardinality of those sets seems to be too much. Isn't there a 'is_empty' functio in those classes that you could use instead? And you probably should call `is_empty` before the `is_finite`. Deciding emptyness is probably easier than deciding if it is finite?... Or perhaps not, in some weird cases? `^^;;`



---

archive/issue_comments_242819.json:
```json
{
    "body": "Okayokay, it seems that there is no `is_empty` method. You ignore my comment above `^^;`",
    "created_at": "2015-04-23T15:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242819",
    "user": "https://github.com/nathanncohen"
}
```

Okayokay, it seems that there is no `is_empty` method. You ignore my comment above `^^;`



---

archive/issue_comments_242820.json:
```json
{
    "body": "Replying to [comment:3 ncohen]:\n> HMmmmmmmm `O_o`\n> \n> I don't know enough about this code to be helpful, but computing the cardinality of those sets seems to be too much. Isn't there a 'is_empty' functio in those classes that you could use instead? And you probably should call `is_empty` before the `is_finite`. Deciding emptyness is probably easier than deciding if it is finite?... Or perhaps not, in some weird cases? `^^;;`\n\n\nI would love to have an `is_empty`... What do you think to add it in the sets category (and set the default implementation to be `return not self.cardinality()`?). The code in this branch would be much cleaner with that.",
    "created_at": "2015-04-23T15:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242820",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:3 ncohen]:
> HMmmmmmmm `O_o`
> 
> I don't know enough about this code to be helpful, but computing the cardinality of those sets seems to be too much. Isn't there a 'is_empty' functio in those classes that you could use instead? And you probably should call `is_empty` before the `is_finite`. Deciding emptyness is probably easier than deciding if it is finite?... Or perhaps not, in some weird cases? `^^;;`


I would love to have an `is_empty`... What do you think to add it in the sets category (and set the default implementation to be `return not self.cardinality()`?). The code in this branch would be much cleaner with that.



---

archive/issue_comments_242821.json:
```json
{
    "body": "> I would love to have an `is_empty`... What do you think to add it in the sets category (and set the default implementation to be `return not self.cardinality()`?). The code in this branch would be much cleaner with that.\n\n\nI'd say that it would be good, but I do not think that I should be patching category codes given my next-to-zero understanding of how it works.",
    "created_at": "2015-04-23T16:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242821",
    "user": "https://github.com/nathanncohen"
}
```

> I would love to have an `is_empty`... What do you think to add it in the sets category (and set the default implementation to be `return not self.cardinality()`?). The code in this branch would be much cleaner with that.


I'd say that it would be good, but I do not think that I should be patching category codes given my next-to-zero understanding of how it works.



---

archive/issue_comments_242822.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-23T18:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242822",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_242823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-23T22:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_242824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-23T23:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_242825.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-23T23:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242825",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_242826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-23T23:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-24T00:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242828.json:
```json
{
    "body": "Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. \"Return the cardinality of self.\" should be \"of this set\" or \"of this cartesian product\".\n\nCode seems to work. Just to make sure: should `cartesian_product([ZZ, ZZ]).unrank(42)` work like for example `ZZ.unrank(42)` works?",
    "created_at": "2015-04-24T06:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242828",
    "user": "https://github.com/jm58660"
}
```

Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. "Return the cardinality of self." should be "of this set" or "of this cartesian product".

Code seems to work. Just to make sure: should `cartesian_product([ZZ, ZZ]).unrank(42)` work like for example `ZZ.unrank(42)` works?



---

archive/issue_comments_242829.json:
```json
{
    "body": "Replying to [comment:15 jmantysalo]:\n> Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. \"Return the cardinality of self.\" should be \"of this set\" or \"of this cartesian product\".\n\n\nI can do that.\n \n> Code seems to work. Just to make sure: should `cartesian_product([ZZ, ZZ]).unrank(42)` work like for example `ZZ.unrank(42)` works?\n\n\nNo. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!",
    "created_at": "2015-04-24T08:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242829",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:15 jmantysalo]:
> Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. "Return the cardinality of self." should be "of this set" or "of this cartesian product".


I can do that.
 
> Code seems to work. Just to make sure: should `cartesian_product([ZZ, ZZ]).unrank(42)` work like for example `ZZ.unrank(42)` works?


No. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!



---

archive/issue_comments_242830.json:
```json
{
    "body": "Replying to [comment:15 jmantysalo]:\n> Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. \"Return the cardinality of self.\" should be \"of this set\" or \"of this cartesian product\".\n\n\nMy understanding of the discussion was that ``self`` should not be listed in the INPUT section (I actually need to argue further in the thread for I don't necessarily agree). I don't remember it being a problem elsewhere in the docstring. But I need to reread the thread.\n\nThat being said, \"of this cartesian product\" is a bit redundant but it reads nicely to remind the user of the context. So this can be a good idea here.\n\nCheers,\n                                        Nicolas",
    "created_at": "2015-04-24T08:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242830",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:15 jmantysalo]:
> Wasn't there just discussion about avoiding `self` in docstrings at sage-devel? I.e. "Return the cardinality of self." should be "of this set" or "of this cartesian product".


My understanding of the discussion was that ``self`` should not be listed in the INPUT section (I actually need to argue further in the thread for I don't necessarily agree). I don't remember it being a problem elsewhere in the docstring. But I need to reread the thread.

That being said, "of this cartesian product" is a bit redundant but it reads nicely to remind the user of the context. So this can be a good idea here.

Cheers,
                                        Nicolas



---

archive/issue_comments_242831.json:
```json
{
    "body": "Replying to [comment:16 vdelecroix]:\n\n> No. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!\n\n\nOK. And after the patch at least `for x in cartesian_product([ZZ,ZZ])` gives an error.",
    "created_at": "2015-04-24T09:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242831",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:16 vdelecroix]:

> No. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!


OK. And after the patch at least `for x in cartesian_product([ZZ,ZZ])` gives an error.



---

archive/issue_comments_242832.json:
```json
{
    "body": "Replying to [comment:18 jmantysalo]:\n> Replying to [comment:16 vdelecroix]:\n> \n> > No. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!\n  \n> \n> OK. And after the patch at least `for x in cartesian_product([ZZ,ZZ])` gives an error.\n\n\nI will add it to the doc with a comment.\n\nThough, for infinite sets, we can choose an other order for the enumeration. If so, we can put back this method and implement rank/unrank.",
    "created_at": "2015-04-24T09:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242832",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:18 jmantysalo]:
> Replying to [comment:16 vdelecroix]:
> 
> > No. The order of enumeration of a cartesian products is lexicographic. So a cartesian product of infinite enumerated sets should even **not** be an enumerated set!
  
> 
> OK. And after the patch at least `for x in cartesian_product([ZZ,ZZ])` gives an error.


I will add it to the doc with a comment.

Though, for infinite sets, we can choose an other order for the enumeration. If so, we can put back this method and implement rank/unrank.



---

archive/issue_comments_242833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-24T09:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-24T16:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-03T19:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_242836.json:
```json
{
    "body": "Rebased on sage-6.7.beta3\n\nVincent",
    "created_at": "2015-05-03T19:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242836",
    "user": "https://github.com/videlec"
}
```

Rebased on sage-6.7.beta3

Vincent



---

archive/issue_comments_242837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-11T11:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_242838.json:
```json
{
    "body": "Rebased on sage-6.7.beta4 + docstring for the overriden functions in cartesian products of finite enumerated sets.",
    "created_at": "2015-05-11T11:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242838",
    "user": "https://github.com/videlec"
}
```

Rebased on sage-6.7.beta4 + docstring for the overriden functions in cartesian products of finite enumerated sets.



---

archive/issue_comments_242839.json:
```json
{
    "body": "If I do\n\n```\nclass A:\n    f = B.f.im_func\n    \"\"\"\n    Some doctests\n\n    TESTS::\n\n       sage: 1+1\n       2\n    \"\"\"\n```\nthis is not considered as a doctest. But if instead I do\n\n```\nclass A:\n    my_string = (\n        r\"\"\"\n        TESTS::\n\n            sage: print \"Is this a test?\"\n            Of course not\n        \"\"\"\n    )\n```\nthen it is considered as a doctest!!\n\nThe algorithm used to detect doctests is clearly wrong!\n\nVincent",
    "created_at": "2015-05-11T12:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242839",
    "user": "https://github.com/videlec"
}
```

If I do

```
class A:
    f = B.f.im_func
    """
    Some doctests

    TESTS::

       sage: 1+1
       2
    """
```
this is not considered as a doctest. But if instead I do

```
class A:
    my_string = (
        r"""
        TESTS::

            sage: print "Is this a test?"
            Of course not
        """
    )
```
then it is considered as a doctest!!

The algorithm used to detect doctests is clearly wrong!

Vincent



---

archive/issue_comments_242840.json:
```json
{
    "body": "What should I do for the sake of that ticket?",
    "created_at": "2015-05-11T12:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242840",
    "user": "https://github.com/videlec"
}
```

What should I do for the sake of that ticket?



---

archive/issue_comments_242841.json:
```json
{
    "body": "Hire an engineer.",
    "created_at": "2015-05-11T12:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242841",
    "user": "https://github.com/nathanncohen"
}
```

Hire an engineer.



---

archive/issue_comments_242842.json:
```json
{
    "body": "```\n  - EnumeratedSets.CartesianProducts.ParentMethods.__iter__\n    - Description of the iterator\n    - Use is_finite or in Sets.Finite? Or put the thing in CartesianProducts.Finite?\n  - unrank: ValueError or IndexError?\n  - Magmas.FinitelyGenerated.Unital.ParentMethods.is_empty:\n    could be an assignment for consistency?\n  - Groups.CartesianProducts.order:\n    could be an assignment for consistency?\n  - Sets.ParentMethods.random_element: use an abstract method + real doc\n  - random_element & friends: do we want to make a tuple before passing\n    the data to cartesian_product_of_elements?\n```\n\n---\nNew commits:",
    "created_at": "2015-05-12T16:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242842",
    "user": "https://github.com/nthiery"
}
```

```
  - EnumeratedSets.CartesianProducts.ParentMethods.__iter__
    - Description of the iterator
    - Use is_finite or in Sets.Finite? Or put the thing in CartesianProducts.Finite?
  - unrank: ValueError or IndexError?
  - Magmas.FinitelyGenerated.Unital.ParentMethods.is_empty:
    could be an assignment for consistency?
  - Groups.CartesianProducts.order:
    could be an assignment for consistency?
  - Sets.ParentMethods.random_element: use an abstract method + real doc
  - random_element & friends: do we want to make a tuple before passing
    the data to cartesian_product_of_elements?
```

---
New commits:



---

archive/issue_comments_242843.json:
```json
{
    "body": "As we discussed on the phone with Nicolas: I removed the abstract methods: `is_empty`, `is_finite` and `random_element` from `Sets`. For the first two, we might not want to call `cardinality` as this can easily lead to loop (e.g. #18400). As a rationale: a less specialized method should not try to call a more specialized one. For random_element: adding an optional abstract method would pollute the namespace.\n\n- unrank: `IndexError` is what is uniformly in `categories/*` and also in `combinat/cartesian_product`.\n- I moved is_empty from `Magmas.FinitelyGenerated.Unital.ParentMethods.is_empty` to `Magmas.Unital.is_empty` and everything looks fine\n- random_element: tuple removed\n\nI will add a second commit for `order` vs `cardinality` in `Groups`.\n\nVincent\n\n---\nNew commits:",
    "created_at": "2015-05-12T21:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242843",
    "user": "https://github.com/videlec"
}
```

As we discussed on the phone with Nicolas: I removed the abstract methods: `is_empty`, `is_finite` and `random_element` from `Sets`. For the first two, we might not want to call `cardinality` as this can easily lead to loop (e.g. #18400). As a rationale: a less specialized method should not try to call a more specialized one. For random_element: adding an optional abstract method would pollute the namespace.

- unrank: `IndexError` is what is uniformly in `categories/*` and also in `combinat/cartesian_product`.
- I moved is_empty from `Magmas.FinitelyGenerated.Unital.ParentMethods.is_empty` to `Magmas.Unital.is_empty` and everything looks fine
- random_element: tuple removed

I will add a second commit for `order` vs `cardinality` in `Groups`.

Vincent

---
New commits:



---

archive/issue_comments_242844.json:
```json
{
    "body": "Hello,\n\nFor `cardinality` vs `order` here is the list of files I had to change:\n\n- algebras/quatalg/quaternion_algebra.py\n- algebras/steenrod/steenrod_algebra.py\n- groups/abelian_gps/abelian_group.py\n- groups/abelian_gps/dual_abelian_group.py\n- groups/additive_abelian/additive_abelian_group.py\n- groups/group.pyx\n- groups/indexed_free_group.py\n- groups/matrix_gps/coxeter_group.py\n- groups/old.pyx\n- groups/pari_group.py\n- groups/perm_gps/permgroup.py\n- groups/semimonomial_transformations/semimonomial_transformation_group.py\n- libs/coxeter3/coxeter.pyx\n- modular/abvar/finite_subgroup.py\n- modular/abvar/torsion_subgroup.py\n- modular/arithgroup/arithgroup_generic.py\n- modular/dirichlet.py\n- rings/contfrac.py\n- rings/finite_rings/finite_field_base.pyx\n- rings/finite_rings/finite_field_ext_pari.py\n- rings/finite_rings/finite_field_givaro.py\n- rings/finite_rings/finite_field_ntl_gf2e.py\n- rings/finite_rings/finite_field_prime_modn.py\n- rings/finite_rings/homset.py\n- rings/finite_rings/integer_mod_ring.py\n- rings/integer_ring.pyx\n- rings/number_field/galois_group.py\n- rings/number_field/morphism.py\n- rings/number_field/number_field.py\n- rings/polynomial/infinite_polynomial_ring.py\n- rings/polynomial/polynomial_quotient_ring.py\n- rings/qqbar.py\n- rings/rational_field.py\n- rings/ring.pyx\n\nIn particular it concerns not only groups but:\n- (multiplicative) groups\n- additive (Abelian) groups\n- rings\n\nAt least Sage is able to start but I am not sure it fits exactly the purpose of the ticket. If you do not mind I will push that commit in #18410.\n\nVincent",
    "created_at": "2015-05-12T22:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242844",
    "user": "https://github.com/videlec"
}
```

Hello,

For `cardinality` vs `order` here is the list of files I had to change:

- algebras/quatalg/quaternion_algebra.py
- algebras/steenrod/steenrod_algebra.py
- groups/abelian_gps/abelian_group.py
- groups/abelian_gps/dual_abelian_group.py
- groups/additive_abelian/additive_abelian_group.py
- groups/group.pyx
- groups/indexed_free_group.py
- groups/matrix_gps/coxeter_group.py
- groups/old.pyx
- groups/pari_group.py
- groups/perm_gps/permgroup.py
- groups/semimonomial_transformations/semimonomial_transformation_group.py
- libs/coxeter3/coxeter.pyx
- modular/abvar/finite_subgroup.py
- modular/abvar/torsion_subgroup.py
- modular/arithgroup/arithgroup_generic.py
- modular/dirichlet.py
- rings/contfrac.py
- rings/finite_rings/finite_field_base.pyx
- rings/finite_rings/finite_field_ext_pari.py
- rings/finite_rings/finite_field_givaro.py
- rings/finite_rings/finite_field_ntl_gf2e.py
- rings/finite_rings/finite_field_prime_modn.py
- rings/finite_rings/homset.py
- rings/finite_rings/integer_mod_ring.py
- rings/integer_ring.pyx
- rings/number_field/galois_group.py
- rings/number_field/morphism.py
- rings/number_field/number_field.py
- rings/polynomial/infinite_polynomial_ring.py
- rings/polynomial/polynomial_quotient_ring.py
- rings/qqbar.py
- rings/rational_field.py
- rings/ring.pyx

In particular it concerns not only groups but:
- (multiplicative) groups
- additive (Abelian) groups
- rings

At least Sage is able to start but I am not sure it fits exactly the purpose of the ticket. If you do not mind I will push that commit in #18410.

Vincent



---

archive/issue_comments_242845.json:
```json
{
    "body": "Replying to [comment:32 vdelecroix]:\n> For `cardinality` vs `order` here is the list of files I had to change:\n> ...\n\n\nThanks!\n\n> At least Sage is able to start but I am not sure it fits exactly the purpose of the ticket. If you do not mind I will push that commit in #18410.\n\n\n+1",
    "created_at": "2015-05-13T05:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242845",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:32 vdelecroix]:
> For `cardinality` vs `order` here is the list of files I had to change:
> ...


Thanks!

> At least Sage is able to start but I am not sure it fits exactly the purpose of the ticket. If you do not mind I will push that commit in #18410.


+1



---

archive/issue_comments_242846.json:
```json
{
    "body": "> As a rationale: a less specialized method should not try to call a more specialized one. \n\n\nAre the 'new rationales' just made up when we need them, or should we stop having `.cardinality()` call `__iter__`, as it is exactly the same pattern?\n\nNathann",
    "created_at": "2015-05-13T06:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242846",
    "user": "https://github.com/nathanncohen"
}
```

> As a rationale: a less specialized method should not try to call a more specialized one. 


Are the 'new rationales' just made up when we need them, or should we stop having `.cardinality()` call `__iter__`, as it is exactly the same pattern?

Nathann



---

archive/issue_comments_242847.json:
```json
{
    "body": "Replying to [comment:34 ncohen]:\n> > As a rationale: a less specialized method should not try to call a more specialized one. \n\n> \n> Are the 'new rationales' just made up when we need them, or should we stop having `.cardinality()` call `__iter__`, as it is exactly the same pattern?\n\n\n;-) I agree with Nathann that it is perhaps not the best default. Though, let us keep it independent of this ticket. My motivation for the rationale was to avoid loops like\n\n- is_finite asks cardinality\n- cardinality asks is_finite before starting to iterate\n\n(which is exactly the problem with projective scheme).\n\nOn the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.\n\nVincent",
    "created_at": "2015-05-13T06:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242847",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:34 ncohen]:
> > As a rationale: a less specialized method should not try to call a more specialized one. 

> 
> Are the 'new rationales' just made up when we need them, or should we stop having `.cardinality()` call `__iter__`, as it is exactly the same pattern?


;-) I agree with Nathann that it is perhaps not the best default. Though, let us keep it independent of this ticket. My motivation for the rationale was to avoid loops like

- is_finite asks cardinality
- cardinality asks is_finite before starting to iterate

(which is exactly the problem with projective scheme).

On the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.

Vincent



---

archive/issue_comments_242848.json:
```json
{
    "body": "> On the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.\n\n\nThe same goes for `is_empty`. Sometimes all you can do is run the enumeration.\n\nNathann",
    "created_at": "2015-05-13T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242848",
    "user": "https://github.com/nathanncohen"
}
```

> On the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.


The same goes for `is_empty`. Sometimes all you can do is run the enumeration.

Nathann



---

archive/issue_comments_242849.json:
```json
{
    "body": "Replying to [comment:36 ncohen]:\n> > On the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.\n\n> \n> The same goes for `is_empty`. Sometimes all you can do is run the enumeration.\n\n\nThis is exactly what I did:\n\n```\nclass EnumeratedSets:\n    class ParentMethods:\n        def is_empty(self):\n            try:\n                iter(self).next()\n            except StopIteration:\n                return False\n            else:\n                return True\n```",
    "created_at": "2015-05-13T06:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242849",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:36 ncohen]:
> > On the other hand, there is sometimes nothing else to do than going through the list of elements to get the cardinality. And you know it: `sage.graphs.independent_sets.IndependentSets`.

> 
> The same goes for `is_empty`. Sometimes all you can do is run the enumeration.


This is exactly what I did:

```
class EnumeratedSets:
    class ParentMethods:
        def is_empty(self):
            try:
                iter(self).next()
            except StopIteration:
                return False
            else:
                return True
```



---

archive/issue_comments_242850.json:
```json
{
    "body": "In your earlier comment you explicitly said that you had removed the methods.",
    "created_at": "2015-05-13T06:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242850",
    "user": "https://github.com/nathanncohen"
}
```

In your earlier comment you explicitly said that you had removed the methods.



---

archive/issue_comments_242851.json:
```json
{
    "body": "Isn't a semigroup a magma too ? `O_o`",
    "created_at": "2015-05-13T07:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242851",
    "user": "https://github.com/nathanncohen"
}
```

Isn't a semigroup a magma too ? `O_o`



---

archive/issue_comments_242852.json:
```json
{
    "body": "Replying to [comment:38 ncohen]:\n> In your earlier comment you explicitly said that you had removed the methods.\n\n\nI removed it at the level of `Sets` where the implementation was `return self.cardinality() == 0`. Not at the level of enumerated sets. So most parents will have a `is_empty`.",
    "created_at": "2015-05-13T07:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242852",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:38 ncohen]:
> In your earlier comment you explicitly said that you had removed the methods.


I removed it at the level of `Sets` where the implementation was `return self.cardinality() == 0`. Not at the level of enumerated sets. So most parents will have a `is_empty`.



---

archive/issue_comments_242853.json:
```json
{
    "body": "Replying to [comment:39 ncohen]:\n> Isn't a semigroup a magma too ? `O_o`\n\n\nIt is!\n\n```\nsage: Semigroups().super_categories()\n[Category of magmas]\n```\nDid you found something strange?",
    "created_at": "2015-05-13T07:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242853",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:39 ncohen]:
> Isn't a semigroup a magma too ? `O_o`


It is!

```
sage: Semigroups().super_categories()
[Category of magmas]
```
Did you found something strange?



---

archive/issue_comments_242854.json:
```json
{
    "body": "I thought for a second that you had defined `is_empty` simultaneously for magmas and semigroups, but apparently I was wrong.",
    "created_at": "2015-05-13T07:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242854",
    "user": "https://github.com/nathanncohen"
}
```

I thought for a second that you had defined `is_empty` simultaneously for magmas and semigroups, but apparently I was wrong.



---

archive/issue_comments_242855.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-13T07:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242856.json:
```json
{
    "body": "I have been through Vincent's last commit. I pushed too minor fixes. I have only a couple points I am wondering about:\n\n- Do we want to import ZZ in sage.sets.cartesian_product? Can we do a local import or lazy import? Or is it just ok?\n\n- In `CartesianProduct._cartesian_product_of_elements`, it would be semantically equivalent to use `zip` rather than `iterator.izip` since we anyway build a tuple right after. Just curious, is one faster than the other in practice (it's a tradeoff between building a list for nothing and using another layer of iterators)?\n\n- Please update the documentation of `Sets.CartesianProducts.ParentMethods._cartesian_product_of_elements` to specify that it should accept any iterable.\n\n- _sets_keys(): do we really want an `IntegerRange` rather than a `range`? I would imagine `IntegerRange` could be faster for containment testing and slower for iteration, so again a tradeoff.\n\nIn any cases, I'll be busy all day and don't have a strong opinion on either of the above points. So please make the choice you feel right. And then I consider this as good to go.\n\nThanks Vincent for all the work!",
    "created_at": "2015-05-13T07:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242856",
    "user": "https://github.com/nthiery"
}
```

I have been through Vincent's last commit. I pushed too minor fixes. I have only a couple points I am wondering about:

- Do we want to import ZZ in sage.sets.cartesian_product? Can we do a local import or lazy import? Or is it just ok?

- In `CartesianProduct._cartesian_product_of_elements`, it would be semantically equivalent to use `zip` rather than `iterator.izip` since we anyway build a tuple right after. Just curious, is one faster than the other in practice (it's a tradeoff between building a list for nothing and using another layer of iterators)?

- Please update the documentation of `Sets.CartesianProducts.ParentMethods._cartesian_product_of_elements` to specify that it should accept any iterable.

- _sets_keys(): do we really want an `IntegerRange` rather than a `range`? I would imagine `IntegerRange` could be faster for containment testing and slower for iteration, so again a tradeoff.

In any cases, I'll be busy all day and don't have a strong opinion on either of the above points. So please make the choice you feel right. And then I consider this as good to go.

Thanks Vincent for all the work!



---

archive/issue_comments_242857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-13T08:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242858.json:
```json
{
    "body": "Replying to [comment:44 nthiery]:\n> I have been through Vincent's last commit. I pushed too minor fixes. I have only a couple points I am wondering about:\n> \n> - Do we want to import ZZ in sage.sets.cartesian_product? Can we do a local import or lazy import? Or is it just ok?\n\n\nI think this is fine. I would find it strange to import it in `sage.categories.*` but `sage.sets.cartesian_product` is lazily imported.\n\n> - In `CartesianProduct._cartesian_product_of_elements`, it would be semantically equivalent to use `zip` rather than `iterator.izip` since we anyway build a tuple right after. Just curious, is one faster than the other in practice (it's a tradeoff between building a list for nothing and using another layer of iterators)?\n\n\nHere you are not building the list from the pairs `(c,x)` but by calling `c(x)`. So I guess that `izip` is always better. From the timing it is very similar and `izip` gets much better as the size of the lists increase. (moreover in `Python 3` the `izip` is just deleted and `zip` becomes `izip`).\n\n> - Please update the documentation of `Sets.CartesianProducts.ParentMethods._cartesian_product_of_elements` to specify that it should accept any iterable.\n\n\ndone.\n\n> - _sets_keys(): do we really want an `IntegerRange` rather than a `range`? I would imagine `IntegerRange` could be faster for containment testing and slower for iteration, so again a tradeoff.\n\n\nIt is **much** faster for containment test and it is currently the only way it is used in `sage.sets.cartesian_product` (the method `cartesian_projection`). If the iteration is slower, then we should just make it faster in `IntegerRange`!\n\n>  In any cases, I'll be busy all day and don't have a strong opinion on either of the above points. So please make the choice you feel right. And then I consider this as good to go.\n\n\nI am running the long tests and will set positive review if everything is fine.\n\nVincent",
    "created_at": "2015-05-13T08:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242858",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:44 nthiery]:
> I have been through Vincent's last commit. I pushed too minor fixes. I have only a couple points I am wondering about:
> 
> - Do we want to import ZZ in sage.sets.cartesian_product? Can we do a local import or lazy import? Or is it just ok?


I think this is fine. I would find it strange to import it in `sage.categories.*` but `sage.sets.cartesian_product` is lazily imported.

> - In `CartesianProduct._cartesian_product_of_elements`, it would be semantically equivalent to use `zip` rather than `iterator.izip` since we anyway build a tuple right after. Just curious, is one faster than the other in practice (it's a tradeoff between building a list for nothing and using another layer of iterators)?


Here you are not building the list from the pairs `(c,x)` but by calling `c(x)`. So I guess that `izip` is always better. From the timing it is very similar and `izip` gets much better as the size of the lists increase. (moreover in `Python 3` the `izip` is just deleted and `zip` becomes `izip`).

> - Please update the documentation of `Sets.CartesianProducts.ParentMethods._cartesian_product_of_elements` to specify that it should accept any iterable.


done.

> - _sets_keys(): do we really want an `IntegerRange` rather than a `range`? I would imagine `IntegerRange` could be faster for containment testing and slower for iteration, so again a tradeoff.


It is **much** faster for containment test and it is currently the only way it is used in `sage.sets.cartesian_product` (the method `cartesian_projection`). If the iteration is slower, then we should just make it faster in `IntegerRange`!

>  In any cases, I'll be busy all day and don't have a strong opinion on either of the above points. So please make the choice you feel right. And then I consider this as good to go.


I am running the long tests and will set positive review if everything is fine.

Vincent



---

archive/issue_comments_242859.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-13T09:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242860.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-13T09:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_242861.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-13T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242861",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_051625.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-13T20:11:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18290#event-51625"
}
```



---

archive/issue_comments_242862.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-13T20:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18290#issuecomment-242862",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
