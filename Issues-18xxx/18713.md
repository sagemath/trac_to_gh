# Issue 18713: Allow almost any callable in matrix constructor

archive/issues_018476.json:
```json
{
    "body": "From http://ask.sagemath.org/question/27111/why-can-matrix-not-use-cached-functions/\n\n```\nsage: @cached_function\n....: def L(n,k):\n....:         if n==k: return 1\n....:         if k<0 or k>n: return 0\n....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)\n....: \nsage: matrix(ZZ, 8, L)\n...\nValueError: Invalid matrix constructor.  Type matrix? for help\n```\n\n**Branch:** [u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)\n\n**Commit:** [a4340fbaa9a70fed68fca6323c2a03f4617995e4](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/18713\n\n",
    "created_at": "2015-06-16T14:28:25Z",
    "labels": [
        "component: linear algebra",
        "bug",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Allow almost any callable in matrix constructor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18713",
    "user": "https://github.com/rwst"
}
```
From http://ask.sagemath.org/question/27111/why-can-matrix-not-use-cached-functions/

```
sage: @cached_function
....: def L(n,k):
....:         if n==k: return 1
....:         if k<0 or k>n: return 0
....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)
....: 
sage: matrix(ZZ, 8, L)
...
ValueError: Invalid matrix constructor.  Type matrix? for help
```

**Branch:** [u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)

**Commit:** [a4340fbaa9a70fed68fca6323c2a03f4617995e4](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)

**Reviewer:** Travis Scrimshaw

**Author:** Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/18713





---

archive/issue_comments_263409.json:
```json
{
    "body": "**Branch:** [u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)",
    "created_at": "2015-06-16T14:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263409",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)



---

archive/issue_comments_263410.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2015-06-16T14:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263410",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_events_168255.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:45:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168255"
}
```



---

archive/issue_comments_263411.json:
```json
{
    "body": "**Commit:** [34d5502150d2a5174984a277a165420f22cf7b7d](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)",
    "created_at": "2015-06-16T14:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263411",
    "user": "https://github.com/rwst"
}
```

**Commit:** [34d5502150d2a5174984a277a165420f22cf7b7d](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)



---

archive/issue_comments_263412.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d\">34d5502</a></td><td><code>18713: cannot feed cached function to Matrix</code></td></tr></table>\n",
    "created_at": "2015-06-16T14:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263412",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d">34d5502</a></td><td><code>18713: cannot feed cached function to Matrix</code></td></tr></table>




---

archive/issue_comments_263413.json:
```json
{
    "body": "<a id='comment:3'></a>\nTrivial doctest failure (via the patchbot):\n\n```\nFile \"src/sage/misc/sageinspect.py\", line 1959, in sage.misc.sageinspect.sage_getsourcelines\nFailed example:\n    sage_getsourcelines(matrix)[1]\nExpected:\n    732\nGot:\n    745\n```\nOnce fixed, you can set a positive review on my behalf.",
    "created_at": "2015-06-16T16:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263413",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Trivial doctest failure (via the patchbot):

```
File "src/sage/misc/sageinspect.py", line 1959, in sage.misc.sageinspect.sage_getsourcelines
Failed example:
    sage_getsourcelines(matrix)[1]
Expected:
    732
Got:
    745
```
Once fixed, you can set a positive review on my behalf.



---

archive/issue_comments_263414.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2015-06-16T16:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263414",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_263415.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?\n\nI don't think so, actually. The comment itself says \"callable\" and then the check is for particular types, rather than checking if the thing is callable.\n\nI would say:\n- restructure, giving preference to checking the passed in argument being iterable. Possibly special-case some iterables like lists and tuples for efficiency if necessary (and if that makes a difference -- I doubt it.\n- check for a callable *later*. You can check using `callable(...)`.\n\nI don't know what we should do with objects that are both iterable and callable. I suspect that giving preference to their iterable behaviour will be best.",
    "created_at": "2015-06-16T16:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263415",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>
The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?

I don't think so, actually. The comment itself says "callable" and then the check is for particular types, rather than checking if the thing is callable.

I would say:
- restructure, giving preference to checking the passed in argument being iterable. Possibly special-case some iterables like lists and tuples for efficiency if necessary (and if that makes a difference -- I doubt it.
- check for a callable *later*. You can check using `callable(...)`.

I don't know what we should do with objects that are both iterable and callable. I suspect that giving preference to their iterable behaviour will be best.



---

archive/issue_comments_263416.json:
```json
{
    "body": "<a id='comment:5'></a>\nSmall detail: do not use\n\n```\n# :trac:`10158`\n```\nin code.\n\nAlso, instead of\n\n```\n    sage: @cached_function # :trac:`18713`\n```\nyou could write\n\n```\nCheck that the matrix constructor works with any callable input (see :trac:`18713`)::\n\n    sage: @cached_function\n```",
    "created_at": "2015-06-16T20:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263416",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Small detail: do not use

```
# :trac:`10158`
```
in code.

Also, instead of

```
    sage: @cached_function # :trac:`18713`
```
you could write

```
Check that the matrix constructor works with any callable input (see :trac:`18713`)::

    sage: @cached_function
```



---

archive/issue_events_168256.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-16T20:21:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168256"
}
```



---

archive/issue_events_168257.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-16T20:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168257"
}
```



---

archive/issue_comments_263417.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [nbruin](#comment%3A4):\n> The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?\n\n\nIt is in that all symbolic expressions are callable, i.e., they return itself when called with no arguments (which IMHO makes sense) and they try substitution when given arguments (which will hopefully soon raise an exception with #14270 but my hope is fading). So, instead of having special cases of callables your solution needs to exclude those symbolic expressions that are not `Function`s.",
    "created_at": "2015-10-20T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263417",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
Replying to [nbruin](#comment%3A4):
> The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?


It is in that all symbolic expressions are callable, i.e., they return itself when called with no arguments (which IMHO makes sense) and they try substitution when given arguments (which will hopefully soon raise an exception with #14270 but my hope is fading). So, instead of having special cases of callables your solution needs to exclude those symbolic expressions that are not `Function`s.



---

archive/issue_comments_263418.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)\" to \"[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)\".",
    "created_at": "2015-10-20T08:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263418",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)" to "[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)".



---

archive/issue_comments_263419.json:
```json
{
    "body": "**Changing commit** from \"[34d5502150d2a5174984a277a165420f22cf7b7d](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)\" to \"[22e665d0c7d8acd54db1c051761f1182b20e125d](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)\".",
    "created_at": "2015-10-20T08:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263419",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[34d5502150d2a5174984a277a165420f22cf7b7d](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)" to "[22e665d0c7d8acd54db1c051761f1182b20e125d](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)".



---

archive/issue_events_168258.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168258"
}
```



---

archive/issue_events_168259.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168259"
}
```



---

archive/issue_events_168260.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "rename": {
        "from": "cannot feed cached function to Matrix",
        "to": "Allow almost any callable in matrix constructor"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168260"
}
```



---

archive/issue_comments_263420.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d\">22e665d</a></td><td><code>18713: allow almost any callable in matrix constructor</code></td></tr></table>\n",
    "created_at": "2015-10-20T08:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263420",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d">22e665d</a></td><td><code>18713: allow almost any callable in matrix constructor</code></td></tr></table>




---

archive/issue_events_168261.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168261"
}
```



---

archive/issue_events_168262.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168262"
}
```



---

archive/issue_comments_263421.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d\">da8d9d8</a></td><td><code>18713: that sageinspect doctest again</code></td></tr></table>\n",
    "created_at": "2015-10-20T13:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d">da8d9d8</a></td><td><code>18713: that sageinspect doctest again</code></td></tr></table>




---

archive/issue_comments_263422.json:
```json
{
    "body": "**Changing commit** from \"[22e665d0c7d8acd54db1c051761f1182b20e125d](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)\" to \"[da8d9d80a2b929d9069b42a7a66ba78989c6664d](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)\".",
    "created_at": "2015-10-20T13:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[22e665d0c7d8acd54db1c051761f1182b20e125d](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)" to "[da8d9d80a2b929d9069b42a7a66ba78989c6664d](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)".



---

archive/issue_events_168263.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-13T08:11:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168263"
}
```



---

archive/issue_events_168264.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-13T08:11:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168264"
}
```



---

archive/issue_comments_263423.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)\" to \"[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)\".",
    "created_at": "2017-01-16T09:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263423",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)" to "[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)".



---

archive/issue_comments_263424.json:
```json
{
    "body": "<a id='comment:12'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef\">a1249da</a></td><td><code>18713: Allow almost any callable in matrix constructor</code></td></tr></table>\n",
    "created_at": "2017-01-16T09:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263424",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef">a1249da</a></td><td><code>18713: Allow almost any callable in matrix constructor</code></td></tr></table>




---

archive/issue_comments_263425.json:
```json
{
    "body": "**Changing commit** from \"[da8d9d80a2b929d9069b42a7a66ba78989c6664d](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)\" to \"[a1249da72e888e91ea1cf543b3ad09df72ec75ef](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)\".",
    "created_at": "2017-01-16T09:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263425",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[da8d9d80a2b929d9069b42a7a66ba78989c6664d](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)" to "[a1249da72e888e91ea1cf543b3ad09df72ec75ef](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)".



---

archive/issue_events_168265.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168265"
}
```



---

archive/issue_events_168266.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168266"
}
```



---

archive/issue_events_168267.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168267"
}
```



---

archive/issue_events_168268.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168268"
}
```



---

archive/issue_events_168269.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T14:36:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168269"
}
```



---

archive/issue_events_168270.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T14:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168270"
}
```



---

archive/issue_comments_263426.json:
```json
{
    "body": "<a id='comment:13'></a>\nWhy are you adding an `import numpy`?",
    "created_at": "2017-03-01T14:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263426",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Why are you adding an `import numpy`?



---

archive/issue_comments_263427.json:
```json
{
    "body": "<a id='comment:14'></a>\nWhy this?\n\n```\nnot (isinstance(arg, Expression) and not isinstance(arg, Function))):\n```",
    "created_at": "2017-03-01T14:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263427",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Why this?

```
not (isinstance(arg, Expression) and not isinstance(arg, Function))):
```



---

archive/issue_comments_263428.json:
```json
{
    "body": "<a id='comment:15'></a>\nIf you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).",
    "created_at": "2017-03-01T14:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263428",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).



---

archive/issue_comments_263429.json:
```json
{
    "body": "<a id='comment:16'></a>\nI don't understand `of_other_type`. Can you try a positive description (i.e. saying what it ''is\n* instead of what it *is not''). Like `is_iterable`. And then a minor optimization: in Cython, use `cdef bint` for booleans.\n\nOr perhaps you can get rid of `if of_other_type` completely and replace it with something like `if entries is None`.",
    "created_at": "2017-03-01T14:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263429",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
I don't understand `of_other_type`. Can you try a positive description (i.e. saying what it ''is
* instead of what it *is not''). Like `is_iterable`. And then a minor optimization: in Cython, use `cdef bint` for booleans.

Or perhaps you can get rid of `if of_other_type` completely and replace it with something like `if entries is None`.



---

archive/issue_comments_263430.json:
```json
{
    "body": "<a id='comment:17'></a>\nSome minor details:\n\n1. Start exception messages with lower case: `raise ValueError(\"When passing...` -> `raise ValueError(\"when passing...`\n\n2. The indentation looks strange here:\n\n```diff\n+            except TypeError:\n+            # not iterable      <--------\n+                from sage.symbolic.expression import Expression\n+                from sage.symbolic.function import Function\n+                if (callable(arg)\n+                and not (isinstance(arg, Expression)          <--------\n+                        and not isinstance(arg, Function))):  <--------\n```\nand here also:\n\n```diff\n+    The matrix constructor works with any callable input (see :trac:`18713`)::\n+\n+        sage: @cached_function\n+        ....: def L(n,k):\n+        ....:         if n==k: return 1                    <---------\n+        ....:         if k<0 or k>n: return 0              <---------\n+        ....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)   <---------\n```",
    "created_at": "2017-03-01T14:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263430",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Some minor details:

1. Start exception messages with lower case: `raise ValueError("When passing...` -> `raise ValueError("when passing...`

2. The indentation looks strange here:

```diff
+            except TypeError:
+            # not iterable      <--------
+                from sage.symbolic.expression import Expression
+                from sage.symbolic.function import Function
+                if (callable(arg)
+                and not (isinstance(arg, Expression)          <--------
+                        and not isinstance(arg, Function))):  <--------
```
and here also:

```diff
+    The matrix constructor works with any callable input (see :trac:`18713`)::
+
+        sage: @cached_function
+        ....: def L(n,k):
+        ....:         if n==k: return 1                    <---------
+        ....:         if k<0 or k>n: return 0              <---------
+        ....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)   <---------
```



---

archive/issue_comments_263431.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d9a73eef5314e389eada35b3db4b1a59ace2aca\">4d9a73e</a></td><td><code>Merge branch 'develop' into t/18713/18713-1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4\">a4340fb</a></td><td><code>18713: address reviewer's comments</code></td></tr></table>\n",
    "created_at": "2017-04-14T06:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d9a73eef5314e389eada35b3db4b1a59ace2aca">4d9a73e</a></td><td><code>Merge branch 'develop' into t/18713/18713-1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4">a4340fb</a></td><td><code>18713: address reviewer's comments</code></td></tr></table>




---

archive/issue_comments_263432.json:
```json
{
    "body": "**Changing commit** from \"[a1249da72e888e91ea1cf543b3ad09df72ec75ef](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)\" to \"[a4340fbaa9a70fed68fca6323c2a03f4617995e4](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)\".",
    "created_at": "2017-04-14T06:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a1249da72e888e91ea1cf543b3ad09df72ec75ef](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)" to "[a4340fbaa9a70fed68fca6323c2a03f4617995e4](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)".



---

archive/issue_comments_263433.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A15):\n> If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).\n\n\nBecause it's really over my head atm.",
    "created_at": "2017-04-14T06:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263433",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A15):
> If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).


Because it's really over my head atm.



---

archive/issue_events_168271.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168271"
}
```



---

archive/issue_events_168272.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168272"
}
```



---

archive/issue_events_168273.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168273"
}
```



---

archive/issue_events_168274.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168274"
}
```



---

archive/issue_comments_263434.json:
```json
{
    "body": "<a id='comment:20'></a>\nDid you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:\n\n```\nsage: R = GF(9, 'a')\nsage: m = matrix(3, 3, R)\nsage: m\n[      0       a   a + 1]\n[2*a + 1       2     2*a]\n[2*a + 2   a + 2       1]\n```\nI would like a doctest for this.",
    "created_at": "2017-04-22T02:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263434",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:

```
sage: R = GF(9, 'a')
sage: m = matrix(3, 3, R)
sage: m
[      0       a   a + 1]
[2*a + 1       2     2*a]
[2*a + 2   a + 2       1]
```
I would like a doctest for this.



---

archive/issue_comments_263435.json:
```json
{
    "body": "<a id='comment:21'></a>\nJeroen or Ralf, what other iterables would not (necessarily) be handled by the current branch?",
    "created_at": "2017-04-22T02:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263435",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Jeroen or Ralf, what other iterables would not (necessarily) be handled by the current branch?



---

archive/issue_comments_263436.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [tscrim](#comment%3A20):\n> Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:\n> \n> ```\n> sage: R = GF(9, 'a')\n> sage: m = matrix(3, 3, R)\n> sage: m\n> [      0       a   a + 1]\n> [2*a + 1       2     2*a]\n> [2*a + 2   a + 2       1]\n> ```\n\n\nIt does not (same error as with develop). Should it?",
    "created_at": "2017-04-22T05:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263436",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Replying to [tscrim](#comment%3A20):
> Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:
> 
> ```
> sage: R = GF(9, 'a')
> sage: m = matrix(3, 3, R)
> sage: m
> [      0       a   a + 1]
> [2*a + 1       2     2*a]
> [2*a + 2   a + 2       1]
> ```


It does not (same error as with develop). Should it?



---

archive/issue_comments_263437.json:
```json
{
    "body": "<a id='comment:23'></a>\nWell, technically, because it is a callable. Yet, it should be treated as an iterator in this case. So since it errors out in the same way, I think it is okay for now.",
    "created_at": "2017-04-22T05:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263437",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
Well, technically, because it is a callable. Yet, it should be treated as an iterator in this case. So since it errors out in the same way, I think it is okay for now.



---

archive/issue_events_168275.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:47:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168275"
}
```



---

archive/issue_events_168276.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:47:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18713#event-168276"
}
```



---

archive/issue_comments_263438.json:
```json
{
    "body": "<a id='comment:24'></a>\nDoctest failures (see patchbot):\n\n```\nsage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 4 doctests failed\n```",
    "created_at": "2017-05-21T01:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263438",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
Doctest failures (see patchbot):

```
sage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 4 doctests failed
```



---

archive/issue_comments_263439.json:
```json
{
    "body": "<a id='comment:25'></a>\nYes, any `Expression` is also a `callable` but we don't want to call it. This breaks the whole elaborate logic.",
    "created_at": "2017-08-24T05:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18713#issuecomment-263439",
    "user": "https://github.com/rwst"
}
```

<a id='comment:25'></a>
Yes, any `Expression` is also a `callable` but we don't want to call it. This breaks the whole elaborate logic.
