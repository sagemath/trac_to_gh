# Issue 18713: Allow almost any callable in matrix constructor

archive/issues_018476.json:
```json
{
    "assignees": [],
    "body": "From http://ask.sagemath.org/question/27111/why-can-matrix-not-use-cached-functions/\n\n```\nsage: @cached_function\n....: def L(n,k):\n....:         if n==k: return 1\n....:         if k<0 or k>n: return 0\n....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)\n....: \nsage: matrix(ZZ, 8, L)\n...\nValueError: Invalid matrix constructor.  Type matrix? for help\n```\n\nBranch/Commit: **[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1) @ [`a4340fb`](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Ralf Stephan**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18713_\n\n",
    "created_at": "2015-06-16T14:28:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Allow almost any callable in matrix constructor",
    "type": "issue",
    "updated_at": "2022-12-29T01:39:18Z",
    "url": "https://github.com/sagemath/sage/issues/18713",
    "user": "https://github.com/rwst"
}
```
From http://ask.sagemath.org/question/27111/why-can-matrix-not-use-cached-functions/

```
sage: @cached_function
....: def L(n,k):
....:         if n==k: return 1
....:         if k<0 or k>n: return 0
....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)
....: 
sage: matrix(ZZ, 8, L)
...
ValueError: Invalid matrix constructor.  Type matrix? for help
```

Branch/Commit: **[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1) @ [`a4340fb`](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)**

Reviewer: **Travis Scrimshaw**

Author: **Ralf Stephan**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/18713_





---

archive/issue_events_265849.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:28:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265849"
}
```



---

archive/issue_events_265850.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:28:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265850"
}
```



---

archive/issue_events_265851.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:28:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265851"
}
```



---

archive/issue_events_265852.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:28:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265852"
}
```



---

archive/issue_comments_260978.json:
```json
{
    "body": "Branch: **[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)**",
    "created_at": "2015-06-16T14:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260978",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)**



---

archive/issue_events_265853.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-16T14:45:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265853"
}
```



---

archive/issue_comments_260979.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2015-06-16T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260979",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_260980.json:
```json
{
    "body": "Commit: **[`34d5502`](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)**",
    "created_at": "2015-06-16T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260980",
    "user": "https://github.com/rwst"
}
```

Commit: **[`34d5502`](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)**



---

archive/issue_comments_260981.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d\"><code>34d5502</code></a></td><td><code>18713: cannot feed cached function to Matrix</code></td></tr></table>\n",
    "created_at": "2015-06-16T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260981",
    "user": "https://github.com/rwst"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d"><code>34d5502</code></a></td><td><code>18713: cannot feed cached function to Matrix</code></td></tr></table>




---

archive/issue_comments_260982.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTrivial doctest failure (via the patchbot):\n\n```\nFile \"src/sage/misc/sageinspect.py\", line 1959, in sage.misc.sageinspect.sage_getsourcelines\nFailed example:\n    sage_getsourcelines(matrix)[1]\nExpected:\n    732\nGot:\n    745\n```\nOnce fixed, you can set a positive review on my behalf.",
    "created_at": "2015-06-16T16:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260982",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

Trivial doctest failure (via the patchbot):

```
File "src/sage/misc/sageinspect.py", line 1959, in sage.misc.sageinspect.sage_getsourcelines
Failed example:
    sage_getsourcelines(matrix)[1]
Expected:
    732
Got:
    745
```
Once fixed, you can set a positive review on my behalf.



---

archive/issue_comments_260983.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2015-06-16T16:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260983",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_260984.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?\n\nI don't think so, actually. The comment itself says \"callable\" and then the check is for particular types, rather than checking if the thing is callable.\n\nI would say:\n- restructure, giving preference to checking the passed in argument being iterable. Possibly special-case some iterables like lists and tuples for efficiency if necessary (and if that makes a difference -- I doubt it.\n- check for a callable *later*. You can check using `callable(...)`.\n\nI don't know what we should do with objects that are both iterable and callable. I suspect that giving preference to their iterable behaviour will be best.",
    "created_at": "2015-06-16T16:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260984",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?

I don't think so, actually. The comment itself says "callable" and then the check is for particular types, rather than checking if the thing is callable.

I would say:
- restructure, giving preference to checking the passed in argument being iterable. Possibly special-case some iterables like lists and tuples for efficiency if necessary (and if that makes a difference -- I doubt it.
- check for a callable *later*. You can check using `callable(...)`.

I don't know what we should do with objects that are both iterable and callable. I suspect that giving preference to their iterable behaviour will be best.



---

archive/issue_comments_260985.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSmall detail: do not use\n\n```\n# :trac:`10158`\n```\nin code.\n\nAlso, instead of\n\n```\n    sage: @cached_function # :trac:`18713`\n```\nyou could write\n\n```\nCheck that the matrix constructor works with any callable input (see :trac:`18713`)::\n\n    sage: @cached_function\n```",
    "created_at": "2015-06-16T20:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260985",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Small detail: do not use

```
# :trac:`10158`
```
in code.

Also, instead of

```
    sage: @cached_function # :trac:`18713`
```
you could write

```
Check that the matrix constructor works with any callable input (see :trac:`18713`)::

    sage: @cached_function
```



---

archive/issue_events_265854.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-16T20:21:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265854"
}
```



---

archive/issue_events_265855.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-16T20:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265855"
}
```



---

archive/issue_comments_260986.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@nbruin](#comment:4):\n> The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?\n\nIt is in that all symbolic expressions are callable, i.e., they return itself when called with no arguments (which IMHO makes sense) and they try substitution when given arguments (which will hopefully soon raise an exception with #14270 but my hope is fading). So, instead of having special cases of callables your solution needs to exclude those symbolic expressions that are not `Function`s.",
    "created_at": "2015-10-20T08:19:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260986",
    "user": "https://github.com/rwst"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@nbruin](#comment:4):
> The proposed fix mends the reported problem, and no more. However, shouldn't there be certain behaviour for the matrix constructor if it gets passed a *callable* object? or is that too broad?

It is in that all symbolic expressions are callable, i.e., they return itself when called with no arguments (which IMHO makes sense) and they try substitution when given arguments (which will hopefully soon raise an exception with #14270 but my hope is fading). So, instead of having special cases of callables your solution needs to exclude those symbolic expressions that are not `Function`s.



---

archive/issue_comments_260987.json:
```json
{
    "body": "Changed branch from **[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)** to **[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)**",
    "created_at": "2015-10-20T08:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260987",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/cannot_feed_cached_function_to_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/cannot_feed_cached_function_to_matrix)** to **[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)**



---

archive/issue_events_265856.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265856"
}
```



---

archive/issue_events_265857.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265857"
}
```



---

archive/issue_comments_260988.json:
```json
{
    "body": "Changed commit from **[`34d5502`](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)** to **[`22e665d`](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)**",
    "created_at": "2015-10-20T08:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260988",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`34d5502`](https://github.com/sagemath/sagetrac-mirror/commit/34d5502150d2a5174984a277a165420f22cf7b7d)** to **[`22e665d`](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)**



---

archive/issue_events_265858.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "title_is": "Allow almost any callable in matrix constructor",
    "title_was": "cannot feed cached function to Matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265858"
}
```



---

archive/issue_comments_260989.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d\"><code>22e665d</code></a></td><td><code>18713: allow almost any callable in matrix constructor</code></td></tr></table>\n",
    "created_at": "2015-10-20T08:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260989",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d"><code>22e665d</code></a></td><td><code>18713: allow almost any callable in matrix constructor</code></td></tr></table>




---

archive/issue_events_265859.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265859"
}
```



---

archive/issue_events_265860.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-10-20T08:37:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265860"
}
```



---

archive/issue_comments_260990.json:
```json
{
    "body": "Changed commit from **[`22e665d`](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)** to **[`da8d9d8`](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)**",
    "created_at": "2015-10-20T13:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260990",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`22e665d`](https://github.com/sagemath/sagetrac-mirror/commit/22e665d0c7d8acd54db1c051761f1182b20e125d)** to **[`da8d9d8`](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)**



---

archive/issue_comments_260991.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d\"><code>da8d9d8</code></a></td><td><code>18713: that sageinspect doctest again</code></td></tr></table>\n",
    "created_at": "2015-10-20T13:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260991",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d"><code>da8d9d8</code></a></td><td><code>18713: that sageinspect doctest again</code></td></tr></table>




---

archive/issue_events_265861.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-13T08:11:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265861"
}
```



---

archive/issue_events_265862.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-13T08:11:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265862"
}
```



---

archive/issue_comments_260992.json:
```json
{
    "body": "Changed branch from **[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)** to **[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)**",
    "created_at": "2017-01-16T09:03:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260992",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/18713](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713)** to **[u/rws/18713-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/18713-1)**



---

archive/issue_events_265863.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265863"
}
```



---

archive/issue_events_265864.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265864"
}
```



---

archive/issue_events_265865.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265865"
}
```



---

archive/issue_events_265866.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T09:04:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265866"
}
```



---

archive/issue_comments_260993.json:
```json
{
    "body": "Changed commit from **[`da8d9d8`](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)** to **[`a1249da`](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)**",
    "created_at": "2017-01-16T09:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260993",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`da8d9d8`](https://github.com/sagemath/sagetrac-mirror/commit/da8d9d80a2b929d9069b42a7a66ba78989c6664d)** to **[`a1249da`](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)**



---

archive/issue_comments_260994.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef\"><code>a1249da</code></a></td><td><code>18713: Allow almost any callable in matrix constructor</code></td></tr></table>\n",
    "created_at": "2017-01-16T09:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260994",
    "user": "https://github.com/rwst"
}
```

<div id="comment:12"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef"><code>a1249da</code></a></td><td><code>18713: Allow almost any callable in matrix constructor</code></td></tr></table>




---

archive/issue_events_265867.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T14:36:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265867"
}
```



---

archive/issue_events_265868.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T14:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265868"
}
```



---

archive/issue_comments_260995.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWhy are you adding an `import numpy`?",
    "created_at": "2017-03-01T14:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260995",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Why are you adding an `import numpy`?



---

archive/issue_comments_260996.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhy this?\n\n```\nnot (isinstance(arg, Expression) and not isinstance(arg, Function))):\n```",
    "created_at": "2017-03-01T14:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260996",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Why this?

```
not (isinstance(arg, Expression) and not isinstance(arg, Function))):
```



---

archive/issue_comments_260997.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIf you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).",
    "created_at": "2017-03-01T14:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260997",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).



---

archive/issue_comments_260998.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI don't understand `of_other_type`. Can you try a positive description (i.e. saying what it ''is\n* instead of what it *is not''). Like `is_iterable`. And then a minor optimization: in Cython, use `cdef bint` for booleans.\n\nOr perhaps you can get rid of `if of_other_type` completely and replace it with something like `if entries is None`.",
    "created_at": "2017-03-01T14:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260998",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I don't understand `of_other_type`. Can you try a positive description (i.e. saying what it ''is
* instead of what it *is not''). Like `is_iterable`. And then a minor optimization: in Cython, use `cdef bint` for booleans.

Or perhaps you can get rid of `if of_other_type` completely and replace it with something like `if entries is None`.



---

archive/issue_comments_260999.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSome minor details:\n\n1. Start exception messages with lower case: `raise ValueError(\"When passing...` -> `raise ValueError(\"when passing...`\n\n2. The indentation looks strange here:\n\n```diff\n+            except TypeError:\n+            # not iterable      <--------\n+                from sage.symbolic.expression import Expression\n+                from sage.symbolic.function import Function\n+                if (callable(arg)\n+                and not (isinstance(arg, Expression)          <--------\n+                        and not isinstance(arg, Function))):  <--------\n```\nand here also:\n\n```diff\n+    The matrix constructor works with any callable input (see :trac:`18713`)::\n+\n+        sage: @cached_function\n+        ....: def L(n,k):\n+        ....:         if n==k: return 1                    <---------\n+        ....:         if k<0 or k>n: return 0              <---------\n+        ....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)   <---------\n```",
    "created_at": "2017-03-01T14:48:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-260999",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Some minor details:

1. Start exception messages with lower case: `raise ValueError("When passing...` -> `raise ValueError("when passing...`

2. The indentation looks strange here:

```diff
+            except TypeError:
+            # not iterable      <--------
+                from sage.symbolic.expression import Expression
+                from sage.symbolic.function import Function
+                if (callable(arg)
+                and not (isinstance(arg, Expression)          <--------
+                        and not isinstance(arg, Function))):  <--------
```
and here also:

```diff
+    The matrix constructor works with any callable input (see :trac:`18713`)::
+
+        sage: @cached_function
+        ....: def L(n,k):
+        ....:         if n==k: return 1                    <---------
+        ....:         if k<0 or k>n: return 0              <---------
+        ....:         return L(n-1,k-1)+(n+k-1)*L(n-1,k)   <---------
```



---

archive/issue_comments_261000.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d9a73eef5314e389eada35b3db4b1a59ace2aca\"><code>4d9a73e</code></a></td><td><code>Merge branch 'develop' into t/18713/18713-1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4\"><code>a4340fb</code></a></td><td><code>18713: address reviewer's comments</code></td></tr></table>\n",
    "created_at": "2017-04-14T06:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261000",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d9a73eef5314e389eada35b3db4b1a59ace2aca"><code>4d9a73e</code></a></td><td><code>Merge branch 'develop' into t/18713/18713-1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4"><code>a4340fb</code></a></td><td><code>18713: address reviewer's comments</code></td></tr></table>




---

archive/issue_comments_261001.json:
```json
{
    "body": "Changed commit from **[`a1249da`](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)** to **[`a4340fb`](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)**",
    "created_at": "2017-04-14T06:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261001",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a1249da`](https://github.com/sagemath/sagetrac-mirror/commit/a1249da72e888e91ea1cf543b3ad09df72ec75ef)** to **[`a4340fb`](https://github.com/sagemath/sagetrac-mirror/commit/a4340fbaa9a70fed68fca6323c2a03f4617995e4)**



---

archive/issue_events_265869.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265869"
}
```



---

archive/issue_events_265870.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265870"
}
```



---

archive/issue_events_265871.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265871"
}
```



---

archive/issue_events_265872.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-14T06:41:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265872"
}
```



---

archive/issue_comments_261002.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:15):\n> If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).\n\nBecause it's really over my head atm.",
    "created_at": "2017-04-14T06:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261002",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:15):
> If you are allowing any kind of callable, why not allowing any kind of iterable too (it's a valid question since you are making changes to the code for iterables).

Because it's really over my head atm.



---

archive/issue_comments_261003.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDid you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:\n\n```\nsage: R = GF(9, 'a')\nsage: m = matrix(3, 3, R)\nsage: m\n[      0       a   a + 1]\n[2*a + 1       2     2*a]\n[2*a + 2   a + 2       1]\n```\nI would like a doctest for this.",
    "created_at": "2017-04-22T02:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261003",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:

```
sage: R = GF(9, 'a')
sage: m = matrix(3, 3, R)
sage: m
[      0       a   a + 1]
[2*a + 1       2     2*a]
[2*a + 2   a + 2       1]
```
I would like a doctest for this.



---

archive/issue_comments_261004.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nJeroen or Ralf, what other iterables would not (necessarily) be handled by the current branch?",
    "created_at": "2017-04-22T02:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261004",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

Jeroen or Ralf, what other iterables would not (necessarily) be handled by the current branch?



---

archive/issue_comments_261005.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment:20):\n> Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:\n> \n> ```\n> sage: R = GF(9, 'a')\n> sage: m = matrix(3, 3, R)\n> sage: m\n> [      0       a   a + 1]\n> [2*a + 1       2     2*a]\n> [2*a + 2   a + 2       1]\n> ```\n\nIt does not (same error as with develop). Should it?",
    "created_at": "2017-04-22T05:04:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261005",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment:20):
> Did you test this against something that is callable and iterable, such as a parent that is a finite set? It seems like the iterable behavior takes precedent, but it is not clear from the code that this is correct. For example, does this now work:
> 
> ```
> sage: R = GF(9, 'a')
> sage: m = matrix(3, 3, R)
> sage: m
> [      0       a   a + 1]
> [2*a + 1       2     2*a]
> [2*a + 2   a + 2       1]
> ```

It does not (same error as with develop). Should it?



---

archive/issue_comments_261006.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWell, technically, because it is a callable. Yet, it should be treated as an iterator in this case. So since it errors out in the same way, I think it is okay for now.",
    "created_at": "2017-04-22T05:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261006",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Well, technically, because it is a callable. Yet, it should be treated as an iterator in this case. So since it errors out in the same way, I think it is okay for now.



---

archive/issue_comments_261007.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nDoctest failures (see patchbot):\n\n```\nsage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 4 doctests failed\n```",
    "created_at": "2017-05-21T01:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261007",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Doctest failures (see patchbot):

```
sage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 4 doctests failed
```



---

archive/issue_events_265873.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:47:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265873"
}
```



---

archive/issue_events_265874.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:47:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265874"
}
```



---

archive/issue_comments_261008.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYes, any `Expression` is also a `callable` but we don't want to call it. This breaks the whole elaborate logic.",
    "created_at": "2017-08-24T05:46:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18713#issuecomment-261008",
    "user": "https://github.com/rwst"
}
```

<div id="comment:25" align="right">comment:25</div>

Yes, any `Expression` is also a `callable` but we don't want to call it. This breaks the whole elaborate logic.



---

archive/issue_events_265875.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:39:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18713",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18713#event-265875"
}
```
