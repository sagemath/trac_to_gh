# Issue 18096: Libsingular conversion of (signed?) int to sage might have a muisunderstanding about bitlength

archive/issues_017859.json:
```json
{
    "body": "Note (in singular)\n\n```\n> LIB \"normal.lib\";\n> ring r=0,(x,y,z),dp;\n> ideal i=(x-y)*(y-z)*(z-x);\n> genus(i);\n-2\n```\nwhereas in sage:\n\n```\nsage: x,y,z = QQ['x,y,z'].gens()\nsage: C= Curve((x-y)*(y-z)*(z-x)); \nsage: sage: import sage.libs.singular.function_factory\nsage: sage: sing_genus = sage.libs.singular.function_factory.ff.normal__lib.genus\nsage: I=C.defining_ideal()\nsage: sing_genus(I)\n4294967294\n```\nso somehow the -2 seems to be represented in libsingular as a 32-bit signed integer and gets interpreted by sage as (probably) a 64-bit signed integer. The relevant code lives in\nsage.lib.singular.function.pyx:951 (to_python):\n\n```\n        elif rtyp == INT_CMD:\n            return <long>to_convert.data\n```\nOddly enough, most of libsingular seems to refer to such fields with a `(long)` cast as well, and I would expect that, since sage and libsingular are supposed to be compiled with compatible compilers, they would agree on what `long` means.\n\n\nBranch/Commit: c9c682b9c533ebc76f553ec4fb5a593d495adc11\n\nReviewer: Jeroen Demeyer\n\nAuthor: Nils Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18096\n\n",
    "closed_at": "2015-04-14T19:43:24Z",
    "created_at": "2015-03-31T18:12:46Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Libsingular conversion of (signed?) int to sage might have a muisunderstanding about bitlength",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18096",
    "user": "https://github.com/nbruin"
}
```
Note (in singular)

```
> LIB "normal.lib";
> ring r=0,(x,y,z),dp;
> ideal i=(x-y)*(y-z)*(z-x);
> genus(i);
-2
```
whereas in sage:

```
sage: x,y,z = QQ['x,y,z'].gens()
sage: C= Curve((x-y)*(y-z)*(z-x)); 
sage: sage: import sage.libs.singular.function_factory
sage: sage: sing_genus = sage.libs.singular.function_factory.ff.normal__lib.genus
sage: I=C.defining_ideal()
sage: sing_genus(I)
4294967294
```
so somehow the -2 seems to be represented in libsingular as a 32-bit signed integer and gets interpreted by sage as (probably) a 64-bit signed integer. The relevant code lives in
sage.lib.singular.function.pyx:951 (to_python):

```
        elif rtyp == INT_CMD:
            return <long>to_convert.data
```
Oddly enough, most of libsingular seems to refer to such fields with a `(long)` cast as well, and I would expect that, since sage and libsingular are supposed to be compiled with compatible compilers, they would agree on what `long` means.


Branch/Commit: c9c682b9c533ebc76f553ec4fb5a593d495adc11

Reviewer: Jeroen Demeyer

Author: Nils Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18096





---

archive/issue_comments_312479.json:
```json
{
    "body": "Changing branch from \"\" to \"u/nbruin/libsingular_conversion_of__signed___int_to_sage_might_have_a_muisunderstanding_about_bitlength\"",
    "created_at": "2015-03-31T20:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312479",
    "user": "https://github.com/nbruin"
}
```

Changing branch from "" to "u/nbruin/libsingular_conversion_of__signed___int_to_sage_might_have_a_muisunderstanding_about_bitlength"



---

archive/issue_comments_312480.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-31T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312480",
    "user": "https://github.com/nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312481.json:
```json
{
    "body": "Changing commit from \"\" to \"5f26856cac7256b06d142c91b3c6c22d50ed0c82\"",
    "created_at": "2015-03-31T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312481",
    "user": "https://github.com/nbruin"
}
```

Changing commit from "" to "5f26856cac7256b06d142c91b3c6c22d50ed0c82"



---

archive/issue_comments_312482.json:
```json
{
    "body": "<a id='comment:2'></a>\ninterpreting the value as an int rather than a long seems to work. Input welcome from someone with more singular knowledge.\n\n(note that the `<int><long>` cast is necessary because a cast to `<int>` directly from `<void *>` causes a \"loss of information\" error).\n\n---\nNew commits:\n|                                                                                                                                          |                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[5f26856](http://git.sagemath.org/sage.git/commit/?id=5f26856cac7256b06d142c91b3c6c22d50ed0c82)|`18096: Interpret a libsingular leftv.data field as \"int\" when rtyp is INT_CMD`|",
    "created_at": "2015-03-31T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312482",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
interpreting the value as an int rather than a long seems to work. Input welcome from someone with more singular knowledge.

(note that the `<int><long>` cast is necessary because a cast to `<int>` directly from `<void *>` causes a "loss of information" error).

---
New commits:
|                                                                                                                                          |                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[5f26856](http://git.sagemath.org/sage.git/commit/?id=5f26856cac7256b06d142c91b3c6c22d50ed0c82)|`18096: Interpret a libsingular leftv.data field as "int" when rtyp is INT_CMD`|



---

archive/issue_comments_312483.json:
```json
{
    "body": "Changing author from \"\" to \"Nils Bruin\"",
    "created_at": "2015-03-31T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312483",
    "user": "https://github.com/nbruin"
}
```

Changing author from "" to "Nils Bruin"



---

archive/issue_comments_312484.json:
```json
{
    "body": "<a id='comment:4'></a>\nCorroborating evidence that this is the appropriate cast:\n[ftp://ftp.fu-berlin.de/science/math/singular/doc/modules.pdf] contains casts `(int)(long)` from INT_CMD marked fields too. In general, the Singular documentation mentions that the `int` type (which is claimed to correspond to the `INT_CMD` type indicator) has range limitations consistent with 32-bit signed integers. So I'm pretty sure at this point that the proposed fix here is correct.",
    "created_at": "2015-04-01T05:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312484",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:4'></a>
Corroborating evidence that this is the appropriate cast:
[ftp://ftp.fu-berlin.de/science/math/singular/doc/modules.pdf] contains casts `(int)(long)` from INT_CMD marked fields too. In general, the Singular documentation mentions that the `int` type (which is claimed to correspond to the `INT_CMD` type indicator) has range limitations consistent with 32-bit signed integers. So I'm pretty sure at this point that the proposed fix here is correct.



---

archive/issue_comments_312485.json:
```json
{
    "body": "<a id='comment:5'></a>\nAdd a doctest and you're good to go.",
    "created_at": "2015-04-01T07:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312485",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Add a doctest and you're good to go.



---

archive/issue_comments_312486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-01T07:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312486",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312487.json:
```json
{
    "body": "Changing commit from \"5f26856cac7256b06d142c91b3c6c22d50ed0c82\" to \"c9c682b9c533ebc76f553ec4fb5a593d495adc11\"",
    "created_at": "2015-04-01T16:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5f26856cac7256b06d142c91b3c6c22d50ed0c82" to "c9c682b9c533ebc76f553ec4fb5a593d495adc11"



---

archive/issue_comments_312488.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[c9c682b](http://git.sagemath.org/sage.git/commit/?id=c9c682b9c533ebc76f553ec4fb5a593d495adc11)|`18096: test to check singularlib \"int\" keeps its sign upon conversion`|",
    "created_at": "2015-04-01T16:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[c9c682b](http://git.sagemath.org/sage.git/commit/?id=c9c682b9c533ebc76f553ec4fb5a593d495adc11)|`18096: test to check singularlib "int" keeps its sign upon conversion`|



---

archive/issue_comments_312489.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-01T16:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312489",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312490.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-04-02T10:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312490",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_312491.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-02T10:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312491",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_051315.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:43:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18096#event-51315"
}
```



---

archive/issue_comments_312492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312492",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_312493.json:
```json
{
    "body": "Changing branch from \"u/nbruin/libsingular_conversion_of__signed___int_to_sage_might_have_a_muisunderstanding_about_bitlength\" to \"c9c682b9c533ebc76f553ec4fb5a593d495adc11\"",
    "created_at": "2015-04-14T19:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18096#issuecomment-312493",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/nbruin/libsingular_conversion_of__signed___int_to_sage_might_have_a_muisunderstanding_about_bitlength" to "c9c682b9c533ebc76f553ec4fb5a593d495adc11"
