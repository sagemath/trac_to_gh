# Issue 18443: Multiplier spectra for projective morphisms

archive/issues_018206.json:
```json
{
    "body": "Implement a function to compute the n multiplier spectra, the set of multipliers of periodic points of formal period n, of a projective morphism. This currently only makes sense for morphisms over projective space of dimension 1.\n\nCC:  @bhutz\n\nBranch/Commit: 6112c29bf609d6cededc1441ffb99d75faef0893\n\nReviewer: Ben Hutz\n\nAuthor: Grayson Jorgenson\n\nDependencies: #18409\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18443\n\n",
    "closed_at": "2015-06-17T07:42:42Z",
    "created_at": "2015-05-18T16:42:11Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Multiplier spectra for projective morphisms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18443",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```
Implement a function to compute the n multiplier spectra, the set of multipliers of periodic points of formal period n, of a projective morphism. This currently only makes sense for morphisms over projective space of dimension 1.

CC:  @bhutz

Branch/Commit: 6112c29bf609d6cededc1441ffb99d75faef0893

Reviewer: Ben Hutz

Author: Grayson Jorgenson

Dependencies: #18409

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18443





---

archive/issue_comments_261520.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-20T19:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261521.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-20T19:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261521",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from new to needs_review.



---

archive/issue_events_051932.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gjorgenson",
    "created_at": "2015-05-20T19:03:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18443#event-51932"
}
```



---

archive/issue_comments_261522.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-25T16:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261522",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_261523.json:
```json
{
    "body": "<a id='comment:4'></a>A few things here, the big one is that the multiplier spectrum is defined with multiplicities. So if a perioidic point has multiplicity > 1 its multiplier should be repeated. Such as example should be added to the doc tests.\n\nOther minor issues:\n- a positive integer, the period.\n\n- numberfield -> number field\n\n- n = int(n)\n\n- change_ring now works for QQbar, so this is not needed\n\n```\nif not PS.base_ring() is QQbar:\n emb = PS.base_ring().embeddings(QQbar)[0]\n f = self.change_ring(QQbar,embedding=emb) # to be able to find all periodic points\nelse:\n f = self\n```\n\n- f.multiplier(P,n)[0][0] -> f.multiplier(P,n)[0,0]\n\n- multipliers.sort() -> not needed\n\n\n- sigma_invariants - 2nd senctence should say all periodic points. (same for INPUT)\n\n\n- from sage.combinat.sf.sf import SymmetricFunctions -> move to top\n\n- make len(multipliers) a constant in for loop",
    "created_at": "2015-05-25T16:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261523",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:4'></a>A few things here, the big one is that the multiplier spectrum is defined with multiplicities. So if a perioidic point has multiplicity > 1 its multiplier should be repeated. Such as example should be added to the doc tests.

Other minor issues:
- a positive integer, the period.

- numberfield -> number field

- n = int(n)

- change_ring now works for QQbar, so this is not needed

```
if not PS.base_ring() is QQbar:
 emb = PS.base_ring().embeddings(QQbar)[0]
 f = self.change_ring(QQbar,embedding=emb) # to be able to find all periodic points
else:
 f = self
```

- f.multiplier(P,n)[0][0] -> f.multiplier(P,n)[0,0]

- multipliers.sort() -> not needed


- sigma_invariants - 2nd senctence should say all periodic points. (same for INPUT)


- from sage.combinat.sf.sf import SymmetricFunctions -> move to top

- make len(multipliers) a constant in for loop



---

archive/issue_comments_261524.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T15:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261525.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T20:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261526.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-27T20:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261526",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_261527.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-30T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261527",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_261528.json:
```json
{
    "body": "<a id='comment:8'></a>A couple things in multiplier_spectrum\n\n- you should check that the domain is projective space to avoid subschemes\n\n- K = f._number_field_from_algebraics() should be outside the if\n\n- if [1,0] is a point of multplicity you will miss this (You also only check if it is fixed not n-periodic). You could instead see if the poly F is of the form `y^m*G(x,y)` for some poly G, then m is the multplicity of [1,0].\n\n- it doesn't seem like your conversion to QQbar is working. Trying your number field example, when the map is actually defined over a number field\n\n```\nsage: set_verbose(None)\nsage: z = QQ['z'].0\nsage: K.<w> = NumberField(z^4 - 4*z^2 + 1)\nsage: P.<x,y> = ProjectiveSpace(K,1)\nsage: H = End(P)\nsage: f = H([x^2 - w/4*y^2,y^2])\nsage: f.multiplier_spectra(2,False)\n```\n\nNot sure exactly what you should do here. One option is to get change_ring for polynomials to deal with QQbar, by passing in and/or creating an embedding. If you look in schemes.generic.morphism.SchemeMorphism_polynomial.change_ring() it gives a simple way to construct a hom of polynomials given a hom of the base rings. It does appear that the change_ring of the parent is working, so you probably just need to create the hom between the poly rings and apply it to the element to be changed.",
    "created_at": "2015-05-30T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261528",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>A couple things in multiplier_spectrum

- you should check that the domain is projective space to avoid subschemes

- K = f._number_field_from_algebraics() should be outside the if

- if [1,0] is a point of multplicity you will miss this (You also only check if it is fixed not n-periodic). You could instead see if the poly F is of the form `y^m*G(x,y)` for some poly G, then m is the multplicity of [1,0].

- it doesn't seem like your conversion to QQbar is working. Trying your number field example, when the map is actually defined over a number field

```
sage: set_verbose(None)
sage: z = QQ['z'].0
sage: K.<w> = NumberField(z^4 - 4*z^2 + 1)
sage: P.<x,y> = ProjectiveSpace(K,1)
sage: H = End(P)
sage: f = H([x^2 - w/4*y^2,y^2])
sage: f.multiplier_spectra(2,False)
```

Not sure exactly what you should do here. One option is to get change_ring for polynomials to deal with QQbar, by passing in and/or creating an embedding. If you look in schemes.generic.morphism.SchemeMorphism_polynomial.change_ring() it gives a simple way to construct a hom of polynomials given a hom of the base rings. It does appear that the change_ring of the parent is working, so you probably just need to create the hom between the poly rings and apply it to the element to be changed.



---

archive/issue_comments_261529.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-08T19:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261530.json:
```json
{
    "body": "<a id='comment:10'></a>For the formal==True case I used the technique in the morphism change_ring function to create the homomorphism between polynomial rings to use on F and this seems to have addressed the issues so far. For the formal==False case, the conversion already seemed to be working, but  the _number_field_from_algebraics version of the map wasn't needed for finding roots.\n\nI found another problem though:\n\n```\nP.<x,y> = ProjectiveSpace(QQ,1)\nH = End(P)\nf = H([x^2 - 3/4*y^2,y^2])\nf.multiplier_spectra(2)\n```\n\ngives [1,1] back which isn't correct.\n\nI didn\u2019t catch this before, but multiplier_spectra should only return [1] here, because there is only one two cycle. The collapsing causes this two cycle to turn into a root of multiplicity 2 of the dynatomic polynomial, so the algorithm I use to pick representatives from cycles doesn\u2019t work.\n\nI will implement a fix attempt for this next, but I wanted to push up the current commit before doing so.",
    "created_at": "2015-06-08T20:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261530",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:10'></a>For the formal==True case I used the technique in the morphism change_ring function to create the homomorphism between polynomial rings to use on F and this seems to have addressed the issues so far. For the formal==False case, the conversion already seemed to be working, but  the _number_field_from_algebraics version of the map wasn't needed for finding roots.

I found another problem though:

```
P.<x,y> = ProjectiveSpace(QQ,1)
H = End(P)
f = H([x^2 - 3/4*y^2,y^2])
f.multiplier_spectra(2)
```

gives [1,1] back which isn't correct.

I didn’t catch this before, but multiplier_spectra should only return [1] here, because there is only one two cycle. The collapsing causes this two cycle to turn into a root of multiplicity 2 of the dynatomic polynomial, so the algorithm I use to pick representatives from cycles doesn’t work.

I will implement a fix attempt for this next, but I wanted to push up the current commit before doing so.



---

archive/issue_comments_261531.json:
```json
{
    "body": "<a id='comment:11'></a>For `x^2-3/4`, what you have are *no* 2-cycles. There are 2 formal 2-periodic points, but they are a doubled fixed point. So, I'm not sure [1,1] is incorrect in this case. Why do you think this is wrong?",
    "created_at": "2015-06-09T01:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261531",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:11'></a>For `x^2-3/4`, what you have are *no* 2-cycles. There are 2 formal 2-periodic points, but they are a doubled fixed point. So, I'm not sure [1,1] is incorrect in this case. Why do you think this is wrong?



---

archive/issue_comments_261532.json:
```json
{
    "body": "<a id='comment:12'></a>I thought getting [1,1] back was messing up the resulting elementary symmetric polynomial. For the other `x^2 + c`, the formal 2-multiplier spectra consists of one multiplier and so there is only one elementary symmetric polynomial, `sigma_{1}^{(2)} = sigma_2 + 4`. For `x^2 - 3/4`, if we use [1,1] we have an extra multiplier, and `sigma_{1}^{(2)} = 1+1 = 2` when we expect `sigma_{1}^{(2)} = sigma_2 + 4 = 1`. \n\nI was thinking that it might be better to treat the doubled fixed point as a single 2-cycle so that we only get one multiplier. Would that work?",
    "created_at": "2015-06-09T05:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261532",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:12'></a>I thought getting [1,1] back was messing up the resulting elementary symmetric polynomial. For the other `x^2 + c`, the formal 2-multiplier spectra consists of one multiplier and so there is only one elementary symmetric polynomial, `sigma_{1}^{(2)} = sigma_2 + 4`. For `x^2 - 3/4`, if we use [1,1] we have an extra multiplier, and `sigma_{1}^{(2)} = 1+1 = 2` when we expect `sigma_{1}^{(2)} = sigma_2 + 4 = 1`. 

I was thinking that it might be better to treat the doubled fixed point as a single 2-cycle so that we only get one multiplier. Would that work?



---

archive/issue_comments_261533.json:
```json
{
    "body": "<a id='comment:13'></a>hmm...yes I see your point. I think having the correct number of multipliers so that the elementary symmetric polynomials are continuous as they are supposed to be would be the correct approach.",
    "created_at": "2015-06-09T14:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261533",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>hmm...yes I see your point. I think having the correct number of multipliers so that the elementary symmetric polynomials are continuous as they are supposed to be would be the correct approach.



---

archive/issue_comments_261534.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-10T03:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261535.json:
```json
{
    "body": "<a id='comment:15'></a>I modified the selection loop slightly so now there's no break when iterating points to find their cycles. I think this will address the issue of extra representative points for collapsed cycles, and shouldn't change anything for maps with no collapsing.",
    "created_at": "2015-06-10T03:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261535",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:15'></a>I modified the selection loop slightly so now there's no break when iterating points to find their cycles. I think this will address the issue of extra representative points for collapsed cycles, and shouldn't change anything for maps with no collapsing.



---

archive/issue_comments_261536.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-10T03:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261536",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_261537.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-11T15:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261537",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_261538.json:
```json
{
    "body": "<a id='comment:16'></a>Just a couple very minor things here. You should actually convert n, not just check the conversion. ie. use ``n=int(n)``\n\nAlso, I'd rather not have you accessing the ._polys list directly. Instead you can use G[0], G[1], etc.\n\nFinally, I'd like to see an example with multiplicities.\n\nI see you directly implemented the QQbar change ring for the dynatomic polynomial. I still think the .change_ring() should be fixed as well, but that can be done in a different ticket.",
    "created_at": "2015-06-11T15:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261538",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:16'></a>Just a couple very minor things here. You should actually convert n, not just check the conversion. ie. use ``n=int(n)``

Also, I'd rather not have you accessing the ._polys list directly. Instead you can use G[0], G[1], etc.

Finally, I'd like to see an example with multiplicities.

I see you directly implemented the QQbar change ring for the dynatomic polynomial. I still think the .change_ring() should be fixed as well, but that can be done in a different ticket.



---

archive/issue_comments_261539.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-12T22:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261540.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-12T22:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261540",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_261541.json:
```json
{
    "body": "<a id='comment:18'></a>I added an example using `x^2 - 7/4` which has a collapsed 3-cycle. I left the `x^2 -3/4` example in to illustrate that the doubled fixed point is treated as one 2-cycle, but I can remove it if it seems unnecessary.",
    "created_at": "2015-06-12T22:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261541",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:18'></a>I added an example using `x^2 - 7/4` which has a collapsed 3-cycle. I left the `x^2 -3/4` example in to illustrate that the doubled fixed point is treated as one 2-cycle, but I can remove it if it seems unnecessary.



---

archive/issue_comments_261542.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-15T19:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261542",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261543.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-17T07:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18443#issuecomment-261543",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-17T07:42:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18443",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18443#event-51933"
}
```
