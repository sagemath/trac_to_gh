# Issue 18240: fix MPIR's compliance with c++

archive/issues_018003.json:
```json
{
    "body": "with gcc 4.9.2, we hit this bug:\n\n[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)\nThe <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:\n\n```\n/usr/include/c++/4.9.0/cstddef:51:11: error: \u2018::max_align_t\u2019 has not been declared\n   using ::max_align_t;\n```\n\nThis has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)\n\nThe workaround suggested by the gcc people appears to work. \n\nCC:  @vbraun @nexttime wbhart\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Jakob Kroeker, Leif Leonhardy\n\nAuthor: Dima Pasechnik\n\nBranch: 6785ef2000d220f511fcf3e9830b05099500ef47\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18240\n\n",
    "closed_at": "2015-04-26T02:21:48Z",
    "created_at": "2015-04-17T14:12:32Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "fix MPIR's compliance with c++",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18240",
    "user": "https://github.com/dimpase"
}
```
with gcc 4.9.2, we hit this bug:

[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)
The <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:

```
/usr/include/c++/4.9.0/cstddef:51:11: error: ‘::max_align_t’ has not been declared
   using ::max_align_t;
```

This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)

The workaround suggested by the gcc people appears to work. 

CC:  @vbraun @nexttime wbhart

Upstream: Fixed upstream, in a later stable release.

Reviewer: Jakob Kroeker, Leif Leonhardy

Author: Dima Pasechnik

Branch: 6785ef2000d220f511fcf3e9830b05099500ef47

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18240





---

archive/issue_comments_257636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-17T18:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257636",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_257637.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n \n This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)\n \n-The workaround suggested appears to work. A patch follows shortly.\n+The workaround suggested by the gcc people appears to work. \n \n Upstream: Reported upstream. Developers acknowledge bug.\n \n```\n",
    "created_at": "2015-04-17T18:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257637",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -10,7 +10,7 @@
 
 This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)
 
-The workaround suggested appears to work. A patch follows shortly.
+The workaround suggested by the gcc people appears to work. 
 
 Upstream: Reported upstream. Developers acknowledge bug.
 
```




---

archive/issue_comments_257638.json:
```json
{
    "body": "<a id='comment:5'></a>needless to say, after pulling in the change, one has to `sage -f mpir` (ideally followed up by `make` -  but this will rebuild half of Sage for nothing, apart from an extra check).",
    "created_at": "2015-04-17T18:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257638",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>needless to say, after pulling in the change, one has to `sage -f mpir` (ideally followed up by `make` -  but this will rebuild half of Sage for nothing, apart from an extra check).



---

archive/issue_comments_257639.json:
```json
{
    "body": "Changing component from number theory to packages: standard.",
    "created_at": "2015-04-19T15:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257639",
    "user": "https://github.com/nexttime"
}
```

Changing component from number theory to packages: standard.



---

archive/issue_comments_257640.json:
```json
{
    "body": "<a id='comment:7'></a>Is that known upstream?\n\n(I recall we had related discussions, but I don't know whether there's already a similar fix.)",
    "created_at": "2015-04-19T15:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257640",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Is that known upstream?

(I recall we had related discussions, but I don't know whether there's already a similar fix.)



---

archive/issue_comments_257641.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 leif]:\n> Is that known upstream?\n\n\nOoops, saw the \"reported upstream\" too late.\n\nBut isn't there already an upstream patch (or at least an issue on github)?",
    "created_at": "2015-04-19T15:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257641",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Replying to [comment:7 leif]:
> Is that known upstream?


Ooops, saw the "reported upstream" too late.

But isn't there already an upstream patch (or at least an issue on github)?



---

archive/issue_comments_257642.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+with gcc 4.9.2, we hit this bug:\n \n+[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)\n+The <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:\n+\n+```\n+/usr/include/c++/4.9.0/cstddef:51:11: error: \u2018::max_align_t\u2019 has not been declared\n+   using ::max_align_t;\n+```\n+\n+This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)\n+\n+The workaround suggested by the gcc people appears to work. \n \n Upstream: Reported upstream. Developers acknowledge bug.\n \n```\n",
    "created_at": "2015-04-19T18:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257642",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,16 @@
+with gcc 4.9.2, we hit this bug:
 
+[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)
+The <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:
+
+```
+/usr/include/c++/4.9.0/cstddef:51:11: error: ‘::max_align_t’ has not been declared
+   using ::max_align_t;
+```
+
+This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)
+
+The workaround suggested by the gcc people appears to work. 
 
 Upstream: Reported upstream. Developers acknowledge bug.
 
```




---

archive/issue_comments_257643.json:
```json
{
    "body": "<a id='comment:9'></a>(fixed the link to sage-devel)\n\nmy understanding is that upstream is not in hurry to fix this properly, as it's not easy.",
    "created_at": "2015-04-19T18:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257643",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>(fixed the link to sage-devel)

my understanding is that upstream is not in hurry to fix this properly, as it's not easy.



---

archive/issue_comments_257644.json:
```json
{
    "body": "<a id='comment:10'></a>Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\nSo you should probably send some fix upstream as well (and/or open a new issue on github).\n\n(\"Developers acknowledge bug\" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)\n\n\n\n\nAs `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?",
    "created_at": "2015-04-19T18:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257644",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).

So you should probably send some fix upstream as well (and/or open a new issue on github).

("Developers acknowledge bug" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)




As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?



---

archive/issue_comments_257645.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 leif]:\n> Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\n\nthere is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ\n(I suppose that no denial means an acknowledgement)\n\nI just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153\n\n> \n> So you should probably send some fix upstream as well (and/or open a new issue on github).\n> \n> (\"Developers acknowledge bug\" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)\n> \n> \n> As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?\n\n\nthe former need to be touched as `<cstddef>` must be the very 1st include!",
    "created_at": "2015-04-19T18:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257645",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:10 leif]:
> Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).


there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ
(I suppose that no denial means an acknowledgement)

I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153

> 
> So you should probably send some fix upstream as well (and/or open a new issue on github).
> 
> ("Developers acknowledge bug" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)
> 
> 
> As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?


the former need to be touched as `<cstddef>` must be the very 1st include!



---

archive/issue_comments_257646.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> Replying to [comment:10 leif]:\n> > Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\n> \n> there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ\n> (I suppose that no denial means an acknowledgement)\n\n\n:-)  So this ticket will set itself to \"positive review\" after a while as well...\n\n> I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153\n\n\nOk.\n\n\n\n\n> > As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?\n\n> \n> the former need to be touched as `<cstddef>` must be the very 1st include!\n\n\nOk, the real problem is that **mpirxx.h** includes mpir.h too late, but it's not the purpose of this ticket to optimize the order of inclusions in MPIR's headers.\n\nStill, I'd remove the `/* for size_t */` when including `cstddef`.  Otherwise looks ok to me, but I can't test this right now.",
    "created_at": "2015-04-19T19:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257646",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> Replying to [comment:10 leif]:
> > Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).

> 
> there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ
> (I suppose that no denial means an acknowledgement)


:-)  So this ticket will set itself to "positive review" after a while as well...

> I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153


Ok.




> > As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?

> 
> the former need to be touched as `<cstddef>` must be the very 1st include!


Ok, the real problem is that **mpirxx.h** includes mpir.h too late, but it's not the purpose of this ticket to optimize the order of inclusions in MPIR's headers.

Still, I'd remove the `/* for size_t */` when including `cstddef`.  Otherwise looks ok to me, but I can't test this right now.



---

archive/issue_comments_257647.json:
```json
{
    "body": "<a id='comment:13'></a>P.S.:  I'd also like to see the patches to both files in a single patch with the issue in its filename, especially since `SPKG.txt` apparently no longer gets updated.",
    "created_at": "2015-04-19T20:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257647",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>P.S.:  I'd also like to see the patches to both files in a single patch with the issue in its filename, especially since `SPKG.txt` apparently no longer gets updated.



---

archive/issue_comments_257648.json:
```json
{
    "body": "<a id='comment:14'></a>Oh, this is weird:\n\nWhile with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\nIn the failing builds, GCC complains about\n\n```\n../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'\n VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)\n ^\n../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here\n VectorArrayAPI::convert(const mpz_class& v1, long int& v2)\n ^\n```\nmultiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.\n\nThis **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.",
    "created_at": "2015-04-19T21:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257648",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Oh, this is weird:

While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).

In the failing builds, GCC complains about

```
../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'
 VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)
 ^
../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here
 VectorArrayAPI::convert(const mpz_class& v1, long int& v2)
 ^
```
multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.

This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.



---

archive/issue_comments_257649.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 leif]:\n> Oh, this is weird:\n> \n> While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\n\nsorry, what is the compiler you are using?",
    "created_at": "2015-04-19T23:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257649",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Replying to [comment:14 leif]:
> Oh, this is weird:
> 
> While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).


sorry, what is the compiler you are using?



---

archive/issue_comments_257650.json:
```json
{
    "body": "<a id='comment:16'></a>The patch/patches should be documented in the header (free-form text before the first chunk). Not in the filesystem metadata, and not in other files (like SPKG.txt)",
    "created_at": "2015-04-19T23:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257650",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>The patch/patches should be documented in the header (free-form text before the first chunk). Not in the filesystem metadata, and not in other files (like SPKG.txt)



---

archive/issue_comments_257651.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 dimpase]:\n> Replying to [comment:14 leif]:\n> > Oh, this is weird:\n> > \n> > While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\n> \n> sorry, what is the compiler you are using?\n\n\nFSF GCC 4.8.4, FSF GCC 4.9.2, and the first release candidate of FSF GCC 5.0.1, i.e., no versions from distros / all vanilla.",
    "created_at": "2015-04-19T23:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257651",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>Replying to [comment:15 dimpase]:
> Replying to [comment:14 leif]:
> > Oh, this is weird:
> > 
> > While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).

> 
> sorry, what is the compiler you are using?


FSF GCC 4.8.4, FSF GCC 4.9.2, and the first release candidate of FSF GCC 5.0.1, i.e., no versions from distros / all vanilla.



---

archive/issue_comments_257652.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 vbraun]:\n> Not in the filesystem metadata, and not in other files (like SPKG.txt)\n\n\nWell, a \"verbose\" filename *in addition* is also helpful; *which files* get patched can easily be extracted from the patch, and other patches may modify the same file(s).",
    "created_at": "2015-04-19T23:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257652",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>Replying to [comment:16 vbraun]:
> Not in the filesystem metadata, and not in other files (like SPKG.txt)


Well, a "verbose" filename *in addition* is also helpful; *which files* get patched can easily be extracted from the patch, and other patches may modify the same file(s).



---

archive/issue_comments_257653.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:14 leif]:\n> Oh, this is weird:\n> \n> While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n> \n> In the failing builds, GCC complains about\n> \n> ```\n> ../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'\n>  VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)\n>  ^\n> ../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here\n>  VectorArrayAPI::convert(const mpz_class& v1, long int& v2)\n>  ^\n> ```\n> multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.\n> \n> This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.\n> \n\n\nI don't see any errors in my `logs/pkg/4ti2.log` with Sage's gcc 4.9.2 (neither on several versions of Linux x64 or i386, nor on OSX 10.10.3). Unless you can explain how to reproduce your problem, I don't think I can do anything with this.",
    "created_at": "2015-04-20T07:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257653",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Replying to [comment:14 leif]:
> Oh, this is weird:
> 
> While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).
> 
> In the failing builds, GCC complains about
> 
> ```
> ../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'
>  VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)
>  ^
> ../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here
>  VectorArrayAPI::convert(const mpz_class& v1, long int& v2)
>  ^
> ```
> multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.
> 
> This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.
> 


I don't see any errors in my `logs/pkg/4ti2.log` with Sage's gcc 4.9.2 (neither on several versions of Linux x64 or i386, nor on OSX 10.10.3). Unless you can explain how to reproduce your problem, I don't think I can do anything with this.



---

archive/issue_comments_257654.json:
```json
{
    "body": "<a id='comment:20'></a>I don't think either that this is connected with MPIR\n\nofftopic:\nI see the same redefinition error as above when trying to build recent Macaulay2 on Fedora21 64 bit\n\nIt must be the case that '_4ti2_HAVE_MPZ_INT64_CONVERSION' for whatever reasons is not defined\n(and '_4ti2_int64_t' is probably the same as a 'long int' on a 64 bit, causing the redefinition error)",
    "created_at": "2015-04-24T23:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257654",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:20'></a>I don't think either that this is connected with MPIR

offtopic:
I see the same redefinition error as above when trying to build recent Macaulay2 on Fedora21 64 bit

It must be the case that '_4ti2_HAVE_MPZ_INT64_CONVERSION' for whatever reasons is not defined
(and '_4ti2_int64_t' is probably the same as a 'long int' on a 64 bit, causing the redefinition error)



---

archive/issue_comments_257655.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 jakobkroeker]:\n> I don't think either that this is connected with MPIR\n\n\n\"either\"? Which comment are you replying to? It's not clear to me, sorry...",
    "created_at": "2015-04-25T00:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257655",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Replying to [comment:20 jakobkroeker]:
> I don't think either that this is connected with MPIR


"either"? Which comment are you replying to? It's not clear to me, sorry...



---

archive/issue_comments_257656.json:
```json
{
    "body": "<a id='comment:22'></a>> \"either\"? Which comment are you replying to? It's not clear to me, sorry...\n\n\n I just misreaded comment 19, it is probably too late for me, sorry. Drop 'either'.\n\n`@`leif\nit seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \ng++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\nPlease check if that is indeed the case.",
    "created_at": "2015-04-25T00:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257656",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:22'></a>> "either"? Which comment are you replying to? It's not clear to me, sorry...


 I just misreaded comment 19, it is probably too late for me, sorry. Drop 'either'.

`@`leif
it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.
Please check if that is indeed the case.



---

archive/issue_comments_257657.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-25T00:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_257658.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-25T00:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257658",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_257659.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                          |                                |\n> |------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n> |[933c5c5](http://git.sagemath.org/sage.git/commit/?id=933c5c587943027944e226bc3b3b80181f22e967)|`merged patch files, renamed...`|\n\n\noops, I messed up.",
    "created_at": "2015-04-25T00:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257659",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>Replying to [comment:23 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                          |                                |
> |------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
> |[933c5c5](http://git.sagemath.org/sage.git/commit/?id=933c5c587943027944e226bc3b3b80181f22e967)|`merged patch files, renamed...`|


oops, I messed up.



---

archive/issue_comments_257660.json:
```json
{
    "body": "<a id='comment:25'></a>New commits:",
    "created_at": "2015-04-25T05:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257660",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>New commits:



---

archive/issue_comments_257661.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-25T06:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_257662.json:
```json
{
    "body": "<a id='comment:27'></a>fixed the error in the previous commit. Ready for review now.",
    "created_at": "2015-04-25T06:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257662",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>fixed the error in the previous commit. Ready for review now.



---

archive/issue_comments_257663.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-25T06:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257663",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_257664.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:22 jakobkroeker]:\n> `@`leif\n> it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \n> g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\n> Please check if that is indeed the case.\n\n\nFWIW, **without** setting any `CXXFLAGS` (just from the logs),\n\nwith GCC 4.8:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... no\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... no\nchecking whether we can convert between int64_t and mpz_class... no\n...\n```\n\nWith GCC 4.9:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... no\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... no\nchecking whether we can convert between int64_t and mpz_class... no\n...\n```\n\nWith GCC 5.1:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... yes\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... yes\nchecking whether we can convert between int64_t and mpz_class... yes\n...\n```\n\nIn all cases, the C++ sources are compiled with `-std=c++0x` by the way, and\n\n```sh\n$ for v in 4.4 4.8 4.9 5.0 5.1; do echo -n \"g++ $v:  \"; g++-$v -E -dM -x c++ -std=c++0x /dev/null | grep __cplusplus; done\ng++ 4.4:  #define __cplusplus 1\ng++ 4.8:  #define __cplusplus 201103L\ng++ 4.9:  #define __cplusplus 201103L\ng++ 5.0:  #define __cplusplus 201103L\ng++ 5.1:  #define __cplusplus 201103L\n```\nso there doesn't seem to be any difference (in case the version is checked in the source files).\n\n\n\n\nHaven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)",
    "created_at": "2015-04-25T15:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257664",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>Replying to [comment:22 jakobkroeker]:
> `@`leif
> it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
> g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.
> Please check if that is indeed the case.


FWIW, **without** setting any `CXXFLAGS` (just from the logs),

with GCC 4.8:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... no
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... no
checking whether we can convert between int64_t and mpz_class... no
...
```

With GCC 4.9:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... no
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... no
checking whether we can convert between int64_t and mpz_class... no
...
```

With GCC 5.1:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... yes
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... yes
checking whether we can convert between int64_t and mpz_class... yes
...
```

In all cases, the C++ sources are compiled with `-std=c++0x` by the way, and

```sh
$ for v in 4.4 4.8 4.9 5.0 5.1; do echo -n "g++ $v:  "; g++-$v -E -dM -x c++ -std=c++0x /dev/null | grep __cplusplus; done
g++ 4.4:  #define __cplusplus 1
g++ 4.8:  #define __cplusplus 201103L
g++ 4.9:  #define __cplusplus 201103L
g++ 5.0:  #define __cplusplus 201103L
g++ 5.1:  #define __cplusplus 201103L
```
so there doesn't seem to be any difference (in case the version is checked in the source files).




Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)



---

archive/issue_comments_257665.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 leif]:\n> Replying to [comment:22 jakobkroeker]:\n> > it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \n> > g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\n\n\nAs posted, they fail, but for a different reason... (see below)\n\n> Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)\n\n\nOk, sorry, my bad:  I had only rebuilt MPIR with GCC 5.1, and so 4ti2's conversion checks failed with the earlier versions (4.8.4 and 4.9.2) due to a rather unrelated linker error.\n\n\n\n\nDima, if nobody objects, I think you can set the ticket to positive review.  (Although \"GCC 4.9 work-around\" stills seems a bit misleading, as it's not a compiler bug. ;-) )",
    "created_at": "2015-04-25T16:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257665",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>Replying to [comment:28 leif]:
> Replying to [comment:22 jakobkroeker]:
> > it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
> > g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.


As posted, they fail, but for a different reason... (see below)

> Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)


Ok, sorry, my bad:  I had only rebuilt MPIR with GCC 5.1, and so 4ti2's conversion checks failed with the earlier versions (4.8.4 and 4.9.2) due to a rather unrelated linker error.




Dima, if nobody objects, I think you can set the ticket to positive review.  (Although "GCC 4.9 work-around" stills seems a bit misleading, as it's not a compiler bug. ;-) )



---

archive/issue_comments_257666.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-25T19:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257666",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_257667.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-26T02:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257667",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051534.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-26T02:21:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18240#event-51534"
}
```



---

archive/issue_comments_257668.json:
```json
{
    "body": "<a id='comment:32'></a>please see an update on https://github.com/wbhart/mpir/issues/153",
    "created_at": "2015-06-10T09:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18240#issuecomment-257668",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>please see an update on https://github.com/wbhart/mpir/issues/153
