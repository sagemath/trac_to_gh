# Issue 18240: fix MPIR's compliance with c++

archive/issues_018003.json:
```json
{
    "assignees": [],
    "body": "with gcc 4.9.2, we hit this bug:\n\n[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)\nThe <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:\n\n```\n/usr/include/c++/4.9.0/cstddef:51:11: error: \u2018::max_align_t\u2019 has not been declared\n   using ::max_align_t;\n```\n\nThis has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)\n\nThe workaround suggested by the gcc people appears to work. \n\nCC:  @vbraun @nexttime @wbhart\n\nBranch: **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Jakob Kroeker, Leif Leonhardy**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18240_\n\n",
    "closed_at": "2015-04-26T02:21:48Z",
    "created_at": "2015-04-17T14:12:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix MPIR's compliance with c++",
    "type": "issue",
    "updated_at": "2015-06-10T09:20:28Z",
    "url": "https://github.com/sagemath/sage/issues/18240",
    "user": "https://github.com/dimpase"
}
```
with gcc 4.9.2, we hit this bug:

[Header <cstddef> changes](https://gcc.gnu.org/gcc-4.9/porting_to.html)
The <cstddef> header was updated for C++11 support and this breaks some libraries which misuse macros meant for internal use by GCC only. For instance with GMP versions up to 5.1.3, you may see:

```
/usr/include/c++/4.9.0/cstddef:51:11: error: ‘::max_align_t’ has not been declared
   using ::max_align_t;
```

This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)

The workaround suggested by the gcc people appears to work. 

CC:  @vbraun @nexttime @wbhart

Branch: **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Jakob Kroeker, Leif Leonhardy**

Author: **Dima Pasechnik**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/18240_





---

archive/issue_events_260543.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T14:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260543"
}
```



---

archive/issue_events_260544.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T14:12:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260544"
}
```



---

archive/issue_events_260545.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T14:12:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260545"
}
```



---

archive/issue_events_260546.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T14:12:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260546"
}
```



---

archive/issue_comments_249927.json:
```json
{
    "body": "Branch: **[u/dimpase/18240](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/18240)**",
    "created_at": "2015-04-17T18:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249927",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/18240](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/18240)**



---

archive/issue_comments_249928.json:
```json
{
    "body": "Commit: **[`d358636`](https://github.com/sagemath/sagetrac-mirror/commit/d358636766bf0abae69bb07f154053180bd14a8a)**",
    "created_at": "2015-04-17T18:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249928",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`d358636`](https://github.com/sagemath/sagetrac-mirror/commit/d358636766bf0abae69bb07f154053180bd14a8a)**



---

archive/issue_comments_249929.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2015-04-17T18:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249929",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_260547.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T18:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260547"
}
```



---

archive/issue_comments_249930.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)\n \n-The workaround suggested appears to work. A patch follows shortly.\n+The workaround suggested by the gcc people appears to work. \n``````\n",
    "created_at": "2015-04-17T18:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249930",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)
 
-The workaround suggested appears to work. A patch follows shortly.
+The workaround suggested by the gcc people appears to work. 
``````




---

archive/issue_events_260548.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T18:11:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "title_is": "fix MIPR's compliance with c++",
    "title_was": "fix MIPRs compliance with c++",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260548"
}
```



---

archive/issue_events_260549.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-17T18:12:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "title_is": "fix MPIR's compliance with c++",
    "title_was": "fix MIPR's compliance with c++",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260549"
}
```



---

archive/issue_comments_249931.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nneedless to say, after pulling in the change, one has to `sage -f mpir` (ideally followed up by `make` -  but this will rebuild half of Sage for nothing, apart from an extra check).",
    "created_at": "2015-04-17T18:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249931",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

needless to say, after pulling in the change, one has to `sage -f mpir` (ideally followed up by `make` -  but this will rebuild half of Sage for nothing, apart from an extra check).



---

archive/issue_events_260550.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-19T15:35:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260550"
}
```



---

archive/issue_events_260551.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-19T15:35:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260551"
}
```



---

archive/issue_comments_249932.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIs that known upstream?\n\n(I recall we had related discussions, but I don't know whether there's already a similar fix.)",
    "created_at": "2015-04-19T15:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249932",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Is that known upstream?

(I recall we had related discussions, but I don't know whether there's already a similar fix.)



---

archive/issue_comments_249933.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nexttime](#comment:7):\n> Is that known upstream?\n\nOoops, saw the \"reported upstream\" too late.\n\nBut isn't there already an upstream patch (or at least an issue on github)?",
    "created_at": "2015-04-19T15:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249933",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nexttime](#comment:7):
> Is that known upstream?

Ooops, saw the "reported upstream" too late.

But isn't there already an upstream patch (or at least an issue on github)?



---

archive/issue_comments_249934.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,6 @@\n    using ::max_align_t;\n ```\n \n-This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)\n+This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)\n \n The workaround suggested by the gcc people appears to work. \n``````\n",
    "created_at": "2015-04-19T18:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249934",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,6 @@
    using ::max_align_t;
 ```
 
-This has hit here: #18198, see also [sage-devel thread](https://gcc.gnu.org/gcc-4.9/porting_to.html)
+This has hit here: #18198, see also [sage-devel thread](https://groups.google.com/d/msg/sage-devel/Tu-egDn-zLw/0S5ouau2J1AJ)
 
 The workaround suggested by the gcc people appears to work. 
``````




---

archive/issue_comments_249935.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n(fixed the link to sage-devel)\n\nmy understanding is that upstream is not in hurry to fix this properly, as it's not easy.",
    "created_at": "2015-04-19T18:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249935",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

(fixed the link to sage-devel)

my understanding is that upstream is not in hurry to fix this properly, as it's not easy.



---

archive/issue_comments_249936.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\nSo you should probably send some fix upstream as well (and/or open a new issue on github).\n\n(\"Developers acknowledge bug\" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)\n\n\n\n\nAs `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?",
    "created_at": "2015-04-19T18:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249936",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).

So you should probably send some fix upstream as well (and/or open a new issue on github).

("Developers acknowledge bug" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)




As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?



---

archive/issue_comments_249937.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@nexttime](#comment:10):\n> Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\nthere is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ\n(I suppose that no denial means an acknowledgement)\n\nI just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153\n\n> \n> So you should probably send some fix upstream as well (and/or open a new issue on github).\n> \n> (\"Developers acknowledge bug\" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)\n> \n> \n> As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?\n\nthe former need to be touched as `<cstddef>` must be the very 1st include!",
    "created_at": "2015-04-19T18:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249937",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@nexttime](#comment:10):
> Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).

there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ
(I suppose that no denial means an acknowledgement)

I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153

> 
> So you should probably send some fix upstream as well (and/or open a new issue on github).
> 
> ("Developers acknowledge bug" -- I'm not sure upstream is really aware of it such that it'll get fixed in the next release.  Bill's pretty busy and there are lots of things he wanted or has to do for the next release IIRC.)
> 
> 
> As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?

the former need to be touched as `<cstddef>` must be the very 1st include!



---

archive/issue_comments_249938.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@dimpase](#comment:11):\n> Replying to [@nexttime](#comment:10):\n> > Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).\n\n> \n> there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ\n> (I suppose that no denial means an acknowledgement)\n\n:-)  So this ticket will set itself to \"positive review\" after a while as well...\n\n> I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153\n\nOk.\n\n\n\n\n> > As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?\n\n> \n> the former need to be touched as `<cstddef>` must be the very 1st include!\n\nOk, the real problem is that **mpirxx.h** includes mpir.h too late, but it's not the purpose of this ticket to optimize the order of inclusions in MPIR's headers.\n\nStill, I'd remove the `/* for size_t */` when including `cstddef`.  Otherwise looks ok to me, but I can't test this right now.",
    "created_at": "2015-04-19T19:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249938",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@dimpase](#comment:11):
> Replying to [@nexttime](#comment:10):
> > Hmmm, I at least haven't found any reply from Bill on mpir-devel, nor any related (open or closed) issue on github (wbhart/mpir).

> 
> there is a post: https://groups.google.com/d/msg/mpir-devel/78Hb2-sGrjQ/1VohfbjBmgUJ
> (I suppose that no denial means an acknowledgement)

:-)  So this ticket will set itself to "positive review" after a while as well...

> I just opened an issue on github, too: https://github.com/wbhart/mpir/issues/153

Ok.




> > As `mpirxx.h` includes `mpir.h`, is it really necessary to touch the former as well?

> 
> the former need to be touched as `<cstddef>` must be the very 1st include!

Ok, the real problem is that **mpirxx.h** includes mpir.h too late, but it's not the purpose of this ticket to optimize the order of inclusions in MPIR's headers.

Still, I'd remove the `/* for size_t */` when including `cstddef`.  Otherwise looks ok to me, but I can't test this right now.



---

archive/issue_comments_249939.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nP.S.:  I'd also like to see the patches to both files in a single patch with the issue in its filename, especially since `SPKG.txt` apparently no longer gets updated.",
    "created_at": "2015-04-19T20:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249939",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

P.S.:  I'd also like to see the patches to both files in a single patch with the issue in its filename, especially since `SPKG.txt` apparently no longer gets updated.



---

archive/issue_comments_249940.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOh, this is weird:\n\nWhile with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\nIn the failing builds, GCC complains about\n\n```\n../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'\n VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)\n ^\n../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here\n VectorArrayAPI::convert(const mpz_class& v1, long int& v2)\n ^\n```\nmultiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.\n\nThis **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.",
    "created_at": "2015-04-19T21:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249940",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

Oh, this is weird:

While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).

In the failing builds, GCC complains about

```
../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'
 VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)
 ^
../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here
 VectorArrayAPI::convert(const mpz_class& v1, long int& v2)
 ^
```
multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.

This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.



---

archive/issue_comments_249941.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@nexttime](#comment:14):\n> Oh, this is weird:\n> \n> While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\nsorry, what is the compiler you are using?",
    "created_at": "2015-04-19T23:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249941",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@nexttime](#comment:14):
> Oh, this is weird:
> 
> While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).

sorry, what is the compiler you are using?



---

archive/issue_comments_249942.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe patch/patches should be documented in the header (free-form text before the first chunk). Not in the filesystem metadata, and not in other files (like SPKG.txt)",
    "created_at": "2015-04-19T23:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249942",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

The patch/patches should be documented in the header (free-form text before the first chunk). Not in the filesystem metadata, and not in other files (like SPKG.txt)



---

archive/issue_comments_249943.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@dimpase](#comment:15):\n> Replying to [@nexttime](#comment:14):\n> > Oh, this is weird:\n> > \n> > While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n\n> \n> sorry, what is the compiler you are using?\n\nFSF GCC 4.8.4, FSF GCC 4.9.2, and the first release candidate of FSF GCC 5.0.1, i.e., no versions from distros / all vanilla.",
    "created_at": "2015-04-19T23:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249943",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@dimpase](#comment:15):
> Replying to [@nexttime](#comment:14):
> > Oh, this is weird:
> > 
> > While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).

> 
> sorry, what is the compiler you are using?

FSF GCC 4.8.4, FSF GCC 4.9.2, and the first release candidate of FSF GCC 5.0.1, i.e., no versions from distros / all vanilla.



---

archive/issue_comments_249944.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@vbraun](#comment:16):\n> Not in the filesystem metadata, and not in other files (like SPKG.txt)\n\nWell, a \"verbose\" filename *in addition* is also helpful; *which files* get patched can easily be extracted from the patch, and other patches may modify the same file(s).",
    "created_at": "2015-04-19T23:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249944",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@vbraun](#comment:16):
> Not in the filesystem metadata, and not in other files (like SPKG.txt)

Well, a "verbose" filename *in addition* is also helpful; *which files* get patched can easily be extracted from the patch, and other patches may modify the same file(s).



---

archive/issue_comments_249945.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@nexttime](#comment:14):\n> Oh, this is weird:\n> \n> While with the patches to MPIR 4ti2-1.6.2 now \"finds\" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).\n> \n> In the failing builds, GCC complains about\n> \n> ```\n> ../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'\n>  VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)\n>  ^\n> ../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here\n>  VectorArrayAPI::convert(const mpz_class& v1, long int& v2)\n>  ^\n> ```\n> multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.\n> \n> This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.\n> \n\nI don't see any errors in my `logs/pkg/4ti2.log` with Sage's gcc 4.9.2 (neither on several versions of Linux x64 or i386, nor on OSX 10.10.3). Unless you can explain how to reproduce your problem, I don't think I can do anything with this.",
    "created_at": "2015-04-20T07:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249945",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@nexttime](#comment:14):
> Oh, this is weird:
> 
> While with the patches to MPIR 4ti2-1.6.2 now "finds" GMP (i.e., MPIR), it doesn't build for me (on Sage 6.6) with GCC 4.8.4 nor 4.9.2, but 5.0.1 (RC1).
> 
> In the failing builds, GCC complains about
> 
> ```
> ../../src/groebner/VectorArrayAPI.h:144:1: error: redefinition of 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]'
>  VectorArrayAPI::convert(const mpz_class& v1, _4ti2_int64_t& v2)
>  ^
> ../../src/groebner/VectorArrayAPI.h:130:1: error: 'static void _4ti2_::VectorArrayAPI::convert(const T1&, T2&) [with T1 = __gmp_expr<__mpz_struct [1], __mpz_struct [1]>; T2 = long int]' previously declared here
>  VectorArrayAPI::convert(const mpz_class& v1, long int& v2)
>  ^
> ```
> multiple times, where apparently only the last is fatal (= not ignored through Make rules); after the first error other things get built and installed.
> 
> This **might** be related to MPIR as well, but I'm not sure, and I guess you also tested with GCC 4.9.2, so I'm a bit puzzled.
> 

I don't see any errors in my `logs/pkg/4ti2.log` with Sage's gcc 4.9.2 (neither on several versions of Linux x64 or i386, nor on OSX 10.10.3). Unless you can explain how to reproduce your problem, I don't think I can do anything with this.



---

archive/issue_comments_249946.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI don't think either that this is connected with MPIR\n\nofftopic:\nI see the same redefinition error as above when trying to build recent Macaulay2 on Fedora21 64 bit\n\nIt must be the case that '_4ti2_HAVE_MPZ_INT64_CONVERSION' for whatever reasons is not defined\n(and '_4ti2_int64_t' is probably the same as a 'long int' on a 64 bit, causing the redefinition error)",
    "created_at": "2015-04-24T23:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249946",
    "user": "https://github.com/sagetrac-jakobkroeker"
}
```

<div id="comment:20" align="right">comment:20</div>

I don't think either that this is connected with MPIR

offtopic:
I see the same redefinition error as above when trying to build recent Macaulay2 on Fedora21 64 bit

It must be the case that '_4ti2_HAVE_MPZ_INT64_CONVERSION' for whatever reasons is not defined
(and '_4ti2_int64_t' is probably the same as a 'long int' on a 64 bit, causing the redefinition error)



---

archive/issue_comments_249947.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@sagetrac-jakobkroeker](#comment:20):\n> I don't think either that this is connected with MPIR\n\n\"either\"? Which comment are you replying to? It's not clear to me, sorry...",
    "created_at": "2015-04-25T00:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249947",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@sagetrac-jakobkroeker](#comment:20):
> I don't think either that this is connected with MPIR

"either"? Which comment are you replying to? It's not clear to me, sorry...



---

archive/issue_comments_249948.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> \"either\"? Which comment are you replying to? It's not clear to me, sorry...\n\n I just misreaded comment 19, it is probably too late for me, sorry. Drop 'either'.\n\n@nexttime\nit seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \ng++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\nPlease check if that is indeed the case.",
    "created_at": "2015-04-25T00:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249948",
    "user": "https://github.com/sagetrac-jakobkroeker"
}
```

<div id="comment:22" align="right">comment:22</div>

> "either"? Which comment are you replying to? It's not clear to me, sorry...

 I just misreaded comment 19, it is probably too late for me, sorry. Drop 'either'.

@nexttime
it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.
Please check if that is indeed the case.



---

archive/issue_comments_249949.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967\"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>\n",
    "created_at": "2015-04-25T00:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249949",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>




---

archive/issue_comments_249950.json:
```json
{
    "body": "Changed commit from **[`d358636`](https://github.com/sagemath/sagetrac-mirror/commit/d358636766bf0abae69bb07f154053180bd14a8a)** to **[`933c5c5`](https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967)**",
    "created_at": "2015-04-25T00:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249950",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d358636`](https://github.com/sagemath/sagetrac-mirror/commit/d358636766bf0abae69bb07f154053180bd14a8a)** to **[`933c5c5`](https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967)**



---

archive/issue_events_260552.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T00:46:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260552"
}
```



---

archive/issue_events_260553.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T00:46:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260553"
}
```



---

archive/issue_comments_249951.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@sagetrac-git](#comment:23):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967\"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>\n\noops, I messed up.",
    "created_at": "2015-04-25T00:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249951",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@sagetrac-git](#comment:23):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>

oops, I messed up.



---

archive/issue_comments_249952.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967\"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>\n",
    "created_at": "2015-04-25T05:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249952",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967"><code>933c5c5</code></a></td><td><code>merged patch files, renamed...</code></td></tr></table>




---

archive/issue_comments_249953.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47\"><code>6785ef2</code></a></td><td><code>restored wrongly removed file, and deleted one that should have gone</code></td></tr></table>\n",
    "created_at": "2015-04-25T06:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249953",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47"><code>6785ef2</code></a></td><td><code>restored wrongly removed file, and deleted one that should have gone</code></td></tr></table>




---

archive/issue_comments_249954.json:
```json
{
    "body": "Changed commit from **[`933c5c5`](https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967)** to **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**",
    "created_at": "2015-04-25T06:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249954",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`933c5c5`](https://github.com/sagemath/sagetrac-mirror/commit/933c5c587943027944e226bc3b3b80181f22e967)** to **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**



---

archive/issue_comments_249955.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nfixed the error in the previous commit. Ready for review now.",
    "created_at": "2015-04-25T06:08:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249955",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

fixed the error in the previous commit. Ready for review now.



---

archive/issue_events_260554.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T06:08:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260554"
}
```



---

archive/issue_events_260555.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T06:08:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260555"
}
```



---

archive/issue_comments_249956.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@sagetrac-jakobkroeker](#comment:22):\n> @nexttime\n> it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \n> g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\n> Please check if that is indeed the case.\n\nFWIW, **without** setting any `CXXFLAGS` (just from the logs),\n\nwith GCC 4.8:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... no\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... no\nchecking whether we can convert between int64_t and mpz_class... no\n...\n```\n\nWith GCC 4.9:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... no\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... no\nchecking whether we can convert between int64_t and mpz_class... no\n...\n```\n\nWith GCC 5.1:\n\n```\n...\nchecking whether C++ compiler accepts -std=c++0x... yes\nchecking whether C++ compiler accepts -ftrapv... yes\nchecking whether -ftrapv actually seems to work for int... yes\nchecking whether -ftrapv actually seems to work for long long... no\n...\nchecking whether we can use the int32_t and int64_t types... yes\nchecking whether we can convert between int32_t and mpz_class... yes\nchecking whether we can convert between int64_t and mpz_class... yes\n...\n```\n\nIn all cases, the C++ sources are compiled with `-std=c++0x` by the way, and\n\n```sh\n$ for v in 4.4 4.8 4.9 5.0 5.1; do echo -n \"g++ $v:  \"; g++-$v -E -dM -x c++ -std=c++0x /dev/null | grep __cplusplus; done\ng++ 4.4:  #define __cplusplus 1\ng++ 4.8:  #define __cplusplus 201103L\ng++ 4.9:  #define __cplusplus 201103L\ng++ 5.0:  #define __cplusplus 201103L\ng++ 5.1:  #define __cplusplus 201103L\n```\nso there doesn't seem to be any difference (in case the version is checked in the source files).\n\n\n\n\nHaven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)",
    "created_at": "2015-04-25T15:34:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249956",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@sagetrac-jakobkroeker](#comment:22):
> @nexttime
> it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
> g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.
> Please check if that is indeed the case.

FWIW, **without** setting any `CXXFLAGS` (just from the logs),

with GCC 4.8:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... no
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... no
checking whether we can convert between int64_t and mpz_class... no
...
```

With GCC 4.9:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... no
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... no
checking whether we can convert between int64_t and mpz_class... no
...
```

With GCC 5.1:

```
...
checking whether C++ compiler accepts -std=c++0x... yes
checking whether C++ compiler accepts -ftrapv... yes
checking whether -ftrapv actually seems to work for int... yes
checking whether -ftrapv actually seems to work for long long... no
...
checking whether we can use the int32_t and int64_t types... yes
checking whether we can convert between int32_t and mpz_class... yes
checking whether we can convert between int64_t and mpz_class... yes
...
```

In all cases, the C++ sources are compiled with `-std=c++0x` by the way, and

```sh
$ for v in 4.4 4.8 4.9 5.0 5.1; do echo -n "g++ $v:  "; g++-$v -E -dM -x c++ -std=c++0x /dev/null | grep __cplusplus; done
g++ 4.4:  #define __cplusplus 1
g++ 4.8:  #define __cplusplus 201103L
g++ 4.9:  #define __cplusplus 201103L
g++ 5.0:  #define __cplusplus 201103L
g++ 5.1:  #define __cplusplus 201103L
```
so there doesn't seem to be any difference (in case the version is checked in the source files).




Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)



---

archive/issue_comments_249957.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@nexttime](#comment:28):\n> Replying to [@sagetrac-jakobkroeker](#comment:22):\n> > it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case \n> > g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.\n\nAs posted, they fail, but for a different reason... (see below)\n\n> Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)\n\nOk, sorry, my bad:  I had only rebuilt MPIR with GCC 5.1, and so 4ti2's conversion checks failed with the earlier versions (4.8.4 and 4.9.2) due to a rather unrelated linker error.\n\n\n\n\nDima, if nobody objects, I think you can set the ticket to positive review.  (Although \"GCC 4.9 work-around\" stills seems a bit misleading, as it's not a compiler bug. ;-) )",
    "created_at": "2015-04-25T16:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249957",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@nexttime](#comment:28):
> Replying to [@sagetrac-jakobkroeker](#comment:22):
> > it seems that the HAVE_MPZ_INT64_CONVERSION check by the configure script fails in case 
> > g++ is used without enabling c++ 2011 standard. When using g++ with '-std=c++11'  flag (or similar), the  HAVE_MPZ_INT64_CONVERSION check should succeed and define '_4ti2_HAVE_MPZ_INT64_CONVERSION'.

As posted, they fail, but for a different reason... (see below)

> Haven't digged deeper yet.  (Should take a look at the `config.log`s, and `configure`.)

Ok, sorry, my bad:  I had only rebuilt MPIR with GCC 5.1, and so 4ti2's conversion checks failed with the earlier versions (4.8.4 and 4.9.2) due to a rather unrelated linker error.




Dima, if nobody objects, I think you can set the ticket to positive review.  (Although "GCC 4.9 work-around" stills seems a bit misleading, as it's not a compiler bug. ;-) )



---

archive/issue_comments_249958.json:
```json
{
    "body": "Reviewer: **Jakob Kroeker, Leif Leonhardy**",
    "created_at": "2015-04-25T16:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249958",
    "user": "https://github.com/nexttime"
}
```

Reviewer: **Jakob Kroeker, Leif Leonhardy**



---

archive/issue_events_260556.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T19:39:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260556"
}
```



---

archive/issue_events_260557.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-04-25T19:39:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260557"
}
```



---

archive/issue_comments_249959.json:
```json
{
    "body": "Changed branch from **[u/dimpase/18240](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/18240)** to **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**",
    "created_at": "2015-04-26T02:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249959",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/18240](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/18240)** to **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)**



---

archive/issue_events_260558.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-26T02:21:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260558"
}
```



---

archive/issue_events_260559.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5b5a4c0d4d0ea81489406cf284b1c707c1cc6572",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-26T02:21:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18240#event-260559"
}
```



---

archive/issue_comments_249960.json:
```json
{
    "body": "Changed commit from **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)** to none",
    "created_at": "2015-06-10T09:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249960",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`6785ef2`](https://github.com/sagemath/sagetrac-mirror/commit/6785ef2000d220f511fcf3e9830b05099500ef47)** to none



---

archive/issue_comments_249961.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nplease see an update on https://github.com/wbhart/mpir/issues/153",
    "created_at": "2015-06-10T09:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249961",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

please see an update on https://github.com/wbhart/mpir/issues/153



---

archive/issue_comments_249962.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2015-06-10T09:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18240#issuecomment-249962",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**
