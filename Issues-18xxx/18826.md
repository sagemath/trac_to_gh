# Issue 18826: A sage-sanity-check-package using the 'spkg-src' scripts

archive/issues_018589.json:
```json
{
    "body": "Hello everybody,\n\nThis branch adds a \"sage-sanity-check-package\" script that uses the 'spkg-src'\nscripts. The goal is to have an easy way to check, when a new-style package gets\nudpated, that the new package is precisely \"spkg-src\" builds.\n\nRight now our 'spkg-spkg' scripts all do different things. In order to use\n'spkg-src' scripts in an automatic way, I made the following assumption:\n\n- When `./sage-src' is run in a build/pkg/<package>/ folder, it creates the\n  package archive whose name is described in checksums.ini\n\n- There is un upstream/ an archive with the same name\n\n- Their contents are compared with 'diff -r'\n\nCurrently, almost none of our packages satisfy those assumptions (*).\n\nWhat would you think of having a script like that? That would 'normalize' the\nsituations of our spkg-src scripts, and we will solve the many inconsistencies\nin our packaging. That will also make sure that everything we do on a package is\nlisted by the spkg-src script.\n\nHave fun,\n\nNathann\n\n(*) Some seem to, but then they are named file.tar.gz while the file is not\ngzipped. Or else the file in upstream/ is not exactly what is in\nchecksum.ini. Or spkg-src downloads the *latest version* instead of the one\n    whose version is hardcoded in checsksums.ini. You get the picture.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18826\n\n",
    "closed_at": "2022-09-01T02:30:35Z",
    "created_at": "2015-06-30T12:48:13Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "A sage-sanity-check-package using the 'spkg-src' scripts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18826",
    "user": "https://github.com/nathanncohen"
}
```
Hello everybody,

This branch adds a "sage-sanity-check-package" script that uses the 'spkg-src'
scripts. The goal is to have an easy way to check, when a new-style package gets
udpated, that the new package is precisely "spkg-src" builds.

Right now our 'spkg-spkg' scripts all do different things. In order to use
'spkg-src' scripts in an automatic way, I made the following assumption:

- When `./sage-src' is run in a build/pkg/<package>/ folder, it creates the
  package archive whose name is described in checksums.ini

- There is un upstream/ an archive with the same name

- Their contents are compared with 'diff -r'

Currently, almost none of our packages satisfy those assumptions (*).

What would you think of having a script like that? That would 'normalize' the
situations of our spkg-src scripts, and we will solve the many inconsistencies
in our packaging. That will also make sure that everything we do on a package is
listed by the spkg-src script.

Have fun,

Nathann

(*) Some seem to, but then they are named file.tar.gz while the file is not
gzipped. Or else the file in upstream/ is not exactly what is in
checksum.ini. Or spkg-src downloads the *latest version* instead of the one
    whose version is hardcoded in checsksums.ini. You get the picture.

Issue created by migration from https://trac.sagemath.org/ticket/18826





---

archive/issue_comments_252583.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-30T12:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252583",
    "user": "https://github.com/nathanncohen"
}
```

New commits:



---

archive/issue_comments_252584.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-30T12:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252584",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_252585.json:
```json
{
    "body": "sage-src scripts are just symptoms of failures of our package system. Instead of formalizing those hacks we should try to understand what is missing. IMHO:\n* we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini\n* most sage-src scripts probably exist because we want to delete stuff from the tarball to bring it to a manageable size. The globs of files to delete should be stored in a file, no need to have executable scripts floating about",
    "created_at": "2015-06-30T13:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252585",
    "user": "https://github.com/vbraun"
}
```

sage-src scripts are just symptoms of failures of our package system. Instead of formalizing those hacks we should try to understand what is missing. IMHO:
* we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini
* most sage-src scripts probably exist because we want to delete stuff from the tarball to bring it to a manageable size. The globs of files to delete should be stored in a file, no need to have executable scripts floating about



---

archive/issue_comments_252586.json:
```json
{
    "body": "And:\n* Recompress in a format that we can handle with the Sage prerequisites; this ought to be a special case no \"files to delete\"",
    "created_at": "2015-06-30T13:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252586",
    "user": "https://github.com/vbraun"
}
```

And:
* Recompress in a format that we can handle with the Sage prerequisites; this ought to be a special case no "files to delete"



---

archive/issue_comments_252587.json:
```json
{
    "body": "I agree that we are still a long way from having a clean build system, but what I want to do with this script is to help us clean the packages progressively.\n\nIf you want to implement the ideas you proposed, your only way to make them work will be to fix all packages at once. I don't think that it can be done, and I do not expect anybody to do it.\n\nIf we agree on some formalism for `spkg-src`, we can start precisely this work: make sure that everything we do to a package is done there. This way if we ever want to move to something more constraining, we will know at least what we have to deal with.\n\nIn the immediate future, however, that would help a reviewer check that the 'updated package' proposed for review is only what it claims to be. No code was injected (to be run on everybody's computer), and also check that everything that is done appears in `spkg-src`.\n\nThus, I still think that such a script would be a good addition: along with a rule that we should only accept spkg-src scripts that fit the assumptions (those are open to discussion). And slowly, we will add new spkg-src files and stabilize the situation.\n\nNathann",
    "created_at": "2015-06-30T13:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252587",
    "user": "https://github.com/nathanncohen"
}
```

I agree that we are still a long way from having a clean build system, but what I want to do with this script is to help us clean the packages progressively.

If you want to implement the ideas you proposed, your only way to make them work will be to fix all packages at once. I don't think that it can be done, and I do not expect anybody to do it.

If we agree on some formalism for `spkg-src`, we can start precisely this work: make sure that everything we do to a package is done there. This way if we ever want to move to something more constraining, we will know at least what we have to deal with.

In the immediate future, however, that would help a reviewer check that the 'updated package' proposed for review is only what it claims to be. No code was injected (to be run on everybody's computer), and also check that everything that is done appears in `spkg-src`.

Thus, I still think that such a script would be a good addition: along with a rule that we should only accept spkg-src scripts that fit the assumptions (those are open to discussion). And slowly, we will add new spkg-src files and stabilize the situation.

Nathann



---

archive/issue_comments_252588.json:
```json
{
    "body": "You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.",
    "created_at": "2015-06-30T16:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252588",
    "user": "https://github.com/jdemeyer"
}
```

You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.



---

archive/issue_comments_252589.json:
```json
{
    "body": "> You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.\n\n\nIn this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs. If the autotoolizing is done by upstream, however, that's no problem.\n\nLet us talk about solutions instead of just raising the problems: how do we address that?\n\nI did not plan to have this script be anything else than a helper tool to review packages. On the other hand, we must have a way to check the sanity of the packages.\n\nOf the packages which are autotoolized by our 'spkg-src' scripts, I would not be at all surprised to find out that they are like this because... its authors are Sage developpers.\n\nNathann",
    "created_at": "2015-06-30T16:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252589",
    "user": "https://github.com/nathanncohen"
}
```

> You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.


In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs. If the autotoolizing is done by upstream, however, that's no problem.

Let us talk about solutions instead of just raising the problems: how do we address that?

I did not plan to have this script be anything else than a helper tool to review packages. On the other hand, we must have a way to check the sanity of the packages.

Of the packages which are autotoolized by our 'spkg-src' scripts, I would not be at all surprised to find out that they are like this because... its authors are Sage developpers.

Nathann



---

archive/issue_comments_252590.json:
```json
{
    "body": "I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.\n\nI'd like to modify the assumptions a bit though:\n1. The `spkg-src` script should only be run within a Sage shell.\n2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n3. The tarball should be created in the `$SAGE_DISTFILES` directory.\n4. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\nSo, `./sage --sh build/pkgs/PKGNAME/spkg-src` should \"just work\".",
    "created_at": "2015-06-30T16:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252590",
    "user": "https://github.com/jdemeyer"
}
```

I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.

I'd like to modify the assumptions a bit though:
1. The `spkg-src` script should only be run within a Sage shell.
2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)
3. The tarball should be created in the `$SAGE_DISTFILES` directory.
4. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.

So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should "just work".



---

archive/issue_comments_252591.json:
```json
{
    "body": "Replying to [comment:6 ncohen]:\n> In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs.\n\nThis is solved by the `autotools` experimental package, which enforces a particular version of `configure` and similar programs.",
    "created_at": "2015-06-30T16:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252591",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 ncohen]:
> In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs.

This is solved by the `autotools` experimental package, which enforces a particular version of `configure` and similar programs.



---

archive/issue_comments_252592.json:
```json
{
    "body": "Replying to [comment:6 ncohen]:\n> I did not plan to have this script be anything else than a helper tool to review packages.\n\n\nYou want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo.",
    "created_at": "2015-06-30T16:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252592",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:6 ncohen]:
> I did not plan to have this script be anything else than a helper tool to review packages.


You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo.



---

archive/issue_comments_252593.json:
```json
{
    "body": "Yooooooooooo !\n\n> I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.\n\n\nYep `T_T`\n\n> I'd like to modify the assumptions a bit though:\n> 1. The `spkg-src` script should only be run within a Sage shell.\n\n\nHow can you check that? Or do you mean that my script should only run them from the inside of a sage shell? If so, would replacing 'spkg-src' with 'sage -sh spkg-src' in the script be sufficient?\n\n> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n\n\nI do not know how to check that either. In a preliminary version of my script I wanted to work in a different directory, but I figured out that most spkg-src files would break at this step.\n\n> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n\n\nThat would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?\n\n> 1. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\n\nWell, it will need some temporary directory anyway.\n\n> So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should \"just work\".\n\n\nYou are making requests which would make this script much more restrictive. If you already know how to implement some of them, feel free to add a commit on this public branch (with explicit error messages).\n\nWhen we will have settled on that, we will also have to explain all this (and go over all assumptions) in the developer manual.\n\nThanks,\n\nNathann",
    "created_at": "2015-06-30T16:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252593",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooooooo !

> I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.


Yep `T_T`

> I'd like to modify the assumptions a bit though:
> 1. The `spkg-src` script should only be run within a Sage shell.


How can you check that? Or do you mean that my script should only run them from the inside of a sage shell? If so, would replacing 'spkg-src' with 'sage -sh spkg-src' in the script be sufficient?

> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)


I do not know how to check that either. In a preliminary version of my script I wanted to work in a different directory, but I figured out that most spkg-src files would break at this step.

> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.


That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?

> 1. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.


Well, it will need some temporary directory anyway.

> So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should "just work".


You are making requests which would make this script much more restrictive. If you already know how to implement some of them, feel free to add a commit on this public branch (with explicit error messages).

When we will have settled on that, we will also have to explain all this (and go over all assumptions) in the developer manual.

Thanks,

Nathann



---

archive/issue_comments_252594.json:
```json
{
    "body": "> You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo. \n\n\nIf you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.\n\nNathann",
    "created_at": "2015-06-30T16:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252594",
    "user": "https://github.com/nathanncohen"
}
```

> You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo. 


If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.

Nathann



---

archive/issue_comments_252595.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> How can you check that?\n\nI didn't say that you script should *check* all conditions. We need to define how the `spkg-src` script should be run, so we need to state the conditions precisely.\n\n> Or do you mean that my script should only run them from the inside of a sage shell?\n\nYes.\n\n> > 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n  \n> \n> I do not know how to check that either.\n\n{{{\ncd /\n\"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src\n}}}\n\n> > 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n  \n> \n> That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?\n\n{{{\nSAGE_REAL_DISTFILES=\"$SAGE_DISTFILES\"\nexport SAGE_DISTFILES=/some/temporary/directory\ncd /\n\"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src\ncompare \"$SAGE_REAL_DISTFILES/$TARBALL\" \"$SAGE_DISTFILES/$TARBALL\"\n}}}\n\n> Well, it will need some temporary directory anyway.\n\nI think it could use `$SAGE_DISTFILES` as temporary directory.",
    "created_at": "2015-06-30T17:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252595",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 ncohen]:
> How can you check that?

I didn't say that you script should *check* all conditions. We need to define how the `spkg-src` script should be run, so we need to state the conditions precisely.

> Or do you mean that my script should only run them from the inside of a sage shell?

Yes.

> > 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)
  
> 
> I do not know how to check that either.

{{{
cd /
"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src
}}}

> > 1. The tarball should be created in the `$SAGE_DISTFILES` directory.
  
> 
> That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?

{{{
SAGE_REAL_DISTFILES="$SAGE_DISTFILES"
export SAGE_DISTFILES=/some/temporary/directory
cd /
"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src
compare "$SAGE_REAL_DISTFILES/$TARBALL" "$SAGE_DISTFILES/$TARBALL"
}}}

> Well, it will need some temporary directory anyway.

I think it could use `$SAGE_DISTFILES` as temporary directory.



---

archive/issue_comments_252596.json:
```json
{
    "body": "Replying to [comment:11 ncohen]:\n> If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.\n\n\n+1",
    "created_at": "2015-06-30T17:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252596",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 ncohen]:
> If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.


+1



---

archive/issue_comments_252597.json:
```json
{
    "body": "Plan:\n1. review #18788\n2. finish collecting specs for whats missing: Delete fluff, recompress, run autotools, anything else?\n3. write testcases\n4. implement",
    "created_at": "2015-06-30T17:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252597",
    "user": "https://github.com/vbraun"
}
```

Plan:
1. review #18788
2. finish collecting specs for whats missing: Delete fluff, recompress, run autotools, anything else?
3. write testcases
4. implement



---

archive/issue_comments_252598.json:
```json
{
    "body": "Replying to [comment:14 vbraun]:\n> Delete fluff, recompress, run autotools, anything else?\n- Download tarball\n- Apply patches (before running autotools)\n- Clone git repo, configure package, build package, make tarball using upstream script (e.g. PARI)\n- Change permissions\n- Merge more than one upstream tarball (e.g. ATLAS, Singular)\n- Move files around",
    "created_at": "2015-06-30T18:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252598",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 vbraun]:
> Delete fluff, recompress, run autotools, anything else?
- Download tarball
- Apply patches (before running autotools)
- Clone git repo, configure package, build package, make tarball using upstream script (e.g. PARI)
- Change permissions
- Merge more than one upstream tarball (e.g. ATLAS, Singular)
- Move files around



---

archive/issue_comments_252599.json:
```json
{
    "body": "I would like to add a condition:\n5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n\nReason: Sage includes `bzip2` so we have a guaranteed version of `bzip2`.",
    "created_at": "2015-06-30T18:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252599",
    "user": "https://github.com/jdemeyer"
}
```

I would like to add a condition:
5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.

Reason: Sage includes `bzip2` so we have a guaranteed version of `bzip2`.



---

archive/issue_comments_252600.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> I think it could use `$SAGE_DISTFILES` as temporary directory.\n\nSee `autotools/spkg-src` for an implementation (except it uses `upstream` instead of `$SAGE_DISTFILES`)",
    "created_at": "2015-06-30T18:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252600",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 jdemeyer]:
> I think it could use `$SAGE_DISTFILES` as temporary directory.

See `autotools/spkg-src` for an implementation (except it uses `upstream` instead of `$SAGE_DISTFILES`)



---

archive/issue_comments_252601.json:
```json
{
    "body": "6. The `spkg-src` script should use `sage-download-file` to download files (not a hard-coded `curl` or `wget`, which are not installed on all systems).",
    "created_at": "2015-06-30T18:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252601",
    "user": "https://github.com/jdemeyer"
}
```

6. The `spkg-src` script should use `sage-download-file` to download files (not a hard-coded `curl` or `wget`, which are not installed on all systems).



---

archive/issue_comments_252602.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> - Merge more than one upstream tarball (e.g. ATLAS, Singular)\n\n\nReally the sad fact that the packaging system can only handle a single tarball ought to be remedied. This removes the need to combine tarballs AND fixes the autotools problem (just ship the autotools output in a separate tarball)",
    "created_at": "2015-06-30T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252602",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:15 jdemeyer]:
> - Merge more than one upstream tarball (e.g. ATLAS, Singular)


Really the sad fact that the packaging system can only handle a single tarball ought to be remedied. This removes the need to combine tarballs AND fixes the autotools problem (just ship the autotools output in a separate tarball)



---

archive/issue_comments_252603.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-30T20:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252603",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_252604.json:
```json
{
    "body": "needs_work because we're still very much discussing.",
    "created_at": "2015-06-30T20:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252604",
    "user": "https://github.com/jdemeyer"
}
```

needs_work because we're still very much discussing.



---

archive/issue_comments_252605.json:
```json
{
    "body": "> * we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini\n\n\nIn case you plan to write something like that, don't lose your time with regexes, i have such feature almost ready (moreover the latest version is self-determinated). I wrote this in november so there might be some new packages missing, also there is still the problem for packages that are bundles (e.g. rubiks), and some packages whose download URL is not deterministic because of some kind of hash. I am curently facing some health issues, so i try to minimize my work by not opening tickets for extra features, i will open one for this soon.",
    "created_at": "2015-07-01T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252605",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

> * we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini


In case you plan to write something like that, don't lose your time with regexes, i have such feature almost ready (moreover the latest version is self-determinated). I wrote this in november so there might be some new packages missing, also there is still the problem for packages that are bundles (e.g. rubiks), and some packages whose download URL is not deterministic because of some kind of hash. I am curently facing some health issues, so i try to minimize my work by not opening tickets for extra features, i will open one for this soon.



---

archive/issue_comments_252606.json:
```json
{
    "body": "> needs_work because we're still very much discussing.\n\n\nPart of the discussion is about other matters than what this branch contains: I wrote a script that I have often needed, in order to check that the packages that are proposed on trac ticket as an updated of upstream are indeed what they claim to be.\n\nRight now these operations have to be done manually, and often. Besides, as I am not the only one who does that I would say that they are of 'public interest'.\n\nI do not mind discussions on wider problems, but I still need a script for those daily/weekly operations that need to be done.\n\nNathann",
    "created_at": "2015-07-01T09:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252606",
    "user": "https://github.com/nathanncohen"
}
```

> needs_work because we're still very much discussing.


Part of the discussion is about other matters than what this branch contains: I wrote a script that I have often needed, in order to check that the packages that are proposed on trac ticket as an updated of upstream are indeed what they claim to be.

Right now these operations have to be done manually, and often. Besides, as I am not the only one who does that I would say that they are of 'public interest'.

I do not mind discussions on wider problems, but I still need a script for those daily/weekly operations that need to be done.

Nathann



---

archive/issue_comments_252607.json:
```json
{
    "body": "You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.",
    "created_at": "2015-07-01T10:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252607",
    "user": "https://github.com/vbraun"
}
```

You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.



---

archive/issue_comments_252608.json:
```json
{
    "body": "> You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.\n\n\nHow are we supposed to check that packages updates are consistent? By doing exactly what this script does, manually?",
    "created_at": "2015-07-01T10:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252608",
    "user": "https://github.com/nathanncohen"
}
```

> You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.


How are we supposed to check that packages updates are consistent? By doing exactly what this script does, manually?



---

archive/issue_comments_252609.json:
```json
{
    "body": "Replying to [comment:22 ncohen]:\n> Part of the discussion is about other matters than what this branch contains\n\n\nThe current branch contains a script to check X without properly defining X.\n\nThat makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the \"discussion\" part).",
    "created_at": "2015-07-01T10:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252609",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 ncohen]:
> Part of the discussion is about other matters than what this branch contains


The current branch contains a script to check X without properly defining X.

That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the "discussion" part).



---

archive/issue_comments_252610.json:
```json
{
    "body": "> The current branch contains a script to check X without properly defining X.\n> \n> That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the \"discussion\" part).\n\n\nI do not mind. I just want something to happen. Somehow with tickets like that, it's like everybody it fighting so that absolutely nothing happens, and burying tickets. This branch exists, while the others alternatives do not.\n\nAbout properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made. Except two:\n- The one about being able to run the script from any place\n- The one about moving the package to upstream\n\nI will implement this now, so please do not make me regret this later by asking me to do something impossible that you know I will not do, thus killing this ticket.\n\nNathann",
    "created_at": "2015-07-01T10:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252610",
    "user": "https://github.com/nathanncohen"
}
```

> The current branch contains a script to check X without properly defining X.
> 
> That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the "discussion" part).


I do not mind. I just want something to happen. Somehow with tickets like that, it's like everybody it fighting so that absolutely nothing happens, and burying tickets. This branch exists, while the others alternatives do not.

About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made. Except two:
- The one about being able to run the script from any place
- The one about moving the package to upstream

I will implement this now, so please do not make me regret this later by asking me to do something impossible that you know I will not do, thus killing this ticket.

Nathann



---

archive/issue_comments_252611.json:
```json
{
    "body": "Replying to [comment:26 ncohen]:\n> This branch exists, while the others alternatives do not.\n\nMore than once you have been angry with me that I write code on \"your\" ticket. So obviously, I'll avoid writing code on this ticket.",
    "created_at": "2015-07-01T11:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252611",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 ncohen]:
> This branch exists, while the others alternatives do not.

More than once you have been angry with me that I write code on "your" ticket. So obviously, I'll avoid writing code on this ticket.



---

archive/issue_comments_252612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-01T11:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252613.json:
```json
{
    "body": "Replying to [comment:26 ncohen]:\n> About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made.\n\n\nSome other things we could check:\n7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n8. All symlinks in the tarball must be relative and point to an existing file.\n\nIf there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.",
    "created_at": "2015-07-01T11:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252613",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 ncohen]:
> About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made.


Some other things we could check:
7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
8. All symlinks in the tarball must be relative and point to an existing file.

If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.



---

archive/issue_comments_252614.json:
```json
{
    "body": "I made the requested modifications.\n\n> More than once you have been angry with me that I write code on \"your\" ticket. So obviously, I'll avoid writing code on this ticket.\n\n\nI would be glad if you could help me on this ticket. If I am alone against two release managers, I know that this is as good as dead.\n\nAbout pushing to 'my' tickets: my only objection is that you should refrain from pushing changes if you know that there is an opposition to them. If we agree that something must be done, then there is no problem in saying \"i'll do it\" and pushing the changes (when the branch is public).\n\nNathann",
    "created_at": "2015-07-01T11:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252614",
    "user": "https://github.com/nathanncohen"
}
```

I made the requested modifications.

> More than once you have been angry with me that I write code on "your" ticket. So obviously, I'll avoid writing code on this ticket.


I would be glad if you could help me on this ticket. If I am alone against two release managers, I know that this is as good as dead.

About pushing to 'my' tickets: my only objection is that you should refrain from pushing changes if you know that there is an opposition to them. If we agree that something must be done, then there is no problem in saying "i'll do it" and pushing the changes (when the branch is public).

Nathann



---

archive/issue_comments_252615.json:
```json
{
    "body": "Hello,\n\n> 7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n\n\nOh. In order to avoid the ugly 0777 files?\n\n> 8. All symlinks in the tarball must be relative and point to an existing file.\n\n\nI don't see any reason to oppose that, and I will pray that the current packages already satisfy it.\n\nCould you add a commit to check that, if you think them necessary? And if you do, could you update the 'list of assumptions' that I added to the head of the 'sanity-check' script? We will need that to write the doc later.\n\n> If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.\n\n\nWell, I would not have thought of those two things you just mentionned, but I see no reason to oppose them (unless we find out that 99% of the tarballs don't satisfy it). And I am afraid that I cannot remember anything else you mentionned that is not yet in my script.\n\nNathann",
    "created_at": "2015-07-01T11:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252615",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> 7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.


Oh. In order to avoid the ugly 0777 files?

> 8. All symlinks in the tarball must be relative and point to an existing file.


I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.

Could you add a commit to check that, if you think them necessary? And if you do, could you update the 'list of assumptions' that I added to the head of the 'sanity-check' script? We will need that to write the doc later.

> If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.


Well, I would not have thought of those two things you just mentionned, but I see no reason to oppose them (unless we find out that 99% of the tarballs don't satisfy it). And I am afraid that I cannot remember anything else you mentionned that is not yet in my script.

Nathann



---

archive/issue_comments_252616.json:
```json
{
    "body": "Replying to [comment:31 ncohen]:\n> I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.\n\nAt least `lrcalc` does not:\n\n```\njdemeyer@tamiyo:/usr/local/src/sage-config/upstream$ ls -l lrcalc-1.1.7/m4\ntotal 0\nlrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 libtool.m4 -> /usr/share/aclocal/libtool.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 33 Jul 25  2012 lt~obsolete.m4 -> /usr/share/aclocal/lt~obsolete.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltoptions.m4 -> /usr/share/aclocal/ltoptions.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 ltsugar.m4 -> /usr/share/aclocal/ltsugar.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltversion.m4 -> /usr/share/aclocal/ltversion.m4\n```",
    "created_at": "2015-07-01T11:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252616",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:31 ncohen]:
> I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.

At least `lrcalc` does not:

```
jdemeyer@tamiyo:/usr/local/src/sage-config/upstream$ ls -l lrcalc-1.1.7/m4
total 0
lrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 libtool.m4 -> /usr/share/aclocal/libtool.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 33 Jul 25  2012 lt~obsolete.m4 -> /usr/share/aclocal/lt~obsolete.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltoptions.m4 -> /usr/share/aclocal/ltoptions.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 ltsugar.m4 -> /usr/share/aclocal/ltsugar.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltversion.m4 -> /usr/share/aclocal/ltversion.m4
```



---

archive/issue_comments_252617.json:
```json
{
    "body": "To refresh your mind about the conditions:\n1. The `spkg-src` script should only be run within a Sage shell.\n2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n3. The tarball should be created in the `$SAGE_DISTFILES` directory.\n4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n6. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).\n7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n8. All symlinks in the tarball must be relative and point to an existing file.",
    "created_at": "2015-07-01T11:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252617",
    "user": "https://github.com/jdemeyer"
}
```

To refresh your mind about the conditions:
1. The `spkg-src` script should only be run within a Sage shell.
2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)
3. The tarball should be created in the `$SAGE_DISTFILES` directory.
4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.
5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.
6. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).
7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
8. All symlinks in the tarball must be relative and point to an existing file.



---

archive/issue_comments_252618.json:
```json
{
    "body": "You have an additional assumption\n\n```\n# - When uncompressed, the archive creates a \"src/\" or a\n#   \"<package_name>-<version>/\" directory\n```\nwhich I think is not needed.\n\nSuch an assumption was needed for old-style spkg files due to the way that `sage-spkg` works, but for new-style packages this is really not needed.",
    "created_at": "2015-07-01T11:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252618",
    "user": "https://github.com/jdemeyer"
}
```

You have an additional assumption

```
# - When uncompressed, the archive creates a "src/" or a
#   "<package_name>-<version>/" directory
```
which I think is not needed.

Such an assumption was needed for old-style spkg files due to the way that `sage-spkg` works, but for new-style packages this is really not needed.



---

archive/issue_comments_252619.json:
```json
{
    "body": "> 1. The `spkg-src` script should only be run within a Sage shell.\n\n\nI updated the sanity-check script on this respect.\n\n> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n\n\nI checked that too, using your test.\n\n> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n\n\nAlso checked.\n\n> 1. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\n\nI do not know how to check that. Is it easily done? It does not seem so important that we should go out of our way to check it.\n\n> 1. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n\n\nWe also have many .tar.gz in 'upstream/'. But I do not see a need to enforce something like that.\n\n> 1. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).\n\n\nWhy would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.\n\n> 1. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n> 2. All symlinks in the tarball must be relative and point to an existing file.\n\n\nI do not think that we need any of those two, but I don't see any reason to oppose you on that. The best for this is probably to try it on several packages, and figure out if this is a reasonable assumption to make. If packages don't already satisfy that, I don't see what we could do against it.\n\n> Such an assumption was needed for old-style spkg files due to the way that sage-spkg works, but for new-style packages this is really not needed.\n\n\nI do not see how to avoid it: if you do, you can add a commit.\n\nNathann",
    "created_at": "2015-07-01T11:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252619",
    "user": "https://github.com/nathanncohen"
}
```

> 1. The `spkg-src` script should only be run within a Sage shell.


I updated the sanity-check script on this respect.

> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)


I checked that too, using your test.

> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.


Also checked.

> 1. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.


I do not know how to check that. Is it easily done? It does not seem so important that we should go out of our way to check it.

> 1. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.


We also have many .tar.gz in 'upstream/'. But I do not see a need to enforce something like that.

> 1. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).


Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.

> 1. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
> 2. All symlinks in the tarball must be relative and point to an existing file.


I do not think that we need any of those two, but I don't see any reason to oppose you on that. The best for this is probably to try it on several packages, and figure out if this is a reasonable assumption to make. If packages don't already satisfy that, I don't see what we could do against it.

> Such an assumption was needed for old-style spkg files due to the way that sage-spkg works, but for new-style packages this is really not needed.


I do not see how to avoid it: if you do, you can add a commit.

Nathann



---

archive/issue_comments_252620.json:
```json
{
    "body": "Replying to [comment:35 ncohen]:\n> We also have many .tar.gz in 'upstream/'.\n\nI have nothing against that.\n\nI'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2` file (there is really no reason to create a `.gz` file, since those are usually larger than the corresponding `.bz2` file).",
    "created_at": "2015-07-01T12:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252620",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:35 ncohen]:
> We also have many .tar.gz in 'upstream/'.

I have nothing against that.

I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2` file (there is really no reason to create a `.gz` file, since those are usually larger than the corresponding `.bz2` file).



---

archive/issue_comments_252621.json:
```json
{
    "body": "Replying to [comment:35 ncohen]:\n> Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.\n\n\nWell, some `spkg-src` scripts use `wget`, others use `curl`...\n\nFor portability, we should use `sage-download-file` which is guaranteed to work.",
    "created_at": "2015-07-01T12:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252621",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:35 ncohen]:
> Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.


Well, some `spkg-src` scripts use `wget`, others use `curl`...

For portability, we should use `sage-download-file` which is guaranteed to work.



---

archive/issue_comments_252622.json:
```json
{
    "body": "> I have nothing against that.\n> \n> I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2`\n\n\nThat could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?",
    "created_at": "2015-07-01T12:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252622",
    "user": "https://github.com/nathanncohen"
}
```

> I have nothing against that.
> 
> I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2`


That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?



---

archive/issue_comments_252623.json:
```json
{
    "body": "> Well, some `spkg-src` scripts use `wget`, others use `curl`...\n> \n> For portability, we should use `sage-download-file` which is guaranteed to work.\n\n\nI think that you want to give us a protection that we do not need. Assuming that a developer has wget on his computer is pretty mild...",
    "created_at": "2015-07-01T12:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252623",
    "user": "https://github.com/nathanncohen"
}
```

> Well, some `spkg-src` scripts use `wget`, others use `curl`...
> 
> For portability, we should use `sage-download-file` which is guaranteed to work.


I think that you want to give us a protection that we do not need. Assuming that a developer has wget on his computer is pretty mild...



---

archive/issue_comments_252624.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-01T19:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252624",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252625.json:
```json
{
    "body": "Replying to [comment:38 ncohen]:\n> That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?\n\n\nNo, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.",
    "created_at": "2015-07-01T19:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252625",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:38 ncohen]:
> That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?


No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.



---

archive/issue_comments_252626.json:
```json
{
    "body": "Replying to [comment:39 ncohen]:\n> Assuming that a developer has wget on his computer is pretty mild...\n1. `wget` is not installed by default on OS X.\n1. There is no `wget` Sage package.",
    "created_at": "2015-07-01T19:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252626",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:39 ncohen]:
> Assuming that a developer has wget on his computer is pretty mild...
1. `wget` is not installed by default on OS X.
1. There is no `wget` Sage package.



---

archive/issue_comments_252627.json:
```json
{
    "body": "> No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.\n\n\nYou seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other.",
    "created_at": "2015-07-01T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252627",
    "user": "https://github.com/nathanncohen"
}
```

> No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.


You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other.



---

archive/issue_comments_252628.json:
```json
{
    "body": "Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.",
    "created_at": "2015-07-01T19:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252628",
    "user": "https://github.com/jdemeyer"
}
```

Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.



---

archive/issue_comments_252629.json:
```json
{
    "body": "Replying to [comment:43 ncohen]:\n> You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other. \n\n\nOK, here is an adjusted assumption:\n5. If the `spkg-src` script does compress the tarball, it should use `bzip2` for that.",
    "created_at": "2015-07-01T19:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252629",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:43 ncohen]:
> You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other. 


OK, here is an adjusted assumption:
5. If the `spkg-src` script does compress the tarball, it should use `bzip2` for that.



---

archive/issue_comments_252630.json:
```json
{
    "body": "> Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.\n\n\nI don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. About 'wget' I think that it is really going too far, but as you never give way on any point for the sake of good mood, well, I am forced to do it.\n\nNo problem for this bz2 thing, we had the same thing in mind all along.",
    "created_at": "2015-07-01T19:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252630",
    "user": "https://github.com/nathanncohen"
}
```

> Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.


I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. About 'wget' I think that it is really going too far, but as you never give way on any point for the sake of good mood, well, I am forced to do it.

No problem for this bz2 thing, we had the same thing in mind all along.



---

archive/issue_comments_252631.json:
```json
{
    "body": "What do we do with this? Do we continue, or do we close this as wontfix?",
    "created_at": "2015-07-09T09:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252631",
    "user": "https://github.com/nathanncohen"
}
```

What do we do with this? Do we continue, or do we close this as wontfix?



---

archive/issue_comments_252632.json:
```json
{
    "body": "Continue I would say, but at the moment I don't have much time for this...",
    "created_at": "2015-07-09T09:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252632",
    "user": "https://github.com/jdemeyer"
}
```

Continue I would say, but at the moment I don't have much time for this...



---

archive/issue_comments_252633.json:
```json
{
    "body": "> Continue I would say, but at the moment I don't have much time for this...\n\n\nWhat would you say that we have to do?\n\nI can write the doc, perhaps? And explain the different assumptions?\n\nAlso, you said that there was a trick for this problem with running autotools on different machines?\n\nNathann",
    "created_at": "2015-07-09T09:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252633",
    "user": "https://github.com/nathanncohen"
}
```

> Continue I would say, but at the moment I don't have much time for this...


What would you say that we have to do?

I can write the doc, perhaps? And explain the different assumptions?

Also, you said that there was a trick for this problem with running autotools on different machines?

Nathann



---

archive/issue_comments_252634.json:
```json
{
    "body": "Replying to [comment:49 ncohen]:\n> Also, you said that there was a trick for this problem with running autotools on different machines?\n\n\nIf the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of \"plain\" `auto(re)conf` (which a suitable error message of the form \"please install the autotools package\").",
    "created_at": "2015-07-09T09:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252634",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:49 ncohen]:
> Also, you said that there was a trick for this problem with running autotools on different machines?


If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of "plain" `auto(re)conf` (which a suitable error message of the form "please install the autotools package").



---

archive/issue_comments_252635.json:
```json
{
    "body": "> If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of \"plain\" `auto(re)conf` (which a suitable error message of the form \"please install the autotools package\").\n\n\nOkay, that's a good news. Should I start writing the doc, or do you see a reason why we should not do it at the moment?",
    "created_at": "2015-07-09T09:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252635",
    "user": "https://github.com/nathanncohen"
}
```

> If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of "plain" `auto(re)conf` (which a suitable error message of the form "please install the autotools package").


Okay, that's a good news. Should I start writing the doc, or do you see a reason why we should not do it at the moment?



---

archive/issue_comments_252636.json:
```json
{
    "body": "Replying to [comment:46 ncohen]:\n> > Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.\n\n> \n> I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. \n\nHello,\nI am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?",
    "created_at": "2015-07-10T11:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252636",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Replying to [comment:46 ncohen]:
> > Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.

> 
> I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. 

Hello,
I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?



---

archive/issue_comments_252637.json:
```json
{
    "body": "> I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?\n\n\nDon't bother with that for the moment. Write a clean spkg-src if you can (trusting your own idea of what it should do), but what is going on here is far from being merged, so don't let it add more work on your heap.\n\nNathann",
    "created_at": "2015-07-10T12:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252637",
    "user": "https://github.com/nathanncohen"
}
```

> I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?


Don't bother with that for the moment. Write a clean spkg-src if you can (trusting your own idea of what it should do), but what is going on here is far from being merged, so don't let it add more work on your heap.

Nathann



---

archive/issue_comments_252638.json:
```json
{
    "body": "Thank you, so now I'd rather keep my checksum.ini unchanged to not bother someone who had already built the package. So I have just put a comment to remind to switch from gz to bz2\nand made other modifications such that spkg-src passes you current sage-sanity-check-package test.",
    "created_at": "2015-07-10T15:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252638",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Thank you, so now I'd rather keep my checksum.ini unchanged to not bother someone who had already built the package. So I have just put a comment to remind to switch from gz to bz2
and made other modifications such that spkg-src passes you current sage-sanity-check-package test.



---

archive/issue_comments_252639.json:
```json
{
    "body": "Let me weaken\n\n> 4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\n\nto\n\n4. Apart from temporary files, the script should not change any file outside `$SAGE_DISTFILES`. Using `build/pkgs/pkgname` or `$SAGE_ROOT/tmp` as temporary directory is fine, but all temporary files should be deleted when the script is finished.",
    "created_at": "2015-07-11T17:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252639",
    "user": "https://github.com/jdemeyer"
}
```

Let me weaken

> 4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.


to

4. Apart from temporary files, the script should not change any file outside `$SAGE_DISTFILES`. Using `build/pkgs/pkgname` or `$SAGE_ROOT/tmp` as temporary directory is fine, but all temporary files should be deleted when the script is finished.



---

archive/issue_comments_252640.json:
```json
{
    "body": "Hello,\n\nIs everybody waiting for this ticket to get forgotten, or do we make something happen?\n\nNathann",
    "created_at": "2015-07-21T15:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252640",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

Is everybody waiting for this ticket to get forgotten, or do we make something happen?

Nathann



---

archive/issue_comments_252641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-21T15:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252641",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252642.json:
```json
{
    "body": "Close to anniversary.",
    "created_at": "2016-07-05T20:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252642",
    "user": "https://github.com/nexttime"
}
```

Close to anniversary.



---

archive/issue_comments_252643.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-06T18:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252643",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_052634.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18826#event-52634"
}
```



---

archive/issue_comments_252644.json:
```json
{
    "body": "I think this can be closed as obsolete",
    "created_at": "2022-08-06T18:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252644",
    "user": "https://github.com/mkoeppe"
}
```

I think this can be closed as obsolete



---

archive/issue_comments_252645.json:
```json
{
    "body": "It seems so.",
    "created_at": "2022-08-07T10:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252645",
    "user": "https://github.com/kwankyu"
}
```

It seems so.



---

archive/issue_comments_252646.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-07T10:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252646",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_052635.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T02:30:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18826#event-52635"
}
```



---

archive/issue_comments_252647.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-09-01T02:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18826#issuecomment-252647",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
