# Issue 18826: A sage-sanity-check-package using the 'spkg-src' scripts

archive/issues_018589.json:
```json
{
    "assignees": [],
    "body": "Hello everybody,\n\nThis branch adds a \"sage-sanity-check-package\" script that uses the 'spkg-src'\nscripts. The goal is to have an easy way to check, when a new-style package gets\nudpated, that the new package is precisely \"spkg-src\" builds.\n\nRight now our 'spkg-spkg' scripts all do different things. In order to use\n'spkg-src' scripts in an automatic way, I made the following assumption:\n\n- When `./sage-src' is run in a build/pkg/<package>/ folder, it creates the\n  package archive whose name is described in checksums.ini\n\n- There is un upstream/ an archive with the same name\n\n- Their contents are compared with 'diff -r'\n\nCurrently, almost none of our packages satisfy those assumptions (*).\n\nWhat would you think of having a script like that? That would 'normalize' the\nsituations of our spkg-src scripts, and we will solve the many inconsistencies\nin our packaging. That will also make sure that everything we do on a package is\nlisted by the spkg-src script.\n\nHave fun,\n\nNathann\n\n(*) Some seem to, but then they are named file.tar.gz while the file is not\ngzipped. Or else the file in upstream/ is not exactly what is in\nchecksum.ini. Or spkg-src downloads the *latest version* instead of the one\n    whose version is hardcoded in checsksums.ini. You get the picture.\n\nBranch/Commit: **[public/18826](https://github.com/sagemath/sagetrac-mirror/tree/public/18826) @ [5372942](https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1)**\n\nReviewer: **Kwankyu Lee**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18826_\n\n",
    "closed_at": "2022-09-01T02:30:35Z",
    "created_at": "2015-06-30T12:48:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "A sage-sanity-check-package using the 'spkg-src' scripts",
    "type": "issue",
    "updated_at": "2022-09-01T02:30:35Z",
    "url": "https://github.com/sagemath/sage/issues/18826",
    "user": "https://github.com/nathanncohen"
}
```
Hello everybody,

This branch adds a "sage-sanity-check-package" script that uses the 'spkg-src'
scripts. The goal is to have an easy way to check, when a new-style package gets
udpated, that the new package is precisely "spkg-src" builds.

Right now our 'spkg-spkg' scripts all do different things. In order to use
'spkg-src' scripts in an automatic way, I made the following assumption:

- When `./sage-src' is run in a build/pkg/<package>/ folder, it creates the
  package archive whose name is described in checksums.ini

- There is un upstream/ an archive with the same name

- Their contents are compared with 'diff -r'

Currently, almost none of our packages satisfy those assumptions (*).

What would you think of having a script like that? That would 'normalize' the
situations of our spkg-src scripts, and we will solve the many inconsistencies
in our packaging. That will also make sure that everything we do on a package is
listed by the spkg-src script.

Have fun,

Nathann

(*) Some seem to, but then they are named file.tar.gz while the file is not
gzipped. Or else the file in upstream/ is not exactly what is in
checksum.ini. Or spkg-src downloads the *latest version* instead of the one
    whose version is hardcoded in checsksums.ini. You get the picture.

Branch/Commit: **[public/18826](https://github.com/sagemath/sagetrac-mirror/tree/public/18826) @ [5372942](https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1)**

Reviewer: **Kwankyu Lee**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/18826_





---

archive/issue_events_267325.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T12:48:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267325"
}
```



---

archive/issue_events_267326.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T12:48:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267326"
}
```



---

archive/issue_events_267327.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T12:48:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267327"
}
```



---

archive/issue_events_267328.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T12:48:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267328"
}
```



---

archive/issue_comments_263187.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9\">ef4e8b0</a></td><td><code>sage-sanity-check-package</code></td></tr></table>\n",
    "created_at": "2015-06-30T12:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263187",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9">ef4e8b0</a></td><td><code>sage-sanity-check-package</code></td></tr></table>




---

archive/issue_comments_263188.json:
```json
{
    "body": "Branch: **[public/18826](https://github.com/sagemath/sagetrac-mirror/tree/public/18826)**",
    "created_at": "2015-06-30T12:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263188",
    "user": "https://github.com/nathanncohen"
}
```

Branch: **[public/18826](https://github.com/sagemath/sagetrac-mirror/tree/public/18826)**



---

archive/issue_events_267329.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-06-30T12:48:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267329"
}
```



---

archive/issue_comments_263189.json:
```json
{
    "body": "Commit: **[ef4e8b0](https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9)**",
    "created_at": "2015-06-30T12:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263189",
    "user": "https://github.com/nathanncohen"
}
```

Commit: **[ef4e8b0](https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9)**



---

archive/issue_comments_263190.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nsage-src scripts are just symptoms of failures of our package system. Instead of formalizing those hacks we should try to understand what is missing. IMHO:\n* we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini\n* most sage-src scripts probably exist because we want to delete stuff from the tarball to bring it to a manageable size. The globs of files to delete should be stored in a file, no need to have executable scripts floating about",
    "created_at": "2015-06-30T13:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263190",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

sage-src scripts are just symptoms of failures of our package system. Instead of formalizing those hacks we should try to understand what is missing. IMHO:
* we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini
* most sage-src scripts probably exist because we want to delete stuff from the tarball to bring it to a manageable size. The globs of files to delete should be stored in a file, no need to have executable scripts floating about



---

archive/issue_comments_263191.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAnd:\n* Recompress in a format that we can handle with the Sage prerequisites; this ought to be a special case no \"files to delete\"",
    "created_at": "2015-06-30T13:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263191",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

And:
* Recompress in a format that we can handle with the Sage prerequisites; this ought to be a special case no "files to delete"



---

archive/issue_comments_263192.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI agree that we are still a long way from having a clean build system, but what I want to do with this script is to help us clean the packages progressively.\n\nIf you want to implement the ideas you proposed, your only way to make them work will be to fix all packages at once. I don't think that it can be done, and I do not expect anybody to do it.\n\nIf we agree on some formalism for `spkg-src`, we can start precisely this work: make sure that everything we do to a package is done there. This way if we ever want to move to something more constraining, we will know at least what we have to deal with.\n\nIn the immediate future, however, that would help a reviewer check that the 'updated package' proposed for review is only what it claims to be. No code was injected (to be run on everybody's computer), and also check that everything that is done appears in `spkg-src`.\n\nThus, I still think that such a script would be a good addition: along with a rule that we should only accept spkg-src scripts that fit the assumptions (those are open to discussion). And slowly, we will add new spkg-src files and stabilize the situation.\n\nNathann",
    "created_at": "2015-06-30T13:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263192",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

I agree that we are still a long way from having a clean build system, but what I want to do with this script is to help us clean the packages progressively.

If you want to implement the ideas you proposed, your only way to make them work will be to fix all packages at once. I don't think that it can be done, and I do not expect anybody to do it.

If we agree on some formalism for `spkg-src`, we can start precisely this work: make sure that everything we do to a package is done there. This way if we ever want to move to something more constraining, we will know at least what we have to deal with.

In the immediate future, however, that would help a reviewer check that the 'updated package' proposed for review is only what it claims to be. No code was injected (to be run on everybody's computer), and also check that everything that is done appears in `spkg-src`.

Thus, I still think that such a script would be a good addition: along with a rule that we should only accept spkg-src scripts that fit the assumptions (those are open to discussion). And slowly, we will add new spkg-src files and stabilize the situation.

Nathann



---

archive/issue_comments_263193.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nYou forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.",
    "created_at": "2015-06-30T16:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263193",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.



---

archive/issue_comments_263194.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.\n\nIn this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs. If the autotoolizing is done by upstream, however, that's no problem.\n\nLet us talk about solutions instead of just raising the problems: how do we address that?\n\nI did not plan to have this script be anything else than a helper tool to review packages. On the other hand, we must have a way to check the sanity of the packages.\n\nOf the packages which are autotoolized by our 'spkg-src' scripts, I would not be at all surprised to find out that they are like this because... its authors are Sage developpers.\n\nNathann",
    "created_at": "2015-06-30T16:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263194",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">comment:6</div>

> You forgot another important change to packages: either add an autotools build system or re-autotoolize after making some changes.

In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs. If the autotoolizing is done by upstream, however, that's no problem.

Let us talk about solutions instead of just raising the problems: how do we address that?

I did not plan to have this script be anything else than a helper tool to review packages. On the other hand, we must have a way to check the sanity of the packages.

Of the packages which are autotoolized by our 'spkg-src' scripts, I would not be at all surprised to find out that they are like this because... its authors are Sage developpers.

Nathann



---

archive/issue_comments_263195.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.\n\nI'd like to modify the assumptions a bit though:\n1. The `spkg-src` script should only be run within a Sage shell.\n2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n3. The tarball should be created in the `$SAGE_DISTFILES` directory.\n4. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\nSo, `./sage --sh build/pkgs/PKGNAME/spkg-src` should \"just work\".",
    "created_at": "2015-06-30T16:11:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263195",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.

I'd like to modify the assumptions a bit though:
1. The `spkg-src` script should only be run within a Sage shell.
2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)
3. The tarball should be created in the `$SAGE_DISTFILES` directory.
4. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.

So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should "just work".



---

archive/issue_comments_263196.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nathanncohen](#comment:6):\n> In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs.\n\nThis is solved by the `autotools` experimental package, which enforces a particular version of `configure` and similar programs.",
    "created_at": "2015-06-30T16:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263196",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nathanncohen](#comment:6):
> In this case, the 'diff' comparison is indeed useless, for different versions of the autotool scripts produce different outputs.

This is solved by the `autotools` experimental package, which enforces a particular version of `configure` and similar programs.



---

archive/issue_comments_263197.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@nathanncohen](#comment:6):\n> I did not plan to have this script be anything else than a helper tool to review packages.\n\nYou want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo.",
    "created_at": "2015-06-30T16:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263197",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@nathanncohen](#comment:6):
> I did not plan to have this script be anything else than a helper tool to review packages.

You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo.



---

archive/issue_comments_263198.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYooooooooooo !\n\n> I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.\n\nYep `T_T`\n\n> I'd like to modify the assumptions a bit though:\n> 1. The `spkg-src` script should only be run within a Sage shell.\n\nHow can you check that? Or do you mean that my script should only run them from the inside of a sage shell? If so, would replacing 'spkg-src' with 'sage -sh spkg-src' in the script be sufficient?\n\n> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n\nI do not know how to check that either. In a preliminary version of my script I wanted to work in a different directory, but I figured out that most spkg-src files would break at this step.\n\n> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n\nThat would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?\n\n> 1. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\nWell, it will need some temporary directory anyway.\n\n> So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should \"just work\".\n\nYou are making requests which would make this script much more restrictive. If you already know how to implement some of them, feel free to add a commit on this public branch (with explicit error messages).\n\nWhen we will have settled on that, we will also have to explain all this (and go over all assumptions) in the developer manual.\n\nThanks,\n\nNathann",
    "created_at": "2015-06-30T16:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263198",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

Yooooooooooo !

> I agree with Nathann that `spkg-src` scripts are inconsistent and should be improved.

Yep `T_T`

> I'd like to modify the assumptions a bit though:
> 1. The `spkg-src` script should only be run within a Sage shell.

How can you check that? Or do you mean that my script should only run them from the inside of a sage shell? If so, would replacing 'spkg-src' with 'sage -sh spkg-src' in the script be sufficient?

> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)

I do not know how to check that either. In a preliminary version of my script I wanted to work in a different directory, but I figured out that most spkg-src files would break at this step.

> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.

That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?

> 1. The script shall not change any file (not even temporary) outside `$SAGE_DISTFILES`.

Well, it will need some temporary directory anyway.

> So, `./sage --sh build/pkgs/PKGNAME/spkg-src` should "just work".

You are making requests which would make this script much more restrictive. If you already know how to implement some of them, feel free to add a commit on this public branch (with explicit error messages).

When we will have settled on that, we will also have to explain all this (and go over all assumptions) in the developer manual.

Thanks,

Nathann



---

archive/issue_comments_263199.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n> You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo. \n\nIf you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.\n\nNathann",
    "created_at": "2015-06-30T16:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263199",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:11" align="right">comment:11</div>

> You want a club to force others to spend time beautifying sage-src scripts. Thats IMHO the wrong direction, we should get rid of the `sage-src` scripts instead of cementing in the status quo. 

If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.

Nathann



---

archive/issue_comments_263200.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nathanncohen](#comment:10):\n> How can you check that?\n\nI didn't say that you script should *check* all conditions. We need to define how the `spkg-src` script should be run, so we need to state the conditions precisely.\n\n> Or do you mean that my script should only run them from the inside of a sage shell?\n\nYes.\n\n> > 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n\n> \n> I do not know how to check that either.\n\n\n```\ncd /\n\"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src\n```\n\n> > 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n\n> \n> That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?\n\n\n```\nSAGE_REAL_DISTFILES=\"$SAGE_DISTFILES\"\nexport SAGE_DISTFILES=/some/temporary/directory\ncd /\n\"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src\ncompare \"$SAGE_REAL_DISTFILES/$TARBALL\" \"$SAGE_DISTFILES/$TARBALL\"\n```\n\n> Well, it will need some temporary directory anyway.\n\nI think it could use `$SAGE_DISTFILES` as temporary directory.",
    "created_at": "2015-06-30T17:40:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263200",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nathanncohen](#comment:10):
> How can you check that?

I didn't say that you script should *check* all conditions. We need to define how the `spkg-src` script should be run, so we need to state the conditions precisely.

> Or do you mean that my script should only run them from the inside of a sage shell?

Yes.

> > 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)

> 
> I do not know how to check that either.


```
cd /
"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src
```

> > 1. The tarball should be created in the `$SAGE_DISTFILES` directory.

> 
> That would break the way the script currently works. It *compares* the file created by spkg-src with the one in `upstream/`. How could we deal with that?


```
SAGE_REAL_DISTFILES="$SAGE_DISTFILES"
export SAGE_DISTFILES=/some/temporary/directory
cd /
"$SAGE_ROOT/build/pkgs/$PKGNAME/spkg-src
compare "$SAGE_REAL_DISTFILES/$TARBALL" "$SAGE_DISTFILES/$TARBALL"
```

> Well, it will need some temporary directory anyway.

I think it could use `$SAGE_DISTFILES` as temporary directory.



---

archive/issue_comments_263201.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@nathanncohen](#comment:11):\n> If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.\n\n+1",
    "created_at": "2015-06-30T17:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@nathanncohen](#comment:11):
> If you see a way to work toward the idea that you have, then count me in. If you have wishes but no specific plan in mind, then I think that this script would help a lot, in the meantime.

+1



---

archive/issue_comments_263202.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nPlan:\n1. review #18788\n2. finish collecting specs for whats missing: Delete fluff, recompress, run autotools, anything else?\n3. write testcases\n4. implement",
    "created_at": "2015-06-30T17:54:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263202",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

Plan:
1. review #18788
2. finish collecting specs for whats missing: Delete fluff, recompress, run autotools, anything else?
3. write testcases
4. implement



---

archive/issue_comments_263203.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@vbraun](#comment:14):\n> Delete fluff, recompress, run autotools, anything else?\n\n- Download tarball\n- Apply patches (before running autotools)\n- Clone git repo, configure package, build package, make tarball using upstream script (e.g. PARI)\n- Change permissions\n- Merge more than one upstream tarball (e.g. ATLAS, Singular)\n- Move files around",
    "created_at": "2015-06-30T18:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263203",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@vbraun](#comment:14):
> Delete fluff, recompress, run autotools, anything else?

- Download tarball
- Apply patches (before running autotools)
- Clone git repo, configure package, build package, make tarball using upstream script (e.g. PARI)
- Change permissions
- Merge more than one upstream tarball (e.g. ATLAS, Singular)
- Move files around



---

archive/issue_comments_263204.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI would like to add a condition:\n5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n\nReason: Sage includes `bzip2` so we have a guaranteed version of `bzip2`.",
    "created_at": "2015-06-30T18:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263204",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I would like to add a condition:
5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.

Reason: Sage includes `bzip2` so we have a guaranteed version of `bzip2`.



---

archive/issue_comments_263205.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:12):\n> I think it could use `$SAGE_DISTFILES` as temporary directory.\n\nSee `autotools/spkg-src` for an implementation (except it uses `upstream` instead of `$SAGE_DISTFILES`)",
    "created_at": "2015-06-30T18:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263205",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:12):
> I think it could use `$SAGE_DISTFILES` as temporary directory.

See `autotools/spkg-src` for an implementation (except it uses `upstream` instead of `$SAGE_DISTFILES`)



---

archive/issue_comments_263206.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n6. The `spkg-src` script should use `sage-download-file` to download files (not a hard-coded `curl` or `wget`, which are not installed on all systems).",
    "created_at": "2015-06-30T18:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

6. The `spkg-src` script should use `sage-download-file` to download files (not a hard-coded `curl` or `wget`, which are not installed on all systems).



---

archive/issue_comments_263207.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:15):\n> - Merge more than one upstream tarball (e.g. ATLAS, Singular)\n\nReally the sad fact that the packaging system can only handle a single tarball ought to be remedied. This removes the need to combine tarballs AND fixes the autotools problem (just ship the autotools output in a separate tarball)",
    "created_at": "2015-06-30T18:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263207",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:15):
> - Merge more than one upstream tarball (e.g. ATLAS, Singular)

Really the sad fact that the packaging system can only handle a single tarball ought to be remedied. This removes the need to combine tarballs AND fixes the autotools problem (just ship the autotools output in a separate tarball)



---

archive/issue_events_267330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-30T20:00:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267330"
}
```



---

archive/issue_events_267331.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-30T20:00:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267331"
}
```



---

archive/issue_comments_263208.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nneeds_work because we're still very much discussing.",
    "created_at": "2015-06-30T20:00:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

needs_work because we're still very much discussing.



---

archive/issue_comments_263209.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n> * we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini\n\nIn case you plan to write something like that, don't lose your time with regexes, i have such feature almost ready (moreover the latest version is self-determinated). I wrote this in november so there might be some new packages missing, also there is still the problem for packages that are bundles (e.g. rubiks), and some packages whose download URL is not deterministic because of some kind of hash. I am curently facing some health issues, so i try to minimize my work by not opening tickets for extra features, i will open one for this soon.",
    "created_at": "2015-07-01T09:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263209",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:21" align="right">comment:21</div>

> * we should store the upstream URL (with a VERSION placeholder) somewhere, maybe in checksums.ini

In case you plan to write something like that, don't lose your time with regexes, i have such feature almost ready (moreover the latest version is self-determinated). I wrote this in november so there might be some new packages missing, also there is still the problem for packages that are bundles (e.g. rubiks), and some packages whose download URL is not deterministic because of some kind of hash. I am curently facing some health issues, so i try to minimize my work by not opening tickets for extra features, i will open one for this soon.



---

archive/issue_comments_263210.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> needs_work because we're still very much discussing.\n\nPart of the discussion is about other matters than what this branch contains: I wrote a script that I have often needed, in order to check that the packages that are proposed on trac ticket as an updated of upstream are indeed what they claim to be.\n\nRight now these operations have to be done manually, and often. Besides, as I am not the only one who does that I would say that they are of 'public interest'.\n\nI do not mind discussions on wider problems, but I still need a script for those daily/weekly operations that need to be done.\n\nNathann",
    "created_at": "2015-07-01T09:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263210",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">comment:22</div>

> needs_work because we're still very much discussing.

Part of the discussion is about other matters than what this branch contains: I wrote a script that I have often needed, in order to check that the packages that are proposed on trac ticket as an updated of upstream are indeed what they claim to be.

Right now these operations have to be done manually, and often. Besides, as I am not the only one who does that I would say that they are of 'public interest'.

I do not mind discussions on wider problems, but I still need a script for those daily/weekly operations that need to be done.

Nathann



---

archive/issue_comments_263211.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nYou are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.",
    "created_at": "2015-07-01T10:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263211",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.



---

archive/issue_comments_263212.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n> You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.\n\nHow are we supposed to check that packages updates are consistent? By doing exactly what this script does, manually?",
    "created_at": "2015-07-01T10:28:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263212",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">comment:24</div>

> You are welcome to use your script, but you don't need to enforce your own conventions on others if we are about to change them.

How are we supposed to check that packages updates are consistent? By doing exactly what this script does, manually?



---

archive/issue_comments_263213.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@nathanncohen](#comment:22):\n> Part of the discussion is about other matters than what this branch contains\n\nThe current branch contains a script to check X without properly defining X.\n\nThat makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the \"discussion\" part).",
    "created_at": "2015-07-01T10:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263213",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@nathanncohen](#comment:22):
> Part of the discussion is about other matters than what this branch contains

The current branch contains a script to check X without properly defining X.

That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the "discussion" part).



---

archive/issue_comments_263214.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n> The current branch contains a script to check X without properly defining X.\n> \n> That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the \"discussion\" part).\n\nI do not mind. I just want something to happen. Somehow with tickets like that, it's like everybody it fighting so that absolutely nothing happens, and burying tickets. This branch exists, while the others alternatives do not.\n\nAbout properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made. Except two:\n- The one about being able to run the script from any place\n- The one about moving the package to upstream\n\nI will implement this now, so please do not make me regret this later by asking me to do something impossible that you know I will not do, thus killing this ticket.\n\nNathann",
    "created_at": "2015-07-01T10:58:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263214",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">comment:26</div>

> The current branch contains a script to check X without properly defining X.
> 
> That makes no sense to me, so my proposal is to first clearly define X, possibly changing it slightly to X' (that's the "discussion" part).

I do not mind. I just want something to happen. Somehow with tickets like that, it's like everybody it fighting so that absolutely nothing happens, and burying tickets. This branch exists, while the others alternatives do not.

About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made. Except two:
- The one about being able to run the script from any place
- The one about moving the package to upstream

I will implement this now, so please do not make me regret this later by asking me to do something impossible that you know I will not do, thus killing this ticket.

Nathann



---

archive/issue_comments_263215.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@nathanncohen](#comment:26):\n> This branch exists, while the others alternatives do not.\n\nMore than once you have been angry with me that I write code on \"your\" ticket. So obviously, I'll avoid writing code on this ticket.",
    "created_at": "2015-07-01T11:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263215",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@nathanncohen](#comment:26):
> This branch exists, while the others alternatives do not.

More than once you have been angry with me that I write code on "your" ticket. So obviously, I'll avoid writing code on this ticket.



---

archive/issue_comments_263216.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae\">fa4edd7</a></td><td><code>trac #18226: New assumptions</code></td></tr></table>\n",
    "created_at": "2015-07-01T11:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263216",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae">fa4edd7</a></td><td><code>trac #18226: New assumptions</code></td></tr></table>




---

archive/issue_comments_263217.json:
```json
{
    "body": "Changed commit from **[ef4e8b0](https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9)** to **[fa4edd7](https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae)**",
    "created_at": "2015-07-01T11:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ef4e8b0](https://github.com/sagemath/sagetrac-mirror/commit/ef4e8b06491e61345809e10b349c03f6d54136a9)** to **[fa4edd7](https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae)**



---

archive/issue_comments_263218.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@nathanncohen](#comment:26):\n> About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made.\n\nSome other things we could check:\n7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n8. All symlinks in the tarball must be relative and point to an existing file.\n\nIf there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.",
    "created_at": "2015-07-01T11:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263218",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@nathanncohen](#comment:26):
> About properly defininf X: so far all the restrictions/assumptions you proposed, if I am not mistaken, are more constraining that those I made.

Some other things we could check:
7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
8. All symlinks in the tarball must be relative and point to an existing file.

If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.



---

archive/issue_comments_263219.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI made the requested modifications.\n\n> More than once you have been angry with me that I write code on \"your\" ticket. So obviously, I'll avoid writing code on this ticket.\n\nI would be glad if you could help me on this ticket. If I am alone against two release managers, I know that this is as good as dead.\n\nAbout pushing to 'my' tickets: my only objection is that you should refrain from pushing changes if you know that there is an opposition to them. If we agree that something must be done, then there is no problem in saying \"i'll do it\" and pushing the changes (when the branch is public).\n\nNathann",
    "created_at": "2015-07-01T11:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263219",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:30" align="right">comment:30</div>

I made the requested modifications.

> More than once you have been angry with me that I write code on "your" ticket. So obviously, I'll avoid writing code on this ticket.

I would be glad if you could help me on this ticket. If I am alone against two release managers, I know that this is as good as dead.

About pushing to 'my' tickets: my only objection is that you should refrain from pushing changes if you know that there is an opposition to them. If we agree that something must be done, then there is no problem in saying "i'll do it" and pushing the changes (when the branch is public).

Nathann



---

archive/issue_comments_263220.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nHello,\n\n> 7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n\nOh. In order to avoid the ugly 0777 files?\n\n> 8. All symlinks in the tarball must be relative and point to an existing file.\n\nI don't see any reason to oppose that, and I will pray that the current packages already satisfy it.\n\nCould you add a commit to check that, if you think them necessary? And if you do, could you update the 'list of assumptions' that I added to the head of the 'sanity-check' script? We will need that to write the doc later.\n\n> If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.\n\nWell, I would not have thought of those two things you just mentionned, but I see no reason to oppose them (unless we find out that 99% of the tarballs don't satisfy it). And I am afraid that I cannot remember anything else you mentionned that is not yet in my script.\n\nNathann",
    "created_at": "2015-07-01T11:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263220",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:31" align="right">comment:31</div>

Hello,

> 7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.

Oh. In order to avoid the ugly 0777 files?

> 8. All symlinks in the tarball must be relative and point to an existing file.

I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.

Could you add a commit to check that, if you think them necessary? And if you do, could you update the 'list of assumptions' that I added to the head of the 'sanity-check' script? We will need that to write the doc later.

> If there are any conditions that I mentioned that you don't agree with (regardless of whether the script on this ticket should check them), I'd like to know.

Well, I would not have thought of those two things you just mentionned, but I see no reason to oppose them (unless we find out that 99% of the tarballs don't satisfy it). And I am afraid that I cannot remember anything else you mentionned that is not yet in my script.

Nathann



---

archive/issue_comments_263221.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@nathanncohen](#comment:31):\n> I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.\n\nAt least `lrcalc` does not:\n\n```\njdemeyer@tamiyo:/usr/local/src/sage-config/upstream$ ls -l lrcalc-1.1.7/m4\ntotal 0\nlrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 libtool.m4 -> /usr/share/aclocal/libtool.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 33 Jul 25  2012 lt~obsolete.m4 -> /usr/share/aclocal/lt~obsolete.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltoptions.m4 -> /usr/share/aclocal/ltoptions.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 ltsugar.m4 -> /usr/share/aclocal/ltsugar.m4\nlrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltversion.m4 -> /usr/share/aclocal/ltversion.m4\n```",
    "created_at": "2015-07-01T11:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263221",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@nathanncohen](#comment:31):
> I don't see any reason to oppose that, and I will pray that the current packages already satisfy it.

At least `lrcalc` does not:

```
jdemeyer@tamiyo:/usr/local/src/sage-config/upstream$ ls -l lrcalc-1.1.7/m4
total 0
lrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 libtool.m4 -> /usr/share/aclocal/libtool.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 33 Jul 25  2012 lt~obsolete.m4 -> /usr/share/aclocal/lt~obsolete.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltoptions.m4 -> /usr/share/aclocal/ltoptions.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 29 Jul 25  2012 ltsugar.m4 -> /usr/share/aclocal/ltsugar.m4
lrwxrwxrwx 1 jdemeyer jdemeyer 31 Jul 25  2012 ltversion.m4 -> /usr/share/aclocal/ltversion.m4
```



---

archive/issue_comments_263222.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nTo refresh your mind about the conditions:\n1. The `spkg-src` script should only be run within a Sage shell.\n2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n3. The tarball should be created in the `$SAGE_DISTFILES` directory.\n4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n6. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).\n7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n8. All symlinks in the tarball must be relative and point to an existing file.",
    "created_at": "2015-07-01T11:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263222",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

To refresh your mind about the conditions:
1. The `spkg-src` script should only be run within a Sage shell.
2. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)
3. The tarball should be created in the `$SAGE_DISTFILES` directory.
4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.
5. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.
6. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).
7. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
8. All symlinks in the tarball must be relative and point to an existing file.



---

archive/issue_comments_263223.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nYou have an additional assumption\n\n```\n# - When uncompressed, the archive creates a \"src/\" or a\n#   \"<package_name>-<version>/\" directory\n```\nwhich I think is not needed.\n\nSuch an assumption was needed for old-style spkg files due to the way that `sage-spkg` works, but for new-style packages this is really not needed.",
    "created_at": "2015-07-01T11:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263223",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

You have an additional assumption

```
# - When uncompressed, the archive creates a "src/" or a
#   "<package_name>-<version>/" directory
```
which I think is not needed.

Such an assumption was needed for old-style spkg files due to the way that `sage-spkg` works, but for new-style packages this is really not needed.



---

archive/issue_comments_263224.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\n> 1. The `spkg-src` script should only be run within a Sage shell.\n\nI updated the sanity-check script on this respect.\n\n> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)\n\nI checked that too, using your test.\n\n> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.\n\nAlso checked.\n\n> 1. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\nI do not know how to check that. Is it easily done? It does not seem so important that we should go out of our way to check it.\n\n> 1. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.\n\nWe also have many .tar.gz in 'upstream/'. But I do not see a need to enforce something like that.\n\n> 1. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).\n\nWhy would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.\n\n> 1. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.\n> 2. All symlinks in the tarball must be relative and point to an existing file.\n\nI do not think that we need any of those two, but I don't see any reason to oppose you on that. The best for this is probably to try it on several packages, and figure out if this is a reasonable assumption to make. If packages don't already satisfy that, I don't see what we could do against it.\n\n> Such an assumption was needed for old-style spkg files due to the way that sage-spkg works, but for new-style packages this is really not needed.\n\nI do not see how to avoid it: if you do, you can add a commit.\n\nNathann",
    "created_at": "2015-07-01T11:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263224",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:35" align="right">comment:35</div>

> 1. The `spkg-src` script should only be run within a Sage shell.

I updated the sanity-check script on this respect.

> 1. The `spkg-src` script should be runnable from any directory (do not assume the current directory is `build/pkgs/PKGNAME`)

I checked that too, using your test.

> 1. The tarball should be created in the `$SAGE_DISTFILES` directory.

Also checked.

> 1. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.

I do not know how to check that. Is it easily done? It does not seem so important that we should go out of our way to check it.

> 1. The resulting tarball should be either uncompressed with a `.tar` extension of bzipped with a `.tar.bz2` extension.

We also have many .tar.gz in 'upstream/'. But I do not see a need to enforce something like that.

> 1. The `spkg-src` script should use `sage-download-file` to download files (not `curl` or `wget`, which are not installed on all systems).

Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.

> 1. All directories in the tarball should have 0755 permission. All ordinary files should have 0755 or 0644 permission. *Possibly add:* every file which has 0755 permission must start with `#!`.
> 2. All symlinks in the tarball must be relative and point to an existing file.

I do not think that we need any of those two, but I don't see any reason to oppose you on that. The best for this is probably to try it on several packages, and figure out if this is a reasonable assumption to make. If packages don't already satisfy that, I don't see what we could do against it.

> Such an assumption was needed for old-style spkg files due to the way that sage-spkg works, but for new-style packages this is really not needed.

I do not see how to avoid it: if you do, you can add a commit.

Nathann



---

archive/issue_comments_263225.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@nathanncohen](#comment:35):\n> We also have many .tar.gz in 'upstream/'.\n\nI have nothing against that.\n\nI'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2` file (there is really no reason to create a `.gz` file, since those are usually larger than the corresponding `.bz2` file).",
    "created_at": "2015-07-01T12:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263225",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@nathanncohen](#comment:35):
> We also have many .tar.gz in 'upstream/'.

I have nothing against that.

I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2` file (there is really no reason to create a `.gz` file, since those are usually larger than the corresponding `.bz2` file).



---

archive/issue_comments_263226.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@nathanncohen](#comment:35):\n> Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.\n\nWell, some `spkg-src` scripts use `wget`, others use `curl`...\n\nFor portability, we should use `sage-download-file` which is guaranteed to work.",
    "created_at": "2015-07-01T12:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263226",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@nathanncohen](#comment:35):
> Why would you make such restrictions? Those spkg-src scripts are run manually and by developpers, at the moment. They know how to deal with a 'wget not found'.

Well, some `spkg-src` scripts use `wget`, others use `curl`...

For portability, we should use `sage-download-file` which is guaranteed to work.



---

archive/issue_comments_263227.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\n> I have nothing against that.\n> \n> I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2`\n\nThat could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?",
    "created_at": "2015-07-01T12:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263227",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:38" align="right">comment:38</div>

> I have nothing against that.
> 
> I'm just saying: *if* the tarball was created using a `spkg-src` script, then it should be either a `.tar` or `.tar.bz2`

That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?



---

archive/issue_comments_263228.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n> Well, some `spkg-src` scripts use `wget`, others use `curl`...\n> \n> For portability, we should use `sage-download-file` which is guaranteed to work.\n\nI think that you want to give us a protection that we do not need. Assuming that a developer has wget on his computer is pretty mild...",
    "created_at": "2015-07-01T12:11:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263228",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:39" align="right">comment:39</div>

> Well, some `spkg-src` scripts use `wget`, others use `curl`...
> 
> For portability, we should use `sage-download-file` which is guaranteed to work.

I think that you want to give us a protection that we do not need. Assuming that a developer has wget on his computer is pretty mild...



---

archive/issue_comments_263229.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60\">ef3d7c4</a></td><td><code>trac #18826: Cleaning a bit some spkg-src scripts</code></td></tr></table>\n",
    "created_at": "2015-07-01T19:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263229",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60">ef3d7c4</a></td><td><code>trac #18826: Cleaning a bit some spkg-src scripts</code></td></tr></table>




---

archive/issue_comments_263230.json:
```json
{
    "body": "Changed commit from **[fa4edd7](https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae)** to **[ef3d7c4](https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60)**",
    "created_at": "2015-07-01T19:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263230",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fa4edd7](https://github.com/sagemath/sagetrac-mirror/commit/fa4edd7810fb1d599f08d01c79a8183a0a806eae)** to **[ef3d7c4](https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60)**



---

archive/issue_comments_263231.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nathanncohen](#comment:38):\n> That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?\n\nNo, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.",
    "created_at": "2015-07-01T19:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263231",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nathanncohen](#comment:38):
> That could force us to decompress+recompress some archives given by upstream, just because we think our compression is always better?

No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.



---

archive/issue_comments_263232.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@nathanncohen](#comment:39):\n> Assuming that a developer has wget on his computer is pretty mild...\n\n1. `wget` is not installed by default on OS X.\n2. There is no `wget` Sage package.",
    "created_at": "2015-07-01T19:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263232",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@nathanncohen](#comment:39):
> Assuming that a developer has wget on his computer is pretty mild...

1. `wget` is not installed by default on OS X.
2. There is no `wget` Sage package.



---

archive/issue_comments_263233.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\n> No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.\n\nYou seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other.",
    "created_at": "2015-07-01T19:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263233",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:43" align="right">comment:43</div>

> No, I clearly said **if the package uses a spkg-src file**. If there is not a `spkg-src` file, then no recompression is needed.

You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other.



---

archive/issue_comments_263234.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nNathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.",
    "created_at": "2015-07-01T19:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263234",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.



---

archive/issue_comments_263235.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@nathanncohen](#comment:43):\n> You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other. \n\nOK, here is an adjusted assumption:\n5. If the `spkg-src` script does compress the tarball, it should use `bzip2` for that.",
    "created_at": "2015-07-01T19:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263235",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@nathanncohen](#comment:43):
> You seem to assume that there is a spkg-src file only if there is something to change in the package. I did not assume that. That's why we do not understand each other. 

OK, here is an adjusted assumption:
5. If the `spkg-src` script does compress the tarball, it should use `bzip2` for that.



---

archive/issue_comments_263236.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n> Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.\n\nI don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. About 'wget' I think that it is really going too far, but as you never give way on any point for the sake of good mood, well, I am forced to do it.\n\nNo problem for this bz2 thing, we had the same thing in mind all along.",
    "created_at": "2015-07-01T19:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263236",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:46" align="right">comment:46</div>

> Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.

I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. About 'wget' I think that it is really going too far, but as you never give way on any point for the sake of good mood, well, I am forced to do it.

No problem for this bz2 thing, we had the same thing in mind all along.



---

archive/issue_comments_263237.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nWhat do we do with this? Do we continue, or do we close this as wontfix?",
    "created_at": "2015-07-09T09:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263237",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:47" align="right">comment:47</div>

What do we do with this? Do we continue, or do we close this as wontfix?



---

archive/issue_comments_263238.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nContinue I would say, but at the moment I don't have much time for this...",
    "created_at": "2015-07-09T09:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263238",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Continue I would say, but at the moment I don't have much time for this...



---

archive/issue_comments_263239.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\n> Continue I would say, but at the moment I don't have much time for this...\n\nWhat would you say that we have to do?\n\nI can write the doc, perhaps? And explain the different assumptions?\n\nAlso, you said that there was a trick for this problem with running autotools on different machines?\n\nNathann",
    "created_at": "2015-07-09T09:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263239",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:49" align="right">comment:49</div>

> Continue I would say, but at the moment I don't have much time for this...

What would you say that we have to do?

I can write the doc, perhaps? And explain the different assumptions?

Also, you said that there was a trick for this problem with running autotools on different machines?

Nathann



---

archive/issue_comments_263240.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@nathanncohen](#comment:49):\n> Also, you said that there was a trick for this problem with running autotools on different machines?\n\nIf the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of \"plain\" `auto(re)conf` (which a suitable error message of the form \"please install the autotools package\").",
    "created_at": "2015-07-09T09:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263240",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@nathanncohen](#comment:49):
> Also, you said that there was a trick for this problem with running autotools on different machines?

If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of "plain" `auto(re)conf` (which a suitable error message of the form "please install the autotools package").



---

archive/issue_comments_263241.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\n> If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of \"plain\" `auto(re)conf` (which a suitable error message of the form \"please install the autotools package\").\n\nOkay, that's a good news. Should I start writing the doc, or do you see a reason why we should not do it at the moment?",
    "created_at": "2015-07-09T09:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263241",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:51" align="right">comment:51</div>

> If the Sage autotools package is installed, it should produce the same output on all systems. So, ideally, `spkg-src` should call `$SAGE_LOCAL/bin/auto(re)conf` instead of "plain" `auto(re)conf` (which a suitable error message of the form "please install the autotools package").

Okay, that's a good news. Should I start writing the doc, or do you see a reason why we should not do it at the moment?



---

archive/issue_comments_263242.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@nathanncohen](#comment:46):\n> > Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.\n\n> \n> I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. \n\nHello,\nI am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?",
    "created_at": "2015-07-10T11:57:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263242",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@nathanncohen](#comment:46):
> > Nathann, more seriously: can we please not change so many `spkg-src` scripts on this ticket? I would really prefer to change just one or two as an example and leave the rest for a follow-up ticket.

> 
> I don't mind. It is just very very hot in england right now, and that's the only thing I am able to do. So I stop trying to fix giac. 

Hello,
I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?



---

archive/issue_comments_263243.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\n> I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?\n\nDon't bother with that for the moment. Write a clean spkg-src if you can (trusting your own idea of what it should do), but what is going on here is far from being merged, so don't let it add more work on your heap.\n\nNathann",
    "created_at": "2015-07-10T12:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263243",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:53" align="right">comment:53</div>

> I am working on an updtate for giac spkg here #18841. Do you prefer that I try to follow your instructions for spkg-src in #18841 or in this ticket?

Don't bother with that for the moment. Write a clean spkg-src if you can (trusting your own idea of what it should do), but what is going on here is far from being merged, so don't let it add more work on your heap.

Nathann



---

archive/issue_comments_263244.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nThank you, so now I'd rather keep my checksum.ini unchanged to not bother someone who had already built the package. So I have just put a comment to remind to switch from gz to bz2\nand made other modifications such that spkg-src passes you current sage-sanity-check-package test.",
    "created_at": "2015-07-10T15:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263244",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:54" align="right">comment:54</div>

Thank you, so now I'd rather keep my checksum.ini unchanged to not bother someone who had already built the package. So I have just put a comment to remind to switch from gz to bz2
and made other modifications such that spkg-src passes you current sage-sanity-check-package test.



---

archive/issue_comments_263245.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nLet me weaken\n\n> 4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.\n\nto\n\n4. Apart from temporary files, the script should not change any file outside `$SAGE_DISTFILES`. Using `build/pkgs/pkgname` or `$SAGE_ROOT/tmp` as temporary directory is fine, but all temporary files should be deleted when the script is finished.",
    "created_at": "2015-07-11T17:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263245",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Let me weaken

> 4. The script should not change any file (not even temporary) outside `$SAGE_DISTFILES`.

to

4. Apart from temporary files, the script should not change any file outside `$SAGE_DISTFILES`. Using `build/pkgs/pkgname` or `$SAGE_ROOT/tmp` as temporary directory is fine, but all temporary files should be deleted when the script is finished.



---

archive/issue_comments_263246.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nHello,\n\nIs everybody waiting for this ticket to get forgotten, or do we make something happen?\n\nNathann",
    "created_at": "2015-07-21T15:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263246",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:56" align="right">comment:56</div>

Hello,

Is everybody waiting for this ticket to get forgotten, or do we make something happen?

Nathann



---

archive/issue_comments_263247.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1\">5372942</a></td><td><code>trac #18826: Merged with 6.8.rc0</code></td></tr></table>\n",
    "created_at": "2015-07-21T15:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263247",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1">5372942</a></td><td><code>trac #18826: Merged with 6.8.rc0</code></td></tr></table>




---

archive/issue_comments_263248.json:
```json
{
    "body": "Changed commit from **[ef3d7c4](https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60)** to **[5372942](https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1)**",
    "created_at": "2015-07-21T15:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ef3d7c4](https://github.com/sagemath/sagetrac-mirror/commit/ef3d7c4f662be3fc8da6a7f1e2053fcfd7cd1b60)** to **[5372942](https://github.com/sagemath/sagetrac-mirror/commit/53729424c4d5fd160b185ce0bd4f3a2a2fa9c9c1)**



---

archive/issue_comments_263249.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nClose to anniversary.",
    "created_at": "2016-07-05T20:22:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263249",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:58" align="right">comment:58</div>

Close to anniversary.



---

archive/issue_events_267332.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267332"
}
```



---

archive/issue_events_267333.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267333"
}
```



---

archive/issue_events_267334.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267334"
}
```



---

archive/issue_events_267335.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267335"
}
```



---

archive/issue_events_267336.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T18:43:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267336"
}
```



---

archive/issue_comments_263250.json:
```json
{
    "body": "Changed author from **Nathann Cohen** to none",
    "created_at": "2022-08-06T18:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263250",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Nathann Cohen** to none



---

archive/issue_comments_263251.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI think this can be closed as obsolete",
    "created_at": "2022-08-06T18:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

I think this can be closed as obsolete



---

archive/issue_comments_263252.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nIt seems so.",
    "created_at": "2022-08-07T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263252",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:60" align="right">comment:60</div>

It seems so.



---

archive/issue_comments_263253.json:
```json
{
    "body": "Reviewer: **Kwankyu Lee**",
    "created_at": "2022-08-07T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18826#issuecomment-263253",
    "user": "https://github.com/kwankyu"
}
```

Reviewer: **Kwankyu Lee**



---

archive/issue_events_267337.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-08-07T10:10:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267337"
}
```



---

archive/issue_events_267338.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-08-07T10:10:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267338"
}
```



---

archive/issue_events_267339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T02:30:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267339"
}
```



---

archive/issue_events_267340.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T02:30:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18826",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18826#event-267340"
}
```
