# Issue 18347: implement the shard intersection order on permutations

archive/issues_018110.json:
```json
{
    "assignees": [],
    "body": "This is a poset (and even a lattice) introduced by N. Reading in 2011.\n\nIt has nice properties, similar to that of noncrossing partitions.\n\nLet's have it in sage.\n\nCC:  @darijgr @tscrim @hughrthomas\n\nComponent: **combinatorics**\n\nKeywords: **poset**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch: **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**\n\nReviewer: **Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18347_\n\n",
    "closed_at": "2015-05-23T22:59:55Z",
    "created_at": "2015-05-01T12:47:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement the shard intersection order on permutations",
    "type": "issue",
    "updated_at": "2016-05-24T03:29:37Z",
    "url": "https://github.com/sagemath/sage/issues/18347",
    "user": "https://github.com/fchapoton"
}
```
This is a poset (and even a lattice) introduced by N. Reading in 2011.

It has nice properties, similar to that of noncrossing partitions.

Let's have it in sage.

CC:  @darijgr @tscrim @hughrthomas

Component: **combinatorics**

Keywords: **poset**

Author: **Frédéric Chapoton**

Branch: **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**

Reviewer: **Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/18347_





---

archive/issue_events_258414.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-01T12:47:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258414"
}
```



---

archive/issue_events_258415.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-01T12:47:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258415"
}
```



---

archive/issue_events_258416.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-01T12:47:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258416"
}
```



---

archive/issue_events_258417.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-01T12:47:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258417"
}
```



---

archive/issue_comments_252233.json:
```json
{
    "body": "Branch: **[u/chapoton/18347](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18347)**",
    "created_at": "2015-05-01T12:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252233",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/18347](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18347)**



---

archive/issue_comments_252234.json:
```json
{
    "body": "Commit: **[`5d0cf22`](https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8)**",
    "created_at": "2015-05-01T12:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252234",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`5d0cf22`](https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8)**



---

archive/issue_events_258418.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-01T12:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258418"
}
```



---

archive/issue_comments_252235.json:
```json
{
    "body": "Changed keywords from none to **poset**",
    "created_at": "2015-05-01T12:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252235",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from none to **poset**



---

archive/issue_comments_252236.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8\"><code>5d0cf22</code></a></td><td><code>trac #18345 implement the shard intersection order of type A</code></td></tr></table>\n",
    "created_at": "2015-05-01T12:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252236",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8"><code>5d0cf22</code></a></td><td><code>trac #18345 implement the shard intersection order of type A</code></td></tr></table>




---

archive/issue_comments_252237.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYou might have forgotten to git-add the main file?",
    "created_at": "2015-05-01T13:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252237",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:2" align="right">comment:2</div>

You might have forgotten to git-add the main file?



---

archive/issue_comments_252238.json:
```json
{
    "body": "Changed commit from **[`5d0cf22`](https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8)** to **[`c8d9000`](https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38)**",
    "created_at": "2015-05-01T13:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252238",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5d0cf22`](https://github.com/sagemath/sagetrac-mirror/commit/5d0cf22c73b983f3b59d2dd154205d78f0a2e7c8)** to **[`c8d9000`](https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38)**



---

archive/issue_comments_252239.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38\"><code>c8d9000</code></a></td><td><code>trac #18347 main file was forgotten</code></td></tr></table>\n",
    "created_at": "2015-05-01T13:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252239",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38"><code>c8d9000</code></a></td><td><code>trac #18347 main file was forgotten</code></td></tr></table>




---

archive/issue_comments_252240.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\noops, indeed, I was a bit too quick\n\nDo you think that descending_runs should be integrated into runs ?",
    "created_at": "2015-05-01T13:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252240",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

oops, indeed, I was a bit too quick

Do you think that descending_runs should be integrated into runs ?



---

archive/issue_comments_252241.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't know -- this seems to be a matter of taste.",
    "created_at": "2015-05-01T13:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252241",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't know -- this seems to be a matter of taste.



---

archive/issue_events_258419.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-01T20:34:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258419"
}
```



---

archive/issue_events_258420.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-01T20:34:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258420"
}
```



---

archive/issue_comments_252242.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHello,\n\n1. In `decreasing_runs` why are you creating a list to return a tuple? You would better use\n\n```\nreturn tuple(tuple([n + 1 - i for i in r]) for r in s_bar.runs())\n```\n\n2. What is the point of the `cached_function` on `shard_preorder_graph`? As far as I understand the information is only temporarily used to construct the poset. The poset constructor basically makes comparison between all pairs. So you are storing information that will never be used beyond constructing the poset.\n\n- proposition 1: implement better the data to initialize the poset from\n- (ugly) proposition 2: clear the cache when you are done\n\n```\nSn = [s.decreasing_runs() for s in Permutations(n)]\nP = Poset([Sn, shard_compares], cover_relations=False)\nshard_preorder_graph.clear_cache()\nreturn P\n```\n\n3. This \n\n```\ndico1 = {}\n# conversion: integer -> index of run in r1\nfor i, bloc in enumerate(r1):\n    for j in bloc:\n        dico1[j] = i\n```\n  can be\n\n```\ndico1 = {j:i for i,bloc in enumerate(r1) for j in bloc}\n```\n\nVincent",
    "created_at": "2015-05-01T20:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252242",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Hello,

1. In `decreasing_runs` why are you creating a list to return a tuple? You would better use

```
return tuple(tuple([n + 1 - i for i in r]) for r in s_bar.runs())
```

2. What is the point of the `cached_function` on `shard_preorder_graph`? As far as I understand the information is only temporarily used to construct the poset. The poset constructor basically makes comparison between all pairs. So you are storing information that will never be used beyond constructing the poset.

- proposition 1: implement better the data to initialize the poset from
- (ugly) proposition 2: clear the cache when you are done

```
Sn = [s.decreasing_runs() for s in Permutations(n)]
P = Poset([Sn, shard_compares], cover_relations=False)
shard_preorder_graph.clear_cache()
return P
```

3. This 

```
dico1 = {}
# conversion: integer -> index of run in r1
for i, bloc in enumerate(r1):
    for j in bloc:
        dico1[j] = i
```
  can be

```
dico1 = {j:i for i,bloc in enumerate(r1) for j in bloc}
```

Vincent



---

archive/issue_comments_252243.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186\"><code>e32ecc3</code></a></td><td><code>trac #18347 some of the reviewer's minor comments</code></td></tr></table>\n",
    "created_at": "2015-05-02T12:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252243",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186"><code>e32ecc3</code></a></td><td><code>trac #18347 some of the reviewer's minor comments</code></td></tr></table>




---

archive/issue_comments_252244.json:
```json
{
    "body": "Changed commit from **[`c8d9000`](https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38)** to **[`e32ecc3`](https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186)**",
    "created_at": "2015-05-02T12:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252244",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c8d9000`](https://github.com/sagemath/sagetrac-mirror/commit/c8d90002fe00c2ace0fa56abd7b035974645ed38)** to **[`e32ecc3`](https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186)**



---

archive/issue_comments_252245.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks for the comments. I have corrected the two minor ones.\n\nAbout the caching: indeed, this is used only in the poset, but used many times.\n\nIt is not clear to me how to avoid that. One could precompute in the poset method all\nthese digraphs, and keep them in a list or a dictionary, and make the `shard_compares` method an internal one. I am not convinced that this would make things more clear.",
    "created_at": "2015-05-02T12:30:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252245",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks for the comments. I have corrected the two minor ones.

About the caching: indeed, this is used only in the poset, but used many times.

It is not clear to me how to avoid that. One could precompute in the poset method all
these digraphs, and keep them in a list or a dictionary, and make the `shard_compares` method an internal one. I am not convinced that this would make things more clear.



---

archive/issue_comments_252246.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@fchapoton](#comment%3A8):\n> Thanks for the comments. I have corrected the two minor ones.\n> \n> About the caching: indeed, this is used only in the poset, but used many times.\n\nIt is currently not used **in** the poset, only during its construction! Just have a look at the ugly poset code. It is not lazy at all.\n \n4. `runs` and `decreasing_runs` should return the same data. It is currently list for one of them and tuple for the other.\n\n5. Why did you wrote the following comment in `shard_compares`?\n\n```\n# We assume that r1 has less runs than r0\n```\n\n6. The function `shard_preorder_graph` only depends on the interval not on the runs themselves. So you are storing too much in the cache of this function. Make the input a tuple of pairs\n\n```\nsage: s = Permutation([2,8,3,9,6,4,5,1,7])\nsage: runs = s.decreasing_runs()\nsage: shard_preorder_graph(runs) == \\\n....:    shard_preorder_graph(tuple((r[0],r[-1]) for r in runs))\nTrue\n```\n  And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?\n\nVincent",
    "created_at": "2015-05-02T13:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252246",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@fchapoton](#comment%3A8):
> Thanks for the comments. I have corrected the two minor ones.
> 
> About the caching: indeed, this is used only in the poset, but used many times.

It is currently not used **in** the poset, only during its construction! Just have a look at the ugly poset code. It is not lazy at all.
 
4. `runs` and `decreasing_runs` should return the same data. It is currently list for one of them and tuple for the other.

5. Why did you wrote the following comment in `shard_compares`?

```
# We assume that r1 has less runs than r0
```

6. The function `shard_preorder_graph` only depends on the interval not on the runs themselves. So you are storing too much in the cache of this function. Make the input a tuple of pairs

```
sage: s = Permutation([2,8,3,9,6,4,5,1,7])
sage: runs = s.decreasing_runs()
sage: shard_preorder_graph(runs) == \
....:    shard_preorder_graph(tuple((r[0],r[-1]) for r in runs))
True
```
  And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?

Vincent



---

archive/issue_comments_252247.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment%3A9):\n> Replying to [@fchapoton](#comment%3A8):\n>   And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?\n\nThis is not quite true, sorry. You are building a comparability graph that also does depend on the order of the input. Not only on the intervals themselves...\n\nVincent",
    "created_at": "2015-05-02T13:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252247",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment%3A9):
> Replying to [@fchapoton](#comment%3A8):
>   And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?

This is not quite true, sorry. You are building a comparability graph that also does depend on the order of the input. Not only on the intervals themselves...

Vincent



---

archive/issue_comments_252248.json:
```json
{
    "body": "Changed commit from **[`e32ecc3`](https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186)** to **[`88b08d5`](https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a)**",
    "created_at": "2015-05-02T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e32ecc3`](https://github.com/sagemath/sagetrac-mirror/commit/e32ecc3a9702cc7ab69ba180eb75f02623418186)** to **[`88b08d5`](https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a)**



---

archive/issue_comments_252249.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a\"><code>88b08d5</code></a></td><td><code>trac #18347 more reviewer comments, still not the main one</code></td></tr></table>\n",
    "created_at": "2015-05-02T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252249",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a"><code>88b08d5</code></a></td><td><code>trac #18347 more reviewer comments, still not the main one</code></td></tr></table>




---

archive/issue_comments_252250.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHello,\n\nyes, this is a rather subtle order, I think. It is indeed closely related to noncrossing\npartitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.\n\nConcerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?\n\nConcerning 5: I have added this as a simple necessary condition\n\nconcerning 6: I have made `shard_preorder_graph` input a tuple of pairs",
    "created_at": "2015-05-02T15:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252250",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

Hello,

yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing
partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.

Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?

Concerning 5: I have added this as a simple necessary condition

concerning 6: I have made `shard_preorder_graph` input a tuple of pairs



---

archive/issue_comments_252251.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWhy not making it a poset on permutations?\n\nReplying to [@fchapoton](#comment%3A12):\n> Hello,\n> \n> yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing\n> partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.\n> \n> Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?\n\nI think so.\n\n> Concerning 5: I have added this as a simple necessary condition\n> \n> concerning 6: I have made `shard_preorder_graph` input a tuple of pairs\n\nNice.\n\n\nI uploaded a branch at `public/18347` in which instead of storing every graph in an external function I created a new class for `ShardPosetElement`. It does some precomputation. It is much cleaner. It is just a toy implementation to let you see. Your previous `shard_compares` is now `ShardPosetElement.__le__`.\n\nBeyond these technicalities:\n- you must put more definitions (about the order, etc)\n- you should put more relevant doctest! \n\n```\n        sage: P = posets.ShardPoset(4); P\n        Finite poset containing 24 elements\n        sage: len(P.maximal_chains())\n        34\n        sage: P.is_selfdual()\n        False\n```\n  is clearly not enough!\n\nVincent",
    "created_at": "2015-05-02T17:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252251",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Why not making it a poset on permutations?

Replying to [@fchapoton](#comment%3A12):
> Hello,
> 
> yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing
> partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.
> 
> Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?

I think so.

> Concerning 5: I have added this as a simple necessary condition
> 
> concerning 6: I have made `shard_preorder_graph` input a tuple of pairs

Nice.


I uploaded a branch at `public/18347` in which instead of storing every graph in an external function I created a new class for `ShardPosetElement`. It does some precomputation. It is much cleaner. It is just a toy implementation to let you see. Your previous `shard_compares` is now `ShardPosetElement.__le__`.

Beyond these technicalities:
- you must put more definitions (about the order, etc)
- you should put more relevant doctest! 

```
        sage: P = posets.ShardPoset(4); P
        Finite poset containing 24 elements
        sage: len(P.maximal_chains())
        34
        sage: P.is_selfdual()
        False
```
  is clearly not enough!

Vincent



---

archive/issue_comments_252252.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c57e836e289885e4739d212f7cf037b15309b673\"><code>c57e836</code></a></td><td><code>Create a ShardPosetElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79d2e2b83ab11a437032b0d0e77777207e036c89\"><code>79d2e2b</code></a></td><td><code>Merge branch 'public/18347' into 6.7.b4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3375c01e3e974a43027bb7b05775dcdbef2213f\"><code>d3375c0</code></a></td><td><code>trac #18347 as_tuple option for runs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2501085920f50ec536b3d03ef5f74d0ce6c3e5b\"><code>f250108</code></a></td><td><code>trac #18347 ok for the ShardPosetElement class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894\"><code>70cf5e8</code></a></td><td><code>trac #18347 more serious doctesting</code></td></tr></table>\n",
    "created_at": "2015-05-06T14:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252252",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c57e836e289885e4739d212f7cf037b15309b673"><code>c57e836</code></a></td><td><code>Create a ShardPosetElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79d2e2b83ab11a437032b0d0e77777207e036c89"><code>79d2e2b</code></a></td><td><code>Merge branch 'public/18347' into 6.7.b4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3375c01e3e974a43027bb7b05775dcdbef2213f"><code>d3375c0</code></a></td><td><code>trac #18347 as_tuple option for runs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2501085920f50ec536b3d03ef5f74d0ce6c3e5b"><code>f250108</code></a></td><td><code>trac #18347 ok for the ShardPosetElement class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894"><code>70cf5e8</code></a></td><td><code>trac #18347 more serious doctesting</code></td></tr></table>




---

archive/issue_comments_252253.json:
```json
{
    "body": "Changed commit from **[`88b08d5`](https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a)** to **[`70cf5e8`](https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894)**",
    "created_at": "2015-05-06T14:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252253",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`88b08d5`](https://github.com/sagemath/sagetrac-mirror/commit/88b08d58b257dbaa72ab98f027cc5023d7224a2a)** to **[`70cf5e8`](https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894)**



---

archive/issue_comments_252254.json:
```json
{
    "body": "Changed commit from **[`70cf5e8`](https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894)** to **[`db7c51a`](https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d)**",
    "created_at": "2015-05-07T08:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252254",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70cf5e8`](https://github.com/sagemath/sagetrac-mirror/commit/70cf5e89ef4898cc519204e55fbcdfe797215894)** to **[`db7c51a`](https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d)**



---

archive/issue_comments_252255.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d\"><code>db7c51a</code></a></td><td><code>trac #18347 more explanations in the doc</code></td></tr></table>\n",
    "created_at": "2015-05-07T08:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252255",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d"><code>db7c51a</code></a></td><td><code>trac #18347 more explanations in the doc</code></td></tr></table>




---

archive/issue_comments_252256.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI have added some explanations. Enough ?",
    "created_at": "2015-05-11T12:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252256",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

I have added some explanations. Enough ?



---

archive/issue_events_258421.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-11T12:20:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258421"
}
```



---

archive/issue_events_258422.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-11T12:20:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258422"
}
```



---

archive/issue_comments_252257.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHello,\n\nWhat does `connected_parts` is doing in the git branch?\n\nYou should work harder on `ShardPosetElement`:\n\n1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)\n\n2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)\n\n3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:\n\n```\nif type(self) is not type(other) or len(self) != len(other):\n    raise TypeError(\"these are not comparable\")\n```\n\n4. Do you want to keep all attributes of `ShardPosetElement` public as they are?\n\nVincent",
    "created_at": "2015-05-11T16:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252257",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

Hello,

What does `connected_parts` is doing in the git branch?

You should work harder on `ShardPosetElement`:

1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)

2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)

3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:

```
if type(self) is not type(other) or len(self) != len(other):
    raise TypeError("these are not comparable")
```

4. Do you want to keep all attributes of `ShardPosetElement` public as they are?

Vincent



---

archive/issue_events_258423.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-11T16:27:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258423"
}
```



---

archive/issue_events_258424.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-11T16:27:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258424"
}
```



---

archive/issue_comments_252258.json:
```json
{
    "body": "Changed commit from **[`db7c51a`](https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d)** to **[`878ed3a`](https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348)**",
    "created_at": "2015-05-11T17:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252258",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`db7c51a`](https://github.com/sagemath/sagetrac-mirror/commit/db7c51a51a7e37d39a5ee015772d5cdc3e254e2d)** to **[`878ed3a`](https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348)**



---

archive/issue_comments_252259.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d82ebd8e22cde134927f18e62fde3440993ffbe7\"><code>d82ebd8</code></a></td><td><code>trac #18347 inherit from tuple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348\"><code>878ed3a</code></a></td><td><code>trac #18347 remove connected_parts</code></td></tr></table>\n",
    "created_at": "2015-05-11T17:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252259",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d82ebd8e22cde134927f18e62fde3440993ffbe7"><code>d82ebd8</code></a></td><td><code>trac #18347 inherit from tuple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348"><code>878ed3a</code></a></td><td><code>trac #18347 remove connected_parts</code></td></tr></table>




---

archive/issue_comments_252260.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHello\n\n> What does `connected_parts` is doing in the git branch?\n\nWell, I removed it. Could go in another ticket maybe.\n \n> 1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)\n\nDone\n\n> 2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)\n\nIs this really necessary ? This class is just there to help build the poset, there is no way\nit will be ever used for something else, I think.\n\n> 3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:\n> \n> ```\n> if type(self) is not type(other) or len(self) != len(other):\n>     raise TypeError(\"these are not comparable\")\n> ```\n\nDone\n \n> 4. Do you want to keep all attributes of `ShardPosetElement` public as they are?\n\nOnce again, this class will probably not be very much used. So I do not see the point to hide things.\n\nMy motivation for this ticket was to have the poset, which is the main interesting thing here.\n\nThanks for your comments, by the way.\n\nFrederic",
    "created_at": "2015-05-11T17:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252260",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

Hello

> What does `connected_parts` is doing in the git branch?

Well, I removed it. Could go in another ticket maybe.
 
> 1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)

Done

> 2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)

Is this really necessary ? This class is just there to help build the poset, there is no way
it will be ever used for something else, I think.

> 3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:
> 
> ```
> if type(self) is not type(other) or len(self) != len(other):
>     raise TypeError("these are not comparable")
> ```

Done
 
> 4. Do you want to keep all attributes of `ShardPosetElement` public as they are?

Once again, this class will probably not be very much used. So I do not see the point to hide things.

My motivation for this ticket was to have the poset, which is the main interesting thing here.

Thanks for your comments, by the way.

Frederic



---

archive/issue_comments_252261.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHi,\n\nReplying to [@fchapoton](#comment%3A19):\n\nI mostly agree with you for 2. and 4. But if you do not care about the elements, then the poset should be abstract on integers: i.e. just store a matrix of relations and send it to `Poset`. You do not want to know which permutation corresponds to which point in this poset?\n\nVincent",
    "created_at": "2015-05-11T17:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252261",
    "user": "https://github.com/videlec"
}
```

<div id="comment:20" align="right">comment:20</div>

Hi,

Replying to [@fchapoton](#comment%3A19):

I mostly agree with you for 2. and 4. But if you do not care about the elements, then the poset should be abstract on integers: i.e. just store a matrix of relations and send it to `Poset`. You do not want to know which permutation corresponds to which point in this poset?

Vincent



---

archive/issue_comments_252262.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWell. I did implement this just to compute the number of maximal chains and the mobius\nnumbers. So only the \"abstract\" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.\n\nI do not think nevertheless that it is necessary to have the elements be permutations.\n\nSo I am happy with the current state of things..",
    "created_at": "2015-05-15T12:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252262",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

Well. I did implement this just to compute the number of maximal chains and the mobius
numbers. So only the "abstract" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.

I do not think nevertheless that it is necessary to have the elements be permutations.

So I am happy with the current state of things..



---

archive/issue_comments_252263.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@fchapoton](#comment%3A21):\n> Well. I did implement this just to compute the number of maximal chains and the mobius\n> numbers. So only the \"abstract\" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.\n> \n> I do not think nevertheless that it is necessary to have the elements be permutations.\n> \n> So I am happy with the current state of things..\n\nI see. Could you mention somewhere (probably in the docstring of `ShardPosetElement` and `ShardPoset`) that the elements are **not** permutation (for computational reasons). But hopefully they are easily recovered:\n\n```\nsage: P = posets.ShardPoset(4)\nsage: mins = P.minimal_elements()[0]\nsage: p = Permutation(mins)\n[2, 3, 4, 1]\nsage: p.decreasing_runs()\n[[2], [3], [4, 1]]\n```\n(or a more relevant example)\n\nVincent",
    "created_at": "2015-05-15T12:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252263",
    "user": "https://github.com/videlec"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@fchapoton](#comment%3A21):
> Well. I did implement this just to compute the number of maximal chains and the mobius
> numbers. So only the "abstract" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.
> 
> I do not think nevertheless that it is necessary to have the elements be permutations.
> 
> So I am happy with the current state of things..

I see. Could you mention somewhere (probably in the docstring of `ShardPosetElement` and `ShardPoset`) that the elements are **not** permutation (for computational reasons). But hopefully they are easily recovered:

```
sage: P = posets.ShardPoset(4)
sage: mins = P.minimal_elements()[0]
sage: p = Permutation(mins)
[2, 3, 4, 1]
sage: p.decreasing_runs()
[[2], [3], [4, 1]]
```
(or a more relevant example)

Vincent



---

archive/issue_comments_252264.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/707450f9e620a3e9536a8a07761b7430eae93360\"><code>707450f</code></a></td><td><code>Merge branch 'u/chapoton/18347' into 6.7.rc0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24\"><code>98f5642</code></a></td><td><code>trac #18347 a little more doc about conversion to permutations</code></td></tr></table>\n",
    "created_at": "2015-05-15T19:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252264",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/707450f9e620a3e9536a8a07761b7430eae93360"><code>707450f</code></a></td><td><code>Merge branch 'u/chapoton/18347' into 6.7.rc0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24"><code>98f5642</code></a></td><td><code>trac #18347 a little more doc about conversion to permutations</code></td></tr></table>




---

archive/issue_comments_252265.json:
```json
{
    "body": "Changed commit from **[`878ed3a`](https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348)** to **[`98f5642`](https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24)**",
    "created_at": "2015-05-15T19:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252265",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`878ed3a`](https://github.com/sagemath/sagetrac-mirror/commit/878ed3a0794d123c46d7cb9ea48ad93ca2d07348)** to **[`98f5642`](https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24)**



---

archive/issue_events_258425.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-15T19:45:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258425"
}
```



---

archive/issue_events_258426.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-15T19:45:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258426"
}
```



---

archive/issue_comments_252266.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nok, back to needs review. I have added some doc about back and forth conversion to permutations.",
    "created_at": "2015-05-15T19:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252266",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

ok, back to needs review. I have added some doc about back and forth conversion to permutations.



---

archive/issue_comments_252267.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nWhy did you put the `INPUT` block one kilometer away in `Permutation.runs`?!",
    "created_at": "2015-05-15T19:53:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252267",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">comment:25</div>

Why did you put the `INPUT` block one kilometer away in `Permutation.runs`?!



---

archive/issue_comments_252268.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f\"><code>854de65</code></a></td><td><code>trac #18247 bad formatting</code></td></tr></table>\n",
    "created_at": "2015-05-15T20:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252268",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f"><code>854de65</code></a></td><td><code>trac #18247 bad formatting</code></td></tr></table>




---

archive/issue_comments_252269.json:
```json
{
    "body": "Changed commit from **[`98f5642`](https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24)** to **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**",
    "created_at": "2015-05-15T20:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252269",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`98f5642`](https://github.com/sagemath/sagetrac-mirror/commit/98f56421ef86a05d7663bcad818c9709f78a4d24)** to **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**



---

archive/issue_comments_252270.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nping ?",
    "created_at": "2015-05-22T20:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252270",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

ping ?



---

archive/issue_events_258427.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-22T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258427"
}
```



---

archive/issue_events_258428.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-22T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258428"
}
```



---

archive/issue_comments_252271.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\npong!",
    "created_at": "2015-05-23T13:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252271",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">comment:28</div>

pong!



---

archive/issue_events_258429.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-23T13:32:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258429"
}
```



---

archive/issue_events_258430.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-23T13:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258430"
}
```



---

archive/issue_comments_252272.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2015-05-23T13:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252272",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_events_258431.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-23T22:59:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258431"
}
```



---

archive/issue_events_258432.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d7c8e2685eb58a21127f0896417dfc5554bc5f45",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-05-23T22:59:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18347#event-258432"
}
```



---

archive/issue_comments_252273.json:
```json
{
    "body": "Changed branch from **[u/chapoton/18347](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18347)** to **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**",
    "created_at": "2015-05-23T22:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252273",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/18347](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/18347)** to **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)**



---

archive/issue_comments_252274.json:
```json
{
    "body": "Changed commit from **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)** to none",
    "created_at": "2016-05-24T02:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252274",
    "user": "https://github.com/novoselt"
}
```

Changed commit from **[`854de65`](https://github.com/sagemath/sagetrac-mirror/commit/854de651af7850b6e6c7387c7b54a7544eec7b4f)** to none



---

archive/issue_comments_252275.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWhy was a new class derived from `tuple` rather then something inheriting from `SageObject`??? It now triggers a warning included in doctest by #20667",
    "created_at": "2016-05-24T02:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252275",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:30" align="right">comment:30</div>

Why was a new class derived from `tuple` rather then something inheriting from `SageObject`??? It now triggers a warning included in doctest by #20667



---

archive/issue_comments_252276.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nInheriting from tuple is forbidden?\n\nMore interesting: what is the warning that was not here before?",
    "created_at": "2016-05-24T03:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252276",
    "user": "https://github.com/videlec"
}
```

<div id="comment:31" align="right">comment:31</div>

Inheriting from tuple is forbidden?

More interesting: what is the warning that was not here before?



---

archive/issue_comments_252277.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nNothing is forbidden, but\nhttp://doc.sagemath.org/html/en/developer/coding_in_python.html?highlight=sageobject\nand the result is\nhttps://github.com/sagemath/sagetrac-mirror/blob/ed746286af38545c69edfc77c3a9f1cfde4665fd/src/sage/combinat/shard_order.py&id2=d5646a4e1a2c6f0575ca90b02085417b676e34dd",
    "created_at": "2016-05-24T03:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252277",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:32" align="right">comment:32</div>

Nothing is forbidden, but
http://doc.sagemath.org/html/en/developer/coding_in_python.html?highlight=sageobject
and the result is
https://github.com/sagemath/sagetrac-mirror/blob/ed746286af38545c69edfc77c3a9f1cfde4665fd/src/sage/combinat/shard_order.py&id2=d5646a4e1a2c6f0575ca90b02085417b676e34dd



---

archive/issue_comments_252278.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe problem is that this error will not be solved by inheriting from `SageObject` since we need to initialize the content of the tuple... The inheritance from `tuple` is here for speed (the methods use `__hash__` and `__eq__`).\n\nDoes the same warning show up with the following?\n\n```\nsage: class A(tuple):\n....:    def __init__(self, a):\n....:        tuple.__init__(a)\nsage: a = A([1,2,3])\n```\nIt works without any warning in IPython console...",
    "created_at": "2016-05-24T03:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18347#issuecomment-252278",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">comment:33</div>

The problem is that this error will not be solved by inheriting from `SageObject` since we need to initialize the content of the tuple... The inheritance from `tuple` is here for speed (the methods use `__hash__` and `__eq__`).

Does the same warning show up with the following?

```
sage: class A(tuple):
....:    def __init__(self, a):
....:        tuple.__init__(a)
sage: a = A([1,2,3])
```
It works without any warning in IPython console...
