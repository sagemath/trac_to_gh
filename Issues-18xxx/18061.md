# Issue 18061: Implement (correct) action of Atkin-Lehner operators on newforms

archive/issues_017824.json:
```json
{
    "assignees": [],
    "body": "Let *f* be a newform of weight *k* for \u0393<sub>1</sub>(*n*), and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is (in the normalisation used by Sage) a complex number *\u03b7* of absolute value *d*^*k*/2 - 1^ such that *W<sub>d</sub>f* = *\u03b7f*<sup>*</sup>, where *f*<sup>*</sup> is a certain twist of *f*.\n\nThe main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that, given a newform `f`, returns a pair `(eta, g)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* on `f` and `g` is the appropriate twist of `f`.\n\nThis also fixes the following bug.  Consider the following newform of weight 2 for \u0393<sub>1</sub>(30) with coefficients in **Q**(*i*):\n\n```\nsage: f = Newforms(Gamma1(30), 2, names='a')[1]; f\nq + a1*q^2 - a1*q^3 - q^4 + (a1 - 2)*q^5 + O(q^6)\nsage: f.base_ring()\nNumber Field in a1 with defining polynomial x^2 + 1\nsage: f.character()\nDirichlet character modulo 30 of conductor 5 mapping 11 |--> 1, 7 |--> -1\n```\nThe method `atkin_lehner_eigenvalue()` returns a nonsensical result:\n\n```\nsage: f.atkin_lehner_eigenvalue()\n-2\n```\nThis is just the upper left entry of the matrix of the Atkin-Lehner operator *W*<sub>30</sub> with respect to some basis of the space of modular symbols attached to *f*:\n\n```\nsage: f.modular_symbols(sign=1).atkin_lehner_operator()\nHecke module morphism Atkin-Lehner operator W_30 defined by the matrix\n[-2 -3]\n[ 1  2]\nDomain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...\nCodomain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...\n```\n\n\nCC:  @kevinywlui @williamstein @jpflori\n\nKeywords: **newform Atkin-Lehner operator**\n\nBranch/Commit: **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**\n\nReviewer: **Peter Bruin, David Loeffler, Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Peter Bruin, David Loeffler**\n\nComponent: **modular forms**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18061_\n\n",
    "closed_at": "2017-09-04T06:11:08Z",
    "created_at": "2015-03-26T18:20:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement (correct) action of Atkin-Lehner operators on newforms",
    "type": "issue",
    "updated_at": "2017-09-04T06:11:08Z",
    "url": "https://github.com/sagemath/sage/issues/18061",
    "user": "https://github.com/pjbruin"
}
```
Let *f* be a newform of weight *k* for Γ<sub>1</sub>(*n*), and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is (in the normalisation used by Sage) a complex number *η* of absolute value *d*^*k*/2 - 1^ such that *W<sub>d</sub>f* = *ηf*<sup>*</sup>, where *f*<sup>*</sup> is a certain twist of *f*.

The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that, given a newform `f`, returns a pair `(eta, g)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* on `f` and `g` is the appropriate twist of `f`.

This also fixes the following bug.  Consider the following newform of weight 2 for Γ<sub>1</sub>(30) with coefficients in **Q**(*i*):

```
sage: f = Newforms(Gamma1(30), 2, names='a')[1]; f
q + a1*q^2 - a1*q^3 - q^4 + (a1 - 2)*q^5 + O(q^6)
sage: f.base_ring()
Number Field in a1 with defining polynomial x^2 + 1
sage: f.character()
Dirichlet character modulo 30 of conductor 5 mapping 11 |--> 1, 7 |--> -1
```
The method `atkin_lehner_eigenvalue()` returns a nonsensical result:

```
sage: f.atkin_lehner_eigenvalue()
-2
```
This is just the upper left entry of the matrix of the Atkin-Lehner operator *W*<sub>30</sub> with respect to some basis of the space of modular symbols attached to *f*:

```
sage: f.modular_symbols(sign=1).atkin_lehner_operator()
Hecke module morphism Atkin-Lehner operator W_30 defined by the matrix
[-2 -3]
[ 1  2]
Domain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...
Codomain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...
```


CC:  @kevinywlui @williamstein @jpflori

Keywords: **newform Atkin-Lehner operator**

Branch/Commit: **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**

Reviewer: **Peter Bruin, David Loeffler, Frédéric Chapoton**

Author: **Peter Bruin, David Loeffler**

Component: **modular forms**

_Issue created by migration from https://trac.sagemath.org/ticket/18061_





---

archive/issue_events_256875.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-26T18:20:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256875"
}
```



---

archive/issue_events_256876.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-26T18:20:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
    "label_color": "0000ff",
    "label_name": "c: modular forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256876"
}
```



---

archive/issue_events_256877.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-26T18:20:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256877"
}
```



---

archive/issue_events_256878.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-03-26T18:20:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256878"
}
```



---

archive/issue_comments_246074.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nA relevant sage-nt discussion: https://groups.google.com/forum/#!topic/sage-nt/SoBQfo0QnwM",
    "created_at": "2015-03-26T18:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246074",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:1" align="right">comment:1</div>

A relevant sage-nt discussion: https://groups.google.com/forum/#!topic/sage-nt/SoBQfo0QnwM



---

archive/issue_comments_246075.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe implementation should probably use the formulae from this paper: A.O.L. Atkin and Wen-Ch'ing Winnie Li, Twists of newforms and pseudo-eigenvalues of *W*-operators, *Inventiones math.* **48** (1978), 221\u2013243.",
    "created_at": "2015-03-27T11:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246075",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:2" align="right">comment:2</div>

The implementation should probably use the formulae from this paper: A.O.L. Atkin and Wen-Ch'ing Winnie Li, Twists of newforms and pseudo-eigenvalues of *W*-operators, *Inventiones math.* **48** (1978), 221–243.



---

archive/issue_comments_246076.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2015-03-27T12:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246076",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_246077.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI am working on implementing this using a more general method `atkin_lehner_action()` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue and `f_star` is the conjugate form.",
    "created_at": "2015-03-27T12:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246077",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:3" align="right">comment:3</div>

I am working on implementing this using a more general method `atkin_lehner_action()` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue and `f_star` is the conjugate form.



---

archive/issue_comments_246078.json:
```json
{
    "body": "Dependencies: **#18068, #18072**",
    "created_at": "2015-03-30T12:29:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246078",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#18068, #18072**



---

archive/issue_comments_246079.json:
```json
{
    "body": "Changed dependencies from **#18068, #18072** to **#18068, #18072, #18086**",
    "created_at": "2015-03-30T13:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246079",
    "user": "https://github.com/pjbruin"
}
```

Changed dependencies from **#18068, #18072** to **#18068, #18072, #18086**



---

archive/issue_events_256879.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-04-30T17:25:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256879"
}
```



---

archive/issue_comments_246080.json:
```json
{
    "body": "Commit: **[`9e84324`](https://github.com/sagemath/sagetrac-mirror/commit/9e8432448aa58142617fb2da80d244eb7e818ea2)**",
    "created_at": "2015-04-30T17:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246080",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`9e84324`](https://github.com/sagemath/sagetrac-mirror/commit/9e8432448aa58142617fb2da80d244eb7e818ea2)**



---

archive/issue_comments_246081.json:
```json
{
    "body": "Branch: **[u/pbruin/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-atkin_lehner_action)**",
    "created_at": "2015-04-30T17:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246081",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-atkin_lehner_action)**



---

archive/issue_comments_246082.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n-Consider the following newform of weight 2 for \u0393<sub>1</sub>(30) with coefficients in **Q**(*i*):\n+Let *f* be a newform of level *n*, and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is a complex number *\u03b7* of absolute value 1 such that *W<sub>d</sub>f* = *\u03b7f*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.\n+\n+The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* acting on a newform `f` and `f_star` is the conjugate form.\n+\n+This also fixes the following bug.  Consider the following newform of weight 2 for \u0393<sub>1</sub>(30) with coefficients in **Q**(*i*):\n \n ```\n sage: f = Newforms(Gamma1(30), 2, names='a')[1]; f\n@@ -24,4 +28,4 @@\n Domain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...\n Codomain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...\n ```\n-The correct result is in fact only a *pseudo*-eigenvalue; it is a complex number *\u03b7* of absolute value 1 such that *W*<sub>30</sub>*f* = *\u03b7f*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.\n+\n``````\n",
    "created_at": "2015-04-30T17:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246082",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
-Consider the following newform of weight 2 for Γ<sub>1</sub>(30) with coefficients in **Q**(*i*):
+Let *f* be a newform of level *n*, and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is a complex number *η* of absolute value 1 such that *W<sub>d</sub>f* = *ηf*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.
+
+The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* acting on a newform `f` and `f_star` is the conjugate form.
+
+This also fixes the following bug.  Consider the following newform of weight 2 for Γ<sub>1</sub>(30) with coefficients in **Q**(*i*):
 
 ```
 sage: f = Newforms(Gamma1(30), 2, names='a')[1]; f
@@ -24,4 +28,4 @@
 Domain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...
 Codomain: Modular Symbols subspace of dimension 2 of Modular Symbols space ...
 ```
-The correct result is in fact only a *pseudo*-eigenvalue; it is a complex number *η* of absolute value 1 such that *W*<sub>30</sub>*f* = *ηf*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.
+
``````




---

archive/issue_events_256880.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-04-30T17:28:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "title_is": "Implement (correct) action of Atkin-Lehner operators on newforms",
    "title_was": "Fix Newform.atkin_lehner_eigenvalue() for coefficient fields other than QQ",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256880"
}
```



---

archive/issue_comments_246083.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNote: the branch merges cleanly with 6.7.beta4 despite the name in the \"Branch\" field being red.",
    "created_at": "2015-05-06T14:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246083",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

Note: the branch merges cleanly with 6.7.beta4 despite the name in the "Branch" field being red.



---

archive/issue_comments_246084.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a38e707bc54952c8ac5f84353c2d3566b206fb69\">a38e707</a></td><td><code>Trac 18436: fix dimension formulae for modular forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa6227f905e5e4160c832a2759c72457f3274fee\">aa6227f</a></td><td><code>Merge branch 'ticket/18436-dimension_formulae' into ticket/18086-Newform_twist</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879\">dd977f2</a></td><td><code>Trac 18086: reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58\">9c0133e</a></td><td><code>Merge branch 'ticket/18086-Newform_twist' into ticket/18061-atkin_lehner_action</code></td></tr></table>\n",
    "created_at": "2015-05-18T10:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246084",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a38e707bc54952c8ac5f84353c2d3566b206fb69">a38e707</a></td><td><code>Trac 18436: fix dimension formulae for modular forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa6227f905e5e4160c832a2759c72457f3274fee">aa6227f</a></td><td><code>Merge branch 'ticket/18436-dimension_formulae' into ticket/18086-Newform_twist</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd977f21a88f86e7ecc7712c1b921a23340f6879">dd977f2</a></td><td><code>Trac 18086: reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58">9c0133e</a></td><td><code>Merge branch 'ticket/18086-Newform_twist' into ticket/18061-atkin_lehner_action</code></td></tr></table>




---

archive/issue_comments_246085.json:
```json
{
    "body": "Changed commit from **[`9e84324`](https://github.com/sagemath/sagetrac-mirror/commit/9e8432448aa58142617fb2da80d244eb7e818ea2)** to **[`9c0133e`](https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58)**",
    "created_at": "2015-05-18T10:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246085",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9e84324`](https://github.com/sagemath/sagetrac-mirror/commit/9e8432448aa58142617fb2da80d244eb7e818ea2)** to **[`9c0133e`](https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58)**



---

archive/issue_comments_246086.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170\">7c5d213</a></td><td><code>Trac 18061: add doctest</code></td></tr></table>\n",
    "created_at": "2015-05-19T17:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246086",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170">7c5d213</a></td><td><code>Trac 18061: add doctest</code></td></tr></table>




---

archive/issue_comments_246087.json:
```json
{
    "body": "Changed commit from **[`9c0133e`](https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58)** to **[`7c5d213`](https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170)**",
    "created_at": "2015-05-19T17:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246087",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c0133e`](https://github.com/sagemath/sagetrac-mirror/commit/9c0133ede19fef7c1497c3dd79e67fe2146c0f58)** to **[`7c5d213`](https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170)**



---

archive/issue_comments_246088.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHi Peter! It's great that someone has got around to implementing this at last. But there are some things needing a little more work:\n\n- I think it's not good that the new implementation returns `NotImplementedError` on some cases where the *old* implementation was correct and valid:\n\n```\n# old implementation\nsage: F = Newforms(169,names='a')[0]\nsage: F[13]\n0\nsage: F.atkin_lehner_eigenvalue(169)\n-1\n```\n Here the A-L operator on the modular symbols space is actually a diagonal matrix, so taking its top left entry is the right thing to do:\n\n```\nsage: F.modular_symbols(sign=0).atkin_lehner_operator(169).matrix()\n[-1  0  0  0]\n[ 0 -1  0  0]\n[ 0  0 -1  0]\n[ 0  0  0 -1]\n```\n With your patch this bombs out at `NotImplementedError: action of W_Q is not implemented if a_Q(f) = 0`. If I'm not mistaken, the old implementation is correct if (and maybe only if) the character is trivial, while your new implementation will refuse to handle any case where the character is trivial and the base field is not QQ. (The old algorithm can be easily patched up to work whenever the Q-part of the character is trivial.)\n\n- The error message returned if Q is not an exact divisor of N is very uninformative:\n\n```\n\nsage: F = Newforms(20, 8, names='a')[1]; F\nq - a1*q^3 + 125*q^5 + O(q^6)\nsage: F.atkin_lehner_action(2)\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-36-b33b9d9d015f> in <module>()\n----> 1 F.atkin_lehner_action(Integer(2))\n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)\n   1224         Q = q**e\n   1225         M = d // Q\n-> 1226         eps_Q = [eps for eps in self.character().decomposition() if eps.modulus() == Q][0]\n   1227         eps = eps_Q(M)\n   1228         if embedding is not None:\n\nIndexError: list index out of range\n```\n I would actually favour handing the special case where Q is a prime separately (interpreting it as W_p<sup>e</sup> where p<sup>e</sup> is the power of p dividing N). The `atkin_lehner_operator` method of modular symbol spaces does something along these lines. But in any case it should react more intelligently than this.\n\n- This error message is misleading:\n\n```\nsage: F.atkin_lehner_action(4)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-77-65866aefe137> in <module>()\n----> 1 F.atkin_lehner_action(Integer(4))\n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)\n   1229             eps = embedding(eps)\n   1230         eta0, g0 = self.atkin_lehner_action(M, embedding)\n-> 1231         eta1, g1 = g0._atkin_lehner_action_prime_power(Q, embedding)\n   1232         return eps * eta0 * eta1, g1\n   1233 \n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in _atkin_lehner_action_prime_power(self, Q, embedding)\n   1135         a_Q = self[Q]\n   1136         if not a_Q:\n-> 1137             raise NotImplementedError(\"action of W_Q is not implemented if a_Q(f) = 0\")\n   1138         epsilon = self.character()\n   1139         eps_Q = [eps for eps in epsilon.decomposition() if eps.modulus() == Q][0]\n\nNotImplementedError: action of W_Q is not implemented if a_Q(f) = 0\n```\n This action **is** implemented in some cases -- when the base ring is QQ (and it should be implemented in more). We don't want to sell our capabilities short here.\n\n- Your implementation will always fail for odd weights:\n\n```\nsage: Newforms(Gamma1(15), 3, names='a')\n[q - q^2 + 3*q^3 - 3*q^4 - 5*q^5 + O(q^6),\n q + q^2 - 3*q^3 - 3*q^4 + 5*q^5 + O(q^6),\n q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6),\n q + a3*q^2 + (3/5*a3^3 + 11/5*a3^2 + 22/5*a3 - 11/5)*q^3 + (-8/5*a3^3 - 31/5*a3^2 - 72/5*a3 + 16/5)*q^4 + (a3^3 + 4*a3^2 + 6*a3 - 6)*q^5 + O(q^6)]\nsage: f = _[2]\nsage: f.atkin_lehner_eigenvalue(5)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-87-4262769bbfb2> in <module>()\n----> 1 f.atkin_lehner_eigenvalue(Integer(5))\n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_eigenvalue(self, d, embedding)\n   1285         if d is None:\n   1286             d = self.level()\n-> 1287         eta, g = self.atkin_lehner_action(d, embedding)\n   1288         if g != self:\n   1289             raise ValueError(\"%r is not an eigenform for W_%r\" % (self, d))\n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)\n   1229             eps = embedding(eps)\n   1230         eta0, g0 = self.atkin_lehner_action(M, embedding)\n-> 1231         eta1, g1 = g0._atkin_lehner_action_prime_power(Q, embedding)\n   1232         return eps * eta0 * eta1, g1\n   1233 \n\n/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in _atkin_lehner_action_prime_power(self, Q, embedding)\n   1149         lambda_Q = g / a_Q\n   1150         Q = lambda_Q.parent()(Q)\n-> 1151         return Q**(self.weight()/2 - 1) * lambda_Q, f_star\n   1152 \n   1153     def atkin_lehner_action(self, d, embedding=None):\n\n/storage/masiao/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:17184)()\n   1905         elif PyInt_CheckExact(left):\n   1906             return (<ModuleElement>right)._mul_long(PyInt_AS_LONG(left))\n-> 1907         return coercion_model.bin_op(left, right, mul)\n   1908 \n   1909     cpdef RingElement _mul_(self, RingElement right):\n\n/storage/masiao/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9131)()\n   1044         # We should really include the underlying error.\n   1045         # This causes so much headache.\n-> 1046         raise TypeError, arith_error_message(x,y,op)\n   1047 \n   1048     cpdef canonical_coercion(self, x, y):\n\nTypeError: unsupported operand parent(s) for '*': 'Symbolic Ring' and 'Number Field in a2 with defining polynomial x^2 + 5'\n```\n Sage doesn't know which square root of 5 to take here, so it returns sqrt(5) in the symbolic ring, which of course causes an error when you try to multiply it by something in the base ring of f. Are you trying to renormalise the Atkin--Lehner operator so as to be an involution in all weights? This can't be done Galois-equivariantly, and is inconsistent with normalisations elsewhere in Sage. (There's a great quote from Deligne re these normalisations: \"Langlands is very sure he knows what the square root of p is. I have never been so sure\".) I personally favour the normalisation where W_Q<sup>2</sup> is Q^(k/2 - 1)^ up to a root of unity, which **is** Galois equivariant.",
    "created_at": "2015-05-21T12:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246088",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:11" align="right">comment:11</div>

Hi Peter! It's great that someone has got around to implementing this at last. But there are some things needing a little more work:

- I think it's not good that the new implementation returns `NotImplementedError` on some cases where the *old* implementation was correct and valid:

```
# old implementation
sage: F = Newforms(169,names='a')[0]
sage: F[13]
0
sage: F.atkin_lehner_eigenvalue(169)
-1
```
 Here the A-L operator on the modular symbols space is actually a diagonal matrix, so taking its top left entry is the right thing to do:

```
sage: F.modular_symbols(sign=0).atkin_lehner_operator(169).matrix()
[-1  0  0  0]
[ 0 -1  0  0]
[ 0  0 -1  0]
[ 0  0  0 -1]
```
 With your patch this bombs out at `NotImplementedError: action of W_Q is not implemented if a_Q(f) = 0`. If I'm not mistaken, the old implementation is correct if (and maybe only if) the character is trivial, while your new implementation will refuse to handle any case where the character is trivial and the base field is not QQ. (The old algorithm can be easily patched up to work whenever the Q-part of the character is trivial.)

- The error message returned if Q is not an exact divisor of N is very uninformative:

```

sage: F = Newforms(20, 8, names='a')[1]; F
q - a1*q^3 + 125*q^5 + O(q^6)
sage: F.atkin_lehner_action(2)
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-36-b33b9d9d015f> in <module>()
----> 1 F.atkin_lehner_action(Integer(2))

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)
   1224         Q = q**e
   1225         M = d // Q
-> 1226         eps_Q = [eps for eps in self.character().decomposition() if eps.modulus() == Q][0]
   1227         eps = eps_Q(M)
   1228         if embedding is not None:

IndexError: list index out of range
```
 I would actually favour handing the special case where Q is a prime separately (interpreting it as W_p<sup>e</sup> where p<sup>e</sup> is the power of p dividing N). The `atkin_lehner_operator` method of modular symbol spaces does something along these lines. But in any case it should react more intelligently than this.

- This error message is misleading:

```
sage: F.atkin_lehner_action(4)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-77-65866aefe137> in <module>()
----> 1 F.atkin_lehner_action(Integer(4))

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)
   1229             eps = embedding(eps)
   1230         eta0, g0 = self.atkin_lehner_action(M, embedding)
-> 1231         eta1, g1 = g0._atkin_lehner_action_prime_power(Q, embedding)
   1232         return eps * eta0 * eta1, g1
   1233 

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in _atkin_lehner_action_prime_power(self, Q, embedding)
   1135         a_Q = self[Q]
   1136         if not a_Q:
-> 1137             raise NotImplementedError("action of W_Q is not implemented if a_Q(f) = 0")
   1138         epsilon = self.character()
   1139         eps_Q = [eps for eps in epsilon.decomposition() if eps.modulus() == Q][0]

NotImplementedError: action of W_Q is not implemented if a_Q(f) = 0
```
 This action **is** implemented in some cases -- when the base ring is QQ (and it should be implemented in more). We don't want to sell our capabilities short here.

- Your implementation will always fail for odd weights:

```
sage: Newforms(Gamma1(15), 3, names='a')
[q - q^2 + 3*q^3 - 3*q^4 - 5*q^5 + O(q^6),
 q + q^2 - 3*q^3 - 3*q^4 + 5*q^5 + O(q^6),
 q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6),
 q + a3*q^2 + (3/5*a3^3 + 11/5*a3^2 + 22/5*a3 - 11/5)*q^3 + (-8/5*a3^3 - 31/5*a3^2 - 72/5*a3 + 16/5)*q^4 + (a3^3 + 4*a3^2 + 6*a3 - 6)*q^5 + O(q^6)]
sage: f = _[2]
sage: f.atkin_lehner_eigenvalue(5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-87-4262769bbfb2> in <module>()
----> 1 f.atkin_lehner_eigenvalue(Integer(5))

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_eigenvalue(self, d, embedding)
   1285         if d is None:
   1286             d = self.level()
-> 1287         eta, g = self.atkin_lehner_action(d, embedding)
   1288         if g != self:
   1289             raise ValueError("%r is not an eigenform for W_%r" % (self, d))

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in atkin_lehner_action(self, d, embedding)
   1229             eps = embedding(eps)
   1230         eta0, g0 = self.atkin_lehner_action(M, embedding)
-> 1231         eta1, g1 = g0._atkin_lehner_action_prime_power(Q, embedding)
   1232         return eps * eta0 * eta1, g1
   1233 

/storage/masiao/sage/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in _atkin_lehner_action_prime_power(self, Q, embedding)
   1149         lambda_Q = g / a_Q
   1150         Q = lambda_Q.parent()(Q)
-> 1151         return Q**(self.weight()/2 - 1) * lambda_Q, f_star
   1152 
   1153     def atkin_lehner_action(self, d, embedding=None):

/storage/masiao/sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:17184)()
   1905         elif PyInt_CheckExact(left):
   1906             return (<ModuleElement>right)._mul_long(PyInt_AS_LONG(left))
-> 1907         return coercion_model.bin_op(left, right, mul)
   1908 
   1909     cpdef RingElement _mul_(self, RingElement right):

/storage/masiao/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9131)()
   1044         # We should really include the underlying error.
   1045         # This causes so much headache.
-> 1046         raise TypeError, arith_error_message(x,y,op)
   1047 
   1048     cpdef canonical_coercion(self, x, y):

TypeError: unsupported operand parent(s) for '*': 'Symbolic Ring' and 'Number Field in a2 with defining polynomial x^2 + 5'
```
 Sage doesn't know which square root of 5 to take here, so it returns sqrt(5) in the symbolic ring, which of course causes an error when you try to multiply it by something in the base ring of f. Are you trying to renormalise the Atkin--Lehner operator so as to be an involution in all weights? This can't be done Galois-equivariantly, and is inconsistent with normalisations elsewhere in Sage. (There's a great quote from Deligne re these normalisations: "Langlands is very sure he knows what the square root of p is. I have never been so sure".) I personally favour the normalisation where W_Q<sup>2</sup> is Q^(k/2 - 1)^ up to a root of unity, which **is** Galois equivariant.



---

archive/issue_events_256881.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-05-21T12:27:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256881"
}
```



---

archive/issue_events_256882.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-05-21T12:27:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256882"
}
```



---

archive/issue_comments_246089.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4d73eca08154d368d2c6d66b90e010dd86b8e35\">c4d73ec</a></td><td><code>Trac 18061: Galois-equivariant normalisation for Atkin-Lehner operators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7759577d9f3346e1e9f8ec23ce137f3bf2ebb98\">b775957</a></td><td><code>Trac 18061: make error message more precise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eab427e02d112a8486d6ae9fc6475666cab91389\">eab427e</a></td><td><code>Trac 18061: first try to use Atkin-Lehner matrix on modular symbols</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589\">48e5d2d</a></td><td><code>Trac 18061: improve handling of d in atkin_lehner_action()</code></td></tr></table>\n",
    "created_at": "2015-05-22T08:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246089",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4d73eca08154d368d2c6d66b90e010dd86b8e35">c4d73ec</a></td><td><code>Trac 18061: Galois-equivariant normalisation for Atkin-Lehner operators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7759577d9f3346e1e9f8ec23ce137f3bf2ebb98">b775957</a></td><td><code>Trac 18061: make error message more precise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eab427e02d112a8486d6ae9fc6475666cab91389">eab427e</a></td><td><code>Trac 18061: first try to use Atkin-Lehner matrix on modular symbols</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589">48e5d2d</a></td><td><code>Trac 18061: improve handling of d in atkin_lehner_action()</code></td></tr></table>




---

archive/issue_comments_246090.json:
```json
{
    "body": "Changed commit from **[`7c5d213`](https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170)** to **[`48e5d2d`](https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589)**",
    "created_at": "2015-05-22T08:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246090",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7c5d213`](https://github.com/sagemath/sagetrac-mirror/commit/7c5d21343137b57b0ce5d4686317092402960170)** to **[`48e5d2d`](https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589)**



---

archive/issue_comments_246091.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHi David,\n\nThanks a lot for taking a look at this!\n\n> - I think it's not good that the new implementation returns `NotImplementedError` on some cases where the *old* implementation was correct and valid:\n\nFixed by first checking if the Atkin-Lehner matrix is a scalar.\n\n> - The error message returned if Q is not an exact divisor of N is very uninformative:\n> [...]\n>  I would actually favour handing the special case where Q is a prime separately (interpreting it as W_p<sup>e</sup> where p<sup>e</sup> is the power of p dividing N). The `atkin_lehner_operator` method of modular symbol spaces does something along these lines.\n\nThe argument `d` is now handled in the same way as in the `atkin_lehner_operator` method of modular symbol spaces.\n> - This error message is misleading:\n> \n> ```\n> ...\n> NotImplementedError: action of W_Q is not implemented if a_Q(f) = 0\n> ```\n>  This action **is** implemented in some cases -- when the base ring is QQ (and it should be implemented in more). We don't want to sell our capabilities short here.\n\nI changed `if a_Q(f) = 0` to `for general newforms with a_Q(f) = 0`.\n\n> - Your implementation will always fail for odd weights:\n> [...]\n>  Are you trying to renormalise the Atkin--Lehner operator so as to be an involution in all weights? This can't be done Galois-equivariantly, and is inconsistent with normalisations elsewhere in Sage. (There's a great quote from Deligne re these normalisations: \"Langlands is very sure he knows what the square root of p is. I have never been so sure\".) I personally favour the normalisation where W_Q<sup>2</sup> is Q^(k/2 - 1)^ up to a root of unity, which **is** Galois equivariant.\n\nI was somehow convinced that the normalisation I used was consistent with the rest of sage, but apparently it isn't.  I changed it as you suggested (I think; did you mean W_Q<sup>2</sup> = Q^(k - 2)^ up to a root of unity?).",
    "created_at": "2015-05-22T09:01:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246091",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Hi David,

Thanks a lot for taking a look at this!

> - I think it's not good that the new implementation returns `NotImplementedError` on some cases where the *old* implementation was correct and valid:

Fixed by first checking if the Atkin-Lehner matrix is a scalar.

> - The error message returned if Q is not an exact divisor of N is very uninformative:
> [...]
>  I would actually favour handing the special case where Q is a prime separately (interpreting it as W_p<sup>e</sup> where p<sup>e</sup> is the power of p dividing N). The `atkin_lehner_operator` method of modular symbol spaces does something along these lines.

The argument `d` is now handled in the same way as in the `atkin_lehner_operator` method of modular symbol spaces.
> - This error message is misleading:
> 
> ```
> ...
> NotImplementedError: action of W_Q is not implemented if a_Q(f) = 0
> ```
>  This action **is** implemented in some cases -- when the base ring is QQ (and it should be implemented in more). We don't want to sell our capabilities short here.

I changed `if a_Q(f) = 0` to `for general newforms with a_Q(f) = 0`.

> - Your implementation will always fail for odd weights:
> [...]
>  Are you trying to renormalise the Atkin--Lehner operator so as to be an involution in all weights? This can't be done Galois-equivariantly, and is inconsistent with normalisations elsewhere in Sage. (There's a great quote from Deligne re these normalisations: "Langlands is very sure he knows what the square root of p is. I have never been so sure".) I personally favour the normalisation where W_Q<sup>2</sup> is Q^(k/2 - 1)^ up to a root of unity, which **is** Galois equivariant.

I was somehow convinced that the normalisation I used was consistent with the rest of sage, but apparently it isn't.  I changed it as you suggested (I think; did you mean W_Q<sup>2</sup> = Q^(k - 2)^ up to a root of unity?).



---

archive/issue_comments_246092.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe following still fails:\n\n```\nsage: f = Newforms(Gamma1(15), 3, names='a')[2]\nsage: f.atkin_lehner_eigenvalue(5)\nTraceback (most recent call last):\n...\nValueError: q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6) is not an eigenform for W_5\n```\nThis is wrong because `f` *is* an eigenform for `W_5`:\n\n```\nsage: f\nq + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6)\nsage: _, g = f.atkin_lehner_action(5); g\nq + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6)\n```\nThe reason is probably that the parents of `f` and `g` are different:\n\n```\nsage: parent(f)\nCuspidal subspace of dimension 8 of Modular Forms space of dimension 24 for Congruence Subgroup Gamma1(15) of weight 3 over Number Field in a2 with defining polynomial x^2 + 5\nsage: parent(g)\nCuspidal subspace of dimension 2 of Modular Forms space of dimension 6, character [-1, 1] and weight 3 over Number Field in a2 with defining polynomial x^2 + 5\n```",
    "created_at": "2015-05-22T09:05:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246092",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:15" align="right">comment:15</div>

The following still fails:

```
sage: f = Newforms(Gamma1(15), 3, names='a')[2]
sage: f.atkin_lehner_eigenvalue(5)
Traceback (most recent call last):
...
ValueError: q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6) is not an eigenform for W_5
```
This is wrong because `f` *is* an eigenform for `W_5`:

```
sage: f
q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6)
sage: _, g = f.atkin_lehner_action(5); g
q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6)
```
The reason is probably that the parents of `f` and `g` are different:

```
sage: parent(f)
Cuspidal subspace of dimension 8 of Modular Forms space of dimension 24 for Congruence Subgroup Gamma1(15) of weight 3 over Number Field in a2 with defining polynomial x^2 + 5
sage: parent(g)
Cuspidal subspace of dimension 2 of Modular Forms space of dimension 6, character [-1, 1] and weight 3 over Number Field in a2 with defining polynomial x^2 + 5
```



---

archive/issue_comments_246093.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHere's another gripe. The following is waaay too slow:\n\n```\nsage: F = Newforms(299,names='a')[0]\nsage: time F.atkin_lehner_eigenvalue(299)\nCPU times: user 4.99 s, sys: 18.9 ms, total: 5.01 s\nWall time: 5 s\n1\n```\nWhat on earth can be taking the time here? According to the profiler, the total time is 5.028 seconds, of which 5.026 is spent in four calls to the \"twist\" routine. Ultimately, most of that is actually spent creating Dirichlet character groups over number fields, which requires factoring some fairly large polynomials over those number fields. Why on earth is this necessary, or even relevant? Evaluating an Atkin--Lehner eigenvalue can't possibly require factorising 82 polynomials over number fields!",
    "created_at": "2015-05-22T09:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246093",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:16" align="right">comment:16</div>

Here's another gripe. The following is waaay too slow:

```
sage: F = Newforms(299,names='a')[0]
sage: time F.atkin_lehner_eigenvalue(299)
CPU times: user 4.99 s, sys: 18.9 ms, total: 5.01 s
Wall time: 5 s
1
```
What on earth can be taking the time here? According to the profiler, the total time is 5.028 seconds, of which 5.026 is spent in four calls to the "twist" routine. Ultimately, most of that is actually spent creating Dirichlet character groups over number fields, which requires factoring some fairly large polynomials over those number fields. Why on earth is this necessary, or even relevant? Evaluating an Atkin--Lehner eigenvalue can't possibly require factorising 82 polynomials over number fields!



---

archive/issue_comments_246094.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe bug in [comment:15](#comment:15) is fixed by #18478.",
    "created_at": "2015-05-23T06:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246094",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

The bug in [comment:15](#comment:15) is fixed by #18478.



---

archive/issue_comments_246095.json:
```json
{
    "body": "Changed dependencies from **#18068, #18072, #18086** to **#18068, #18072, #18086, #18478**",
    "created_at": "2015-05-23T06:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246095",
    "user": "https://github.com/pjbruin"
}
```

Changed dependencies from **#18068, #18072, #18086** to **#18068, #18072, #18086, #18478**



---

archive/issue_comments_246096.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee\">a98bee2</a></td><td><code>Trac 18061: add doctest</code></td></tr></table>\n",
    "created_at": "2015-05-23T07:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246096",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee">a98bee2</a></td><td><code>Trac 18061: add doctest</code></td></tr></table>




---

archive/issue_comments_246097.json:
```json
{
    "body": "Changed commit from **[`48e5d2d`](https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589)** to **[`a98bee2`](https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee)**",
    "created_at": "2015-05-23T07:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246097",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`48e5d2d`](https://github.com/sagemath/sagetrac-mirror/commit/48e5d2d924072cdbbaf4051c549e268e8e39e589)** to **[`a98bee2`](https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee)**



---

archive/issue_comments_246098.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@loefflerd](#comment:16):\n> Here's another gripe. The following is waaay too slow:\n> \n> ```\n> sage: F = Newforms(299,names='a')[0]\n> sage: time F.atkin_lehner_eigenvalue(299)\n> CPU times: user 4.99 s, sys: 18.9 ms, total: 5.01 s\n> Wall time: 5 s\n> 1\n> ```\n> What on earth can be taking the time here? According to the profiler, the total time is 5.028 seconds, of which 5.026 is spent in four calls to the \"twist\" routine.\n\nYou are right, `twist()` can and should be made much faster.  I propose to do this either on #18086 or on a follow-up ticket; I think this one can go back to needs_review.",
    "created_at": "2015-05-23T07:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246098",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@loefflerd](#comment:16):
> Here's another gripe. The following is waaay too slow:
> 
> ```
> sage: F = Newforms(299,names='a')[0]
> sage: time F.atkin_lehner_eigenvalue(299)
> CPU times: user 4.99 s, sys: 18.9 ms, total: 5.01 s
> Wall time: 5 s
> 1
> ```
> What on earth can be taking the time here? According to the profiler, the total time is 5.028 seconds, of which 5.026 is spent in four calls to the "twist" routine.

You are right, `twist()` can and should be made much faster.  I propose to do this either on #18086 or on a follow-up ticket; I think this one can go back to needs_review.



---

archive/issue_events_256883.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:11:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256883"
}
```



---

archive/issue_events_256884.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:11:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256884"
}
```



---

archive/issue_events_256885.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:11:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256885"
}
```



---

archive/issue_events_256886.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-05-23T07:11:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256886"
}
```



---

archive/issue_comments_246099.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI think there are still some cases where the modular symbol algorithm actually works, but this implementation doesn't realise it. Here are two ways this can come up:\n\n- It can happen that the action of W_Q on f is multiplication by a scalar in the Hecke eigenvalue field of f, but not one which is in the base ring of f. Then the matrix of W_Q on the modular symbol space is not obviously recognisable as a scalar, but is contained in the subalgebra of the endomorphisms of the mod sym space generated by the Hecke operators (which is isomorphic to the Hecke eigenvalue field), and one should really recognise it as such and return the appropriate number field element. This comes up for my level 15 weight 3 example, where the W_5 eigenvalue is a square root of -5, but not just any square root -- rather, a specific one lying in the Hecke eigenvalue field of f:\n\n```\nsage: Newforms(Gamma1(15), 3, names='a')\n[q - q^2 + 3*q^3 - 3*q^4 - 5*q^5 + O(q^6),\n q + q^2 - 3*q^3 - 3*q^4 + 5*q^5 + O(q^6),\n q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6),\n q + a3*q^2 + (3/5*a3^3 + 11/5*a3^2 + 22/5*a3 - 11/5)*q^3 + (-8/5*a3^3 - 31/5*a3^2 - 72/5*a3 + 16/5)*q^4 + (a3^3 + 4*a3^2 + 6*a3 - 6)*q^5 + O(q^6)]\nsage: F = _[2]\nsage: M = F.modular_symbols(sign=0)\nsage: M.atkin_lehner_operator(5).matrix()\n[  -1/5 -39/10 -33/10    3/2]\n[   9/5 -19/10 -63/10  -13/2]\n[  -3/5    9/5   28/5      6]\n[     0   -3/2   -9/2   -7/2]\nsage: M.hecke_operator(5).matrix()\n[  1/5 39/10 33/10  -3/2]\n[ -9/5 19/10 63/10  13/2]\n[  3/5  -9/5 -28/5    -6]\n[    0   3/2   9/2   7/2]\n```\n\n- It can also happen that calculating the action of W_Q on the modular symbols space fails if you use \"sign = 1\" (as in your implementation). This is because the Atkin--Lehner operator and the star involution don't commute, although they do when restricted to an eigenspace on which the diamond operators at Q are trivial (if I remember rightly, the commutator of the two operators is exactly eps_Q(-1)). So one can get spurious linear algebra errors working on the sign 1 symbols, because the action of W_Q on the whole space is not defined, even though it is defined on the subspace we care about. This also comes up in the above example:\n\n```\nsage: F.modular_symbols(sign=1).atkin_lehner_operator(5) \n...\nArithmeticError: subspace is not invariant under matrix\n```\nI have a proof-of-concept implementation lying around on my hard drive which avoids these pitfalls, and I can merge it with your implementation to cover these extra cases; but this is definitely an enhancement of your work rather than a bug, and I won't have time to work on it for a week or so since I am away at a conference. So I will leave the ticket at needs_review for now, in case anybody else wants to look at it.",
    "created_at": "2015-05-27T18:51:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246099",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:20" align="right">comment:20</div>

I think there are still some cases where the modular symbol algorithm actually works, but this implementation doesn't realise it. Here are two ways this can come up:

- It can happen that the action of W_Q on f is multiplication by a scalar in the Hecke eigenvalue field of f, but not one which is in the base ring of f. Then the matrix of W_Q on the modular symbol space is not obviously recognisable as a scalar, but is contained in the subalgebra of the endomorphisms of the mod sym space generated by the Hecke operators (which is isomorphic to the Hecke eigenvalue field), and one should really recognise it as such and return the appropriate number field element. This comes up for my level 15 weight 3 example, where the W_5 eigenvalue is a square root of -5, but not just any square root -- rather, a specific one lying in the Hecke eigenvalue field of f:

```
sage: Newforms(Gamma1(15), 3, names='a')
[q - q^2 + 3*q^3 - 3*q^4 - 5*q^5 + O(q^6),
 q + q^2 - 3*q^3 - 3*q^4 + 5*q^5 + O(q^6),
 q + a2*q^2 + (-a2 - 2)*q^3 - q^4 - a2*q^5 + O(q^6),
 q + a3*q^2 + (3/5*a3^3 + 11/5*a3^2 + 22/5*a3 - 11/5)*q^3 + (-8/5*a3^3 - 31/5*a3^2 - 72/5*a3 + 16/5)*q^4 + (a3^3 + 4*a3^2 + 6*a3 - 6)*q^5 + O(q^6)]
sage: F = _[2]
sage: M = F.modular_symbols(sign=0)
sage: M.atkin_lehner_operator(5).matrix()
[  -1/5 -39/10 -33/10    3/2]
[   9/5 -19/10 -63/10  -13/2]
[  -3/5    9/5   28/5      6]
[     0   -3/2   -9/2   -7/2]
sage: M.hecke_operator(5).matrix()
[  1/5 39/10 33/10  -3/2]
[ -9/5 19/10 63/10  13/2]
[  3/5  -9/5 -28/5    -6]
[    0   3/2   9/2   7/2]
```

- It can also happen that calculating the action of W_Q on the modular symbols space fails if you use "sign = 1" (as in your implementation). This is because the Atkin--Lehner operator and the star involution don't commute, although they do when restricted to an eigenspace on which the diamond operators at Q are trivial (if I remember rightly, the commutator of the two operators is exactly eps_Q(-1)). So one can get spurious linear algebra errors working on the sign 1 symbols, because the action of W_Q on the whole space is not defined, even though it is defined on the subspace we care about. This also comes up in the above example:

```
sage: F.modular_symbols(sign=1).atkin_lehner_operator(5) 
...
ArithmeticError: subspace is not invariant under matrix
```
I have a proof-of-concept implementation lying around on my hard drive which avoids these pitfalls, and I can merge it with your implementation to cover these extra cases; but this is definitely an enhancement of your work rather than a bug, and I won't have time to work on it for a week or so since I am away at a conference. So I will leave the ticket at needs_review for now, in case anybody else wants to look at it.



---

archive/issue_comments_246100.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI had another look at your implementation. When using the modular-symbols algorithm, why do you take the conjugate of the (0,0) matrix entry? This is going to be quite slow to compute (because Sage has to verify from first principles that the coefficient fields are CM); and, more importantly, isn't it clearly the wrong answer?\n\n(Maybe Sage's conventions for Atkin--Lehner operators aren't the same as Atkin and Li, and the conjugation is the difference between conventions; but I think it would be very bad and confusing if Sage's conventions weren't internally consistent!)",
    "created_at": "2015-06-03T10:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246100",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:21" align="right">comment:21</div>

I had another look at your implementation. When using the modular-symbols algorithm, why do you take the conjugate of the (0,0) matrix entry? This is going to be quite slow to compute (because Sage has to verify from first principles that the coefficient fields are CM); and, more importantly, isn't it clearly the wrong answer?

(Maybe Sage's conventions for Atkin--Lehner operators aren't the same as Atkin and Li, and the conjugation is the difference between conventions; but I think it would be very bad and confusing if Sage's conventions weren't internally consistent!)



---

archive/issue_comments_246101.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI checked this against a newform of level 21 and character of conductor 7, and it does indeed appear to be the case that the Atkin--Lehner operator as currently implemented in Sage differs from Atkin and Li's conventions (even in weight 2, where the issue of powers of Q does not arise).\n\nSage's definition of the Atkin--Lehner operator seems to be that W<sub>Q</sub><sup>2</sup> = e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q), while Atkin and Li require that W<sub>Q</sub><sup>2</sup> = e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q)<sup>-1</sup>.\n\nSo there's a choice to be made here: we must have either an inconsistency between different parts of Sage, an inconsistency between Sage and Atkin--Li, or a non-backward-compatible change of conventions.\n\nI would actually favour the second option: there are plenty of other papers in the literature which use the convention W<sub>Q</sub><sup>2</sup> = Q<sup>k-2</sup>e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q). The great advantage of this convention is that if you use it, then the pseudo-eigenvalues l<sub>Q</sub> satisfy l<sub>QQ'</sub> = l<sub>Q</sub> l<sub>Q'</sub>, which is not the case with Atkin and Li's conventions.",
    "created_at": "2015-06-03T11:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246101",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:22" align="right">comment:22</div>

I checked this against a newform of level 21 and character of conductor 7, and it does indeed appear to be the case that the Atkin--Lehner operator as currently implemented in Sage differs from Atkin and Li's conventions (even in weight 2, where the issue of powers of Q does not arise).

Sage's definition of the Atkin--Lehner operator seems to be that W<sub>Q</sub><sup>2</sup> = e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q), while Atkin and Li require that W<sub>Q</sub><sup>2</sup> = e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q)<sup>-1</sup>.

So there's a choice to be made here: we must have either an inconsistency between different parts of Sage, an inconsistency between Sage and Atkin--Li, or a non-backward-compatible change of conventions.

I would actually favour the second option: there are plenty of other papers in the literature which use the convention W<sub>Q</sub><sup>2</sup> = Q<sup>k-2</sup>e<sub>Q</sub>(-1) e<sub>N/Q</sub>(Q). The great advantage of this convention is that if you use it, then the pseudo-eigenvalues l<sub>Q</sub> satisfy l<sub>QQ'</sub> = l<sub>Q</sub> l<sub>Q'</sub>, which is not the case with Atkin and Li's conventions.



---

archive/issue_comments_246102.json:
```json
{
    "body": "Changed branch from **[u/pbruin/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-atkin_lehner_action)** to **[u/davidloeffler/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18061-atkin_lehner_action)**",
    "created_at": "2015-06-03T16:53:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246102",
    "user": "https://github.com/loefflerd"
}
```

Changed branch from **[u/pbruin/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-atkin_lehner_action)** to **[u/davidloeffler/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18061-atkin_lehner_action)**



---

archive/issue_comments_246103.json:
```json
{
    "body": "Changed commit from **[`a98bee2`](https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee)** to **[`648b0cc`](https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f)**",
    "created_at": "2015-06-03T16:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246103",
    "user": "https://github.com/loefflerd"
}
```

Changed commit from **[`a98bee2`](https://github.com/sagemath/sagetrac-mirror/commit/a98bee2a3337431582e1762a0bf30f7577742bee)** to **[`648b0cc`](https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f)**



---

archive/issue_comments_246104.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOK, here's my best attempt to merge your implementation and mine to cover the absolute maximum range of cases (sticking with the Atkin--Li conventions for now). \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c95288c5b62f7ed5620444fc784ca070091725d5\">c95288c</a></td><td><code>Trac 18061: use mod-symb algorithm in more cases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb5a958bdcdb2d7d62e09f9a63ca96d56f95075c\">eb5a958</a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d0544c4eebf8f9d4cfbac22a64bdff8b3546161\">0d0544c</a></td><td><code>Trac 18086: reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb\">751bf48</a></td><td><code>Trac 18086: fixed a small Dirichlet character bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abbeed56252780f1372966173fcd2d033f1f033f\">abbeed5</a></td><td><code>Merge branch 't/18086/18086-merged' into t/18061/18061-atkin_lehner_action</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b6cea1b82b92af1be73ea29686b8200a0caf4d0\">8b6cea1</a></td><td><code>Trac 18478: fix comparison of equal newforms in different parents</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f\">648b0cc</a></td><td><code>Merge branch 't/18478/18478-Newform_comparison' into t/18061/18061-atkin_lehner_action (prerequisite ticket)</code></td></tr></table>\n",
    "created_at": "2015-06-03T16:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246104",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:24" align="right">comment:24</div>

OK, here's my best attempt to merge your implementation and mine to cover the absolute maximum range of cases (sticking with the Atkin--Li conventions for now). 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c95288c5b62f7ed5620444fc784ca070091725d5">c95288c</a></td><td><code>Trac 18061: use mod-symb algorithm in more cases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb5a958bdcdb2d7d62e09f9a63ca96d56f95075c">eb5a958</a></td><td><code>Trac 18086: implement twisting of newforms by Dirichlet characters</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d0544c4eebf8f9d4cfbac22a64bdff8b3546161">0d0544c</a></td><td><code>Trac 18086: reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/751bf48f8c2f65fd4a7478e0b22fbe76c6edf3bb">751bf48</a></td><td><code>Trac 18086: fixed a small Dirichlet character bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abbeed56252780f1372966173fcd2d033f1f033f">abbeed5</a></td><td><code>Merge branch 't/18086/18086-merged' into t/18061/18061-atkin_lehner_action</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b6cea1b82b92af1be73ea29686b8200a0caf4d0">8b6cea1</a></td><td><code>Trac 18478: fix comparison of equal newforms in different parents</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f">648b0cc</a></td><td><code>Merge branch 't/18478/18478-Newform_comparison' into t/18061/18061-atkin_lehner_action (prerequisite ticket)</code></td></tr></table>




---

archive/issue_comments_246105.json:
```json
{
    "body": "Changed commit from **[`648b0cc`](https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f)** to **[`c650fd8`](https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a)**",
    "created_at": "2015-06-03T16:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246105",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`648b0cc`](https://github.com/sagemath/sagetrac-mirror/commit/648b0ccf5bc27a4eb52b13279437e2e0bf61af6f)** to **[`c650fd8`](https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a)**



---

archive/issue_comments_246106.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a\">c650fd8</a></td><td><code>Doctests and small fix to L-function computation</code></td></tr></table>\n",
    "created_at": "2015-06-03T16:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246106",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a">c650fd8</a></td><td><code>Doctests and small fix to L-function computation</code></td></tr></table>




---

archive/issue_comments_246107.json:
```json
{
    "body": "Changed author from **Peter Bruin** to **Peter Bruin, David Loeffler**",
    "created_at": "2015-06-03T19:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246107",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Peter Bruin** to **Peter Bruin, David Loeffler**



---

archive/issue_comments_246108.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI uploaded a rebased branch (by cherry-picking the relevant commits) on top of #18086.  The reasons are (1) there were some duplicate commits (from the two versions of #18086) and merges of dependencies that are no longer needed since they are in the latest beta, and (2) merging the new branch from #18086 accidentally caused two copies of the method `Newform.twist()` to be present.  Hopefully we now have a clean branch to work on.",
    "created_at": "2015-06-03T19:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246108",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:26" align="right">comment:26</div>

I uploaded a rebased branch (by cherry-picking the relevant commits) on top of #18086.  The reasons are (1) there were some duplicate commits (from the two versions of #18086) and merges of dependencies that are no longer needed since they are in the latest beta, and (2) merging the new branch from #18086 accidentally caused two copies of the method `Newform.twist()` to be present.  Hopefully we now have a clean branch to work on.



---

archive/issue_comments_246109.json:
```json
{
    "body": "Changed branch from **[u/davidloeffler/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18061-atkin_lehner_action)** to **[u/pbruin/18061-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-rebased)**",
    "created_at": "2015-06-03T19:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246109",
    "user": "https://github.com/pjbruin"
}
```

Changed branch from **[u/davidloeffler/18061-atkin_lehner_action](https://github.com/sagemath/sagetrac-mirror/tree/u/davidloeffler/18061-atkin_lehner_action)** to **[u/pbruin/18061-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-rebased)**



---

archive/issue_comments_246110.json:
```json
{
    "body": "Changed commit from **[`c650fd8`](https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a)** to **[`90f0b3b`](https://github.com/sagemath/sagetrac-mirror/commit/90f0b3b0e0050d686169f7dc53da62e667fd8f6e)**",
    "created_at": "2015-06-03T19:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246110",
    "user": "https://github.com/pjbruin"
}
```

Changed commit from **[`c650fd8`](https://github.com/sagemath/sagetrac-mirror/commit/c650fd8a14d1b9c3daddfa17ef6aaf4ca3bfb50a)** to **[`90f0b3b`](https://github.com/sagemath/sagetrac-mirror/commit/90f0b3b0e0050d686169f7dc53da62e667fd8f6e)**



---

archive/issue_comments_246111.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@loefflerd](#comment:21):\n> I had another look at your implementation. When using the modular-symbols algorithm, why do you take the conjugate of the (0,0) matrix entry? This is going to be quite slow to compute (because Sage has to verify from first principles that the coefficient fields are CM); and, more importantly, isn't it clearly the wrong answer?\n\nTo be honest I ran into this through a doctest failure, and figured that in all probability either the (0,0) entry or its conjugate would be the correct value, with the conjugate being explained by some sesquilinear pairing intervening somewhere...\n> (Maybe Sage's conventions for Atkin--Lehner operators aren't the same as Atkin and Li, and the conjugation is the difference between conventions; but I think it would be very bad and confusing if Sage's conventions weren't internally consistent!)\n\nI didn't realise that the various conventions for the Atkin-Lehner operator differ in other ways than by a power of *Q*.  We should carefully document what convention we use and how it differs from others!",
    "created_at": "2015-06-03T19:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246111",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@loefflerd](#comment:21):
> I had another look at your implementation. When using the modular-symbols algorithm, why do you take the conjugate of the (0,0) matrix entry? This is going to be quite slow to compute (because Sage has to verify from first principles that the coefficient fields are CM); and, more importantly, isn't it clearly the wrong answer?

To be honest I ran into this through a doctest failure, and figured that in all probability either the (0,0) entry or its conjugate would be the correct value, with the conjugate being explained by some sesquilinear pairing intervening somewhere...
> (Maybe Sage's conventions for Atkin--Lehner operators aren't the same as Atkin and Li, and the conjugation is the difference between conventions; but I think it would be very bad and confusing if Sage's conventions weren't internally consistent!)

I didn't realise that the various conventions for the Atkin-Lehner operator differ in other ways than by a power of *Q*.  We should carefully document what convention we use and how it differs from others!



---

archive/issue_comments_246112.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7\">93e2f86</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>\n",
    "created_at": "2015-06-04T23:26:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246112",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7">93e2f86</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>




---

archive/issue_comments_246113.json:
```json
{
    "body": "Changed commit from **[`90f0b3b`](https://github.com/sagemath/sagetrac-mirror/commit/90f0b3b0e0050d686169f7dc53da62e667fd8f6e)** to **[`93e2f86`](https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7)**",
    "created_at": "2015-06-04T23:26:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246113",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`90f0b3b`](https://github.com/sagemath/sagetrac-mirror/commit/90f0b3b0e0050d686169f7dc53da62e667fd8f6e)** to **[`93e2f86`](https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7)**



---

archive/issue_comments_246114.json:
```json
{
    "body": "Changed commit from **[`93e2f86`](https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7)** to **[`d513f93`](https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f)**",
    "created_at": "2015-08-19T13:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246114",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`93e2f86`](https://github.com/sagemath/sagetrac-mirror/commit/93e2f86b86ec763447d062f38a6ce340ace302a7)** to **[`d513f93`](https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f)**



---

archive/issue_comments_246115.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1dddad0135598d76366247deb7f38f1882c6caf7\">1dddad0</a></td><td><code>Trac 18061: revert changes to dirichlet.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/601287de641e32bb5af62708a99023df22de5c2f\">601287d</a></td><td><code>Trac 18061: improve computation of root number</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f\">d513f93</a></td><td><code>Trac 18061: remove trailing whitespace</code></td></tr></table>\n",
    "created_at": "2015-08-19T13:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246115",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1dddad0135598d76366247deb7f38f1882c6caf7">1dddad0</a></td><td><code>Trac 18061: revert changes to dirichlet.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/601287de641e32bb5af62708a99023df22de5c2f">601287d</a></td><td><code>Trac 18061: improve computation of root number</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f">d513f93</a></td><td><code>Trac 18061: remove trailing whitespace</code></td></tr></table>




---

archive/issue_comments_246116.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nNew commits:\n- changes to `gauss_sum()` and `gauss_sum_numerical()` over `QQbar` should be done on the new ticket #19056 (it does not seem to be essential for this ticket, `gauss_sum()` and `gauss_sum_numerical()` should behave differently, and we should add doctests)\n- use correct precision in computation of root number in `lseries()`\n- clean up whitespace",
    "created_at": "2015-08-19T13:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246116",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:30"></div>

New commits:
- changes to `gauss_sum()` and `gauss_sum_numerical()` over `QQbar` should be done on the new ticket #19056 (it does not seem to be essential for this ticket, `gauss_sum()` and `gauss_sum_numerical()` should behave differently, and we should add doctests)
- use correct precision in computation of root number in `lseries()`
- clean up whitespace



---

archive/issue_comments_246117.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2\">c173a2e</a></td><td><code>Trac 18061: move @cached_method to where the actual computation is done</code></td></tr></table>\n",
    "created_at": "2015-08-19T13:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246117",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2">c173a2e</a></td><td><code>Trac 18061: move @cached_method to where the actual computation is done</code></td></tr></table>




---

archive/issue_comments_246118.json:
```json
{
    "body": "Changed commit from **[`d513f93`](https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f)** to **[`c173a2e`](https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2)**",
    "created_at": "2015-08-19T13:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246118",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d513f93`](https://github.com/sagemath/sagetrac-mirror/commit/d513f931d4ae9aa3f23efb893e084195204ff55f)** to **[`c173a2e`](https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2)**



---

archive/issue_comments_246119.json:
```json
{
    "body": "Changed commit from **[`c173a2e`](https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2)** to **[`1c20775`](https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e)**",
    "created_at": "2015-08-19T14:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246119",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c173a2e`](https://github.com/sagemath/sagetrac-mirror/commit/c173a2ee022f18e6171d2addd756728f0280afb2)** to **[`1c20775`](https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e)**



---

archive/issue_comments_246120.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f1b77daa20467410c3bd5450c53c9d6dbfcbe85\">6f1b77d</a></td><td><code>Trac 18061: small documentation fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e\">1c20775</a></td><td><code>Trac 18061: make modsym_eigenspace() slightly more readable</code></td></tr></table>\n",
    "created_at": "2015-08-19T14:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246120",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f1b77daa20467410c3bd5450c53c9d6dbfcbe85">6f1b77d</a></td><td><code>Trac 18061: small documentation fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e">1c20775</a></td><td><code>Trac 18061: make modsym_eigenspace() slightly more readable</code></td></tr></table>




---

archive/issue_comments_246121.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53d026ffd12c40d4f991b470f45387c382e60925\">53d026f</a></td><td><code>Trac 18061: use Sage convention instead of Atkin-Li convention</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2\">88bda87</a></td><td><code>Trac 18061: replace ArithmeticError by assertion</code></td></tr></table>\n",
    "created_at": "2015-08-20T12:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246121",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53d026ffd12c40d4f991b470f45387c382e60925">53d026f</a></td><td><code>Trac 18061: use Sage convention instead of Atkin-Li convention</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2">88bda87</a></td><td><code>Trac 18061: replace ArithmeticError by assertion</code></td></tr></table>




---

archive/issue_comments_246122.json:
```json
{
    "body": "Changed commit from **[`1c20775`](https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e)** to **[`88bda87`](https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2)**",
    "created_at": "2015-08-20T12:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246122",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1c20775`](https://github.com/sagemath/sagetrac-mirror/commit/1c20775295a7c243cafb90d92469a22e8cb9e88e)** to **[`88bda87`](https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2)**



---

archive/issue_comments_246123.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI changed `_atkin_lehner_action_from_{qexp,modsym}` to use the Sage convention instead of the Atkin-Li convention for Atkin-Lehner operators.  We still have to document this clearly.",
    "created_at": "2015-08-20T12:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246123",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:34" align="right">comment:34</div>

I changed `_atkin_lehner_action_from_{qexp,modsym}` to use the Sage convention instead of the Atkin-Li convention for Atkin-Lehner operators.  We still have to document this clearly.



---

archive/issue_comments_246124.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00\">cd6b13f</a></td><td><code>Trac 18061: document the definition of Atkin-Lehner operators</code></td></tr></table>\n",
    "created_at": "2015-08-20T13:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246124",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00">cd6b13f</a></td><td><code>Trac 18061: document the definition of Atkin-Lehner operators</code></td></tr></table>




---

archive/issue_comments_246125.json:
```json
{
    "body": "Changed commit from **[`88bda87`](https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2)** to **[`cd6b13f`](https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00)**",
    "created_at": "2015-08-20T13:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246125",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`88bda87`](https://github.com/sagemath/sagetrac-mirror/commit/88bda8783bc188c0a5ceccc999e576c93cc399c2)** to **[`cd6b13f`](https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00)**



---

archive/issue_comments_246126.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAfter fixing the ticket description, I hope everything is consistent now.",
    "created_at": "2015-08-20T14:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246126",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:36" align="right">comment:36</div>

After fixing the ticket description, I hope everything is consistent now.



---

archive/issue_comments_246127.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-Let *f* be a newform of level *n*, and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is a complex number *\u03b7* of absolute value 1 such that *W<sub>d</sub>f* = *\u03b7f*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.\n+Let *f* be a newform of weight *k* for \u0393<sub>1</sub>(*n*), and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is (in the normalisation used by Sage) a complex number *\u03b7* of absolute value *d*^*k*/2 - 1^ such that *W<sub>d</sub>f* = *\u03b7f*<sup>*</sup>, where *f*<sup>*</sup> is a certain twist of *f*.\n \n-The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* acting on a newform `f` and `f_star` is the conjugate form.\n+The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that, given a newform `f`, returns a pair `(eta, g)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* on `f` and `g` is the appropriate twist of `f`.\n \n This also fixes the following bug.  Consider the following newform of weight 2 for \u0393<sub>1</sub>(30) with coefficients in **Q**(*i*):\n \n``````\n",
    "created_at": "2015-08-20T14:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246127",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-Let *f* be a newform of level *n*, and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is a complex number *η* of absolute value 1 such that *W<sub>d</sub>f* = *ηf*<sup>*</sup>, where *f*<sup>*</sup> is the form whose coefficients are the complex conjugates of those of *f*.
+Let *f* be a newform of weight *k* for Γ<sub>1</sub>(*n*), and let *d* be a divisor of *n* that is coprime to *n/d*.  Then the Atkin-Lehner operator *W<sub>d</sub>* acts by a *pseudo-eigenvalue* on *f*: this is (in the normalisation used by Sage) a complex number *η* of absolute value *d*^*k*/2 - 1^ such that *W<sub>d</sub>f* = *ηf*<sup>*</sup>, where *f*<sup>*</sup> is a certain twist of *f*.
 
-The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that returns a pair `(eta, f_star)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* acting on a newform `f` and `f_star` is the conjugate form.
+The main goal of this ticket is to add a method `Newform.atkin_lehner_action(d)` that, given a newform `f`, returns a pair `(eta, g)`, where `eta` is the pseudo-eigenvalue of *W<sub>d</sub>* on `f` and `g` is the appropriate twist of `f`.
 
 This also fixes the following bug.  Consider the following newform of weight 2 for Γ<sub>1</sub>(30) with coefficients in **Q**(*i*):
 
``````




---

archive/issue_comments_246128.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHi Peter,\n\nMega-pedantic comment: in the docstring for \"def atkin_lehner_eigenvalue\", the \"NOTE\" is untrue (as the accompanying example shows). It would be nice if we could get this merged, but our contributions are now so much intertwined that we can't really review each other's code -- we need a third-party reviewer.",
    "created_at": "2015-12-04T15:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246128",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:37" align="right">comment:37</div>

Hi Peter,

Mega-pedantic comment: in the docstring for "def atkin_lehner_eigenvalue", the "NOTE" is untrue (as the accompanying example shows). It would be nice if we could get this merged, but our contributions are now so much intertwined that we can't really review each other's code -- we need a third-party reviewer.



---

archive/issue_events_256887.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-04T15:33:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256887"
}
```



---

archive/issue_events_256888.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-04T15:33:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256888"
}
```



---

archive/issue_comments_246129.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414\">0041931</a></td><td><code>Trac 18061: remove incorrect statement in docstring</code></td></tr></table>\n",
    "created_at": "2015-12-07T22:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246129",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414">0041931</a></td><td><code>Trac 18061: remove incorrect statement in docstring</code></td></tr></table>




---

archive/issue_comments_246130.json:
```json
{
    "body": "Changed commit from **[`cd6b13f`](https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00)** to **[`0041931`](https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414)**",
    "created_at": "2015-12-07T22:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246130",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cd6b13f`](https://github.com/sagemath/sagetrac-mirror/commit/cd6b13f1e11ee10ff9d22d5972bc27ac64422c00)** to **[`0041931`](https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414)**



---

archive/issue_comments_246131.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nHi David,\n> Mega-pedantic comment: in the docstring for \"def atkin_lehner_eigenvalue\", the \"NOTE\" is untrue (as the accompanying example shows).\n\nRemoved in the last commit, thanks for spotting this!\n> It would be nice if we could get this merged, but our contributions are now so much intertwined that we can't really review each other's code -- we need a third-party reviewer.\n\nI agree.",
    "created_at": "2015-12-07T22:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246131",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:39" align="right">comment:39</div>

Hi David,
> Mega-pedantic comment: in the docstring for "def atkin_lehner_eigenvalue", the "NOTE" is untrue (as the accompanying example shows).

Removed in the last commit, thanks for spotting this!
> It would be nice if we could get this merged, but our contributions are now so much intertwined that we can't really review each other's code -- we need a third-party reviewer.

I agree.



---

archive/issue_events_256889.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-12-07T22:17:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256889"
}
```



---

archive/issue_events_256890.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-12-07T22:17:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256890"
}
```



---

archive/issue_events_256891.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-10T09:32:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256891"
}
```



---

archive/issue_events_256892.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-10T09:32:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256892"
}
```



---

archive/issue_comments_246132.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThis now doesn't merge, because it conflicts with #19668 (merged in 6.10.rc0). I'll upload a rebased version shortly.",
    "created_at": "2015-12-10T09:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246132",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:41" align="right">comment:41</div>

This now doesn't merge, because it conflicts with #19668 (merged in 6.10.rc0). I'll upload a rebased version shortly.



---

archive/issue_comments_246133.json:
```json
{
    "body": "Changed branch from **[u/pbruin/18061-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-rebased)** to **[public/18061-rebase](https://github.com/sagemath/sagetrac-mirror/tree/public/18061-rebase)**",
    "created_at": "2015-12-10T13:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246133",
    "user": "https://github.com/loefflerd"
}
```

Changed branch from **[u/pbruin/18061-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/18061-rebased)** to **[public/18061-rebase](https://github.com/sagemath/sagetrac-mirror/tree/public/18061-rebase)**



---

archive/issue_comments_246134.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c\">559d7d0</a></td><td><code>Trac 18061: sort out merge fallout</code></td></tr></table>\n",
    "created_at": "2015-12-10T13:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246134",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c">559d7d0</a></td><td><code>Trac 18061: sort out merge fallout</code></td></tr></table>




---

archive/issue_comments_246135.json:
```json
{
    "body": "Changed commit from **[`0041931`](https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414)** to **[`559d7d0`](https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c)**",
    "created_at": "2015-12-10T13:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246135",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0041931`](https://github.com/sagemath/sagetrac-mirror/commit/0041931d71f2c870505f6781546c9cabf5dd6414)** to **[`559d7d0`](https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c)**



---

archive/issue_comments_246136.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI rebased it to 6.10.rc0, and created a new public branch.",
    "created_at": "2015-12-10T13:13:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246136",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:44" align="right">comment:44</div>

I rebased it to 6.10.rc0, and created a new public branch.



---

archive/issue_events_256893.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-10T13:13:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256893"
}
```



---

archive/issue_events_256894.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2015-12-10T13:13:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256894"
}
```



---

archive/issue_comments_246137.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6\">adea89b</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>\n",
    "created_at": "2016-08-11T07:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246137",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6">adea89b</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>




---

archive/issue_comments_246138.json:
```json
{
    "body": "Changed commit from **[`559d7d0`](https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c)** to **[`adea89b`](https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6)**",
    "created_at": "2016-08-11T07:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246138",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`559d7d0`](https://github.com/sagemath/sagetrac-mirror/commit/559d7d0205cdcaf80427b67cf92a0de38ab9eb3c)** to **[`adea89b`](https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6)**



---

archive/issue_comments_246139.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac\">d702cb3</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>\n",
    "created_at": "2016-10-11T14:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246139",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac">d702cb3</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>




---

archive/issue_comments_246140.json:
```json
{
    "body": "Changed commit from **[`adea89b`](https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6)** to **[`d702cb3`](https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac)**",
    "created_at": "2016-10-11T14:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246140",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`adea89b`](https://github.com/sagemath/sagetrac-mirror/commit/adea89bac4a262dbd0651a85720b7f0c1c794bb6)** to **[`d702cb3`](https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac)**



---

archive/issue_comments_246141.json:
```json
{
    "body": "Changed commit from **[`d702cb3`](https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac)** to **[`3ffdf4a`](https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a)**",
    "created_at": "2016-10-13T06:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246141",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d702cb3`](https://github.com/sagemath/sagetrac-mirror/commit/d702cb3992a65d5a0280b06b5b6ab389dcd961ac)** to **[`3ffdf4a`](https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a)**



---

archive/issue_comments_246142.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a\">3ffdf4a</a></td><td><code>Trac 18061: refer correctly to ComplexField, QQ, ZZ (now imported directly)</code></td></tr></table>\n",
    "created_at": "2016-10-13T06:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246142",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a">3ffdf4a</a></td><td><code>Trac 18061: refer correctly to ComplexField, QQ, ZZ (now imported directly)</code></td></tr></table>




---

archive/issue_comments_246143.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f\">07e9003</a></td><td><code>Trac 18061: update references [Atkin-Li] -> [AL1978]</code></td></tr></table>\n",
    "created_at": "2017-01-06T09:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f">07e9003</a></td><td><code>Trac 18061: update references [Atkin-Li] -> [AL1978]</code></td></tr></table>




---

archive/issue_comments_246144.json:
```json
{
    "body": "Changed commit from **[`3ffdf4a`](https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a)** to **[`07e9003`](https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f)**",
    "created_at": "2017-01-06T09:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3ffdf4a`](https://github.com/sagemath/sagetrac-mirror/commit/3ffdf4a8775ef083b8576b8409ee5eb77e00d50a)** to **[`07e9003`](https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f)**



---

archive/issue_comments_246145.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReferences had to be changed due to #21454.",
    "created_at": "2017-01-06T09:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246145",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:49" align="right">comment:49</div>

References had to be changed due to #21454.



---

archive/issue_comments_246146.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nFailing doctests in `sage/modular/abvar/lseries.py`, see [patchbot report](https://patchbot.sagemath.org/log/18061/Ubuntu/16.04/x86_64/3.13.0-83-generic/poseidon/2017-01-26%2018:44:56?short)",
    "created_at": "2017-01-27T08:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246146",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:50" align="right">comment:50</div>

Failing doctests in `sage/modular/abvar/lseries.py`, see [patchbot report](https://patchbot.sagemath.org/log/18061/Ubuntu/16.04/x86_64/3.13.0-83-generic/poseidon/2017-01-26%2018:44:56?short)



---

archive/issue_events_256895.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2017-01-27T08:20:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256895"
}
```



---

archive/issue_events_256896.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2017-01-27T08:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256896"
}
```



---

archive/issue_comments_246147.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI am CC-ing Kevin Lui and William Stein because the failing doctest was introduced in #21496.  I suspect that the numerical value occurring in the following doctest may be incorrect:\n\n```\nsage: L = J1(23).lseries(); L\nComplex L-series attached to Abelian variety J1(23) of dimension 12\nsage: L(1)\n1.71571957480487e-7\n```\n\nWith the current branch, the doctest fails with a `ValueError` because some of the cusp forms occurring in the decomposition of J_1(23) are not eigenforms for the Atkin-Lehner operator.  After fixing the method `ModularForm_abstract.lseries()` to dispense with this assumption (work in progress, not pushed yet), I get\n\n```\nsage: L = J1(23).lseries(); L\nComplex L-series attached to Abelian variety J1(23) of dimension 12\nsage: L(1)\n0.000129519861426989 + 1.14001148377577e-19*I\n```\nThis value agrees with the product of all special values *L*(*f*, 1) with *f* ranging over the 12 complex primitive forms of weight 2 for Gamma_1(23), which according to the LMFDB pages for the modular forms [23.2.1.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/23/2/1/a/) and [23.2.2.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/23/2/2/a/) are\n\n```\n0.4503793707,\n0.5516057856,\n0.2732227586 - 0.2394635951*I,\n0.4450567187 + 0.2281314535*I,\n0.5144735331 + 0.0030140754*I,\n0.4295189659 - 0.1720855959*I,\n0.5226459551 - 0.0741564295*I,\n0.5226459551 + 0.0741564295*I,\n0.4295189659 + 0.1720855959*I,\n0.5144735331 - 0.0030140754*I,\n0.4450567187 - 0.2281314535*I,\n0.2732227586 + 0.2394635951*I\n```\n(follow the various links to the L-functions on these pages, and look at the values *L*(*f*, 1/2); note that LMFDB uses the \"analytic\" normalisation).\n\nUnfortunately, Magma agrees with neither of the above two values:\n\n```\n> Evaluate(LSeries(JOne(23)), 1);\n8.07776970747857754200906998408E-8 + 5.36796212774822177732076691797E-8*i\n```",
    "created_at": "2017-01-30T13:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246147",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:51" align="right">comment:51</div>

I am CC-ing Kevin Lui and William Stein because the failing doctest was introduced in #21496.  I suspect that the numerical value occurring in the following doctest may be incorrect:

```
sage: L = J1(23).lseries(); L
Complex L-series attached to Abelian variety J1(23) of dimension 12
sage: L(1)
1.71571957480487e-7
```

With the current branch, the doctest fails with a `ValueError` because some of the cusp forms occurring in the decomposition of J_1(23) are not eigenforms for the Atkin-Lehner operator.  After fixing the method `ModularForm_abstract.lseries()` to dispense with this assumption (work in progress, not pushed yet), I get

```
sage: L = J1(23).lseries(); L
Complex L-series attached to Abelian variety J1(23) of dimension 12
sage: L(1)
0.000129519861426989 + 1.14001148377577e-19*I
```
This value agrees with the product of all special values *L*(*f*, 1) with *f* ranging over the 12 complex primitive forms of weight 2 for Gamma_1(23), which according to the LMFDB pages for the modular forms [23.2.1.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/23/2/1/a/) and [23.2.2.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/23/2/2/a/) are

```
0.4503793707,
0.5516057856,
0.2732227586 - 0.2394635951*I,
0.4450567187 + 0.2281314535*I,
0.5144735331 + 0.0030140754*I,
0.4295189659 - 0.1720855959*I,
0.5226459551 - 0.0741564295*I,
0.5226459551 + 0.0741564295*I,
0.4295189659 + 0.1720855959*I,
0.5144735331 - 0.0030140754*I,
0.4450567187 - 0.2281314535*I,
0.2732227586 + 0.2394635951*I
```
(follow the various links to the L-functions on these pages, and look at the values *L*(*f*, 1/2); note that LMFDB uses the "analytic" normalisation).

Unfortunately, Magma agrees with neither of the above two values:

```
> Evaluate(LSeries(JOne(23)), 1);
8.07776970747857754200906998408E-8 + 5.36796212774822177732076691797E-8*i
```



---

archive/issue_comments_246148.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nHere is a smaller example of incorrectly computed special *L*-values of cusp forms:\n\n```\nsage: f = Newforms(Gamma1(13), 2, names='a')[0]  # coefficient field QQ(zeta_3)\nsage: f.lseries(embedding=0)(1)\n0.150417043086554 - 0.0100341694561220*I\nsage: f.lseries(embedding=1)(1)\n0.150417043086554 + 0.0100341694561220*I\nsage: J1(13).lseries()(1)  # product of the above two\n0.0227259714075763\n```\nWith my branch, these become\n\n```\nsage: f.lseries(embedding=0)(1)\n0.298115272465799 - 0.0402203326076734*I\nsage: f.lseries(embedding=1)(1)\n0.298115272465799 + 0.0402203326076732*I\nsage: J1(13).lseries()(1)  # product of the above two\n0.0904903908324296 - 4.51028103753970e-17*I\n```\nwhich agrees with the LMFDB data for [newform 13.2.4.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/13/2/4/a/).\n\nHere Magma is almost certainly wrong (the result should be close to a real number):\n\n```\n> Evaluate(LSeries(JOne(13)), 1);\n0.00926625827718259912085805050640 - 0.0306402029795322002630256221347*i\n```",
    "created_at": "2017-01-30T14:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246148",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:52" align="right">comment:52</div>

Here is a smaller example of incorrectly computed special *L*-values of cusp forms:

```
sage: f = Newforms(Gamma1(13), 2, names='a')[0]  # coefficient field QQ(zeta_3)
sage: f.lseries(embedding=0)(1)
0.150417043086554 - 0.0100341694561220*I
sage: f.lseries(embedding=1)(1)
0.150417043086554 + 0.0100341694561220*I
sage: J1(13).lseries()(1)  # product of the above two
0.0227259714075763
```
With my branch, these become

```
sage: f.lseries(embedding=0)(1)
0.298115272465799 - 0.0402203326076734*I
sage: f.lseries(embedding=1)(1)
0.298115272465799 + 0.0402203326076732*I
sage: J1(13).lseries()(1)  # product of the above two
0.0904903908324296 - 4.51028103753970e-17*I
```
which agrees with the LMFDB data for [newform 13.2.4.a](http://www.lmfdb.org/ModularForm/GL2/Q/holomorphic/13/2/4/a/).

Here Magma is almost certainly wrong (the result should be close to a real number):

```
> Evaluate(LSeries(JOne(13)), 1);
0.00926625827718259912085805050640 - 0.0306402029795322002630256221347*i
```



---

archive/issue_comments_246149.json:
```json
{
    "body": "Changed commit from **[`07e9003`](https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f)** to **[`d3ec5fb`](https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b)**",
    "created_at": "2017-01-30T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246149",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`07e9003`](https://github.com/sagemath/sagetrac-mirror/commit/07e90033bb02ebe4461302851b8acc9e7bb0eb6f)** to **[`d3ec5fb`](https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b)**



---

archive/issue_comments_246150.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f07162ab0efc4a55535c20bdbe7a1f5432f7fc5b\">f07162a</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0cfc8527f3eb4d0162c51045e66532ca6918e1f\">b0cfc85</a></td><td><code>Trac 18061: implement/use atkin_lehner_action() for all modular forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b8b81eae5401396b7ea4db55b3f8dc5c1a0c49a\">0b8b81e</a></td><td><code>Trac 18061: do not restrict to Atkin-Lehner eigenforms in ModularForm_abstract.lseries()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b\">d3ec5fb</a></td><td><code>Trac 18061: trivial docstring changes</code></td></tr></table>\n",
    "created_at": "2017-01-30T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246150",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f07162ab0efc4a55535c20bdbe7a1f5432f7fc5b">f07162a</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0cfc8527f3eb4d0162c51045e66532ca6918e1f">b0cfc85</a></td><td><code>Trac 18061: implement/use atkin_lehner_action() for all modular forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b8b81eae5401396b7ea4db55b3f8dc5c1a0c49a">0b8b81e</a></td><td><code>Trac 18061: do not restrict to Atkin-Lehner eigenforms in ModularForm_abstract.lseries()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b">d3ec5fb</a></td><td><code>Trac 18061: trivial docstring changes</code></td></tr></table>




---

archive/issue_comments_246151.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nHere are some improvements that should fix the above problems.",
    "created_at": "2017-01-30T16:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246151",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:54" align="right">comment:54</div>

Here are some improvements that should fix the above problems.



---

archive/issue_events_256897.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2017-01-30T16:42:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256897"
}
```



---

archive/issue_events_256898.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2017-01-30T16:42:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256898"
}
```



---

archive/issue_comments_246152.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b\">7030e6e</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>\n",
    "created_at": "2017-03-13T08:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246152",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b">7030e6e</a></td><td><code>Merge branch 'develop' into ticket/18061-atkin_lehner_action</code></td></tr></table>




---

archive/issue_comments_246153.json:
```json
{
    "body": "Changed commit from **[`d3ec5fb`](https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b)** to **[`7030e6e`](https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b)**",
    "created_at": "2017-03-13T08:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246153",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d3ec5fb`](https://github.com/sagemath/sagetrac-mirror/commit/d3ec5fbdea648bd8bbf6b89d5a3ea969d587307b)** to **[`7030e6e`](https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b)**



---

archive/issue_events_256899.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-13T20:02:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256899"
}
```



---

archive/issue_events_256900.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-13T20:02:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256900"
}
```



---

archive/issue_comments_246154.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\ngreen bot, please review",
    "created_at": "2017-03-13T20:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246154",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:56" align="right">comment:56</div>

green bot, please review



---

archive/issue_comments_246155.json:
```json
{
    "body": "Changed commit from **[`7030e6e`](https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b)** to **[`cf0278b`](https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80)**",
    "created_at": "2017-03-28T12:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246155",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7030e6e`](https://github.com/sagemath/sagetrac-mirror/commit/7030e6ebd2f8ef6be84a90ae376bc74947732e3b)** to **[`cf0278b`](https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80)**



---

archive/issue_comments_246156.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80\">cf0278b</a></td><td><code>Trac 18061: make doctest more robust</code></td></tr></table>\n",
    "created_at": "2017-03-28T12:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246156",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80">cf0278b</a></td><td><code>Trac 18061: make doctest more robust</code></td></tr></table>




---

archive/issue_comments_246157.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nImproved a doctest to avoid failures due to \"numerical noise\".",
    "created_at": "2017-03-28T12:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246157",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:58" align="right">comment:58</div>

Improved a doctest to avoid failures due to "numerical noise".



---

archive/issue_comments_246158.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96\">3ba3aff</a></td><td><code>Merge branch 'public/18061-rebase' in 8.0.b0</code></td></tr></table>\n",
    "created_at": "2017-03-31T07:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246158",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96">3ba3aff</a></td><td><code>Merge branch 'public/18061-rebase' in 8.0.b0</code></td></tr></table>




---

archive/issue_comments_246159.json:
```json
{
    "body": "Changed commit from **[`cf0278b`](https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80)** to **[`3ba3aff`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96)**",
    "created_at": "2017-03-31T07:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246159",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cf0278b`](https://github.com/sagemath/sagetrac-mirror/commit/cf0278bf9e6536c33b3ea59946e8124933156b80)** to **[`3ba3aff`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96)**



---

archive/issue_comments_246160.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\ngreen bot",
    "created_at": "2017-04-05T10:15:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246160",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:60" align="right">comment:60</div>

green bot



---

archive/issue_events_256901.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-05T10:15:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256901"
}
```



---

archive/issue_events_256902.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-05T10:15:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256902"
}
```



---

archive/issue_comments_246161.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\ngreen bot ! experts and interested people, please look at this ticket !",
    "created_at": "2017-05-10T11:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246161",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:61" align="right">comment:61</div>

green bot ! experts and interested people, please look at this ticket !



---

archive/issue_comments_246162.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\n**PING** ?",
    "created_at": "2017-05-18T19:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246162",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:62" align="right">comment:62</div>

**PING** ?



---

archive/issue_comments_246163.json:
```json
{
    "body": "Changed dependencies from **#18068, #18072, #18086, #18478** to none",
    "created_at": "2017-06-22T11:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246163",
    "user": "https://github.com/fchapoton"
}
```

Changed dependencies from **#18068, #18072, #18086, #18478** to none



---

archive/issue_comments_246164.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046\">41baa68</a></td><td><code>Trac 18061: fix .. SEEALSO:: syntax</code></td></tr></table>\n",
    "created_at": "2017-07-11T07:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246164",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046">41baa68</a></td><td><code>Trac 18061: fix .. SEEALSO:: syntax</code></td></tr></table>




---

archive/issue_comments_246165.json:
```json
{
    "body": "Changed commit from **[`3ba3aff`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96)** to **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**",
    "created_at": "2017-07-11T07:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246165",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3ba3aff`](https://github.com/sagemath/sagetrac-mirror/commit/3ba3aff60b36e0dfc96c71606225b92251258e96)** to **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**



---

archive/issue_comments_246166.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nThe \"blocks\" plugin of the patchbot complains about the `.. SEEALSO::` blocks inserted by this ticket; see [this report](https://patchbot.sagemath.org/log/18061/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-07-06%2006:51:02?plugin=blocks&diff=/log/0/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-07-05%2023%3A23%3A47&ticket=18061&base=8.0.rc1).  One of them was missing a colon, but the others had the correct syntax as far as I can see.\n\nFr\u00e9d\u00e9ric, could you perhaps check the plugin to see if it is doing the right thing?",
    "created_at": "2017-07-11T07:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246166",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:66" align="right">comment:66</div>

The "blocks" plugin of the patchbot complains about the `.. SEEALSO::` blocks inserted by this ticket; see [this report](https://patchbot.sagemath.org/log/18061/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-07-06%2006:51:02?plugin=blocks&diff=/log/0/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-07-05%2023%3A23%3A47&ticket=18061&base=8.0.rc1).  One of them was missing a colon, but the others had the correct syntax as far as I can see.

Frédéric, could you perhaps check the plugin to see if it is doing the right thing?



---

archive/issue_comments_246167.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nThis has been fixed already. In fact, patchbot 2.6.9 is not quite the latest, but I forgot to make a tag for 2.7.0\n\nEDIT: patchbot 2.7.0 now officially the latest version",
    "created_at": "2017-07-11T08:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246167",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:67" align="right">comment:67</div>

This has been fixed already. In fact, patchbot 2.6.9 is not quite the latest, but I forgot to make a tag for 2.7.0

EDIT: patchbot 2.7.0 now officially the latest version



---

archive/issue_events_256903.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-26T14:01:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256903"
}
```



---

archive/issue_events_256904.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-26T14:01:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256904"
}
```



---

archive/issue_comments_246168.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI think one could set this one to positive-review. There is one fully-green bot.\n\nConfirmation, somebody ?",
    "created_at": "2017-08-26T14:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246168",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:68" align="right">comment:68</div>

I think one could set this one to positive-review. There is one fully-green bot.

Confirmation, somebody ?



---

archive/issue_comments_246169.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@fchapoton](#comment:68):\n> I think one could set this one to positive-review. There is one fully-green bot.\n> \n> Confirmation, somebody ?\n\nPersonally I would be very happy if this could finally be merged.  It fixes known bugs and is not known to introduce new ones.  If someone could verify that the fixed doctests in `sage/modular/abvar/lseries.py` are correct (see [comment:51](#comment:51)) then maybe together with the fact that David and I have looked at each other's code, that could count as a positive review?",
    "created_at": "2017-08-30T13:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246169",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@fchapoton](#comment:68):
> I think one could set this one to positive-review. There is one fully-green bot.
> 
> Confirmation, somebody ?

Personally I would be very happy if this could finally be merged.  It fixes known bugs and is not known to introduce new ones.  If someone could verify that the fixed doctests in `sage/modular/abvar/lseries.py` are correct (see [comment:51](#comment:51)) then maybe together with the fact that David and I have looked at each other's code, that could count as a positive review?



---

archive/issue_comments_246170.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nok, let it be. It has been waiting for long enough.\n\nEDIT: I confirm that magma V2.22-3 has not the same value as us for J1(23). Let us keep that for another ticket.",
    "created_at": "2017-08-30T13:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246170",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:70" align="right">comment:70</div>

ok, let it be. It has been waiting for long enough.

EDIT: I confirm that magma V2.22-3 has not the same value as us for J1(23). Let us keep that for another ticket.



---

archive/issue_comments_246171.json:
```json
{
    "body": "Reviewer: **Peter Bruin, David Loeffler, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-08-30T13:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246171",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Peter Bruin, David Loeffler, Frédéric Chapoton**



---

archive/issue_events_256905.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-30T13:31:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256905"
}
```



---

archive/issue_events_256906.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-30T13:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256906"
}
```



---

archive/issue_comments_246172.json:
```json
{
    "body": "Changed branch from **[public/18061-rebase](https://github.com/sagemath/sagetrac-mirror/tree/public/18061-rebase)** to **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**",
    "created_at": "2017-09-04T06:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18061#issuecomment-246172",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/18061-rebase](https://github.com/sagemath/sagetrac-mirror/tree/public/18061-rebase)** to **[`41baa68`](https://github.com/sagemath/sagetrac-mirror/commit/41baa6825bd3018d1c443b53e1f0aba0242ea046)**



---

archive/issue_events_256907.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-04T06:11:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256907"
}
```



---

archive/issue_events_256908.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b40f4e8bbed7700af812b5a3323bd4c571740c60",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-04T06:11:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18061",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18061#event-256908"
}
```
