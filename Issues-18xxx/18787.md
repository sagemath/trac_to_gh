# Issue 18787: symbolic modular integers still broken

archive/issues_018550.json:
```json
{
    "body": "> {{{\n> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3\n> sage: f(1)\n> 2\n> sage: Zmod(7)(1) + Zmod(9)(1)\n\n...\nTypeError: unsupported operand parent(s) for '+': 'Ring of integers modulo 7' and 'Ring of integers modulo 9'\n> }}}\n\n\n\nCC:  @kcrisman @slel\n\nReviewer: Ralf Stephan\n\nBranch: u/rws/symbolic_modular_integers_still_broken\n\nDependencies: #21391\n\nCommit: be9ec4e97557a2ff7ed682ed62c2101d084de498\n\nResolution: wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/18787\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2015-06-25T11:07:30Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "symbolic modular integers still broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18787",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
> {{{
> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3
> sage: f(1)
> 2
> sage: Zmod(7)(1) + Zmod(9)(1)

...
TypeError: unsupported operand parent(s) for '+': 'Ring of integers modulo 7' and 'Ring of integers modulo 9'
> }}}



CC:  @kcrisman @slel

Reviewer: Ralf Stephan

Branch: u/rws/symbolic_modular_integers_still_broken

Dependencies: #21391

Commit: be9ec4e97557a2ff7ed682ed62c2101d084de498

Resolution: wontfix

Issue created by migration from https://trac.sagemath.org/ticket/18787





---

archive/issue_comments_326872.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,8 @@\n As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)\n \n ```\n-sage: sage: var('A,B,C,D')\n-(A, B, C, D)\n-sage: S = matrix(SR,2,[[1+3*A,3*B],[3*C,1+3*D]])\n+sage: _ =var('A,B,C,D')\n+sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])\n sage: R = Zmod(9)\n sage: g = matrix(R,2,[[2,1],[2,6]])\n sage: gi = matrix(R,2,[[6,8],[7,2]])\n@@ -15,12 +14,12 @@\n While we have (look at the second line):\n \n ```\n-sage: R.<A,B,C,D> = PolynomialRing(Zmod(9),4)\n+sage: P.<A,B,C,D> = ZZ[]\n+sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])\n+sage: R = Zmod(9)\n sage: g = matrix(R,2,[[2,1],[2,6]])\n sage: gi = matrix(R,2,[[6,8],[7,2]])\n-sage: S = matrix(R,2,[[1+3*A,3*B],[3*C,1+3*D]])\n sage: g*S*gi\n [        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]\n [                  6*B         3*A + 3*B + 1]\n ```\n-\n``````\n",
    "created_at": "2015-06-25T12:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326872",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,8 @@
 As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)
 
 ```
-sage: sage: var('A,B,C,D')
-(A, B, C, D)
-sage: S = matrix(SR,2,[[1+3*A,3*B],[3*C,1+3*D]])
+sage: _ =var('A,B,C,D')
+sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])
 sage: R = Zmod(9)
 sage: g = matrix(R,2,[[2,1],[2,6]])
 sage: gi = matrix(R,2,[[6,8],[7,2]])
@@ -15,12 +14,12 @@
 While we have (look at the second line):
 
 ```
-sage: R.<A,B,C,D> = PolynomialRing(Zmod(9),4)
+sage: P.<A,B,C,D> = ZZ[]
+sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])
+sage: R = Zmod(9)
 sage: g = matrix(R,2,[[2,1],[2,6]])
 sage: gi = matrix(R,2,[[6,8],[7,2]])
-sage: S = matrix(R,2,[[1+3*A,3*B],[3*C,1+3*D]])
 sage: g*S*gi
 [        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]
 [                  6*B         3*A + 3*B + 1]
 ```
-
``````




---

archive/issue_comments_326873.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,25 +1,7 @@\n As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)\n \n ```\n-sage: _ =var('A,B,C,D')\n-sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])\n-sage: R = Zmod(9)\n-sage: g = matrix(R,2,[[2,1],[2,6]])\n-sage: gi = matrix(R,2,[[6,8],[7,2]])\n-sage: g*S*gi\n-[        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]\n-[            0*A + 0*D         3*A + 0*D + 1]\n+sage: _ = var('A,B,C,D')\n+sage: (B + 3*D)*Zmod(9)(6)\n+0*D\n ```\n-\n-While we have (look at the second line):\n-\n-```\n-sage: P.<A,B,C,D> = ZZ[]\n-sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])\n-sage: R = Zmod(9)\n-sage: g = matrix(R,2,[[2,1],[2,6]])\n-sage: gi = matrix(R,2,[[6,8],[7,2]])\n-sage: g*S*gi\n-[        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]\n-[                  6*B         3*A + 3*B + 1]\n-```\n``````\n",
    "created_at": "2015-06-25T12:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326873",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,25 +1,7 @@
 As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)
 
 ```
-sage: _ =var('A,B,C,D')
-sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])
-sage: R = Zmod(9)
-sage: g = matrix(R,2,[[2,1],[2,6]])
-sage: gi = matrix(R,2,[[6,8],[7,2]])
-sage: g*S*gi
-[        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]
-[            0*A + 0*D         3*A + 0*D + 1]
+sage: _ = var('A,B,C,D')
+sage: (B + 3*D)*Zmod(9)(6)
+0*D
 ```
-
-While we have (look at the second line):
-
-```
-sage: P.<A,B,C,D> = ZZ[]
-sage: S = matrix([[1+3*A,3*B],[3*C,1+3*D]])
-sage: R = Zmod(9)
-sage: g = matrix(R,2,[[2,1],[2,6]])
-sage: gi = matrix(R,2,[[6,8],[7,2]])
-sage: g*S*gi
-[        6*B + 3*D + 1 3*A + 3*B + 6*C + 6*D]
-[                  6*B         3*A + 3*B + 1]
-```
``````




---

archive/issue_events_067526.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "rename": {
        "from": "Bug with matrice products over Symbolic Ring with modular integers",
        "to": "Bug with products of symbolic variables with modular integers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67526"
}
```



---

archive/issue_comments_326874.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks for isolating the problem.",
    "created_at": "2015-06-25T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326874",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>
Thanks for isolating the problem.



---

archive/issue_comments_326875.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,10 @@\n As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)\n \n ```\n-sage: _ = var('A,B,C,D')\n-sage: (B + 3*D)*Zmod(9)(6)\n-0*D\n+sage: _ = var('A,B')\n+sage: (A + 3*B)*Zmod(9)(6)\n+0*B\n ```\n+\n+while the result should be `6*A`.\n+\n``````\n",
    "created_at": "2015-06-25T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326875",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,10 @@
 As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)
 
 ```
-sage: _ = var('A,B,C,D')
-sage: (B + 3*D)*Zmod(9)(6)
-0*D
+sage: _ = var('A,B')
+sage: (A + 3*B)*Zmod(9)(6)
+0*B
 ```
+
+while the result should be `6*A`.
+
``````




---

archive/issue_comments_326876.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks very much to both for reporting and simplifying this.",
    "created_at": "2015-06-25T13:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326876",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
Thanks very much to both for reporting and simplifying this.



---

archive/issue_comments_326877.json:
```json
{
    "body": "<a id='comment:6'></a>\nA different issue, but it might be related:\n\n```\nsage: F=sum((i+1)*x^i for i in [0..20])\nsage: G=sum(Zmod(7)(i+1)*x^i for i in [0..20])\nsage: F*Zmod(7)(1) - G\nx^19 + 2*x^18 + 0*x^13 + 0*x^6\nsage: G*Zmod(7)(1) - G\n0\n```\nso there seems to be something fishy with symbolic multiplication involving integers and elements of Z/n in general. It's not just a zero-divisor problem.\n\nIt's not just powers either:\n\n```\nsage: V=[SR.var(\"x%s\"%i) for i in [0..20]]\nsage: F=sum((i+1)*V[i] for i in [0..20])\nsage: G=sum(Zmod(7)(i+1)*V[i] for i in [0..20])\nsage: sage: F*Zmod(7)(1)-G\n-x0 + 0*x13 + 6*x14 + 0*x20 + 3*x3 + 0*x6\nsage: F-G \n14*x13 + 21*x20 + 7*x6\n```\nThe last one is correct, since the terms with x6, x20 and x13 are really missing from G. This illustrates why mixing characteristics in SR is always going to be a mess (even if non-zero characteristic works properly otherwise).",
    "created_at": "2015-06-25T18:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326877",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'></a>
A different issue, but it might be related:

```
sage: F=sum((i+1)*x^i for i in [0..20])
sage: G=sum(Zmod(7)(i+1)*x^i for i in [0..20])
sage: F*Zmod(7)(1) - G
x^19 + 2*x^18 + 0*x^13 + 0*x^6
sage: G*Zmod(7)(1) - G
0
```
so there seems to be something fishy with symbolic multiplication involving integers and elements of Z/n in general. It's not just a zero-divisor problem.

It's not just powers either:

```
sage: V=[SR.var("x%s"%i) for i in [0..20]]
sage: F=sum((i+1)*V[i] for i in [0..20])
sage: G=sum(Zmod(7)(i+1)*V[i] for i in [0..20])
sage: sage: F*Zmod(7)(1)-G
-x0 + 0*x13 + 6*x14 + 0*x20 + 3*x3 + 0*x6
sage: F-G 
14*x13 + 21*x20 + 7*x6
```
The last one is correct, since the terms with x6, x20 and x13 are really missing from G. This illustrates why mixing characteristics in SR is always going to be a mess (even if non-zero characteristic works properly otherwise).



---

archive/issue_comments_326878.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt seems to be a pynac/ginac issue, right ? So what should we do on our side ? Add a stopgap during conversion/coercion Zmod(n) -> SR ?",
    "created_at": "2015-06-25T20:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326878",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>
It seems to be a pynac/ginac issue, right ? So what should we do on our side ? Add a stopgap during conversion/coercion Zmod(n) -> SR ?



---

archive/issue_comments_326879.json:
```json
{
    "body": "<a id='comment:8'></a>\n(Or even just disallow it?)",
    "created_at": "2015-06-25T20:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326879",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>
(Or even just disallow it?)



---

archive/issue_comments_326880.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis is working in pynac-0.4.1 (but not 0.3.9.1).\n\nEDIT: I meant the original case.",
    "created_at": "2015-06-26T06:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326880",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>
This is working in pynac-0.4.1 (but not 0.3.9.1).

EDIT: I meant the original case.



---

archive/issue_comments_326881.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [nbruin](#comment%3A6):\n> It's not just powers either:\n> \n> ```\n> sage: V=[SR.var(\"x%s\"%i) for i in [0..20]]\n> sage: F=sum((i+1)*V[i] for i in [0..20])\n> sage: G=sum(Zmod(7)(i+1)*V[i] for i in [0..20])\n> sage: sage: F*Zmod(7)(1)-G\n> -x0 + 0*x13 + 6*x14 + 0*x20 + 3*x3 + 0*x6\n> sage: F-G \n> 14*x13 + 21*x20 + 7*x6\n> ```\n\nThis is different in 0.4.1:\n\n```\nsage: sage: sage: F*Zmod(7)(1)-G\n-x0 + 0*x13 + 0*x20 + 4*x9\nsage: F-G\n14*x13 + 21*x20 + 7*x6\nsage: F\nx0 + 2*x1 + 11*x10 + 12*x11 + 13*x12 + 14*x13 + 15*x14 + 16*x15 + 17*x16 + 18*x17 + 19*x18 + 20*x19 + 3*x2 + 21*x20 + 4*x3 + 5*x4 + 6*x5 + 7*x6 + 8*x7 + 9*x8 + 10*x9\nsage: G\nx0 + 2*x1 + 4*x10 + 5*x11 + 6*x12 + x14 + 2*x15 + 3*x16 + 4*x17 + 5*x18 + 6*x19 + 3*x2 + 4*x3 + 5*x4 + 6*x5 + x7 + 2*x8 + 3*x9\n```\nEDIT: Added `F`,`G`.",
    "created_at": "2015-06-26T06:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326881",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
Replying to [nbruin](#comment%3A6):
> It's not just powers either:
> 
> ```
> sage: V=[SR.var("x%s"%i) for i in [0..20]]
> sage: F=sum((i+1)*V[i] for i in [0..20])
> sage: G=sum(Zmod(7)(i+1)*V[i] for i in [0..20])
> sage: sage: F*Zmod(7)(1)-G
> -x0 + 0*x13 + 6*x14 + 0*x20 + 3*x3 + 0*x6
> sage: F-G 
> 14*x13 + 21*x20 + 7*x6
> ```

This is different in 0.4.1:

```
sage: sage: sage: F*Zmod(7)(1)-G
-x0 + 0*x13 + 0*x20 + 4*x9
sage: F-G
14*x13 + 21*x20 + 7*x6
sage: F
x0 + 2*x1 + 11*x10 + 12*x11 + 13*x12 + 14*x13 + 15*x14 + 16*x15 + 17*x16 + 18*x17 + 19*x18 + 20*x19 + 3*x2 + 21*x20 + 4*x3 + 5*x4 + 6*x5 + 7*x6 + 8*x7 + 9*x8 + 10*x9
sage: G
x0 + 2*x1 + 4*x10 + 5*x11 + 6*x12 + x14 + 2*x15 + 3*x16 + 4*x17 + 5*x18 + 6*x19 + 3*x2 + 4*x3 + 5*x4 + 6*x5 + x7 + 2*x8 + 3*x9
```
EDIT: Added `F`,`G`.



---

archive/issue_comments_326882.json:
```json
{
    "body": "<a id='comment:11'></a>\nCorrection: this is not pynac-0.4.1 but pynac master. Narrowing down the reponsible change...",
    "created_at": "2015-06-26T07:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326882",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'></a>
Correction: this is not pynac-0.4.1 but pynac master. Narrowing down the reponsible change...



---

archive/issue_comments_326883.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,12 @@\n 0*B\n ```\n \n-while the result should be `6*A`.\n+while the result should be `6*A`. There is even (with the 6.6 Linux tarball)\n \n+```\n+sage: (3*A + 3*B + 1)*Zmod(9)(6)\n+6\n+sage: (3*A + 3*B)*Zmod(9)(6)\n+                           <------------ !!\n+sage:\n+```\n``````\n",
    "created_at": "2015-06-26T13:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326883",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,12 @@
 0*B
 ```
 
-while the result should be `6*A`.
+while the result should be `6*A`. There is even (with the 6.6 Linux tarball)
 
+```
+sage: (3*A + 3*B + 1)*Zmod(9)(6)
+6
+sage: (3*A + 3*B)*Zmod(9)(6)
+                           <------------ !!
+sage:
+```
``````




---

archive/issue_comments_326884.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,12 +6,19 @@\n 0*B\n ```\n \n-while the result should be `6*A`. There is even (with the 6.6 Linux tarball)\n+while the result should be `6*A`.\n+\n+It seems that the internal state of these objects is really messed up:\n \n ```\n-sage: (3*A + 3*B + 1)*Zmod(9)(6)\n-6\n-sage: (3*A + 3*B)*Zmod(9)(6)\n-                           <------------ !!\n-sage:\n+sage: _ = var('A,B')\n+sage: (3*A + 3*B)*Zmod(9)(6)    # Yes, the output is really empty!\n+\n+sage: (3*A + 3*B)*Zmod(9)(6)*A  \n+------------------------------------------------------------------------\n+Unhandled SIGSEGV: A segmentation fault occurred in Sage.\n+This probably occurred because a *compiled* component of Sage has a bug\n+in it and is not properly wrapped with sig_on(), sig_off().\n+Sage will now terminate.\n+------------------------------------------------------------------------\n ```\n``````\n",
    "created_at": "2015-06-26T13:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326884",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,12 +6,19 @@
 0*B
 ```
 
-while the result should be `6*A`. There is even (with the 6.6 Linux tarball)
+while the result should be `6*A`.
+
+It seems that the internal state of these objects is really messed up:
 
 ```
-sage: (3*A + 3*B + 1)*Zmod(9)(6)
-6
-sage: (3*A + 3*B)*Zmod(9)(6)
-                           <------------ !!
-sage:
+sage: _ = var('A,B')
+sage: (3*A + 3*B)*Zmod(9)(6)    # Yes, the output is really empty!
+
+sage: (3*A + 3*B)*Zmod(9)(6)*A  
+------------------------------------------------------------------------
+Unhandled SIGSEGV: A segmentation fault occurred in Sage.
+This probably occurred because a *compiled* component of Sage has a bug
+in it and is not properly wrapped with sig_on(), sig_off().
+Sage will now terminate.
+------------------------------------------------------------------------
 ```
``````




---

archive/issue_comments_326885.json:
```json
{
    "body": "Changing dependencies from \"\" to \"pynac-0.3.9.2\"",
    "created_at": "2015-06-26T15:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326885",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "pynac-0.3.9.2"



---

archive/issue_comments_326886.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe following patch works for these two examples, just to point at the direction further completion is needed:\n\n```\ndiff --git a/ginac/expairseq.cpp b/ginac/expairseq.cpp\nindex 2abb7b7..acef09b 100644\n--- a/ginac/expairseq.cpp\n+++ b/ginac/expairseq.cpp\n@@ -1207,16 +1207,17 @@ void expairseq::combine_same_terms_sorted_seq()\n \t// must_copy will be set to true the first time some combination is \n \t// possible from then on the sequence has changed and must be compacted\n \tbool must_copy = false;\n+        numeric itin1_c = ex_to<numeric>(itin1->coeff);\n \twhile (itin2!=last) {\n \t\tif (itin1->rest.compare(itin2->rest)==0 &&\n \t\t\t\tunlikely(!is_a<infinity>(itin1->rest))) {\n-\t\t\titin1->coeff = ex_to<numeric>(itin1->coeff).\n+\t\t\titin1->coeff = itin1_c.\n \t\t\t               add_dyn(ex_to<numeric>(itin2->coeff));\n \t\t\tif (expair_needs_further_processing(itin1))\n \t\t\t\tneeds_further_processing = true;\n \t\t\tmust_copy = true;\n \t\t} else {\n-\t\t\tif (!ex_to<numeric>(itin1->coeff).is_zero()) {\n+\t\t\tif (not itin1_c.is_zero() or itin1_c.is_parent_pos_char()) {\n \t\t\t\tif (must_copy)\n \t\t\t\t\t*itout = *itin1;\n \t\t\t\t++itout;\n@@ -1225,7 +1226,7 @@ void expairseq::combine_same_terms_sorted_seq()\n \t\t}\n \t\t++itin2;\n \t}\n-\tif (!ex_to<numeric>(itin1->coeff).is_zero()) {\n+\tif (not itin1_c.is_zero() or itin1_c.is_parent_pos_char()) {\n \t\tif (must_copy)\n \t\t\t*itout = *itin1;\n \t\t++itout;\n```\nThe relevant ticket would be https://github.com/pynac/pynac/issues/77.",
    "created_at": "2015-06-26T15:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326886",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
The following patch works for these two examples, just to point at the direction further completion is needed:

```
diff --git a/ginac/expairseq.cpp b/ginac/expairseq.cpp
index 2abb7b7..acef09b 100644
--- a/ginac/expairseq.cpp
+++ b/ginac/expairseq.cpp
@@ -1207,16 +1207,17 @@ void expairseq::combine_same_terms_sorted_seq()
 	// must_copy will be set to true the first time some combination is 
 	// possible from then on the sequence has changed and must be compacted
 	bool must_copy = false;
+        numeric itin1_c = ex_to<numeric>(itin1->coeff);
 	while (itin2!=last) {
 		if (itin1->rest.compare(itin2->rest)==0 &&
 				unlikely(!is_a<infinity>(itin1->rest))) {
-			itin1->coeff = ex_to<numeric>(itin1->coeff).
+			itin1->coeff = itin1_c.
 			               add_dyn(ex_to<numeric>(itin2->coeff));
 			if (expair_needs_further_processing(itin1))
 				needs_further_processing = true;
 			must_copy = true;
 		} else {
-			if (!ex_to<numeric>(itin1->coeff).is_zero()) {
+			if (not itin1_c.is_zero() or itin1_c.is_parent_pos_char()) {
 				if (must_copy)
 					*itout = *itin1;
 				++itout;
@@ -1225,7 +1226,7 @@ void expairseq::combine_same_terms_sorted_seq()
 		}
 		++itin2;
 	}
-	if (!ex_to<numeric>(itin1->coeff).is_zero()) {
+	if (not itin1_c.is_zero() or itin1_c.is_parent_pos_char()) {
 		if (must_copy)
 			*itout = *itin1;
 		++itout;
```
The relevant ticket would be https://github.com/pynac/pynac/issues/77.



---

archive/issue_comments_326887.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. Developers acknowledge bug.\"",
    "created_at": "2015-06-26T15:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326887",
    "user": "https://github.com/rwst"
}
```

Changing upstream from "N/A" to "Reported upstream. Developers acknowledge bug."



---

archive/issue_comments_326888.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/bug_with_products_of_symbolic_variables_with_modular_integers\"",
    "created_at": "2015-06-30T13:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326888",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/bug_with_products_of_symbolic_variables_with_modular_integers"



---

archive/issue_comments_326889.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326889",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_events_067527.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "rename": {
        "from": "Bug with products of symbolic variables with modular integers",
        "to": "doctest symbolic modular integers fix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67527"
}
```



---

archive/issue_comments_326890.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326890",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_326891.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. Developers acknowledge bug.\" to \"N/A\"",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326891",
    "user": "https://github.com/rwst"
}
```

Changing upstream from "Reported upstream. Developers acknowledge bug." to "N/A"



---

archive/issue_comments_326892.json:
```json
{
    "body": "<a id='comment:16'></a>\nNew commits:\n|                                                                                                                                          |                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[6f9e551](https://github.com/sagemath/sagetrac-mirror/commit/6f9e551e2110aa700b29eee6f379ec93890d7ba8)|`18787: doctests`|",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326892",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'></a>
New commits:
|                                                                                                                                          |                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[6f9e551](https://github.com/sagemath/sagetrac-mirror/commit/6f9e551e2110aa700b29eee6f379ec93890d7ba8)|`18787: doctests`|



---

archive/issue_comments_326893.json:
```json
{
    "body": "Changing commit from \"\" to \"6f9e551e2110aa700b29eee6f379ec93890d7ba8\"",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326893",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "6f9e551e2110aa700b29eee6f379ec93890d7ba8"



---

archive/issue_comments_326894.json:
```json
{
    "body": "Changing dependencies from \"pynac-0.3.9.2\" to \"\"",
    "created_at": "2015-07-16T06:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326894",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "pynac-0.3.9.2" to ""



---

archive/issue_comments_326895.json:
```json
{
    "body": "<a id='comment:17'></a>\nWith Sage-6.8.rc0:\n\n```\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 2821, in sage.symbolic.expression.Expression._add_\nFailed example:\n    (A + 3*B)*Zmod(9)(6)\nExpected:\n    6*A\nGot:\n    0* + 6*A\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 2823, in sage.symbolic.expression.Expression._add_\nFailed example:\n    (3*A + 3*B)*Zmod(9)(6)\nExpected:\n    0\nGot:\n    0*\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 2825, in sage.symbolic.expression.Expression._add_\nFailed example:\n    (3*A + 3*B)*Zmod(9)(6)*A\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.expression.Expression._add_[24]>\", line 1, in <module>\n        (Integer(3)*A + Integer(3)*B)*Zmod(Integer(9))(Integer(6))*A\n      File \"sage/structure/element.pyx\", line 1849, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16581)\n        return (<RingElement>left)._mul_(<RingElement>right)\n      File \"sage/symbolic/expression.pyx\", line 3148, in sage.symbolic.expression.Expression._mul_ (build/cythonized/sage/symbolic/expression.cpp:19837)\n        x = gmul(left._gobj, _right._gobj)\n    OverflowError: numeric::div(): division by zero\n**********************************************************************\n```",
    "created_at": "2015-07-16T13:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326895",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
With Sage-6.8.rc0:

```
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 2821, in sage.symbolic.expression.Expression._add_
Failed example:
    (A + 3*B)*Zmod(9)(6)
Expected:
    6*A
Got:
    0* + 6*A
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 2823, in sage.symbolic.expression.Expression._add_
Failed example:
    (3*A + 3*B)*Zmod(9)(6)
Expected:
    0
Got:
    0*
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 2825, in sage.symbolic.expression.Expression._add_
Failed example:
    (3*A + 3*B)*Zmod(9)(6)*A
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression.Expression._add_[24]>", line 1, in <module>
        (Integer(3)*A + Integer(3)*B)*Zmod(Integer(9))(Integer(6))*A
      File "sage/structure/element.pyx", line 1849, in sage.structure.element.RingElement.__mul__ (build/cythonized/sage/structure/element.c:16581)
        return (<RingElement>left)._mul_(<RingElement>right)
      File "sage/symbolic/expression.pyx", line 3148, in sage.symbolic.expression.Expression._mul_ (build/cythonized/sage/symbolic/expression.cpp:19837)
        x = gmul(left._gobj, _right._gobj)
    OverflowError: numeric::div(): division by zero
**********************************************************************
```



---

archive/issue_comments_326896.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-16T13:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326896",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_326897.json:
```json
{
    "body": "<a id='comment:18'></a>\nAlso a detail: it's better style to use\n\n```\nsage: x = foo\n```\ninstead of\n\n```\nsage: x=foo\n```",
    "created_at": "2015-07-16T13:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Also a detail: it's better style to use

```
sage: x = foo
```
instead of

```
sage: x=foo
```



---

archive/issue_comments_326898.json:
```json
{
    "body": "<a id='comment:19'></a>\nSeems the backport from Pynac-0.4.2 missed something. When will C++11 be mandatory in Sage?",
    "created_at": "2015-07-16T13:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326898",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
Seems the backport from Pynac-0.4.2 missed something. When will C++11 be mandatory in Sage?



---

archive/issue_comments_326899.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [rws](#comment%3A19):\n> When will C++11 be mandatory in Sage?\n\nI think I already mentioned this: I recommend you write to sage-devel with this request.",
    "created_at": "2015-07-16T13:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326899",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [rws](#comment%3A19):
> When will C++11 be mandatory in Sage?

I think I already mentioned this: I recommend you write to sage-devel with this request.



---

archive/issue_comments_326900.json:
```json
{
    "body": "<a id='comment:21'></a>\nLet me add that the hard part will be to define the precise subset of C++11 that you need.\n\nIt's easy to require that the C++ compiler supports the `-std=c++0x` or `-std=c++11` option, but I don't know if that is sufficient.",
    "created_at": "2015-07-16T13:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326900",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Let me add that the hard part will be to define the precise subset of C++11 that you need.

It's easy to require that the C++ compiler supports the `-std=c++0x` or `-std=c++11` option, but I don't know if that is sufficient.



---

archive/issue_comments_326901.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [jdemeyer](#comment%3A21):\n> Let me add that the hard part will be to define the precise subset of C++11 that you need.\n\nWhy? We have already committed to gcc-4.6 in our conversation. For the other system without gcc there will have to be an Xcode version that has equivalent functionality. These two versions will be made the minimum. No other definition necessary.",
    "created_at": "2015-07-16T14:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326901",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Replying to [jdemeyer](#comment%3A21):
> Let me add that the hard part will be to define the precise subset of C++11 that you need.

Why? We have already committed to gcc-4.6 in our conversation. For the other system without gcc there will have to be an Xcode version that has equivalent functionality. These two versions will be made the minimum. No other definition necessary.



---

archive/issue_comments_326902.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [rws](#comment%3A22):\n> We have already committed to gcc-4.6 in our conversation\n\nReally? I understood that you were not sure if GCC 4.6 was in fact sufficient. But if you are, that's fine for me.\n\nNote that, for various reasons, we actually do not support GCC 4.6 in Sage, which would make GCC 4.7 the minimum.\n\nIf you're willing to go ahead with this, you should:\n1. write to `sage-devel` explaining why you want C++11 support and that this means requiring GCC 4.7.\n2. create a ticket for requiring C++11 and GCC 4.7 in Sage.\n3. create a ticket for upgrading Pynac to the version and make it depend on the ticket in 2.",
    "created_at": "2015-07-16T14:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326902",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [rws](#comment%3A22):
> We have already committed to gcc-4.6 in our conversation

Really? I understood that you were not sure if GCC 4.6 was in fact sufficient. But if you are, that's fine for me.

Note that, for various reasons, we actually do not support GCC 4.6 in Sage, which would make GCC 4.7 the minimum.

If you're willing to go ahead with this, you should:
1. write to `sage-devel` explaining why you want C++11 support and that this means requiring GCC 4.7.
2. create a ticket for requiring C++11 and GCC 4.7 in Sage.
3. create a ticket for upgrading Pynac to the version and make it depend on the ticket in 2.



---

archive/issue_events_067528.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-07-30T13:58:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67528"
}
```



---

archive/issue_comments_326903.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jdemeyer](#comment%3A17):\n> With Sage-6.8.rc0:\n> \n> ```\n> Got:\n>     0* + 6*A\n> Got:\n>     0*\n> ```\n\nFound it. The backport was indeed incomplete. Fix in pynac-0.3.9.3.",
    "created_at": "2015-07-30T13:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326903",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'></a>
Replying to [jdemeyer](#comment%3A17):
> With Sage-6.8.rc0:
> 
> ```
> Got:
>     0* + 6*A
> Got:
>     0*
> ```

Found it. The backport was indeed incomplete. Fix in pynac-0.3.9.3.



---

archive/issue_comments_326904.json:
```json
{
    "body": "Changing dependencies from \"\" to \"pynac-0.3.9.3/-0.4.2\"",
    "created_at": "2015-07-30T13:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326904",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "pynac-0.3.9.3/-0.4.2"



---

archive/issue_comments_326905.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-02T09:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326905",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_326906.json:
```json
{
    "body": "Changing dependencies from \"pynac-0.3.9.3/-0.4.2\" to \"#18980\"",
    "created_at": "2015-08-02T09:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326906",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "pynac-0.3.9.3/-0.4.2" to "#18980"



---

archive/issue_events_067529.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-08-20T13:46:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67529"
}
```



---

archive/issue_events_067530.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-08-20T13:46:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67530"
}
```



---

archive/issue_comments_326907.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-09-19T03:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326907",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_326908.json:
```json
{
    "body": "<a id='comment:27'></a>\nWhy is it in sage-pending?\n\nWhat about the following (inspired from [comment:6](#comment%3A6)\n\n```\nsage: f(x) = Zmod(7)(3) * x**2 + Zmod(9)(3) * x**3\nsage: f(1)\n** BOOM **\n```\nwhile\n\n```\nsage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3\nsage: f(1)\n2\n```\n\nVincent",
    "created_at": "2015-09-19T03:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326908",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>
Why is it in sage-pending?

What about the following (inspired from [comment:6](#comment%3A6)

```
sage: f(x) = Zmod(7)(3) * x**2 + Zmod(9)(3) * x**3
sage: f(1)
** BOOM **
```
while

```
sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3
sage: f(1)
2
```

Vincent



---

archive/issue_comments_326909.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-09-19T06:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326909",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_326910.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [vdelecroix](#comment%3A27):\n> Why is it in sage-pending?\n\nI didn't want patchbot on it.",
    "created_at": "2015-09-19T06:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326910",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Replying to [vdelecroix](#comment%3A27):
> Why is it in sage-pending?

I didn't want patchbot on it.



---

archive/issue_comments_326911.json:
```json
{
    "body": "Changing dependencies from \"#18980\" to \"\"",
    "created_at": "2015-09-19T06:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326911",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#18980" to ""



---

archive/issue_comments_326912.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,24 +1,11 @@\n-As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)\n+> {{{\n+> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3\n+> sage: f(1)\n+> 2\n+> sage: Zmod(7)(1) + Zmod(9)(1)\n \n-```\n-sage: _ = var('A,B')\n-sage: (A + 3*B)*Zmod(9)(6)\n-0*B\n-```\n+...\n+TypeError: unsupported operand parent(s) for '+': 'Ring of integers modulo 7' and 'Ring of integers modulo 9'\n+> }}}\n \n-while the result should be `6*A`.\n \n-It seems that the internal state of these objects is really messed up:\n-\n-```\n-sage: _ = var('A,B')\n-sage: (3*A + 3*B)*Zmod(9)(6)    # Yes, the output is really empty!\n-\n-sage: (3*A + 3*B)*Zmod(9)(6)*A  \n-------------------------------------------------------------------------\n-Unhandled SIGSEGV: A segmentation fault occurred in Sage.\n-This probably occurred because a *compiled* component of Sage has a bug\n-in it and is not properly wrapped with sig_on(), sig_off().\n-Sage will now terminate.\n-------------------------------------------------------------------------\n-```\n``````\n",
    "created_at": "2015-09-19T06:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326912",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,24 +1,11 @@
-As reported on [this ask question](http://ask.sagemath.org/question/27196/multiplying-matrices-with-different-parents/)
+> {{{
+> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3
+> sage: f(1)
+> 2
+> sage: Zmod(7)(1) + Zmod(9)(1)
 
-```
-sage: _ = var('A,B')
-sage: (A + 3*B)*Zmod(9)(6)
-0*B
-```
+...
+TypeError: unsupported operand parent(s) for '+': 'Ring of integers modulo 7' and 'Ring of integers modulo 9'
+> }}}
 
-while the result should be `6*A`.
 
-It seems that the internal state of these objects is really messed up:
-
-```
-sage: _ = var('A,B')
-sage: (3*A + 3*B)*Zmod(9)(6)    # Yes, the output is really empty!
-
-sage: (3*A + 3*B)*Zmod(9)(6)*A  
-------------------------------------------------------------------------
-Unhandled SIGSEGV: A segmentation fault occurred in Sage.
-This probably occurred because a *compiled* component of Sage has a bug
-in it and is not properly wrapped with sig_on(), sig_off().
-Sage will now terminate.
-------------------------------------------------------------------------
-```
``````




---

archive/issue_events_067531.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-09-19T06:18:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67531"
}
```



---

archive/issue_events_067532.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-09-19T06:18:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67532"
}
```



---

archive/issue_events_067533.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "rename": {
        "from": "doctest symbolic modular integers fix",
        "to": "symbolic modular integers still broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67533"
}
```



---

archive/issue_comments_326913.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [vdelecroix](#comment%3A27):\n> What about the following (inspired from [comment:6](#comment%3A6)\n> \n> ```\n> sage: f(x) = Zmod(7)(3) * x**2 + Zmod(9)(3) * x**3\n> sage: f(1)\n> ** BOOM **\n> ```\n> while\n> \n> ```\n> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3\n> sage: f(1)\n> 2\n> ```\n\n\nThis both now gives a `TypeError` in pynac master, equivalently to `GF(7)(1) + GF(9)(1)` and `GF(7)(3) + GF(9)(3)`.\n\nThe ticket should doctest this as soon as pynac is upgraded to 0.6.4",
    "created_at": "2016-03-07T07:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326913",
    "user": "https://github.com/rwst"
}
```

<a id='comment:30'></a>
Replying to [vdelecroix](#comment%3A27):
> What about the following (inspired from [comment:6](#comment%3A6)
> 
> ```
> sage: f(x) = Zmod(7)(3) * x**2 + Zmod(9)(3) * x**3
> sage: f(1)
> ** BOOM **
> ```
> while
> 
> ```
> sage: f(x) = Zmod(7)(1) * x**2 + Zmod(9)(1) * x**3
> sage: f(1)
> 2
> ```


This both now gives a `TypeError` in pynac master, equivalently to `GF(7)(1) + GF(9)(1)` and `GF(7)(3) + GF(9)(3)`.

The ticket should doctest this as soon as pynac is upgraded to 0.6.4



---

archive/issue_comments_326914.json:
```json
{
    "body": "<a id='comment:31'></a>\nI believe this is resolved in #21391.",
    "created_at": "2017-01-16T07:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326914",
    "user": "https://github.com/rwst"
}
```

<a id='comment:31'></a>
I believe this is resolved in #21391.



---

archive/issue_comments_326915.json:
```json
{
    "body": "Changing commit from \"6f9e551e2110aa700b29eee6f379ec93890d7ba8\" to \"\"",
    "created_at": "2017-01-16T07:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326915",
    "user": "https://github.com/rwst"
}
```

Changing commit from "6f9e551e2110aa700b29eee6f379ec93890d7ba8" to ""



---

archive/issue_comments_326916.json:
```json
{
    "body": "Changing branch from \"u/rws/bug_with_products_of_symbolic_variables_with_modular_integers\" to \"\"",
    "created_at": "2017-01-16T07:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326916",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/bug_with_products_of_symbolic_variables_with_modular_integers" to ""



---

archive/issue_comments_326917.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-16T07:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326917",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_326918.json:
```json
{
    "body": "Changing author from \"Ralf Stephan\" to \"\"",
    "created_at": "2017-01-16T07:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326918",
    "user": "https://github.com/rwst"
}
```

Changing author from "Ralf Stephan" to ""



---

archive/issue_events_067534.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T07:14:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67534"
}
```



---

archive/issue_events_067535.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-16T07:14:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67535"
}
```



---

archive/issue_events_067536.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tmonteil",
    "created_at": "2017-03-06T22:37:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67536"
}
```



---

archive/issue_events_067537.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tmonteil",
    "created_at": "2017-03-06T22:37:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67537"
}
```



---

archive/issue_comments_326919.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [rws](#comment%3A31):\n> I believe this is resolved in #21391.\n\n\nIt seems inteed to works better now. But why not adding the tests discussed on the current ticket as you did previously ?",
    "created_at": "2017-03-06T22:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326919",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:32'></a>
Replying to [rws](#comment%3A31):
> I believe this is resolved in #21391.


It seems inteed to works better now. But why not adding the tests discussed on the current ticket as you did previously ?



---

archive/issue_comments_326920.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-03-06T22:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326920",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_326921.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/symbolic_modular_integers_still_broken\"",
    "created_at": "2017-03-07T14:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326921",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/symbolic_modular_integers_still_broken"



---

archive/issue_comments_326922.json:
```json
{
    "body": "<a id='comment:34'></a>\nMade dependent on #21391 to prevent merge conflicts.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[7147699](https://github.com/sagemath/sagetrac-mirror/commit/7147699e66955b2a130a871b97886ec5af3a665d)|`21391: Disallow mixing of pos.char.ring elements and symbolic variables`|\n|[dd6ad96](https://github.com/sagemath/sagetrac-mirror/commit/dd6ad96992067f48fdd3c8982c267d6f67b434fd)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|\n|[03ccd07](https://github.com/sagemath/sagetrac-mirror/commit/03ccd07aba29c84e4510b41811567ae71c9d1151)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|\n|[f2933cc](https://github.com/sagemath/sagetrac-mirror/commit/f2933cc95f5ace319d93038c92bd92e9b6e3e3ac)|`21391: introduce ex.has_finite_parent()`|\n|[333db3c](https://github.com/sagemath/sagetrac-mirror/commit/333db3c0de1e767304a8b9be2e2894038d0b3cbd)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|\n|[8700e00](https://github.com/sagemath/sagetrac-mirror/commit/8700e0048e85cbd330ef1c2cc739708893b6d599)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|\n|[c7f8ad2](https://github.com/sagemath/sagetrac-mirror/commit/c7f8ad21a2d23d2cf33594b84224ece11a459a23)|`21391: to prevent fails give the coordinate functions an explicit characteristic`|\n|[9430605](https://github.com/sagemath/sagetrac-mirror/commit/9430605a17f8793efff5453966fea424e28423a0)|`21391: doctest fixes`|\n|[be9ec4e](https://github.com/sagemath/sagetrac-mirror/commit/be9ec4e97557a2ff7ed682ed62c2101d084de498)|`18787: doctest`|",
    "created_at": "2017-03-07T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326922",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
Made dependent on #21391 to prevent merge conflicts.

---
New commits:
|                                                                                                                                          |                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[7147699](https://github.com/sagemath/sagetrac-mirror/commit/7147699e66955b2a130a871b97886ec5af3a665d)|`21391: Disallow mixing of pos.char.ring elements and symbolic variables`|
|[dd6ad96](https://github.com/sagemath/sagetrac-mirror/commit/dd6ad96992067f48fdd3c8982c267d6f67b434fd)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|
|[03ccd07](https://github.com/sagemath/sagetrac-mirror/commit/03ccd07aba29c84e4510b41811567ae71c9d1151)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|
|[f2933cc](https://github.com/sagemath/sagetrac-mirror/commit/f2933cc95f5ace319d93038c92bd92e9b6e3e3ac)|`21391: introduce ex.has_finite_parent()`|
|[333db3c](https://github.com/sagemath/sagetrac-mirror/commit/333db3c0de1e767304a8b9be2e2894038d0b3cbd)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|
|[8700e00](https://github.com/sagemath/sagetrac-mirror/commit/8700e0048e85cbd330ef1c2cc739708893b6d599)|`Merge branch 'develop' into t/21391/disallow_mixing_of_pos_char_ring_elements_and_symbolic_variables`|
|[c7f8ad2](https://github.com/sagemath/sagetrac-mirror/commit/c7f8ad21a2d23d2cf33594b84224ece11a459a23)|`21391: to prevent fails give the coordinate functions an explicit characteristic`|
|[9430605](https://github.com/sagemath/sagetrac-mirror/commit/9430605a17f8793efff5453966fea424e28423a0)|`21391: doctest fixes`|
|[be9ec4e](https://github.com/sagemath/sagetrac-mirror/commit/be9ec4e97557a2ff7ed682ed62c2101d084de498)|`18787: doctest`|



---

archive/issue_comments_326923.json:
```json
{
    "body": "Changing commit from \"\" to \"be9ec4e97557a2ff7ed682ed62c2101d084de498\"",
    "created_at": "2017-03-07T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326923",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "be9ec4e97557a2ff7ed682ed62c2101d084de498"



---

archive/issue_comments_326924.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-03-07T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326924",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_326925.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-03-07T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326925",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_326926.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21391\"",
    "created_at": "2017-03-07T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326926",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#21391"



---

archive/issue_comments_326927.json:
```json
{
    "body": "<a id='comment:35'></a>\nDo the people on this ticket agree that #24072 solves this ticket as is claimed there?",
    "created_at": "2017-10-25T10:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326927",
    "user": "https://github.com/koffie"
}
```

<a id='comment:35'></a>
Do the people on this ticket agree that #24072 solves this ticket as is claimed there?



---

archive/issue_events_067538.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T12:44:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67538"
}
```



---

archive/issue_events_067539.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-25T12:44:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67539"
}
```



---

archive/issue_comments_326928.json:
```json
{
    "body": "<a id='comment:36'></a>\nAgree.",
    "created_at": "2017-10-25T12:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326928",
    "user": "https://github.com/rwst"
}
```

<a id='comment:36'></a>
Agree.



---

archive/issue_comments_326929.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-10-25T22:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326929",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Ralf Stephan"



---

archive/issue_comments_326930.json:
```json
{
    "body": "Changing author from \"Ralf Stephan\" to \"\"",
    "created_at": "2017-10-25T22:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326930",
    "user": "https://github.com/tscrim"
}
```

Changing author from "Ralf Stephan" to ""



---

archive/issue_comments_326931.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-25T22:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326931",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_067540.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18787#event-67540"
}
```



---

archive/issue_comments_326932.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18787#issuecomment-326932",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix
