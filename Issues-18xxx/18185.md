# Issue 18185: Clean the Graph/DiGraph constructors

archive/issues_017948.json:
```json
{
    "body": "The Graph and DiGraph constructor are rather long, and rather messy, as they are meant to accept a LOT of different inputs.\n\nThe point of this branch is to simplify its logic, in order to be able to split it into subfunctions later.\n\nHere is the current logic:\n1) Detect and set the 'format' if it was not specified\n2) For every possible format, define whether the graph should allow loops/multiedges\n3) Pick a data structure (i.e. backend) and create it\n4) For every possible format, add vertices and edges\n\nBesides local fixes and modifications, this branch moves '3' right after '1'. Then, '2' and '4' are merged so that we only enumerate all possible formats once.\n\nI tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.\n\nCC:  @nathanncohen sage-combinat tmonteil @videlec @dcoudert @darijgr\n\nBranch/Commit: 6afd117df805ce5b42c8019069824ed0cd0d277f\n\nReviewer: David Coudert\n\nAuthor: Nathann Cohen\n\nDependencies: #18067\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18185\n\n",
    "closed_at": "2015-04-29T03:13:43Z",
    "created_at": "2015-04-14T10:46:33Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Clean the Graph/DiGraph constructors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18185",
    "user": "https://github.com/nathanncohen"
}
```
The Graph and DiGraph constructor are rather long, and rather messy, as they are meant to accept a LOT of different inputs.

The point of this branch is to simplify its logic, in order to be able to split it into subfunctions later.

Here is the current logic:
1) Detect and set the 'format' if it was not specified
2) For every possible format, define whether the graph should allow loops/multiedges
3) Pick a data structure (i.e. backend) and create it
4) For every possible format, add vertices and edges

Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '2' and '4' are merged so that we only enumerate all possible formats once.

I tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.

CC:  @nathanncohen sage-combinat tmonteil @videlec @dcoudert @darijgr

Branch/Commit: 6afd117df805ce5b42c8019069824ed0cd0d277f

Reviewer: David Coudert

Author: Nathann Cohen

Dependencies: #18067

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18185





---

archive/issue_comments_314894.json:
```json
{
    "body": "Changing commit from \"\" to \"279b141566b69d149e89992dba2fac74399815c9\"",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314894",
    "user": "https://github.com/nathanncohen"
}
```

Changing commit from "" to "279b141566b69d149e89992dba2fac74399815c9"



---

archive/issue_comments_314895.json:
```json
{
    "body": "Changing branch from \"\" to \"public/18185\"",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314895",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "" to "public/18185"



---

archive/issue_comments_314896.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314896",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314897.json:
```json
{
    "body": "<a id='comment:1'></a>Last 10 new commits:",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314897",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>Last 10 new commits:



---

archive/issue_comments_314898.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-15T10:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314899.json:
```json
{
    "body": "Changing commit from \"279b141566b69d149e89992dba2fac74399815c9\" to \"4b15f0f7f1cebd6f858e49ae2bf952dec6a2544f\"",
    "created_at": "2015-04-15T10:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "279b141566b69d149e89992dba2fac74399815c9" to "4b15f0f7f1cebd6f858e49ae2bf952dec6a2544f"



---

archive/issue_comments_314900.json:
```json
{
    "body": "<a id='comment:3'></a>(rebased on latest beta)",
    "created_at": "2015-04-15T10:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314900",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>(rebased on latest beta)



---

archive/issue_comments_314901.json:
```json
{
    "body": "<a id='comment:4'></a>syntax error (missing : see patchbot report )\n\n elif format == 'NX'",
    "created_at": "2015-04-17T06:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314901",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>syntax error (missing : see patchbot report )

 elif format == 'NX'



---

archive/issue_comments_314902.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-17T06:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314902",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314903.json:
```json
{
    "body": "Changing commit from \"4b15f0f7f1cebd6f858e49ae2bf952dec6a2544f\" to \"80456d80dafe26adf7ac95e71311c767ca5e866b\"",
    "created_at": "2015-04-17T06:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4b15f0f7f1cebd6f858e49ae2bf952dec6a2544f" to "80456d80dafe26adf7ac95e71311c767ca5e866b"



---

archive/issue_comments_314904.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T06:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314905.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-17T06:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314905",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314906.json:
```json
{
    "body": "<a id='comment:7'></a>**many** doctests are failing, see patchbot report..",
    "created_at": "2015-04-17T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314906",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>**many** doctests are failing, see patchbot report..



---

archive/issue_comments_314907.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-17T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314907",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314908.json:
```json
{
    "body": "<a id='comment:8'></a>Funny. No problem in graphs/ and 1000 combinat modules break. Let's see...",
    "created_at": "2015-04-17T08:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314908",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>Funny. No problem in graphs/ and 1000 combinat modules break. Let's see...



---

archive/issue_comments_314909.json:
```json
{
    "body": "Changing commit from \"80456d80dafe26adf7ac95e71311c767ca5e866b\" to \"f8c9f8ef8662324dee8f1bc403968fa5b2d168aa\"",
    "created_at": "2015-04-17T08:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "80456d80dafe26adf7ac95e71311c767ca5e866b" to "f8c9f8ef8662324dee8f1bc403968fa5b2d168aa"



---

archive/issue_comments_314910.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T08:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314911.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-17T08:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314911",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314912.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,6 @@\n 3) Pick a data structure (i.e. backend) and create it\n 4) For every possible format, add vertices and edges\n \n-Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '3' and '4' are merged so that we only enumerate all possible formats once.\n+Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '2' and '4' are merged so that we only enumerate all possible formats once.\n \n I tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.\n``````\n",
    "created_at": "2015-04-17T09:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314912",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,6 @@
 3) Pick a data structure (i.e. backend) and create it
 4) For every possible format, add vertices and edges
 
-Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '3' and '4' are merged so that we only enumerate all possible formats once.
+Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '2' and '4' are merged so that we only enumerate all possible formats once.
 
 I tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.
``````




---

archive/issue_events_051436.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-17T11:50:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18185#event-51436"
}
```



---

archive/issue_comments_314913.json:
```json
{
    "body": "<a id='comment:12'></a>remains 4 doctests failure, see patchbot report",
    "created_at": "2015-04-17T11:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314913",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>remains 4 doctests failure, see patchbot report



---

archive/issue_comments_314914.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314915.json:
```json
{
    "body": "Changing commit from \"f8c9f8ef8662324dee8f1bc403968fa5b2d168aa\" to \"6afd117df805ce5b42c8019069824ed0cd0d277f\"",
    "created_at": "2015-04-17T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f8c9f8ef8662324dee8f1bc403968fa5b2d168aa" to "6afd117df805ce5b42c8019069824ed0cd0d277f"



---

archive/issue_comments_314916.json:
```json
{
    "body": "<a id='comment:14'></a>Heyyyyyyy guys. It would be cool if you could help me with this ticket, because there is not much one could do with the Graph class while this is waiting for a review (and so subject to changes).\n\nThanks,\n\nNathann",
    "created_at": "2015-04-27T16:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314916",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Heyyyyyyy guys. It would be cool if you could help me with this ticket, because there is not much one could do with the Graph class while this is waiting for a review (and so subject to changes).

Thanks,

Nathann



---

archive/issue_comments_314917.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314917",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314918.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2015-04-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314918",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_314919.json:
```json
{
    "body": "<a id='comment:15'></a>Hello,\n\nAlthough the graph and digraph constructor remains hard to read (very long), the modifications you did are very helpful.\n\nThe doc build properly, and I have no doctest error.\nGood to go.\n\nDavid.",
    "created_at": "2015-04-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314919",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>Hello,

Although the graph and digraph constructor remains hard to read (very long), the modifications you did are very helpful.

The doc build properly, and I have no doctest error.
Good to go.

David.



---

archive/issue_comments_314920.json:
```json
{
    "body": "<a id='comment:16'></a>Wouhouuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu !!\n\nThanks for that review !!!!!\n\nNathann",
    "created_at": "2015-04-28T07:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314920",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>Wouhouuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu !!

Thanks for that review !!!!!

Nathann



---

archive/issue_comments_314921.json:
```json
{
    "body": "<a id='comment:17'></a>Thank you, both of you!",
    "created_at": "2015-04-28T14:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314921",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:17'></a>Thank you, both of you!



---

archive/issue_events_051437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-29T03:13:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18185#event-51437"
}
```



---

archive/issue_comments_314922.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-29T03:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314922",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_314923.json:
```json
{
    "body": "Changing branch from \"public/18185\" to \"6afd117df805ce5b42c8019069824ed0cd0d277f\"",
    "created_at": "2015-04-29T03:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18185#issuecomment-314923",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/18185" to "6afd117df805ce5b42c8019069824ed0cd0d277f"
