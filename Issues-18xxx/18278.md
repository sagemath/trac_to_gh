# Issue 18278: Variable to non-integral power for integer polynomials (using Flint) is broken

archive/issues_018041.json:
```json
{
    "body": "Currently:\n\n```\nsage: R.<x> = ZZ[]\nsage: x^(1/2)\n1\n```\n\nI correct to\n\n```\nsage: R.<x> = ZZ[]\nsage: x^(1/2)\nTraceback (most recent call last):\n...\nTypeError: non-integral exponents not supported\n```\n\nthat is consistent with the results in other polynomial rings.\n\n**Keywords:** integer polynomials, exponentiation\n\n**Branch/Commit:** [7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Bruno Grenet\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18278\n\n",
    "closed_at": "2015-05-05T00:32:30Z",
    "created_at": "2015-04-22T13:30:23Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Variable to non-integral power for integer polynomials (using Flint) is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18278",
    "user": "https://github.com/bgrenet"
}
```
Currently:

```
sage: R.<x> = ZZ[]
sage: x^(1/2)
1
```

I correct to

```
sage: R.<x> = ZZ[]
sage: x^(1/2)
Traceback (most recent call last):
...
TypeError: non-integral exponents not supported
```

that is consistent with the results in other polynomial rings.

**Keywords:** integer polynomials, exponentiation

**Branch/Commit:** [7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)

**Reviewer:** Jeroen Demeyer

**Author:** Bruno Grenet

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/18278





---

archive/issue_comments_321164.json:
```json
{
    "body": "**Branch:** [u/bruno/ticket/non_integral_pow](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/ticket/non_integral_pow)",
    "created_at": "2015-04-22T13:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321164",
    "user": "https://github.com/bgrenet"
}
```

**Branch:** [u/bruno/ticket/non_integral_pow](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/ticket/non_integral_pow)



---

archive/issue_comments_321165.json:
```json
{
    "body": "**Commit:** [49dc92ba66a2196af71ba62ef475e0403e43ac11](https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11)",
    "created_at": "2015-04-22T13:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321165",
    "user": "https://github.com/bgrenet"
}
```

**Commit:** [49dc92ba66a2196af71ba62ef475e0403e43ac11](https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11)



---

archive/issue_comments_321166.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11\">49dc92b</a></td><td><code>Non integral exponents for variable is not permitted</code></td></tr></table>\n",
    "created_at": "2015-04-22T13:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321166",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11">49dc92b</a></td><td><code>Non integral exponents for variable is not permitted</code></td></tr></table>




---

archive/issue_comments_321167.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2015-04-22T13:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321167",
    "user": "https://github.com/bgrenet"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_321168.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-05-03T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321168",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_321169.json:
```json
{
    "body": "<a id='comment:3'></a>\nSalut Bruno,\n\n1. You introduced trailing whitespaces, please remove them.\n\n2. Why would you want to do that\n\n```\ntry:\n    nn = PyNumber_AsSsize_t (exp, OverflowError)\nexcept TypeError:\n   raise TypeError(\"non-integral exponents not supported\")\n```\n  the problem comes from the fact that you can cast rationals to Python int\n\n```\nsage: int(2/3)\n0\n```\n  I would very much prefer\n\n```\ncdef long u = exp\nif exp != u:\n    raise TypeError(\"...\")\n```\n\nVincent",
    "created_at": "2015-05-03T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321169",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Salut Bruno,

1. You introduced trailing whitespaces, please remove them.

2. Why would you want to do that

```
try:
    nn = PyNumber_AsSsize_t (exp, OverflowError)
except TypeError:
   raise TypeError("non-integral exponents not supported")
```
  the problem comes from the fact that you can cast rationals to Python int

```
sage: int(2/3)
0
```
  I would very much prefer

```
cdef long u = exp
if exp != u:
    raise TypeError("...")
```

Vincent



---

archive/issue_comments_321170.json:
```json
{
    "body": "<a id='comment:4'></a>\nActually, the proper solution is here\n\n    https://groups.google.com/forum/#!topic/sage-support/0ATjCgQlq4c",
    "created_at": "2015-05-03T20:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321170",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Actually, the proper solution is here

    https://groups.google.com/forum/#!topic/sage-support/0ATjCgQlq4c



---

archive/issue_comments_321171.json:
```json
{
    "body": "**Changing commit** from \"[49dc92ba66a2196af71ba62ef475e0403e43ac11](https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11)\" to \"[4ade279cb4e0bf5965f907ff498168967cd23add](https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add)\".",
    "created_at": "2015-05-04T09:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[49dc92ba66a2196af71ba62ef475e0403e43ac11](https://github.com/sagemath/sagetrac-mirror/commit/49dc92ba66a2196af71ba62ef475e0403e43ac11)" to "[4ade279cb4e0bf5965f907ff498168967cd23add](https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add)".



---

archive/issue_comments_321172.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add\">4ade279</a></td><td><code>Use PyNumber_Index</code></td></tr></table>\n",
    "created_at": "2015-05-04T09:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add">4ade279</a></td><td><code>Use PyNumber_Index</code></td></tr></table>




---

archive/issue_comments_321173.json:
```json
{
    "body": "<a id='comment:6'></a>\nSalut Vincent,\n\nI made the changes you propose. For the use of `PyNumber_AsSsize_t`, I actually borrowed this code from `sage/rings/polynomial/polynomial_rational_flint.pyx`. Should I use this ticket to change the test in this file too?",
    "created_at": "2015-05-04T09:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321173",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:6'></a>
Salut Vincent,

I made the changes you propose. For the use of `PyNumber_AsSsize_t`, I actually borrowed this code from `sage/rings/polynomial/polynomial_rational_flint.pyx`. Should I use this ticket to change the test in this file too?



---

archive/issue_comments_321174.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-05-04T09:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321174",
    "user": "https://github.com/bgrenet"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_321175.json:
```json
{
    "body": "<a id='comment:7'></a>\nDo you really need this?\n\n```\nexcept TypeError:\n    raise TypeError(\"non-integral exponents not supported\")\n```\n\nI have a general dislike for code of the form\n\n```\nexcept E:\n    raise E(...)\n```",
    "created_at": "2015-05-04T09:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321175",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Do you really need this?

```
except TypeError:
    raise TypeError("non-integral exponents not supported")
```

I have a general dislike for code of the form

```
except E:
    raise E(...)
```



---

archive/issue_comments_321176.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jdemeyer](#comment%3A7):\n> Do you really need this?\n\n\nIt is not needed indeed, it simply gives a more specific error message. But it may not be worth adding these lines.",
    "created_at": "2015-05-04T09:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321176",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:8'></a>
Replying to [jdemeyer](#comment%3A7):
> Do you really need this?


It is not needed indeed, it simply gives a more specific error message. But it may not be worth adding these lines.



---

archive/issue_comments_321177.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [bruno](#comment%3A8):\n> Replying to [jdemeyer](#comment%3A7):\n> > Do you really need this?\n\n> \n> It is not needed indeed, it simply gives a more specific error message\n\n...I would say a *less specific* error message, since you throw away all information which is contained in the original `TypeError`.",
    "created_at": "2015-05-04T10:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321177",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [bruno](#comment%3A8):
> Replying to [jdemeyer](#comment%3A7):
> > Do you really need this?

> 
> It is not needed indeed, it simply gives a more specific error message

...I would say a *less specific* error message, since you throw away all information which is contained in the original `TypeError`.



---

archive/issue_comments_321178.json:
```json
{
    "body": "<a id='comment:10'></a>\nMy guess is that the code using `PyNumber_Index()` is slightly faster than `PyNumber_AsSsize_t()`. Also, `PyNumber_Index()` is more general, since you don't need the result to be a `Py_ssize_t`. But really, the difference between these 2 functions is very small.",
    "created_at": "2015-05-04T10:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321178",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
My guess is that the code using `PyNumber_Index()` is slightly faster than `PyNumber_AsSsize_t()`. Also, `PyNumber_Index()` is more general, since you don't need the result to be a `Py_ssize_t`. But really, the difference between these 2 functions is very small.



---

archive/issue_comments_321179.json:
```json
{
    "body": "**Changing commit** from \"[4ade279cb4e0bf5965f907ff498168967cd23add](https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add)\" to \"[02f6ee1532e11b2acc0113e55563f1ce65067ad7](https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7)\".",
    "created_at": "2015-05-04T10:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4ade279cb4e0bf5965f907ff498168967cd23add](https://github.com/sagemath/sagetrac-mirror/commit/4ade279cb4e0bf5965f907ff498168967cd23add)" to "[02f6ee1532e11b2acc0113e55563f1ce65067ad7](https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7)".



---

archive/issue_comments_321180.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7\">02f6ee1</a></td><td><code>Remove try ... except</code></td></tr></table>\n",
    "created_at": "2015-05-04T10:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7">02f6ee1</a></td><td><code>Remove try ... except</code></td></tr></table>




---

archive/issue_comments_321181.json:
```json
{
    "body": "<a id='comment:12'></a>\nDon't forget to update doctests.",
    "created_at": "2015-05-04T10:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321181",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Don't forget to update doctests.



---

archive/issue_comments_321182.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-05-04T10:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321182",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_321183.json:
```json
{
    "body": "<a id='comment:13'></a>\nI would also like to see a doctest for exponent overflow:\n\n```\nsage: x^(2^100)\n```",
    "created_at": "2015-05-04T10:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321183",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
I would also like to see a doctest for exponent overflow:

```
sage: x^(2^100)
```



---

archive/issue_comments_321184.json:
```json
{
    "body": "**Changing commit** from \"[02f6ee1532e11b2acc0113e55563f1ce65067ad7](https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7)\" to \"[7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)\".",
    "created_at": "2015-05-04T11:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[02f6ee1532e11b2acc0113e55563f1ce65067ad7](https://github.com/sagemath/sagetrac-mirror/commit/02f6ee1532e11b2acc0113e55563f1ce65067ad7)" to "[7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)".



---

archive/issue_comments_321185.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e\">7d0bc5c</a></td><td><code>Doctests</code></td></tr></table>\n",
    "created_at": "2015-05-04T11:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e">7d0bc5c</a></td><td><code>Doctests</code></td></tr></table>




---

archive/issue_comments_321186.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2015-05-04T11:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321186",
    "user": "https://github.com/bgrenet"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_321187.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2015-05-04T12:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321187",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_321188.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2015-05-04T12:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321188",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_321189.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks Vincent and Jeroen for your help!",
    "created_at": "2015-05-04T12:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321189",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:17'></a>
Thanks Vincent and Jeroen for your help!



---

archive/issue_events_058689.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-05T00:32:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18278#event-58689"
}
```



---

archive/issue_comments_321190.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2015-05-05T00:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321190",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_321191.json:
```json
{
    "body": "**Changing branch** from \"[u/bruno/ticket/non_integral_pow](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/ticket/non_integral_pow)\" to \"[7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)\".",
    "created_at": "2015-05-05T00:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18278#issuecomment-321191",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/bruno/ticket/non_integral_pow](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/ticket/non_integral_pow)" to "[7d0bc5c99228b11b9cf1d3d180edaeed2d34343e](https://github.com/sagemath/sagetrac-mirror/commit/7d0bc5c99228b11b9cf1d3d180edaeed2d34343e)".
