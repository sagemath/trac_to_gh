# Issue 18266: Conversion from Sage polynomial to gap/libgap

archive/issues_018029.json:
```json
{
    "body": "It is not possible to use (in a straightforward way) univariate polynomial in libgap\n\n```\nsage: R.<x> = ZZ[]\nsage: libgap(x^5+2*x+1)\nTraceback (most recent call last):\n...\nValueError: libGAP: Error, Variable: 'x' must have a value\n```\nAnd multivariate polynomials with either gap or libgap\n\n```\nsage: R.<x,y> = ZZ[]\nsage: gap(x+y)\nTraceback (most recent call last):\n...\nTypeError: Gap produced error output\nsage: libgap(x+y)\nTraceback (most recent call last):\n...\nValueError: libGAP: Error, Variable: 'x' must have a value\n```\nThe above ticket (partially based on #2420) implement the above conversions.\n\nNote: The conversion from gap/libgap to Sage does not work as well and will be dealt with in #21020.\n\n**CC:**  @vbraun @jplab\n\n**Branch/Commit:** [f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/18266\n\n",
    "closed_at": "2016-08-15T18:27:16Z",
    "created_at": "2015-04-21T12:46:26Z",
    "labels": [
        "component: interfaces",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Conversion from Sage polynomial to gap/libgap",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18266",
    "user": "https://github.com/videlec"
}
```
It is not possible to use (in a straightforward way) univariate polynomial in libgap

```
sage: R.<x> = ZZ[]
sage: libgap(x^5+2*x+1)
Traceback (most recent call last):
...
ValueError: libGAP: Error, Variable: 'x' must have a value
```
And multivariate polynomials with either gap or libgap

```
sage: R.<x,y> = ZZ[]
sage: gap(x+y)
Traceback (most recent call last):
...
TypeError: Gap produced error output
sage: libgap(x+y)
Traceback (most recent call last):
...
ValueError: libGAP: Error, Variable: 'x' must have a value
```
The above ticket (partially based on #2420) implement the above conversions.

Note: The conversion from gap/libgap to Sage does not work as well and will be dealt with in #21020.

**CC:**  @vbraun @jplab

**Branch/Commit:** [f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)

**Reviewer:** Travis Scrimshaw

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/18266





---

archive/issue_comments_252963.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942\">f1b8bcd</a></td><td><code>Trac 18266: Sage polynomial -> gap/libgap polynomial</code></td></tr></table>\n",
    "created_at": "2016-07-13T20:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252963",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942">f1b8bcd</a></td><td><code>Trac 18266: Sage polynomial -> gap/libgap polynomial</code></td></tr></table>




---

archive/issue_comments_252964.json:
```json
{
    "body": "**Commit:** [f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)",
    "created_at": "2016-07-13T20:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252964",
    "user": "https://github.com/videlec"
}
```

**Commit:** [f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)



---

archive/issue_events_163968.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T20:17:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163968"
}
```



---

archive/issue_events_163969.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T20:17:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163969"
}
```



---

archive/issue_comments_252965.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/18266](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18266)",
    "created_at": "2016-07-13T20:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252965",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/18266](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18266)



---

archive/issue_comments_252966.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,25 @@\n-Currently sage is not able to convert back polynomials from libgap\n+It is not possible to use (in a straightforward way) univariate polynomial in libgap\n \n ```\n-sage: libgap.MinimalPolynomial(QQ, libgap.eval(\"E(3)\"))\n-x_1^2+x_1+1\n-sage: p = libgap.MinimalPolynomial(QQ, libgap.eval(\"E(3)\"))\n-sage: p.sage()\n+sage: R.<x> = ZZ[]\n+sage: libgap(x^5+2*x+1)\n Traceback (most recent call last):\n ...\n-NotImplementedError: cannot construct equivalent Sage object\n+ValueError: libGAP: Error, Variable: 'x' must have a value\n ```\n+And multivariate polynomials with either gap or libgap\n+\n+```\n+sage: R.<x,y> = ZZ[]\n+sage: gap(x+y)\n+Traceback (most recent call last):\n+...\n+TypeError: Gap produced error output\n+sage: libgap(x+y)\n+Traceback (most recent call last):\n+...\n+ValueError: libGAP: Error, Variable: 'x' must have a value\n+```\n+The above ticket (partially based on #2420) implement the above conversions.\n+\n+Note: The conversion from gap/libgap to Sage does not work as well and will be delat with in #21020.\n``````\n",
    "created_at": "2016-07-13T20:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252966",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,25 @@
-Currently sage is not able to convert back polynomials from libgap
+It is not possible to use (in a straightforward way) univariate polynomial in libgap
 
 ```
-sage: libgap.MinimalPolynomial(QQ, libgap.eval("E(3)"))
-x_1^2+x_1+1
-sage: p = libgap.MinimalPolynomial(QQ, libgap.eval("E(3)"))
-sage: p.sage()
+sage: R.<x> = ZZ[]
+sage: libgap(x^5+2*x+1)
 Traceback (most recent call last):
 ...
-NotImplementedError: cannot construct equivalent Sage object
+ValueError: libGAP: Error, Variable: 'x' must have a value
 ```
+And multivariate polynomials with either gap or libgap
+
+```
+sage: R.<x,y> = ZZ[]
+sage: gap(x+y)
+Traceback (most recent call last):
+...
+TypeError: Gap produced error output
+sage: libgap(x+y)
+Traceback (most recent call last):
+...
+ValueError: libGAP: Error, Variable: 'x' must have a value
+```
+The above ticket (partially based on #2420) implement the above conversions.
+
+Note: The conversion from gap/libgap to Sage does not work as well and will be delat with in #21020.
``````




---

archive/issue_comments_252967.json:
```json
{
    "body": "**Author:** Vincent Delecroix",
    "created_at": "2016-07-13T20:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252967",
    "user": "https://github.com/videlec"
}
```

**Author:** Vincent Delecroix



---

archive/issue_events_163970.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T20:24:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "rename": {
        "from": "Conversion between Sage and libgap polynomials",
        "to": "Conversion from Sage polynomial to gap/libgap"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163970"
}
```



---

archive/issue_events_163971.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T20:24:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163971"
}
```



---

archive/issue_comments_252968.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -22,4 +22,4 @@\n ```\n The above ticket (partially based on #2420) implement the above conversions.\n \n-Note: The conversion from gap/libgap to Sage does not work as well and will be delat with in #21020.\n+Note: The conversion from gap/libgap to Sage does not work as well and will be dealt with in #21020.\n``````\n",
    "created_at": "2016-07-13T20:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252968",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -22,4 +22,4 @@
 ```
 The above ticket (partially based on #2420) implement the above conversions.
 
-Note: The conversion from gap/libgap to Sage does not work as well and will be delat with in #21020.
+Note: The conversion from gap/libgap to Sage does not work as well and will be dealt with in #21020.
``````




---

archive/issue_comments_252969.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt looks good except for `_coerce_map_from_`. I don't think it is a good idea to have `libgap` have a coerce map from everything; there are many algebras that (lib)gap almost certainly has no idea about (e.g., Jordan algebras).",
    "created_at": "2016-07-18T04:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252969",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
It looks good except for `_coerce_map_from_`. I don't think it is a good idea to have `libgap` have a coerce map from everything; there are many algebras that (lib)gap almost certainly has no idea about (e.g., Jordan algebras).



---

archive/issue_comments_252970.json:
```json
{
    "body": "<a id='comment:5'></a>\n- coercion between interfaces objects and Sage objects should be one way. So if for a given ring there is a coercion `Sage -> GAP` then it should be the case for every ring that GAP understands.\n\n- The solution I used is precisely what is done with PARI/GP (see for instance the `PariInstance` class in `/sage/libs/pari/pari_instance.pyx`)\n\n- Implementing the function `_coerce_map_from_` would be a useless pain\n\n- *\"interface objects\"* are only intended for people having a knowledge of the underlying software\n\nNow, if for some specific `GAP` object you want to lift it back to Sage then you can either use conversion (i.e. `MyParent(my_interface_object)`) or use the `.sage()` method\n\n```\nsage: pari(13).sage()\n13\nsage: parent(_)\nInteger Ring\nsage: gap(13).sage()\n13\nsage: parent(_)\nInteger Ring\nsage: libgap(13).sage()\n13\nsage: parent(_)\nInteger Ring\n```",
    "created_at": "2016-07-22T19:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252970",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
- coercion between interfaces objects and Sage objects should be one way. So if for a given ring there is a coercion `Sage -> GAP` then it should be the case for every ring that GAP understands.

- The solution I used is precisely what is done with PARI/GP (see for instance the `PariInstance` class in `/sage/libs/pari/pari_instance.pyx`)

- Implementing the function `_coerce_map_from_` would be a useless pain

- *"interface objects"* are only intended for people having a knowledge of the underlying software

Now, if for some specific `GAP` object you want to lift it back to Sage then you can either use conversion (i.e. `MyParent(my_interface_object)`) or use the `.sage()` method

```
sage: pari(13).sage()
13
sage: parent(_)
Integer Ring
sage: gap(13).sage()
13
sage: parent(_)
Integer Ring
sage: libgap(13).sage()
13
sage: parent(_)
Integer Ring
```



---

archive/issue_comments_252971.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe problem with unlimited coercion maps is that we get a bad (IMO incorrect) error message (this is on `develop`):\n\n```sage\nsage: cat = Algebras(QQ).WithBasis().FiniteDimensional()\nsage: C = CombinatorialFreeModule(QQ, ['x','y','z'], category=cat)\nsage: J1 = JordanAlgebra(C, names=['a','b','c'])\nsage: J1.an_element() + gap(2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unsupported operand parent(s) for '+': 'Jordan algebra of Free module generated by {'x', 'y', 'z'} over Rational Field' and 'Gap'\nsage: J1.an_element() + pari(2)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n...\nPariError: incorrect type in gtos [integer expected] (t_POL)\n```\nThere should be a conversion, but I think a coercion is far too strong.\nPerhaps we should ask sage-devel?",
    "created_at": "2016-07-23T00:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252971",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
The problem with unlimited coercion maps is that we get a bad (IMO incorrect) error message (this is on `develop`):

```sage
sage: cat = Algebras(QQ).WithBasis().FiniteDimensional()
sage: C = CombinatorialFreeModule(QQ, ['x','y','z'], category=cat)
sage: J1 = JordanAlgebra(C, names=['a','b','c'])
sage: J1.an_element() + gap(2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unsupported operand parent(s) for '+': 'Jordan algebra of Free module generated by {'x', 'y', 'z'} over Rational Field' and 'Gap'
sage: J1.an_element() + pari(2)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
...
PariError: incorrect type in gtos [integer expected] (t_POL)
```
There should be a conversion, but I think a coercion is far too strong.
Perhaps we should ask sage-devel?



---

archive/issue_comments_252972.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt is a good idea to discuss what should we do concerning coercion and external softwares/libraries.\n\nConcerning this ticket, it is very handy that the coercion always go from Sage to third party interfaces\n\n```\nsage: x = polygen(ZZ)\nsage: p = x^3 + 2*x + 1\nsage: p(pari(2))\n13\nsage: type(_)\n<type 'sage.libs.pari.gen.gen'>\n```\n\nMaking explicit the subset of Sage parents that can actually be represented in a given interface might indeed be much better. But certainly harder to write and maintain. The way I choose is the lazy one. The error messages you mentioned are wrong but should never appear if you restrict to \"pure Sage functions\". If desirable for pari/gap, I guess that implementing it belongs to another ticket.",
    "created_at": "2016-07-23T01:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252972",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
It is a good idea to discuss what should we do concerning coercion and external softwares/libraries.

Concerning this ticket, it is very handy that the coercion always go from Sage to third party interfaces

```
sage: x = polygen(ZZ)
sage: p = x^3 + 2*x + 1
sage: p(pari(2))
13
sage: type(_)
<type 'sage.libs.pari.gen.gen'>
```

Making explicit the subset of Sage parents that can actually be represented in a given interface might indeed be much better. But certainly harder to write and maintain. The way I choose is the lazy one. The error messages you mentioned are wrong but should never appear if you restrict to "pure Sage functions". If desirable for pari/gap, I guess that implementing it belongs to another ticket.



---

archive/issue_comments_252973.json:
```json
{
    "body": "<a id='comment:8'></a>\nAnd this is not the only wrong thing with interfaces. The default implementation of conversion between Sage and the interfaces etc relies on string representations and global variables... which is of course unreliable\n\n```\nsage: R = PolynomialRing(ZZ,('x','y','z'))\nsage: p = 3*R.0*R.1 + R.2^3\nsage: pari(p).sage()\nTraceback (most recent call last):\n...\nNameError: name 'y' is not defined\n```\nor\n\n```\nsage: pari(ZZ).sage()\n<built-in function IntegerRing>\nsage: pari(RR)\nRealFieldwith53bitsofprecision\nsage: pari(RR).sage()\nTraceback (most recent call last):\n...\nNameError: name 'RealFieldwith53bitsofprecision' is not defined\n```",
    "created_at": "2016-07-23T02:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252973",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
And this is not the only wrong thing with interfaces. The default implementation of conversion between Sage and the interfaces etc relies on string representations and global variables... which is of course unreliable

```
sage: R = PolynomialRing(ZZ,('x','y','z'))
sage: p = 3*R.0*R.1 + R.2^3
sage: pari(p).sage()
Traceback (most recent call last):
...
NameError: name 'y' is not defined
```
or

```
sage: pari(ZZ).sage()
<built-in function IntegerRing>
sage: pari(RR)
RealFieldwith53bitsofprecision
sage: pari(RR).sage()
Traceback (most recent call last):
...
NameError: name 'RealFieldwith53bitsofprecision' is not defined
```



---

archive/issue_comments_252974.json:
```json
{
    "body": "<a id='comment:9'></a>\nWell, since we already do a catch-all coercion for `pari` and we got no response from sage-devel, I can tolerate the current state of the coercion.",
    "created_at": "2016-08-14T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252974",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Well, since we already do a catch-all coercion for `pari` and we got no response from sage-devel, I can tolerate the current state of the coercion.



---

archive/issue_comments_252975.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2016-08-14T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252975",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_163972.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-14T13:11:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163972"
}
```



---

archive/issue_events_163973.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-14T13:11:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163973"
}
```



---

archive/issue_events_163974.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-14T13:11:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163974"
}
```



---

archive/issue_events_163975.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-14T13:11:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163975"
}
```



---

archive/issue_events_163976.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-15T18:27:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163976"
}
```



---

archive/issue_events_163977.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-15T18:27:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18266#event-163977"
}
```



---

archive/issue_comments_252976.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/18266](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18266)\" to \"[f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)\".",
    "created_at": "2016-08-15T18:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18266#issuecomment-252976",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/18266](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18266)" to "[f1b8bcd98ffadede706ec244975fab07fa3bd942](https://github.com/sagemath/sagetrac-mirror/commit/f1b8bcd98ffadede706ec244975fab07fa3bd942)".
