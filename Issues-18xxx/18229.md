# Issue 18229: Upgrade R to 3.2.0

archive/issues_017992.json:
```json
{
    "body": "It's that time of the year again (and I'm late...).\n\n\n---\n\n\nRenamed source tarball available from:\n\n    http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz\n\nWe add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).  ([Upstream report](https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16364))\n\n**Assignee:** @EmmanuelCharpentier\n\n**Keywords:** r-project\n\n**Branch/Commit:** [f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Vincent Delecroix, Fran\u00e7ois Bissey, Leif Leonhardy\n\n**Author:** Emmanuel Charpentier, Leif Leonhardy\n\n**Dependencies:** #18254, #15642\n\nIssue created by migration from https://trac.sagemath.org/ticket/18229\n\n",
    "closed_at": "2015-05-14T22:40:13Z",
    "created_at": "2015-04-16T19:39:27Z",
    "labels": [
        "component: packages: standard",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "title": "Upgrade R to 3.2.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/18229",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
It's that time of the year again (and I'm late...).


---


Renamed source tarball available from:

    http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz

We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).  ([Upstream report](https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16364))

**Assignee:** @EmmanuelCharpentier

**Keywords:** r-project

**Branch/Commit:** [f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Vincent Delecroix, François Bissey, Leif Leonhardy

**Author:** Emmanuel Charpentier, Leif Leonhardy

**Dependencies:** #18254, #15642

Issue created by migration from https://trac.sagemath.org/ticket/18229





---

archive/issue_comments_252094.json:
```json
{
    "body": "**Branch:** [u/charpent/upgrade_r_to_3_1_3](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/upgrade_r_to_3_1_3)",
    "created_at": "2015-04-16T20:29:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252094",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Branch:** [u/charpent/upgrade_r_to_3_1_3](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/upgrade_r_to_3_1_3)



---

archive/issue_events_163615.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-16T20:36:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163615"
}
```



---

archive/issue_comments_252095.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n It's that time of the year again (and I'm late...).\n+\n+Renamed source tarball available from here : https://drive.google.com/file/d/0B1gfn4_V_wm3dlBneWNlTmhmZFE/view?usp=sharing\u00a0 (I don't have a publicly accessible repository).\n``````\n",
    "created_at": "2015-04-16T20:36:34Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252095",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 It's that time of the year again (and I'm late...).
+
+Renamed source tarball available from here : https://drive.google.com/file/d/0B1gfn4_V_wm3dlBneWNlTmhmZFE/view?usp=sharing  (I don't have a publicly accessible repository).
``````




---

archive/issue_comments_252096.json:
```json
{
    "body": "**Commit:** [b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571](https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571)",
    "created_at": "2015-04-16T20:36:34Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252096",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Commit:** [b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571](https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571)



---

archive/issue_comments_252097.json:
```json
{
    "body": "<a id='comment:3'></a>\nI forgot : passes ptestlong.",
    "created_at": "2015-04-16T20:37:48Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252097",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:3'></a>
I forgot : passes ptestlong.



---

archive/issue_comments_252098.json:
```json
{
    "body": "**Assignee:** @EmmanuelCharpentier",
    "created_at": "2015-04-16T20:37:48Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252098",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Assignee:** @EmmanuelCharpentier



---

archive/issue_comments_252099.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoes plotting and so forth still work properly?",
    "created_at": "2015-04-17T01:30:50Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252099",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
Does plotting and so forth still work properly?



---

archive/issue_events_163616.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-17T05:10:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "rename": {
        "from": "Upgrade R to 3.1.3",
        "to": "Upgrade R to 3.2.0"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163616"
}
```



---

archive/issue_events_163617.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-17T05:10:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163617"
}
```



---

archive/issue_events_163618.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-17T05:10:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163618"
}
```



---

archive/issue_comments_252100.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'll check that.\n\nBTW : R-project released (of course !) 3.2.0 hours after I uploaded this patch ==> needs_work. I amend the ticket.",
    "created_at": "2015-04-17T05:10:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252100",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:5'></a>
I'll check that.

BTW : R-project released (of course !) 3.2.0 hours after I uploaded this patch ==> needs_work. I amend the ticket.



---

archive/issue_comments_252101.json:
```json
{
    "body": "<a id='comment:6'></a>\nActually can you check if you really need to rename upstream's tarball? We can deal with archive with a capital in their name (`Pillow` and `Sphinx` for example). You'll have to change `checksums.ini` to try that.",
    "created_at": "2015-04-17T06:12:02Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252101",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Actually can you check if you really need to rename upstream's tarball? We can deal with archive with a capital in their name (`Pillow` and `Sphinx` for example). You'll have to change `checksums.ini` to try that.



---

archive/issue_comments_252102.json:
```json
{
    "body": "**Changing commit** from \"[b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571](https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571)\" to \"[ab208a4e69834c786a2f0d4ff5a2626776db4d62](https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62)\".",
    "created_at": "2015-04-17T06:35:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571](https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571)" to "[ab208a4e69834c786a2f0d4ff5a2626776db4d62](https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62)".



---

archive/issue_comments_252103.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62\">ab208a4</a></td><td><code>Upgrade R to 3.2.0. passes ptestlong (All tests passed\\!).</code></td></tr></table>\n",
    "created_at": "2015-04-17T06:35:19Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62">ab208a4</a></td><td><code>Upgrade R to 3.2.0. passes ptestlong (All tests passed\!).</code></td></tr></table>




---

archive/issue_comments_252104.json:
```json
{
    "body": "<a id='comment:8'></a>\nUpgrade to 3.2.0 done. Passes ptestlong ==> needs_review\n\nR graphics : they work in the sage notebook, not on command line or ipython notebook (same as before...). This would deserve another ticket.\n\nFran\u00e7ois : the build system may support names with a capital, but sage-fix-pkg-checksums do not. I won't fix that in this ticket. Should I (should you ?) open a new ticket ?",
    "created_at": "2015-04-17T06:42:06Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252104",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:8'></a>
Upgrade to 3.2.0 done. Passes ptestlong ==> needs_review

R graphics : they work in the sage notebook, not on command line or ipython notebook (same as before...). This would deserve another ticket.

François : the build system may support names with a capital, but sage-fix-pkg-checksums do not. I won't fix that in this ticket. Should I (should you ?) open a new ticket ?



---

archive/issue_events_163619.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-17T06:42:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163619"
}
```



---

archive/issue_events_163620.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-17T06:42:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163620"
}
```



---

archive/issue_comments_252105.json:
```json
{
    "body": "<a id='comment:9'></a>\nI am a bit surprised since we have other packages with capital in their names and they have to be checksumed too. In fact I just tried the script on Pillow and it worked (as in I removed checksum.ini for pillow and regenerated it). In fact I renamed the current R tarball from r-3.1.2.tar.gz to R-3.1.2.tar.gz and it worked too. Have you even tried it?",
    "created_at": "2015-04-17T07:09:45Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252105",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I am a bit surprised since we have other packages with capital in their names and they have to be checksumed too. In fact I just tried the script on Pillow and it worked (as in I removed checksum.ini for pillow and regenerated it). In fact I renamed the current R tarball from r-3.1.2.tar.gz to R-3.1.2.tar.gz and it worked too. Have you even tried it?



---

archive/issue_comments_252106.json:
```json
{
    "body": "<a id='comment:10'></a>\nImportant rectifications :\n\nkcrisman : I was able to get R graphics in the ipython notebook ... but I had to %load_ext rmagic before, and work in a %%R cell. This is far from obvious after reading the docs. I understand that the ipython is work in progress, so this is not (yet) a big problem. But it should eventually be documented in a more obvious way. I am beginnig to think that some kind of guide to ipython notebook for (repentant ?) Sage notebook users would be useful. Maybe ditto for Cloud users (Sagemath cloud is really a different beast ...).\n\nNote that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython\"). Does this deserve a ticket ?\n\nfbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.\n\nThat was on 6.7beta1 + the present patch. Don't you have other patches ?\n\nStatus : still \"needs_review\", IMHO.\n\nHTH,",
    "created_at": "2015-04-17T17:59:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252106",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:10'></a>
Important rectifications :

kcrisman : I was able to get R graphics in the ipython notebook ... but I had to %load_ext rmagic before, and work in a %%R cell. This is far from obvious after reading the docs. I understand that the ipython is work in progress, so this is not (yet) a big problem. But it should eventually be documented in a more obvious way. I am beginnig to think that some kind of guide to ipython notebook for (repentant ?) Sage notebook users would be useful. Maybe ditto for Cloud users (Sagemath cloud is really a different beast ...).

Note that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython"). Does this deserve a ticket ?

fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.

That was on 6.7beta1 + the present patch. Don't you have other patches ?

Status : still "needs_review", IMHO.

HTH,



---

archive/issue_comments_252107.json:
```json
{
    "body": "<a id='comment:11'></a>\nI wouldn't be concerned about ipynb graphics since that is new (I mean, I'm not, others might be).  Has plotting from the command line ever worked without setting a graphics viewer (there is a name for this in R, I just forget it now).",
    "created_at": "2015-04-17T18:23:43Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252107",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
I wouldn't be concerned about ipynb graphics since that is new (I mean, I'm not, others might be).  Has plotting from the command line ever worked without setting a graphics viewer (there is a name for this in R, I just forget it now).



---

archive/issue_comments_252108.json:
```json
{
    "body": "<a id='comment:12'></a>\n> Note that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython\"). Does this deserve a ticket ?\n\n\nI don't know anything about that, but rpy2 shouldn't be necessary for all this.",
    "created_at": "2015-04-17T18:24:18Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252108",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
> Note that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython"). Does this deserve a ticket ?


I don't know anything about that, but rpy2 shouldn't be necessary for all this.



---

archive/issue_comments_252109.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [kcrisman](#comment%3A11):\n> I wouldn't be concerned about ipynb graphics since that is new (I mean, I'm not, others might be).  Has plotting from the command line ever worked without setting a graphics viewer (there is a name for this in R, I just forget it now).\n\n\nIt's known as a \"graphic device\" in R docs.\n\nTo be clear,\n\n```\nr(\"plot(rnorm(1000),rnorm(1000))\")\n```\ndoes nothing (on command line and in ipynb). Returns NULL\n\n```\nr(\"X11();plot(rnorm(1000),rnorm(1000))\")\n```\nopens an X11 window (the R graphic device) and displays the cloud in this window (again on command line and in ipynb). Returns NULL, nothing displayed **in the notebook**.\n\nInterestingly, neither `r.plot(r.rnorm(1000),r.rnorm(1000))` nor `r.X11();r.plot(r.rnorm(1000),r.rnorm(1000))` do anything on the command line (prints NULL, then the named vector (c(\"null device\"=1). or in the notebook (ditto except that NULL is not printed).\n\nI don't remember having ever used R from sage on the command line (my favorite interface was emacs  and ess, for obvious reasons, but The Sage notebook was sometimes handy, and ipynb appears more and more attractive, since %%R seems to work).\n\nHTH,",
    "created_at": "2015-04-17T19:05:07Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252109",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:13'></a>
Replying to [kcrisman](#comment%3A11):
> I wouldn't be concerned about ipynb graphics since that is new (I mean, I'm not, others might be).  Has plotting from the command line ever worked without setting a graphics viewer (there is a name for this in R, I just forget it now).


It's known as a "graphic device" in R docs.

To be clear,

```
r("plot(rnorm(1000),rnorm(1000))")
```
does nothing (on command line and in ipynb). Returns NULL

```
r("X11();plot(rnorm(1000),rnorm(1000))")
```
opens an X11 window (the R graphic device) and displays the cloud in this window (again on command line and in ipynb). Returns NULL, nothing displayed **in the notebook**.

Interestingly, neither `r.plot(r.rnorm(1000),r.rnorm(1000))` nor `r.X11();r.plot(r.rnorm(1000),r.rnorm(1000))` do anything on the command line (prints NULL, then the named vector (c("null device"=1). or in the notebook (ditto except that NULL is not printed).

I don't remember having ever used R from sage on the command line (my favorite interface was emacs  and ess, for obvious reasons, but The Sage notebook was sometimes handy, and ipynb appears more and more attractive, since %%R seems to work).

HTH,



---

archive/issue_comments_252110.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [kcrisman](#comment%3A12):\n> > Note that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython\"). Does this deserve a ticket ?\n\n> \n> I don't know anything about that, but rpy2 shouldn't be necessary for all this.\n\n\nCurrently, it seems to be, at least in ipynb. In the Sage notebook, the only way I found  to get graphs reliably in the notebook itself was to open a device, plot on it (several graphs are possible) and close the device in the same %r cell. The same is possible in an rpy2 %%R cell vhithout to have to open/close the device.\n\nHTH,",
    "created_at": "2015-04-17T19:26:06Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252110",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:14'></a>
Replying to [kcrisman](#comment%3A12):
> > Note that you have to %load_ext rmagic, nor rpy2.ipython (error message : ImportError: No module named ipython"). Does this deserve a ticket ?

> 
> I don't know anything about that, but rpy2 shouldn't be necessary for all this.


Currently, it seems to be, at least in ipynb. In the Sage notebook, the only way I found  to get graphs reliably in the notebook itself was to open a device, plot on it (several graphs are possible) and close the device in the same %r cell. The same is possible in an rpy2 %%R cell vhithout to have to open/close the device.

HTH,



---

archive/issue_comments_252111.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [charpent](#comment%3A10):\n> fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.\n> \n\n\nThat's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.",
    "created_at": "2015-04-17T19:48:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252111",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Replying to [charpent](#comment%3A10):
> fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.
> 


That's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.



---

archive/issue_comments_252112.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [fbissey](#comment%3A15):\n> Replying to [charpent](#comment%3A10):\n> > fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.\n> > \n\n> \n> That's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.\n\n\nI just did that **exactly**, with the same result : **nothing** is printed by the script, and the checksums.ini file is **not** recreated.\n\nYet another Appleism ? What shell do you use ?\n\nHTH,",
    "created_at": "2015-04-17T20:09:34Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252112",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:16'></a>
Replying to [fbissey](#comment%3A15):
> Replying to [charpent](#comment%3A10):
> > fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.
> > 

> 
> That's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.


I just did that **exactly**, with the same result : **nothing** is printed by the script, and the checksums.ini file is **not** recreated.

Yet another Appleism ? What shell do you use ?

HTH,



---

archive/issue_comments_252113.json:
```json
{
    "body": "<a id='comment:17'></a>\nIt is bash 3.2 as far as I can tell. I am guessing you have 4.x.",
    "created_at": "2015-04-17T20:27:08Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252113",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
It is bash 3.2 as far as I can tell. I am guessing you have 4.x.



---

archive/issue_comments_252114.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [charpent](#comment%3A16):\n> Replying to [fbissey](#comment%3A15):\n> > Replying to [charpent](#comment%3A10):\n> > > fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.\n> > > \n\n> > \n> > That's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.\n\n> \n> I just did that **exactly**, with the same result : **nothing** is printed by the script, and the checksums.ini file is **not** recreated.\n> \n> Yet another Appleism ? What shell do you use ?\n> \n\n\nThinking more about it, I don't think it is strictly an appleism - not of the shell at any rate. I think the underlying file system may be case insensitive and just look case sensitive by hackery (not unlike FAT32 in some ways). In any case someone created checksums for `Pillow` and `Sphinx`...",
    "created_at": "2015-04-20T01:40:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252114",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
Replying to [charpent](#comment%3A16):
> Replying to [fbissey](#comment%3A15):
> > Replying to [charpent](#comment%3A10):
> > > fbissey : I tried your way : I moved $SAGE_ROOT/build/pkgs/r/checksums.ini out of the way, renamed $SAGE_ROOT/upstream/r-3.2.0.tar.gz to $SAGE_ROOT/upstream/R-3.2.0.tar.gz and ran sage -sh sage-fix-pkg-checksums : **neither** r-3.2.0.tar.gz **nor** R-3.2.0.tar.gz appear in the list of recomputed checksums (nor does pillow or Pillow, by the way), and $SAGE_ROOT/build/pkgs/r/checksums.ini is ***NOT*** recreated.
> > > 

> > 
> > That's very strange I was on 6.6 on a mac when I did that. Can you go in upstream and try `../sage -sh  sage-fix-pkg-checksums R-3.2.0.tar.gz` explicitly. It may be that it doesn't work with all shells.

> 
> I just did that **exactly**, with the same result : **nothing** is printed by the script, and the checksums.ini file is **not** recreated.
> 
> Yet another Appleism ? What shell do you use ?
> 


Thinking more about it, I don't think it is strictly an appleism - not of the shell at any rate. I think the underlying file system may be case insensitive and just look case sensitive by hackery (not unlike FAT32 in some ways). In any case someone created checksums for `Pillow` and `Sphinx`...



---

archive/issue_comments_252115.json:
```json
{
    "body": "<a id='comment:19'></a>\nI should have run this simple check before the last post. Fairly convincing\n\n```\nMirage:upstream fbissey$ ls\nPillow-2.2.2.tar.gz\t\t\tgd-2.0.35.tar.bz2\t\t\tmpfi-1.5.1.tar.bz2\t\t\tr-3.1.2.tar.gz\nSphinx-1.2.2.tar.gz\t\t\tgdmodule-0.56.tar.bz2\t\t\tmpfr-3.1.2.tar.bz2\t\t\tratpoints-2.1.3.tar.bz2\natlas-3.10.2.tar.bz2\t\t\tgf2x-1.1.tar.bz2\t\t\tmpir-2.6.0.tar.bz2\t\t\treadline-6.3.008.tar.gz\nboehm_gc-7.2d.tar.bz2\t\t\tgfan-0.5.tar.bz2\t\t\tmpmath-0.18.tar.gz\t\t\trpy2-2.3.8.tar.gz\nboost_cropped-1.52.0.tar.bz2\t\tgit-2.1.2.tar.gz\t\t\tncurses-5.9.20131221.tar.bz2\t\trubiks-20070912.tar.bz2\nbzip2-1.0.6.20140317.tar.gz\t\tgivaro-3.7.1.tar.bz2\t\t\tnetworkx-1.8.1.tar.gz\t\t\tsagenb-0.11.1.tar\ncddlib-094g.tar.bz2\t\t\tglpk-4.55.tar.gz\t\t\tntl-6.2.1.tar.bz2\t\t\tsagetex-2.3.4.tar.bz2\ncephes-2.8.tar.bz2\t\t\tgraphs-20120404.tar.bz2\t\t\tnumpy-1.8.1.tar.gz\t\t\tscipy-0.14.0.tar.gz\ncliquer-1.21.tar.bz2\t\t\tgsl-1.16.tar.gz\t\t\t\tpalp-2.1.tar.bz2\t\t\tscons-1.2.0.tar.bz2\ncombinatorial_designs-20140630.tar.bz2\ticonv-1.14.tar.bz2\t\t\tpari-2.7.1.tar.gz\t\t\tsetuptools-3.6.tar.gz\nconway_polynomials-0.4.tar.bz2\t\timl-1.0.4.tar.bz2\t\t\tpari_galdata-20080411.tar.bz2\t\tsingular-3.1.7p1.tar.bz2\ncvxopt-1.1.7.tar.gz\t\t\tipython-2.3.0.tar.gz\t\t\tpari_seadata_small-20090618.tar.bz2\tsix-1.4.1.tar.gz\ncython-0.21.1.tar.gz\t\t\tjinja2-2.5.5.tar.bz2\t\t\tpatch-2.7.1.tar.gz\t\t\tsqlalchemy-0.5.8.tar.bz2\ndateutil-2.2.tar.gz\t\t\tjmol-14.2.4_2014.08.03.tar.bz2\t\tpexpect-2.0.tar.bz2\t\t\tsqlite-3.8.4.3.tar.bz2\ndocutils-0.12.tar.gz\t\t\tlcalc-1.23.tar.bz2\t\t\tpkgconf-0.9.7.tar.gz\t\t\tsymmetrica-2.0.tar.bz2\necl-13.5.1.tar.bz2\t\t\tlibfplll-4.0.4.tar.bz2\t\t\tpkgconfig-1.1.0.tar.gz\t\t\tsympow-1.018.1.tar.bz2\neclib-20140921.tar.bz2\t\t\tlibgap-4.7.5.1.tar.gz\t\t\tpolybori-0.8.3.tar.bz2\t\t\tsympy-0.7.5.tar.gz\necm-6.4.4.tar.bz2\t\t\tlibpng-1.2.51.tar.gz\t\t\tpolytopes_db-20120220.tar.bz2\t\ttachyon-0.98.9.tar.bz2\nelliptic_curves-0.7.tar.bz2\t\tlinbox-1.3.2.tar.bz2\t\t\tppl-1.1.tar.bz2\t\t\t\ttornado-3.1.1.tar.gz\nfflas_ffpack-1.6.0.tar.bz2\t\tlrcalc-1.1.7.tar.gz\t\t\tpycrypto-2.6.1.tar.gz\t\t\tzeromq-4.0.4.tar.gz\nflint-2.4.4.tar.gz\t\t\tm4ri-20140914.tar.gz\t\t\tpygments-1.3.1.tar.bz2\t\t\tzlib-1.2.8.tar.bz2\nflintqs-20070817.tar.bz2\t\tm4rie-20140914.tar.gz\t\t\tpynac-0.3.2.tar.bz2\t\t\tzn_poly-0.9.tar.bz2\nfreetype-2.5.2.tar.bz2\t\t\tmatplotlib-1.3.1.tar.gz\t\t\tpyparsing-2.0.1.tar.gz\ngap-4.7.5.tar.bz2\t\t\tmaxima-5.34.1.tar.bz2\t\t\tpython-2.7.8.tar.gz\ngcc-4.9.2.tar.bz2\t\t\tmpc-1.0.2.tar.gz\t\t\tpyzmq-14.3.0.tar.gz\nMirage:upstream fbissey$ ll pillow-2.2.2.tar.gz\n-rw-r--r--  1 fbissey  staff   2.0M 13 Oct  2014 pillow-2.2.2.tar.gz\n```",
    "created_at": "2015-04-20T01:42:57Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252115",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
I should have run this simple check before the last post. Fairly convincing

```
Mirage:upstream fbissey$ ls
Pillow-2.2.2.tar.gz			gd-2.0.35.tar.bz2			mpfi-1.5.1.tar.bz2			r-3.1.2.tar.gz
Sphinx-1.2.2.tar.gz			gdmodule-0.56.tar.bz2			mpfr-3.1.2.tar.bz2			ratpoints-2.1.3.tar.bz2
atlas-3.10.2.tar.bz2			gf2x-1.1.tar.bz2			mpir-2.6.0.tar.bz2			readline-6.3.008.tar.gz
boehm_gc-7.2d.tar.bz2			gfan-0.5.tar.bz2			mpmath-0.18.tar.gz			rpy2-2.3.8.tar.gz
boost_cropped-1.52.0.tar.bz2		git-2.1.2.tar.gz			ncurses-5.9.20131221.tar.bz2		rubiks-20070912.tar.bz2
bzip2-1.0.6.20140317.tar.gz		givaro-3.7.1.tar.bz2			networkx-1.8.1.tar.gz			sagenb-0.11.1.tar
cddlib-094g.tar.bz2			glpk-4.55.tar.gz			ntl-6.2.1.tar.bz2			sagetex-2.3.4.tar.bz2
cephes-2.8.tar.bz2			graphs-20120404.tar.bz2			numpy-1.8.1.tar.gz			scipy-0.14.0.tar.gz
cliquer-1.21.tar.bz2			gsl-1.16.tar.gz				palp-2.1.tar.bz2			scons-1.2.0.tar.bz2
combinatorial_designs-20140630.tar.bz2	iconv-1.14.tar.bz2			pari-2.7.1.tar.gz			setuptools-3.6.tar.gz
conway_polynomials-0.4.tar.bz2		iml-1.0.4.tar.bz2			pari_galdata-20080411.tar.bz2		singular-3.1.7p1.tar.bz2
cvxopt-1.1.7.tar.gz			ipython-2.3.0.tar.gz			pari_seadata_small-20090618.tar.bz2	six-1.4.1.tar.gz
cython-0.21.1.tar.gz			jinja2-2.5.5.tar.bz2			patch-2.7.1.tar.gz			sqlalchemy-0.5.8.tar.bz2
dateutil-2.2.tar.gz			jmol-14.2.4_2014.08.03.tar.bz2		pexpect-2.0.tar.bz2			sqlite-3.8.4.3.tar.bz2
docutils-0.12.tar.gz			lcalc-1.23.tar.bz2			pkgconf-0.9.7.tar.gz			symmetrica-2.0.tar.bz2
ecl-13.5.1.tar.bz2			libfplll-4.0.4.tar.bz2			pkgconfig-1.1.0.tar.gz			sympow-1.018.1.tar.bz2
eclib-20140921.tar.bz2			libgap-4.7.5.1.tar.gz			polybori-0.8.3.tar.bz2			sympy-0.7.5.tar.gz
ecm-6.4.4.tar.bz2			libpng-1.2.51.tar.gz			polytopes_db-20120220.tar.bz2		tachyon-0.98.9.tar.bz2
elliptic_curves-0.7.tar.bz2		linbox-1.3.2.tar.bz2			ppl-1.1.tar.bz2				tornado-3.1.1.tar.gz
fflas_ffpack-1.6.0.tar.bz2		lrcalc-1.1.7.tar.gz			pycrypto-2.6.1.tar.gz			zeromq-4.0.4.tar.gz
flint-2.4.4.tar.gz			m4ri-20140914.tar.gz			pygments-1.3.1.tar.bz2			zlib-1.2.8.tar.bz2
flintqs-20070817.tar.bz2		m4rie-20140914.tar.gz			pynac-0.3.2.tar.bz2			zn_poly-0.9.tar.bz2
freetype-2.5.2.tar.bz2			matplotlib-1.3.1.tar.gz			pyparsing-2.0.1.tar.gz
gap-4.7.5.tar.bz2			maxima-5.34.1.tar.bz2			python-2.7.8.tar.gz
gcc-4.9.2.tar.bz2			mpc-1.0.2.tar.gz			pyzmq-14.3.0.tar.gz
Mirage:upstream fbissey$ ll pillow-2.2.2.tar.gz
-rw-r--r--  1 fbissey  staff   2.0M 13 Oct  2014 pillow-2.2.2.tar.gz
```



---

archive/issue_comments_252116.json:
```json
{
    "body": "<a id='comment:20'></a>\nFran\u00e7ois : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.\n\nOTOH, I wonder what has caused the \"lower case only in source tarball names\" rule to be added to the Sage byzantine build system. In other words, what would be broken if MixedCase nAmEs were allowed on tarball names ? In yet other words, should we hack up sage-fix-pkg-checksums  to allow it to work with mixed-case-named tarballs ?\n\nHTH,",
    "created_at": "2015-04-20T06:41:05Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252116",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:20'></a>
François : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.

OTOH, I wonder what has caused the "lower case only in source tarball names" rule to be added to the Sage byzantine build system. In other words, what would be broken if MixedCase nAmEs were allowed on tarball names ? In yet other words, should we hack up sage-fix-pkg-checksums  to allow it to work with mixed-case-named tarballs ?

HTH,



---

archive/issue_comments_252117.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [charpent](#comment%3A20):\n> Fran\u00e7ois : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.\n> \n\n\nThat's what it looks like yes.\n\n> OTOH, I wonder what has caused the \"lower case only in source tarball names\" rule to be added to the Sage byzantine build system. In other words, what would be broken if MixedCase nAmEs were allowed on tarball names ? In yet other words, should we hack up sage-fix-pkg-checksums  to allow it to work with mixed-case-named tarballs ?\n> \n\n\nThe build system obviously works fine, otherwise we would have tons of reports about Sphinx and Pillow by now. But `sage-fix-pkg-checksums` should be dealt with it is the most obvious piece that cannot cope with mixed/uppercase characters as far as we can see here.",
    "created_at": "2015-04-20T07:12:27Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252117",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
Replying to [charpent](#comment%3A20):
> François : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.
> 


That's what it looks like yes.

> OTOH, I wonder what has caused the "lower case only in source tarball names" rule to be added to the Sage byzantine build system. In other words, what would be broken if MixedCase nAmEs were allowed on tarball names ? In yet other words, should we hack up sage-fix-pkg-checksums  to allow it to work with mixed-case-named tarballs ?
> 


The build system obviously works fine, otherwise we would have tons of reports about Sphinx and Pillow by now. But `sage-fix-pkg-checksums` should be dealt with it is the most obvious piece that cannot cope with mixed/uppercase characters as far as we can see here.



---

archive/issue_comments_252118.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [fbissey](#comment%3A21):\n> But `sage-fix-pkg-checksums` should be dealt with it is the most obvious piece that cannot cope with mixed/uppercase characters as far as we can see here.\n\nObviously, `sage-fix-pkg-checksums` can deal with mixed case characters. It's just that the name in `build/pkgs` should match the tarball name. The tarball for `build/pkgs/r` must be named `r-something`, not `R-something`. It seems to be an unwritten(?) Sage convention that `build/pkgs` always uses a lower case name, so I recommend to use lower case also for the tarball name.",
    "created_at": "2015-04-21T09:32:04Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252118",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [fbissey](#comment%3A21):
> But `sage-fix-pkg-checksums` should be dealt with it is the most obvious piece that cannot cope with mixed/uppercase characters as far as we can see here.

Obviously, `sage-fix-pkg-checksums` can deal with mixed case characters. It's just that the name in `build/pkgs` should match the tarball name. The tarball for `build/pkgs/r` must be named `r-something`, not `R-something`. It seems to be an unwritten(?) Sage convention that `build/pkgs` always uses a lower case name, so I recommend to use lower case also for the tarball name.



---

archive/issue_comments_252119.json:
```json
{
    "body": "<a id='comment:23'></a>\nOK. It seems now that, whereas at least two Sage developers are eager to qibble over the case of tarballs' names, no one has (yet) opened a ticket for this issue, which is **different** from the issue at hand, which is R-3.2.0.\n\nSince it is a different issue, I do not think it is wise to try to fix it incidently. I will **not** touch it in this ticket.\n\n1) Should I open a ticket over the tarball case question ?\n\n2) Could some kind soul review my proposed fix ?\n\n3) Should I open a ticket over the issue of sex of angels in Sage ?\n\n`Status<-needs-no-dithering-over-side-issues`.",
    "created_at": "2015-04-21T10:42:03Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252119",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:23'></a>
OK. It seems now that, whereas at least two Sage developers are eager to qibble over the case of tarballs' names, no one has (yet) opened a ticket for this issue, which is **different** from the issue at hand, which is R-3.2.0.

Since it is a different issue, I do not think it is wise to try to fix it incidently. I will **not** touch it in this ticket.

1) Should I open a ticket over the tarball case question ?

2) Could some kind soul review my proposed fix ?

3) Should I open a ticket over the issue of sex of angels in Sage ?

`Status<-needs-no-dithering-over-side-issues`.



---

archive/issue_comments_252120.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [charpent](#comment%3A23):\n> 1) Should I open a ticket over the tarball case question ?\n\nFor me, there is no issue, so there shouldn't be a ticket.",
    "created_at": "2015-04-21T11:16:02Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252120",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [charpent](#comment%3A23):
> 1) Should I open a ticket over the tarball case question ?

For me, there is no issue, so there shouldn't be a ticket.



---

archive/issue_comments_252121.json:
```json
{
    "body": "<a id='comment:25'></a>\nThe download link points to `r-3.1.3.tar.gz`\n\nThe Author name should be filled in.",
    "created_at": "2015-04-21T11:17:38Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252121",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
The download link points to `r-3.1.3.tar.gz`

The Author name should be filled in.



---

archive/issue_events_163621.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-21T11:17:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163621"
}
```



---

archive/issue_events_163622.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-21T11:17:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163622"
}
```



---

archive/issue_comments_252122.json:
```json
{
    "body": "<a id='comment:26'></a>\nAbout the tarball link: I'm pretty sure that Volker will want a direct download link, not \"open this webpage, then click on this\" instruction.",
    "created_at": "2015-04-21T11:19:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252122",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
About the tarball link: I'm pretty sure that Volker will want a direct download link, not "open this webpage, then click on this" instruction.



---

archive/issue_events_163623.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-21T13:57:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163623"
}
```



---

archive/issue_events_163624.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-21T13:57:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163624"
}
```



---

archive/issue_comments_252123.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n It's that time of the year again (and I'm late...).\n \n-Renamed source tarball available from here : https://drive.google.com/file/d/0B1gfn4_V_wm3dlBneWNlTmhmZFE/view?usp=sharing\u00a0 (I don't have a publicly accessible repository).\n+Renamed source tarball available from [here](https://drive.google.com/open?id=0B1gfn4_V_wm3SlI1a0ZSX1FOM0E&authuser=0) (I don't have a publicly accessible repository).\n``````\n",
    "created_at": "2015-04-21T13:57:55Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252123",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 It's that time of the year again (and I'm late...).
 
-Renamed source tarball available from here : https://drive.google.com/file/d/0B1gfn4_V_wm3dlBneWNlTmhmZFE/view?usp=sharing  (I don't have a publicly accessible repository).
+Renamed source tarball available from [here](https://drive.google.com/open?id=0B1gfn4_V_wm3SlI1a0ZSX1FOM0E&authuser=0) (I don't have a publicly accessible repository).
``````




---

archive/issue_comments_252124.json:
```json
{
    "body": "<a id='comment:27'></a>\nSorry, I still don't have a server publicly available. Google driwe will have to serve...",
    "created_at": "2015-04-21T13:57:55Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252124",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:27'></a>
Sorry, I still don't have a server publicly available. Google driwe will have to serve...



---

archive/issue_comments_252125.json:
```json
{
    "body": "**Author:** Emmanuel Charpentier",
    "created_at": "2015-04-21T13:57:55Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252125",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

**Author:** Emmanuel Charpentier



---

archive/issue_comments_252126.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n It's that time of the year again (and I'm late...).\n \n-Renamed source tarball available from [here](https://drive.google.com/open?id=0B1gfn4_V_wm3SlI1a0ZSX1FOM0E&authuser=0) (I don't have a publicly accessible repository).\n+Renamed source tarball available from:\n+\n+    http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz\n``````\n",
    "created_at": "2015-04-21T15:50:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252126",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 It's that time of the year again (and I'm late...).
 
-Renamed source tarball available from [here](https://drive.google.com/open?id=0B1gfn4_V_wm3SlI1a0ZSX1FOM0E&authuser=0) (I don't have a publicly accessible repository).
+Renamed source tarball available from:
+
+    http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz
``````




---

archive/issue_comments_252127.json:
```json
{
    "body": "<a id='comment:28'></a>\nI put the tarball on my webpage (and checked that the sha1 matches the upstream one).\n\nVincent",
    "created_at": "2015-04-21T15:50:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252127",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>
I put the tarball on my webpage (and checked that the sha1 matches the upstream one).

Vincent



---

archive/issue_comments_252128.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [vdelecroix](#comment%3A28):\n> I put the tarball on my webpage (and checked that the sha1 matches the upstream one).\n\n\nAnd it builds fine on my computer (Debian jessie 64 bits)",
    "created_at": "2015-04-21T15:51:21Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252128",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>
Replying to [vdelecroix](#comment%3A28):
> I put the tarball on my webpage (and checked that the sha1 matches the upstream one).


And it builds fine on my computer (Debian jessie 64 bits)



---

archive/issue_comments_252129.json:
```json
{
    "body": "<a id='comment:30'></a>\nFWIW, 6.7beta2 + this patch passes ptestlong with \"All tests passed!\".",
    "created_at": "2015-04-24T06:08:02Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252129",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:30'></a>
FWIW, 6.7beta2 + this patch passes ptestlong with "All tests passed!".



---

archive/issue_comments_252130.json:
```json
{
    "body": "<a id='comment:31'></a>\nLet it go.",
    "created_at": "2015-04-24T17:26:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252130",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>
Let it go.



---

archive/issue_events_163625.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-24T17:26:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163625"
}
```



---

archive/issue_events_163626.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-24T17:26:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163626"
}
```



---

archive/issue_comments_252131.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2015-04-24T17:26:52Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252131",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_comments_252132.json:
```json
{
    "body": "<a id='comment:32'></a>\nFor what it's worth, this fails on OS X 10.10.3. (So does the old version of R, but this one fails in a different way.) See [ticket:18254#comment:53 #18254].",
    "created_at": "2015-04-24T23:06:03Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252132",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
For what it's worth, this fails on OS X 10.10.3. (So does the old version of R, but this one fails in a different way.) See [ticket:18254#comment:53 #18254].



---

archive/issue_comments_252133.json:
```json
{
    "body": "<a id='comment:33'></a>\nAlso fails on Linux 32-bit:\n\n```\ngcc -std=gnu99 -Wl,--export-dynamic -fopenmp  -L../../lib -L/home/buildslave-sage/slave/sage_git/build/local/lib/  -o R.bin Rmain.o  -lR \n../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'\n../../lib/libR.so: undefined reference to `BZ2_bzRead'\n../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'\n../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'\n../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'\n../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'\n../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompress'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'\n../../lib/libR.so: undefined reference to `BZ2_bzWrite'\n../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'\n../../lib/libR.so: undefined reference to `BZ2_bzReadClose'\ncollect2: error: ld returned 1 exit status\n```\nFull log: http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/259/steps/compile/logs/r-project",
    "created_at": "2015-04-24T23:22:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252133",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
Also fails on Linux 32-bit:

```
gcc -std=gnu99 -Wl,--export-dynamic -fopenmp  -L../../lib -L/home/buildslave-sage/slave/sage_git/build/local/lib/  -o R.bin Rmain.o  -lR 
../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'
../../lib/libR.so: undefined reference to `BZ2_bzRead'
../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'
../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'
../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'
../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'
../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'
../../lib/libR.so: undefined reference to `BZ2_bzDecompress'
../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'
../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'
../../lib/libR.so: undefined reference to `BZ2_bzWrite'
../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'
../../lib/libR.so: undefined reference to `BZ2_bzReadClose'
collect2: error: ld returned 1 exit status
```
Full log: http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/259/steps/compile/logs/r-project



---

archive/issue_events_163627.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-24T23:22:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163627"
}
```



---

archive/issue_events_163628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-24T23:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163628"
}
```



---

archive/issue_comments_252134.json:
```json
{
    "body": "<a id='comment:34'></a>\nHum, it looks like libR.so has been underlinked\n\n```\ngcc -std=gnu99 -shared -fopenmp -L/home/buildslave-sage/slave/sage_git/build/local/lib/   -o libR.so CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cum.o dcf.o datetime.o debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o names.o objects.o options.o paste.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`   ../extra/pcre/libpcre.a ../extra/tre/libtre.a  ../extra/xz/liblzma.a   -lf77blas -latlas -lgfortran -lm -lquadmath   -lreadline  -lz -lrt -ldl -lm  \n```\nwhich would go unnoticed if R.bin was compiled with `-lbzlib`. It looks like bzip2 was properly detected at configuration so we should be using the one shipped with sage. I'd ask for the `config.log` but I am fairly certain I won't see anything abnormal there. Still there could be something in there that wasn't printed.",
    "created_at": "2015-04-24T23:34:18Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252134",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
Hum, it looks like libR.so has been underlinked

```
gcc -std=gnu99 -shared -fopenmp -L/home/buildslave-sage/slave/sage_git/build/local/lib/   -o libR.so CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cum.o dcf.o datetime.o debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o names.o objects.o options.o paste.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`   ../extra/pcre/libpcre.a ../extra/tre/libtre.a  ../extra/xz/liblzma.a   -lf77blas -latlas -lgfortran -lm -lquadmath   -lreadline  -lz -lrt -ldl -lm  
```
which would go unnoticed if R.bin was compiled with `-lbzlib`. It looks like bzip2 was properly detected at configuration so we should be using the one shipped with sage. I'd ask for the `config.log` but I am fairly certain I won't see anything abnormal there. Still there could be something in there that wasn't printed.



---

archive/issue_comments_252135.json:
```json
{
    "body": "<a id='comment:35'></a>\nMy OSX `config.log` is [here](http://faculty.washington.edu/jpalmier/Sage/config.log).",
    "created_at": "2015-04-25T04:34:56Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252135",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>
My OSX `config.log` is [here](http://faculty.washington.edu/jpalmier/Sage/config.log).



---

archive/issue_comments_252136.json:
```json
{
    "body": "<a id='comment:36'></a>\nNope, nothing as expected. Will have to try to debug the config logic later this evening on my own mac.",
    "created_at": "2015-04-25T04:44:10Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252136",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>
Nope, nothing as expected. Will have to try to debug the config logic later this evening on my own mac.



---

archive/issue_comments_252137.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [charpent](#comment%3A27):\n> Sorry, I still don't have a server publicly available. Google driwe will have to serve...\n\n\n`<OFFTOPIC>`\n\n*Ads by Google*\n\nThere's still [https://spkg-upload.googlecode.com](https://spkg-upload.googlecode.com), but I don't know whether\n\n\n  *\"Use your Gmail account to email Minh Van Nguyen <mvngu putdothere name thefunnyat gmail putdothere com> to request uploading credentials.\"*\n\nstill applies, i.e., whether Minh will respond [in reasonable time].\n\n`</OFFTOPIC>`",
    "created_at": "2015-04-25T21:05:10Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252137",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>
Replying to [charpent](#comment%3A27):
> Sorry, I still don't have a server publicly available. Google driwe will have to serve...


`<OFFTOPIC>`

*Ads by Google*

There's still [https://spkg-upload.googlecode.com](https://spkg-upload.googlecode.com), but I don't know whether


  *"Use your Gmail account to email Minh Van Nguyen <mvngu putdothere name thefunnyat gmail putdothere com> to request uploading credentials."*

still applies, i.e., whether Minh will respond [in reasonable time].

`</OFFTOPIC>`



---

archive/issue_comments_252138.json:
```json
{
    "body": "<a id='comment:38'></a>\nGoogle's code hosting will close in 2016 so its not a good strategy...",
    "created_at": "2015-04-25T21:26:20Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252138",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
Google's code hosting will close in 2016 so its not a good strategy...



---

archive/issue_comments_252139.json:
```json
{
    "body": "<a id='comment:39'></a>\nI was going to comment on that. Otherwise I can just upload it there, I got access. Come to that I probably can put it on the lmona.de server for you and be done with it.",
    "created_at": "2015-04-25T21:28:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252139",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
I was going to comment on that. Otherwise I can just upload it there, I got access. Come to that I probably can put it on the lmona.de server for you and be done with it.



---

archive/issue_comments_252140.json:
```json
{
    "body": "<a id='comment:40'></a>\nMoved from #18254:\n\n\n> [ticket:18254#comment:55 Changed 16 hours ago by fbissey]\n> \n> --without-system-bzlib did the trick. I also noticed that with r-3.1.2 bzip2 was not properly detected during configuration on my mac and therefore the internal copy was used in that case too.\n> \n> [ticket:18254#comment:56 Changed 8 hours ago by jhpalmieri]\n> \n> That works for me, too. All tests pass.\n",
    "created_at": "2015-04-26T04:00:33Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252140",
    "user": "https://trac.sagemath.org/admin/accounts/users/buck"
}
```

<a id='comment:40'></a>
Moved from #18254:


> [ticket:18254#comment:55 Changed 16 hours ago by fbissey]
> 
> --without-system-bzlib did the trick. I also noticed that with r-3.1.2 bzip2 was not properly detected during configuration on my mac and therefore the internal copy was used in that case too.
> 
> [ticket:18254#comment:56 Changed 8 hours ago by jhpalmieri]
> 
> That works for me, too. All tests pass.




---

archive/issue_comments_252141.json:
```json
{
    "body": "**Dependencies:** 18254",
    "created_at": "2015-04-26T04:01:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252141",
    "user": "https://trac.sagemath.org/admin/accounts/users/buck"
}
```

**Dependencies:** 18254



---

archive/issue_comments_252142.json:
```json
{
    "body": "**Changing dependencies** from \"18254\" to \"#18254\".",
    "created_at": "2015-04-26T14:10:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252142",
    "user": "https://github.com/nexttime"
}
```

**Changing dependencies** from "18254" to "#18254".



---

archive/issue_events_163629.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-30T05:27:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163629"
}
```



---

archive/issue_events_163630.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2015-04-30T05:27:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163630"
}
```



---

archive/issue_comments_252143.json:
```json
{
    "body": "<a id='comment:43'></a>\nNote : [https://spkg-upload.googlecode.com/](https://spkg-upload.googlecode.com/) does not accept new uploads (as of last year).\n\nSince #18254 is closed, this patch can be reviewed can be reviewed. Changing status accordingly.",
    "created_at": "2015-04-30T05:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252143",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:43'></a>
Note : [https://spkg-upload.googlecode.com/](https://spkg-upload.googlecode.com/) does not accept new uploads (as of last year).

Since #18254 is closed, this patch can be reviewed can be reviewed. Changing status accordingly.



---

archive/issue_comments_252144.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [fbissey](#comment%3A21):\n> Replying to [charpent](#comment%3A20):\n> > Fran\u00e7ois : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.\n> > \n\n> \n> That's what it looks like yes.\n\n\n- Pillow : contributed to #16759, which might be related.\n- Sphinx : created #18341.\n\nHTH,",
    "created_at": "2015-04-30T06:32:28Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252144",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:44'></a>
Replying to [fbissey](#comment%3A21):
> Replying to [charpent](#comment%3A20):
> > François : If I follow you correctly, you conclude that Pillow, Sphinx and Mirage checksums can only be recreated on a Mac with a pseudo-case-sensitive filesystem ? If so I'd be tempted to call this a (serious) bug and file tickets against them.
> > 

> 
> That's what it looks like yes.


- Pillow : contributed to #16759, which might be related.
- Sphinx : created #18341.

HTH,



---

archive/issue_comments_252145.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [buck](#comment%3A40):\n> Moved from #18254:\n> > [ticket:18254#comment:55 fbissey:]\n> > \n> > --without-system-bzlib did the trick. I also noticed that with r-3.1.2 bzip2 was not properly detected during configuration on my mac and therefore the internal copy was used in that case too.\n> > \n> > [ticket:18254#comment:56 jhpalmieri:]\n> > \n> > That works for me, too. All tests pass.\n\n\nSo this means for MacOS X / Xcode (and only that?) we *currently* (a moving target anyway) would have to configure with `--without-system-bzlib`, or fix the linking issue in another way, on this ticket here, right?\n\nNot using Sage's bzlib would be a temporary solution anyway:\n\n  *\"Building R using the included versions of zlib, bzip2, xz and PCRE is deprecated: these are frozen (bar essential bug-fixes) and will be removed for R 3.3.0.\"*\n\n(So Sage will finally include `xz` as well, such that we can use better compression for the upstream tarballs... :P )",
    "created_at": "2015-05-04T09:02:39Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252145",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'></a>
Replying to [buck](#comment%3A40):
> Moved from #18254:
> > [ticket:18254#comment:55 fbissey:]
> > 
> > --without-system-bzlib did the trick. I also noticed that with r-3.1.2 bzip2 was not properly detected during configuration on my mac and therefore the internal copy was used in that case too.
> > 
> > [ticket:18254#comment:56 jhpalmieri:]
> > 
> > That works for me, too. All tests pass.


So this means for MacOS X / Xcode (and only that?) we *currently* (a moving target anyway) would have to configure with `--without-system-bzlib`, or fix the linking issue in another way, on this ticket here, right?

Not using Sage's bzlib would be a temporary solution anyway:

  *"Building R using the included versions of zlib, bzip2, xz and PCRE is deprecated: these are frozen (bar essential bug-fixes) and will be removed for R 3.3.0."*

(So Sage will finally include `xz` as well, such that we can use better compression for the upstream tarballs... :P )



---

archive/issue_comments_252146.json:
```json
{
    "body": "<a id='comment:46'></a>\nSpeaking of detection of `bzlib` in `R`, I have another annoyance to signal. The test to check the version of `bzlib` in `R`'s configure script is broken with gcc 5.1 - I noticed it in `R-3.2.0` so this is current. A header is missing in the test program they compile. If upstream is serious about the removal, they will notice quickly.",
    "created_at": "2015-05-04T09:13:29Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252146",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
Speaking of detection of `bzlib` in `R`, I have another annoyance to signal. The test to check the version of `bzlib` in `R`'s configure script is broken with gcc 5.1 - I noticed it in `R-3.2.0` so this is current. A header is missing in the test program they compile. If upstream is serious about the removal, they will notice quickly.



---

archive/issue_comments_252147.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [fbissey](#comment%3A46):\n> Speaking of detection of `bzlib` in `R`, I have another annoyance to signal. The test to check the version of `bzlib` in `R`'s configure script is broken with gcc 5.1 - I noticed it in `R-3.2.0` so this is current.\n\n\nYou mean this? 8D\n\n```\nmake[6]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\ngcc-5.1   -I../../src/extra/pcre -I../../src/extra  -I../../src/extra/xz/api -I. -I../../src/include -I../../src/include   -I../../src/nmath -DHAVE_CONFIG_H   -fopenmp -fpic  -g -O2   -c Rmain.c -o Rmain.o\ngcc-5.1 -Wl,--export-dynamic -fopenmp  -L../../lib -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  -o R.bin Rmain.o  -lR \n../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'\n../../lib/libR.so: undefined reference to `BZ2_bzRead'\n../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'\n../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'\n../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'\n../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'\n../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompress'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'\n../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'\n../../lib/libR.so: undefined reference to `BZ2_bzWrite'\n../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'\n../../lib/libR.so: undefined reference to `BZ2_bzReadClose'\ncollect2: error: ld returned 1 exit status\nMakefile:153: recipe for target 'R.bin' failed\nmake[6]: *** [R.bin] Error 1\nmake[6]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nMakefile:143: recipe for target 'R' failed\nmake[5]: *** [R] Error 2\nmake[5]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nMakefile:28: recipe for target 'R' failed\nmake[4]: *** [R] Error 1\nmake[4]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src'\nMakefile:59: recipe for target 'R' failed\nmake[3]: *** [R] Error 1\nmake[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src'\nError building R.\n```",
    "created_at": "2015-05-04T09:22:46Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252147",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:47'></a>
Replying to [fbissey](#comment%3A46):
> Speaking of detection of `bzlib` in `R`, I have another annoyance to signal. The test to check the version of `bzlib` in `R`'s configure script is broken with gcc 5.1 - I noticed it in `R-3.2.0` so this is current.


You mean this? 8D

```
make[6]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
gcc-5.1   -I../../src/extra/pcre -I../../src/extra  -I../../src/extra/xz/api -I. -I../../src/include -I../../src/include   -I../../src/nmath -DHAVE_CONFIG_H   -fopenmp -fpic  -g -O2   -c Rmain.c -o Rmain.o
gcc-5.1 -Wl,--export-dynamic -fopenmp  -L../../lib -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  -o R.bin Rmain.o  -lR 
../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'
../../lib/libR.so: undefined reference to `BZ2_bzRead'
../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'
../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'
../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'
../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'
../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'
../../lib/libR.so: undefined reference to `BZ2_bzDecompress'
../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'
../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'
../../lib/libR.so: undefined reference to `BZ2_bzWrite'
../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'
../../lib/libR.so: undefined reference to `BZ2_bzReadClose'
collect2: error: ld returned 1 exit status
Makefile:153: recipe for target 'R.bin' failed
make[6]: *** [R.bin] Error 1
make[6]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
Makefile:143: recipe for target 'R' failed
make[5]: *** [R] Error 2
make[5]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
Makefile:28: recipe for target 'R' failed
make[4]: *** [R] Error 1
make[4]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src'
Makefile:59: recipe for target 'R' failed
make[3]: *** [R] Error 1
make[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src'
Error building R.
```



---

archive/issue_events_163631.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-04T09:22:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163631"
}
```



---

archive/issue_events_163632.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-04T09:22:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163632"
}
```



---

archive/issue_comments_252148.json:
```json
{
    "body": "**Work_Issues:** Fix detection of bzlib",
    "created_at": "2015-05-04T09:22:46Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252148",
    "user": "https://github.com/nexttime"
}
```

**Work_Issues:** Fix detection of bzlib



---

archive/issue_comments_252149.json:
```json
{
    "body": "<a id='comment:48'></a>\nAlthough I get:\n\n```\n...\nchecking for BZ2_bzlibVersion in -lbz2... yes\nchecking bzlib.h usability... yes\nchecking bzlib.h presence... yes\nchecking for bzlib.h... yes\nchecking if bzip2 version >= 1.0.6... yes\nchecking whether bzip2 support needs to be compiled... no\n...\nR is now configured for x86_64-unknown-linux-gnu\n  ...\n  External libraries:        readline, BLAS(ATLAS), LAPACK(generic), zlib, bzlib\n  ...\n```",
    "created_at": "2015-05-04T09:28:49Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252149",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:48'></a>
Although I get:

```
...
checking for BZ2_bzlibVersion in -lbz2... yes
checking bzlib.h usability... yes
checking bzlib.h presence... yes
checking for bzlib.h... yes
checking if bzip2 version >= 1.0.6... yes
checking whether bzip2 support needs to be compiled... no
...
R is now configured for x86_64-unknown-linux-gnu
  ...
  External libraries:        readline, BLAS(ATLAS), LAPACK(generic), zlib, bzlib
  ...
```



---

archive/issue_comments_252150.json:
```json
{
    "body": "<a id='comment:49'></a>\nAnd in `config.log` I have:\n\n```\n...\nconfigure:34211: checking if bzip2 version >= 1.0.6\nconfigure:34239: gcc-5.1 -o conftest -g -O2  -fpic    -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  conftest.c -lbz2 -lz -lrt -ldl -lm  >&5\nconftest.c: In function 'main':\nconftest.c:254:17: warning: initialization discards 'const' qualifier from pointer target type [-Wdiscarded-qualifiers]\n     char *ver = BZ2_bzlibVersion();\n                 ^\nconftest.c:255:5: warning: implicit declaration of function 'exit' [-Wimplicit-function-declaration]\n     exit(strcmp(ver, \"1.0.6\") < 0);\n     ^\nconftest.c:255:5: warning: incompatible implicit declaration of built-in function 'exit'\nconftest.c:255:5: note: include '<stdlib.h>' or provide a declaration of 'exit'\nconftest.c:255:10: warning: implicit declaration of function 'strcmp' [-Wimplicit-function-declaration]\n     exit(strcmp(ver, \"1.0.6\") < 0);\n          ^\nconfigure:34239: $? = 0\nconfigure:34239: ./conftest\nconfigure:34239: $? = 0\nconfigure:34256: result: yes\nconfigure:34262: checking whether bzip2 support needs to be compiled\nconfigure:34265: result: no\n...\n```\n\nSo detection apparently works for me.",
    "created_at": "2015-05-04T09:38:51Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252150",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
And in `config.log` I have:

```
...
configure:34211: checking if bzip2 version >= 1.0.6
configure:34239: gcc-5.1 -o conftest -g -O2  -fpic    -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  conftest.c -lbz2 -lz -lrt -ldl -lm  >&5
conftest.c: In function 'main':
conftest.c:254:17: warning: initialization discards 'const' qualifier from pointer target type [-Wdiscarded-qualifiers]
     char *ver = BZ2_bzlibVersion();
                 ^
conftest.c:255:5: warning: implicit declaration of function 'exit' [-Wimplicit-function-declaration]
     exit(strcmp(ver, "1.0.6") < 0);
     ^
conftest.c:255:5: warning: incompatible implicit declaration of built-in function 'exit'
conftest.c:255:5: note: include '<stdlib.h>' or provide a declaration of 'exit'
conftest.c:255:10: warning: implicit declaration of function 'strcmp' [-Wimplicit-function-declaration]
     exit(strcmp(ver, "1.0.6") < 0);
          ^
configure:34239: $? = 0
configure:34239: ./conftest
configure:34239: $? = 0
configure:34256: result: yes
configure:34262: checking whether bzip2 support needs to be compiled
configure:34265: result: no
...
```

So detection apparently works for me.



---

archive/issue_comments_252151.json:
```json
{
    "body": "<a id='comment:50'></a>\nI am surprised on my power7 machine I get\n\n```\nchecking zlib.h usability... yes\nchecking zlib.h presence... yes\nchecking for zlib.h... yes\nchecking if zlib version >= 1.2.5... yes\nchecking whether zlib support needs to be compiled... no\nchecking for BZ2_bzlibVersion in -lbz2... yes\nchecking bzlib.h usability... yes\nchecking bzlib.h presence... yes\nchecking for bzlib.h... yes\nchecking if bzip2 version >= 1.0.6... no\nchecking whether bzip2 support needs to be compiled... yes\n```\nBut looking closer I may have misdiagnosed it. I think on that system the wrong library may have been used in the test. That's a problem that has plagued the install of gcc 5.1 itself on that system. It doesn't happen with other version of gcc.",
    "created_at": "2015-05-04T09:45:02Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252151",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:50'></a>
I am surprised on my power7 machine I get

```
checking zlib.h usability... yes
checking zlib.h presence... yes
checking for zlib.h... yes
checking if zlib version >= 1.2.5... yes
checking whether zlib support needs to be compiled... no
checking for BZ2_bzlibVersion in -lbz2... yes
checking bzlib.h usability... yes
checking bzlib.h presence... yes
checking for bzlib.h... yes
checking if bzip2 version >= 1.0.6... no
checking whether bzip2 support needs to be compiled... yes
```
But looking closer I may have misdiagnosed it. I think on that system the wrong library may have been used in the test. That's a problem that has plagued the install of gcc 5.1 itself on that system. It doesn't happen with other version of gcc.



---

archive/issue_comments_252152.json:
```json
{
    "body": "<a id='comment:51'></a>\nWith `R_CONFIGURE=--without-system-bzlib`, I'm getting\n\n```\ngcc-5.1 -shared -fopenmp -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/   -o libR.so CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cum.o dcf.o datetime.o debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o names.o objects.o options.o paste.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`  ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a ../extra/tre/libtre.a  ../extra/xz/liblzma.a   -lf77blas -latlas -lgfortran -lm -lquadmath   -lreadline  -lrt -ldl -lm  \nmake[4]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nmkdir -p -- /tmp/sage-build-tmp/r-3.2.0.p0/src/bin/exec\nmkdir -p -- /tmp/sage-build-tmp/r-3.2.0.p0/src/lib\nmake[4]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nmake[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nmake[3]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\ngcc-5.1  -I../../src/extra/bzip2 -I../../src/extra/pcre -I../../src/extra  -I../../src/extra/xz/api -I. -I../../src/include -I../../src/include   -I../../src/nmath -DHAVE_CONFIG_H   -fopenmp -fpic  -g -O2   -c Rmain.c -o Rmain.o\ngcc-5.1 -Wl,--export-dynamic -fopenmp  -L../../lib -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  -o R.bin Rmain.o  -lR \n../../lib/libR.so: undefined reference to `inflateReset'\n../../lib/libR.so: undefined reference to `inflateEnd'\n../../lib/libR.so: undefined reference to `compress'\n../../lib/libR.so: undefined reference to `deflate'\n../../lib/libR.so: undefined reference to `inflateInit2_'\n../../lib/libR.so: undefined reference to `inflate'\n../../lib/libR.so: undefined reference to `crc32'\n../../lib/libR.so: undefined reference to `deflateEnd'\n../../lib/libR.so: undefined reference to `zlibVersion'\n../../lib/libR.so: undefined reference to `deflateInit2_'\n../../lib/libR.so: undefined reference to `uncompress'\ncollect2: error: ld returned 1 exit status\nMakefile:153: recipe for target 'R.bin' failed\nmake[3]: *** [R.bin] Error 1\nmake[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nMakefile:143: recipe for target 'R' failed\nmake[2]: *** [R] Error 2\nmake[2]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'\nMakefile:28: recipe for target 'R' failed\nmake[1]: *** [R] Error 1\nmake[1]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src'\nMakefile:59: recipe for target 'R' failed\nmake: *** [R] Error 1\nError building R.\n```",
    "created_at": "2015-05-04T09:49:50Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252152",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:51'></a>
With `R_CONFIGURE=--without-system-bzlib`, I'm getting

```
gcc-5.1 -shared -fopenmp -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/   -o libR.so CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cum.o dcf.o datetime.o debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o names.o objects.o options.o paste.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`  ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a ../extra/tre/libtre.a  ../extra/xz/liblzma.a   -lf77blas -latlas -lgfortran -lm -lquadmath   -lreadline  -lrt -ldl -lm  
make[4]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
mkdir -p -- /tmp/sage-build-tmp/r-3.2.0.p0/src/bin/exec
mkdir -p -- /tmp/sage-build-tmp/r-3.2.0.p0/src/lib
make[4]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
make[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
make[3]: Entering directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
gcc-5.1  -I../../src/extra/bzip2 -I../../src/extra/pcre -I../../src/extra  -I../../src/extra/xz/api -I. -I../../src/include -I../../src/include   -I../../src/nmath -DHAVE_CONFIG_H   -fopenmp -fpic  -g -O2   -c Rmain.c -o Rmain.o
gcc-5.1 -Wl,--export-dynamic -fopenmp  -L../../lib -L/data/Sage/release/devel/sage-6.7.beta3-gcc-5.1.0/local/lib/  -o R.bin Rmain.o  -lR 
../../lib/libR.so: undefined reference to `inflateReset'
../../lib/libR.so: undefined reference to `inflateEnd'
../../lib/libR.so: undefined reference to `compress'
../../lib/libR.so: undefined reference to `deflate'
../../lib/libR.so: undefined reference to `inflateInit2_'
../../lib/libR.so: undefined reference to `inflate'
../../lib/libR.so: undefined reference to `crc32'
../../lib/libR.so: undefined reference to `deflateEnd'
../../lib/libR.so: undefined reference to `zlibVersion'
../../lib/libR.so: undefined reference to `deflateInit2_'
../../lib/libR.so: undefined reference to `uncompress'
collect2: error: ld returned 1 exit status
Makefile:153: recipe for target 'R.bin' failed
make[3]: *** [R.bin] Error 1
make[3]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
Makefile:143: recipe for target 'R' failed
make[2]: *** [R] Error 2
make[2]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src/main'
Makefile:28: recipe for target 'R' failed
make[1]: *** [R] Error 1
make[1]: Leaving directory '/tmp/sage-build-tmp/r-3.2.0.p0/src/src'
Makefile:59: recipe for target 'R' failed
make: *** [R] Error 1
Error building R.
```



---

archive/issue_comments_252153.json:
```json
{
    "body": "<a id='comment:52'></a>\n(So there, just `-lz` was missing.)\n\nConfiguring with `--without-system-bzlib --without-system-zlib`, the build succeeds (still with GCC 5.1.0).",
    "created_at": "2015-05-04T10:02:32Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252153",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>
(So there, just `-lz` was missing.)

Configuring with `--without-system-bzlib --without-system-zlib`, the build succeeds (still with GCC 5.1.0).



---

archive/issue_comments_252154.json:
```json
{
    "body": "<a id='comment:53'></a>\nYes, wrong library and I now understand the root cause of some of my problems on that system courtesy of IBM and nothing to do with `R` upstream. Anyway there is something strange going on with bzlib but I have no problem using the internal copy here. That being said I may uncover another surprise from the same source, it would take me a bit of time to disentangle the bits that causes gcc to prefer static libraries on my system and rebuild it. \n\nVery strange both zlib and bzlib, does bzlib depend on zlib somehow?",
    "created_at": "2015-05-04T10:03:46Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252154",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>
Yes, wrong library and I now understand the root cause of some of my problems on that system courtesy of IBM and nothing to do with `R` upstream. Anyway there is something strange going on with bzlib but I have no problem using the internal copy here. That being said I may uncover another surprise from the same source, it would take me a bit of time to disentangle the bits that causes gcc to prefer static libraries on my system and rebuild it. 

Very strange both zlib and bzlib, does bzlib depend on zlib somehow?



---

archive/issue_comments_252155.json:
```json
{
    "body": "<a id='comment:54'></a>\nNow that I have removed the interfering library from the system I can compile `R` with an external bzlib library and gcc 5.1.0 and I don't experience any of these troubles. \n\nStill there are problems linking an external bzlib on OS X and gcc 5.1.0 - on some systems. This is very strange. Does the failed libR.so have an entry for libbz2 at all?",
    "created_at": "2015-05-04T10:26:23Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252155",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:54'></a>
Now that I have removed the interfering library from the system I can compile `R` with an external bzlib library and gcc 5.1.0 and I don't experience any of these troubles. 

Still there are problems linking an external bzlib on OS X and gcc 5.1.0 - on some systems. This is very strange. Does the failed libR.so have an entry for libbz2 at all?



---

archive/issue_comments_252156.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [fbissey](#comment%3A53):\n> Very strange both zlib and bzlib, does bzlib depend on zlib somehow?\n\n\nNo.\n\nI've so far not found anything suspicious in `configure`; the libs get added to `LIBS` if the \"system\" versions are used, so the failing magic must be somewhere in the Makefiles (or some R config thingy these use).",
    "created_at": "2015-05-04T10:27:25Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252156",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:55'></a>
Replying to [fbissey](#comment%3A53):
> Very strange both zlib and bzlib, does bzlib depend on zlib somehow?


No.

I've so far not found anything suspicious in `configure`; the libs get added to `LIBS` if the "system" versions are used, so the failing magic must be somewhere in the Makefiles (or some R config thingy these use).



---

archive/issue_comments_252157.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [fbissey](#comment%3A54):\n> Still there are problems linking an external bzlib on OS X and gcc 5.1.0 - on some systems. This is very strange. Does the failed libR.so have an entry for libbz2 at all?\n\n\nNo, but for libz when I configure without anything special (using system libraries for both libz and libbz2):\n\n```\nDynamic section at offset 0x3363f8 contains 36 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libz.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n```",
    "created_at": "2015-05-04T10:40:38Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252157",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:56'></a>
Replying to [fbissey](#comment%3A54):
> Still there are problems linking an external bzlib on OS X and gcc 5.1.0 - on some systems. This is very strange. Does the failed libR.so have an entry for libbz2 at all?


No, but for libz when I configure without anything special (using system libraries for both libz and libbz2):

```
Dynamic section at offset 0x3363f8 contains 36 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libz.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
```



---

archive/issue_comments_252158.json:
```json
{
    "body": "<a id='comment:57'></a>\nWhen configuring with just `--without-system-bzlib` `libz` vanishes as expected (regarding the missing symbols reported):\n\n```\nDynamic section at offset 0x343978 contains 35 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n```",
    "created_at": "2015-05-04T10:45:29Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252158",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:57'></a>
When configuring with just `--without-system-bzlib` `libz` vanishes as expected (regarding the missing symbols reported):

```
Dynamic section at offset 0x343978 contains 35 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
```



---

archive/issue_comments_252159.json:
```json
{
    "body": "<a id='comment:58'></a>\n(And they're missing in the command building libR.so, cf. the very long lines some posts above.)",
    "created_at": "2015-05-04T10:50:23Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252159",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:58'></a>
(And they're missing in the command building libR.so, cf. the very long lines some posts above.)



---

archive/issue_comments_252160.json:
```json
{
    "body": "<a id='comment:59'></a>\nIn the Makefile (in `src/src/main`) of the last attempt, we have:\n\n```\n## use an explicit library: there might be an unsatisfactory -lz around\nR_ZLIBS = # ../extra/zlib/libz.a\nR_BZLIBS =  ../extra/bzip2/libbz2.a\nR_PCRE =  ../extra/pcre/libpcre.a\nR_TRE =  ../extra/tre/libtre.a\nR_XDR = # ../extra/xdr/libxdr.a\nR_XZ =   ../extra/xz/liblzma.a\nR_LIBINTL = # ../extra/intl/libintl.a\nR_TZONE = # ../extra/tzone/libtz.a\n\nMAIN_LIBS = ../unix/libunix.a ../appl/libappl.a ../nmath/libnmath.a\nMAIN_OBJS = `ls ../unix/*.o ../appl/*.o ../nmath/*.o`\nEXTRA_STATIC_LIBS = \\\n  $(R_ZLIBS) $(R_BZLIBS) $(R_PCRE) $(R_TRE) $(R_XDR) $(R_XZ) $(R_LIBINTL) $(R_TZONE)\nSTATIC_LIBS = $(MAIN_LIBS) $(EXTRA_STATIC_LIBS)\n\nEXTRA_LIBS = $(BLAS_LIBS) $(FLIBS) $(R_XTRA_LIBS)  $(READLINE_LIBS) $(LIBS)\n\nR_binary = R.bin\nR_bin_OBJECTS = Rmain.o #$(OBJECTS)\n#R_bin_LDADD = $(MAIN_OBJS) $(EXTRA_STATIC_LIBS) $(EXTRA_LIBS)\n## Linked against -lRblas becasue -lR is and otherwise ld complains.\nR_bin_LDADD = -lR #-lRblas\nR_bin_DEPENDENCIES =# libR.a # $(top_builddir)/etc/R.exp\n\nlibR_la = libR$(DYLIB_EXT)\nlibR_la_OBJECTS = $(OBJECTS)\nlibR_la_LIBADD =  $(MAIN_OBJS) $(EXTRA_STATIC_LIBS) $(EXTRA_LIBS)  # -Wl,-bE:$(top_builddir)/etc/R.exp\nlibR_la_DEPENDENCIES = $(STATIC_LIBS) $(R_TZONE)  # $(top_builddir)/etc/R.exp\n```\nso somehow `LIBS` got messed up (libz dropped) somewhere on the way.",
    "created_at": "2015-05-04T11:06:57Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252160",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:59'></a>
In the Makefile (in `src/src/main`) of the last attempt, we have:

```
## use an explicit library: there might be an unsatisfactory -lz around
R_ZLIBS = # ../extra/zlib/libz.a
R_BZLIBS =  ../extra/bzip2/libbz2.a
R_PCRE =  ../extra/pcre/libpcre.a
R_TRE =  ../extra/tre/libtre.a
R_XDR = # ../extra/xdr/libxdr.a
R_XZ =   ../extra/xz/liblzma.a
R_LIBINTL = # ../extra/intl/libintl.a
R_TZONE = # ../extra/tzone/libtz.a

MAIN_LIBS = ../unix/libunix.a ../appl/libappl.a ../nmath/libnmath.a
MAIN_OBJS = `ls ../unix/*.o ../appl/*.o ../nmath/*.o`
EXTRA_STATIC_LIBS = \
  $(R_ZLIBS) $(R_BZLIBS) $(R_PCRE) $(R_TRE) $(R_XDR) $(R_XZ) $(R_LIBINTL) $(R_TZONE)
STATIC_LIBS = $(MAIN_LIBS) $(EXTRA_STATIC_LIBS)

EXTRA_LIBS = $(BLAS_LIBS) $(FLIBS) $(R_XTRA_LIBS)  $(READLINE_LIBS) $(LIBS)

R_binary = R.bin
R_bin_OBJECTS = Rmain.o #$(OBJECTS)
#R_bin_LDADD = $(MAIN_OBJS) $(EXTRA_STATIC_LIBS) $(EXTRA_LIBS)
## Linked against -lRblas becasue -lR is and otherwise ld complains.
R_bin_LDADD = -lR #-lRblas
R_bin_DEPENDENCIES =# libR.a # $(top_builddir)/etc/R.exp

libR_la = libR$(DYLIB_EXT)
libR_la_OBJECTS = $(OBJECTS)
libR_la_LIBADD =  $(MAIN_OBJS) $(EXTRA_STATIC_LIBS) $(EXTRA_LIBS)  # -Wl,-bE:$(top_builddir)/etc/R.exp
libR_la_DEPENDENCIES = $(STATIC_LIBS) $(R_TZONE)  # $(top_builddir)/etc/R.exp
```
so somehow `LIBS` got messed up (libz dropped) somewhere on the way.



---

archive/issue_comments_252161.json:
```json
{
    "body": "<a id='comment:60'></a>\nIn `src/Makeconf`, we already have just\n\n```\n## These are the libs which the final R.bin/libR is linked against.\n## Many of these used to be optional: ICU libs still are.\n## There may be platform-specific ones, e.g.\n## -lrt -ldl on Linux, -lnsl -lsocket -lrt -lsunmath -ldl -liconv on Solaris.\nLIBS =  -lrt -ldl -lm\n```",
    "created_at": "2015-05-04T11:14:08Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252161",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:60'></a>
In `src/Makeconf`, we already have just

```
## These are the libs which the final R.bin/libR is linked against.
## Many of these used to be optional: ICU libs still are.
## There may be platform-specific ones, e.g.
## -lrt -ldl on Linux, -lnsl -lsocket -lrt -lsunmath -ldl -liconv on Solaris.
LIBS =  -lrt -ldl -lm
```



---

archive/issue_comments_252162.json:
```json
{
    "body": "<a id='comment:61'></a>\nYou could check what you get for `LIBS` in `config.log` and `config.status`, I'll look at what is going on on OS X.",
    "created_at": "2015-05-04T11:30:36Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252162",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:61'></a>
You could check what you get for `LIBS` in `config.log` and `config.status`, I'll look at what is going on on OS X.



---

archive/issue_comments_252163.json:
```json
{
    "body": "<a id='comment:62'></a>\nYep, just found the \"truncated\" one in `config.status`, so it's apparent\u013ay a `configure` problem:\n\n```\nS[\"LIBS\"]=\" -lrt -ldl -lm\"\n```",
    "created_at": "2015-05-04T11:34:06Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252163",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:62'></a>
Yep, just found the "truncated" one in `config.status`, so it's apparentĺy a `configure` problem:

```
S["LIBS"]=" -lrt -ldl -lm"
```



---

archive/issue_comments_252164.json:
```json
{
    "body": "<a id='comment:63'></a>\nFinal results goes in the top `Makefile`. Why does `configure` behaves that way on some system and not some other. Dissecting on OS X.",
    "created_at": "2015-05-04T11:40:26Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252164",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:63'></a>
Final results goes in the top `Makefile`. Why does `configure` behaves that way on some system and not some other. Dissecting on OS X.



---

archive/issue_comments_252165.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [fbissey](#comment%3A63):\n> Why does `configure` behaves that way on some system and not some other. Dissecting on OS X.\n\n\nWell, the behaviour presumably depends on the outcome of some other tests in `configure`, such that sometimes the accumulated `LIBS` get clobbered.\n\nBtw., it's not GCC 5.1; same with GCC 4.9 here.",
    "created_at": "2015-05-04T12:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252165",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:64'></a>
Replying to [fbissey](#comment%3A63):
> Why does `configure` behaves that way on some system and not some other. Dissecting on OS X.


Well, the behaviour presumably depends on the outcome of some other tests in `configure`, such that sometimes the accumulated `LIBS` get clobbered.

Btw., it's not GCC 5.1; same with GCC 4.9 here.



---

archive/issue_comments_252166.json:
```json
{
    "body": "<a id='comment:65'></a>\nGetting closer...\n\nIn the PCRE checks, `LIBS` gets restored from `r_save_LIBS`, but that's (in my case) an obsolete value, because `r_save_LIBS` didn't get set in *that* check (i.e., the conditions for saving and restoring aren't the same).",
    "created_at": "2015-05-04T15:45:50Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252166",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:65'></a>
Getting closer...

In the PCRE checks, `LIBS` gets restored from `r_save_LIBS`, but that's (in my case) an obsolete value, because `r_save_LIBS` didn't get set in *that* check (i.e., the conditions for saving and restoring aren't the same).



---

archive/issue_comments_252167.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [leif](#comment%3A65):\n> Getting closer...\n> \n> In the PCRE checks, `LIBS` gets restored from `r_save_LIBS`, but that's (in my case) an obsolete value, because `r_save_LIBS` didn't get set in *that* check (i.e., the conditions for saving and restoring aren't the same).\n\n\nI *think* it's this:\n\n```diff\n--- m4/R.m4.orig\t2015-03-19 00:02:06.000000000 +0100\n+++ m4/R.m4\t2015-05-04 18:09:13.742304005 +0200\n@@ -3107,11 +3107,11 @@\n #endif\n }\n ]])], [r_cv_have_pcre810=yes], [r_cv_have_pcre810=no], [r_cv_have_pcre810=no])])\n-fi\n if test \"x${r_cv_have_pcre810}\" != xyes; then\n   have_pcre=no\n   LIBS=\"${r_save_LIBS}\"\n fi\n+fi\n AC_MSG_CHECKING([whether PCRE support needs to be compiled])\n if test \"x${r_cv_have_pcre810}\" = xyes; then\n   AC_MSG_RESULT([no])\n```",
    "created_at": "2015-05-04T16:11:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252167",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:66'></a>
Replying to [leif](#comment%3A65):
> Getting closer...
> 
> In the PCRE checks, `LIBS` gets restored from `r_save_LIBS`, but that's (in my case) an obsolete value, because `r_save_LIBS` didn't get set in *that* check (i.e., the conditions for saving and restoring aren't the same).


I *think* it's this:

```diff
--- m4/R.m4.orig	2015-03-19 00:02:06.000000000 +0100
+++ m4/R.m4	2015-05-04 18:09:13.742304005 +0200
@@ -3107,11 +3107,11 @@
 #endif
 }
 ]])], [r_cv_have_pcre810=yes], [r_cv_have_pcre810=no], [r_cv_have_pcre810=no])])
-fi
 if test "x${r_cv_have_pcre810}" != xyes; then
   have_pcre=no
   LIBS="${r_save_LIBS}"
 fi
+fi
 AC_MSG_CHECKING([whether PCRE support needs to be compiled])
 if test "x${r_cv_have_pcre810}" = xyes; then
   AC_MSG_RESULT([no])
```



---

archive/issue_comments_252168.json:
```json
{
    "body": "<a id='comment:67'></a>\nCorresponding patch to `configure`:\n\n```diff\n--- R-3.2.0/configure.orig\t2015-04-09 00:16:36.000000000 +0200\n+++ R-3.2.0/configure\t2015-05-04 18:19:37.942304048 +0200\n@@ -34543,11 +34543,11 @@\n fi\n { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $r_cv_have_pcre810\" >&5\n $as_echo \"$r_cv_have_pcre810\" >&6; }\n-fi\n if test \"x${r_cv_have_pcre810}\" != xyes; then\n   have_pcre=no\n   LIBS=\"${r_save_LIBS}\"\n fi\n+fi\n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether PCRE support needs to be compiled\" >&5\n $as_echo_n \"checking whether PCRE support needs to be compiled... \" >&6; }\n if test \"x${r_cv_have_pcre810}\" = xyes; then\n```\n\nWorks for me (so far outside of Sage).  May work on MacOS X as well (omitting `--without-system-*`), but probably there'll be further problems when Sage's libs are used.",
    "created_at": "2015-05-04T16:34:20Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252168",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:67'></a>
Corresponding patch to `configure`:

```diff
--- R-3.2.0/configure.orig	2015-04-09 00:16:36.000000000 +0200
+++ R-3.2.0/configure	2015-05-04 18:19:37.942304048 +0200
@@ -34543,11 +34543,11 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $r_cv_have_pcre810" >&5
 $as_echo "$r_cv_have_pcre810" >&6; }
-fi
 if test "x${r_cv_have_pcre810}" != xyes; then
   have_pcre=no
   LIBS="${r_save_LIBS}"
 fi
+fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether PCRE support needs to be compiled" >&5
 $as_echo_n "checking whether PCRE support needs to be compiled... " >&6; }
 if test "x${r_cv_have_pcre810}" = xyes; then
```

Works for me (so far outside of Sage).  May work on MacOS X as well (omitting `--without-system-*`), but probably there'll be further problems when Sage's libs are used.



---

archive/attachments_020659.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "dont_lose_libz_libbz2_in_configure.patch",
    "asset_url": "tarball://root/attachments/ticket18229/dont_lose_libz_libbz2_in_configure.patch",
    "created_at": "2015-05-04T17:09:39Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket18229/dont_lose_libz_libbz2_in_configure.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_252169.json:
```json
{
    "body": "Attachment [dont_lose_libz_libbz2_in_configure.patch](https://github.com/sagemath/sage/files/ticket18229/dont_lose_libz_libbz2_in_configure.patch) by @nexttime created at 2015-05-04 17:09:39\n\nTentative patch (to be put into `build/pkgs/r/patches/`)",
    "created_at": "2015-05-04T17:09:39Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252169",
    "user": "https://github.com/nexttime"
}
```

Attachment [dont_lose_libz_libbz2_in_configure.patch](https://github.com/sagemath/sage/files/ticket18229/dont_lose_libz_libbz2_in_configure.patch) by @nexttime created at 2015-05-04 17:09:39

Tentative patch (to be put into `build/pkgs/r/patches/`)



---

archive/issue_comments_252170.json:
```json
{
    "body": "<a id='comment:68'></a>\nAttached patch of course works outside of Sage as well.",
    "created_at": "2015-05-04T17:11:21Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252170",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:68'></a>
Attached patch of course works outside of Sage as well.



---

archive/issue_comments_252171.json:
```json
{
    "body": "<a id='comment:69'></a>\n\n```\n...\nSuccessfully installed r-3.2.0.p0\n...\n$ readelf -d local/lib/R/lib/libR.so \n\nDynamic section at offset 0x336418 contains 37 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libbz2.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libz.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n...\n```",
    "created_at": "2015-05-04T17:18:23Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252171",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:69'></a>

```
...
Successfully installed r-3.2.0.p0
...
$ readelf -d local/lib/R/lib/libR.so 

Dynamic section at offset 0x336418 contains 37 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libf77blas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libatlas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libgfortran.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libquadmath.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libreadline.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libbz2.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libz.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [librt.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libgomp.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
...
```



---

archive/issue_comments_252172.json:
```json
{
    "body": "**Changing branch** from \"[u/charpent/upgrade_r_to_3_1_3](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/upgrade_r_to_3_1_3)\" to \"[u/leif/R_upgrade_with_new_patch](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/R_upgrade_with_new_patch)\".",
    "created_at": "2015-05-04T17:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252172",
    "user": "https://github.com/nexttime"
}
```

**Changing branch** from "[u/charpent/upgrade_r_to_3_1_3](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/upgrade_r_to_3_1_3)" to "[u/leif/R_upgrade_with_new_patch](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/R_upgrade_with_new_patch)".



---

archive/issue_comments_252173.json:
```json
{
    "body": "**Changing work_issues** from \"Fix detection of bzlib\" to \"\".",
    "created_at": "2015-05-04T17:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252173",
    "user": "https://github.com/nexttime"
}
```

**Changing work_issues** from "Fix detection of bzlib" to "".



---

archive/issue_comments_252174.json:
```json
{
    "body": "<a id='comment:70'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571\">b0f4e43</a></td><td><code>Upgrade R to 3.1.3. Passes ptestlong (All tests passed\\!).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62\">ab208a4</a></td><td><code>Upgrade R to 3.2.0. passes ptestlong (All tests passed\\!).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6685ddd5a1ca87f7fec0205e5120dcf354d1e243\">6685ddd</a></td><td><code>Merge branch 'u/charpent/upgrade_r_to_3_1_3' of trac.sagemath.org:sage into R_upgrade_18229</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf\">bc2269e</a></td><td><code>Add patch to avoid R 3.2.0's 'configure' losing libraries from LIBS (#18229)</code></td></tr></table>\n",
    "created_at": "2015-05-04T17:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252174",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:70'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0f4e43a2f36cf349387a645cb6bd9bd6bc7d571">b0f4e43</a></td><td><code>Upgrade R to 3.1.3. Passes ptestlong (All tests passed\!).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62">ab208a4</a></td><td><code>Upgrade R to 3.2.0. passes ptestlong (All tests passed\!).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6685ddd5a1ca87f7fec0205e5120dcf354d1e243">6685ddd</a></td><td><code>Merge branch 'u/charpent/upgrade_r_to_3_1_3' of trac.sagemath.org:sage into R_upgrade_18229</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf">bc2269e</a></td><td><code>Add patch to avoid R 3.2.0's 'configure' losing libraries from LIBS (#18229)</code></td></tr></table>




---

archive/issue_comments_252175.json:
```json
{
    "body": "**Changing commit** from \"[ab208a4e69834c786a2f0d4ff5a2626776db4d62](https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62)\" to \"[bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf](https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf)\".",
    "created_at": "2015-05-04T17:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252175",
    "user": "https://github.com/nexttime"
}
```

**Changing commit** from "[ab208a4e69834c786a2f0d4ff5a2626776db4d62](https://github.com/sagemath/sagetrac-mirror/commit/ab208a4e69834c786a2f0d4ff5a2626776db4d62)" to "[bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf](https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf)".



---

archive/issue_comments_252176.json:
```json
{
    "body": "**Changing author** from \"Emmanuel Charpentier\" to \"Emmanuel Charpentier, Leif Leonhardy\".",
    "created_at": "2015-05-04T17:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252176",
    "user": "https://github.com/nexttime"
}
```

**Changing author** from "Emmanuel Charpentier" to "Emmanuel Charpentier, Leif Leonhardy".



---

archive/issue_events_163633.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-04T17:34:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163633"
}
```



---

archive/issue_events_163634.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-04T17:34:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163634"
}
```



---

archive/issue_comments_252177.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,13 @@\n It's that time of the year again (and I'm late...).\n+\n+\n+---\n+\n \n Renamed source tarball available from:\n \n     http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz\n+\n+We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).\n+\n+\n``````\n",
    "created_at": "2015-05-04T17:55:20Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252177",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,13 @@
 It's that time of the year again (and I'm late...).
+
+
+---
+
 
 Renamed source tarball available from:
 
     http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz
+
+We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).
+
+
``````




---

archive/issue_comments_252178.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,4 @@\n \n     http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz\n \n-We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).\n-\n-\n+We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).  ([Upstream report](https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16364))\n``````\n",
    "created_at": "2015-05-04T18:55:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252178",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,4 @@
 
     http://www.labri.fr/perso/vdelecro/r-3.2.0.tar.gz
 
-We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).
-
-
+We add a new patch to fix a bug in the `R_PCRE` autoconf macro which leads to `configure` losing `-lz` and `-lbz2` from `LIBS` under certain circumstances, when using Sage's versions of these libraries (as opposed to letting R build its own, which we don't want).  ([Upstream report](https://bugs.r-project.org/bugzilla/show_bug.cgi?id=16364))
``````




---

archive/issue_comments_252179.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2015-05-04T18:55:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252179",
    "user": "https://github.com/nexttime"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_252180.json:
```json
{
    "body": "<a id='comment:72'></a>\nPatch now submitted upstream.",
    "created_at": "2015-05-04T18:55:35Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252180",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:72'></a>
Patch now submitted upstream.



---

archive/issue_comments_252181.json:
```json
{
    "body": "<a id='comment:73'></a>\nOn two different OS X 10.10 machines, one with Xcode 6.1, one with 6.3.1: R builds and passes its self tests, and Sage passes all tests with `make ptestlong`.",
    "created_at": "2015-05-04T19:44:32Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252181",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:73'></a>
On two different OS X 10.10 machines, one with Xcode 6.1, one with 6.3.1: R builds and passes its self tests, and Sage passes all tests with `make ptestlong`.



---

archive/issue_comments_252182.json:
```json
{
    "body": "<a id='comment:74'></a>\nBy the way, here is a typo in `spkg-install`. Can we fix it on this ticket?\n\n```diff\ndiff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install\nindex 06a340d..fb2f35a 100755\n--- a/build/pkgs/r/spkg-install\n+++ b/build/pkgs/r/spkg-install\n@@ -161,7 +161,7 @@ if [ \"$UNAME\" = \"Darwin\" ]; then\n     # On systems using LD_LIBRARY_PATH, both Sage and R modify it and R wins,\n     # so no problem should occur.\n     if [ -d \"$SAGE_LOCAL\"/lib/R ]; then\n-        RINSTALL_MOVED = yes\n+        RINSTALL_MOVED=yes\n         mv \"$SAGE_LOCAL\"/lib/R \"$SAGE_LOCAL\"/lib/R.old\n     fi\n fi\n```",
    "created_at": "2015-05-04T20:25:54Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252182",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:74'></a>
By the way, here is a typo in `spkg-install`. Can we fix it on this ticket?

```diff
diff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install
index 06a340d..fb2f35a 100755
--- a/build/pkgs/r/spkg-install
+++ b/build/pkgs/r/spkg-install
@@ -161,7 +161,7 @@ if [ "$UNAME" = "Darwin" ]; then
     # On systems using LD_LIBRARY_PATH, both Sage and R modify it and R wins,
     # so no problem should occur.
     if [ -d "$SAGE_LOCAL"/lib/R ]; then
-        RINSTALL_MOVED = yes
+        RINSTALL_MOVED=yes
         mv "$SAGE_LOCAL"/lib/R "$SAGE_LOCAL"/lib/R.old
     fi
 fi
```



---

archive/issue_comments_252183.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [jhpalmieri](#comment%3A74):\n> By the way, here is a typo in `spkg-install`. Can we fix it on this ticket?\n\n\nGo ahead if you care. I'll review it.\n\nBut I'm a little frightened : this is the **third** time that the port of a new version of R, which is a mindless affair, is hijacked for an unrelated bug (which, by the way, never gets repertoried under a proper heading !). Is filing a *different* bug that hard ?\n\n[ Bandwidth savings ... ]",
    "created_at": "2015-05-04T20:49:58Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252183",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:75'></a>
Replying to [jhpalmieri](#comment%3A74):
> By the way, here is a typo in `spkg-install`. Can we fix it on this ticket?


Go ahead if you care. I'll review it.

But I'm a little frightened : this is the **third** time that the port of a new version of R, which is a mindless affair, is hijacked for an unrelated bug (which, by the way, never gets repertoried under a proper heading !). Is filing a *different* bug that hard ?

[ Bandwidth savings ... ]



---

archive/issue_comments_252184.json:
```json
{
    "body": "<a id='comment:76'></a>\nNo it is not hard. I am guessing some people find it terribly inconvenient. I am guilty in indulging leif in continuing on this ticket.",
    "created_at": "2015-05-04T21:12:13Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252184",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:76'></a>
No it is not hard. I am guessing some people find it terribly inconvenient. I am guilty in indulging leif in continuing on this ticket.



---

archive/issue_comments_252185.json:
```json
{
    "body": "<a id='comment:77'></a>\n? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).",
    "created_at": "2015-05-04T21:26:22Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252185",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:77'></a>
? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).



---

archive/issue_comments_252186.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [leif](#comment%3A77):\n> ? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).\n\n\n1. This version introduced the bug : you're right, as far as I can tell. Your case seems to be a corner case.\n2. It's the same problem : no. This is, as far as I understand, a problem with the build infrastructure of Sage. The new R version just revealed a latent bug in a very loosely related part of this infrastructure.\n\nIf I'd found this bug, I'd have opened a distinct ticket (T2) and made the present ticket (T1) depend on the new ticket (T2). That way, each different problem would have been identified in the tickets database. As should have been done when a previous version of R opened a Cygwin-related saga...\n\nAm I clearer ?",
    "created_at": "2015-05-04T21:44:11Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252186",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:78'></a>
Replying to [leif](#comment%3A77):
> ? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).


1. This version introduced the bug : you're right, as far as I can tell. Your case seems to be a corner case.
2. It's the same problem : no. This is, as far as I understand, a problem with the build infrastructure of Sage. The new R version just revealed a latent bug in a very loosely related part of this infrastructure.

If I'd found this bug, I'd have opened a distinct ticket (T2) and made the present ticket (T1) depend on the new ticket (T2). That way, each different problem would have been identified in the tickets database. As should have been done when a previous version of R opened a Cygwin-related saga...

Am I clearer ?



---

archive/issue_comments_252187.json:
```json
{
    "body": "<a id='comment:79'></a>\nBefore I fix the \"typo\", could someone translate (i.e., rephrase) the following such that it makes sense?\n\n```\n    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process\n    # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly\n    # built one which will get loaded during the build process and if they are\n    # different versions then the build process might fail.\n```\n\nMaybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *\"whereas\"* doesn't make sense to me.",
    "created_at": "2015-05-04T21:48:54Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252187",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:79'></a>
Before I fix the "typo", could someone translate (i.e., rephrase) the following such that it makes sense?

```
    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process
    # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly
    # built one which will get loaded during the build process and if they are
    # different versions then the build process might fail.
```

Maybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *"whereas"* doesn't make sense to me.



---

archive/issue_comments_252188.json:
```json
{
    "body": "<a id='comment:80'></a>\nIt should be prudent to check the (forthcoming) patch by jhpalmieri on a 32-bit (virtual) machine (which I don't have) before accepting it.\n\nReplying to [vbraun](#comment%3A33):\n> Also fails on Linux 32-bit:\n> \n> ```\n> gcc -std=gnu99 -Wl,--export-dynamic -fopenmp  -L../../lib -L/home/buildslave-sage/slave/sage_git/build/local/lib/  -o R.bin Rmain.o  -lR \n> ../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'\n> ../../lib/libR.so: undefined reference to `BZ2_bzRead'\n> ../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'\n> ../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'\n> ../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'\n> ../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'\n> ../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'\n> ../../lib/libR.so: undefined reference to `BZ2_bzDecompress'\n> ../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'\n> ../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'\n> ../../lib/libR.so: undefined reference to `BZ2_bzWrite'\n> ../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'\n> ../../lib/libR.so: undefined reference to `BZ2_bzReadClose'\n> collect2: error: ld returned 1 exit status\n> ```\n> Full log: http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/259/steps/compile/logs/r-project\n",
    "created_at": "2015-05-04T21:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252188",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:80'></a>
It should be prudent to check the (forthcoming) patch by jhpalmieri on a 32-bit (virtual) machine (which I don't have) before accepting it.

Replying to [vbraun](#comment%3A33):
> Also fails on Linux 32-bit:
> 
> ```
> gcc -std=gnu99 -Wl,--export-dynamic -fopenmp  -L../../lib -L/home/buildslave-sage/slave/sage_git/build/local/lib/  -o R.bin Rmain.o  -lR 
> ../../lib/libR.so: undefined reference to `BZ2_bzReadGetUnused'
> ../../lib/libR.so: undefined reference to `BZ2_bzRead'
> ../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffCompress'
> ../../lib/libR.so: undefined reference to `BZ2_bzBuffToBuffDecompress'
> ../../lib/libR.so: undefined reference to `BZ2_bzWriteClose'
> ../../lib/libR.so: undefined reference to `BZ2_bzWriteOpen'
> ../../lib/libR.so: undefined reference to `BZ2_bzReadOpen'
> ../../lib/libR.so: undefined reference to `BZ2_bzDecompress'
> ../../lib/libR.so: undefined reference to `BZ2_bzDecompressEnd'
> ../../lib/libR.so: undefined reference to `BZ2_bzDecompressInit'
> ../../lib/libR.so: undefined reference to `BZ2_bzWrite'
> ../../lib/libR.so: undefined reference to `BZ2_bzlibVersion'
> ../../lib/libR.so: undefined reference to `BZ2_bzReadClose'
> collect2: error: ld returned 1 exit status
> ```
> Full log: http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/259/steps/compile/logs/r-project




---

archive/issue_comments_252189.json:
```json
{
    "body": "<a id='comment:81'></a>\nDoesn't that means that R and Sage do **different**, possibly incompatible, changes to DYLD_LIBRARY_PATH ?\n\nReplying to [leif](#comment%3A79):\n> Before I fix the \"typo\", could someone translate (i.e., rephrase) the following such that it makes sense?\n> \n> ```\n>     # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process\n>     # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly\n>     # built one which will get loaded during the build process and if they are\n>     # different versions then the build process might fail.\n> ```\n> \n> Maybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *\"whereas\"* doesn't make sense to me.\n",
    "created_at": "2015-05-04T21:53:41Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252189",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:81'></a>
Doesn't that means that R and Sage do **different**, possibly incompatible, changes to DYLD_LIBRARY_PATH ?

Replying to [leif](#comment%3A79):
> Before I fix the "typo", could someone translate (i.e., rephrase) the following such that it makes sense?
> 
> ```
>     # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process
>     # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly
>     # built one which will get loaded during the build process and if they are
>     # different versions then the build process might fail.
> ```
> 
> Maybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *"whereas"* doesn't make sense to me.




---

archive/issue_comments_252190.json:
```json
{
    "body": "<a id='comment:82'></a>\nPossibly `{DY}LD_LIBRARY_PATH` plain `LD_LIBRARY_PATH` is linux but `DYLD_LIBRARY_PATH` is OS X's version.\n\nsage does load the appropriate one so its libraries are found first but of course during the building process `R` does its own overloading to find the stuff from the just built `R` when building the standard `R` packages. In principle this should be done by augmentation but I have seen libtool doing broken things before (in octave it inserts `/usr/lib64` which completely defeat the purpose of the variable).",
    "created_at": "2015-05-04T21:57:05Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252190",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:82'></a>
Possibly `{DY}LD_LIBRARY_PATH` plain `LD_LIBRARY_PATH` is linux but `DYLD_LIBRARY_PATH` is OS X's version.

sage does load the appropriate one so its libraries are found first but of course during the building process `R` does its own overloading to find the stuff from the just built `R` when building the standard `R` packages. In principle this should be done by augmentation but I have seen libtool doing broken things before (in octave it inserts `/usr/lib64` which completely defeat the purpose of the variable).



---

archive/issue_comments_252191.json:
```json
{
    "body": "<a id='comment:83'></a>\nReplying to [leif](#comment%3A79):\n> Before I fix the \"typo\", could someone translate (i.e., rephrase) the following such that it makes sense?\n> \n> ```\n>     # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process\n>     # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly\n>     # built one which will get loaded during the build process and if they are\n>     # different versions then the build process might fail.\n> ```\n> \n> Maybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *\"whereas\"* doesn't make sense to me.\n\n\nI'm guessing that this comes from ticket:14706#comment:101, in which case, the second version should say `DYLD_FALLBACK_LIBRARY_PATH`.",
    "created_at": "2015-05-04T22:00:26Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252191",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:83'></a>
Replying to [leif](#comment%3A79):
> Before I fix the "typo", could someone translate (i.e., rephrase) the following such that it makes sense?
> 
> ```
>     # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process
>     # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly
>     # built one which will get loaded during the build process and if they are
>     # different versions then the build process might fail.
> ```
> 
> Maybe I'm blind or just dumb, but I twice read `DYLD_LIBRARY_PATH` -- the second occurrence should probably read `LD_LIBRARY_PATH`, otherwise *"whereas"* doesn't make sense to me.


I'm guessing that this comes from ticket:14706#comment:101, in which case, the second version should say `DYLD_FALLBACK_LIBRARY_PATH`.



---

archive/issue_comments_252192.json:
```json
{
    "body": "<a id='comment:84'></a>\nJohn makes a lot of sense here, that fits the kind of things we want to achieve.",
    "created_at": "2015-05-04T22:02:06Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252192",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:84'></a>
John makes a lot of sense here, that fits the kind of things we want to achieve.



---

archive/issue_comments_252193.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [charpent](#comment%3A80):\n> It should be prudent to check the (forthcoming) patch by jhpalmieri on a 32-bit (virtual) machine (which I don't have) before accepting it.\n> \n> Replying to [vbraun](#comment%3A33):\n> > Also fails on Linux 32-bit:\n> > [snip]\n\n\nMy suggestion should only have an effect on OS X: it's in a block starting\n\n```\nif [ \"$UNAME\" = \"Darwin\" ]; then\n```\nAnd it is just a mistake in the shell script, yielding a (non-fatal) error\n\n```\n./spkg-install: line 164: RINSTALL_MOVED: command not found\n```\nevery time you try to install R on an OS X machine.",
    "created_at": "2015-05-04T22:09:16Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252193",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:85'></a>
Replying to [charpent](#comment%3A80):
> It should be prudent to check the (forthcoming) patch by jhpalmieri on a 32-bit (virtual) machine (which I don't have) before accepting it.
> 
> Replying to [vbraun](#comment%3A33):
> > Also fails on Linux 32-bit:
> > [snip]


My suggestion should only have an effect on OS X: it's in a block starting

```
if [ "$UNAME" = "Darwin" ]; then
```
And it is just a mistake in the shell script, yielding a (non-fatal) error

```
./spkg-install: line 164: RINSTALL_MOVED: command not found
```
every time you try to install R on an OS X machine.



---

archive/issue_comments_252194.json:
```json
{
    "body": "<a id='comment:86'></a>\nReplying to [charpent](#comment%3A78):\n> Replying to [leif](#comment%3A77):\n> > ? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).\n\n> \n> 1. This version introduced the bug : you're right, as far as I can tell. Your case seems to be a corner case.\n\n\nDid you read the upstream report?\n\n\n\n\n> 2. It's the same problem : no. \n\n\nSame as what?\n\n\n\n\n> This is, as far as I understand, a problem with the build infrastructure of Sage.\n\n\nNope.  The same happens outside of Sage.\n\n\n\n\n> The new R version just revealed a latent bug in a very loosely related part of this infrastructure.\n\n\nBug in Sage's infrastructure?  I don't get the point.\n\n\n\n\n> If I'd found this bug, I'd have opened a distinct ticket (T2) and made the present ticket (T1) depend on the new ticket (T2).\n\n\nWell, technically that doesn't really make sense, since I cannot fix something that hasn't yet been included.  (#18254 is *slightly* different as it modifies an existing file, namely `spkg-install`.)  My changes are based on your branch.\n\nI would agree if we could make this ticket depend on upstream, but then it wouldn't be possible to (positively) review it before upstream decided on a solution.\n\n\n\n\n> That way, each different problem would have been identified in the tickets database. As should have been done when a previous version of R opened a Cygwin-related saga...\n\n\nWe at least have different commits with IMHO meaningful commit messages... (which unfortunately often isn't the case).\n\nYou probably know my opinion on (not) bumping patch levels and discarding the package changelog we used to have for years.\n\nSometimes it is better to also fix \"unrelated\" minor issues (such as the typo) on a ticket dealing with a package (nowadays probably less than it was with \"legacy\" spkgs), since otherwise they'll simply never get fixed, either because nobody opens individual tickets for them, or  the tickets just rotten.\n\nThe prerequisite for inclusion of a new (or upgraded) package is that it builds/works on all supported platforms, so fixing build issues (and probably fixing doctests, cf. the PARI upgrade at #18340, which was motivated by an initially seemingly unrelated problem with GNU make) belongs to the ticket that introduces (or upgrades) a package.\n\nThere are other issues where it perfectly makes sense to open (a metaticket and) separate (sub-)tickets, e.g. to let Sage build with GCC 5.x (four tickets for four different packages which need fixing), or to let Sage build with `clang` (dozens of tickets).\n\n*[page overflow]*",
    "created_at": "2015-05-04T23:01:29Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252194",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:86'></a>
Replying to [charpent](#comment%3A78):
> Replying to [leif](#comment%3A77):
> > ? Fixing the bug in `R_PCRE` certainly belongs to upgrading R to 3.2.0, since the new version introduced the bug, and as you have seen, it hits at least some of us (depending on the system configuration).

> 
> 1. This version introduced the bug : you're right, as far as I can tell. Your case seems to be a corner case.


Did you read the upstream report?




> 2. It's the same problem : no. 


Same as what?




> This is, as far as I understand, a problem with the build infrastructure of Sage.


Nope.  The same happens outside of Sage.




> The new R version just revealed a latent bug in a very loosely related part of this infrastructure.


Bug in Sage's infrastructure?  I don't get the point.




> If I'd found this bug, I'd have opened a distinct ticket (T2) and made the present ticket (T1) depend on the new ticket (T2).


Well, technically that doesn't really make sense, since I cannot fix something that hasn't yet been included.  (#18254 is *slightly* different as it modifies an existing file, namely `spkg-install`.)  My changes are based on your branch.

I would agree if we could make this ticket depend on upstream, but then it wouldn't be possible to (positively) review it before upstream decided on a solution.




> That way, each different problem would have been identified in the tickets database. As should have been done when a previous version of R opened a Cygwin-related saga...


We at least have different commits with IMHO meaningful commit messages... (which unfortunately often isn't the case).

You probably know my opinion on (not) bumping patch levels and discarding the package changelog we used to have for years.

Sometimes it is better to also fix "unrelated" minor issues (such as the typo) on a ticket dealing with a package (nowadays probably less than it was with "legacy" spkgs), since otherwise they'll simply never get fixed, either because nobody opens individual tickets for them, or  the tickets just rotten.

The prerequisite for inclusion of a new (or upgraded) package is that it builds/works on all supported platforms, so fixing build issues (and probably fixing doctests, cf. the PARI upgrade at #18340, which was motivated by an initially seemingly unrelated problem with GNU make) belongs to the ticket that introduces (or upgrades) a package.

There are other issues where it perfectly makes sense to open (a metaticket and) separate (sub-)tickets, e.g. to let Sage build with GCC 5.x (four tickets for four different packages which need fixing), or to let Sage build with `clang` (dozens of tickets).

*[page overflow]*



---

archive/issue_comments_252195.json:
```json
{
    "body": "<a id='comment:87'></a>\nLast chance for further changes: ;-)\n\n```diff\ndiff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install\nindex 06a340d..f02bea9 100755\n--- a/build/pkgs/r/spkg-install\n+++ b/build/pkgs/r/spkg-install\n@@ -153,15 +153,15 @@ if [ $? -ne 0 ]; then\n fi\n \n if [ \"$UNAME\" = \"Darwin\" ]; then\n-    # We have to move old installs of R when upgrading R in Sage on OS X.\n-    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process\n-    # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly\n-    # built one which will get loaded during the build process and if they are\n-    # different versions then the build process might fail.\n+    # We have to move (i.e., hide) old installs of R when upgrading R in Sage on OS X.\n+    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R's build process\n+    # modifies DYLD_FALLBACK_LIBRARY_PATH, so that it is Sage's R and not the freshly\n+    # built one which will get loaded during the build process; in case the versions\n+    # differ, the build process might fail.\n     # On systems using LD_LIBRARY_PATH, both Sage and R modify it and R wins,\n     # so no problem should occur.\n     if [ -d \"$SAGE_LOCAL\"/lib/R ]; then\n-        RINSTALL_MOVED = yes\n+        RINSTALL_MOVED=yes\n         mv \"$SAGE_LOCAL\"/lib/R \"$SAGE_LOCAL\"/lib/R.old\n     fi\n fi\n```",
    "created_at": "2015-05-04T23:42:47Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252195",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:87'></a>
Last chance for further changes: ;-)

```diff
diff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install
index 06a340d..f02bea9 100755
--- a/build/pkgs/r/spkg-install
+++ b/build/pkgs/r/spkg-install
@@ -153,15 +153,15 @@ if [ $? -ne 0 ]; then
 fi
 
 if [ "$UNAME" = "Darwin" ]; then
-    # We have to move old installs of R when upgrading R in Sage on OS X.
-    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R build process
-    # modifies DYLD_LIBRARY_PATH, so that it is Sage's R and not the freshly
-    # built one which will get loaded during the build process and if they are
-    # different versions then the build process might fail.
+    # We have to move (i.e., hide) old installs of R when upgrading R in Sage on OS X.
+    # Indeed Sage modifies DYLD_LIBRARY_PATH whereas R's build process
+    # modifies DYLD_FALLBACK_LIBRARY_PATH, so that it is Sage's R and not the freshly
+    # built one which will get loaded during the build process; in case the versions
+    # differ, the build process might fail.
     # On systems using LD_LIBRARY_PATH, both Sage and R modify it and R wins,
     # so no problem should occur.
     if [ -d "$SAGE_LOCAL"/lib/R ]; then
-        RINSTALL_MOVED = yes
+        RINSTALL_MOVED=yes
         mv "$SAGE_LOCAL"/lib/R "$SAGE_LOCAL"/lib/R.old
     fi
 fi
```



---

archive/issue_comments_252196.json:
```json
{
    "body": "<a id='comment:88'></a>\nLooks good to me. I would be happy if you went ahead with the change.",
    "created_at": "2015-05-05T00:04:15Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252196",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:88'></a>
Looks good to me. I would be happy if you went ahead with the change.



---

archive/issue_comments_252197.json:
```json
{
    "body": "<a id='comment:89'></a>\nNo further changes here. Let's gets this to review now.",
    "created_at": "2015-05-05T00:12:31Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252197",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:89'></a>
No further changes here. Let's gets this to review now.



---

archive/issue_comments_252198.json:
```json
{
    "body": "<a id='comment:90'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8\">f451e9a</a></td><td><code>Fix typo in R's spkg-install (potentially causing a syntax error on MacOS X) (#18229)</code></td></tr></table>\n",
    "created_at": "2015-05-05T01:17:53Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:90'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8">f451e9a</a></td><td><code>Fix typo in R's spkg-install (potentially causing a syntax error on MacOS X) (#18229)</code></td></tr></table>




---

archive/issue_comments_252199.json:
```json
{
    "body": "**Changing commit** from \"[bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf](https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf)\" to \"[f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)\".",
    "created_at": "2015-05-05T01:17:53Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf](https://github.com/sagemath/sagetrac-mirror/commit/bc2269e64ccb2f5fcc83cf62085eeeb53d7e1dcf)" to "[f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)".



---

archive/issue_comments_252200.json:
```json
{
    "body": "<a id='comment:91'></a>\nReplying to [git](#comment%3A90):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8\">f451e9a</a></td><td><code>Fix typo in R's spkg-install (potentially causing a syntax error on MacOS X) (#18229)</code></td></tr></table>\n\nIt's not a syntax error, it's the shell running the command `RINSTALL_MOVED` with 2 arguments `=` and `yes`.",
    "created_at": "2015-05-05T06:02:37Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252200",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:91'></a>
Replying to [git](#comment%3A90):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8">f451e9a</a></td><td><code>Fix typo in R's spkg-install (potentially causing a syntax error on MacOS X) (#18229)</code></td></tr></table>

It's not a syntax error, it's the shell running the command `RINSTALL_MOVED` with 2 arguments `=` and `yes`.



---

archive/issue_comments_252201.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [jdemeyer](#comment%3A91):\n> It's not a syntax error, it's the shell running the command `RINSTALL_MOVED` with 2 arguments `=` and `yes`.\n\n\nIt's a *potential* syntax error, depending on how `R_INSTALL_MOVED` is defined ... ;-)\n\n```sh\n$ R_INSTALL_MOVED(){ expr $@; } \n$ R_INSTALL_MOVED = yes\nexpr: syntax error\n```",
    "created_at": "2015-05-05T06:14:45Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252201",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:92'></a>
Replying to [jdemeyer](#comment%3A91):
> It's not a syntax error, it's the shell running the command `RINSTALL_MOVED` with 2 arguments `=` and `yes`.


It's a *potential* syntax error, depending on how `R_INSTALL_MOVED` is defined ... ;-)

```sh
$ R_INSTALL_MOVED(){ expr $@; } 
$ R_INSTALL_MOVED = yes
expr: syntax error
```



---

archive/issue_comments_252202.json:
```json
{
    "body": "<a id='comment:93'></a>\nTypo.  `s/R_INSTALL_MOVED/RINSTALL_MOVED/g`",
    "created_at": "2015-05-05T06:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252202",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:93'></a>
Typo.  `s/R_INSTALL_MOVED/RINSTALL_MOVED/g`



---

archive/issue_comments_252203.json:
```json
{
    "body": "<a id='comment:94'></a>\n6.7beta3+f451e9a builds and passes make ptestlong on Debian testing 64 bits.\n\nI'd rather have corroborating evidence on Mac OS X and Linux 32 bits before setting \"positive_review\" (and I won't set it since I am one of the authors...).",
    "created_at": "2015-05-05T06:31:23Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252203",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:94'></a>
6.7beta3+f451e9a builds and passes make ptestlong on Debian testing 64 bits.

I'd rather have corroborating evidence on Mac OS X and Linux 32 bits before setting "positive_review" (and I won't set it since I am one of the authors...).



---

archive/issue_comments_252204.json:
```json
{
    "body": "<a id='comment:95'></a>\n*One day<sup>TM</sup>* we should also really\n\n```sh\nrm -rf \"${TMPDIR:-/tmp}\"/Rtmp*\n```\nafter building (or installing) R.",
    "created_at": "2015-05-06T06:28:41Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252204",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:95'></a>
*One day<sup>TM</sup>* we should also really

```sh
rm -rf "${TMPDIR:-/tmp}"/Rtmp*
```
after building (or installing) R.



---

archive/issue_comments_252205.json:
```json
{
    "body": "<a id='comment:96'></a>\n6.7beta4+f451e9a builds and passes \"make ptestlong\" on Debian testing amd64, albeit with one failure :\n` sage -t --long --warn-long 66.8 src/sage/interfaces/expect.py  # 1 doctest failed `\nThis doctest succeeds when presented alone:\n\n```\ncharpent@asus16-ec:/usr/local/sage-6.7$ sage -t --long --warn-long 66.8 src/sage/interfaces/expect.py\nRunning doctests with ID 2015-05-08-20-24-57-6dd95266.\nGit branch: mabranche\nDoctesting 1 file.\nsage -t --long --warn-long 66.8 src/sage/interfaces/expect.py\n    [77 tests, 5.90 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 5.9 seconds\n    cpu time: 0.2 seconds\n    cumulative wall time: 5.9 seconds\n```\n...and is known to be triggered by a loaded machine. To I'd give it a \"positive_review\" if\n1) I wasn't one of the authors, and\n2) I' had corroboration on x86 and Mac.\n\nAny takers ? Fran\u00e7ois, any hope in seeing this tested on your Mac ? Volker, any news on the x86 front ?",
    "created_at": "2015-05-08T18:35:30Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252205",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:96'></a>
6.7beta4+f451e9a builds and passes "make ptestlong" on Debian testing amd64, albeit with one failure :
` sage -t --long --warn-long 66.8 src/sage/interfaces/expect.py  # 1 doctest failed `
This doctest succeeds when presented alone:

```
charpent@asus16-ec:/usr/local/sage-6.7$ sage -t --long --warn-long 66.8 src/sage/interfaces/expect.py
Running doctests with ID 2015-05-08-20-24-57-6dd95266.
Git branch: mabranche
Doctesting 1 file.
sage -t --long --warn-long 66.8 src/sage/interfaces/expect.py
    [77 tests, 5.90 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5.9 seconds
    cpu time: 0.2 seconds
    cumulative wall time: 5.9 seconds
```
...and is known to be triggered by a loaded machine. To I'd give it a "positive_review" if
1) I wasn't one of the authors, and
2) I' had corroboration on x86 and Mac.

Any takers ? François, any hope in seeing this tested on your Mac ? Volker, any news on the x86 front ?



---

archive/issue_comments_252206.json:
```json
{
    "body": "<a id='comment:97'></a>\nI am looking at it right now from scratch with 6.7.beta4. Silly stuff, because this doesn't depend on #18156 switching to this branch removes the fix to gcc from 6.7.beta4. So I lost a couple of hours of building while I was doing the week end shopping.",
    "created_at": "2015-05-08T23:33:21Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252206",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:97'></a>
I am looking at it right now from scratch with 6.7.beta4. Silly stuff, because this doesn't depend on #18156 switching to this branch removes the fix to gcc from 6.7.beta4. So I lost a couple of hours of building while I was doing the week end shopping.



---

archive/issue_comments_252207.json:
```json
{
    "body": "<a id='comment:98'></a>\nSend it to the bots...",
    "created_at": "2015-05-09T04:08:24Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252207",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:98'></a>
Send it to the bots...



---

archive/issue_events_163635.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-09T04:08:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163635"
}
```



---

archive/issue_events_163636.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-09T04:08:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163636"
}
```



---

archive/issue_comments_252208.json:
```json
{
    "body": "<a id='comment:99'></a>\nReplying to [fbissey](#comment%3A98):\n> Send it to the bots...\n\n\nThank you, Fran\u00e7ois ! Any news from the x86 front ?",
    "created_at": "2015-05-09T05:43:53Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252208",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:99'></a>
Replying to [fbissey](#comment%3A98):
> Send it to the bots...


Thank you, François ! Any news from the x86 front ?



---

archive/issue_comments_252209.json:
```json
{
    "body": "**Changing reviewer** from \"Vincent Delecroix\" to \"Vincent Delecroix, Fran\u00e7ois Bissey, Leif Leonhardy\".",
    "created_at": "2015-05-09T06:15:31Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252209",
    "user": "https://github.com/kiwifb"
}
```

**Changing reviewer** from "Vincent Delecroix" to "Vincent Delecroix, François Bissey, Leif Leonhardy".



---

archive/issue_comments_252210.json:
```json
{
    "body": "<a id='comment:0'></a>\nNot as such, but I am fairly sure leif solved the bzip2 problem that was cropping up randomly. I can confirm the fix works on several platform. I am personally satisfied that this as been vetted beyond the call of duty. If there are any more issues the bots will tell us. Fill free to edit the authors and reviewer fields as you see fit.",
    "created_at": "2015-05-09T06:15:31Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252210",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Not as such, but I am fairly sure leif solved the bzip2 problem that was cropping up randomly. I can confirm the fix works on several platform. I am personally satisfied that this as been vetted beyond the call of duty. If there are any more issues the bots will tell us. Fill free to edit the authors and reviewer fields as you see fit.



---

archive/issue_comments_252211.json:
```json
{
    "body": "**Changing dependencies** from \"#18254\" to \"#18254, #15642\".",
    "created_at": "2015-05-12T20:25:36Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252211",
    "user": "https://github.com/vbraun"
}
```

**Changing dependencies** from "#18254" to "#18254, #15642".



---

archive/issue_comments_252212.json:
```json
{
    "body": "**Changing branch** from \"[u/leif/R_upgrade_with_new_patch](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/R_upgrade_with_new_patch)\" to \"[f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)\".",
    "created_at": "2015-05-14T22:40:13Z",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18229#issuecomment-252212",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/leif/R_upgrade_with_new_patch](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/R_upgrade_with_new_patch)" to "[f451e9a5227d73fc5ab8719857a4d17aae129eb8](https://github.com/sagemath/sagetrac-mirror/commit/f451e9a5227d73fc5ab8719857a4d17aae129eb8)".



---

archive/issue_events_163637.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-14T22:40:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163637"
}
```



---

archive/issue_events_163638.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-14T22:40:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18229",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18229#event-163638"
}
```
