# Issue 18333: Cleanup and speedup in QQbar

archive/issues_018096.json:
```json
{
    "body": "This is a task ticket for speed up and cleaning in `sage.rings.qqbar`\n\nPrerequisites on number fields/polynomials/interval arithmetic\n- #18332: implement `is_integer` and `is_rational` on number field elements\n- #18334: implement `unique_sign` and `unique_trunc` on interval field elements\n- #18337: implement `real` and `imag` on real intervals\n- #17830: consider the natural order induced from `RR` for number fields with real embedding\n- #19362, #28191: refine root\n- #18356: implement composed_op from [BFSS]\n- #19824: faster comparison for (real) embedded number fields\n- #24503: enhanced `LazyAlgebraic`\n\nTasks in `AA/QQbar`:\n- #18303: better comparisons\n- #17886, #18242: faster exactification operations using power series and resultants (see also #18356)\n- #15600: exactification is slow in `do_polred`\n- #16222, #18122, #31889: enhanced minpoly\n- #19954 and #19955: remove all descriptors except `ANRoot`, `ANExtension` and `ANRational`\n- #20074: simplify method dispatcher for binary operators\n- #12745: conversion issue `QQbar -> AA`\n- #18106: introduce a polynomial descriptor, make sum and product be n-ary instead of binary and get rid of recursive calls\n- #12715: number field embeddings should always have target in `AA` or `QQbar`\n- #19356: QQbar.polynomial_root(): allow approximate root\n- #21095: slowness in exactification\n- #21838: do not make appear the imaginary (or real) part in QQbar when it is known to be zero\n- #5574: Implement QQbar<sup>QQ</sup> as action\n- use firstly interval arithmetic for `sign`/`floor`/`ceil`/`trunc`/`round` instead of the `_floor_ceil` helper\n- remove the following methods from `ANDescr`:\n   - `rational_value`\n   - `is_field_element`\n   - `is_exact`\n- (?) enhanced `sage_input` for `ANExtension`\n- better powering (`__pow__`) using `ANExtension` and fix convention for powering in `AA` vs `QQbar`\n- reimplement `_real_refine_interval` without these ugly dictionaries (see also #17895)\n- use directly embedded number fields in `AlgebraicGenerator` as comparison there is faster (see #17830 and #19824). We might want that these embedded number field carries an interval of fixed precision with them  (let say `64`) to avoid reevaluation in most cases\n- #26944: improve hashing to avoid exact computations\n- more generally, track down code in qqbar.py that may lead to larger extensions than necessary if an exact computation is triggered (for example, see if the formulas in `ANUnaryExpr.exactify()` can be optimized).\n- #31767: more capable sign \n\nBugs\n\n- #20209: `QQbar -> RIF` conversion fails\n- #12745: Coercion problem with Algebraic Real Field\n- #20288: representation and mutability of the description\n\nCC:  @mezzarobba @gagern @cheuberg\n\nAuthor: Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/18333\n\n",
    "created_at": "2015-04-29T12:09:02Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "Cleanup and speedup in QQbar",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18333",
    "user": "https://github.com/videlec"
}
```
This is a task ticket for speed up and cleaning in `sage.rings.qqbar`

Prerequisites on number fields/polynomials/interval arithmetic
- #18332: implement `is_integer` and `is_rational` on number field elements
- #18334: implement `unique_sign` and `unique_trunc` on interval field elements
- #18337: implement `real` and `imag` on real intervals
- #17830: consider the natural order induced from `RR` for number fields with real embedding
- #19362, #28191: refine root
- #18356: implement composed_op from [BFSS]
- #19824: faster comparison for (real) embedded number fields
- #24503: enhanced `LazyAlgebraic`

Tasks in `AA/QQbar`:
- #18303: better comparisons
- #17886, #18242: faster exactification operations using power series and resultants (see also #18356)
- #15600: exactification is slow in `do_polred`
- #16222, #18122, #31889: enhanced minpoly
- #19954 and #19955: remove all descriptors except `ANRoot`, `ANExtension` and `ANRational`
- #20074: simplify method dispatcher for binary operators
- #12745: conversion issue `QQbar -> AA`
- #18106: introduce a polynomial descriptor, make sum and product be n-ary instead of binary and get rid of recursive calls
- #12715: number field embeddings should always have target in `AA` or `QQbar`
- #19356: QQbar.polynomial_root(): allow approximate root
- #21095: slowness in exactification
- #21838: do not make appear the imaginary (or real) part in QQbar when it is known to be zero
- #5574: Implement QQbar<sup>QQ</sup> as action
- use firstly interval arithmetic for `sign`/`floor`/`ceil`/`trunc`/`round` instead of the `_floor_ceil` helper
- remove the following methods from `ANDescr`:
   - `rational_value`
   - `is_field_element`
   - `is_exact`
- (?) enhanced `sage_input` for `ANExtension`
- better powering (`__pow__`) using `ANExtension` and fix convention for powering in `AA` vs `QQbar`
- reimplement `_real_refine_interval` without these ugly dictionaries (see also #17895)
- use directly embedded number fields in `AlgebraicGenerator` as comparison there is faster (see #17830 and #19824). We might want that these embedded number field carries an interval of fixed precision with them  (let say `64`) to avoid reevaluation in most cases
- #26944: improve hashing to avoid exact computations
- more generally, track down code in qqbar.py that may lead to larger extensions than necessary if an exact computation is triggered (for example, see if the formulas in `ANUnaryExpr.exactify()` can be optimized).
- #31767: more capable sign 

Bugs

- #20209: `QQbar -> RIF` conversion fails
- #12745: Coercion problem with Algebraic Real Field
- #20288: representation and mutability of the description

CC:  @mezzarobba @gagern @cheuberg

Author: Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/18333





---

archive/issue_comments_243573.json:
```json
{
    "body": "<a id='comment:11'></a>about slowness of QQbar, see #19910.",
    "created_at": "2016-01-18T17:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18333#issuecomment-243573",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:11'></a>about slowness of QQbar, see #19910.



---

archive/issue_events_051740.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-18T19:32:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18333",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18333#event-51740"
}
```



---

archive/issue_comments_243574.json:
```json
{
    "body": "<a id='comment:16'></a>There's an issue on QQBar element powering reported in [#18836 comment 9](http://trac.sagemath.org/ticket/18836#comment:9) that may have interaction with what you're doing here (perhaps you're solving the issue?). Perhaps it's worthwhile including that problem in this QQbar cleanup operation somewhere.",
    "created_at": "2016-02-17T07:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18333#issuecomment-243574",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:16'></a>There's an issue on QQBar element powering reported in [#18836 comment 9](http://trac.sagemath.org/ticket/18836#comment:9) that may have interaction with what you're doing here (perhaps you're solving the issue?). Perhaps it's worthwhile including that problem in this QQbar cleanup operation somewhere.



---

archive/issue_comments_243575.json:
```json
{
    "body": "<a id='comment:30'></a>- [sage-devel, 2021-04-29: The sign() method in QQbar overlooks some (presumably) easy shortcuts](https://groups.google.com/g/sage-devel/c/OaUlf5VHBbc)",
    "created_at": "2021-04-29T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18333#issuecomment-243575",
    "user": "https://github.com/slel"
}
```

<a id='comment:30'></a>- [sage-devel, 2021-04-29: The sign() method in QQbar overlooks some (presumably) easy shortcuts](https://groups.google.com/g/sage-devel/c/OaUlf5VHBbc)
