# Issue 18922: Speedup creation of spin crystals

archive/issues_018685.json:
```json
{
    "body": "Currently, when we construct a spin crystal, we build the full digraph to implement a comparison operation. This ticket, in effect, makes constructing the digraph a lazy attribute which gets called when doing the comparison operation.\n\nAssignee: sage-combinat\n\nCC:  sage-combinat @anneschilling\n\nKeywords: spin crystals\n\nBranch/Commit: d237ec2e56b50959510fcab2f9f58c2d255fe271\n\nReviewer: Anne Schilling\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18922\n\n",
    "closed_at": "2015-08-07T07:31:32Z",
    "created_at": "2015-07-19T12:55:54Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Speedup creation of spin crystals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18922",
    "user": "https://github.com/tscrim"
}
```
Currently, when we construct a spin crystal, we build the full digraph to implement a comparison operation. This ticket, in effect, makes constructing the digraph a lazy attribute which gets called when doing the comparison operation.

Assignee: sage-combinat

CC:  sage-combinat @anneschilling

Keywords: spin crystals

Branch/Commit: d237ec2e56b50959510fcab2f9f58c2d255fe271

Reviewer: Anne Schilling

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18922





---

archive/issue_comments_271018.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-19T13:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271018",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271019.json:
```json
{
    "body": "<a id='comment:1'></a>I also did some cleanup:\n\n- I removed the caching of the elements since the e/f operations aren't cached (which I think is where the real speed gains are) and it was a hack IMO.\n\n- I removed the `list` command because that (and the respective caching) is done by `FiniteEnumeratedSets` (and will result in a speedup for iteration after calling `.list()` once).\n \n---\nNew commits:",
    "created_at": "2015-07-19T13:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271019",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>I also did some cleanup:

- I removed the caching of the elements since the e/f operations aren't cached (which I think is where the real speed gains are) and it was a hack IMO.

- I removed the `list` command because that (and the respective caching) is done by `FiniteEnumeratedSets` (and will result in a speedup for iteration after calling `.list()` once).
 
---
New commits:



---

archive/issue_comments_271020.json:
```json
{
    "body": "<a id='comment:2'></a>Instead of deleting the tests for the methods that you removed, it would be better if they would be moved (perhaps as tests for the class). Also, could you provide timings and an example where this was a problem before?\n\nThanks,\n\nAnne",
    "created_at": "2015-07-21T11:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271020",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:2'></a>Instead of deleting the tests for the methods that you removed, it would be better if they would be moved (perhaps as tests for the class). Also, could you provide timings and an example where this was a problem before?

Thanks,

Anne



---

archive/issue_comments_271021.json:
```json
{
    "body": "<a id='comment:3'></a>The `.list()` test is already in the function which creates the B<sub>n</sub> spin crystal object, so I just added back the element construction example to the `_element_constructor_` and added a test to check for consistency. Here are my timings.\n\nWith branch:\n\n```\nsage: %time C = crystals.SpinsPlus(['D',6])\nCPU times: user 472 \u00b5s, sys: 58 \u00b5s, total: 530 \u00b5s\nWall time: 542 \u00b5s\nsage: %time C = crystals.SpinsPlus(['D',7])\nCPU times: user 453 \u00b5s, sys: 56 \u00b5s, total: 509 \u00b5s\nWall time: 523 \u00b5s\nsage: %time C = crystals.SpinsMinus(['D',8])\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 956 \u00b5s\nsage: %time C = crystals.Spins(['B',10])\nCPU times: user 488 \u00b5s, sys: 56 \u00b5s, total: 544 \u00b5s\nWall time: 490 \u00b5s\n```\nBefore:\n\n```\nsage: %time C = crystals.SpinsPlus(['D',6])\nCPU times: user 465 ms, sys: 69.7 ms, total: 535 ms\nWall time: 549 ms\nsage: %time C = crystals.SpinsPlus(['D',7])\nCPU times: user 52 ms, sys: 12.7 ms, total: 64.7 ms\nWall time: 58.6 ms\nsage: %time C = crystals.SpinsMinus(['D',8])\nCPU times: user 223 ms, sys: 20.6 ms, total: 244 ms\nWall time: 228 ms\nsage: %time C = crystals.Spins(['B',10])\nI got tired after waiting for 10 minutes and killed it and then ran this:\nsage: %time C = crystals.Spins(['B',8])\nCPU times: user 2.59 s, sys: 24 ms, total: 2.61 s\nWall time: 2.58 s\n```",
    "created_at": "2015-07-21T13:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271021",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>The `.list()` test is already in the function which creates the B<sub>n</sub> spin crystal object, so I just added back the element construction example to the `_element_constructor_` and added a test to check for consistency. Here are my timings.

With branch:

```
sage: %time C = crystals.SpinsPlus(['D',6])
CPU times: user 472 µs, sys: 58 µs, total: 530 µs
Wall time: 542 µs
sage: %time C = crystals.SpinsPlus(['D',7])
CPU times: user 453 µs, sys: 56 µs, total: 509 µs
Wall time: 523 µs
sage: %time C = crystals.SpinsMinus(['D',8])
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 956 µs
sage: %time C = crystals.Spins(['B',10])
CPU times: user 488 µs, sys: 56 µs, total: 544 µs
Wall time: 490 µs
```
Before:

```
sage: %time C = crystals.SpinsPlus(['D',6])
CPU times: user 465 ms, sys: 69.7 ms, total: 535 ms
Wall time: 549 ms
sage: %time C = crystals.SpinsPlus(['D',7])
CPU times: user 52 ms, sys: 12.7 ms, total: 64.7 ms
Wall time: 58.6 ms
sage: %time C = crystals.SpinsMinus(['D',8])
CPU times: user 223 ms, sys: 20.6 ms, total: 244 ms
Wall time: 228 ms
sage: %time C = crystals.Spins(['B',10])
I got tired after waiting for 10 minutes and killed it and then ran this:
sage: %time C = crystals.Spins(['B',8])
CPU times: user 2.59 s, sys: 24 ms, total: 2.61 s
Wall time: 2.58 s
```



---

archive/issue_comments_271022.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-21T13:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271023.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-05T16:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271024.json:
```json
{
    "body": "<a id='comment:6'></a>Ok, looks good!",
    "created_at": "2015-08-06T17:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271024",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:6'></a>Ok, looks good!



---

archive/issue_comments_271025.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-06T17:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271025",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271026.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-07T07:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18922#issuecomment-271026",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052798.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-07T07:31:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18922",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18922#event-52798"
}
```
