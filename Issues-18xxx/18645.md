# Issue 18645: Add some methods to CartanMatrix

archive/issues_018408.json:
```json
{
    "body": "This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`, and `indecomposable_blocks()`.\n\n\nAssignee: jonathan.judge\n\nCC:  @bsalisbury1 @tscrim sage-combinat @dwbump khlee @nthiery vripoll @jplab jmichel\n\nKeywords: days65\n\nBranch/Commit: dca9b68d339238ef43c614dbd459ce41ee4c80d9\n\nReviewer: Ben Salisbury, Travis Scrimshaw\n\nAuthor: Jonathan Judge\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18645\n\n",
    "closed_at": "2015-06-20T18:23:20Z",
    "created_at": "2015-06-08T23:21:36Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Add some methods to CartanMatrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18645",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```
This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`, and `indecomposable_blocks()`.


Assignee: jonathan.judge

CC:  @bsalisbury1 @tscrim sage-combinat @dwbump khlee @nthiery vripoll @jplab jmichel

Keywords: days65

Branch/Commit: dca9b68d339238ef43c614dbd459ce41ee4c80d9

Reviewer: Ben Salisbury, Travis Scrimshaw

Author: Jonathan Judge

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18645





---

archive/issue_comments_331588.json:
```json
{
    "body": "Changing keywords from \"\" to \"days65\".",
    "created_at": "2015-06-08T23:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331588",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Changing keywords from "" to "days65".



---

archive/issue_comments_331589.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jonathan.judge/add_some_methods_to_cartanmatrix\"",
    "created_at": "2015-06-09T06:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331589",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Changing branch from "" to "u/jonathan.judge/add_some_methods_to_cartanmatrix"



---

archive/issue_comments_331590.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|\n|[77f1bf6](https://github.com/sagemath/sagetrac-mirror/commit/77f1bf6eced4549e4ea433d1904f273f4057baac)|`Added methods is_indefinite(), is_hyperbolic(), is_indecomposable(), and principal_submatrices() to the class CartanMatrix`|",
    "created_at": "2015-06-09T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331590",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|
|[77f1bf6](https://github.com/sagemath/sagetrac-mirror/commit/77f1bf6eced4549e4ea433d1904f273f4057baac)|`Added methods is_indefinite(), is_hyperbolic(), is_indecomposable(), and principal_submatrices() to the class CartanMatrix`|



---

archive/issue_comments_331591.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-09T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331591",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331592.json:
```json
{
    "body": "Changing commit from \"\" to \"77f1bf6eced4549e4ea433d1904f273f4057baac\"",
    "created_at": "2015-06-09T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331592",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Changing commit from "" to "77f1bf6eced4549e4ea433d1904f273f4057baac"



---

archive/issue_comments_331593.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Jon,\n\nPatch looks good, documentation looks good, and all tests passed.\n\n```\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 2285.1 seconds\n    cpu time: 12380.9 seconds\n    cumulative wall time: 17333.0 seconds\n```\n\nSome suggestions, though:\n\n- Should the term `strict` in `is_hyperbolic` be changed to `compact` to mesh with some current literature?\n\n- Can you also add a method `is_Lorentzian`?\n\nBest,\nBen",
    "created_at": "2015-06-09T19:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331593",
    "user": "https://github.com/bsalisbury1"
}
```

<a id='comment:4'></a>
Hi Jon,

Patch looks good, documentation looks good, and all tests passed.

```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 2285.1 seconds
    cpu time: 12380.9 seconds
    cumulative wall time: 17333.0 seconds
```

Some suggestions, though:

- Should the term `strict` in `is_hyperbolic` be changed to `compact` to mesh with some current literature?

- Can you also add a method `is_Lorentzian`?

Best,
Ben



---

archive/issue_comments_331594.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Salisbury\"",
    "created_at": "2015-06-09T19:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331594",
    "user": "https://github.com/bsalisbury1"
}
```

Changing reviewer from "" to "Ben Salisbury"



---

archive/issue_comments_331595.json:
```json
{
    "body": "Changing commit from \"77f1bf6eced4549e4ea433d1904f273f4057baac\" to \"bb250015dd24f433d84e92b28019b935359fb0a1\"",
    "created_at": "2015-06-09T22:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "77f1bf6eced4549e4ea433d1904f273f4057baac" to "bb250015dd24f433d84e92b28019b935359fb0a1"



---

archive/issue_comments_331596.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|\n|[bb25001](https://github.com/sagemath/sagetrac-mirror/commit/bb250015dd24f433d84e92b28019b935359fb0a1)|`Added an is_lorentzian method, changed strict to compact for hyperbolic, and improved docs.`|",
    "created_at": "2015-06-09T22:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
|[bb25001](https://github.com/sagemath/sagetrac-mirror/commit/bb250015dd24f433d84e92b28019b935359fb0a1)|`Added an is_lorentzian method, changed strict to compact for hyperbolic, and improved docs.`|



---

archive/issue_comments_331597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: ` is_indefinite() `, ` is_indecomposable() `, ` is_hyperbolic() `, ` principal_submatrices() `.\n+This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`.\n \n``````\n",
    "created_at": "2015-06-11T16:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331597",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: ` is_indefinite() `, ` is_indecomposable() `, ` is_hyperbolic() `, ` principal_submatrices() `.
+This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`.
 
``````




---

archive/issue_comments_331598.json:
```json
{
    "body": "<a id='comment:6'></a>\nSome minor things:\n\n- I think this logic\n\n```\nif compact:\n    if not subg.is_finite():\n        return False\nelse:\n    if not subg.is_finite() and not subg.is_affine():\n        return False\n```\n  could be rewritten as\n\n```\nif not ( subg.is_finite() or (compact and subg.is_affine()) ):\n    return False\n```\n  (IMO using `or` reflects the definition better, but feel free to distribute the `not`).\n- I'd change `all([a.det() > 0 for a in self.principal_submatrices()])` into `all(a.det() > 0 for a in self.principal_submatrices())` as you don't need to create the intermediary list.\n- I'd replace `return comp_num == 0 or comp_num == 1` with `return comp_num <= 1`.\n- The `INPUT:` block contents should not be indented.\n- Using Sage's `Set` is somewhat of a heavyhanded approach. So I'd make this change:\n\n```diff\n-        from sage.sets.set import Set\n-        iset = Set(range(self.ncols()));\n-        ret = []\n-        for l in iset.subsets():\n+        iset = range(self.ncols())\n+        from sage.misc.misc import powerset\n+        ret = []\n+        for l in powerset(iset):\n```",
    "created_at": "2015-06-11T16:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331598",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Some minor things:

- I think this logic

```
if compact:
    if not subg.is_finite():
        return False
else:
    if not subg.is_finite() and not subg.is_affine():
        return False
```
  could be rewritten as

```
if not ( subg.is_finite() or (compact and subg.is_affine()) ):
    return False
```
  (IMO using `or` reflects the definition better, but feel free to distribute the `not`).
- I'd change `all([a.det() > 0 for a in self.principal_submatrices()])` into `all(a.det() > 0 for a in self.principal_submatrices())` as you don't need to create the intermediary list.
- I'd replace `return comp_num == 0 or comp_num == 1` with `return comp_num <= 1`.
- The `INPUT:` block contents should not be indented.
- Using Sage's `Set` is somewhat of a heavyhanded approach. So I'd make this change:

```diff
-        from sage.sets.set import Set
-        iset = Set(range(self.ncols()));
-        ret = []
-        for l in iset.subsets():
+        iset = range(self.ncols())
+        from sage.misc.misc import powerset
+        ret = []
+        for l in powerset(iset):
```



---

archive/issue_comments_331599.json:
```json
{
    "body": "Changing commit from \"bb250015dd24f433d84e92b28019b935359fb0a1\" to \"7e17029e1388141ba3cce2f160adc296afb18fcb\"",
    "created_at": "2015-06-12T18:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bb250015dd24f433d84e92b28019b935359fb0a1" to "7e17029e1388141ba3cce2f160adc296afb18fcb"



---

archive/issue_comments_331600.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|\n|[7e17029](https://github.com/sagemath/sagetrac-mirror/commit/7e17029e1388141ba3cce2f160adc296afb18fcb)|`Cleaned up docs, removed some unnecessary intermediary lists, and added a method indecomposable_blocks().`|",
    "created_at": "2015-06-12T18:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
|[7e17029](https://github.com/sagemath/sagetrac-mirror/commit/7e17029e1388141ba3cce2f160adc296afb18fcb)|`Cleaned up docs, removed some unnecessary intermediary lists, and added a method indecomposable_blocks().`|



---

archive/issue_comments_331601.json:
```json
{
    "body": "<a id='comment:8'></a>\nIs there a generally accepted convention for deciding how to classify Cartan matrices whose blocks are of mixed type? For example, should a Cartan matrix with a finite block and an affine block be considered affine?\n\nFor now, the methods ` is_finite() `, ` is_affine() `, ` is_hyperbolic() ` return false if the matrix is decomposable. Indecomposability is assumed in the classification in Kac's book (and Carter's), but I've seen other conventions (e.g. calling a Cartan matrix with multiple finite blocks a finite matrix).\n\nWith this in mind, I added the ` indecomposable_blocks() ` method to make it easy for a user to check blocks individually for finiteness, affineness, and hyperbolicity.",
    "created_at": "2015-06-12T18:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331601",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

<a id='comment:8'></a>
Is there a generally accepted convention for deciding how to classify Cartan matrices whose blocks are of mixed type? For example, should a Cartan matrix with a finite block and an affine block be considered affine?

For now, the methods ` is_finite() `, ` is_affine() `, ` is_hyperbolic() ` return false if the matrix is decomposable. Indecomposability is assumed in the classification in Kac's book (and Carter's), but I've seen other conventions (e.g. calling a Cartan matrix with multiple finite blocks a finite matrix).

With this in mind, I added the ` indecomposable_blocks() ` method to make it easy for a user to check blocks individually for finiteness, affineness, and hyperbolicity.



---

archive/issue_comments_331602.json:
```json
{
    "body": "<a id='comment:9'></a>\nIMO for finite, all types have to be finite because this gives you a finite root system (in particular, this makes all types contained in a finite type stay finite). Affine types I think is the trickiest, but I would say we'd want to keep the corank 1 property, so I would say no, decomposable types cannot be affine. For hyperbolic, I believe it follows from the definition that it has to be connected except for a single vertex disjoint from an affine type. However I'd make it uniform and say if it is decomposable, then it is not hyperbolic.\n\nNicolas, Dan, do either of you have thoughts on this?",
    "created_at": "2015-06-17T06:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331602",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
IMO for finite, all types have to be finite because this gives you a finite root system (in particular, this makes all types contained in a finite type stay finite). Affine types I think is the trickiest, but I would say we'd want to keep the corank 1 property, so I would say no, decomposable types cannot be affine. For hyperbolic, I believe it follows from the definition that it has to be connected except for a single vertex disjoint from an affine type. However I'd make it uniform and say if it is decomposable, then it is not hyperbolic.

Nicolas, Dan, do either of you have thoughts on this?



---

archive/issue_comments_331603.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis sounds reasonnable but this is going beyond my expertise zone. I am adding Jean-Philippe Labb\u00e9, Jean Michel and Vivien Ripoll in the loop, as they are likely to have some good insight on this matter (proper answer for `is_affine`, `is_hyperbolic`, ... for decomposable types).",
    "created_at": "2015-06-17T07:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331603",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>
This sounds reasonnable but this is going beyond my expertise zone. I am adding Jean-Philippe Labbé, Jean Michel and Vivien Ripoll in the loop, as they are likely to have some good insight on this matter (proper answer for `is_affine`, `is_hyperbolic`, ... for decomposable types).



---

archive/issue_comments_331604.json:
```json
{
    "body": "<a id='comment:11'></a>\nHi all,\n\nHmm. I also had thoughts about that recently when classifying finite and affine types. Here are some thoughts, suggestions, feel free to critize/ignore...\n\nHave a look at #17798, there is a function \"recognize_coxeter_type_from_matrix\".\n\nI usually use the following naming convention for Finite and Affine:\n\n-Finite types correspond to positive definite bilinear forms (reducible or not). For example, A_1 x A_1 should return True to \"is_finite\".\n\n-Affine types are not finite but the corresponding bilinear is semi-positive definite. The group acts affinely on a Euclidean space. Note the \"potentiality\" here in the definition. Some may require that the dimension of the kernel of the bilinear be 1-dimensional, so that an affine type should consist of only one affine component and possibly finite components.\n\nI like to refer to finite and affine types as level 0 types (see below).\n\nHyperbolic (Bourbaki and Humphreys): The bilinear form is regular (trivial kernel) but has exactly one negative eigenvalue. Moreover, it is called compact if the fundamental cone is compact in the hyperbolic space. It is called finite volume if the volume of the cone is finite volume in the hyperbolic space.\n\n+'s: this is classical nomenclature.\n-'s: there are way more matrices that are regular and have exactly one negative eigenvalue.\n\nThe only reason I found in the litterature about naming these groups hyperbolic was that they are the ones that one can easily deal with (at the time). I believe this fact to be obsolete nowadays.\n\nThere is another naming convention which says that hyperbolic is exactly when the bilinear form is regular and has exactly one eigenvalue. This was adopted by Vinberg and Maxwell for example in the 70's and 80's. But this leads to confusion.\n\nAnother convention is when the bilinear form has exactly one negative eigenvalue and a non-zero kernel: weakly hyperbolic. IMHO, this \"weakly\" is misleading.\n\nHave a look at Remark 2.2 of http://arxiv.org/abs/1310.8608 where there are references about this.\n\n==============\n\nTo clarify all this, I like to use the notion of level and strictness that reveals a lot of structure.\n\nA Coxeter matrix or Coxeter graph is of level 0 if it is finite or affine.\n\nA Coxeter matrix or Coxeter graph is of \"level =<r\" if removing any set of r generators leaves a finite or affine type graph/matrix.\n\nA Coxeter matrix or Coxeter graph is of level (exactly) r if it is not of level <=r-1 but of level <=r.\n\nA Coxeter matrix or Coxeter graph is strict if removing the r vertices always leaves a finite type.\n\nThe hyperbolic (compact and non compact) are the graphs of level 1. The compact hyperbolic types are exactly the strict level 1.\n\nThe level 2 graphs have signature (n-1,1,0). This was proved by Maxwell and his enumeration was corrected in the above paper.\n\nInstead of using hyperbolic I prefer to use the term Lorentzian to reflect the fact that the group acts not only on the hyperbolic space (which is part of a Lorentz space) but also on the outside of it. Note that the Lorentzian represent a potentiality. Lorentzian types are when the signature of the bilinear is (n-1,1,0). When the kernel is non-zero, i.e. signature (m,1,k) I would use the term degenerate Lorentzian instead of weakly hyperbolic.\n\nSorry for the long text... Anyhow, this is more or less the picture as for Coxeter matrices and types.\n\nAs for the methods: very good to have them there!",
    "created_at": "2015-06-17T11:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331604",
    "user": "https://github.com/jplab"
}
```

<a id='comment:11'></a>
Hi all,

Hmm. I also had thoughts about that recently when classifying finite and affine types. Here are some thoughts, suggestions, feel free to critize/ignore...

Have a look at #17798, there is a function "recognize_coxeter_type_from_matrix".

I usually use the following naming convention for Finite and Affine:

-Finite types correspond to positive definite bilinear forms (reducible or not). For example, A_1 x A_1 should return True to "is_finite".

-Affine types are not finite but the corresponding bilinear is semi-positive definite. The group acts affinely on a Euclidean space. Note the "potentiality" here in the definition. Some may require that the dimension of the kernel of the bilinear be 1-dimensional, so that an affine type should consist of only one affine component and possibly finite components.

I like to refer to finite and affine types as level 0 types (see below).

Hyperbolic (Bourbaki and Humphreys): The bilinear form is regular (trivial kernel) but has exactly one negative eigenvalue. Moreover, it is called compact if the fundamental cone is compact in the hyperbolic space. It is called finite volume if the volume of the cone is finite volume in the hyperbolic space.

+'s: this is classical nomenclature.
-'s: there are way more matrices that are regular and have exactly one negative eigenvalue.

The only reason I found in the litterature about naming these groups hyperbolic was that they are the ones that one can easily deal with (at the time). I believe this fact to be obsolete nowadays.

There is another naming convention which says that hyperbolic is exactly when the bilinear form is regular and has exactly one eigenvalue. This was adopted by Vinberg and Maxwell for example in the 70's and 80's. But this leads to confusion.

Another convention is when the bilinear form has exactly one negative eigenvalue and a non-zero kernel: weakly hyperbolic. IMHO, this "weakly" is misleading.

Have a look at Remark 2.2 of http://arxiv.org/abs/1310.8608 where there are references about this.

==============

To clarify all this, I like to use the notion of level and strictness that reveals a lot of structure.

A Coxeter matrix or Coxeter graph is of level 0 if it is finite or affine.

A Coxeter matrix or Coxeter graph is of "level =<r" if removing any set of r generators leaves a finite or affine type graph/matrix.

A Coxeter matrix or Coxeter graph is of level (exactly) r if it is not of level <=r-1 but of level <=r.

A Coxeter matrix or Coxeter graph is strict if removing the r vertices always leaves a finite type.

The hyperbolic (compact and non compact) are the graphs of level 1. The compact hyperbolic types are exactly the strict level 1.

The level 2 graphs have signature (n-1,1,0). This was proved by Maxwell and his enumeration was corrected in the above paper.

Instead of using hyperbolic I prefer to use the term Lorentzian to reflect the fact that the group acts not only on the hyperbolic space (which is part of a Lorentz space) but also on the outside of it. Note that the Lorentzian represent a potentiality. Lorentzian types are when the signature of the bilinear is (n-1,1,0). When the kernel is non-zero, i.e. signature (m,1,k) I would use the term degenerate Lorentzian instead of weakly hyperbolic.

Sorry for the long text... Anyhow, this is more or less the picture as for Coxeter matrices and types.

As for the methods: very good to have them there!



---

archive/issue_comments_331605.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt sounds like Jean-Philippe and I are in agreement that finite types include decomposable types whose pieces are all finite. This makes me also believe that we should have affine types include decomposable types whose pieces are all finite or affine. This would mean that the hyperbolic types are those of level 1 (and forced to be connected).\n\nI'm also okay calling those Cartan types with a signature of (n-1,1,0) as Lorentzian and those of (m,1,k) being degenerate Lorentzian. However I do think we should call the (strict) level 1 Lorentzian (resp., compact) hyperbolic to be as close with the classical literature as possible.",
    "created_at": "2015-06-18T17:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331605",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
It sounds like Jean-Philippe and I are in agreement that finite types include decomposable types whose pieces are all finite. This makes me also believe that we should have affine types include decomposable types whose pieces are all finite or affine. This would mean that the hyperbolic types are those of level 1 (and forced to be connected).

I'm also okay calling those Cartan types with a signature of (n-1,1,0) as Lorentzian and those of (m,1,k) being degenerate Lorentzian. However I do think we should call the (strict) level 1 Lorentzian (resp., compact) hyperbolic to be as close with the classical literature as possible.



---

archive/issue_comments_331606.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis sounds good to me. With respect to the code, I think the following changes to the most recent push should take care of things:\n\n- change ` is_finite() ` to check if the matrix is positive definite;\n\n- change ` is_affine() ` to check if the determinant is zero and if each indecomposable block is either finite or affine. With respect to checking affine-ness, I didn't find a matrix method for positive semi-definiteness. Is there a smarter way to do this than checking if the determinants of proper principal submatrices are positive?\n\nBased on the discussion of levels and strictness above, I believe that the methods ` is_hyperbolic() ` and ` is_lorentzian() ` will yield correct results as they stand.",
    "created_at": "2015-06-18T22:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331606",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

<a id='comment:13'></a>
This sounds good to me. With respect to the code, I think the following changes to the most recent push should take care of things:

- change ` is_finite() ` to check if the matrix is positive definite;

- change ` is_affine() ` to check if the determinant is zero and if each indecomposable block is either finite or affine. With respect to checking affine-ness, I didn't find a matrix method for positive semi-definiteness. Is there a smarter way to do this than checking if the determinants of proper principal submatrices are positive?

Based on the discussion of levels and strictness above, I believe that the methods ` is_hyperbolic() ` and ` is_lorentzian() ` will yield correct results as they stand.



---

archive/issue_comments_331607.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[3289b28](https://github.com/sagemath/sagetrac-mirror/commit/3289b28067a5983b56eebfebc213bdec14245273)|`Some updates to is_finite and is_affine`|\n|[8d06af9](https://github.com/sagemath/sagetrac-mirror/commit/8d06af9a2013822895f945e37cf7df0137b421ed)|`Merge branch 'develop' into t/18645/add_some_methods_to_cartanmatrix`|",
    "created_at": "2015-06-19T00:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331607",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[3289b28](https://github.com/sagemath/sagetrac-mirror/commit/3289b28067a5983b56eebfebc213bdec14245273)|`Some updates to is_finite and is_affine`|
|[8d06af9](https://github.com/sagemath/sagetrac-mirror/commit/8d06af9a2013822895f945e37cf7df0137b421ed)|`Merge branch 'develop' into t/18645/add_some_methods_to_cartanmatrix`|



---

archive/issue_comments_331608.json:
```json
{
    "body": "Changing commit from \"7e17029e1388141ba3cce2f160adc296afb18fcb\" to \"8d06af9a2013822895f945e37cf7df0137b421ed\"",
    "created_at": "2015-06-19T00:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7e17029e1388141ba3cce2f160adc296afb18fcb" to "8d06af9a2013822895f945e37cf7df0137b421ed"



---

archive/issue_comments_331609.json:
```json
{
    "body": "<a id='comment:15'></a>\nA couple of things:\n\n- IMO `not self.det() == 0` would be better as `self.det() != 0`.\n- Instead of `return len([x for x in self.eigenvalues() if x < 0]) == 1`, I would use `sum(1 for x in M.eigenvalues() if x < 0)` since then we don't create the intermediate list (but this probably isn't really important since matrices we consider are usually \"small\").\n- I would do this import `from sage.misc.misc import powerset` at the module level. It makes the code run faster. (Sorry, I should have mentioned this earlier.)\n- I would cache the `is_*` methods since they actually seem to get called with some frequency (specifically `is_finite`).\n- I think your check for `is_hyperbolic` is overkill. You should instead iterate over the vertices and check the subgraph of everything except that vertex.",
    "created_at": "2015-06-19T05:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331609",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
A couple of things:

- IMO `not self.det() == 0` would be better as `self.det() != 0`.
- Instead of `return len([x for x in self.eigenvalues() if x < 0]) == 1`, I would use `sum(1 for x in M.eigenvalues() if x < 0)` since then we don't create the intermediate list (but this probably isn't really important since matrices we consider are usually "small").
- I would do this import `from sage.misc.misc import powerset` at the module level. It makes the code run faster. (Sorry, I should have mentioned this earlier.)
- I would cache the `is_*` methods since they actually seem to get called with some frequency (specifically `is_finite`).
- I think your check for `is_hyperbolic` is overkill. You should instead iterate over the vertices and check the subgraph of everything except that vertex.



---

archive/issue_comments_331610.json:
```json
{
    "body": "Changing commit from \"8d06af9a2013822895f945e37cf7df0137b421ed\" to \"12895862c647d103d134c98ef18a5d8a934aeb5f\"",
    "created_at": "2015-06-19T18:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331610",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8d06af9a2013822895f945e37cf7df0137b421ed" to "12895862c647d103d134c98ef18a5d8a934aeb5f"



---

archive/issue_comments_331611.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[70e492e](https://github.com/sagemath/sagetrac-mirror/commit/70e492ed32447f08322c0e7a67ef652258fe13cf)|`fixing a typo in boolean condition in is_affine`|\n|[0e20543](https://github.com/sagemath/sagetrac-mirror/commit/0e20543dbca1215b9608873cd53a06dbb09e1731)|`Merge branch 'develop' into t/18645/add_some_methods_to_cartanmatrix`|\n|[1289586](https://github.com/sagemath/sagetrac-mirror/commit/12895862c647d103d134c98ef18a5d8a934aeb5f)|`More cleanup and optimizations.`|",
    "created_at": "2015-06-19T18:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[70e492e](https://github.com/sagemath/sagetrac-mirror/commit/70e492ed32447f08322c0e7a67ef652258fe13cf)|`fixing a typo in boolean condition in is_affine`|
|[0e20543](https://github.com/sagemath/sagetrac-mirror/commit/0e20543dbca1215b9608873cd53a06dbb09e1731)|`Merge branch 'develop' into t/18645/add_some_methods_to_cartanmatrix`|
|[1289586](https://github.com/sagemath/sagetrac-mirror/commit/12895862c647d103d134c98ef18a5d8a934aeb5f)|`More cleanup and optimizations.`|



---

archive/issue_comments_331612.json:
```json
{
    "body": "<a id='comment:17'></a>\n`@`tscrim: I think I've made all the changes you suggested.\n\nA couple things that we should probably do (on another ticket?):\n\n- add ` is_hyperbolic `, ` is_lorentzian ` and ` is_indefinite ` methods to DynkinDiagram.\n- unify results here with those for reducible Cartan types. To see what I mean, note the difference between CM2 and CM3 below, where the matrices are the same, but where CM2 knows its CartanType while CM3 does not.\n\n```\nsage: CM1 = CartanMatrix(\"A2xA2\")\nsage: CM1.is_finite()\nTrue\nsage: CM2 = CartanMatrix(\"A2~xA2\")\nsage: CM2\n[ 2 -1 -1  0  0]\n[-1  2 -1  0  0]\n[-1 -1  2  0  0]\n[ 0  0  0  2 -1]\n[ 0  0  0 -1  2]\nsage: CM2.is_finite()\nFalse\nsage: CM2.is_affine()\nFalse\nsage: CM3 = CartanMatrix([[2,-1,-1,0,0],[-1,2,-1,0,0],[-1,-1,2,0,0],[0,0,0,2,-1],[0,0,0,-1,2]])\nsage: CM3.is_affine()\nTrue\n```",
    "created_at": "2015-06-19T18:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331612",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

<a id='comment:17'></a>
`@`tscrim: I think I've made all the changes you suggested.

A couple things that we should probably do (on another ticket?):

- add ` is_hyperbolic `, ` is_lorentzian ` and ` is_indefinite ` methods to DynkinDiagram.
- unify results here with those for reducible Cartan types. To see what I mean, note the difference between CM2 and CM3 below, where the matrices are the same, but where CM2 knows its CartanType while CM3 does not.

```
sage: CM1 = CartanMatrix("A2xA2")
sage: CM1.is_finite()
True
sage: CM2 = CartanMatrix("A2~xA2")
sage: CM2
[ 2 -1 -1  0  0]
[-1  2 -1  0  0]
[-1 -1  2  0  0]
[ 0  0  0  2 -1]
[ 0  0  0 -1  2]
sage: CM2.is_finite()
False
sage: CM2.is_affine()
False
sage: CM3 = CartanMatrix([[2,-1,-1,0,0],[-1,2,-1,0,0],[-1,-1,2,0,0],[0,0,0,2,-1],[0,0,0,-1,2]])
sage: CM3.is_affine()
True
```



---

archive/issue_comments_331613.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jonathan.judge](#comment%3A17):\n> `@`tscrim: I think I've made all the changes you suggested.\n\n\nThanks. Although I would not cache `principal_submatrices` as it returns a list of mutable matrices. I would change the output of `indecomposable_blocks` to a tuple so that the output list cannot be changed. Once this is changed, you can set a positive review on my behalf.\n\n> A couple things that we should probably do (on another ticket?):\n\n>\n> - add ` is_hyperbolic `, ` is_lorentzian ` and ` is_indefinite ` methods to DynkinDiagram.\n\n\nI'm happy doing this on another ticket as well. You might be interested in #15974 (which I have half forgotten about, half didn't have time for).\n\n> - unify results here with those for reducible Cartan types. To see what I mean, note the difference between CM2 and CM3 below, where the matrices are the same, but where CM2 knows its CartanType while CM3 does not.\n> \n> ```\n> sage: CM1 = CartanMatrix(\"A2xA2\")\n> sage: CM1.is_finite()\n> True\n> sage: CM2 = CartanMatrix(\"A2~xA2\")\n> sage: CM2\n> [ 2 -1 -1  0  0]\n> [-1  2 -1  0  0]\n> [-1 -1  2  0  0]\n> [ 0  0  0  2 -1]\n> [ 0  0  0 -1  2]\n> sage: CM2.is_finite()\n> False\n> sage: CM2.is_affine()\n> False\n> sage: CM3 = CartanMatrix([[2,-1,-1,0,0],[-1,2,-1,0,0],[-1,-1,2,0,0],[0,0,0,2,-1],[0,0,0,-1,2]])\n> sage: CM3.is_affine()\n> True\n> ```\n\n\nYes, we do not have good type recognition for Cartan types. I think the better thing to do is to compare the Dynkin diagrams (as digraphs) and do type recognition and relabeling that way. However this is definitely a separate ticket.\n\nAlso, please add your real name as the author.",
    "created_at": "2015-06-19T19:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331613",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Replying to [jonathan.judge](#comment%3A17):
> `@`tscrim: I think I've made all the changes you suggested.


Thanks. Although I would not cache `principal_submatrices` as it returns a list of mutable matrices. I would change the output of `indecomposable_blocks` to a tuple so that the output list cannot be changed. Once this is changed, you can set a positive review on my behalf.

> A couple things that we should probably do (on another ticket?):

>
> - add ` is_hyperbolic `, ` is_lorentzian ` and ` is_indefinite ` methods to DynkinDiagram.


I'm happy doing this on another ticket as well. You might be interested in #15974 (which I have half forgotten about, half didn't have time for).

> - unify results here with those for reducible Cartan types. To see what I mean, note the difference between CM2 and CM3 below, where the matrices are the same, but where CM2 knows its CartanType while CM3 does not.
> 
> ```
> sage: CM1 = CartanMatrix("A2xA2")
> sage: CM1.is_finite()
> True
> sage: CM2 = CartanMatrix("A2~xA2")
> sage: CM2
> [ 2 -1 -1  0  0]
> [-1  2 -1  0  0]
> [-1 -1  2  0  0]
> [ 0  0  0  2 -1]
> [ 0  0  0 -1  2]
> sage: CM2.is_finite()
> False
> sage: CM2.is_affine()
> False
> sage: CM3 = CartanMatrix([[2,-1,-1,0,0],[-1,2,-1,0,0],[-1,-1,2,0,0],[0,0,0,2,-1],[0,0,0,-1,2]])
> sage: CM3.is_affine()
> True
> ```


Yes, we do not have good type recognition for Cartan types. I think the better thing to do is to compare the Dynkin diagrams (as digraphs) and do type recognition and relabeling that way. However this is definitely a separate ticket.

Also, please add your real name as the author.



---

archive/issue_comments_331614.json:
```json
{
    "body": "Changing reviewer from \"Ben Salisbury\" to \"Ben Salisbury, Travis Scrimshaw\"",
    "created_at": "2015-06-19T19:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331614",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Ben Salisbury" to "Ben Salisbury, Travis Scrimshaw"



---

archive/issue_comments_331615.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|\n|[dca9b68](https://github.com/sagemath/sagetrac-mirror/commit/dca9b68d339238ef43c614dbd459ce41ee4c80d9)|`Removed caching on principal_submatrices and changed indecomposable_blocks to return a tuple instead of a list.`|",
    "created_at": "2015-06-19T21:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|[dca9b68](https://github.com/sagemath/sagetrac-mirror/commit/dca9b68d339238ef43c614dbd459ce41ee4c80d9)|`Removed caching on principal_submatrices and changed indecomposable_blocks to return a tuple instead of a list.`|



---

archive/issue_comments_331616.json:
```json
{
    "body": "Changing commit from \"12895862c647d103d134c98ef18a5d8a934aeb5f\" to \"dca9b68d339238ef43c614dbd459ce41ee4c80d9\"",
    "created_at": "2015-06-19T21:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "12895862c647d103d134c98ef18a5d8a934aeb5f" to "dca9b68d339238ef43c614dbd459ce41ee4c80d9"



---

archive/issue_comments_331617.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Judge\"",
    "created_at": "2015-06-19T21:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331617",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Changing author from "" to "Jonathan Judge"



---

archive/issue_comments_331618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`.\n+This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`, and `indecomposable_blocks()`.\n \n``````\n",
    "created_at": "2015-06-19T21:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331618",
    "user": "https://trac.sagemath.org/admin/accounts/users/jonathan.judge"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`.
+This ticket is to add the following methods to the CartanMatrix class in support of ticket #18000: `is_indefinite()`, `is_indecomposable()`, `is_hyperbolic()`, `principal_submatrices()`, and `indecomposable_blocks()`.
 
``````




---

archive/issue_comments_331619.json:
```json
{
    "body": "<a id='comment:21'></a>\nThanks!",
    "created_at": "2015-06-19T23:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331619",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Thanks!



---

archive/issue_comments_331620.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-19T23:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331620",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331621.json:
```json
{
    "body": "Changing branch from \"u/jonathan.judge/add_some_methods_to_cartanmatrix\" to \"dca9b68d339238ef43c614dbd459ce41ee4c80d9\"",
    "created_at": "2015-06-20T18:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331621",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jonathan.judge/add_some_methods_to_cartanmatrix" to "dca9b68d339238ef43c614dbd459ce41ee4c80d9"



---

archive/issue_events_059477.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-20T18:23:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18645#event-59477"
}
```



---

archive/issue_comments_331622.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-20T18:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18645#issuecomment-331622",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
