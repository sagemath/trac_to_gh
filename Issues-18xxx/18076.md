# Issue 18076: Coercion for numpy types

archive/issues_017839.json:
```json
{
    "assignees": [],
    "body": "Plenty of bugs have been reported for the interaction with numpy:\n- #8426: polynomial * constant does not work if constant is a numpy type\n- #8949: symbolic functions dont work with numpy.int32\n- #9769: symbolic function do not work with numpy.int64 arguments\n- #13386: comparison of Sage integer with Numpy integer\n- #15695: Coercion problems between numpy and sage floats\n- #17758: Intervals and numpy floats do not compare correctly\n- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n\nWe solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail\n\n```\nsage: import numpy\n\nsage: f(t) = t^2\nsage: f(numpy.int32('1'))\n1\n\nsage: sin(numpy.int32(10))\nsin(10)\n\nsage: 123 == numpy.int32(123)\nTrue\n\nsage: 1j + numpy.float(2)\n2.00000000000000 + 1.00000000000000*I\nsage: parent(_)\nComplex Field with 53 bits of precision\n\nsage: RIF(1) <= numpy.float64(2.0)\nTrue \n```\n\nSome of them depend on modifying some internal in numpy and will not be solved here:\n- #8824: Make it so that numpy datatypes are integrated into the coercion model\n\nDepends on #18121\n\n**Assignee:** @videlec\n\n**CC:**  tmonteil\n\n**Keywords:** sd66\n\n**Branch/Commit:** [8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)\n\n**Reviewer:** Jeroen Demeyer, Vincent Delecroix\n\n**Author:** Vincent Delecroix, Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/18076\n\n",
    "closed_at": "2015-04-28T04:44:37Z",
    "created_at": "2015-03-28T00:03:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Coercion for numpy types",
    "type": "issue",
    "updated_at": "2015-04-28T04:44:37Z",
    "url": "https://github.com/sagemath/sage/issues/18076",
    "user": "https://github.com/videlec"
}
```
Plenty of bugs have been reported for the interaction with numpy:
- #8426: polynomial * constant does not work if constant is a numpy type
- #8949: symbolic functions dont work with numpy.int32
- #9769: symbolic function do not work with numpy.int64 arguments
- #13386: comparison of Sage integer with Numpy integer
- #15695: Coercion problems between numpy and sage floats
- #17758: Intervals and numpy floats do not compare correctly
- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks

We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail

```
sage: import numpy

sage: f(t) = t^2
sage: f(numpy.int32('1'))
1

sage: sin(numpy.int32(10))
sin(10)

sage: 123 == numpy.int32(123)
True

sage: 1j + numpy.float(2)
2.00000000000000 + 1.00000000000000*I
sage: parent(_)
Complex Field with 53 bits of precision

sage: RIF(1) <= numpy.float64(2.0)
True 
```

Some of them depend on modifying some internal in numpy and will not be solved here:
- #8824: Make it so that numpy datatypes are integrated into the coercion model

Depends on #18121

**Assignee:** @videlec

**CC:**  tmonteil

**Keywords:** sd66

**Branch/Commit:** [8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)

**Reviewer:** Jeroen Demeyer, Vincent Delecroix

**Author:** Vincent Delecroix, Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/18076





---

archive/issue_events_220882.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220882"
}
```



---

archive/issue_events_220883.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "08517b",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220883"
}
```



---

archive/issue_events_220884.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220884"
}
```



---

archive/issue_comments_248795.json:
```json
{
    "body": "**Assignee:** @videlec",
    "created_at": "2015-03-28T00:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248795",
    "user": "https://github.com/videlec"
}
```

**Assignee:** @videlec



---

archive/issue_comments_248796.json:
```json
{
    "body": "**Commit:** [f739d53004dd326ef6412dc4f0ec283e59970586](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248796",
    "user": "https://github.com/videlec"
}
```

**Commit:** [f739d53004dd326ef6412dc4f0ec283e59970586](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)



---

archive/issue_comments_248797.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586\">f739d53</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr></table>\n",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248797",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'>**Comment 2:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586">f739d53</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr></table>




---

archive/issue_comments_248798.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,8 +5,9 @@\n - #13386: comparison of Sage integer with Numpy integer\n - #15695: Coercion problems between numpy and sage floats\n - #17758: Intervals and numpy floats do not compare correctly\n+- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n \n-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`.\n+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.\n \n Some of them depend on modifying some internal in numpy and will not be solved here:\n-- - #8824: Make it so that numpy datatypes are integrated into the coercion model\n+- #8824: Make it so that numpy datatypes are integrated into the coercion model\n``````\n",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248798",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,8 +5,9 @@
 - #13386: comparison of Sage integer with Numpy integer
 - #15695: Coercion problems between numpy and sage floats
 - #17758: Intervals and numpy floats do not compare correctly
+- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks
 
-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`.
+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.
 
 Some of them depend on modifying some internal in numpy and will not be solved here:
-- - #8824: Make it so that numpy datatypes are integrated into the coercion model
+- #8824: Make it so that numpy datatypes are integrated into the coercion model
``````




---

archive/issue_comments_248799.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248799",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)



---

archive/issue_comments_248800.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nNot so bad... got three problematic files\n\n```\nsage -t --long src/sage/plot/plot.py  # 2 doctests failed\nsage -t --long src/sage/plot/graphics.py  # 1 doctest failed\nsage -t --long src/doc/en/thematic_tutorials/numerical_sage/numpy.rst  # 1 doctest failed\n```",
    "created_at": "2015-03-28T20:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248800",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'>**Comment 3:**</a>
Not so bad... got three problematic files

```
sage -t --long src/sage/plot/plot.py  # 2 doctests failed
sage -t --long src/sage/plot/graphics.py  # 1 doctest failed
sage -t --long src/doc/en/thematic_tutorials/numerical_sage/numpy.rst  # 1 doctest failed
```



---

archive/issue_comments_248801.json:
```json
{
    "body": "**Changing commit** from \"[f739d53004dd326ef6412dc4f0ec283e59970586](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)\" to \"[1a76757d67024985b529cc54a7eb399305c15126](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)\".",
    "created_at": "2015-03-28T21:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248801",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f739d53004dd326ef6412dc4f0ec283e59970586](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)" to "[1a76757d67024985b529cc54a7eb399305c15126](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)".



---

archive/issue_comments_248802.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126\">1a76757</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248802",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126">1a76757</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_comments_248803.json:
```json
{
    "body": "**Changing commit** from \"[1a76757d67024985b529cc54a7eb399305c15126](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)\" to \"[b0c83753b4eee2f5ba3c9558acae517d8508919c](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)\".",
    "created_at": "2015-03-28T21:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248803",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1a76757d67024985b529cc54a7eb399305c15126](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)" to "[b0c83753b4eee2f5ba3c9558acae517d8508919c](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)".



---

archive/issue_comments_248804.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c\">b0c8375</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248804",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>**Comment 5:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c">b0c8375</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_comments_248805.json:
```json
{
    "body": "**Changing commit** from \"[b0c83753b4eee2f5ba3c9558acae517d8508919c](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)\" to \"[1d2148e8a0eb2dbfd3575f209ced87626e84c6b1](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)\".",
    "created_at": "2015-03-28T21:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248805",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[b0c83753b4eee2f5ba3c9558acae517d8508919c](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)" to "[1d2148e8a0eb2dbfd3575f209ced87626e84c6b1](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)".



---

archive/issue_comments_248806.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1\">1d2148e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248806",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1">1d2148e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_events_220885.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T21:09:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220885"
}
```



---

archive/issue_comments_248807.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,7 +7,29 @@\n - #17758: Intervals and numpy floats do not compare correctly\n - #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n \n-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.\n+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail\n+\n+```\n+sage: import numpy\n+\n+sage: f(t) = t^2\n+sage: f(numpy.int32('1'))\n+1\n+\n+sage: sin(numpy.int32(10))\n+sin(10)\n+\n+sage: 123 == numpy.int32(123)\n+True\n+\n+sage: 1j + numpy.float(2)\n+2.00000000000000 + 1.00000000000000*I\n+sage: parent(_)\n+Complex Field with 53 bits of precision\n+\n+sage: RIF(1) <= numpy.float64(2.0)\n+True \n+```\n \n Some of them depend on modifying some internal in numpy and will not be solved here:\n - #8824: Make it so that numpy datatypes are integrated into the coercion model\n``````\n",
    "created_at": "2015-03-30T16:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248807",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,7 +7,29 @@
 - #17758: Intervals and numpy floats do not compare correctly
 - #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks
 
-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.
+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail
+
+```
+sage: import numpy
+
+sage: f(t) = t^2
+sage: f(numpy.int32('1'))
+1
+
+sage: sin(numpy.int32(10))
+sin(10)
+
+sage: 123 == numpy.int32(123)
+True
+
+sage: 1j + numpy.float(2)
+2.00000000000000 + 1.00000000000000*I
+sage: parent(_)
+Complex Field with 53 bits of precision
+
+sage: RIF(1) <= numpy.float64(2.0)
+True 
+```
 
 Some of them depend on modifying some internal in numpy and will not be solved here:
 - #8824: Make it so that numpy datatypes are integrated into the coercion model
``````




---

archive/issue_comments_248808.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\n3 failing doctests, see patchbot report",
    "created_at": "2015-03-31T18:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248808",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'>**Comment 9:**</a>
3 failing doctests, see patchbot report



---

archive/issue_events_220886.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-31T18:30:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220886"
}
```



---

archive/issue_events_220887.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-31T18:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220887"
}
```



---

archive/issue_comments_248809.json:
```json
{
    "body": "**Changing commit** from \"[1d2148e8a0eb2dbfd3575f209ced87626e84c6b1](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)\" to \"[dbe635f3401ae345516330c0b1d9f570352f31db](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)\".",
    "created_at": "2015-03-31T19:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248809",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1d2148e8a0eb2dbfd3575f209ced87626e84c6b1](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)" to "[dbe635f3401ae345516330c0b1d9f570352f31db](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)".



---

archive/issue_comments_248810.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f187d02e30ce46723df91b8d2c738e2162168761\">f187d02</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd5601ee8fb866139bf5be1852cf4a4dd3043972\">fd5601e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db\">dbe635f</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>\n",
    "created_at": "2015-03-31T19:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248810",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>**Comment 10:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f187d02e30ce46723df91b8d2c738e2162168761">f187d02</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd5601ee8fb866139bf5be1852cf4a4dd3043972">fd5601e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db">dbe635f</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>




---

archive/issue_comments_248811.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nReplying to [@fchapoton](#comment%3A9):\n> 3 failing doctests, see patchbot report\n\nIs that all?",
    "created_at": "2015-03-31T19:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248811",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'>**Comment 11:**</a>
Replying to [@fchapoton](#comment%3A9):
> 3 failing doctests, see patchbot report

Is that all?



---

archive/issue_events_220888.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-31T19:59:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220888"
}
```



---

archive/issue_events_220889.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-31T19:59:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220889"
}
```



---

archive/issue_events_220890.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-01T16:48:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220890"
}
```



---

archive/issue_events_220891.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-01T16:48:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220891"
}
```



---

archive/issue_comments_248812.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nstill one failing doctest, see patchbot report.\n\nD\u00e9sol\u00e9 de ne pas faire de commentaires plus constructifs, vraiment.",
    "created_at": "2015-04-01T16:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248812",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>**Comment 13:**</a>
still one failing doctest, see patchbot report.

Désolé de ne pas faire de commentaires plus constructifs, vraiment.



---

archive/issue_comments_248813.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5\">6b51a65</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>\n",
    "created_at": "2015-04-01T21:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248813",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>**Comment 14:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5">6b51a65</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>




---

archive/issue_comments_248814.json:
```json
{
    "body": "**Changing commit** from \"[dbe635f3401ae345516330c0b1d9f570352f31db](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)\" to \"[6b51a65164956dbd398e8af21b843f39931cadd5](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)\".",
    "created_at": "2015-04-01T21:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248814",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[dbe635f3401ae345516330c0b1d9f570352f31db](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)" to "[6b51a65164956dbd398e8af21b843f39931cadd5](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)".



---

archive/issue_events_220892.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-01T21:44:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220892"
}
```



---

archive/issue_events_220893.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-01T21:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220893"
}
```



---

archive/issue_comments_248815.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@fchapoton](#comment%3A13):\n> still one failing doctest, see patchbot report.\n> \n> D\u00e9sol\u00e9 de ne pas faire de commentaires plus constructifs, vraiment.\n\nDone!",
    "created_at": "2015-04-01T21:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248815",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@fchapoton](#comment%3A13):
> still one failing doctest, see patchbot report.
> 
> Désolé de ne pas faire de commentaires plus constructifs, vraiment.

Done!



---

archive/issue_comments_248816.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nThere is a incomplete trac number XYZ:\n\n```\n+ This used to fail (see :trac:`XYZ`)::\n```",
    "created_at": "2015-04-03T15:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248816",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:16'>**Comment 16:**</a>
There is a incomplete trac number XYZ:

```
+ This used to fail (see :trac:`XYZ`)::
```



---

archive/issue_comments_248817.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nMy intention is to make this depend on #18121.",
    "created_at": "2015-04-04T07:02:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248817",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>**Comment 17:**</a>
My intention is to make this depend on #18121.



---

archive/issue_comments_248818.json:
```json
{
    "body": "**Changing author** from \"Vincent Delecroix\" to \"Vincent Delecroix, Jeroen Demeyer\".",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248818",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Vincent Delecroix" to "Vincent Delecroix, Jeroen Demeyer".



---

archive/issue_comments_248819.json:
```json
{
    "body": "**Dependencies:** #18121",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248819",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #18121



---

archive/issue_comments_248820.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248820",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_248821.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)\" to \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\".",
    "created_at": "2015-04-07T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248821",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)" to "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)".



---

archive/issue_comments_248822.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nThis looks wrong to me:\n\n```\nsage: numpy.int8('12') + 1/3\n12.333333333333334\n```\nWhy is the answer a float???\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5532969cc7c462d24788585030ab662cf05b024b\">5532969</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd2531d2ab79f8db4357788248bb5d936b920b85\">fd2531d</a></td><td><code>Merge commit '5532969cc7c462d24788585030ab662cf05b024b' into t/18076/18076</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac\">c3e4671</a></td><td><code>Introduce new function \"is_numpy_type\"</code></td></tr></table>\n",
    "created_at": "2015-04-07T10:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248822",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>**Comment 20:**</a>
This looks wrong to me:

```
sage: numpy.int8('12') + 1/3
12.333333333333334
```
Why is the answer a float???

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5532969cc7c462d24788585030ab662cf05b024b">5532969</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd2531d2ab79f8db4357788248bb5d936b920b85">fd2531d</a></td><td><code>Merge commit '5532969cc7c462d24788585030ab662cf05b024b' into t/18076/18076</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac">c3e4671</a></td><td><code>Introduce new function "is_numpy_type"</code></td></tr></table>




---

archive/issue_comments_248823.json:
```json
{
    "body": "**Changing commit** from \"[6b51a65164956dbd398e8af21b843f39931cadd5](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)\" to \"[c3e467149631917bb5ea7d753ef5a18333dd29ac](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)\".",
    "created_at": "2015-04-07T10:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248823",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[6b51a65164956dbd398e8af21b843f39931cadd5](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)" to "[c3e467149631917bb5ea7d753ef5a18333dd29ac](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)".



---

archive/issue_events_220894.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:05:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220894"
}
```



---

archive/issue_events_220895.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:05:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220895"
}
```



---

archive/issue_comments_248824.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nReplying to [@jdemeyer](#comment%3A20):\n> This looks wrong to me:\n> \n> ```\n> sage: numpy.int8('12') + 1/3\n> 12.333333333333334\n> ```\n> Why is the answer a float???\n\nThis is because the addition is handled by numpy and not by the rational. Simlarly\n\n```\nsage: import numpy\nsage: numpy.int64('1') + 1\n2\nsage: parent(_)\n<type 'numpy.int64'>\n```\nThere is a comment somewhere that this can be an upstream request.",
    "created_at": "2015-04-07T10:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248824",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>**Comment 21:**</a>
Replying to [@jdemeyer](#comment%3A20):
> This looks wrong to me:
> 
> ```
> sage: numpy.int8('12') + 1/3
> 12.333333333333334
> ```
> Why is the answer a float???

This is because the addition is handled by numpy and not by the rational. Simlarly

```
sage: import numpy
sage: numpy.int64('1') + 1
2
sage: parent(_)
<type 'numpy.int64'>
```
There is a comment somewhere that this can be an upstream request.



---

archive/issue_comments_248825.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nsee also #8824",
    "created_at": "2015-04-07T10:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248825",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'>**Comment 22:**</a>
see also #8824



---

archive/issue_comments_248826.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nReplying to [@videlec](#comment%3A21):\n> Replying to [@jdemeyer](#comment%3A20):\n> > This looks wrong to me:\n> > \n> > ```\n> > sage: numpy.int8('12') + 1/3\n> > 12.333333333333334\n> > ```\n> > Why is the answer a float???\n\n> \n> This is because the addition is handled by numpy and not by the rational.\n\nI see. It doesn't use the Sage coercion framework at all.\n\nCould you clarify this in the docstring when you write this example?",
    "created_at": "2015-04-07T11:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248826",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>**Comment 23:**</a>
Replying to [@videlec](#comment%3A21):
> Replying to [@jdemeyer](#comment%3A20):
> > This looks wrong to me:
> > 
> > ```
> > sage: numpy.int8('12') + 1/3
> > 12.333333333333334
> > ```
> > Why is the answer a float???

> 
> This is because the addition is handled by numpy and not by the rational.

I see. It doesn't use the Sage coercion framework at all.

Could you clarify this in the docstring when you write this example?



---

archive/issue_comments_248827.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nCould you please add doctests for all the tickets you're marking as duplicate of this one? For example, there is no doctest for #8949.",
    "created_at": "2015-04-07T11:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248827",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>**Comment 24:**</a>
Could you please add doctests for all the tickets you're marking as duplicate of this one? For example, there is no doctest for #8949.



---

archive/issue_comments_248828.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4\">9c7a6f5</a></td><td><code>Trac 18076: precision about numpy and Sage coercion</code></td></tr></table>\n",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248828",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'>**Comment 25:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4">9c7a6f5</a></td><td><code>Trac 18076: precision about numpy and Sage coercion</code></td></tr></table>




---

archive/issue_comments_248829.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\" to \"[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)\".",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248829",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)" to "[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)".



---

archive/issue_comments_248830.json:
```json
{
    "body": "**Changing commit** from \"[c3e467149631917bb5ea7d753ef5a18333dd29ac](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)\" to \"[9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)\".",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248830",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[c3e467149631917bb5ea7d753ef5a18333dd29ac](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)" to "[9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)".



---

archive/issue_events_220896.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "08517b",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220896"
}
```



---

archive/issue_events_220897.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "08517b",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220897"
}
```



---

archive/issue_events_220898.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "rename": {
        "from": "Be nicer with numpy",
        "to": "Coercion for numpy types"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220898"
}
```



---

archive/issue_comments_248831.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2\">8af0216</a></td><td><code>Trac 18076: document all corrected bugs</code></td></tr></table>\n",
    "created_at": "2015-04-07T12:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248831",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>**Comment 27:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2">8af0216</a></td><td><code>Trac 18076: document all corrected bugs</code></td></tr></table>




---

archive/issue_comments_248832.json:
```json
{
    "body": "**Changing commit** from \"[9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)\" to \"[8af0216f6b910e29632b5c0b1fc105176d5f5df2](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)\".",
    "created_at": "2015-04-07T12:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248832",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)" to "[8af0216f6b910e29632b5c0b1fc105176d5f5df2](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)".



---

archive/issue_comments_248833.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nFeel free to set this ticket back to needs_review (although somebody needs to review #18121 before this ticket can be formally reviewed).",
    "created_at": "2015-04-07T15:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248833",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>**Comment 28:**</a>
Feel free to set this ticket back to needs_review (although somebody needs to review #18121 before this ticket can be formally reviewed).



---

archive/issue_events_220899.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-09T19:54:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220899"
}
```



---

archive/issue_events_220900.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-09T19:54:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220900"
}
```



---

archive/issue_comments_248834.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nVarious conflicts, rebasing...",
    "created_at": "2015-04-22T08:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248834",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>**Comment 30:**</a>
Various conflicts, rebasing...



---

archive/issue_events_220901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220901"
}
```



---

archive/issue_events_220902.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220902"
}
```



---

archive/issue_events_220903.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220903"
}
```



---

archive/issue_events_220904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220904"
}
```



---

archive/issue_comments_248835.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)\" to \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\".",
    "created_at": "2015-04-22T08:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248835",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)" to "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)".



---

archive/issue_comments_248836.json:
```json
{
    "body": "**Changing commit** from \"[8af0216f6b910e29632b5c0b1fc105176d5f5df2](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)\" to \"[d4c53ac38372916a2e81100e2c4dd360b5afcf51](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)\".",
    "created_at": "2015-04-22T09:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248836",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[8af0216f6b910e29632b5c0b1fc105176d5f5df2](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)" to "[d4c53ac38372916a2e81100e2c4dd360b5afcf51](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)".



---

archive/issue_comments_248837.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a10dcbaaaefb87d48cf337be367cd48f11ed6edf\">a10dcba</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77e38d28e608521c7a79decf16bfb3f09b089737\">77e38d2</a></td><td><code>Define 3-argument version Py_VISIT3 of Py_VISIT</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58c17fbe84b31e534be250907717c52b8827e1d8\">58c17fb</a></td><td><code>cimport PyWeakref_GetObject() from cpython.weakref</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51\">d4c53ac</a></td><td><code>Coercion for numpy types</code></td></tr></table>\n",
    "created_at": "2015-04-22T09:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248837",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'>**Comment 32:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a10dcbaaaefb87d48cf337be367cd48f11ed6edf">a10dcba</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77e38d28e608521c7a79decf16bfb3f09b089737">77e38d2</a></td><td><code>Define 3-argument version Py_VISIT3 of Py_VISIT</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58c17fbe84b31e534be250907717c52b8827e1d8">58c17fb</a></td><td><code>cimport PyWeakref_GetObject() from cpython.weakref</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51">d4c53ac</a></td><td><code>Coercion for numpy types</code></td></tr></table>




---

archive/issue_events_220905.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:14:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220905"
}
```



---

archive/issue_events_220906.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:14:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220906"
}
```



---

archive/issue_events_220907.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-22T19:31:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220907"
}
```



---

archive/issue_events_220908.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-22T19:31:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220908"
}
```



---

archive/issue_comments_248838.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nThis is fine for me. And all test pass.\n\nVincent",
    "created_at": "2015-04-22T19:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248838",
    "user": "https://github.com/videlec"
}
```

<a id='comment:33'>**Comment 33:**</a>
This is fine for me. And all test pass.

Vincent



---

archive/issue_comments_248839.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Vincent Delecroix\".",
    "created_at": "2015-04-22T19:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248839",
    "user": "https://github.com/videlec"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Vincent Delecroix".



---

archive/issue_comments_248840.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nNot so fast, I haven't actually reviewed all your changes.",
    "created_at": "2015-04-22T19:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248840",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>**Comment 34:**</a>
Not so fast, I haven't actually reviewed all your changes.



---

archive/issue_events_220909.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T19:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220909"
}
```



---

archive/issue_events_220910.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T19:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220910"
}
```



---

archive/issue_comments_248841.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nMy comments (all easy to fix):\n\n1. Conversion `numpy.floating` -> `QQ` should use `RR` directly, instead of `numpy.floating` -> `RDF` which then converts to `RR`.\n\n2. The reference to #15965 is wrong.\n\n3. In `src/sage/rings/real_double.pyx`, I would prefer to split up `if S is ZZ or S is QQ or S is RLF or (isinstance(S, RealField_class) and S.prec() >= 53)` in several cases, just like for `CDF` (in particular, if the precision is too small, we can return `None` immediately).\n\n4. Python considers `bool` a subclass of `int`, so\n\n```\nissubclass(py_type, int) or issubclass(py_type, long) or issubclass(py_type, bool)\n```\ncan be replaced by\n\n```\nissubclass(py_type, int) or issubclass(py_type, long)\n```\n\n5. In doctests, please replace `1jr` by the more natural `I` (unless you have a good reason to not do this)\n\n6. In `NumpyToSRMorphism.__init__`, could you raise a `TypeError` if `numpy_type` doesn't satisfy any of the `issubclass()` checks (and add a doctest for this case). Also, the second `if` should better be an `elif`.",
    "created_at": "2015-04-23T10:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248841",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>**Comment 35:**</a>
My comments (all easy to fix):

1. Conversion `numpy.floating` -> `QQ` should use `RR` directly, instead of `numpy.floating` -> `RDF` which then converts to `RR`.

2. The reference to #15965 is wrong.

3. In `src/sage/rings/real_double.pyx`, I would prefer to split up `if S is ZZ or S is QQ or S is RLF or (isinstance(S, RealField_class) and S.prec() >= 53)` in several cases, just like for `CDF` (in particular, if the precision is too small, we can return `None` immediately).

4. Python considers `bool` a subclass of `int`, so

```
issubclass(py_type, int) or issubclass(py_type, long) or issubclass(py_type, bool)
```
can be replaced by

```
issubclass(py_type, int) or issubclass(py_type, long)
```

5. In doctests, please replace `1jr` by the more natural `I` (unless you have a good reason to not do this)

6. In `NumpyToSRMorphism.__init__`, could you raise a `TypeError` if `numpy_type` doesn't satisfy any of the `issubclass()` checks (and add a doctest for this case). Also, the second `if` should better be an `elif`.



---

archive/issue_events_220911.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T10:12:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220911"
}
```



---

archive/issue_events_220912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T10:12:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220912"
}
```



---

archive/issue_comments_248842.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nI'm also wondering if this check is really needed:\n\n```\nif ty != type(y + x):\n    raise RuntimeError(\"x + y and y + x have different types...\")\n```\n\nFirst of all, I cannot find any case where this happens. Second, even if it does happen, would it really be a problem?",
    "created_at": "2015-04-23T10:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248842",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'>**Comment 37:**</a>
I'm also wondering if this check is really needed:

```
if ty != type(y + x):
    raise RuntimeError("x + y and y + x have different types...")
```

First of all, I cannot find any case where this happens. Second, even if it does happen, would it really be a problem?



---

archive/issue_comments_248843.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@jdemeyer](#comment%3A37):\n> I'm also wondering if this check is really needed:\n> \n> ```\n> if ty != type(y + x):\n>     raise RuntimeError(\"x + y and y + x have different types...\")\n> ```\n> \n> First of all, I cannot find any case where this happens. \n\n```\nsage: numpy.int16(1) + 1.0\n2.0\nsage: type(_)\n<type 'numpy.float64'>\nsage: 1.0 + numpy.int16(1)\n2.00000000000000\nsage: type(_)\n<type 'sage.rings.real_mpfr.RealNumber'>\n```\nBut the canonical coercion is fine since we do have a coercion from numpy types to real numbers.\n\n> Second, even if it does happen, would it really be a problem?\n\nI don't know. You would prefer that we get rid of it?\n\nVincent",
    "created_at": "2015-04-23T10:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248843",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@jdemeyer](#comment%3A37):
> I'm also wondering if this check is really needed:
> 
> ```
> if ty != type(y + x):
>     raise RuntimeError("x + y and y + x have different types...")
> ```
> 
> First of all, I cannot find any case where this happens. 

```
sage: numpy.int16(1) + 1.0
2.0
sage: type(_)
<type 'numpy.float64'>
sage: 1.0 + numpy.int16(1)
2.00000000000000
sage: type(_)
<type 'sage.rings.real_mpfr.RealNumber'>
```
But the canonical coercion is fine since we do have a coercion from numpy types to real numbers.

> Second, even if it does happen, would it really be a problem?

I don't know. You would prefer that we get rid of it?

Vincent



---

archive/issue_comments_248844.json:
```json
{
    "body": "**Changing commit** from \"[d4c53ac38372916a2e81100e2c4dd360b5afcf51](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)\" to \"[dc770406c96a27d7925a149f01bdc4e88123392b](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)\".",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248844",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[d4c53ac38372916a2e81100e2c4dd360b5afcf51](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)" to "[dc770406c96a27d7925a149f01bdc4e88123392b](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)".



---

archive/issue_comments_248845.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b\">dc77040</a></td><td><code>Trac 18076: review commit</code></td></tr></table>\n",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248845",
    "user": "https://github.com/videlec"
}
```

<a id='comment:39'>**Comment 39:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b">dc77040</a></td><td><code>Trac 18076: review commit</code></td></tr></table>




---

archive/issue_comments_248846.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\" to \"[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)\".",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248846",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)" to "[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)".



---

archive/issue_events_220913.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:14:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220913"
}
```



---

archive/issue_events_220914.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:14:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220914"
}
```



---

archive/issue_comments_248847.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nReplying to [@videlec](#comment%3A38):\n> I don't know. You would prefer that we get rid of it?\n\nGiven that I see no reason to have the check, I'd rather remove it.\n\nI think you did your search-and-replace a bit too naive, this is a syntax error: `numpy.complex128(-2+.I)`",
    "created_at": "2015-04-23T11:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248847",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>**Comment 40:**</a>
Replying to [@videlec](#comment%3A38):
> I don't know. You would prefer that we get rid of it?

Given that I see no reason to have the check, I'd rather remove it.

I think you did your search-and-replace a bit too naive, this is a syntax error: `numpy.complex128(-2+.I)`



---

archive/issue_events_220915.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T11:39:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220915"
}
```



---

archive/issue_events_220916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T11:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220916"
}
```



---

archive/issue_comments_248848.json:
```json
{
    "body": "**Changing commit** from \"[dc770406c96a27d7925a149f01bdc4e88123392b](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)\" to \"[ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)\".",
    "created_at": "2015-04-23T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248848",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[dc770406c96a27d7925a149f01bdc4e88123392b](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)" to "[ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)".



---

archive/issue_comments_248849.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7\">ccaf80c</a></td><td><code>Trac 18076: more fixes in structure.coerce</code></td></tr></table>\n",
    "created_at": "2015-04-23T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248849",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'>**Comment 41:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7">ccaf80c</a></td><td><code>Trac 18076: more fixes in structure.coerce</code></td></tr></table>




---

archive/issue_events_220917.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:52:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220917"
}
```



---

archive/issue_events_220918.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:52:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220918"
}
```



---

archive/issue_events_220919.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T12:00:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220919"
}
```



---

archive/issue_events_220920.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T12:00:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220920"
}
```



---

archive/issue_events_220921.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-25T03:52:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220921"
}
```



---

archive/issue_events_220922.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-25T03:52:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220922"
}
```



---

archive/issue_comments_248850.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nOn 32-bit:\n\n```\nsage -t --long src/sage/structure/coerce.pyx\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 334, in sage.structure.coerce.CoercionModel_cache_maps\nFailed example:\n    type(_)\nExpected:\n    <type 'numpy.int64'>\nGot:\n    <type 'numpy.int32'>\n**********************************************************************\n1 item had failures:\n   1 of  22 in sage.structure.coerce.CoercionModel_cache_maps\n    [272 tests, 1 failure, 0.41 s]\n```",
    "created_at": "2015-04-25T03:52:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248850",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'>**Comment 44:**</a>
On 32-bit:

```
sage -t --long src/sage/structure/coerce.pyx
**********************************************************************
File "src/sage/structure/coerce.pyx", line 334, in sage.structure.coerce.CoercionModel_cache_maps
Failed example:
    type(_)
Expected:
    <type 'numpy.int64'>
Got:
    <type 'numpy.int32'>
**********************************************************************
1 item had failures:
   1 of  22 in sage.structure.coerce.CoercionModel_cache_maps
    [272 tests, 1 failure, 0.41 s]
```



---

archive/issue_comments_248851.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)\" to \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\".",
    "created_at": "2015-04-25T08:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248851",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)" to "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)".



---

archive/issue_comments_248852.json:
```json
{
    "body": "**Changing commit** from \"[ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)\" to \"[8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)\".",
    "created_at": "2015-04-25T08:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248852",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)" to "[8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)".



---

archive/issue_comments_248853.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f\">8b0cf39</a></td><td><code>Fix doctest different on 32 vs. 64 bits</code></td></tr></table>\n",
    "created_at": "2015-04-25T08:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248853",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'>**Comment 46:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f">8b0cf39</a></td><td><code>Fix doctest different on 32 vs. 64 bits</code></td></tr></table>




---

archive/issue_events_220923.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T08:57:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220923"
}
```



---

archive/issue_events_220924.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T08:57:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220924"
}
```



---

archive/issue_comments_248854.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nIt does not affect floating point?\n\n```\nsage: numpy.int8('12') + 1/3\n12.333333333333334\nsage: type(_)\n<type 'numpy.float64'>\n```",
    "created_at": "2015-04-25T09:05:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248854",
    "user": "https://github.com/videlec"
}
```

<a id='comment:47'>**Comment 47:**</a>
It does not affect floating point?

```
sage: numpy.int8('12') + 1/3
12.333333333333334
sage: type(_)
<type 'numpy.float64'>
```



---

archive/issue_comments_248855.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nLet's assume that it's right...",
    "created_at": "2015-04-27T15:04:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248855",
    "user": "https://github.com/videlec"
}
```

<a id='comment:48'>**Comment 48:**</a>
Let's assume that it's right...



---

archive/issue_events_220925.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-27T15:04:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220925"
}
```



---

archive/issue_events_220926.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-27T15:04:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220926"
}
```



---

archive/issue_comments_248856.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)\" to \"[8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)\".",
    "created_at": "2015-04-28T04:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248856",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)" to "[8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)".



---

archive/issue_events_220927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-28T04:44:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220927"
}
```



---

archive/issue_events_220928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "93a7ac623a7d5ea9a12a0e8e21c07cfb386c9baa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-28T04:44:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-220928"
}
```
