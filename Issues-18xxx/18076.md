# Issue 18076: Coercion for numpy types

archive/issues_017839.json:
```json
{
    "assignees": [],
    "body": "Plenty of bugs have been reported for the interaction with numpy:\n- #8426: polynomial * constant does not work if constant is a numpy type\n- #8949: symbolic functions dont work with numpy.int32\n- #9769: symbolic function do not work with numpy.int64 arguments\n- #13386: comparison of Sage integer with Numpy integer\n- #15695: Coercion problems between numpy and sage floats\n- #17758: Intervals and numpy floats do not compare correctly\n- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n\nWe solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail\n\n```\nsage: import numpy\n\nsage: f(t) = t^2\nsage: f(numpy.int32('1'))\n1\n\nsage: sin(numpy.int32(10))\nsin(10)\n\nsage: 123 == numpy.int32(123)\nTrue\n\nsage: 1j + numpy.float(2)\n2.00000000000000 + 1.00000000000000*I\nsage: parent(_)\nComplex Field with 53 bits of precision\n\nsage: RIF(1) <= numpy.float64(2.0)\nTrue \n```\n\nSome of them depend on modifying some internal in numpy and will not be solved here:\n- #8824: Make it so that numpy datatypes are integrated into the coercion model\n\nDepends on #18121\n\nAssignee: **@videlec**\n\nCC:  @sagetrac-tmonteil\n\nKeywords: **sd66**\n\nBranch/Commit: **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**\n\nReviewer: **Jeroen Demeyer, Vincent Delecroix**\n\nAuthor: **Vincent Delecroix, Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18076_\n\n",
    "closed_at": "2015-04-28T04:44:37Z",
    "created_at": "2015-03-28T00:03:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Coercion for numpy types",
    "type": "issue",
    "updated_at": "2015-04-28T04:44:37Z",
    "url": "https://github.com/sagemath/sage/issues/18076",
    "user": "https://github.com/videlec"
}
```
Plenty of bugs have been reported for the interaction with numpy:
- #8426: polynomial * constant does not work if constant is a numpy type
- #8949: symbolic functions dont work with numpy.int32
- #9769: symbolic function do not work with numpy.int64 arguments
- #13386: comparison of Sage integer with Numpy integer
- #15695: Coercion problems between numpy and sage floats
- #17758: Intervals and numpy floats do not compare correctly
- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks

We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail

```
sage: import numpy

sage: f(t) = t^2
sage: f(numpy.int32('1'))
1

sage: sin(numpy.int32(10))
sin(10)

sage: 123 == numpy.int32(123)
True

sage: 1j + numpy.float(2)
2.00000000000000 + 1.00000000000000*I
sage: parent(_)
Complex Field with 53 bits of precision

sage: RIF(1) <= numpy.float64(2.0)
True 
```

Some of them depend on modifying some internal in numpy and will not be solved here:
- #8824: Make it so that numpy datatypes are integrated into the coercion model

Depends on #18121

Assignee: **@videlec**

CC:  @sagetrac-tmonteil

Keywords: **sd66**

Branch/Commit: **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**

Reviewer: **Jeroen Demeyer, Vincent Delecroix**

Author: **Vincent Delecroix, Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/18076_





---

archive/issue_events_239375.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239375"
}
```



---

archive/issue_events_239376.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239376"
}
```



---

archive/issue_events_239377.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239377"
}
```



---

archive/issue_events_239378.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T00:03:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239378"
}
```



---

archive/issue_comments_248857.json:
```json
{
    "body": "Assignee: **@videlec**",
    "created_at": "2015-03-28T00:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248857",
    "user": "https://github.com/videlec"
}
```

Assignee: **@videlec**



---

archive/issue_comments_248858.json:
```json
{
    "body": "Commit: **[f739d53](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)**",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248858",
    "user": "https://github.com/videlec"
}
```

Commit: **[f739d53](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)**



---

archive/issue_comments_248859.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586\">f739d53</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr></table>\n",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248859",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2" align="right">Comment 2</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586">f739d53</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr></table>




---

archive/issue_comments_248860.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,8 +5,9 @@\n - #13386: comparison of Sage integer with Numpy integer\n - #15695: Coercion problems between numpy and sage floats\n - #17758: Intervals and numpy floats do not compare correctly\n+- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n \n-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`.\n+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.\n \n Some of them depend on modifying some internal in numpy and will not be solved here:\n-- - #8824: Make it so that numpy datatypes are integrated into the coercion model\n+- #8824: Make it so that numpy datatypes are integrated into the coercion model\n``````\n",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248860",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,8 +5,9 @@
 - #13386: comparison of Sage integer with Numpy integer
 - #15695: Coercion problems between numpy and sage floats
 - #17758: Intervals and numpy floats do not compare correctly
+- #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks
 
-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`.
+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.
 
 Some of them depend on modifying some internal in numpy and will not be solved here:
-- - #8824: Make it so that numpy datatypes are integrated into the coercion model
+- #8824: Make it so that numpy datatypes are integrated into the coercion model
``````




---

archive/issue_comments_248861.json:
```json
{
    "body": "Branch: **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**",
    "created_at": "2015-03-28T11:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248861",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**



---

archive/issue_comments_248862.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nNot so bad... got three problematic files\n\n```\nsage -t --long src/sage/plot/plot.py  # 2 doctests failed\nsage -t --long src/sage/plot/graphics.py  # 1 doctest failed\nsage -t --long src/doc/en/thematic_tutorials/numerical_sage/numpy.rst  # 1 doctest failed\n```",
    "created_at": "2015-03-28T20:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248862",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">Comment 3</div>

Not so bad... got three problematic files

```
sage -t --long src/sage/plot/plot.py  # 2 doctests failed
sage -t --long src/sage/plot/graphics.py  # 1 doctest failed
sage -t --long src/doc/en/thematic_tutorials/numerical_sage/numpy.rst  # 1 doctest failed
```



---

archive/issue_comments_248863.json:
```json
{
    "body": "Changed commit from **[f739d53](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)** to **[1a76757](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)**",
    "created_at": "2015-03-28T21:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248863",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f739d53](https://github.com/sagemath/sagetrac-mirror/commit/f739d53004dd326ef6412dc4f0ec283e59970586)** to **[1a76757](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)**



---

archive/issue_comments_248864.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126\">1a76757</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248864",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4" align="right">Comment 4</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126">1a76757</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_comments_248865.json:
```json
{
    "body": "Changed commit from **[1a76757](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)** to **[b0c8375](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)**",
    "created_at": "2015-03-28T21:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248865",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1a76757](https://github.com/sagemath/sagetrac-mirror/commit/1a76757d67024985b529cc54a7eb399305c15126)** to **[b0c8375](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)**



---

archive/issue_comments_248866.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c\">b0c8375</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248866",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c">b0c8375</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_comments_248867.json:
```json
{
    "body": "Changed commit from **[b0c8375](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)** to **[1d2148e](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)**",
    "created_at": "2015-03-28T21:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248867",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b0c8375](https://github.com/sagemath/sagetrac-mirror/commit/b0c83753b4eee2f5ba3c9558acae517d8508919c)** to **[1d2148e](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)**



---

archive/issue_comments_248868.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1\">1d2148e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>\n",
    "created_at": "2015-03-28T21:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248868",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6" align="right">Comment 6</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1">1d2148e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr></table>




---

archive/issue_events_239379.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-28T21:09:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239379"
}
```



---

archive/issue_comments_248869.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,29 @@\n - #17758: Intervals and numpy floats do not compare correctly\n - #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks\n \n-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.\n+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail\n+\n+```\n+sage: import numpy\n+\n+sage: f(t) = t^2\n+sage: f(numpy.int32('1'))\n+1\n+\n+sage: sin(numpy.int32(10))\n+sin(10)\n+\n+sage: 123 == numpy.int32(123)\n+True\n+\n+sage: 1j + numpy.float(2)\n+2.00000000000000 + 1.00000000000000*I\n+sage: parent(_)\n+Complex Field with 53 bits of precision\n+\n+sage: RIF(1) <= numpy.float64(2.0)\n+True \n+```\n \n Some of them depend on modifying some internal in numpy and will not be solved here:\n - #8824: Make it so that numpy datatypes are integrated into the coercion model\n``````\n",
    "created_at": "2015-03-30T16:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248869",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,29 @@
 - #17758: Intervals and numpy floats do not compare correctly
 - #17865: get rid of _native_coercion_ranks_inv and _native_coercion_ranks
 
-We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition.
+We solve them all by defining coercions of numpy integers to `ZZ`, numpy floating to `RDF` and numpy complex floating to `CDF`. Also, coercion between numerical types (in `sage.structure.coerce`) are now done directly via the addition. In particular, all of this used to fail
+
+```
+sage: import numpy
+
+sage: f(t) = t^2
+sage: f(numpy.int32('1'))
+1
+
+sage: sin(numpy.int32(10))
+sin(10)
+
+sage: 123 == numpy.int32(123)
+True
+
+sage: 1j + numpy.float(2)
+2.00000000000000 + 1.00000000000000*I
+sage: parent(_)
+Complex Field with 53 bits of precision
+
+sage: RIF(1) <= numpy.float64(2.0)
+True 
+```
 
 Some of them depend on modifying some internal in numpy and will not be solved here:
 - #8824: Make it so that numpy datatypes are integrated into the coercion model
``````




---

archive/issue_comments_248870.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n3 failing doctests, see patchbot report",
    "created_at": "2015-03-31T18:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248870",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">Comment 9</div>

3 failing doctests, see patchbot report



---

archive/issue_events_239380.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-31T18:30:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239380"
}
```



---

archive/issue_events_239381.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-03-31T18:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239381"
}
```



---

archive/issue_comments_248871.json:
```json
{
    "body": "Changed commit from **[1d2148e](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)** to **[dbe635f](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)**",
    "created_at": "2015-03-31T19:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248871",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1d2148e](https://github.com/sagemath/sagetrac-mirror/commit/1d2148e8a0eb2dbfd3575f209ced87626e84c6b1)** to **[dbe635f](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)**



---

archive/issue_comments_248872.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f187d02e30ce46723df91b8d2c738e2162168761\">f187d02</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd5601ee8fb866139bf5be1852cf4a4dd3043972\">fd5601e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db\">dbe635f</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>\n",
    "created_at": "2015-03-31T19:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248872",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10" align="right">Comment 10</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f187d02e30ce46723df91b8d2c738e2162168761">f187d02</a></td><td><code>Trac 18076: be nicer with numpy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd5601ee8fb866139bf5be1852cf4a4dd3043972">fd5601e</a></td><td><code>Trac 18076: fix coercions of numpy arrays</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db">dbe635f</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>




---

archive/issue_comments_248873.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@fchapoton](#comment%3A9):\n> 3 failing doctests, see patchbot report\n\nIs that all?",
    "created_at": "2015-03-31T19:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248873",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@fchapoton](#comment%3A9):
> 3 failing doctests, see patchbot report

Is that all?



---

archive/issue_events_239382.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-31T19:59:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239382"
}
```



---

archive/issue_events_239383.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-31T19:59:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239383"
}
```



---

archive/issue_events_239384.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-01T16:48:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239384"
}
```



---

archive/issue_events_239385.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-01T16:48:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239385"
}
```



---

archive/issue_comments_248874.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nstill one failing doctest, see patchbot report.\n\nD\u00e9sol\u00e9 de ne pas faire de commentaires plus constructifs, vraiment.",
    "created_at": "2015-04-01T16:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248874",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">Comment 13</div>

still one failing doctest, see patchbot report.

Désolé de ne pas faire de commentaires plus constructifs, vraiment.



---

archive/issue_comments_248875.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5\">6b51a65</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>\n",
    "created_at": "2015-04-01T21:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248875",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14" align="right">Comment 14</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5">6b51a65</a></td><td><code>Trac 18076: fix some doctests</code></td></tr></table>




---

archive/issue_comments_248876.json:
```json
{
    "body": "Changed commit from **[dbe635f](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)** to **[6b51a65](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)**",
    "created_at": "2015-04-01T21:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248876",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dbe635f](https://github.com/sagemath/sagetrac-mirror/commit/dbe635f3401ae345516330c0b1d9f570352f31db)** to **[6b51a65](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)**



---

archive/issue_events_239386.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-01T21:44:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239386"
}
```



---

archive/issue_events_239387.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-01T21:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239387"
}
```



---

archive/issue_comments_248877.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@fchapoton](#comment%3A13):\n> still one failing doctest, see patchbot report.\n> \n> D\u00e9sol\u00e9 de ne pas faire de commentaires plus constructifs, vraiment.\n\nDone!",
    "created_at": "2015-04-01T21:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248877",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@fchapoton](#comment%3A13):
> still one failing doctest, see patchbot report.
> 
> Désolé de ne pas faire de commentaires plus constructifs, vraiment.

Done!



---

archive/issue_comments_248878.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nThere is a incomplete trac number XYZ:\n\n```\n+ This used to fail (see :trac:`XYZ`)::\n```",
    "created_at": "2015-04-03T15:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248878",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:16" align="right">Comment 16</div>

There is a incomplete trac number XYZ:

```
+ This used to fail (see :trac:`XYZ`)::
```



---

archive/issue_comments_248879.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nMy intention is to make this depend on #18121.",
    "created_at": "2015-04-04T07:02:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248879",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">Comment 17</div>

My intention is to make this depend on #18121.



---

archive/issue_comments_248880.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to **Vincent Delecroix, Jeroen Demeyer**",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248880",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Vincent Delecroix** to **Vincent Delecroix, Jeroen Demeyer**



---

archive/issue_comments_248881.json:
```json
{
    "body": "Dependencies: **#18121**",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248881",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#18121**



---

archive/issue_comments_248882.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-04-07T09:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248882",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_248883.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**",
    "created_at": "2015-04-07T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248883",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**



---

archive/issue_comments_248884.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nThis looks wrong to me:\n\n```\nsage: numpy.int8('12') + 1/3\n12.333333333333334\n```\nWhy is the answer a float???\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5532969cc7c462d24788585030ab662cf05b024b\">5532969</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd2531d2ab79f8db4357788248bb5d936b920b85\">fd2531d</a></td><td><code>Merge commit '5532969cc7c462d24788585030ab662cf05b024b' into t/18076/18076</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac\">c3e4671</a></td><td><code>Introduce new function \"is_numpy_type\"</code></td></tr></table>\n",
    "created_at": "2015-04-07T10:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248884",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">Comment 20</div>

This looks wrong to me:

```
sage: numpy.int8('12') + 1/3
12.333333333333334
```
Why is the answer a float???

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5532969cc7c462d24788585030ab662cf05b024b">5532969</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd2531d2ab79f8db4357788248bb5d936b920b85">fd2531d</a></td><td><code>Merge commit '5532969cc7c462d24788585030ab662cf05b024b' into t/18076/18076</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac">c3e4671</a></td><td><code>Introduce new function "is_numpy_type"</code></td></tr></table>




---

archive/issue_comments_248885.json:
```json
{
    "body": "Changed commit from **[6b51a65](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)** to **[c3e4671](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)**",
    "created_at": "2015-04-07T10:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248885",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[6b51a65](https://github.com/sagemath/sagetrac-mirror/commit/6b51a65164956dbd398e8af21b843f39931cadd5)** to **[c3e4671](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)**



---

archive/issue_events_239388.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:05:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239388"
}
```



---

archive/issue_events_239389.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T10:05:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239389"
}
```



---

archive/issue_comments_248886.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@jdemeyer](#comment%3A20):\n> This looks wrong to me:\n> \n> ```\n> sage: numpy.int8('12') + 1/3\n> 12.333333333333334\n> ```\n> Why is the answer a float???\n\nThis is because the addition is handled by numpy and not by the rational. Simlarly\n\n```\nsage: import numpy\nsage: numpy.int64('1') + 1\n2\nsage: parent(_)\n<type 'numpy.int64'>\n```\nThere is a comment somewhere that this can be an upstream request.",
    "created_at": "2015-04-07T10:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248886",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@jdemeyer](#comment%3A20):
> This looks wrong to me:
> 
> ```
> sage: numpy.int8('12') + 1/3
> 12.333333333333334
> ```
> Why is the answer a float???

This is because the addition is handled by numpy and not by the rational. Simlarly

```
sage: import numpy
sage: numpy.int64('1') + 1
2
sage: parent(_)
<type 'numpy.int64'>
```
There is a comment somewhere that this can be an upstream request.



---

archive/issue_comments_248887.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nsee also #8824",
    "created_at": "2015-04-07T10:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248887",
    "user": "https://github.com/videlec"
}
```

<div id="comment:22" align="right">Comment 22</div>

see also #8824



---

archive/issue_comments_248888.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@videlec](#comment%3A21):\n> Replying to [@jdemeyer](#comment%3A20):\n> > This looks wrong to me:\n> > \n> > ```\n> > sage: numpy.int8('12') + 1/3\n> > 12.333333333333334\n> > ```\n> > Why is the answer a float???\n\n> \n> This is because the addition is handled by numpy and not by the rational.\n\nI see. It doesn't use the Sage coercion framework at all.\n\nCould you clarify this in the docstring when you write this example?",
    "created_at": "2015-04-07T11:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248888",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@videlec](#comment%3A21):
> Replying to [@jdemeyer](#comment%3A20):
> > This looks wrong to me:
> > 
> > ```
> > sage: numpy.int8('12') + 1/3
> > 12.333333333333334
> > ```
> > Why is the answer a float???

> 
> This is because the addition is handled by numpy and not by the rational.

I see. It doesn't use the Sage coercion framework at all.

Could you clarify this in the docstring when you write this example?



---

archive/issue_comments_248889.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nCould you please add doctests for all the tickets you're marking as duplicate of this one? For example, there is no doctest for #8949.",
    "created_at": "2015-04-07T11:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248889",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">Comment 24</div>

Could you please add doctests for all the tickets you're marking as duplicate of this one? For example, there is no doctest for #8949.



---

archive/issue_comments_248890.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4\">9c7a6f5</a></td><td><code>Trac 18076: precision about numpy and Sage coercion</code></td></tr></table>\n",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248890",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">Comment 25</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4">9c7a6f5</a></td><td><code>Trac 18076: precision about numpy and Sage coercion</code></td></tr></table>




---

archive/issue_comments_248891.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248891",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**



---

archive/issue_comments_248892.json:
```json
{
    "body": "Changed commit from **[c3e4671](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)** to **[9c7a6f5](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)**",
    "created_at": "2015-04-07T11:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248892",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[c3e4671](https://github.com/sagemath/sagetrac-mirror/commit/c3e467149631917bb5ea7d753ef5a18333dd29ac)** to **[9c7a6f5](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)**



---

archive/issue_events_239390.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239390"
}
```



---

archive/issue_events_239391.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239391"
}
```



---

archive/issue_events_239392.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-07T11:51:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "title_is": "Coercion for numpy types",
    "title_was": "Be nicer with numpy",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239392"
}
```



---

archive/issue_comments_248893.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2\">8af0216</a></td><td><code>Trac 18076: document all corrected bugs</code></td></tr></table>\n",
    "created_at": "2015-04-07T12:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248893",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27" align="right">Comment 27</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2">8af0216</a></td><td><code>Trac 18076: document all corrected bugs</code></td></tr></table>




---

archive/issue_comments_248894.json:
```json
{
    "body": "Changed commit from **[9c7a6f5](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)** to **[8af0216](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)**",
    "created_at": "2015-04-07T12:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248894",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9c7a6f5](https://github.com/sagemath/sagetrac-mirror/commit/9c7a6f517c54dfd70d36dd29828e0efd30fcb9a4)** to **[8af0216](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)**



---

archive/issue_comments_248895.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nFeel free to set this ticket back to needs_review (although somebody needs to review #18121 before this ticket can be formally reviewed).",
    "created_at": "2015-04-07T15:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248895",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">Comment 28</div>

Feel free to set this ticket back to needs_review (although somebody needs to review #18121 before this ticket can be formally reviewed).



---

archive/issue_events_239393.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-09T19:54:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239393"
}
```



---

archive/issue_events_239394.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-09T19:54:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239394"
}
```



---

archive/issue_comments_248896.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nVarious conflicts, rebasing...",
    "created_at": "2015-04-22T08:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248896",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">Comment 30</div>

Various conflicts, rebasing...



---

archive/issue_events_239395.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239395"
}
```



---

archive/issue_events_239396.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239396"
}
```



---

archive/issue_events_239397.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239397"
}
```



---

archive/issue_events_239398.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T08:24:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239398"
}
```



---

archive/issue_comments_248897.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**",
    "created_at": "2015-04-22T08:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248897",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**



---

archive/issue_comments_248898.json:
```json
{
    "body": "Changed commit from **[8af0216](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)** to **[d4c53ac](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)**",
    "created_at": "2015-04-22T09:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248898",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[8af0216](https://github.com/sagemath/sagetrac-mirror/commit/8af0216f6b910e29632b5c0b1fc105176d5f5df2)** to **[d4c53ac](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)**



---

archive/issue_comments_248899.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a10dcbaaaefb87d48cf337be367cd48f11ed6edf\">a10dcba</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77e38d28e608521c7a79decf16bfb3f09b089737\">77e38d2</a></td><td><code>Define 3-argument version Py_VISIT3 of Py_VISIT</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58c17fbe84b31e534be250907717c52b8827e1d8\">58c17fb</a></td><td><code>cimport PyWeakref_GetObject() from cpython.weakref</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51\">d4c53ac</a></td><td><code>Coercion for numpy types</code></td></tr></table>\n",
    "created_at": "2015-04-22T09:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248899",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">Comment 32</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a10dcbaaaefb87d48cf337be367cd48f11ed6edf">a10dcba</a></td><td><code>Use PyTypeObject from Cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77e38d28e608521c7a79decf16bfb3f09b089737">77e38d2</a></td><td><code>Define 3-argument version Py_VISIT3 of Py_VISIT</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58c17fbe84b31e534be250907717c52b8827e1d8">58c17fb</a></td><td><code>cimport PyWeakref_GetObject() from cpython.weakref</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51">d4c53ac</a></td><td><code>Coercion for numpy types</code></td></tr></table>




---

archive/issue_events_239399.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:14:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239399"
}
```



---

archive/issue_events_239400.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:14:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239400"
}
```



---

archive/issue_events_239401.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-22T19:31:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239401"
}
```



---

archive/issue_events_239402.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-22T19:31:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239402"
}
```



---

archive/issue_comments_248900.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nThis is fine for me. And all test pass.\n\nVincent",
    "created_at": "2015-04-22T19:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248900",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">Comment 33</div>

This is fine for me. And all test pass.

Vincent



---

archive/issue_comments_248901.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**",
    "created_at": "2015-04-22T19:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248901",
    "user": "https://github.com/videlec"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**



---

archive/issue_comments_248902.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nNot so fast, I haven't actually reviewed all your changes.",
    "created_at": "2015-04-22T19:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248902",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

Not so fast, I haven't actually reviewed all your changes.



---

archive/issue_events_239403.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T19:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239403"
}
```



---

archive/issue_events_239404.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T19:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239404"
}
```



---

archive/issue_comments_248903.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nMy comments (all easy to fix):\n\n1. Conversion `numpy.floating` -> `QQ` should use `RR` directly, instead of `numpy.floating` -> `RDF` which then converts to `RR`.\n\n2. The reference to #15965 is wrong.\n\n3. In `src/sage/rings/real_double.pyx`, I would prefer to split up `if S is ZZ or S is QQ or S is RLF or (isinstance(S, RealField_class) and S.prec() >= 53)` in several cases, just like for `CDF` (in particular, if the precision is too small, we can return `None` immediately).\n\n4. Python considers `bool` a subclass of `int`, so\n\n```\nissubclass(py_type, int) or issubclass(py_type, long) or issubclass(py_type, bool)\n```\ncan be replaced by\n\n```\nissubclass(py_type, int) or issubclass(py_type, long)\n```\n\n5. In doctests, please replace `1jr` by the more natural `I` (unless you have a good reason to not do this)\n\n6. In `NumpyToSRMorphism.__init__`, could you raise a `TypeError` if `numpy_type` doesn't satisfy any of the `issubclass()` checks (and add a doctest for this case). Also, the second `if` should better be an `elif`.",
    "created_at": "2015-04-23T10:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248903",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">Comment 35</div>

My comments (all easy to fix):

1. Conversion `numpy.floating` -> `QQ` should use `RR` directly, instead of `numpy.floating` -> `RDF` which then converts to `RR`.

2. The reference to #15965 is wrong.

3. In `src/sage/rings/real_double.pyx`, I would prefer to split up `if S is ZZ or S is QQ or S is RLF or (isinstance(S, RealField_class) and S.prec() >= 53)` in several cases, just like for `CDF` (in particular, if the precision is too small, we can return `None` immediately).

4. Python considers `bool` a subclass of `int`, so

```
issubclass(py_type, int) or issubclass(py_type, long) or issubclass(py_type, bool)
```
can be replaced by

```
issubclass(py_type, int) or issubclass(py_type, long)
```

5. In doctests, please replace `1jr` by the more natural `I` (unless you have a good reason to not do this)

6. In `NumpyToSRMorphism.__init__`, could you raise a `TypeError` if `numpy_type` doesn't satisfy any of the `issubclass()` checks (and add a doctest for this case). Also, the second `if` should better be an `elif`.



---

archive/issue_events_239405.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T10:12:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239405"
}
```



---

archive/issue_events_239406.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T10:12:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239406"
}
```



---

archive/issue_comments_248904.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI'm also wondering if this check is really needed:\n\n```\nif ty != type(y + x):\n    raise RuntimeError(\"x + y and y + x have different types...\")\n```\n\nFirst of all, I cannot find any case where this happens. Second, even if it does happen, would it really be a problem?",
    "created_at": "2015-04-23T10:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248904",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">Comment 37</div>

I'm also wondering if this check is really needed:

```
if ty != type(y + x):
    raise RuntimeError("x + y and y + x have different types...")
```

First of all, I cannot find any case where this happens. Second, even if it does happen, would it really be a problem?



---

archive/issue_comments_248905.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@jdemeyer](#comment%3A37):\n> I'm also wondering if this check is really needed:\n> \n> ```\n> if ty != type(y + x):\n>     raise RuntimeError(\"x + y and y + x have different types...\")\n> ```\n> \n> First of all, I cannot find any case where this happens. \n\n```\nsage: numpy.int16(1) + 1.0\n2.0\nsage: type(_)\n<type 'numpy.float64'>\nsage: 1.0 + numpy.int16(1)\n2.00000000000000\nsage: type(_)\n<type 'sage.rings.real_mpfr.RealNumber'>\n```\nBut the canonical coercion is fine since we do have a coercion from numpy types to real numbers.\n\n> Second, even if it does happen, would it really be a problem?\n\nI don't know. You would prefer that we get rid of it?\n\nVincent",
    "created_at": "2015-04-23T10:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248905",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@jdemeyer](#comment%3A37):
> I'm also wondering if this check is really needed:
> 
> ```
> if ty != type(y + x):
>     raise RuntimeError("x + y and y + x have different types...")
> ```
> 
> First of all, I cannot find any case where this happens. 

```
sage: numpy.int16(1) + 1.0
2.0
sage: type(_)
<type 'numpy.float64'>
sage: 1.0 + numpy.int16(1)
2.00000000000000
sage: type(_)
<type 'sage.rings.real_mpfr.RealNumber'>
```
But the canonical coercion is fine since we do have a coercion from numpy types to real numbers.

> Second, even if it does happen, would it really be a problem?

I don't know. You would prefer that we get rid of it?

Vincent



---

archive/issue_comments_248906.json:
```json
{
    "body": "Changed commit from **[d4c53ac](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)** to **[dc77040](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)**",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248906",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[d4c53ac](https://github.com/sagemath/sagetrac-mirror/commit/d4c53ac38372916a2e81100e2c4dd360b5afcf51)** to **[dc77040](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)**



---

archive/issue_comments_248907.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b\">dc77040</a></td><td><code>Trac 18076: review commit</code></td></tr></table>\n",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248907",
    "user": "https://github.com/videlec"
}
```

<div id="comment:39" align="right">Comment 39</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b">dc77040</a></td><td><code>Trac 18076: review commit</code></td></tr></table>




---

archive/issue_comments_248908.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**",
    "created_at": "2015-04-23T11:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248908",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)**



---

archive/issue_events_239407.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:14:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239407"
}
```



---

archive/issue_events_239408.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:14:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239408"
}
```



---

archive/issue_comments_248909.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nReplying to [@videlec](#comment%3A38):\n> I don't know. You would prefer that we get rid of it?\n\nGiven that I see no reason to have the check, I'd rather remove it.\n\nI think you did your search-and-replace a bit too naive, this is a syntax error: `numpy.complex128(-2+.I)`",
    "created_at": "2015-04-23T11:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248909",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">Comment 40</div>

Replying to [@videlec](#comment%3A38):
> I don't know. You would prefer that we get rid of it?

Given that I see no reason to have the check, I'd rather remove it.

I think you did your search-and-replace a bit too naive, this is a syntax error: `numpy.complex128(-2+.I)`



---

archive/issue_events_239409.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T11:39:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239409"
}
```



---

archive/issue_events_239410.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T11:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239410"
}
```



---

archive/issue_comments_248910.json:
```json
{
    "body": "Changed commit from **[dc77040](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)** to **[ccaf80c](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)**",
    "created_at": "2015-04-23T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248910",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dc77040](https://github.com/sagemath/sagetrac-mirror/commit/dc770406c96a27d7925a149f01bdc4e88123392b)** to **[ccaf80c](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)**



---

archive/issue_comments_248911.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7\">ccaf80c</a></td><td><code>Trac 18076: more fixes in structure.coerce</code></td></tr></table>\n",
    "created_at": "2015-04-23T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248911",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41" align="right">Comment 41</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7">ccaf80c</a></td><td><code>Trac 18076: more fixes in structure.coerce</code></td></tr></table>




---

archive/issue_events_239411.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:52:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239411"
}
```



---

archive/issue_events_239412.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-23T11:52:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239412"
}
```



---

archive/issue_events_239413.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T12:00:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239413"
}
```



---

archive/issue_events_239414.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-23T12:00:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239414"
}
```



---

archive/issue_events_239415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-25T03:52:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239415"
}
```



---

archive/issue_events_239416.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-25T03:52:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239416"
}
```



---

archive/issue_comments_248912.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nOn 32-bit:\n\n```\nsage -t --long src/sage/structure/coerce.pyx\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 334, in sage.structure.coerce.CoercionModel_cache_maps\nFailed example:\n    type(_)\nExpected:\n    <type 'numpy.int64'>\nGot:\n    <type 'numpy.int32'>\n**********************************************************************\n1 item had failures:\n   1 of  22 in sage.structure.coerce.CoercionModel_cache_maps\n    [272 tests, 1 failure, 0.41 s]\n```",
    "created_at": "2015-04-25T03:52:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248912",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:44" align="right">Comment 44</div>

On 32-bit:

```
sage -t --long src/sage/structure/coerce.pyx
**********************************************************************
File "src/sage/structure/coerce.pyx", line 334, in sage.structure.coerce.CoercionModel_cache_maps
Failed example:
    type(_)
Expected:
    <type 'numpy.int64'>
Got:
    <type 'numpy.int32'>
**********************************************************************
1 item had failures:
   1 of  22 in sage.structure.coerce.CoercionModel_cache_maps
    [272 tests, 1 failure, 0.41 s]
```



---

archive/issue_comments_248913.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**",
    "created_at": "2015-04-25T08:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248913",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18076)** to **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)**



---

archive/issue_comments_248914.json:
```json
{
    "body": "Changed commit from **[ccaf80c](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)** to **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**",
    "created_at": "2015-04-25T08:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248914",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[ccaf80c](https://github.com/sagemath/sagetrac-mirror/commit/ccaf80c11d5ad4cc7207f7d03d42a947a72aa9c7)** to **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**



---

archive/issue_comments_248915.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f\">8b0cf39</a></td><td><code>Fix doctest different on 32 vs. 64 bits</code></td></tr></table>\n",
    "created_at": "2015-04-25T08:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248915",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">Comment 46</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f">8b0cf39</a></td><td><code>Fix doctest different on 32 vs. 64 bits</code></td></tr></table>




---

archive/issue_events_239417.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T08:57:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239417"
}
```



---

archive/issue_events_239418.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-25T08:57:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239418"
}
```



---

archive/issue_comments_248916.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nIt does not affect floating point?\n\n```\nsage: numpy.int8('12') + 1/3\n12.333333333333334\nsage: type(_)\n<type 'numpy.float64'>\n```",
    "created_at": "2015-04-25T09:05:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248916",
    "user": "https://github.com/videlec"
}
```

<div id="comment:47" align="right">Comment 47</div>

It does not affect floating point?

```
sage: numpy.int8('12') + 1/3
12.333333333333334
sage: type(_)
<type 'numpy.float64'>
```



---

archive/issue_comments_248917.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nLet's assume that it's right...",
    "created_at": "2015-04-27T15:04:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248917",
    "user": "https://github.com/videlec"
}
```

<div id="comment:48" align="right">Comment 48</div>

Let's assume that it's right...



---

archive/issue_events_239419.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-27T15:04:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239419"
}
```



---

archive/issue_events_239420.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-27T15:04:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239420"
}
```



---

archive/issue_comments_248918.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**",
    "created_at": "2015-04-28T04:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18076#issuecomment-248918",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/18076](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/18076)** to **[8b0cf39](https://github.com/sagemath/sagetrac-mirror/commit/8b0cf3903f70460883cd4b8ba4ba90b0c30f7d8f)**



---

archive/issue_events_239421.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-28T04:44:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239421"
}
```



---

archive/issue_events_239422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "93a7ac623a7d5ea9a12a0e8e21c07cfb386c9baa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-28T04:44:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18076",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18076#event-239422"
}
```
