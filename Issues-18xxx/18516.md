# Issue 18516: Posets: canonical_label() returns a poset from lattice

archive/issues_018279.json:
```json
{
    "body": "```\nsage: L=LatticePoset({1:[2]}); L\nFinite lattice containing 2 elements\nsage: L.canonical_label()\nFinite poset containing 2 elements\n```\n\nCanonically relabeling a (semi)lattice should return a (semi)lattice. (Compare to `.relabel()`.)\n\nCC:  @nathanncohen\n\nBranch/Commit: 48952c18d6ba6ccd6750d8fb537adc5b3831aa0d\n\nReviewer: Nathann Cohen\n\nAuthor: Nathann Cohen, Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18516\n\n",
    "closed_at": "2015-06-11T13:50:55Z",
    "created_at": "2015-05-26T11:20:19Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Posets: canonical_label() returns a poset from lattice",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18516",
    "user": "https://github.com/jm58660"
}
```
```
sage: L=LatticePoset({1:[2]}); L
Finite lattice containing 2 elements
sage: L.canonical_label()
Finite poset containing 2 elements
```

Canonically relabeling a (semi)lattice should return a (semi)lattice. (Compare to `.relabel()`.)

CC:  @nathanncohen

Branch/Commit: 48952c18d6ba6ccd6750d8fb537adc5b3831aa0d

Reviewer: Nathann Cohen

Author: Nathann Cohen, Jori MÃ¤ntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18516





---

archive/issue_comments_247282.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-26T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247282",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_247283.json:
```json
{
    "body": "<a id='comment:2'></a>Simple correction.\n\n---\nNew commits:",
    "created_at": "2015-05-26T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247283",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>Simple correction.

---
New commits:



---

archive/issue_comments_247284.json:
```json
{
    "body": "<a id='comment:3'></a>Hellooooo,\n\nWhy wouldn't just call `FinitePoset.relabel` which already handles that?\n\nNathann",
    "created_at": "2015-05-26T12:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247284",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Hellooooo,

Why wouldn't just call `FinitePoset.relabel` which already handles that?

Nathann



---

archive/issue_comments_247285.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-05-26T12:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247285",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_247286.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 ncohen]:\n\n> Why wouldn't just call `FinitePoset.relabel` which already handles that?\n\n\nI don't understand. How? Calling `canonical_label` from DiGraph gives a DiGraph, not a dictionary that could be directly used for `relabel()`.",
    "created_at": "2015-05-26T13:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247286",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>Replying to [comment:3 ncohen]:

> Why wouldn't just call `FinitePoset.relabel` which already handles that?


I don't understand. How? Calling `canonical_label` from DiGraph gives a DiGraph, not a dictionary that could be directly used for `relabel()`.



---

archive/issue_comments_247287.json:
```json
{
    "body": "<a id='comment:6'></a>> I don't understand. How? Calling `canonical_label` from DiGraph gives a DiGraph, not a dictionary that could be directly used for `relabel()`.\n\n\n```\nsage: graphs.PetersenGraph().canonical_label(certify=True)\n(Graph on 10 vertices,\n {0: 9, 1: 8, 2: 5, 3: 4, 4: 6, 5: 7, 6: 2, 7: 3, 8: 1, 9: 0})\n```\n\nHonestly I don't see why `canonical_label` should always return a copy of the graph. In this present case, we see that it is not necessary at all `O_o`\n\nNathann",
    "created_at": "2015-05-26T13:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247287",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>> I don't understand. How? Calling `canonical_label` from DiGraph gives a DiGraph, not a dictionary that could be directly used for `relabel()`.


```
sage: graphs.PetersenGraph().canonical_label(certify=True)
(Graph on 10 vertices,
 {0: 9, 1: 8, 2: 5, 3: 4, 4: 6, 5: 7, 6: 2, 7: 3, 8: 1, 9: 0})
```

Honestly I don't see why `canonical_label` should always return a copy of the graph. In this present case, we see that it is not necessary at all `O_o`

Nathann



---

archive/issue_comments_247288.json:
```json
{
    "body": "<a id='comment:7'></a>OK. But actually... How is `self.canonical_label()` different from `Poset(self._hasse_diagram, linear_extension=self._with_linear_extension, category=self.category(), facade=self._is_facade)`? I.e. when is canonical label of Hasse diagram not already on canonically numbered?",
    "created_at": "2015-05-26T13:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247288",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>OK. But actually... How is `self.canonical_label()` different from `Poset(self._hasse_diagram, linear_extension=self._with_linear_extension, category=self.category(), facade=self._is_facade)`? I.e. when is canonical label of Hasse diagram not already on canonically numbered?



---

archive/issue_comments_247289.json:
```json
{
    "body": "<a id='comment:8'></a>> I.e. when is canonical label of Hasse diagram not already on canonically numbered?\n\n\nI am not sure I understand your question, but there is no reason why `_hasse_diagram` should be canonically labelled by default, even though it is integer-valued.",
    "created_at": "2015-05-26T13:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247289",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>> I.e. when is canonical label of Hasse diagram not already on canonically numbered?


I am not sure I understand your question, but there is no reason why `_hasse_diagram` should be canonically labelled by default, even though it is integer-valued.



---

archive/issue_comments_247290.json:
```json
{
    "body": "<a id='comment:9'></a>The point of using `FinitePoset.relabel` directly is that it handles the 'class' (`Lattice`, `MeetSemiLattice`, ...) already.",
    "created_at": "2015-05-26T13:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247290",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>The point of using `FinitePoset.relabel` directly is that it handles the 'class' (`Lattice`, `MeetSemiLattice`, ...) already.



---

archive/issue_comments_247291.json:
```json
{
    "body": "<a id='comment:10'></a>OK, so you mean to convert this to oneliner\n\n```\nself.relabel(self.cover_relations_graph().canonical_label(certify=True)[1])\n```\n\n? Then `relabel()` will take care of facade property, poset vs. lattice -thing and so on.",
    "created_at": "2015-05-26T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247291",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:10'></a>OK, so you mean to convert this to oneliner

```
self.relabel(self.cover_relations_graph().canonical_label(certify=True)[1])
```

? Then `relabel()` will take care of facade property, poset vs. lattice -thing and so on.



---

archive/issue_comments_247292.json:
```json
{
    "body": "<a id='comment:11'></a>> {{{\n> self.relabel(self.cover_relations_graph().canonical_label(certify=True)[1])\n> }}}\n> \n> ? Then `relabel()` will take care of facade property, poset vs. lattice -thing and so on.\n\n\nYep, that's the idea. Though you can avoid creating a copy of the graph by:\n1) computing the canonical label on _hasse_diagram\n2) \"relabel the canonical label\" using the correspondance between _hasse_diagram vertices and poset vertices\n3) call relabel on the poset itself with the \"relabelled\" canonical label\n\nNathann",
    "created_at": "2015-05-26T14:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247292",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>> {{{
> self.relabel(self.cover_relations_graph().canonical_label(certify=True)[1])
> }}}
> 
> ? Then `relabel()` will take care of facade property, poset vs. lattice -thing and so on.


Yep, that's the idea. Though you can avoid creating a copy of the graph by:
1) computing the canonical label on _hasse_diagram
2) "relabel the canonical label" using the correspondance between _hasse_diagram vertices and poset vertices
3) call relabel on the poset itself with the "relabelled" canonical label

Nathann



---

archive/issue_comments_247293.json:
```json
{
    "body": "<a id='comment:12'></a>Uh, got a headache. So you mean\n\n```\nself.relabel({self._list[e]:e for e in self._hasse_diagram.canonical_label(certify=True)[1]})\n```\n\n?",
    "created_at": "2015-05-26T16:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247293",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>Uh, got a headache. So you mean

```
self.relabel({self._list[e]:e for e in self._hasse_diagram.canonical_label(certify=True)[1]})
```

?



---

archive/issue_comments_247294.json:
```json
{
    "body": "<a id='comment:13'></a>I added a commit at public/18516.\n\nIt also fixes a bug, as the embedded linear extension seemed to be excluded from the relabelling.\n\nNathann",
    "created_at": "2015-05-27T11:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247294",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>I added a commit at public/18516.

It also fixes a bug, as the embedded linear extension seemed to be excluded from the relabelling.

Nathann



---

archive/issue_comments_247295.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 ncohen]:\n\n> I added a commit at public/18516.\n\n\nWhy those `# random` parts on doctests? And isn't `sorted` unneeded, as the order of 'a' and 'b' is always the same?\n\nAlso you say that this issue is now corrected, but give an example with `relabel` function, not with `canonical_relabel`?",
    "created_at": "2015-05-27T12:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247295",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:14'></a>Replying to [comment:13 ncohen]:

> I added a commit at public/18516.


Why those `# random` parts on doctests? And isn't `sorted` unneeded, as the order of 'a' and 'b' is always the same?

Also you say that this issue is now corrected, but give an example with `relabel` function, not with `canonical_relabel`?



---

archive/issue_comments_247296.json:
```json
{
    "body": "<a id='comment:15'></a>Hello !\n\n> Why those `# random` parts on doctests?\n\n\nBecause the doctests wrongly assume that the canonical label should never change. We had this problem with bliss: the canonical labels it returns are different from the ones returned by 'native' Sage.\n\nA labelling is 'canonical' in the sense that two isomorphic object will be relabelled to the same object. This being said, nothing says that a canonical label never changes in time, and in particular the documentation of Nauty says explicitly that it will.\n\n> And isn't `sorted` unneeded, as the order of 'a' and 'b' is always the same?\n\n\nI am not sure. These letters will be stored on dictionaries, and you never know what happens with dictionaires on different architectures. Anyway I removed that, because of your next comment:\n\n> Also you say that this issue is now corrected, but give an example with `relabel` function, not with `canonical_relabel`? \n\n\nMy mistake. I added another commit at the same location.\n\nNathann",
    "created_at": "2015-05-27T12:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247296",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'></a>Hello !

> Why those `# random` parts on doctests?


Because the doctests wrongly assume that the canonical label should never change. We had this problem with bliss: the canonical labels it returns are different from the ones returned by 'native' Sage.

A labelling is 'canonical' in the sense that two isomorphic object will be relabelled to the same object. This being said, nothing says that a canonical label never changes in time, and in particular the documentation of Nauty says explicitly that it will.

> And isn't `sorted` unneeded, as the order of 'a' and 'b' is always the same?


I am not sure. These letters will be stored on dictionaries, and you never know what happens with dictionaires on different architectures. Anyway I removed that, because of your next comment:

> Also you say that this issue is now corrected, but give an example with `relabel` function, not with `canonical_relabel`? 


My mistake. I added another commit at the same location.

Nathann



---

archive/issue_comments_247297.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 ncohen]:\n\n> A labelling is 'canonical' in the sense that two isomorphic object will be relabelled to the same object. This being said, nothing says that a canonical label never changes in time, and in particular the documentation of Nauty says explicitly that it will.\n\n\nOK. It seems to be good now, but I don't have time to test it just now.",
    "created_at": "2015-05-27T12:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247297",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:16'></a>Replying to [comment:15 ncohen]:

> A labelling is 'canonical' in the sense that two isomorphic object will be relabelled to the same object. This being said, nothing says that a canonical label never changes in time, and in particular the documentation of Nauty says explicitly that it will.


OK. It seems to be good now, but I don't have time to test it just now.



---

archive/issue_comments_247298.json:
```json
{
    "body": "<a id='comment:17'></a>New commits:",
    "created_at": "2015-05-27T15:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247298",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:17'></a>New commits:



---

archive/issue_comments_247299.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T16:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_247300.json:
```json
{
    "body": "<a id='comment:19'></a>After canonical relabeling we should be sure of the *elements* of the poset, even if not sure of their *position*, i.e. cover relations. Hence I removed a `# random`. But it seems that `sorted` does not work. Strange, what did I forgot?\n\nI also moved a part of documentation from tests to examples.\n\nMaybe these were stupid changes and should be reverted.",
    "created_at": "2015-05-27T16:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247300",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:19'></a>After canonical relabeling we should be sure of the *elements* of the poset, even if not sure of their *position*, i.e. cover relations. Hence I removed a `# random`. But it seems that `sorted` does not work. Strange, what did I forgot?

I also moved a part of documentation from tests to examples.

Maybe these were stupid changes and should be reverted.



---

archive/issue_comments_247301.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T16:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247301",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_247302.json:
```json
{
    "body": "<a id='comment:21'></a>I should not code today. There is no order for non-facade elements.",
    "created_at": "2015-05-27T16:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247302",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:21'></a>I should not code today. There is no order for non-facade elements.



---

archive/issue_comments_247303.json:
```json
{
    "body": "<a id='comment:22'></a>> I should not code today. There is no order for non-facade elements.\n\n\nYeah. I hate those things.",
    "created_at": "2015-05-27T16:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247303",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'></a>> I should not code today. There is no order for non-facade elements.


Yeah. I hate those things.



---

archive/issue_comments_247304.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T09:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_247305.json:
```json
{
    "body": "<a id='comment:24'></a>OK, now it should work.",
    "created_at": "2015-06-09T09:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247305",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:24'></a>OK, now it should work.



---

archive/issue_comments_247306.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-06-09T09:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247306",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_247307.json:
```json
{
    "body": "<a id='comment:25'></a>Yep !",
    "created_at": "2015-06-09T13:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247307",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:25'></a>Yep !



---

archive/issue_comments_247308.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-09T13:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247308",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_247309.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-11T13:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18516#issuecomment-247309",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052049.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-11T13:50:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18516",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18516#event-52049"
}
```
