# Issue 18611: Further isogeny improvement

archive/issues_018374.json:
```json
{
    "body": "To compute all `l`-isogenies, Sage uses a function `mult(f)` which computes\n\n```\ngcd( numerator(f(m)), psi )\n```\nwhere `m` is a rational function giving the multiplication-by-`m` map (the denominator of `m` is coprime to `psi`)\n\nInstead of the above computation, the inverse direction is actually easier to compute: given `g`, we want to find `f` such that\n\n```\ngcd( numerator(f(m)), psi ) = g\n```\nUsing some theory, this is equivalent to\n\n```\nf(m) = 0 mod g\n```\nSince `f` must be irreducible of the same degree as `g`, this is just the characteristic (= minimal) polynomial of `m mod g`.\n\n---\n\nExample timing:\n\n**before**\n\n```\nsage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\nCPU times: user 1min 52s, sys: 16 ms, total: 1min 52s\nWall time: 1min 52s\n```\n\n**after**\n\n```\nsage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\nCPU times: user 33.1 s, sys: 107 ms, total: 33.2 s\nWall time: 33.2 s\n```\n\nCC:  @JohnCremona\n\nBranch/Commit: 7dfcc8e3a8d27b923afaae87a0b4764008146f5d\n\nReviewer: John Cremona\n\nAuthor: Jeroen Demeyer\n\nDependencies: #18589\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18611\n\n",
    "closed_at": "2015-06-06T12:47:41Z",
    "created_at": "2015-06-04T19:45:02Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Further isogeny improvement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18611",
    "user": "https://github.com/jdemeyer"
}
```
To compute all `l`-isogenies, Sage uses a function `mult(f)` which computes

```
gcd( numerator(f(m)), psi )
```
where `m` is a rational function giving the multiplication-by-`m` map (the denominator of `m` is coprime to `psi`)

Instead of the above computation, the inverse direction is actually easier to compute: given `g`, we want to find `f` such that

```
gcd( numerator(f(m)), psi ) = g
```
Using some theory, this is equivalent to

```
f(m) = 0 mod g
```
Since `f` must be irreducible of the same degree as `g`, this is just the characteristic (= minimal) polynomial of `m mod g`.

---

Example timing:

**before**

```
sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s
Wall time: 1min 52s
```

**after**

```
sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s
Wall time: 33.2 s
```

CC:  @JohnCremona

Branch/Commit: 7dfcc8e3a8d27b923afaae87a0b4764008146f5d

Reviewer: John Cremona

Author: Jeroen Demeyer

Dependencies: #18589

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18611





---

archive/issue_comments_265477.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n \\`\\`\\`\n f(m) = 0 mod g\n \\`\\`\\`\n-Since \\`f\\` must be irreducible, this is just the characteristic (= minimal) polynomial of \\`a/b mod g\\`.\n+Since \\`f\\` must be irreducible, this is just the characteristic (= minimal) polynomial of \\`m mod g\\`.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-06-04T19:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265477",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -15,7 +15,7 @@
 \`\`\`
 f(m) = 0 mod g
 \`\`\`
-Since \`f\` must be irreducible, this is just the characteristic (= minimal) polynomial of \`a/b mod g\`.
+Since \`f\` must be irreducible, this is just the characteristic (= minimal) polynomial of \`m mod g\`.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_265478.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,41 @@\n+To compute all \\`l\\`-isogenies, Sage uses a function \\`mult(f)\\` which computes\n \n+\\`\\`\\`\n+gcd( numerator(f(m)), psi )\n+\\`\\`\\`\n+where \\`m\\` is a rational function giving the multiplication-by-\\`m\\` map.\n+\n+Instead of the above computation, the inverse direction is actually easier to compute: given \\`g\\`, we want to find \\`f\\` such that\n+\n+\\`\\`\\`\n+gcd( numerator(f(m)), psi ) = g\n+\\`\\`\\`\n+Using some theory, this is equivalent to\n+\n+\\`\\`\\`\n+f(m) = 0 mod g\n+\\`\\`\\`\n+Since \\`f\\` must be irreducible, this is just the characteristic (= minimal) polynomial of \\`m mod g\\`.\n+\n+---\n+\n+Example timing:\n+\n+**before**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s\n+Wall time: 1min 52s\n+\\`\\`\\`\n+\n+**after**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s\n+Wall time: 33.2 s\n+\\`\\`\\`\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-06-04T19:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265478",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,41 @@
+To compute all \`l\`-isogenies, Sage uses a function \`mult(f)\` which computes
 
+\`\`\`
+gcd( numerator(f(m)), psi )
+\`\`\`
+where \`m\` is a rational function giving the multiplication-by-\`m\` map.
+
+Instead of the above computation, the inverse direction is actually easier to compute: given \`g\`, we want to find \`f\` such that
+
+\`\`\`
+gcd( numerator(f(m)), psi ) = g
+\`\`\`
+Using some theory, this is equivalent to
+
+\`\`\`
+f(m) = 0 mod g
+\`\`\`
+Since \`f\` must be irreducible, this is just the characteristic (= minimal) polynomial of \`m mod g\`.
+
+---
+
+Example timing:
+
+**before**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s
+Wall time: 1min 52s
+\`\`\`
+
+**after**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s
+Wall time: 33.2 s
+\`\`\`
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_265479.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2015-06-04T20:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265479",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_265480.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-04T20:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265480",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265481.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,41 @@\n+To compute all \\`l\\`-isogenies, Sage uses a function \\`mult(f)\\` which computes\n \n+\\`\\`\\`\n+gcd( numerator(f(m)), psi )\n+\\`\\`\\`\n+where \\`m\\` is a rational function giving the multiplication-by-\\`m\\` map (the denominator of \\`m\\` is coprime to \\`psi\\`)\n+\n+Instead of the above computation, the inverse direction is actually easier to compute: given \\`g\\`, we want to find \\`f\\` such that\n+\n+\\`\\`\\`\n+gcd( numerator(f(m)), psi ) = g\n+\\`\\`\\`\n+Using some theory, this is equivalent to\n+\n+\\`\\`\\`\n+f(m) = 0 mod g\n+\\`\\`\\`\n+Since \\`f\\` must be irreducible, this is just the characteristic (= minimal) polynomial of \\`m mod g\\`.\n+\n+---\n+\n+Example timing:\n+\n+**before**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s\n+Wall time: 1min 52s\n+\\`\\`\\`\n+\n+**after**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s\n+Wall time: 33.2 s\n+\\`\\`\\`\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-06-04T20:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265481",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,41 @@
+To compute all \`l\`-isogenies, Sage uses a function \`mult(f)\` which computes
 
+\`\`\`
+gcd( numerator(f(m)), psi )
+\`\`\`
+where \`m\` is a rational function giving the multiplication-by-\`m\` map (the denominator of \`m\` is coprime to \`psi\`)
+
+Instead of the above computation, the inverse direction is actually easier to compute: given \`g\`, we want to find \`f\` such that
+
+\`\`\`
+gcd( numerator(f(m)), psi ) = g
+\`\`\`
+Using some theory, this is equivalent to
+
+\`\`\`
+f(m) = 0 mod g
+\`\`\`
+Since \`f\` must be irreducible, this is just the characteristic (= minimal) polynomial of \`m mod g\`.
+
+---
+
+Example timing:
+
+**before**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s
+Wall time: 1min 52s
+\`\`\`
+
+**after**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s
+Wall time: 33.2 s
+\`\`\`
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_265482.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-04T20:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_265483.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,41 @@\n+To compute all \\`l\\`-isogenies, Sage uses a function \\`mult(f)\\` which computes\n \n+\\`\\`\\`\n+gcd( numerator(f(m)), psi )\n+\\`\\`\\`\n+where \\`m\\` is a rational function giving the multiplication-by-\\`m\\` map (the denominator of \\`m\\` is coprime to \\`psi\\`)\n+\n+Instead of the above computation, the inverse direction is actually easier to compute: given \\`g\\`, we want to find \\`f\\` such that\n+\n+\\`\\`\\`\n+gcd( numerator(f(m)), psi ) = g\n+\\`\\`\\`\n+Using some theory, this is equivalent to\n+\n+\\`\\`\\`\n+f(m) = 0 mod g\n+\\`\\`\\`\n+Since \\`f\\` must be irreducible of the same degree as \\`g\\`, this is just the characteristic (= minimal) polynomial of \\`m mod g\\`.\n+\n+---\n+\n+Example timing:\n+\n+**before**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s\n+Wall time: 1min 52s\n+\\`\\`\\`\n+\n+**after**\n+\n+\\`\\`\\`\n+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)\n+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s\n+Wall time: 33.2 s\n+\\`\\`\\`\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-06-04T20:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265483",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,41 @@
+To compute all \`l\`-isogenies, Sage uses a function \`mult(f)\` which computes
 
+\`\`\`
+gcd( numerator(f(m)), psi )
+\`\`\`
+where \`m\` is a rational function giving the multiplication-by-\`m\` map (the denominator of \`m\` is coprime to \`psi\`)
+
+Instead of the above computation, the inverse direction is actually easier to compute: given \`g\`, we want to find \`f\` such that
+
+\`\`\`
+gcd( numerator(f(m)), psi ) = g
+\`\`\`
+Using some theory, this is equivalent to
+
+\`\`\`
+f(m) = 0 mod g
+\`\`\`
+Since \`f\` must be irreducible of the same degree as \`g\`, this is just the characteristic (= minimal) polynomial of \`m mod g\`.
+
+---
+
+Example timing:
+
+**before**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 1min 52s, sys: 16 ms, total: 1min 52s
+Wall time: 1min 52s
+\`\`\`
+
+**after**
+
+\`\`\`
+sage: %time from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_prime_degree_general; E = EllipticCurve(GF(3^3,'a'), [0,0,0,-1,0]); L = isogenies_prime_degree_general(E, 73)
+CPU times: user 33.1 s, sys: 107 ms, total: 33.2 s
+Wall time: 33.2 s
+\`\`\`
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_265484.json:
```json
{
    "body": "<a id='comment:9'></a>Before I go to look at the code I will confirm the theory sketched in the ticket description.  In the notation there,  g is irreducible and if alpha is a root of it then the desired f is precisely the min poly of m(alpha).",
    "created_at": "2015-06-05T08:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265484",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>Before I go to look at the code I will confirm the theory sketched in the ticket description.  In the notation there,  g is irreducible and if alpha is a root of it then the desired f is precisely the min poly of m(alpha).



---

archive/issue_comments_265485.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-05T08:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265485",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_265486.json:
```json
{
    "body": "<a id='comment:10'></a>Looks good and tests out well.  For the record:\n\n```\nsage: K.<a>=NumberField(x^2-x-22)                                                              sage: sage: E=EllipticCurve([0,0,1,-1590*a-8580,92750*a+359875])\nsage: sage: time E.isogenies_prime_degree(89)\nCPU times: user 25min 37s, sys: 2.4 s, total: 25min 39s\nWall time: 25min 37s\n[Isogeny of degree 89 from Elliptic Curve defined by y^2 + y = x^3 + (-1590*a-8580)*x + (92750*a+359875) over Number Field in a with defining polynomial x^2 - x - 22 to Elliptic Curve defined by y^2 + y = x^3 + (12594390*a-80556570)*x + (-65385874750*a+319086769867) over Number Field in a with defining polynomial x^2 - x - 22]\n```\nthough thanks to the code at #18589 this does not use mult() anyway so is not strictly relevant to this ticket.",
    "created_at": "2015-06-05T08:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265486",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>Looks good and tests out well.  For the record:

```
sage: K.<a>=NumberField(x^2-x-22)                                                              sage: sage: E=EllipticCurve([0,0,1,-1590*a-8580,92750*a+359875])
sage: sage: time E.isogenies_prime_degree(89)
CPU times: user 25min 37s, sys: 2.4 s, total: 25min 39s
Wall time: 25min 37s
[Isogeny of degree 89 from Elliptic Curve defined by y^2 + y = x^3 + (-1590*a-8580)*x + (92750*a+359875) over Number Field in a with defining polynomial x^2 - x - 22 to Elliptic Curve defined by y^2 + y = x^3 + (12594390*a-80556570)*x + (-65385874750*a+319086769867) over Number Field in a with defining polynomial x^2 - x - 22]
```
though thanks to the code at #18589 this does not use mult() anyway so is not strictly relevant to this ticket.



---

archive/issue_comments_265487.json:
```json
{
    "body": "<a id='comment:11'></a>One more remark on the algorithm: the current `mult()` does not use the fact that the characteristic polynomial is one of finitely many given possibilities. We could probably optimize even more using this information. However, my impression is that it's not currently worth it, since the other parts of the isogeny computation take more time anyway. If you do come across an example where `mult()` dominates the computation, I'd like to know.",
    "created_at": "2015-06-05T09:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265487",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>One more remark on the algorithm: the current `mult()` does not use the fact that the characteristic polynomial is one of finitely many given possibilities. We could probably optimize even more using this information. However, my impression is that it's not currently worth it, since the other parts of the isogeny computation take more time anyway. If you do come across an example where `mult()` dominates the computation, I'd like to know.



---

archive/issue_comments_265488.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-06T12:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18611#issuecomment-265488",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_052238.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-06T12:47:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18611",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18611#event-52238"
}
```
