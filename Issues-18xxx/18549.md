# Issue 18549: Posets: 50x faster is_incomparable_chain_free

archive/issues_018312.json:
```json
{
    "body": "When dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run\n\n```\nlen([P for P in P6 if P.is_incomparable_chain_free(2,2)])\n```\n\nbut\n\n```\nA=Posets.ChainPoset(2).disjoint_union(Posets.ChainPoset(2))\nlen([P for P in P6 if not P.has_isomorphic_subposet(A)])\n```\n\ntakes less than one second.\n\nCC:  @nathanncohen\n\nBranch/Commit: 58197838580d42c439c5c56369e3e89b597d4e5e\n\nReviewer: Nathann Cohen\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18549\n\n",
    "closed_at": "2015-06-02T14:42:05Z",
    "created_at": "2015-05-29T17:27:26Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Posets: 50x faster is_incomparable_chain_free",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18549",
    "user": "https://github.com/jm58660"
}
```
When dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run

```
len([P for P in P6 if P.is_incomparable_chain_free(2,2)])
```

but

```
A=Posets.ChainPoset(2).disjoint_union(Posets.ChainPoset(2))
len([P for P in P6 if not P.has_isomorphic_subposet(A)])
```

takes less than one second.

CC:  @nathanncohen

Branch/Commit: 58197838580d42c439c5c56369e3e89b597d4e5e

Reviewer: Nathann Cohen

Author: Jori Mäntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18549





---

archive/issue_comments_320954.json:
```json
{
    "body": "<a id='comment:1'></a>\nAn optimization question: Which is more propably for a random poset to have: incomparable chains of size `n` and `n`, or of size `n-1` and `n+1`? It sounds reasonable to except latter one.\n\nIf it so, the parameter (when it is a list of tuples) should be sorted descending by difference of elements of the tuple. We want to return ``False`` as soon as possible.",
    "created_at": "2015-05-29T18:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320954",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:1'></a>
An optimization question: Which is more propably for a random poset to have: incomparable chains of size `n` and `n`, or of size `n-1` and `n+1`? It sounds reasonable to except latter one.

If it so, the parameter (when it is a list of tuples) should be sorted descending by difference of elements of the tuple. We want to return ``False`` as soon as possible.



---

archive/issue_comments_320955.json:
```json
{
    "body": "<a id='comment:2'></a>\nI do not know the answer to the question you ask `O_o`",
    "created_at": "2015-05-29T22:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320955",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:2'></a>
I do not know the answer to the question you ask `O_o`



---

archive/issue_comments_320956.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jmantysalo/posets__50x_faster_is_incomparable_chain_free\"",
    "created_at": "2015-05-30T07:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320956",
    "user": "https://github.com/jm58660"
}
```

Changing branch from "" to "u/jmantysalo/posets__50x_faster_is_incomparable_chain_free"



---

archive/issue_comments_320957.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis does harm to nobody. Massive speedup might happen only when `dot2tex` is installed. But everyone will save several microseconds with this patch.\n\n---\nNew commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[5030de1](https://github.com/sagemath/sagetrac-mirror/commit/5030de1348fcf541a97f45fea755f2f7ea7071ac)|`.hasse_diagram() changed to ._hasse_diagram .`|",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320957",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>
This does harm to nobody. Massive speedup might happen only when `dot2tex` is installed. But everyone will save several microseconds with this patch.

---
New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[5030de1](https://github.com/sagemath/sagetrac-mirror/commit/5030de1348fcf541a97f45fea755f2f7ea7071ac)|`.hasse_diagram() changed to ._hasse_diagram .`|



---

archive/issue_comments_320958.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320958",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_320959.json:
```json
{
    "body": "Changing commit from \"\" to \"5030de1348fcf541a97f45fea755f2f7ea7071ac\"",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320959",
    "user": "https://github.com/jm58660"
}
```

Changing commit from "" to "5030de1348fcf541a97f45fea755f2f7ea7071ac"



---

archive/issue_events_067074.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-05-30T07:18:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18549#event-67074"
}
```



---

archive/issue_comments_320960.json:
```json
{
    "body": "Changing author from \"\" to \"Jori M\u00e4ntysalo\"",
    "created_at": "2015-05-30T07:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320960",
    "user": "https://github.com/jm58660"
}
```

Changing author from "" to "Jori Mäntysalo"



---

archive/issue_comments_320961.json:
```json
{
    "body": "<a id='comment:5'></a>\nHello !\n\nI've got no problem with the branch, but could you remove this 'TODO' from the code and opena  ticket instead?\n\nI personally don't believe that Sage should do things like that. It should do what it is asked to do: even if we knew what the most 'probable' pattern is in general, we have no clue what the user's input is.\n\nIf you want some cheap speedup, here is one: you can pre-compute 'height' and remove from the list all pairs with an element larger than 'height'. That would 'always' work, and be rather cheap. \n\nNathann",
    "created_at": "2015-05-30T07:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320961",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>
Hello !

I've got no problem with the branch, but could you remove this 'TODO' from the code and opena  ticket instead?

I personally don't believe that Sage should do things like that. It should do what it is asked to do: even if we knew what the most 'probable' pattern is in general, we have no clue what the user's input is.

If you want some cheap speedup, here is one: you can pre-compute 'height' and remove from the list all pairs with an element larger than 'height'. That would 'always' work, and be rather cheap. 

Nathann



---

archive/issue_comments_320962.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[5819783](https://github.com/sagemath/sagetrac-mirror/commit/58197838580d42c439c5c56369e3e89b597d4e5e)|`Removed a todo-note.`|",
    "created_at": "2015-05-30T15:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[5819783](https://github.com/sagemath/sagetrac-mirror/commit/58197838580d42c439c5c56369e3e89b597d4e5e)|`Removed a todo-note.`|



---

archive/issue_comments_320963.json:
```json
{
    "body": "Changing commit from \"5030de1348fcf541a97f45fea755f2f7ea7071ac\" to \"58197838580d42c439c5c56369e3e89b597d4e5e\"",
    "created_at": "2015-05-30T15:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5030de1348fcf541a97f45fea755f2f7ea7071ac" to "58197838580d42c439c5c56369e3e89b597d4e5e"



---

archive/issue_comments_320964.json:
```json
{
    "body": "<a id='comment:7'></a>\nRemoved todo-note. I'll think optimization later in new ticket.",
    "created_at": "2015-05-30T15:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320964",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>
Removed todo-note. I'll think optimization later in new ticket.



---

archive/issue_comments_320965.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks,\n\nNathann",
    "created_at": "2015-05-30T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320965",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>
Thanks,

Nathann



---

archive/issue_comments_320966.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2015-05-30T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320966",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_320967.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-30T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320967",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_320968.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-After `P6=Posets(6)` it takes more than 50 seconds to run\n+When dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run\n \n ```\n len([P for P in P6 if P.is_incomparable_chain_free(2,2)])\n``````\n",
    "created_at": "2015-05-30T16:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320968",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-After `P6=Posets(6)` it takes more than 50 seconds to run
+When dot2tex is installed, `P6=Posets(6)` takes more than 50 seconds to run
 
 ```
 len([P for P in P6 if P.is_incomparable_chain_free(2,2)])
``````




---

archive/issue_events_067075.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "rename": {
        "from": "Posets: 50x faster is_incomparable_chain_free",
        "to": "Posets: 50x faster is_incomparable_chain_free"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18549#event-67075"
}
```



---

archive/issue_comments_320969.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-02T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320969",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067076.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-02T14:42:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18549#event-67076"
}
```



---

archive/issue_comments_320970.json:
```json
{
    "body": "Changing branch from \"u/jmantysalo/posets__50x_faster_is_incomparable_chain_free\" to \"58197838580d42c439c5c56369e3e89b597d4e5e\"",
    "created_at": "2015-06-02T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18549#issuecomment-320970",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jmantysalo/posets__50x_faster_is_incomparable_chain_free" to "58197838580d42c439c5c56369e3e89b597d4e5e"
