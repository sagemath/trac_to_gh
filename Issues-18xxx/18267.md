# Issue 18267: libgap for PermutationGroup

archive/issues_018030.json:
```json
{
    "assignees": [],
    "body": "As remarked in [this question on ask.sagemath.org](http://ask.sagemath.org/question/26590/add-generator-to-a-group-combine-generators-of-two-groups/) a lot of time is spent with pexpect when playing with permutation groups.\n\nIn this ticket:\n- we interface libgap permutation group so that the following works\n\n```\nsage: p1=libgap.eval(\"(1,2,3)\")\nsage: p2=libgap.eval(\"(3,4,5)\")\nsage: p1.sage()\n(1,2,3)\nsage: G=libgap.Group([p1,p2])\nsage: G.sage()\nTraceback (most recent call last):\n...\nNotImplementedError: cannot construct equivalent Sage object\n```\n- we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap\n- we use them in `PermutationGroup` inplace of the current gap version\n\nDepends on #27946\nDepends on #28354\n\nAssignee: **@embray**\n\nCC:  @nthiery @tscrim\n\nKeywords: **fpsac2019**\n\nBranch/Commit: **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix, Travis Scrimshaw**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18267_\n\n",
    "closed_at": "2019-08-18T18:46:43Z",
    "created_at": "2015-04-21T13:30:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "libgap for PermutationGroup",
    "type": "issue",
    "updated_at": "2019-08-18T18:46:43Z",
    "url": "https://github.com/sagemath/sage/issues/18267",
    "user": "https://github.com/videlec"
}
```
As remarked in [this question on ask.sagemath.org](http://ask.sagemath.org/question/26590/add-generator-to-a-group-combine-generators-of-two-groups/) a lot of time is spent with pexpect when playing with permutation groups.

In this ticket:
- we interface libgap permutation group so that the following works

```
sage: p1=libgap.eval("(1,2,3)")
sage: p2=libgap.eval("(3,4,5)")
sage: p1.sage()
(1,2,3)
sage: G=libgap.Group([p1,p2])
sage: G.sage()
Traceback (most recent call last):
...
NotImplementedError: cannot construct equivalent Sage object
```
- we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap
- we use them in `PermutationGroup` inplace of the current gap version

Depends on #27946
Depends on #28354

Assignee: **@embray**

CC:  @nthiery @tscrim

Keywords: **fpsac2019**

Branch/Commit: **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**

Reviewer: **Frédéric Chapoton, Vincent Delecroix, Travis Scrimshaw**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/18267_





---

archive/issue_events_233237.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233237"
}
```



---

archive/issue_events_233238.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233238"
}
```



---

archive/issue_events_233239.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233239"
}
```



---

archive/issue_events_233240.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233240"
}
```



---

archive/issue_events_233241.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T09:39:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233241"
}
```



---

archive/issue_events_233242.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T09:39:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233242"
}
```



---

archive/issue_comments_253068.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThe overhead of using pexpect for GAP is *especially* serious on Cygwin.  I believe it to be one of the worst performance hits there, due to the I/O overhead.\n\nIt's so slow in fact that I wonder if there isn't a bug/defect in Cygwin related to this.  It's normal that there is some additional overhead involved for I/O on Cygwin, but this is especially bad.",
    "created_at": "2019-04-12T16:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253068",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'>Comment 2:</a>
The overhead of using pexpect for GAP is *especially* serious on Cygwin.  I believe it to be one of the worst performance hits there, due to the I/O overhead.

It's so slow in fact that I wonder if there isn't a bug/defect in Cygwin related to this.  It's normal that there is some additional overhead involved for I/O on Cygwin, but this is especially bad.



---

archive/issue_comments_253069.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI have a prototype for this in progress that is shaping up pretty well so far.  I will likely need help with this part:\n\n> we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap\n\nas I don't know all the math well enough to write interesting tests for this.  But I can get most of the skunkworks done and then anyone else who's interested can add on to it.",
    "created_at": "2019-04-12T16:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253069",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'>Comment 3:</a>
I have a prototype for this in progress that is shaping up pretty well so far.  I will likely need help with this part:

> we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap

as I don't know all the math well enough to write interesting tests for this.  But I can get most of the skunkworks done and then anyone else who's interested can add on to it.



---

archive/issue_comments_253070.json:
```json
{
    "body": "Assignee: **@embray**",
    "created_at": "2019-04-12T16:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253070",
    "user": "https://github.com/embray"
}
```

Assignee: **@embray**



---

archive/issue_comments_253071.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThe I/O overhead on Cygwin adds up to something on the order of 20x in this test (specially, the `_test_cellular` test).  I tracked this down to being entirely coming from the pexpect communication.  On Linux:\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 30.17 s]\n```\n\nOn Cygwin (different machine, but with reasonably good specs):\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 613.16 s]\n```\n\nMore than 10 minutes on this one test!  It's by far one of the slowest tests on Cygwin.  With my prototype of getting pexpect out of permutation groups I knocked this result down to (again on Cygwin):\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 25.49 s]\n```",
    "created_at": "2019-04-12T16:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253071",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'>Comment 4:</a>
The I/O overhead on Cygwin adds up to something on the order of 20x in this test (specially, the `_test_cellular` test).  I tracked this down to being entirely coming from the pexpect communication.  On Linux:

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 30.17 s]
```

On Cygwin (different machine, but with reasonably good specs):

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 613.16 s]
```

More than 10 minutes on this one test!  It's by far one of the slowest tests on Cygwin.  With my prototype of getting pexpect out of permutation groups I knocked this result down to (again on Cygwin):

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 25.49 s]
```



---

archive/issue_comments_253072.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nUnfortunately `src/sage/groups/perm_gps/permgroup_named.py` still remains by far one of the slowest tests on Cygwin despite my fixes.  Unclear as of yet why; maybe several tests using other code that still uses pexpect, or something else...",
    "created_at": "2019-04-12T16:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253072",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'>Comment 5:</a>
Unfortunately `src/sage/groups/perm_gps/permgroup_named.py` still remains by far one of the slowest tests on Cygwin despite my fixes.  Unclear as of yet why; maybe several tests using other code that still uses pexpect, or something else...



---

archive/issue_events_233243.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T16:26:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233243"
}
```



---

archive/issue_events_233244.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T16:26:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233244"
}
```



---

archive/issue_comments_253073.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nWell I found one more pexpect use in permgroup_named; fixing that one knocked it down from ~5 minutes to\n\n```\nsage -t --long src/sage/groups/perm_gps/permgroup_named.py\n    [509 tests, 47.12 s]\n```\n\nWhich is still about 5 times slower for some reason than that test is on Linux, but progress!\n\nSome of the tests also intentionally use the pexpect interface directly, so nothing to do about that for now.",
    "created_at": "2019-04-12T16:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253073",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
Well I found one more pexpect use in permgroup_named; fixing that one knocked it down from ~5 minutes to

```
sage -t --long src/sage/groups/perm_gps/permgroup_named.py
    [509 tests, 47.12 s]
```

Which is still about 5 times slower for some reason than that test is on Linux, but progress!

Some of the tests also intentionally use the pexpect interface directly, so nothing to do about that for now.



---

archive/issue_comments_253074.json:
```json
{
    "body": "Commit: **[75d6b76](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253074",
    "user": "https://github.com/embray"
}
```

Commit: **[75d6b76](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)**



---

archive/issue_events_233245.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233245"
}
```



---

archive/issue_comments_253075.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nHere is my current prototype for getting pexpect out of permutation groups, and having them use libgap exclusively.  For the large part it is quite effective at this.  This fixes (among many other examples):\n\n```\nsage: G = SymmetricGroup(3)\nsage: %prun G.one()\nsage: G.one()\n()\nsage: gap._expect is None\n```\n\nwhere previously this was invoking a GAP process through pexpect.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/618a0d4e73741706067427e87b432d351a9615ee\">618a0d4</a></td><td><code>Fix several predicate methods of permutation groups to use libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a0dd0e895399d5bc95521fc4f73486955666433\">7a0dd0e</a></td><td><code>Use libgap for permutation group comparison.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc5381dc4032b01255d0a3334d924abd7ce5c4b2\">cc5381d</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4e81e835aa4facbc69fe2572962b38e7aada4ba\">d4e81e8</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e60ebe130a6e9e02971de2c92bc50e9c5de6930\">2e60ebe</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c8954a9bb542a8dcd276de29b85a27d49aa453b\">3c8954a</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/220c5e722d94b0405a12d2e0acf0d72fbf2118ec\">220c5e7</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ab41fb9454bb8f668b27e724012fd0582152268\">5ab41fb</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db4eeda4e8707fd3090c36f2624a61a2e0adcc63\">db4eeda</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db\">75d6b76</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr></table>\n",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253075",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>Comment 7:</a>
Here is my current prototype for getting pexpect out of permutation groups, and having them use libgap exclusively.  For the large part it is quite effective at this.  This fixes (among many other examples):

```
sage: G = SymmetricGroup(3)
sage: %prun G.one()
sage: G.one()
()
sage: gap._expect is None
```

where previously this was invoking a GAP process through pexpect.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/618a0d4e73741706067427e87b432d351a9615ee">618a0d4</a></td><td><code>Fix several predicate methods of permutation groups to use libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a0dd0e895399d5bc95521fc4f73486955666433">7a0dd0e</a></td><td><code>Use libgap for permutation group comparison.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc5381dc4032b01255d0a3334d924abd7ce5c4b2">cc5381d</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4e81e835aa4facbc69fe2572962b38e7aada4ba">d4e81e8</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e60ebe130a6e9e02971de2c92bc50e9c5de6930">2e60ebe</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c8954a9bb542a8dcd276de29b85a27d49aa453b">3c8954a</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/220c5e722d94b0405a12d2e0acf0d72fbf2118ec">220c5e7</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ab41fb9454bb8f668b27e724012fd0582152268">5ab41fb</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db4eeda4e8707fd3090c36f2624a61a2e0adcc63">db4eeda</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db">75d6b76</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr></table>




---

archive/issue_comments_253076.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253076",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_253077.json:
```json
{
    "body": "Dependencies: **#27946**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253077",
    "user": "https://github.com/embray"
}
```

Dependencies: **#27946**



---

archive/issue_comments_253078.json:
```json
{
    "body": "Branch: **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253078",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)**



---

archive/issue_events_233246.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233246"
}
```



---

archive/issue_events_233247.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233247"
}
```



---

archive/issue_comments_253079.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nUnfortunately there is still a handful of failing tests with this.",
    "created_at": "2019-06-25T13:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253079",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'>Comment 8:</a>
Unfortunately there is still a handful of failing tests with this.



---

archive/issue_comments_253080.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI think most of the problems are coming from my hacky attempt to make some `GapElement` objects pickle-able in [fcfde85](https://github.com/sagemath/sagetrac-mirror/commit/fcfde857e27b703dfed96787f639126d76f31c30) which can make some surprising results, and is maybe not quite right yet.  It should probably be handled in a separate ticket.",
    "created_at": "2019-06-25T14:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253080",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'>Comment 9:</a>
I think most of the problems are coming from my hacky attempt to make some `GapElement` objects pickle-able in [fcfde85](https://github.com/sagemath/sagetrac-mirror/commit/fcfde857e27b703dfed96787f639126d76f31c30) which can make some surprising results, and is maybe not quite right yet.  It should probably be handled in a separate ticket.



---

archive/issue_comments_253081.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/075a48a5798607663c4e7d2140d5354425807e58\">075a48a</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc0b1191a5c51c21b2e9937864fff333f7889d3\">dcc0b11</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96c55c318e44e6c74ba08c119261b3dab2787d8b\">96c55c3</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13b0e3cb46e61ec56c3271a3bce49b76ac6b8b36\">13b0e3c</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6928f6982e7a489d8e4c73c137bf052590cf4267\">6928f69</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77513fee45213ebf297b59bbe7d43b4a24a6797c\">77513fe</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edf2a5d7c595973e87389977b9a2abeaea9454dd\">edf2a5d</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fbdbd1ae9afa5c5fd1b1caffa2c4b506b14c381\">6fbdbd1</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42318a9424b9b5b9d5332610232e113219420b3a\">42318a9</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4\">c02c2f1</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr></table>\n",
    "created_at": "2019-06-25T15:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253081",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/075a48a5798607663c4e7d2140d5354425807e58">075a48a</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc0b1191a5c51c21b2e9937864fff333f7889d3">dcc0b11</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96c55c318e44e6c74ba08c119261b3dab2787d8b">96c55c3</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13b0e3cb46e61ec56c3271a3bce49b76ac6b8b36">13b0e3c</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6928f6982e7a489d8e4c73c137bf052590cf4267">6928f69</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77513fee45213ebf297b59bbe7d43b4a24a6797c">77513fe</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edf2a5d7c595973e87389977b9a2abeaea9454dd">edf2a5d</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fbdbd1ae9afa5c5fd1b1caffa2c4b506b14c381">6fbdbd1</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42318a9424b9b5b9d5332610232e113219420b3a">42318a9</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4">c02c2f1</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr></table>




---

archive/issue_comments_253082.json:
```json
{
    "body": "Changed commit from **[75d6b76](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)** to **[c02c2f1](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)**",
    "created_at": "2019-06-25T15:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253082",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[75d6b76](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)** to **[c02c2f1](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)**



---

archive/issue_comments_253083.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nFixed the problems *that I knew about*, though there are likely still others.  Although this is set to \"needs_work\" it would probably be interesting-enough to start playing around with if anyone wants to review.",
    "created_at": "2019-06-25T15:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253083",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'>Comment 11:</a>
Fixed the problems *that I knew about*, though there are likely still others.  Although this is set to "needs_work" it would probably be interesting-enough to start playing around with if anyone wants to review.



---

archive/issue_comments_253084.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nWith the current version of this branch almost everything works except for a few trivial doctest failures due to new pseudo-random results in some tests.\n\nHowever, I am also getting a bizarre memory error when running the tests for `sage.combinat.tableau` that's similar to what I reported in #27681 (but later couldn't reproduce).",
    "created_at": "2019-06-25T15:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253084",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'>Comment 12:</a>
With the current version of this branch almost everything works except for a few trivial doctest failures due to new pseudo-random results in some tests.

However, I am also getting a bizarre memory error when running the tests for `sage.combinat.tableau` that's similar to what I reported in #27681 (but later couldn't reproduce).



---

archive/issue_comments_253085.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\n+1 for doing this.",
    "created_at": "2019-06-26T10:10:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253085",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'>Comment 13:</a>
+1 for doing this.



---

archive/issue_comments_253086.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nIf anyone would like to help test this that would be great for moving forward on this work.  In particular, it would be helpful to know if anyone can reproduce the test failure in `sage.combinat.tableau`, since from my end that is the only major blocker to completing this work.",
    "created_at": "2019-07-01T13:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253086",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
If anyone would like to help test this that would be great for moving forward on this work.  In particular, it would be helpful to know if anyone can reproduce the test failure in `sage.combinat.tableau`, since from my end that is the only major blocker to completing this work.



---

archive/issue_comments_253087.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca\">cc64910</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr></table>\n",
    "created_at": "2019-07-04T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253087",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca">cc64910</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr></table>




---

archive/issue_comments_253088.json:
```json
{
    "body": "Changed commit from **[c02c2f1](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)** to **[cc64910](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)**",
    "created_at": "2019-07-04T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253088",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c02c2f1](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)** to **[cc64910](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)**



---

archive/issue_events_233248.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-04T15:30:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233248"
}
```



---

archive/issue_events_233249.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-04T15:30:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233249"
}
```



---

archive/issue_comments_253089.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nAll tests now pass for me on this ticket (have not tried optional packages).\n\nThe one bug I mentioned in [comment:14](#comment%3A14) is now tracked at #28106 and is not directly caused by the changes I made here; rather it only exhibited due to the fact that using libgap in more places meant slightly more virtual memory was being allocated in some tests than previously, but this is expected.\n\nSo if you run into the bug with `MemoryError`s in `sage.combinat.tableau` you can pass the test runner `--memlimit=4000` or something like that.",
    "created_at": "2019-07-04T15:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253089",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'>Comment 16:</a>
All tests now pass for me on this ticket (have not tried optional packages).

The one bug I mentioned in [comment:14](#comment%3A14) is now tracked at #28106 and is not directly caused by the changes I made here; rather it only exhibited due to the fact that using libgap in more places meant slightly more virtual memory was being allocated in some tests than previously, but this is expected.

So if you run into the bug with `MemoryError`s in `sage.combinat.tableau` you can pass the test runner `--memlimit=4000` or something like that.



---

archive/issue_comments_253090.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI have tested a bit with python3. All doctests pass in tableau-related files and in the modified files.",
    "created_at": "2019-07-07T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253090",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>Comment 17:</a>
I have tested a bit with python3. All doctests pass in tableau-related files and in the modified files.



---

archive/issue_comments_253091.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nTests pass with [surface_dynamics](https://gitlab.com/videlec/surface_dynamics) that uses `PermutationGroup`. In the same library, I also replaced many calls to `gap` by `libgap` and everything went smoothly.\n\nThanks for working on this!",
    "created_at": "2019-07-07T20:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253091",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'>Comment 18:</a>
Tests pass with [surface_dynamics](https://gitlab.com/videlec/surface_dynamics) that uses `PermutationGroup`. In the same library, I also replaced many calls to `gap` by `libgap` and everything went smoothly.

Thanks for working on this!



---

archive/issue_events_233250.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233250"
}
```



---

archive/issue_events_233251.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233251"
}
```



---

archive/issue_events_233252.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233252"
}
```



---

archive/issue_events_233253.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233253"
}
```



---

archive/issue_comments_253092.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix, Travis Scrimshaw**",
    "created_at": "2019-07-08T13:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253092",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Frédéric Chapoton, Vincent Delecroix, Travis Scrimshaw**



---

archive/issue_comments_253093.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nEverything also LGTM.",
    "created_at": "2019-07-08T13:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253093",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'>Comment 19:</a>
Everything also LGTM.



---

archive/issue_comments_253094.json:
```json
{
    "body": "Changed keywords from **** to **fpsac2019**",
    "created_at": "2019-07-08T13:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253094",
    "user": "https://github.com/tscrim"
}
```

Changed keywords from **** to **fpsac2019**



---

archive/issue_comments_253095.json:
```json
{
    "body": "Changed dependencies from **#27946** to **#27946, #28106**",
    "created_at": "2019-07-13T12:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253095",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27946** to **#27946, #28106**



---

archive/issue_events_233254.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-31T09:42:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233254"
}
```



---

archive/issue_events_233255.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-31T09:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233255"
}
```



---

archive/issue_comments_253096.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nAny reason this is sage-pending?",
    "created_at": "2019-08-05T16:49:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253096",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'>Comment 23:</a>
Any reason this is sage-pending?



---

archive/issue_comments_253097.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\ndependency needing work",
    "created_at": "2019-08-05T18:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253097",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>Comment 24:</a>
dependency needing work



---

archive/issue_comments_253098.json:
```json
{
    "body": "Changed dependencies from **#27946, #28106** to **#27946**",
    "created_at": "2019-08-06T12:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253098",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#27946, #28106** to **#27946**



---

archive/issue_events_233256.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-06T12:57:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233256"
}
```



---

archive/issue_events_233257.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-06T12:57:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233257"
}
```



---

archive/issue_comments_253099.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI think I'll just remove the dependency.  It's not actually a dependency for this ticket, especially since my solution proposed there still doesn't seem to work.  The relation between that issue and this ticket is much more indirect than I previously thought.",
    "created_at": "2019-08-06T12:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253099",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'>Comment 25:</a>
I think I'll just remove the dependency.  It's not actually a dependency for this ticket, especially since my solution proposed there still doesn't seem to work.  The relation between that issue and this ticket is much more indirect than I previously thought.



---

archive/issue_comments_253100.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nThis breaks the gap interfaces when building with SAGE_DEBUG=yes:\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/gap.py\", line 732, in sage.interfaces.gap.Gap_generic._eval_line\nFailed example:\n    a = gap(3)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>\", line 1, in <module>\n        a = gap(Integer(3))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 323, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage/structure/sage_object.pyx\", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)\n        return self._interface_(G)\n      File \"sage/structure/sage_object.pyx\", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)\n        X = I(s)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 288, in __call__\n        return cls(self, x, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1438, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 491, in _create\n        self.set(name, value)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 1411, in set\n        self._eval_line(cmd, allow_use_file=True)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 746, in _eval_line\n        expect_eof= (self._quit_string() in line))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 609, in _execute_line\n        x = E.expect_list(self._compiled_full_pattern)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py\", line 369, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py\", line 111, in expect_loop\n        incoming = spawn.read_nonblocking(spawn.maxread, timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 469, in read_nonblocking\n        self.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 704, in isalive\n        alive = ptyproc.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py\", line 35, in __exit__\n        self.gen.throw(type, value, traceback)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 25, in _wrap_ptyprocess_err\n        raise ExceptionPexpect(*e.args)\n    ExceptionPexpect: isalive() encountered condition where \"terminated\" is 0, but there was no child process. Did someone else call waitpid() on our process?\n**********************************************************************\n[...]\n    [227 tests, 92 failures, 42.83 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/interfaces/gap.py  # 92 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2019-08-10T08:31:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253100",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'>Comment 26:</a>
This breaks the gap interfaces when building with SAGE_DEBUG=yes:

```
**********************************************************************
File "src/sage/interfaces/gap.py", line 732, in sage.interfaces.gap.Gap_generic._eval_line
Failed example:
    a = gap(3)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>", line 1, in <module>
        a = gap(Integer(3))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 295, in __call__
        result = self._coerce_from_special_method(x)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 323, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage/structure/sage_object.pyx", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)
        return self._interface_(G)
      File "sage/structure/sage_object.pyx", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)
        X = I(s)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 288, in __call__
        return cls(self, x, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1438, in __init__
        self._name = parent._create(value, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 491, in _create
        self.set(name, value)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 1411, in set
        self._eval_line(cmd, allow_use_file=True)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 746, in _eval_line
        expect_eof= (self._quit_string() in line))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 609, in _execute_line
        x = E.expect_list(self._compiled_full_pattern)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py", line 369, in expect_list
        return exp.expect_loop(timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py", line 111, in expect_loop
        incoming = spawn.read_nonblocking(spawn.maxread, timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 469, in read_nonblocking
        self.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 704, in isalive
        alive = ptyproc.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py", line 35, in __exit__
        self.gen.throw(type, value, traceback)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 25, in _wrap_ptyprocess_err
        raise ExceptionPexpect(*e.args)
    ExceptionPexpect: isalive() encountered condition where "terminated" is 0, but there was no child process. Did someone else call waitpid() on our process?
**********************************************************************
[...]
    [227 tests, 92 failures, 42.83 s]
----------------------------------------------------------------------
sage -t --long src/sage/interfaces/gap.py  # 92 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_events_233258.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-10T08:31:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233258"
}
```



---

archive/issue_events_233259.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-10T08:31:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233259"
}
```



---

archive/issue_comments_253101.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI'm not really sure what makes you think that has anything to do with this ticket. That looks like the gap interpreter itself is crashing unexpectedly when running a debug build. But this ticket doesn't change anything about gap itself or the pexpect interface.",
    "created_at": "2019-08-12T09:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253101",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'>Comment 27:</a>
I'm not really sure what makes you think that has anything to do with this ticket. That looks like the gap interpreter itself is crashing unexpectedly when running a debug build. But this ticket doesn't change anything about gap itself or the pexpect interface.



---

archive/issue_events_233260.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-12T09:06:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233260"
}
```



---

archive/issue_events_233261.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-12T09:06:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233261"
}
```



---

archive/issue_comments_253102.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nI only ran the tests with and without this ticket, I haven't looked at the code. If it is as you say then presumably its some sort of resource exhaustion while running the tests.",
    "created_at": "2019-08-12T12:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253102",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'>Comment 28:</a>
I only ran the tests with and without this ticket, I haven't looked at the code. If it is as you say then presumably its some sort of resource exhaustion while running the tests.



---

archive/issue_comments_253103.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nI'll still check if I can reproduce.  It could be something like #28106",
    "created_at": "2019-08-14T11:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253103",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'>Comment 29:</a>
I'll still check if I can reproduce.  It could be something like #28106



---

archive/issue_comments_253104.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nI can reproduce it, even with `--memlimit=0`.  Truly baffling, but I guess there must be something...",
    "created_at": "2019-08-14T12:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253104",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'>Comment 30:</a>
I can reproduce it, even with `--memlimit=0`.  Truly baffling, but I guess there must be something...



---

archive/issue_comments_253105.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nSomehow it seems this has caused a regression of something that was supposed to be fixed by #10296.  The problems start here:\n\n```\n        The following tests against a bug fixed at :trac:`10296`::\n\n            sage: gap(3)\n            3\n            sage: gap.eval('quit;')\n            ''\n            sage: a = gap(3)\n            ** Gap crashed or quit executing '\\$sage...:=3;;' **\n            Restarting Gap and trying again\n            sage: a\n            3\n```\n\nInstead of gap crashing normally and restarting, we get this error instead:\n\n```\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>\", line 1, in <module>\n        a = gap(Integer(3))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 323, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage/structure/sage_object.pyx\", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)\n        return self._interface_(G)\n      File \"sage/structure/sage_object.pyx\", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)\n        X = I(s)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 288, in __call__\n        return cls(self, x, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1438, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 491, in _create\n        self.set(name, value)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 1411, in set\n        self._eval_line(cmd, allow_use_file=True)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 746, in _eval_line\n        expect_eof= (self._quit_string() in line))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 609, in _execute_line\n        x = E.expect_list(self._compiled_full_pattern)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py\", line 369, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py\", line 111, in expect_loop\n        incoming = spawn.read_nonblocking(spawn.maxread, timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 469, in read_nonblocking\n        self.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 704, in isalive\n        alive = ptyproc.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py\", line 35, in __exit__\n        self.gen.throw(type, value, traceback)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 25, in _wrap_ptyprocess_err\n        raise ExceptionPexpect(*e.args)\n    ExceptionPexpect: isalive() encountered condition where \"terminated\" is 0, but there was no child process. Did someone else call waitpid() on our process?\n```\n\nafter which point the gap interface never recovers.  It's only happening in the tests though.  I can't reproduce interactively.  Running the tests with `--serial` makes no difference.",
    "created_at": "2019-08-14T12:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253105",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'>Comment 31:</a>
Somehow it seems this has caused a regression of something that was supposed to be fixed by #10296.  The problems start here:

```
        The following tests against a bug fixed at :trac:`10296`::

            sage: gap(3)
            3
            sage: gap.eval('quit;')
            ''
            sage: a = gap(3)
            ** Gap crashed or quit executing '\$sage...:=3;;' **
            Restarting Gap and trying again
            sage: a
            3
```

Instead of gap crashing normally and restarting, we get this error instead:

```
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>", line 1, in <module>
        a = gap(Integer(3))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 295, in __call__
        result = self._coerce_from_special_method(x)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 323, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage/structure/sage_object.pyx", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)
        return self._interface_(G)
      File "sage/structure/sage_object.pyx", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)
        X = I(s)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 288, in __call__
        return cls(self, x, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1438, in __init__
        self._name = parent._create(value, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 491, in _create
        self.set(name, value)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 1411, in set
        self._eval_line(cmd, allow_use_file=True)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 746, in _eval_line
        expect_eof= (self._quit_string() in line))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 609, in _execute_line
        x = E.expect_list(self._compiled_full_pattern)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py", line 369, in expect_list
        return exp.expect_loop(timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py", line 111, in expect_loop
        incoming = spawn.read_nonblocking(spawn.maxread, timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 469, in read_nonblocking
        self.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 704, in isalive
        alive = ptyproc.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py", line 35, in __exit__
        self.gen.throw(type, value, traceback)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 25, in _wrap_ptyprocess_err
        raise ExceptionPexpect(*e.args)
    ExceptionPexpect: isalive() encountered condition where "terminated" is 0, but there was no child process. Did someone else call waitpid() on our process?
```

after which point the gap interface never recovers.  It's only happening in the tests though.  I can't reproduce interactively.  Running the tests with `--serial` makes no difference.



---

archive/issue_comments_253106.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fc1096c30f07cc21570f67e050a79030f9760c2\">2fc1096</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b12342234364c7b37db9e7c72a797dd5ef9b26f1\">b123422</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f35a967d4eccbbfd4c0068508240f04189b4429b\">f35a967</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4aacf0fb4bf7a113ed6ad5eb871b005352147cac\">4aacf0f</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fe1132538b4496da8e4eb46657bc4bcb0f9d83f\">4fe1132</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ef4b4b3263ab72f8ddb7188025d4d6e018b48f0\">3ef4b4b</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9205aa69916ac7b61dc7334142acc2d5ef4199b0\">9205aa6</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d0e1bb5c0dde84bcd05bfa727d649b3f9bf0a01\">0d0e1bb</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8c5ecf3cf8ed1108b1d102169b9fa5c68edc874\">c8c5ecf</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2\">65f8a84</a></td><td><code>Update this test to still use the gap pexpect interface.</code></td></tr></table>\n",
    "created_at": "2019-08-14T13:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253106",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fc1096c30f07cc21570f67e050a79030f9760c2">2fc1096</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b12342234364c7b37db9e7c72a797dd5ef9b26f1">b123422</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f35a967d4eccbbfd4c0068508240f04189b4429b">f35a967</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4aacf0fb4bf7a113ed6ad5eb871b005352147cac">4aacf0f</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fe1132538b4496da8e4eb46657bc4bcb0f9d83f">4fe1132</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ef4b4b3263ab72f8ddb7188025d4d6e018b48f0">3ef4b4b</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9205aa69916ac7b61dc7334142acc2d5ef4199b0">9205aa6</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d0e1bb5c0dde84bcd05bfa727d649b3f9bf0a01">0d0e1bb</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8c5ecf3cf8ed1108b1d102169b9fa5c68edc874">c8c5ecf</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2">65f8a84</a></td><td><code>Update this test to still use the gap pexpect interface.</code></td></tr></table>




---

archive/issue_comments_253107.json:
```json
{
    "body": "Changed commit from **[cc64910](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)** to **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**",
    "created_at": "2019-08-14T13:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253107",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cc64910](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)** to **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**



---

archive/issue_comments_253108.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nRebased on current develop, and the latest commit fixes the immediate problem in the test suite.\n\nI believe there is still an underlying problem with libgap/gap interaction which is not yet addressed though (and is probably not new as of this ticket, but just more likely to occur with libgap being used more extensively).",
    "created_at": "2019-08-14T13:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253108",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'>Comment 33:</a>
Rebased on current develop, and the latest commit fixes the immediate problem in the test suite.

I believe there is still an underlying problem with libgap/gap interaction which is not yet addressed though (and is probably not new as of this ticket, but just more likely to occur with libgap being used more extensively).



---

archive/issue_events_233262.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T13:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233262"
}
```



---

archive/issue_events_233263.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T13:11:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233263"
}
```



---

archive/issue_comments_253109.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nThis might be related to https://github.com/gap-system/gap/issues/3380 , with libgap `wait()`-ing on random child processes inappropriatly.",
    "created_at": "2019-08-14T13:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253109",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'>Comment 34:</a>
This might be related to https://github.com/gap-system/gap/issues/3380 , with libgap `wait()`-ing on random child processes inappropriatly.



---

archive/issue_comments_253110.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nIt seems that, at least theoretically, we already do disable GAP's default `SIGCHLD` handler.",
    "created_at": "2019-08-14T13:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253110",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'>Comment 35:</a>
It seems that, at least theoretically, we already do disable GAP's default `SIGCHLD` handler.



---

archive/issue_comments_253111.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBizarrely, even after backing out that last test update, and rebuilding, I can't reproduce the issue anymore either.  I think it might have actually had something to do with sage-cleaner.\n\nPlease send this to the buildbots again.  I really don't think the issue is caused by this ticket, but is something more ephemeral that it happens to provoke somehow.",
    "created_at": "2019-08-14T14:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253111",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'>Comment 36:</a>
Bizarrely, even after backing out that last test update, and rebuilding, I can't reproduce the issue anymore either.  I think it might have actually had something to do with sage-cleaner.

Please send this to the buildbots again.  I really don't think the issue is caused by this ticket, but is something more ephemeral that it happens to provoke somehow.



---

archive/issue_events_233264.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T14:14:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233264"
}
```



---

archive/issue_events_233265.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T14:14:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233265"
}
```



---

archive/issue_comments_253112.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nYes, this has got to have something to do with `sage-cleaner`.  If I just start a `sage-cleaner` process on its own, then run `./sage -t src/sage/interfaces/gap.py` I can reproduce the issue reliably.",
    "created_at": "2019-08-14T14:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253112",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'>Comment 37:</a>
Yes, this has got to have something to do with `sage-cleaner`.  If I just start a `sage-cleaner` process on its own, then run `./sage -t src/sage/interfaces/gap.py` I can reproduce the issue reliably.



---

archive/issue_comments_253113.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nSoft dependency on #28354: Although I don't think the issues are particularly related, if those pexpect exceptions about `isalive()` keep happening, merging #28354 first should alleviate them.",
    "created_at": "2019-08-14T16:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253113",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'>Comment 38:</a>
Soft dependency on #28354: Although I don't think the issues are particularly related, if those pexpect exceptions about `isalive()` keep happening, merging #28354 first should alleviate them.



---

archive/issue_comments_253114.json:
```json
{
    "body": "Changed dependencies from **#27946** to **#27946, #28354**",
    "created_at": "2019-08-14T22:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253114",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27946** to **#27946, #28354**



---

archive/issue_events_233266.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-18T18:46:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233266"
}
```



---

archive/issue_events_233267.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8c985712aebdb887c2e66308af1d29907a6fc242",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-08-18T18:46:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-233267"
}
```



---

archive/issue_comments_253115.json:
```json
{
    "body": "Changed branch from **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)** to **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**",
    "created_at": "2019-08-18T18:46:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-253115",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)** to **[65f8a84](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**
