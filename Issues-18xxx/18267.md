# Issue 18267: libgap for PermutationGroup

archive/issues_018030.json:
```json
{
    "assignees": [
        "https://github.com/embray"
    ],
    "body": "As remarked in [this question on ask.sagemath.org](http://ask.sagemath.org/question/26590/add-generator-to-a-group-combine-generators-of-two-groups/) a lot of time is spent with pexpect when playing with permutation groups.\n\nIn this ticket:\n- we interface libgap permutation group so that the following works\n\n```\nsage: p1=libgap.eval(\"(1,2,3)\")\nsage: p2=libgap.eval(\"(3,4,5)\")\nsage: p1.sage()\n(1,2,3)\nsage: G=libgap.Group([p1,p2])\nsage: G.sage()\nTraceback (most recent call last):\n...\nNotImplementedError: cannot construct equivalent Sage object\n```\n- we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap\n- we use them in `PermutationGroup` inplace of the current gap version\n\nDepends on #27946\nDepends on #28354\n\nCC:  @nthiery @tscrim\n\nKeywords: **fpsac2019**\n\nBranch/Commit: **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix, Travis Scrimshaw**\n\nAuthor: **Erik Bray**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18267_\n\n",
    "closed_at": "2019-08-18T18:46:43Z",
    "created_at": "2015-04-21T13:30:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "libgap for PermutationGroup",
    "type": "issue",
    "updated_at": "2019-08-18T18:46:43Z",
    "url": "https://github.com/sagemath/sage/issues/18267",
    "user": "https://github.com/videlec"
}
```
As remarked in [this question on ask.sagemath.org](http://ask.sagemath.org/question/26590/add-generator-to-a-group-combine-generators-of-two-groups/) a lot of time is spent with pexpect when playing with permutation groups.

In this ticket:
- we interface libgap permutation group so that the following works

```
sage: p1=libgap.eval("(1,2,3)")
sage: p2=libgap.eval("(3,4,5)")
sage: p1.sage()
(1,2,3)
sage: G=libgap.Group([p1,p2])
sage: G.sage()
Traceback (most recent call last):
...
NotImplementedError: cannot construct equivalent Sage object
```
- we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap
- we use them in `PermutationGroup` inplace of the current gap version

Depends on #27946
Depends on #28354

CC:  @nthiery @tscrim

Keywords: **fpsac2019**

Branch/Commit: **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**

Reviewer: **Frédéric Chapoton, Vincent Delecroix, Travis Scrimshaw**

Author: **Erik Bray**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/18267_





---

archive/issue_events_259701.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259701"
}
```



---

archive/issue_events_259702.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259702"
}
```



---

archive/issue_events_259703.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259703"
}
```



---

archive/issue_events_259704.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-21T13:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259704"
}
```



---

archive/issue_events_259705.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T09:39:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259705"
}
```



---

archive/issue_events_259706.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T09:39:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259706"
}
```



---

archive/issue_comments_250563.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe overhead of using pexpect for GAP is *especially* serious on Cygwin.  I believe it to be one of the worst performance hits there, due to the I/O overhead.\n\nIt's so slow in fact that I wonder if there isn't a bug/defect in Cygwin related to this.  It's normal that there is some additional overhead involved for I/O on Cygwin, but this is especially bad.",
    "created_at": "2019-04-12T16:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250563",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

The overhead of using pexpect for GAP is *especially* serious on Cygwin.  I believe it to be one of the worst performance hits there, due to the I/O overhead.

It's so slow in fact that I wonder if there isn't a bug/defect in Cygwin related to this.  It's normal that there is some additional overhead involved for I/O on Cygwin, but this is especially bad.



---

archive/issue_comments_250564.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI have a prototype for this in progress that is shaping up pretty well so far.  I will likely need help with this part:\n\n> we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap\n\nas I don't know all the math well enough to write interesting tests for this.  But I can get most of the skunkworks done and then anyone else who's interested can add on to it.",
    "created_at": "2019-04-12T16:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250564",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

I have a prototype for this in progress that is shaping up pretty well so far.  I will likely need help with this part:

> we check that interesting GAP functions such as `ClosureGroup`, `AllBlocks`, are available from libgap

as I don't know all the math well enough to write interesting tests for this.  But I can get most of the skunkworks done and then anyone else who's interested can add on to it.



---

archive/issue_events_259707.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T16:13:53Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "subject": "https://github.com/embray",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259707"
}
```



---

archive/issue_comments_250565.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe I/O overhead on Cygwin adds up to something on the order of 20x in this test (specially, the `_test_cellular` test).  I tracked this down to being entirely coming from the pexpect communication.  On Linux:\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 30.17 s]\n```\n\nOn Cygwin (different machine, but with reasonably good specs):\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 613.16 s]\n```\n\nMore than 10 minutes on this one test!  It's by far one of the slowest tests on Cygwin.  With my prototype of getting pexpect out of permutation groups I knocked this result down to (again on Cygwin):\n\n```\nsage -t --long src/sage/combinat/symmetric_group_algebra.py\n    [422 tests, 25.49 s]\n```",
    "created_at": "2019-04-12T16:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250565",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

The I/O overhead on Cygwin adds up to something on the order of 20x in this test (specially, the `_test_cellular` test).  I tracked this down to being entirely coming from the pexpect communication.  On Linux:

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 30.17 s]
```

On Cygwin (different machine, but with reasonably good specs):

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 613.16 s]
```

More than 10 minutes on this one test!  It's by far one of the slowest tests on Cygwin.  With my prototype of getting pexpect out of permutation groups I knocked this result down to (again on Cygwin):

```
sage -t --long src/sage/combinat/symmetric_group_algebra.py
    [422 tests, 25.49 s]
```



---

archive/issue_comments_250566.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nUnfortunately `src/sage/groups/perm_gps/permgroup_named.py` still remains by far one of the slowest tests on Cygwin despite my fixes.  Unclear as of yet why; maybe several tests using other code that still uses pexpect, or something else...",
    "created_at": "2019-04-12T16:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250566",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Unfortunately `src/sage/groups/perm_gps/permgroup_named.py` still remains by far one of the slowest tests on Cygwin despite my fixes.  Unclear as of yet why; maybe several tests using other code that still uses pexpect, or something else...



---

archive/issue_events_259708.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T16:26:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259708"
}
```



---

archive/issue_events_259709.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-12T16:26:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259709"
}
```



---

archive/issue_comments_250567.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWell I found one more pexpect use in permgroup_named; fixing that one knocked it down from ~5 minutes to\n\n```\nsage -t --long src/sage/groups/perm_gps/permgroup_named.py\n    [509 tests, 47.12 s]\n```\n\nWhich is still about 5 times slower for some reason than that test is on Linux, but progress!\n\nSome of the tests also intentionally use the pexpect interface directly, so nothing to do about that for now.",
    "created_at": "2019-04-12T16:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250567",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Well I found one more pexpect use in permgroup_named; fixing that one knocked it down from ~5 minutes to

```
sage -t --long src/sage/groups/perm_gps/permgroup_named.py
    [509 tests, 47.12 s]
```

Which is still about 5 times slower for some reason than that test is on Linux, but progress!

Some of the tests also intentionally use the pexpect interface directly, so nothing to do about that for now.



---

archive/issue_comments_250568.json:
```json
{
    "body": "Commit: **[`75d6b76`](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250568",
    "user": "https://github.com/embray"
}
```

Commit: **[`75d6b76`](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)**



---

archive/issue_events_259710.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259710"
}
```



---

archive/issue_comments_250569.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHere is my current prototype for getting pexpect out of permutation groups, and having them use libgap exclusively.  For the large part it is quite effective at this.  This fixes (among many other examples):\n\n```\nsage: G = SymmetricGroup(3)\nsage: %prun G.one()\nsage: G.one()\n()\nsage: gap._expect is None\n```\n\nwhere previously this was invoking a GAP process through pexpect.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/618a0d4e73741706067427e87b432d351a9615ee\">618a0d4</a></td><td><code>Fix several predicate methods of permutation groups to use libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a0dd0e895399d5bc95521fc4f73486955666433\">7a0dd0e</a></td><td><code>Use libgap for permutation group comparison.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc5381dc4032b01255d0a3334d924abd7ce5c4b2\">cc5381d</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4e81e835aa4facbc69fe2572962b38e7aada4ba\">d4e81e8</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e60ebe130a6e9e02971de2c92bc50e9c5de6930\">2e60ebe</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c8954a9bb542a8dcd276de29b85a27d49aa453b\">3c8954a</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/220c5e722d94b0405a12d2e0acf0d72fbf2118ec\">220c5e7</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ab41fb9454bb8f668b27e724012fd0582152268\">5ab41fb</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db4eeda4e8707fd3090c36f2624a61a2e0adcc63\">db4eeda</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db\">75d6b76</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr></table>\n",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250569",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Here is my current prototype for getting pexpect out of permutation groups, and having them use libgap exclusively.  For the large part it is quite effective at this.  This fixes (among many other examples):

```
sage: G = SymmetricGroup(3)
sage: %prun G.one()
sage: G.one()
()
sage: gap._expect is None
```

where previously this was invoking a GAP process through pexpect.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/618a0d4e73741706067427e87b432d351a9615ee">618a0d4</a></td><td><code>Fix several predicate methods of permutation groups to use libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a0dd0e895399d5bc95521fc4f73486955666433">7a0dd0e</a></td><td><code>Use libgap for permutation group comparison.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc5381dc4032b01255d0a3334d924abd7ce5c4b2">cc5381d</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4e81e835aa4facbc69fe2572962b38e7aada4ba">d4e81e8</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e60ebe130a6e9e02971de2c92bc50e9c5de6930">2e60ebe</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c8954a9bb542a8dcd276de29b85a27d49aa453b">3c8954a</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/220c5e722d94b0405a12d2e0acf0d72fbf2118ec">220c5e7</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ab41fb9454bb8f668b27e724012fd0582152268">5ab41fb</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db4eeda4e8707fd3090c36f2624a61a2e0adcc63">db4eeda</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db">75d6b76</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr></table>




---

archive/issue_comments_250570.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250570",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_250571.json:
```json
{
    "body": "Dependencies: **#27946**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250571",
    "user": "https://github.com/embray"
}
```

Dependencies: **#27946**



---

archive/issue_comments_250572.json:
```json
{
    "body": "Branch: **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)**",
    "created_at": "2019-06-25T13:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250572",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)**



---

archive/issue_events_259711.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259711"
}
```



---

archive/issue_events_259712.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-25T13:58:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259712"
}
```



---

archive/issue_comments_250573.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nUnfortunately there is still a handful of failing tests with this.",
    "created_at": "2019-06-25T13:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250573",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Unfortunately there is still a handful of failing tests with this.



---

archive/issue_comments_250574.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think most of the problems are coming from my hacky attempt to make some `GapElement` objects pickle-able in [fcfde85](https://github.com/sagemath/sagetrac-mirror/commit/fcfde857e27b703dfed96787f639126d76f31c30) which can make some surprising results, and is maybe not quite right yet.  It should probably be handled in a separate ticket.",
    "created_at": "2019-06-25T14:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250574",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I think most of the problems are coming from my hacky attempt to make some `GapElement` objects pickle-able in [fcfde85](https://github.com/sagemath/sagetrac-mirror/commit/fcfde857e27b703dfed96787f639126d76f31c30) which can make some surprising results, and is maybe not quite right yet.  It should probably be handled in a separate ticket.



---

archive/issue_comments_250575.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/075a48a5798607663c4e7d2140d5354425807e58\">075a48a</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc0b1191a5c51c21b2e9937864fff333f7889d3\">dcc0b11</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96c55c318e44e6c74ba08c119261b3dab2787d8b\">96c55c3</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13b0e3cb46e61ec56c3271a3bce49b76ac6b8b36\">13b0e3c</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6928f6982e7a489d8e4c73c137bf052590cf4267\">6928f69</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77513fee45213ebf297b59bbe7d43b4a24a6797c\">77513fe</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edf2a5d7c595973e87389977b9a2abeaea9454dd\">edf2a5d</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fbdbd1ae9afa5c5fd1b1caffa2c4b506b14c381\">6fbdbd1</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42318a9424b9b5b9d5332610232e113219420b3a\">42318a9</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4\">c02c2f1</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr></table>\n",
    "created_at": "2019-06-25T15:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250575",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/075a48a5798607663c4e7d2140d5354425807e58">075a48a</a></td><td><code>It seems these tests broke again.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc0b1191a5c51c21b2e9937864fff333f7889d3">dcc0b11</a></td><td><code>Use libgap in several more methods where it was trivial to make the change, and where it at least didn't break any local tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96c55c318e44e6c74ba08c119261b3dab2787d8b">96c55c3</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13b0e3cb46e61ec56c3271a3bce49b76ac6b8b36">13b0e3c</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6928f6982e7a489d8e4c73c137bf052590cf4267">6928f69</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77513fee45213ebf297b59bbe7d43b4a24a6797c">77513fe</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edf2a5d7c595973e87389977b9a2abeaea9454dd">edf2a5d</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fbdbd1ae9afa5c5fd1b1caffa2c4b506b14c381">6fbdbd1</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42318a9424b9b5b9d5332610232e113219420b3a">42318a9</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4">c02c2f1</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr></table>




---

archive/issue_comments_250576.json:
```json
{
    "body": "Changed commit from **[`75d6b76`](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)** to **[`c02c2f1`](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)**",
    "created_at": "2019-06-25T15:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250576",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`75d6b76`](https://github.com/sagemath/sagetrac-mirror/commit/75d6b764cac83c2930dff648605de98adbc506db)** to **[`c02c2f1`](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)**



---

archive/issue_comments_250577.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFixed the problems *that I knew about*, though there are likely still others.  Although this is set to \"needs_work\" it would probably be interesting-enough to start playing around with if anyone wants to review.",
    "created_at": "2019-06-25T15:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250577",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Fixed the problems *that I knew about*, though there are likely still others.  Although this is set to "needs_work" it would probably be interesting-enough to start playing around with if anyone wants to review.



---

archive/issue_comments_250578.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWith the current version of this branch almost everything works except for a few trivial doctest failures due to new pseudo-random results in some tests.\n\nHowever, I am also getting a bizarre memory error when running the tests for `sage.combinat.tableau` that's similar to what I reported in #27681 (but later couldn't reproduce).",
    "created_at": "2019-06-25T15:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250578",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

With the current version of this branch almost everything works except for a few trivial doctest failures due to new pseudo-random results in some tests.

However, I am also getting a bizarre memory error when running the tests for `sage.combinat.tableau` that's similar to what I reported in #27681 (but later couldn't reproduce).



---

archive/issue_comments_250579.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n+1 for doing this.",
    "created_at": "2019-06-26T10:10:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250579",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

+1 for doing this.



---

archive/issue_comments_250580.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIf anyone would like to help test this that would be great for moving forward on this work.  In particular, it would be helpful to know if anyone can reproduce the test failure in `sage.combinat.tableau`, since from my end that is the only major blocker to completing this work.",
    "created_at": "2019-07-01T13:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250580",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

If anyone would like to help test this that would be great for moving forward on this work.  In particular, it would be helpful to know if anyone can reproduce the test failure in `sage.combinat.tableau`, since from my end that is the only major blocker to completing this work.



---

archive/issue_comments_250581.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca\">cc64910</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr></table>\n",
    "created_at": "2019-07-04T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250581",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca">cc64910</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr></table>




---

archive/issue_comments_250582.json:
```json
{
    "body": "Changed commit from **[`c02c2f1`](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)** to **[`cc64910`](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)**",
    "created_at": "2019-07-04T15:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250582",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c02c2f1`](https://github.com/sagemath/sagetrac-mirror/commit/c02c2f11a2c2228851419eb1aadd32fde75a2ad4)** to **[`cc64910`](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)**



---

archive/issue_events_259713.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-04T15:30:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259713"
}
```



---

archive/issue_events_259714.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-04T15:30:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259714"
}
```



---

archive/issue_comments_250583.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAll tests now pass for me on this ticket (have not tried optional packages).\n\nThe one bug I mentioned in [comment:14](#comment:14) is now tracked at #28106 and is not directly caused by the changes I made here; rather it only exhibited due to the fact that using libgap in more places meant slightly more virtual memory was being allocated in some tests than previously, but this is expected.\n\nSo if you run into the bug with `MemoryError`s in `sage.combinat.tableau` you can pass the test runner `--memlimit=4000` or something like that.",
    "created_at": "2019-07-04T15:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250583",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

All tests now pass for me on this ticket (have not tried optional packages).

The one bug I mentioned in [comment:14](#comment:14) is now tracked at #28106 and is not directly caused by the changes I made here; rather it only exhibited due to the fact that using libgap in more places meant slightly more virtual memory was being allocated in some tests than previously, but this is expected.

So if you run into the bug with `MemoryError`s in `sage.combinat.tableau` you can pass the test runner `--memlimit=4000` or something like that.



---

archive/issue_comments_250584.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI have tested a bit with python3. All doctests pass in tableau-related files and in the modified files.",
    "created_at": "2019-07-07T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250584",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

I have tested a bit with python3. All doctests pass in tableau-related files and in the modified files.



---

archive/issue_comments_250585.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nTests pass with [surface_dynamics](https://gitlab.com/videlec/surface_dynamics) that uses `PermutationGroup`. In the same library, I also replaced many calls to `gap` by `libgap` and everything went smoothly.\n\nThanks for working on this!",
    "created_at": "2019-07-07T20:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250585",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Tests pass with [surface_dynamics](https://gitlab.com/videlec/surface_dynamics) that uses `PermutationGroup`. In the same library, I also replaced many calls to `gap` by `libgap` and everything went smoothly.

Thanks for working on this!



---

archive/issue_events_259715.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259715"
}
```



---

archive/issue_events_259716.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259716"
}
```



---

archive/issue_events_259717.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259717"
}
```



---

archive/issue_events_259718.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-07-08T13:00:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259718"
}
```



---

archive/issue_comments_250586.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix, Travis Scrimshaw**",
    "created_at": "2019-07-08T13:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250586",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Frédéric Chapoton, Vincent Delecroix, Travis Scrimshaw**



---

archive/issue_comments_250587.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nEverything also LGTM.",
    "created_at": "2019-07-08T13:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250587",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Everything also LGTM.



---

archive/issue_comments_250588.json:
```json
{
    "body": "Changed keywords from none to **fpsac2019**",
    "created_at": "2019-07-08T13:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250588",
    "user": "https://github.com/tscrim"
}
```

Changed keywords from none to **fpsac2019**



---

archive/issue_comments_250589.json:
```json
{
    "body": "Changed dependencies from **#27946** to **#27946, #28106**",
    "created_at": "2019-07-13T12:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250589",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27946** to **#27946, #28106**



---

archive/issue_events_259719.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-31T09:42:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259719"
}
```



---

archive/issue_events_259720.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-31T09:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259720"
}
```



---

archive/issue_comments_250590.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAny reason this is sage-pending?",
    "created_at": "2019-08-05T16:49:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250590",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Any reason this is sage-pending?



---

archive/issue_comments_250591.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\ndependency needing work",
    "created_at": "2019-08-05T18:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250591",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

dependency needing work



---

archive/issue_comments_250592.json:
```json
{
    "body": "Changed dependencies from **#27946, #28106** to **#27946**",
    "created_at": "2019-08-06T12:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250592",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#27946, #28106** to **#27946**



---

archive/issue_events_259721.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-06T12:57:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259721"
}
```



---

archive/issue_events_259722.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-06T12:57:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259722"
}
```



---

archive/issue_comments_250593.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think I'll just remove the dependency.  It's not actually a dependency for this ticket, especially since my solution proposed there still doesn't seem to work.  The relation between that issue and this ticket is much more indirect than I previously thought.",
    "created_at": "2019-08-06T12:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250593",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

I think I'll just remove the dependency.  It's not actually a dependency for this ticket, especially since my solution proposed there still doesn't seem to work.  The relation between that issue and this ticket is much more indirect than I previously thought.



---

archive/issue_comments_250594.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThis breaks the gap interfaces when building with SAGE_DEBUG=yes:\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/gap.py\", line 732, in sage.interfaces.gap.Gap_generic._eval_line\nFailed example:\n    a = gap(3)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>\", line 1, in <module>\n        a = gap(Integer(3))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 323, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage/structure/sage_object.pyx\", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)\n        return self._interface_(G)\n      File \"sage/structure/sage_object.pyx\", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)\n        X = I(s)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 288, in __call__\n        return cls(self, x, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1438, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 491, in _create\n        self.set(name, value)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 1411, in set\n        self._eval_line(cmd, allow_use_file=True)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 746, in _eval_line\n        expect_eof= (self._quit_string() in line))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 609, in _execute_line\n        x = E.expect_list(self._compiled_full_pattern)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py\", line 369, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py\", line 111, in expect_loop\n        incoming = spawn.read_nonblocking(spawn.maxread, timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 469, in read_nonblocking\n        self.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 704, in isalive\n        alive = ptyproc.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py\", line 35, in __exit__\n        self.gen.throw(type, value, traceback)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 25, in _wrap_ptyprocess_err\n        raise ExceptionPexpect(*e.args)\n    ExceptionPexpect: isalive() encountered condition where \"terminated\" is 0, but there was no child process. Did someone else call waitpid() on our process?\n**********************************************************************\n[...]\n    [227 tests, 92 failures, 42.83 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/interfaces/gap.py  # 92 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2019-08-10T08:31:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250594",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:26" align="right">comment:26</div>

This breaks the gap interfaces when building with SAGE_DEBUG=yes:

```
**********************************************************************
File "src/sage/interfaces/gap.py", line 732, in sage.interfaces.gap.Gap_generic._eval_line
Failed example:
    a = gap(3)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>", line 1, in <module>
        a = gap(Integer(3))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 295, in __call__
        result = self._coerce_from_special_method(x)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 323, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage/structure/sage_object.pyx", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)
        return self._interface_(G)
      File "sage/structure/sage_object.pyx", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)
        X = I(s)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 288, in __call__
        return cls(self, x, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1438, in __init__
        self._name = parent._create(value, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 491, in _create
        self.set(name, value)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 1411, in set
        self._eval_line(cmd, allow_use_file=True)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 746, in _eval_line
        expect_eof= (self._quit_string() in line))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 609, in _execute_line
        x = E.expect_list(self._compiled_full_pattern)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py", line 369, in expect_list
        return exp.expect_loop(timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py", line 111, in expect_loop
        incoming = spawn.read_nonblocking(spawn.maxread, timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 469, in read_nonblocking
        self.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 704, in isalive
        alive = ptyproc.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py", line 35, in __exit__
        self.gen.throw(type, value, traceback)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 25, in _wrap_ptyprocess_err
        raise ExceptionPexpect(*e.args)
    ExceptionPexpect: isalive() encountered condition where "terminated" is 0, but there was no child process. Did someone else call waitpid() on our process?
**********************************************************************
[...]
    [227 tests, 92 failures, 42.83 s]
----------------------------------------------------------------------
sage -t --long src/sage/interfaces/gap.py  # 92 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_events_259723.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-10T08:31:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259723"
}
```



---

archive/issue_events_259724.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-10T08:31:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259724"
}
```



---

archive/issue_comments_250595.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI'm not really sure what makes you think that has anything to do with this ticket. That looks like the gap interpreter itself is crashing unexpectedly when running a debug build. But this ticket doesn't change anything about gap itself or the pexpect interface.",
    "created_at": "2019-08-12T09:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250595",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

I'm not really sure what makes you think that has anything to do with this ticket. That looks like the gap interpreter itself is crashing unexpectedly when running a debug build. But this ticket doesn't change anything about gap itself or the pexpect interface.



---

archive/issue_events_259725.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-12T09:06:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259725"
}
```



---

archive/issue_events_259726.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-12T09:06:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259726"
}
```



---

archive/issue_comments_250596.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI only ran the tests with and without this ticket, I haven't looked at the code. If it is as you say then presumably its some sort of resource exhaustion while running the tests.",
    "created_at": "2019-08-12T12:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250596",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">comment:28</div>

I only ran the tests with and without this ticket, I haven't looked at the code. If it is as you say then presumably its some sort of resource exhaustion while running the tests.



---

archive/issue_comments_250597.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI'll still check if I can reproduce.  It could be something like #28106",
    "created_at": "2019-08-14T11:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250597",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

I'll still check if I can reproduce.  It could be something like #28106



---

archive/issue_comments_250598.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI can reproduce it, even with `--memlimit=0`.  Truly baffling, but I guess there must be something...",
    "created_at": "2019-08-14T12:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250598",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

I can reproduce it, even with `--memlimit=0`.  Truly baffling, but I guess there must be something...



---

archive/issue_comments_250599.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nSomehow it seems this has caused a regression of something that was supposed to be fixed by #10296.  The problems start here:\n\n```\n        The following tests against a bug fixed at :trac:`10296`::\n\n            sage: gap(3)\n            3\n            sage: gap.eval('quit;')\n            ''\n            sage: a = gap(3)\n            ** Gap crashed or quit executing '\\$sage...:=3;;' **\n            Restarting Gap and trying again\n            sage: a\n            3\n```\n\nInstead of gap crashing normally and restarting, we get this error instead:\n\n```\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>\", line 1, in <module>\n        a = gap(Integer(3))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 295, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 323, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage/structure/sage_object.pyx\", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)\n        return self._interface_(G)\n      File \"sage/structure/sage_object.pyx\", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)\n        X = I(s)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 288, in __call__\n        return cls(self, x, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1438, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 491, in _create\n        self.set(name, value)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 1411, in set\n        self._eval_line(cmd, allow_use_file=True)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 746, in _eval_line\n        expect_eof= (self._quit_string() in line))\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py\", line 609, in _execute_line\n        x = E.expect_list(self._compiled_full_pattern)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py\", line 369, in expect_list\n        return exp.expect_loop(timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py\", line 111, in expect_loop\n        incoming = spawn.read_nonblocking(spawn.maxread, timeout)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 469, in read_nonblocking\n        self.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 704, in isalive\n        alive = ptyproc.isalive()\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py\", line 35, in __exit__\n        self.gen.throw(type, value, traceback)\n      File \"/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 25, in _wrap_ptyprocess_err\n        raise ExceptionPexpect(*e.args)\n    ExceptionPexpect: isalive() encountered condition where \"terminated\" is 0, but there was no child process. Did someone else call waitpid() on our process?\n```\n\nafter which point the gap interface never recovers.  It's only happening in the tests though.  I can't reproduce interactively.  Running the tests with `--serial` makes no difference.",
    "created_at": "2019-08-14T12:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250599",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Somehow it seems this has caused a regression of something that was supposed to be fixed by #10296.  The problems start here:

```
        The following tests against a bug fixed at :trac:`10296`::

            sage: gap(3)
            3
            sage: gap.eval('quit;')
            ''
            sage: a = gap(3)
            ** Gap crashed or quit executing '\$sage...:=3;;' **
            Restarting Gap and trying again
            sage: a
            3
```

Instead of gap crashing normally and restarting, we get this error instead:

```
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.gap.Gap_generic._eval_line[8]>", line 1, in <module>
        a = gap(Integer(3))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 295, in __call__
        result = self._coerce_from_special_method(x)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 323, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage/structure/sage_object.pyx", line 693, in sage.structure.sage_object.SageObject._gap_ (build/cythonized/sage/structure/sage_object.c:5929)
        return self._interface_(G)
      File "sage/structure/sage_object.pyx", line 669, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5475)
        X = I(s)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 288, in __call__
        return cls(self, x, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1438, in __init__
        self._name = parent._create(value, name=name)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 491, in _create
        self.set(name, value)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 1411, in set
        self._eval_line(cmd, allow_use_file=True)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 746, in _eval_line
        expect_eof= (self._quit_string() in line))
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/gap.py", line 609, in _execute_line
        x = E.expect_list(self._compiled_full_pattern)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/spawnbase.py", line 369, in expect_list
        return exp.expect_loop(timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/expect.py", line 111, in expect_loop
        incoming = spawn.read_nonblocking(spawn.maxread, timeout)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 469, in read_nonblocking
        self.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 704, in isalive
        alive = ptyproc.isalive()
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/contextlib.py", line 35, in __exit__
        self.gen.throw(type, value, traceback)
      File "/home/buildbot-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 25, in _wrap_ptyprocess_err
        raise ExceptionPexpect(*e.args)
    ExceptionPexpect: isalive() encountered condition where "terminated" is 0, but there was no child process. Did someone else call waitpid() on our process?
```

after which point the gap interface never recovers.  It's only happening in the tests though.  I can't reproduce interactively.  Running the tests with `--serial` makes no difference.



---

archive/issue_comments_250600.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fc1096c30f07cc21570f67e050a79030f9760c2\">2fc1096</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b12342234364c7b37db9e7c72a797dd5ef9b26f1\">b123422</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f35a967d4eccbbfd4c0068508240f04189b4429b\">f35a967</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4aacf0fb4bf7a113ed6ad5eb871b005352147cac\">4aacf0f</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fe1132538b4496da8e4eb46657bc4bcb0f9d83f\">4fe1132</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ef4b4b3263ab72f8ddb7188025d4d6e018b48f0\">3ef4b4b</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9205aa69916ac7b61dc7334142acc2d5ef4199b0\">9205aa6</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d0e1bb5c0dde84bcd05bfa727d649b3f9bf0a01\">0d0e1bb</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8c5ecf3cf8ed1108b1d102169b9fa5c68edc874\">c8c5ecf</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2\">65f8a84</a></td><td><code>Update this test to still use the gap pexpect interface.</code></td></tr></table>\n",
    "created_at": "2019-08-14T13:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250600",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fc1096c30f07cc21570f67e050a79030f9760c2">2fc1096</a></td><td><code>These tests were marked 'random output' despite the explicit calls to set_random_seed(0), which should have obviated this.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b12342234364c7b37db9e7c72a797dd5ef9b26f1">b123422</a></td><td><code>Use libgap for direct_product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f35a967d4eccbbfd4c0068508240f04189b4429b">f35a967</a></td><td><code>Use libgap for character_table</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4aacf0fb4bf7a113ed6ad5eb871b005352147cac">4aacf0f</a></td><td><code>Some fixes to make ClassFunction work properly with libgap.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fe1132538b4496da8e4eb46657bc4bcb0f9d83f">4fe1132</a></td><td><code>Use libgap for PermutationGroup_generic._regular_subgroup_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ef4b4b3263ab72f8ddb7188025d4d6e018b48f0">3ef4b4b</a></td><td><code>Use libgap for PermutationGroup_generic.molien_series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9205aa69916ac7b61dc7334142acc2d5ef4199b0">9205aa6</a></td><td><code>Fix minor test failure: This will now fail at trying to find a `_libgap_init_` rather than a _gap_init_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d0e1bb5c0dde84bcd05bfa727d649b3f9bf0a01">0d0e1bb</a></td><td><code>If the values passed to the ClassFunction constructor are already a libgap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8c5ecf3cf8ed1108b1d102169b9fa5c68edc874">c8c5ecf</a></td><td><code>Fixed slightly different output on a few tests due to PRNG differences related</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2">65f8a84</a></td><td><code>Update this test to still use the gap pexpect interface.</code></td></tr></table>




---

archive/issue_comments_250601.json:
```json
{
    "body": "Changed commit from **[`cc64910`](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)** to **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**",
    "created_at": "2019-08-14T13:09:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250601",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cc64910`](https://github.com/sagemath/sagetrac-mirror/commit/cc6491009070408c9ed5dde6317ee0ac229458ca)** to **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**



---

archive/issue_comments_250602.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nRebased on current develop, and the latest commit fixes the immediate problem in the test suite.\n\nI believe there is still an underlying problem with libgap/gap interaction which is not yet addressed though (and is probably not new as of this ticket, but just more likely to occur with libgap being used more extensively).",
    "created_at": "2019-08-14T13:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250602",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Rebased on current develop, and the latest commit fixes the immediate problem in the test suite.

I believe there is still an underlying problem with libgap/gap interaction which is not yet addressed though (and is probably not new as of this ticket, but just more likely to occur with libgap being used more extensively).



---

archive/issue_events_259727.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T13:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259727"
}
```



---

archive/issue_events_259728.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T13:11:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259728"
}
```



---

archive/issue_comments_250603.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThis might be related to https://github.com/gap-system/gap/issues/3380 , with libgap `wait()`-ing on random child processes inappropriatly.",
    "created_at": "2019-08-14T13:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250603",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

This might be related to https://github.com/gap-system/gap/issues/3380 , with libgap `wait()`-ing on random child processes inappropriatly.



---

archive/issue_comments_250604.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIt seems that, at least theoretically, we already do disable GAP's default `SIGCHLD` handler.",
    "created_at": "2019-08-14T13:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250604",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

It seems that, at least theoretically, we already do disable GAP's default `SIGCHLD` handler.



---

archive/issue_comments_250605.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nBizarrely, even after backing out that last test update, and rebuilding, I can't reproduce the issue anymore either.  I think it might have actually had something to do with sage-cleaner.\n\nPlease send this to the buildbots again.  I really don't think the issue is caused by this ticket, but is something more ephemeral that it happens to provoke somehow.",
    "created_at": "2019-08-14T14:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250605",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Bizarrely, even after backing out that last test update, and rebuilding, I can't reproduce the issue anymore either.  I think it might have actually had something to do with sage-cleaner.

Please send this to the buildbots again.  I really don't think the issue is caused by this ticket, but is something more ephemeral that it happens to provoke somehow.



---

archive/issue_events_259729.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T14:14:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259729"
}
```



---

archive/issue_events_259730.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-08-14T14:14:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259730"
}
```



---

archive/issue_comments_250606.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nYes, this has got to have something to do with `sage-cleaner`.  If I just start a `sage-cleaner` process on its own, then run `./sage -t src/sage/interfaces/gap.py` I can reproduce the issue reliably.",
    "created_at": "2019-08-14T14:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250606",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

Yes, this has got to have something to do with `sage-cleaner`.  If I just start a `sage-cleaner` process on its own, then run `./sage -t src/sage/interfaces/gap.py` I can reproduce the issue reliably.



---

archive/issue_comments_250607.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nSoft dependency on #28354: Although I don't think the issues are particularly related, if those pexpect exceptions about `isalive()` keep happening, merging #28354 first should alleviate them.",
    "created_at": "2019-08-14T16:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250607",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

Soft dependency on #28354: Although I don't think the issues are particularly related, if those pexpect exceptions about `isalive()` keep happening, merging #28354 first should alleviate them.



---

archive/issue_comments_250608.json:
```json
{
    "body": "Changed dependencies from **#27946** to **#27946, #28354**",
    "created_at": "2019-08-14T22:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250608",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27946** to **#27946, #28354**



---

archive/issue_events_259731.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-18T18:46:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259731"
}
```



---

archive/issue_events_259732.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8c985712aebdb887c2e66308af1d29907a6fc242",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-08-18T18:46:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18267#event-259732"
}
```



---

archive/issue_comments_250609.json:
```json
{
    "body": "Changed branch from **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)** to **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**",
    "created_at": "2019-08-18T18:46:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18267#issuecomment-250609",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/prototype/perm-gps-no-pexpect-gap](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/prototype/perm-gps-no-pexpect-gap)** to **[`65f8a84`](https://github.com/sagemath/sagetrac-mirror/commit/65f8a84b3965bf80fc3b7fb6018a1be753f3eab2)**
