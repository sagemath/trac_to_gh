# Issue 18888: failing optional mathematica tests, due to bugs in N() and n()

archive/issues_018651.json:
```json
{
    "body": "With\n\n```\n$ sage --version\nSageMath Version 6.8.beta8, Release Date: 2015-07-10\n$ mathematica --version\n10.0\n```\n\nThe command\n\n```\nsage -t --warn-long 2.3 --optional=sage,mathematica src/sage/symbolic/expression.pyx src/sage/tests/benchmark.py src/sage/misc/functional.py src/sage/symbolic/constants.py src/sage/calculus/calculus.py src/sage/interfaces/mathematica.py src/sage/symbolic/integration/integral.py src/sage/symbolic/constants_c.pyx src/sage/matrix/matrix1.pyx src/sage/modules/free_module_element.pyx\n```\n\ngives:\n\n```\n# sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 1 doctest failed\n# sage -t --warn-long 2.3 src/sage/symbolic/constants.py  # 3 doctests failed\n# sage -t --warn-long 2.3 src/sage/interfaces/mathematica.py  # 30 doctests failed\n# sage -t --warn-long 2.3 src/sage/symbolic/constants_c.pyx  # 1 doctest failed\n# sage -t --warn-long 2.3 src/sage/matrix/matrix1.pyx  # 2 doctests failed\n# sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed\n```\n\nFull log is attached. Previous similar tickets are : #16703, #13011.\n\nOne reason is a bug in implementation of `N()`, which is caused by always stripping precision tick away in `get()`, setting `NumberMarks->False`.\n(Or at least it has become a bug - this line of code dates back to 2006).\n\n\nCC:  @vbraun @slel @mkoeppe\n\nKeywords: mathematica\n\nBranch/Commit: eb0bed51d49219938c811ee528ed1ada2600bb99\n\nReviewer: Matthias Koeppe, Yuan Zhou\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18888\n\n",
    "closed_at": "2016-03-31T18:41:49Z",
    "created_at": "2015-07-13T12:31:15Z",
    "labels": [
        "component: interfaces: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "failing optional mathematica tests, due to bugs in N() and n()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18888",
    "user": "https://github.com/seblabbe"
}
```
With

```
$ sage --version
SageMath Version 6.8.beta8, Release Date: 2015-07-10
$ mathematica --version
10.0
```

The command

```
sage -t --warn-long 2.3 --optional=sage,mathematica src/sage/symbolic/expression.pyx src/sage/tests/benchmark.py src/sage/misc/functional.py src/sage/symbolic/constants.py src/sage/calculus/calculus.py src/sage/interfaces/mathematica.py src/sage/symbolic/integration/integral.py src/sage/symbolic/constants_c.pyx src/sage/matrix/matrix1.pyx src/sage/modules/free_module_element.pyx
```

gives:

```
# sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 1 doctest failed
# sage -t --warn-long 2.3 src/sage/symbolic/constants.py  # 3 doctests failed
# sage -t --warn-long 2.3 src/sage/interfaces/mathematica.py  # 30 doctests failed
# sage -t --warn-long 2.3 src/sage/symbolic/constants_c.pyx  # 1 doctest failed
# sage -t --warn-long 2.3 src/sage/matrix/matrix1.pyx  # 2 doctests failed
# sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed
```

Full log is attached. Previous similar tickets are : #16703, #13011.

One reason is a bug in implementation of `N()`, which is caused by always stripping precision tick away in `get()`, setting `NumberMarks->False`.
(Or at least it has become a bug - this line of code dates back to 2006).


CC:  @vbraun @slel @mkoeppe

Keywords: mathematica

Branch/Commit: eb0bed51d49219938c811ee528ed1ada2600bb99

Reviewer: Matthias Koeppe, Yuan Zhou

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18888





---

archive/issue_comments_333890.json:
```json
{
    "body": "Attachment [mathematica.log](tarball://root/attachments/some-uuid/ticket18888/mathematica.log) by @seblabbe created at 2015-07-13 12:31:36",
    "created_at": "2015-07-13T12:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333890",
    "user": "https://github.com/seblabbe"
}
```

Attachment [mathematica.log](tarball://root/attachments/some-uuid/ticket18888/mathematica.log) by @seblabbe created at 2015-07-13 12:31:36



---

archive/issue_comments_333891.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n # sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed\n ```\n \n-Full log is attached.\n+Full log is attached. Previous similar tickets are : #16703, #13011.\n``````\n",
    "created_at": "2015-07-13T12:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333891",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 # sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed
 ```
 
-Full log is attached.
+Full log is attached. Previous similar tickets are : #16703, #13011.
``````




---

archive/issue_comments_333892.json:
```json
{
    "body": "<a id='comment:2'></a>I get similar doctest failures with Sage 6.7 and Mathematica 10 running on OS X.  It looks to me like it's an issue with how Sage is formatting things; the output of the doctests often looks like it is TeX'ed.  In particular, I think somehow the _latex_ method of `sage.interfaces.mathematica.MathematicaElement` is being called instead of just __repr__ as you would expect.  Here's a simple example: \n\n\n```\nsage: e = mathematica('{{1,2},{3,4}}') \nsage: e\n\\left(\n                 \\begin{array}{cc}\n                  1 & 2 \\                  3 & 4 \\                 \\end{array}\n                 \\right)\nsage: repr(e)\n'{{1, 2}, {3, 4}}'\nsage: str(e)\n        {{1, 2}, {3, 4}}\nsage: e._latex_()\n'\\\\left(\\n                  \\\\begin{array}{cc}\\n                   1 & 2 [...]\n\n```",
    "created_at": "2015-07-13T17:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333892",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:2'></a>I get similar doctest failures with Sage 6.7 and Mathematica 10 running on OS X.  It looks to me like it's an issue with how Sage is formatting things; the output of the doctests often looks like it is TeX'ed.  In particular, I think somehow the _latex_ method of `sage.interfaces.mathematica.MathematicaElement` is being called instead of just __repr__ as you would expect.  Here's a simple example: 


```
sage: e = mathematica('{{1,2},{3,4}}') 
sage: e
\left(
                 \begin{array}{cc}
                  1 & 2 \                  3 & 4 \                 \end{array}
                 \right)
sage: repr(e)
'{{1, 2}, {3, 4}}'
sage: str(e)
        {{1, 2}, {3, 4}}
sage: e._latex_()
'\\left(\n                  \\begin{array}{cc}\n                   1 & 2 [...]

```



---

archive/issue_comments_333893.json:
```json
{
    "body": "<a id='comment:3'></a>After fixing my sage install I got similar issues too. I am running 6.8.beta8 with Mathematica 10.1\n\nI did few checks and it looks like __repr__ is the method being called; to see this just do the following changes\n\n```\ndiff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py\nindex aa5a848..e348927 100644\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -654,6 +654,8 @@ class MathematicaElement(ExpectElement):\n         return z[i+1:].strip()\n \n     def __repr__(self):\n+        import traceback\n+        for s in traceback.format_stack():\n+            print s\n         P = self._check_valid()\n         return P.get(self._name, ascii_art=False).strip()\n```\n\nThen run\n\n```\n$ sage -br\nsage: mathematica(pi)\n  File \"/opt/sage/src/bin/sage-ipython\", line 14, in <module>\n    app.start()\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/ipapp.py\", line 371, in start\n    self.shell.mainloop()\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py\", line 383, in mainloop\n    self.interact(display_banner=display_banner)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py\", line 507, in interact\n    self.run_cell(source_raw, store_history=True)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2871, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2981, in run_ast_nodes\n    if self.run_code(code, result):\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 3035, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n\n  File \"<ipython-input-1-568cde928ef5>\", line 1, in <module>\n    mathematica(pi)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py\", line 232, in __call__\n    format_dict, md_dict = self.compute_format_data(result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py\", line 138, in compute_format_data\n    return self.shell.display_formatter.format(result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py\", line 128, in format\n    return self.dm.displayhook(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 745, in displayhook\n    plain_text, rich_output = self._rich_output_formatter(obj, dict())\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 610, in _rich_output_formatter\n    plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 305, in plain_text_formatter\n    plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 250, in _apply_pretty_printer\n    printer.pretty(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py\", line 147, in pretty\n    ok = representation(obj, self, cycle)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py\", line 276, in __call__\n    output = repr(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py\", line 658, in __repr__\n    for s in traceback.format_stack():\n\n\\pi\n```",
    "created_at": "2015-07-14T13:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333893",
    "user": "https://github.com/etn40ff"
}
```

<a id='comment:3'></a>After fixing my sage install I got similar issues too. I am running 6.8.beta8 with Mathematica 10.1

I did few checks and it looks like __repr__ is the method being called; to see this just do the following changes

```
diff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py
index aa5a848..e348927 100644
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -654,6 +654,8 @@ class MathematicaElement(ExpectElement):
         return z[i+1:].strip()
 
     def __repr__(self):
+        import traceback
+        for s in traceback.format_stack():
+            print s
         P = self._check_valid()
         return P.get(self._name, ascii_art=False).strip()
```

Then run

```
$ sage -br
sage: mathematica(pi)
  File "/opt/sage/src/bin/sage-ipython", line 14, in <module>
    app.start()

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/ipapp.py", line 371, in start
    self.shell.mainloop()

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 383, in mainloop
    self.interact(display_banner=display_banner)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 507, in interact
    self.run_cell(source_raw, store_history=True)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2871, in run_cell
    interactivity=interactivity, compiler=compiler, result=result)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2981, in run_ast_nodes
    if self.run_code(code, result):

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 3035, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)

  File "<ipython-input-1-568cde928ef5>", line 1, in <module>
    mathematica(pi)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py", line 232, in __call__
    format_dict, md_dict = self.compute_format_data(result)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py", line 138, in compute_format_data
    return self.shell.display_formatter.format(result)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py", line 128, in format
    return self.dm.displayhook(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 745, in displayhook
    plain_text, rich_output = self._rich_output_formatter(obj, dict())

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 610, in _rich_output_formatter
    plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 305, in plain_text_formatter
    plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 250, in _apply_pretty_printer
    printer.pretty(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py", line 147, in pretty
    ok = representation(obj, self, cycle)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py", line 276, in __call__
    output = repr(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py", line 658, in __repr__
    for s in traceback.format_stack():

\pi
```



---

archive/issue_comments_333894.json:
```json
{
    "body": "<a id='comment:4'></a>another annoying bug is that if mathematica is not installed then\n\n```\nsage: mathematica(1) # or whatever\n```\njust hangs, and even Ctrl-C is unable to interrupt this.",
    "created_at": "2015-07-15T14:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333894",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>another annoying bug is that if mathematica is not installed then

```
sage: mathematica(1) # or whatever
```
just hangs, and even Ctrl-C is unable to interrupt this.



---

archive/issue_comments_333895.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [dimpase](#comment%3A4):\n> another annoying bug is that if mathematica is not installed then\n> \n> ```\n> sage: mathematica(1) # or whatever\n> ```\n> just hangs, and even Ctrl-C is unable to interrupt this.\n\n\nthis is fixed in #18908",
    "created_at": "2015-07-17T11:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333895",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>Replying to [dimpase](#comment%3A4):
> another annoying bug is that if mathematica is not installed then
> 
> ```
> sage: mathematica(1) # or whatever
> ```
> just hangs, and even Ctrl-C is unable to interrupt this.


this is fixed in #18908



---

archive/issue_comments_333896.json:
```json
{
    "body": "<a id='comment:6'></a>The root of the \"too much TeX\" problem seems to be that at the moment by default mathematica interface outputs in LaTeX mode. I think this should be changed to plain. One way to change this is as follows.\n\n```\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -885,9 +885,10 @@ class MathematicaElement(ExpectElement):\n                     self.save, kwds, '.png', OutputImagePng)\n         else:\n             OutputLatex = display_manager.types.OutputLatex\n-            if display_manager.preferences.text == 'plain':\n+            dmp = display_manager.preferences.text\n+            if dmp is None or dmp == 'plain':\n                 return\n-            if OutputLatex in display_manager.supported_output():\n+            if dmp == 'latex' and OutputLatex in display_manager.supported_output():\n                 return OutputLatex(self._latex_())\n         \n     def show(self, ImageSize=600):\n```\nafter this change only 9 doctests in `sage/interfaces/mathematica.py` are failing, and these are mostly due to floating point noise. \n\nPlease tell me if I should proceed with this change. (One will have to document this properly too).",
    "created_at": "2015-07-17T12:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333896",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>The root of the "too much TeX" problem seems to be that at the moment by default mathematica interface outputs in LaTeX mode. I think this should be changed to plain. One way to change this is as follows.

```
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -885,9 +885,10 @@ class MathematicaElement(ExpectElement):
                     self.save, kwds, '.png', OutputImagePng)
         else:
             OutputLatex = display_manager.types.OutputLatex
-            if display_manager.preferences.text == 'plain':
+            dmp = display_manager.preferences.text
+            if dmp is None or dmp == 'plain':
                 return
-            if OutputLatex in display_manager.supported_output():
+            if dmp == 'latex' and OutputLatex in display_manager.supported_output():
                 return OutputLatex(self._latex_())
         
     def show(self, ImageSize=600):
```
after this change only 9 doctests in `sage/interfaces/mathematica.py` are failing, and these are mostly due to floating point noise. 

Please tell me if I should proceed with this change. (One will have to document this properly too).



---

archive/issue_comments_333897.json:
```json
{
    "body": "<a id='comment:7'></a>changes around `display_manager` are due to Volker. I wonder whether he overlooked the fact that normally `display_manager.preferences.text is None` rather than `display_manager.preferences.text == 'plain'` holds.",
    "created_at": "2015-07-17T13:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333897",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>changes around `display_manager` are due to Volker. I wonder whether he overlooked the fact that normally `display_manager.preferences.text is None` rather than `display_manager.preferences.text == 'plain'` holds.



---

archive/issue_comments_333898.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-07-17T13:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333898",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_333899.json:
```json
{
    "body": "<a id='comment:8'></a>there is something going on with 'N()' that I don't get:\n\n```\nsage: mathematica('N[Pi,10]')\n3.1415926535897932384626433832795028842\nsage: mathematica.eval('N[Pi,10]')\n         3.141592654\nsage: mathematica('Pi').N(10)\n3.1415926535897932384626433832795028842\nsage: \n```\nunless we do that `eval`, we get way too many digits.",
    "created_at": "2015-07-17T15:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333899",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>there is something going on with 'N()' that I don't get:

```
sage: mathematica('N[Pi,10]')
3.1415926535897932384626433832795028842
sage: mathematica.eval('N[Pi,10]')
         3.141592654
sage: mathematica('Pi').N(10)
3.1415926535897932384626433832795028842
sage: 
```
unless we do that `eval`, we get way too many digits.



---

archive/issue_comments_333900.json:
```json
{
    "body": "Changing branch from \"\" to \"public/18888\"",
    "created_at": "2015-07-17T15:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333900",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "public/18888"



---

archive/issue_comments_333901.json:
```json
{
    "body": "Changing commit from \"\" to \"4853c276c221510b6ef17eaf4c8d415a18a0f3c2\"",
    "created_at": "2015-07-17T15:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333901",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "4853c276c221510b6ef17eaf4c8d415a18a0f3c2"



---

archive/issue_comments_333902.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [dimpase](#comment%3A9):\n\nI neither know how to deal with displaying images (via rich_repr...), nor what to do with `N()`. Otherwise, see the branch",
    "created_at": "2015-07-17T15:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333902",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Replying to [dimpase](#comment%3A9):

I neither know how to deal with displaying images (via rich_repr...), nor what to do with `N()`. Otherwise, see the branch



---

archive/issue_comments_333903.json:
```json
{
    "body": "Changing keywords from \"\" to \"mathematica\".",
    "created_at": "2016-01-18T08:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333903",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "mathematica".



---

archive/issue_comments_333904.json:
```json
{
    "body": "Changing commit from \"4853c276c221510b6ef17eaf4c8d415a18a0f3c2\" to \"4fd09adee1cffa4fb7922862d20d2587f7837362\"",
    "created_at": "2016-03-12T13:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4853c276c221510b6ef17eaf4c8d415a18a0f3c2" to "4fd09adee1cffa4fb7922862d20d2587f7837362"



---

archive/issue_comments_333905.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-12T13:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_052748.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-03-12T13:48:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18888#event-52748"
}
```



---

archive/issue_comments_333906.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-03-12T13:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333906",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_333907.json:
```json
{
    "body": "<a id='comment:14'></a>with Mathematica 9 on 64-bit Linux, all tests pass with this branch. Please test and tell if this is the case on other systems/versions.",
    "created_at": "2016-03-12T13:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333907",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>with Mathematica 9 on 64-bit Linux, all tests pass with this branch. Please test and tell if this is the case on other systems/versions.



---

archive/issue_comments_333908.json:
```json
{
    "body": "<a id='comment:15'></a>With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\nvarious test failures related to number of displayed digits.\nSee log attached.",
    "created_at": "2016-03-12T16:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>With Mathematica 10.3.1 for Mac OS X x86 (64-bit),
various test failures related to number of displayed digits.
See log attached.



---

archive/issue_comments_333909.json:
```json
{
    "body": "Attachment [mathematica-10.3.1-2016-03-12.log](tarball://root/attachments/some-uuid/ticket18888/mathematica-10.3.1-2016-03-12.log) by @mkoeppe created at 2016-03-12 16:42:58",
    "created_at": "2016-03-12T16:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333909",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [mathematica-10.3.1-2016-03-12.log](tarball://root/attachments/some-uuid/ticket18888/mathematica-10.3.1-2016-03-12.log) by @mkoeppe created at 2016-03-12 16:42:58



---

archive/issue_comments_333910.json:
```json
{
    "body": "<a id='comment:16'></a>The `display_manager.preferences.text == None` is for you to decide; Just return what you think a good default for Mathematica objects is. Generally it is the same as `plain`, so feel free to implement that.\n\nE.g. one difference is the behavior of\n\n```\nsage: pretty_print(1/x)\n\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\frac{1}{x}\nsage: %display text plain\nsage: pretty_print(1/x)       # I specifically asked for plain text \n1/x\n```",
    "created_at": "2016-03-12T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333910",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>The `display_manager.preferences.text == None` is for you to decide; Just return what you think a good default for Mathematica objects is. Generally it is the same as `plain`, so feel free to implement that.

E.g. one difference is the behavior of

```
sage: pretty_print(1/x)
\newcommand{\Bold}[1]{\mathbf{#1}}\frac{1}{x}
sage: %display text plain
sage: pretty_print(1/x)       # I specifically asked for plain text 
1/x
```



---

archive/issue_comments_333911.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [mkoeppe](#comment%3A15):\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n> various test failures related to number of displayed digits.\n> See log attached.\n\n\nMatthias, it seems that in your setup N() and n() methods of Mathematica objects are mixed up. For me on Linux, with 64-bit Mathematica 9,  I have\n\n```\nsage: t=mathematica('Pi')\nsage: t.n?\nDocstring:\n   Return a numerical approximation of x with at least prec bits of\n   precision.\n\n   EXAMPLES:\n[...]\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\nFile:           /home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx\nType:           builtin_function_or_method\nsage: t.N?\nSignature:      t.N(*args)\nDocstring:\n   EXAMPLES:\n[...]\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\nFile:           /home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py\nType:           instancemethod\nsage: t.n(20)\n3.1416\nsage: t.N(20)\n3.141592653589793238462643383279502884197169399375105820975\n```\n\nWhat is the output of these (in particular, two last) commands for you?",
    "created_at": "2016-03-12T20:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333911",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [mkoeppe](#comment%3A15):
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),
> various test failures related to number of displayed digits.
> See log attached.


Matthias, it seems that in your setup N() and n() methods of Mathematica objects are mixed up. For me on Linux, with 64-bit Mathematica 9,  I have

```
sage: t=mathematica('Pi')
sage: t.n?
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:
[...]
Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
File:           /home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx
Type:           builtin_function_or_method
sage: t.N?
Signature:      t.N(*args)
Docstring:
   EXAMPLES:
[...]
Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
File:           /home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py
Type:           instancemethod
sage: t.n(20)
3.1416
sage: t.N(20)
3.141592653589793238462643383279502884197169399375105820975
```

What is the output of these (in particular, two last) commands for you?



---

archive/issue_comments_333912.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [mkoeppe](#comment%3A15):\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n\n\nit might be that your Mathematica is 32-bit, no?",
    "created_at": "2016-03-12T20:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333912",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Replying to [mkoeppe](#comment%3A15):
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),


it might be that your Mathematica is 32-bit, no?



---

archive/issue_comments_333913.json:
```json
{
    "body": "<a id='comment:19'></a>Here's the output:\n\n```\nsage: sage: t.n(20)\n3.1416\nsage: sage: t.N(20)\n3.14159265358979323846\n```\n\nReplying to [dimpase](#comment%3A18):\n> Replying to [mkoeppe](#comment%3A15):\n> > With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n\n> \n> it might be that your Mathematica is 32-bit, no?\n\n\nNo. I copy-pasted from the banner that it displays at start; and also verified by calling ` mathematica.SystemInformation()`.\n \nNote that in the docstrings that you copied, it guarantees \"at least\" ... digits.\nSo the tests should probably not rely on a particular number of digits.",
    "created_at": "2016-03-13T00:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333913",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Here's the output:

```
sage: sage: t.n(20)
3.1416
sage: sage: t.N(20)
3.14159265358979323846
```

Replying to [dimpase](#comment%3A18):
> Replying to [mkoeppe](#comment%3A15):
> > With Mathematica 10.3.1 for Mac OS X x86 (64-bit),

> 
> it might be that your Mathematica is 32-bit, no?


No. I copy-pasted from the banner that it displays at start; and also verified by calling ` mathematica.SystemInformation()`.
 
Note that in the docstrings that you copied, it guarantees "at least" ... digits.
So the tests should probably not rely on a particular number of digits.



---

archive/issue_comments_333914.json:
```json
{
    "body": "<a id='comment:20'></a>OK, at least I understand the reason for `N()` to output seemingly random length things. I set up logging output to a file, as follows, to see this:\n\n```\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -401,7 +401,7 @@ class Mathematica(ExtraTabCompletion, Expect):\n     \"\"\"\n     Interface to the Mathematica interpreter.\n     \"\"\"\n-    def __init__(self, maxread=None, script_subdirectory=None, logfile=None, server=None, server_tmpdir=None):\n+    def __init__(self, maxread=None, script_subdirectory=None, logfile=\"/tmp/xxx.log\", server=None, server_tmpdir=None):\n         Expect.__init__(self,\n                         name = 'mathematica',\n                         prompt = 'In[[0-9]+]:=',\n```\nNamely, the interface works with M-ca's `InputForm`; e.g. when `mathematica('Pi').N(10)`\nis computed, intermediate data is stored in `InputForm`, and it is on my system \n\n```\n3.14159265358979323846264338327950419993`10.\n```\nIn more detail:\n\n```\nIn[1]:= x2=N[Pi,10]                                                                                       \nOut[1]= 3.141592654\nIn[2]:= InputForm[x2]                                                                                     \nOut[2]//InputForm= 3.14159265358979323846264338327950419993`10.\nIn[3]:= 3.14159265358979323846264338327950419993`10.                                                      \nOut[3]= 3.141592654                                                                                             \nIn[4]:= InputForm[x2,NumberMarks->False]                                                                  \nOut[4]//InputForm= 3.14159265358979323846264338327950419993\n```\nThen `get()` is called, and it does (line 528 of `mathematica.py`)\n\n```\nreturn self.eval('InputForm[%s, NumberMarks->False]'%var, strip=True)\n```\nstripping `10` after the tick away (this is what `NumberMarks->False` does)! Oops...\nOne workaround would be to provide an implementation of `N()` avoiding `get` all together.",
    "created_at": "2016-03-13T15:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333914",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>OK, at least I understand the reason for `N()` to output seemingly random length things. I set up logging output to a file, as follows, to see this:

```
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -401,7 +401,7 @@ class Mathematica(ExtraTabCompletion, Expect):
     """
     Interface to the Mathematica interpreter.
     """
-    def __init__(self, maxread=None, script_subdirectory=None, logfile=None, server=None, server_tmpdir=None):
+    def __init__(self, maxread=None, script_subdirectory=None, logfile="/tmp/xxx.log", server=None, server_tmpdir=None):
         Expect.__init__(self,
                         name = 'mathematica',
                         prompt = 'In[[0-9]+]:=',
```
Namely, the interface works with M-ca's `InputForm`; e.g. when `mathematica('Pi').N(10)`
is computed, intermediate data is stored in `InputForm`, and it is on my system 

```
3.14159265358979323846264338327950419993`10.
```
In more detail:

```
In[1]:= x2=N[Pi,10]                                                                                       
Out[1]= 3.141592654
In[2]:= InputForm[x2]                                                                                     
Out[2]//InputForm= 3.14159265358979323846264338327950419993`10.
In[3]:= 3.14159265358979323846264338327950419993`10.                                                      
Out[3]= 3.141592654                                                                                             
In[4]:= InputForm[x2,NumberMarks->False]                                                                  
Out[4]//InputForm= 3.14159265358979323846264338327950419993
```
Then `get()` is called, and it does (line 528 of `mathematica.py`)

```
return self.eval('InputForm[%s, NumberMarks->False]'%var, strip=True)
```
stripping `10` after the tick away (this is what `NumberMarks->False` does)! Oops...
One workaround would be to provide an implementation of `N()` avoiding `get` all together.



---

archive/issue_comments_333915.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-13T16:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333915",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333916.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,7 @@\n ```\n \n Full log is attached. Previous similar tickets are : #16703, #13011.\n+\n+One reason is a bug in implementation of `N()`, which is caused by always stripping precision tick away in `get()`, setting `NumberMarks->False`.\n+(Or at least it has become a bug - this line of code dates back to 2006).\n+\n``````\n",
    "created_at": "2016-03-13T16:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333916",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,7 @@
 ```
 
 Full log is attached. Previous similar tickets are : #16703, #13011.
+
+One reason is a bug in implementation of `N()`, which is caused by always stripping precision tick away in `get()`, setting `NumberMarks->False`.
+(Or at least it has become a bug - this line of code dates back to 2006).
+
``````




---

archive/issue_comments_333917.json:
```json
{
    "body": "Changing work_issues from \"\" to \"fix `N()`\"",
    "created_at": "2016-03-13T16:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333917",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "" to "fix `N()`"



---

archive/issue_comments_333918.json:
```json
{
    "body": "<a id='comment:22'></a>And here is a (hilarious) trace of the communications with M-ca, upon calling `mathematica('Pi').n(10)`.\n\n```\nMathematica 9.0 for Linux x86 (64-bit)\nCopyright 1988-2013 Wolfram Research, Inc.\nIn[1]:= sage0=Pi;\nIn[2]:= sage1=0;\nIn[3]:= sage2=gen[sage1];\nIn[4]:= sage1=prec[sage0];\nIn[5]:= sage3=1;\nIn[6]:= sage3=10;\nIn[7]:= sage3 < sage1\nOut[7]= 10 < prec[Pi]\nIn[8]:= sage3 > sage1\nOut[8]= 10 > prec[Pi]\nIn[9]:= sage3 == sage1\nOut[9]= 10 == prec[Pi]\nIn[10]:= sage3=1.0000;\nIn[11]:= sage0\nOut[11]= Pi\nIn[12]:= sage3=1.0000*I;\nIn[13]:= InputForm[sage0, NumberMarks->False]\nOut[13]//InputForm= Pi\nIn[14]:= \n```\n\ncertainly, M-ca does not know `gen` or `prec`, and thus the comparisons like\n\n```\nIn[7]:= sage3 < sage1\nOut[7]= 10 < prec[Pi]\n```\nfail miserably. Could anyone advice me on how to get the Sage part of the trace?\nI have no clue where these `gen` and `prec` come from.",
    "created_at": "2016-03-13T16:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333918",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>And here is a (hilarious) trace of the communications with M-ca, upon calling `mathematica('Pi').n(10)`.

```
Mathematica 9.0 for Linux x86 (64-bit)
Copyright 1988-2013 Wolfram Research, Inc.
In[1]:= sage0=Pi;
In[2]:= sage1=0;
In[3]:= sage2=gen[sage1];
In[4]:= sage1=prec[sage0];
In[5]:= sage3=1;
In[6]:= sage3=10;
In[7]:= sage3 < sage1
Out[7]= 10 < prec[Pi]
In[8]:= sage3 > sage1
Out[8]= 10 > prec[Pi]
In[9]:= sage3 == sage1
Out[9]= 10 == prec[Pi]
In[10]:= sage3=1.0000;
In[11]:= sage0
Out[11]= Pi
In[12]:= sage3=1.0000*I;
In[13]:= InputForm[sage0, NumberMarks->False]
Out[13]//InputForm= Pi
In[14]:= 
```

certainly, M-ca does not know `gen` or `prec`, and thus the comparisons like

```
In[7]:= sage3 < sage1
Out[7]= 10 < prec[Pi]
```
fail miserably. Could anyone advice me on how to get the Sage part of the trace?
I have no clue where these `gen` and `prec` come from.



---

archive/issue_comments_333919.json:
```json
{
    "body": "Changing work_issues from \"fix `N()`\" to \"fix `N()` and `n()`\"",
    "created_at": "2016-03-13T16:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333919",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "fix `N()`" to "fix `N()` and `n()`"



---

archive/issue_comments_333920.json:
```json
{
    "body": "<a id='comment:24'></a>OK, we don't need to implement `n()` here, only `N()`. As far as `n()` goes, part of trouble comes from Sage being unable to do `n()` of constants in the `SR` (symbolic ring) properly. E.g.\n\n```\nsage: pi.n(10)\n3.1\n```\nWe can also implement `n()` as `sage().n()`, not sure if we should. E.g. `gap(2/3).n()` is not implemented. Perhaps explicitly making it throw `NotImplementedError` is the best?",
    "created_at": "2016-03-13T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333920",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>OK, we don't need to implement `n()` here, only `N()`. As far as `n()` goes, part of trouble comes from Sage being unable to do `n()` of constants in the `SR` (symbolic ring) properly. E.g.

```
sage: pi.n(10)
3.1
```
We can also implement `n()` as `sage().n()`, not sure if we should. E.g. `gap(2/3).n()` is not implemented. Perhaps explicitly making it throw `NotImplementedError` is the best?



---

archive/issue_comments_333921.json:
```json
{
    "body": "<a id='comment:25'></a>Whats wrong? With hindsight you need \n\n```\nsage: log(3.14 / 0.005, 2)\n9.29462074889163\n```\nbits of precision to know the next decimal digit, and there is probably a guard (binary) digit:\n\n```\nsage: pi.n(11)\n3.14\nsage: pi.n(digits=10)\n3.141592654\n```",
    "created_at": "2016-03-13T18:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333921",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Whats wrong? With hindsight you need 

```
sage: log(3.14 / 0.005, 2)
9.29462074889163
```
bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:

```
sage: pi.n(11)
3.14
sage: pi.n(digits=10)
3.141592654
```



---

archive/issue_comments_333922.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [vbraun](#comment%3A25):\n> Whats wrong? With hindsight you need \n> \n> ```\n> sage: log(3.14 / 0.005, 2)\n> 9.29462074889163\n> ```\n> bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:\n> \n> ```\n> sage: pi.n(11)\n> 3.14\n> sage: pi.n(digits=10)\n> 3.141592654\n> ```\n\nwell, I am struggling to understand the error here:\nE.g. how would you explain the following:\n(it sort of works if the precision is specified...)\n\n```\nsage: mathematica('Pi').n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-0b9c467a05fb> in <module>()\n----> 1 mathematica('Pi').n()\n\n/home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx in sage.structure.element.Element.numerical_approx (build/cythonized/sage/structure/element.c:7330)()\n    717         \"\"\"\n    718         from sage.misc.functional import numerical_approx\n--> 719         return numerical_approx(self, prec=prec, digits=digits,\n    720                                 algorithm=algorithm)\n    721     n = numerical_approx\n\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits, algorithm)\n   1330 \n   1331     if prec > inprec:\n-> 1332         raise TypeError(\"cannot approximate to a precision of %s bits, use at most %s bits\" % (prec, inprec))\n   1333 \n   1334     # The issue is not precision, try conversion instead\n\nTypeError: cannot approximate to a precision of 53 bits, use at most          prec[Pi] bits\n```",
    "created_at": "2016-03-13T21:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333922",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>Replying to [vbraun](#comment%3A25):
> Whats wrong? With hindsight you need 
> 
> ```
> sage: log(3.14 / 0.005, 2)
> 9.29462074889163
> ```
> bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:
> 
> ```
> sage: pi.n(11)
> 3.14
> sage: pi.n(digits=10)
> 3.141592654
> ```

well, I am struggling to understand the error here:
E.g. how would you explain the following:
(it sort of works if the precision is specified...)

```
sage: mathematica('Pi').n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-0b9c467a05fb> in <module>()
----> 1 mathematica('Pi').n()

/home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx in sage.structure.element.Element.numerical_approx (build/cythonized/sage/structure/element.c:7330)()
    717         """
    718         from sage.misc.functional import numerical_approx
--> 719         return numerical_approx(self, prec=prec, digits=digits,
    720                                 algorithm=algorithm)
    721     n = numerical_approx

/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits, algorithm)
   1330 
   1331     if prec > inprec:
-> 1332         raise TypeError("cannot approximate to a precision of %s bits, use at most %s bits" % (prec, inprec))
   1333 
   1334     # The issue is not precision, try conversion instead

TypeError: cannot approximate to a precision of 53 bits, use at most          prec[Pi] bits
```



---

archive/issue_comments_333923.json:
```json
{
    "body": "<a id='comment:27'></a>Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?",
    "created_at": "2016-03-13T23:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333923",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?



---

archive/issue_comments_333924.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [vbraun](#comment%3A27):\n> Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?\n\n\nit is a symbolic Mathematica expression `prec[Pi]`. It cannot be evaluated to anything.\nEvaluating `mathematica('Pi').n()`, on Mathematica side I see the following:\n\n```\nIn[1]:= sage0=Pi;\nIn[2]:= sage1=0;\nIn[3]:= sage2=gen[sage1];\nIn[4]:= sage1=prec[sage0];\nIn[5]:= sage3=1;\nIn[6]:= sage3=53;\nIn[7]:= sage1 < sage3\nOut[7]= prec[Pi] < 53\nIn[8]:= sage1 > sage3\nOut[8]= prec[Pi] > 53\nIn[9]:= sage1 == sage3\nOut[9]= prec[Pi] == 53\nIn[10]:= sage1\nOut[10]= prec[Pi]\n```\n\n(in comment 22 I posted the corresponding log for `.n(10)` (I made a typo, wrote that it is `.n()`, now corrected there).",
    "created_at": "2016-03-13T23:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333924",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>Replying to [vbraun](#comment%3A27):
> Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?


it is a symbolic Mathematica expression `prec[Pi]`. It cannot be evaluated to anything.
Evaluating `mathematica('Pi').n()`, on Mathematica side I see the following:

```
In[1]:= sage0=Pi;
In[2]:= sage1=0;
In[3]:= sage2=gen[sage1];
In[4]:= sage1=prec[sage0];
In[5]:= sage3=1;
In[6]:= sage3=53;
In[7]:= sage1 < sage3
Out[7]= prec[Pi] < 53
In[8]:= sage1 > sage3
Out[8]= prec[Pi] > 53
In[9]:= sage1 == sage3
Out[9]= prec[Pi] == 53
In[10]:= sage1
Out[10]= prec[Pi]
```

(in comment 22 I posted the corresponding log for `.n(10)` (I made a typo, wrote that it is `.n()`, now corrected there).



---

archive/issue_comments_333925.json:
```json
{
    "body": "<a id='comment:29'></a>The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions.",
    "created_at": "2016-03-14T00:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333925",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions.



---

archive/issue_comments_333926.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [vbraun](#comment%3A29):\n> The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions. \n\n\nOK, I have implemented `n()`, and it works. \n\nBut I am at loss as to how to implement `N()` (i.e. the Mathematica function call).\nThe problem is that `get()` method of Mathematica class in \nhttps://github.com/sagemath/sage/blob/develop/src/sage/interfaces/mathematica.py#L517\nshould get the parameter `ascii_art` set to True while it calls Mathematica via Expect.\nAnd I cannot find an interface that would do this for me.",
    "created_at": "2016-03-15T12:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333926",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Replying to [vbraun](#comment%3A29):
> The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions. 


OK, I have implemented `n()`, and it works. 

But I am at loss as to how to implement `N()` (i.e. the Mathematica function call).
The problem is that `get()` method of Mathematica class in 
https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/mathematica.py#L517
should get the parameter `ascii_art` set to True while it calls Mathematica via Expect.
And I cannot find an interface that would do this for me.



---

archive/issue_comments_333927.json:
```json
{
    "body": "<a id='comment:31'></a>I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is.",
    "created_at": "2016-03-15T13:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333927",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is.



---

archive/issue_comments_333928.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-15T13:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333929.json:
```json
{
    "body": "Changing commit from \"4fd09adee1cffa4fb7922862d20d2587f7837362\" to \"7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f\"",
    "created_at": "2016-03-15T13:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4fd09adee1cffa4fb7922862d20d2587f7837362" to "7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f"



---

archive/issue_comments_333930.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-15T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333930",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333931.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [vbraun](#comment%3A31):\n> I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is. \n\nThe thing is that\n\n```\nself.parent().N(self, *args)\n```\ndoe not work properly, as data is kept in `InputFormat` on Mathematica side, e.g. 1.111111111111 with\nprecision 5 is not kept the way one expects, 1.1111, but as 1.111111111111<backtick>5. And that <backtick> gets stripped off by `get()`, getting the precision info lost in the process. \n\nSo I ended up calling `self.parent().eval()` directly, took me the whole morning to figure out the right way. Anyhow, ready for review now!",
    "created_at": "2016-03-15T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333931",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>Replying to [vbraun](#comment%3A31):
> I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is. 

The thing is that

```
self.parent().N(self, *args)
```
doe not work properly, as data is kept in `InputFormat` on Mathematica side, e.g. 1.111111111111 with
precision 5 is not kept the way one expects, 1.1111, but as 1.111111111111<backtick>5. And that <backtick> gets stripped off by `get()`, getting the precision info lost in the process. 

So I ended up calling `self.parent().eval()` directly, took me the whole morning to figure out the right way. Anyhow, ready for review now!



---

archive/issue_comments_333932.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-15T21:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333932",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333933.json:
```json
{
    "body": "<a id='comment:34'></a>All good, except:\n\n```\nFile \"src/sage/symbolic/constants.py\", line 1082, in sage.symbolic.constants.Khinchin\nFailed example:\n    m.N(200)                                 # optional - mathematica\nExpected:\n    2.685452001065306445309714835481795693820382293994462953051152345557218859537152002801141174931847697995153465905288090082897677716410963051792533483259668381852315421332119499626039328522044819409618068664166343945732171166692445674          \nGot:\n            2.6854520010653064453097148354817956938203822939944629530511523455572 \n    >    188595371520028011411749318476979951534659052880900828976777164109630517 \n    >    925334832596683818523154213321194996260393285220448194096181\n```",
    "created_at": "2016-03-15T21:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333933",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>All good, except:

```
File "src/sage/symbolic/constants.py", line 1082, in sage.symbolic.constants.Khinchin
Failed example:
    m.N(200)                                 # optional - mathematica
Expected:
    2.685452001065306445309714835481795693820382293994462953051152345557218859537152002801141174931847697995153465905288090082897677716410963051792533483259668381852315421332119499626039328522044819409618068664166343945732171166692445674          
Got:
            2.6854520010653064453097148354817956938203822939944629530511523455572 
    >    188595371520028011411749318476979951534659052880900828976777164109630517 
    >    925334832596683818523154213321194996260393285220448194096181
```



---

archive/issue_comments_333934.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [mkoeppe](#comment%3A34):\n> All good, except:\n\noh, I forgot to check doctests in these files... Will do shortly.",
    "created_at": "2016-03-15T22:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333934",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>Replying to [mkoeppe](#comment%3A34):
> All good, except:

oh, I forgot to check doctests in these files... Will do shortly.



---

archive/issue_comments_333935.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-15T23:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333936.json:
```json
{
    "body": "Changing commit from \"7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f\" to \"8a6c9c4f02c0fe6898f12b6475d03c1f303685e2\"",
    "created_at": "2016-03-15T23:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f" to "8a6c9c4f02c0fe6898f12b6475d03c1f303685e2"



---

archive/issue_comments_333937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-15T23:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333937",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333938.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2016-03-15T23:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333938",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_333939.json:
```json
{
    "body": "<a id='comment:38'></a>Tests pass now. Didn't look at your code changes.",
    "created_at": "2016-03-15T23:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333939",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>Tests pass now. Didn't look at your code changes.



---

archive/issue_comments_333940.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [git](#comment%3A32):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                          |                         |\n> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n> |[7f9f0e0](http://git.sagemath.org/sage.git/commit/?id=7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f)|`cleaning up N() and n()`|\n\n\nAny reason to use `pres` rather than `prec` to abbreviate \"precision\"?",
    "created_at": "2016-03-16T04:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333940",
    "user": "https://github.com/slel"
}
```

<a id='comment:39'></a>Replying to [git](#comment%3A32):
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                          |                         |
> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
> |[7f9f0e0](http://git.sagemath.org/sage.git/commit/?id=7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f)|`cleaning up N() and n()`|


Any reason to use `pres` rather than `prec` to abbreviate "precision"?



---

archive/issue_comments_333941.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-16T08:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333942.json:
```json
{
    "body": "Changing commit from \"8a6c9c4f02c0fe6898f12b6475d03c1f303685e2\" to \"53e76e679a7c411aa4f193dabca0d8281fdaf052\"",
    "created_at": "2016-03-16T08:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8a6c9c4f02c0fe6898f12b6475d03c1f303685e2" to "53e76e679a7c411aa4f193dabca0d8281fdaf052"



---

archive/issue_events_052749.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-03-21T18:42:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18888#event-52749"
}
```



---

archive/issue_events_052750.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-03-21T18:42:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18888#event-52750"
}
```



---

archive/issue_comments_333943.json:
```json
{
    "body": "<a id='comment:42'></a>With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. \n\nThe old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.\n\n```\n@@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.\n OTHER Examples::\n \n     sage: def math_bessel_K(nu,x):\n     ...       return mathematica(nu).BesselK(x).N(20)\n     ...\n     sage: math_bessel_K(2,I)                      # optional - mathematica\n-    0.180489972066962*I - 2.592886175491197             # 32-bit\n-    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit\n+    -2.5928861754911969782 + 0.1804899720669620266 I\n```\nHave they become identical now? \n\nAlso, I was puzzled by the discrepancy between\n\n```\nsage: mathematica('Pi').N(10)\n         3.141592654\n```\nand\n\n```\nsage: mathematica('Pi').n(10)\n3.1\n```\nAfter reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as\n\n```\nsage: pi.n(digits=10)\n3.141592654\n```\nand\n\n```\nsage: pi.n(10)\n3.1\n```\nrespectively.\nIs such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?",
    "created_at": "2016-03-29T03:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333943",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:42'></a>With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. 

The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.

```
@@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.
 OTHER Examples::
 
     sage: def math_bessel_K(nu,x):
     ...       return mathematica(nu).BesselK(x).N(20)
     ...
     sage: math_bessel_K(2,I)                      # optional - mathematica
-    0.180489972066962*I - 2.592886175491197             # 32-bit
-    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit
+    -2.5928861754911969782 + 0.1804899720669620266 I
```
Have they become identical now? 

Also, I was puzzled by the discrepancy between

```
sage: mathematica('Pi').N(10)
         3.141592654
```
and

```
sage: mathematica('Pi').n(10)
3.1
```
After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as

```
sage: pi.n(digits=10)
3.141592654
```
and

```
sage: pi.n(10)
3.1
```
respectively.
Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?



---

archive/issue_comments_333944.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [yzh](#comment%3A42):\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. \n> \n> The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.\n> \n> ```\n> @@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.\n>  OTHER Examples::\n>  \n>      sage: def math_bessel_K(nu,x):\n>      ...       return mathematica(nu).BesselK(x).N(20)\n>      ...\n>      sage: math_bessel_K(2,I)                      # optional - mathematica\n> -    0.180489972066962*I - 2.592886175491197             # 32-bit\n> -    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit\n> +    -2.5928861754911969782 + 0.1804899720669620266 I\n> ```\n\nthe difference was due to a bug that is now fixed, I think.\n\n> Have they become identical now? \n\nthey should be.\nI don't have 32-bit Mathematical to test, but I think it should be the same.\n> \n> Also, I was puzzled by the discrepancy between\n> \n> ```\n> sage: mathematica('Pi').N(10)\n>          3.141592654\n> ```\n> and\n> \n> ```\n> sage: mathematica('Pi').n(10)\n> 3.1\n> ```\n> After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as\n> \n> ```\n> sage: pi.n(digits=10)\n> 3.141592654\n> ```\n> and\n> \n> ```\n> sage: pi.n(10)\n> 3.1\n> ```\n> respectively.\n> Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?\n\n\nthe idea is that N() is a Mathematica function, and n() is a Sage function.",
    "created_at": "2016-03-29T06:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333944",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>Replying to [yzh](#comment%3A42):
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. 
> 
> The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.
> 
> ```
> @@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.
>  OTHER Examples::
>  
>      sage: def math_bessel_K(nu,x):
>      ...       return mathematica(nu).BesselK(x).N(20)
>      ...
>      sage: math_bessel_K(2,I)                      # optional - mathematica
> -    0.180489972066962*I - 2.592886175491197             # 32-bit
> -    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit
> +    -2.5928861754911969782 + 0.1804899720669620266 I
> ```

the difference was due to a bug that is now fixed, I think.

> Have they become identical now? 

they should be.
I don't have 32-bit Mathematical to test, but I think it should be the same.
> 
> Also, I was puzzled by the discrepancy between
> 
> ```
> sage: mathematica('Pi').N(10)
>          3.141592654
> ```
> and
> 
> ```
> sage: mathematica('Pi').n(10)
> 3.1
> ```
> After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as
> 
> ```
> sage: pi.n(digits=10)
> 3.141592654
> ```
> and
> 
> ```
> sage: pi.n(10)
> 3.1
> ```
> respectively.
> Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?


the idea is that N() is a Mathematica function, and n() is a Sage function.



---

archive/issue_comments_333945.json:
```json
{
    "body": "Changing work_issues from \"fix `N()` and `n()`\" to \"add () in `n()`\"",
    "created_at": "2016-03-29T07:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333945",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "fix `N()` and `n()`" to "add () in `n()`"



---

archive/issue_comments_333946.json:
```json
{
    "body": "<a id='comment:44'></a>> Does it make sense to implement mathematica('Pi').n(digits=10) as well?\n\noops, right, there is a typo in n() implementation. I'll fix it at once.",
    "created_at": "2016-03-29T07:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333946",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>> Does it make sense to implement mathematica('Pi').n(digits=10) as well?

oops, right, there is a typo in n() implementation. I'll fix it at once.



---

archive/issue_comments_333947.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-29T07:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333947",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333948.json:
```json
{
    "body": "Changing commit from \"53e76e679a7c411aa4f193dabca0d8281fdaf052\" to \"031e2219a488ac6c30372952482d17fa3cfa1986\"",
    "created_at": "2016-03-29T10:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "53e76e679a7c411aa4f193dabca0d8281fdaf052" to "031e2219a488ac6c30372952482d17fa3cfa1986"



---

archive/issue_comments_333949.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-29T10:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333950.json:
```json
{
    "body": "Changing work_issues from \"add () in `n()`\" to \"\"",
    "created_at": "2016-03-29T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333950",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "add () in `n()`" to ""



---

archive/issue_comments_333951.json:
```json
{
    "body": "<a id='comment:46'></a>OK, fixed. Please have a look.",
    "created_at": "2016-03-29T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333951",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>OK, fixed. Please have a look.



---

archive/issue_comments_333952.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-29T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333952",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333953.json:
```json
{
    "body": "Changing commit from \"031e2219a488ac6c30372952482d17fa3cfa1986\" to \"eb0bed51d49219938c811ee528ed1ada2600bb99\"",
    "created_at": "2016-03-29T10:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "031e2219a488ac6c30372952482d17fa3cfa1986" to "eb0bed51d49219938c811ee528ed1ada2600bb99"



---

archive/issue_comments_333954.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-29T10:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333955.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe\" to \"Matthias Koeppe, Yuan Zhou\"",
    "created_at": "2016-03-29T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333955",
    "user": "https://github.com/yuan-zhou"
}
```

Changing reviewer from "Matthias Koeppe" to "Matthias Koeppe, Yuan Zhou"



---

archive/issue_comments_333956.json:
```json
{
    "body": "Changing author from \"\" to \"\u200bDima Pasechnik\"",
    "created_at": "2016-03-29T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333956",
    "user": "https://github.com/yuan-zhou"
}
```

Changing author from "" to "​Dima Pasechnik"



---

archive/issue_comments_333957.json:
```json
{
    "body": "<a id='comment:48'></a>Thanks a lot for the nice work.",
    "created_at": "2016-03-29T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333957",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:48'></a>Thanks a lot for the nice work.



---

archive/issue_comments_333958.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-29T18:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333958",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_333959.json:
```json
{
    "body": "<a id='comment:50'></a>invisible space",
    "created_at": "2016-03-30T16:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333959",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>invisible space



---

archive/issue_comments_333960.json:
```json
{
    "body": "Changing author from \"\u200bDima Pasechnik\" to \"Dima Pasechnik\"",
    "created_at": "2016-03-30T16:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333960",
    "user": "https://github.com/vbraun"
}
```

Changing author from "​Dima Pasechnik" to "Dima Pasechnik"



---

archive/issue_events_052751.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-31T18:41:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18888#event-52751"
}
```



---

archive/issue_comments_333961.json:
```json
{
    "body": "Changing branch from \"public/18888\" to \"eb0bed51d49219938c811ee528ed1ada2600bb99\"",
    "created_at": "2016-03-31T18:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333961",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/18888" to "eb0bed51d49219938c811ee528ed1ada2600bb99"



---

archive/issue_comments_333962.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-31T18:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18888#issuecomment-333962",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
