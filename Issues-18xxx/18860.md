# Issue 18860: Faster Poyhedron.graph()

archive/issues_018623.json:
```json
{
    "assignees": [],
    "body": "With this branch, `polytopes.Gosset_3_21().graph()` takes 300ms, against 16s before.\n\nThe 'definition' used to compute adjacent vertices can be found in [comment:10]\n\nAnd of course the following works:\n\n```\nsage: g=graphs.GossetGraph()\nsage: g.is_isomorphic(polytopes.Gosset_3_21().graph())\nTrue\n```\n\nDepends on #18779\n\nCC:  @videlec @dimpase @vbraun @novoselt\n\nComponent: **geometry**\n\nAuthor: **Nathann Cohen**\n\nBranch/Commit: **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18860_\n\n",
    "closed_at": "2015-08-01T23:07:52Z",
    "created_at": "2015-07-07T16:35:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster Poyhedron.graph()",
    "type": "issue",
    "updated_at": "2015-08-01T23:07:52Z",
    "url": "https://github.com/sagemath/sage/issues/18860",
    "user": "https://github.com/nathanncohen"
}
```
With this branch, `polytopes.Gosset_3_21().graph()` takes 300ms, against 16s before.

The 'definition' used to compute adjacent vertices can be found in [comment:10]

And of course the following works:

```
sage: g=graphs.GossetGraph()
sage: g.is_isomorphic(polytopes.Gosset_3_21().graph())
True
```

Depends on #18779

CC:  @videlec @dimpase @vbraun @novoselt

Component: **geometry**

Author: **Nathann Cohen**

Branch/Commit: **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/18860_





---

archive/issue_events_265405.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-07T16:35:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265405"
}
```



---

archive/issue_events_265406.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-07T16:35:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265406"
}
```



---

archive/issue_events_265407.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-07T16:35:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265407"
}
```



---

archive/issue_events_265408.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-07T16:35:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265408"
}
```



---

archive/issue_comments_264016.json:
```json
{
    "body": "Branch: **[public/18860](https://github.com/sagemath/sagetrac-mirror/tree/public/18860)**",
    "created_at": "2015-07-07T16:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264016",
    "user": "https://github.com/nathanncohen"
}
```

Branch: **[public/18860](https://github.com/sagemath/sagetrac-mirror/tree/public/18860)**



---

archive/issue_comments_264017.json:
```json
{
    "body": "Commit: **[`3b5eabb`](https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732)**",
    "created_at": "2015-07-07T16:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264017",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`3b5eabb`](https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732)**



---

archive/issue_comments_264018.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a4ee0c75fb5275811c513ae7b9e8ca13f4a1b35\"><code>4a4ee0c</code></a></td><td><code>trac #18779: polytopes.gosset_3_21 and graphs.GossetGraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b498a9ed71957f45330abab46ae9a63d618b3d91\"><code>b498a9e</code></a></td><td><code>trac #18779: Reviewer's (dead right) comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6527f4b41f580d470c734f30c109bc25049bfb29\"><code>6527f4b</code></a></td><td><code>capitalise Gosset</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732\"><code>3b5eabb</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>\n",
    "created_at": "2015-07-07T16:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264018",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a4ee0c75fb5275811c513ae7b9e8ca13f4a1b35"><code>4a4ee0c</code></a></td><td><code>trac #18779: polytopes.gosset_3_21 and graphs.GossetGraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b498a9ed71957f45330abab46ae9a63d618b3d91"><code>b498a9e</code></a></td><td><code>trac #18779: Reviewer's (dead right) comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6527f4b41f580d470c734f30c109bc25049bfb29"><code>6527f4b</code></a></td><td><code>capitalise Gosset</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732"><code>3b5eabb</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>




---

archive/issue_comments_264019.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n\n```\n+        # Why 26 ?? I was expecting 'd-1'. Are there some useless inequalities\n+        # in the list?\n```\nwell, you have 26 facets on each edge - none are more useless than the others. You can do the\nfollowing (note that 0th and 1st vertices are adjacent).\n\n```\nsage: p=polytopes.Gosset_3_21()\nsage: M=p.incidence_matrix()\nsage: a=0; b=1;\nsage: vv=[i for i in [0..702] if M[a,i]*M[b,i]>0]\nsage: matrix([p.inequalities()[j].vector() for j in vv]).T.kernel()\nFree module of degree 9 and rank 1 over Integer Ring\nEchelon basis matrix:\n[0 1 0 0 0 0 0 0 0]\n```\nor just \n\n```\nsage: m=matrix([p.inequalities()[j].vector() for j in vv])\nsage: m.rank()\n8\n```\nwhich makes sense, as `m` is of size 27x9.  (27, as there is not full-dimensional).\n\nGeneral code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space\nshould check that `m` has corank `1`.\n\n(There could be special cases when one of the vertices is the origin, or some inequalities are homogeneous).",
    "created_at": "2015-07-07T18:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264019",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>


```
+        # Why 26 ?? I was expecting 'd-1'. Are there some useless inequalities
+        # in the list?
```
well, you have 26 facets on each edge - none are more useless than the others. You can do the
following (note that 0th and 1st vertices are adjacent).

```
sage: p=polytopes.Gosset_3_21()
sage: M=p.incidence_matrix()
sage: a=0; b=1;
sage: vv=[i for i in [0..702] if M[a,i]*M[b,i]>0]
sage: matrix([p.inequalities()[j].vector() for j in vv]).T.kernel()
Free module of degree 9 and rank 1 over Integer Ring
Echelon basis matrix:
[0 1 0 0 0 0 0 0 0]
```
or just 

```
sage: m=matrix([p.inequalities()[j].vector() for j in vv])
sage: m.rank()
8
```
which makes sense, as `m` is of size 27x9.  (27, as there is not full-dimensional).

General code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space
should check that `m` has corank `1`.

(There could be special cases when one of the vertices is the origin, or some inequalities are homogeneous).



---

archive/issue_comments_264020.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n> General code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space\n> should check that `m` has corank `1`.\n\nWould you know how to adapt this code for that? Hoping that it will remain faster than what we currently have?\n\nNathann",
    "created_at": "2015-07-07T19:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264020",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:5" align="right">comment:5</div>

> General code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space
> should check that `m` has corank `1`.

Would you know how to adapt this code for that? Hoping that it will remain faster than what we currently have?

Nathann



---

archive/issue_comments_264021.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@nathanncohen](#comment%3A5):\n> > General code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space\n> > should check that `m` has corank `1`.\n\n> \n> Would you know how to adapt this code for that? Hoping that it will remain faster than what we currently have?\n\nMy understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.\nExcept that it goes from bottom to top, which probably means that one gets adjacency of facets as the first step. But it should be possible to change it that goes the other way around.\nWe can write a paper about it ;-).",
    "created_at": "2015-07-08T09:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264021",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@nathanncohen](#comment%3A5):
> > General code for adjacency of two vertices `a` and `b` of a polytope in `d`-dimensional space
> > should check that `m` has corank `1`.

> 
> Would you know how to adapt this code for that? Hoping that it will remain faster than what we currently have?

My understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.
Except that it goes from bottom to top, which probably means that one gets adjacency of facets as the first step. But it should be possible to change it that goes the other way around.
We can write a paper about it ;-).



---

archive/issue_comments_264022.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n> My understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.\n\nI do not know how to do that. If you know how to fix this implementation, at least it will be done. Otherwise chances are that nothing will happen.\n\nNathann",
    "created_at": "2015-07-08T11:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264022",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:7" align="right">comment:7</div>

> My understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.

I do not know how to do that. If you know how to fix this implementation, at least it will be done. Otherwise chances are that nothing will happen.

Nathann



---

archive/issue_comments_264023.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nathanncohen](#comment%3A7):\n> > My understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.\n\n> \n> I do not know how to do that. If you know how to fix this implementation, at least it will be done. Otherwise chances are that nothing will happen\n\nthe whole Polyhedron code does a potentially very slow thing: enumerating the inequalities at construction time, instead of doing it optionally or/and lazily.\n\nIndeed, e.g. the problem at hand, deciding if two vertices are adjacent, does not need pre-computed inequalities. Namely, checking that v_1 and v_2 are adjacent can be done by solving the following LP:\n\n```\n    variables: x_0..x_d,x_{d+1}\n    objective: max x_0\n    constraints: \n         -1 <= x_i <=1 for i in [1..d]; \n          x_{d+1} >= 0;\n          sum_{j=1}^d v_{i,j}*x_j = x_{d+1},         for i=1,2;\n          sum_{j=1}^d v_{i,j}*x_j >= x_{d+1} + x_0,  for i>2;\n```\nif the optimum exists and is strictly positive, they form an edge, and otherwise they don't.\n\nSo we are trying to find an inequality that is valid for the convex hull of v_k's and turns\ninto an equation on v_1 and v_2, but is a strict inequality on the rest of v_k's.\n\n(The LP above will not work if there are more v_j's on the line joining v_1 and v_2 --- but this case can be taken care of trivially.)",
    "created_at": "2015-07-08T14:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264023",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nathanncohen](#comment%3A7):
> > My understanding is that hacking `hasse_diagram.py` to stop earlier is what one actually needs to do.

> 
> I do not know how to do that. If you know how to fix this implementation, at least it will be done. Otherwise chances are that nothing will happen

the whole Polyhedron code does a potentially very slow thing: enumerating the inequalities at construction time, instead of doing it optionally or/and lazily.

Indeed, e.g. the problem at hand, deciding if two vertices are adjacent, does not need pre-computed inequalities. Namely, checking that v_1 and v_2 are adjacent can be done by solving the following LP:

```
    variables: x_0..x_d,x_{d+1}
    objective: max x_0
    constraints: 
         -1 <= x_i <=1 for i in [1..d]; 
          x_{d+1} >= 0;
          sum_{j=1}^d v_{i,j}*x_j = x_{d+1},         for i=1,2;
          sum_{j=1}^d v_{i,j}*x_j >= x_{d+1} + x_0,  for i>2;
```
if the optimum exists and is strictly positive, they form an edge, and otherwise they don't.

So we are trying to find an inequality that is valid for the convex hull of v_k's and turns
into an equation on v_1 and v_2, but is a strict inequality on the rest of v_k's.

(The LP above will not work if there are more v_j's on the line joining v_1 and v_2 --- but this case can be taken care of trivially.)



---

archive/issue_comments_264024.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOh. That's a nice formulation of the problem, thanks. I will not forget it.\n\nWould you know a combinatorial way to compute it? It seems that we can already rely on cddlib (see #18861) in order to build the graph over RDF.\n\nNathann",
    "created_at": "2015-07-08T14:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264024",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:9" align="right">comment:9</div>

Oh. That's a nice formulation of the problem, thanks. I will not forget it.

Would you know a combinatorial way to compute it? It seems that we can already rely on cddlib (see #18861) in order to build the graph over RDF.

Nathann



---

archive/issue_comments_264025.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHere is a new 'combinatorial' version. It uses an 'idea', which I am not sure is a proper definition of the object, but well... You tell me `:-P`\n\n1) For every inequality `I`, build the set `set(I)` of points for which it is an equality\n2) For any pair of points `i,j`, list all inequalities `I_1, ..., I_k` that contain them both\n3) Intersection `set(I_1), ..., set(I_k)`. If this intersection has cardinality 2, then ij is an edge.\n\nWorks for Gosset (at least) `:-P`\n\nNathann",
    "created_at": "2015-07-08T16:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264025",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

Here is a new 'combinatorial' version. It uses an 'idea', which I am not sure is a proper definition of the object, but well... You tell me `:-P`

1) For every inequality `I`, build the set `set(I)` of points for which it is an equality
2) For any pair of points `i,j`, list all inequalities `I_1, ..., I_k` that contain them both
3) Intersection `set(I_1), ..., set(I_k)`. If this intersection has cardinality 2, then ij is an edge.

Works for Gosset (at least) `:-P`

Nathann



---

archive/issue_comments_264026.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526\"><code>d084b1f</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>\n",
    "created_at": "2015-07-08T16:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264026",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526"><code>d084b1f</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>




---

archive/issue_comments_264027.json:
```json
{
    "body": "Changed commit from **[`3b5eabb`](https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732)** to **[`d084b1f`](https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526)**",
    "created_at": "2015-07-08T16:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264027",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3b5eabb`](https://github.com/sagemath/sagetrac-mirror/commit/3b5eabb9735a867678c2c6a13dc7700c24d82732)** to **[`d084b1f`](https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526)**



---

archive/issue_comments_264028.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nA bit cleaner: I moved the code to the `.graph()`, method for apparently the `_vertex_adjacency_matrix` is not what it claims to be. Its dimension may not even be the number of vertices (if you have rays n your polyhedron) [1].\n\nWith this, all tests pass in the `geometry` folder.\n\nNathann\n\n[1] You can see what goes wrong by adding `return self.graph().adjacency_matrix()` in the first line of `_vertex_adjacency_matrix`.",
    "created_at": "2015-07-08T16:44:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264028",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

A bit cleaner: I moved the code to the `.graph()`, method for apparently the `_vertex_adjacency_matrix` is not what it claims to be. Its dimension may not even be the number of vertices (if you have rays n your polyhedron) [1].

With this, all tests pass in the `geometry` folder.

Nathann

[1] You can see what goes wrong by adding `return self.graph().adjacency_matrix()` in the first line of `_vertex_adjacency_matrix`.



---

archive/issue_comments_264029.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n-With this branch, `polytopes.Gosset_3_21().graph()` takes 200ms, against 16s before.\n+With this branch, `polytopes.Gosset_3_21().graph()` takes 300ms, against 16s before.\n \n-There is however, a mystery in the code: I hard-coded a constant '26' which I expected to be equal to 'd-1'. If we can solve this mistery, we get a speedup.\n+The 'definition' used to compute adjacent vertices can be found in [comment:10]\n \n-This 26 has been picked so that the following works:\n+And of course the following works:\n \n ```\n sage: g=graphs.GossetGraph()\n``````\n",
    "created_at": "2015-07-08T16:44:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264029",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
-With this branch, `polytopes.Gosset_3_21().graph()` takes 200ms, against 16s before.
+With this branch, `polytopes.Gosset_3_21().graph()` takes 300ms, against 16s before.
 
-There is however, a mystery in the code: I hard-coded a constant '26' which I expected to be equal to 'd-1'. If we can solve this mistery, we get a speedup.
+The 'definition' used to compute adjacent vertices can be found in [comment:10]
 
-This 26 has been picked so that the following works:
+And of course the following works:
 
 ```
 sage: g=graphs.GossetGraph()
``````




---

archive/issue_events_265409.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-07-08T16:44:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265409"
}
```



---

archive/issue_comments_264030.json:
```json
{
    "body": "Changed commit from **[`d084b1f`](https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526)** to **[`74d8412`](https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a)**",
    "created_at": "2015-07-08T16:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264030",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d084b1f`](https://github.com/sagemath/sagetrac-mirror/commit/d084b1f2d0a7fa39fd522079aba39494f1704526)** to **[`74d8412`](https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a)**



---

archive/issue_comments_264031.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a\"><code>74d8412</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>\n",
    "created_at": "2015-07-08T16:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264031",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a"><code>74d8412</code></a></td><td><code>trac #18860: Faster Poyhedron.graph()</code></td></tr></table>




---

archive/issue_comments_264032.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe adjacency matrix for unbound polyhedra is essentially the projectvization; See also the adjacency matrix docs for a more down-to-earth definition.",
    "created_at": "2015-07-08T19:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264032",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

The adjacency matrix for unbound polyhedra is essentially the projectvization; See also the adjacency matrix docs for a more down-to-earth definition.



---

archive/issue_comments_264033.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> The adjacency matrix for unbound polyhedra is essentially the projectvization; See also the adjacency matrix docs for a more down-to-earth definition.\n\nI was not talking about the `.adjacency_matrix` method. I was talking about `._vertex_adjacency_matrix`, which should (from its name) have as many rows/cols as there are vertices.\n\nNathann",
    "created_at": "2015-07-08T20:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264033",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

> The adjacency matrix for unbound polyhedra is essentially the projectvization; See also the adjacency matrix docs for a more down-to-earth definition.

I was not talking about the `.adjacency_matrix` method. I was talking about `._vertex_adjacency_matrix`, which should (from its name) have as many rows/cols as there are vertices.

Nathann



---

archive/issue_comments_264034.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAgain its really the V-representation adjacency matrix; The non-compact case is just the projectivization. So in a sense its really the vertex adjacency matrix; I know its somewhat confusing but most people are interested in the compact case so being overly nitpicky about wording is going to be confusing too.",
    "created_at": "2015-07-08T20:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264034",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

Again its really the V-representation adjacency matrix; The non-compact case is just the projectivization. So in a sense its really the vertex adjacency matrix; I know its somewhat confusing but most people are interested in the compact case so being overly nitpicky about wording is going to be confusing too.



---

archive/issue_comments_264035.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> Again its really the V-representation adjacency matrix; The non-compact case is just the projectivization. So in a sense its really the vertex adjacency matrix; I know its somewhat confusing but most people are interested in the compact case so being overly nitpicky about wording is going to be confusing too. \n\nSo was this line incorrect `return Graph(self.vertex_adjacency_matrix(), loops=False)` ?\n\nI expect the `.vertex_graph()` to give me a graph whose vertices are the vertices of the polyhedron. And the incidence matrix of that graph is *not* the output of the `_vertex_adjacency_matrix` whose rows are not the vertices only. Do we agree?\n\nNathann",
    "created_at": "2015-07-08T20:58:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264035",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:18" align="right">comment:18</div>

> Again its really the V-representation adjacency matrix; The non-compact case is just the projectivization. So in a sense its really the vertex adjacency matrix; I know its somewhat confusing but most people are interested in the compact case so being overly nitpicky about wording is going to be confusing too. 

So was this line incorrect `return Graph(self.vertex_adjacency_matrix(), loops=False)` ?

I expect the `.vertex_graph()` to give me a graph whose vertices are the vertices of the polyhedron. And the incidence matrix of that graph is *not* the output of the `_vertex_adjacency_matrix` whose rows are not the vertices only. Do we agree?

Nathann



---

archive/issue_comments_264036.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@nathanncohen](#comment%3A10):\n> Here is a new 'combinatorial' version. It uses an 'idea', which I am not sure is a proper definition of the object, but well... You tell me `:-P`\n> \n> 1) For every inequality `I`, build the set `set(I)` of points for which it is an equality\n> 2) For any pair of points `i,j`, list all inequalities `I_1, ..., I_k` that contain them both\n> 3) Intersection `set(I_1), ..., set(I_k)`. If this intersection has cardinality 2, then ij is an edge.\n\nyes, that's correct for the polytopes - provided there is no redundancy.\nE.g. if a polytope is not full-dimensional, then adding an equation satisfied by all the vertices to an inequality is a \"copy\" of this inequality, vertex-vise.\n\n\n> Works for Gosset (at least) `:-P`\n> \n> Nathann",
    "created_at": "2015-07-08T23:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264036",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@nathanncohen](#comment%3A10):
> Here is a new 'combinatorial' version. It uses an 'idea', which I am not sure is a proper definition of the object, but well... You tell me `:-P`
> 
> 1) For every inequality `I`, build the set `set(I)` of points for which it is an equality
> 2) For any pair of points `i,j`, list all inequalities `I_1, ..., I_k` that contain them both
> 3) Intersection `set(I_1), ..., set(I_k)`. If this intersection has cardinality 2, then ij is an edge.

yes, that's correct for the polytopes - provided there is no redundancy.
E.g. if a polytope is not full-dimensional, then adding an equation satisfied by all the vertices to an inequality is a "copy" of this inequality, vertex-vise.


> Works for Gosset (at least) `:-P`
> 
> Nathann



---

archive/issue_comments_264037.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n> yes, that's correct for the polytopes - provided there is no redundancy.\n\nExcellent news! Then we have a very nice speedup ahead `:-PPPP`\n\nAs for redundancy, it is true that this algorithm will not behave very well if there are several vertices at the same place which are actually the same. Redundancy of inequalities, however, is not a problem.\n\n> E.g. if a polytope is not full-dimensional, then adding an equation satisfied by all the vertices to an inequality is a \"copy\" of this inequality, vertex-vise.\n\nYeah but in terms of sets it produces the very same one. So it's cool.\n\nNathann",
    "created_at": "2015-07-09T07:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264037",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:20" align="right">comment:20</div>

> yes, that's correct for the polytopes - provided there is no redundancy.

Excellent news! Then we have a very nice speedup ahead `:-PPPP`

As for redundancy, it is true that this algorithm will not behave very well if there are several vertices at the same place which are actually the same. Redundancy of inequalities, however, is not a problem.

> E.g. if a polytope is not full-dimensional, then adding an equation satisfied by all the vertices to an inequality is a "copy" of this inequality, vertex-vise.

Yeah but in terms of sets it produces the very same one. So it's cool.

Nathann



---

archive/issue_comments_264038.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@nathanncohen](#comment%3A12):\n> A bit cleaner: I moved the code to the `.graph()`, method for apparently the `_vertex_adjacency_matrix` is not what it claims to be. Its dimension may not even be the number of vertices (if you have rays n your polyhedron) [1].\n> \n> With this, all tests pass in the `geometry` folder.\n\nAren't we changing the behaviour of some functions for the non-compact case?",
    "created_at": "2015-07-09T10:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264038",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@nathanncohen](#comment%3A12):
> A bit cleaner: I moved the code to the `.graph()`, method for apparently the `_vertex_adjacency_matrix` is not what it claims to be. Its dimension may not even be the number of vertices (if you have rays n your polyhedron) [1].
> 
> With this, all tests pass in the `geometry` folder.

Aren't we changing the behaviour of some functions for the non-compact case?



---

archive/issue_comments_264039.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> Aren't we changing the behaviour of some functions for the non-compact case?\n\nThis patch only touches the function `.vertex_graph`. Its behaviour changes indeed for the non-compact case, but unless you can defend that the previous behavior was not a bug (there were more vertices in the graph than vertices in the polyhedron) I would say that this is not a problem.\n\nNathann",
    "created_at": "2015-07-09T10:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264039",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:22" align="right">comment:22</div>

> Aren't we changing the behaviour of some functions for the non-compact case?

This patch only touches the function `.vertex_graph`. Its behaviour changes indeed for the non-compact case, but unless you can defend that the previous behavior was not a bug (there were more vertices in the graph than vertices in the polyhedron) I would say that this is not a problem.

Nathann



---

archive/issue_comments_264040.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> Aren't we changing the behaviour of some functions for the non-compact case?\n\nalso note that not a single doctest changed. But to be honest, I still believe that the `._vertex_adjacency_matrix` should be either fixed or renamed. It is not what it claims to be.\n\nNathann",
    "created_at": "2015-07-09T10:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264040",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:23" align="right">comment:23</div>

> Aren't we changing the behaviour of some functions for the non-compact case?

also note that not a single doctest changed. But to be honest, I still believe that the `._vertex_adjacency_matrix` should be either fixed or renamed. It is not what it claims to be.

Nathann



---

archive/issue_comments_264041.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nathanncohen](#comment%3A23):\n> > Aren't we changing the behaviour of some functions for the non-compact case?\n\n> \n> also note that not a single doctest changed. But to be honest, I still believe that the `._vertex_adjacency_matrix` should be either fixed or renamed. It is not what it claims to be.\n\npresently we have \n\n```\nadjacency_matrix = vertex_adjacency_matrix\n```\nin `geometry/polhedron/base.py`. I'd think we should rename `._vertex_adjacency_matrix` to something like `._Vrep_adjacency_matrix`, and, dually `._facet_adjacency_matrix` to `._Hrep_adjacency_matrix`. \n\nAnd then set `adjacency_matrix = _Vrep_adjacency_matrix`, and provide a meaningful implementation of  `vertex_adjacency_matrix`, as you propose here.",
    "created_at": "2015-07-09T11:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264041",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nathanncohen](#comment%3A23):
> > Aren't we changing the behaviour of some functions for the non-compact case?

> 
> also note that not a single doctest changed. But to be honest, I still believe that the `._vertex_adjacency_matrix` should be either fixed or renamed. It is not what it claims to be.

presently we have 

```
adjacency_matrix = vertex_adjacency_matrix
```
in `geometry/polhedron/base.py`. I'd think we should rename `._vertex_adjacency_matrix` to something like `._Vrep_adjacency_matrix`, and, dually `._facet_adjacency_matrix` to `._Hrep_adjacency_matrix`. 

And then set `adjacency_matrix = _Vrep_adjacency_matrix`, and provide a meaningful implementation of  `vertex_adjacency_matrix`, as you propose here.



---

archive/issue_comments_264042.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nSeems reasonable. Though I would very much like to see the definition of a `V_rep adjacency matrix`.\n\nNathann",
    "created_at": "2015-07-09T11:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264042",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:25" align="right">comment:25</div>

Seems reasonable. Though I would very much like to see the definition of a `V_rep adjacency matrix`.

Nathann



---

archive/issue_comments_264043.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@nathanncohen](#comment%3A25):\n> Seems reasonable. Though I would very much like to see the definition of a `V_rep adjacency matrix`.\n> \n\nwell, check out `sage.geometry.polyhedron.constructor?`. In short, any polyhedron is the Minkowski sum of a polytope P (spanned by vertices), a pointed polyhedral cone (spanned by rays), and a subspace S (spanned by lines). \n\n* If S is empty or of dimension bigger than 1, it can be ignored. \n* Otherwise S is a line,  and it is adjacent to all the vertices, and to no ray; and, counter-intuitively, no   vertices are adjacent to each other.\n* Rays are not adjacent to each other, and might be adjacent to some vertices.\n\nHow these general adjacencies are used, I don't know.",
    "created_at": "2015-07-09T19:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264043",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@nathanncohen](#comment%3A25):
> Seems reasonable. Though I would very much like to see the definition of a `V_rep adjacency matrix`.
> 

well, check out `sage.geometry.polyhedron.constructor?`. In short, any polyhedron is the Minkowski sum of a polytope P (spanned by vertices), a pointed polyhedral cone (spanned by rays), and a subspace S (spanned by lines). 

* If S is empty or of dimension bigger than 1, it can be ignored. 
* Otherwise S is a line,  and it is adjacent to all the vertices, and to no ray; and, counter-intuitively, no   vertices are adjacent to each other.
* Rays are not adjacent to each other, and might be adjacent to some vertices.

How these general adjacencies are used, I don't know.



---

archive/issue_comments_264044.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOh. Then it seems that it will be possible to rewrite that method using the algorithm implemented here, then. And everything will be faster.\n\nNathann",
    "created_at": "2015-07-09T19:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264044",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:27" align="right">comment:27</div>

Oh. Then it seems that it will be possible to rewrite that method using the algorithm implemented here, then. And everything will be faster.

Nathann



---

archive/issue_comments_264045.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAre we still in `needs review` here? I struggle to remember what was the sticking point.",
    "created_at": "2015-07-31T10:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264045",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

Are we still in `needs review` here? I struggle to remember what was the sticking point.



---

archive/issue_comments_264046.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n> Are we still in `needs review` here? I struggle to remember what was the sticking point.\n\nI do not think that there was any. We had discussions on the name of other functions, but this new implementation only touches the \"vertex graph\" and clearly improves the running time.\n\nNathann",
    "created_at": "2015-07-31T11:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264046",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:29" align="right">comment:29</div>

> Are we still in `needs review` here? I struggle to remember what was the sticking point.

I do not think that there was any. We had discussions on the name of other functions, but this new implementation only touches the "vertex graph" and clearly improves the running time.

Nathann



---

archive/issue_events_265410.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-31T12:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265410"
}
```



---

archive/issue_events_265411.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-07-31T12:54:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265411"
}
```



---

archive/issue_comments_264047.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2015-07-31T12:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264047",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_264048.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nOK. Merges in 6.8, no problem...",
    "created_at": "2015-07-31T12:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264048",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

OK. Merges in 6.8, no problem...



---

archive/issue_comments_264049.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThanks!",
    "created_at": "2015-07-31T12:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264049",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:31" align="right">comment:31</div>

Thanks!



---

archive/issue_events_265412.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-01T09:11:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265412"
}
```



---

archive/issue_events_265413.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-01T09:11:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265413"
}
```



---

archive/issue_comments_264050.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\n\n```\nsage -t --long src/sage/graphs/generators/random.py\n**********************************************************************\nFile \"src/sage/graphs/generators/random.py\", line 806, in sage.graphs.generators.random.RandomTriangulation\nFailed example:\n    for i in range(10):\n        g = graphs.RandomTriangulation(30,embed=True)\n        assert g.is_planar() and g.size() == 3*g.order()-6\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generators.random.RandomTriangulation[3]>\", line 3, in <module>\n        assert g.is_planar() and g.size() == Integer(3)*g.order()-Integer(6)\n      File \"/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 4035, in is_planar\n        planar = is_planar(G,kuratowski=kuratowski,set_pos=set_pos,set_embedding=set_embedding)\n      File \"sage/graphs/planarity.pyx\", line 99, in sage.graphs.planarity.is_planar (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/graphs/planarity.c:1800)\n        g.relabel(ffrom)\n      File \"/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 18006, in relabel\n        new_attr[perm[v]] = value\n    KeyError: 0\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.graphs.generators.random.RandomTriangulation\n    [71 tests, 1 failure, 5.56 s]\n```\nWould have been easy to catch if you had checked the patchbot output...",
    "created_at": "2015-08-01T09:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264050",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:32" align="right">comment:32</div>


```
sage -t --long src/sage/graphs/generators/random.py
**********************************************************************
File "src/sage/graphs/generators/random.py", line 806, in sage.graphs.generators.random.RandomTriangulation
Failed example:
    for i in range(10):
        g = graphs.RandomTriangulation(30,embed=True)
        assert g.is_planar() and g.size() == 3*g.order()-6
Exception raised:
    Traceback (most recent call last):
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.random.RandomTriangulation[3]>", line 3, in <module>
        assert g.is_planar() and g.size() == Integer(3)*g.order()-Integer(6)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 4035, in is_planar
        planar = is_planar(G,kuratowski=kuratowski,set_pos=set_pos,set_embedding=set_embedding)
      File "sage/graphs/planarity.pyx", line 99, in sage.graphs.planarity.is_planar (/mnt/highperf/buildbot/slave/sage_git/build/src/build/cythonized/sage/graphs/planarity.c:1800)
        g.relabel(ffrom)
      File "/mnt/highperf/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 18006, in relabel
        new_attr[perm[v]] = value
    KeyError: 0
**********************************************************************
1 item had failures:
   1 of   5 in sage.graphs.generators.random.RandomTriangulation
    [71 tests, 1 failure, 5.56 s]
```
Would have been easy to catch if you had checked the patchbot output...



---

archive/issue_comments_264051.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5dfc776a511ab06d549f6437d1b906ec3bb7e3d5\"><code>5dfc776</code></a></td><td><code>trac #18860: Merged with 6.9.beta0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053\"><code>5223cda</code></a></td><td><code>trac #18860: Remove vertex labels</code></td></tr></table>\n",
    "created_at": "2015-08-01T09:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264051",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5dfc776a511ab06d549f6437d1b906ec3bb7e3d5"><code>5dfc776</code></a></td><td><code>trac #18860: Merged with 6.9.beta0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053"><code>5223cda</code></a></td><td><code>trac #18860: Remove vertex labels</code></td></tr></table>




---

archive/issue_comments_264052.json:
```json
{
    "body": "Changed commit from **[`74d8412`](https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a)** to **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**",
    "created_at": "2015-08-01T09:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264052",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`74d8412`](https://github.com/sagemath/sagetrac-mirror/commit/74d8412010748142918edf6178636bffdb14e60a)** to **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**



---

archive/issue_events_265414.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-08-01T09:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265414"
}
```



---

archive/issue_events_265415.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-08-01T09:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265415"
}
```



---

archive/issue_comments_264053.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@nathanncohen](#comment%3A34):\n\nCould you explain what happens in the last commit? \n(E.g.. why did it work earlier?)",
    "created_at": "2015-08-01T09:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264053",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@nathanncohen](#comment%3A34):

Could you explain what happens in the last commit? 
(E.g.. why did it work earlier?)



---

archive/issue_comments_264054.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nOh, no problem: there is a difference between the previous output or `.vertex_graph` and the new version: in the former, the vertices of the graph were labelled on integers. Now, the vertices of that graph are the 'vertex' objects contained in the polyhedron.\n\nI adapted the code, for it expected the keys of the position dictionary (the vertices) to be integers, instead of the new points.\n\nActually, it convinced me that the previous version of this function was incorrect in theory. It was assumed that the vertices of the polyhedron appeared in the very same order as how they were first given to the polyhedron constructor. I don't know if it is true in practice, but for sure there is no reason to assume that a priori. So you can see this as a bugfix `;-)`\n\nNathann",
    "created_at": "2015-08-01T09:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264054",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:36" align="right">comment:36</div>

Oh, no problem: there is a difference between the previous output or `.vertex_graph` and the new version: in the former, the vertices of the graph were labelled on integers. Now, the vertices of that graph are the 'vertex' objects contained in the polyhedron.

I adapted the code, for it expected the keys of the position dictionary (the vertices) to be integers, instead of the new points.

Actually, it convinced me that the previous version of this function was incorrect in theory. It was assumed that the vertices of the polyhedron appeared in the very same order as how they were first given to the polyhedron constructor. I don't know if it is true in practice, but for sure there is no reason to assume that a priori. So you can see this as a bugfix `;-)`

Nathann



---

archive/issue_comments_264055.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nVertices are definitely reordered in `Polyhedron`.",
    "created_at": "2015-08-01T09:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264055",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

Vertices are definitely reordered in `Polyhedron`.



---

archive/issue_events_265416.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-01T10:14:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265416"
}
```



---

archive/issue_events_265417.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-08-01T10:14:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265417"
}
```



---

archive/issue_comments_264056.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOK, looks good.",
    "created_at": "2015-08-01T10:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264056",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

OK, looks good.



---

archive/issue_comments_264057.json:
```json
{
    "body": "Changed branch from **[public/18860](https://github.com/sagemath/sagetrac-mirror/tree/public/18860)** to **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**",
    "created_at": "2015-08-01T23:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18860#issuecomment-264057",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/18860](https://github.com/sagemath/sagetrac-mirror/tree/public/18860)** to **[`5223cda`](https://github.com/sagemath/sagetrac-mirror/commit/5223cda9f15b2a417b550039b978a07e126f9053)**



---

archive/issue_events_265418.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-01T23:07:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265418"
}
```



---

archive/issue_events_265419.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4f379dc2812e1a144a0371c924dfa738444780a1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-08-01T23:07:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18860",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18860#event-265419"
}
```
