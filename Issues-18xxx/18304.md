# Issue 18304: Integer and Rational comparisons

archive/issues_018067.json:
```json
{
    "assignees": [],
    "body": "MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n\nComparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n\n```\nsage: a = 1; b = 18\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 64.3 ns per loop\nsage: a = QQ(1); b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 84 ns per loop\nsage: a = 1; b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 405 ns per loop\n```\n\nWith the branch applied, it gets better\n\n```\nsage: a = 1; b = 18\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 64 ns per loop\nsage: a = QQ(1); b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 65.6 ns per loop\nsage: a = 1; b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 87.1 ns per loop\n```\n\nCC:  @jdemeyer\n\nBranch/Commit: **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**\n\nReviewer: **Marc Mezzarobba, Travis Scrimshaw**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/18304_\n\n",
    "closed_at": "2017-06-17T10:29:04Z",
    "created_at": "2015-04-26T11:05:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Integer and Rational comparisons",
    "type": "issue",
    "updated_at": "2017-06-17T10:29:04Z",
    "url": "https://github.com/sagemath/sage/issues/18304",
    "user": "https://github.com/videlec"
}
```
MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.

Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:

```
sage: a = 1; b = 18
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 64.3 ns per loop
sage: a = QQ(1); b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 84 ns per loop
sage: a = 1; b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 405 ns per loop
```

With the branch applied, it gets better

```
sage: a = 1; b = 18
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 64 ns per loop
sage: a = QQ(1); b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 65.6 ns per loop
sage: a = 1; b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 87.1 ns per loop
```

CC:  @jdemeyer

Branch/Commit: **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**

Reviewer: **Marc Mezzarobba, Travis Scrimshaw**

Author: **Vincent Delecroix**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/18304_





---

archive/issue_events_261409.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T11:05:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261409"
}
```



---

archive/issue_events_261410.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T11:05:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261410"
}
```



---

archive/issue_events_261411.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T11:05:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261411"
}
```



---

archive/issue_events_261412.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T11:05:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261412"
}
```



---

archive/issue_comments_251360.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2015-04-26T15:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251360",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_251361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n sage: timeit(\"a < b\", number=500000, repeat=100)\n 500000 loops, best of 100: 416 ns per loop\n ```\n+\n+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.\n``````\n",
    "created_at": "2015-04-26T15:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251361",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 sage: timeit("a < b", number=500000, repeat=100)
 500000 loops, best of 100: 416 ns per loop
 ```
+
+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.
``````




---

archive/issue_comments_251362.json:
```json
{
    "body": "Branch: **[u/vdelecroix/18304](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18304)**",
    "created_at": "2015-04-26T15:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251362",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/18304](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18304)**



---

archive/issue_comments_251363.json:
```json
{
    "body": "Commit: **[`dbb7831`](https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4)**",
    "created_at": "2015-04-26T15:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251363",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`dbb7831`](https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4)**



---

archive/issue_comments_251364.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26\"><code>a7cbb88</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b48fec116a29a3449c816bcf392ce3d07e72667\"><code>9b48fec</code></a></td><td><code>Doctest .pxd files also</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d\"><code>1ad339b</code></a></td><td><code>Implement _rich_to_bool as inline function instead of member function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba\"><code>17bd067</code></a></td><td><code>Merge tag '6.7.beta2' into t/17890/ticket/17890</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4\"><code>dbb7831</code></a></td><td><code>Trac 18304: faster comparisons Integer <-> Rational</code></td></tr></table>\n",
    "created_at": "2015-04-26T15:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251364",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7cbb88852ceefff65e421e75c0479bcd554ce26"><code>a7cbb88</code></a></td><td><code>Remove _cmp_c_impl and _richcmp_c_impl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b48fec116a29a3449c816bcf392ce3d07e72667"><code>9b48fec</code></a></td><td><code>Doctest .pxd files also</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ad339bf0c8ffe75d23ddaa6d896121b8c96636d"><code>1ad339b</code></a></td><td><code>Implement _rich_to_bool as inline function instead of member function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17bd067153ad40ced061147390687f514a7f7cba"><code>17bd067</code></a></td><td><code>Merge tag '6.7.beta2' into t/17890/ticket/17890</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4"><code>dbb7831</code></a></td><td><code>Trac 18304: faster comparisons Integer <-> Rational</code></td></tr></table>




---

archive/issue_events_261413.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-26T15:49:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261413"
}
```



---

archive/issue_comments_251365.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec\"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/629f6a5618ec6e5f616bf89e4886ea4dd92ae60e\"><code>629f6a5</code></a></td><td><code>Improve comparisons for permutation groups</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1\"><code>0d1e049</code></a></td><td><code>Improve _richcmp and documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422\"><code>39273f1</code></a></td><td><code>Fix doctest formatting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af\"><code>04570b3</code></a></td><td><code>Fix bad doctest in etaproducts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef\"><code>3976f2c</code></a></td><td><code>Add pointers for special uses of __richcmp__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e8315fac859f821b5c5f649e176aded4efd08bd\"><code>7e8315f</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/17890' into sage-6.7.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e\"><code>554c435</code></a></td><td><code>Trac 18304: faster comparisons for Rational</code></td></tr></table>\n",
    "created_at": "2015-04-28T21:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251365",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313a400146b0fb19d80c31117d44ce735041d4ec"><code>313a400</code></a></td><td><code>Optimize rich_to_bool_sgn</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/629f6a5618ec6e5f616bf89e4886ea4dd92ae60e"><code>629f6a5</code></a></td><td><code>Improve comparisons for permutation groups</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d1e049f807a1c34b00cf0e58ee65cc7734d1ad1"><code>0d1e049</code></a></td><td><code>Improve _richcmp and documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39273f1aacfdd307d20b729ae732e349438a8422"><code>39273f1</code></a></td><td><code>Fix doctest formatting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04570b3dfd194fea8c2437c8717c3dfb8704b4af"><code>04570b3</code></a></td><td><code>Fix bad doctest in etaproducts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3976f2cc4ec59c9f978d9d02c7f697c81025c4ef"><code>3976f2c</code></a></td><td><code>Add pointers for special uses of __richcmp__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e8315fac859f821b5c5f649e176aded4efd08bd"><code>7e8315f</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/17890' into sage-6.7.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e"><code>554c435</code></a></td><td><code>Trac 18304: faster comparisons for Rational</code></td></tr></table>




---

archive/issue_comments_251366.json:
```json
{
    "body": "Changed commit from **[`dbb7831`](https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4)** to **[`554c435`](https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e)**",
    "created_at": "2015-04-28T21:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbb7831`](https://github.com/sagemath/sagetrac-mirror/commit/dbb783170ea1989d32e538af4b025db2c8576cf4)** to **[`554c435`](https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e)**



---

archive/issue_comments_251367.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,16 @@\n 500000 loops, best of 100: 416 ns per loop\n ```\n \n-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.\n+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got\n+\n+```\n+sage: a = 1; b = 18\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 62.2 ns per loop\n+sage: a = QQ(1); b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 65.3 ns per loop\n+sage: a = 1; b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 82.8 ns per loop\n+```\n``````\n",
    "created_at": "2015-04-28T22:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251367",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,16 @@
 500000 loops, best of 100: 416 ns per loop
 ```
 
-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.
+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got
+
+```
+sage: a = 1; b = 18
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 62.2 ns per loop
+sage: a = QQ(1); b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 65.3 ns per loop
+sage: a = 1; b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 82.8 ns per loop
+```
``````




---

archive/issue_comments_251368.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?\n\nAlso, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\nBy the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.",
    "created_at": "2015-05-03T08:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251368",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:6" align="right">comment:6</div>

It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?

Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?

By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.



---

archive/issue_comments_251369.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHello,\n\nReplying to [@mezzarobba](#comment:6):\n> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...\n\nMe neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\n> Did you check if there is a measurable performance benefit?\n\nIt is minor but timings are in the ticket description. In a more concrete situation\n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\nsage: shuffle(l)\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 1.21 ms\n```\ncompared to\n\n```\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 247 \u00b5s\n```\n\n> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\nI do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.\n\n> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\nYes.",
    "created_at": "2015-05-03T09:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251369",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

Hello,

Replying to [@mezzarobba](#comment:6):
> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...

Me neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?

> Did you check if there is a measurable performance benefit?

It is minor but timings are in the ticket description. In a more concrete situation

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
sage: shuffle(l)
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.21 ms
```
compared to

```
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 247 µs
```

> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?

I do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.

> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

Yes.



---

archive/issue_comments_251370.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@videlec](#comment:7):\n> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\n> \n> Yes.\n\nActually, no. Because it is **not** a rich comparison but just comparison.",
    "created_at": "2015-05-03T09:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251370",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@videlec](#comment:7):
> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

> 
> Yes.

Actually, no. Because it is **not** a rich comparison but just comparison.



---

archive/issue_comments_251371.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@videlec](#comment:7):\n> Me neither (and there is actually one in `sage.rings.integer` that is not from me).\n\nYes, I saw that.\n\n> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\nI have no idea.\n\n> > Did you check if there is a measurable performance benefit?\n\n> \n> It is minor but timings are in the ticket description.\n\nNo, I mean specifically for using a global temporary variable instead of creating a new one each time.",
    "created_at": "2015-05-03T09:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251371",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@videlec](#comment:7):
> Me neither (and there is actually one in `sage.rings.integer` that is not from me).

Yes, I saw that.

> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?

I have no idea.

> > Did you check if there is a measurable performance benefit?

> 
> It is minor but timings are in the ticket description.

No, I mean specifically for using a global temporary variable instead of creating a new one each time.



---

archive/issue_comments_251372.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment:8):\n> Replying to [@videlec](#comment:7):\n> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\n> > \n> > Yes.\n\n> \n> Actually, no. Because it is **not** a rich comparison but just comparison.\n\nRight, sorry.",
    "created_at": "2015-05-03T09:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251372",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment:8):
> Replying to [@videlec](#comment:7):
> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

> > 
> > Yes.

> 
> Actually, no. Because it is **not** a rich comparison but just comparison.

Right, sorry.



---

archive/issue_events_261414.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-03T09:57:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261414"
}
```



---

archive/issue_events_261415.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-05-03T09:57:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261415"
}
```



---

archive/issue_comments_251373.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWith \n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\n```\n\ndeclaring global `mpz_tmp` and `mpq_tmp` I got\n\n```\ntimeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 131 \u00b5s per loop\n```\nand with local ones\n\n```\nsage: timeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 177 \u00b5s per loop\n```\n\nNote that this bad scenario only occurs for comparisons of:\n- Python long with Sage Integer\n- Sage Rationals with Sage Integer, Python int, Python long\n\nThere is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).\n\nI will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.\n\nVincent",
    "created_at": "2015-05-03T09:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251373",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">comment:11</div>

With 

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
```

declaring global `mpz_tmp` and `mpq_tmp` I got

```
timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 131 µs per loop
```
and with local ones

```
sage: timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 177 µs per loop
```

Note that this bad scenario only occurs for comparisons of:
- Python long with Sage Integer
- Sage Rationals with Sage Integer, Python int, Python long

There is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).

I will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.

Vincent



---

archive/issue_comments_251374.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,16 +12,6 @@\n 500000 loops, best of 100: 416 ns per loop\n ```\n \n-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got\n+Upstream mpir pull request for the `mpq_cmp_mpz` function:\n \n-```\n-sage: a = 1; b = 18\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 62.2 ns per loop\n-sage: a = QQ(1); b = QQ(18)\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 65.3 ns per loop\n-sage: a = 1; b = QQ(18)\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 82.8 ns per loop\n-```\n+    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n``````\n",
    "created_at": "2015-08-14T16:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251374",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,16 +12,6 @@
 500000 loops, best of 100: 416 ns per loop
 ```
 
-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got
+Upstream mpir pull request for the `mpq_cmp_mpz` function:
 
-```
-sage: a = 1; b = 18
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 62.2 ns per loop
-sage: a = QQ(1); b = QQ(18)
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 65.3 ns per loop
-sage: a = 1; b = QQ(18)
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 82.8 ns per loop
-```
+    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
``````




---

archive/issue_events_261416.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-14T16:27:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261416"
}
```



---

archive/issue_events_261417.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-14T16:27:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261417"
}
```



---

archive/issue_comments_251375.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf219965537197228a551b456a0c275d587daeb6\"><code>cf21996</code></a></td><td><code>Trac 18304: mpir patch for mpq_cmp_mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482\"><code>e03a26e</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2015-08-14T17:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251375",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf219965537197228a551b456a0c275d587daeb6"><code>cf21996</code></a></td><td><code>Trac 18304: mpir patch for mpq_cmp_mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482"><code>e03a26e</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_comments_251376.json:
```json
{
    "body": "Changed commit from **[`554c435`](https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e)** to **[`e03a26e`](https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482)**",
    "created_at": "2015-08-14T17:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251376",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`554c435`](https://github.com/sagemath/sagetrac-mirror/commit/554c4358bc0e470ec0c72c2a24251f4a6978a12e)** to **[`e03a26e`](https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482)**



---

archive/issue_comments_251377.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,12 +6,28 @@\n 500000 loops, best of 100: 64.3 ns per loop\n sage: a = QQ(1); b = QQ(18)\n sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 88.4 ns per loop\n+500000 loops, best of 100: 84 ns per loop\n sage: a = 1; b = QQ(18)\n sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 416 ns per loop\n+500000 loops, best of 100: 405 ns per loop\n+```\n+\n+With the branch applied, it gets better\n+\n+```\n+sage: a = 1; b = 18\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 64 ns per loop\n+sage: a = QQ(1); b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 65.6 ns per loop\n+sage: a = 1; b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 87.1 ns per loop\n ```\n \n Upstream mpir pull request for the `mpq_cmp_mpz` function:\n \n     [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n+\n+Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!\n``````\n",
    "created_at": "2015-08-14T17:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251377",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,12 +6,28 @@
 500000 loops, best of 100: 64.3 ns per loop
 sage: a = QQ(1); b = QQ(18)
 sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 88.4 ns per loop
+500000 loops, best of 100: 84 ns per loop
 sage: a = 1; b = QQ(18)
 sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 416 ns per loop
+500000 loops, best of 100: 405 ns per loop
+```
+
+With the branch applied, it gets better
+
+```
+sage: a = 1; b = 18
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 64 ns per loop
+sage: a = QQ(1); b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 65.6 ns per loop
+sage: a = 1; b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 87.1 ns per loop
 ```
 
 Upstream mpir pull request for the `mpq_cmp_mpz` function:
 
     [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
+
+Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!
``````




---

archive/issue_events_261418.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-14T17:10:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261418"
}
```



---

archive/issue_events_261419.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-14T17:10:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261419"
}
```



---

archive/issue_comments_251378.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHi Vincent,\n\nDo you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?",
    "created_at": "2015-08-18T14:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251378",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

Hi Vincent,

Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?



---

archive/issue_comments_251379.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHi Marc,\n\nThanks for having a look.\n\nReplying to [@mezzarobba](#comment:15):\n> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?\n\nLast news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.\n\nYou are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.",
    "created_at": "2015-08-18T15:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251379",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Hi Marc,

Thanks for having a look.

Replying to [@mezzarobba](#comment:15):
> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?

Last news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.

You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.



---

archive/issue_comments_251380.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@videlec](#comment:16):\n> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n\nI'd wait.",
    "created_at": "2015-08-18T15:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251380",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@videlec](#comment:16):
> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.

I'd wait.



---

archive/issue_comments_251381.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.\n+\n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n ```\n``````\n",
    "created_at": "2015-08-18T15:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251381",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.
+
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
 ```
``````




---

archive/issue_comments_251382.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mezzarobba](#comment:17):\n> Replying to [@videlec](#comment:16):\n> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n\n> \n> I'd wait.\n\nLooks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.",
    "created_at": "2015-08-18T15:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251382",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mezzarobba](#comment:17):
> Replying to [@videlec](#comment:16):
> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.

> 
> I'd wait.

Looks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.



---

archive/issue_events_261420.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-18T15:57:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261420"
}
```



---

archive/issue_events_261421.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-18T15:57:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261421"
}
```



---

archive/issue_events_261422.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-03T18:12:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261422"
}
```



---

archive/issue_events_261423.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-03T18:12:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261423"
}
```



---

archive/issue_comments_251383.json:
```json
{
    "body": "Dependencies: **#22493**",
    "created_at": "2017-05-03T18:12:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251383",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#22493**



---

archive/issue_comments_251384.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.\n+MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n \n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n@@ -27,9 +27,3 @@\n sage: timeit(\"a < b\", number=500000, repeat=100)\n 500000 loops, best of 100: 87.1 ns per loop\n ```\n-\n-Upstream mpir pull request for the `mpq_cmp_mpz` function:\n-\n-    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n-\n-Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!\n``````\n",
    "created_at": "2017-05-03T18:12:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251384",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.
+MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
 
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
@@ -27,9 +27,3 @@
 sage: timeit("a < b", number=500000, repeat=100)
 500000 loops, best of 100: 87.1 ns per loop
 ```
-
-Upstream mpir pull request for the `mpq_cmp_mpz` function:
-
-    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
-
-Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!
``````




---

archive/issue_comments_251385.json:
```json
{
    "body": "Changed commit from **[`e03a26e`](https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482)** to **[`81b637b`](https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803)**",
    "created_at": "2017-05-04T06:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251385",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e03a26e`](https://github.com/sagemath/sagetrac-mirror/commit/e03a26e63dd50f79fc7ada885daefd8c9970c482)** to **[`81b637b`](https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803)**



---

archive/issue_comments_251386.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d723dcf5455ff95d40bfc24a11779efd69589aa\"><code>4d723dc</code></a></td><td><code>Add yasm as a standard package.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3057c797a3230875c26cf2dc4117e61cdd07ecda\"><code>3057c79</code></a></td><td><code>Add configure check for yasm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6377eaeea02655d3238b1ab389fd236d9d42e988\"><code>6377eae</code></a></td><td><code>upgrade mpir to 3-0-0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c39a193b70b7d0e32f690b307dcccf3c123374d1\"><code>c39a193</code></a></td><td><code>Add build time yasm dependency to mpir.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803\"><code>81b637b</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2017-05-04T06:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251386",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d723dcf5455ff95d40bfc24a11779efd69589aa"><code>4d723dc</code></a></td><td><code>Add yasm as a standard package.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3057c797a3230875c26cf2dc4117e61cdd07ecda"><code>3057c79</code></a></td><td><code>Add configure check for yasm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6377eaeea02655d3238b1ab389fd236d9d42e988"><code>6377eae</code></a></td><td><code>upgrade mpir to 3-0-0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c39a193b70b7d0e32f690b307dcccf3c123374d1"><code>c39a193</code></a></td><td><code>Add build time yasm dependency to mpir.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803"><code>81b637b</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_events_261424.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-04T06:35:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261424"
}
```



---

archive/issue_events_261425.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-04T06:35:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261425"
}
```



---

archive/issue_comments_251387.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\ndoes not apply",
    "created_at": "2017-05-31T06:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251387",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

does not apply



---

archive/issue_events_261426.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T06:34:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261426"
}
```



---

archive/issue_events_261427.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T06:34:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261427"
}
```



---

archive/issue_comments_251388.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/357103ac48fc1e10d55e1fae2c5a07c43858a2de\"><code>357103a</code></a></td><td><code>Merge branch 'public/22493' of git://trac.sagemath.org/sage into mpir300</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ddc2f11aa9af630b0e5873bb93bceb3c0e571c2\"><code>8ddc2f1</code></a></td><td><code>MPIR 3.0.0 does not build yasm anymore.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8205366bd4bfe78b25781533622d7633e8376454\"><code>8205366</code></a></td><td><code>But MPIR always looks for it even on archs where it is not used.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9573e155b79a719db84d0ea2d2842abb7885d84e\"><code>9573e15</code></a></td><td><code>Check GNU as version when building MPIR.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb8a3f7beeb1fd57d9a7ce3180bffad7f78867cf\"><code>cb8a3f7</code></a></td><td><code>Echo comment when skipping yasm check.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa0b222388e27db40c9da7e5a91da4f08401c854\"><code>aa0b222</code></a></td><td><code>This should work and be useful on non-linux systems.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9eaefcc84a3f4473b30d93d697d684135d69d6c\"><code>c9eaefc</code></a></td><td><code>Remove useless gcc check when looking for old as.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01c90970e9fe648a9374cd02be24c3d6d8da3dab\"><code>01c9097</code></a></td><td><code>Remove broken spaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42e738afd9e4b4d226c31802e5539f757240b7e7\"><code>42e738a</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163\"><code>e2b7230</code></a></td><td><code>Merge 8.0.beta8</code></td></tr></table>\n",
    "created_at": "2017-05-31T07:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251388",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/357103ac48fc1e10d55e1fae2c5a07c43858a2de"><code>357103a</code></a></td><td><code>Merge branch 'public/22493' of git://trac.sagemath.org/sage into mpir300</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ddc2f11aa9af630b0e5873bb93bceb3c0e571c2"><code>8ddc2f1</code></a></td><td><code>MPIR 3.0.0 does not build yasm anymore.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8205366bd4bfe78b25781533622d7633e8376454"><code>8205366</code></a></td><td><code>But MPIR always looks for it even on archs where it is not used.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9573e155b79a719db84d0ea2d2842abb7885d84e"><code>9573e15</code></a></td><td><code>Check GNU as version when building MPIR.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb8a3f7beeb1fd57d9a7ce3180bffad7f78867cf"><code>cb8a3f7</code></a></td><td><code>Echo comment when skipping yasm check.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa0b222388e27db40c9da7e5a91da4f08401c854"><code>aa0b222</code></a></td><td><code>This should work and be useful on non-linux systems.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9eaefcc84a3f4473b30d93d697d684135d69d6c"><code>c9eaefc</code></a></td><td><code>Remove useless gcc check when looking for old as.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01c90970e9fe648a9374cd02be24c3d6d8da3dab"><code>01c9097</code></a></td><td><code>Remove broken spaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42e738afd9e4b4d226c31802e5539f757240b7e7"><code>42e738a</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163"><code>e2b7230</code></a></td><td><code>Merge 8.0.beta8</code></td></tr></table>




---

archive/issue_comments_251389.json:
```json
{
    "body": "Changed commit from **[`81b637b`](https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803)** to **[`e2b7230`](https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163)**",
    "created_at": "2017-05-31T07:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251389",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`81b637b`](https://github.com/sagemath/sagetrac-mirror/commit/81b637b30a06e19504eda1898f3e3ad57b0bc803)** to **[`e2b7230`](https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163)**



---

archive/issue_events_261428.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-31T07:26:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261428"
}
```



---

archive/issue_events_261429.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-31T07:26:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261429"
}
```



---

archive/issue_comments_251390.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2\"><code>575d855</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2017-06-03T16:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251390",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2"><code>575d855</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_comments_251391.json:
```json
{
    "body": "Changed commit from **[`e2b7230`](https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163)** to **[`575d855`](https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2)**",
    "created_at": "2017-06-03T16:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e2b7230`](https://github.com/sagemath/sagetrac-mirror/commit/e2b72301cda6c9b36a8b128a5cceeac12a11e163)** to **[`575d855`](https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2)**



---

archive/issue_comments_251392.json:
```json
{
    "body": "Changed dependencies from **#22493** to none",
    "created_at": "2017-06-03T16:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251392",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#22493** to none



---

archive/issue_comments_251393.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n+MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n \n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n``````\n",
    "created_at": "2017-06-03T16:08:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251393",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
+MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
 
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
``````




---

archive/issue_comments_251394.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOverall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:\n\n```diff\n-if not isinstance(left, Rational):\n-   raise RuntimeError('this should not happen')\n+assert isinstance(left, Rational)\n```",
    "created_at": "2017-06-03T22:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251394",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

Overall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:

```diff
-if not isinstance(left, Rational):
-   raise RuntimeError('this should not happen')
+assert isinstance(left, Rational)
```



---

archive/issue_comments_251395.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f\"><code>8c60c6a</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2017-06-12T15:59:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251395",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f"><code>8c60c6a</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_comments_251396.json:
```json
{
    "body": "Changed commit from **[`575d855`](https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2)** to **[`8c60c6a`](https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f)**",
    "created_at": "2017-06-12T15:59:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251396",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`575d855`](https://github.com/sagemath/sagetrac-mirror/commit/575d85593a6965ac5d3b7c008d8dce474eb572e2)** to **[`8c60c6a`](https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f)**



---

archive/issue_comments_251397.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc\"><code>6294a5f</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2017-06-12T16:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251397",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc"><code>6294a5f</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_comments_251398.json:
```json
{
    "body": "Changed commit from **[`8c60c6a`](https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f)** to **[`6294a5f`](https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc)**",
    "created_at": "2017-06-12T16:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251398",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8c60c6a`](https://github.com/sagemath/sagetrac-mirror/commit/8c60c6ad58e14315213ed055a05383550408ab8f)** to **[`6294a5f`](https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc)**



---

archive/issue_comments_251399.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nrebased on 8.0.beta10 (and incorported your [comment:28](#comment:28))",
    "created_at": "2017-06-12T16:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251399",
    "user": "https://github.com/videlec"
}
```

<div id="comment:31" align="right">comment:31</div>

rebased on 8.0.beta10 (and incorported your [comment:28](#comment:28))



---

archive/issue_comments_251400.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:\n\nhttps://eev.ee/blog/2012/03/24/python-faq-equality/\n\nI do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.",
    "created_at": "2017-06-12T23:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251400",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Thanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:

https://eev.ee/blog/2012/03/24/python-faq-equality/

I do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.



---

archive/issue_comments_251401.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\ndoes not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)",
    "created_at": "2017-06-16T06:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251401",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:33" align="right">comment:33</div>

does not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)



---

archive/issue_events_261430.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-16T06:34:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261430"
}
```



---

archive/issue_events_261431.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-16T06:34:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261431"
}
```



---

archive/issue_comments_251402.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d\"><code>e72c82d</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>\n",
    "created_at": "2017-06-16T07:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251402",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d"><code>e72c82d</code></a></td><td><code>Trac 18304: faster comparisons for Integer/Rational</code></td></tr></table>




---

archive/issue_comments_251403.json:
```json
{
    "body": "Changed commit from **[`6294a5f`](https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc)** to **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**",
    "created_at": "2017-06-16T07:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251403",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6294a5f`](https://github.com/sagemath/sagetrac-mirror/commit/6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc)** to **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**



---

archive/issue_comments_251404.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIndeed. I rebased on 8.0.beta11.",
    "created_at": "2017-06-16T07:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251404",
    "user": "https://github.com/videlec"
}
```

<div id="comment:35" align="right">comment:35</div>

Indeed. I rebased on 8.0.beta11.



---

archive/issue_events_261432.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-16T07:54:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261432"
}
```



---

archive/issue_events_261433.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-16T07:54:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261433"
}
```



---

archive/issue_comments_251405.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba, Travis Scrimshaw**",
    "created_at": "2017-06-16T15:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251405",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Marc Mezzarobba, Travis Scrimshaw**



---

archive/issue_events_261434.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-06-16T15:35:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261434"
}
```



---

archive/issue_events_261435.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-06-16T15:35:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261435"
}
```



---

archive/issue_comments_251406.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nHmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.",
    "created_at": "2017-06-16T15:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251406",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:36" align="right">comment:36</div>

Hmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.



---

archive/issue_comments_251407.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/18304](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18304)** to **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**",
    "created_at": "2017-06-17T10:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/18304#issuecomment-251407",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/18304](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/18304)** to **[`e72c82d`](https://github.com/sagemath/sagetrac-mirror/commit/e72c82de36e6838f1064eccf08382b232521ed0d)**



---

archive/issue_events_261436.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-17T10:29:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261436"
}
```



---

archive/issue_events_261437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a04c390736f0def683628bd06844e7f7f891222b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-17T10:29:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/18304",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/18304#event-261437"
}
```
