# Issue 18304: Integer and Rational comparisons

archive/issues_018067.json:
```json
{
    "body": "MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n\nComparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n\n```\nsage: a = 1; b = 18\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 64.3 ns per loop\nsage: a = QQ(1); b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 84 ns per loop\nsage: a = 1; b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 405 ns per loop\n```\n\nWith the branch applied, it gets better\n\n```\nsage: a = 1; b = 18\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 64 ns per loop\nsage: a = QQ(1); b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 65.6 ns per loop\nsage: a = 1; b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 87.1 ns per loop\n```\n\nCC:  @jdemeyer\n\nBranch/Commit: e72c82de36e6838f1064eccf08382b232521ed0d\n\nReviewer: Marc Mezzarobba, Travis Scrimshaw\n\nAuthor: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/18304\n\n",
    "closed_at": "2017-06-17T10:29:04Z",
    "created_at": "2015-04-26T11:05:02Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Integer and Rational comparisons",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18304",
    "user": "https://github.com/videlec"
}
```
MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.

Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:

```
sage: a = 1; b = 18
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 64.3 ns per loop
sage: a = QQ(1); b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 84 ns per loop
sage: a = 1; b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 405 ns per loop
```

With the branch applied, it gets better

```
sage: a = 1; b = 18
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 64 ns per loop
sage: a = QQ(1); b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 65.6 ns per loop
sage: a = 1; b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 87.1 ns per loop
```

CC:  @jdemeyer

Branch/Commit: e72c82de36e6838f1064eccf08382b232521ed0d

Reviewer: Marc Mezzarobba, Travis Scrimshaw

Author: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/18304





---

archive/issue_comments_318093.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Delecroix\"",
    "created_at": "2015-04-26T15:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318093",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Vincent Delecroix"



---

archive/issue_comments_318094.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n sage: timeit(\"a < b\", number=500000, repeat=100)\n 500000 loops, best of 100: 416 ns per loop\n ```\n+\n+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.\n``````\n",
    "created_at": "2015-04-26T15:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318094",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 sage: timeit("a < b", number=500000, repeat=100)
 500000 loops, best of 100: 416 ns per loop
 ```
+
+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.
``````




---

archive/issue_comments_318095.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/18304\"",
    "created_at": "2015-04-26T15:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318095",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/18304"



---

archive/issue_comments_318096.json:
```json
{
    "body": "Changing commit from \"\" to \"dbb783170ea1989d32e538af4b025db2c8576cf4\"",
    "created_at": "2015-04-26T15:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "dbb783170ea1989d32e538af4b025db2c8576cf4"



---

archive/issue_comments_318097.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-26T15:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318098.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-26T15:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318098",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318099.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-28T21:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318100.json:
```json
{
    "body": "Changing commit from \"dbb783170ea1989d32e538af4b025db2c8576cf4\" to \"554c4358bc0e470ec0c72c2a24251f4a6978a12e\"",
    "created_at": "2015-04-28T21:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318100",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dbb783170ea1989d32e538af4b025db2c8576cf4" to "554c4358bc0e470ec0c72c2a24251f4a6978a12e"



---

archive/issue_comments_318101.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,16 @@\n 500000 loops, best of 100: 416 ns per loop\n ```\n \n-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.\n+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got\n+\n+```\n+sage: a = 1; b = 18\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 62.2 ns per loop\n+sage: a = QQ(1); b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 65.3 ns per loop\n+sage: a = 1; b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 82.8 ns per loop\n+```\n``````\n",
    "created_at": "2015-04-28T22:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318101",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,16 @@
 500000 loops, best of 100: 416 ns per loop
 ```
 
-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time.
+With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got
+
+```
+sage: a = 1; b = 18
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 62.2 ns per loop
+sage: a = QQ(1); b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 65.3 ns per loop
+sage: a = 1; b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 82.8 ns per loop
+```
``````




---

archive/issue_comments_318102.json:
```json
{
    "body": "<a id='comment:6'></a>It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?\n\nAlso, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\nBy the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.",
    "created_at": "2015-05-03T08:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318102",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?

Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?

By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.



---

archive/issue_comments_318103.json:
```json
{
    "body": "<a id='comment:7'></a>Hello,\n\nReplying to [mmezzarobba](#comment%3A6):\n> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...\n\n\nMe neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\n> Did you check if there is a measurable performance benefit?\n\n\nIt is minor but timings are in the ticket description. In a more concrete situation\n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\nsage: shuffle(l)\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 1.21 ms\n```\ncompared to\n\n```\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 247 \u00b5s\n```\n\n> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\n\nI do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.\n\n> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\n\nYes.",
    "created_at": "2015-05-03T09:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318103",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Hello,

Replying to [mmezzarobba](#comment%3A6):
> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...


Me neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?

> Did you check if there is a measurable performance benefit?


It is minor but timings are in the ticket description. In a more concrete situation

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
sage: shuffle(l)
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.21 ms
```
compared to

```
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 247 µs
```

> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?


I do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.

> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.


Yes.



---

archive/issue_comments_318104.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [vdelecroix](#comment%3A7):\n> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\n> \n> Yes.\n\n\nActually, no. Because it is **not** a rich comparison but just comparison.",
    "created_at": "2015-05-03T09:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318104",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Replying to [vdelecroix](#comment%3A7):
> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

> 
> Yes.


Actually, no. Because it is **not** a rich comparison but just comparison.



---

archive/issue_comments_318105.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [vdelecroix](#comment%3A7):\n> Me neither (and there is actually one in `sage.rings.integer` that is not from me).\n\n\nYes, I saw that.\n\n> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\n\nI have no idea.\n\n> > Did you check if there is a measurable performance benefit?\n\n> \n> It is minor but timings are in the ticket description.\n\n\nNo, I mean specifically for using a global temporary variable instead of creating a new one each time.",
    "created_at": "2015-05-03T09:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318105",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>Replying to [vdelecroix](#comment%3A7):
> Me neither (and there is actually one in `sage.rings.integer` that is not from me).


Yes, I saw that.

> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?


I have no idea.

> > Did you check if there is a measurable performance benefit?

> 
> It is minor but timings are in the ticket description.


No, I mean specifically for using a global temporary variable instead of creating a new one each time.



---

archive/issue_comments_318106.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [vdelecroix](#comment%3A8):\n> Replying to [vdelecroix](#comment%3A7):\n> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\n> > \n> > Yes.\n\n> \n> Actually, no. Because it is **not** a rich comparison but just comparison.\n\n\nRight, sorry.",
    "created_at": "2015-05-03T09:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318106",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:10'></a>Replying to [vdelecroix](#comment%3A8):
> Replying to [vdelecroix](#comment%3A7):
> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

> > 
> > Yes.

> 
> Actually, no. Because it is **not** a rich comparison but just comparison.


Right, sorry.



---

archive/issue_comments_318107.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-03T09:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318107",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318108.json:
```json
{
    "body": "<a id='comment:11'></a>With \n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\n```\n\ndeclaring global `mpz_tmp` and `mpq_tmp` I got\n\n```\ntimeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 131 \u00b5s per loop\n```\nand with local ones\n\n```\nsage: timeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 177 \u00b5s per loop\n```\n\nNote that this bad scenario only occurs for comparisons of:\n- Python long with Sage Integer\n- Sage Rationals with Sage Integer, Python int, Python long\n\nThere is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).\n\nI will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.\n\nVincent",
    "created_at": "2015-05-03T09:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318108",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>With 

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
```

declaring global `mpz_tmp` and `mpq_tmp` I got

```
timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 131 µs per loop
```
and with local ones

```
sage: timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 177 µs per loop
```

Note that this bad scenario only occurs for comparisons of:
- Python long with Sage Integer
- Sage Rationals with Sage Integer, Python int, Python long

There is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).

I will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.

Vincent



---

archive/issue_comments_318109.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,16 +12,6 @@\n 500000 loops, best of 100: 416 ns per loop\n ```\n \n-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got\n+Upstream mpir pull request for the `mpq_cmp_mpz` function:\n \n-```\n-sage: a = 1; b = 18\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 62.2 ns per loop\n-sage: a = QQ(1); b = QQ(18)\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 65.3 ns per loop\n-sage: a = 1; b = QQ(18)\n-sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 82.8 ns per loop\n-```\n+    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n``````\n",
    "created_at": "2015-08-14T16:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318109",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,16 +12,6 @@
 500000 loops, best of 100: 416 ns per loop
 ```
 
-With the branch applied all comparisons involving only Sage integers, Sage rationals and Python int/long are about the same time. With the branch applied, I got
+Upstream mpir pull request for the `mpq_cmp_mpz` function:
 
-```
-sage: a = 1; b = 18
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 62.2 ns per loop
-sage: a = QQ(1); b = QQ(18)
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 65.3 ns per loop
-sage: a = 1; b = QQ(18)
-sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 82.8 ns per loop
-```
+    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
``````




---

archive/issue_events_051636.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-08-14T16:27:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18304#event-51636"
}
```



---

archive/issue_comments_318110.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-14T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318111.json:
```json
{
    "body": "Changing commit from \"554c4358bc0e470ec0c72c2a24251f4a6978a12e\" to \"e03a26e63dd50f79fc7ada885daefd8c9970c482\"",
    "created_at": "2015-08-14T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "554c4358bc0e470ec0c72c2a24251f4a6978a12e" to "e03a26e63dd50f79fc7ada885daefd8c9970c482"



---

archive/issue_comments_318112.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,12 +6,28 @@\n 500000 loops, best of 100: 64.3 ns per loop\n sage: a = QQ(1); b = QQ(18)\n sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 88.4 ns per loop\n+500000 loops, best of 100: 84 ns per loop\n sage: a = 1; b = QQ(18)\n sage: timeit(\"a < b\", number=500000, repeat=100)\n-500000 loops, best of 100: 416 ns per loop\n+500000 loops, best of 100: 405 ns per loop\n+```\n+\n+With the branch applied, it gets better\n+\n+```\n+sage: a = 1; b = 18\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 64 ns per loop\n+sage: a = QQ(1); b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 65.6 ns per loop\n+sage: a = 1; b = QQ(18)\n+sage: timeit(\"a < b\", number=500000, repeat=100)\n+500000 loops, best of 100: 87.1 ns per loop\n ```\n \n Upstream mpir pull request for the `mpq_cmp_mpz` function:\n \n     [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n+\n+Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!\n``````\n",
    "created_at": "2015-08-14T17:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318112",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,12 +6,28 @@
 500000 loops, best of 100: 64.3 ns per loop
 sage: a = QQ(1); b = QQ(18)
 sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 88.4 ns per loop
+500000 loops, best of 100: 84 ns per loop
 sage: a = 1; b = QQ(18)
 sage: timeit("a < b", number=500000, repeat=100)
-500000 loops, best of 100: 416 ns per loop
+500000 loops, best of 100: 405 ns per loop
+```
+
+With the branch applied, it gets better
+
+```
+sage: a = 1; b = 18
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 64 ns per loop
+sage: a = QQ(1); b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 65.6 ns per loop
+sage: a = 1; b = QQ(18)
+sage: timeit("a < b", number=500000, repeat=100)
+500000 loops, best of 100: 87.1 ns per loop
 ```
 
 Upstream mpir pull request for the `mpq_cmp_mpz` function:
 
     [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
+
+Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!
``````




---

archive/issue_comments_318113.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-14T17:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318113",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318114.json:
```json
{
    "body": "<a id='comment:15'></a>Hi Vincent,\n\nDo you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?",
    "created_at": "2015-08-18T14:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318114",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:15'></a>Hi Vincent,

Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?



---

archive/issue_comments_318115.json:
```json
{
    "body": "<a id='comment:16'></a>Hi Marc,\n\nThanks for having a look.\n\nReplying to [mmezzarobba](#comment%3A15):\n> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?\n\n\nLast news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.\n\nYou are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.",
    "created_at": "2015-08-18T15:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318115",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>Hi Marc,

Thanks for having a look.

Replying to [mmezzarobba](#comment%3A15):
> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?


Last news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.

You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.



---

archive/issue_comments_318116.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [vdelecroix](#comment%3A16):\n> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n\n\nI'd wait.",
    "created_at": "2015-08-18T15:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318116",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:17'></a>Replying to [vdelecroix](#comment%3A16):
> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.


I'd wait.



---

archive/issue_comments_318117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.\n+\n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n ```\n``````\n",
    "created_at": "2015-08-18T15:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318117",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.
+
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
 ```
``````




---

archive/issue_comments_318118.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [mmezzarobba](#comment%3A17):\n> Replying to [vdelecroix](#comment%3A16):\n> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n\n> \n> I'd wait.\n\n\nLooks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.",
    "created_at": "2015-08-18T15:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318118",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [mmezzarobba](#comment%3A17):
> Replying to [vdelecroix](#comment%3A16):
> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.

> 
> I'd wait.


Looks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.



---

archive/issue_comments_318119.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-18T15:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318119",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_051637.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-03T18:12:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18304#event-51637"
}
```



---

archive/issue_events_051638.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-03T18:12:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18304#event-51638"
}
```



---

archive/issue_comments_318120.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#22493\"",
    "created_at": "2017-05-03T18:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318120",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "" to "#22493"



---

archive/issue_comments_318121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.\n+MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n \n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n@@ -27,9 +27,3 @@\n sage: timeit(\"a < b\", number=500000, repeat=100)\n 500000 loops, best of 100: 87.1 ns per loop\n ```\n-\n-Upstream mpir pull request for the `mpq_cmp_mpz` function:\n-\n-    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)\n-\n-Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!\n``````\n",
    "created_at": "2017-05-03T18:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318121",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-DISCLAIMER: this ticket is waiting from two upstream modifications (GMP and mpir). Namely the creation of the function `mpq_cmp_z(mpq_t, mpz_t)`.
+MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
 
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
@@ -27,9 +27,3 @@
 sage: timeit("a < b", number=500000, repeat=100)
 500000 loops, best of 100: 87.1 ns per loop
 ```
-
-Upstream mpir pull request for the `mpq_cmp_mpz` function:
-
-    [https://github.com/wbhart/mpir/pull/157](https://github.com/wbhart/mpir/pull/157)
-
-Warning: if you pull the branch and run `make` then you will likely rebuild your whole Sage!
``````




---

archive/issue_comments_318122.json:
```json
{
    "body": "Changing commit from \"e03a26e63dd50f79fc7ada885daefd8c9970c482\" to \"81b637b30a06e19504eda1898f3e3ad57b0bc803\"",
    "created_at": "2017-05-04T06:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e03a26e63dd50f79fc7ada885daefd8c9970c482" to "81b637b30a06e19504eda1898f3e3ad57b0bc803"



---

archive/issue_comments_318123.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-04T06:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318124.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-04T06:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318124",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318125.json:
```json
{
    "body": "<a id='comment:22'></a>does not apply",
    "created_at": "2017-05-31T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318125",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>does not apply



---

archive/issue_comments_318126.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-31T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318126",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318127.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-05-31T07:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_318128.json:
```json
{
    "body": "Changing commit from \"81b637b30a06e19504eda1898f3e3ad57b0bc803\" to \"e2b72301cda6c9b36a8b128a5cceeac12a11e163\"",
    "created_at": "2017-05-31T07:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81b637b30a06e19504eda1898f3e3ad57b0bc803" to "e2b72301cda6c9b36a8b128a5cceeac12a11e163"



---

archive/issue_comments_318129.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-31T07:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318129",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318130.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-03T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318131.json:
```json
{
    "body": "Changing commit from \"e2b72301cda6c9b36a8b128a5cceeac12a11e163\" to \"575d85593a6965ac5d3b7c008d8dce474eb572e2\"",
    "created_at": "2017-06-03T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e2b72301cda6c9b36a8b128a5cceeac12a11e163" to "575d85593a6965ac5d3b7c008d8dce474eb572e2"



---

archive/issue_comments_318132.json:
```json
{
    "body": "Changing dependencies from \"#22493\" to \"\"",
    "created_at": "2017-06-03T16:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318132",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "#22493" to ""



---

archive/issue_comments_318133.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n+MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.\n \n Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n \n``````\n",
    "created_at": "2017-06-03T16:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318133",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-MPIR 3.0.0 will be shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
+MPIR 3.0.0 is shipped with the function `mpq_cmp_z(mpq_t, mpz_t)`. We can use it to make integer/rational comparisons much faster.
 
 Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:
 
``````




---

archive/issue_comments_318134.json:
```json
{
    "body": "<a id='comment:28'></a>Overall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:\n\n```diff\n-if not isinstance(left, Rational):\n-   raise RuntimeError('this should not happen')\n+assert isinstance(left, Rational)\n```",
    "created_at": "2017-06-03T22:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318134",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>Overall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:

```diff
-if not isinstance(left, Rational):
-   raise RuntimeError('this should not happen')
+assert isinstance(left, Rational)
```



---

archive/issue_comments_318135.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-12T15:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318136.json:
```json
{
    "body": "Changing commit from \"575d85593a6965ac5d3b7c008d8dce474eb572e2\" to \"8c60c6ad58e14315213ed055a05383550408ab8f\"",
    "created_at": "2017-06-12T15:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "575d85593a6965ac5d3b7c008d8dce474eb572e2" to "8c60c6ad58e14315213ed055a05383550408ab8f"



---

archive/issue_comments_318137.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-12T16:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318138.json:
```json
{
    "body": "Changing commit from \"8c60c6ad58e14315213ed055a05383550408ab8f\" to \"6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc\"",
    "created_at": "2017-06-12T16:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c60c6ad58e14315213ed055a05383550408ab8f" to "6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc"



---

archive/issue_comments_318139.json:
```json
{
    "body": "<a id='comment:31'></a>rebased on 8.0.beta10 (and incorported your [comment:28](#comment%3A28))",
    "created_at": "2017-06-12T16:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318139",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>rebased on 8.0.beta10 (and incorported your [comment:28](#comment%3A28))



---

archive/issue_comments_318140.json:
```json
{
    "body": "<a id='comment:32'></a>Thanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:\n\nhttps://eev.ee/blog/2012/03/24/python-faq-equality/\n\nI do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.",
    "created_at": "2017-06-12T23:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318140",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>Thanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:

https://eev.ee/blog/2012/03/24/python-faq-equality/

I do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.



---

archive/issue_comments_318141.json:
```json
{
    "body": "<a id='comment:33'></a>does not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)",
    "created_at": "2017-06-16T06:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318141",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>does not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)



---

archive/issue_comments_318142.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-16T06:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318142",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318143.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-16T07:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318144.json:
```json
{
    "body": "Changing commit from \"6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc\" to \"e72c82de36e6838f1064eccf08382b232521ed0d\"",
    "created_at": "2017-06-16T07:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6294a5fdc0fdc9d4c977afe1b8c100af06ca9ffc" to "e72c82de36e6838f1064eccf08382b232521ed0d"



---

archive/issue_comments_318145.json:
```json
{
    "body": "<a id='comment:35'></a>Indeed. I rebased on 8.0.beta11.",
    "created_at": "2017-06-16T07:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318145",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>Indeed. I rebased on 8.0.beta11.



---

archive/issue_comments_318146.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-16T07:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318146",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318147.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Marc Mezzarobba, Travis Scrimshaw\"",
    "created_at": "2017-06-16T15:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318147",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Marc Mezzarobba, Travis Scrimshaw"



---

archive/issue_comments_318148.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-16T15:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318148",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318149.json:
```json
{
    "body": "<a id='comment:36'></a>Hmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.",
    "created_at": "2017-06-16T15:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318149",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>Hmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.



---

archive/issue_comments_318150.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/18304\" to \"e72c82de36e6838f1064eccf08382b232521ed0d\"",
    "created_at": "2017-06-17T10:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318150",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vdelecroix/18304" to "e72c82de36e6838f1064eccf08382b232521ed0d"



---

archive/issue_comments_318151.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-17T10:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18304#issuecomment-318151",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051639.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-17T10:29:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18304",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18304#event-51639"
}
```
