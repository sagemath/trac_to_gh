# Issue 17124: Poset: Add ordinal_product

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2014-11-18 09:37:09

CC:  ncohen

Add the ordinal product function of posets. See Enumerative combinatorics, p. 284.


---

Comment by chapoton created at 2014-11-23 07:46:02

Could you please recall the definition here ?


---

Comment by chapoton created at 2014-11-23 07:46:02

Changing keywords from "" to "poset".


---

Comment by chapoton created at 2014-11-24 15:20:18

Here is a first proposal, that still needs some polishing.
----
New commits:


---

Comment by git created at 2014-11-24 15:24:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2014-11-24 17:14:40

On #17129 I was told that strings for `ValueError` should be incomplete sentences.

After #17053 it seems logical to have `pairs` as a default value, not `integers`.

If I am not mistaken, ordinal product of lattices is a lattice; compare to for example #17142.

I have been told that all input should be documented, i.e. also `other`.


---

Comment by git created at 2014-11-24 19:47:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2014-11-24 19:54:46

When making `SEEALSO`-part it is good to also add reference of new function to old ones. I guess that most seealso-references should be bidirectional.

Sorry for forgotting to say this in first message.


---

Comment by git created at 2014-11-24 20:18:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2014-11-25 07:43:34

Aarghs, we already have the function! It is `lexicographic_product` on graphs, and I guess it must just be mapped to function of poset. (Like `minimal_elements` on poset is actually `sources` on digraphs.)


---

Comment by jmantysalo created at 2014-11-25 07:56:04

I cc Nathann to this, because he knows digraphs. I tested with product of `BooleanLattice(5)` with itself. It took 14 seconds with code of this ticket, whereas `lexicographic_product` took 18 seconds. This is interesting. Nathann has just corrected a slowdown on generating digraph from dict, maybe this is related?


---

Comment by ncohen created at 2014-11-25 08:54:25

Hello !

Well, first for the poset thing you can be MUCH more efficient. In `Poset.ordinal_sum` you add only edges between the top elements of one and the bottom elements of the other. Why don't you do that here too ?

(please, cache the top/bottom elements of each poset).

Also, `for s in self for s2 in self.lower_covers(s)` should probably be `for s,s in cover_relations_iterator`.

For the graph code, it could be improved by replacing the calls to `add_edge` by one call to `add_edges`. The difference is that `add_edge` supports many kind of inputs (a pair, or two points, or three points) and that `add_edge` checks it at every call (while `add_edges` does it once).

Nathann


---

Comment by git created at 2014-11-25 20:49:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-11-25 21:13:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-11-26 02:53:57

(you can also use the min_elements/max_elements trick on the add_edge call which contains `for t in other for t2 in other`. That is where it will save the most)


---

Comment by git created at 2014-11-26 16:11:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-11-26 19:36:16

Hello !

Well, this patch looks good to me, and all tests pass. Jory: I tested the product of two `BooleanLattice(5)` and it takes 2.5 seconds. It is still a lot, but better than 17s `:-/`


```
sage: %timeit p.ordinal_product(p)
1 loops, best of 3: 2.46 s per loop
```


I do not understand much what the profiling says, though. It seems that 1.3s is used by the 'has_edge' function (Why ???? `O_o`)

The code of `transitive_reduction` can be rewritten more efficiently, though. Actually, this is a very important point since this function is called every time a poset is created, to build its hasse diagram.

Sorry guys, but I have to give up for tonight. 1am, and I will need my brain tomorrow again. Good night, and thanks for the patch !

Nathann


---

Comment by ncohen created at 2014-11-26 19:36:24

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-11-26 19:36:30

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2014-11-26 19:57:56

Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Frédéric!

I think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.


---

Comment by ncohen created at 2014-11-26 20:04:51

Yooooooo !

> Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Frédéric!

Right right, all the commits are his !

By the way, Jakob Kröker just sent me an email about Posets and I told him that you had a half-plan of adding some doc there.

God, I should be sleeping `T_T` 

> I think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.

I don't know. Graphs+vertex labels mean dictionary somewhere, so I do not trust anything `^^;`

Nathann


---

Comment by jmantysalo created at 2014-11-27 06:44:58

Changing status from positive_review to needs_work.


---

Comment by jmantysalo created at 2014-11-27 06:44:58

Still one thing: Could this return a lattice instead of only poset when both `this` and `other` are lattices?

If not, that is OK: in that case, just mark this back to positive_review again.


---

Comment by git created at 2014-11-27 19:19:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-11-27 19:21:53

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2014-11-27 19:48:06

`Poset({0:[1,2]})` is a meet semilattice, but it's ordinal product with itself is not a meet semilattice. (resp. for join semilattice). Hence we have only two options: both arguments are lattices and so is return type also lattice, or else return type is "only" poset.


---

Comment by jmantysalo created at 2014-11-27 19:48:06

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-11-27 19:52:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-11-27 21:13:35

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2014-11-27 21:19:39

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2014-11-27 21:19:39

Looks good. I tested for example empty poset, one-element poset and products of chain and antichain.


---

Comment by vbraun created at 2014-11-28 17:51:58

Resolution: fixed
