# Issue 17124: Poset: Add ordinal_product

archive/issues_017124.json:
```json
{
    "body": "CC:  @nathanncohen\n\nAdd the ordinal product function of posets. See Enumerative combinatorics, p. 284.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17361\n\n",
    "created_at": "2014-11-18T09:37:09Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Poset: Add ordinal_product",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17124",
    "user": "@jm58660"
}
```
CC:  @nathanncohen

Add the ordinal product function of posets. See Enumerative combinatorics, p. 284.

Issue created by migration from https://trac.sagemath.org/ticket/17361





---

archive/issue_comments_227628.json:
```json
{
    "body": "Could you please recall the definition here ?",
    "created_at": "2014-11-23T07:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227628",
    "user": "@fchapoton"
}
```

Could you please recall the definition here ?



---

archive/issue_comments_227629.json:
```json
{
    "body": "Changing keywords from \"\" to \"poset\".",
    "created_at": "2014-11-23T07:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227629",
    "user": "@fchapoton"
}
```

Changing keywords from "" to "poset".



---

archive/issue_comments_227630.json:
```json
{
    "body": "Here is a first proposal, that still needs some polishing.\n----\nNew commits:",
    "created_at": "2014-11-24T15:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227630",
    "user": "@fchapoton"
}
```

Here is a first proposal, that still needs some polishing.
----
New commits:



---

archive/issue_comments_227631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-24T15:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227631",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227632.json:
```json
{
    "body": "On #17129 I was told that strings for `ValueError` should be incomplete sentences.\n\nAfter #17053 it seems logical to have `pairs` as a default value, not `integers`.\n\nIf I am not mistaken, ordinal product of lattices is a lattice; compare to for example #17142.\n\nI have been told that all input should be documented, i.e. also `other`.",
    "created_at": "2014-11-24T17:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227632",
    "user": "@jm58660"
}
```

On #17129 I was told that strings for `ValueError` should be incomplete sentences.

After #17053 it seems logical to have `pairs` as a default value, not `integers`.

If I am not mistaken, ordinal product of lattices is a lattice; compare to for example #17142.

I have been told that all input should be documented, i.e. also `other`.



---

archive/issue_comments_227633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-24T19:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227633",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227634.json:
```json
{
    "body": "When making `SEEALSO`-part it is good to also add reference of new function to old ones. I guess that most seealso-references should be bidirectional.\n\nSorry for forgotting to say this in first message.",
    "created_at": "2014-11-24T19:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227634",
    "user": "@jm58660"
}
```

When making `SEEALSO`-part it is good to also add reference of new function to old ones. I guess that most seealso-references should be bidirectional.

Sorry for forgotting to say this in first message.



---

archive/issue_comments_227635.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-24T20:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227635",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227636.json:
```json
{
    "body": "Aarghs, we already have the function! It is `lexicographic_product` on graphs, and I guess it must just be mapped to function of poset. (Like `minimal_elements` on poset is actually `sources` on digraphs.)",
    "created_at": "2014-11-25T07:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227636",
    "user": "@jm58660"
}
```

Aarghs, we already have the function! It is `lexicographic_product` on graphs, and I guess it must just be mapped to function of poset. (Like `minimal_elements` on poset is actually `sources` on digraphs.)



---

archive/issue_comments_227637.json:
```json
{
    "body": "I cc Nathann to this, because he knows digraphs. I tested with product of `BooleanLattice(5)` with itself. It took 14 seconds with code of this ticket, whereas `lexicographic_product` took 18 seconds. This is interesting. Nathann has just corrected a slowdown on generating digraph from dict, maybe this is related?",
    "created_at": "2014-11-25T07:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227637",
    "user": "@jm58660"
}
```

I cc Nathann to this, because he knows digraphs. I tested with product of `BooleanLattice(5)` with itself. It took 14 seconds with code of this ticket, whereas `lexicographic_product` took 18 seconds. This is interesting. Nathann has just corrected a slowdown on generating digraph from dict, maybe this is related?



---

archive/issue_comments_227638.json:
```json
{
    "body": "Hello !\n\nWell, first for the poset thing you can be MUCH more efficient. In `Poset.ordinal_sum` you add only edges between the top elements of one and the bottom elements of the other. Why don't you do that here too ?\n\n(please, cache the top/bottom elements of each poset).\n\nAlso, `for s in self for s2 in self.lower_covers(s)` should probably be `for s,s in cover_relations_iterator`.\n\nFor the graph code, it could be improved by replacing the calls to `add_edge` by one call to `add_edges`. The difference is that `add_edge` supports many kind of inputs (a pair, or two points, or three points) and that `add_edge` checks it at every call (while `add_edges` does it once).\n\nNathann",
    "created_at": "2014-11-25T08:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227638",
    "user": "@nathanncohen"
}
```

Hello !

Well, first for the poset thing you can be MUCH more efficient. In `Poset.ordinal_sum` you add only edges between the top elements of one and the bottom elements of the other. Why don't you do that here too ?

(please, cache the top/bottom elements of each poset).

Also, `for s in self for s2 in self.lower_covers(s)` should probably be `for s,s in cover_relations_iterator`.

For the graph code, it could be improved by replacing the calls to `add_edge` by one call to `add_edges`. The difference is that `add_edge` supports many kind of inputs (a pair, or two points, or three points) and that `add_edge` checks it at every call (while `add_edges` does it once).

Nathann



---

archive/issue_comments_227639.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-25T20:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227639",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-25T21:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227640",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227641.json:
```json
{
    "body": "(you can also use the min_elements/max_elements trick on the add_edge call which contains `for t in other for t2 in other`. That is where it will save the most)",
    "created_at": "2014-11-26T02:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227641",
    "user": "@nathanncohen"
}
```

(you can also use the min_elements/max_elements trick on the add_edge call which contains `for t in other for t2 in other`. That is where it will save the most)



---

archive/issue_comments_227642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-26T16:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227643.json:
```json
{
    "body": "Hello !\n\nWell, this patch looks good to me, and all tests pass. Jory: I tested the product of two `BooleanLattice(5)` and it takes 2.5 seconds. It is still a lot, but better than 17s `:-/`\n\n\n```\nsage: %timeit p.ordinal_product(p)\n1 loops, best of 3: 2.46 s per loop\n```\n\n\nI do not understand much what the profiling says, though. It seems that 1.3s is used by the 'has_edge' function (Why ???? `O_o`)\n\nThe code of `transitive_reduction` can be rewritten more efficiently, though. Actually, this is a very important point since this function is called every time a poset is created, to build its hasse diagram.\n\nSorry guys, but I have to give up for tonight. 1am, and I will need my brain tomorrow again. Good night, and thanks for the patch !\n\nNathann",
    "created_at": "2014-11-26T19:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227643",
    "user": "@nathanncohen"
}
```

Hello !

Well, this patch looks good to me, and all tests pass. Jory: I tested the product of two `BooleanLattice(5)` and it takes 2.5 seconds. It is still a lot, but better than 17s `:-/`


```
sage: %timeit p.ordinal_product(p)
1 loops, best of 3: 2.46 s per loop
```


I do not understand much what the profiling says, though. It seems that 1.3s is used by the 'has_edge' function (Why ???? `O_o`)

The code of `transitive_reduction` can be rewritten more efficiently, though. Actually, this is a very important point since this function is called every time a poset is created, to build its hasse diagram.

Sorry guys, but I have to give up for tonight. 1am, and I will need my brain tomorrow again. Good night, and thanks for the patch !

Nathann



---

archive/issue_comments_227644.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-26T19:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227644",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227645.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-26T19:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227645",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227646.json:
```json
{
    "body": "Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Fr\u00e9d\u00e9ric!\n\nI think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.",
    "created_at": "2014-11-26T19:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227646",
    "user": "@jm58660"
}
```

Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Frédéric!

I think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.



---

archive/issue_comments_227647.json:
```json
{
    "body": "Yooooooo !\n\n> Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Fr\u00e9d\u00e9ric!\n\nRight right, all the commits are his !\n\nBy the way, Jakob Kr\u00f6ker just sent me an email about Posets and I told him that you had a half-plan of adding some doc there.\n\nGod, I should be sleeping `T_T` \n\n> I think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.\n\nI don't know. Graphs+vertex labels mean dictionary somewhere, so I do not trust anything `^^;`\n\nNathann",
    "created_at": "2014-11-26T20:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227647",
    "user": "@nathanncohen"
}
```

Yooooooo !

> Code seems to be clear. Just to clarify to Nathann: I reported this one, but have not written any of the code. So thanks goes to Frédéric!

Right right, all the commits are his !

By the way, Jakob Kröker just sent me an email about Posets and I told him that you had a half-plan of adding some doc there.

God, I should be sleeping `T_T` 

> I think that there is no need to have `sorted` on examples. They are kind of automatically sorted, when are all same type. But this is of course a minor thing.

I don't know. Graphs+vertex labels mean dictionary somewhere, so I do not trust anything `^^;`

Nathann



---

archive/issue_comments_227648.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-27T06:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227648",
    "user": "@jm58660"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_227649.json:
```json
{
    "body": "Still one thing: Could this return a lattice instead of only poset when both `this` and `other` are lattices?\n\nIf not, that is OK: in that case, just mark this back to positive_review again.",
    "created_at": "2014-11-27T06:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227649",
    "user": "@jm58660"
}
```

Still one thing: Could this return a lattice instead of only poset when both `this` and `other` are lattices?

If not, that is OK: in that case, just mark this back to positive_review again.



---

archive/issue_comments_227650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-27T19:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227651.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-27T19:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227651",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227652.json:
```json
{
    "body": "`Poset({0:[1,2]})` is a meet semilattice, but it's ordinal product with itself is not a meet semilattice. (resp. for join semilattice). Hence we have only two options: both arguments are lattices and so is return type also lattice, or else return type is \"only\" poset.",
    "created_at": "2014-11-27T19:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227652",
    "user": "@jm58660"
}
```

`Poset({0:[1,2]})` is a meet semilattice, but it's ordinal product with itself is not a meet semilattice. (resp. for join semilattice). Hence we have only two options: both arguments are lattices and so is return type also lattice, or else return type is "only" poset.



---

archive/issue_comments_227653.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-27T19:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227653",
    "user": "@jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-27T19:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227654",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227655.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-27T21:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227655",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227656.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-27T21:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227656",
    "user": "@jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227657.json:
```json
{
    "body": "Looks good. I tested for example empty poset, one-element poset and products of chain and antichain.",
    "created_at": "2014-11-27T21:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227657",
    "user": "@jm58660"
}
```

Looks good. I tested for example empty poset, one-element poset and products of chain and antichain.



---

archive/issue_comments_227658.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-28T17:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17124#issuecomment-227658",
    "user": "@vbraun"
}
```

Resolution: fixed
