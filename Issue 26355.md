# Issue 26355: internet doctest failing in combinat/designs [SSL: UNKNOWN_PROTOCOL]

archive/issues_026355.json:
```json
{
    "body": "CC:  dgordon @seblabbe @slel @vinklein zerline\n\nWith 8.5.beta1, the command\n\n```\nsage -t --long --optional=sage,internet src/sage/combinat/designs/design_catalog.py src/sage/combinat/designs/covering_design.py\n```\n\n\ngives:\n\n\n```\nDoctesting 2 files.\nsage -t --long src/sage/combinat/designs/design_catalog.py\n**********************************************************************\nFile \"src/sage/combinat/designs/design_catalog.py\", line 22, in sage.combinat.designs.design_catalog\nFailed example:\n    C = designs.best_known_covering_design_from_LJCR(7, 3, 2)   # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.design_catalog[1]>\", line 1, in <module>\n        C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))   # optional - internet\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py\", line 503, in best_known_covering_design_www\n        f = urlopen(url)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 154, in urlopen\n        return opener.open(url, data, timeout)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 429, in open\n        response = self._open(req, data)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 447, in _open\n        '_open', req)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 407, in _call_chain\n        result = func(*args)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 1241, in https_open\n        context=self._context)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 1198, in do_open\n        raise URLError(err)\n    URLError: <urlopen error [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:726)>\n**********************************************************************\nFile \"src/sage/combinat/designs/design_catalog.py\", line 23, in sage.combinat.designs.design_catalog\nFailed example:\n    C                            # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.design_catalog[2]>\", line 1, in <module>\n        C                            # optional - internet\n    NameError: name 'C' is not defined\n**********************************************************************\nFile \"src/sage/combinat/designs/design_catalog.py\", line 28, in sage.combinat.designs.design_catalog\nFailed example:\n    C.incidence_structure()      # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.design_catalog[3]>\", line 1, in <module>\n        C.incidence_structure()      # optional - internet\n    NameError: name 'C' is not defined\n**********************************************************************\n1 item had failures:\n   3 of   5 in sage.combinat.designs.design_catalog\n    [4 tests, 3 failures, 0.34 s]\nsage -t --long src/sage/combinat/designs/covering_design.py\n**********************************************************************\nFile \"src/sage/combinat/designs/covering_design.py\", line 473, in sage.combinat.designs.covering_design.best_known_covering_design_www\nFailed example:\n    C = best_known_covering_design_www(7, 3, 2)   # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[1]>\", line 1, in <module>\n        C = best_known_covering_design_www(Integer(7), Integer(3), Integer(2))   # optional - internet\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py\", line 503, in best_known_covering_design_www\n        f = urlopen(url)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 154, in urlopen\n        return opener.open(url, data, timeout)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 429, in open\n        response = self._open(req, data)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 447, in _open\n        '_open', req)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 407, in _call_chain\n        result = func(*args)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 1241, in https_open\n        context=self._context)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 1198, in do_open\n        raise URLError(err)\n    URLError: <urlopen error [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:726)>\n**********************************************************************\nFile \"src/sage/combinat/designs/covering_design.py\", line 474, in sage.combinat.designs.covering_design.best_known_covering_design_www\nFailed example:\n    print(C)                                     # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[2]>\", line 1, in <module>\n        print(C)                                     # optional - internet\n    NameError: name 'C' is not defined\n**********************************************************************\n1 item had failures:\n   2 of   4 in sage.combinat.designs.covering_design.best_known_covering_design_www\n    [49 tests, 2 failures, 0.37 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/combinat/designs/design_catalog.py  # 3 doctests failed\nsage -t --long src/sage/combinat/designs/covering_design.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.7 seconds\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26592\n\n",
    "created_at": "2018-10-29T15:43:47Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "internet doctest failing in combinat/designs [SSL: UNKNOWN_PROTOCOL]",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26355",
    "user": "https://github.com/seblabbe"
}
```
CC:  dgordon @seblabbe @slel @vinklein zerline

With 8.5.beta1, the command

```
sage -t --long --optional=sage,internet src/sage/combinat/designs/design_catalog.py src/sage/combinat/designs/covering_design.py
```


gives:


```
Doctesting 2 files.
sage -t --long src/sage/combinat/designs/design_catalog.py
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 22, in sage.combinat.designs.design_catalog
Failed example:
    C = designs.best_known_covering_design_from_LJCR(7, 3, 2)   # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[1]>", line 1, in <module>
        C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))   # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py", line 503, in best_known_covering_design_www
        f = urlopen(url)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 429, in open
        response = self._open(req, data)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 447, in _open
        '_open', req)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1241, in https_open
        context=self._context)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1198, in do_open
        raise URLError(err)
    URLError: <urlopen error [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:726)>
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 23, in sage.combinat.designs.design_catalog
Failed example:
    C                            # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[2]>", line 1, in <module>
        C                            # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 28, in sage.combinat.designs.design_catalog
Failed example:
    C.incidence_structure()      # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.design_catalog[3]>", line 1, in <module>
        C.incidence_structure()      # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   3 of   5 in sage.combinat.designs.design_catalog
    [4 tests, 3 failures, 0.34 s]
sage -t --long src/sage/combinat/designs/covering_design.py
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 473, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    C = best_known_covering_design_www(7, 3, 2)   # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[1]>", line 1, in <module>
        C = best_known_covering_design_www(Integer(7), Integer(3), Integer(2))   # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.py", line 503, in best_known_covering_design_www
        f = urlopen(url)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 429, in open
        response = self._open(req, data)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 447, in _open
        '_open', req)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1241, in https_open
        context=self._context)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 1198, in do_open
        raise URLError(err)
    URLError: <urlopen error [SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:726)>
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 474, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    print(C)                                     # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[2]>", line 1, in <module>
        print(C)                                     # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   2 of   4 in sage.combinat.designs.covering_design.best_known_covering_design_www
    [49 tests, 2 failures, 0.37 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/designs/design_catalog.py  # 3 doctests failed
sage -t --long src/sage/combinat/designs/covering_design.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.7 seconds
```


Issue created by migration from https://trac.sagemath.org/ticket/26592





---

archive/issue_comments_370690.json:
```json
{
    "body": "The whole https://math.ccrwest.org was down for a few days. It's back up now.",
    "created_at": "2018-10-31T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370690",
    "user": "https://github.com/slel"
}
```

The whole https://math.ccrwest.org was down for a few days. It's back up now.



---

archive/issue_comments_370691.json:
```json
{
    "body": "This needs some Python 3 love now though.\n\nHere's what I get with a Python3-based Sage:\n\n\n```\nsage: print(version())\nSageMath version 8.5.beta1, Release Date: 2018-10-27\nsage: print(sys.version)\n3.6.6 (default, Oct 27 2018, 01:34:38)\n[GCC 4.2.1 Compatible Apple LLVM 7.0.2 (clang-700.1.81)]\nsage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-a3d9f9e592f1> in <module>()\n----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))\n\n/opt/s/sage/local/lib/python3.6/site-packages/sage/combinat/designs/covering_design.py in best_known_covering_design_www(v, k, t, verbose)\n    505     f.close()\n    506\n--> 507     if 'covering not in database' in s:   #not found\n    508         str = \"no (%d,%d,%d) covering design in database\\n\"%(v,k,t)\n    509         raise ValueError(str)\n\nTypeError: a bytes-like object is required, not 'str'\n```\n",
    "created_at": "2018-10-31T15:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370691",
    "user": "https://github.com/slel"
}
```

This needs some Python 3 love now though.

Here's what I get with a Python3-based Sage:


```
sage: print(version())
SageMath version 8.5.beta1, Release Date: 2018-10-27
sage: print(sys.version)
3.6.6 (default, Oct 27 2018, 01:34:38)
[GCC 4.2.1 Compatible Apple LLVM 7.0.2 (clang-700.1.81)]
sage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-a3d9f9e592f1> in <module>()
----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))

/opt/s/sage/local/lib/python3.6/site-packages/sage/combinat/designs/covering_design.py in best_known_covering_design_www(v, k, t, verbose)
    505     f.close()
    506
--> 507     if 'covering not in database' in s:   #not found
    508         str = "no (%d,%d,%d) covering design in database\n"%(v,k,t)
    509         raise ValueError(str)

TypeError: a bytes-like object is required, not 'str'
```




---

archive/issue_comments_370692.json:
```json
{
    "body": "Feel free to repurpose the present ticket for that.",
    "created_at": "2018-10-31T15:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370692",
    "user": "https://github.com/slel"
}
```

Feel free to repurpose the present ticket for that.



---

archive/issue_comments_370693.json:
```json
{
    "body": "Changing component from doctest coverage to python3.",
    "created_at": "2018-11-20T08:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370693",
    "user": "https://github.com/seblabbe"
}
```

Changing component from doctest coverage to python3.



---

archive/issue_comments_370694.json:
```json
{
    "body": "Ok, I updated the goal of this ticket as suggested.",
    "created_at": "2018-11-20T08:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370694",
    "user": "https://github.com/seblabbe"
}
```

Ok, I updated the goal of this ticket as suggested.



---

archive/issue_comments_370695.json:
```json
{
    "body": "As suggested in #26502#comment:8, the url address apparently changed to:\n\n\u200bhttp://dmgordon.org/cover/\n\nSo we need to redo the changes that were made in #26502 in order to fix this issue.",
    "created_at": "2019-03-07T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370695",
    "user": "https://github.com/seblabbe"
}
```

As suggested in #26502#comment:8, the url address apparently changed to:

​http://dmgordon.org/cover/

So we need to redo the changes that were made in #26502 in order to fix this issue.



---

archive/issue_comments_370696.json:
```json
{
    "body": "The problem with dmgordon.org is that the server certificate chain is incomplete:\n\n\n```\nsage: from six.moves.urllib.request import urlopen\nsage: url = \"https://dmgordon.org/cover/\"\nsage: f = urlopen(url)\n---------------------------------------------------------------------------\nURLError                                  Traceback (most recent call last)\n<ipython-input-6-152a0d5393b6> in <module>()\n----> 1 f = urlopen(url)\n\n...\n\n/home/vklein/odk/sage/local/lib/python2.7/urllib2.pyc in do_open(self, http_class, req, **http_conn_args)\n   1196         except socket.error, err: # XXX what error?\n   1197             h.close()\n-> 1198             raise URLError(err)\n   1199         else:\n   1200             try:\n\nURLError: <urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:726)>\n```\n\n\nShould we find a way to ignore ssl verification or to contact dmgordon.org owner ?",
    "created_at": "2019-03-07T09:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370696",
    "user": "https://github.com/vinklein"
}
```

The problem with dmgordon.org is that the server certificate chain is incomplete:


```
sage: from six.moves.urllib.request import urlopen
sage: url = "https://dmgordon.org/cover/"
sage: f = urlopen(url)
---------------------------------------------------------------------------
URLError                                  Traceback (most recent call last)
<ipython-input-6-152a0d5393b6> in <module>()
----> 1 f = urlopen(url)

...

/home/vklein/odk/sage/local/lib/python2.7/urllib2.pyc in do_open(self, http_class, req, **http_conn_args)
   1196         except socket.error, err: # XXX what error?
   1197             h.close()
-> 1198             raise URLError(err)
   1199         else:
   1200             try:

URLError: <urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:726)>
```


Should we find a way to ignore ssl verification or to contact dmgordon.org owner ?



---

archive/issue_comments_370697.json:
```json
{
    "body": "I just emailed Dan Gordon to report the various issues we are trying to tackle here:\n\n- http vs https\n- `get_cover.php` seems gone from http://ljcr.dmgordon.org/cover/\n  (`show_cover.php` returns some html-formatted string)",
    "created_at": "2019-03-07T13:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370697",
    "user": "https://github.com/slel"
}
```

I just emailed Dan Gordon to report the various issues we are trying to tackle here:

- http vs https
- `get_cover.php` seems gone from http://ljcr.dmgordon.org/cover/
  (`show_cover.php` returns some html-formatted string)



---

archive/issue_comments_370698.json:
```json
{
    "body": "Thank you Samuel.\\\\\nFor the http vs https part, note that `urlopen(\"http://dmgordon.org/cover/get_cover.php\")` return the famous `HTTP Error 404: Not Found`.",
    "created_at": "2019-03-07T14:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370698",
    "user": "https://github.com/vinklein"
}
```

Thank you Samuel.\\
For the http vs https part, note that `urlopen("http://dmgordon.org/cover/get_cover.php")` return the famous `HTTP Error 404: Not Found`.



---

archive/issue_comments_370699.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2019-03-07T14:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370699",
    "user": "https://github.com/vinklein"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_370700.json:
```json
{
    "body": "My attempt so far is using:\n\n\n```diff\ndiff --git a/src/sage/combinat/designs/covering_design.py b/src/sage/combinat/designs/covering_design.py\nindex 87dda39064..23beebc2e8 100644\n--- a/src/sage/combinat/designs/covering_design.py\n+++ b/src/sage/combinat/designs/covering_design.py\n@@ -497,7 +497,7 @@ def best_known_covering_design_www(v, k, t, verbose=False):\n\n     param = (\"?v=%s&k=%s&t=%s\"%(v,k,t))\n\n-    url = \"https://math.ccrwest.org/cover/get_cover.php\"+param\n+    url = \"http://ljcr.dmgordon.org/cover/show_cover.php\" + param\n     if verbose:\n         print(\"Looking up the bounds at %s\" % url)\n     f = urlopen(url)\n```\n\n\nwhich returns html instead of plain text, but I guess we could easily de-html-ify it.",
    "created_at": "2019-03-07T14:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370700",
    "user": "https://github.com/slel"
}
```

My attempt so far is using:


```diff
diff --git a/src/sage/combinat/designs/covering_design.py b/src/sage/combinat/designs/covering_design.py
index 87dda39064..23beebc2e8 100644
--- a/src/sage/combinat/designs/covering_design.py
+++ b/src/sage/combinat/designs/covering_design.py
@@ -497,7 +497,7 @@ def best_known_covering_design_www(v, k, t, verbose=False):

     param = ("?v=%s&k=%s&t=%s"%(v,k,t))

-    url = "https://math.ccrwest.org/cover/get_cover.php"+param
+    url = "http://ljcr.dmgordon.org/cover/show_cover.php" + param
     if verbose:
         print("Looking up the bounds at %s" % url)
     f = urlopen(url)
```


which returns html instead of plain text, but I guess we could easily de-html-ify it.



---

archive/issue_comments_370701.json:
```json
{
    "body": "It's feasible but calling `get_cover.php` will be far cleaner.\\\\\nAnother concern for me is that without https, given that the current code call `sage_eval` on the result, this code look like an open door to inject any (sage) code you want on a sage user's computer.",
    "created_at": "2019-03-07T16:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370701",
    "user": "https://github.com/vinklein"
}
```

It's feasible but calling `get_cover.php` will be far cleaner.\\
Another concern for me is that without https, given that the current code call `sage_eval` on the result, this code look like an open door to inject any (sage) code you want on a sage user's computer.



---

archive/issue_comments_370702.json:
```json
{
    "body": "The following changes should suffice once `get_cover.php`  is repaired.\n\n(I think it currently gives an extra initial  `\\n\\n<html>\\n<body>\\n` we don't expect.)\n\n\n```diff\ndiff --git a/src/sage/combinat/designs/covering_design.py b/src/sage/combinat/designs/covering_design.py\nindex 87dda39064..ef7512b704 100644\n--- a/src/sage/combinat/designs/covering_design.py\n+++ b/src/sage/combinat/designs/covering_design.py\n@@ -21,11 +21,11 @@ design from this database, we include extra information:\n REFERENCES:\n\n .. [1] La Jolla Covering Repository,\n-  https://math.ccrwest.org/cover.html\n+  http://ljcr.dmgordon.org/cover.html\n\n .. [2] Coverings,\n   Daniel Gordon and Douglas Stinson,\n-  https://math.ccrwest.org/gordon/hcd.pdf\n+  https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view\n   from the Handbook of Combinatorial Designs\n\n AUTHORS:\n@@ -452,8 +452,10 @@ class CoveringDesign(SageObject):\n\n def best_known_covering_design_www(v, k, t, verbose=False):\n     r\"\"\"\n-    Gives the best known `(v,k,t)` covering design, using the database\n-    available at `<https://math.ccrwest.org/cover.html>`_\n+    Return the best known `(v, k, t)` covering design from an online database.\n+\n+    This uses the La Jolla Covering Repository, a database\n+    available at `<http://ljcr.dmgordon.org/cover.html>`_\n\n     INPUT:\n@@ -488,7 +490,7 @@ def best_known_covering_design_www(v, k, t, verbose=False):\n     \"\"\"\n     # import compatible with py2 and py3\n     from six.moves.urllib.request import urlopen\n-\n+    from sage.cpython.string import bytes_to_str\n     from sage.misc.sage_eval import sage_eval\n\n     v = int(v)\n@@ -497,12 +499,11 @@ def best_known_covering_design_www(v, k, t, verbose=False):\n\n     param = (\"?v=%s&k=%s&t=%s\"%(v,k,t))\n\n-    url = \"https://math.ccrwest.org/cover/get_cover.php\"+param\n+    url = \"http://ljcr.dmgordon.org/cover/get_cover.php\" + param\n     if verbose:\n         print(\"Looking up the bounds at %s\" % url)\n-    f = urlopen(url)\n-    s = f.read()\n-    f.close()\n+    with urlopen(url) as f:\n+        s = bytes_to_str(f.read())\n\n     if 'covering not in database' in s:   #not found\n         str = \"no (%d,%d,%d) covering design in database\\n\"%(v,k,t)\n```\n\n\nI'll propose a branch if Dan Gordon confirms this about `get_cover.php`.",
    "created_at": "2019-03-08T07:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370702",
    "user": "https://github.com/slel"
}
```

The following changes should suffice once `get_cover.php`  is repaired.

(I think it currently gives an extra initial  `\n\n<html>\n<body>\n` we don't expect.)


```diff
diff --git a/src/sage/combinat/designs/covering_design.py b/src/sage/combinat/designs/covering_design.py
index 87dda39064..ef7512b704 100644
--- a/src/sage/combinat/designs/covering_design.py
+++ b/src/sage/combinat/designs/covering_design.py
@@ -21,11 +21,11 @@ design from this database, we include extra information:
 REFERENCES:

 .. [1] La Jolla Covering Repository,
-  https://math.ccrwest.org/cover.html
+  http://ljcr.dmgordon.org/cover.html

 .. [2] Coverings,
   Daniel Gordon and Douglas Stinson,
-  https://math.ccrwest.org/gordon/hcd.pdf
+  https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view
   from the Handbook of Combinatorial Designs

 AUTHORS:
@@ -452,8 +452,10 @@ class CoveringDesign(SageObject):

 def best_known_covering_design_www(v, k, t, verbose=False):
     r"""
-    Gives the best known `(v,k,t)` covering design, using the database
-    available at `<https://math.ccrwest.org/cover.html>`_
+    Return the best known `(v, k, t)` covering design from an online database.
+
+    This uses the La Jolla Covering Repository, a database
+    available at `<http://ljcr.dmgordon.org/cover.html>`_

     INPUT:
@@ -488,7 +490,7 @@ def best_known_covering_design_www(v, k, t, verbose=False):
     """
     # import compatible with py2 and py3
     from six.moves.urllib.request import urlopen
-
+    from sage.cpython.string import bytes_to_str
     from sage.misc.sage_eval import sage_eval

     v = int(v)
@@ -497,12 +499,11 @@ def best_known_covering_design_www(v, k, t, verbose=False):

     param = ("?v=%s&k=%s&t=%s"%(v,k,t))

-    url = "https://math.ccrwest.org/cover/get_cover.php"+param
+    url = "http://ljcr.dmgordon.org/cover/get_cover.php" + param
     if verbose:
         print("Looking up the bounds at %s" % url)
-    f = urlopen(url)
-    s = f.read()
-    f.close()
+    with urlopen(url) as f:
+        s = bytes_to_str(f.read())

     if 'covering not in database' in s:   #not found
         str = "no (%d,%d,%d) covering design in database\n"%(v,k,t)
```


I'll propose a branch if Dan Gordon confirms this about `get_cover.php`.



---

archive/issue_comments_370703.json:
```json
{
    "body": "Dan Gordon was able to get rid of the extra initial `\\n\\n<html>\\n<body>\\n`.\nWe're almost there, but one thing puzzles me about `sage -t`.\n\nWith the following code in `src/sage/combinat/designs/covering_design.py`\n\n```\ndef best_known_covering_design_www(v, k, t, verbose=False):\n    r\"\"\"\n    Return the best known `(v, k, t)` covering design from an online database.\n\n    This uses the La Jolla Covering Repository, a database\n    available at `<http://ljcr.dmgordon.org/cover.html>`_\n\n    INPUT:\n\n    - ``v`` -- integer, the size of the point set for the design\n\n    - ``k`` -- integer, the number of points per block\n\n    - ``t`` -- integer, the size of sets covered by the blocks\n\n    - ``verbose`` -- bool (default: ``False``), print verbose message\n\n    OUTPUT:\n\n    A :class:`CoveringDesign` object representing the ``(v, k, t)``-covering\n    design with smallest number of blocks available in the database.\n\n    EXAMPLES::\n\n        sage: from sage.combinat.designs.covering_design import (\n        ....:     best_known_covering_design_www)          # optional - internet\n        sage: C = best_known_covering_design_www(7, 3, 2)  # optional - internet\n        sage: print(C)                                     # optional - internet\n        C(7,3,2) = 7\n        Method: lex covering\n        Submitted on: 1996-12-01 00:00:00\n        0  1  2\n        0  3  4\n        0  5  6\n        1  3  5\n        1  4  6\n        2  3  6\n        2  4  5\n\n    A ValueError is raised if the ``(v, k, t)`` parameters are not\n    found in the database.\n    \"\"\"\n    # import compatible with py2 and py3\n    from six.moves.urllib.request import urlopen\n    from sage.cpython.string import bytes_to_str\n    from sage.misc.sage_eval import sage_eval\n\n    v = int(v)\n    k = int(k)\n    t = int(t)\n\n    param = \"?v=%s&k=%s&t=%s\" % (v, k, t)\n\n    url = \"http://ljcr.dmgordon.org/cover/get_cover.php\" + param\n    if verbose:\n        print(\"Looking up the bounds at %s\" % url)\n    with urlopen(url) as f:\n        s = bytes_to_str(f.read())\n\n    if 'covering not in database' in s:  # not found\n        str = \"no (%d, %d, %d) covering design in database\\n\" % (v, k, t)\n        raise ValueError(str)\n\n    return sage_eval(s)\n```\n\nthe function now works manually, i.e. I can do\n\n```\nsage: from sage.combinat.designs.covering_design import (\n....:     best_known_covering_design_www)\nsage: C = best_known_covering_design_www(7, 3, 2)\nsage: print(C)\nC(7, 3, 2) = 7\nMethod: lex covering\nSubmitted on: 1996-12-01 00:00:00\n0  1  2\n0  3  4\n0  5  6\n1  3  5\n1  4  6\n2  3  6\n2  4  5\n\n```\n\nbut, for some reason I cannot figure out, `sage -t` gives a `NameError` saying\n`name 'best_known_covering_design_www' is not defined`:\n\n```\n$ sage -t --optional=internet src/sage/combinat/designs/covering_design.py\nRunning doctests with ID 2019-03-08-21-29-22-a6581694.\nGit branch: t-26592-covering-designs-www\nUsing --optional=internet\nDoctesting 1 file.\nsage -t --warn-long 81.7 src/sage/combinat/designs/covering_design.py\n**********************************************************************\nFile \"src/sage/combinat/designs/covering_design.py\", line 514, in sage.combinat.designs.covering_design.best_known_covering_design_www\nFailed example:\n    C = best_known_covering_design_www(7, 3, 2)  # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[0]>\", line 1, in <module>\n        C = best_known_covering_design_www(Integer(7), Integer(3), Integer(2))  # optional - internet\n    NameError: name 'best_known_covering_design_www' is not defined\n**********************************************************************\nFile \"src/sage/combinat/designs/covering_design.py\", line 515, in sage.combinat.designs.covering_design.best_known_covering_design_www\nFailed example:\n    print(C)                                     # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[1]>\", line 1, in <module>\n        print(C)                                     # optional - internet\n    NameError: name 'C' is not defined\n**********************************************************************\n1 item had failures:\n   2 of   3 in sage.combinat.designs.covering_design.best_known_covering_design_www\n    [2 tests, 2 failures, 0.01 s]\n----------------------------------------------------------------------\nsage -t --warn-long 81.7 src/sage/combinat/designs/covering_design.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.1 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\nCan somebody enlighten me?",
    "created_at": "2019-03-08T20:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370703",
    "user": "https://github.com/slel"
}
```

Dan Gordon was able to get rid of the extra initial `\n\n<html>\n<body>\n`.
We're almost there, but one thing puzzles me about `sage -t`.

With the following code in `src/sage/combinat/designs/covering_design.py`

```
def best_known_covering_design_www(v, k, t, verbose=False):
    r"""
    Return the best known `(v, k, t)` covering design from an online database.

    This uses the La Jolla Covering Repository, a database
    available at `<http://ljcr.dmgordon.org/cover.html>`_

    INPUT:

    - ``v`` -- integer, the size of the point set for the design

    - ``k`` -- integer, the number of points per block

    - ``t`` -- integer, the size of sets covered by the blocks

    - ``verbose`` -- bool (default: ``False``), print verbose message

    OUTPUT:

    A :class:`CoveringDesign` object representing the ``(v, k, t)``-covering
    design with smallest number of blocks available in the database.

    EXAMPLES::

        sage: from sage.combinat.designs.covering_design import (
        ....:     best_known_covering_design_www)          # optional - internet
        sage: C = best_known_covering_design_www(7, 3, 2)  # optional - internet
        sage: print(C)                                     # optional - internet
        C(7,3,2) = 7
        Method: lex covering
        Submitted on: 1996-12-01 00:00:00
        0  1  2
        0  3  4
        0  5  6
        1  3  5
        1  4  6
        2  3  6
        2  4  5

    A ValueError is raised if the ``(v, k, t)`` parameters are not
    found in the database.
    """
    # import compatible with py2 and py3
    from six.moves.urllib.request import urlopen
    from sage.cpython.string import bytes_to_str
    from sage.misc.sage_eval import sage_eval

    v = int(v)
    k = int(k)
    t = int(t)

    param = "?v=%s&k=%s&t=%s" % (v, k, t)

    url = "http://ljcr.dmgordon.org/cover/get_cover.php" + param
    if verbose:
        print("Looking up the bounds at %s" % url)
    with urlopen(url) as f:
        s = bytes_to_str(f.read())

    if 'covering not in database' in s:  # not found
        str = "no (%d, %d, %d) covering design in database\n" % (v, k, t)
        raise ValueError(str)

    return sage_eval(s)
```

the function now works manually, i.e. I can do

```
sage: from sage.combinat.designs.covering_design import (
....:     best_known_covering_design_www)
sage: C = best_known_covering_design_www(7, 3, 2)
sage: print(C)
C(7, 3, 2) = 7
Method: lex covering
Submitted on: 1996-12-01 00:00:00
0  1  2
0  3  4
0  5  6
1  3  5
1  4  6
2  3  6
2  4  5

```

but, for some reason I cannot figure out, `sage -t` gives a `NameError` saying
`name 'best_known_covering_design_www' is not defined`:

```
$ sage -t --optional=internet src/sage/combinat/designs/covering_design.py
Running doctests with ID 2019-03-08-21-29-22-a6581694.
Git branch: t-26592-covering-designs-www
Using --optional=internet
Doctesting 1 file.
sage -t --warn-long 81.7 src/sage/combinat/designs/covering_design.py
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 514, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    C = best_known_covering_design_www(7, 3, 2)  # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[0]>", line 1, in <module>
        C = best_known_covering_design_www(Integer(7), Integer(3), Integer(2))  # optional - internet
    NameError: name 'best_known_covering_design_www' is not defined
**********************************************************************
File "src/sage/combinat/designs/covering_design.py", line 515, in sage.combinat.designs.covering_design.best_known_covering_design_www
Failed example:
    print(C)                                     # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/s/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.covering_design.best_known_covering_design_www[1]>", line 1, in <module>
        print(C)                                     # optional - internet
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   2 of   3 in sage.combinat.designs.covering_design.best_known_covering_design_www
    [2 tests, 2 failures, 0.01 s]
----------------------------------------------------------------------
sage -t --warn-long 81.7 src/sage/combinat/designs/covering_design.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.1 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```

Can somebody enlighten me?



---

archive/issue_comments_370704.json:
```json
{
    "body": "* do not break the import line\n\n* OR tag the first line of the import\n\n* OR use optional=sage,internet ?",
    "created_at": "2019-03-09T06:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370704",
    "user": "https://github.com/fchapoton"
}
```

* do not break the import line

* OR tag the first line of the import

* OR use optional=sage,internet ?



---

archive/issue_comments_370705.json:
```json
{
    "body": "`@`slelievre with your patch and python 2 i obtain the following:\n\n\n```\nsage: best_known_covering_design_www(7, 3, 2)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-a930c6c24a1d> in <module>()\n----> 1 best_known_covering_design_www(Integer(7), Integer(3), Integer(2))\n\n<ipython-input-1-598f13fbcc94> in best_known_covering_design_www(v, k, t, verbose)\n     55     if verbose:\n     56         print(\"Looking up the bounds at %s\" % url)\n---> 57     with urlopen(url) as f:\n     58         s = bytes_to_str(f.read())\n     59 \n\nAttributeError: addinfourl instance has no attribute '__exit__'\n\n```\n\nSee: https://stackoverflow.com/questions/30627937/traceback-attributeerroraddinfourl-instance-has-no-attribute-exit/30628142",
    "created_at": "2019-03-11T09:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370705",
    "user": "https://github.com/vinklein"
}
```

`@`slelievre with your patch and python 2 i obtain the following:


```
sage: best_known_covering_design_www(7, 3, 2)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-a930c6c24a1d> in <module>()
----> 1 best_known_covering_design_www(Integer(7), Integer(3), Integer(2))

<ipython-input-1-598f13fbcc94> in best_known_covering_design_www(v, k, t, verbose)
     55     if verbose:
     56         print("Looking up the bounds at %s" % url)
---> 57     with urlopen(url) as f:
     58         s = bytes_to_str(f.read())
     59 

AttributeError: addinfourl instance has no attribute '__exit__'

```

See: https://stackoverflow.com/questions/30627937/traceback-attributeerroraddinfourl-instance-has-no-attribute-exit/30628142



---

archive/issue_comments_370706.json:
```json
{
    "body": "The py2 and py3 tests pass with branch u/vklein/26592.\\\\\n\nI will now look for a way to avoid calling `sage_eval` on a internet given result.\\\\\nIt really looks like an highway for code injection to me.\n----\nNew commits:",
    "created_at": "2019-03-11T09:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370706",
    "user": "https://github.com/vinklein"
}
```

The py2 and py3 tests pass with branch u/vklein/26592.\\

I will now look for a way to avoid calling `sage_eval` on a internet given result.\\
It really looks like an highway for code injection to me.
----
New commits:



---

archive/issue_comments_370707.json:
```json
{
    "body": "Constructing \"manually\" the `CoveringDesign` is not that easy because his `__init__` function has eleven named parameters with default values, that mean there is a lot of potential string format that `get_cover.php` could return.\n\nDo we know if get_cover.php always return a string in the form \"CoveringDesign(<all init parameters positionally>)\" ?",
    "created_at": "2019-03-11T14:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370707",
    "user": "https://github.com/vinklein"
}
```

Constructing "manually" the `CoveringDesign` is not that easy because his `__init__` function has eleven named parameters with default values, that mean there is a lot of potential string format that `get_cover.php` could return.

Do we know if get_cover.php always return a string in the form "CoveringDesign(<all init parameters positionally>)" ?



---

archive/issue_comments_370708.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2019-03-13T17:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370708",
    "user": "https://github.com/vinklein"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_370709.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370709",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_370710.json:
```json
{
    "body": "New branch based on Sage 8.8.beta2.\n\nA first commit does pep8 reformatting + updating urls.\n\nThe second commit has the actual `bytes_to_str` fix in\n`best_known_covering_design_www` and a minor\nimprovement to `is_covering`.\n\nPlease review.\n----\nNew commits:",
    "created_at": "2019-04-15T02:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370710",
    "user": "https://github.com/slel"
}
```

New branch based on Sage 8.8.beta2.

A first commit does pep8 reformatting + updating urls.

The second commit has the actual `bytes_to_str` fix in
`best_known_covering_design_www` and a minor
improvement to `is_covering`.

Please review.
----
New commits:



---

archive/issue_comments_370711.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-04-15T02:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370711",
    "user": "https://github.com/slel"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_370712.json:
```json
{
    "body": "There is no point in these being in-line imports: \n\n\n```\n     from six.moves.urllib.request import urlopen\n-\n+    from sage.cpython.string import bytes_to_str\n```\n\n\nThose modules are always loaded by Sage so they might as well go at the module-level.",
    "created_at": "2019-04-16T16:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370712",
    "user": "https://github.com/embray"
}
```

There is no point in these being in-line imports: 


```
     from six.moves.urllib.request import urlopen
-
+    from sage.cpython.string import bytes_to_str
```


Those modules are always loaded by Sage so they might as well go at the module-level.



---

archive/issue_comments_370713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-17T08:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370714.json:
```json
{
    "body": "Like this?",
    "created_at": "2019-04-17T08:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370714",
    "user": "https://github.com/slel"
}
```

Like this?



---

archive/issue_comments_370715.json:
```json
{
    "body": "This line:\n\n```\nhttps://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view\n```\n\nis not something that we should link to.\n\nOtherwise, looks good. In the future, please avoid doing large scale pep8 cleanup at the same time as serious changes.",
    "created_at": "2019-04-28T07:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370715",
    "user": "https://github.com/fchapoton"
}
```

This line:

```
https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view
```

is not something that we should link to.

Otherwise, looks good. In the future, please avoid doing large scale pep8 cleanup at the same time as serious changes.



---

archive/issue_comments_370716.json:
```json
{
    "body": "Replying to [comment:28 chapoton]:\n> This line:\n> {{{\n> https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view\n> }}}\n> is not something that we should link to.\n\nOther options I can see are the following:\n\n- Dan Gordon's publications page: https://www.dmgordon.org/Publications/\n- the CRC Press page for the book: https://www.crcpress.com/Handbook-of-Combinatorial-Designs-Second-Edition/Colbourn-Dinitz/p/book/9781584885061\n- one of the editors' page for the book: http://www.cems.uvm.edu/~jdinitz/hcd.html\n\n> Otherwise, looks good. In the future, please avoid doing large scale pep8 cleanup at the same time as serious changes.\n\nSorry about that, I got slightly carried away. I tried to use a different commit for each type of changes, but probably could have done a better job of that, or used different tickets altogether. Thanks for reviewing anyway and for the advice for the future.",
    "created_at": "2019-04-28T08:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370716",
    "user": "https://github.com/slel"
}
```

Replying to [comment:28 chapoton]:
> This line:
> {{{
> https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view
> }}}
> is not something that we should link to.

Other options I can see are the following:

- Dan Gordon's publications page: https://www.dmgordon.org/Publications/
- the CRC Press page for the book: https://www.crcpress.com/Handbook-of-Combinatorial-Designs-Second-Edition/Colbourn-Dinitz/p/book/9781584885061
- one of the editors' page for the book: http://www.cems.uvm.edu/~jdinitz/hcd.html

> Otherwise, looks good. In the future, please avoid doing large scale pep8 cleanup at the same time as serious changes.

Sorry about that, I got slightly carried away. I tried to use a different commit for each type of changes, but probably could have done a better job of that, or used different tickets altogether. Thanks for reviewing anyway and for the advice for the future.



---

archive/issue_comments_370717.json:
```json
{
    "body": "Or we could link to the copy archived at the Internet Archive's Wayback Machine:\n\n- https://web.archive.org/web/20170829210149/https://www.ccrwest.org/gordon/hcd.pdf",
    "created_at": "2019-04-28T08:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370717",
    "user": "https://github.com/slel"
}
```

Or we could link to the copy archived at the Internet Archive's Wayback Machine:

- https://web.archive.org/web/20170829210149/https://www.ccrwest.org/gordon/hcd.pdf



---

archive/issue_comments_370718.json:
```json
{
    "body": "Replying to [comment:29 slelievre]:\n> Replying to [comment:28 chapoton]:\n> > This line:\n> > {{{\n> > https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view\n> > }}}\n> > is not something that we should link to.\n> \n> Other options I can see are the following:\n> \n> - Dan Gordon's publications page: https://www.dmgordon.org/Publications/\n\nYes, this one is better. One should also give the title (Coverings, chapter 1 of whatever)",
    "created_at": "2019-04-28T10:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370718",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:29 slelievre]:
> Replying to [comment:28 chapoton]:
> > This line:
> > {{{
> > https://drive.google.com/file/d/0B6s9_JNV1EjtUFd4MkhBc0hSdVU/view
> > }}}
> > is not something that we should link to.
> 
> Other options I can see are the following:
> 
> - Dan Gordon's publications page: https://www.dmgordon.org/Publications/

Yes, this one is better. One should also give the title (Coverings, chapter 1 of whatever)



---

archive/issue_comments_370719.json:
```json
{
    "body": "Having my papers on google drive was the last part of my website that I hadn't updated.  I've moved them now, so that paper can now be linked to at [https://www.dmgordon.org/papers/hcd.pdf](https://www.dmgordon.org/papers/hcd.pdf).",
    "created_at": "2019-04-29T21:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370719",
    "user": "https://trac.sagemath.org/admin/accounts/users/dgordon"
}
```

Having my papers on google drive was the last part of my website that I hadn't updated.  I've moved them now, so that paper can now be linked to at [https://www.dmgordon.org/papers/hcd.pdf](https://www.dmgordon.org/papers/hcd.pdf).



---

archive/issue_comments_370720.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-01T00:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370721.json:
```json
{
    "body": "Updated now, please review.",
    "created_at": "2019-05-01T00:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370721",
    "user": "https://github.com/slel"
}
```

Updated now, please review.



---

archive/issue_comments_370722.json:
```json
{
    "body": "ok, thx",
    "created_at": "2019-05-01T06:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370722",
    "user": "https://github.com/fchapoton"
}
```

ok, thx



---

archive/issue_comments_370723.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-01T06:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370723",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_024485.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-05-06T11:56:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26355#event-24485"
}
```



---

archive/issue_comments_370724.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-06T11:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370724",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_370725.json:
```json
{
    "body": "With 8.8.beta5, I get:\n\n\n```\nsage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-a3d9f9e592f1> in <module>()\n----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))\n\n/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.pyc in best_known_covering_design_www(v, k, t, verbose)\n    525     if verbose:\n    526         print(\"Looking up the bounds at %s\" % url)\n--> 527     with urlopen(url) as f:\n    528         s = bytes_to_str(f.read())\n    529     if 'covering not in database' in s:  # not found\n\nAttributeError: addinfourl instance has no attribute '__exit__'\n```\n\nWere you obtaining the same issue with this branch?",
    "created_at": "2019-05-13T13:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370725",
    "user": "https://github.com/seblabbe"
}
```

With 8.8.beta5, I get:


```
sage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-a3d9f9e592f1> in <module>()
----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))

/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.pyc in best_known_covering_design_www(v, k, t, verbose)
    525     if verbose:
    526         print("Looking up the bounds at %s" % url)
--> 527     with urlopen(url) as f:
    528         s = bytes_to_str(f.read())
    529     if 'covering not in database' in s:  # not found

AttributeError: addinfourl instance has no attribute '__exit__'
```

Were you obtaining the same issue with this branch?



---

archive/issue_comments_370726.json:
```json
{
    "body": "I think so `with urelopen(url) as...` syntax has been introduced with commit `e863721`.\\\\\n\nIt should be avoided (see [comment:16](https://trac.sagemath.org/ticket/26592#comment:16))",
    "created_at": "2019-05-13T13:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370726",
    "user": "https://github.com/vinklein"
}
```

I think so `with urelopen(url) as...` syntax has been introduced with commit `e863721`.\\

It should be avoided (see [comment:16](https://trac.sagemath.org/ticket/26592#comment:16))



---

archive/issue_comments_370727.json:
```json
{
    "body": "Open a new ticket to fix that #27821",
    "created_at": "2019-05-13T14:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26355#issuecomment-370727",
    "user": "https://github.com/vinklein"
}
```

Open a new ticket to fix that #27821
