# Issue 23634: Assorted doctest failures due to optional packages

archive/issues_023634.json:
```json
{
    "body": "The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`\ninstalled. Note that on this system all test passed before installing the optional packages.\n\n\n\n```\n./sage -tp 2 --all \n...\n...\n...\nsage -t --long --warn-long 46.3 src/sage/schemes/elliptic_curves/ell_number_field.py  # 18 doctests failed\nsage -t --long --warn-long 46.3 src/sage/manifolds/differentiable/affine_connection.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/misc/sagedoc.py  # 7 doctests failed\nsage -t --long --warn-long 46.3 src/sage/tests/cmdline.py  # 9 doctests failed\nsage -t --long --warn-long 46.3 src/sage/manifolds/differentiable/vectorfield.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/rings/number_field/number_field.py  # 3 doctests failed\nsage -t --long --warn-long 46.3 src/sage/graphs/generators/smallgraphs.py  # 9 doctests failed\nsage -t --long --warn-long 46.3 src/sage/coding/linear_code.py  # 12 doctests failed\nsage -t --long --warn-long 46.3 src/sage/graphs/strongly_regular_db.pyx  # 16 doctests failed\nsage -t --long --warn-long 46.3 src/sage/graphs/generators/classical_geometries.py  # 6 doctests failed\nsage -t --long --warn-long 46.3 src/sage/combinat/designs/database.py  # 3 doctests failed\nsage -t --long --warn-long 46.3 src/sage/rings/integer.pyx  # 1 doctest failed\nsage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/groups/perm_gps/permgroup.py  # 30 doctests failed\nsage -t --long --warn-long 46.3 src/sage/tensor/modules/comp.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/parallel/decorate.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/groups/perm_gps/permgroup_named.py  # 50 doctests failed\nsage -t --long --warn-long 46.3 src/sage/groups/generic.py  # 6 doctests failed\nsage -t --long --warn-long 46.3 src/sage/combinat/integer_vectors_mod_permgroup.py  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/sage/repl/interpreter.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/rings/polynomial/polynomial_rational_flint.pyx  # 4 doctests failed\nsage -t --long --warn-long 46.3 src/sage/rings/number_field/galois_group.py  # 2 doctests failed\nsage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/combinat/designs/block_design.py  # 6 doctests failed\nsage -t --long --warn-long 46.3 src/sage/coding/code_bounds.py  # 6 doctests failed\nsage -t --long --warn-long 46.3 src/sage/combinat/designs/incidence_structures.py  # 7 doctests failed\nsage -t --long --warn-long 46.3 src/sage/combinat/sloane_functions.py  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/sage/coding/databases.py  # 4 doctests failed\nsage -t --long --warn-long 46.3 src/doc/ru/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/en/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/fr/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/ja/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/de/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/pt/tutorial/interfaces.rst  # 2 doctests failed\nsage -t --long --warn-long 46.3 src/doc/en/constructions/groups.rst  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/repl/ipython_tests.py  # UserWarning in doctesting framework\nsage -t --long --warn-long 46.3 src/sage/categories/finite_permutation_groups.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/parallel/multiprocessing_sage.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/ext/memory.pyx  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/combinat/designs/design_catalog.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/doc/common/conf.py  # 1 doctest failed\nsage -t --long --warn-long 46.3 src/sage/coding/guava.py  # 3 doctests failed\n```\n\n\nAny doctest for which a more specific reason of failure can be found shouldd get a separate ticket and be added to #23832. After this the doctests can be removed from this ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23871\n\n",
    "created_at": "2017-09-15T18:53:28Z",
    "labels": [
        "PLEASE CHANGE",
        "blocker",
        "bug"
    ],
    "title": "Assorted doctest failures due to optional packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23634",
    "user": "mderickx"
}
```
The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`
installed. Note that on this system all test passed before installing the optional packages.



```
./sage -tp 2 --all 
...
...
...
sage -t --long --warn-long 46.3 src/sage/schemes/elliptic_curves/ell_number_field.py  # 18 doctests failed
sage -t --long --warn-long 46.3 src/sage/manifolds/differentiable/affine_connection.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/misc/sagedoc.py  # 7 doctests failed
sage -t --long --warn-long 46.3 src/sage/tests/cmdline.py  # 9 doctests failed
sage -t --long --warn-long 46.3 src/sage/manifolds/differentiable/vectorfield.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/rings/number_field/number_field.py  # 3 doctests failed
sage -t --long --warn-long 46.3 src/sage/graphs/generators/smallgraphs.py  # 9 doctests failed
sage -t --long --warn-long 46.3 src/sage/coding/linear_code.py  # 12 doctests failed
sage -t --long --warn-long 46.3 src/sage/graphs/strongly_regular_db.pyx  # 16 doctests failed
sage -t --long --warn-long 46.3 src/sage/graphs/generators/classical_geometries.py  # 6 doctests failed
sage -t --long --warn-long 46.3 src/sage/combinat/designs/database.py  # 3 doctests failed
sage -t --long --warn-long 46.3 src/sage/rings/integer.pyx  # 1 doctest failed
sage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 1 doctest failed
sage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/groups/perm_gps/permgroup.py  # 30 doctests failed
sage -t --long --warn-long 46.3 src/sage/tensor/modules/comp.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/parallel/decorate.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/groups/perm_gps/permgroup_named.py  # 50 doctests failed
sage -t --long --warn-long 46.3 src/sage/groups/generic.py  # 6 doctests failed
sage -t --long --warn-long 46.3 src/sage/combinat/integer_vectors_mod_permgroup.py  # 2 doctests failed
sage -t --long --warn-long 46.3 src/sage/repl/interpreter.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/rings/polynomial/polynomial_rational_flint.pyx  # 4 doctests failed
sage -t --long --warn-long 46.3 src/sage/rings/number_field/galois_group.py  # 2 doctests failed
sage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/combinat/designs/block_design.py  # 6 doctests failed
sage -t --long --warn-long 46.3 src/sage/coding/code_bounds.py  # 6 doctests failed
sage -t --long --warn-long 46.3 src/sage/combinat/designs/incidence_structures.py  # 7 doctests failed
sage -t --long --warn-long 46.3 src/sage/combinat/sloane_functions.py  # 2 doctests failed
sage -t --long --warn-long 46.3 src/sage/coding/databases.py  # 4 doctests failed
sage -t --long --warn-long 46.3 src/doc/ru/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/en/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/fr/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/ja/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/de/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/pt/tutorial/interfaces.rst  # 2 doctests failed
sage -t --long --warn-long 46.3 src/doc/en/constructions/groups.rst  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/repl/ipython_tests.py  # UserWarning in doctesting framework
sage -t --long --warn-long 46.3 src/sage/categories/finite_permutation_groups.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/parallel/multiprocessing_sage.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py  # 1 doctest failed
sage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 1 doctest failed
sage -t --long --warn-long 46.3 local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/ext/memory.pyx  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/combinat/designs/design_catalog.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/doc/common/conf.py  # 1 doctest failed
sage -t --long --warn-long 46.3 src/sage/coding/guava.py  # 3 doctests failed
```


Any doctest for which a more specific reason of failure can be found shouldd get a separate ticket and be added to #23832. After this the doctests can be removed from this ticket.

Issue created by migration from https://trac.sagemath.org/ticket/23871





---

archive/issue_comments_331007.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to misc.",
    "created_at": "2017-09-15T18:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331007",
    "user": "mderickx"
}
```

Changing component from PLEASE CHANGE to misc.



---

archive/issue_comments_331008.json:
```json
{
    "body": "Replying to [ticket:23871 mderickx]:\n> The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`\n\nInstead of listing the packages which are not installed, can you instead list the packages which are installed?",
    "created_at": "2017-09-15T19:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331008",
    "user": "jdemeyer"
}
```

Replying to [ticket:23871 mderickx]:
> The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`

Instead of listing the packages which are not installed, can you instead list the packages which are installed?



---

archive/issue_comments_331009.json:
```json
{
    "body": "Do you also have which package you installed when you first saw a failure?",
    "created_at": "2017-09-15T19:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331009",
    "user": "tscrim"
}
```

Do you also have which package you installed when you first saw a failure?



---

archive/issue_comments_331010.json:
```json
{
    "body": "Ok I added a list of all the optional packages installed. I do not have a list of when I first saw a failure since this was obtained by first installing as many packages as possible and then running all the tests. An automated script for doctesting in between each install would be nice indeed. I'll try to see if I can set that up and run it only on the above files. I created this ticket as an overview so that we at least know what is wrong. I certainly plan on working on making it more refined.",
    "created_at": "2017-09-15T19:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331010",
    "user": "mderickx"
}
```

Ok I added a list of all the optional packages installed. I do not have a list of when I first saw a failure since this was obtained by first installing as many packages as possible and then running all the tests. An automated script for doctesting in between each install would be nice indeed. I'll try to see if I can set that up and run it only on the above files. I created this ticket as an overview so that we at least know what is wrong. I certainly plan on working on making it more refined.



---

archive/issue_comments_331011.json:
```json
{
    "body": "Would you mind posting the details of at least one failure? Given the number of packages there may be multiple sources but you have to start somewhere.",
    "created_at": "2017-09-15T20:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331011",
    "user": "fbissey"
}
```

Would you mind posting the details of at least one failure? Given the number of packages there may be multiple sources but you have to start somewhere.



---

archive/issue_comments_331012.json:
```json
{
    "body": "There are multiple failures there that should be caused by gap_packages\n\n```\nsage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py\nsage -t --long --warn-long 46.3 src/sage/coding/guava.py\n```\n\npossibly a couple of others. I would have thought this particular package was well tested. I am wondering if there is a bad interaction with something else.\n\nI would like to know the details of\n\n```\nsage -t --long --warn-long 46.3 src/sage/rings/integer.pyx\nsage -t --long --warn-long 46.3 src/sage/ext/memory.pyx\n```\n\nthat couple is suspicious in that it would imply gmp which you said you didn't install. I wonder if it was pulled by something else.",
    "created_at": "2017-09-15T20:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331012",
    "user": "fbissey"
}
```

There are multiple failures there that should be caused by gap_packages

```
sage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py
sage -t --long --warn-long 46.3 src/sage/coding/guava.py
```

possibly a couple of others. I would have thought this particular package was well tested. I am wondering if there is a bad interaction with something else.

I would like to know the details of

```
sage -t --long --warn-long 46.3 src/sage/rings/integer.pyx
sage -t --long --warn-long 46.3 src/sage/ext/memory.pyx
```

that couple is suspicious in that it would imply gmp which you said you didn't install. I wonder if it was pulled by something else.



---

archive/issue_comments_331013.json:
```json
{
    "body": "Hi Francios,\n\nThank you for pointing at gmp. I did have gmp installed in the same sage install, but then later did \n\n```\nsage -i mpir\n```\n\nwhich removed gmp from the installed packages list returned by `installed_packages()`. Could this be the cause?",
    "created_at": "2017-09-15T21:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331013",
    "user": "mderickx"
}
```

Hi Francios,

Thank you for pointing at gmp. I did have gmp installed in the same sage install, but then later did 

```
sage -i mpir
```

which removed gmp from the installed packages list returned by `installed_packages()`. Could this be the cause?



---

archive/issue_comments_331014.json:
```json
{
    "body": "Could be something funny happening there. Typically gmp will lead to this\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\nFailed example:\n    1 << (2^60)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes   \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer._shift_helper[8]>\", line 1, in <module>\n        Integer(1) << (Integer(2)**Integer(60))\n      File \"sage/rings/integer.pyx\", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)\n        return (<Integer>x)._shift_helper(y, 1)\n      File \"sage/rings/integer.pyx\", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)\n        sig_on()\n    RuntimeError: Aborted\n```\n\nand\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx\", line 9, in sage.ext.memory\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes  \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"sage/rings/integer.pyx\", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)\n        sig_on()\n    RuntimeError: Aborted\n```\n",
    "created_at": "2017-09-15T22:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331014",
    "user": "fbissey"
}
```

Could be something funny happening there. Typically gmp will lead to this

```
File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
Failed example:
    1 << (2^60)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes   
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer._shift_helper[8]>", line 1, in <module>
        Integer(1) << (Integer(2)**Integer(60))
      File "sage/rings/integer.pyx", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)
        return (<Integer>x)._shift_helper(y, 1)
      File "sage/rings/integer.pyx", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)
        sig_on()
    RuntimeError: Aborted
```

and

```
File "/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx", line 9, in sage.ext.memory
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.ext.memory[0]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)
        sig_on()
    RuntimeError: Aborted
```




---

archive/issue_comments_331015.json:
```json
{
    "body": "I just did:\n\n\n```\nsage -f database_gap\nsage -f gap_packages\n```\n\n\nand this fixed almost all of the failures. For some reason something went wrong with these two packages.",
    "created_at": "2017-09-15T22:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331015",
    "user": "mderickx"
}
```

I just did:


```
sage -f database_gap
sage -f gap_packages
```


and this fixed almost all of the failures. For some reason something went wrong with these two packages.



---

archive/issue_comments_331016.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> Could be something funny happening there. Typically gmp will lead to this\n> {{{\n> File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> ...\n>     RuntimeError: Aborted\n> }}}\n> \n> \nThese two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?",
    "created_at": "2017-09-15T22:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331016",
    "user": "mderickx"
}
```

Replying to [comment:11 fbissey]:
> Could be something funny happening there. Typically gmp will lead to this
> {{{
> File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> ...
>     RuntimeError: Aborted
> }}}
> 
> 
These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?



---

archive/issue_comments_331017.json:
```json
{
    "body": "Replying to [comment:14 mderickx]:\n> Replying to [comment:11 fbissey]:\n> > Could be something funny happening there. Typically gmp will lead to this\n> > {{{\n> > File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> > ...\n> >     RuntimeError: Aborted\n> > }}}\n> > \n> > \n> These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?\n\nYes, possibly in a won't fix state though. These are differences in error messages between mpir and gmp. We are more or less living with them. They are well know of sage-on-distro people since we all use gmp for \"reasons\" (including sanity).",
    "created_at": "2017-09-15T22:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331017",
    "user": "fbissey"
}
```

Replying to [comment:14 mderickx]:
> Replying to [comment:11 fbissey]:
> > Could be something funny happening there. Typically gmp will lead to this
> > {{{
> > File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> > ...
> >     RuntimeError: Aborted
> > }}}
> > 
> > 
> These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?

Yes, possibly in a won't fix state though. These are differences in error messages between mpir and gmp. We are more or less living with them. They are well know of sage-on-distro people since we all use gmp for "reasons" (including sanity).



---

archive/issue_comments_331018.json:
```json
{
    "body": "I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?",
    "created_at": "2017-09-15T22:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331018",
    "user": "fbissey"
}
```

I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?



---

archive/issue_comments_331019.json:
```json
{
    "body": "Changing priority from blocker to major.",
    "created_at": "2017-09-15T23:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331019",
    "user": "mderickx"
}
```

Changing priority from blocker to major.



---

archive/issue_comments_331020.json:
```json
{
    "body": "Replying to [comment:16 fbissey]:\n> I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?\n\nSorry the detail is gone by subsequent doctests. A lot of the messages were saying that I should install database_gap or gap_packages, which I already had installed. I want to try to make this entire build again from a clean sage install and see if I can reproduce the errors. This will take some time though.\n\nIn the meanwhile a lot of thanks for helping figuring all the errors out. This was a great help in reliably installing a lot of optional packages at the same time.",
    "created_at": "2017-09-15T23:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331020",
    "user": "mderickx"
}
```

Replying to [comment:16 fbissey]:
> I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?

Sorry the detail is gone by subsequent doctests. A lot of the messages were saying that I should install database_gap or gap_packages, which I already had installed. I want to try to make this entire build again from a clean sage install and see if I can reproduce the errors. This will take some time though.

In the meanwhile a lot of thanks for helping figuring all the errors out. This was a great help in reliably installing a lot of optional packages at the same time.



---

archive/issue_comments_331021.json:
```json
{
    "body": "On my `sage4` patchbot, I also saw the whole bunch of failures that Maarten initially posted on this ticket. So there must be a real issue here. Since there are a lot of `MemoryError` in the failed tests, this is almost certainly due to #23748. So there must be some optional package which has high memory usage (possibly even if it's not actually used). This could very well be `gap_packages` but then I do not understand why reinstalling `gap_packages` would help.\n\nMy strategy is now to install those packages one by one and run a few selected doctests every time to see which package is responsible for which failures.",
    "created_at": "2017-09-16T07:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331021",
    "user": "jdemeyer"
}
```

On my `sage4` patchbot, I also saw the whole bunch of failures that Maarten initially posted on this ticket. So there must be a real issue here. Since there are a lot of `MemoryError` in the failed tests, this is almost certainly due to #23748. So there must be some optional package which has high memory usage (possibly even if it's not actually used). This could very well be `gap_packages` but then I do not understand why reinstalling `gap_packages` would help.

My strategy is now to install those packages one by one and run a few selected doctests every time to see which package is responsible for which failures.



---

archive/issue_comments_331022.json:
```json
{
    "body": "At least some of the failures are caused by `cbc`.",
    "created_at": "2017-09-16T11:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331022",
    "user": "jdemeyer"
}
```

At least some of the failures are caused by `cbc`.



---

archive/issue_comments_331023.json:
```json
{
    "body": "Is cbc failing as in #22006 or is it something else?",
    "created_at": "2017-09-16T12:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331023",
    "user": "mderickx"
}
```

Is cbc failing as in #22006 or is it something else?



---

archive/issue_comments_331024.json:
```json
{
    "body": "No, I don't mean #22006. I mean some of the failures that you originally posted in the ticket description (and which are not there anymore).",
    "created_at": "2017-09-16T19:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331024",
    "user": "jdemeyer"
}
```

No, I don't mean #22006. I mean some of the failures that you originally posted in the ticket description (and which are not there anymore).



---

archive/issue_comments_331025.json:
```json
{
    "body": "Replying to [ticket:23871 mderickx]:\n> This leaves us with:\n> {{{\n> sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\n> sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed\n> }}}\n> which was caused by gmp being picked up.\n\nDetails please. What do you mean with \"caused by gmp being picked up\"? The Sage package `gmp` is not in your list of optional packages.",
    "created_at": "2017-09-18T10:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331025",
    "user": "jdemeyer"
}
```

Replying to [ticket:23871 mderickx]:
> This leaves us with:
> {{{
> sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
> sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed
> }}}
> which was caused by gmp being picked up.

Details please. What do you mean with "caused by gmp being picked up"? The Sage package `gmp` is not in your list of optional packages.



---

archive/issue_comments_331026.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> Replying to [ticket:23871 mderickx]:\n> > This leaves us with:\n> > {{{\n> > sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\n> > sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed\n> > }}}\n> > which was caused by gmp being picked up.\n> \n> Details please. What do you mean with \"caused by gmp being picked up\"? The Sage package `gmp` is not in your list of optional packages.\n\nSee #23871#comment:9",
    "created_at": "2017-09-18T10:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331026",
    "user": "fbissey"
}
```

Replying to [comment:24 jdemeyer]:
> Replying to [ticket:23871 mderickx]:
> > This leaves us with:
> > {{{
> > sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
> > sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed
> > }}}
> > which was caused by gmp being picked up.
> 
> Details please. What do you mean with "caused by gmp being picked up"? The Sage package `gmp` is not in your list of optional packages.

See #23871#comment:9



---

archive/issue_comments_331027.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> Could be something funny happening there. Typically gmp will lead to this\n> {{{\n> File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> Failed example:\n>     1 << (2^60)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     MemoryError: failed to allocate ... bytes   \n> Got:\n>     gmp: overflow in mpz type\n>     Traceback (most recent call last):\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.rings.integer.Integer._shift_helper[8]>\", line 1, in <module>\n>         Integer(1) << (Integer(2)**Integer(60))\n>       File \"sage/rings/integer.pyx\", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)\n>         return (<Integer>x)._shift_helper(y, 1)\n>       File \"sage/rings/integer.pyx\", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)\n>         sig_on()\n>     RuntimeError: Aborted\n> }}}\n> and\n> {{{\n> File \"/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx\", line 9, in sage.ext.memory\n> Failed example:\n>     2<sup>(2</sup>63-2)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     MemoryError: failed to allocate 1152921504606847008 bytes  \n> Got:\n>     gmp: overflow in mpz type\n>     Traceback (most recent call last):\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n>       File \"sage/rings/integer.pyx\", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)\n>         sig_on()\n>     RuntimeError: Aborted\n> }}}\n\nI assume that this is with GMP 6 on Gentoo, right? Because Sage still ships GMP 5.1.3 (see #19706).",
    "created_at": "2017-09-18T10:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331027",
    "user": "jdemeyer"
}
```

Replying to [comment:11 fbissey]:
> Could be something funny happening there. Typically gmp will lead to this
> {{{
> File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> Failed example:
>     1 << (2^60)
> Expected:
>     Traceback (most recent call last):
>     ...
>     MemoryError: failed to allocate ... bytes   
> Got:
>     gmp: overflow in mpz type
>     Traceback (most recent call last):
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.rings.integer.Integer._shift_helper[8]>", line 1, in <module>
>         Integer(1) << (Integer(2)**Integer(60))
>       File "sage/rings/integer.pyx", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)
>         return (<Integer>x)._shift_helper(y, 1)
>       File "sage/rings/integer.pyx", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)
>         sig_on()
>     RuntimeError: Aborted
> }}}
> and
> {{{
> File "/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx", line 9, in sage.ext.memory
> Failed example:
>     2<sup>(2</sup>63-2)
> Expected:
>     Traceback (most recent call last):
>     ...
>     MemoryError: failed to allocate 1152921504606847008 bytes  
> Got:
>     gmp: overflow in mpz type
>     Traceback (most recent call last):
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.ext.memory[0]>", line 1, in <module>
>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))
>       File "sage/rings/integer.pyx", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)
>         sig_on()
>     RuntimeError: Aborted
> }}}

I assume that this is with GMP 6 on Gentoo, right? Because Sage still ships GMP 5.1.3 (see #19706).



---

archive/issue_comments_331028.json:
```json
{
    "body": "As far as I remember both `GMP` 5 and 6 will give you that message. While on the subject, the problem that stopped #19706 have now gone so we could finish it off.",
    "created_at": "2017-09-18T10:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331028",
    "user": "fbissey"
}
```

As far as I remember both `GMP` 5 and 6 will give you that message. While on the subject, the problem that stopped #19706 have now gone so we could finish it off.



---

archive/issue_comments_331029.json:
```json
{
    "body": "#23713 should deal with `cbc` and `cryptominisat`",
    "created_at": "2017-10-05T10:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331029",
    "user": "jdemeyer"
}
```

#23713 should deal with `cbc` and `cryptominisat`



---

archive/issue_comments_331030.json:
```json
{
    "body": "Thanks, I think this ticket can be closed as duplicate since the issues turned out to be flukes or are fixed by other tickets.",
    "created_at": "2017-10-05T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331030",
    "user": "mderickx"
}
```

Thanks, I think this ticket can be closed as duplicate since the issues turned out to be flukes or are fixed by other tickets.



---

archive/issue_comments_331031.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-05T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331031",
    "user": "mderickx"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331032.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-05T12:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331032",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331033.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2017-10-05T14:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331033",
    "user": "mderickx"
}
```

Resolution: duplicate



---

archive/issue_comments_331034.json:
```json
{
    "body": "I believe that I have now created a blocker ticket for each of the issues that I could reproduce on a particular x86_64 Linux system.\n\nI could not reproduce the issue with `gap_packages` and `database_gap`: I have no idea what went wrong there. Nor could I reproduce the issue with `pandoc`, but that's probably because `pandoc` is actually installed on the system where I tested it.",
    "created_at": "2017-10-07T14:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331034",
    "user": "jdemeyer"
}
```

I believe that I have now created a blocker ticket for each of the issues that I could reproduce on a particular x86_64 Linux system.

I could not reproduce the issue with `gap_packages` and `database_gap`: I have no idea what went wrong there. Nor could I reproduce the issue with `pandoc`, but that's probably because `pandoc` is actually installed on the system where I tested it.



---

archive/issue_comments_331035.json:
```json
{
    "body": "I should also add that I tested *all* optional and pip packages except for `gmp`, `atlas` and `mpi4py`. So I included a few packages that you omitted.",
    "created_at": "2017-10-07T14:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331035",
    "user": "jdemeyer"
}
```

I should also add that I tested *all* optional and pip packages except for `gmp`, `atlas` and `mpi4py`. So I included a few packages that you omitted.



---

archive/issue_comments_331036.json:
```json
{
    "body": "Hi Jeroen thanks for putting so much energy in these optional packages,\n\nI recreated the pandoc problem and created #23985 for this with a clear traceback and explanation of why it occurs. I think the `gap_packages` and `database_gap` errors can be regarded as a mistake in installing all these optional packages from my side, because I cannot reproduce it either on the machine where it went wrong.",
    "created_at": "2017-10-07T18:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-331036",
    "user": "mderickx"
}
```

Hi Jeroen thanks for putting so much energy in these optional packages,

I recreated the pandoc problem and created #23985 for this with a clear traceback and explanation of why it occurs. I think the `gap_packages` and `database_gap` errors can be regarded as a mistake in installing all these optional packages from my side, because I cannot reproduce it either on the machine where it went wrong.
