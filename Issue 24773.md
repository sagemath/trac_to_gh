# Issue 24773: Wrong results for principal_directions in ParametrizedSurface3d

Issue created by migration from https://trac.sagemath.org/ticket/25010

Original creator: enriqueartal

Original creation time: 2018-03-19 08:10:02

CC:  egourgoulhon ​jvkersch tscrim

Keywords: differential geometry, principal directions

The function principañ_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.
The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):
var('u,v',domain='real')
V=vector([u*cos(u+v),u*sin(u+v),u+v])
S=ParametrizedSurface3D(V,(u,v))
dN=S.shape_operator()
U=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.

#Check if they are eigenvalues for the left action
[(dN*j-i*j).simplify_full() for i,j in U]

Output:
[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),
 (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]

False

#Check if they are eigenvalues for the left action
[(j*dN-i*j).simplify_full() for i,j in U]
Output:
[(0, 0), (0, 0)]
True


---

Comment by enriqueartal created at 2018-04-09 16:07:02

New commits:


---

Comment by enriqueartal created at 2018-04-09 16:07:02

Changing status from new to needs_review.


---

Comment by enriqueartal created at 2018-04-09 16:10:44

The solution is simply to replace `eigenvectors_left` by `eigenvectors_right` in the method `principal_directions`. 

It is solved now.


---

Comment by chapoton created at 2018-04-18 18:25:58

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-04-18 18:25:58

You need to add a doctest to check that it does fix something.


---

Comment by git created at 2018-04-19 11:34:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enriqueartal created at 2018-04-19 11:36:47

Doctest added.


---

Comment by enriqueartal created at 2018-04-19 11:36:47

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2018-04-25 14:55:27

LGTM. Thanks for the fix!


---

Comment by egourgoulhon created at 2018-04-25 14:55:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-18 17:03:57

Resolution: fixed
