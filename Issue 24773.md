# Issue 24773: Wrong results for principal_directions in ParametrizedSurface3d

archive/issues_024773.json:
```json
{
    "body": "CC:  @egourgoulhon @jvkersch @tscrim\n\nKeywords: differential geometry, principal directions\n\nThe function principa\u00f1_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.\nThe following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):\nvar('u,v',domain='real')\nV=vector([u*cos(u+v),u*sin(u+v),u+v])\nS=ParametrizedSurface3D(V,(u,v))\ndN=S.shape_operator()\nU=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.\n\n#Check if they are eigenvalues for the left action\n[(dN*j-i*j).simplify_full() for i,j in U]\n\nOutput:\n[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),\n (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]\n\nFalse\n\n#Check if they are eigenvalues for the left action\n[(j*dN-i*j).simplify_full() for i,j in U]\nOutput:\n[(0, 0), (0, 0)]\nTrue\n\nIssue created by migration from https://trac.sagemath.org/ticket/25010\n\n",
    "created_at": "2018-03-19T08:10:02Z",
    "labels": [
        "geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Wrong results for principal_directions in ParametrizedSurface3d",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24773",
    "user": "@enriqueartal"
}
```
CC:  @egourgoulhon @jvkersch @tscrim

Keywords: differential geometry, principal directions

The function principa√±_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.
The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):
var('u,v',domain='real')
V=vector([u*cos(u+v),u*sin(u+v),u+v])
S=ParametrizedSurface3D(V,(u,v))
dN=S.shape_operator()
U=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.

#Check if they are eigenvalues for the left action
[(dN*j-i*j).simplify_full() for i,j in U]

Output:
[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),
 (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]

False

#Check if they are eigenvalues for the left action
[(j*dN-i*j).simplify_full() for i,j in U]
Output:
[(0, 0), (0, 0)]
True

Issue created by migration from https://trac.sagemath.org/ticket/25010





---

archive/issue_comments_347788.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-09T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347788",
    "user": "@enriqueartal"
}
```

New commits:



---

archive/issue_comments_347789.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-09T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347789",
    "user": "@enriqueartal"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347790.json:
```json
{
    "body": "The solution is simply to replace `eigenvectors_left` by `eigenvectors_right` in the method `principal_directions`. \n\nIt is solved now.",
    "created_at": "2018-04-09T16:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347790",
    "user": "@enriqueartal"
}
```

The solution is simply to replace `eigenvectors_left` by `eigenvectors_right` in the method `principal_directions`. 

It is solved now.



---

archive/issue_comments_347791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-18T18:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347791",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_347792.json:
```json
{
    "body": "You need to add a doctest to check that it does fix something.",
    "created_at": "2018-04-18T18:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347792",
    "user": "@fchapoton"
}
```

You need to add a doctest to check that it does fix something.



---

archive/issue_comments_347793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T11:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347793",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347794.json:
```json
{
    "body": "Doctest added.",
    "created_at": "2018-04-19T11:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347794",
    "user": "@enriqueartal"
}
```

Doctest added.



---

archive/issue_comments_347795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-19T11:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347795",
    "user": "@enriqueartal"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_347796.json:
```json
{
    "body": "LGTM. Thanks for the fix!",
    "created_at": "2018-04-25T14:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347796",
    "user": "@egourgoulhon"
}
```

LGTM. Thanks for the fix!



---

archive/issue_comments_347797.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-25T14:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347797",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347798.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24773#issuecomment-347798",
    "user": "@vbraun"
}
```

Resolution: fixed
