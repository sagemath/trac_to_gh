# Issue 20536: MixedIntegerLinearProgram.new_variable could optionally take a "static" list of component indices

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-06-03 16:19:03

CC:  dimpase vdelecroix jdemeyer nbruin chapoton tmonteil dcoudert tscrim

Keywords: lp

Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable()
sage: x[7]
x_0
sage: x[2]
x_1
```


Sometimes it could be nice to have a predictable order in the backend. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.

This could look like this:

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable(components=range(7))
sage: p.number_of_variables()
7
sage: x[3]
x_3
sage: x[11]
IndexError: MIPVariable component index out of range
```

(This would be optional; if no `components` argument is passed, it would match the fully dynamic current behavior.)


---

Comment by mkoeppe created at 2018-09-18 15:49:54

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2018-09-18 15:49:54

Needs review. Comments on the proposed interface are welcome.
----
New commits:


---

Comment by tscrim created at 2018-09-18 23:15:46

While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as

```
        - ``indices`` -- (optional) an iterable of keys; components
          corresponding to these keys are created in order,
          and access to components with other keys will raise an
          error; otherwise components of this variable can be
          indexed by arbitrary keys and are created dynamically
          on access
```

However, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.


---

Comment by mkoeppe created at 2018-09-19 13:11:39

Replying to [comment:3 tscrim]:
> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 

Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

(`indices = []` must give a static-index MIP variable for which any component access is an error.)


---

Comment by tscrim created at 2018-09-19 13:46:28

Replying to [comment:4 mkoeppe]:
> Replying to [comment:3 tscrim]:
> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 
> 
> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

That is not a good rule IMO:

```
sage: Partition([])
[]
sage: Partition(None)  # This makes no sense and rightly raises an error.
```

The only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.


---

Comment by git created at 2018-09-19 13:56:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-19 13:58:11

Thanks for the discussion. I've changed it to `None`. Needs review


---

Comment by git created at 2018-09-20 02:09:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-20 02:10:18

Replying to [comment:4 mkoeppe]:
>  I definitely want to distinguish `[]` from the default argument ...
> (`indices = []` must give a static-index MIP variable for which any component access is an error.)

I've added a doctest for this.

Ready for final review


---

Comment by tscrim created at 2018-09-20 02:27:07

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-09-20 02:27:07

Thanks. LGTM.


---

Comment by vbraun created at 2018-09-21 22:20:38

Resolution: fixed
