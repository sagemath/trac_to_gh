# Issue 20536: MixedIntegerLinearProgram.new_variable could optionally take a "static" list of component indices

archive/issues_020536.json:
```json
{
    "body": "CC:  dimpase vdelecroix jdemeyer nbruin chapoton tmonteil dcoudert tscrim\n\nKeywords: lp\n\nCurrently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable()\nsage: x[7]\nx_0\nsage: x[2]\nx_1\n```\n\n\nSometimes it could be nice to have a predictable order in the backend. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n\nThis could look like this:\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable(components=range(7))\nsage: p.number_of_variables()\n7\nsage: x[3]\nx_3\nsage: x[11]\nIndexError: MIPVariable component index out of range\n```\n\n(This would be optional; if no `components` argument is passed, it would match the fully dynamic current behavior.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/20773\n\n",
    "created_at": "2016-06-03T16:19:03Z",
    "labels": [
        "numerical",
        "major",
        "enhancement"
    ],
    "title": "MixedIntegerLinearProgram.new_variable could optionally take a \"static\" list of component indices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20536",
    "user": "mkoeppe"
}
```
CC:  dimpase vdelecroix jdemeyer nbruin chapoton tmonteil dcoudert tscrim

Keywords: lp

Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable()
sage: x[7]
x_0
sage: x[2]
x_1
```


Sometimes it could be nice to have a predictable order in the backend. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.

This could look like this:

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable(components=range(7))
sage: p.number_of_variables()
7
sage: x[3]
x_3
sage: x[11]
IndexError: MIPVariable component index out of range
```

(This would be optional; if no `components` argument is passed, it would match the fully dynamic current behavior.)

Issue created by migration from https://trac.sagemath.org/ticket/20773





---

archive/issue_comments_283627.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283627",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_283628.json:
```json
{
    "body": "Needs review. Comments on the proposed interface are welcome.\n----\nNew commits:",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283628",
    "user": "mkoeppe"
}
```

Needs review. Comments on the proposed interface are welcome.
----
New commits:



---

archive/issue_comments_283629.json:
```json
{
    "body": "While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as\n\n```\n        - ``indices`` -- (optional) an iterable of keys; components\n          corresponding to these keys are created in order,\n          and access to components with other keys will raise an\n          error; otherwise components of this variable can be\n          indexed by arbitrary keys and are created dynamically\n          on access\n```\n\nHowever, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.",
    "created_at": "2018-09-18T23:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283629",
    "user": "tscrim"
}
```

While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as

```
        - ``indices`` -- (optional) an iterable of keys; components
          corresponding to these keys are created in order,
          and access to components with other keys will raise an
          error; otherwise components of this variable can be
          indexed by arbitrary keys and are created dynamically
          on access
```

However, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.



---

archive/issue_comments_283630.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n\nRight, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\n(`indices = []` must give a static-index MIP variable for which any component access is an error.)",
    "created_at": "2018-09-19T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283630",
    "user": "mkoeppe"
}
```

Replying to [comment:3 tscrim]:
> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 

Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

(`indices = []` must give a static-index MIP variable for which any component access is an error.)



---

archive/issue_comments_283631.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> Replying to [comment:3 tscrim]:\n> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n> \n> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\nThat is not a good rule IMO:\n\n```\nsage: Partition([])\n[]\nsage: Partition(None)  # This makes no sense and rightly raises an error.\n```\n\nThe only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.",
    "created_at": "2018-09-19T13:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283631",
    "user": "tscrim"
}
```

Replying to [comment:4 mkoeppe]:
> Replying to [comment:3 tscrim]:
> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 
> 
> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

That is not a good rule IMO:

```
sage: Partition([])
[]
sage: Partition(None)  # This makes no sense and rightly raises an error.
```

The only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.



---

archive/issue_comments_283632.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T13:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283632",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283633.json:
```json
{
    "body": "Thanks for the discussion. I've changed it to `None`. Needs review",
    "created_at": "2018-09-19T13:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283633",
    "user": "mkoeppe"
}
```

Thanks for the discussion. I've changed it to `None`. Needs review



---

archive/issue_comments_283634.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T02:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283634",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283635.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n>  I definitely want to distinguish `[]` from the default argument ...\n> (`indices = []` must give a static-index MIP variable for which any component access is an error.)\n\nI've added a doctest for this.\n\nReady for final review",
    "created_at": "2018-09-20T02:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283635",
    "user": "mkoeppe"
}
```

Replying to [comment:4 mkoeppe]:
>  I definitely want to distinguish `[]` from the default argument ...
> (`indices = []` must give a static-index MIP variable for which any component access is an error.)

I've added a doctest for this.

Ready for final review



---

archive/issue_comments_283636.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283636",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_283637.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283637",
    "user": "tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_283638.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-21T22:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20536#issuecomment-283638",
    "user": "vbraun"
}
```

Resolution: fixed
