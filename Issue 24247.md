# Issue 24247: nbconvert broken after the upgrade to Jupyter 5.2.1

Issue created by migration from https://trac.sagemath.org/ticket/24484

Original creator: egourgoulhon

Original creation time: 2018-01-07 16:03:49

CC:  nthiery slelievre embray

Keywords: jupyter, nbconvert

After the upgrade to Jupyter 5.2.1 implemented in #24168 (merged in Sage 8.2.beta0), the export of a notebook to another format fails, whatever the format. For instance, clicking on `File` -> `Download as` -> `PDF via LaTeX` leads to

```
500 : Internal Server Error

The error was:

Could not import nbconvert: No module named base
```



---

Comment by slelievre created at 2018-01-07 22:52:22

Adding outline of the fix to ticket description.
----
New commits:


---

Comment by egourgoulhon created at 2018-01-09 15:11:49

Is this ready for review?


---

Comment by vbraun created at 2018-01-09 21:24:47

no there is still a trail of dependencies... i stopped at html5lib for now.


---

Comment by nthiery created at 2018-02-08 16:17:02

Hi Volker,

For #23362, we need to upgrade pandocfilters too (and nothing else). Do you mind if we take over the two related diffs there?


---

Comment by nthiery created at 2018-02-08 16:47:54

Hi again:

To get things moving and for testing, I have pushed a branch with those diffs to #23362; waiting for your confirmation.

Strangely enough, I did not get the same checksums. You downloaded the tarbal from
https://github.com/jgm/pandocfilters/releases, right?

Cheers,
                   Nicolas


---

Comment by vbraun created at 2018-02-08 19:44:47

Feel free to move stuff to separate ticket. I got pandocfilters from https://pypi.python.org/pypi/pandocfilters which does list the same md5....


---

Comment by nthiery created at 2018-02-09 14:00:53

I see. Thanks for the feedback!

I had downloaded the tarball from github, according to the instructions in the SPKG.txt, and indeed the two tarballs differ slightly:

```
Seulement dans pandocfilters-1.4.2-github/examples: gabc-score.gabc
Seulement dans pandocfilters-1.4.2-github/examples: lilypond-score.ly
Seulement dans pandocfilters-1.4.2-github: .gitignore
Seulement dans pandocfilters-1.4.2-github: MANIFEST.in
Seulement dans pandocfilters-1.4.2-github: PACKAGING
Seulement dans pandocfilters-1.4.2: PKG-INFO
```


It's reasonable to use pypi as authoritative source since we want to stay close to a usual pip install. So I updated the instructions in SPKG.txt and reverted to your checksums in #23362.


---

Comment by vbraun created at 2018-02-09 14:50:35

Most likely, the github tarball is just the git repo whereas the file on pypi is the output of `setup.py sdist`.


---

Comment by embray created at 2018-04-03 12:25:58

I'll take care of finishing this up.


---

Comment by embray created at 2018-04-03 12:25:58

Set assignee to embray.


---

Comment by embray created at 2018-04-03 13:12:35

New commits:


---

Comment by embray created at 2018-04-03 13:16:47

Changing status from new to needs_review.


---

Comment by embray created at 2018-04-03 13:16:47

Rebased to incorporate #23362; added additional missing dependencies bleach, html5lib, and webencodings.

Confirmed that this fixed the issue for me.  I can now export notebooks in various formats.


---

Comment by egourgoulhon created at 2018-04-03 14:03:29

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2018-04-03 14:03:29

Many thanks for the fix!
I confirmed it works (Ubuntu 16.04); I simply had to install the Ubuntu package `textlive-xetex` to enable the PDF export. 
There remains the bug reported in #23330, but this is a separate issue (and definitively not a blocker).


---

Comment by vbraun created at 2018-04-07 18:03:21

Resolution: fixed
