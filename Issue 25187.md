# Issue 25187: Graphs: distance matrix and wrong error message

archive/issues_025187.json:
```json
{
    "body": "It seems from the code that the error message should be \"Input (di)graph must be (strongly) connected.\", but in reality `DiGraph(2).distance_matrix()` outputs `KeyError: 1`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25424\n\n",
    "created_at": "2018-05-22T13:01:41Z",
    "labels": [
        "graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Graphs: distance matrix and wrong error message",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25187",
    "user": "jmantysalo"
}
```
It seems from the code that the error message should be "Input (di)graph must be (strongly) connected.", but in reality `DiGraph(2).distance_matrix()` outputs `KeyError: 1`.

Issue created by migration from https://trac.sagemath.org/ticket/25424





---

archive/issue_comments_354669.json:
```json
{
    "body": "in the doc of `sage: dg.shortest_path_all_pairs?` one reads\n\n```\nNote: Only reachable vertices are present in the dictionaries.\n```\n\n\nAnd by the way, there is no domain for matrices with infinite entries..",
    "created_at": "2018-05-22T18:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354669",
    "user": "chapoton"
}
```

in the doc of `sage: dg.shortest_path_all_pairs?` one reads

```
Note: Only reachable vertices are present in the dictionaries.
```


And by the way, there is no domain for matrices with infinite entries..



---

archive/issue_comments_354670.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n\n> And by the way, there is no domain for matrices with infinite entries..\n\nWe do, try `Matrix(RR, [[Infinity, -Infinity], [42, 0]])`, but I don't suggest using that. I just suggest making the right error message to appear, as I wondered this for a while today.",
    "created_at": "2018-05-22T18:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354670",
    "user": "jmantysalo"
}
```

Replying to [comment:4 chapoton]:

> And by the way, there is no domain for matrices with infinite entries..

We do, try `Matrix(RR, [[Infinity, -Infinity], [42, 0]])`, but I don't suggest using that. I just suggest making the right error message to appear, as I wondered this for a while today.



---

archive/issue_comments_354671.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-23T05:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354671",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354672.json:
```json
{
    "body": "I guess `if d > n:` is not needed, but maybe there will be a version of `distance_all_pairs()` returning `Infinity` at some later point.\n----\nNew commits:",
    "created_at": "2018-05-23T05:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354672",
    "user": "jmantysalo"
}
```

I guess `if d > n:` is not needed, but maybe there will be a version of `distance_all_pairs()` returning `Infinity` at some later point.
----
New commits:



---

archive/issue_comments_354673.json:
```json
{
    "body": "In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.\n\nIf you want to return a matrix even if the graph is not (strongly)connected, then all distances should be set to `Infinity`.\n\n\nThere is a significant amount of work to be done for cleaning and unifying distance related methods. \n- The usage of weights (and the parameters) must be unified. We should have a method to check the consistency of weights with respect an input weight function. Currently, it is done inside several methods in different ways.\n- The `distance_matrix` method is for unweighted graphs only. It could be extended to weighted graphs. Also, this method transforms a dict of dicts to a matrix which is in my opinion very bad (consumes a lot of memory and slow down computations with extra transformations). We could go directly from low level representation to matrix when using a Cython or C++ implementation.\n- etc.",
    "created_at": "2018-05-23T06:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354673",
    "user": "dcoudert"
}
```

In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.

If you want to return a matrix even if the graph is not (strongly)connected, then all distances should be set to `Infinity`.


There is a significant amount of work to be done for cleaning and unifying distance related methods. 
- The usage of weights (and the parameters) must be unified. We should have a method to check the consistency of weights with respect an input weight function. Currently, it is done inside several methods in different ways.
- The `distance_matrix` method is for unweighted graphs only. It could be extended to weighted graphs. Also, this method transforms a dict of dicts to a matrix which is in my opinion very bad (consumes a lot of memory and slow down computations with extra transformations). We could go directly from low level representation to matrix when using a Cython or C++ implementation.
- etc.



---

archive/issue_comments_354674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-23T10:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354674",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354675.json:
```json
{
    "body": "Replying to [comment:9 dcoudert]:\n> In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.\n\nDone.\n\n> There is a significant amount of work to be done for cleaning and unifying distance related methods. \n\nTrue.",
    "created_at": "2018-05-23T10:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354675",
    "user": "jmantysalo"
}
```

Replying to [comment:9 dcoudert]:
> In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.

Done.

> There is a significant amount of work to be done for cleaning and unifying distance related methods. 

True.



---

archive/issue_comments_354676.json:
```json
{
    "body": "- for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.\n\n- Do you think that the description of the method is clear enough ? For me, this can be confusing: `whose rows and columns are indexed with the vertices` but this is not correct. Indeed, the ith row corresponds to the ith vertex in the ordering of `G.vertices()`, but `G.vertices()[i]` can be something else like `'a'`. \n\n  We could change like that\n\n```\nThe distance matrix of a (strongly) connected (di)graph is a matrix\nwhose rows and columns are indexed with the positions of the vertices\nof the (di)graph in the ordering ``G.vertices()``. The intersection\nof a row and a column contains the respective distance between the\nvertices indexed at these positions.\n```\n",
    "created_at": "2018-05-23T11:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354676",
    "user": "dcoudert"
}
```

- for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.

- Do you think that the description of the method is clear enough ? For me, this can be confusing: `whose rows and columns are indexed with the vertices` but this is not correct. Indeed, the ith row corresponds to the ith vertex in the ordering of `G.vertices()`, but `G.vertices()[i]` can be something else like `'a'`. 

  We could change like that

```
The distance matrix of a (strongly) connected (di)graph is a matrix
whose rows and columns are indexed with the positions of the vertices
of the (di)graph in the ordering ``G.vertices()``. The intersection
of a row and a column contains the respective distance between the
vertices indexed at these positions.
```




---

archive/issue_comments_354677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-23T11:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354677",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354678.json:
```json
{
    "body": "Replying to [comment:12 dcoudert]:\n> \n> - for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.\n\nTrue. Is just overlooked that.\n\n> - Do you think that the description of the method is clear enough ?\n\nGood point. I added your suggestion with additional note trying to make this crystal clear.",
    "created_at": "2018-05-23T11:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354678",
    "user": "jmantysalo"
}
```

Replying to [comment:12 dcoudert]:
> 
> - for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.

True. Is just overlooked that.

> - Do you think that the description of the method is clear enough ?

Good point. I added your suggestion with additional note trying to make this crystal clear.



---

archive/issue_comments_354679.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-23T11:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354679",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354680.json:
```json
{
    "body": "I like your modifications.",
    "created_at": "2018-05-23T11:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354680",
    "user": "dcoudert"
}
```

I like your modifications.



---

archive/issue_comments_354681.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-27T17:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25187#issuecomment-354681",
    "user": "vbraun"
}
```

Resolution: fixed
