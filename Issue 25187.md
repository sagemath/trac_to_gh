# Issue 25187: Graphs: distance matrix and wrong error message

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2018-05-22 13:01:41

It seems from the code that the error message should be "Input (di)graph must be (strongly) connected.", but in reality `DiGraph(2).distance_matrix()` outputs `KeyError: 1`.


---

Comment by chapoton created at 2018-05-22 18:39:36

in the doc of `sage: dg.shortest_path_all_pairs?` one reads

```
Note: Only reachable vertices are present in the dictionaries.
```


And by the way, there is no domain for matrices with infinite entries..


---

Comment by jmantysalo created at 2018-05-22 18:44:52

Replying to [comment:4 chapoton]:

> And by the way, there is no domain for matrices with infinite entries..

We do, try `Matrix(RR, [[Infinity, -Infinity], [42, 0]])`, but I don't suggest using that. I just suggest making the right error message to appear, as I wondered this for a while today.


---

Comment by jmantysalo created at 2018-05-23 05:58:36

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2018-05-23 05:58:36

I guess `if d > n:` is not needed, but maybe there will be a version of `distance_all_pairs()` returning `Infinity` at some later point.
----
New commits:


---

Comment by dcoudert created at 2018-05-23 06:23:50

In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.

If you want to return a matrix even if the graph is not (strongly)connected, then all distances should be set to `Infinity`.


There is a significant amount of work to be done for cleaning and unifying distance related methods. 
- The usage of weights (and the parameters) must be unified. We should have a method to check the consistency of weights with respect an input weight function. Currently, it is done inside several methods in different ways.
- The `distance_matrix` method is for unweighted graphs only. It could be extended to weighted graphs. Also, this method transforms a dict of dicts to a matrix which is in my opinion very bad (consumes a lot of memory and slow down computations with extra transformations). We could go directly from low level representation to matrix when using a Cython or C++ implementation.
- etc.


---

Comment by git created at 2018-05-23 10:03:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-05-23 10:05:58

Replying to [comment:9 dcoudert]:
> In this patch, you should add a connectivity test prior to the call to `distance_all_pairs`. It will be faster and cleaner.

Done.

> There is a significant amount of work to be done for cleaning and unifying distance related methods. 

True.


---

Comment by dcoudert created at 2018-05-23 11:16:22

- for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.

- Do you think that the description of the method is clear enough ? For me, this can be confusing: `whose rows and columns are indexed with the vertices` but this is not correct. Indeed, the ith row corresponds to the ith vertex in the ordering of `G.vertices()`, but `G.vertices()[i]` can be something else like `'a'`. 

  We could change like that

```
The distance matrix of a (strongly) connected (di)graph is a matrix
whose rows and columns are indexed with the positions of the vertices
of the (di)graph in the ordering ``G.vertices()``. The intersection
of a row and a column contains the respective distance between the
vertices indexed at these positions.
```



---

Comment by git created at 2018-05-23 11:29:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-05-23 11:30:14

Replying to [comment:12 dcoudert]:
> 
> - for the error message `Input (di)graph must be (strongly) connected.`, I though it should not start with a capital letter and not have a `.` at the end, but may be I misunderstood some rules.

True. Is just overlooked that.

> - Do you think that the description of the method is clear enough ?

Good point. I added your suggestion with additional note trying to make this crystal clear.


---

Comment by dcoudert created at 2018-05-23 11:44:33

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2018-05-23 11:44:33

I like your modifications.


---

Comment by vbraun created at 2018-05-27 17:01:26

Resolution: fixed
