# Issue 25396: Speed up LAT computation for SBoxes

archive/issues_025396.json:
```json
{
    "body": "CC:  tscrim\n\nKeywords: days94\n\nAs briefly discussed on ask.sagemath.org (https://ask.sagemath.org/question/42492/huge-delay-in-sagecryptosboxsbox-method-nonlinearity-introduced-in-v82/?answer=42505#post-id-42505), the implementation for computing the linear approximation table can be speed up.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25633\n\n",
    "created_at": "2018-06-21T17:46:05Z",
    "labels": [
        "cryptography",
        "major",
        "enhancement"
    ],
    "title": "Speed up LAT computation for SBoxes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25396",
    "user": "asante"
}
```
CC:  tscrim

Keywords: days94

As briefly discussed on ask.sagemath.org (https://ask.sagemath.org/question/42492/huge-delay-in-sagecryptosboxsbox-method-nonlinearity-introduced-in-v82/?answer=42505#post-id-42505), the implementation for computing the linear approximation table can be speed up.

Issue created by migration from https://trac.sagemath.org/ticket/25633





---

archive/issue_comments_358065.json:
```json
{
    "body": "Set assignee to asante.",
    "created_at": "2018-06-21T17:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358065",
    "user": "asante"
}
```

Set assignee to asante.



---

archive/issue_comments_358066.json:
```json
{
    "body": "This is a follow up ticket of #25516.",
    "created_at": "2018-06-25T08:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358066",
    "user": "asante"
}
```

This is a follow up ticket of #25516.



---

archive/issue_comments_358067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-01T14:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358067",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358068.json:
```json
{
    "body": "I've reset the branch, because the initial \"git del && git add\" poluted the diff (instead of doing a \"git mv\").",
    "created_at": "2018-07-01T14:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358068",
    "user": "asante"
}
```

I've reset the branch, because the initial "git del && git add" poluted the diff (instead of doing a "git mv").



---

archive/issue_comments_358069.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-01T15:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358069",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358070.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-01T15:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358070",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358071.json:
```json
{
    "body": "So, finally managed to delete the branch from my first attempt ~.~",
    "created_at": "2018-07-01T15:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358071",
    "user": "asante"
}
```

So, finally managed to delete the branch from my first attempt ~.~



---

archive/issue_comments_358072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358072",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T21:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T21:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358074",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T09:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358075",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358076.json:
```json
{
    "body": "I think the methods are now reasonable optimized. Computing the linear approximation matrix now takes roughly 40 to 80ms on my laptop -- note that this heavily depends on the scaling of the matrix in the end:\n\n\n```sage\nsage: for j in range(10):\n....:     S = [x for x in range(256)];shuffle(S)\n....:     S = sage.crypto.sbox.SBox(S)\n....:     %time _ = S.linear_approximation_matrix()\n....:     \nCPU times: user 180 ms, sys: 24 ms, total: 204 ms\nWall time: 191 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 84.6 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 85.2 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 84.5 ms\nCPU times: user 88 ms, sys: 0 ns, total: 88 ms\nWall time: 84.9 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 84.5 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 83.6 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 84.1 ms\nCPU times: user 88 ms, sys: 0 ns, total: 88 ms\nWall time: 85.9 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 85.3 ms\nsage: for j in range(10):\n....:     S = [x for x in range(256)];shuffle(S)\n....:     S = sage.crypto.sbox.SBox(S)\n....:     %time _ = S.linear_approximation_matrix(\"fourier_coefficient\")\n....:     \nCPU times: user 48 ms, sys: 0 ns, total: 48 ms\nWall time: 49.3 ms\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 42.6 ms\nCPU times: user 48 ms, sys: 0 ns, total: 48 ms\nWall time: 45.7 ms\nCPU times: user 40 ms, sys: 0 ns, total: 40 ms\nWall time: 40.6 ms\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 44.5 ms\nCPU times: user 40 ms, sys: 0 ns, total: 40 ms\nWall time: 40.5 ms\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 44.3 ms\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 41.7 ms\nCPU times: user 44 ms, sys: 0 ns, total: 44 ms\nWall time: 44.5 ms\nCPU times: user 40 ms, sys: 0 ns, total: 40 ms\nWall time: 40.9 ms\n```\n",
    "created_at": "2018-07-03T09:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358076",
    "user": "asante"
}
```

I think the methods are now reasonable optimized. Computing the linear approximation matrix now takes roughly 40 to 80ms on my laptop -- note that this heavily depends on the scaling of the matrix in the end:


```sage
sage: for j in range(10):
....:     S = [x for x in range(256)];shuffle(S)
....:     S = sage.crypto.sbox.SBox(S)
....:     %time _ = S.linear_approximation_matrix()
....:     
CPU times: user 180 ms, sys: 24 ms, total: 204 ms
Wall time: 191 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 84.6 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 85.2 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 84.5 ms
CPU times: user 88 ms, sys: 0 ns, total: 88 ms
Wall time: 84.9 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 84.5 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 83.6 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 84.1 ms
CPU times: user 88 ms, sys: 0 ns, total: 88 ms
Wall time: 85.9 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 85.3 ms
sage: for j in range(10):
....:     S = [x for x in range(256)];shuffle(S)
....:     S = sage.crypto.sbox.SBox(S)
....:     %time _ = S.linear_approximation_matrix("fourier_coefficient")
....:     
CPU times: user 48 ms, sys: 0 ns, total: 48 ms
Wall time: 49.3 ms
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 42.6 ms
CPU times: user 48 ms, sys: 0 ns, total: 48 ms
Wall time: 45.7 ms
CPU times: user 40 ms, sys: 0 ns, total: 40 ms
Wall time: 40.6 ms
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 44.5 ms
CPU times: user 40 ms, sys: 0 ns, total: 40 ms
Wall time: 40.5 ms
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 44.3 ms
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 41.7 ms
CPU times: user 44 ms, sys: 0 ns, total: 44 ms
Wall time: 44.5 ms
CPU times: user 40 ms, sys: 0 ns, total: 40 ms
Wall time: 40.9 ms
```




---

archive/issue_comments_358077.json:
```json
{
    "body": "Changing keywords from \"days94\" to \"cython, sbox, days94\".",
    "created_at": "2018-07-03T09:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358077",
    "user": "asante"
}
```

Changing keywords from "days94" to "cython, sbox, days94".



---

archive/issue_comments_358078.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-03T09:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358078",
    "user": "asante"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_358079.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T10:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358079",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358080.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-17T12:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358080",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-17T13:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358081",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-17T13:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358082",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-27T12:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358083",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-23T19:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358084",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358085.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-25T23:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358085",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358086.json:
```json
{
    "body": "Merge conflict. Once rebased on the latest beta, I will review this.",
    "created_at": "2018-11-25T23:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358086",
    "user": "tscrim"
}
```

Merge conflict. Once rebased on the latest beta, I will review this.



---

archive/issue_comments_358087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-26T12:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358087",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358088.json:
```json
{
    "body": "In #25708 some SBox class methods were deprecated.\nThese now throw an error, when called:\n\n\n```python\nsage: from sage.crypto.sbox import SBox\nsage: S = SBox(7,6,0,4,2,5,1,3)\nsage: S.difference_distribution_matrix()\n/home/asante/werkstatt/werkbank/sage/src/bin/sage-ipython:1: DeprecationWarning: difference_distribution_matrix is deprecated. Please use difference_distribution_table instead.\nSee https://trac.sagemath.org/25708 for details.\n  #!/usr/bin/env sage-python23\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-9af42cf79b34> in <module>()\n----> 1 S.difference_distribution_matrix()\n/home/asante/werkstatt/werkbank/sage/local/lib/python2.7/site-packages/sage/misc/superseded.pyc in __call__(self, *args, **kwds)\n    426             return self.func(*args, **kwds)\n    427         else:\n--> 428             return self.func(self.instance, *args, **kwds)\n    429\n    430     def __get__(self, inst, cls=None):\nTypeError: __call__() takes exactly 0 positional arguments (1 given)\n```\n\n\nShould I fix this within this ticket or create a new one?\nAnd does anyone has an idea whats wrong with this deprecation?\nThe new methods work as expected.\n----\nNew commits:",
    "created_at": "2018-11-26T12:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358088",
    "user": "asante"
}
```

In #25708 some SBox class methods were deprecated.
These now throw an error, when called:


```python
sage: from sage.crypto.sbox import SBox
sage: S = SBox(7,6,0,4,2,5,1,3)
sage: S.difference_distribution_matrix()
/home/asante/werkstatt/werkbank/sage/src/bin/sage-ipython:1: DeprecationWarning: difference_distribution_matrix is deprecated. Please use difference_distribution_table instead.
See https://trac.sagemath.org/25708 for details.
  #!/usr/bin/env sage-python23
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-9af42cf79b34> in <module>()
----> 1 S.difference_distribution_matrix()
/home/asante/werkstatt/werkbank/sage/local/lib/python2.7/site-packages/sage/misc/superseded.pyc in __call__(self, *args, **kwds)
    426             return self.func(*args, **kwds)
    427         else:
--> 428             return self.func(self.instance, *args, **kwds)
    429
    430     def __get__(self, inst, cls=None):
TypeError: __call__() takes exactly 0 positional arguments (1 given)
```


Should I fix this within this ticket or create a new one?
And does anyone has an idea whats wrong with this deprecation?
The new methods work as expected.
----
New commits:



---

archive/issue_comments_358089.json:
```json
{
    "body": "We should fix this within this ticket by not making it an alias but manually issuing the deprecation warning and calling the corresponding function. So something like this:\n\n```python\ndef difference_distribution_matrix(self):\n    \"\"\"\n    Deprecated in :trac:`25708` for :meth:`difference_distribution_table`.\n    \"\"\"\n    from sage.misc.superseded import deprecation\n    deprecation(25708, \"difference_distribution_matrix is deprecated. Please use difference_distribution_table instead.\")\n    return self.difference_distribution_table()\n```\n\nSince this is slated to be removed, it is not worth the time to add doctests.",
    "created_at": "2018-11-27T02:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358089",
    "user": "tscrim"
}
```

We should fix this within this ticket by not making it an alias but manually issuing the deprecation warning and calling the corresponding function. So something like this:

```python
def difference_distribution_matrix(self):
    """
    Deprecated in :trac:`25708` for :meth:`difference_distribution_table`.
    """
    from sage.misc.superseded import deprecation
    deprecation(25708, "difference_distribution_matrix is deprecated. Please use difference_distribution_table instead.")
    return self.difference_distribution_table()
```

Since this is slated to be removed, it is not worth the time to add doctests.



---

archive/issue_comments_358090.json:
```json
{
    "body": "Some comments:\n\n- Instead of using `long` and `int`, you should use the more machine-independent `Py_ssize_t` (unless you have a specific reason to limit the size, such as you know these must be small values).\n\n- In `_nterms`, it would be good to mark `total`, `divisor`, and `var_choices` as `Py_ssize_t`. Do you also want `var_choices/divisor` to be floor/integer division? If so, I think it is better to do `var_choices//divisor` to better emphasize this.\n\n- It might be better to not declare `i` to be a `bint` in `from_bits` as you never use that fact (so it avoids extra checks in Cython). Also, why is there even a `swp` function? Would it be better to just do\n  {{{#!python\n        if self._big_endian:\n            x = list(reversed(x))\n        return ZZ([i for i in self._rpad(swp(x), n)], 2)\n  }}}\n- Replace `[GF(2)(0)]` with `[GF(2).zero()]`.\n- Why are you converting to `ZZ` here `X = ZZ([ZZ(i) for i in X], 2)` when `i` is already an `int`? It might also be good to take care of this comment in `Integer`: `# should probably also have fast code for Python ints...` It actually seems like a good thing to factor the code to construct an integer from a bitstring out into a `cdef` helper function.\n- It seems redundant to call `vector` here `return K(vector(GF(2), out))`. Shouldn't `K` be able to handle `out`?\n- You could consider making `output_bits` into an array that you manually `alloc`/`free` so you will have better type control and can initialize without having to create a temp object to reverse it.\n- You could use the `get_unsafe` operations for `lat` and `act` (once you explicitly cast it as a `Matrix` object).\n- This is not correct: `cdef A = []`. I believe you want `cdef list A = []`.\n- Add the `cdef list` declaration: `cdef list L = [self(i) for i in range(1 << m)]`.\n- I would factor out the `substitute` into a `cdef` function and explicitly declare variable types.",
    "created_at": "2018-11-27T03:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358090",
    "user": "tscrim"
}
```

Some comments:

- Instead of using `long` and `int`, you should use the more machine-independent `Py_ssize_t` (unless you have a specific reason to limit the size, such as you know these must be small values).

- In `_nterms`, it would be good to mark `total`, `divisor`, and `var_choices` as `Py_ssize_t`. Do you also want `var_choices/divisor` to be floor/integer division? If so, I think it is better to do `var_choices//divisor` to better emphasize this.

- It might be better to not declare `i` to be a `bint` in `from_bits` as you never use that fact (so it avoids extra checks in Cython). Also, why is there even a `swp` function? Would it be better to just do
  {{{#!python
        if self._big_endian:
            x = list(reversed(x))
        return ZZ([i for i in self._rpad(swp(x), n)], 2)
  }}}
- Replace `[GF(2)(0)]` with `[GF(2).zero()]`.
- Why are you converting to `ZZ` here `X = ZZ([ZZ(i) for i in X], 2)` when `i` is already an `int`? It might also be good to take care of this comment in `Integer`: `# should probably also have fast code for Python ints...` It actually seems like a good thing to factor the code to construct an integer from a bitstring out into a `cdef` helper function.
- It seems redundant to call `vector` here `return K(vector(GF(2), out))`. Shouldn't `K` be able to handle `out`?
- You could consider making `output_bits` into an array that you manually `alloc`/`free` so you will have better type control and can initialize without having to create a temp object to reverse it.
- You could use the `get_unsafe` operations for `lat` and `act` (once you explicitly cast it as a `Matrix` object).
- This is not correct: `cdef A = []`. I believe you want `cdef list A = []`.
- Add the `cdef list` declaration: `cdef list L = [self(i) for i in range(1 << m)]`.
- I would factor out the `substitute` into a `cdef` function and explicitly declare variable types.



---

archive/issue_comments_358091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-27T09:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358092.json:
```json
{
    "body": "regarding the `cdef Py_ssize_t`, should I also change parts like the following?\n\n```python\ncdef int i\nx = [GF(2)(i) for i in ZZ(x).digits(base=2, padto=n)]\n```\n\n\n\nAnother thing that comes to my mind, when I see this part: I'm not so sure how helpful it actually is, to convert the digits to GF(2) elements, as we are only returning a list and not a vector.\n\nBut I guess changing this could cause some other code to break, so it may not be good to do so?",
    "created_at": "2018-11-27T09:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358092",
    "user": "asante"
}
```

regarding the `cdef Py_ssize_t`, should I also change parts like the following?

```python
cdef int i
x = [GF(2)(i) for i in ZZ(x).digits(base=2, padto=n)]
```



Another thing that comes to my mind, when I see this part: I'm not so sure how helpful it actually is, to convert the digits to GF(2) elements, as we are only returning a list and not a vector.

But I guess changing this could cause some other code to break, so it may not be good to do so?



---

archive/issue_comments_358093.json:
```json
{
    "body": "Replying to [comment:31 asante]:\n> regarding the `cdef Py_ssize_t`, should I also change parts like the following?\n> {{{\n> #!python\n> cdef int i\n> x = [GF(2)(i) for i in ZZ(x).digits(base=2, padto=n)]\n> }}}\n\nI don't see the benefit of saying/converting `i` to an `int` because the `GF(2)` element constructor does not use that information. So it essentially adds another useless check. Thus, I would remove the `cdef int i` altogether.\n\n> Another thing that comes to my mind, when I see this part: I'm not so sure how helpful it actually is, to convert the digits to GF(2) elements, as we are only returning a list and not a vector.\n\nA list is lightweight compared to a vector and implemented directly into the Python interpreter/language, so it is much faster.",
    "created_at": "2018-11-27T09:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358093",
    "user": "tscrim"
}
```

Replying to [comment:31 asante]:
> regarding the `cdef Py_ssize_t`, should I also change parts like the following?
> {{{
> #!python
> cdef int i
> x = [GF(2)(i) for i in ZZ(x).digits(base=2, padto=n)]
> }}}

I don't see the benefit of saying/converting `i` to an `int` because the `GF(2)` element constructor does not use that information. So it essentially adds another useless check. Thus, I would remove the `cdef int i` altogether.

> Another thing that comes to my mind, when I see this part: I'm not so sure how helpful it actually is, to convert the digits to GF(2) elements, as we are only returning a list and not a vector.

A list is lightweight compared to a vector and implemented directly into the Python interpreter/language, so it is much faster.



---

archive/issue_comments_358094.json:
```json
{
    "body": "OK. I added this `cdef int i` because, IIRC, Jeroen said that it is faster, because cython can then optimize the `for i in` loop stuff. But maybe I just misunderstood this and its only faster when doing something like `for i in range(...)`?\nBut OK, I'll just remove it then.\n\nRegarding the second point: should I remove the conversion to GF(2) then, or leave it?",
    "created_at": "2018-11-27T10:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358094",
    "user": "asante"
}
```

OK. I added this `cdef int i` because, IIRC, Jeroen said that it is faster, because cython can then optimize the `for i in` loop stuff. But maybe I just misunderstood this and its only faster when doing something like `for i in range(...)`?
But OK, I'll just remove it then.

Regarding the second point: should I remove the conversion to GF(2) then, or leave it?



---

archive/issue_comments_358095.json:
```json
{
    "body": "Replying to [comment:33 asante]:\n> OK. I added this `cdef int i` because, IIRC, Jeroen said that it is faster, because cython can then optimize the `for i in` loop stuff. But maybe I just misunderstood this and its only faster when doing something like `for i in range(...)`?\n> But OK, I'll just remove it then.\n\nYes, that is when it is faster because Cython converts it to a C `for` loop. It is also useful for when you are using the type declaration.\n\n> Regarding the second point: should I remove the conversion to GF(2) then, or leave it?\n\nIDK as this is outside of my area of math. If it is the object you return and mathematically it should be in `GF(2)`, then you should keep the conversion. I was merely commenting on your question above returning a list versus a vector.\n\nMicro-optimization:\n\n```python\nF = GF(2)\nx = [F(i) for i in ZZ(x).digits(base=2, padto=n)]\n```\n\nso you do not (re)create `GF(2)` on every call.",
    "created_at": "2018-11-27T10:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358095",
    "user": "tscrim"
}
```

Replying to [comment:33 asante]:
> OK. I added this `cdef int i` because, IIRC, Jeroen said that it is faster, because cython can then optimize the `for i in` loop stuff. But maybe I just misunderstood this and its only faster when doing something like `for i in range(...)`?
> But OK, I'll just remove it then.

Yes, that is when it is faster because Cython converts it to a C `for` loop. It is also useful for when you are using the type declaration.

> Regarding the second point: should I remove the conversion to GF(2) then, or leave it?

IDK as this is outside of my area of math. If it is the object you return and mathematically it should be in `GF(2)`, then you should keep the conversion. I was merely commenting on your question above returning a list versus a vector.

Micro-optimization:

```python
F = GF(2)
x = [F(i) for i in ZZ(x).digits(base=2, padto=n)]
```

so you do not (re)create `GF(2)` on every call.



---

archive/issue_comments_358096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-27T18:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358096",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358097.json:
```json
{
    "body": "I tried to commit the changes in logical parts, hopefully thats ok for reviewing.\n\nRegarding commit 24a8bbe 'clean up the SBox construction functions, as they duplicate some code' -- I'm not sure how to properly test the cdef functions used here. Are these indirect doctests ok or should I think about some better tests?",
    "created_at": "2018-11-27T18:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358097",
    "user": "asante"
}
```

I tried to commit the changes in logical parts, hopefully thats ok for reviewing.

Regarding commit 24a8bbe 'clean up the SBox construction functions, as they duplicate some code' -- I'm not sure how to properly test the cdef functions used here. Are these indirect doctests ok or should I think about some better tests?



---

archive/issue_comments_358098.json:
```json
{
    "body": "Replying to [comment:36 asante]:\n> I tried to commit the changes in logical parts, hopefully thats ok for reviewing.\n\nYes, that is good (both for reviewing and history, makes it easier to find when bugs might have been introduced; I am not as good as I should be with granularity of my commits...).\n\n> Regarding commit 24a8bbe 'clean up the SBox construction functions, as they duplicate some code' -- I'm not sure how to properly test the cdef functions used here. Are these indirect doctests ok or should I think about some better tests?\n\nIndirect doctests are good. Strictly speaking, I think our policy is `cdef` functions/methods do not need doctests, but it is better to have them when can be meaningful.",
    "created_at": "2018-11-27T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358098",
    "user": "tscrim"
}
```

Replying to [comment:36 asante]:
> I tried to commit the changes in logical parts, hopefully thats ok for reviewing.

Yes, that is good (both for reviewing and history, makes it easier to find when bugs might have been introduced; I am not as good as I should be with granularity of my commits...).

> Regarding commit 24a8bbe 'clean up the SBox construction functions, as they duplicate some code' -- I'm not sure how to properly test the cdef functions used here. Are these indirect doctests ok or should I think about some better tests?

Indirect doctests are good. Strictly speaking, I think our policy is `cdef` functions/methods do not need doctests, but it is better to have them when can be meaningful.



---

archive/issue_comments_358099.json:
```json
{
    "body": "As a data point for why `list` is faster:\n\n```\nsage: L = list(map(GF(2), [1,0,1,0,1]))\nsage: %timeit k(vector(L))\nThe slowest run took 896.22 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 81.6 \u00b5s per loop\nsage: %timeit k(L)\n10000 loops, best of 3: 22.5 \u00b5s per loop\n```\n\n\nI am planning to go through the files here this morning and see what other changes I can do to try and speed things up further. Do you have some computations you have been doing for timings of various parts (besides comment:16)? (I do not know anything of the mathematics, so I don't know what are meaningful examples.)",
    "created_at": "2018-11-27T22:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358099",
    "user": "tscrim"
}
```

As a data point for why `list` is faster:

```
sage: L = list(map(GF(2), [1,0,1,0,1]))
sage: %timeit k(vector(L))
The slowest run took 896.22 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 81.6 µs per loop
sage: %timeit k(L)
10000 loops, best of 3: 22.5 µs per loop
```


I am planning to go through the files here this morning and see what other changes I can do to try and speed things up further. Do you have some computations you have been doing for timings of various parts (besides comment:16)? (I do not know anything of the mathematics, so I don't know what are meaningful examples.)



---

archive/issue_comments_358100.json:
```json
{
    "body": "No I have no other timing checks. And its also quite late here, so I wont have much time for some experiments in the next few hours..\n\nFrom my intuition it might be worth to look for optimisations in the `__call__` method. I assume it is the most called method and the current input handling looks like it takes some time.. But I also do not know how to handle this more elegant.\n\nIt's basically only a array look up, but for sake of easier handling, we also want to support vector/list/tuple inputs (that encodes the array index as a binary string) or a finite field element (where the coefficient vector encodes the index as binary string, or, equivalent, the return value is the evaluation of the polynomial representation of the sbox).\n\nCurrently this is done with this try blocks, but I guess catching exceptions just to handle different input types might not be the fastest option.",
    "created_at": "2018-11-27T22:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358100",
    "user": "asante"
}
```

No I have no other timing checks. And its also quite late here, so I wont have much time for some experiments in the next few hours..

From my intuition it might be worth to look for optimisations in the `__call__` method. I assume it is the most called method and the current input handling looks like it takes some time.. But I also do not know how to handle this more elegant.

It's basically only a array look up, but for sake of easier handling, we also want to support vector/list/tuple inputs (that encodes the array index as a binary string) or a finite field element (where the coefficient vector encodes the index as binary string, or, equivalent, the return value is the evaluation of the polynomial representation of the sbox).

Currently this is done with this try blocks, but I guess catching exceptions just to handle different input types might not be the fastest option.



---

archive/issue_comments_358101.json:
```json
{
    "body": "Is this a bug? According to the docstring in `__call__`, it is:\n\n```\nsage: from sage.crypto.sbox import SBox\nsage: S = SBox([7,6,0,4,2,5,1,3])\nsage: k.<a> = GF(2^3)\nsage: vector(a^2)\n(0, 0, 1)\nsage: S([0,0,1])\n[1, 1, 0]\nsage: S(vector(a^2))\n[1, 1, 0]\nsage: S(a^2)  # From the docstring, this should be 1 + a\na\n```\n",
    "created_at": "2018-12-01T00:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358101",
    "user": "tscrim"
}
```

Is this a bug? According to the docstring in `__call__`, it is:

```
sage: from sage.crypto.sbox import SBox
sage: S = SBox([7,6,0,4,2,5,1,3])
sage: k.<a> = GF(2^3)
sage: vector(a^2)
(0, 0, 1)
sage: S([0,0,1])
[1, 1, 0]
sage: S(vector(a^2))
[1, 1, 0]
sage: S(a^2)  # From the docstring, this should be 1 + a
a
```




---

archive/issue_comments_358102.json:
```json
{
    "body": "Thanks for checking this. I stumbled across this during changing to cython.\nIn the end I was a bit confused and then forgot about this again. But I think you are right, it should be 1 + a.\n\nWhen fixing this thou, other doctests that rely on the current behaviour fail:\n\n\n\n```\n**********************************************************************\nFile \"src/sage/crypto/sbox.pyx\", line 1007, in sage.crypto.sbox.SBox.interpolation_polynomial\nFailed example:\n    f\nExpected:\n    x^6 + a*x^5 + (a + 1)*x^4 + (a^2 + a + 1)*x^3\n      + (a^2 + 1)*x^2 + (a + 1)*x + a^2 + a + 1\nGot:\n    (a^2 + a + 1)*x^6 + a^2*x^5 + (a + 1)*x^4 + (a^2 + a)*x^3 + x^2 + a*x + a^2 + a + 1\n**********************************************************************\nFile \"src/sage/crypto/sbox.pyx\", line 1759, in sage.crypto.sbox.SBox.is_monomial_function\nFailed example:\n    S.interpolation_polynomial()\nExpected:\n    (a + 1)*x^6 + (a^2 + a + 1)*x^5 + (a^2 + 1)*x^3\nGot:\n    (a + 1)*x^6 + (a^2 + a + 1)*x^5 + (a^2 + a)*x^4 + (a^2 + 1)*x^3 + a*x^2 + a*x\n**********************************************************************\nFile \"src/sage/crypto/sbox.pyx\", line 1763, in sage.crypto.sbox.SBox.is_monomial_function\nFailed example:\n    S.is_monomial_function()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/crypto/sbox.pyx\", line 1765, in sage.crypto.sbox.SBox.is_monomial_function\nFailed example:\n    S.interpolation_polynomial()\nExpected:\n    x^6\nGot:\n    (a^2 + a)*x^6 + (a + 1)*x^5 + (a + 1)*x^4 + (a^2 + a + 1)*x^3 + (a^2 + a)*x\n**********************************************************************\n```\n\n\nShould I change this doctests? This might also brake other code, could'nt it?",
    "created_at": "2018-12-06T10:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358102",
    "user": "asante"
}
```

Thanks for checking this. I stumbled across this during changing to cython.
In the end I was a bit confused and then forgot about this again. But I think you are right, it should be 1 + a.

When fixing this thou, other doctests that rely on the current behaviour fail:



```
**********************************************************************
File "src/sage/crypto/sbox.pyx", line 1007, in sage.crypto.sbox.SBox.interpolation_polynomial
Failed example:
    f
Expected:
    x^6 + a*x^5 + (a + 1)*x^4 + (a^2 + a + 1)*x^3
      + (a^2 + 1)*x^2 + (a + 1)*x + a^2 + a + 1
Got:
    (a^2 + a + 1)*x^6 + a^2*x^5 + (a + 1)*x^4 + (a^2 + a)*x^3 + x^2 + a*x + a^2 + a + 1
**********************************************************************
File "src/sage/crypto/sbox.pyx", line 1759, in sage.crypto.sbox.SBox.is_monomial_function
Failed example:
    S.interpolation_polynomial()
Expected:
    (a + 1)*x^6 + (a^2 + a + 1)*x^5 + (a^2 + 1)*x^3
Got:
    (a + 1)*x^6 + (a^2 + a + 1)*x^5 + (a^2 + a)*x^4 + (a^2 + 1)*x^3 + a*x^2 + a*x
**********************************************************************
File "src/sage/crypto/sbox.pyx", line 1763, in sage.crypto.sbox.SBox.is_monomial_function
Failed example:
    S.is_monomial_function()
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/crypto/sbox.pyx", line 1765, in sage.crypto.sbox.SBox.is_monomial_function
Failed example:
    S.interpolation_polynomial()
Expected:
    x^6
Got:
    (a^2 + a)*x^6 + (a + 1)*x^5 + (a + 1)*x^4 + (a^2 + a + 1)*x^3 + (a^2 + a)*x
**********************************************************************
```


Should I change this doctests? This might also brake other code, could'nt it?



---

archive/issue_comments_358103.json:
```json
{
    "body": "I knew these were failing, but I did not want to change them until I knew what the correct behavior was (specifically, if I switched the endianness, then the tests passed). I will change them as I continue my review. It is possible that it will break code in the wild, but I would treat that as a [spacebar](https://xkcd.com/1172/).",
    "created_at": "2018-12-06T13:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358103",
    "user": "tscrim"
}
```

I knew these were failing, but I did not want to change them until I knew what the correct behavior was (specifically, if I switched the endianness, then the tests passed). I will change them as I continue my review. It is possible that it will break code in the wild, but I would treat that as a [spacebar](https://xkcd.com/1172/).



---

archive/issue_comments_358104.json:
```json
{
    "body": "With my latest changes, I am getting a speedup from your last comment of `72ms` and `36ms` to `60ms` and `<22ms` respectively.\n\nSome other timings of current:\nwithout my last commit:\n\n```\nsage: from sage.crypto.sbox import SBox\nsage: S = SBox([7,6,0,4,2,5,1,3])\nsage: k.<a> = GF(2^3)\nsage: x = vector(a)\nsage: %timeit S([0,1,0])\n100000 loops, best of 3: 10.5 \u00b5s per loop\nsage: %timeit S(a)\n10000 loops, best of 3: 50.6 \u00b5s per loop\nsage: %timeit S(x)\n10000 loops, best of 3: 32.4 \u00b5s per loop\nsage: %timeit S(5)\n10000000 loops, best of 3: 138 ns per loop\n```\n\nvs your branch:\n\n```\nsage: %timeit S([0,1,0])\n100000 loops, best of 3: 14.5 \u00b5s per loop\nsage: %timeit S(a)\n10000 loops, best of 3: 65.3 \u00b5s per loop\nsage: %timeit S(x)\n10000 loops, best of 3: 33.9 \u00b5s per loop\nsage: %timeit S(5)\n1000000 loops, best of 3: 434 ns per loop\n```\n",
    "created_at": "2018-12-08T11:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358104",
    "user": "tscrim"
}
```

With my latest changes, I am getting a speedup from your last comment of `72ms` and `36ms` to `60ms` and `<22ms` respectively.

Some other timings of current:
without my last commit:

```
sage: from sage.crypto.sbox import SBox
sage: S = SBox([7,6,0,4,2,5,1,3])
sage: k.<a> = GF(2^3)
sage: x = vector(a)
sage: %timeit S([0,1,0])
100000 loops, best of 3: 10.5 µs per loop
sage: %timeit S(a)
10000 loops, best of 3: 50.6 µs per loop
sage: %timeit S(x)
10000 loops, best of 3: 32.4 µs per loop
sage: %timeit S(5)
10000000 loops, best of 3: 138 ns per loop
```

vs your branch:

```
sage: %timeit S([0,1,0])
100000 loops, best of 3: 14.5 µs per loop
sage: %timeit S(a)
10000 loops, best of 3: 65.3 µs per loop
sage: %timeit S(x)
10000 loops, best of 3: 33.9 µs per loop
sage: %timeit S(5)
1000000 loops, best of 3: 434 ns per loop
```




---

archive/issue_comments_358105.json:
```json
{
    "body": "With my last commit, I now get `50ms` and `13ms` respectively. Little tweaks and looking at the C code can go a long way. `:)`",
    "created_at": "2018-12-08T11:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358105",
    "user": "tscrim"
}
```

With my last commit, I now get `50ms` and `13ms` respectively. Little tweaks and looking at the C code can go a long way. `:)`



---

archive/issue_comments_358106.json:
```json
{
    "body": "Okay, I have done what I can other than special casing the bit in/output for `ZZ`. Yet, I think this is good for now.\n\nHowever, I would like verification from someone else who does use the **F**<sub>2</sub> call input to the SBox to verify that the docstring was indeed how it was suppose to be treated. Subsequently, I would like verification about the corresponding doctests that needed to be changed.\n----\nNew commits:",
    "created_at": "2018-12-08T11:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358106",
    "user": "tscrim"
}
```

Okay, I have done what I can other than special casing the bit in/output for `ZZ`. Yet, I think this is good for now.

However, I would like verification from someone else who does use the **F**<sub>2</sub> call input to the SBox to verify that the docstring was indeed how it was suppose to be treated. Subsequently, I would like verification about the corresponding doctests that needed to be changed.
----
New commits:



---

archive/issue_comments_358107.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-08T11:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358107",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-08T11:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358108",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358109.json:
```json
{
    "body": "I took care of two other todo points I mentioned above. Now I am done.",
    "created_at": "2018-12-08T11:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358109",
    "user": "tscrim"
}
```

I took care of two other todo points I mentioned above. Now I am done.



---

archive/issue_comments_358110.json:
```json
{
    "body": "Thanks for your work :)\n\nIs the change in rings/integer.pyx on purpose within this ticket?\n\nApart from that, LGTM. I'll see if I can find someone who used the interpolation stuff (maybe Martin Albrecht did).",
    "created_at": "2018-12-19T14:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358110",
    "user": "asante"
}
```

Thanks for your work :)

Is the change in rings/integer.pyx on purpose within this ticket?

Apart from that, LGTM. I'll see if I can find someone who used the interpolation stuff (maybe Martin Albrecht did).



---

archive/issue_comments_358111.json:
```json
{
    "body": "Replying to [comment:48 asante]:\n> Thanks for your work :)\n\nNo problem.\n\n> Is the change in rings/integer.pyx on purpose within this ticket?\n\nYes, it is.\n\n> Apart from that, LGTM. I'll see if I can find someone who used the interpolation stuff (maybe Martin Albrecht did).\n\nGreat, thank you. Looks like we will need to rebase the branch on the latest version before finalizing this, but that should be trivial.",
    "created_at": "2018-12-19T23:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358111",
    "user": "tscrim"
}
```

Replying to [comment:48 asante]:
> Thanks for your work :)

No problem.

> Is the change in rings/integer.pyx on purpose within this ticket?

Yes, it is.

> Apart from that, LGTM. I'll see if I can find someone who used the interpolation stuff (maybe Martin Albrecht did).

Great, thank you. Looks like we will need to rebase the branch on the latest version before finalizing this, but that should be trivial.



---

archive/issue_comments_358112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-19T23:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358112",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358113.json:
```json
{
    "body": "I just did the trivial rebase.",
    "created_at": "2018-12-19T23:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358113",
    "user": "tscrim"
}
```

I just did the trivial rebase.



---

archive/issue_comments_358114.json:
```json
{
    "body": "So in order to get this ticket closed at some point and as https://groups.google.com/forum/#!searchin/sage-devel/sbox$20interpolation_polynomial%7Csort:date/sage-devel/_fLVL-r4B7Q/KnxL9WnyBQAJ did not really resulted in a final decision, should we go with Martin's suggestion and keep the current behaviour, and discuss it in the docs?",
    "created_at": "2019-06-16T20:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358114",
    "user": "asante"
}
```

So in order to get this ticket closed at some point and as https://groups.google.com/forum/#!searchin/sage-devel/sbox$20interpolation_polynomial%7Csort:date/sage-devel/_fLVL-r4B7Q/KnxL9WnyBQAJ did not really resulted in a final decision, should we go with Martin's suggestion and keep the current behaviour, and discuss it in the docs?



---

archive/issue_comments_358115.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-01-10T21:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358115",
    "user": "asante"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358116.json:
```json
{
    "body": "As there was no more reaction, I'd go with Martins suggestion: \"If it\u2019s all the same, perhaps keeping the current behaviour (and changing the documentation) is the strategy of least surprise?\"\n\nI'll try to work on this in the next days.",
    "created_at": "2022-01-10T21:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358116",
    "user": "asante"
}
```

As there was no more reaction, I'd go with Martins suggestion: "If it’s all the same, perhaps keeping the current behaviour (and changing the documentation) is the strategy of least surprise?"

I'll try to work on this in the next days.



---

archive/issue_comments_358117.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-11T18:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358117",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358118.json:
```json
{
    "body": "That is fine with me. (I don't have any stake in this as I don't use this code.)",
    "created_at": "2022-01-13T00:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358118",
    "user": "tscrim"
}
```

That is fine with me. (I don't have any stake in this as I don't use this code.)



---

archive/issue_comments_358119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-13T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358119",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-14T20:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358120",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358121.json:
```json
{
    "body": "I'd say its ready for review - however since I worked on a ticket for the last time, this new lint button seems to be introduced, which says 'failing'.\n\nCan someone tell me how to use this, so that I can find out what to fix? Thanks in advance!",
    "created_at": "2022-01-14T21:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358121",
    "user": "asante"
}
```

I'd say its ready for review - however since I worked on a ticket for the last time, this new lint button seems to be introduced, which says 'failing'.

Can someone tell me how to use this, so that I can find out what to fix? Thanks in advance!



---

archive/issue_comments_358122.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-01-15T01:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358122",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358123.json:
```json
{
    "body": "I wouldn't worry too much about it. Setting to needs review to get the patchbot to look at this. Have you reverted the behavior? I don't see those changes, but maybe I missed something.",
    "created_at": "2022-01-15T01:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358123",
    "user": "tscrim"
}
```

I wouldn't worry too much about it. Setting to needs review to get the patchbot to look at this. Have you reverted the behavior? I don't see those changes, but maybe I missed something.



---

archive/issue_comments_358124.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-15T21:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358124",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358125.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-15T21:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358125",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358126.json:
```json
{
    "body": "Yes you are right.\n\nI agree with your changes, that `interpolation_polynomial` should directly use `__call__`.\nHowever, changing the endianness for the finite field input inside the call function breaks a lot of stuff at other places.\n\nThus, I'd propose to (instead of what suggested by Martin and mentioned by me above) keep the documented behaviour.",
    "created_at": "2022-01-15T21:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358126",
    "user": "asante"
}
```

Yes you are right.

I agree with your changes, that `interpolation_polynomial` should directly use `__call__`.
However, changing the endianness for the finite field input inside the call function breaks a lot of stuff at other places.

Thus, I'd propose to (instead of what suggested by Martin and mentioned by me above) keep the documented behaviour.



---

archive/issue_comments_358127.json:
```json
{
    "body": "I think there was a pair of changes I needed to make, but it has been too long for me to remember exactly. While there might be some doctests that break, only the ones that were touched could potentially be reset. Anyways, if you are happy with the current behavior, then I will set a positive review assuming there are no other objections (and a green patchbot).\n\nOne trivial change needed before that though:\n\n```diff\n-NOTE:\n+.. NOTE::\n```\n",
    "created_at": "2022-01-16T03:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358127",
    "user": "tscrim"
}
```

I think there was a pair of changes I needed to make, but it has been too long for me to remember exactly. While there might be some doctests that break, only the ones that were touched could potentially be reset. Anyways, if you are happy with the current behavior, then I will set a positive review assuming there are no other objections (and a green patchbot).

One trivial change needed before that though:

```diff
-NOTE:
+.. NOTE::
```




---

archive/issue_comments_358128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-17T21:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358128",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358129.json:
```json
{
    "body": "Thanks. I think this will be good for now. It should be relatively easy to revert the change if necessary (such as people disagree with it). I am slightly wondering if we want to put a note in the doc about this ticket with the change. Either way you decide, you can set a positive review (on my behalf if you add the note).",
    "created_at": "2022-01-23T10:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358129",
    "user": "tscrim"
}
```

Thanks. I think this will be good for now. It should be relatively easy to revert the change if necessary (such as people disagree with it). I am slightly wondering if we want to put a note in the doc about this ticket with the change. Either way you decide, you can set a positive review (on my behalf if you add the note).



---

archive/issue_comments_358130.json:
```json
{
    "body": "OK cool.\n\nRegarding the note in the doc: I added the following note to the docstring of `interpolation_polynomial`. Do you have something else in mind?\n\n\n```diff\n\ndiff --git a/src/sage/crypto/sbox.pyx b/src/sage/crypto/sbox.pyx\n--- a/src/sage/crypto/sbox.pyx\n+++ b/src/sage/crypto/sbox.pyx\n@@ -1044,6 +1044,12 @@ cdef class SBox(SageObject):\n             sage: f(a^2 + 1), S(5)\n             (a^2 + 1, 5)\n+\n+        ..NOTE::\n+\n+            The method-internal call to the S-box initially used a different\n+            endianess for handling finite field elements. This changed in\n+            https://trac.sagemath.org/ticket/25633, by calling the S-box directly.\n         \"\"\"\n         if self.m != self.n:\n             raise TypeError(\"Lagrange interpolation only supported if\"\n\n```\n",
    "created_at": "2022-01-23T11:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358130",
    "user": "asante"
}
```

OK cool.

Regarding the note in the doc: I added the following note to the docstring of `interpolation_polynomial`. Do you have something else in mind?


```diff

diff --git a/src/sage/crypto/sbox.pyx b/src/sage/crypto/sbox.pyx
--- a/src/sage/crypto/sbox.pyx
+++ b/src/sage/crypto/sbox.pyx
@@ -1044,6 +1044,12 @@ cdef class SBox(SageObject):
             sage: f(a^2 + 1), S(5)
             (a^2 + 1, 5)
+
+        ..NOTE::
+
+            The method-internal call to the S-box initially used a different
+            endianess for handling finite field elements. This changed in
+            https://trac.sagemath.org/ticket/25633, by calling the S-box directly.
         """
         if self.m != self.n:
             raise TypeError("Lagrange interpolation only supported if"

```




---

archive/issue_comments_358131.json:
```json
{
    "body": "Ah, right. No that is good other than using `:trac:`25633`` instead of the explicit trac link.",
    "created_at": "2022-01-23T11:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358131",
    "user": "tscrim"
}
```

Ah, right. No that is good other than using `:trac:`25633`` instead of the explicit trac link.



---

archive/issue_comments_358132.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T12:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358132",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T12:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358133",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358134.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-23T12:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358134",
    "user": "asante"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_358135.json:
```json
{
    "body": "Perfect, I wasn't aware of that macro.\nSetting it to *positive review* then.",
    "created_at": "2022-01-23T12:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358135",
    "user": "asante"
}
```

Perfect, I wasn't aware of that macro.
Setting it to *positive review* then.



---

archive/issue_comments_358136.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-31T23:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358136",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_358137.json:
```json
{
    "body": "This breaks the Cygwin build:\n\n```\n[ 74/529] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -g -O2 -I./sage/cpython -I/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/site-packages/cysignals -I/cygdrive/d/a/sage/sage/pkgs/sagemath-standard -I/usr/include/python3.8 -I/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/opt/sage-3c8073266a16294562cd0273556664c883917216/include -I/usr/include/python3.8 -c build/cythonized/sage/crypto/sbox.c -o build/temp.cygwin-3.3.4-x86_64-3.8/build/cythonized/sage/crypto/sbox.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=gnu99\ngcc -shared -Wl,--enable-auto-image-base -L/opt/sage-3c8073266a16294562cd0273556664c883917216/lib -Wl,-rpath,/opt/sage-3c8073266a16294562cd0273556664c883917216/lib -g -O2 build/temp.cygwin-3.3.4-x86_64-3.8/build/cythonized/sage/cpython/wrapperdescr.o -L/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/config -L/usr/lib -lpython3.8 -o build/lib.cygwin-3.3.4-x86_64-3.8/sage/cpython/wrapperdescr.cpython-38-x86_64-cygwin.dll\nIn file included from /usr/include/python3.8/unicodeobject.h:58,\n                 from /usr/include/python3.8/Python.h:97,\n                 from build/cythonized/sage/crypto/sbox.c:45:\nbuild/cythonized/sage/crypto/sbox.c:1642:13: error: expected identifier or \u2018(\u2019 before numeric constant\n 1642 |   PyObject *_S;\n      |             ^~\nIn file included from /usr/include/python3.8/pytime.h:6,\n                 from /usr/include/python3.8/Python.h:85,\n                 from build/cythonized/sage/crypto/sbox.c:45:\nbuild/cythonized/sage/crypto/sbox.c: In function \u2018__pyx_pf_4sage_6crypto_4sbox_4SBox___init__\u2019:\nbuild/cythonized/sage/crypto/sbox.c:4577:30: error: expected identifier before numeric constant\n 4577 |   __Pyx_DECREF(__pyx_v_self->_S);\n      |                              ^~\n```\n\nhttps://github.com/mkoeppe/sage/runs/5054706036?check_suite_focus=true",
    "created_at": "2022-02-03T19:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358137",
    "user": "mkoeppe"
}
```

This breaks the Cygwin build:

```
[ 74/529] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -g -O2 -I./sage/cpython -I/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/site-packages/cysignals -I/cygdrive/d/a/sage/sage/pkgs/sagemath-standard -I/usr/include/python3.8 -I/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/opt/sage-3c8073266a16294562cd0273556664c883917216/include -I/usr/include/python3.8 -c build/cythonized/sage/crypto/sbox.c -o build/temp.cygwin-3.3.4-x86_64-3.8/build/cythonized/sage/crypto/sbox.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=gnu99
gcc -shared -Wl,--enable-auto-image-base -L/opt/sage-3c8073266a16294562cd0273556664c883917216/lib -Wl,-rpath,/opt/sage-3c8073266a16294562cd0273556664c883917216/lib -g -O2 build/temp.cygwin-3.3.4-x86_64-3.8/build/cythonized/sage/cpython/wrapperdescr.o -L/opt/sage-3c8073266a16294562cd0273556664c883917216/lib/python3.8/config -L/usr/lib -lpython3.8 -o build/lib.cygwin-3.3.4-x86_64-3.8/sage/cpython/wrapperdescr.cpython-38-x86_64-cygwin.dll
In file included from /usr/include/python3.8/unicodeobject.h:58,
                 from /usr/include/python3.8/Python.h:97,
                 from build/cythonized/sage/crypto/sbox.c:45:
build/cythonized/sage/crypto/sbox.c:1642:13: error: expected identifier or ‘(’ before numeric constant
 1642 |   PyObject *_S;
      |             ^~
In file included from /usr/include/python3.8/pytime.h:6,
                 from /usr/include/python3.8/Python.h:85,
                 from build/cythonized/sage/crypto/sbox.c:45:
build/cythonized/sage/crypto/sbox.c: In function ‘__pyx_pf_4sage_6crypto_4sbox_4SBox___init__’:
build/cythonized/sage/crypto/sbox.c:4577:30: error: expected identifier before numeric constant
 4577 |   __Pyx_DECREF(__pyx_v_self->_S);
      |                              ^~
```

https://github.com/mkoeppe/sage/runs/5054706036?check_suite_focus=true



---

archive/issue_comments_358138.json:
```json
{
    "body": "This is likely from a clash with an unfortunately named macro from a system header file\n\n(see https://eigen.tuxfamily.org/bz/show_bug.cgi?id=658)",
    "created_at": "2022-02-03T19:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358138",
    "user": "mkoeppe"
}
```

This is likely from a clash with an unfortunately named macro from a system header file

(see https://eigen.tuxfamily.org/bz/show_bug.cgi?id=658)



---

archive/issue_comments_358139.json:
```json
{
    "body": "Should I take care of fixing this?",
    "created_at": "2022-02-03T19:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358139",
    "user": "asante"
}
```

Should I take care of fixing this?



---

archive/issue_comments_358140.json:
```json
{
    "body": "That would be great. Since the ticket has already been closed, it would be best done in a follow-up ticket",
    "created_at": "2022-02-03T20:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358140",
    "user": "mkoeppe"
}
```

That would be great. Since the ticket has already been closed, it would be best done in a follow-up ticket



---

archive/issue_comments_358141.json:
```json
{
    "body": "Ok. I opened #33284 for this.",
    "created_at": "2022-02-03T20:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358141",
    "user": "asante"
}
```

Ok. I opened #33284 for this.



---

archive/issue_comments_358142.json:
```json
{
    "body": "usage of six is no longer allowed. See #33350",
    "created_at": "2022-02-15T13:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25396#issuecomment-358142",
    "user": "chapoton"
}
```

usage of six is no longer allowed. See #33350
