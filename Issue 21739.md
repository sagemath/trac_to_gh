# Issue 21739: multivariate laurent polynomial constructor: shortcuts for speedup

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-11-26 15:25:26

At the moment, (many) multivariate laurent polynomials and their rings are expensively converted when passed through `_element_constructor_`. The aim of this ticket is to detect a couple of special cases, where this can be done more directly, e.g., if the to-be-converted element has the same parent or the same polynomial ring as the laurent polynomial ring.


---

Comment by dkrenn created at 2016-11-26 15:26:44

Last 10 new commits:


---

Comment by dkrenn created at 2016-11-26 15:26:44

Changing status from new to needs_review.


---

Comment by git created at 2017-02-09 09:06:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2017-02-22 15:02:21

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2017-02-22 15:02:21

1. Please test new argument `mon` for `_element_constructor_`
2. Please break long lines.


---

Comment by tscrim created at 2017-02-26 21:58:35

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-02-26 21:58:35

Added, as well as some other tweaks and changes for speed and clarity.
----
New commits:


---

Comment by dkrenn created at 2017-02-28 08:02:21

Replying to [comment:5 tscrim]:
> Added, as well as some other tweaks and changes for speed and clarity.

Looks good. I have two questions:


```
-        if P is self:
-            return x
```

Shouldn't we have this speedup (as there is really nothing to do in this case)?


```
-        elif P == self:
-            return element_class(self, x)
```

Skipping this indeed will result in the same behavior. A question: Should we keep this after all in the spirit of "Explicit is better than implicit"?


---

Comment by tscrim created at 2017-02-28 15:19:42

Those are both never called because the coercion framework takes care of those cases on its own before ever getting to `_element_constructor_`. So they just become wasted CPU cycles.


---

Comment by tscrim created at 2017-02-28 15:23:57

Actually, the `P == self` case could possibly come up, but you have to do strange things with pickling. I also see that as more a problem with the fact that `LaurentPolynomialRing` doesn't implement true `UniqueRepresentation` behavior:

```
sage: R.<x,y,z> = LaurentPolynomialRing(ZZ)
sage: S.<x,y,z> = LaurentPolynomialRing(ZZ)
sage: S is R
True
sage: S = loads(dumps(R))
sage: S == R
True
sage: S is R
False
```



---

Comment by dkrenn created at 2017-03-02 11:35:35

Replying to [comment:7 tscrim]:
> Those are both never called because the coercion framework takes care of those cases on its own before ever getting to `_element_constructor_`. So they just become wasted CPU cycles.

Oh, good to know. They, let's skip them.


---

Comment by dkrenn created at 2017-03-02 11:37:04

Replying to [comment:8 tscrim]:
> Actually, the `P == self` case could possibly come up, but you have to do strange things with pickling. I also see that as more a problem with the fact that `LaurentPolynomialRing` doesn't implement true `UniqueRepresentation` behavior:
> {{{
> sage: R.<x,y,z> = LaurentPolynomialRing(ZZ)
> sage: S.<x,y,z> = LaurentPolynomialRing(ZZ)
> sage: S is R
> True
> sage: S = loads(dumps(R))
> sage: S == R
> True
> sage: S is R
> False
> }}}

I suggest to open a separate ticket for this pickling and unique representation issues.


---

Comment by dkrenn created at 2017-03-02 11:41:28

From my side this ticket is positively (cross) reviewed. (About authorship: `@`Travis, do you want yourself to be added as author? If so, I would add my self as a reviewer (for the cross-reviewing); and we could bring this ticket to an end.)


---

Comment by tscrim created at 2017-03-02 13:35:13

I agree that we should have the `UniqueRepresentation` issue as a separate ticket (likely we will have to do all polynomial rings at once). I also don't think I've done enough to warrant being an author, so I'm setting a positive review. Thank you!


---

Comment by tscrim created at 2017-03-02 13:35:13

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2017-03-02 13:44:21

Replying to [comment:12 tscrim]:
> I agree that we should have the `UniqueRepresentation` issue as a separate ticket (likely we will have to do all polynomial rings at once). I also don't think I've done enough to warrant being an author, so I'm setting a positive review. Thank you!

Ok, thank you.


---

Comment by vbraun created at 2017-03-03 21:19:49

Resolution: fixed
