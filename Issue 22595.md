# Issue 22595: Add an option to the test runner to exit immediately upon the first failure

Issue created by migration from https://trac.sagemath.org/ticket/22832

Original creator: embray

Original creation time: 2017-04-19 11:41:36

Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.

I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.


---

Comment by embray created at 2017-04-19 11:42:05

New commits:


---

Comment by embray created at 2017-04-19 11:42:05

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-04-19 12:32:02

Replying to [ticket:22832 embray]:
> Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.

Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.


---

Comment by jdemeyer created at 2017-04-19 12:42:18

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-04-19 12:42:18

I'm making some changes, hang on...


---

Comment by jdemeyer created at 2017-04-19 15:03:42

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-04-19 15:03:42

New commits:


---

Comment by embray created at 2017-04-20 09:09:00

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-04-20 09:09:00

I'm fine with that, thanks.


---

Comment by embray created at 2017-04-20 09:22:10

Replying to [comment:2 jdemeyer]:
> Replying to [ticket:22832 embray]:
> > Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.
> 
> Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.

I personally find "fail once" to be clearer than "exit first"--"Exit first what?" is what it makes me ask.  That said, the documentation makes it clear enough, and I don't mind the consistency.


---

Comment by embray created at 2017-04-20 09:31:08

Oops, one little nitpick--you forgot to remove the line `fail_immediately=False` after renaming it to `abort_now` everywhere else.


---

Comment by embray created at 2017-04-20 09:31:08

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-04-20 09:34:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-04-20 09:36:03

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-04-23 12:57:20

Resolution: fixed
