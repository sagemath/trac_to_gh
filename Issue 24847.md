# Issue 24847: change _invert_unit to inverse_of_unit on integer matrices

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2018-04-03 06:56:36

CC:  slelievre




---

Comment by vdelecroix created at 2018-04-03 07:02:49

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-04-03 07:02:49

New commits:


---

Comment by slelievre created at 2018-04-03 08:58:36

These are not changes from this ticket, but while we're focused on this piece of code...

When the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.

I would replace the method's description at the start of the docstring from the current


```
If self is a matrix with determinant `1` or `-1` return the inverse of
``self`` as a matrix over `ZZ`.
```


to the following:


```
Return the inverse of this matrix as a matrix over `ZZ`.

If the matrix is not invertible over `ZZ`, a value error is raised.
```



---

Comment by slabbe created at 2018-04-03 19:58:07

I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:


```python
>>> (0)**-1
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: 0.0 cannot be raised to a negative power

sage: 0^-1
Traceback (most recent call last)
...
ZeroDivisionError: rational division by zero

sage: A = Integers(6)
sage: a = A(2)
sage: a^-1
Traceback (most recent call last)
...
ZeroDivisionError: Inverse does not exist.
```



---

Comment by slelievre created at 2018-04-03 20:07:10

Thanks `@`slabbe for these illuminating comparisons. You are right...
Failing to invert a matrix amounts to having to divide by zero in the
echelonization and reduction process of the matrix augmented by the
identity matrix. Or, when applying a formula such as "inverse of
determinant times transpose of comatrix", with a zero determinant,
having to invert zero, ie dividing (the base ring's one) by zero
(the determinant). So I withdraw my suggestion to replace
`ZeroDivisionError` by `ValueError`.


---

Comment by vdelecroix created at 2018-04-03 22:45:36

Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in

```
sage: 2.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
sage: 0.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
```



---

Comment by git created at 2018-04-03 22:48:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-09-02 01:27:16

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-09-02 01:37:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-09-02 01:38:20

rebased with doctests fixed


---

Comment by vdelecroix created at 2018-09-02 01:38:20

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-10-31 12:26:19

ok


---

Comment by chapoton created at 2018-10-31 12:26:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-11-01 00:58:57

Resolution: fixed


---

Comment by mkoeppe created at 2021-08-24 22:24:00

Removed in #32417
