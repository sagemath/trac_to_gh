# Issue 24847: change _invert_unit to inverse_of_unit on integer matrices

archive/issues_024847.json:
```json
{
    "body": "CC:  slelievre\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25084\n\n",
    "created_at": "2018-04-03T06:56:36Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "title": "change _invert_unit to inverse_of_unit on integer matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24847",
    "user": "vdelecroix"
}
```
CC:  slelievre



Issue created by migration from https://trac.sagemath.org/ticket/25084





---

archive/issue_comments_348964.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348964",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348965.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348965",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_348966.json:
```json
{
    "body": "These are not changes from this ticket, but while we're focused on this piece of code...\n\nWhen the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.\n\nI would replace the method's description at the start of the docstring from the current\n\n\n```\nIf self is a matrix with determinant `1` or `-1` return the inverse of\n``self`` as a matrix over `ZZ`.\n```\n\n\nto the following:\n\n\n```\nReturn the inverse of this matrix as a matrix over `ZZ`.\n\nIf the matrix is not invertible over `ZZ`, a value error is raised.\n```\n",
    "created_at": "2018-04-03T08:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348966",
    "user": "slelievre"
}
```

These are not changes from this ticket, but while we're focused on this piece of code...

When the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.

I would replace the method's description at the start of the docstring from the current


```
If self is a matrix with determinant `1` or `-1` return the inverse of
``self`` as a matrix over `ZZ`.
```


to the following:


```
Return the inverse of this matrix as a matrix over `ZZ`.

If the matrix is not invertible over `ZZ`, a value error is raised.
```




---

archive/issue_comments_348967.json:
```json
{
    "body": "I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:\n\n\n```python\n>>> (0)**-1\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nZeroDivisionError: 0.0 cannot be raised to a negative power\n\nsage: 0^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: rational division by zero\n\nsage: A = Integers(6)\nsage: a = A(2)\nsage: a^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: Inverse does not exist.\n```\n",
    "created_at": "2018-04-03T19:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348967",
    "user": "slabbe"
}
```

I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:


```python
>>> (0)**-1
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: 0.0 cannot be raised to a negative power

sage: 0^-1
Traceback (most recent call last)
...
ZeroDivisionError: rational division by zero

sage: A = Integers(6)
sage: a = A(2)
sage: a^-1
Traceback (most recent call last)
...
ZeroDivisionError: Inverse does not exist.
```




---

archive/issue_comments_348968.json:
```json
{
    "body": "Thanks `@`slabbe for these illuminating comparisons. You are right...\nFailing to invert a matrix amounts to having to divide by zero in the\nechelonization and reduction process of the matrix augmented by the\nidentity matrix. Or, when applying a formula such as \"inverse of\ndeterminant times transpose of comatrix\", with a zero determinant,\nhaving to invert zero, ie dividing (the base ring's one) by zero\n(the determinant). So I withdraw my suggestion to replace\n`ZeroDivisionError` by `ValueError`.",
    "created_at": "2018-04-03T20:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348968",
    "user": "slelievre"
}
```

Thanks `@`slabbe for these illuminating comparisons. You are right...
Failing to invert a matrix amounts to having to divide by zero in the
echelonization and reduction process of the matrix augmented by the
identity matrix. Or, when applying a formula such as "inverse of
determinant times transpose of comatrix", with a zero determinant,
having to invert zero, ie dividing (the base ring's one) by zero
(the determinant). So I withdraw my suggestion to replace
`ZeroDivisionError` by `ValueError`.



---

archive/issue_comments_348969.json:
```json
{
    "body": "Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in\n\n```\nsage: 2.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\nsage: 0.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\n```\n",
    "created_at": "2018-04-03T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348969",
    "user": "vdelecroix"
}
```

Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in

```
sage: 2.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
sage: 0.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
```




---

archive/issue_comments_348970.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-03T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348970",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_348971.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-02T01:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348971",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348972.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-02T01:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348972",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_348973.json:
```json
{
    "body": "rebased with doctests fixed",
    "created_at": "2018-09-02T01:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348973",
    "user": "vdelecroix"
}
```

rebased with doctests fixed



---

archive/issue_comments_348974.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-02T01:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348974",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348975.json:
```json
{
    "body": "ok",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348975",
    "user": "chapoton"
}
```

ok



---

archive/issue_comments_348976.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348976",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348977.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-01T00:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348977",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_348978.json:
```json
{
    "body": "Removed in #32417",
    "created_at": "2021-08-24T22:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24847#issuecomment-348978",
    "user": "mkoeppe"
}
```

Removed in #32417
