# Issue 17420: Upgrade to Cython 0.22

archive/issues_017420.json:
```json
{
    "body": "CC:  @robertwb @kiwifb\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17657\n\n",
    "created_at": "2015-01-22T08:11:04Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Upgrade to Cython 0.22",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17420",
    "user": "@jdemeyer"
}
```
CC:  @robertwb @kiwifb



Issue created by migration from https://trac.sagemath.org/ticket/17657





---

archive/issue_comments_232572.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-22T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232572",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_232573.json:
```json
{
    "body": "#17661 already removes the `sage.tests.parallel`",
    "created_at": "2015-01-23T12:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232573",
    "user": "@videlec"
}
```

#17661 already removes the `sage.tests.parallel`



---

archive/issue_comments_232574.json:
```json
{
    "body": "The 0.22 Cython version is a beta release? Do you really want to ship that in Sage? The release cycle between the first beta and the stable version seems to be short in Cython (max 1 month). Don't you want to wait for it?\n\nVincent",
    "created_at": "2015-01-25T17:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232574",
    "user": "@videlec"
}
```

The 0.22 Cython version is a beta release? Do you really want to ship that in Sage? The release cycle between the first beta and the stable version seems to be short in Cython (max 1 month). Don't you want to wait for it?

Vincent



---

archive/issue_comments_232575.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-01-25T17:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232575",
    "user": "@videlec"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_232576.json:
```json
{
    "body": "It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.\n\nNote that the ticket title isn't \"Upgrade to Cython 0.22.beta0\", that the status wasn't \"needs_review\" and that I didn't even post a tarball link...",
    "created_at": "2015-01-25T21:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232576",
    "user": "@jdemeyer"
}
```

It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.

Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...



---

archive/issue_comments_232577.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.\n\nTrue!\n\n> Note that the ticket title isn't \"Upgrade to Cython 0.22.beta0\", that the status wasn't \"needs_review\" and that I didn't even post a tarball link...\n\nI was wondering because you need to update with respect to some tarball (sha1sum for example). Sorry for my misunderstanding.\n\nVincent",
    "created_at": "2015-01-25T21:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232577",
    "user": "@videlec"
}
```

Replying to [comment:7 jdemeyer]:
> It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.

True!

> Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...

I was wondering because you need to update with respect to some tarball (sha1sum for example). Sorry for my misunderstanding.

Vincent



---

archive/issue_comments_232578.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-12T09:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232578",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_232579.json:
```json
{
    "body": "One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.",
    "created_at": "2015-02-12T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232579",
    "user": "@robertwb"
}
```

One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.



---

archive/issue_comments_232580.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-02-12T10:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232580",
    "user": "@robertwb"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_232581.json:
```json
{
    "body": "Replying to [comment:11 robertwb]:\n> One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.\n\nI am replacing\n\n```\ncdef extern from \"Python.h\":\n    bint PySlice_Check(PyObject* ob)\n\n...PySlice_Check(<PyObject *>row_index)...\n```\n\nby\n\n```\n...isinstance(row_index, slice)...\n```\n\n\nWhy is that a problem?",
    "created_at": "2015-02-12T10:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232581",
    "user": "@jdemeyer"
}
```

Replying to [comment:11 robertwb]:
> One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.

I am replacing

```
cdef extern from "Python.h":
    bint PySlice_Check(PyObject* ob)

...PySlice_Check(<PyObject *>row_index)...
```

by

```
...isinstance(row_index, slice)...
```


Why is that a problem?



---

archive/issue_comments_232582.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-12T12:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232582",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232583.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-12T16:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232583",
    "user": "@robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232584.json:
```json
{
    "body": "Bah, got my red and green mixed up. Yes, that's good.",
    "created_at": "2015-02-12T16:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232584",
    "user": "@robertwb"
}
```

Bah, got my red and green mixed up. Yes, that's good.



---

archive/issue_comments_232585.json:
```json
{
    "body": "btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.\n\n```\nbuild/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp: In function 'void* __pyx_f_4sage_3ext_6memory_check_allocarray(size_t, size_t)':\nbuild/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp:5507:60: error: 'mul_overflowcheck' was not declared in this scope\n   __pyx_v_n = mul_overflowcheck(__pyx_v_nmemb, __pyx_v_size);\n```\n\nThe cython version should probably also be considered in `sage -b`. If you want to work on that do it in a separate ticktet, this is already merged.",
    "created_at": "2015-02-17T10:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232585",
    "user": "@vbraun"
}
```

btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.

```
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp: In function 'void* __pyx_f_4sage_3ext_6memory_check_allocarray(size_t, size_t)':
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp:5507:60: error: 'mul_overflowcheck' was not declared in this scope
   __pyx_v_n = mul_overflowcheck(__pyx_v_nmemb, __pyx_v_size);
```

The cython version should probably also be considered in `sage -b`. If you want to work on that do it in a separate ticktet, this is already merged.



---

archive/issue_comments_232586.json:
```json
{
    "body": "Replying to [comment:17 vbraun]:\n> btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.\n\nIt's unrelated to this ticket, it's a bug in `build/deps`: the `csage` target does not state the `c_lib` sources as dependency. This causes `make` to skip `csage`, even though `./sage -b` should work.\n\nThe error you see comes from the `c_lib` change in #10257. I guess you compiled with #10257 applied, then undid #10257.",
    "created_at": "2015-02-17T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232586",
    "user": "@jdemeyer"
}
```

Replying to [comment:17 vbraun]:
> btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.

It's unrelated to this ticket, it's a bug in `build/deps`: the `csage` target does not state the `c_lib` sources as dependency. This causes `make` to skip `csage`, even though `./sage -b` should work.

The error you see comes from the `c_lib` change in #10257. I guess you compiled with #10257 applied, then undid #10257.



---

archive/issue_comments_232587.json:
```json
{
    "body": "I created #17794 for this.",
    "created_at": "2015-02-17T10:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232587",
    "user": "@jdemeyer"
}
```

I created #17794 for this.



---

archive/issue_comments_232588.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-17T19:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17420#issuecomment-232588",
    "user": "@vbraun"
}
```

Resolution: fixed
