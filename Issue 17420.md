# Issue 17420: Upgrade to Cython 0.22

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-01-22 08:11:04

CC:  robertwb fbissey




---

Comment by jdemeyer created at 2015-01-22 14:58:03

New commits:


---

Comment by vdelecroix created at 2015-01-23 12:33:55

#17661 already removes the `sage.tests.parallel`


---

Comment by vdelecroix created at 2015-01-25 17:42:17

The 0.22 Cython version is a beta release? Do you really want to ship that in Sage? The release cycle between the first beta and the stable version seems to be short in Cython (max 1 month). Don't you want to wait for it?

Vincent


---

Comment by vdelecroix created at 2015-01-25 17:42:17

Changing status from new to needs_info.


---

Comment by jdemeyer created at 2015-01-25 21:42:11

It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.

Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...


---

Comment by vdelecroix created at 2015-01-25 21:50:13

Replying to [comment:7 jdemeyer]:
> It makes a lot of sense to create a ticket now and test the beta version to give feedback to Cython upstream.

True!

> Note that the ticket title isn't "Upgrade to Cython 0.22.beta0", that the status wasn't "needs_review" and that I didn't even post a tarball link...

I was wondering because you need to update with respect to some tarball (sha1sum for example). Sorry for my misunderstanding.

Vincent


---

Comment by git created at 2015-02-12 09:32:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by robertwb created at 2015-02-12 10:00:10

One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.


---

Comment by robertwb created at 2015-02-12 10:00:10

Changing status from needs_info to needs_work.


---

Comment by jdemeyer created at 2015-02-12 10:22:47

Replying to [comment:11 robertwb]:
> One tiny nit: declare PySlice_Check as taking an object, not a `PyObject*`.

I am replacing

```
cdef extern from "Python.h":
    bint PySlice_Check(PyObject* ob)

...PySlice_Check(<PyObject *>row_index)...
```

by

```
...isinstance(row_index, slice)...
```


Why is that a problem?


---

Comment by jdemeyer created at 2015-02-12 12:39:48

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2015-02-12 16:40:22

Changing status from needs_review to positive_review.


---

Comment by robertwb created at 2015-02-12 16:40:22

Bah, got my red and green mixed up. Yes, that's good.


---

Comment by vbraun created at 2015-02-17 10:02:45

btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.

```
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp: In function 'void* __pyx_f_4sage_3ext_6memory_check_allocarray(size_t, size_t)':
build/cythonized/sage/algebras/letterplace/letterplace_ideal.cpp:5507:60: error: 'mul_overflowcheck' was not declared in this scope
   __pyx_v_n = mul_overflowcheck(__pyx_v_nmemb, __pyx_v_size);
```

The cython version should probably also be considered in `sage -b`. If you want to work on that do it in a separate ticktet, this is already merged.


---

Comment by jdemeyer created at 2015-02-17 10:10:34

Replying to [comment:17 vbraun]:
> btw this breaks upgrading, if you don't manually run `sage -ba` then compilation fails because not all cython files are regenerated.

It's unrelated to this ticket, it's a bug in `build/deps`: the `csage` target does not state the `c_lib` sources as dependency. This causes `make` to skip `csage`, even though `./sage -b` should work.

The error you see comes from the `c_lib` change in #10257. I guess you compiled with #10257 applied, then undid #10257.


---

Comment by jdemeyer created at 2015-02-17 10:26:52

I created #17794 for this.


---

Comment by vbraun created at 2015-02-17 19:28:32

Resolution: fixed
