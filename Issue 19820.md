# Issue 19820: Add iterator to DisjointSet class

archive/issues_019820.json:
```json
{
    "body": "CC:  @seblabbe\n\nThis small patch enables for example\n\n\n```\nD = DisjointSet('abcd'); D.union('b','c')\nfor part in D: pass\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20057\n\n",
    "created_at": "2016-02-15T17:54:12Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Add iterator to DisjointSet class",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19820",
    "user": "https://github.com/jm58660"
}
```
CC:  @seblabbe

This small patch enables for example


```
D = DisjointSet('abcd'); D.union('b','c')
for part in D: pass
```



Issue created by migration from https://trac.sagemath.org/ticket/20057





---

archive/issue_comments_272069.json:
```json
{
    "body": "An oneliner. At least works, but there might be places for optimizations.\n----\nNew commits:",
    "created_at": "2016-02-15T17:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272069",
    "user": "https://github.com/jm58660"
}
```

An oneliner. At least works, but there might be places for optimizations.
----
New commits:



---

archive/issue_comments_272070.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-15T17:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272070",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_272071.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-15T20:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272071",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_272072.json:
```json
{
    "body": "LGTM.",
    "created_at": "2016-02-15T20:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272072",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_272073.json:
```json
{
    "body": "I now remember why I did not coded the `__iter__`. It is because the two basic and efficient methods of this data structure are join and find and they are done lazyly. Lazyly in the sense that we you join the class of an element a with the class of an element b, then the parent of the root of a is now b or vice versa. It is not true that the structure is now that the direct parent of all elements of the new merged class is equal to the root. But this is what we get when we call `find` on all elements of the data structure. At that time, I decided not to code `__iter__` because to me, an internal method like `__iter__` is a basic internal method of enumerable that is expected to be efficient. But for this particular data structure, I did not find that calling `find` on every elements was in the spirit of the data structure...\n\nAnyway, I do think that a method that returns an enumerable on the roots is useful as I answered to Jori in a private email yesterday. Thinking about it now, I would have suggested a method `roots` that returns a list of the roots (an iterator needs to store the list anyway), which avoids the creation of the list of all elements in each class which is currently done in the oneliner that got positively reviewed.\n\nAlso, one thing I would suggest is to add a `NotImplementedError` to the `__iter__` to explain that such an enumeration needs to call `find` on all elements which is a costly operation (all proportion preserved) for that data structure. And suggest to use the method `roots`.\n\nI let you decide if you agree with me and if we put this ticket on hold ...13 hours after a positive review.\n\nhttps://en.wikipedia.org/wiki/Disjoint-set_data_structure",
    "created_at": "2016-02-16T10:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272073",
    "user": "https://github.com/seblabbe"
}
```

I now remember why I did not coded the `__iter__`. It is because the two basic and efficient methods of this data structure are join and find and they are done lazyly. Lazyly in the sense that we you join the class of an element a with the class of an element b, then the parent of the root of a is now b or vice versa. It is not true that the structure is now that the direct parent of all elements of the new merged class is equal to the root. But this is what we get when we call `find` on all elements of the data structure. At that time, I decided not to code `__iter__` because to me, an internal method like `__iter__` is a basic internal method of enumerable that is expected to be efficient. But for this particular data structure, I did not find that calling `find` on every elements was in the spirit of the data structure...

Anyway, I do think that a method that returns an enumerable on the roots is useful as I answered to Jori in a private email yesterday. Thinking about it now, I would have suggested a method `roots` that returns a list of the roots (an iterator needs to store the list anyway), which avoids the creation of the list of all elements in each class which is currently done in the oneliner that got positively reviewed.

Also, one thing I would suggest is to add a `NotImplementedError` to the `__iter__` to explain that such an enumeration needs to call `find` on all elements which is a costly operation (all proportion preserved) for that data structure. And suggest to use the method `roots`.

I let you decide if you agree with me and if we put this ticket on hold ...13 hours after a positive review.

https://en.wikipedia.org/wiki/Disjoint-set_data_structure



---

archive/issue_comments_272074.json:
```json
{
    "body": "I put this on *needs_info* to get some more time to explain.",
    "created_at": "2016-02-16T10:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272074",
    "user": "https://github.com/jm58660"
}
```

I put this on *needs_info* to get some more time to explain.



---

archive/issue_comments_272075.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2016-02-16T10:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272075",
    "user": "https://github.com/jm58660"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_272076.json:
```json
{
    "body": "I just realize the oneliner for `__iter__` is\n\n```\n    return self.root_to_elements_dict().itervalues()\n```\n\nand not\n\n```\n    return self.root_to_elements_dict().iterkeys()\n```\n\nIndeed, we also need to decide what to iterate on...",
    "created_at": "2016-02-16T10:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272076",
    "user": "https://github.com/seblabbe"
}
```

I just realize the oneliner for `__iter__` is

```
    return self.root_to_elements_dict().itervalues()
```

and not

```
    return self.root_to_elements_dict().iterkeys()
```

Indeed, we also need to decide what to iterate on...



---

archive/issue_comments_272077.json:
```json
{
    "body": "I want to make a function computing congruence of a (finite) lattice generated by some element sets. The result is splitting of elements to sets, i.e. exactly disjoint union. Hence `DisjointUnion` feels natural choise. The code basically iterates \"elements `a` and `b` must belong to same equivalnce class, so combine set containing `a` and set containing `b`.\"\n\nIf I understood right, there is no way to make a fast iteration of values possible; the whole idea of this data structure is to avoid moving data in memory so that iterating would become fast.\n\nI think that `itervalues()` and not `iterkeys()` is the right solution, if we are going to make this. There is basically no \"roots\" in mathematical sense in disjoint union. So the question is about \"expected to be efficient\". I would vote against it: we can make a slow iterator.",
    "created_at": "2016-02-16T11:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272077",
    "user": "https://github.com/jm58660"
}
```

I want to make a function computing congruence of a (finite) lattice generated by some element sets. The result is splitting of elements to sets, i.e. exactly disjoint union. Hence `DisjointUnion` feels natural choise. The code basically iterates "elements `a` and `b` must belong to same equivalnce class, so combine set containing `a` and set containing `b`."

If I understood right, there is no way to make a fast iteration of values possible; the whole idea of this data structure is to avoid moving data in memory so that iterating would become fast.

I think that `itervalues()` and not `iterkeys()` is the right solution, if we are going to make this. There is basically no "roots" in mathematical sense in disjoint union. So the question is about "expected to be efficient". I would vote against it: we can make a slow iterator.



---

archive/issue_comments_272078.json:
```json
{
    "body": "Thanks for allowing the discussion.\n\nReplying to [comment:7 jmantysalo]:\n> I think that `itervalues()` and not `iterkeys()` is the right solution, if we are going to make this. There is basically no \"roots\" in mathematical sense in disjoint union. \n\nYou are right. I agree. Also `iterkeys()` is not well defined as the chosen roots might be different depending on the computer.\n\n> So the question is about \"expected to be efficient\". I would vote against it: we can make a slow iterator.\n\nOk. So, let `__iter__()` return `self.root_to_elements_dict().itervalues()` then. I don't think there is much improvement we can do by avoiding the creation of the root to elements dict.\n\nPositive review then :)",
    "created_at": "2016-02-16T12:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272078",
    "user": "https://github.com/seblabbe"
}
```

Thanks for allowing the discussion.

Replying to [comment:7 jmantysalo]:
> I think that `itervalues()` and not `iterkeys()` is the right solution, if we are going to make this. There is basically no "roots" in mathematical sense in disjoint union. 

You are right. I agree. Also `iterkeys()` is not well defined as the chosen roots might be different depending on the computer.

> So the question is about "expected to be efficient". I would vote against it: we can make a slow iterator.

Ok. So, let `__iter__()` return `self.root_to_elements_dict().itervalues()` then. I don't think there is much improvement we can do by avoiding the creation of the root to elements dict.

Positive review then :)



---

archive/issue_comments_272079.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-02-16T12:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272079",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_272080.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-16T17:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19820#issuecomment-272080",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
