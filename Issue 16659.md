# Issue 16659: rework of row_reduced_form/weak_popov_form calling convention

archive/issues_016659.json:
```json
{
    "body": "CC:  jsrn dlucas\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16896\n\n",
    "created_at": "2014-08-28T13:30:57Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "rework of row_reduced_form/weak_popov_form calling convention",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16659",
    "user": "ketzu"
}
```
CC:  jsrn dlucas



Issue created by migration from https://trac.sagemath.org/ticket/16896





---

archive/issue_comments_219926.json:
```json
{
    "body": "Changing keywords from \"\" to \"weak-popov-form matrix\".",
    "created_at": "2014-08-28T13:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219926",
    "user": "ketzu"
}
```

Changing keywords from "" to "weak-popov-form matrix".



---

archive/issue_comments_219927.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to linear algebra.",
    "created_at": "2014-08-28T13:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219927",
    "user": "ketzu"
}
```

Changing component from PLEASE CHANGE to linear algebra.



---

archive/issue_comments_219928.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-08-28T13:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219928",
    "user": "ketzu"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_219929.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-08T08:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219929",
    "user": "ketzu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_219930.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-08T08:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219930",
    "user": "ketzu"
}
```

New commits:



---

archive/issue_comments_219931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-07T10:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219931",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-07T13:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219932",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219933.json:
```json
{
    "body": "Hello,\n\nA few comments on this ticket:\n\n1) Merge with latest beta of Sage is not possible as is, as some conflicts arise with the merge. It needs to be fixed.\n\n2) There are some trailing whitespaces in both `matrix2.pyx` and `matrix_misc.py`, it will be good to remove them.\n\n3) The documentation of `row_reduced_form` mentions weak Popov form several times, like:\n\n\n```\n\n OUTPUT:\n\n        `W` - a matrix over `k(x)` giving a weak the Popov form of self\n```\n\n\nbut as far as I understand it, `row_reduced_form` does not compute the weak Popov form, for instance:\n\n\n```\nsage: R.<t> = QQ['t']\nsage: M = matrix([[t,t,t^2],[0,0,t], [0, t, 0]])\nsage: M.row_reduced_form()\n[t t 0]\n[0 0 t]\n[0 t 0]\n```\n \ndoes not output a matrix in wPf as leading positions are the same for the first and third third rows of `M`. In that case, change occurences of weak Popov form by row reduced form.\n\n4) It could be nice to add another example in `matrix_misc.py` to illustrate the output in the case where `transformation=True`.\n\n5) You changed the arguments of `row_reduced_form` in this ticket. But in #16742, you will get the original implementation of `row_reduced_form`, which might create a conflict between the two tickets. You need to add a dependency somewhere to be sure that the merge goes smoothly.",
    "created_at": "2015-05-06T12:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219933",
    "user": "dlucas"
}
```

Hello,

A few comments on this ticket:

1) Merge with latest beta of Sage is not possible as is, as some conflicts arise with the merge. It needs to be fixed.

2) There are some trailing whitespaces in both `matrix2.pyx` and `matrix_misc.py`, it will be good to remove them.

3) The documentation of `row_reduced_form` mentions weak Popov form several times, like:


```

 OUTPUT:

        `W` - a matrix over `k(x)` giving a weak the Popov form of self
```


but as far as I understand it, `row_reduced_form` does not compute the weak Popov form, for instance:


```
sage: R.<t> = QQ['t']
sage: M = matrix([[t,t,t^2],[0,0,t], [0, t, 0]])
sage: M.row_reduced_form()
[t t 0]
[0 0 t]
[0 t 0]
```
 
does not output a matrix in wPf as leading positions are the same for the first and third third rows of `M`. In that case, change occurences of weak Popov form by row reduced form.

4) It could be nice to add another example in `matrix_misc.py` to illustrate the output in the case where `transformation=True`.

5) You changed the arguments of `row_reduced_form` in this ticket. But in #16742, you will get the original implementation of `row_reduced_form`, which might create a conflict between the two tickets. You need to add a dependency somewhere to be sure that the merge goes smoothly.



---

archive/issue_comments_219934.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-06T12:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219934",
    "user": "dlucas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219936.json:
```json
{
    "body": "Tried to rebase the commits for 6.8beta or at least 6.7 and solve all conflicts. Rework of comments including the term \"weak Popov form\" are yet to be done and testing/doctesting of current changes.",
    "created_at": "2015-07-06T14:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219936",
    "user": "ketzu"
}
```

Tried to rebase the commits for 6.8beta or at least 6.7 and solve all conflicts. Rework of comments including the term "weak Popov form" are yet to be done and testing/doctesting of current changes.



---

archive/issue_comments_219937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T09:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219938.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-07T09:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219938",
    "user": "ketzu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_219939.json:
```json
{
    "body": "I tried to incorporate the suggestions and create a patchable commit. Doctests and compilation/integration are working for me on sages git master branch.",
    "created_at": "2015-07-07T09:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219939",
    "user": "ketzu"
}
```

I tried to incorporate the suggestions and create a patchable commit. Doctests and compilation/integration are working for me on sages git master branch.



---

archive/issue_comments_219940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-04T14:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219940",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219941.json:
```json
{
    "body": "Changing keywords from \"weak-popov-form matrix\" to \"polynomial matrix\".",
    "created_at": "2015-12-04T14:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219941",
    "user": "jsrn"
}
```

Changing keywords from "weak-popov-form matrix" to "polynomial matrix".



---

archive/issue_comments_219942.json:
```json
{
    "body": "I rewrote the patch because it didn't really fix the calling convention, while it still broke backwards compatibility without proper deprecation warnings. Now, the patch does as the new description says.\n\nIt's again at needs review.",
    "created_at": "2015-12-04T14:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219942",
    "user": "jsrn"
}
```

I rewrote the patch because it didn't really fix the calling convention, while it still broke backwards compatibility without proper deprecation warnings. Now, the patch does as the new description says.

It's again at needs review.



---

archive/issue_comments_219943.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-14T09:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219943",
    "user": "dlucas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219944.json:
```json
{
    "body": "I guess I'm bad news' harbinger again, as I noticed the following:\n\n\n```\nsage: PR.<x> = GF(7)[]\nsage: M = random_matrix(PR, 5, 5)\nsage: type(M)\n<type 'sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint'>\nsage: type(M.row_reduced_form(transformation=False, old_call=False)[0, 0])\n<type 'sage.rings.fraction_field_FpT.FpTElement'>\n```\n\n\nSo it seems that the actual implementation messes with the type of the elements in the matrix, which is never a good thing...\n\nDavid",
    "created_at": "2015-12-14T09:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219944",
    "user": "dlucas"
}
```

I guess I'm bad news' harbinger again, as I noticed the following:


```
sage: PR.<x> = GF(7)[]
sage: M = random_matrix(PR, 5, 5)
sage: type(M)
<type 'sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint'>
sage: type(M.row_reduced_form(transformation=False, old_call=False)[0, 0])
<type 'sage.rings.fraction_field_FpT.FpTElement'>
```


So it seems that the actual implementation messes with the type of the elements in the matrix, which is never a good thing...

David



---

archive/issue_comments_219945.json:
```json
{
    "body": "That has been the behaviour of the function always, so it's not the \"fault\" of this patch. It is, however, rather stupid, as it is because of the division with `R.one()` (named `den`) in the return line of `row_reduced_form` in `matrix_misc.py`.\n\nSo, let's say it was broken behaviour before, so we can change it without doing the deprecation-dance...",
    "created_at": "2015-12-14T16:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219945",
    "user": "jsrn"
}
```

That has been the behaviour of the function always, so it's not the "fault" of this patch. It is, however, rather stupid, as it is because of the division with `R.one()` (named `den`) in the return line of `row_reduced_form` in `matrix_misc.py`.

So, let's say it was broken behaviour before, so we can change it without doing the deprecation-dance...



---

archive/issue_comments_219946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T16:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219947.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T17:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219947",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219948.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-14T17:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219948",
    "user": "jsrn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_219949.json:
```json
{
    "body": "Done!",
    "created_at": "2015-12-14T17:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219949",
    "user": "jsrn"
}
```

Done!



---

archive/issue_comments_219950.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-15T09:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219950",
    "user": "dlucas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_219951.json:
```json
{
    "body": "Ok, it passes the tests and fixes the bug I noticed, to me it's good to go.",
    "created_at": "2015-12-15T09:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219951",
    "user": "dlucas"
}
```

Ok, it passes the tests and fixes the bug I noticed, to me it's good to go.



---

archive/issue_comments_219952.json:
```json
{
    "body": "Cool, thanks!",
    "created_at": "2015-12-15T10:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219952",
    "user": "jsrn"
}
```

Cool, thanks!



---

archive/issue_comments_219953.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-23T11:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219953",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_219954.json:
```json
{
    "body": "The reviewer name is supposed to be your real name, not trac account",
    "created_at": "2015-12-23T11:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219954",
    "user": "vbraun"
}
```

The reviewer name is supposed to be your real name, not trac account



---

archive/issue_comments_219955.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-12-23T11:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219955",
    "user": "jsrn"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_219956.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-24T23:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16659#issuecomment-219956",
    "user": "vbraun"
}
```

Resolution: fixed
