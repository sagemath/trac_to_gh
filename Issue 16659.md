# Issue 16659: rework of row_reduced_form/weak_popov_form calling convention

Issue created by migration from Trac.

Original creator: ketzu

Original creation time: 2014-08-28 13:30:57

CC:  jsrn dlucas




---

Comment by ketzu created at 2014-08-28 13:34:24

Changing keywords from "" to "weak-popov-form matrix".


---

Comment by ketzu created at 2014-08-28 13:34:24

Changing component from PLEASE CHANGE to linear algebra.


---

Comment by ketzu created at 2014-08-28 13:34:24

Changing type from PLEASE CHANGE to enhancement.


---

Comment by ketzu created at 2014-09-08 08:26:30

Changing status from new to needs_review.


---

Comment by ketzu created at 2014-09-08 08:26:30

New commits:


---

Comment by git created at 2014-10-07 10:56:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-07 13:08:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-05-06 12:05:12

Hello,

A few comments on this ticket:

1) Merge with latest beta of Sage is not possible as is, as some conflicts arise with the merge. It needs to be fixed.

2) There are some trailing whitespaces in both `matrix2.pyx` and `matrix_misc.py`, it will be good to remove them.

3) The documentation of `row_reduced_form` mentions weak Popov form several times, like:


```

 OUTPUT:

        `W` - a matrix over `k(x)` giving a weak the Popov form of self
```


but as far as I understand it, `row_reduced_form` does not compute the weak Popov form, for instance:


```
sage: R.<t> = QQ['t']
sage: M = matrix([[t,t,t^2],[0,0,t], [0, t, 0]])
sage: M.row_reduced_form()
[t t 0]
[0 0 t]
[0 t 0]
}}} 
does not output a matrix in wPf as leading positions are the same for the first and third third rows of `M`. In that case, change occurences of weak Popov form by row reduced form.

4) It could be nice to add another example in `matrix_misc.py` to illustrate the output in the case where `transformation=True`.

5) You changed the arguments of `row_reduced_form` in this ticket. But in #16742, you will get the original implementation of `row_reduced_form`, which might create a conflict between the two tickets. You need to add a dependency somewhere to be sure that the merge goes smoothly.


---

Comment by dlucas created at 2015-05-06 12:05:12

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-07-06 13:57:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ketzu created at 2015-07-06 14:08:20

Tried to rebase the commits for 6.8beta or at least 6.7 and solve all conflicts. Rework of comments including the term "weak Popov form" are yet to be done and testing/doctesting of current changes.


---

Comment by git created at 2015-07-07 09:09:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ketzu created at 2015-07-07 09:11:38

Changing status from needs_work to needs_review.


---

Comment by ketzu created at 2015-07-07 09:11:38

I tried to incorporate the suggestions and create a patchable commit. Doctests and compilation/integration are working for me on sages git master branch.


---

Comment by git created at 2015-12-04 14:08:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2015-12-04 14:17:04

Changing keywords from "weak-popov-form matrix" to "polynomial matrix".


---

Comment by jsrn created at 2015-12-04 14:17:04

I rewrote the patch because it didn't really fix the calling convention, while it still broke backwards compatibility without proper deprecation warnings. Now, the patch does as the new description says.

It's again at needs review.


---

Comment by dlucas created at 2015-12-14 09:59:30

Changing status from needs_review to needs_work.


---

Comment by dlucas created at 2015-12-14 09:59:30

I guess I'm bad news' harbinger again, as I noticed the following:


```
sage: PR.<x> = GF(7)[]
sage: M = random_matrix(PR, 5, 5)
sage: type(M)
<type 'sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint'>
sage: type(M.row_reduced_form(transformation=False, old_call=False)[0, 0])
<type 'sage.rings.fraction_field_FpT.FpTElement'>
```


So it seems that the actual implementation messes with the type of the elements in the matrix, which is never a good thing...

David


---

Comment by jsrn created at 2015-12-14 16:21:09

That has been the behaviour of the function always, so it's not the "fault" of this patch. It is, however, rather stupid, as it is because of the division with `R.one()` (named `den`) in the return line of `row_reduced_form` in `matrix_misc.py`.

So, let's say it was broken behaviour before, so we can change it without doing the deprecation-dance...


---

Comment by git created at 2015-12-14 16:48:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-14 17:01:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2015-12-14 17:02:06

Changing status from needs_work to needs_review.


---

Comment by jsrn created at 2015-12-14 17:02:06

Done!


---

Comment by dlucas created at 2015-12-15 09:49:09

Changing status from needs_review to positive_review.


---

Comment by dlucas created at 2015-12-15 09:49:09

Ok, it passes the tests and fixes the bug I noticed, to me it's good to go.


---

Comment by jsrn created at 2015-12-15 10:47:44

Cool, thanks!


---

Comment by vbraun created at 2015-12-23 11:08:01

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-12-23 11:08:01

The reviewer name is supposed to be your real name, not trac account


---

Comment by jsrn created at 2015-12-23 11:22:06

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-12-24 23:46:46

Resolution: fixed
