# Issue 11648: Undo #4777

Issue created by migration from Trac.

Original creator: aapitzsch

Original creation time: 2011-09-20 19:49:19

Assignee: AlexGhitza

The pari bug mentioned in #4777 is fixed, see [1].
So undo #4777 to make `is_prime_power` faster.

[1] http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=916&archive=yes


---

Comment by aapitzsch created at 2011-09-20 19:54:44

Changing status from new to needs_review.


---

Comment by leif created at 2011-09-20 21:11:14

The error message could be nicer, and the commit message more meaningful.


---

Attachment


---

Comment by leif created at 2011-09-20 23:24:08

I've attached a reviewer patch fixing the error message and also some other (unrelated) parts of the documentation.

P.S.: trac doesn't send a notification if you only attach or update a patch, so it's usually better to also add a comment such that others will notice your update.


---

Comment by leif created at 2011-09-20 23:24:08

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-09-21 13:10:02

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-09-21 13:10:02

Doesn't [attachment:trac_11820-beautify_error_message.reviewer.patch] conflict with #11685?


---

Comment by leif created at 2011-09-21 13:32:42

Replying to [comment:4 jdemeyer]:
> Doesn't [attachment:trac_11820-beautify_error_message.reviewer.patch] conflict with #11685?

Does it? Apparently haven't tried, i.e., tested it / made the patch against alpha2.

If so, I can of course rebase it; I was actually considering it for late inclusion into the alpha3 since it is a trivial (or harmless) fix.


---

Comment by leif created at 2011-09-21 13:52:11

Replying to [comment:5 leif]:
> Replying to [comment:4 jdemeyer]:
> > Doesn't [attachment:trac_11820-beautify_error_message.reviewer.patch] conflict with #11685?
> 
> Apparently haven't tried, i.e., tested it / made the patch against alpha2.

Yep, did so. (Too many terminal windows and Sage installations.)

But as long as it doesn't (formally) depend on #11685 (and alpha3 isn't released), it doesn't need work... ;-)


---

Comment by leif created at 2011-09-21 22:53:28

Apply on top of André's patch. Includes further random documentation fixes. Based on Sage 4.7.2.alpha3-prerelease / #11685.


---

Comment by leif created at 2011-09-21 23:02:31

Changing status from needs_work to needs_review.


---

Attachment

Updated my reviewer patch.

Jeroen, are you going to / do you want to review this?

Otherwise I'll just set it back to "positive review"... ;-) (Did a full `ptestlong` to catch all places where the changed exception messages are used.)


---

Comment by jdemeyer created at 2011-09-22 07:49:26

Mercurial doesn't like [attachment:trac_11820_undo_4777.patch] because it uses non-ASCII characters:

```
$ pwd
/usr/local/src/sage-4.7.2.alpha2/devel/sage

$ ../../sage --version
* Warning: this is a prerelease version, and it may be unstable.     *
| Sage Version 4.7.2.alpha2, Release Date: 2011-08-24                |
$ ../../sage -hg --version
Mercurial Distributed SCM (version 1.8.4)
(see http://mercurial.selenic.com for more information)

Copyright (C) 2005-2011 Matt Mackall and others
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

$ ../../sage -hg qpush
applying trac_11820_undo_4777.patch
transaction abort!
rollback completed
cleaning up working directory...done
abort: decoding near 'AndrÃ© Apitzsc': 'ascii' codec can't decode byte 0xc3 in position 4: ordinal not in range(128)!
```



---

Comment by jdemeyer created at 2011-09-22 07:49:26

Changing status from needs_review to needs_work.


---

Comment by leif created at 2011-09-22 12:44:55

Replying to [comment:8 jdemeyer]:
> Mercurial doesn't like [attachment:trac_11820_undo_4777.patch] because it uses non-ASCII characters [...]

Jeroen, we have *lots* of such patches.

You *must not* set (e.g.) `LC_ALL=C`, but use e.g. `en_US.utf-8` when applying patches.

I'd consider that a Mercurial bug btw.


---

Comment by leif created at 2011-09-22 12:44:55

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-09-22 12:57:23

Replying to [comment:9 leif]:
> You *must not* set (e.g.) `LC_ALL=C`, but use e.g. `en_US.utf-8` when applying patches.

Allright, the command that made it work for me was

```
$ LANG=en_US.UTF-8 hg qpush
```

Note that `$LANG` is set by default on some systems (e.g. sage.math.washington.edu).


---

Attachment


---

Comment by jdemeyer created at 2011-09-22 13:01:54

I don't why exception strings should have a dot at the end, they most commonly do *not* have a dot.  New reviewer patch fixing that.


---

Comment by jdemeyer created at 2011-09-22 13:01:54

Changing status from needs_review to positive_review.


---

Comment by leif created at 2011-09-22 13:30:55

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 leif]:
> > You *must not* set (e.g.) `LC_ALL=C`, but use e.g. `en_US.utf-8` when applying patches.
> 
> Allright, the command that made it work for me was

```
$ LANG=en_US.UTF-8 hg qpush
```

> Note that `$LANG` is set by default on some systems (e.g. sage.math.washington.edu).

Wonder whether we should set / change the locale in `sage --hg ...` (at least if the current one is not a UTF-8 one).


---

Comment by jdemeyer created at 2011-09-22 14:27:36

Replying to [comment:12 leif]:
> Wonder whether we should set / change the locale in `sage --hg ...` (at least if the current one is not a UTF-8 one).

See #11830 (needs_review) for a solution.


---

Comment by leif created at 2011-09-27 17:39:57

Resolution: fixed
