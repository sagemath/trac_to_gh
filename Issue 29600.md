# Issue 29600: Improvement for incidence matrix of polyhedra

archive/issues_029600.json:
```json
{
    "body": "CC:  @jplab @laisrast\n\nKeywords: polyhedra, incidence matrix\n\nThis ticket collects some improvements for obtaining incidence matrices:\n\n- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.\n- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).\n\n  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.\n\nBefore this ticket:\n\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 751 ms, sys: 7.95 ms, total: 759 ms\nWall time: 758 ms\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time _ = P.incidence_matrix()\nCPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s\nWall time: 1.94 s\nsage: P = polytopes.hypercube(14)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 670 ms, sys: 0 ns, total: 670 ms\nWall time: 669 ms\nsage: K.<sqrt2> = QuadraticField(2)\nsage: P = polytopes.permutahedron(7).dilation(sqrt2)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 4.1 s, sys: 0 ns, total: 4.1 s\nWall time: 4.1 s\n```\n\n\nWith this ticket:\n\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 236 ms, sys: 15.8 ms, total: 252 ms\nWall time: 251 ms\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time _ = P.incidence_matrix()\nCPU times: user 1.21 s, sys: 52.1 ms, total: 1.27 s\nWall time: 1.27 s\nsage: P = polytopes.hypercube(14)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 247 ms, sys: 8.1 ms, total: 256 ms\nWall time: 255 ms\nsage: K.<sqrt2> = QuadraticField(2)\nsage: P = polytopes.permutahedron(7).dilation(sqrt2)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 3.77 s, sys: 3.81 ms, total: 3.77 s\nWall time: 3.77 s\n```\n\n\nPossible follow up: Set up incidence matrix etc. with base ring `GF(2)`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29837\n\n",
    "created_at": "2020-06-10T10:09:27Z",
    "labels": [
        "geometry",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Improvement for incidence matrix of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29600",
    "user": "@kliem"
}
```
CC:  @jplab @laisrast

Keywords: polyhedra, incidence matrix

This ticket collects some improvements for obtaining incidence matrices:

- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.
- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).

  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.

Before this ticket:


```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms
Wall time: 758 ms
sage: P = polytopes.associahedron(['A', 9])
sage: %time _ = P.incidence_matrix()
CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s
Wall time: 1.94 s
sage: P = polytopes.hypercube(14)
sage: %time _ = P.incidence_matrix()
CPU times: user 670 ms, sys: 0 ns, total: 670 ms
Wall time: 669 ms
sage: K.<sqrt2> = QuadraticField(2)
sage: P = polytopes.permutahedron(7).dilation(sqrt2)
sage: %time _ = P.incidence_matrix()
CPU times: user 4.1 s, sys: 0 ns, total: 4.1 s
Wall time: 4.1 s
```


With this ticket:


```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 236 ms, sys: 15.8 ms, total: 252 ms
Wall time: 251 ms
sage: P = polytopes.associahedron(['A', 9])
sage: %time _ = P.incidence_matrix()
CPU times: user 1.21 s, sys: 52.1 ms, total: 1.27 s
Wall time: 1.27 s
sage: P = polytopes.hypercube(14)
sage: %time _ = P.incidence_matrix()
CPU times: user 247 ms, sys: 8.1 ms, total: 256 ms
Wall time: 255 ms
sage: K.<sqrt2> = QuadraticField(2)
sage: P = polytopes.permutahedron(7).dilation(sqrt2)
sage: %time _ = P.incidence_matrix()
CPU times: user 3.77 s, sys: 3.81 ms, total: 3.77 s
Wall time: 3.77 s
```


Possible follow up: Set up incidence matrix etc. with base ring `GF(2)`.

Issue created by migration from https://trac.sagemath.org/ticket/29837





---

archive/issue_comments_420253.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420253",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_420254.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420254",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420255.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420255",
    "user": "@kliem"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_420256.json:
```json
{
    "body": "This should be rebased on #29838 and another ticket that speeds up getting the incidence matrix from the slack matrix.",
    "created_at": "2020-06-10T12:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420256",
    "user": "@kliem"
}
```

This should be rebased on #29838 and another ticket that speeds up getting the incidence matrix from the slack matrix.



---

archive/issue_comments_420257.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-10T12:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420257",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_420258.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420258",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420259.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420259",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_420260.json:
```json
{
    "body": "I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.",
    "created_at": "2020-06-10T19:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420260",
    "user": "@mkoeppe"
}
```

I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.



---

archive/issue_comments_420261.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.\n> \n\nI don't think the change to `GF(2)` was needed to make things better. So I can rewrite some stuff and remove #29839, that would also do it, I think. `sage.matrix.matrix_integer_dense` is probably just as fast or faster than the other one.\n\nI really only thought that this is the more natural thing for a 0/1 matrix. If the more natural thing is base ring integer or `GF(2)` really performs awful, I can just revert that decision.",
    "created_at": "2020-06-10T20:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420261",
    "user": "@kliem"
}
```

Replying to [comment:7 mkoeppe]:
> I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.
> 

I don't think the change to `GF(2)` was needed to make things better. So I can rewrite some stuff and remove #29839, that would also do it, I think. `sage.matrix.matrix_integer_dense` is probably just as fast or faster than the other one.

I really only thought that this is the more natural thing for a 0/1 matrix. If the more natural thing is base ring integer or `GF(2)` really performs awful, I can just revert that decision.



---

archive/issue_comments_420262.json:
```json
{
    "body": "See my comment in #29840",
    "created_at": "2020-06-10T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420262",
    "user": "@mkoeppe"
}
```

See my comment in #29840



---

archive/issue_comments_420263.json:
```json
{
    "body": "Changing the base ring of incidence matrices was rejected in #29340.",
    "created_at": "2020-06-10T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420263",
    "user": "@kliem"
}
```

Changing the base ring of incidence matrices was rejected in #29340.



---

archive/issue_comments_420264.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-10T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420264",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_420265.json:
```json
{
    "body": "I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.",
    "created_at": "2020-06-10T21:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420265",
    "user": "@dimpase"
}
```

I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.



---

archive/issue_comments_420266.json:
```json
{
    "body": "I don't know how fast conversion back and forth works. It is true, that numpy is a bit faster, but that doesn't help me if I cannot convert things.\n\nE.g.\n\n```\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time a = np.array(P.Vrepresentation())\nCPU times: user 383 ms, sys: 0 ns, total: 383 ms\nWall time: 382 ms\n```\n\n\nThis is already longer than it takes to obtain the entire incidence matrix. Of course this is most likely not an ideal way to convert, but I don't know any better way at the moment.\n\nAnd conversion back is also slow.\n\nReplying to [comment:11 dimpase]:\n> I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.",
    "created_at": "2020-06-10T22:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420266",
    "user": "@kliem"
}
```

I don't know how fast conversion back and forth works. It is true, that numpy is a bit faster, but that doesn't help me if I cannot convert things.

E.g.

```
sage: P = polytopes.associahedron(['A', 9])
sage: %time a = np.array(P.Vrepresentation())
CPU times: user 383 ms, sys: 0 ns, total: 383 ms
Wall time: 382 ms
```


This is already longer than it takes to obtain the entire incidence matrix. Of course this is most likely not an ideal way to convert, but I don't know any better way at the moment.

And conversion back is also slow.

Replying to [comment:11 dimpase]:
> I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.



---

archive/issue_comments_420267.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420267",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420268.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420268",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_420269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T22:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420269",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T09:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420270",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420271.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-06-17T09:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420271",
    "user": "@kliem"
}
```

Last 10 new commits:



---

archive/issue_comments_420272.json:
```json
{
    "body": "Needs review.\n\nThe the ticket itself is only 3 commits on top of #29838 and #29839, which are both closed now.",
    "created_at": "2020-06-30T05:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420272",
    "user": "@kliem"
}
```

Needs review.

The the ticket itself is only 3 commits on top of #29838 and #29839, which are both closed now.



---

archive/issue_comments_420273.json:
```json
{
    "body": "You might be able to get a little more speed out by doing\n\n```diff\n-return x == 0\n+return (not x)\n```\n",
    "created_at": "2020-07-01T02:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420273",
    "user": "@tscrim"
}
```

You might be able to get a little more speed out by doing

```diff
-return x == 0
+return (not x)
```




---

archive/issue_comments_420274.json:
```json
{
    "body": "However, whether you make that change or not, you can set a positive review on my behalf.",
    "created_at": "2020-07-01T02:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420274",
    "user": "@tscrim"
}
```

However, whether you make that change or not, you can set a positive review on my behalf.



---

archive/issue_comments_420275.json:
```json
{
    "body": "About three percent for `P = polytopes.permutahedron(7).dilation(sqrt2)`.\n\nThank you.",
    "created_at": "2020-07-01T04:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420275",
    "user": "@kliem"
}
```

About three percent for `P = polytopes.permutahedron(7).dilation(sqrt2)`.

Thank you.



---

archive/issue_comments_420276.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-01T04:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420276",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420277.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-01T04:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420277",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420278.json:
```json
{
    "body": "I am getting this with this ticket in sage-on-gentoo\n\n```\nsage -t --long --warn-long 101.0 /usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py\", line 508, in sage.geometry.polyhedron.backend_cdd.Polyhedron_RDF_cdd.__init__\nFailed example:\n    TestSuite(p).run()\nExpected nothing\nGot:\n    Failure in _test_an_affine_basis:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/misc/sage_unittest.py\", line 296, in run\n        test_method(tester=tester)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2122, in _test_an_affine_basis\n        b = self.an_affine_basis()\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2085, in an_affine_basis\n        chain = self.a_maximal_chain()[1:]  # we exclude the empty face\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 3098, in a_maximal_chain\n        comb_chain = self.combinatorial_polyhedron().a_maximal_chain()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)\n        self.cache = f(self._instance)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 3362, in combinatorial_polyhedron\n        return CombinatorialPolyhedron(self)\n      File \"sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 367, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/base.c:6786)\n        data = data.incidence_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)\n        self.cache = f(self._instance)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2749, in incidence_matrix\n        is_zero == self._is_zero\n    UnboundLocalError: local variable 'is_zero' referenced before assignment\n    ------------------------------------------------------------\n    The following tests failed: _test_an_affine_basis\n**********************************************************************\n```\n\nseems circular.",
    "created_at": "2020-07-05T02:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420278",
    "user": "@kiwifb"
}
```

I am getting this with this ticket in sage-on-gentoo

```
sage -t --long --warn-long 101.0 /usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py", line 508, in sage.geometry.polyhedron.backend_cdd.Polyhedron_RDF_cdd.__init__
Failed example:
    TestSuite(p).run()
Expected nothing
Got:
    Failure in _test_an_affine_basis:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
        test_method(tester=tester)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2122, in _test_an_affine_basis
        b = self.an_affine_basis()
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2085, in an_affine_basis
        chain = self.a_maximal_chain()[1:]  # we exclude the empty face
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 3098, in a_maximal_chain
        comb_chain = self.combinatorial_polyhedron().a_maximal_chain()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)
        self.cache = f(self._instance)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 3362, in combinatorial_polyhedron
        return CombinatorialPolyhedron(self)
      File "sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 367, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/base.c:6786)
        data = data.incidence_matrix()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)
        self.cache = f(self._instance)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2749, in incidence_matrix
        is_zero == self._is_zero
    UnboundLocalError: local variable 'is_zero' referenced before assignment
    ------------------------------------------------------------
    The following tests failed: _test_an_affine_basis
**********************************************************************
```

seems circular.



---

archive/issue_comments_420279.json:
```json
{
    "body": "\n```diff\n-is_zero == self._is_zero\n+is_zero = self._is_zero\n```\n",
    "created_at": "2020-07-05T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420279",
    "user": "@tscrim"
}
```


```diff
-is_zero == self._is_zero
+is_zero = self._is_zero
```




---

archive/issue_comments_420280.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-07-05T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420280",
    "user": "@tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_420281.json:
```json
{
    "body": "The problem is that usually the cdd backend figures out the incidence matrix itself for inexact polyhedra. So you don't notice, because `incidence_matrix` is never run (except for the empty polyhedron, hence the error). I should add a doctest for this.",
    "created_at": "2020-07-05T06:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420281",
    "user": "@kliem"
}
```

The problem is that usually the cdd backend figures out the incidence matrix itself for inexact polyhedra. So you don't notice, because `incidence_matrix` is never run (except for the empty polyhedron, hence the error). I should add a doctest for this.



---

archive/issue_comments_420282.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420282",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420283.json:
```json
{
    "body": "I rebased as well.\n----\nNew commits:",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420283",
    "user": "@kliem"
}
```

I rebased as well.
----
New commits:



---

archive/issue_comments_420284.json:
```json
{
    "body": "Trivial tweak, but the formatting is better:\n\n```diff\n         Test that this method works for inexact base ring\n-        (`cdd` sets the cache already)::\n+        (``cdd`` sets the cache already)::\n```\n",
    "created_at": "2020-07-05T07:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420284",
    "user": "@tscrim"
}
```

Trivial tweak, but the formatting is better:

```diff
         Test that this method works for inexact base ring
-        (`cdd` sets the cache already)::
+        (``cdd`` sets the cache already)::
```




---

archive/issue_comments_420285.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-05T07:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420285",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420286.json:
```json
{
    "body": "Done.\n\nReplying to [comment:28 tscrim]:\n> Trivial tweak, but the formatting is better:\n> {{{#!diff\n>          Test that this method works for inexact base ring\n> -        (`cdd` sets the cache already)::\n> +        (``cdd`` sets the cache already)::\n> }}}",
    "created_at": "2020-07-05T07:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420286",
    "user": "@kliem"
}
```

Done.

Replying to [comment:28 tscrim]:
> Trivial tweak, but the formatting is better:
> {{{#!diff
>          Test that this method works for inexact base ring
> -        (`cdd` sets the cache already)::
> +        (``cdd`` sets the cache already)::
> }}}



---

archive/issue_comments_420287.json:
```json
{
    "body": "Thanks.",
    "created_at": "2020-07-05T09:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420287",
    "user": "@tscrim"
}
```

Thanks.



---

archive/issue_comments_420288.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-05T09:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420288",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420289.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29600#issuecomment-420289",
    "user": "@vbraun"
}
```

Resolution: fixed
