# Issue 15278: Assert that graphics_filename() is only used in the notebook

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-12-12 16:47:53

The function `graphics_filename()` in `sage/misc/temporary_file.py` was created for the notebook and should only be used in the notebook (where it can be used in a safe, controlled, way).


---

Attachment


---

Comment by jdemeyer created at 2013-12-20 15:55:02

Changing status from new to needs_review.


---

Comment by rws created at 2014-05-12 06:23:11

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-05-12 06:23:11

New commits:


---

Comment by jdemeyer created at 2014-05-12 08:41:44

rws, do you care about this patch, would you review it? I can rebase the patch, but only if I know that somebody is interested in reviewing it.


---

Comment by rws created at 2014-05-12 08:44:41

No, I don't care about the notebook.


---

Comment by rws created at 2014-05-12 08:46:24

Oh it's not the notebook. Yes, I do care.


---

Comment by gagern created at 2014-07-03 22:42:28

Changing status from needs_work to needs_review.


---

Comment by gagern created at 2014-07-03 22:42:28

Rebased this. Funny, I was coding something along the same lines at the moment, before comment:34:ticket:16533 made me aware of this ticket here.

[My own modifications](http://git.sagemath.org/sage.git/log/?h=u/gagern/feature/graphics_filename-passthrough) (which I have just modified to build on this here) also move some other tasks into that function, namely passing a caller-provided filename back (either unaltered or with added suffix) unless it is `None`. That way, one can simply do `graphics_filename(filename=filename)` without worrying whether the user specified a file name or not.

But since I might end up reviewing your commit, I probably should file my own as a separate ticketâ€¦ I haven't looked at _all_ your modifications yet, but I notice that [code in plot3d/base.pyx](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/plot/plot3d/base.pyx?id=6.3.beta1#n1131) is still pretty broken with regard to `graphics_filename`: they call it to generate some name, then strip the original extension and add an assortment of other extensions. That's just asking for a name clash. And if `SAGE_TMP` would happen to be world writable (although I can't imagine how that might be), then a security relevant race condition would be very likely.

If I were to fix this, I would be using my own code for this. Jeroen, could we review one another's code for this?

I guess I'd also like to use this function (with my own additions) all over the place for animations. Doing that would fix #16608 as well, would be a useful basis for my next stab at #16533, and would make [005b83f](http://git.sagemath.org/sage.git/commit/?id=005b83f2379d786b88f9a6b194dd334c038ea8ca) from #16571 superfluous as well.
----
New commits:


---

Comment by jdemeyer created at 2014-07-04 04:40:02

Replying to [comment:12 gagern]:
> If I were to fix this, I would be using my own code for this. Jeroen, could we review one another's code for this?

Yes, but not before the end of July. Please remind me then in case I forget.


---

Comment by gagern created at 2014-07-10 06:46:58

I had a closer look at the code. Decided to restore explicit arguments in two cases because they might have been used as positional arguments, not keyword arguments, so we'd break backward compatibility. This is in response to the discussion staring at comment:25:ticket:16533. If we want to deprecate them properly, I'd suggest doing so along the lines of #16607.

Apart from that, the changes all look good. I'm doing the build, doc build, long test suite and so on tests now, and will push this change and set positive review once I'm done, unless any problems pop up.


---

Comment by gagern created at 2014-07-10 07:02:23

I just filed #16640 for the Graphics3d problem, since that may be harder to fix, but is already a problem without this change here applied to it, so it should be dealt with independently. Once it has been dealt with, that code can also be changed to use `graphics_filename` in all cases, instead of only the embedded case.


---

Comment by git created at 2014-07-10 10:08:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gagern created at 2014-07-10 10:18:20

Changing status from needs_review to positive_review.


---

Comment by gagern created at 2014-07-10 10:18:20

OK, now even the old API with positional parameters is restored. Everything looks good: look at the code, interactive experiments, doctests, documentation build. I hope it's OK if I give this a positive review even though the last commit is mine. After all, its a minor change, mostly restoring previous code.


---

Comment by vbraun created at 2014-07-11 04:19:38

Resolution: fixed


---

Comment by gagern created at 2014-09-05 07:39:36

Replying to [comment:13 jdemeyer]:
>> Jeroen, could we review one another's code for this?
> Yes, but not before the end of July. Please remind me then in case I forget.

Jeroen, can you please have a look at #16640? Of course I'll welcome reviews for [all my other modifications](http://trac.sagemath.org/query?status=needs_review&author=~Gagern&group=component) as well, but that ticket is closely related to what you did here.
