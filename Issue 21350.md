# Issue 21350: Implementing ribbon graphs

Issue created by migration from Trac.

Original creator: pportilla

Original creation time: 2016-09-24 20:48:04

CC:  tscrim tmonteil

Keywords: ribbon, graph, graphs, surfaces, orientable

This ticket is meant to implement a new class of objects: ribbon graphs. These are graphs together with a cyclic ordering of the half edges adjacent to each vertex. This data allows us to unambiguosly "thicken" the  ribbon graph to an orientable surface with boundary.

This will be done by encoding the ribbon graphs in two permutations. As done for example in [Gir] (and many other places). This is also meant to include basic methods of the class to compute:
  
   * Genus of the thicekning
   * Number of boundary components
   * Labeling of the boundary components (see also [Gir])
   * A basis of the homology of the graph (and so of the thickening)
       -This base satisfies the condition that each element of the basis is an embedded circle in the graph and contains one (and only one) edge that is not in any other element of the basis.

This is implementation is useful in itself but is also meant to serve as a base for a later implementation of something called "tete-a-tete" graphs which is an original idea by the mathematician Norbert A'Campo [Nor] and has been developed in my thesis. These other graphs model periodic automorphisms of the thickening of the graph.

[Gir] Girondo, Ernesto; González-Diez, Gabino (2012), Introduction to compact Riemann surfaces and dessins d'enfants, London Mathematical Society Student Texts, 79, Cambridge: Cambridge University Press,

[Nor] Tete-a-tete graphs and geometric monodromy


---

Comment by pportilla created at 2016-09-24 21:37:51

Set assignee to pportilla.


---

Comment by git created at 2016-09-25 05:34:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-25 05:40:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-25 05:43:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-25 06:00:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-25 15:25:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-09-25 15:45:32

This will be a nice addition. A few quick comments to help:

- You have a `.directory` file that has gotten mixed in with your commit.
- You should only import things you need, not `sage.all`. From within Sage, you can use `import_statements(foo)` to see the import.
- I've found it helpful to write docstrings (with doctests) as soon as I create a new function/method.

Looking forward to this being ready for review.


---

Comment by pportilla created at 2016-09-25 15:54:48

Replying to [comment:12 tscrim]:
> This will be a nice addition. A few quick comments to help:
> 
> - You have a `.directory` file that has gotten mixed in with your commit.
> - You should only import things you need, not `sage.all`. From within Sage, you can use `import_statements(foo)` to see the import.
> - I've found it helpful to write docstrings (with doctests) as soon as I create a new function/method.
> 
> Looking forward to this being ready for review.

Thank you for the comments!

Basically I was working on this on my own for doing some computations and somebody told me that this might be useful for other  people, so I decided to collaborate on Sage development. It happens that I had two ".sage" files that were written "for me". So now I am doing all the translation to python + adjusting to developers guide lines. That's why there is no docstrings yet and the format is not yet adapted. 

The import sage.all was just to check that the .py file actually compiled :)


---

Comment by git created at 2016-09-26 04:48:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-03 05:20:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-03 21:34:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-03 21:38:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-04 19:04:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-10-04 19:31:14

Since this is the only file for ribbon graphs, I think it is overkill to have it be in a separate folder.


---

Comment by pportilla created at 2016-10-04 20:03:52

Replying to [comment:20 tscrim]:
> Since this is the only file for ribbon graphs, I think it is overkill to have it be in a separate folder.

I understand it is overkill for now, but I will open a new ticket shortly depending on this and add a second file. This file will be about the so called tete-a-tete graphs that model automorphisms of surfaces.

I thought it was appropriated but I will revert the changes if it is not. Also I don't know if this fits more in "geometry". ?¿


---

Comment by tscrim created at 2016-10-04 20:07:18

I would say 4 or so files would deserve a new folder, so I still recommend reverting. However, considering where you want this to go and how I think about ribbon graphs, `geometry` would be a much better fit than `combinat`.


---

Comment by git created at 2016-10-04 22:34:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-05 04:11:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-05 05:32:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-10-05 05:38:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-10-05 05:38:30

New commits:
----
New commits:


---

Comment by pportilla created at 2016-10-05 05:38:30

Changing component from combinatorics to geometry.


---

Comment by git created at 2016-10-05 16:19:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-05 20:23:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-06 05:35:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-06 16:56:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-06 20:10:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-07 05:08:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-10-07 05:11:11

I submit the ticket to review. Comments, bugs, anything is welcomed.

There are some methods such as homology_basis() that might not have a clear purpose. Nevertheless they work as expected and are there because a future ticket will use them. In general, this ticket just lets you play with ribbon graphs and I think it could be useful for people trying to make computations on dessins d'enfant for example. Also it will be useful (and necessary) for the implementation of tete-a-tete graph as I said in the beginning. i will start with this project as soon as this ticket is positively reviewed to be included in the next sage version.

Also, is there a way to include images on the documentation?. And I mean images created for example with IPE (not by plotting with sphinx_plot).

EDIT: at some point I did a force-push (I know I know) so if conflict appear for anyway, I recommend deleting your local branch and re-pulling it.


---

Comment by pportilla created at 2016-10-07 05:11:11

Changing status from new to needs_review.


---

Comment by git created at 2016-10-11 17:05:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-10-11 17:05:56

Replying to [comment:35 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[d2cf929](https://git.sagemath.org/sage.git/commit/?id=d2cf929a4b96572962914f988035d5deb8a65dbf)||`Merge remote-tracking branch 'trac/u/SimonKing/metaclass_framework' into t/21587/ribbon_graphs`||

Just merged to the new rc0.


---

Comment by pportilla created at 2016-10-16 19:27:32

I don't know if I have to do anything else in order for people to start reviewing or is it just that there are a lot of tickets to review and few people reviewing


---

Comment by tscrim created at 2016-10-17 02:34:13

Replying to [comment:37 pportilla]:
> I don't know if I have to do anything else in order for people to start reviewing or is it just that there are a lot of tickets to review and few people reviewing

It's a waiting game a lot of times. I hope to get around to review this soon, but unfortunately, I have a few other things that are higher priority at the moment. It takes finding someone who has enough knowledge in the area and time (which sometimes is 0, but I will [eventually] review this).


---

Comment by pportilla created at 2016-10-17 04:12:56

Replying to [comment:38 tscrim]:
> Replying to [comment:37 pportilla]:
> > I don't know if I have to do anything else in order for people to start reviewing or is it just that there are a lot of tickets to review and few people reviewing
> 
> It's a waiting game a lot of times. I hope to get around to review this soon, but unfortunately, I have a few other things that are higher priority at the moment. It takes finding someone who has enough knowledge in the area and time (which sometimes is 0, but I will [eventually] review this).

Thanks for the quick answer! I will try to review or at least test some other tickets myself.


---

Comment by git created at 2016-10-19 15:15:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-11-17 21:05:42

A test has been run by a patchbot. Everything was fine except for the  "startup_time". Is there something that I have to do to fix this? Or this issue just deppends on the architecture on which the test is being run and I shouldn't do anything?

Thank you,

pportilla


---

Comment by tscrim created at 2016-11-17 23:52:01

It probably comes from the fact that we probably want to lazily import this to avoid increasing the number of imports at the startup of Sage. Also, you seem to have accidentally included changes to the git ignore file.


---

Comment by tscrim created at 2016-11-17 23:52:31

Also I will be at a SageDays next week and plan to review this ticket during that time.


---

Comment by git created at 2016-11-18 03:51:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-11-18 03:58:23

Replying to [comment:43 tscrim]:
> Also I will be at a SageDays next week and plan to review this ticket during that time.

First of all: thank you! When this is positively reviewed, I have more interesting work to upload on other tickets (related to ribbon graphs)!

I already reverted .gitignore to its original state, thanks for that.

Should I change all imports for lazy imports? Will that do it?


---

Comment by tscrim created at 2016-11-18 05:04:32

You only need to change the one in `all.py`:

```
from .ribbon_graph import RibbonGraph, make_ribbon
```

as that is the one that gets called on startup (which then subsequently calls the ones in `ribbon_graph.py`).


---

Comment by dcoudert created at 2016-11-18 09:11:59

I did not check all the code, but the following must be done:

* method `_find` should be simplified as follows, where an error is raised if the k is not in the list.

```
for i,lst in enumerate(l):
    if k in lst:
        return [i, lst.index(k)]
raise ValueError("element {} not found".format(k))
```


* method `_clean` should be simplied as `return [copy(elt) for elt in l if len(elt)>0]` 

* Many other simplifications could be done. For instance:
 - `darts_rho = [j for i in range(len(repr_rho)) for j in repr_rho[i]]` is `darts_rho = flatten(repr_rho)`
 - `darts_sigma = flatten(repr_sigma)`


---

Comment by dcoudert created at 2016-11-18 09:11:59

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-11-18 15:12:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-18 15:32:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-11-22 11:11:44

Changing status from needs_work to needs_review.


---

Comment by pportilla created at 2016-11-22 11:11:44

I forgot to change the state to "need review" after commiting the suggested fixes.


---

Comment by tscrim created at 2016-11-22 12:41:51

I have made it through the code and overall it looks good. I reworked some things to fix some things I encountered while I was doing my review. I also went through the doc and brought it up to Sage standards. If my changes look good, then you can set it to a positive review.
----
New commits:


---

Comment by tscrim created at 2016-11-22 12:41:51

Changing keywords from "ribbon, graph, graphs, surfaces, orientable" to "ribbon, graph, graphs, surfaces, orientable, days79".


---

Comment by dcoudert created at 2016-11-22 13:16:49

In the `_find` method, you should add a `TEST:` section for the case when an error is raised.

Shouldn't you put almost all the introduction to the topic and so that you have in the `class RibbonGraph` in the module description ? In the class, you can then refer to the module's documentation.


---

Comment by git created at 2016-11-22 15:26:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-22 15:27:35

Replying to [comment:53 dcoudert]:
> In the `_find` method, you should add a `TEST:` section for the case when an error is raised.

Added.

> Shouldn't you put almost all the introduction to the topic and so that you have in the `class RibbonGraph` in the module description ? In the class, you can then refer to the module's documentation.

No, you want the doc in the class-level doc because then it is accessible from the command line `RibbonGraph?`. It is also easy to find in the full doc page as well.


---

Comment by pportilla created at 2016-11-22 15:58:50

The changes look very good to me. (thank you).

If the other reviewer also agrees, it can be changed to positive_review.


---

Comment by git created at 2016-11-23 16:30:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-25 16:14:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-27 11:40:07

David, any other comments?


---

Comment by dcoudert created at 2016-11-27 12:09:00

I don't really understand what is a ribbon graph, so it's not easy to comment.
However, it is surprising to have methods for contracting and extruding edges but not a method to list vertices or edges.

Also, the method `bipartite_rib` that is added to the global namespace (I'm not sure it is useful here) should be renamed to e.g., `bipartite_ribbon_graph` or something like that.

a typo: A ribbon graph codified as two elements of a `certaing` permutation


---

Comment by pportilla created at 2016-11-27 18:35:29

Replying to [comment:60 dcoudert]:
> I don't really understand what is a ribbon graph, so it's not easy to comment.
> However, it is surprising to have methods for contracting and extruding edges but not a method to list vertices or edges.
> 
> Also, the method `bipartite_rib` that is added to the global namespace (I'm not sure it is useful here) should be renamed to e.g., `bipartite_ribbon_graph` or something like that.
> 
> a typo: A ribbon graph codified as two elements of a `certaing` permutation

A ribbon graph is an object that recovers the topology of a surface with boundary. You can see it as the "spine" (a strong deformation retract) of a surface with boundary. The combinatorial data of a ribbon graph (the two permutations) allow us to unambiguously thicken the graph to a surface with boundary. I think that to people familiar with the mathematical object this implementation is quite natural. 

I'm not on my laptop at the moment but I think that I state that one can look at the cycles that form sigma as the vertices and the cycles that form tho as the edges. The names are chosen sigma and tho because those are used in some texts as well as sigma_0 and sigma_1.

I don't understand what "useful" means in this context but the bipartite_rib function produces a lot of examples of ribbon graphs such that their thickenings (associated surfaces with boundary) are very much used in Singularity theory. In fact they are the building blocks for all Milnor fibers of plane curve singularities. And I will definitely use them on the implementation of tete-a-tete graphs. 

I agree on changing the name as well as the other correction. I will fix them when I get home!


---

Comment by git created at 2016-11-28 10:21:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-03 18:08:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-12-03 18:33:22

I don't plan to update this ticket with new methods. I am also happy with your changes so whenever you think it is the time, you can positively review it.

Also, I created a new ticket #22016 to implement ribbon graphs (it depends on this ticket). However there seems to be some kind of problem: first, the branch name appears in read and second, I can't checkout that ticket.


---

Comment by tscrim created at 2016-12-03 18:38:12

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-12-03 18:38:12

I changed the constructor of `RibbonGraph` to allow access to the bipartite construction so we avoid putting more stuff in the global namespace.

Ribbon graphs also have appeared in the recent preprint https://arxiv.org/abs/1612.00061, where they are related to Brauer graph algebras. I'm not entirely convinced that getting a list of edges and vertices is useful with the current implementation.

So, since Pablo says my changes are good, I'm setting this to a positive review. David, if you have any objections, feel free to set back to needs work.


---

Comment by dcoudert created at 2016-12-03 18:42:09

No objection.
Best,


---

Comment by vbraun created at 2016-12-04 12:25:54


```
3048[dochtml] [geometry ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/ribbon_graph.py:docstring of sage.geometry.ribbon_graph.RibbonGraph.normalize:7: WARNING: Bullet list ends without a blank line; unexpected unindent.
3049[dochtml] Error building the documentation.
3050[dochtml] Traceback (most recent call last):
3051[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python/runpy.py", line 162, in _run_module_as_main
3052[dochtml]     "__main__", fname, loader, pkg_name)
3053[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python/runpy.py", line 72, in _run_code
3054[dochtml]     exec code in run_globals
3055[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
3056[dochtml]     main()
3057[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1667, in main
3058[dochtml]     builder()
3059[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
3060[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
3061[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
3062[dochtml]     build_many(build_ref_doc, L)
3063[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 266, in build_many
3064[dochtml]     results.append(target(arg))
3065[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 70, in build_ref_doc
3066[dochtml]     getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
3067[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 719, in _wrapper
3068[dochtml]     getattr(DocBuilder, build_type)(self, *args, **kwds)
3069[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 104, in f
3070[dochtml]     runsphinx()
3071[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 215, in runsphinx
3072[dochtml]     raise exception
3073[dochtml] OSError: [geometry ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/ribbon_graph.py:docstring of sage.geometry.ribbon_graph.RibbonGraph.normalize:7: WARNING: Bullet list ends without a blank line; unexpected unindent.
3074[dochtml] 
3075Makefile:1071: recipe for target 'doc-html-mathjax' failed
3076make[1]: *** [doc-html-mathjax] Error 1
3077make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
```



---

Comment by vbraun created at 2016-12-04 12:25:54

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-12-04 15:11:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pportilla created at 2016-12-04 15:12:40

It should be fixed now. There were a couple of spaces missing in an OUTPUT environment.


---

Comment by tscrim created at 2016-12-04 15:28:24

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-12-05 22:35:03

Resolution: fixed
