# Issue 20966: basic element and parent for k-regular sequences

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-08-10 13:11:00

CC:  rws galipnik

Implement minimal element and parent classes for working with k-regular sequences

See also Meta ticket #21202.


---

Comment by dkrenn created at 2016-08-10 13:18:49

Last 10 new commits:


---

Comment by git created at 2016-08-11 06:33:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-18 15:01:30

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-08-19 12:25:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-08-19 12:29:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-08-19 12:31:21

Changing status from new to needs_review.


---

Comment by git created at 2016-08-22 12:56:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-08-22 15:35:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-08-23 18:27:39

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-08-25 11:04:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-25 11:14:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-08-25 11:15:21

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-08-26 11:24:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-26 11:54:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2017-01-05 12:17:23

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2017-01-05 12:17:23

python3 patchbot plugin failure


---

Comment by git created at 2017-01-24 13:05:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-01-24 13:06:22

Replying to [comment:18 cheuberg]:
> python3 patchbot plugin failure

Should be fixed. Branch is now on 7.5.


---

Comment by git created at 2017-01-24 13:09:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-01-24 13:11:15

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-04-06 07:39:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-29 08:49:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2021-02-10 11:16:27

New commits:


---

Comment by cheuberg created at 2021-02-10 11:19:38

1. Example Binary sum of digits: It would be helpful to explain why this is a linear representation of the binary sum of digits. (However: why not choosing a simpler representation having the sum of digits and a constant sequence in the vector? Here, the first component is one minus the sum of digits)

2. Example Number of odd entries in Pascal's triangle: u(n) seems to be the number of odd entries up to row n-1. This could be made more explicit and the linear representation as well as the recursive formula could be explained, possibly with a reference.

3. `kRegularSequence`: please add an explanation on how to access elements of the sequence to the documentation of the class (it is now in the documentation of the module, but without explanation, and the docstrings of `__getitem__` and `__iter__` are not shown in the documentation.

4. `kRegularSequenceSpace`: I think that to the casual user, the use of the word "coefficient" might be surprising.

5. `_n_to_index_`: I would prefer a `ValueError` with meaningful message instead of an `OverflowError`.


---

Comment by cheuberg created at 2021-04-19 08:13:41

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2021-04-19 08:13:41

6. Please move reference AS2003 to src/doc/en/reference/references/index.rst as per the developer's guide ​https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content 

7. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items


---

Comment by cheuberg created at 2021-04-19 08:32:16

8. One more very minor detail: docstring of `__getitem__`: Apparently ``n`th` is not recognised correctly: there is an error message "docstring of `sage.combinat.k_regular_sequence.kRegularSequence.__getitem__`:1: WARNING: Inline interpreted text or phrase reference start-string without end-string." when running `./sage --docbuild --underscore reference/combinat html`, and no LaTeX formatting occurs.


---

Comment by git created at 2021-04-29 11:18:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2021-04-29 11:43:16

I pushed a clean merge of #21295 in order to have a base for #27940.


---

Comment by dkrenn created at 2021-05-06 08:06:15

Started working on this ticket again. Merge in the dependency #21295 and adapted the code.

Replying to [comment:27 cheuberg]:
> 6. Please move reference AS2003 to src/doc/en/reference/references/index.rst as per the developer's guide ​https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content 

Done.

> 7. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items

Done.
----
Last 10 new commits:


---

Comment by git created at 2021-05-06 17:49:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2021-05-06 17:50:06

Replying to [comment:28 cheuberg]:
> 8. One more very minor detail: docstring of `__getitem__`: Apparently ``n`th` is not recognised correctly: there is an error message "docstring of `sage.combinat.k_regular_sequence.kRegularSequence.__getitem__`:1: WARNING: Inline interpreted text or phrase reference start-string without end-string." when running `./sage --docbuild --underscore reference/combinat html`, and no LaTeX formatting occurs. 

Fixed


---

Comment by dkrenn created at 2021-05-06 17:52:20

Replying to [comment:26 cheuberg]:
> 1. Example Binary sum of digits: It would be helpful to explain why this is a linear representation of the binary sum of digits. (However: why not choosing a simpler representation having the sum of digits and a constant sequence in the vector? Here, the first component is one minus the sum of digits)

Example changed (easier representation used) and more explanations.

> 2. Example Number of odd entries in Pascal's triangle: u(n) seems to be the number of odd entries up to row n-1. This could be made more explicit and the linear representation as well as the recursive formula could be explained, possibly with a reference.

Linear representation changed and some text added. For sure more could always be made...

> 3. `kRegularSequence`: please add an explanation on how to access elements of the sequence to the documentation of the class (it is now in the documentation of the module, but without explanation, and the docstrings of `__getitem__` and `__iter__` are not shown in the documentation.

Example added.

> 4. `kRegularSequenceSpace`: I think that to the casual user, the use of the word "coefficient" might be surprising.

Yes, indeed. Naming is not that easy here. Everything with "base" seems to be no option was we have "k" that is called base as well. I now give "coefficient_ring" a try (also changed at at #21295), but I am very open to other, better suggestions.

> 5. `_n_to_index_`: I would prefer a `ValueError` with meaningful message instead of an `OverflowError`.

Changed.


---

Comment by dkrenn created at 2021-05-06 17:52:38

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2021-05-06 19:11:07

Thank you for your changes.

I have one question and another minor suggestion.

9. What was the motivation to remove "If not specified (`None`), then the integer ring is used." ?

10. I suggest to use `raise ... from None` where appropriate (e.g., the `OverflowError` caught in `_n_to_index_`) to avoid lengthy stack traces like

```
...
/local/cheuberg/local/sage-9.3.rc3/local/lib/python3.6/site-packages/sage/combinat/words/word_char.pyx in sage.combinat.words.word_char.WordDatatype_char._set_data (build/cythonized/sage/combinat/words/word_char.c:3830)()
    110         for i in range(self._length):
--> 111             self._data[i] = data[i]
    112 

OverflowError: can't convert negative value to unsigned char

During handling of the above exception, another exception occurred:

ValueError                                Traceback (most recent call last)
<ipython-input-1-b7387a9417cd> in <module>
      2 Seq2._n_to_index_(Integer(6))
      3 word: Integer(11)
----> 4 Seq2._n_to_index_(-Integer(1))

/local/cheuberg/local/sage-9.3.rc3/local/lib/python3.6/site-packages/sage/combinat/k_regular_sequence.py in _n_to_index_(self, n)
    353             return W(n.digits(self.k))
    354         except OverflowError:
--> 355             raise ValueError('value {} of index is negative'.format(n))

ValueError: value -1 of index is negative
```



---

Comment by cheuberg created at 2021-05-06 19:11:07

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-05-10 11:28:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-11 13:55:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2021-05-11 13:58:04

Replying to [comment:38 cheuberg]:
> Thank you for your changes.
> 9. What was the motivation to remove "If not specified (`None`), then the integer ring is used." ?

I believe that there is no obvious/canonical base ring for regular sequences, so I think, there should not be set a somehow artificial choice. (BTW, never used in the the tests, except for one specific test on this default argument.)

> 10. I suggest to use `raise ... from None` where appropriate (e.g., the `OverflowError` caught in `_n_to_index_`) to avoid lengthy stack traces like [...]

Yes, indeed, this output is quite lengthy and does not bring anything. Done.


---

Comment by dkrenn created at 2021-05-11 13:58:04

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2021-05-11 18:25:07

Changing status from needs_review to positive_review.


---

Comment by cheuberg created at 2021-05-11 18:25:07

Thank you, all seems to be fine. For the record: the lint warnings do not concern the files changed in this ticket.


---

Comment by vbraun created at 2021-06-06 13:19:35

Resolution: fixed
