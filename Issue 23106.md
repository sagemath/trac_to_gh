# Issue 23106: Handling flatten.py and some mild cleanup

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-06-30 12:24:56

CC:  tscrim




---

Comment by jdemeyer created at 2017-06-30 12:25:56

New commits:


---

Comment by jdemeyer created at 2017-06-30 12:25:56

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-07-03 13:04:47

Since you are cleaning this up anyway, I would prefer if you could also move the changes from #10483 to `flatten.py` to this branch. For example, it would allow to test whether the changes here are compatible with #10483.


---

Comment by jdemeyer created at 2017-07-03 13:04:47

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2017-07-03 14:46:04

I don't think they are really compatible. Instead, I think these changes should replace those in #10483. The changes of #10483 rely on strings for keys rather than variables, which (in principle) would not work if a variable name is repeated (I haven't explicitly tested that this works in my code or if this is [suppose to be] a supported feature).


---

Comment by jdemeyer created at 2017-07-03 14:48:50

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-07-03 14:51:44

OK, that wasn't clear. Thanks for the clarification.


---

Comment by jdemeyer created at 2017-07-04 10:36:16

In order to understand the `SpecializationMorphism`, I ended up doing a lot more clean up. Please review my commit.
----
New commits:


---

Comment by tscrim created at 2017-07-04 13:34:40

Inserting at the beginning of a list repeatedly is more expensive than inserting at the end and then reversing (it has to bump each entry back every time you insert). Granted, at this scale it may not be a big issue.

Somewhere between paranoia and it makes the code easier to parse:

```diff
-            force_multivariate = (len(old) == 1) and is_MPolynomialRing(R)
+            force_multivariate = ((len(old) == 1) and is_MPolynomialRing(R))
```


Is there a definitive reason to force the multivariate polynomial ring? I know you're not changing the current implementation, but I'm just wondering if that is something that is necessary since the univariates tend to be more powerful. If you don't know, then we can just leave it as is.

LGTM otherwise.


---

Comment by jdemeyer created at 2017-07-04 13:36:45

Replying to [comment:9 tscrim]:
> Is there a definitive reason to force the multivariate polynomial ring?

I don't know, I just didn't want to change the existing behaviour.


---

Comment by git created at 2017-07-04 13:43:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-07-04 13:46:24

Minor update.


---

Comment by tscrim created at 2017-07-04 13:52:31

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-07-04 13:52:31

Thanks. LGTM.


---

Comment by chapoton created at 2017-07-05 06:09:19

missing utf8 declaration in src/sage/rings/polynomial/flatten.py


---

Comment by git created at 2017-07-05 11:12:45

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2017-07-05 11:12:45

Changing status from positive_review to needs_review.


---

Comment by jdemeyer created at 2017-07-05 11:14:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-07-26 22:12:57

Resolution: fixed
