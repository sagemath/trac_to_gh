# Issue 28210: posets: introduce a boolean lequal_matrix

Issue created by migration from https://trac.sagemath.org/ticket/28447

Original creator: chapoton

Original creation time: 2019-09-03 09:11:28

CC:  tscrim jmantysalo

for better speed

not yet clear for small size


---

Comment by chapoton created at 2019-09-03 09:14:18

For small posets: after, one gets

```
sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
sage: H = P._hasse_diagram
sage: %time H.lequal_matrix()
CPU times: user 623 µs, sys: 7 µs, total: 630 µs
Wall time: 634 µs
```

and before, one got

```
sage: sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
....: sage: H = P._hasse_diagram
....: sage: %time H.lequal_matrix()
....: 
CPU times: user 328 µs, sys: 0 ns, total: 328 µs
Wall time: 332 µs
```

so there is a loss here.

For larger posets, there is a gain. This needs to be investigated.
----
New commits:


---

Comment by git created at 2019-09-03 12:24:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-09-03 12:26:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-09-03 12:32:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2019-09-03 15:42:28

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-09-04 02:18:01

Any updates from the timings in comment:1?


---

Comment by chapoton created at 2019-09-04 06:25:50

I am away from home in the next 3 days, so I will have no time to update the timings. I think the current branch gives a smaller difference, still in the wrong direction.


---

Comment by chapoton created at 2019-09-07 15:33:59

With the branch I am going to post soon:
Before:

```
sage: sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
....: sage: H = P._hasse_diagram
....: sage: %time H.lequal_matrix()
....: 
CPU times: user 591 µs, sys: 60 µs, total: 651 µs
Wall time: 660 µs
```

After:

```
sage: sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
....: sage: H = P._hasse_diagram
....: sage: %time H.lequal_matrix()
....: 
CPU times: user 537 µs, sys: 10 µs, total: 547 µs
Wall time: 556 µs
```

So there is now a small progress in that case.


---

Comment by git created at 2019-09-07 15:34:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-09-07 16:05:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-09-08 10:52:11

Great. LGTM.


---

Comment by tscrim created at 2019-09-08 10:52:11

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-09-08 11:45:44

Thanks, Travis. Did you make any timings, just to be sure ? I am slightly uncertain whether this is a general speedup of posets.


---

Comment by tscrim created at 2019-09-08 22:02:12

I noticed some mild speedups across the board:

Before:

```
sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 1.23 ms, sys: 158 µs, total: 1.39 ms
Wall time: 1.28 ms

sage: P = posets.CoxeterGroupAbsoluteOrderPoset(CoxeterGroup(['B',4]))
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 65.2 ms, sys: 4.05 ms, total: 69.2 ms
Wall time: 64 ms

sage: P = posets.SymmetricGroupBruhatOrderPoset(6)
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 966 ms, sys: 36.3 ms, total: 1 s
Wall time: 981 ms
```

After:

```
sage: P = posets.NoncrossingPartitions(SymmetricGroup(4))
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 1.11 ms, sys: 105 µs, total: 1.21 ms
Wall time: 1.05 ms

sage: P = posets.CoxeterGroupAbsoluteOrderPoset(CoxeterGroup(['B',4]))
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 67.4 ms, sys: 0 ns, total: 67.4 ms
Wall time: 63.8 ms

sage: P = posets.SymmetricGroupBruhatOrderPoset(6)
sage: H = P._hasse_diagram
sage: %time _ = H.lequal_matrix()
CPU times: user 921 ms, sys: 20.1 ms, total: 941 ms
Wall time: 937 ms
```



---

Comment by vbraun created at 2019-09-10 23:01:35

Resolution: fixed
