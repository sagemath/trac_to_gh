# Issue 22175: timeit("...") does not work inside a function

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2017-02-22 10:34:03

Apparently, timeit('some expression') evaluates the expression in the
context of the interpreter rather than the local context where timeit
is being called, which can lead to unexpected results (some students
of mine got trapped today).

Let's take an example, where we time a non trivial factorization:


```
    sage: p = (1-x^100)
    sage: timeit('factor(p)', seconds=True)
    0.007231048583984375
```


Now, let's do the same inside a function:

```
    sage: def f(p):
    ....:     return timeit('factor(p)', seconds=True)
    sage: f(p)                    # That's normal
    0.007200319290161133
    sage: f(1)                    # OOPS, That should be instantaneous!
    0.007200319290161133
```


I am not sure there is an easy fix, but at least this limitation needs
to be documented.



---

Comment by tmonteil created at 2017-02-26 13:22:54

Note that the following seems to work:


```
sage: def f(p):
....:     return timeit('factor({})'.format(p), seconds=True)
sage: p = (1-x^100)
sage: f(p)
0.013366518020629882
sage: f(1)
4.191055297851562e-05
```


I am not sure whether what you reported should be considered as a bug however (there is some local/global context issue but i am not sure about how Python should behave in such a case).
