# Issue 19606: Improve location change error message

archive/issues_019606.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/19843\n\n",
    "created_at": "2016-01-07T22:45:47Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Improve location change error message",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19606",
    "user": "vbraun"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/19843





---

archive/issue_comments_269416.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269416",
    "user": "vbraun"
}
```

New commits:



---

archive/issue_comments_269417.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269417",
    "user": "vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_269418.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269418",
    "user": "vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_269419.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269419",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_269420.json:
```json
{
    "body": "This seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.",
    "created_at": "2016-01-08T06:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269420",
    "user": "kcrisman"
}
```

This seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.



---

archive/issue_comments_269421.json:
```json
{
    "body": "This warning is useful:\n\n```sh\n    # Display a message if we actually installed something (using this\n    # file, generated by sage-spkg, is a bit of a hack though)\n    if [ -f \"$SAGE_LOCAL/lib/sage-force-relocate.txt\" ]; then\n        echo\n        echo \"Warning: it might be needed to update the Sage library before\"\n        echo \"installed packages work: you should run 'make' from \\$SAGE_ROOT\"\n        echo \"before running Sage.\"\n    fi\n```\n\nUsing `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.",
    "created_at": "2016-01-16T13:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269421",
    "user": "jdemeyer"
}
```

This warning is useful:

```sh
    # Display a message if we actually installed something (using this
    # file, generated by sage-spkg, is a bit of a hack though)
    if [ -f "$SAGE_LOCAL/lib/sage-force-relocate.txt" ]; then
        echo
        echo "Warning: it might be needed to update the Sage library before"
        echo "installed packages work: you should run 'make' from \$SAGE_ROOT"
        echo "before running Sage."
    fi
```

Using `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.



---

archive/issue_comments_269422.json:
```json
{
    "body": "There is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.",
    "created_at": "2016-01-16T14:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269422",
    "user": "vbraun"
}
```

There is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.



---

archive/issue_comments_269423.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-01-16T14:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269423",
    "user": "vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_269424.json:
```json
{
    "body": "this should really be in 7.0",
    "created_at": "2016-01-16T14:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269424",
    "user": "vbraun"
}
```

this should really be in 7.0



---

archive/issue_comments_269425.json:
```json
{
    "body": "Please read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.",
    "created_at": "2016-01-16T14:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269425",
    "user": "jdemeyer"
}
```

Please read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.



---

archive/issue_comments_269426.json:
```json
{
    "body": "Hmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?",
    "created_at": "2016-01-16T14:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269426",
    "user": "vbraun"
}
```

Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?



---

archive/issue_comments_269427.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> Hmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed\n\nThat's not true. This is to catch \"reverse dependencies\": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.",
    "created_at": "2016-01-16T19:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269427",
    "user": "jdemeyer"
}
```

Replying to [comment:9 vbraun]:
> Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed

That's not true. This is to catch "reverse dependencies": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.



---

archive/issue_comments_269428.json:
```json
{
    "body": "Make already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. \n\nIn any case, I made #19902 for that.",
    "created_at": "2016-01-16T20:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269428",
    "user": "vbraun"
}
```

Make already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. 

In any case, I made #19902 for that.



---

archive/issue_comments_269429.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> Make already has `--question` to check whether dependencies are satisfied. We should just use that.\nThe problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.\n\n> Or, even easier, print that warning simply after `make B`.\nOK, please move this message to the end of `sage-spkg` then.",
    "created_at": "2016-01-17T08:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269429",
    "user": "jdemeyer"
}
```

Replying to [comment:11 vbraun]:
> Make already has `--question` to check whether dependencies are satisfied. We should just use that.
The problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.

> Or, even easier, print that warning simply after `make B`.
OK, please move this message to the end of `sage-spkg` then.



---

archive/issue_comments_269430.json:
```json
{
    "body": "See #19902",
    "created_at": "2016-01-17T09:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269430",
    "user": "vbraun"
}
```

See #19902



---

archive/issue_comments_269431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-17T13:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269431",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-17T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269432",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_269433.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-18T10:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269433",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_269434.json:
```json
{
    "body": "This is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.\n\nEither you run them every time a package is installed (like it used to be) or you never run them.\n\nSecond, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.",
    "created_at": "2016-01-18T10:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269434",
    "user": "jdemeyer"
}
```

This is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.

Either you run them every time a package is installed (like it used to be) or you never run them.

Second, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.



---

archive/issue_comments_269435.json:
```json
{
    "body": "I suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.",
    "created_at": "2016-01-18T10:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269435",
    "user": "jdemeyer"
}
```

I suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.



---

archive/issue_comments_269436.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-18T12:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269436",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_269437.json:
```json
{
    "body": "Making script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.\n\nThis branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.\n\nFeature requests for `check_processor_flags` should also go to a separate ticket.",
    "created_at": "2016-01-18T12:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269437",
    "user": "vbraun"
}
```

Making script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.

This branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.

Feature requests for `check_processor_flags` should also go to a separate ticket.



---

archive/issue_comments_269438.json:
```json
{
    "body": "Replying to [comment:18 vbraun]:\n> But I have no intention of engaging in a bikeshedding session here over what to do\n\nNot every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\n> either change it yourself\n\nFine.",
    "created_at": "2016-01-18T12:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269438",
    "user": "jdemeyer"
}
```

Replying to [comment:18 vbraun]:
> But I have no intention of engaging in a bikeshedding session here over what to do

Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).

> either change it yourself

Fine.



---

archive/issue_comments_269439.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-18T12:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269439",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_269440.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Not every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\nThat is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.",
    "created_at": "2016-01-18T12:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269440",
    "user": "vbraun"
}
```

Replying to [comment:19 jdemeyer]:
> Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).

That is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.



---

archive/issue_comments_269441.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-18T12:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269441",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_269442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-18T12:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269442",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_269443.json:
```json
{
    "body": "This implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.",
    "created_at": "2016-01-18T12:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269443",
    "user": "jdemeyer"
}
```

This implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.



---

archive/issue_comments_269444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-18T12:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269444",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_269445.json:
```json
{
    "body": "much worse but at least we don't have to hold the release process hostage any more with this pointless exercise",
    "created_at": "2016-01-18T12:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269445",
    "user": "vbraun"
}
```

much worse but at least we don't have to hold the release process hostage any more with this pointless exercise



---

archive/issue_comments_269446.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-18T12:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269446",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_269447.json:
```json
{
    "body": "> at least we don't have to hold the release process hostage\nIs that cynism really needed? Pointing out issues with a branch is not \"holding the release process hostage\".\n\nI think you are \"reverse bikeshedding\": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.\n\nAt least my patch is much safer than yours, because it really only changes the color of the bikeshed.",
    "created_at": "2016-01-18T12:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269447",
    "user": "jdemeyer"
}
```

> at least we don't have to hold the release process hostage
Is that cynism really needed? Pointing out issues with a branch is not "holding the release process hostage".

I think you are "reverse bikeshedding": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.

At least my patch is much safer than yours, because it really only changes the color of the bikeshed.



---

archive/issue_comments_269448.json:
```json
{
    "body": "It still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.",
    "created_at": "2016-01-18T13:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269448",
    "user": "vbraun"
}
```

It still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.



---

archive/issue_comments_269449.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> It still leaves lots of misleading messages about relocation\n\nI don't believe that the messages are so misleading. The most common is\n\n```\nForcing sage-location, probably because a new package was installed.\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\n```\n\nwhich is not really wrong.\n\nMore seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)",
    "created_at": "2016-01-18T13:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269449",
    "user": "jdemeyer"
}
```

Replying to [comment:28 vbraun]:
> It still leaves lots of misleading messages about relocation

I don't believe that the messages are so misleading. The most common is

```
Forcing sage-location, probably because a new package was installed.
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
```

which is not really wrong.

More seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)



---

archive/issue_comments_269450.json:
```json
{
    "body": "How is a user not going to interpret that as \"relocation is ok\", especially since it has been like that for the last years.",
    "created_at": "2016-01-18T13:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19606#issuecomment-269450",
    "user": "vbraun"
}
```

How is a user not going to interpret that as "relocation is ok", especially since it has been like that for the last years.
