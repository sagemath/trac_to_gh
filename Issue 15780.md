# Issue 15780: Get libs.mwrank to compile on OS X 10.4

archive/issues_015780.json:
```json
{
    "body": "CC:  @nexttime @vbraun jpflori\n\n\n```\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include/python2.7 -c sage/libs/mwrank/mwrank.c -o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o -fno-strict-aliasing -w\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include/python2.7 -c sage/libs/mwrank/wrap.cc -o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -fno-strict-aliasing -w\ng++ -bundle -undefined dynamic_lookup -L/Users/student/Desktop/sage-6.2.beta4/local/lib build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -L/Users/student/Desktop/sage-6.2.beta4/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.so\n/usr/bin/ld: warning can't open dynamic library: libflint.dylib referenced from: /Users/student/Desktop/sage-6.2.beta4/local/lib/libec.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)\n/usr/bin/ld: Undefined symbols:\n_nmod_mat_clear referenced from libec expected to be defined in libflint.dylib\n_nmod_mat_init referenced from libec expected to be defined in libflint.dylib\n_nmod_mat_rref referenced from libec expected to be defined in libflint.dylib\ncollect2: error: ld returned 1 exit status\nerror: command 'g++' failed with exit status 1\n```\n\nSee lots of discussion at [this sage-release thread](https://groups.google.com/forum/#!topic/sage-release/6Vh55hF7UXk).  Best guesses are either [this Flint bug](https://github.com/wbhart/flint2/issues/55) and leif's idea that there is a missing linker flag on Darwin (see the sage-release thread).\n\nIssue created by migration from https://trac.sagemath.org/ticket/16017\n\n",
    "created_at": "2014-03-26T18:21:40Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Get libs.mwrank to compile on OS X 10.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15780",
    "user": "https://github.com/kcrisman"
}
```
CC:  @nexttime @vbraun jpflori


```
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include/python2.7 -c sage/libs/mwrank/mwrank.c -o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o -fno-strict-aliasing -w
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include -I/Users/student/Desktop/sage-6.2.beta4/local/include/csage -I/Users/student/Desktop/sage-6.2.beta4/src -I/Users/student/Desktop/sage-6.2.beta4/src/sage/ext -I/Users/student/Desktop/sage-6.2.beta4/local/include/python2.7 -c sage/libs/mwrank/wrap.cc -o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -fno-strict-aliasing -w
g++ -bundle -undefined dynamic_lookup -L/Users/student/Desktop/sage-6.2.beta4/local/lib build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -L/Users/student/Desktop/sage-6.2.beta4/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.so
/usr/bin/ld: warning can't open dynamic library: libflint.dylib referenced from: /Users/student/Desktop/sage-6.2.beta4/local/lib/libec.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)
/usr/bin/ld: Undefined symbols:
_nmod_mat_clear referenced from libec expected to be defined in libflint.dylib
_nmod_mat_init referenced from libec expected to be defined in libflint.dylib
_nmod_mat_rref referenced from libec expected to be defined in libflint.dylib
collect2: error: ld returned 1 exit status
error: command 'g++' failed with exit status 1
```

See lots of discussion at [this sage-release thread](https://groups.google.com/forum/#!topic/sage-release/6Vh55hF7UXk).  Best guesses are either [this Flint bug](https://github.com/wbhart/flint2/issues/55) and leif's idea that there is a missing linker flag on Darwin (see the sage-release thread).

Issue created by migration from https://trac.sagemath.org/ticket/16017





---

archive/issue_comments_204287.json:
```json
{
    "body": "Leif's idea seems to have been right, though I don't know that setting the DYLD_ whatever path or rpath is any easier that what seemed to do it for me - just adding an explicit dependency in src/module_list.py, as we often do for Cygwin, which is more finicky.  From the thread:\n----\nBut the problem is that somehow the linking isn't happening properly in sage/libs/mwrank, and indeed -lflint isn't in the line\n\ng++ -bundle -undefined dynamic_lookup -L/Users/student/Desktop/sage-6.2.beta4/local/lib build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -L/Users/student/Desktop/sage-6.2.beta4/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.so\n\nMaybe could I add something to src/module_list.py or whatever the appropriate file is now to force -lflint as well?  On Cygwin we often had to be more explicit because of something analogous, if I recall that correctly.  I'm going to try this just to see...\n\nIt seems to work!  At least, things continue compiling. On Cygwin that was always the sign of victory, though :)\n\nSo Leif's idea was probably the right one.  I'll see if things finish up first and then run tests - John, any files I should run tests on first to make sure this did indeed compile and link correctly? \n\nHowever, I don't know the right *fix*.  I don't mind including extra things in module_list.py since probably Cygwin likes them too, but perhaps there is a better fix, or maybe there's a reason that's a bad fix, or something.",
    "created_at": "2014-03-27T17:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204287",
    "user": "https://github.com/kcrisman"
}
```

Leif's idea seems to have been right, though I don't know that setting the DYLD_ whatever path or rpath is any easier that what seemed to do it for me - just adding an explicit dependency in src/module_list.py, as we often do for Cygwin, which is more finicky.  From the thread:
----
But the problem is that somehow the linking isn't happening properly in sage/libs/mwrank, and indeed -lflint isn't in the line

g++ -bundle -undefined dynamic_lookup -L/Users/student/Desktop/sage-6.2.beta4/local/lib build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.4-ppc-2.7/sage/libs/mwrank/wrap.o -L/Users/student/Desktop/sage-6.2.beta4/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.4-ppc-2.7/sage/libs/mwrank/mwrank.so

Maybe could I add something to src/module_list.py or whatever the appropriate file is now to force -lflint as well?  On Cygwin we often had to be more explicit because of something analogous, if I recall that correctly.  I'm going to try this just to see...

It seems to work!  At least, things continue compiling. On Cygwin that was always the sign of victory, though :)

So Leif's idea was probably the right one.  I'll see if things finish up first and then run tests - John, any files I should run tests on first to make sure this did indeed compile and link correctly? 

However, I don't know the right *fix*.  I don't mind including extra things in module_list.py since probably Cygwin likes them too, but perhaps there is a better fix, or maybe there's a reason that's a bad fix, or something.



---

archive/issue_comments_204288.json:
```json
{
    "body": "Also required for sage.libs.cremona extensions.  Given that on Cygwin we will probably need this too, I'm suggesting that this is the right solution now.",
    "created_at": "2014-03-27T17:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204288",
    "user": "https://github.com/kcrisman"
}
```

Also required for sage.libs.cremona extensions.  Given that on Cygwin we will probably need this too, I'm suggesting that this is the right solution now.



---

archive/issue_comments_204289.json:
```json
{
    "body": "I'm pretty curious whether -- with the \"superfluous\" `-lflint` added -- you're still getting the weird\n\n```\n/usr/bin/ld: warning can't open dynamic library: libflint.dylib referenced from: /Users/student/Desktop/sage-6.2.beta4/local/lib/libec.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)\n```\n\n\nThe addition is IMHO just a work-around (on Darwin 8; still probably necessary on Cygwin); it doesn't address the root of the problem (provided we can trust the linker messages).  (Cf. my recent comment on the Sage 6.2.beta**4** thread on sage-release.)",
    "created_at": "2014-03-27T20:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204289",
    "user": "https://github.com/nexttime"
}
```

I'm pretty curious whether -- with the "superfluous" `-lflint` added -- you're still getting the weird

```
/usr/bin/ld: warning can't open dynamic library: libflint.dylib referenced from: /Users/student/Desktop/sage-6.2.beta4/local/lib/libec.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)
```


The addition is IMHO just a work-around (on Darwin 8; still probably necessary on Cygwin); it doesn't address the root of the problem (provided we can trust the linker messages).  (Cf. my recent comment on the Sage 6.2.beta**4** thread on sage-release.)



---

archive/issue_comments_204290.json:
```json
{
    "body": "... in other words:\n\nWhere the heck does the linker try to find the `libflint.dylib` `libec.dylib` refers to, and does `libec.dylib` really refer to `$SAGE_ROOT/local/lib/libflint.dylib` (modulo symlinks to versioned versions of the libraries)?\n\n\n\n\nCould Apple's `otool` enlighten us?  (Not sure whether passing `-t` to the Darwin linker would.)",
    "created_at": "2014-03-27T21:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204290",
    "user": "https://github.com/nexttime"
}
```

... in other words:

Where the heck does the linker try to find the `libflint.dylib` `libec.dylib` refers to, and does `libec.dylib` really refer to `$SAGE_ROOT/local/lib/libflint.dylib` (modulo symlinks to versioned versions of the libraries)?




Could Apple's `otool` enlighten us?  (Not sure whether passing `-t` to the Darwin linker would.)



---

archive/issue_comments_204291.json:
```json
{
    "body": "No, no warnings if I use that.  I really think it just doesn't know where to find it.  This happened on Cygwin all the time, like I said.  Yes, it's certainly just a workaround, but one that I can't really see a downside to.  I have no idea where it is looking, and I have pretty much run out of energy on this now that I found what I think it is an acceptable solution.  Not that I don't *want* a better one, but my sense is there may not be one that doesn't involve special casing a `-lflint` for old Macs for no particular reason, or that doesn't involve asking John to do something annoying with eclib.",
    "created_at": "2014-03-28T03:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204291",
    "user": "https://github.com/kcrisman"
}
```

No, no warnings if I use that.  I really think it just doesn't know where to find it.  This happened on Cygwin all the time, like I said.  Yes, it's certainly just a workaround, but one that I can't really see a downside to.  I have no idea where it is looking, and I have pretty much run out of energy on this now that I found what I think it is an acceptable solution.  Not that I don't *want* a better one, but my sense is there may not be one that doesn't involve special casing a `-lflint` for old Macs for no particular reason, or that doesn't involve asking John to do something annoying with eclib.



---

archive/issue_comments_204292.json:
```json
{
    "body": "Try using [https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/flint/files/flint-2.4-makefile.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/flint/files/flint-2.4-makefile.patch) in the patches folder for flint. Then in spkg-install \n\n```\nexport SHARE_FLAGS=\"-install_name ${SAGE_LOCAL}/lib/libflint.dylib\"\n```\n\nbefore $MAKE\nRebuild flint, eclib and see if that works. If it does we'll put that in a better shape.",
    "created_at": "2014-03-28T09:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204292",
    "user": "https://github.com/kiwifb"
}
```

Try using [https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/flint/files/flint-2.4-makefile.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/flint/files/flint-2.4-makefile.patch) in the patches folder for flint. Then in spkg-install 

```
export SHARE_FLAGS="-install_name ${SAGE_LOCAL}/lib/libflint.dylib"
```

before $MAKE
Rebuild flint, eclib and see if that works. If it does we'll put that in a better shape.



---

archive/issue_comments_204293.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-03-28T18:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204293",
    "user": "https://github.com/kcrisman"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_204294.json:
```json
{
    "body": "Thanks, that sounds fine too if it works, but I won't be able to try this until Monday.\n\nSince we have several workarounds now, and since (for now) this is still a supported platform, I'm making this a blocker for 6.2.",
    "created_at": "2014-03-28T18:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204294",
    "user": "https://github.com/kcrisman"
}
```

Thanks, that sounds fine too if it works, but I won't be able to try this until Monday.

Since we have several workarounds now, and since (for now) this is still a supported platform, I'm making this a blocker for 6.2.



---

archive/issue_comments_204295.json:
```json
{
    "body": "\n```sh\nleif@bsd:~/Sage/sage-6.2.beta5$ otool -DL local/lib/libec.dylib \nlocal/lib/libec.dylib:\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)\n\tlibflint.dylib (compatibility version 0.0.0, current version 0.0.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 125.2.11)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n```\n\n\nInteresting...  (Note the recorded path to the PARI library!)\n\nBut we (also) already have `-lpari` on the command line for linking the mwrank Python extension module (which I think by the way shouldn't be necessary either, as it isn't *directly* used IIRC):\n\n\n```\ng++ -bundle -undefined dynamic_lookup -L/Users/leif/Sage/sage-6.2.beta5/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.so\n```\n\n\nAnd FWIW, in the build on bsd.math, `libtool` also drops the `-rpath` given to it when linking `libec.dylib` (or, more precisely, `libec.0.dylib`).",
    "created_at": "2014-03-29T14:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204295",
    "user": "https://github.com/nexttime"
}
```


```sh
leif@bsd:~/Sage/sage-6.2.beta5$ otool -DL local/lib/libec.dylib 
local/lib/libec.dylib:
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)
	libflint.dylib (compatibility version 0.0.0, current version 0.0.0)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 125.2.11)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```


Interesting...  (Note the recorded path to the PARI library!)

But we (also) already have `-lpari` on the command line for linking the mwrank Python extension module (which I think by the way shouldn't be necessary either, as it isn't *directly* used IIRC):


```
g++ -bundle -undefined dynamic_lookup -L/Users/leif/Sage/sage-6.2.beta5/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lcsage -lec -lntl -lpari -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.so
```


And FWIW, in the build on bsd.math, `libtool` also drops the `-rpath` given to it when linking `libec.dylib` (or, more precisely, `libec.0.dylib`).



---

archive/issue_comments_204296.json:
```json
{
    "body": "For completeness, this is how `libec.0.dylib` gets linked on bsd.math (looks the same as on Karl-Dieter's MacOS X 10.4 PPC box):\n\n```\n/bin/sh ../libtool --tag=CXX   --mode=link g++  -g -O3  -no-undefined -L/Users/leif/Sage/sage-6.2.beta5/local/lib -L/Users/leif/Sage/sage-6.2.beta5/local/lib -L/Users/leif/Sage/sage-6.2.beta5/local/lib   -o libec.la -rpath /Users/leif/Sage/sage-6.2.beta5/local/lib interface.lo unimod.lo arith.lo marith.lo gpslave.lo compproc.lo vector.lo matrix.lo subspace.lo kbessel.lo mvector.lo mmatrix.lo msubspace.lo svector.lo smatrix.lo smatrix_elim.lo xsplit.lo conic.lo legendre.lo quadratic.lo illl.lo hilbert.lo timer.lo cubic.lo polys.lo realroots.lo parifact.lo p2points.lo gf.lo xsplit_data.lo threadpool.lo logger.lo curve.lo curvedata.lo curvered.lo points.lo cperiods.lo isogs.lo heights.lo mwprocs.lo lambda.lo sifter.lo sieve_search.lo htconst.lo egr.lo saturate.lo divpol.lo pointsmod.lo curvemod.lo ffmod.lo tlss.lo elog.lo getcurve.lo mequiv.lo mrank1.lo mlocsol.lo mglobsol.lo mquartic.lo mrank2.lo qc.lo sqfdiv.lo version.lo minim.lo reduce.lo transform.lo desc2.lo bitspace.lo GetOpt.lo twoadic.lo descent.lo newforms.lo symb.lo homspace.lo cusp.lo oldforms.lo fixc6.lo periods.lo moddata.lo pcprocs.lo nfd.lo curvesort.lo  -lflint -lntl -lpari\nlibtool: link: g++ -dynamiclib  -o .libs/libec.0.dylib  .libs/interface.o .libs/unimod.o .libs/arith.o .libs/marith.o .libs/gpslave.o .libs/compproc.o .libs/vector.o .libs/matrix.o .libs/subspace.o .libs/kbessel.o .libs/mvector.o .libs/mmatrix.o .libs/msubspace.o .libs/svector.o .libs/smatrix.o .libs/smatrix_elim.o .libs/xsplit.o .libs/conic.o .libs/legendre.o .libs/quadratic.o .libs/illl.o .libs/hilbert.o .libs/timer.o .libs/cubic.o .libs/polys.o .libs/realroots.o .libs/parifact.o .libs/p2points.o .libs/gf.o .libs/xsplit_data.o .libs/threadpool.o .libs/logger.o .libs/curve.o .libs/curvedata.o .libs/curvered.o .libs/points.o .libs/cperiods.o .libs/isogs.o .libs/heights.o .libs/mwprocs.o .libs/lambda.o .libs/sifter.o .libs/sieve_search.o .libs/htconst.o .libs/egr.o .libs/saturate.o .libs/divpol.o .libs/pointsmod.o .libs/curvemod.o .libs/ffmod.o .libs/tlss.o .libs/elog.o .libs/getcurve.o .libs/mequiv.o .libs/mrank1.o .libs/mlocsol.o .libs/mglobsol.o .libs/mquartic.o .libs/mrank2.o .libs/qc.o .libs/sqfdiv.o .libs/version.o .libs/minim.o .libs/reduce.o .libs/transform.o .libs/desc2.o .libs/bitspace.o .libs/GetOpt.o .libs/twoadic.o .libs/descent.o .libs/newforms.o .libs/symb.o .libs/homspace.o .libs/cusp.o .libs/oldforms.o .libs/fixc6.o .libs/periods.o .libs/moddata.o .libs/pcprocs.o .libs/nfd.o .libs/curvesort.o   -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lflint /Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.dylib -L/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/gcc-4.7.3.p1/gcc-build/x86_64-apple-darwin10.8.0/libstdc++-v3/src -L/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/gcc-4.7.3.p1/gcc-build/x86_64-apple-darwin10.8.0/libstdc++-v3/src/.libs -lpari  -O3   -install_name  /Users/leif/Sage/sage-6.2.beta5/local/lib/libec.0.dylib -compatibility_version 1 -current_version 1.0 -Wl,-single_module\n```\n\n\nSo indeed the (missing or weird) `install_name`s seem to be the problem.  (Or `libtool`... ;-) )",
    "created_at": "2014-03-29T14:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204296",
    "user": "https://github.com/nexttime"
}
```

For completeness, this is how `libec.0.dylib` gets linked on bsd.math (looks the same as on Karl-Dieter's MacOS X 10.4 PPC box):

```
/bin/sh ../libtool --tag=CXX   --mode=link g++  -g -O3  -no-undefined -L/Users/leif/Sage/sage-6.2.beta5/local/lib -L/Users/leif/Sage/sage-6.2.beta5/local/lib -L/Users/leif/Sage/sage-6.2.beta5/local/lib   -o libec.la -rpath /Users/leif/Sage/sage-6.2.beta5/local/lib interface.lo unimod.lo arith.lo marith.lo gpslave.lo compproc.lo vector.lo matrix.lo subspace.lo kbessel.lo mvector.lo mmatrix.lo msubspace.lo svector.lo smatrix.lo smatrix_elim.lo xsplit.lo conic.lo legendre.lo quadratic.lo illl.lo hilbert.lo timer.lo cubic.lo polys.lo realroots.lo parifact.lo p2points.lo gf.lo xsplit_data.lo threadpool.lo logger.lo curve.lo curvedata.lo curvered.lo points.lo cperiods.lo isogs.lo heights.lo mwprocs.lo lambda.lo sifter.lo sieve_search.lo htconst.lo egr.lo saturate.lo divpol.lo pointsmod.lo curvemod.lo ffmod.lo tlss.lo elog.lo getcurve.lo mequiv.lo mrank1.lo mlocsol.lo mglobsol.lo mquartic.lo mrank2.lo qc.lo sqfdiv.lo version.lo minim.lo reduce.lo transform.lo desc2.lo bitspace.lo GetOpt.lo twoadic.lo descent.lo newforms.lo symb.lo homspace.lo cusp.lo oldforms.lo fixc6.lo periods.lo moddata.lo pcprocs.lo nfd.lo curvesort.lo  -lflint -lntl -lpari
libtool: link: g++ -dynamiclib  -o .libs/libec.0.dylib  .libs/interface.o .libs/unimod.o .libs/arith.o .libs/marith.o .libs/gpslave.o .libs/compproc.o .libs/vector.o .libs/matrix.o .libs/subspace.o .libs/kbessel.o .libs/mvector.o .libs/mmatrix.o .libs/msubspace.o .libs/svector.o .libs/smatrix.o .libs/smatrix_elim.o .libs/xsplit.o .libs/conic.o .libs/legendre.o .libs/quadratic.o .libs/illl.o .libs/hilbert.o .libs/timer.o .libs/cubic.o .libs/polys.o .libs/realroots.o .libs/parifact.o .libs/p2points.o .libs/gf.o .libs/xsplit_data.o .libs/threadpool.o .libs/logger.o .libs/curve.o .libs/curvedata.o .libs/curvered.o .libs/points.o .libs/cperiods.o .libs/isogs.o .libs/heights.o .libs/mwprocs.o .libs/lambda.o .libs/sifter.o .libs/sieve_search.o .libs/htconst.o .libs/egr.o .libs/saturate.o .libs/divpol.o .libs/pointsmod.o .libs/curvemod.o .libs/ffmod.o .libs/tlss.o .libs/elog.o .libs/getcurve.o .libs/mequiv.o .libs/mrank1.o .libs/mlocsol.o .libs/mglobsol.o .libs/mquartic.o .libs/mrank2.o .libs/qc.o .libs/sqfdiv.o .libs/version.o .libs/minim.o .libs/reduce.o .libs/transform.o .libs/desc2.o .libs/bitspace.o .libs/GetOpt.o .libs/twoadic.o .libs/descent.o .libs/newforms.o .libs/symb.o .libs/homspace.o .libs/cusp.o .libs/oldforms.o .libs/fixc6.o .libs/periods.o .libs/moddata.o .libs/pcprocs.o .libs/nfd.o .libs/curvesort.o   -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lflint /Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.dylib -L/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/gcc-4.7.3.p1/gcc-build/x86_64-apple-darwin10.8.0/libstdc++-v3/src -L/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/gcc-4.7.3.p1/gcc-build/x86_64-apple-darwin10.8.0/libstdc++-v3/src/.libs -lpari  -O3   -install_name  /Users/leif/Sage/sage-6.2.beta5/local/lib/libec.0.dylib -compatibility_version 1 -current_version 1.0 -Wl,-single_module
```


So indeed the (missing or weird) `install_name`s seem to be the problem.  (Or `libtool`... ;-) )



---

archive/issue_comments_204297.json:
```json
{
    "body": "Replying to [comment:8 leif]:\n> (Note the recorded path to the PARI library!)\n> \n> But we (also) already have `-lpari` on the command line for linking the mwrank Python extension module (which I think by the way shouldn't be necessary either, as it isn't *directly* used IIRC) [...]\n\nAnd if I remove `pari` from the allegedly needed libraries of the mwrank Python extension module (in `module_list.py`), this also works *on bsd.math*:\n\n```\nleif@bsd:~/Sage/sage-6.2.beta5$ touch src/sage/libs/mwrank/mwrank.pyx \nleif@bsd:~/Sage/sage-6.2.beta5$ ./sage -b\nscons: `install' is up to date.\nUpdating Cython code....\nCompiling sage/libs/mwrank/mwrank.pyx because it changed.\nCythonizing sage/libs/mwrank/mwrank.pyx\nFinished compiling Cython code (time = 4.62841916084 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.libs.mwrank.mwrank' extension\nExecuting 1 command (using 1 thread)\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include/python2.7 -c sage/libs/mwrank/mwrank.c -o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o -fno-strict-aliasing -w\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include/python2.7 -c sage/libs/mwrank/wrap.cc -o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -fno-strict-aliasing -w\ng++ -bundle -undefined dynamic_lookup -L/Users/leif/Sage/sage-6.2.beta5/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lcsage -lec -lntl -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.so\nTime to execute 1 command: 4.69843101501 seconds\nTotal time spent compiling C/C++ extensions:  4.88040590286 seconds.\n```\n\n\nI guess doing so would trigger another \"no such file or directory\" warning on *Karl-Dieter's* machine.  MacOS X 10.6's linker is simply \"smarter\"...",
    "created_at": "2014-03-29T15:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204297",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:8 leif]:
> (Note the recorded path to the PARI library!)
> 
> But we (also) already have `-lpari` on the command line for linking the mwrank Python extension module (which I think by the way shouldn't be necessary either, as it isn't *directly* used IIRC) [...]

And if I remove `pari` from the allegedly needed libraries of the mwrank Python extension module (in `module_list.py`), this also works *on bsd.math*:

```
leif@bsd:~/Sage/sage-6.2.beta5$ touch src/sage/libs/mwrank/mwrank.pyx 
leif@bsd:~/Sage/sage-6.2.beta5$ ./sage -b
scons: `install' is up to date.
Updating Cython code....
Compiling sage/libs/mwrank/mwrank.pyx because it changed.
Cythonizing sage/libs/mwrank/mwrank.pyx
Finished compiling Cython code (time = 4.62841916084 seconds)
running install
running build
running build_py
running build_ext
building 'sage.libs.mwrank.mwrank' extension
Executing 1 command (using 1 thread)
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include/python2.7 -c sage/libs/mwrank/mwrank.c -o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o -fno-strict-aliasing -w
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -DNTL_ALL -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include -I/Users/leif/Sage/sage-6.2.beta5/local/include/csage -I/Users/leif/Sage/sage-6.2.beta5/src -I/Users/leif/Sage/sage-6.2.beta5/src/sage/ext -I/Users/leif/Sage/sage-6.2.beta5/local/include/python2.7 -c sage/libs/mwrank/wrap.cc -o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -fno-strict-aliasing -w
g++ -bundle -undefined dynamic_lookup -L/Users/leif/Sage/sage-6.2.beta5/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.o build/temp.macosx-10.6-x86_64-2.7/sage/libs/mwrank/wrap.o -L/Users/leif/Sage/sage-6.2.beta5/local/lib -lcsage -lec -lntl -lgmp -lgmpxx -lstdc++ -lm -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/libs/mwrank/mwrank.so
Time to execute 1 command: 4.69843101501 seconds
Total time spent compiling C/C++ extensions:  4.88040590286 seconds.
```


I guess doing so would trigger another "no such file or directory" warning on *Karl-Dieter's* machine.  MacOS X 10.6's linker is simply "smarter"...



---

archive/issue_comments_204298.json:
```json
{
    "body": "So we may also want to look at pari because it put the build time location rather than final location in install name. Not a problem if you tell sage to keep the build stuff I guess.",
    "created_at": "2014-03-29T18:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204298",
    "user": "https://github.com/kiwifb"
}
```

So we may also want to look at pari because it put the build time location rather than final location in install name. Not a problem if you tell sage to keep the build stuff I guess.



---

archive/issue_comments_204299.json:
```json
{
    "body": "I actually have a patch for pari's installname that I made for pari 2.5.0 and it is still in the gentoo and sage-on-gentoo trees, I guess I should try to it merged in pari proper.\n[https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch)\nAs for Karl-Dieter's problem we should be able to see if fixing the installname solves his problem without rebuilding flint and eclib.\nwe can use \n\n```\ninstall_name_tool -change \"oldname\" \"newname\" filename\n```\n\nWe can alter libflint.dylib and libec.dylib with the appropriate values and see if sage compile.",
    "created_at": "2014-03-29T20:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204299",
    "user": "https://github.com/kiwifb"
}
```

I actually have a patch for pari's installname that I made for pari 2.5.0 and it is still in the gentoo and sage-on-gentoo trees, I guess I should try to it merged in pari proper.
[https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch)
As for Karl-Dieter's problem we should be able to see if fixing the installname solves his problem without rebuilding flint and eclib.
we can use 

```
install_name_tool -change "oldname" "newname" filename
```

We can alter libflint.dylib and libec.dylib with the appropriate values and see if sage compile.



---

archive/issue_comments_204300.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> I actually have a patch for pari's installname that I made for pari 2.5.0 and it is still in the gentoo and sage-on-gentoo trees, I guess I should try to it merged in pari proper.\n> [https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch)\n> As for Karl-Dieter's problem we should be able to see if fixing the installname solves his problem without rebuilding flint and eclib.\n> we can use \n> {{{\n> install_name_tool -change \"oldname\" \"newname\" filename\n> }}}\n> We can alter libflint.dylib and libec.dylib with the appropriate values and see if sage compile.\n\nYep, but he'd have to rebuild eclib (after changing libflint's [and perhaps libpari's] `install_name`) such that the proper dependency name(s) get(s) recorded in `libec.0.dylib`; I don't think you can change these with `install_name_tool`.\n\n\n\n\nAny idea why `libtool` ignores `-rpath` (on both MacOS X 10.4 and 10.6)?",
    "created_at": "2014-03-29T22:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204300",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:12 fbissey]:
> I actually have a patch for pari's installname that I made for pari 2.5.0 and it is still in the gentoo and sage-on-gentoo trees, I guess I should try to it merged in pari proper.
> [https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/pari/files/pari-2.5.0-macos.patch)
> As for Karl-Dieter's problem we should be able to see if fixing the installname solves his problem without rebuilding flint and eclib.
> we can use 
> {{{
> install_name_tool -change "oldname" "newname" filename
> }}}
> We can alter libflint.dylib and libec.dylib with the appropriate values and see if sage compile.

Yep, but he'd have to rebuild eclib (after changing libflint's [and perhaps libpari's] `install_name`) such that the proper dependency name(s) get(s) recorded in `libec.0.dylib`; I don't think you can change these with `install_name_tool`.




Any idea why `libtool` ignores `-rpath` (on both MacOS X 10.4 and 10.6)?



---

archive/issue_comments_204301.json:
```json
{
    "body": "First yes you can.\n\n```\nMirage:lib fbissey$ otool -L libec.0.dylib \nlibec.0.dylib:\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)\n\tlibflint.dylib (compatibility version 0.0.0, current version 0.0.0)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)\n\t/Users/fbissey/build/sage-6.2.beta4/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\nMirage:lib fbissey$ install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib \nMirage:lib fbissey$ otool -L libec.0.dylib \nlibec.0.dylib:\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib (compatibility version 0.0.0, current version 0.0.0)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)\n\t/Users/fbissey/build/sage-6.2.beta4/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)\n\t/Users/fbissey/build/sage-6.2.beta4/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\nMirage:lib fbissey$ \n```\n\nAbout libtool, not sure. I always felt rpath was redundant with the install_name mechanism but that's not really an answer to your question.",
    "created_at": "2014-03-29T23:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204301",
    "user": "https://github.com/kiwifb"
}
```

First yes you can.

```
Mirage:lib fbissey$ otool -L libec.0.dylib 
libec.0.dylib:
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)
	libflint.dylib (compatibility version 0.0.0, current version 0.0.0)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/Users/fbissey/build/sage-6.2.beta4/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
Mirage:lib fbissey$ install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib 
Mirage:lib fbissey$ otool -L libec.0.dylib 
libec.0.dylib:
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib (compatibility version 0.0.0, current version 0.0.0)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/Users/fbissey/build/sage-6.2.beta4/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)
	/Users/fbissey/build/sage-6.2.beta4/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
Mirage:lib fbissey$ 
```

About libtool, not sure. I always felt rpath was redundant with the install_name mechanism but that's not really an answer to your question.



---

archive/issue_comments_204302.json:
```json
{
    "body": "Replying to [comment:14 fbissey]:\n> First yes you can.\n\nCool.  \\o/\n\n\n\n\n> About libtool, not sure. I always felt rpath was redundant with the install_name mechanism but that's not really an answer to your question.\n\nWell, by default `install_name` is an *absolute* path.  You can prepend ``@`rpath/` (and other flavours) to the `install_name` to make it relative to paths set by `-rpath`, similar to `$ORIGIN` in an ELF object's `DT_RUNPATH`.  But I'm not a Darwin linker (nor Mach-O) expert; I'd expect `libtool` to know how to do it though.  On the other hand, `libtool` did convert *some* of the `-L/path/to/foo/ -lfoo` to absolute filenames on the linker command line (when linking `libec.0.dylib`), presumably exactly [to] those with a correct, absolute `install_name`.",
    "created_at": "2014-03-30T01:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204302",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:14 fbissey]:
> First yes you can.

Cool.  \o/




> About libtool, not sure. I always felt rpath was redundant with the install_name mechanism but that's not really an answer to your question.

Well, by default `install_name` is an *absolute* path.  You can prepend ``@`rpath/` (and other flavours) to the `install_name` to make it relative to paths set by `-rpath`, similar to `$ORIGIN` in an ELF object's `DT_RUNPATH`.  But I'm not a Darwin linker (nor Mach-O) expert; I'd expect `libtool` to know how to do it though.  On the other hand, `libtool` did convert *some* of the `-L/path/to/foo/ -lfoo` to absolute filenames on the linker command line (when linking `libec.0.dylib`), presumably exactly [to] those with a correct, absolute `install_name`.



---

archive/issue_comments_204303.json:
```json
{
    "body": "Yikes!  As long as I have a specific thing to try out on Monday I'll be happy - if you guys can agree on what I should try, I don't have infinite time with that machine ;-)",
    "created_at": "2014-03-30T02:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204303",
    "user": "https://github.com/kcrisman"
}
```

Yikes!  As long as I have a specific thing to try out on Monday I'll be happy - if you guys can agree on what I should try, I don't have infinite time with that machine ;-)



---

archive/issue_comments_204304.json:
```json
{
    "body": "Try the equivalent for your machine of:\n\n```\ninstall_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib \ninstall_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libflint.dylib \n```\n\nin $SAGE_LOCAL/lib. Don't forget to replace the path for SAGE_LOCAL with what's correct for you.\nOnce that's done you can try to build sage again and see if it will go past that point.\nIf it does we'll make the appropriate patch.",
    "created_at": "2014-03-30T03:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204304",
    "user": "https://github.com/kiwifb"
}
```

Try the equivalent for your machine of:

```
install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib 
install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libflint.dylib 
```

in $SAGE_LOCAL/lib. Don't forget to replace the path for SAGE_LOCAL with what's correct for you.
Once that's done you can try to build sage again and see if it will go past that point.
If it does we'll make the appropriate patch.



---

archive/issue_comments_204305.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> Yikes!  As long as I have a specific thing to try out on Monday I'll be happy - if you guys can agree on what I should try, I don't have infinite time with that machine ;-)\n\nThere are plenty of things you *could* try... :-)\n\nBut I think kiwifb and me agree on that you could first try to:\n\n* Restore `module_list.py` (at least remove `flint`, optionally also `pari`) from the \"needed\" libraries of the libs.mwrank Python extension module -- to test whether it works for *one of* the affected modules (you had to change about five IIRC)\n\n* Make sure libflint's `install_name` is still just `libflint.dylib` (otherwise `install_name_tool` will give an error):\n\n```sh\n$ cd $SAGE_ROOT\n$ otool -D local/lib/libflint.dylib\nlocal/lib/libflint.dylib:\nlibflint.dylib\n```\n\n* Change the `install_name` (here called \"id\") to the library's absolute path:\n\n```sh\n$ install_name_tool -id `pwd`/local/lib/libflint.dylib local/lib/libflint.dylib\n```\n\n* Then either rebuild/reinstall eclib (which should now record libflint's absolute path), or -- simpler -- just change the recorded name (for FLINT) in `libec.0.dylib` manually:\n\n```sh\n$ otool -L local/lib/libec.0.dylib  # just to check libflint's name there\nlocal/lib/libec.0.dylib:\n\t<path to>/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)\n\tlibflint.dylib (compatibility version 0.0.0, current version 0.0.0)\n        ...\n\n$ install_name_tool -change libflint.dylib `pwd`/local/lib/libflint.dylib local/lib/libec.0.dylib  # now really change the name\n\n$ otool -L local/lib/libec.0.dylib  # just to verify it changed\nlocal/lib/libec.0.dylib:\n\t<path to>/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)\n\t<path to>/sage-6.2.beta5/local/lib/libflint.dylib (compatibility version 0.0.0, current version 0.0.0)\n        ...\n\n```\n\n\n* Pretend file modification to trigger the rebuild of the module(s):\n\n```sh\n$ touch src/sage/libs/mwrank/mwrank.pyx  # and more if you like\n\n$ ./sage -b  # and now rebuild\n```\n\n\nThe linker should now be able to locate `libflint.dylib` referenced by `libec.dylib`.\n\n\n\n\nOptionally, repeat the steps analogously for `pari` (which in contrast is originally listed as a needed lib in `module_list.py`, so you'd have to really remove it rather than restoring the state of vanilla beta4 or beta5); just libpari's original `install_name` is a bit more complicated (with a non-existing temporary path):\n\n```sh\n $ otool -D local/lib/libpari-gmp.dylib \nlocal/lib/libpari-gmp.dylib:\n<path to>/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib\n```\n\n(`libpari.dylib` is a symbolic link to `libpari-gmp.dylib`.)\n\nWhen you change the name (again in `libec.0.dylib`), you have to specify the **full original (invalid) path**:\n\n```sh\n$ install_name_tool -change /Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib `pwd`/local/lib/libpari-gmp.dylib local/lib/libec.0.dylib\n```\n\n(Just as an example -- note that the invalid path will differ on a PowerPC, and of course your `$SAGE_ROOT`.)",
    "created_at": "2014-03-30T03:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204305",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:16 kcrisman]:
> Yikes!  As long as I have a specific thing to try out on Monday I'll be happy - if you guys can agree on what I should try, I don't have infinite time with that machine ;-)

There are plenty of things you *could* try... :-)

But I think kiwifb and me agree on that you could first try to:

* Restore `module_list.py` (at least remove `flint`, optionally also `pari`) from the "needed" libraries of the libs.mwrank Python extension module -- to test whether it works for *one of* the affected modules (you had to change about five IIRC)

* Make sure libflint's `install_name` is still just `libflint.dylib` (otherwise `install_name_tool` will give an error):

```sh
$ cd $SAGE_ROOT
$ otool -D local/lib/libflint.dylib
local/lib/libflint.dylib:
libflint.dylib
```

* Change the `install_name` (here called "id") to the library's absolute path:

```sh
$ install_name_tool -id `pwd`/local/lib/libflint.dylib local/lib/libflint.dylib
```

* Then either rebuild/reinstall eclib (which should now record libflint's absolute path), or -- simpler -- just change the recorded name (for FLINT) in `libec.0.dylib` manually:

```sh
$ otool -L local/lib/libec.0.dylib  # just to check libflint's name there
local/lib/libec.0.dylib:
	<path to>/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)
	libflint.dylib (compatibility version 0.0.0, current version 0.0.0)
        ...

$ install_name_tool -change libflint.dylib `pwd`/local/lib/libflint.dylib local/lib/libec.0.dylib  # now really change the name

$ otool -L local/lib/libec.0.dylib  # just to verify it changed
local/lib/libec.0.dylib:
	<path to>/sage-6.2.beta5/local/lib/libec.0.dylib (compatibility version 1.0.0, current version 1.0.0)
	<path to>/sage-6.2.beta5/local/lib/libflint.dylib (compatibility version 0.0.0, current version 0.0.0)
        ...

```


* Pretend file modification to trigger the rebuild of the module(s):

```sh
$ touch src/sage/libs/mwrank/mwrank.pyx  # and more if you like

$ ./sage -b  # and now rebuild
```


The linker should now be able to locate `libflint.dylib` referenced by `libec.dylib`.




Optionally, repeat the steps analogously for `pari` (which in contrast is originally listed as a needed lib in `module_list.py`, so you'd have to really remove it rather than restoring the state of vanilla beta4 or beta5); just libpari's original `install_name` is a bit more complicated (with a non-existing temporary path):

```sh
 $ otool -D local/lib/libpari-gmp.dylib 
local/lib/libpari-gmp.dylib:
<path to>/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib
```

(`libpari.dylib` is a symbolic link to `libpari-gmp.dylib`.)

When you change the name (again in `libec.0.dylib`), you have to specify the **full original (invalid) path**:

```sh
$ install_name_tool -change /Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib `pwd`/local/lib/libpari-gmp.dylib local/lib/libec.0.dylib
```

(Just as an example -- note that the invalid path will differ on a PowerPC, and of course your `$SAGE_ROOT`.)



---

archive/issue_comments_204306.json:
```json
{
    "body": "Just for the record:  I *started* writing *before* Fran\u00e7ois replied... 8)\n\nBut we (still) agree on what you could try.",
    "created_at": "2014-03-30T04:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204306",
    "user": "https://github.com/nexttime"
}
```

Just for the record:  I *started* writing *before* Franois replied... 8)

But we (still) agree on what you could try.



---

archive/issue_comments_204307.json:
```json
{
    "body": "Yes we do. Just using install_name_tool means that we can test that theory without rebuilding flint and eclib, which would take some time on that machine.",
    "created_at": "2014-03-30T04:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204307",
    "user": "https://github.com/kiwifb"
}
```

Yes we do. Just using install_name_tool means that we can test that theory without rebuilding flint and eclib, which would take some time on that machine.



---

archive/issue_comments_204308.json:
```json
{
    "body": "Replying to [comment:17 fbissey]:\n> Try the equivalent for your machine of:\n> {{{\n> install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib \n> install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libflint.dylib \n> }}}\n> in $SAGE_LOCAL/lib. Don't forget to replace the path for SAGE_LOCAL with what's correct for you.\n\nNote that the second line wouldn't work (it's a no-op).\n\nIf you want to change the `install_name` of the library *itself* (as opposed to the recorded install names of libraries *it uses*), you have to use the `-id` option of `install_name_tool`, which takes just the *new* name (plus the filename of the library to change of course).",
    "created_at": "2014-03-30T04:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204308",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:17 fbissey]:
> Try the equivalent for your machine of:
> {{{
> install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libec.0.dylib 
> install_name_tool -change libflint.dylib /Users/fbissey/build/sage-6.2.beta4/local/lib/libflint.dylib libflint.dylib 
> }}}
> in $SAGE_LOCAL/lib. Don't forget to replace the path for SAGE_LOCAL with what's correct for you.

Note that the second line wouldn't work (it's a no-op).

If you want to change the `install_name` of the library *itself* (as opposed to the recorded install names of libraries *it uses*), you have to use the `-id` option of `install_name_tool`, which takes just the *new* name (plus the filename of the library to change of course).



---

archive/issue_comments_204309.json:
```json
{
    "body": "Well spotted. I was a bit too eager there and I had completely forgotten about that important detail.",
    "created_at": "2014-03-30T05:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204309",
    "user": "https://github.com/kiwifb"
}
```

Well spotted. I was a bit too eager there and I had completely forgotten about that important detail.



---

archive/issue_comments_204310.json:
```json
{
    "body": "For the record, ``@`rpath` is OSX 10.5 and later only afaik. So absolute paths it is.",
    "created_at": "2014-03-30T11:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204310",
    "user": "https://github.com/vbraun"
}
```

For the record, ``@`rpath` is OSX 10.5 and later only afaik. So absolute paths it is.



---

archive/issue_comments_204311.json:
```json
{
    "body": "Ok, I'm trying this.  Thank you leif for the VERY explicit steps, which start to help me understand even what these files even are.\n\nThe `otool` output was fine, and I decided to have it rebuild eclib just to make sure that worked fine.  I already reverted `module_list.py` and `touch`ed the files so I'll let you know what happens when it's done.  I'm not messing with the `pari` issue, though :)",
    "created_at": "2014-03-31T15:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204311",
    "user": "https://github.com/kcrisman"
}
```

Ok, I'm trying this.  Thank you leif for the VERY explicit steps, which start to help me understand even what these files even are.

The `otool` output was fine, and I decided to have it rebuild eclib just to make sure that worked fine.  I already reverted `module_list.py` and `touch`ed the files so I'll let you know what happens when it's done.  I'm not messing with the `pari` issue, though :)



---

archive/issue_comments_204312.json:
```json
{
    "body": "Okay, this does indeed seem to do the trick.  I can't run doctests, though, because sympy isn't built yet.  Weird.",
    "created_at": "2014-03-31T17:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204312",
    "user": "https://github.com/kcrisman"
}
```

Okay, this does indeed seem to do the trick.  I can't run doctests, though, because sympy isn't built yet.  Weird.



---

archive/issue_comments_204313.json:
```json
{
    "body": "Ok, I had to install sympy AND mpmath for Sage to even start - which seems odd, they shouldn't be imported on startup?  Anyway, only sage/libs/cremona/newforms.pyx doesn't pass tests, but that is because the Cremona mini database apparently never got installed, unrelated, I assume.  (Or is that part of the eclib package?)",
    "created_at": "2014-03-31T17:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204313",
    "user": "https://github.com/kcrisman"
}
```

Ok, I had to install sympy AND mpmath for Sage to even start - which seems odd, they shouldn't be imported on startup?  Anyway, only sage/libs/cremona/newforms.pyx doesn't pass tests, but that is because the Cremona mini database apparently never got installed, unrelated, I assume.  (Or is that part of the eclib package?)



---

archive/issue_comments_204314.json:
```json
{
    "body": "I am fairly sure it is in database_cremona_ellcurve.",
    "created_at": "2014-03-31T17:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204314",
    "user": "https://github.com/kiwifb"
}
```

I am fairly sure it is in database_cremona_ellcurve.



---

archive/issue_comments_204315.json:
```json
{
    "body": "Actually, it ended up being installed via the `elliptic_curve` spkg, which only installed later... so that should be fine as well.\n\nNow I guess we just need a \"good\" way to implement your ideas, which it sounds like you all have.",
    "created_at": "2014-03-31T17:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204315",
    "user": "https://github.com/kcrisman"
}
```

Actually, it ended up being installed via the `elliptic_curve` spkg, which only installed later... so that should be fine as well.

Now I guess we just need a "good" way to implement your ideas, which it sounds like you all have.



---

archive/issue_comments_204316.json:
```json
{
    "body": "In the first instance what I suggested earlier would work but I want to put it in form that's more palatable to flint upstream so they can just merge it (and I'll get rid of my patch in sage-on-gentoo).\n\nI need to take another look at their configure script.",
    "created_at": "2014-03-31T20:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204316",
    "user": "https://github.com/kiwifb"
}
```

In the first instance what I suggested earlier would work but I want to put it in form that's more palatable to flint upstream so they can just merge it (and I'll get rid of my patch in sage-on-gentoo).

I need to take another look at their configure script.



---

archive/issue_comments_204317.json:
```json
{
    "body": "Changing keywords from \"\" to \"Darwin 8 linker error install_name libflint.dylib\".",
    "created_at": "2014-03-31T20:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204317",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "Darwin 8 linker error install_name libflint.dylib".



---

archive/issue_comments_204318.json:
```json
{
    "body": "Replying to [comment:28 kcrisman]:\n> Now I guess we just need a \"good\" way to implement your ideas, which it sounds like you all have.\n\nWhich I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Fran\u00e7ois presumably knows, as he mentioned he had patches for both.",
    "created_at": "2014-03-31T20:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204318",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:28 kcrisman]:
> Now I guess we just need a "good" way to implement your ideas, which it sounds like you all have.

Which I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Franois presumably knows, as he mentioned he had patches for both.



---

archive/issue_comments_204319.json:
```json
{
    "body": "P.S.:  Does anyone currently test on Cygwin?",
    "created_at": "2014-03-31T20:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204319",
    "user": "https://github.com/nexttime"
}
```

P.S.:  Does anyone currently test on Cygwin?



---

archive/issue_comments_204320.json:
```json
{
    "body": "Replying to [comment:31 leif]:\n> P.S.:  Does anyone currently test on Cygwin?\nI could do that.\n\nIIRC I built 6.2.beta4 without problems (except bzip2 unrelated issues) so maybe nothing is actully needed?\nWhen was eclib updated?",
    "created_at": "2014-03-31T20:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204320",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:31 leif]:
> P.S.:  Does anyone currently test on Cygwin?
I could do that.

IIRC I built 6.2.beta4 without problems (except bzip2 unrelated issues) so maybe nothing is actully needed?
When was eclib updated?



---

archive/issue_comments_204321.json:
```json
{
    "body": "Replying to [comment:30 leif]:\n> Replying to [comment:28 kcrisman]:\n> > Now I guess we just need a \"good\" way to implement your ideas, which it sounds like you all have.\n> \n> Which I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Fran\u00e7ois presumably knows, as he mentioned he had patches for both.\n\nFlint upstream doesn't set anything for install_name and it is straightforward to add it, I'll submit a pull request for that to them this morning hopefully. Not sure how to forward that kind of patch to pari upstream, but again they don't do anything particular and end with something that comes as default with their linking options. I posted a link to the patch in #comment:12 if we want to include it. No extra actions needed in spkg-install just apply the patch.",
    "created_at": "2014-03-31T20:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204321",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:30 leif]:
> Replying to [comment:28 kcrisman]:
> > Now I guess we just need a "good" way to implement your ideas, which it sounds like you all have.
> 
> Which I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Franois presumably knows, as he mentioned he had patches for both.

Flint upstream doesn't set anything for install_name and it is straightforward to add it, I'll submit a pull request for that to them this morning hopefully. Not sure how to forward that kind of patch to pari upstream, but again they don't do anything particular and end with something that comes as default with their linking options. I posted a link to the patch in #comment:12 if we want to include it. No extra actions needed in spkg-install just apply the patch.



---

archive/issue_comments_204322.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> Replying to [comment:30 leif]:\n> > Replying to [comment:28 kcrisman]:\n> > > Now I guess we just need a \"good\" way to implement your ideas, which it sounds like you all have.\n> > \n> > Which I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Fran\u00e7ois presumably knows, as he mentioned he had patches for both.\n> \n> Flint upstream doesn't set anything for install_name and it is straightforward to add it, I'll submit a pull request for that to them this morning hopefully. Not sure how to forward that kind of patch to pari upstream, but again they don't do anything particular and end with something that comes as default with their linking options. I posted a link to the patch in #comment:12 if we want to include it. No extra actions needed in spkg-install just apply the patch.\nThe PARI folk is currently releasing rc's for 2.7.\nIt might be a very good time to forward them such a patch.\nI think you should post it on the pari-dev ml.",
    "created_at": "2014-03-31T20:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204322",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:33 fbissey]:
> Replying to [comment:30 leif]:
> > Replying to [comment:28 kcrisman]:
> > > Now I guess we just need a "good" way to implement your ideas, which it sounds like you all have.
> > 
> > Which I think means fixing the FLINT (and optionally also the PARI) spkg (on Darwin at least).  I don't know whether it's upstream's or probably Sage's fault, but Franois presumably knows, as he mentioned he had patches for both.
> 
> Flint upstream doesn't set anything for install_name and it is straightforward to add it, I'll submit a pull request for that to them this morning hopefully. Not sure how to forward that kind of patch to pari upstream, but again they don't do anything particular and end with something that comes as default with their linking options. I posted a link to the patch in #comment:12 if we want to include it. No extra actions needed in spkg-install just apply the patch.
The PARI folk is currently releasing rc's for 2.7.
It might be a very good time to forward them such a patch.
I think you should post it on the pari-dev ml.



---

archive/issue_comments_204323.json:
```json
{
    "body": "Replying to [comment:32 jpflori]:\n> Replying to [comment:31 leif]:\n> > P.S.:  Does anyone currently test on Cygwin?\n> I could do that.\n> \n> IIRC I built 6.2.beta4 without problems (except bzip2 unrelated issues) so maybe nothing is actully needed?\n> When was eclib updated?\n\nIn Sage 6.2.beta0 IIRC.  (That's why I asked when K-D last *successfully* built Sage on that Darwin PPC box.)",
    "created_at": "2014-03-31T20:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204323",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:32 jpflori]:
> Replying to [comment:31 leif]:
> > P.S.:  Does anyone currently test on Cygwin?
> I could do that.
> 
> IIRC I built 6.2.beta4 without problems (except bzip2 unrelated issues) so maybe nothing is actully needed?
> When was eclib updated?

In Sage 6.2.beta0 IIRC.  (That's why I asked when K-D last *successfully* built Sage on that Darwin PPC box.)



---

archive/issue_comments_204324.json:
```json
{
    "body": "I need a little bit of time to check my fix work for flint (bulding beta5 on my maverick machine)",
    "created_at": "2014-03-31T21:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204324",
    "user": "https://github.com/kiwifb"
}
```

I need a little bit of time to check my fix work for flint (bulding beta5 on my maverick machine)



---

archive/issue_comments_204325.json:
```json
{
    "body": "Push request sent to upstream flint [https://github.com/wbhart/flint2/pull/58](https://github.com/wbhart/flint2/pull/58) we can use the patch directly in sage. Anyone set up to make a sage commit can just grab that patch.\nI also tested the pari patch I quoted, needed a small adjustment for git style. I will send it and another for doc building with -j4 and over to maintonly`@`pari.math.u-bordeaux.fr which seem to be the right forum for these.",
    "created_at": "2014-03-31T23:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204325",
    "user": "https://github.com/kiwifb"
}
```

Push request sent to upstream flint [https://github.com/wbhart/flint2/pull/58](https://github.com/wbhart/flint2/pull/58) we can use the patch directly in sage. Anyone set up to make a sage commit can just grab that patch.
I also tested the pari patch I quoted, needed a small adjustment for git style. I will send it and another for doc building with -j4 and over to maintonly`@`pari.math.u-bordeaux.fr which seem to be the right forum for these.



---

archive/issue_comments_204326.json:
```json
{
    "body": "Other libs without a proper install_name:\n* libLfunction.dylib (lcalc)\n* libcliquer.dylib\n* polybori's libraries are strange, possibly bad substitution\n* libzn_poly.dylib (zn_poly)\n* libcsage.dylib :) moving to autotools would solve that\n\nAnd my patch for flint has been merged upstream \\o/",
    "created_at": "2014-03-31T23:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204326",
    "user": "https://github.com/kiwifb"
}
```

Other libs without a proper install_name:
* libLfunction.dylib (lcalc)
* libcliquer.dylib
* polybori's libraries are strange, possibly bad substitution
* libzn_poly.dylib (zn_poly)
* libcsage.dylib :) moving to autotools would solve that

And my patch for flint has been merged upstream \o/



---

archive/issue_comments_204327.json:
```json
{
    "body": "Bill made a flint-2.4.3 release with this fix, we can just bump to that. see\n[https://github.com/wbhart/flint2/pull/58](https://github.com/wbhart/flint2/pull/58)",
    "created_at": "2014-03-31T23:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204327",
    "user": "https://github.com/kiwifb"
}
```

Bill made a flint-2.4.3 release with this fix, we can just bump to that. see
[https://github.com/wbhart/flint2/pull/58](https://github.com/wbhart/flint2/pull/58)



---

archive/issue_comments_204328.json:
```json
{
    "body": "Any of these solutions seems good to me - thanks so much for this quick and knowledgeable work!",
    "created_at": "2014-04-01T00:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204328",
    "user": "https://github.com/kcrisman"
}
```

Any of these solutions seems good to me - thanks so much for this quick and knowledgeable work!



---

archive/issue_comments_204329.json:
```json
{
    "body": "Going back to pari :) the install_name problem is all sage's spkg-install fault. Pari's own install target produce a correct dylib but sage does this little interesting bit:\n\n```\n    if [ \"$UNAME\" = \"Darwin\" ]; then\n        # The following is a hack to get the library installed correctly\n        # on Mac OS X:\n        echo \"Applying Mac OS X hack -- deleting and reinstalling libpari.a ...\"\n        rm -f Odarwin-ppc/*lib*\n        $MAKE install-lib-sta\n        if [ $? -ne 0 ]; then\n            echo >&2 \"Error reinstalling PARI's static libraries (OS X trick)\"\n            exit 1\n        fi\n\n        cd \"`config/objdir`\" && cp -f libpari* \"$SAGE_LOCAL/lib\"\n        if [ $? -ne 0 ]; then\n            echo >&2 \"Error copying PARI's libraries (OS X trick)\"\n            exit 1\n        fi\n        cd \"$CUR\"\n    fi\n```\n\nSo we use the copy from the build directory in SAGE_LOCAL/lib. But when when you do \"make install\" pari actually rebuilds libpari{,-gmp}.dylib in the install location (modulo DESTDIR if it is defined) with the correct install_name. But spkg-install throw all that away and uses a copy without any install_name set.\n\nUnless someone can explain to me what this hack is all about, I think its removal should have a bug of its own on trac.",
    "created_at": "2014-04-01T22:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204329",
    "user": "https://github.com/kiwifb"
}
```

Going back to pari :) the install_name problem is all sage's spkg-install fault. Pari's own install target produce a correct dylib but sage does this little interesting bit:

```
    if [ "$UNAME" = "Darwin" ]; then
        # The following is a hack to get the library installed correctly
        # on Mac OS X:
        echo "Applying Mac OS X hack -- deleting and reinstalling libpari.a ..."
        rm -f Odarwin-ppc/*lib*
        $MAKE install-lib-sta
        if [ $? -ne 0 ]; then
            echo >&2 "Error reinstalling PARI's static libraries (OS X trick)"
            exit 1
        fi

        cd "`config/objdir`" && cp -f libpari* "$SAGE_LOCAL/lib"
        if [ $? -ne 0 ]; then
            echo >&2 "Error copying PARI's libraries (OS X trick)"
            exit 1
        fi
        cd "$CUR"
    fi
```

So we use the copy from the build directory in SAGE_LOCAL/lib. But when when you do "make install" pari actually rebuilds libpari{,-gmp}.dylib in the install location (modulo DESTDIR if it is defined) with the correct install_name. But spkg-install throw all that away and uses a copy without any install_name set.

Unless someone can explain to me what this hack is all about, I think its removal should have a bug of its own on trac.



---

archive/issue_comments_204330.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> Going back to pari :) the install_name problem is all sage's spkg-install fault.\n\nDoesn't really surprise me... B)\n\n\n\n\n> Unless someone can explain to me what this hack is all about, I think its removal should have a bug of its own on trac.\n\nYou may have to ask the BDFL; that \"hack\" is historically pre-Mercurial, apparently.",
    "created_at": "2014-04-01T22:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204330",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:42 fbissey]:
> Going back to pari :) the install_name problem is all sage's spkg-install fault.

Doesn't really surprise me... B)




> Unless someone can explain to me what this hack is all about, I think its removal should have a bug of its own on trac.

You may have to ask the BDFL; that "hack" is historically pre-Mercurial, apparently.



---

archive/issue_comments_204331.json:
```json
{
    "body": "I'll try to figure the new workflow and submit an update for flint.",
    "created_at": "2014-04-01T23:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204331",
    "user": "https://github.com/kiwifb"
}
```

I'll try to figure the new workflow and submit an update for flint.



---

archive/issue_comments_204332.json:
```json
{
    "body": "Replying to [comment:39 fbissey]:\n> Other libs without a proper install_name:\n>  * libLfunction.dylib (lcalc)\n>  * libcliquer.dylib\n>  * polybori's libraries are strange, possibly bad substitution\n>  * libzn_poly.dylib (zn_poly)\n>  * libcsage.dylib :) moving to autotools would solve that\n> \n\nAnd apparently the R dylibs as well - see #16044, and of course fbissey and leif discovered these too :)",
    "created_at": "2014-04-02T02:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204332",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:39 fbissey]:
> Other libs without a proper install_name:
>  * libLfunction.dylib (lcalc)
>  * libcliquer.dylib
>  * polybori's libraries are strange, possibly bad substitution
>  * libzn_poly.dylib (zn_poly)
>  * libcsage.dylib :) moving to autotools would solve that
> 

And apparently the R dylibs as well - see #16044, and of course fbissey and leif discovered these too :)



---

archive/issue_comments_204333.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-02T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204334.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-02T10:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204334",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204335.json:
```json
{
    "body": "From my point of view this is fine - [upstream](https://github.com/wbhart/flint2/commits/trunk) does seem to have a couple other changes since the previous release so it seems good to test this on a few other machines just in case there is some problem.   But presumably those problems would also be problems elsewhere.",
    "created_at": "2014-04-02T14:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204335",
    "user": "https://github.com/kcrisman"
}
```

From my point of view this is fine - [upstream](https://github.com/wbhart/flint2/commits/trunk) does seem to have a couple other changes since the previous release so it seems good to test this on a few other machines just in case there is some problem.   But presumably those problems would also be problems elsewhere.



---

archive/issue_comments_204336.json:
```json
{
    "body": "Right. I haven't run doctests against it yet so I will. I am putting this back to \"need work\" because I forgot to generate the checksum :(",
    "created_at": "2014-04-02T17:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204336",
    "user": "https://github.com/kiwifb"
}
```

Right. I haven't run doctests against it yet so I will. I am putting this back to "need work" because I forgot to generate the checksum :(



---

archive/issue_comments_204337.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-04-02T17:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204337",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_204338.json:
```json
{
    "body": "So... will this fix be non-movable?  (I.e., on any platform, on this one...) See [leif's comment](http://trac.sagemath.org/ticket/16044#comment:1) on #16044.",
    "created_at": "2014-04-02T18:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204338",
    "user": "https://github.com/kcrisman"
}
```

So... will this fix be non-movable?  (I.e., on any platform, on this one...) See [leif's comment](http://trac.sagemath.org/ticket/16044#comment:1) on #16044.



---

archive/issue_comments_204339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-03T10:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204340.json:
```json
{
    "body": "Replying to [comment:51 kcrisman]:\n> So... will this fix be non-movable?  (I.e., on any platform, on this one...) See [leif's comment](http://trac.sagemath.org/ticket/16044#comment:1) on #16044.\nBasically yes, unless we find variables that overrides the install_names effectively. Note that once your install is moved, if we find variables overrides to make it work, you'll probably be screwed if you try to upgrade in the new location. \n\nOn linux LD_LIBRARY_PATH is a very effective override to anything you put in an elf, so regardless of Volker's comment about dangling rpath they are screened by LD_LIBRARY_PATH. Even on linux upgrading in the new location is probably leaving a mess behind, but LD_LIBRARY_PATH is a good safety blanket most of the time.\n\nPutting this for review now that I have put the checksums.",
    "created_at": "2014-04-03T10:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204340",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:51 kcrisman]:
> So... will this fix be non-movable?  (I.e., on any platform, on this one...) See [leif's comment](http://trac.sagemath.org/ticket/16044#comment:1) on #16044.
Basically yes, unless we find variables that overrides the install_names effectively. Note that once your install is moved, if we find variables overrides to make it work, you'll probably be screwed if you try to upgrade in the new location. 

On linux LD_LIBRARY_PATH is a very effective override to anything you put in an elf, so regardless of Volker's comment about dangling rpath they are screened by LD_LIBRARY_PATH. Even on linux upgrading in the new location is probably leaving a mess behind, but LD_LIBRARY_PATH is a good safety blanket most of the time.

Putting this for review now that I have put the checksums.



---

archive/issue_comments_204341.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-03T10:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204341",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_204342.json:
```json
{
    "body": "Hmm, I don't know if I like that.  I'd at least want to see what happened here.  How will relocation issues be a problem with people downloading binaries?  (I assume this change in flint would cause problems for all Mac platforms, not just ours, since the extra flag and hence full name comes in on all Darwin, not just this Darwin 8, based on the patch.)",
    "created_at": "2014-04-03T14:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204342",
    "user": "https://github.com/kcrisman"
}
```

Hmm, I don't know if I like that.  I'd at least want to see what happened here.  How will relocation issues be a problem with people downloading binaries?  (I assume this change in flint would cause problems for all Mac platforms, not just ours, since the extra flag and hence full name comes in on all Darwin, not just this Darwin 8, based on the patch.)



---

archive/issue_comments_204343.json:
```json
{
    "body": "Replying to [comment:54 kcrisman]:\n> How will relocation issues be a problem with people downloading binaries?\n> (I assume this change in flint would cause problems for all Mac platforms, not just ours, since the extra flag and hence full name comes in on all Darwin, not just this Darwin 8, based on the patch.)\n\nFor FLINT and w.r.t. relocating Sage, the patch would only (effectively) make a difference on MacOS X 10.4.\n\nIf relocation is (at least partially) broken on Darwin anyway, the change doesn't make a difference to the others, i.e., it doesn't really worsen the situation.\n\nOn Darwin, we have absolute paths in (most of) all other libraries already; fixing that is subject of another ticket I'd say.\n\n\n\n\nDisclaimer:  I don't know at all what the Mac **app** currently does; but if it behaves differently, I'd rather expect it to be *smarter* w.r.t. \"relocation\".",
    "created_at": "2014-04-03T15:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204343",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:54 kcrisman]:
> How will relocation issues be a problem with people downloading binaries?
> (I assume this change in flint would cause problems for all Mac platforms, not just ours, since the extra flag and hence full name comes in on all Darwin, not just this Darwin 8, based on the patch.)

For FLINT and w.r.t. relocating Sage, the patch would only (effectively) make a difference on MacOS X 10.4.

If relocation is (at least partially) broken on Darwin anyway, the change doesn't make a difference to the others, i.e., it doesn't really worsen the situation.

On Darwin, we have absolute paths in (most of) all other libraries already; fixing that is subject of another ticket I'd say.




Disclaimer:  I don't know at all what the Mac **app** currently does; but if it behaves differently, I'd rather expect it to be *smarter* w.r.t. "relocation".



---

archive/issue_comments_204344.json:
```json
{
    "body": "According to http://wiki.sagemath.org/SupportedPlatforms the Mac App doesn't work at all on OSX 10.4",
    "created_at": "2014-04-03T15:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204344",
    "user": "https://github.com/vbraun"
}
```

According to http://wiki.sagemath.org/SupportedPlatforms the Mac App doesn't work at all on OSX 10.4



---

archive/issue_comments_204345.json:
```json
{
    "body": "Replying to [comment:55 leif]:\n> If relocation is (at least partially) broken on Darwin anyway, the change doesn't make a difference to the others, i.e., it doesn't really worsen the situation.\n> \n> On Darwin, we have absolute paths in (most of) all other libraries already; fixing that is subject of another ticket I'd say.\n\nWays to go (not excluding each other):\n\n* Putting Sage's library folders into `DYLD_FALLBACK_LIBRARY_PATH`; rather a work-around (not to say hack).\n\n* Rewriting all dylibs in `sage-location` (*adjusting* all absolute paths / `install_name`s).  (Raises the question whether `install_name_tool` is available \"by default\", i.e., at least shipped with something (e.g. XCode?) Sage requires anyway, for ordinary as opposed to development use.  And the lengths of the new filenames might be an issue.)\n\n* Using relative paths in `install_name`s (presumably ``@`loader_path/...`).  This could be done (just) in `sage-location` or some other post-inst hook as well, in the long run (also) changing build scripts (or just settings) and presumably patching a couple of upstream packages.\n\n----\n\n*Ads by G!**gle*\n\nBuy the [compiler wrapper](https://bitbucket.org/vbraun/compilerwrapper) NOW!!!",
    "created_at": "2014-04-03T15:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204345",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:55 leif]:
> If relocation is (at least partially) broken on Darwin anyway, the change doesn't make a difference to the others, i.e., it doesn't really worsen the situation.
> 
> On Darwin, we have absolute paths in (most of) all other libraries already; fixing that is subject of another ticket I'd say.

Ways to go (not excluding each other):

* Putting Sage's library folders into `DYLD_FALLBACK_LIBRARY_PATH`; rather a work-around (not to say hack).

* Rewriting all dylibs in `sage-location` (*adjusting* all absolute paths / `install_name`s).  (Raises the question whether `install_name_tool` is available "by default", i.e., at least shipped with something (e.g. XCode?) Sage requires anyway, for ordinary as opposed to development use.  And the lengths of the new filenames might be an issue.)

* Using relative paths in `install_name`s (presumably ``@`loader_path/...`).  This could be done (just) in `sage-location` or some other post-inst hook as well, in the long run (also) changing build scripts (or just settings) and presumably patching a couple of upstream packages.

----

*Ads by G!**gle*

Buy the [compiler wrapper](https://bitbucket.org/vbraun/compilerwrapper) NOW!!!



---

archive/issue_comments_204346.json:
```json
{
    "body": "> According to http://wiki.sagemath.org/SupportedPlatforms the Mac App doesn't work at all on OSX 10.4\nHuh, that surprises me.  There is one built, anyway, and distributed via the mirrors for 5.13.  I can check that later - it should still work okay.",
    "created_at": "2014-04-03T18:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204346",
    "user": "https://github.com/kcrisman"
}
```

> According to http://wiki.sagemath.org/SupportedPlatforms the Mac App doesn't work at all on OSX 10.4
Huh, that surprises me.  There is one built, anyway, and distributed via the mirrors for 5.13.  I can check that later - it should still work okay.



---

archive/issue_comments_204347.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-07T17:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204347",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_204348.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-07T19:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15780#issuecomment-204348",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015384.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-07T19:09:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15780",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15780#event-15384"
}
```
