# Issue 33228: sage.graphs: Use Executable.absolute_filename()

Issue created by migration from https://trac.sagemath.org/ticket/33465

Original creator: mkoeppe

Original creation time: 2022-03-05 19:33:51

CC:  dcoudert dimpase

This is so that Sage becomes fully functional even when not being run from within sage-env (which sets PATH).


---

Comment by mkoeppe created at 2022-03-05 19:45:09

Last 10 new commits:


---

Comment by git created at 2022-03-07 19:42:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-07 19:48:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-07 19:55:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-07 20:01:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-07 20:16:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-07 20:17:46

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-03-07 22:09:01

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-03-07 22:16:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-07 22:16:17

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2022-03-08 07:23:47

The patchbot reports pyflakes and deprecation number errors.


---

Comment by mkoeppe created at 2022-03-08 17:23:22

The deprecations are coming from the dependencies, specifically #31292.

The pyflakes warnings are not related to the ticket


---

Comment by dcoudert created at 2022-03-08 18:01:44

There is an error with with `benzene` due to a missing space in command string

```
sage -t --warn-long 292.4 --random-seed=170677623432521762806450982723252630968 src/sage/graphs/graph_generators.py
**********************************************************************
File "src/sage/graphs/graph_generators.py", line 1360, in sage.graphs.graph_generators.GraphGenerators.fusenes
Failed example:
    len(list(gen))  # optional benzene
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_generators.GraphGenerators.fusenes[6]>", line 1, in <module>
        len(list(gen))  # optional benzene
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/graph_generators.py", line 1396, in fusenes
        for G in graphs._read_planar_code(sp.stdout):
      File "/Users/dcoudert/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/graph_generators.py", line 1153, in _read_planar_code
        assert header == '>>planar_code<<', 'Not a valid planar code header'
    AssertionError: Not a valid planar code header
```


It can be fixed this way

```diff
diff --git a/src/sage/graphs/graph_generators.py b/src/sage/graphs/graph_generators.py
index e358d07ec6..f047a6ebbe 100644
--- a/src/sage/graphs/graph_generators.py
+++ b/src/sage/graphs/graph_generators.py
@@ -1384,7 +1384,7 @@ class GraphGenerators():
 
         import shlex
         command = shlex.quote(Benzene().absolute_filename())
-        command += ('b' if benzenoids else '') + ' {0} p'.format(hexagon_count)
+        command += (' b' if benzenoids else '') + ' {0} p'.format(hexagon_count)
 
         sp = subprocess.Popen(command, shell=True,
                               stdin=subprocess.PIPE, stdout=subprocess.PIPE,
```


I have tested the ticket with `benzene`, `buckygen`, `nauty` and `plantri` installed. Other modifications are Ok.


---

Comment by git created at 2022-03-08 18:22:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-08 18:22:30

Thanks for catching this!


---

Comment by dcoudert created at 2022-03-08 18:23:55

LGTM.


---

Comment by dcoudert created at 2022-03-08 18:23:55

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-08 18:31:15

Thank you!


---

Comment by vbraun created at 2022-03-12 15:11:01

Resolution: fixed
