# Issue 8844: add missing libraries to module_list for Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/8844

Original creator: mhansen

Original creation time: 2010-05-03 04:53:40

Assignee: tbd

CC:  leif robertwb

Cygwin is a lot pickier about missing symbols so more libraries need to be linked in to the extension modules.


---

Attachment


---

Comment by mhansen created at 2010-05-03 13:25:22

Changing status from new to needs_review.


---

Comment by mhansen created at 2010-05-19 22:12:55

Changing component from cygwin to build.


---

Comment by leif created at 2010-05-20 02:20:46

`s/'png'/'png12'/` (once).


---

Comment by leif created at 2010-05-20 02:20:46

Changing status from needs_review to needs_work.


---

Comment by leif created at 2010-05-20 02:28:17

(Or we should create symbolic links from `libpng.so*` to `libpng12.so*`.)


---

Comment by mhansen created at 2010-05-20 02:39:38

Symbolic links don't work for linking libraries in Cygwin.


---

Comment by leif created at 2010-05-20 07:29:24

Reviewer patch, s/png/png12/ once as mentioned


---

Attachment

Now *trying* to rebase #7987 on this one...


---

Comment by leif created at 2010-05-20 07:36:04

Changing status from needs_work to needs_review.


---

Comment by leif created at 2010-05-20 18:46:43

Changing keywords from "" to "missing library, unresolved symbol".


---

Comment by leif created at 2010-05-20 18:46:43

Works for OpenSuSE 11.2: http://groups.google.com/group/sage-devel/msg/1078faf7f0c6ec48

(And most probably will for Fedora 13, too, which is released in a few days.)


---

Comment by leif created at 2010-05-22 10:31:21

It seems the whole Sage library build process needs clean-ups...
(i.e. `local/bin/sage-build`, `devel/sage/module_list.py`, `devel/sage/setup.py`, and perhaps `devel/sage/c_lib/SConstruct`)

Btw, at least all Sage library C files (of course including those generated by `cython`) compile with gcc and `-std=c99 [-pedantic]`, though not really standard-conformant. (C++ files currently don't, neither with `-std=c++98` nor `c++0x`.)


---

Comment by mhansen created at 2010-05-25 22:58:53

Thanks for the review patch.  We'll hopefully get this merged this evening.


---

Comment by was created at 2010-05-26 01:03:22

Resolution: fixed


---

Comment by mhansen created at 2010-05-27 23:54:01

The reviewer patch actually breaks things on Cygwin.  It should be reverted.


---

Comment by leif created at 2010-05-28 03:25:21

Replying to [comment:13 mhansen]:
> The reviewer patch actually breaks things on Cygwin.  It should be reverted.

How can that be? At least on Linux, there's no `libpng.so`, just `libpng12.so`, so reverting it wouldn't build on other systems.


---

Comment by drkirkby created at 2010-06-03 15:11:26

Replying to [comment:9 leif]:
> Btw, at least all Sage library C files (of course including those generated by `cython`) compile with gcc and `-std=c99 [-pedantic]`, though not really standard-conformant. (C++ files currently don't, neither with `-std=c++98` nor `c++0x`.)
> 
>  

The problem with c_lib/SConstruct is that nobody to my knowledge knows SCons well. I know it needs something to add the -m64 flag to CFLAGS, CXXFLAGS and LDFLAGS on platforms other than OS X (darwin). Something like (untested)


```
if env['PLATFORM'] != "darwin" and os.environ['SAGE64']=="yes" 
        env.Append( CFLAGS="-O2 -g -m64" )
        env.Append( CXXFLAGS="-O2 -g -m64" )
        env.Append( LINKFLAGS="-m64" )
```


This seems a problem in general with Sage and SCons - nobody really knows what they are doing with it. 

Dave


---

Comment by drkirkby created at 2010-06-03 15:15:44

Replying to [comment:15 drkirkby]:
> Replying to [comment:9 leif]:
> > Btw, at least all Sage library C files (of course including those generated by `cython`) compile with gcc and `-std=c99 [-pedantic]`, though not really standard-conformant. (C++ files currently don't, neither with `-std=c++98` nor `c++0x`.)
> > 
> >  
> 
> The problem with c_lib/SConstruct is that nobody to my knowledge knows SCons well. I know it needs something to add the -m64 flag to CFLAGS, CXXFLAGS and LDFLAGS on platforms other than OS X (darwin). Something like (untested)
> 
> {{{
> if env['PLATFORM'] != "darwin" and os.environ['SAGE64']=="yes" 
>         env.Append( CFLAGS="-O2 -g -m64" )
>         env.Append( CXXFLAGS="-O2 -g -m64" )
>         env.Append( LINKFLAGS="-m64" )
> }}}
> 
> This seems a problem in general with Sage and SCons - nobody really knows what they are doing with it. 
> 
> Dave 


Oops, I posted my comment about SCons under the wrong comment. It was meant to be under that of leif, who wrote:

_It seems the whole Sage library build process needs clean-ups... (i.e. local/bin/sage-build, devel/sage/module_list.py, devel/sage/setup.py, and perhaps devel/sage/c_lib/SConstruct)_

Dave


---

Comment by jdemeyer created at 2015-11-20 11:09:08

Did anybody remember why `gmp` was added as dependency to the various `symbolic` modules? I don't believe those actually depend on `gmp`. This change is partially responsible for #19602.


---

Comment by jdemeyer created at 2015-11-20 11:23:20

The linked thread does mention some problems with `gmp`, but not in the `symbolic` modules.

PS for `@`was: the fact that I'm even _able_ to ask this question is because I can check the git history to see where this dependency was added. This is exactly what open development is about.


---

Comment by leif created at 2015-11-20 15:55:40

Replying to [comment:17 jdemeyer]:
> Did anybody remember why `gmp` was added as dependency to the various `symbolic` modules? I don't believe those actually depend on `gmp`.

I can only guess this was some kind of overkill, caused by confusing the `pynac` _extension module_ with the external Pynac library `libpynac`.  While the former indeed uses GMP and hence needs to get linked with it (_and_ in addition `libpynac`), the latter does not.
