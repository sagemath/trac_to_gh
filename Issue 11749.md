# Issue 11749: Allow Sympy conversion sign/sgn

Issue created by migration from https://trac.sagemath.org/ticket/11921

Original creator: kcrisman

Original creation time: 2011-10-14 12:37:30

Assignee: burcin

Keywords: sympy conversion beginner

From [this thread on sage-support](http://groups.google.com/group/sage-support/t/592e98fcece39df1):

```
Hi, 
Sage uses a dictionary to translate Sage function names to SymPy ones 
when they are different. 
Signal function is called "sgn" in Sage and "sign" in Sympy but the 
respective translation is not in the dictionary, and a error is issued 
if one tries to do something like: 
   x = var('x'); sgn(x)._sympy_() 
To fix it, it is just a matter of adding 
                "sgn": "sign", 
to the dictionary. 
Such dictionary is called "translation_table" and it is inside 
function "composition" from class "SympyConverter" of file "sage/ 
symbolic/expression_conversions.py". 
I would like to know how can I submit a patch, or ask someone to do 
it, and if it is necessary to include something in a unit test (like I 
did for Sympy for the inverse translation). 
? 
```



---

Comment by burcin created at 2011-10-18 17:51:54

The conversions should be specified with the `conversions` argument to the `BuiltinFunction` constructor. Having the conversion near the function definition is easier to maintain than that table.

In this case, the constructor for sage.functions.generalized.FunctionSignum should be changed to include `'sympy': 'sign'` in the `conversions` argument.


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted


---

Attachment

I performed the addition to the conversions argument as requested by burcin.


However, `x = var('x'); sgn(x)._sympy_()` still fails.


---

Comment by peter.story created at 2012-01-11 16:34:45

Changing status from new to needs_review.


---

Comment by peter.story created at 2012-01-11 16:34:54

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by burcin created at 2012-01-11 18:05:52

I was wrong. For some reason, `SympyConverter.composition()` method defined a translation table of its own. attachment:trac_11921-sympy_conversion.patch fixes it to go through the standard mechanism. Your patch should work now.

We still need doctests to switch this to needs_review.


---

Attachment


---

Comment by burcin created at 2012-02-08 12:05:16

I attached a new patch that adds a doctest as well. This is ready for review now.


---

Comment by burcin created at 2012-02-08 12:05:16

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-03-16 02:54:49

I like everything here, good simplification and clarification of all this.  

I'd like a different example, though!  

```
sage: from sage.symbolic.function import SymbolicFunction 
sage: f = SymbolicFunction('f', conversions=dict(sympy='ff'))
sage: f(x)
f(x)
sage: f(x)._sympy_()
<snip>
ValueError: Function FallingFactorial expects 2 argument(s), got 1.
```

Well!  That was a surprise.

So I'm adding a reviewer patch that just swaps `g` for `f` and then documents the less surprising error that sympy has no `gg` function.


---

Attachment


---

Comment by kcrisman created at 2012-03-16 02:58:28

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-03-16 02:58:28

For patchbot:

Apply:
 * attachment:trac_11921-sympy_conversion.patch
 * attachment:trac_11921_conversionsDictionary.patch
 * attachment:trac_11921-doctest.patch
 * attachment:trac_11921-reviewer.patch


---

Comment by jdemeyer created at 2012-03-23 15:19:55

Resolution: fixed
