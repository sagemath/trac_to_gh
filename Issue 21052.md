# Issue 21052: speed regression in Poset.canonical_label

archive/issues_021052.json:
```json
{
    "body": "CC:  @jm58660 @fchapoton @jdemeyer @mkoeppe @tscrim\n\nIn 6.9.beta5 I have:\n\n```\nsage: p = posets.IntegerPartitions(20)\nsage: timeit(\"p.canonical_label()\")\n5 loops, best of 3: 180 ms per loop\n```\n\nwhereas in 7.4.beta1\n\n```\nsage: timeit(\"p.canonical_label()\")\n5 loops, best of 3: 1.58 s per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21289\n\n",
    "created_at": "2016-08-19T08:58:47Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "speed regression in Poset.canonical_label",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21052",
    "user": "@mantepse"
}
```
CC:  @jm58660 @fchapoton @jdemeyer @mkoeppe @tscrim

In 6.9.beta5 I have:

```
sage: p = posets.IntegerPartitions(20)
sage: timeit("p.canonical_label()")
5 loops, best of 3: 180 ms per loop
```

whereas in 7.4.beta1

```
sage: timeit("p.canonical_label()")
5 loops, best of 3: 1.58 s per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/21289





---

archive/issue_comments_291637.json:
```json
{
    "body": "Can you check canonical label for plain graphs? Are you sure that you don't have Bliss installed in 6.9 but not in 7.4?",
    "created_at": "2016-08-19T09:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291637",
    "user": "@jm58660"
}
```

Can you check canonical label for plain graphs? Are you sure that you don't have Bliss installed in 6.9 but not in 7.4?



---

archive/issue_comments_291638.json:
```json
{
    "body": "(no, i haven't installed bliss in either version)\n\nThe problem is actually elsewhere:\n\n\n```\nsage: timeit('p._hasse_diagram.canonical_label(algorithm=\"sage\")')\n5 loops, best of 3: 93 ms per loop\n```\n\n\nIn 7.4, all the time is eaten by\n\n```\nsage: timeit(\"is_package_installed('bliss')\")\n5 loops, best of 3: 1.37 s per loop\n```\n\n\nI think that `Posets.canonical_label` should also accept the optional argument `algorithm`.",
    "created_at": "2016-08-19T09:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291638",
    "user": "@mantepse"
}
```

(no, i haven't installed bliss in either version)

The problem is actually elsewhere:


```
sage: timeit('p._hasse_diagram.canonical_label(algorithm="sage")')
5 loops, best of 3: 93 ms per loop
```


In 7.4, all the time is eaten by

```
sage: timeit("is_package_installed('bliss')")
5 loops, best of 3: 1.37 s per loop
```


I think that `Posets.canonical_label` should also accept the optional argument `algorithm`.



---

archive/issue_comments_291639.json:
```json
{
    "body": "Replying to [comment:2 mantepse]:\n> In 7.4, all the time is eaten by\n\n> {{{\n> sage: timeit(\"is_package_installed('bliss')\")\n> 5 loops, best of 3: 1.37 s per loop\n> }}}\n\nIs the problem `installed_packages()`? On my system it seems to be the problem.\n\n> I think that `Posets.canonical_label` should also accept the optional argument `algorithm`.\n\nTrue. I can add it, but let's first check what is wrong here.",
    "created_at": "2016-08-19T09:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291639",
    "user": "@jm58660"
}
```

Replying to [comment:2 mantepse]:
> In 7.4, all the time is eaten by

> {{{
> sage: timeit("is_package_installed('bliss')")
> 5 loops, best of 3: 1.37 s per loop
> }}}

Is the problem `installed_packages()`? On my system it seems to be the problem.

> I think that `Posets.canonical_label` should also accept the optional argument `algorithm`.

True. I can add it, but let's first check what is wrong here.



---

archive/issue_comments_291640.json:
```json
{
    "body": "I think I got it. It does\n\n\n```\nproc = subprocess.Popen([\"pip\", \"list\"], stdout=subprocess.PIPE)\nstdout = proc.communicate()[0]\nreturn dict((name.lower(), version) for name,version in PIP_VERSION.findall(stdout))\n```\n\n\nand this is clearly too much for every function call.",
    "created_at": "2016-08-19T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291640",
    "user": "@jm58660"
}
```

I think I got it. It does


```
proc = subprocess.Popen(["pip", "list"], stdout=subprocess.PIPE)
stdout = proc.communicate()[0]
return dict((name.lower(), version) for name,version in PIP_VERSION.findall(stdout))
```


and this is clearly too much for every function call.



---

archive/issue_comments_291641.json:
```json
{
    "body": "Jeroen is propably interested in this.",
    "created_at": "2016-08-19T09:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291641",
    "user": "@jm58660"
}
```

Jeroen is propably interested in this.



---

archive/issue_comments_291642.json:
```json
{
    "body": "As the problem is now in the ticket #21291 and the keyword is added at #21293 we can close this one.",
    "created_at": "2016-08-19T10:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291642",
    "user": "@jm58660"
}
```

As the problem is now in the ticket #21291 and the keyword is added at #21293 we can close this one.



---

archive/issue_comments_291643.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-19T10:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291643",
    "user": "@jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_291644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-19T10:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291644",
    "user": "@mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291645.json:
```json
{
    "body": "Replying to [comment:2 mantepse]:\n> {{{\n> is_package_installed('bliss')\n> }}}\n\nDon't do that. Use the [Easier to ask for forgiveness than permission](https://docs.python.org/3/glossary.html#term-eafp) principle: assume that Bliss is installed and fail gracefully if not.",
    "created_at": "2016-08-19T11:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291645",
    "user": "@jdemeyer"
}
```

Replying to [comment:2 mantepse]:
> {{{
> is_package_installed('bliss')
> }}}

Don't do that. Use the [Easier to ask for forgiveness than permission](https://docs.python.org/3/glossary.html#term-eafp) principle: assume that Bliss is installed and fail gracefully if not.



---

archive/issue_comments_291646.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-19T11:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291646",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_291647.json:
```json
{
    "body": "So all of these (except the ones in ```package```) are wrong:\n\n```\n-*- mode: grep; default-directory: \"~/sage-develop/src/sage/\" -*-\nGrep started at Fri Aug 19 13:31:58\n\ngrep -r -nH -e \"is_package_installed(\" *\ndatabases/cremona.py:827:            elif is_package_installed('database_cremona_ellcurve'):\ndatabases/cremona.py:1676:        if is_package_installed('database_cremona_ellcurve'):\ngame_theory/normal_form_game.py:1320:            if is_package_installed('lrslib'):\ngame_theory/normal_form_game.py:1326:            if not is_package_installed('lrslib'):\ngeometry/polyhedron/base.py:3694:        if not is_package_installed('lrslib'):\ngraphs/generic_graph.py:7877:            elif is_package_installed(\"python_igraph\"):\ngraphs/generic_graph.py:20258:             is_package_installed('bliss'))):\ngraphs/generic_graph.py:20927:             is_package_installed('bliss') and\ngraphs/graph_generators.py:1199:        if not is_package_installed(\"buckygen\"):\ngraphs/graph_generators.py:1284:        if not is_package_installed(\"benzene\"):\ngraphs/graph_generators.py:1437:        if not is_package_installed(\"plantri\"):\ngraphs/graph_generators.py:1636:        if not is_package_installed(\"plantri\"):\ngraphs/graph_generators.py:1790:        if not is_package_installed(\"plantri\"):\ngraphs/lovasz_theta.py:70:    if not is_package_installed('csdp'):\ngraphs/generators/classical_geometries.py:1292:    if not is_package_installed('gap_packages'):\ngroups/perm_gps/permgroup.py:193:        if not is_package_installed('gap_packages'):\ngroups/perm_gps/permgroup.py:1686:            if not is_package_installed('database_gap'):\ngroups/perm_gps/permgroup.py:1739:            if not is_package_installed('database_gap'):\ngroups/perm_gps/permgroup.py:4117:        if not is_package_installed('gap_packages'):\ngroups/generic.py:1407:        if not is_package_installed('database_gap'):\nmisc/package.py:294:def is_package_installed(package):\nmisc/package.py:300:        sage: is_package_installed('pari')\nmisc/package.py:305:        sage: is_package_installed('matplotli')\n\u00dcbereinstimmungen in Bin\u00e4rdatei misc/package.pyc.\nrings/polynomial/multi_polynomial_sequence.py:1432:                if not is_package_installed('fes'):\n\nGrep finished (matches found) at Fri Aug 19 13:31:58\n```\n",
    "created_at": "2016-08-19T11:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291647",
    "user": "@mantepse"
}
```

So all of these (except the ones in ```package```) are wrong:

```
-*- mode: grep; default-directory: "~/sage-develop/src/sage/" -*-
Grep started at Fri Aug 19 13:31:58

grep -r -nH -e "is_package_installed(" *
databases/cremona.py:827:            elif is_package_installed('database_cremona_ellcurve'):
databases/cremona.py:1676:        if is_package_installed('database_cremona_ellcurve'):
game_theory/normal_form_game.py:1320:            if is_package_installed('lrslib'):
game_theory/normal_form_game.py:1326:            if not is_package_installed('lrslib'):
geometry/polyhedron/base.py:3694:        if not is_package_installed('lrslib'):
graphs/generic_graph.py:7877:            elif is_package_installed("python_igraph"):
graphs/generic_graph.py:20258:             is_package_installed('bliss'))):
graphs/generic_graph.py:20927:             is_package_installed('bliss') and
graphs/graph_generators.py:1199:        if not is_package_installed("buckygen"):
graphs/graph_generators.py:1284:        if not is_package_installed("benzene"):
graphs/graph_generators.py:1437:        if not is_package_installed("plantri"):
graphs/graph_generators.py:1636:        if not is_package_installed("plantri"):
graphs/graph_generators.py:1790:        if not is_package_installed("plantri"):
graphs/lovasz_theta.py:70:    if not is_package_installed('csdp'):
graphs/generators/classical_geometries.py:1292:    if not is_package_installed('gap_packages'):
groups/perm_gps/permgroup.py:193:        if not is_package_installed('gap_packages'):
groups/perm_gps/permgroup.py:1686:            if not is_package_installed('database_gap'):
groups/perm_gps/permgroup.py:1739:            if not is_package_installed('database_gap'):
groups/perm_gps/permgroup.py:4117:        if not is_package_installed('gap_packages'):
groups/generic.py:1407:        if not is_package_installed('database_gap'):
misc/package.py:294:def is_package_installed(package):
misc/package.py:300:        sage: is_package_installed('pari')
misc/package.py:305:        sage: is_package_installed('matplotli')
Übereinstimmungen in Binärdatei misc/package.pyc.
rings/polynomial/multi_polynomial_sequence.py:1432:                if not is_package_installed('fes'):

Grep finished (matches found) at Fri Aug 19 13:31:58
```




---

archive/issue_comments_291648.json:
```json
{
    "body": "Why can't Sage just check installed packages on startup and make a list to some global variable?",
    "created_at": "2016-08-19T11:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291648",
    "user": "@jm58660"
}
```

Why can't Sage just check installed packages on startup and make a list to some global variable?



---

archive/issue_comments_291649.json:
```json
{
    "body": "Replying to [comment:11 jmantysalo]:\n> Why can't Sage just check installed packages on startup and make a list to some global variable?\n\nBecause that would be very slow, see #21291.",
    "created_at": "2016-08-19T11:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291649",
    "user": "@jdemeyer"
}
```

Replying to [comment:11 jmantysalo]:
> Why can't Sage just check installed packages on startup and make a list to some global variable?

Because that would be very slow, see #21291.



---

archive/issue_comments_291650.json:
```json
{
    "body": "Some are possibly OK, for example in `cremona.py`, because they only determine the error message.\n\nHowever, that's not quite true either: if I'm going to catch an error, I possibly rely on it being thrown quickly...",
    "created_at": "2016-08-19T11:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291650",
    "user": "@mantepse"
}
```

Some are possibly OK, for example in `cremona.py`, because they only determine the error message.

However, that's not quite true either: if I'm going to catch an error, I possibly rely on it being thrown quickly...



---

archive/issue_comments_291651.json:
```json
{
    "body": "Replying to [comment:10 mantepse]:\n> So all of these (except the ones in `package`) are wrong:\n\nAt least the ones which involve an `OptionalExtension` (like `bliss`) should be replaced by just importing the module.",
    "created_at": "2016-08-19T11:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291651",
    "user": "@jdemeyer"
}
```

Replying to [comment:10 mantepse]:
> So all of these (except the ones in `package`) are wrong:

At least the ones which involve an `OptionalExtension` (like `bliss`) should be replaced by just importing the module.



---

archive/issue_comments_291652.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 jmantysalo]:\n> > Why can't Sage just check installed packages on startup and make a list to some global variable?\n> \n> Because that would be very slow, see #21291.\n\nToo slow to do it once at startup?",
    "created_at": "2016-08-19T11:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291652",
    "user": "@jm58660"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 jmantysalo]:
> > Why can't Sage just check installed packages on startup and make a list to some global variable?
> 
> Because that would be very slow, see #21291.

Too slow to do it once at startup?



---

archive/issue_comments_291653.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 jmantysalo]:\n> > Why can't Sage just check installed packages on startup and make a list to some global variable?\n> \n> Because that would be very slow, see #21291.\n\nI do not understand this answer.  Compiling the list once does not take very long.  The problem occurs only because sage is doing it over and over again.",
    "created_at": "2016-08-19T11:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291653",
    "user": "@mantepse"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 jmantysalo]:
> > Why can't Sage just check installed packages on startup and make a list to some global variable?
> 
> Because that would be very slow, see #21291.

I do not understand this answer.  Compiling the list once does not take very long.  The problem occurs only because sage is doing it over and over again.



---

archive/issue_comments_291654.json:
```json
{
    "body": "I do think however that we want to be able to pick up new packages without having to leave sage, don't we?",
    "created_at": "2016-08-19T11:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291654",
    "user": "@mantepse"
}
```

I do think however that we want to be able to pick up new packages without having to leave sage, don't we?



---

archive/issue_comments_291655.json:
```json
{
    "body": "Replying to [comment:16 mantepse]:\n> Compiling the list once does not take very long.\n\nCompiling the list once takes an extremely long time (almost 2 seconds on my machine).",
    "created_at": "2016-08-19T12:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291655",
    "user": "@jdemeyer"
}
```

Replying to [comment:16 mantepse]:
> Compiling the list once does not take very long.

Compiling the list once takes an extremely long time (almost 2 seconds on my machine).



---

archive/issue_comments_291656.json:
```json
{
    "body": "Replying to [comment:17 mantepse]:\n> I do think however that we want to be able to pick up new packages without having to leave sage, don't we?\n\nI don't think that it is an important feature. Would be nice, yes, but a minor issue.",
    "created_at": "2016-08-19T12:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291656",
    "user": "@jm58660"
}
```

Replying to [comment:17 mantepse]:
> I do think however that we want to be able to pick up new packages without having to leave sage, don't we?

I don't think that it is an important feature. Would be nice, yes, but a minor issue.



---

archive/issue_comments_291657.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n\n> Compiling the list once takes an extremely long time (almost 2 seconds on my machine).\n\nOK. And there is no way to hook it to package installation?",
    "created_at": "2016-08-19T12:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291657",
    "user": "@jm58660"
}
```

Replying to [comment:18 jdemeyer]:

> Compiling the list once takes an extremely long time (almost 2 seconds on my machine).

OK. And there is no way to hook it to package installation?



---

archive/issue_comments_291658.json:
```json
{
    "body": "FYI Travis: doctesting `_kl_poly(x, y)` takes now about 5 seconds because of this.",
    "created_at": "2016-08-24T07:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291658",
    "user": "@jm58660"
}
```

FYI Travis: doctesting `_kl_poly(x, y)` takes now about 5 seconds because of this.



---

archive/issue_comments_291659.json:
```json
{
    "body": "This is maybe (probably?) the cause of several annoying timeout failures seen in the patchbots, in particular in tutte_polynomial.py",
    "created_at": "2016-08-26T11:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291659",
    "user": "@fchapoton"
}
```

This is maybe (probably?) the cause of several annoying timeout failures seen in the patchbots, in particular in tutte_polynomial.py



---

archive/issue_comments_291660.json:
```json
{
    "body": "Could we cache result of `is_package_installed()`? Or maybe result of `pip_installed_packages()` or something like that?",
    "created_at": "2016-08-26T11:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291660",
    "user": "@jm58660"
}
```

Could we cache result of `is_package_installed()`? Or maybe result of `pip_installed_packages()` or something like that?



---

archive/issue_comments_291661.json:
```json
{
    "body": "Replying to [comment:24 jmantysalo]:\n> Could we cache result of `is_package_installed()`? Or maybe result of `pip_installed_packages()` or something like that?\n\nAll that is irrelevant to this ticket, which is just specifically about `bliss`.",
    "created_at": "2016-08-26T12:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291661",
    "user": "@jdemeyer"
}
```

Replying to [comment:24 jmantysalo]:
> Could we cache result of `is_package_installed()`? Or maybe result of `pip_installed_packages()` or something like that?

All that is irrelevant to this ticket, which is just specifically about `bliss`.



---

archive/issue_comments_291662.json:
```json
{
    "body": "See #20382 and #21291 for more general discussions.",
    "created_at": "2016-08-26T12:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291662",
    "user": "@jdemeyer"
}
```

See #20382 and #21291 for more general discussions.



---

archive/issue_comments_291663.json:
```json
{
    "body": "Replying to [comment:24 jmantysalo]:\n> Could we cache result of `is_package_installed()`?\n\nAs I already said in [comment:18], that would not help.",
    "created_at": "2016-08-26T12:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291663",
    "user": "@jdemeyer"
}
```

Replying to [comment:24 jmantysalo]:
> Could we cache result of `is_package_installed()`?

As I already said in [comment:18], that would not help.



---

archive/issue_comments_291664.json:
```json
{
    "body": "Replying to [comment:27 jdemeyer]:\n> Replying to [comment:24 jmantysalo]:\n> > Could we cache result of `is_package_installed()`?\n> \n> As I already said in [comment:18], that would not help.\n\n?? If the result is cached, we got only one delay of two seconds. Currently running something like\n\n\n```\ng_list = [g.canonical_label() for g in g_list]\n```\n\n\nis extremely slow. Or maybe I miss something obvious.",
    "created_at": "2016-08-26T12:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291664",
    "user": "@jm58660"
}
```

Replying to [comment:27 jdemeyer]:
> Replying to [comment:24 jmantysalo]:
> > Could we cache result of `is_package_installed()`?
> 
> As I already said in [comment:18], that would not help.

?? If the result is cached, we got only one delay of two seconds. Currently running something like


```
g_list = [g.canonical_label() for g in g_list]
```


is extremely slow. Or maybe I miss something obvious.



---

archive/issue_comments_291665.json:
```json
{
    "body": "This ticket is super-easy to fix: just apply what I said in [comment:9] instead of coming up with overly-complicated solutions.",
    "created_at": "2016-08-26T12:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291665",
    "user": "@jdemeyer"
}
```

This ticket is super-easy to fix: just apply what I said in [comment:9] instead of coming up with overly-complicated solutions.



---

archive/issue_comments_291666.json:
```json
{
    "body": "Just do something like:\n\n```\ntry:\n    import sage.graphs.bliss\n    have_bliss = True\nexcept ImportError:\n    have_bliss = False\n```\n\nand use this `have_bliss` variable where needed.\n\nThat's it!",
    "created_at": "2016-08-26T12:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291666",
    "user": "@jdemeyer"
}
```

Just do something like:

```
try:
    import sage.graphs.bliss
    have_bliss = True
except ImportError:
    have_bliss = False
```

and use this `have_bliss` variable where needed.

That's it!



---

archive/issue_comments_291667.json:
```json
{
    "body": "done, please review\n----\nNew commits:",
    "created_at": "2016-08-26T13:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291667",
    "user": "@fchapoton"
}
```

done, please review
----
New commits:



---

archive/issue_comments_291668.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-26T13:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291668",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T13:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291669",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291670.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-26T15:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291670",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291671.json:
```json
{
    "body": "Could you replace\n\n```\nraise ImportError(\"You must install the 'bliss' package to run this command.\")\n```\n\nby\n\n```\nfrom sage.misc.package import PackageNotFoundError\nraise PackageNotFoundError(\"bliss\")\n```\n\nThis will give a customized error message.",
    "created_at": "2016-08-26T15:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291671",
    "user": "@jdemeyer"
}
```

Could you replace

```
raise ImportError("You must install the 'bliss' package to run this command.")
```

by

```
from sage.misc.package import PackageNotFoundError
raise PackageNotFoundError("bliss")
```

This will give a customized error message.



---

archive/issue_comments_291672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T16:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291672",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291673.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-26T16:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291673",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291674.json:
```json
{
    "body": "done",
    "created_at": "2016-08-26T16:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291674",
    "user": "@fchapoton"
}
```

done



---

archive/issue_comments_291675.json:
```json
{
    "body": "ping ?",
    "created_at": "2016-08-27T11:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291675",
    "user": "@fchapoton"
}
```

ping ?



---

archive/issue_comments_291676.json:
```json
{
    "body": "This looks good, but it just needs testing that it works both without and with bliss.",
    "created_at": "2016-08-27T12:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291676",
    "user": "@jdemeyer"
}
```

This looks good, but it just needs testing that it works both without and with bliss.



---

archive/issue_comments_291677.json:
```json
{
    "body": "Let's wait for the patchbot...",
    "created_at": "2016-08-27T12:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291677",
    "user": "@jdemeyer"
}
```

Let's wait for the patchbot...



---

archive/issue_comments_291678.json:
```json
{
    "body": "ok, bot is green. Jeroen ?",
    "created_at": "2016-08-28T08:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291678",
    "user": "@fchapoton"
}
```

ok, bot is green. Jeroen ?



---

archive/issue_comments_291679.json:
```json
{
    "body": "I'll test it now on my computer *with* bliss installed.",
    "created_at": "2016-08-28T08:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291679",
    "user": "@jdemeyer"
}
```

I'll test it now on my computer *with* bliss installed.



---

archive/issue_comments_291680.json:
```json
{
    "body": "Given that this code is very close to the stuff I do in sage-on-gentoo with that file - may be Jeroen has been inspired by something he saw a while back :P - I would put this positive. But since Jeroen wants to try it, I'll let him push the button.",
    "created_at": "2016-08-28T08:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291680",
    "user": "@kiwifb"
}
```

Given that this code is very close to the stuff I do in sage-on-gentoo with that file - may be Jeroen has been inspired by something he saw a while back :P - I would put this positive. But since Jeroen wants to try it, I'll let him push the button.



---

archive/issue_comments_291681.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-28T08:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291681",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291682.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-30T06:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21052#issuecomment-291682",
    "user": "@vbraun"
}
```

Resolution: fixed
