# Issue 20892: arakelov-zhang pairing of rational maps

Issue created by migration from Trac.

Original creator: paulfili

Original creation time: 2016-07-29 15:35:52

CC:  hkrieger @yuankmath bhutz @enderwannabe

We add a function to compute the dynamical Arakelov-Zhang pairing of two rational maps defined over number fields. 


---

Comment by paulfili created at 2016-07-29 15:46:53

Changing status from new to needs_review.


---

Comment by git created at 2016-07-29 16:10:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-29 18:45:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-12-15 20:12:48

please use python3-compatible syntax for print (see https://wiki.sagemath.org/Python3-compatible%20code)


---

Comment by chapoton created at 2017-01-05 16:27:15

plus one failing doctest, see patchbot report


---

Comment by chapoton created at 2017-07-17 08:03:22

I removed the bad prints and corrected the failing doctest.
----
New commits:


---

Comment by bhutz created at 2017-07-21 19:39:16

Changing component from algebraic geometry to dynamics.


---

Comment by chapoton created at 2017-10-03 18:35:48

Changing status from needs_review to needs_work.


---

Comment by @yuankmath created at 2019-11-20 17:50:10

Updated to sage 9.0 codebase 
----
New commits:


---

Comment by git created at 2019-11-20 18:10:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulfili created at 2019-11-20 18:18:50

Changing keywords from "" to "sd104".


---

Comment by paulfili created at 2019-11-20 18:18:50

There is currently a bug in prime_of_bad_reduction, reported now in #28779, which affects one of the examples here. (Apparently the bug wasn't present when the examples were first computed!). I'd rather not remove a good example, so we are marking this as dependent on that bug fix.


---

Comment by paulfili created at 2019-11-20 22:31:25

Changing status from needs_work to needs_review.


---

Comment by paulfili created at 2019-11-20 22:31:25

The bug in #28779 should be fixed. If you apply that patch, then this one, it should now be working.


---

Comment by bhutz created at 2019-11-25 17:49:58

notice that this is listed as 13000 lines of code change. It looks like git thinks you've deleted the entire file and re-written it. It would be better not to lose the code change history. Can you see if you can get it to just have your changes?


---

Comment by paulfili created at 2019-11-25 21:33:42

Replying to [comment:15 bhutz]:
> notice that this is listed as 13000 lines of code change. It looks like git thinks you've deleted the entire file and re-written it. It would be better not to lose the code change history. Can you see if you can get it to just have your changes?

Done! 
----
New commits:


---

Comment by bhutz created at 2019-11-25 23:10:57

Thanks!


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by @guojing0 created at 2022-09-04 09:51:29

New commits:


---

Comment by @guojing0 created at 2022-09-04 09:51:29

Changing keywords from "sd104" to "sd104, gsoc2022".


---

Comment by @guojing0 created at 2022-09-04 09:51:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-09-04 09:58:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-09-05 03:59:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-07 08:17:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-07 10:28:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-07 10:44:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-07 14:29:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-07 15:00:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-09-09 08:31:40

Changing status from needs_work to needs_review.


---

Comment by @EnderWannabe created at 2022-09-21 20:06:34

The following throws an error:

```
K.<k> = CyclotomicField(3)
P.<x,y> = ProjectiveSpace(K,1)
f = DynamicalSystem_projective([x^2 + (2*k+2)*y^2, y^2])
g = DynamicalSystem_projective([x^2, y^2])
pairingval = f.arakelov_zhang_pairing(g, n=5); pairingval
```


The last example in the documentation is failing on my end. Does it pass for you?

Finally, some minor issues in the code. There is extra whitespace on line 1302. Line 1281 is too long, it should be wrapped into two lines, as should any line longer than that.


---

Comment by @EnderWannabe created at 2022-09-21 20:06:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-09-22 06:06:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-09-22 06:25:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-09-22 06:33:10

Thank you, Alex. Good catch. That was caused by calling `abs` before `norm` for non-rational `f_disc`. Everything is fixed now.


---

Comment by @guojing0 created at 2022-09-22 06:33:10

Changing status from needs_work to needs_review.


---

Comment by @EnderWannabe created at 2022-09-22 20:05:10

Changing status from needs_review to needs_work.


---

Comment by @EnderWannabe created at 2022-09-22 20:05:10

Code itself looks good now. The test I was trying to run also doesn't fail now. Using Prop 4.3 in Birdy and Larson's paper on the pairing, I tested pairing two different dynamical systems, and the results were mathematically correct correct.

The only remaining problem is the example beginning on line 1224. According to Prop 18 of Petsche, Szpiro and Tucker, the value of the pairing should be exactly the global height of a. Thus, this is mathematically incorrect. Since it was passing before the code was modernized, it could have been something in the modernization. It is also possible that we just need to increase `n`, or change the noise modifier to get this example to work. Take a look and try and see what could be going wrong, and if you get stuck, this is worth emailing Paul about.


---

Comment by git created at 2022-09-23 05:34:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-24 03:25:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-24 03:59:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-27 07:42:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-27 08:03:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @guojing0 created at 2022-09-27 08:07:31

Changing status from needs_work to needs_review.


---

Comment by @EnderWannabe created at 2022-09-27 16:24:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-09-28 23:04:07

Resolution: fixed
