# Issue 13340: Omit .DS_Store when building 'all' documentation

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2012-09-28 03:07:49

Assignee: mvngu

CC:  yomcat

In OS X, viewing a directory like devel/sage/doc/en/ in the Finder can create a file `.DS_Store`, and then the docbuilder thinks that it is a piece of documentation to be built. We should ignore it.

The attached patch adds ".DS_Store" to the list of documents to ignore. We could instead (or in addition) only add documents if they are directories.


---

Attachment


---

Comment by jhpalmieri created at 2012-09-28 03:08:34

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-09-28 03:26:46

Another option would be the following; this could be used in addition to the patch here, or independently of it. Both should fix the problem.

```diff
diff --git a/doc/common/builder.py b/doc/common/builder.py
--- a/doc/common/builder.py
+++ b/doc/common/builder.py
`@``@` -257,11 +257,10 `@``@` class AllBuilder(object):
             sage: documents[0] == 'en/reference'
             True
         """
-        documents = []
-        for lang in LANGUAGES:
-            for document in os.listdir(os.path.join(SAGE_DOC, lang)):
-                if document not in OMIT:
-                    documents.append(os.path.join(lang, document))
+        documents = [os.path.join(lang, document) for lang in LANGUAGES
+                     for document in os.listdir(os.path.join(SAGE_DOC, lang))
+                     if document not in OMIT and
+                     os.path.isdir(os.path.join(SAGE_DOC, lang, document))]
 
         # Ensure that the reference guide is compiled first so that links from
         # the other document to it are correctly resolved.
```



---

Comment by yomcat created at 2012-09-28 03:43:54

Replying to [comment:2 jhpalmieri]:
> Another option would be the following; this could be used in addition to the patch here, or independently of it. Both should fix the problem.

This solution is nicer and would fix more than just .DS_Store issues (assuming that such things arise).


---

Comment by yomcat created at 2012-09-28 04:55:33

Changing status from needs_review to positive_review.


---

Comment by yomcat created at 2012-09-28 04:55:33

Works as advertised. Both fixes.


---

Comment by jdemeyer created at 2012-09-28 06:37:45

John, in this case, I find the for/for/if better readable than the long list comprehension.  It's a detail, but a 4-line list comprehension is a lot to parse.  I agree on the change itself.


---

Comment by jhpalmieri created at 2012-09-28 14:34:36

Okay, here's a new "dirs" patch. I suggest we only use that patch, not both.


---

Comment by jdemeyer created at 2012-09-28 14:47:46

If you fix the commit message, it's all good to go.


---

Comment by jhpalmieri created at 2012-09-28 15:29:43

Well, I personally thought that "[mq]: foo" was pretty descriptive.


---

Attachment


---

Comment by jhpalmieri created at 2012-09-28 15:31:23

(Oops: trac_13544_dirs.patch and trac_13544_dirs.2.patch are identical. You can delete one if you want. I wish that attachment owners could delete their own attachments.)


---

Comment by jdemeyer created at 2012-10-05 10:07:13

Resolution: fixed
