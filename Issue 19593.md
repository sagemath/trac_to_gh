# Issue 19593: Classification of finite and affine Coxeter groups

archive/issues_019593.json:
```json
{
    "body": "CC:  tscrim chapoton nthiery darij\n\nKeywords: coxeter system, root system\n\nThe bug here is two-fold:\n\n1. The roots for a `CoxeterGroup` are constructed as in Humphreys \"in the Coxeter sense, that all have the same norm\". Therefore it seems more natural to not at all introduce a type C and to follow Humphrey's classification of finite Coxeter groups given on page 32.\n\n2. The current implementation of types B/C (which I suggest to remove and to only keep type B) is also broken:\n\n* First Sage start\n\n```\nsage: W = CoxeterGroup(['B',4])\nsage: W.coxeter_matrix().coxeter_type()\nCoxeter type of ['B', 4]\nsage: W = CoxeterGroup(['C',4])\nsage: W.coxeter_matrix().coxeter_type()\nCoxeter type of ['B', 4]\n```\n\n* Second Sage start\n\n```\nsage: W = CoxeterGroup(['C',4])\nsage: W.coxeter_matrix().coxeter_type()\nCoxeter type of ['C', 4]\nsage: W = CoxeterGroup(['B',4])\nsage: W.coxeter_matrix().coxeter_type()\nCoxeter type of ['C', 4]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19830\n\n",
    "created_at": "2016-01-04T13:01:34Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "title": "Classification of finite and affine Coxeter groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19593",
    "user": "stumpc5"
}
```
CC:  tscrim chapoton nthiery darij

Keywords: coxeter system, root system

The bug here is two-fold:

1. The roots for a `CoxeterGroup` are constructed as in Humphreys "in the Coxeter sense, that all have the same norm". Therefore it seems more natural to not at all introduce a type C and to follow Humphrey's classification of finite Coxeter groups given on page 32.

2. The current implementation of types B/C (which I suggest to remove and to only keep type B) is also broken:

* First Sage start

```
sage: W = CoxeterGroup(['B',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['B', 4]
sage: W = CoxeterGroup(['C',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['B', 4]
```

* Second Sage start

```
sage: W = CoxeterGroup(['C',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['C', 4]
sage: W = CoxeterGroup(['B',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['C', 4]
```


Issue created by migration from https://trac.sagemath.org/ticket/19830





---

archive/issue_comments_269285.json:
```json
{
    "body": "And what to do with\n\n```\nsage: CoxeterGroup(CoxeterType(['B',2],['B',2]).coxeter_matrix()).coxeter_matrix().coxeter_type()\nCoxeter type of G2xG2 relabelled by {1: 3, 2: 4}\n```\n",
    "created_at": "2016-01-04T13:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269285",
    "user": "stumpc5"
}
```

And what to do with

```
sage: CoxeterGroup(CoxeterType(['B',2],['B',2]).coxeter_matrix()).coxeter_matrix().coxeter_type()
Coxeter type of G2xG2 relabelled by {1: 3, 2: 4}
```




---

archive/issue_comments_269286.json:
```json
{
    "body": "With `7.0.beta1`, I get:\n\n```\nsage: CoxeterGroup(CoxeterType(['B',2],['B',2]).coxeter_matrix()).coxeter_matrix().coxeter_type()\nCoxeter type of B2xB2\n```\n\nWhat are you using when you tested that? Although, that you got that in any situation is very frightening to me.",
    "created_at": "2016-01-04T13:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269286",
    "user": "tscrim"
}
```

With `7.0.beta1`, I get:

```
sage: CoxeterGroup(CoxeterType(['B',2],['B',2]).coxeter_matrix()).coxeter_matrix().coxeter_type()
Coxeter type of B2xB2
```

What are you using when you tested that? Although, that you got that in any situation is very frightening to me.



---

archive/issue_comments_269287.json:
```json
{
    "body": "Hm, after restarting with `7.0.beta2` I also get this result, and I wasn't able to reproduce the bug even after retyping all comments that seemed to be related. So let's leave this aside for now.",
    "created_at": "2016-01-04T14:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269287",
    "user": "stumpc5"
}
```

Hm, after restarting with `7.0.beta2` I also get this result, and I wasn't able to reproduce the bug even after retyping all comments that seemed to be related. So let's leave this aside for now.



---

archive/issue_comments_269288.json:
```json
{
    "body": "At some point during that session I accidentally copied almost the complete source of `subword_complex.py` into the terminal. So it might also be that this caused the issue, though I wouldn't know how.)",
    "created_at": "2016-01-04T14:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269288",
    "user": "stumpc5"
}
```

At some point during that session I accidentally copied almost the complete source of `subword_complex.py` into the terminal. So it might also be that this caused the issue, though I wouldn't know how.)



---

archive/issue_comments_269289.json:
```json
{
    "body": "`@`tscrim: And what to do with\n\n```\nsage: sage: W = CoxeterGroup(['B',3],index_set=['A','b','XX'])\nsage: sage: W.index_set()\n(1, 2, 3)\n```\n",
    "created_at": "2016-01-04T15:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269289",
    "user": "stumpc5"
}
```

`@`tscrim: And what to do with

```
sage: sage: W = CoxeterGroup(['B',3],index_set=['A','b','XX'])
sage: sage: W.index_set()
(1, 2, 3)
```




---

archive/issue_comments_269290.json:
```json
{
    "body": "Sorry for adding more and more questions here: The documentation of the method `roots` states \n\n```\nThese are roots in the Coxeter sense, that all have the\nsame norm. They are given by their coefficients in the\nbase of simple roots, also taken to have all the same\nnorm.\n```\n\nHow is this true if the sum of the coefficients is not one? As in\n\n```\nsage: W = CoxeterGroup(['A',2])\nsage: W.roots()\n[(1, 0), (1, 1), (0, 1), (-1, 0), (-1, -1), (0, -1)]\n```\n",
    "created_at": "2016-01-05T15:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269290",
    "user": "stumpc5"
}
```

Sorry for adding more and more questions here: The documentation of the method `roots` states 

```
These are roots in the Coxeter sense, that all have the
same norm. They are given by their coefficients in the
base of simple roots, also taken to have all the same
norm.
```

How is this true if the sum of the coefficients is not one? As in

```
sage: W = CoxeterGroup(['A',2])
sage: W.roots()
[(1, 0), (1, 1), (0, 1), (-1, 0), (-1, -1), (0, -1)]
```




---

archive/issue_comments_269291.json:
```json
{
    "body": "What ? Type A2 is simply laced, so the roots are just the roots in the Weyl sense..\n\nThe scalar product is the one that is invariant by the group, of course..",
    "created_at": "2016-01-05T15:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269291",
    "user": "chapoton"
}
```

What ? Type A2 is simply laced, so the roots are just the roots in the Weyl sense..

The scalar product is the one that is invariant by the group, of course..



---

archive/issue_comments_269292.json:
```json
{
    "body": "I am working on trying to fix the norm index set issue, which uncovered some other bugs/isues with the relabelling. I was somewhat inclined to say that passing a Coxeter (or Cartan) type and an index set was essentially double info, but after some more thought, I think it is a nice API to support.",
    "created_at": "2016-01-05T15:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269292",
    "user": "tscrim"
}
```

I am working on trying to fix the norm index set issue, which uncovered some other bugs/isues with the relabelling. I was somewhat inclined to say that passing a Coxeter (or Cartan) type and an index set was essentially double info, but after some more thought, I think it is a nice API to support.



---

archive/issue_comments_269293.json:
```json
{
    "body": "`@`chapoton: My last comment on the root lengths was too quick, please forget about it and sorry for the noise!",
    "created_at": "2016-01-05T15:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269293",
    "user": "stumpc5"
}
```

`@`chapoton: My last comment on the root lengths was too quick, please forget about it and sorry for the noise!



---

archive/issue_comments_269294.json:
```json
{
    "body": "Replying to [comment:6 stumpc5]:\n> Sorry for adding more and more questions here: The documentation of the method `roots` states \n> {{{\n> These are roots in the Coxeter sense, that all have the\n> same norm. They are given by their coefficients in the\n> base of simple roots, also taken to have all the same\n> norm.\n> }}}\n> How is this true if the sum of the coefficients is not one? As in\n> {{{\n> sage: W = CoxeterGroup(['A',2])\n> sage: W.roots()\n> [(1, 0), (1, 1), (0, 1), (-1, 0), (-1, -1), (0, -1)]\n> }}}\n\nIsn't this just that the basis of the simple roots is not orthonormal? So one can't read of the norm of vectors expressed there right away.",
    "created_at": "2016-01-05T20:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269294",
    "user": "nthiery"
}
```

Replying to [comment:6 stumpc5]:
> Sorry for adding more and more questions here: The documentation of the method `roots` states 
> {{{
> These are roots in the Coxeter sense, that all have the
> same norm. They are given by their coefficients in the
> base of simple roots, also taken to have all the same
> norm.
> }}}
> How is this true if the sum of the coefficients is not one? As in
> {{{
> sage: W = CoxeterGroup(['A',2])
> sage: W.roots()
> [(1, 0), (1, 1), (0, 1), (-1, 0), (-1, -1), (0, -1)]
> }}}

Isn't this just that the basis of the simple roots is not orthonormal? So one can't read of the norm of vectors expressed there right away.



---

archive/issue_comments_269295.json:
```json
{
    "body": "Oops, I was too quick and did not see your last comment :-)",
    "created_at": "2016-01-05T20:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269295",
    "user": "nthiery"
}
```

Oops, I was too quick and did not see your last comment :-)



---

archive/issue_comments_269296.json:
```json
{
    "body": "Here is a fix for relabelling issues that I came across. Although I think this might be better on a separate ticket.\n\n`@`darij the previous test for checking for relabelled types gave false negatives. Consider F<sub>4</sub> under cyclic shift and under interchanging 1 and 3. These are the *same* type and our relabelling check does not distinguish between them (nor can any algorithm).\n\nHow do we want to handle Coxeter vs Dynkin classification of the affine types or the general case? I'm guessing for the affine types, we just use the untwisted types. Do we even want to consider the general case at this point?\n----\nNew commits:",
    "created_at": "2016-01-30T01:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269296",
    "user": "tscrim"
}
```

Here is a fix for relabelling issues that I came across. Although I think this might be better on a separate ticket.

`@`darij the previous test for checking for relabelled types gave false negatives. Consider F<sub>4</sub> under cyclic shift and under interchanging 1 and 3. These are the *same* type and our relabelling check does not distinguish between them (nor can any algorithm).

How do we want to handle Coxeter vs Dynkin classification of the affine types or the general case? I'm guessing for the affine types, we just use the untwisted types. Do we even want to consider the general case at this point?
----
New commits:



---

archive/issue_comments_269297.json:
```json
{
    "body": "Oh gosh, I have literally no idea about anything beyond the classical types. Is this a bug in the algorithm I wrote? I thought very little of that algorithm is still in Sage?",
    "created_at": "2016-01-30T01:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269297",
    "user": "darij"
}
```

Oh gosh, I have literally no idea about anything beyond the classical types. Is this a bug in the algorithm I wrote? I thought very little of that algorithm is still in Sage?



---

archive/issue_comments_269298.json:
```json
{
    "body": "Replying to [comment:13 darij]:\n> Oh gosh, I have literally no idea about anything beyond the classical types. Is this a bug in the algorithm I wrote? I thought very little of that algorithm is still in Sage?\n\nSorry, I meant the B/C issue in the ticket description.",
    "created_at": "2016-01-30T01:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269298",
    "user": "tscrim"
}
```

Replying to [comment:13 darij]:
> Oh gosh, I have literally no idea about anything beyond the classical types. Is this a bug in the algorithm I wrote? I thought very little of that algorithm is still in Sage?

Sorry, I meant the B/C issue in the ticket description.



---

archive/issue_comments_269299.json:
```json
{
    "body": "Oh, that!\n\nI have to admit I don't know what the current recognition code is doing (the path-dependent output suggests some caching is going on), but my original code in #16630 never outputted a C_n. Maybe we should do the same?",
    "created_at": "2016-01-30T01:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269299",
    "user": "darij"
}
```

Oh, that!

I have to admit I don't know what the current recognition code is doing (the path-dependent output suggests some caching is going on), but my original code in #16630 never outputted a C_n. Maybe we should do the same?



---

archive/issue_comments_269300.json:
```json
{
    "body": "The B/C issue isn't so much having to do with type recognition (which won't result in a C<sub>n</sub>), but instead what to do when we do things like `CoxeterType(['C', 5])`.",
    "created_at": "2016-01-30T02:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19593#issuecomment-269300",
    "user": "tscrim"
}
```

The B/C issue isn't so much having to do with type recognition (which won't result in a C<sub>n</sub>), but instead what to do when we do things like `CoxeterType(['C', 5])`.
