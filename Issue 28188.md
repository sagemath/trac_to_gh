# Issue 28188: py3 : install only the correct pip

Issue created by migration from https://trac.sagemath.org/ticket/28425

Original creator: chapoton

Original creation time: 2019-08-29 18:21:29

CC:  embray jdemeyer fbissey

namely either pip2 or pip3


---

Comment by chapoton created at 2019-08-29 18:22:00

New commits:


---

Comment by chapoton created at 2019-08-29 18:22:00

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-08-29 18:26:39

probably one should also change the "dependencies" file, no ?


---

Comment by jhpalmieri created at 2019-08-29 18:48:21

I was trying to accomplish something similar, but in fact to remove Python 2 completely with a Python 3 build (as you mentioned on sage-devel). The only reason Python 2 is built in a Python 3 build, currently, is that it is a dependency for setuptools and pip. My patch, which I am currently testing:

```diff
diff --git a/build/pkgs/pip/dependencies b/build/pkgs/pip/dependencies
index d7000d134d..6fb99bfe3f 100644
--- a/build/pkgs/pip/dependencies
+++ b/build/pkgs/pip/dependencies
@@ -1,4 +1,4 @@
-python2 python3 setuptools
+$(PYTHON) python3 setuptools
 
 ----------
 All lines of this file are ignored except the first.
diff --git a/build/pkgs/pip/spkg-install b/build/pkgs/pip/spkg-install
index db656d4b4d..f7243906fb 100644
--- a/build/pkgs/pip/spkg-install
+++ b/build/pkgs/pip/spkg-install
@@ -8,8 +8,14 @@ export PYTHONPATH="$(pwd)/src"
 # need to use --upgrade or --ignore-installed; Otherwise pip, which is
 # importing itself, will think itself is already installed
 #
-# Install pip3 first so pip2 overwrites local/bin/pip
-for vers in 3 2; do
+if [ "$SAGE_PYTHON3" = "yes" ]; then
+    versions="3"
+else
+    # Install pip3 first so pip2 overwrites local/bin/pip
+    versions="3 2"
+fi
+
+for vers in $versions; do
     python${vers} -m pip install --verbose --no-index --ignore-installed \
             --no-build-isolation --isolated --root="$SAGE_DESTDIR" . || \
         sdh_die "Error building / installing pip${vers}"
diff --git a/build/pkgs/setuptools/dependencies b/build/pkgs/setuptools/dependencies
index 6e4d4d7da4..6304688354 100644
--- a/build/pkgs/setuptools/dependencies
+++ b/build/pkgs/setuptools/dependencies
@@ -1,4 +1,4 @@
-python2 python3
+$(PYTHON) python3
 
 ----------
 All lines of this file are ignored except the first.
diff --git a/build/pkgs/setuptools/spkg-install b/build/pkgs/setuptools/spkg-install
index e231615d95..800170674b 100644
--- a/build/pkgs/setuptools/spkg-install
+++ b/build/pkgs/setuptools/spkg-install
@@ -9,8 +9,14 @@ export PYTHON_EGG_CACHE="$DOT_SAGE/.python-eggs"
 
 cd src
 
+if [ "$SAGE_PYTHON3" = "yes" ]; then
+    versions="3"
+else
+    versions="2 3"
+fi
+
 # Prevent setuptools from installing itself with easy_install
-for vers in 2 3; do
+for vers in $versions; do
     python${vers} setup.py --no-user-cfg install \
             --single-version-externally-managed --root="$SAGE_DESTDIR" || \
         sdh_die "Error building / installing setuptools for Python ${vers}"
```



---

Comment by jhpalmieri created at 2019-08-29 22:00:58

I've opened up #28426 for my changes.


---

Comment by chapoton created at 2019-09-01 06:24:39

ok, then I think I can close the ticket as duplicate, right ?


---

Comment by jhpalmieri created at 2019-09-03 17:42:13

Yes, I agree.


---

Comment by chapoton created at 2019-09-03 18:17:18

Resolution: duplicate
