# Issue 17702: SageTex sageplot giving oversized plots with default Debian pdflatex.

Issue created by migration from https://trac.sagemath.org/ticket/17939

Original creator: anton_t

Original creation time: 2015-03-12 11:16:54

CC:  tmonteil vdelecroix dimpase chapoton

Keywords: sagetex latex pdflatex

As above. 

After using the third possible way of getting latex to talk to sagetex from here: http://www.sagemath.org/doc/installation/sagetex.html

The example code inside the sagetex folder produces a very ugly set of plots roughly twice the size of those shown here when : 
http://ctan.unsw.edu.au/macros/latex/contrib/sagetex/example.pdf

Using:
Sage Version 6.5, Release Date: 2015-02-17 from github.
pdfTeX 3.14159265-2.6-1.40.15 (TeX Live 2015/dev/Debian)

If no one else can reproduce this but I will attach the produced pdf. This however also happened under regular latex in Debian.


---

Comment by anton_t created at 2015-03-12 11:45:11

After some minor digging around it looks like line 97 of sagetexparse.py never evaluates to true and 
    

```
opts = r'[width=.75\textwidth]'
```


is never run. Since the name of the variable is "t" and I'm not familiar with the code base around those parts I'm not too keep on trying to fix it myself, as just trying to see where else in the code 't' appears made my eyes bleed.


---

Comment by slelievre created at 2016-01-25 00:32:59

Changing keywords from "sagetex latex pdflatex" to "sagetex latex pdflatex debian".


---

Comment by kcrisman created at 2016-03-08 15:58:15

Can you verify that this is only with Debian?


---

Comment by kcrisman created at 2017-03-02 18:28:04

See also #22499 which might make it easier to deal with such tickets.


---

Comment by kcrisman created at 2019-01-08 14:13:57

Changing priority from major to minor.


---

Comment by kcrisman created at 2019-01-08 14:13:57

I seem to recall default image sizes getting a lot bigger a few years ago, but haven't seen any specific validation of this ticket.  Certainly downgrading status as it is fairly easy (if tedious) to fix on an image-by-image basis.


---

Comment by kcrisman created at 2019-06-11 14:00:57

`t` is the [list of matched tokens](https://pyparsing-docs.readthedocs.io/en/latest/HowToUsePyparsing.html#setparseaction) in a `pyparsing` result.   So in principle, `t.opts` is the stuff in the first matching square brackets (if present) from a `\sageplot` command.

However, if you are right then maybe we need to change

```
sageplotparser = (r'\sageplot'
                 + Optional(squarebrackets)('opts')
                 + Optional(squarebrackets)('format')
                 + curlybrackets('code'))
```

to include the default in this part, rather than in the plot method

```
  def plot(self, s, l, t):
    self.plotn += 1
    if len(t.opts) == 0:
      opts = r'[width=.75\textwidth]'
    else:
      opts = t.opts[0]
    return (r'\includegraphics%s{sage-plots-for-%s.tex/plot-%s}' %
      (opts, self.fn, self.plotn - 1))
```

I'd want to test whether this is really being skipped but at any rate somewhere in here is where the fix would have to lie.  Once we figure out whether this is an actual bug, we should [report upstream](https://github.com/sagemath/sagetex).

By the way, [the scripts dtx file](https://github.com/sagemath/sagetex/blob/master/scripts.dtx) is eminently readable!
