# Issue 15051: Balanced Incomplete Block Designs with k=4

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2013-10-16 15:02:16

CC:  dimpase vbraun wdj rbeezer

End of a loong queue of patches, here it is ! The constructions for BIBD with k=4 as found in Douglas Stinson's book "Combinatorial Designs: Constructions and Analysis", which uses the constructions given in #15286 (Latin Squares) and #15287 (Orthogonal Arrays).

This patch creates a file named bibd.py in `combinat/design/` for the BIBD we already know how to build and the future ones (I will make sure of that `:-P`)


---

Comment by ncohen created at 2013-10-16 15:02:40

Changing status from new to needs_review.


---

Comment by git created at 2013-10-16 15:07:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-09 12:31:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-09 12:32:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-27 15:38:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-27 15:43:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-03-27 15:56:34

Just rebased on the latest version of its last dependency. Hey guys, all the dependencies are reviewed now ! We can get this in !

Look at what it can do. Isn't it totally cool ? `:-PPP`


```
sage: designs.BalancedIncompleteBlockDesign(13,4)
```


Nathann


---

Comment by dimpase created at 2014-03-27 20:04:07

while building docs, I get

```
OSError: [combinat ] /usr/local/src/sage/sage-6.1.rc0/local/lib/python2.7/site-packages/sage/combinat/designs/bibd.py:docstring of sage.combinat.designs.bibd.BalancedIncompleteBlockDesign:27: ERROR: Unknown target name: "http://www.argilo.net/files/bibd.pdf".
```

any clues?


---

Comment by ncohen created at 2014-03-27 20:12:59

It is probably this 

```
`http://www.argilo.net/files/bibd.pdf`_
```


You can remove the link if it is a problem to compile the doc, it is not very important.

Nathann


---

Comment by dimpase created at 2014-03-27 21:11:54

I pushed the fix for this and one more small doc-related issue.
----
New commits:


---

Comment by dimpase created at 2014-03-28 09:20:16

I don't like that `designs.BalancedIncompleteBlockDesign()` returns a list of blocks, whereas it should obviously return an `IncidenceStructure`, e.g. as `designs.ProjectivePlaneDesign()` does. Please fix this.


---

Comment by dimpase created at 2014-03-28 09:20:16

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-03-28 13:22:59

Done. But honestly you are just enforcing your own subjective point of view there, and I do not like what I am doing.

It is very nice if for you a BIBD is a Incidence Structure, but for me this thing is a collection of set. That's all. I could also return a complete graph along with a collection of subgraphs to show that a BIBD is a decomposition of a complete graph into smaller ones, and this does not make any sense at all. For me a BIBD is a collection of sets, and if you want some specific additional structure on top of it you are quite free to set it yourself.

Besides this `IncidenceStructure` class spends its lifetime sorting stuff I never asked to sort, and copying stuff around for no reason. That's for the loss of computational time resulting for enforcing a subjective point of view.

In the end, I just end up calling `.blocks()` every time I build a BIBD, and I don't see why I should pay cycles to `IncidenceStructure` in exchange for that.

Nathann
----
New commits:


---

Comment by ncohen created at 2014-03-28 13:22:59

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2014-03-28 21:25:07

Replying to [comment:14 ncohen]:
> Done. But honestly you are just enforcing your own subjective point of view there, and I do not like what I am doing.
I am enforcing consistency, as I indicated quite clearly, I hope.
The thing I complained about is akin to `graphs.blah()` returning a list of edges instead of a `Graph`.


> 
> It is very nice if for you a BIBD is a Incidence Structure, but for me this thing is a collection of set. That's all. I could also return a complete graph along with a collection of subgraphs to show that a BIBD is a decomposition of a complete graph into smaller ones, and this does not make any sense at all. For me a BIBD is a collection of sets, and if you want some specific additional structure on top of it you are quite free to set it yourself.
> 
> Besides this `IncidenceStructure` class spends its lifetime sorting stuff I never asked to sort, and copying stuff around for no reason. That's for the loss of computational time resulting for enforcing a subjective point of view.

well, this just means that `IncidenceStructure` class is in need of an improvement; perhaps it should get several backends just as `Graph` has.


---

Comment by ncohen created at 2014-03-28 22:23:49

> I am enforcing consistency, as I indicated quite clearly, I hope.

You are enforcing consistency because consistency is a way to enforce what you like. If I tell you that `designs.steiner_quadruple_systems` returns tuples then you will tell me (as before) that "It's not because I did something wrong once that I should be allowed to do it again".

Dear, dear consistency `:-P`

> The thing I complained about is akin to `graphs.blah()` returning a list of edges instead of a `Graph`.

Yep. Exactly like here, and for the same reason.

> well, this just means that `IncidenceStructure` class is in need of an improvement; perhaps it should get several backends just as `Graph` has.

Changes nothing. All backends have a cost, all of them mean duplicating stuff uselessly, and none of them is as "simple and understandable" as a list. If you want a data structure to do something specific, pick the data structure that you like. I don't think we should pick a specific data structure over another one, and so I prefer to return the most basic types. The types that the functions actually work with. No copy, easy-to-understand data.

I personally have NOTHING to do of all methods of `IncidenceStructure`, yet I am the one who implements that code. Isn't that a proof that it is not the right data structure ? `:-P`

Nathann


---

Comment by dimpase created at 2014-03-29 00:12:27

Replying to [comment:16 ncohen]:
> > I am enforcing consistency, as I indicated quite clearly, I hope.
> 
> You are enforcing consistency because consistency is a way to enforce what you like. If I tell you that `designs.steiner_quadruple_systems` returns tuples then you will tell me (as before) that "It's not because I did something wrong once that I should be allowed to do it again".
> 
> Dear, dear consistency `:-P`

Do you understand the meaning of the word `consistency`? Just wondering...

I don't have time to control all the code you produce for consistency, sorry. But, indeed, I am of opinion that `designs.*` must all return the stuff from the same class. And I am sure the majority on sage-devel would support me on this, if you think that I am not sufficient authority for you.

> 
> > The thing I complained about is akin to `graphs.blah()` returning a list of edges instead of a `Graph`.
> 
> Yep. Exactly like here, and for the same reason.

But `graphs.*` do not do this, and `designs.*` do. Some have to give, and it's certainly `designs.*`.

> 
> > well, this just means that `IncidenceStructure` class is in need of an improvement; perhaps it should get several backends just as `Graph` has.
> 
> Changes nothing. All backends have a cost, all of them mean duplicating stuff uselessly, and none of them is as "simple and understandable" as a list. If you want a data structure to do something specific, pick the data structure that you like. I don't think we should pick a specific data structure over another one, and so I prefer to return the most basic types. The types that the functions actually work with. No copy, easy-to-understand data.

No, this design (more precisely, absence of one) is crap, it throws away the fact that list in question is a list of blocks of BIBD.
It's perfectly OK to have it in your private code, but not in a library code.

E.g. the fact that it is not an immutable list is inviting errors.
Another thing, one might wonder what the parameters of the design are. 
Surely one can have a function to compute them, but it can also be implemented by storing the parameters upon the creation.
Same for automorphism groups.

> 
> I personally have NOTHING to do of all methods of `IncidenceStructure`, yet I am the one who implements that code. Isn't that a proof that it is not the right data structure ? `:-P`
> 
I did not check who wrote `IncidenceStructure` structure class. Does it matter? It could have been you...


---

Comment by ncohen created at 2014-03-29 06:34:52

> Do you understand the meaning of the word `consistency`? Just wondering...

My point was to show you that if I try to be consistent with something you don't like, the result is the same `:-P`

> I don't have time to control all the code you produce for consistency, sorry. But, indeed, I am of opinion that `designs.*` must all return the stuff from the same class. And I am sure the majority on sage-devel would support me on this, if you think that I am not sufficient authority for you.

No authority is ever sufficient to enforce a bad idea. For instance you will never make "MOLS" return block designs. They return lists of sets from time to time. And Orthogonal arrays are not block designs when you call `orthogonal_array`. So no, these function will never all return the same thing.

> But `graphs.*` do not do this, and `designs.*` do. Some have to give, and it's certainly `designs.*`.

`graphs.something` sometimes return lists of graphs, or  iterators on them. Though it is true that *they* are more consistent.

> No, this design (more precisely, absence of one) is crap, it throws away the fact that list in question is a list of blocks of BIBD.

Who cares ? You know it when you build it, and you do whatever you want afterwards ! You can change the sets of a block design without changing the name. Actually, with  your strandards the design of `BlockDesign` is pretty bad, for `.blocks()` does not return a copy of the blocks but the  blocks themselves, so I wondered at some point if it was safe  to  do that. See ? More copies  for nothing, just because you want to wrap them in a data structure when nobody requested it.

> It's perfectly OK to have it in your private code, but not in a library code.
> 
> E.g. the fact that it is not an immutable list is inviting errors.

Do you see that your way of looking at things will add useless copies everywhere ? Copies, and sorting, and equality tests, all for no new feature, but only for "good code administration" ? Do you see the cost of this, and the total lack of gain in the process ?

The code will be slower. For nothing. What's so good in "consistency" that we have to pay all this ?

> Another thing, one might wonder what the parameters of the design are. 

Not when one creates the design by giving it the parameters. But they can recompute them afterwards, I fixed the function recently.

> Surely one can have a function to compute them, but it can also be implemented by storing the parameters upon the creation.
> Same for automorphism groups.

You are all crazy with your caches everywhere, immutable structures and so. You waste computations. Consider the developers as responsible beings, and you will stop having to copy/cache stuff when nobody asks you as if you wanted to protect them from themselves. They know what they are doing.

> I did not check who wrote `IncidenceStructure` structure class. Does it matter? It could have been you...

Well, it does not do much. It builds the matrix from the blocks, or the blocks from the matrix, it computes parameters... Well, to be honest it does its job. It's just that there is no reason on earth why we should pay copies to this data structure if we don't need it.

Nathann


---

Comment by ncohen created at 2014-03-29 07:08:23

(Oh, by the way I just looked at the list of commits in this branch and saw that the Orthogonal Array stuff is still there : it has already been reviewed, so this part should be okay. It's not easy to know what is left to review now :-/)


---

Comment by dimpase created at 2014-03-29 10:36:26

Replying to [comment:18 ncohen]:
> > Do you understand the meaning of the word `consistency`? Just wondering...
> 
> My point was to show you that if I try to be consistent with something you don't like, the result is the same `:-P`
> 
> > I don't have time to control all the code you produce for consistency, sorry. But, indeed, I am of opinion that `designs.*` must all return the stuff from the same class. And I am sure the majority on sage-devel would support me on this, if you think that I am not sufficient authority for you.
> 
> No authority is ever sufficient to enforce a bad idea. For instance you will never make "MOLS" return block designs. They return lists of sets from time to time. And Orthogonal arrays are not block designs when you call `orthogonal_array`. So no, these function will never all return the same thing.
> 
> > But `graphs.*` do not do this, and `designs.*` do. Some have to give, and it's certainly `designs.*`.
> 
> `graphs.something` sometimes return lists of graphs, or  iterators on them. Though it is true that *they* are more consistent.
> 
> > No, this design (more precisely, absence of one) is crap, it throws away the fact that list in question is a list of blocks of BIBD.
> 
> Who cares ? You know it when you build it, and you do whatever you want afterwards ! 

a user can go through `designs.*` and call functions, like 

You can change the sets of a block design without changing the name. Actually, with  your strandards the design of `BlockDesign` is pretty bad, for `.blocks()` does not return a copy of the blocks but the  blocks themselves, so I wondered at some point if it was safe  to  do that. See ? More copies  for nothing, just because you want to wrap them in a data structure when nobody requested it.


`ProjectivePlaneDesign()` is written by you, isn't it? And it does return `IncidenceStructure`. Needless to say, `ProjectivePlaneDesign()` is a BIBD. You simply do not have a good argument to justify why in different cases you return different classes.


---

Comment by ncohen created at 2014-03-30 01:11:06

> `ProjectivePlaneDesign()` is written by you, isn't it? And it does return `IncidenceStructure`. Needless to say, `ProjectivePlaneDesign()` is a BIBD. You simply do not have a good argument to justify why in different cases you return different classes.

`O_O`

Hey, let's make them all return lists of Sets if you don't mind ! `:-D`

This function returns `IncidenceStructure` because I copy/pasted from projective geometry design, but really I  could not care less about Incidence Structure. I just  never  used  those functions in any way. I just want the sets `:-P`

Nathann


---

Comment by dimpase created at 2014-03-30 19:58:28

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2014-03-30 19:58:28

OK, good.


---

Comment by ncohen created at 2014-03-30 20:13:02

Wow.

Wow.

BIBD with k=4 reviewed.

THaaaaaaaaaaaaaaaaaaaaaaaaaaank you so much !! `:-)`

I can clean  the code for k=5 now.

Nathann


---

Comment by vbraun created at 2014-03-31 18:05:44

PDF docs don't build:

```
(inputenc)                in inputencoding `utf8'.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.173287 Returns a $(v,\{^^D
                            ,5,8,9,12\})-PBD$ on $v$ elements.
? 
! Emergency stop.
 ...                                              
                                                  
l.173287 Returns a $(v,\{^^D
                            ,5,8,9,12\})-PBD$ on $v$ elements.
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on combinat.log.
```



---

Comment by dimpase created at 2014-03-31 20:32:29

here is the diff to fix the thing:

```
--- a/src/sage/combinat/designs/bibd.py
+++ b/src/sage/combinat/designs/bibd.py
`@``@` -449,7 +449,7 `@``@` def _relabel_bibd(B,n):
 
 def PBD_4_5_8_9_12(v, check=True):
     """
-    Returns a `(v,\{\4,5,8,9,12\})-PBD` on `v` elements.
+    Returns a `(v,\{4,5,8,9,12\})-PBD` on `v` elements.
 
     A `(v,\{4,5,8,9,12\})`-PBD exists if and only if `v\equiv 0,1 \pmod 4`. The
     construction implemented here appears page 168 in [Stinson2004]_.
```

I have to f*cking clue how to push such a commit into the right place. `Git the hard way` does give recepies that push something somewhere, but certainly not where it should go to...


---

Comment by dimpase created at 2014-03-31 20:42:03

I've modified the description of the ticket to point to the "right" branch and commit. Hope I didn't screw this too badly...


---

Comment by vbraun created at 2014-03-31 21:05:52

Just `git push trac HEAD:public/15288` should have done it. But this is fine, too.


---

Comment by dimpase created at 2014-03-31 21:18:44

I don't see how this could work - unless I don't create my own branch. 
I did as described in `Git the hard way`:

```
git fetch trac public/15288
get checkout -b typofix15288 FETCH_HEAD
... editing the file...
git commit -a
git push --set-upstream trac HEAD:public/typofix15288` 
```

And trac server was not impressed :-)

I thought that the reason for this is some kind of lack of permissions to commit to a branch that is not my own... Anyhow, it's not clear from the description in the docs. Especially it's unclear under what conditions the manual changing of the branch and commit fields are not needed.


---

Comment by vbraun created at 2014-03-31 21:21:02

Everybody can write to branches named `public/...`

Trac can't possibly know that `public/typofix15288` is supposed to be on this ticket, which is why you had to manually update the ticket.


---

Comment by vbraun created at 2014-04-01 12:12:38

Resolution: fixed
