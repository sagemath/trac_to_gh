# Issue 31717: Hyperplane Transformation Matrix

Issue created by migration from https://trac.sagemath.org/ticket/31954

Original creator: @EnderWannabe

Original creation time: 2021-06-11 03:45:49

CC:  bhutz

Keywords: gsoc2021

Given two hyperplanes in projective space, there exist many PGL elements which map one hyperplane to the other. We add a method (hyperplane_transformation_matrix) to projective space to compute such a PGL element.


---

Comment by git created at 2021-06-14 17:05:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-14 18:47:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-06-14 18:47:38

Changing status from new to needs_review.


---

Comment by bhutz created at 2021-06-16 21:59:05

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2021-06-16 21:59:05

I didn't get to fully finish my reviewing, but i wanted to get you some feedback today. This is looking good for the most part. Here is some feedback

- add a check to the examples like:

```
plane2(m*P(1,0,-1,0))
```


- add some sanity checking that your procedures to find points really do end up with the right number

- need some number field examples

- relative number fields breaks:

```
K.<v>=CyclotomicField(3)
R.<t>=K[]
F.<w>=K.extension(t^5+2)
P.<x,y,z> = ProjectiveSpace(F, 2)
plane1 = P.subscheme(x - 2*w*y + z)
plane2 = P.subscheme(x + w*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```


- errr..random bug in Sage?

```
K.<v>=CyclotomicField(3)
R.<t>=K[]
F.<w>=K.extension(t^5+2)
G.<u> = F.absolute_field()
P.<x,y,z> = ProjectiveSpace(G, 2)
plane1 = P.subscheme(x - 2*u*y + z)
plane2 = P.subscheme(x + u*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```



---

Comment by git created at 2021-06-17 14:04:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-17 18:10:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-06-17 18:11:20

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2021-06-17 18:36:03

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2021-06-17 18:36:03

Two comments here.

- I understand the desire for the report message in the error, but that is not standard practice for a release version of Sage.

- Now that you've expanded the scope of fields, the normalization issue is cropping up again. With your call to .point_transformation_matrix, it is always normalizing, since there is no way to control that parameter.


---

Comment by git created at 2021-06-17 19:29:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-06-17 19:30:27

I'm not seeing issues with normalization. Normalization might fail when the base field isn't exact, but it should be disabled in those cases. Could you give an example?


---

Comment by bhutz created at 2021-06-17 19:38:40


```
K=CC
P.<x,y,z,w> = ProjectiveSpace(K, 3)
plane1 = P.subscheme(x + K(sqrt(2))*y +4*z)
plane2 = P.subscheme(2*x + CC(3)*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```



---

Comment by @EnderWannabe created at 2021-06-17 21:00:47

That division error is caused when trying to invert the matrix m_source on line 1500, not from attempting to normalize. Its a precision issue with the complexes - that works when the reals are used.

I think the bug is coming from the call to solve right in the helper function get_matrix, as solve right approximates. I'm not sure if there is any solution except adding a warning about precision fields.


---

Comment by bhutz created at 2021-06-22 15:07:32

Another normalization issue:


```
K.<t>=GF(2)[]
P.<x,y,z,w> = ProjectiveSpace(K, 3)
plane1 = P.subscheme(t*x + K(2)*y + z)
plane2 = P.subscheme(2*x + t*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```



---

Comment by @EnderWannabe created at 2021-06-22 17:16:40

This one appears to be an issue with lcm on polynomial rings. Opened ticket #32033 to deal with that bug.


---

Comment by @EnderWannabe created at 2021-06-22 17:16:51

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2021-06-24 13:59:30

ok. Then I think we're good on this one.


---

Comment by bhutz created at 2021-06-24 13:59:30

Changing status from needs_review to positive_review.


---

Comment by git created at 2021-07-09 16:52:57

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-07-09 16:52:57

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by @EnderWannabe created at 2021-07-09 16:53:57

Pushed an update to dependencies - this ticket is the same, but #31906 had been updated.


---

Comment by bhutz created at 2021-07-12 18:52:06

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2021-07-12 18:52:06

With the new #31906 this looks good.


---

Comment by vbraun created at 2021-07-25 13:25:39

Resolution: fixed
