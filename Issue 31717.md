# Issue 31717: Hyperplane Transformation Matrix

archive/issues_031717.json:
```json
{
    "body": "CC:  bhutz\n\nKeywords: gsoc2021\n\nGiven two hyperplanes in projective space, there exist many PGL elements which map one hyperplane to the other. We add a method (hyperplane_transformation_matrix) to projective space to compute such a PGL element.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31954\n\n",
    "created_at": "2021-06-11T03:45:49Z",
    "labels": [
        "algebraic geometry",
        "minor",
        "enhancement"
    ],
    "title": "Hyperplane Transformation Matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31717",
    "user": "@EnderWannabe"
}
```
CC:  bhutz

Keywords: gsoc2021

Given two hyperplanes in projective space, there exist many PGL elements which map one hyperplane to the other. We add a method (hyperplane_transformation_matrix) to projective space to compute such a PGL element.

Issue created by migration from https://trac.sagemath.org/ticket/31954





---

archive/issue_comments_453258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-14T17:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453258",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-14T18:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453259",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453260.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-14T18:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453260",
    "user": "@EnderWannabe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_453261.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-16T21:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453261",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_453262.json:
```json
{
    "body": "I didn't get to fully finish my reviewing, but i wanted to get you some feedback today. This is looking good for the most part. Here is some feedback\n\n- add a check to the examples like:\n\n```\nplane2(m*P(1,0,-1,0))\n```\n\n\n- add some sanity checking that your procedures to find points really do end up with the right number\n\n- need some number field examples\n\n- relative number fields breaks:\n\n```\nK.<v>=CyclotomicField(3)\nR.<t>=K[]\nF.<w>=K.extension(t^5+2)\nP.<x,y,z> = ProjectiveSpace(F, 2)\nplane1 = P.subscheme(x - 2*w*y + z)\nplane2 = P.subscheme(x + w*y + z)\nm=P.hyperplane_transformation_matrix(plane1, plane2)\n```\n\n\n- errr..random bug in Sage?\n\n```\nK.<v>=CyclotomicField(3)\nR.<t>=K[]\nF.<w>=K.extension(t^5+2)\nG.<u> = F.absolute_field()\nP.<x,y,z> = ProjectiveSpace(G, 2)\nplane1 = P.subscheme(x - 2*u*y + z)\nplane2 = P.subscheme(x + u*y + z)\nm=P.hyperplane_transformation_matrix(plane1, plane2)\n```\n",
    "created_at": "2021-06-16T21:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453262",
    "user": "bhutz"
}
```

I didn't get to fully finish my reviewing, but i wanted to get you some feedback today. This is looking good for the most part. Here is some feedback

- add a check to the examples like:

```
plane2(m*P(1,0,-1,0))
```


- add some sanity checking that your procedures to find points really do end up with the right number

- need some number field examples

- relative number fields breaks:

```
K.<v>=CyclotomicField(3)
R.<t>=K[]
F.<w>=K.extension(t^5+2)
P.<x,y,z> = ProjectiveSpace(F, 2)
plane1 = P.subscheme(x - 2*w*y + z)
plane2 = P.subscheme(x + w*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```


- errr..random bug in Sage?

```
K.<v>=CyclotomicField(3)
R.<t>=K[]
F.<w>=K.extension(t^5+2)
G.<u> = F.absolute_field()
P.<x,y,z> = ProjectiveSpace(G, 2)
plane1 = P.subscheme(x - 2*u*y + z)
plane2 = P.subscheme(x + u*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```




---

archive/issue_comments_453263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T14:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453263",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T18:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453264",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453265.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-17T18:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453265",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_453266.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-17T18:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453266",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_453267.json:
```json
{
    "body": "Two comments here.\n\n- I understand the desire for the report message in the error, but that is not standard practice for a release version of Sage.\n\n- Now that you've expanded the scope of fields, the normalization issue is cropping up again. With your call to .point_transformation_matrix, it is always normalizing, since there is no way to control that parameter.",
    "created_at": "2021-06-17T18:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453267",
    "user": "bhutz"
}
```

Two comments here.

- I understand the desire for the report message in the error, but that is not standard practice for a release version of Sage.

- Now that you've expanded the scope of fields, the normalization issue is cropping up again. With your call to .point_transformation_matrix, it is always normalizing, since there is no way to control that parameter.



---

archive/issue_comments_453268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T19:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453268",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453269.json:
```json
{
    "body": "I'm not seeing issues with normalization. Normalization might fail when the base field isn't exact, but it should be disabled in those cases. Could you give an example?",
    "created_at": "2021-06-17T19:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453269",
    "user": "@EnderWannabe"
}
```

I'm not seeing issues with normalization. Normalization might fail when the base field isn't exact, but it should be disabled in those cases. Could you give an example?



---

archive/issue_comments_453270.json:
```json
{
    "body": "\n```\nK=CC\nP.<x,y,z,w> = ProjectiveSpace(K, 3)\nplane1 = P.subscheme(x + K(sqrt(2))*y +4*z)\nplane2 = P.subscheme(2*x + CC(3)*y + z)\nm=P.hyperplane_transformation_matrix(plane1, plane2)\n```\n",
    "created_at": "2021-06-17T19:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453270",
    "user": "bhutz"
}
```


```
K=CC
P.<x,y,z,w> = ProjectiveSpace(K, 3)
plane1 = P.subscheme(x + K(sqrt(2))*y +4*z)
plane2 = P.subscheme(2*x + CC(3)*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```




---

archive/issue_comments_453271.json:
```json
{
    "body": "That division error is caused when trying to invert the matrix m_source on line 1500, not from attempting to normalize. Its a precision issue with the complexes - that works when the reals are used.\n\nI think the bug is coming from the call to solve right in the helper function get_matrix, as solve right approximates. I'm not sure if there is any solution except adding a warning about precision fields.",
    "created_at": "2021-06-17T21:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453271",
    "user": "@EnderWannabe"
}
```

That division error is caused when trying to invert the matrix m_source on line 1500, not from attempting to normalize. Its a precision issue with the complexes - that works when the reals are used.

I think the bug is coming from the call to solve right in the helper function get_matrix, as solve right approximates. I'm not sure if there is any solution except adding a warning about precision fields.



---

archive/issue_comments_453272.json:
```json
{
    "body": "Another normalization issue:\n\n\n```\nK.<t>=GF(2)[]\nP.<x,y,z,w> = ProjectiveSpace(K, 3)\nplane1 = P.subscheme(t*x + K(2)*y + z)\nplane2 = P.subscheme(2*x + t*y + z)\nm=P.hyperplane_transformation_matrix(plane1, plane2)\n```\n",
    "created_at": "2021-06-22T15:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453272",
    "user": "bhutz"
}
```

Another normalization issue:


```
K.<t>=GF(2)[]
P.<x,y,z,w> = ProjectiveSpace(K, 3)
plane1 = P.subscheme(t*x + K(2)*y + z)
plane2 = P.subscheme(2*x + t*y + z)
m=P.hyperplane_transformation_matrix(plane1, plane2)
```




---

archive/issue_comments_453273.json:
```json
{
    "body": "This one appears to be an issue with lcm on polynomial rings. Opened ticket #32033 to deal with that bug.",
    "created_at": "2021-06-22T17:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453273",
    "user": "@EnderWannabe"
}
```

This one appears to be an issue with lcm on polynomial rings. Opened ticket #32033 to deal with that bug.



---

archive/issue_comments_453274.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-22T17:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453274",
    "user": "@EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_453275.json:
```json
{
    "body": "ok. Then I think we're good on this one.",
    "created_at": "2021-06-24T13:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453275",
    "user": "bhutz"
}
```

ok. Then I think we're good on this one.



---

archive/issue_comments_453276.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-24T13:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453276",
    "user": "bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453277.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-07-09T16:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453277",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_453278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-07-09T16:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453278",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_453279.json:
```json
{
    "body": "Pushed an update to dependencies - this ticket is the same, but #31906 had been updated.",
    "created_at": "2021-07-09T16:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453279",
    "user": "@EnderWannabe"
}
```

Pushed an update to dependencies - this ticket is the same, but #31906 had been updated.



---

archive/issue_comments_453280.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-12T18:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453280",
    "user": "bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453281.json:
```json
{
    "body": "With the new #31906 this looks good.",
    "created_at": "2021-07-12T18:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453281",
    "user": "bhutz"
}
```

With the new #31906 this looks good.



---

archive/issue_comments_453282.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31717#issuecomment-453282",
    "user": "vbraun"
}
```

Resolution: fixed
