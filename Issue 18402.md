# Issue 18402: I.divides(0) crashes for I a fractional ideal

Issue created by migration from Trac.

Original creator: cremona

Original creation time: 2015-06-08 19:38:26

CC:  mmasdeu


```
sage: K.<a> = NumberField(x^2-10)
sage: a.divides(K(10))
True
sage: a.divides(K(0))                                                                          
True
sage: I = K.ideal(a)
sage: I.divides(K(10))                                                                         
True
sage: I.divides(K(0))                                                                          
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-18-bfc74602576b> in <module>()
----> 1 I.divides(K(Integer(0)))

/home/jec/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.pyc in divides(self, other)
   1753         if not isinstance(other, NumberFieldIdeal):
   1754             other = self.number_field().ideal(other)
-> 1755         return (other / self).is_integral()
   1756 
   1757     def factor(self):

TypeError: unsupported operand type(s) for /: 'NumberFieldIdeal' and 'NumberFieldFractionalIdeal'
```

This is failing because the divides method does this:

```
       if not isinstance(other, NumberFieldIdeal):
            other = self.number_field().ideal(other)
        return (other / self).is_integral()
```

and the / operator does not like having the left operand the zero ideal (which is not a fractional ideal).  Similarly, I.divides(K.ideal(0)) fails.

The simple fix is to check whether other.is_zero() first.


---

Comment by cremona created at 2015-06-08 19:50:14

New commits:


---

Comment by cremona created at 2015-06-08 19:50:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-06-08 21:06:03

Wouldn't the proper fix to just allow `(0) / I = (0)` for a fractional ideal `I`? Can you check if #18622 does that?


---

Comment by cremona created at 2015-06-08 21:19:48

OK, I will check that.  Certainly the 0 ideal passes the is_integral() test, and that should be done anyway, as it is already p ossible to multiply the 0 idal with a nonzero (fractional) one.


---

Comment by jdemeyer created at 2015-06-09 06:42:38

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-06-09 06:42:38

It's worse with #18622: it gives a segmentation fault.

In any case, I still think that allowing `(0)/I` is the proper fix here, so I'm boldly changing the ticket to do that.


---

Comment by cremona created at 2015-06-09 08:31:15

I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.


---

Comment by jdemeyer created at 2015-06-09 09:06:26

Replying to [comment:5 cremona]:
> I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.
You can always use the commit hash, that should always work:

```
git fetch trac  # or just "git fetch" depending on your configuration
git checkout f61588ecabefc84103c4daa40e648b76e6e58828
```



---

Comment by jdemeyer created at 2015-06-09 09:25:06

There are actually many issues with the zero ideal...


---

Comment by git created at 2015-06-09 09:27:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-09 09:30:18

I hope you don't mind that I'm making this ticket much more general than you intended, but there is really not much point in fixing one specific method when maybe the whole approach needs to be changed.

I am now thinking about the following: introduce a new class `NumberFieldZeroIdeal` to represent the zero ideal. Then inherit both `NumberFieldZeroIdeal` and `NumberFieldFractionalIdeal` from `NumberFieldIdeal` (which shouldn't have much functionality).


---

Comment by jdemeyer created at 2015-06-09 09:31:09

Replying to [comment:8 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7be3884](http://git.sagemath.org/sage.git/commit/?id=7be38840da684f9110b4a295712a7eb212f94318)||`#18639: handle division for 0 ideal`||

Sorry, but this will conflict with #18622.


---

Comment by cremona created at 2015-06-09 09:32:07

I have done what was suggested.  Basically the __div__ function is moved from NumberFieldFractionalIdeal to NumberFieldIdeal with appropriate tests.  The test from the original patch are included too, to show that the porioginal issue is resolved.  I based this on my original branch but also tested it based on #18622.

I'm sure you will find something I did not do right and/or want to do more (I just saw your comment).  Feel free to take this over from me 100% as I have other things to do today.


---

Comment by jdemeyer created at 2015-06-09 09:34:55

Replying to [comment:11 cremona]:
> but also tested it based on #18622.
Are you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.

> Feel free to take this over from me 100% as I have other things to do today.
Me too :-)

What do you think about the approach I propose in [comment:9]?


---

Comment by cremona created at 2015-06-09 09:45:16

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 cremona]:
> > but also tested it based on #18622.
> Are you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.
> 
> > Feel free to take this over from me 100% as I have other things to do today.
> Me too :-)

I am sure you do!  I am in the middle of implementing Kraus's condictoins and global minimal (or almost global minimal) models for elliptic curves over number fields of class number 1, which no-one has ever done before.  Nearly finished...

> 
> What do you think about the approach I propose in [comment:9]?

Good idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)


---

Comment by jdemeyer created at 2015-06-09 09:49:26

Replying to [comment:13 cremona]:
> Good idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)

I know. The problem is that currently there is really no way to write special code for just the zero ideal. I also think that `NumberFieldZeroIdeal` is more explicit about its intentions, which is a good thing.


---

Comment by git created at 2021-02-02 16:49:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2021-02-02 16:50:24

Although this has become inactive, I thought it worth at least merging in the current develop branch and resolving conflicts (there were very few).
