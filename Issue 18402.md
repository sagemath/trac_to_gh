# Issue 18402: I.divides(0) crashes for I a fractional ideal

archive/issues_018402.json:
```json
{
    "body": "CC:  @mmasdeu\n\n\n```\nsage: K.<a> = NumberField(x^2-10)\nsage: a.divides(K(10))\nTrue\nsage: a.divides(K(0))                                                                          \nTrue\nsage: I = K.ideal(a)\nsage: I.divides(K(10))                                                                         \nTrue\nsage: I.divides(K(0))                                                                          \n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-18-bfc74602576b> in <module>()\n----> 1 I.divides(K(Integer(0)))\n\n/home/jec/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.pyc in divides(self, other)\n   1753         if not isinstance(other, NumberFieldIdeal):\n   1754             other = self.number_field().ideal(other)\n-> 1755         return (other / self).is_integral()\n   1756 \n   1757     def factor(self):\n\nTypeError: unsupported operand type(s) for /: 'NumberFieldIdeal' and 'NumberFieldFractionalIdeal'\n```\n\nThis is failing because the divides method does this:\n\n```\n       if not isinstance(other, NumberFieldIdeal):\n            other = self.number_field().ideal(other)\n        return (other / self).is_integral()\n```\n\nand the / operator does not like having the left operand the zero ideal (which is not a fractional ideal).  Similarly, I.divides(K.ideal(0)) fails.\n\nThe simple fix is to check whether other.is_zero() first.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18639\n\n",
    "created_at": "2015-06-08T19:38:26Z",
    "labels": [
        "number fields",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "I.divides(0) crashes for I a fractional ideal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18402",
    "user": "@JohnCremona"
}
```
CC:  @mmasdeu


```
sage: K.<a> = NumberField(x^2-10)
sage: a.divides(K(10))
True
sage: a.divides(K(0))                                                                          
True
sage: I = K.ideal(a)
sage: I.divides(K(10))                                                                         
True
sage: I.divides(K(0))                                                                          
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-18-bfc74602576b> in <module>()
----> 1 I.divides(K(Integer(0)))

/home/jec/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.pyc in divides(self, other)
   1753         if not isinstance(other, NumberFieldIdeal):
   1754             other = self.number_field().ideal(other)
-> 1755         return (other / self).is_integral()
   1756 
   1757     def factor(self):

TypeError: unsupported operand type(s) for /: 'NumberFieldIdeal' and 'NumberFieldFractionalIdeal'
```

This is failing because the divides method does this:

```
       if not isinstance(other, NumberFieldIdeal):
            other = self.number_field().ideal(other)
        return (other / self).is_integral()
```

and the / operator does not like having the left operand the zero ideal (which is not a fractional ideal).  Similarly, I.divides(K.ideal(0)) fails.

The simple fix is to check whether other.is_zero() first.

Issue created by migration from https://trac.sagemath.org/ticket/18639





---

archive/issue_comments_249926.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-08T19:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249926",
    "user": "@JohnCremona"
}
```

New commits:



---

archive/issue_comments_249927.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-08T19:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249927",
    "user": "@JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249928.json:
```json
{
    "body": "Wouldn't the proper fix to just allow `(0) / I = (0)` for a fractional ideal `I`? Can you check if #18622 does that?",
    "created_at": "2015-06-08T21:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249928",
    "user": "@jdemeyer"
}
```

Wouldn't the proper fix to just allow `(0) / I = (0)` for a fractional ideal `I`? Can you check if #18622 does that?



---

archive/issue_comments_249929.json:
```json
{
    "body": "OK, I will check that.  Certainly the 0 ideal passes the is_integral() test, and that should be done anyway, as it is already p ossible to multiply the 0 idal with a nonzero (fractional) one.",
    "created_at": "2015-06-08T21:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249929",
    "user": "@JohnCremona"
}
```

OK, I will check that.  Certainly the 0 ideal passes the is_integral() test, and that should be done anyway, as it is already p ossible to multiply the 0 idal with a nonzero (fractional) one.



---

archive/issue_comments_249930.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-09T06:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249930",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_249931.json:
```json
{
    "body": "It's worse with #18622: it gives a segmentation fault.\n\nIn any case, I still think that allowing `(0)/I` is the proper fix here, so I'm boldly changing the ticket to do that.",
    "created_at": "2015-06-09T06:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249931",
    "user": "@jdemeyer"
}
```

It's worse with #18622: it gives a segmentation fault.

In any case, I still think that allowing `(0)/I` is the proper fix here, so I'm boldly changing the ticket to do that.



---

archive/issue_comments_249932.json:
```json
{
    "body": "I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.",
    "created_at": "2015-06-09T08:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249932",
    "user": "@JohnCremona"
}
```

I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.



---

archive/issue_comments_249933.json:
```json
{
    "body": "Replying to [comment:5 cremona]:\n> I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.\nYou can always use the commit hash, that should always work:\n\n```\ngit fetch trac  # or just \"git fetch\" depending on your configuration\ngit checkout f61588ecabefc84103c4daa40e648b76e6e58828\n```\n",
    "created_at": "2015-06-09T09:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249933",
    "user": "@jdemeyer"
}
```

Replying to [comment:5 cremona]:
> I see that #18622 has been merged but is not in the current beta, so the branch name has disappeared from that ticket, so I am hoping that schecking out rremote branch trac/u/jdemeyer/ticket/18611 is the right thing to do.
You can always use the commit hash, that should always work:

```
git fetch trac  # or just "git fetch" depending on your configuration
git checkout f61588ecabefc84103c4daa40e648b76e6e58828
```




---

archive/issue_comments_249934.json:
```json
{
    "body": "There are actually many issues with the zero ideal...",
    "created_at": "2015-06-09T09:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249934",
    "user": "@jdemeyer"
}
```

There are actually many issues with the zero ideal...



---

archive/issue_comments_249935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T09:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249936.json:
```json
{
    "body": "I hope you don't mind that I'm making this ticket much more general than you intended, but there is really not much point in fixing one specific method when maybe the whole approach needs to be changed.\n\nI am now thinking about the following: introduce a new class `NumberFieldZeroIdeal` to represent the zero ideal. Then inherit both `NumberFieldZeroIdeal` and `NumberFieldFractionalIdeal` from `NumberFieldIdeal` (which shouldn't have much functionality).",
    "created_at": "2015-06-09T09:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249936",
    "user": "@jdemeyer"
}
```

I hope you don't mind that I'm making this ticket much more general than you intended, but there is really not much point in fixing one specific method when maybe the whole approach needs to be changed.

I am now thinking about the following: introduce a new class `NumberFieldZeroIdeal` to represent the zero ideal. Then inherit both `NumberFieldZeroIdeal` and `NumberFieldFractionalIdeal` from `NumberFieldIdeal` (which shouldn't have much functionality).



---

archive/issue_comments_249937.json:
```json
{
    "body": "Replying to [comment:8 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[7be3884](http://git.sagemath.org/sage.git/commit/?id=7be38840da684f9110b4a295712a7eb212f94318)||`#18639: handle division for 0 ideal`||\n\nSorry, but this will conflict with #18622.",
    "created_at": "2015-06-09T09:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249937",
    "user": "@jdemeyer"
}
```

Replying to [comment:8 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7be3884](http://git.sagemath.org/sage.git/commit/?id=7be38840da684f9110b4a295712a7eb212f94318)||`#18639: handle division for 0 ideal`||

Sorry, but this will conflict with #18622.



---

archive/issue_comments_249938.json:
```json
{
    "body": "I have done what was suggested.  Basically the __div__ function is moved from NumberFieldFractionalIdeal to NumberFieldIdeal with appropriate tests.  The test from the original patch are included too, to show that the porioginal issue is resolved.  I based this on my original branch but also tested it based on #18622.\n\nI'm sure you will find something I did not do right and/or want to do more (I just saw your comment).  Feel free to take this over from me 100% as I have other things to do today.",
    "created_at": "2015-06-09T09:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249938",
    "user": "@JohnCremona"
}
```

I have done what was suggested.  Basically the __div__ function is moved from NumberFieldFractionalIdeal to NumberFieldIdeal with appropriate tests.  The test from the original patch are included too, to show that the porioginal issue is resolved.  I based this on my original branch but also tested it based on #18622.

I'm sure you will find something I did not do right and/or want to do more (I just saw your comment).  Feel free to take this over from me 100% as I have other things to do today.



---

archive/issue_comments_249939.json:
```json
{
    "body": "Replying to [comment:11 cremona]:\n> but also tested it based on #18622.\nAre you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.\n\n> Feel free to take this over from me 100% as I have other things to do today.\nMe too :-)\n\nWhat do you think about the approach I propose in [comment:9]?",
    "created_at": "2015-06-09T09:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249939",
    "user": "@jdemeyer"
}
```

Replying to [comment:11 cremona]:
> but also tested it based on #18622.
Are you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.

> Feel free to take this over from me 100% as I have other things to do today.
Me too :-)

What do you think about the approach I propose in [comment:9]?



---

archive/issue_comments_249940.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 cremona]:\n> > but also tested it based on #18622.\n> Are you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.\n> \n> > Feel free to take this over from me 100% as I have other things to do today.\n> Me too :-)\n\nI am sure you do!  I am in the middle of implementing Kraus's condictoins and global minimal (or almost global minimal) models for elliptic curves over number fields of class number 1, which no-one has ever done before.  Nearly finished...\n\n> \n> What do you think about the approach I propose in [comment:9]?\n\nGood idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)",
    "created_at": "2015-06-09T09:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249940",
    "user": "@JohnCremona"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 cremona]:
> > but also tested it based on #18622.
> Are you sure? I ask because #18622 actually changes `__div__` to `_div_` so I find it hard to believe that you didn't get a conflict.
> 
> > Feel free to take this over from me 100% as I have other things to do today.
> Me too :-)

I am sure you do!  I am in the middle of implementing Kraus's condictoins and global minimal (or almost global minimal) models for elliptic curves over number fields of class number 1, which no-one has ever done before.  Nearly finished...

> 
> What do you think about the approach I propose in [comment:9]?

Good idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)



---

archive/issue_comments_249941.json:
```json
{
    "body": "Replying to [comment:13 cremona]:\n> Good idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)\n\nI know. The problem is that currently there is really no way to write special code for just the zero ideal. I also think that `NumberFieldZeroIdeal` is more explicit about its intentions, which is a good thing.",
    "created_at": "2015-06-09T09:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249941",
    "user": "@jdemeyer"
}
```

Replying to [comment:13 cremona]:
> Good idea.  I think WIlliam and I considered this way back (see line 10 of the file in question -- it was in fact 28 Jan 2008, almost my first ever Sage development session, and took place in a hotel room in New Jersey where he and I had nothing else to do all day...)

I know. The problem is that currently there is really no way to write special code for just the zero ideal. I also think that `NumberFieldZeroIdeal` is more explicit about its intentions, which is a good thing.



---

archive/issue_comments_249942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-02T16:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249942",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249943.json:
```json
{
    "body": "Although this has become inactive, I thought it worth at least merging in the current develop branch and resolving conflicts (there were very few).",
    "created_at": "2021-02-02T16:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18402#issuecomment-249943",
    "user": "@JohnCremona"
}
```

Although this has become inactive, I thought it worth at least merging in the current develop branch and resolving conflicts (there were very few).
