# Issue 20015: Allow sage-uncompress-spkg to work with Python 2.6

Issue created by migration from https://trac.sagemath.org/ticket/20252

Original creator: jhpalmieri

Original creation time: 2016-03-22 23:14:30

`sage-uncompress-spkg` uses "context management protocol" syntax, i.e., `with tarfile.open(...) as blah ...`. This requires Python 2.7, so let's change it to work with Python 2.6.


---

Comment by git created at 2016-03-22 23:20:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2016-03-22 23:21:18

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2016-03-22 23:24:06

I tested this on OS X with the following change:

```diff
diff --git a/build/bin/sage-uncompress-spkg b/build/bin/sage-uncompress-spkg
index 81bc1db..ca20543 100755
--- a/build/bin/sage-uncompress-spkg
+++ b/build/bin/sage-uncompress-spkg
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python2.6
 
 # USAGE:
 #
```

On my computer:

```
$ python2.6 --version
Python 2.6.9
```



---

Comment by dimpase created at 2016-03-23 07:46:40

are you catching file opening errors now?  that was done by with, now you ought to use try/catch, IMHO.


---

Comment by jdemeyer created at 2016-03-23 09:27:48

Replying to [comment:5 dimpase]:
> are you catching file opening errors now?  that was done by with, now you ought to use try/catch, IMHO.

`with` doesn't catch exceptions: exceptions in `__enter__` are just raised as usual.


---

Comment by jhpalmieri created at 2016-03-23 15:35:40

This script is written with the assumption that it doesn't get run on its own but instead via `sage-spkg`. Any errors in this script will result in an error message from `sage-spkg`. So while we could add more error-checking, I don't think it's really necessary.


---

Comment by dimpase created at 2016-03-23 16:25:05

Strangely, `with` already appears in python 2.5 as a feature, and it is always on in 2.6. 
https://docs.python.org/2/reference/compound_stmts.html#the-with-statement

Are sure you are fixing the right bug (that is to say, did you reproduce this on your python 2.6?)


---

Comment by jhpalmieri created at 2016-03-23 16:37:33

I reproduced the bug with Python 2.6, and this change fixed it for me. `with` is already there in earlier versions, but the use of `with` with `TarFile` objects was added in Python 2.7. According to the [docs for the `tarfile` module](https://docs.python.org/2/library/tarfile.html): "New in version 2.7: Added support for the context management protocol." The same goes for the `zipfile` module.


---

Comment by dimpase created at 2016-03-23 16:46:09

OK, OK, sorry for noise then. Looks good.


---

Comment by dimpase created at 2016-03-23 16:46:09

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2016-03-23 16:52:27

You still made the good point that Python 2.6 is not supported anymore, so should we even bother with this? But I guess it doesn't hurt.


---

Comment by vbraun created at 2016-03-26 11:31:01

Resolution: fixed
