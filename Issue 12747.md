# Issue 12747: Typo in Parent.discover_action

Issue created by migration from https://trac.sagemath.org/ticket/12919

Original creator: nthiery

Original creation time: 2012-05-07 16:44:11

Assignee: robertwb

CC:  sage-combinat mguaypaq

This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.

If someone wants to play further, here is the kind of thing I tried:

```
class P(Parent):
    def __init__(self):
        Parent.__init__(self, category=Sets())
    Element=ElementWrapper
A = P(); a = A("a")
B = P(); b = A("b")
C = P(); c = A("c")
D = P(); d = A("d")
Hom(A,B)(lambda x: b).register_as_coercion()
Hom(B,C)(lambda x: c).register_as_coercion()
Hom(C,D)(lambda x: d).register_as_coercion()
Hom(D,A)(lambda x: a).register_as_coercion()
```


But I guess it could go as is


---

Comment by nthiery created at 2012-05-07 18:00:19

Changing status from new to needs_review.


---

Comment by nthiery created at 2012-05-07 18:00:19

Changing keywords from "" to "days38".


---

Comment by aapitzsch created at 2012-05-07 21:59:44

Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.


---

Comment by aapitzsch created at 2012-05-07 21:59:44

Changing status from needs_review to needs_work.


---

Comment by nthiery created at 2012-05-07 23:33:45

Replying to [comment:3 aapitzsch]:
> Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.

Good catch, thanks :-)


---

Comment by nthiery created at 2012-05-07 23:36:38

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2012-05-08 07:08:16

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2012-05-08 13:05:52

Thanks!


---

Comment by mguaypaq created at 2012-05-15 17:21:09

Here is a minimal example which illustrates the problem:


```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

/home/mguaypaq/<ipython console> in <module>()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7906)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.convert_map_from (sage/structure/parent.c:15248)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_convert_map_from (sage/structure/parent.c:15399)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14958)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14966)()

UnboundLocalError: local variable 'connecting' referenced before assignment
```

With the patch, the output is now (as it should be):


```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
'a'
```

This could be added as a doctest to detect the problem, but maybe it's not necessary for such a clear typo. I would also note that [this comment](http://trac.sagemath.org/sage_trac/ticket/7420#comment:3) from #7420 points out a cleaner way to fix the problem, but this patch is fine too.


---

Comment by nthiery created at 2012-05-17 04:09:08

Changing status from positive_review to needs_work.


---

Comment by nthiery created at 2012-05-17 04:09:08

Excellent, thanks for the doctest! I confirm it catches the issue on my machine. I'll upload shortly an updated patch, and set the ticket back to needs review. Please double check, and set back to positive review.


---

Attachment


---

Comment by nthiery created at 2012-05-17 04:09:46

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2012-05-17 09:48:38

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2012-05-19 04:50:59

Replying to [comment:13 aapitzsch]:
> positive review

Thanks!


---

Comment by jdemeyer created at 2012-05-23 21:37:02

Resolution: fixed


---

Comment by kini created at 2012-05-26 17:51:59

It seems #12990 is a duplicate of this. Should we keep the doctest on the patch at #12990, and add it to the doctest you guys added? Or just scrap that ticket?
