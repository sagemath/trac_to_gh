# Issue 12747: Typo in Parent.discover_action

archive/issues_012747.json:
```json
{
    "body": "Assignee: @robertwb\n\nCC:  sage-combinat @mguaypaq\n\nThis patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.\n\nIf someone wants to play further, here is the kind of thing I tried:\n\n```\nclass P(Parent):\n    def __init__(self):\n        Parent.__init__(self, category=Sets())\n    Element=ElementWrapper\nA = P(); a = A(\"a\")\nB = P(); b = A(\"b\")\nC = P(); c = A(\"c\")\nD = P(); d = A(\"d\")\nHom(A,B)(lambda x: b).register_as_coercion()\nHom(B,C)(lambda x: c).register_as_coercion()\nHom(C,D)(lambda x: d).register_as_coercion()\nHom(D,A)(lambda x: a).register_as_coercion()\n```\n\nBut I guess it could go as is\n\nIssue created by migration from https://trac.sagemath.org/ticket/12919\n\n",
    "created_at": "2012-05-07T16:44:11Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Typo in Parent.discover_action",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12747",
    "user": "https://github.com/nthiery"
}
```
Assignee: @robertwb

CC:  sage-combinat @mguaypaq

This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.

If someone wants to play further, here is the kind of thing I tried:

```
class P(Parent):
    def __init__(self):
        Parent.__init__(self, category=Sets())
    Element=ElementWrapper
A = P(); a = A("a")
B = P(); b = A("b")
C = P(); c = A("c")
D = P(); d = A("d")
Hom(A,B)(lambda x: b).register_as_coercion()
Hom(B,C)(lambda x: c).register_as_coercion()
Hom(C,D)(lambda x: d).register_as_coercion()
Hom(D,A)(lambda x: a).register_as_coercion()
```

But I guess it could go as is

Issue created by migration from https://trac.sagemath.org/ticket/12919





---

archive/issue_comments_152524.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-07T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152524",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152525.json:
```json
{
    "body": "Changing keywords from \"\" to \"days38\".",
    "created_at": "2012-05-07T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152525",
    "user": "https://github.com/nthiery"
}
```

Changing keywords from "" to "days38".



---

archive/issue_comments_152526.json:
```json
{
    "body": "Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152526",
    "user": "https://github.com/a-andre"
}
```

Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.



---

archive/issue_comments_152527.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152527",
    "user": "https://github.com/a-andre"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_152528.json:
```json
{
    "body": "Replying to [comment:3 aapitzsch]:\n> Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.\n\n\nGood catch, thanks :-)",
    "created_at": "2012-05-07T23:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152528",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:3 aapitzsch]:
> Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.


Good catch, thanks :-)



---

archive/issue_comments_152529.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-07T23:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152529",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_152530.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-08T07:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152530",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152531.json:
```json
{
    "body": "Thanks!",
    "created_at": "2012-05-08T13:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152531",
    "user": "https://github.com/nthiery"
}
```

Thanks!



---

archive/issue_comments_152532.json:
```json
{
    "body": "Here is a minimal example which illustrates the problem:\n\n```\nsage: class P(Parent):\n....:\u00a0\u00a0\u00a0\u00a0 def __init__(self):\n....:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Parent.__init__(self, category=Sets())\n....:\u00a0\u00a0\u00a0\u00a0 Element=ElementWrapper\n....:\u00a0\u00a0\u00a0\u00a0 \nsage: A = P(); a = A('a')\nsage: B = P(); b = B('b')\nsage: C = P(); c = C('c')\nsage: D = P(); d = D('d')\nsage: Hom(A, B)(lambda x: b).register_as_coercion()\nsage: Hom(B, A)(lambda x: a).register_as_coercion()\nsage: Hom(C, B)(lambda x: b).register_as_coercion()\nsage: Hom(D, C)(lambda x: c).register_as_coercion()\nsage: A(d)\n---------------------------------------------------------------------------\nUnboundLocalError\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Traceback (most recent call last)\n\n/home/mguaypaq/<ipython console> in <module>()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7906)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.convert_map_from (sage/structure/parent.c:15248)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_convert_map_from (sage/structure/parent.c:15399)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14958)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14966)()\n\nUnboundLocalError: local variable 'connecting' referenced before assignment\n```\nWith the patch, the output is now (as it should be):\n\n```\nsage: class P(Parent):\n....:     def __init__(self):\n....:         Parent.__init__(self, category=Sets())\n....:     Element=ElementWrapper\n....:     \nsage: A = P(); a = A('a')\nsage: B = P(); b = B('b')\nsage: C = P(); c = C('c')\nsage: D = P(); d = D('d')\nsage: Hom(A, B)(lambda x: b).register_as_coercion()\nsage: Hom(B, A)(lambda x: a).register_as_coercion()\nsage: Hom(C, B)(lambda x: b).register_as_coercion()\nsage: Hom(D, C)(lambda x: c).register_as_coercion()\nsage: A(d)\n'a'\n```\nThis could be added as a doctest to detect the problem, but maybe it's not necessary for such a clear typo. I would also note that [this comment](http://trac.sagemath.org/sage_trac/ticket/7420#comment:3) from #7420 points out a cleaner way to fix the problem, but this patch is fine too.",
    "created_at": "2012-05-15T17:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152532",
    "user": "https://github.com/mguaypaq"
}
```

Here is a minimal example which illustrates the problem:

```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

/home/mguaypaq/<ipython console> in <module>()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7906)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.convert_map_from (sage/structure/parent.c:15248)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_convert_map_from (sage/structure/parent.c:15399)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14958)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14966)()

UnboundLocalError: local variable 'connecting' referenced before assignment
```
With the patch, the output is now (as it should be):

```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
'a'
```
This could be added as a doctest to detect the problem, but maybe it's not necessary for such a clear typo. I would also note that [this comment](http://trac.sagemath.org/sage_trac/ticket/7420#comment:3) from #7420 points out a cleaner way to fix the problem, but this patch is fine too.



---

archive/issue_comments_152533.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-17T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152533",
    "user": "https://github.com/nthiery"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_152534.json:
```json
{
    "body": "Excellent, thanks for the doctest! I confirm it catches the issue on my machine. I'll upload shortly an updated patch, and set the ticket back to needs review. Please double check, and set back to positive review.",
    "created_at": "2012-05-17T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152534",
    "user": "https://github.com/nthiery"
}
```

Excellent, thanks for the doctest! I confirm it catches the issue on my machine. I'll upload shortly an updated patch, and set the ticket back to needs review. Please double check, and set back to positive review.



---

archive/issue_comments_152535.json:
```json
{
    "body": "Attachment [trac_12919_coercion_typo_parent-nt.patch](tarball://root/attachments/some-uuid/ticket12919/trac_12919_coercion_typo_parent-nt.patch) by @nthiery created at 2012-05-17 04:09:33",
    "created_at": "2012-05-17T04:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152535",
    "user": "https://github.com/nthiery"
}
```

Attachment [trac_12919_coercion_typo_parent-nt.patch](tarball://root/attachments/some-uuid/ticket12919/trac_12919_coercion_typo_parent-nt.patch) by @nthiery created at 2012-05-17 04:09:33



---

archive/issue_comments_152536.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-17T04:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152536",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_152537.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-17T09:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152537",
    "user": "https://github.com/a-andre"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152538.json:
```json
{
    "body": "Replying to [comment:13 aapitzsch]:\n> positive review\n\n\nThanks!",
    "created_at": "2012-05-19T04:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152538",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:13 aapitzsch]:
> positive review


Thanks!



---

archive/issue_comments_152539.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-23T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152539",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_035303.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-23T21:37:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12747#event-35303"
}
```



---

archive/issue_comments_152540.json:
```json
{
    "body": "It seems #12990 is a duplicate of this. Should we keep the doctest on the patch at #12990, and add it to the doctest you guys added? Or just scrap that ticket?",
    "created_at": "2012-05-26T17:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12747#issuecomment-152540",
    "user": "https://github.com/kini"
}
```

It seems #12990 is a duplicate of this. Should we keep the doctest on the patch at #12990, and add it to the doctest you guys added? Or just scrap that ticket?
