# Issue 12243: Update doctesting framework

archive/issues_012243.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  kini ohanar jhpalmieri\n\nThere are several improvements that would be good to make, including but not limited to:\n\n1. Forking rather than starting up a new Sage each time.\n2. Customizeable comparison rather than mutating doctests into new doctests. \n3. Avoiding the use of writing out temporary files.\n4. Provide mechanisms for recording and comparing timings. \n5. Constant headaches caused by the difference in doctesting library vs. non-library files. \n\nhttp://code.google.com/p/sagemath-timer/\n\nIssue created by migration from https://trac.sagemath.org/ticket/12415\n\n",
    "created_at": "2012-02-02T18:41:26Z",
    "labels": [
        "doctest",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "Update doctesting framework",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12243",
    "user": "robertwb"
}
```
Assignee: mvngu

CC:  kini ohanar jhpalmieri

There are several improvements that would be good to make, including but not limited to:

1. Forking rather than starting up a new Sage each time.
2. Customizeable comparison rather than mutating doctests into new doctests. 
3. Avoiding the use of writing out temporary files.
4. Provide mechanisms for recording and comparing timings. 
5. Constant headaches caused by the difference in doctesting library vs. non-library files. 

http://code.google.com/p/sagemath-timer/

Issue created by migration from https://trac.sagemath.org/ticket/12415





---

archive/issue_comments_143088.json:
```json
{
    "body": "I'm working on this.  E-mail me if you want to collaborate.",
    "created_at": "2012-02-02T20:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143088",
    "user": "roed"
}
```

I'm working on this.  E-mail me if you want to collaborate.



---

archive/issue_comments_143089.json:
```json
{
    "body": "12415_2.patch seems to contain a lot of tempfile changes, could you split out the doctest changes into a separate patch (or are these affecting doctests?)",
    "created_at": "2012-05-29T04:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143089",
    "user": "robertwb"
}
```

12415_2.patch seems to contain a lot of tempfile changes, could you split out the doctest changes into a separate patch (or are these affecting doctests?)



---

archive/issue_comments_143090.json:
```json
{
    "body": "apparently even I forget my trac username is not what it should be",
    "created_at": "2012-06-06T23:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143090",
    "user": "ohanar"
}
```

apparently even I forget my trac username is not what it should be



---

archive/issue_comments_143091.json:
```json
{
    "body": "I've moved the patches dealing with temporary files to #13147.",
    "created_at": "2012-06-21T05:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143091",
    "user": "roed"
}
```

I've moved the patches dealing with temporary files to #13147.



---

archive/issue_comments_143092.json:
```json
{
    "body": "Ready for review!\n\nThere are still a few known issues:\n\n* valgrinding under sage -t doesn't work.  I haven't used valgrind much and don't know how to resolve this.\n* The fix at #13147 probably needs work: I'm getting a failure in `sage.rings.polynomial.multi_polynomial_libsingular` to do with garbage collection.  I'm working on it.\n* I'm in the process of updating the developer guide.\n\nBut I wanted to get some other people involved in reviewing.",
    "created_at": "2012-06-23T15:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143092",
    "user": "roed"
}
```

Ready for review!

There are still a few known issues:

* valgrinding under sage -t doesn't work.  I haven't used valgrind much and don't know how to resolve this.
* The fix at #13147 probably needs work: I'm getting a failure in `sage.rings.polynomial.multi_polynomial_libsingular` to do with garbage collection.  I'm working on it.
* I'm in the process of updating the developer guide.

But I wanted to get some other people involved in reviewing.



---

archive/issue_comments_143093.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-23T15:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143093",
    "user": "roed"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_143094.json:
```json
{
    "body": "This may be a silly question, but how do I use the new framework? Don't we need changes to the scripts repo, too?  (If I just run `sage -t FILES`, I don't see the various messages, like `Doctesting ...`, that should be printed by `run_doctests` are not printed, so `sage -t` is not yet using the new framework.)\n\nOne of the patches also didn't apply cleanly to 5.1.beta5:\n\n```\nhg qimport -P ~/Downloads/12415_stderr.patch \nadding 12415_stderr.patch to series file\napplying 12415_stderr.patch\npatching file sage/lfunctions/lcalc.py\nHunk #1 FAILED at 226\n1 out of 2 hunks FAILED -- saving rejects to file sage/lfunctions/lcalc.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh 12415_stderr.patch\n```\n",
    "created_at": "2012-06-24T20:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143094",
    "user": "jhpalmieri"
}
```

This may be a silly question, but how do I use the new framework? Don't we need changes to the scripts repo, too?  (If I just run `sage -t FILES`, I don't see the various messages, like `Doctesting ...`, that should be printed by `run_doctests` are not printed, so `sage -t` is not yet using the new framework.)

One of the patches also didn't apply cleanly to 5.1.beta5:

```
hg qimport -P ~/Downloads/12415_stderr.patch 
adding 12415_stderr.patch to series file
applying 12415_stderr.patch
patching file sage/lfunctions/lcalc.py
Hunk #1 FAILED at 226
1 out of 2 hunks FAILED -- saving rejects to file sage/lfunctions/lcalc.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 12415_stderr.patch
```




---

archive/issue_comments_143095.json:
```json
{
    "body": "Did you apply the new dependencies (#13145, #13146, #13147)?  There are some more patches to other repositories: I'll update the ticket description.",
    "created_at": "2012-06-24T21:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143095",
    "user": "roed"
}
```

Did you apply the new dependencies (#13145, #13146, #13147)?  There are some more patches to other repositories: I'll update the ticket description.



---

archive/issue_comments_143096.json:
```json
{
    "body": "The description is updated: let me know if you have any more problems.  I think you need to apply 12415_stderr_vs_51b5.patch instead of 12415_stderr.patch.",
    "created_at": "2012-06-24T21:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143096",
    "user": "roed"
}
```

The description is updated: let me know if you have any more problems.  I think you need to apply 12415_stderr_vs_51b5.patch instead of 12415_stderr.patch.



---

archive/issue_comments_143097.json:
```json
{
    "body": "Regarding [attachment:12415_spkg_bin_sage.patch], the file in question should be part of the root repo.",
    "created_at": "2012-06-24T23:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143097",
    "user": "jhpalmieri"
}
```

Regarding [attachment:12415_spkg_bin_sage.patch], the file in question should be part of the root repo.



---

archive/issue_comments_143098.json:
```json
{
    "body": "One regression: with the old set-up, running `sage -tp FILES` (with no argument for `tp`) would choose the number of threads automatically. With the new set-up, this command gives an error, because `FILES` is not an integer. Therefore I think that, for example, `make ptestlong` will fail. (The file sage-runtests says that the default value for nthreads is 1, but I don't think optparse is dealing with the missing argument properly here. Also, passing the argument 0 causes doctests to never happen: maybe it's using 0 threads instead of `minimum(8, cpu_count())`.",
    "created_at": "2012-06-25T02:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143098",
    "user": "jhpalmieri"
}
```

One regression: with the old set-up, running `sage -tp FILES` (with no argument for `tp`) would choose the number of threads automatically. With the new set-up, this command gives an error, because `FILES` is not an integer. Therefore I think that, for example, `make ptestlong` will fail. (The file sage-runtests says that the default value for nthreads is 1, but I don't think optparse is dealing with the missing argument properly here. Also, passing the argument 0 causes doctests to never happen: maybe it's using 0 threads instead of `minimum(8, cpu_count())`.



---

archive/issue_comments_143099.json:
```json
{
    "body": "I would suggest the following two changes: for the scripts repo:\n\n```diff\ndiff --git a/sage-runtests b/sage-runtests\n--- a/sage-runtests\n+++ b/sage-runtests\n@@ -5,7 +5,7 @@ import optparse, os, sys\n if __name__ == \"__main__\":\n     parser = optparse.OptionParser()\n \n-    parser.add_option(\"-p\", \"--nthreads\", type=int, default=1, metavar=\"N\", help=\"tests in parallel using N threads with 0 interpreted as minimum(8, cpu_count())\")\n+    parser.add_option(\"-p\", \"--nthreads\", type=\"string\", default=1, metavar=\"N\", help=\"tests in parallel using N threads with 0 interpreted as minimum(8, cpu_count())\")\n     parser.add_option(\"--serial\", action=\"store_true\", default=False, help=\"run tests in a single process in series\")\n     parser.add_option(\"--timeout\", type=int, default=-1, help=\"timeout (in seconds) for doctesting one file\")\n     parser.add_option(\"-a\", \"--all\", action=\"store_true\", default=False, help=\"test all files in the Sage library\")\n@@ -49,7 +49,20 @@ if __name__ == \"__main__\":\n     parser.add_option(\"--stats_path\", \"--stats-path\", default=os.path.join(os.path.expanduser(\"~/.sage/timings2.json\")), \\\n                           help=\"path to a json dictionary for the latest run storing a timing for each file\")\n \n+    options, args = parser.parse_args()\n+    try:\n+        options.nthreads = int(options.nthreads)\n+    except ValueError:\n+        args.insert(0, options.nthreads.strip())\n+        options.nthreads = 0\n+\n+    if options.nthreads == 0:\n+        try:\n+            options.nthreads = int(os.environ['SAGE_NUM_THREADS_PARALLEL'])\n+        except KeyError:\n+            options.nthreads = 1\n+\n     from sage.doctest.control import DocTestController\n-    DC = DocTestController(*parser.parse_args())\n+    DC = DocTestController(options, args)\n     err = DC.run()\n     sys.exit(err)\n```\n\nand for the Sage library:\n\n```diff\ndiff --git a/sage/doctest/control.py b/sage/doctest/control.py\n--- a/sage/doctest/control.py\n+++ b/sage/doctest/control.py\n@@ -433,8 +433,9 @@ class DocTestController(SageObject):\n             else:\n                 nother += 1\n         if nfiles + ndbsources + nother:\n-            self.log(\"Doctesting %s.\"%(\", \".join(([\"%s file%s\"%(nfiles, \"s\" if nfiles > 1 else \"\")] if nfiles else []) +\n-                                                 ([\"%s other sources\"%nother] if nother else []))))\n+            self.log(\"Doctesting %s\"%(\", \".join(([\"%s file%s\"%(nfiles, \"s\" if nfiles > 1 else \"\")] if nfiles else []) +\n+                                                 ([\"%s other sources\"%nother] if nother else [])))\n+                + \" using %s threads.\"%self.options.nthreads if self.options.nthreads > 1 else \".\")\n             self.reporter = DocTestReporter(self)\n             self.dispatcher = DocTestDispatcher(self)\n             try:\n```\n\n\nOr something like that. I guess you should also print the number of threads when you print \"Doctesting entire Sage library.\", etc.",
    "created_at": "2012-06-25T02:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143099",
    "user": "jhpalmieri"
}
```

I would suggest the following two changes: for the scripts repo:

```diff
diff --git a/sage-runtests b/sage-runtests
--- a/sage-runtests
+++ b/sage-runtests
@@ -5,7 +5,7 @@ import optparse, os, sys
 if __name__ == "__main__":
     parser = optparse.OptionParser()
 
-    parser.add_option("-p", "--nthreads", type=int, default=1, metavar="N", help="tests in parallel using N threads with 0 interpreted as minimum(8, cpu_count())")
+    parser.add_option("-p", "--nthreads", type="string", default=1, metavar="N", help="tests in parallel using N threads with 0 interpreted as minimum(8, cpu_count())")
     parser.add_option("--serial", action="store_true", default=False, help="run tests in a single process in series")
     parser.add_option("--timeout", type=int, default=-1, help="timeout (in seconds) for doctesting one file")
     parser.add_option("-a", "--all", action="store_true", default=False, help="test all files in the Sage library")
@@ -49,7 +49,20 @@ if __name__ == "__main__":
     parser.add_option("--stats_path", "--stats-path", default=os.path.join(os.path.expanduser("~/.sage/timings2.json")), \
                           help="path to a json dictionary for the latest run storing a timing for each file")
 
+    options, args = parser.parse_args()
+    try:
+        options.nthreads = int(options.nthreads)
+    except ValueError:
+        args.insert(0, options.nthreads.strip())
+        options.nthreads = 0
+
+    if options.nthreads == 0:
+        try:
+            options.nthreads = int(os.environ['SAGE_NUM_THREADS_PARALLEL'])
+        except KeyError:
+            options.nthreads = 1
+
     from sage.doctest.control import DocTestController
-    DC = DocTestController(*parser.parse_args())
+    DC = DocTestController(options, args)
     err = DC.run()
     sys.exit(err)
```

and for the Sage library:

```diff
diff --git a/sage/doctest/control.py b/sage/doctest/control.py
--- a/sage/doctest/control.py
+++ b/sage/doctest/control.py
@@ -433,8 +433,9 @@ class DocTestController(SageObject):
             else:
                 nother += 1
         if nfiles + ndbsources + nother:
-            self.log("Doctesting %s."%(", ".join((["%s file%s"%(nfiles, "s" if nfiles > 1 else "")] if nfiles else []) +
-                                                 (["%s other sources"%nother] if nother else []))))
+            self.log("Doctesting %s"%(", ".join((["%s file%s"%(nfiles, "s" if nfiles > 1 else "")] if nfiles else []) +
+                                                 (["%s other sources"%nother] if nother else [])))
+                + " using %s threads."%self.options.nthreads if self.options.nthreads > 1 else ".")
             self.reporter = DocTestReporter(self)
             self.dispatcher = DocTestDispatcher(self)
             try:
```


Or something like that. I guess you should also print the number of threads when you print "Doctesting entire Sage library.", etc.



---

archive/issue_comments_143100.json:
```json
{
    "body": "I've updated the option parsing to allow -p to take no options (though I used a callback so that the -p doesn't have to be last).  I changed 12415_spkg_bin_sage.patch to be an actual patch against the root repository.  I also made a small change to the debug functionality (printing the doctest that failed before dropping into the debugger).\n\nSince I'm modifying four repositories, I'll just update the patches rather than creating lots of referee patches (unless the referee objects!).",
    "created_at": "2012-06-25T05:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143100",
    "user": "roed"
}
```

I've updated the option parsing to allow -p to take no options (though I used a callback so that the -p doesn't have to be last).  I changed 12415_spkg_bin_sage.patch to be an actual patch against the root repository.  I also made a small change to the debug functionality (printing the doctest that failed before dropping into the debugger).

Since I'm modifying four repositories, I'll just update the patches rather than creating lots of referee patches (unless the referee objects!).



---

archive/issue_comments_143101.json:
```json
{
    "body": "`sage/parallel/decorate.py`: Use\n\n```\nUnhandled SIG...\n```\n\n\n(on systems, this would give a SIGBUS: Bus Error instead)",
    "created_at": "2012-06-25T06:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143101",
    "user": "jdemeyer"
}
```

`sage/parallel/decorate.py`: Use

```
Unhandled SIG...
```


(on systems, this would give a SIGBUS: Bus Error instead)



---

archive/issue_comments_143102.json:
```json
{
    "body": "Please explain why you're adding `nodoctest` to some of the files in `doc/`?",
    "created_at": "2012-06-25T06:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143102",
    "user": "jdemeyer"
}
```

Please explain why you're adding `nodoctest` to some of the files in `doc/`?



---

archive/issue_comments_143103.json:
```json
{
    "body": "Are *all* the options in `sage-runtests` actually implemented? (it seems some of them are meant for #12720, these should not be added here)",
    "created_at": "2012-06-25T06:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143103",
    "user": "jdemeyer"
}
```

Are *all* the options in `sage-runtests` actually implemented? (it seems some of them are meant for #12720, these should not be added here)



---

archive/issue_comments_143104.json:
```json
{
    "body": "I guess you're no longer using the scripts `sage-test`, `sage-ptest`, `sage-doctest`, `sage-maketest`, perhaps `sage-test-new` and `sage-test-import`.  Remove these.",
    "created_at": "2012-06-25T06:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143104",
    "user": "jdemeyer"
}
```

I guess you're no longer using the scripts `sage-test`, `sage-ptest`, `sage-doctest`, `sage-maketest`, perhaps `sage-test-new` and `sage-test-import`.  Remove these.



---

archive/issue_comments_143105.json:
```json
{
    "body": "Why does the doctesting framework need to be imported from `sage.all`?",
    "created_at": "2012-06-25T07:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143105",
    "user": "jdemeyer"
}
```

Why does the doctesting framework need to be imported from `sage.all`?



---

archive/issue_comments_143106.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> Why does the doctesting framework need to be imported from `sage.all`?\nI don't think it needs to be, but it makes it easy to test (and debug) doctests from within Sage:\n\n```\nsage: run_doctests(sage.rings.integer)\n...\n```\n",
    "created_at": "2012-06-25T07:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143106",
    "user": "ohanar"
}
```

Replying to [comment:33 jdemeyer]:
> Why does the doctesting framework need to be imported from `sage.all`?
I don't think it needs to be, but it makes it easy to test (and debug) doctests from within Sage:

```
sage: run_doctests(sage.rings.integer)
...
```




---

archive/issue_comments_143107.json:
```json
{
    "body": "You have two instances of\n\n```\nexcept:\n```\n\nin the new code.\n\nThe one for `os.kill()` should just catch `OSError`, for the other one replace\n\n```\nexcept KeyboardInterrupt:\n    pass\nexcept:\n```\n\nby\n\n```\nexcept Exception:\n```\n",
    "created_at": "2012-06-25T09:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143107",
    "user": "jdemeyer"
}
```

You have two instances of

```
except:
```

in the new code.

The one for `os.kill()` should just catch `OSError`, for the other one replace

```
except KeyboardInterrupt:
    pass
except:
```

by

```
except Exception:
```




---

archive/issue_comments_143108.json:
```json
{
    "body": "Replace\n\n```\nimport multiprocessing \noptions.nthreads = os.getenv('SAGE_NUM_THREADS_PARALLEL',min(8, multiprocessing.cpu_count()))\n```\n\nby\n\n```\noptions.nthreads = int(os.getenv('SAGE_NUM_THREADS_PARALLEL', 1))\n```\n\n(don't reinvent the `sage-num-threads.py` wheel)",
    "created_at": "2012-06-25T09:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143108",
    "user": "jdemeyer"
}
```

Replace

```
import multiprocessing 
options.nthreads = os.getenv('SAGE_NUM_THREADS_PARALLEL',min(8, multiprocessing.cpu_count()))
```

by

```
options.nthreads = int(os.getenv('SAGE_NUM_THREADS_PARALLEL', 1))
```

(don't reinvent the `sage-num-threads.py` wheel)



---

archive/issue_comments_143109.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-25T09:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143109",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143110.json:
```json
{
    "body": "Planning to make a reviewer patch, so hang on...",
    "created_at": "2012-06-25T10:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143110",
    "user": "jdemeyer"
}
```

Planning to make a reviewer patch, so hang on...



---

archive/issue_comments_143111.json:
```json
{
    "body": "This actually fails on the very first thing I tried (after applying all patches and doing `sage -b`):\n\n```\njdemeyer@sage:/release/sage-5.1.beta5-doctest$ ./sage -t devel/sage/sage/rings/padics/\nargv ['/release/sage-5.1.beta5-doctest/local/bin/sage-runtests', 'devel/sage/sage/rings/padics/']\nTraceback (most recent call last):\n  File \"/release/sage-5.1.beta5-doctest/local/bin/sage-runtests\", line 68, in <module>\n    DC = DocTestController(*parser.parse_args())\n  File \"/release/sage-5.1.beta5-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 116, in __init__\n    if options.nthreads == 0:\nAttributeError: Values instance has no attribute 'nthreads'\n```\n\n\nAm I doing something wrong?",
    "created_at": "2012-06-25T11:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143111",
    "user": "jdemeyer"
}
```

This actually fails on the very first thing I tried (after applying all patches and doing `sage -b`):

```
jdemeyer@sage:/release/sage-5.1.beta5-doctest$ ./sage -t devel/sage/sage/rings/padics/
argv ['/release/sage-5.1.beta5-doctest/local/bin/sage-runtests', 'devel/sage/sage/rings/padics/']
Traceback (most recent call last):
  File "/release/sage-5.1.beta5-doctest/local/bin/sage-runtests", line 68, in <module>
    DC = DocTestController(*parser.parse_args())
  File "/release/sage-5.1.beta5-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py", line 116, in __init__
    if options.nthreads == 0:
AttributeError: Values instance has no attribute 'nthreads'
```


Am I doing something wrong?



---

archive/issue_comments_143112.json:
```json
{
    "body": "Building from scratch and doing `make ptest` gives:\n\n```\nargv ['/release/merger/sage-5.1.beta5-12415/local/bin/sage-runtests', '-p', '--sagenb', 'devel/sage/doc/common', 'devel/sage/doc/de', 'devel/sage/doc/en', 'devel/sage/doc/fr', 'devel/sage/doc/ru', 'devel/sage/doc/tr', 'devel/sage/sage']\nnext_arg: --sagenb\nRunning doctests with ID 2012-06-25-12-57-22-d71deecd.\nDoctesting the Sage notebook.\nDoctesting 2067 files using 6 threads\nUsage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)\n\nsage-runtests: error: no such option: -p\n**********************************************************************\nFile \"programming\", line 620, in programming\nFailed example:\n    for i in range(5):\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 572, in _run\n        compileflags, 1)\n      File \"<doctest programming[0]>\", line 1\n        for i in range(5):\n                         ^\n    SyntaxError: unexpected EOF while parsing\n**********************************************************************\n1 items had failures:\n   1 of 113 in programming\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"programming\", line 578, in programming\nFailed example:\n    for i in range(5):\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 572, in _run\n        compileflags, 1)\n      File \"<doctest programming[0]>\", line 1\n        for i in range(5):\n                         ^\n    SyntaxError: unexpected EOF while parsing\n**********************************************************************\n1 items had failures:\n   1 of 113 in programming\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"sage.misc.sh\", line 20, in sage.misc.sh.Sh.eval\nFailed example:\n    sh.eval('''echo \"Hello there\"\\nif [ $? -eq 0 ]; then\\necho \"good\"\\nfi''')\nExpected:\n    /...\n    ''\nGot:\n    Hello there\n    good\n    /release/merger/sage-5.1.beta5-12415\n    ''\n**********************************************************************\nFile \"interfaces\", line 331, in interfaces\nFailed example:\n    maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\ \n      '[plot_format, openmath]') # not tested\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 572, in _run\n        compileflags, 1)\n      File \"<doctest interfaces[0]>\", line 2\n        maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n                                                                         \n                                                 ^\n    SyntaxError: unexpected character after line continuation character\n**********************************************************************\n1 items had failures:\n   1 of  57 in interfaces\n***Test Failed*** 1 failures.\n**********************************************************************\n1 items had failures:\n   1 of   1 in sage.misc.sh.Sh.eval\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"sage.doctest.control\", line 246, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC = DocTestController(DD, [])\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 573, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 835, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[2]>\", line 1, in <module>\n        DC = DocTestController(DD, [])\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 127, in __init__\n        self.logfile = open(options.logfile, 'a')\n    IOError: [Errno 2] No such file or directory: '/release/merger/sage-5.1.beta5-12415/home/.sage//tmp/test.log'\n**********************************************************************\nFile \"sage.doctest.control\", line 247, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC.add_files()\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 573, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 835, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[3]>\", line 1, in <module>\n        DC.add_files()\n    NameError: name 'DC' is not defined\n**********************************************************************\nFile \"sage.doctest.control\", line 249, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    (os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage', 'sage'), True) in DC.files\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 573, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 835, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[4]>\", line 1, in <module>\n        (os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage', 'sage'), True) in DC.files\n    NameError: name 'DC' is not defined\n**********************************************************************\nFile \"sage.doctest.control\", line 418, in sage.doctest.control.DocTestController.run_doctests\nFailed example:\n    DC.run_doctests()\nExpected:\n    Doctesting 1 file.\n    sage -t .../sage/rings/homset.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\nGot:\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/homset.py\n        [15 tests, 0.3 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 0.8 seconds\n        cpu time: 0.1 seconds\n        cumulative wall time: 0.3 seconds\n**********************************************************************\nFile \"interfaces\", line 318, in interfaces\nFailed example:\n    maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\ \n      '[plot_format, openmath]') # not tested\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 572, in _run\n        compileflags, 1)\n      File \"<doctest interfaces[0]>\", line 2\n        maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n                                                                         \n                                                 ^\n    SyntaxError: unexpected character after line continuation character\n**********************************************************************\n1 items had failures:\n   1 of  57 in interfaces\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"sage.doctest.control\", line 479, in sage.doctest.control.DocTestController.cleanup\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Doctesting 1 file.\n    sage -t .../rings/infinity.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\n    0\nGot:\n    Running doctests with ID 2012-06-25-12-57-35-cf5e164b.\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py\n        [220 tests, 12.8 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 13.8 seconds\n        cpu time: 1.0 seconds\n        cumulative wall time: 12.8 seconds\n    0\n**********************************************************************\nFile \"sage.doctest.control\", line 619, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Doctesting 1 file.\n    sage -t .../sage/sets/non_negative_integers.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\n    0\nGot:\n    Running doctests with ID 2012-06-25-12-57-49-f475b4d8.\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/sets/non_negative_integers.py\n        [41 tests, 0.5 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 1.4 seconds\n        cpu time: 0.1 seconds\n        cumulative wall time: 0.5 seconds\n    0\n**********************************************************************\nFile \"sage.doctest.control\", line 660, in sage.doctest.control.run_doctests\nFailed example:\n    run_doctests(sage.rings.infinity)\nExpected:\n    Doctesting .../sage/rings/infinity.py\n    Running doctests with ID ...\n    Doctesting 1 file.\n    sage -t .../sage/rings/infinity.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\nGot:\n    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py\n    Running doctests with ID 2012-06-25-12-57-50-38f106c7.\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py\n        [220 tests, 20.3 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 22.3 seconds\n        cpu time: 1.0 seconds\n        cumulative wall time: 20.3 seconds\n**********************************************************************\n5 items had failures:\n   3 of  13 in sage.doctest.control.DocTestController.add_files\n   1 of  10 in sage.doctest.control.DocTestController.cleanup\n   1 of   6 in sage.doctest.control.DocTestController.run\n   1 of   7 in sage.doctest.control.DocTestController.run_doctests\n   1 of   1 in sage.doctest.control.run_doctests\n***Test Failed*** 7 failures.\n**********************************************************************\nFile \"sage.parallel.decorate\", line 559, in sage.parallel.decorate.fork\nFailed example:\n    g()\nExpected:\n    <BLANKLINE>\n    ------------------------------------------------------------------------\n    Unhandled SIGSEGV: A segmentation fault occurred in Sage.\n    This probably occurred because a *compiled* component of Sage has a bug\n    in it and is not properly wrapped with sig_on(), sig_off(). You might\n    want to run Sage under gdb with 'sage -gdb' to debug this.\n    Sage will now terminate.\n    ------------------------------------------------------------------------\n    'NO DATA'\nGot:\n    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(print_backtrace+0x2b)[0x2b39ebbaf66e]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(sigdie+0x14)[0x2b39ebbaf69b]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(sage_signal_handler+0x20b)[0x2b39ebbaf189]\n    /lib/libpthread.so.0[0x2b39e86417d0]\n    /lib/libc.so.6(strlen+0x30)[0x2b39e8f532f0]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyString_FromString+0x1b)[0x2b39e82e486b]\n    /release/merger/sage-5.1.beta5-12415/home/.sage//temp/sage.math.washington.edu/28931//spyx//_release_merger_sage_5_1_beta5_12415_home__sage_temp_sage_math_washington_edu_28931_tmp_0_spyx/_release_merger_sage_5_1_beta5_12415_home__sage_temp_sage_math_washington_edu_28931_tmp_0_spyx_0.so[0x2aaaaaab0abd]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5a63)[0x2b39e833b2a3]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x37bf)[0x2b39e8338fff]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82b6b09]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c952d]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c9acb]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b39e833d432]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x714e)[0x2b39e833c98e]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f563a]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x37bf)[0x2b39e8338fff]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f523c]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f523c]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b39e833d432]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xc1)[0x2b39e83611b1]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x1f9)[0x2b39e8361489]\n    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(Py_Main+0xb15)[0x2b39e8373e65]\n    /lib/libc.so.6(__libc_start_main+0xf4)[0x2b39e8ef61f4]\n    python[0x400679]\n    <BLANKLINE>\n    ------------------------------------------------------------------------\n    Unhandled SIGSEGV: A segmentation fault occurred in Sage.\n    This probably occurred because a *compiled* component of Sage has a bug\n    in it and is not properly wrapped with sig_on(), sig_off(). You might\n    want to run Sage under gdb with 'sage -gdb' to debug this.\n    Sage will now terminate.\n    ------------------------------------------------------------------------\n    'NO DATA'\n**********************************************************************\n1 items had failures:\n   1 of  17 in sage.parallel.decorate.fork\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"sage.tests.startup\", line 6, in sage.tests.startup\nFailed example:\n    if os.uname()[1] == 'sage.math.washington.edu':\n        print float(os.popen(\"sage -startuptime>/dev/null; sage -startuptime|grep sage.all\").readlines()[0].split()[1]) < 2.0\n    else: print True   # nothing when not on sage.math\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"sage.rings.polynomial.multi_polynomial_libsingular\", line 420, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__copy__\nFailed example:\n    len(ring_refcount_dict) == n   \nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"sage.rings.polynomial.plural\", line 2738, in sage.rings.polynomial.plural.new_NRing\nFailed example:\n    z*x\nExpected:\n    x*z\nGot:\n    Exception KeyError: (The ring pointer 0x2b3a04886e90,) in 'sage.libs.singular.ring.singular_ring_delete' ignored\n    x*z\n**********************************************************************\nFile \"sage.rings.polynomial.plural\", line 2856, in sage.rings.polynomial.plural.SCA\nFailed example:\n    E = SCA(QQ, ['x', 'y', 'z'], [0, 1], order = 'degrevlex')\nExpected nothing\nGot:\n    Exception KeyError: (The ring pointer 0x2b3a048af1a0,) in 'sage.libs.singular.ring.singular_ring_delete' ignored\n**********************************************************************\nFile \"sage.matrix.benchmark\", line 11, in sage.matrix.benchmark\nFailed example:\n    b.report([b.det_ZZ], 'Test', systems=['sage'])\nExpected:\n    ======================================================================\n              Test\n    ======================================================================\n    ...\n    ======================================================================\nGot:\n    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux\n    ======================================================================\n              Test\n    ======================================================================\n    <BLANKLINE>\n    <BLANKLINE>\n    ----------------------------------------------------------------------\n    Dense integer determinant over ZZ.\n        Given an n x n matrix A over ZZ with random entries\n        between min and max, inclusive, compute det(A).\n    <BLANKLINE>\n   **********************************************************************\n2 items had failures:\n   1 of   8 in sage.rings.polynomial.plural.SCA\n   1 of  17 in sage.rings.polynomial.plural.new_NRing\n***Test Failed*** 2 failures.\n     INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: ``200``)\n        - ``min`` - minimal value for entries of matrix (default: ``1``)\n        - ``max`` - maximal value for entries of matrix (default: ``100``)\n        - ``system`` - either 'sage' or 'magma' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.det_ZZ(200)\n            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma\n               sage\n              1.560\n    ======================================================================\n**********************************************************************\n1 items had failures:\n   1 of  16 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__copy__\n***Test Failed*** 1 failures.\n**********************************************************************\n1 items had failures:\n   1 of   2 in sage.tests.startup\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"sage.matrix.benchmark\", line 38, in sage.matrix.benchmark.report\nFailed example:\n    b.report([b.det_ZZ], 'Test', systems=['sage'])\nExpected:\n    ======================================================================\n              Test\n    ======================================================================\n    ...\n    ======================================================================\nGot:\n    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux\n    ======================================================================\n              Test\n    ======================================================================\n    <BLANKLINE>\n    <BLANKLINE>\n    ----------------------------------------------------------------------\n    Dense integer determinant over ZZ.\n        Given an n x n matrix A over ZZ with random entries\n        between min and max, inclusive, compute det(A).\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: ``200``)\n        - ``min`` - minimal value for entries of matrix (default: ``1``)\n        - ``max`` - maximal value for entries of matrix (default: ``100``)\n        - ``system`` - either 'sage' or 'magma' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.det_ZZ(200)\n            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma\n               sage\n              1.330\n    ======================================================================\n**********************************************************************\nFile \"sage.doctest.forker\", line 925, in sage.doctest.forker.SageDocTestRunner.report_unexpected_exception\nFailed example:\n    \"ArithmeticError\" in tb\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"sage.doctest.forker\", line 1185, in sage.doctest.forker.DocTestWorker.__init__\nFailed example:\n    run_doctests(sage.rings.big_oh) # indirect doctest\nExpected:\n    Doctesting .../sage/rings/big_oh.py\n    Running doctests with ID ...\n    Doctesting 1 file.\n    sage -t .../sage/rings/big_oh.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\nGot:\n    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/big_oh.py\n    Running doctests with ID 2012-06-25-12-59-29-e5a039b5.\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/big_oh.py\n        [17 tests, 1.4 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 1.9 seconds\n        cpu time: 0.4 seconds\n        cumulative wall time: 1.4 seconds\n**********************************************************************\nFile \"sage.doctest.forker\", line 1211, in sage.doctest.forker.DocTestWorker.run\nFailed example:\n    run_doctests(sage.symbolic.units) # indirect doctest\nExpected:\n    Doctesting .../sage/symbolic/units.py\n    Running doctests with ID ...\n    Doctesting 1 file.\n    sage -t .../sage/symbolic/units.py\n        [... tests, ... s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\nGot:\n    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/symbolic/units.py\n    Running doctests with ID 2012-06-25-12-59-31-e804e534.\n    .\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/symbolic/units.py\n        [82 tests, 0.4 s]\n    ------------------------------------------------------------------------\n    All tests passed!\n    ------------------------------------------------------------------------\n    Total time for all tests: 0.7 seconds\n        cpu time: 0.2 seconds\n        cumulative wall time: 0.4 seconds\n**********************************************************************\n3 items had failures:\n   1 of   1 in sage.doctest.forker.DocTestWorker.__init__\n   1 of   1 in sage.doctest.forker.DocTestWorker.run\n   1 of  18 in sage.doctest.forker.SageDocTestRunner.report_unexpected_exception\n***Test Failed*** 3 failures.\n**********************************************************************\nFile \"sage.tests.cmdline\", line 270, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    1\n**********************************************************************\nFile \"sage.tests.cmdline\", line 272, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"All tests passed!\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"sage.tests.cmdline\", line 275, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    1\n**********************************************************************\nFile \"sage.tests.cmdline\", line 277, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"All tests passed!\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"sage.tests.cmdline\", line 291, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    128\nGot:\n    1\n**********************************************************************\nFile \"sage.tests.cmdline\", line 293, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"1 items had failures:\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   6 of 183 in sage.tests.cmdline.test_executable\n***Test Failed*** 6 failures.\n**********************************************************************\nFile \"sage.matrix.benchmark\", line 566, in sage.matrix.benchmark.report_GF\nFailed example:\n    b.report_GF(systems=['sage'])\nExpected:\n    ======================================================================\n    Dense benchmarks over GF with prime 16411\n    ======================================================================\n    ...\n    ======================================================================\nGot:\n    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux\n    ======================================================================\n              Dense benchmarks over GF with prime 16411\n    ======================================================================\n    <BLANKLINE>\n    <BLANKLINE>\n    ----------------------------------------------------------------------\n    Rank over GF(p):\n        Given a n x (n+10) matrix over GF(p) with random entries, compute the rank.\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 300)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.rank_GF(1000)\n            sage: tm = b.rank_GF(1000, system='magma')  # optional - magma\n               sage\n              0.160\n    ----------------------------------------------------------------------\n    Rank over GF(p): Given a (n + 10) x n matrix over GF(p) with\n        random entries, compute the rank.\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 300)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.rank2_GF(500)\n            sage: tm = b.rank2_GF(500, system='magma')  # optional - magma\n               sage\n              0.170\n    ----------------------------------------------------------------------\n    Given a n+1 x n  matrix over GF(p) with random\n        entries, compute the nullspace.\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 300)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.nullspace_GF(300)\n            sage: tm = b.nullspace_GF(300, system='magma')  # optional - magma\n               sage\n              0.820\n    ----------------------------------------------------------------------\n    Given a n x n matrix over GF with random entries, compute the\n        charpoly.\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 100)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.charpoly_GF(100)\n            sage: tm = b.charpoly_GF(100, system='magma')  # optional - magma\n               sage\n              0.060\n    ----------------------------------------------------------------------\n    Given an n x n matrix A over GF(p) with random entries, compute\n        A * (A+1).\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 100)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n        - ``times`` - number of experiments (default: ``3``)\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.matrix_multiply_GF(100, p=19)\n            sage: tm = b.matrix_multiply_GF(100, p=19, system='magma')  # optional - magma\n               sage\n              0.003\n    ----------------------------------------------------------------------\n    Dense determinant over GF(p).\n        Given an n x n matrix A over GF with random entries compute\n        det(A).\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: 300)\n        - ``p`` - prime number (default: ``16411``)\n        - ``system`` - either 'magma' or 'sage' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.det_GF(1000)\n            sage: tm = b.det_GF(1000, system='magma')  # optional - magma\n               sage\n              0.090\n    ======================================================================\n**********************************************************************\n3 items had failures:\n   1 of   2 in sage.matrix.benchmark\n   1 of   2 in sage.matrix.benchmark.report\n   1 of   2 in sage.matrix.benchmark.report_GF\n***Test Failed*** 3 failures.\n\n------------------------------------------------------------------------\nDoctests interrupted: 0/2067 files tested\n------------------------------------------------------------------------\nTotal time for all tests: 181.4 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nTraceback (most recent call last):\n  File \"/release/merger/sage-5.1.beta5-12415/local/bin/sage-runtests\", line 69, in <module>\n    err = DC.run()\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 645, in run\n    self.run_doctests()\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 446, in run_doctests\n    self.dispatcher.dispatch()\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1130, in dispatch\n    self._parallel_dispatch()\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1072, in _parallel_dispatch\n    w.start()\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python/multiprocessing/process.py\", line 130, in start\n    self._popen = Popen(self)\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python/multiprocessing/forking.py\", line 120, in __init__\n    self.pid = os.fork()\nOSError: [Errno 12] Cannot allocate memory\n```\n",
    "created_at": "2012-06-25T14:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143112",
    "user": "jdemeyer"
}
```

Building from scratch and doing `make ptest` gives:

```
argv ['/release/merger/sage-5.1.beta5-12415/local/bin/sage-runtests', '-p', '--sagenb', 'devel/sage/doc/common', 'devel/sage/doc/de', 'devel/sage/doc/en', 'devel/sage/doc/fr', 'devel/sage/doc/ru', 'devel/sage/doc/tr', 'devel/sage/sage']
next_arg: --sagenb
Running doctests with ID 2012-06-25-12-57-22-d71deecd.
Doctesting the Sage notebook.
Doctesting 2067 files using 6 threads
Usage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)

sage-runtests: error: no such option: -p
**********************************************************************
File "programming", line 620, in programming
Failed example:
    for i in range(5):
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        compileflags, 1)
      File "<doctest programming[0]>", line 1
        for i in range(5):
                         ^
    SyntaxError: unexpected EOF while parsing
**********************************************************************
1 items had failures:
   1 of 113 in programming
***Test Failed*** 1 failures.
**********************************************************************
File "programming", line 578, in programming
Failed example:
    for i in range(5):
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        compileflags, 1)
      File "<doctest programming[0]>", line 1
        for i in range(5):
                         ^
    SyntaxError: unexpected EOF while parsing
**********************************************************************
1 items had failures:
   1 of 113 in programming
***Test Failed*** 1 failures.
**********************************************************************
File "sage.misc.sh", line 20, in sage.misc.sh.Sh.eval
Failed example:
    sh.eval('''echo "Hello there"\nif [ $? -eq 0 ]; then\necho "good"\nfi''')
Expected:
    /...
    ''
Got:
    Hello there
    good
    /release/merger/sage-5.1.beta5-12415
    ''
**********************************************************************
File "interfaces", line 331, in interfaces
Failed example:
    maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\ 
      '[plot_format, openmath]') # not tested
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        compileflags, 1)
      File "<doctest interfaces[0]>", line 2
        maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\
                                                                         
                                                 ^
    SyntaxError: unexpected character after line continuation character
**********************************************************************
1 items had failures:
   1 of  57 in interfaces
***Test Failed*** 1 failures.
**********************************************************************
1 items had failures:
   1 of   1 in sage.misc.sh.Sh.eval
***Test Failed*** 1 failures.
**********************************************************************
File "sage.doctest.control", line 246, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC = DocTestController(DD, [])
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 573, in _run
        self.execute(example, compiled, test.globs)
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 835, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[2]>", line 1, in <module>
        DC = DocTestController(DD, [])
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py", line 127, in __init__
        self.logfile = open(options.logfile, 'a')
    IOError: [Errno 2] No such file or directory: '/release/merger/sage-5.1.beta5-12415/home/.sage//tmp/test.log'
**********************************************************************
File "sage.doctest.control", line 247, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC.add_files()
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 573, in _run
        self.execute(example, compiled, test.globs)
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 835, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[3]>", line 1, in <module>
        DC.add_files()
    NameError: name 'DC' is not defined
**********************************************************************
File "sage.doctest.control", line 249, in sage.doctest.control.DocTestController.add_files
Failed example:
    (os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage', 'sage'), True) in DC.files
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 573, in _run
        self.execute(example, compiled, test.globs)
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 835, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[4]>", line 1, in <module>
        (os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage', 'sage'), True) in DC.files
    NameError: name 'DC' is not defined
**********************************************************************
File "sage.doctest.control", line 418, in sage.doctest.control.DocTestController.run_doctests
Failed example:
    DC.run_doctests()
Expected:
    Doctesting 1 file.
    sage -t .../sage/rings/homset.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
Got:
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/homset.py
        [15 tests, 0.3 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 0.8 seconds
        cpu time: 0.1 seconds
        cumulative wall time: 0.3 seconds
**********************************************************************
File "interfaces", line 318, in interfaces
Failed example:
    maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\ 
      '[plot_format, openmath]') # not tested
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        compileflags, 1)
      File "<doctest interfaces[0]>", line 2
        maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\
                                                                         
                                                 ^
    SyntaxError: unexpected character after line continuation character
**********************************************************************
1 items had failures:
   1 of  57 in interfaces
***Test Failed*** 1 failures.
**********************************************************************
File "sage.doctest.control", line 479, in sage.doctest.control.DocTestController.cleanup
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Doctesting 1 file.
    sage -t .../rings/infinity.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
    0
Got:
    Running doctests with ID 2012-06-25-12-57-35-cf5e164b.
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py
        [220 tests, 12.8 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 13.8 seconds
        cpu time: 1.0 seconds
        cumulative wall time: 12.8 seconds
    0
**********************************************************************
File "sage.doctest.control", line 619, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Doctesting 1 file.
    sage -t .../sage/sets/non_negative_integers.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
    0
Got:
    Running doctests with ID 2012-06-25-12-57-49-f475b4d8.
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/sets/non_negative_integers.py
        [41 tests, 0.5 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 1.4 seconds
        cpu time: 0.1 seconds
        cumulative wall time: 0.5 seconds
    0
**********************************************************************
File "sage.doctest.control", line 660, in sage.doctest.control.run_doctests
Failed example:
    run_doctests(sage.rings.infinity)
Expected:
    Doctesting .../sage/rings/infinity.py
    Running doctests with ID ...
    Doctesting 1 file.
    sage -t .../sage/rings/infinity.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
Got:
    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py
    Running doctests with ID 2012-06-25-12-57-50-38f106c7.
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/infinity.py
        [220 tests, 20.3 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 22.3 seconds
        cpu time: 1.0 seconds
        cumulative wall time: 20.3 seconds
**********************************************************************
5 items had failures:
   3 of  13 in sage.doctest.control.DocTestController.add_files
   1 of  10 in sage.doctest.control.DocTestController.cleanup
   1 of   6 in sage.doctest.control.DocTestController.run
   1 of   7 in sage.doctest.control.DocTestController.run_doctests
   1 of   1 in sage.doctest.control.run_doctests
***Test Failed*** 7 failures.
**********************************************************************
File "sage.parallel.decorate", line 559, in sage.parallel.decorate.fork
Failed example:
    g()
Expected:
    <BLANKLINE>
    ------------------------------------------------------------------------
    Unhandled SIGSEGV: A segmentation fault occurred in Sage.
    This probably occurred because a *compiled* component of Sage has a bug
    in it and is not properly wrapped with sig_on(), sig_off(). You might
    want to run Sage under gdb with 'sage -gdb' to debug this.
    Sage will now terminate.
    ------------------------------------------------------------------------
    'NO DATA'
Got:
    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(print_backtrace+0x2b)[0x2b39ebbaf66e]
    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(sigdie+0x14)[0x2b39ebbaf69b]
    /release/merger/sage-5.1.beta5-12415/local/lib/libcsage.so(sage_signal_handler+0x20b)[0x2b39ebbaf189]
    /lib/libpthread.so.0[0x2b39e86417d0]
    /lib/libc.so.6(strlen+0x30)[0x2b39e8f532f0]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyString_FromString+0x1b)[0x2b39e82e486b]
    /release/merger/sage-5.1.beta5-12415/home/.sage//temp/sage.math.washington.edu/28931//spyx//_release_merger_sage_5_1_beta5_12415_home__sage_temp_sage_math_washington_edu_28931_tmp_0_spyx/_release_merger_sage_5_1_beta5_12415_home__sage_temp_sage_math_washington_edu_28931_tmp_0_spyx_0.so[0x2aaaaaab0abd]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5a63)[0x2b39e833b2a3]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x37bf)[0x2b39e8338fff]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82b6b09]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c952d]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c9acb]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b39e833d432]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x714e)[0x2b39e833c98e]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x5ae4)[0x2b39e833b324]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f563a]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x37bf)[0x2b39e8338fff]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f523c]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82c1979]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82a487f]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f523c]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0[0x2b39e82f0568]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyObject_Call+0x68)[0x2b39e82942c8]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x1299)[0x2b39e8336ad9]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x69c5)[0x2b39e833c205]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x852)[0x2b39e833d312]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x32)[0x2b39e833d432]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xc1)[0x2b39e83611b1]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x1f9)[0x2b39e8361489]
    /release/merger/sage-5.1.beta5-12415/local/lib/libpython2.7.so.1.0(Py_Main+0xb15)[0x2b39e8373e65]
    /lib/libc.so.6(__libc_start_main+0xf4)[0x2b39e8ef61f4]
    python[0x400679]
    <BLANKLINE>
    ------------------------------------------------------------------------
    Unhandled SIGSEGV: A segmentation fault occurred in Sage.
    This probably occurred because a *compiled* component of Sage has a bug
    in it and is not properly wrapped with sig_on(), sig_off(). You might
    want to run Sage under gdb with 'sage -gdb' to debug this.
    Sage will now terminate.
    ------------------------------------------------------------------------
    'NO DATA'
**********************************************************************
1 items had failures:
   1 of  17 in sage.parallel.decorate.fork
***Test Failed*** 1 failures.
**********************************************************************
File "sage.tests.startup", line 6, in sage.tests.startup
Failed example:
    if os.uname()[1] == 'sage.math.washington.edu':
        print float(os.popen("sage -startuptime>/dev/null; sage -startuptime|grep sage.all").readlines()[0].split()[1]) < 2.0
    else: print True   # nothing when not on sage.math
Expected:
    True
Got:
    False
**********************************************************************
File "sage.rings.polynomial.multi_polynomial_libsingular", line 420, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__copy__
Failed example:
    len(ring_refcount_dict) == n   
Expected:
    True
Got:
    False
**********************************************************************
File "sage.rings.polynomial.plural", line 2738, in sage.rings.polynomial.plural.new_NRing
Failed example:
    z*x
Expected:
    x*z
Got:
    Exception KeyError: (The ring pointer 0x2b3a04886e90,) in 'sage.libs.singular.ring.singular_ring_delete' ignored
    x*z
**********************************************************************
File "sage.rings.polynomial.plural", line 2856, in sage.rings.polynomial.plural.SCA
Failed example:
    E = SCA(QQ, ['x', 'y', 'z'], [0, 1], order = 'degrevlex')
Expected nothing
Got:
    Exception KeyError: (The ring pointer 0x2b3a048af1a0,) in 'sage.libs.singular.ring.singular_ring_delete' ignored
**********************************************************************
File "sage.matrix.benchmark", line 11, in sage.matrix.benchmark
Failed example:
    b.report([b.det_ZZ], 'Test', systems=['sage'])
Expected:
    ======================================================================
              Test
    ======================================================================
    ...
    ======================================================================
Got:
    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux
    ======================================================================
              Test
    ======================================================================
    <BLANKLINE>
    <BLANKLINE>
    ----------------------------------------------------------------------
    Dense integer determinant over ZZ.
        Given an n x n matrix A over ZZ with random entries
        between min and max, inclusive, compute det(A).
    <BLANKLINE>
   **********************************************************************
2 items had failures:
   1 of   8 in sage.rings.polynomial.plural.SCA
   1 of  17 in sage.rings.polynomial.plural.new_NRing
***Test Failed*** 2 failures.
     INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: ``200``)
        - ``min`` - minimal value for entries of matrix (default: ``1``)
        - ``max`` - maximal value for entries of matrix (default: ``100``)
        - ``system`` - either 'sage' or 'magma' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.det_ZZ(200)
            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma
               sage
              1.560
    ======================================================================
**********************************************************************
1 items had failures:
   1 of  16 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomialRing_libsingular.__copy__
***Test Failed*** 1 failures.
**********************************************************************
1 items had failures:
   1 of   2 in sage.tests.startup
***Test Failed*** 1 failures.
**********************************************************************
File "sage.matrix.benchmark", line 38, in sage.matrix.benchmark.report
Failed example:
    b.report([b.det_ZZ], 'Test', systems=['sage'])
Expected:
    ======================================================================
              Test
    ======================================================================
    ...
    ======================================================================
Got:
    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux
    ======================================================================
              Test
    ======================================================================
    <BLANKLINE>
    <BLANKLINE>
    ----------------------------------------------------------------------
    Dense integer determinant over ZZ.
        Given an n x n matrix A over ZZ with random entries
        between min and max, inclusive, compute det(A).
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: ``200``)
        - ``min`` - minimal value for entries of matrix (default: ``1``)
        - ``max`` - maximal value for entries of matrix (default: ``100``)
        - ``system`` - either 'sage' or 'magma' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.det_ZZ(200)
            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma
               sage
              1.330
    ======================================================================
**********************************************************************
File "sage.doctest.forker", line 925, in sage.doctest.forker.SageDocTestRunner.report_unexpected_exception
Failed example:
    "ArithmeticError" in tb
Expected:
    True
Got:
    False
**********************************************************************
File "sage.doctest.forker", line 1185, in sage.doctest.forker.DocTestWorker.__init__
Failed example:
    run_doctests(sage.rings.big_oh) # indirect doctest
Expected:
    Doctesting .../sage/rings/big_oh.py
    Running doctests with ID ...
    Doctesting 1 file.
    sage -t .../sage/rings/big_oh.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
Got:
    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/big_oh.py
    Running doctests with ID 2012-06-25-12-59-29-e5a039b5.
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/rings/big_oh.py
        [17 tests, 1.4 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 1.9 seconds
        cpu time: 0.4 seconds
        cumulative wall time: 1.4 seconds
**********************************************************************
File "sage.doctest.forker", line 1211, in sage.doctest.forker.DocTestWorker.run
Failed example:
    run_doctests(sage.symbolic.units) # indirect doctest
Expected:
    Doctesting .../sage/symbolic/units.py
    Running doctests with ID ...
    Doctesting 1 file.
    sage -t .../sage/symbolic/units.py
        [... tests, ... s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
Got:
    Doctesting /release/merger/sage-5.1.beta5-12415/devel/sage/sage/symbolic/units.py
    Running doctests with ID 2012-06-25-12-59-31-e804e534.
    .
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/symbolic/units.py
        [82 tests, 0.4 s]
    ------------------------------------------------------------------------
    All tests passed!
    ------------------------------------------------------------------------
    Total time for all tests: 0.7 seconds
        cpu time: 0.2 seconds
        cumulative wall time: 0.4 seconds
**********************************************************************
3 items had failures:
   1 of   1 in sage.doctest.forker.DocTestWorker.__init__
   1 of   1 in sage.doctest.forker.DocTestWorker.run
   1 of  18 in sage.doctest.forker.SageDocTestRunner.report_unexpected_exception
***Test Failed*** 3 failures.
**********************************************************************
File "sage.tests.cmdline", line 270, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    1
**********************************************************************
File "sage.tests.cmdline", line 272, in sage.tests.cmdline.test_executable
Failed example:
    out.find("All tests passed!") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "sage.tests.cmdline", line 275, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    1
**********************************************************************
File "sage.tests.cmdline", line 277, in sage.tests.cmdline.test_executable
Failed example:
    out.find("All tests passed!") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "sage.tests.cmdline", line 291, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    128
Got:
    1
**********************************************************************
File "sage.tests.cmdline", line 293, in sage.tests.cmdline.test_executable
Failed example:
    out.find("1 items had failures:") >= 0
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   6 of 183 in sage.tests.cmdline.test_executable
***Test Failed*** 6 failures.
**********************************************************************
File "sage.matrix.benchmark", line 566, in sage.matrix.benchmark.report_GF
Failed example:
    b.report_GF(systems=['sage'])
Expected:
    ======================================================================
    Dense benchmarks over GF with prime 16411
    ======================================================================
    ...
    ======================================================================
Got:
    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux
    ======================================================================
              Dense benchmarks over GF with prime 16411
    ======================================================================
    <BLANKLINE>
    <BLANKLINE>
    ----------------------------------------------------------------------
    Rank over GF(p):
        Given a n x (n+10) matrix over GF(p) with random entries, compute the rank.
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 300)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.rank_GF(1000)
            sage: tm = b.rank_GF(1000, system='magma')  # optional - magma
               sage
              0.160
    ----------------------------------------------------------------------
    Rank over GF(p): Given a (n + 10) x n matrix over GF(p) with
        random entries, compute the rank.
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 300)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.rank2_GF(500)
            sage: tm = b.rank2_GF(500, system='magma')  # optional - magma
               sage
              0.170
    ----------------------------------------------------------------------
    Given a n+1 x n  matrix over GF(p) with random
        entries, compute the nullspace.
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 300)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.nullspace_GF(300)
            sage: tm = b.nullspace_GF(300, system='magma')  # optional - magma
               sage
              0.820
    ----------------------------------------------------------------------
    Given a n x n matrix over GF with random entries, compute the
        charpoly.
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 100)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.charpoly_GF(100)
            sage: tm = b.charpoly_GF(100, system='magma')  # optional - magma
               sage
              0.060
    ----------------------------------------------------------------------
    Given an n x n matrix A over GF(p) with random entries, compute
        A * (A+1).
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 100)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
        - ``times`` - number of experiments (default: ``3``)
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.matrix_multiply_GF(100, p=19)
            sage: tm = b.matrix_multiply_GF(100, p=19, system='magma')  # optional - magma
               sage
              0.003
    ----------------------------------------------------------------------
    Dense determinant over GF(p).
        Given an n x n matrix A over GF with random entries compute
        det(A).
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: 300)
        - ``p`` - prime number (default: ``16411``)
        - ``system`` - either 'magma' or 'sage' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.det_GF(1000)
            sage: tm = b.det_GF(1000, system='magma')  # optional - magma
               sage
              0.090
    ======================================================================
**********************************************************************
3 items had failures:
   1 of   2 in sage.matrix.benchmark
   1 of   2 in sage.matrix.benchmark.report
   1 of   2 in sage.matrix.benchmark.report_GF
***Test Failed*** 3 failures.

------------------------------------------------------------------------
Doctests interrupted: 0/2067 files tested
------------------------------------------------------------------------
Total time for all tests: 181.4 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
Traceback (most recent call last):
  File "/release/merger/sage-5.1.beta5-12415/local/bin/sage-runtests", line 69, in <module>
    err = DC.run()
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py", line 645, in run
    self.run_doctests()
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py", line 446, in run_doctests
    self.dispatcher.dispatch()
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1130, in dispatch
    self._parallel_dispatch()
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1072, in _parallel_dispatch
    w.start()
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python/multiprocessing/process.py", line 130, in start
    self._popen = Popen(self)
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python/multiprocessing/forking.py", line 120, in __init__
    self.pid = os.fork()
OSError: [Errno 12] Cannot allocate memory
```




---

archive/issue_comments_143113.json:
```json
{
    "body": "Replying to [comment:38 jdemeyer]:\n> Planning to make a reviewer patch\n...after you guys fix the more serious errors.",
    "created_at": "2012-06-25T16:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143113",
    "user": "jdemeyer"
}
```

Replying to [comment:38 jdemeyer]:
> Planning to make a reviewer patch
...after you guys fix the more serious errors.



---

archive/issue_comments_143114.json:
```json
{
    "body": "Some of these are due to a bug in the change I just made to -p.  I'm working on fixing those.\n\nSome look like you didn't apply the patch to the sagenb repo.  Did you forget, or is something else going on?\n\nSome are due to the fact that in your tests, os.system calls are happening before the python process gets far enough, so results that were printed to the screen in the wrong order.  I'm guessing this may relate to the fact that you're running on /release, since my tests on sage.math didn't show the same behavior.\n\nI'm in the process of fixing stuff.",
    "created_at": "2012-06-25T17:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143114",
    "user": "roed"
}
```

Some of these are due to a bug in the change I just made to -p.  I'm working on fixing those.

Some look like you didn't apply the patch to the sagenb repo.  Did you forget, or is something else going on?

Some are due to the fact that in your tests, os.system calls are happening before the python process gets far enough, so results that were printed to the screen in the wrong order.  I'm guessing this may relate to the fact that you're running on /release, since my tests on sage.math didn't show the same behavior.

I'm in the process of fixing stuff.



---

archive/issue_comments_143115.json:
```json
{
    "body": "There's some code in the current doctesting code to output xml results, which I'm not currently duplicating.  Is this used somewhere?",
    "created_at": "2012-06-25T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143115",
    "user": "roed"
}
```

There's some code in the current doctesting code to output xml results, which I'm not currently duplicating.  Is this used somewhere?



---

archive/issue_comments_143116.json:
```json
{
    "body": "Currently sage -t --new is broken.  I'm trying to figure out why.",
    "created_at": "2012-06-25T18:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143116",
    "user": "roed"
}
```

Currently sage -t --new is broken.  I'm trying to figure out why.



---

archive/issue_comments_143117.json:
```json
{
    "body": "Alright, I'm going to start running tests.  There are still some remaining issues, but the patches are in a state where someone else might want to look at them.  :-)\n\nRemaining problems:\n\n* #13145 needs work, generating some doctest failures related to deallocating multivariate polynomials\n* hg_sage seems to be broken, causing the --new option to fail\n* valgrinding `sage -t` doesn't work; I'm not sure whether it did before\n* The new code doesn't support xml output\n\nI'll see if I find more when running `sage -t --all`.",
    "created_at": "2012-06-25T18:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143117",
    "user": "roed"
}
```

Alright, I'm going to start running tests.  There are still some remaining issues, but the patches are in a state where someone else might want to look at them.  :-)

Remaining problems:

* #13145 needs work, generating some doctest failures related to deallocating multivariate polynomials
* hg_sage seems to be broken, causing the --new option to fail
* valgrinding `sage -t` doesn't work; I'm not sure whether it did before
* The new code doesn't support xml output

I'll see if I find more when running `sage -t --all`.



---

archive/issue_comments_143118.json:
```json
{
    "body": "Replying to [comment:43 roed]:\n> Some are due to the fact that in your tests, os.system calls are happening before the python process gets far enough, so results that were printed to the screen in the wrong order.\nUse `sys.stdout.flush()` (and/or the same for `stderr`) before `os.system()` to overcome this.  The difference is probably that my output was sent to a pipe, as opposed to directly to the terminal. In the latter case, flushing is automatic.\n\nTrue, I might not have applied all patches correctly.",
    "created_at": "2012-06-25T18:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143118",
    "user": "jdemeyer"
}
```

Replying to [comment:43 roed]:
> Some are due to the fact that in your tests, os.system calls are happening before the python process gets far enough, so results that were printed to the screen in the wrong order.
Use `sys.stdout.flush()` (and/or the same for `stderr`) before `os.system()` to overcome this.  The difference is probably that my output was sent to a pipe, as opposed to directly to the terminal. In the latter case, flushing is automatic.

True, I might not have applied all patches correctly.



---

archive/issue_comments_143119.json:
```json
{
    "body": "It doesn't make sense to patch the old notebook. Please work with the flask notebook instead (i.e. make this ticket depend on #11080 and preferably #13121).",
    "created_at": "2012-06-25T18:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143119",
    "user": "kini"
}
```

It doesn't make sense to patch the old notebook. Please work with the flask notebook instead (i.e. make this ticket depend on #11080 and preferably #13121).



---

archive/issue_comments_143120.json:
```json
{
    "body": "Replying to [comment:48 kini]:\n> It doesn't make sense to patch the old notebook. Please work with the flask notebook instead (i.e. make this ticket depend on #11080 and preferably #13121).\n\nI agree that it doesn't make much sense to patch the old notebook, but if this can get a positive review quickly I'd rather not wait on #11080 and #13121.  The changes to the old notebook are pretty minor.",
    "created_at": "2012-06-25T19:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143120",
    "user": "roed"
}
```

Replying to [comment:48 kini]:
> It doesn't make sense to patch the old notebook. Please work with the flask notebook instead (i.e. make this ticket depend on #11080 and preferably #13121).

I agree that it doesn't make much sense to patch the old notebook, but if this can get a positive review quickly I'd rather not wait on #11080 and #13121.  The changes to the old notebook are pretty minor.



---

archive/issue_comments_143121.json:
```json
{
    "body": "Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?",
    "created_at": "2012-06-25T19:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143121",
    "user": "roed"
}
```

Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?



---

archive/issue_comments_143122.json:
```json
{
    "body": "The only tests I have failing on sage.math are `sage.tests.startup` and `sage.rings.polynomial.multi_polynomial_libsingular` (due to #13145).",
    "created_at": "2012-06-25T19:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143122",
    "user": "roed"
}
```

The only tests I have failing on sage.math are `sage.tests.startup` and `sage.rings.polynomial.multi_polynomial_libsingular` (due to #13145).



---

archive/issue_comments_143123.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-06-25T19:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143123",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143124.json:
```json
{
    "body": "Replying to [comment:50 roed]:\n> Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?\nIt might not be truly a problem, but I prefer the current model where the tests for one file are grouped.",
    "created_at": "2012-06-25T19:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143124",
    "user": "jdemeyer"
}
```

Replying to [comment:50 roed]:
> Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?
It might not be truly a problem, but I prefer the current model where the tests for one file are grouped.



---

archive/issue_comments_143125.json:
```json
{
    "body": "Replying to [comment:50 roed]:\n> Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?\nEven better might be an option to show only the *first* failure in each file.",
    "created_at": "2012-06-25T20:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143125",
    "user": "jdemeyer"
}
```

Replying to [comment:50 roed]:
> Design question: when running tests in parallel, failed examples are printed as they arise, meaning that examples from different files are intermingled.  Is this a problem that needs to be fixed?
Even better might be an option to show only the *first* failure in each file.



---

archive/issue_comments_143126.json:
```json
{
    "body": "I've updated the code to group results for each file, and added an option (`sage -t --initial`) so that only the first failure is reported.",
    "created_at": "2012-06-25T22:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143126",
    "user": "roed"
}
```

I've updated the code to group results for each file, and added an option (`sage -t --initial`) so that only the first failure is reported.



---

archive/issue_comments_143127.json:
```json
{
    "body": "The following is cut from a `make ptestlong` run:\n\n```\nsage -t devel/sage/sage/symbolic/expression.pyx\n    [1960 tests, 38.2 s]\nsage -t devel/sage/sage/pl**********************************************************************\nFile \"sage.schemes.elliptic_curves.ell_rational_field\", line 1468, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_ration\nal_field.simon_two_descent\nFailed example:\n    E.simon_two_descent()  # long time (9s on sage.math, 2011)\nExpected:\n    (5, 5, [(5 : 8 : 1), (4 : 9 : 1), (3 : 11 : 1), (-1 : 20 : 1), (-6 : -25 : 1)])\nGot:\n    Saturation index bound = 265\n    WARNING: saturation at primes p > 97 will not be done;\n    points may be unsaturated at primes between 97 and index bound\n    Failed to saturate MW basis at primes [ ]\n    Saturation index bound = 265\n    WARNING: saturation at primes p > 199 will not be done;\n    points may be unsaturated at primes between 199 and index bound\n    Failed to saturate MW basis at primes [ ]\n    (5, 5, [(5 : 8 : 1), (4 : 9 : 1), (3 : 11 : 1), (-1 : 20 : 1), (-6 : -25 : 1)])\n**********************************************************************\n1 items had failures:\n   1 of  38 in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.simon_two_descent\n***Test Failed*** 1 failures.\not/plot3d/implicit_plot3d.py\n    [57 tests, 26.9 s]\nsage -t devel/sage/sage/modular/modsym/ambient.py\n    [397 tests, 26.4 s]\n```\n\n\nThere are 3 issues:\n\n1. The doctest failure itself.\n\n2. The fact that `sage -t foo` is written instead of `sage -t --long foo`.\n\n3. Output flushing: note the\n\n```\nsage -t devel/sage/sage/pl\n```\n\nand then later\n\n```\not/plot3d/implicit_plot3d.py\n    [57 tests, 26.9 s]\n```\n\n\nBy all means please keep working on this, it already looks very cool!",
    "created_at": "2012-06-26T09:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143127",
    "user": "jdemeyer"
}
```

The following is cut from a `make ptestlong` run:

```
sage -t devel/sage/sage/symbolic/expression.pyx
    [1960 tests, 38.2 s]
sage -t devel/sage/sage/pl**********************************************************************
File "sage.schemes.elliptic_curves.ell_rational_field", line 1468, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_ration
al_field.simon_two_descent
Failed example:
    E.simon_two_descent()  # long time (9s on sage.math, 2011)
Expected:
    (5, 5, [(5 : 8 : 1), (4 : 9 : 1), (3 : 11 : 1), (-1 : 20 : 1), (-6 : -25 : 1)])
Got:
    Saturation index bound = 265
    WARNING: saturation at primes p > 97 will not be done;
    points may be unsaturated at primes between 97 and index bound
    Failed to saturate MW basis at primes [ ]
    Saturation index bound = 265
    WARNING: saturation at primes p > 199 will not be done;
    points may be unsaturated at primes between 199 and index bound
    Failed to saturate MW basis at primes [ ]
    (5, 5, [(5 : 8 : 1), (4 : 9 : 1), (3 : 11 : 1), (-1 : 20 : 1), (-6 : -25 : 1)])
**********************************************************************
1 items had failures:
   1 of  38 in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.simon_two_descent
***Test Failed*** 1 failures.
ot/plot3d/implicit_plot3d.py
    [57 tests, 26.9 s]
sage -t devel/sage/sage/modular/modsym/ambient.py
    [397 tests, 26.4 s]
```


There are 3 issues:

1. The doctest failure itself.

2. The fact that `sage -t foo` is written instead of `sage -t --long foo`.

3. Output flushing: note the

```
sage -t devel/sage/sage/pl
```

and then later

```
ot/plot3d/implicit_plot3d.py
    [57 tests, 26.9 s]
```


By all means please keep working on this, it already looks very cool!



---

archive/issue_comments_143128.json:
```json
{
    "body": "Some more doctest failures from `make ptest`:\n\n```\nsage -t devel/sage/doc/common/__init__.py\n    [0 tests, 0.0 s]\nsage -t devel/sage/doc/common/build_optiUsage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)\n\nsage-runtests: error: no such option: -p\nons.py\n    [0 tests, 0.0 s]\nsage -t devel/sage/doc/common/builder.py\n    Bad exit: 2\nTests run before process failed:\n\nsage -t devel/sage/doc/common/conf.py\n    [0 tests, 0.0 s]\n```\n\n\n\n```\nsage -t devel/sage/doc/de/tutorial/interactive_shell.rst\n    Error: TAB character found at line 656\n    [8 tests, 0.2 s]\nsage -t devel/sage/doc/en/tutorial/interactive_shell.rst\n    [8 tests, 0.2 s]\nsage -t devel/sage/doc/en/bordeaux_2008/birds_other.rst\n    [26 tests, 5.2**********************************************************************\nFile \"interfaces\", line 331, in interfaces\nFailed example:\n    maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n      '[plot_format, openmath]') # not tested\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 590, in _run\n        compileflags, 1)\n      File \"<doctest interfaces[0]>\", line 2\n        maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n\n                                                 ^\n    SyntaxError: unexpected character after line continuation character\n**********************************************************************\n1 items had failures:\n   1 of  57 in interfaces\n***Test Failed*** 1 failures.\n**********************************************************************\nFile \"interfaces\", line 318, in interfaces\nFailed example:\n    maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n      '[plot_format, openmath]') # not tested\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 590, in _run\n        compileflags, 1)\n      File \"<doctest interfaces[0]>\", line 2\n        maxima.plot3d(\"[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\\\n      y*sin(x/2)]\", \"[x, -4, 4]\", \"[y, -4, 4]\",\\\n\n                                                 ^\n    SyntaxError: unexpected character after line continuation character\n**********************************************************************\n1 items had failures:\n   1 of  57 in interfaces\n***Test Failed*** 1 failures.\n s]\nsage -t devel/sage/doc/fr/tutorial/interactive_shell.rst\n    [8 tests, 0.2 s]\n```\n\n(why is the filename simply \"interfaces\")\n\n\n```\nsage -t devel/sage/doc/en/reference/probability.rst\n    [0 tests, 0.0 s]\nsage -t de**********************************************************************\nFile \"programming\", line 620, in programming\nFailed example:\n    for i in range(5):\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 590, in _run\n        compileflags, 1)\n      File \"<doctest programming[0]>\", line 1\n        for i in range(5):\n                         ^\n    SyntaxError: unexpected EOF while parsing\n**********************************************************************\n1 items had failures:\n   1 of 113 in programming\n***Test Failed*** 1 failures.\n```\n\n\n\n```\nsage -t devel/sage/doc/en/reference/rings_standard.rst\n    [0 tests, 0.0 s]\nsage -t devel/sage/doc/en/reference/combinat/root_syste**********************************************************************\nFile \"programming\", line 578, in programming\nFailed example:\n    for i in range(5):\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 590, in _run\n        compileflags, 1)\n      File \"<doctest programming[0]>\", line 1\n        for i in range(5):\n                         ^\n    SyntaxError: unexpected EOF while parsing\n**********************************************************************\n1 items had failures:\n   1 of 113 in programming\n***Test Failed*** 1 failures.\nms.rst\n    [0 tests, 0.0 s]\n```\n\n\n\n```\nsage -t devel/sage/sage/databases/odlyzko.py\n    [0 tests, 0.0 s]\nsag**********************************************************************\nFile \"sage.doctest.reporting\", line 93, in sage.doctest.reporting.DocTestReporter.report\nFailed example:\n    DTR.report(FDS, True, 0, None, \"Output so far...\")\nExpected:\n    sage -t .../devel/sage/sage/doctest/reporting.py\n        Timed out!\n    Output so far...\nGot:\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py\n        Timed out!\n    Tests run before process froze:\n    Output so far...\n**********************************************************************\nFile \"sage.doctest.reporting\", line 102, in sage.doctest.reporting.DocTestReporter.report\nFailed example:\n    DTR.report(FDS, False, 3, None, \"Output before bad exit\")\nExpected:\n    sage -t .../devel/sage/sage/doctest/reporting.py\n        Bad exit: 3\n    Output before bad exit\nGot:\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py\n        Bad exit: 3\n    Tests run before process failed:\n    Output before bad exit\n**********************************************************************\nFile \"sage.doctest.reporting\", line 215, in sage.doctest.reporting.DocTestReporter.finalize\nFailed example:\n    DTR.report(FDS, True, 0, None, \"Output so far...\")\nExpected:\n    sage -t .../devel/sage/sage/doctest/reporting.py\n        Timed out!\n    Output so far...\nGot:\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py\n        Timed out!\n    Tests run before process froze:\n    Output so far...\n**********************************************************************\nFile \"sage.doctest.reporting\", line 219, in sage.doctest.reporting.DocTestReporter.finalize\nFailed example:\n    DTR.report(FDS, False, 3, None, \"Output before bad exit\")\nExpected:\n    sage -t .../devel/sage/sage/doctest/reporting.py\n        Bad exit: 3\n    Output before bad exit\nGot:\n    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py\n        Bad exit: 3\n    Tests run before process failed:\n    Output before bad exit\n**********************************************************************\n2 items had failures:\n   2 of  26 in sage.doctest.reporting.DocTestReporter.finalize\n   2 of  23 in sage.doctest.reporting.DocTestReporter.report\n***Test Failed*** 4 failures.\ne -t devel/sage/sage/databases/sloane.py\n    [1 tests, 0.1 s]\n```\n\n\n\n```\nsage -t devel/sage/sage/ext/cdefs.pxi\n    [0 tests, 0.0 s]\nsage -t devel/sage/sage/docte**********************************************************************\nFile \"sage.doctest.control\", line 252, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC = DocTestController(DD, [])\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 591, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 873, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[2]>\", line 1, in <module>\n        DC = DocTestController(DD, [])\n      File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 132, in __init__\n        print \"Unable to open logfile at %s\\nProceeding without logging.\"%(self.logfile)\n    AttributeError: 'DocTestController' object has no attribute 'logfile'\n**********************************************************************\n```\n\n\n\n```\nsage -t devel/sage/sage/misc/profiler.py\n    [0 tests, 0.0 s]\nsage -t devel/sage/**********************************************************************\nFile \"sage.matrix.benchmark\", line 11, in sage.matrix.benchmark\nFailed example:\n    print \"starting\"; b.report([b.det_ZZ], 'Test', systems=['sage'])\nExpected:\n    starting...\n    ======================================================================\n              Test\n    ======================================================================\n    ...\n    ======================================================================\nGot:\n    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux\n    starting\n    ======================================================================\n              Test\n    ======================================================================\n    <BLANKLINE>\n    <BLANKLINE>\n    ----------------------------------------------------------------------\n    Dense integer determinant over ZZ.\n        Given an n x n matrix A over ZZ with random entries\n        between min and max, inclusive, compute det(A).\n    <BLANKLINE>\n        INPUT:\n    <BLANKLINE>\n        - ``n`` - matrix dimension (default: ``200``)\n        - ``min`` - minimal value for entries of matrix (default: ``1``)\n        - ``max`` - maximal value for entries of matrix (default: ``100``)\n        - ``system`` - either 'sage' or 'magma' (default: 'sage')\n    <BLANKLINE>\n        EXAMPLES::\n    <BLANKLINE>\n            sage: import sage.matrix.benchmark as b\n            sage: ts = b.det_ZZ(200)\n            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma\n               sage\n              1.370\n    ======================================================================\n**********************************************************************\n```\n",
    "created_at": "2012-06-26T09:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143128",
    "user": "jdemeyer"
}
```

Some more doctest failures from `make ptest`:

```
sage -t devel/sage/doc/common/__init__.py
    [0 tests, 0.0 s]
sage -t devel/sage/doc/common/build_optiUsage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)

sage-runtests: error: no such option: -p
ons.py
    [0 tests, 0.0 s]
sage -t devel/sage/doc/common/builder.py
    Bad exit: 2
Tests run before process failed:

sage -t devel/sage/doc/common/conf.py
    [0 tests, 0.0 s]
```



```
sage -t devel/sage/doc/de/tutorial/interactive_shell.rst
    Error: TAB character found at line 656
    [8 tests, 0.2 s]
sage -t devel/sage/doc/en/tutorial/interactive_shell.rst
    [8 tests, 0.2 s]
sage -t devel/sage/doc/en/bordeaux_2008/birds_other.rst
    [26 tests, 5.2**********************************************************************
File "interfaces", line 331, in interfaces
Failed example:
    maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\
      '[plot_format, openmath]') # not tested
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 590, in _run
        compileflags, 1)
      File "<doctest interfaces[0]>", line 2
        maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\

                                                 ^
    SyntaxError: unexpected character after line continuation character
**********************************************************************
1 items had failures:
   1 of  57 in interfaces
***Test Failed*** 1 failures.
**********************************************************************
File "interfaces", line 318, in interfaces
Failed example:
    maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\
      '[plot_format, openmath]') # not tested
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 590, in _run
        compileflags, 1)
      File "<doctest interfaces[0]>", line 2
        maxima.plot3d("[cos(x)*(3 + y*cos(x/2)), sin(x)*(3 + y*cos(x/2)),\
      y*sin(x/2)]", "[x, -4, 4]", "[y, -4, 4]",\

                                                 ^
    SyntaxError: unexpected character after line continuation character
**********************************************************************
1 items had failures:
   1 of  57 in interfaces
***Test Failed*** 1 failures.
 s]
sage -t devel/sage/doc/fr/tutorial/interactive_shell.rst
    [8 tests, 0.2 s]
```

(why is the filename simply "interfaces")


```
sage -t devel/sage/doc/en/reference/probability.rst
    [0 tests, 0.0 s]
sage -t de**********************************************************************
File "programming", line 620, in programming
Failed example:
    for i in range(5):
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 590, in _run
        compileflags, 1)
      File "<doctest programming[0]>", line 1
        for i in range(5):
                         ^
    SyntaxError: unexpected EOF while parsing
**********************************************************************
1 items had failures:
   1 of 113 in programming
***Test Failed*** 1 failures.
```



```
sage -t devel/sage/doc/en/reference/rings_standard.rst
    [0 tests, 0.0 s]
sage -t devel/sage/doc/en/reference/combinat/root_syste**********************************************************************
File "programming", line 578, in programming
Failed example:
    for i in range(5):
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 590, in _run
        compileflags, 1)
      File "<doctest programming[0]>", line 1
        for i in range(5):
                         ^
    SyntaxError: unexpected EOF while parsing
**********************************************************************
1 items had failures:
   1 of 113 in programming
***Test Failed*** 1 failures.
ms.rst
    [0 tests, 0.0 s]
```



```
sage -t devel/sage/sage/databases/odlyzko.py
    [0 tests, 0.0 s]
sag**********************************************************************
File "sage.doctest.reporting", line 93, in sage.doctest.reporting.DocTestReporter.report
Failed example:
    DTR.report(FDS, True, 0, None, "Output so far...")
Expected:
    sage -t .../devel/sage/sage/doctest/reporting.py
        Timed out!
    Output so far...
Got:
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py
        Timed out!
    Tests run before process froze:
    Output so far...
**********************************************************************
File "sage.doctest.reporting", line 102, in sage.doctest.reporting.DocTestReporter.report
Failed example:
    DTR.report(FDS, False, 3, None, "Output before bad exit")
Expected:
    sage -t .../devel/sage/sage/doctest/reporting.py
        Bad exit: 3
    Output before bad exit
Got:
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py
        Bad exit: 3
    Tests run before process failed:
    Output before bad exit
**********************************************************************
File "sage.doctest.reporting", line 215, in sage.doctest.reporting.DocTestReporter.finalize
Failed example:
    DTR.report(FDS, True, 0, None, "Output so far...")
Expected:
    sage -t .../devel/sage/sage/doctest/reporting.py
        Timed out!
    Output so far...
Got:
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py
        Timed out!
    Tests run before process froze:
    Output so far...
**********************************************************************
File "sage.doctest.reporting", line 219, in sage.doctest.reporting.DocTestReporter.finalize
Failed example:
    DTR.report(FDS, False, 3, None, "Output before bad exit")
Expected:
    sage -t .../devel/sage/sage/doctest/reporting.py
        Bad exit: 3
    Output before bad exit
Got:
    sage -t /release/merger/sage-5.1.beta5-12415/devel/sage/sage/doctest/reporting.py
        Bad exit: 3
    Tests run before process failed:
    Output before bad exit
**********************************************************************
2 items had failures:
   2 of  26 in sage.doctest.reporting.DocTestReporter.finalize
   2 of  23 in sage.doctest.reporting.DocTestReporter.report
***Test Failed*** 4 failures.
e -t devel/sage/sage/databases/sloane.py
    [1 tests, 0.1 s]
```



```
sage -t devel/sage/sage/ext/cdefs.pxi
    [0 tests, 0.0 s]
sage -t devel/sage/sage/docte**********************************************************************
File "sage.doctest.control", line 252, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC = DocTestController(DD, [])
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 591, in _run
        self.execute(example, compiled, test.globs)
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 873, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[2]>", line 1, in <module>
        DC = DocTestController(DD, [])
      File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/control.py", line 132, in __init__
        print "Unable to open logfile at %s\nProceeding without logging."%(self.logfile)
    AttributeError: 'DocTestController' object has no attribute 'logfile'
**********************************************************************
```



```
sage -t devel/sage/sage/misc/profiler.py
    [0 tests, 0.0 s]
sage -t devel/sage/**********************************************************************
File "sage.matrix.benchmark", line 11, in sage.matrix.benchmark
Failed example:
    print "starting"; b.report([b.det_ZZ], 'Test', systems=['sage'])
Expected:
    starting...
    ======================================================================
              Test
    ======================================================================
    ...
    ======================================================================
Got:
    Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Fri Feb 11 18:08:32 UTC 2011 x86_64 GNU/Linux
    starting
    ======================================================================
              Test
    ======================================================================
    <BLANKLINE>
    <BLANKLINE>
    ----------------------------------------------------------------------
    Dense integer determinant over ZZ.
        Given an n x n matrix A over ZZ with random entries
        between min and max, inclusive, compute det(A).
    <BLANKLINE>
        INPUT:
    <BLANKLINE>
        - ``n`` - matrix dimension (default: ``200``)
        - ``min`` - minimal value for entries of matrix (default: ``1``)
        - ``max`` - maximal value for entries of matrix (default: ``100``)
        - ``system`` - either 'sage' or 'magma' (default: 'sage')
    <BLANKLINE>
        EXAMPLES::
    <BLANKLINE>
            sage: import sage.matrix.benchmark as b
            sage: ts = b.det_ZZ(200)
            sage: tm = b.det_ZZ(200, system='magma')  # optional - magma
               sage
              1.370
    ======================================================================
**********************************************************************
```




---

archive/issue_comments_143129.json:
```json
{
    "body": "Another annoyance, compare in the output:\n\n```\nsage -t devel/sage/sage/rings/polynomial/padics/polynomial_padic_capped_relative_dense.py\n```\n\n\n```\nsage -t /release/merger/sage-5.1.beta5-12415/devel/sagenb-main/sagenb/interfaces/expect.py\n```\n\nWhy a relative path in the first case but a full path in the second case?  Also with `-a`, only absolute paths are shown.  I would prefer all paths to be relative to the current directory.",
    "created_at": "2012-06-26T09:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143129",
    "user": "jdemeyer"
}
```

Another annoyance, compare in the output:

```
sage -t devel/sage/sage/rings/polynomial/padics/polynomial_padic_capped_relative_dense.py
```


```
sage -t /release/merger/sage-5.1.beta5-12415/devel/sagenb-main/sagenb/interfaces/expect.py
```

Why a relative path in the first case but a full path in the second case?  Also with `-a`, only absolute paths are shown.  I would prefer all paths to be relative to the current directory.



---

archive/issue_comments_143130.json:
```json
{
    "body": "\n```\njdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -tp 1000000000 devel/sage/sage/rings/padics/\nRunning doctests with ID 2012-06-26-11-58-02-3accd40f.\nDoctesting 32 files using 1000000000 threads\n```\n\n\nThe previous doctester would reduce the number of threads to be at most the number of files to test.",
    "created_at": "2012-06-26T09:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143130",
    "user": "jdemeyer"
}
```


```
jdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -tp 1000000000 devel/sage/sage/rings/padics/
Running doctests with ID 2012-06-26-11-58-02-3accd40f.
Doctesting 32 files using 1000000000 threads
```


The previous doctester would reduce the number of threads to be at most the number of files to test.



---

archive/issue_comments_143131.json:
```json
{
    "body": "A very useful feature from the previous doctester which is missing here is that `--verbose` actually shows the output as the test is running.  So when it gets stuck somewhere, you actually see that it gets stuck.  Currently, the whole test result is simply dumped at the end.\n\nAlso: previously, line numbers were shown with `--verbose` (albeit in a very bad way).\n\nOne more feature-request: with `--verbose`, show the time taken *for each single test*, i.e. I would like\n\n```\nTrying (line 242):\n    EllipticCurve('900d1').integral_points()\nExpecting:\n    [(-11 : 27 : 1), (-4 : 34 : 1), (4 : 18 : 1), (16 : 54 : 1)]\nok [0.10s]\nTrying (line 243):\n    E=EllipticCurve([-879984,319138704])\nExpecting nothing\nok [1.92s]\nTrying (line 255):\n    P1=E.point((540,1188)); P2=E.point((576,1836))\nExpecting nothing\nok [4.59s]\n```\n\n\nIt's totally okay for me to disallow `--verbose` in parallel tests.",
    "created_at": "2012-06-26T10:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143131",
    "user": "jdemeyer"
}
```

A very useful feature from the previous doctester which is missing here is that `--verbose` actually shows the output as the test is running.  So when it gets stuck somewhere, you actually see that it gets stuck.  Currently, the whole test result is simply dumped at the end.

Also: previously, line numbers were shown with `--verbose` (albeit in a very bad way).

One more feature-request: with `--verbose`, show the time taken *for each single test*, i.e. I would like

```
Trying (line 242):
    EllipticCurve('900d1').integral_points()
Expecting:
    [(-11 : 27 : 1), (-4 : 34 : 1), (4 : 18 : 1), (16 : 54 : 1)]
ok [0.10s]
Trying (line 243):
    E=EllipticCurve([-879984,319138704])
Expecting nothing
ok [1.92s]
Trying (line 255):
    P1=E.point((540,1188)); P2=E.point((576,1836))
Expecting nothing
ok [4.59s]
```


It's totally okay for me to disallow `--verbose` in parallel tests.



---

archive/issue_comments_143132.json:
```json
{
    "body": "What does the `--serial` option do and how is it different from `-p 1`?",
    "created_at": "2012-06-26T10:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143132",
    "user": "jdemeyer"
}
```

What does the `--serial` option do and how is it different from `-p 1`?



---

archive/issue_comments_143133.json:
```json
{
    "body": "I would expect `sage -t -f` not to need any filename arguments (similarly to `-a`), just run all the failed tests.\n\nHowever:\n\n```\njdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t -f\nUsage: sage -t [options] filenames\n```\n",
    "created_at": "2012-06-26T10:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143133",
    "user": "jdemeyer"
}
```

I would expect `sage -t -f` not to need any filename arguments (similarly to `-a`), just run all the failed tests.

However:

```
jdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t -f
Usage: sage -t [options] filenames
```




---

archive/issue_comments_143134.json:
```json
{
    "body": "Perhaps add a `-T` option as a synonym for `--timeout`?",
    "created_at": "2012-06-26T11:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143134",
    "user": "jdemeyer"
}
```

Perhaps add a `-T` option as a synonym for `--timeout`?



---

archive/issue_comments_143135.json:
```json
{
    "body": "I'm collecting some \"special cases\" for doctests in [http://boxen.math.washington.edu/home/jdemeyer/doctest/](http://boxen.math.washington.edu/home/jdemeyer/doctest/) (maybe these should eventually become \"meta-doctests\").\n\nThe doctesting framework seems to hang on\n\n```\njdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py\nRunning doctests with ID 2012-06-26-14-12-55-fbefc7c4.\nDoctesting 1 file.\n```\n\n\nWhile the following gives an error inside the doctesting framework (this also used to fail before):\n\n```\njdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/keyboardinterrupt.py\nRunning doctests with ID 2012-06-26-14-12-38-b70e54c4.\nDoctesting 1 file.\nsage -t /home/jdemeyer/doctest/keyboardinterrupt.py\nTraceback (most recent call last):\n  File \"/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/reporting.py\", line 146, in report\n    ntests, runner = results\nTypeError: 'NoneType' object is not iterable\n\n------------------------------------------------------------------------\nDoctests interrupted: 0/1 files tested\n------------------------------------------------------------------------\nTotal time for all tests: 1.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\n\nThe following should report an error but doesn't:\n\n```\njdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py\nRunning doctests with ID 2012-06-26-14-14-08-06a01dbf.\nDoctesting 1 file.\nsage -t /home/jdemeyer/doctest/sig_on.py\n    [1 tests, 1.1 s]\n------------------------------------------------------------------------\nAll tests passed!\n------------------------------------------------------------------------\nTotal time for all tests: 2.1 seconds\n    cpu time: 0.1 seconds\n    cumulative wall time: 1.1 seconds\n```\n",
    "created_at": "2012-06-26T12:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143135",
    "user": "jdemeyer"
}
```

I'm collecting some "special cases" for doctests in [http://boxen.math.washington.edu/home/jdemeyer/doctest/](http://boxen.math.washington.edu/home/jdemeyer/doctest/) (maybe these should eventually become "meta-doctests").

The doctesting framework seems to hang on

```
jdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py
Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.
Doctesting 1 file.
```


While the following gives an error inside the doctesting framework (this also used to fail before):

```
jdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/keyboardinterrupt.py
Running doctests with ID 2012-06-26-14-12-38-b70e54c4.
Doctesting 1 file.
sage -t /home/jdemeyer/doctest/keyboardinterrupt.py
Traceback (most recent call last):
  File "/release/merger/sage-5.1.beta5-12415/local/lib/python2.7/site-packages/sage/doctest/reporting.py", line 146, in report
    ntests, runner = results
TypeError: 'NoneType' object is not iterable

------------------------------------------------------------------------
Doctests interrupted: 0/1 files tested
------------------------------------------------------------------------
Total time for all tests: 1.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```


The following should report an error but doesn't:

```
jdemeyer@sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py
Running doctests with ID 2012-06-26-14-14-08-06a01dbf.
Doctesting 1 file.
sage -t /home/jdemeyer/doctest/sig_on.py
    [1 tests, 1.1 s]
------------------------------------------------------------------------
All tests passed!
------------------------------------------------------------------------
Total time for all tests: 2.1 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 1.1 seconds
```




---

archive/issue_comments_143136.json:
```json
{
    "body": "I'm working on fixing these.  Thanks for the feedback!",
    "created_at": "2012-06-26T16:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143136",
    "user": "roed"
}
```

I'm working on fixing these.  Thanks for the feedback!



---

archive/issue_comments_143137.json:
```json
{
    "body": "Replying to [comment:60 jdemeyer]:\n> What does the `--serial` option do and how is it different from `-p 1`?\n\nThe `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.",
    "created_at": "2012-06-26T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143137",
    "user": "roed"
}
```

Replying to [comment:60 jdemeyer]:
> What does the `--serial` option do and how is it different from `-p 1`?

The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.



---

archive/issue_comments_143138.json:
```json
{
    "body": "Replying to [comment:62 jdemeyer]:\n> Perhaps add a `-T` option as a synonym for `--timeout`?\n\nDone.  Are there other options that should have a short form?  Maybe `-L` for `--long`?  I'd like to avoid too much mixing of upper and lower case....",
    "created_at": "2012-06-26T21:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143138",
    "user": "roed"
}
```

Replying to [comment:62 jdemeyer]:
> Perhaps add a `-T` option as a synonym for `--timeout`?

Done.  Are there other options that should have a short form?  Maybe `-L` for `--long`?  I'd like to avoid too much mixing of upper and lower case....



---

archive/issue_comments_143139.json:
```json
{
    "body": "There doesn't seem to be an objection to diverting `stderr`, so I'm going to not worry about keeping changes resulting from that decision separate (I don't want to update that patch since it requires rebuilding a lot of files).",
    "created_at": "2012-06-26T21:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143139",
    "user": "roed"
}
```

There doesn't seem to be an objection to diverting `stderr`, so I'm going to not worry about keeping changes resulting from that decision separate (I don't want to update that patch since it requires rebuilding a lot of files).



---

archive/issue_comments_143140.json:
```json
{
    "body": "Replying to [comment:63 jdemeyer]:\n> The following should report an error but doesn't:\n> {{{\n> jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py\n> Running doctests with ID 2012-06-26-14-14-08-06a01dbf.\n> Doctesting 1 file.\n> sage -t /home/jdemeyer/doctest/sig_on.py\n>     [1 tests, 1.1 s]\n> ------------------------------------------------------------------------\n> All tests passed!\n> ------------------------------------------------------------------------\n> Total time for all tests: 2.1 seconds\n>     cpu time: 0.1 seconds\n>     cumulative wall time: 1.1 seconds\n> }}}\n\nIf I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?",
    "created_at": "2012-06-26T21:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143140",
    "user": "roed"
}
```

Replying to [comment:63 jdemeyer]:
> The following should report an error but doesn't:
> {{{
> jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py
> Running doctests with ID 2012-06-26-14-14-08-06a01dbf.
> Doctesting 1 file.
> sage -t /home/jdemeyer/doctest/sig_on.py
>     [1 tests, 1.1 s]
> ------------------------------------------------------------------------
> All tests passed!
> ------------------------------------------------------------------------
> Total time for all tests: 2.1 seconds
>     cpu time: 0.1 seconds
>     cumulative wall time: 1.1 seconds
> }}}

If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?



---

archive/issue_comments_143141.json:
```json
{
    "body": "Replying to [comment:68 roed]:\n> Replying to [comment:63 jdemeyer]:\n> > The following should report an error but doesn't:\n> > {{{\n> > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py\n> > Running doctests with ID 2012-06-26-14-14-08-06a01dbf.\n> > Doctesting 1 file.\n> > sage -t /home/jdemeyer/doctest/sig_on.py\n> >     [1 tests, 1.1 s]\n> > ------------------------------------------------------------------------\n> > All tests passed!\n> > ------------------------------------------------------------------------\n> > Total time for all tests: 2.1 seconds\n> >     cpu time: 0.1 seconds\n> >     cumulative wall time: 1.1 seconds\n> > }}}\n> \n> If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?\n\nI can even run sage commands afterward, like `factor(2^199-1)`.  But if I hit Ctl-C, I get a segfault (and it screws up my terminal).",
    "created_at": "2012-06-26T22:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143141",
    "user": "roed"
}
```

Replying to [comment:68 roed]:
> Replying to [comment:63 jdemeyer]:
> > The following should report an error but doesn't:
> > {{{
> > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sig_on.py
> > Running doctests with ID 2012-06-26-14-14-08-06a01dbf.
> > Doctesting 1 file.
> > sage -t /home/jdemeyer/doctest/sig_on.py
> >     [1 tests, 1.1 s]
> > ------------------------------------------------------------------------
> > All tests passed!
> > ------------------------------------------------------------------------
> > Total time for all tests: 2.1 seconds
> >     cpu time: 0.1 seconds
> >     cumulative wall time: 1.1 seconds
> > }}}
> 
> If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?

I can even run sage commands afterward, like `factor(2^199-1)`.  But if I hit Ctl-C, I get a segfault (and it screws up my terminal).



---

archive/issue_comments_143142.json:
```json
{
    "body": "New version posted.  `sage -t --long -a` passes all tests except the one related to #13145.\n\n`/home/jdemeyer/doctest/keyboardinterrupt.py` passes if you remove the trailing colon.  I've updated the framework to recover a bit more gracefully if a doctest raises an unexpected KeyboardInterrupt, but it behaves a bit strangely since it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).  I think the new behavior is actually fairly reasonable: try it on your file without removing the colon.",
    "created_at": "2012-06-26T23:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143142",
    "user": "roed"
}
```

New version posted.  `sage -t --long -a` passes all tests except the one related to #13145.

`/home/jdemeyer/doctest/keyboardinterrupt.py` passes if you remove the trailing colon.  I've updated the framework to recover a bit more gracefully if a doctest raises an unexpected KeyboardInterrupt, but it behaves a bit strangely since it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).  I think the new behavior is actually fairly reasonable: try it on your file without removing the colon.



---

archive/issue_comments_143143.json:
```json
{
    "body": "Replying to [comment:63 jdemeyer]:\n> The doctesting framework seems to hang on\n> {{{\n> jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py\n> Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.\n> Doctesting 1 file.\n> }}}\n\nIs this behavior acceptable?  Eventually the test will time out (you can try running `sage -t -T 5 /home/jdemeyer/doctest/sigdie.py`) and the ending summary will be printed with a time out.",
    "created_at": "2012-06-26T23:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143143",
    "user": "roed"
}
```

Replying to [comment:63 jdemeyer]:
> The doctesting framework seems to hang on
> {{{
> jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py
> Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.
> Doctesting 1 file.
> }}}

Is this behavior acceptable?  Eventually the test will time out (you can try running `sage -t -T 5 /home/jdemeyer/doctest/sigdie.py`) and the ending summary will be printed with a time out.



---

archive/issue_comments_143144.json:
```json
{
    "body": "Replying to [comment:70 roed]:\n> it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).\n\nA \"real\" interrupt would interrupt also the master process, a fake doctest-interrupt only the child process.  That's an easy way to distinguish.",
    "created_at": "2012-06-27T07:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143144",
    "user": "jdemeyer"
}
```

Replying to [comment:70 roed]:
> it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).

A "real" interrupt would interrupt also the master process, a fake doctest-interrupt only the child process.  That's an easy way to distinguish.



---

archive/issue_comments_143145.json:
```json
{
    "body": "Replying to [comment:71 roed]:\n> Replying to [comment:63 jdemeyer]:\n> > The doctesting framework seems to hang on\n> > {{{\n> > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py\n> > Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.\n> > Doctesting 1 file.\n> > }}}\n> \n> Is this behavior acceptable?\nNot really.  One should get a message that Sage crashed (compare with the old doctesting framework).",
    "created_at": "2012-06-27T07:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143145",
    "user": "jdemeyer"
}
```

Replying to [comment:71 roed]:
> Replying to [comment:63 jdemeyer]:
> > The doctesting framework seems to hang on
> > {{{
> > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py
> > Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.
> > Doctesting 1 file.
> > }}}
> 
> Is this behavior acceptable?
Not really.  One should get a message that Sage crashed (compare with the old doctesting framework).



---

archive/issue_comments_143146.json:
```json
{
    "body": "Replying to [comment:68 roed]:\n> If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?\nLet me elaborate: #10030 added a check to the doctesting code which checks\n\n```\nsage: sig_on_count()\n0\n```\n\nafter each doctest (i.e. it appends this to every doctest), to ensure there are no unbalanced `sig_on()`s.  Could you add this also to your doctesting framework?",
    "created_at": "2012-06-27T07:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143146",
    "user": "jdemeyer"
}
```

Replying to [comment:68 roed]:
> If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?
Let me elaborate: #10030 added a check to the doctesting code which checks

```
sage: sig_on_count()
0
```

after each doctest (i.e. it appends this to every doctest), to ensure there are no unbalanced `sig_on()`s.  Could you add this also to your doctesting framework?



---

archive/issue_comments_143147.json:
```json
{
    "body": "Replying to [comment:72 jdemeyer]:\n> Replying to [comment:70 roed]:\n> > it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).\n> \n> A \"real\" interrupt would interrupt also the master process, a fake doctest-interrupt only the child process.  That's an easy way to distinguish.\n\nSure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.  The parent process can continue the doctests though....",
    "created_at": "2012-06-27T08:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143147",
    "user": "roed"
}
```

Replying to [comment:72 jdemeyer]:
> Replying to [comment:70 roed]:
> > it's difficult to distinguish between an actual interrupt (in which case the testing should terminate) and one raised by a doctest (in which case tests of other files could continue).
> 
> A "real" interrupt would interrupt also the master process, a fake doctest-interrupt only the child process.  That's an easy way to distinguish.

Sure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.  The parent process can continue the doctests though....



---

archive/issue_comments_143148.json:
```json
{
    "body": "Replying to [comment:73 jdemeyer]:\n> Replying to [comment:71 roed]:\n> > Replying to [comment:63 jdemeyer]:\n> > > The doctesting framework seems to hang on\n> > > {{{\n> > > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py\n> > > Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.\n> > > Doctesting 1 file.\n> > > }}}\n> > \n> > Is this behavior acceptable?\n> Not really.  One should get a message that Sage crashed (compare with the old doctesting framework).\nOkay, I will look into it.  I assume that the underlying process has terminated and I should be able to get at the exit code somehow.",
    "created_at": "2012-06-27T08:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143148",
    "user": "roed"
}
```

Replying to [comment:73 jdemeyer]:
> Replying to [comment:71 roed]:
> > Replying to [comment:63 jdemeyer]:
> > > The doctesting framework seems to hang on
> > > {{{
> > > jdemeyer`@`sage:/release/merger/sage-5.1.beta5-12415$ ./sage -t /home/jdemeyer/doctest/sigdie.py
> > > Running doctests with ID 2012-06-26-14-12-55-fbefc7c4.
> > > Doctesting 1 file.
> > > }}}
> > 
> > Is this behavior acceptable?
> Not really.  One should get a message that Sage crashed (compare with the old doctesting framework).
Okay, I will look into it.  I assume that the underlying process has terminated and I should be able to get at the exit code somehow.



---

archive/issue_comments_143149.json:
```json
{
    "body": "Replying to [comment:74 jdemeyer]:\n> Replying to [comment:68 roed]:\n> > If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?\n> Let me elaborate: #10030 added a check to the doctesting code which checks\n> {{{\n> sage: sig_on_count()\n> 0\n> }}}\n> after each doctest (i.e. it appends this to every doctest), to ensure there are no unbalanced `sig_on()`s.  Could you add this also to your doctesting framework?\n\nThis shouldn't be too hard.",
    "created_at": "2012-06-27T08:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143149",
    "user": "roed"
}
```

Replying to [comment:74 jdemeyer]:
> Replying to [comment:68 roed]:
> > If I do `cython('sig_on()')` at the command line nothing happens.  Is it supposed to crash Sage?
> Let me elaborate: #10030 added a check to the doctesting code which checks
> {{{
> sage: sig_on_count()
> 0
> }}}
> after each doctest (i.e. it appends this to every doctest), to ensure there are no unbalanced `sig_on()`s.  Could you add this also to your doctesting framework?

This shouldn't be too hard.



---

archive/issue_comments_143150.json:
```json
{
    "body": "Replying to [comment:46 roed]:\n> Alright, I'm going to start running tests.  There are still some remaining issues, but the patches are in a state where someone else might want to look at them.  :-)\n> \n> Remaining problems:\n> \n>  * #13145 needs work, generating some doctest failures related to deallocating multivariate polynomials\n>  * hg_sage seems to be broken, causing the --new option to fail\n>  * valgrinding `sage -t` doesn't work; I'm not sure whether it did before\n>  * The new code doesn't support xml output\n> \n> I'll see if I find more when running `sage -t --all`.\n\n\nI'm going to sleep; let me know which of these need to be fixed in order for this ticket to get a positive review.  I will also keep working on the tests in `/home/jdemeyer/doctest/`.  And of course if you find more problems or have other feature requests, keep those coming too!",
    "created_at": "2012-06-27T08:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143150",
    "user": "roed"
}
```

Replying to [comment:46 roed]:
> Alright, I'm going to start running tests.  There are still some remaining issues, but the patches are in a state where someone else might want to look at them.  :-)
> 
> Remaining problems:
> 
>  * #13145 needs work, generating some doctest failures related to deallocating multivariate polynomials
>  * hg_sage seems to be broken, causing the --new option to fail
>  * valgrinding `sage -t` doesn't work; I'm not sure whether it did before
>  * The new code doesn't support xml output
> 
> I'll see if I find more when running `sage -t --all`.


I'm going to sleep; let me know which of these need to be fixed in order for this ticket to get a positive review.  I will also keep working on the tests in `/home/jdemeyer/doctest/`.  And of course if you find more problems or have other feature requests, keep those coming too!



---

archive/issue_comments_143151.json:
```json
{
    "body": "Replying to [comment:75 roed]:\n> Sure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.\nOkay, I see what you mean.  I would propose not to special-case `KeyboardInterrupt` at all in the child process.  When the parent process gets a `KeyboardInterrupt`, kill all child processes (without showing their output) and exit.\n\n(note: since the old doctesting framework didn't do this either, I don't consider this a prerequisite for positive review, but a nice feature to have.)",
    "created_at": "2012-06-27T17:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143151",
    "user": "jdemeyer"
}
```

Replying to [comment:75 roed]:
> Sure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.
Okay, I see what you mean.  I would propose not to special-case `KeyboardInterrupt` at all in the child process.  When the parent process gets a `KeyboardInterrupt`, kill all child processes (without showing their output) and exit.

(note: since the old doctesting framework didn't do this either, I don't consider this a prerequisite for positive review, but a nice feature to have.)



---

archive/issue_comments_143152.json:
```json
{
    "body": "Replying to [comment:65 roed]:\n> Replying to [comment:60 jdemeyer]:\n> > What does the `--serial` option do and how is it different from `-p 1`?\n> \n> The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.\nI suppose you mean \"process\", not thread?  Still, I don't see the point of `--serial`.",
    "created_at": "2012-06-27T17:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143152",
    "user": "jdemeyer"
}
```

Replying to [comment:65 roed]:
> Replying to [comment:60 jdemeyer]:
> > What does the `--serial` option do and how is it different from `-p 1`?
> 
> The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.
I suppose you mean "process", not thread?  Still, I don't see the point of `--serial`.



---

archive/issue_comments_143153.json:
```json
{
    "body": "Replying to [comment:80 jdemeyer]:\n> Replying to [comment:65 roed]:\n> > Replying to [comment:60 jdemeyer]:\n> > > What does the `--serial` option do and how is it different from `-p 1`?\n> > \n> > The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.\n> I suppose you mean \"process\", not thread?  Still, I don't see the point of `--serial`.\n\nThe main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)\n\nI'm fine making it less prominent (having it not show up in the help display for `sage -t` for example, and not using it for `--verbose` mode).  But I think it should stick around since it currently exists, and it makes some kinds of bugs much easier to track down.",
    "created_at": "2012-06-27T21:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143153",
    "user": "roed"
}
```

Replying to [comment:80 jdemeyer]:
> Replying to [comment:65 roed]:
> > Replying to [comment:60 jdemeyer]:
> > > What does the `--serial` option do and how is it different from `-p 1`?
> > 
> > The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.
> I suppose you mean "process", not thread?  Still, I don't see the point of `--serial`.

The main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)

I'm fine making it less prominent (having it not show up in the help display for `sage -t` for example, and not using it for `--verbose` mode).  But I think it should stick around since it currently exists, and it makes some kinds of bugs much easier to track down.



---

archive/issue_comments_143154.json:
```json
{
    "body": "Replying to [comment:81 roed]:\n> Replying to [comment:80 jdemeyer]:\n> > Replying to [comment:65 roed]:\n> > > Replying to [comment:60 jdemeyer]:\n> > > > What does the `--serial` option do and how is it different from `-p 1`?\n> > > \n> > > The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.\n> > I suppose you mean \"process\", not thread?  Still, I don't see the point of `--serial`.\n> \n> The main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)\n> \n> I'm fine making it less prominent (having it not show up in the help display for `sage -t` for example, and not using it for `--verbose` mode).  But I think it should stick around since it currently exists, and it makes some kinds of bugs much easier to track down.\n\nI'm also using it for `--gdb` since it makes the tracebacks simpler, though I'm not sure that's necessary.\n\nDo you ever use `sage -t` with valgrind?  I'm not sure exactly what's wrong with `sage -t --valgrind <FILENAME>`.",
    "created_at": "2012-06-27T21:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143154",
    "user": "roed"
}
```

Replying to [comment:81 roed]:
> Replying to [comment:80 jdemeyer]:
> > Replying to [comment:65 roed]:
> > > Replying to [comment:60 jdemeyer]:
> > > > What does the `--serial` option do and how is it different from `-p 1`?
> > > 
> > > The `-p 1` has one worker: there's another thread which collates and prints answers.  `-p 1` is the default.
> > I suppose you mean "process", not thread?  Still, I don't see the point of `--serial`.
> 
> The main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)
> 
> I'm fine making it less prominent (having it not show up in the help display for `sage -t` for example, and not using it for `--verbose` mode).  But I think it should stick around since it currently exists, and it makes some kinds of bugs much easier to track down.

I'm also using it for `--gdb` since it makes the tracebacks simpler, though I'm not sure that's necessary.

Do you ever use `sage -t` with valgrind?  I'm not sure exactly what's wrong with `sage -t --valgrind <FILENAME>`.



---

archive/issue_comments_143155.json:
```json
{
    "body": "Replying to [comment:79 jdemeyer]:\n> Replying to [comment:75 roed]:\n> > Sure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.\n> Okay, I see what you mean.  I would propose not to special-case `KeyboardInterrupt` at all in the child process.  When the parent process gets a `KeyboardInterrupt`, kill all child processes (without showing their output) and exit.\n> \n> (note: since the old doctesting framework didn't do this either, I don't consider this a prerequisite for positive review, but a nice feature to have.)\n\nI just tried changing the interrupt handling so that `KeyboardInterrupt` is handled in the parent process and it doesn't work as well: there's extraneous printing happening when the doctest framework thinks it's just printing an unexpected exception, and I don't see a good way to get rid of it.\n\nI think the current handling of KeyboardInterrupts is fine.",
    "created_at": "2012-06-28T04:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143155",
    "user": "roed"
}
```

Replying to [comment:79 jdemeyer]:
> Replying to [comment:75 roed]:
> > Sure, and for reporting what happened to the user this is fine.  But from the child process' perspective, an unexpected `KeyboardInterrupt` has been raised and it should stop testing that file.
> Okay, I see what you mean.  I would propose not to special-case `KeyboardInterrupt` at all in the child process.  When the parent process gets a `KeyboardInterrupt`, kill all child processes (without showing their output) and exit.
> 
> (note: since the old doctesting framework didn't do this either, I don't consider this a prerequisite for positive review, but a nice feature to have.)

I just tried changing the interrupt handling so that `KeyboardInterrupt` is handled in the parent process and it doesn't work as well: there's extraneous printing happening when the doctest framework thinks it's just printing an unexpected exception, and I don't see a good way to get rid of it.

I think the current handling of KeyboardInterrupts is fine.



---

archive/issue_comments_143156.json:
```json
{
    "body": "I'm going to be offline until Tuesday.  More feedback while I'm gone would be great.  :-)",
    "created_at": "2012-06-28T21:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143156",
    "user": "roed"
}
```

I'm going to be offline until Tuesday.  More feedback while I'm gone would be great.  :-)



---

archive/issue_comments_143157.json:
```json
{
    "body": "As far as I understand it, this new framework should allow for the same commands (e.g., `sage -tp 6 --long devel/sage/sage/matrix/`). In addition, though, there are new command-line options to `sage-runtest`, which should available through `sage -t ...`, right? Which of these new options should be documented in the help messages `usage` and/or `usage_advanced` at the top of `spkg/bin/sage`? Which should be documented in the developer's guide?",
    "created_at": "2012-06-29T20:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143157",
    "user": "jhpalmieri"
}
```

As far as I understand it, this new framework should allow for the same commands (e.g., `sage -tp 6 --long devel/sage/sage/matrix/`). In addition, though, there are new command-line options to `sage-runtest`, which should available through `sage -t ...`, right? Which of these new options should be documented in the help messages `usage` and/or `usage_advanced` at the top of `spkg/bin/sage`? Which should be documented in the developer's guide?



---

archive/issue_comments_143158.json:
```json
{
    "body": "I'm back, and I've been working on a patch to the developer's guide.  I'll post something soon, and more comments on which options will be shown in usage.",
    "created_at": "2012-07-03T03:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143158",
    "user": "roed"
}
```

I'm back, and I've been working on a patch to the developer's guide.  I'll post something soon, and more comments on which options will be shown in usage.



---

archive/issue_comments_143159.json:
```json
{
    "body": "I'm going to build and test Sage again with these patches.  Stay tuned...",
    "created_at": "2012-07-07T21:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143159",
    "user": "jdemeyer"
}
```

I'm going to build and test Sage again with these patches.  Stay tuned...



---

archive/issue_comments_143160.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-07T22:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143160",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143161.json:
```json
{
    "body": "Needs to be rebased to #11871.",
    "created_at": "2012-07-07T22:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143161",
    "user": "jdemeyer"
}
```

Needs to be rebased to #11871.



---

archive/issue_comments_143162.json:
```json
{
    "body": "Replying to [comment:89 jdemeyer]:\n> Needs to be rebased to #11871.\n\nDone.  I will make sure the suggestions in comment 56 are addressed.",
    "created_at": "2012-07-08T02:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143162",
    "user": "roed"
}
```

Replying to [comment:89 jdemeyer]:
> Needs to be rebased to #11871.

Done.  I will make sure the suggestions in comment 56 are addressed.



---

archive/issue_comments_143163.json:
```json
{
    "body": "The change to 12415_script.patch fixes a problem with interrupting doctests on sage.math.",
    "created_at": "2012-07-08T09:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143163",
    "user": "roed"
}
```

The change to 12415_script.patch fixes a problem with interrupting doctests on sage.math.



---

archive/issue_comments_143164.json:
```json
{
    "body": "When doing `make ptest` and `make ptestlong`, all doctests are run but there is no summary at the end.  The processes end with exit code 132 (which usually means an Illegal Instruction but probably not here).\n\nThe following are the last lines output by `make ptest` and `make ptestlong`:\n\n```\nsage -t devel/sage/doc/en/thematic_tutorials/lie/weyl_groups.rst\n    [44 tests, 4.6 s]\nsage -t devel/sage/doc/fr/tutorial/tour_plotting.rst\n    [35 tests, 9.2 s]\nsage -t devel/sage/doc/de/tutorial/tour_plotting.rst\n    [51 tests, 10.7 s]\nsage -t devel/sage/doc/en/tutorial/tour_plotting.rst\n    [51 tests, 10.9 s]\nsage -t devel/sage/doc/ru/tutorial/tour_plotting.rst\n    [46 tests, 10.9 s]\n```\n\nand\n\n```\nsage -t --long devel/sage/sage/combinat/crystals/__init__.py\n    [0 tests, 0.0 s]\nsage -t --long devel/sage/sage/gsl/callback.pyx\n    [0 tests, 0.0 s]\nsage -t --long devel/sage/sage/ext/python_module.pxi\n    [0 tests, 0.0 s]\nsage -t --long devel/sage/sage/groups/perm_gps/all.py\n    [0 tests, 0.0 s]\nsage -t --long devel/sage/doc/en/bordeaux_2008/modular_forms_and_hecke_operators.rst\n    [0 tests, 0.0 s]\n```\n",
    "created_at": "2012-07-09T06:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143164",
    "user": "jdemeyer"
}
```

When doing `make ptest` and `make ptestlong`, all doctests are run but there is no summary at the end.  The processes end with exit code 132 (which usually means an Illegal Instruction but probably not here).

The following are the last lines output by `make ptest` and `make ptestlong`:

```
sage -t devel/sage/doc/en/thematic_tutorials/lie/weyl_groups.rst
    [44 tests, 4.6 s]
sage -t devel/sage/doc/fr/tutorial/tour_plotting.rst
    [35 tests, 9.2 s]
sage -t devel/sage/doc/de/tutorial/tour_plotting.rst
    [51 tests, 10.7 s]
sage -t devel/sage/doc/en/tutorial/tour_plotting.rst
    [51 tests, 10.9 s]
sage -t devel/sage/doc/ru/tutorial/tour_plotting.rst
    [46 tests, 10.9 s]
```

and

```
sage -t --long devel/sage/sage/combinat/crystals/__init__.py
    [0 tests, 0.0 s]
sage -t --long devel/sage/sage/gsl/callback.pyx
    [0 tests, 0.0 s]
sage -t --long devel/sage/sage/ext/python_module.pxi
    [0 tests, 0.0 s]
sage -t --long devel/sage/sage/groups/perm_gps/all.py
    [0 tests, 0.0 s]
sage -t --long devel/sage/doc/en/bordeaux_2008/modular_forms_and_hecke_operators.rst
    [0 tests, 0.0 s]
```




---

archive/issue_comments_143165.json:
```json
{
    "body": "Then I get the following `make ptestlong` failures:\n\n```\nRunning doctests with ID 2012-07-08-23-57-28-0d45df42.\nDoctesting the Sage notebook.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 2067 files using 6 threads.\nUsage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)\n\nsage-runtests: error: no such option: -p\nsage -t --long devel/sage/doc/common/builder.py\n    Bad exit: 2\n********************************************************************************\nTests run before process failed:\n\n********************************************************************************\nsage -t --long devel/sage/sage/tests/interrupt.pyx\n    [80 tests, 15.0 s]\n```\n\n\n```\nsage -t --long devel/sage/sage/matrix/matrix2.pyx\n    [1980 tests, 24.9 s]\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 272, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"All tests passed!\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 277, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"All tests passed!\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   2 of 185 in sage.tests.cmdline.test_executable\n***Test Failed*** 2 failures.\nsage -t --long devel/sage/sage/tests/cmdline.py\n    [184 tests, 23.0 s]\n```\n\n\n```\n**********************************************************************\nFile \"devel/sage/sage/doctest/control.py\", line 263, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC = DocTestController(DD, [])\nException raised:\n    Traceback (most recent call last):\n      File \"/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 590, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 881, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[2]>\", line 1, in <module>\n        DC = DocTestController(DD, [])\n      File \"/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 142, in __init__\n        print \"Unable to open logfile at %s\\nProceeding without logging.\"%(self.logfile)\n    AttributeError: 'DocTestController' object has no attribute 'logfile'\n**********************************************************************\n```\n\n+ errors related to #13145.",
    "created_at": "2012-07-09T06:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143165",
    "user": "jdemeyer"
}
```

Then I get the following `make ptestlong` failures:

```
Running doctests with ID 2012-07-08-23-57-28-0d45df42.
Doctesting the Sage notebook.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 2067 files using 6 threads.
Usage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)

sage-runtests: error: no such option: -p
sage -t --long devel/sage/doc/common/builder.py
    Bad exit: 2
********************************************************************************
Tests run before process failed:

********************************************************************************
sage -t --long devel/sage/sage/tests/interrupt.pyx
    [80 tests, 15.0 s]
```


```
sage -t --long devel/sage/sage/matrix/matrix2.pyx
    [1980 tests, 24.9 s]
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 272, in sage.tests.cmdline.test_executable
Failed example:
    out.find("All tests passed!") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 277, in sage.tests.cmdline.test_executable
Failed example:
    out.find("All tests passed!") >= 0
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   2 of 185 in sage.tests.cmdline.test_executable
***Test Failed*** 2 failures.
sage -t --long devel/sage/sage/tests/cmdline.py
    [184 tests, 23.0 s]
```


```
**********************************************************************
File "devel/sage/sage/doctest/control.py", line 263, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC = DocTestController(DD, [])
Exception raised:
    Traceback (most recent call last):
      File "/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 590, in _run
        self.execute(example, compiled, test.globs)
      File "/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 881, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[2]>", line 1, in <module>
        DC = DocTestController(DD, [])
      File "/release/merger/sage-5.1.rc0-12415/local/lib/python2.7/site-packages/sage/doctest/control.py", line 142, in __init__
        print "Unable to open logfile at %s\nProceeding without logging."%(self.logfile)
    AttributeError: 'DocTestController' object has no attribute 'logfile'
**********************************************************************
```

+ errors related to #13145.



---

archive/issue_comments_143166.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-12T08:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143166",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143167.json:
```json
{
    "body": "I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`: after the change I ran `sage -tp --sagenb --long devel/sage/doc/common devel/sage/doc/[a-z][a-z] devel/sage/sage` 10 times with no failures (where before there had been 5 failures in `interrupt.pyx`).  But I just got another one.  Maybe it has to do with the load on sage.math?  There are more processes running now than when I ran the test earlier.\n\nJeroen, would you be willing to take a look at it since you wrote the tests in that file?\n\nAll the other tests pass for me, with the exception of startup.py.",
    "created_at": "2012-07-12T08:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143167",
    "user": "roed"
}
```

I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`: after the change I ran `sage -tp --sagenb --long devel/sage/doc/common devel/sage/doc/[a-z][a-z] devel/sage/sage` 10 times with no failures (where before there had been 5 failures in `interrupt.pyx`).  But I just got another one.  Maybe it has to do with the load on sage.math?  There are more processes running now than when I ran the test earlier.

Jeroen, would you be willing to take a look at it since you wrote the tests in that file?

All the other tests pass for me, with the exception of startup.py.



---

archive/issue_comments_143168.json:
```json
{
    "body": "Rebased the scripts patch to sage-5.1.",
    "created_at": "2012-07-12T08:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143168",
    "user": "jdemeyer"
}
```

Rebased the scripts patch to sage-5.1.



---

archive/issue_comments_143169.json:
```json
{
    "body": "The sagenb patch doesn't apply to the new notebook (#11080).",
    "created_at": "2012-07-12T08:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143169",
    "user": "jdemeyer"
}
```

The sagenb patch doesn't apply to the new notebook (#11080).



---

archive/issue_comments_143170.json:
```json
{
    "body": "Replying to [comment:94 roed]:\n> I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`\nThe tests *should* be designed in such a way that they work regardless of the delay.",
    "created_at": "2012-07-12T08:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143170",
    "user": "jdemeyer"
}
```

Replying to [comment:94 roed]:
> I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`
The tests *should* be designed in such a way that they work regardless of the delay.



---

archive/issue_comments_143171.json:
```json
{
    "body": "Replying to [comment:98 jdemeyer]:\n> Replying to [comment:94 roed]:\n> > I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`\n> The tests *should* be designed in such a way that they work regardless of the delay.\n\nAgreed, but I'm at a loss for what's causing the problem, and it's difficult to debug since it's sporadic and a segfault.",
    "created_at": "2012-07-12T08:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143171",
    "user": "roed"
}
```

Replying to [comment:98 jdemeyer]:
> Replying to [comment:94 roed]:
> > I thought I'd solved the sporadic problem in sage.tests.interrupt by increasing the delays in `test_sig_block_outside_sig_on`
> The tests *should* be designed in such a way that they work regardless of the delay.

Agreed, but I'm at a loss for what's causing the problem, and it's difficult to debug since it's sporadic and a segfault.



---

archive/issue_comments_143172.json:
```json
{
    "body": "I have added some changes to `local/bin/.hgignore` to the scripts patch.  I discovered there was a problem when I put the file `sage-runtests` in `local/bin` without adding it using `hg`.  Surprisingly, `hg status` didn't show `sage-runtests`.",
    "created_at": "2012-07-12T13:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143172",
    "user": "jdemeyer"
}
```

I have added some changes to `local/bin/.hgignore` to the scripts patch.  I discovered there was a problem when I put the file `sage-runtests` in `local/bin` without adding it using `hg`.  Surprisingly, `hg status` didn't show `sage-runtests`.



---

archive/issue_comments_143173.json:
```json
{
    "body": "I updated the sagenb patch",
    "created_at": "2012-07-13T06:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143173",
    "user": "roed"
}
```

I updated the sagenb patch



---

archive/issue_comments_143174.json:
```json
{
    "body": "I imported the patch: https://github.com/sagemath/sagenb/pull/84\n\nI'll cut a sagenb 0.10.2 release with this fix in it (and put it on #13121). Jeroen, are you aware of any other tickets with bugfix-type patches to sagenb which I could merge at the same time?",
    "created_at": "2012-07-13T06:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143174",
    "user": "kini"
}
```

I imported the patch: https://github.com/sagemath/sagenb/pull/84

I'll cut a sagenb 0.10.2 release with this fix in it (and put it on #13121). Jeroen, are you aware of any other tickets with bugfix-type patches to sagenb which I could merge at the same time?



---

archive/issue_comments_143175.json:
```json
{
    "body": "Actually, since this doctest fix actually breaks doctests with the current doctesting framework, should I leave this patch for sagenb 0.11 or something? How close would you say this ticket is to positive review? I notice it's set to milestone 5.3, whereas I'm hoping that #13121 can get into 5.2, so maybe that is the way to go.",
    "created_at": "2012-07-13T07:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143175",
    "user": "kini"
}
```

Actually, since this doctest fix actually breaks doctests with the current doctesting framework, should I leave this patch for sagenb 0.11 or something? How close would you say this ticket is to positive review? I notice it's set to milestone 5.3, whereas I'm hoping that #13121 can get into 5.2, so maybe that is the way to go.



---

archive/issue_comments_143176.json:
```json
{
    "body": "Replying to [comment:103 kini]:\n> Actually, since this doctest fix actually breaks doctests with the current doctesting framework, should I leave this patch for sagenb 0.11 or something?\nYes please.\n\n> How close would you say this ticket is to positive review?\nI think it's mostly finished, but since this is a big change, I'm certainly not merging it in sage-5.2. Also, there is a good chance that various small issues will come up here.\n\n> I notice it's set to milestone 5.3, whereas I'm hoping that #13121 can get into 5.2, so maybe that is the way to go.\nYes.",
    "created_at": "2012-07-13T07:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143176",
    "user": "jdemeyer"
}
```

Replying to [comment:103 kini]:
> Actually, since this doctest fix actually breaks doctests with the current doctesting framework, should I leave this patch for sagenb 0.11 or something?
Yes please.

> How close would you say this ticket is to positive review?
I think it's mostly finished, but since this is a big change, I'm certainly not merging it in sage-5.2. Also, there is a good chance that various small issues will come up here.

> I notice it's set to milestone 5.3, whereas I'm hoping that #13121 can get into 5.2, so maybe that is the way to go.
Yes.



---

archive/issue_comments_143177.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-13T08:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143177",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143178.json:
```json
{
    "body": "Just one failure remaining related to this ticket:\n\n```\n**********************************************************************\nFile \"devel/sage/sage/doctest/control.py\", line 258, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC = DocTestController(DD, [])\nExpected nothing\nGot:\n    Unable to open logfile at /release/merger/sage-5.1-12415/home/.sage//tmp/test.log\n    Proceeding without logging.\nsage -t devel/sage/sage/ext/gmp.pxi\n    [0 tests, 0.0 s]\n**********************************************************************\n1 items had failures:\n   1 of  15 in sage.doctest.control.DocTestController.add_files\n***Test Failed*** 1 failures.\nsage -t devel/sage/sage/doctest/control.py\n    [115 tests, 3.6 s]\n```\n\n\nBut also the formatting of the above failure looks strange:\n\n1) Why does\n\n```\nsage -t devel/sage/sage/ext/gmp.pxi\n    [0 tests, 0.0 s]\n```\n\nappear in the middle of the failure?\n\n2) Could you format the output as\n\n```\nsage -t devel/sage/sage/doctest/control.py\n**********************************************************************\n[...failure...]\n**********************************************************************\n1 items had failures:\n   1 of  15 in sage.doctest.control.DocTestController.add_files\n***Test Failed*** 1 failures.\n    [115 tests, 3.6 s]\n```\n\n\nI would even shorten the last two lines to\n\n```\n    [115 tests, 1 failed, 3.6 s]\n```\n\n\nAnd I would add a function like\n\n```\ndef count_noun(number, noun):\n    if number == 1:\n        return \"1 %s\"%noun\n    else:\n        return \"%d %ss\"%(number,noun)\n```\n\nSo you can do\n\n```\nprint count_noun(n, 'item'), \"had failures\"\n```\n",
    "created_at": "2012-07-13T08:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143178",
    "user": "jdemeyer"
}
```

Just one failure remaining related to this ticket:

```
**********************************************************************
File "devel/sage/sage/doctest/control.py", line 258, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC = DocTestController(DD, [])
Expected nothing
Got:
    Unable to open logfile at /release/merger/sage-5.1-12415/home/.sage//tmp/test.log
    Proceeding without logging.
sage -t devel/sage/sage/ext/gmp.pxi
    [0 tests, 0.0 s]
**********************************************************************
1 items had failures:
   1 of  15 in sage.doctest.control.DocTestController.add_files
***Test Failed*** 1 failures.
sage -t devel/sage/sage/doctest/control.py
    [115 tests, 3.6 s]
```


But also the formatting of the above failure looks strange:

1) Why does

```
sage -t devel/sage/sage/ext/gmp.pxi
    [0 tests, 0.0 s]
```

appear in the middle of the failure?

2) Could you format the output as

```
sage -t devel/sage/sage/doctest/control.py
**********************************************************************
[...failure...]
**********************************************************************
1 items had failures:
   1 of  15 in sage.doctest.control.DocTestController.add_files
***Test Failed*** 1 failures.
    [115 tests, 3.6 s]
```


I would even shorten the last two lines to

```
    [115 tests, 1 failed, 3.6 s]
```


And I would add a function like

```
def count_noun(number, noun):
    if number == 1:
        return "1 %s"%noun
    else:
        return "%d %ss"%(number,noun)
```

So you can do

```
print count_noun(n, 'item'), "had failures"
```




---

archive/issue_comments_143179.json:
```json
{
    "body": "The `KeyboardInterrupt` example [http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py](http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py) still doesn't work correctly:\n\n```\nRunning doctests with ID 2012-07-13-10-53-02-ed232e22.\nDoctesting 1 file.\nsage -t /home/jdemeyer/doctest/keyboardinterrupt.py\n    Unexpected KeyboardInterrupt raised in file\n********************************************************************************\nTests run before interrupt:\nsage: raise KeyboardInterrupt ## line 2 ##\n\n********************************************************************************\n------------------------------------------------------------------------\nsage -t /home/jdemeyer/doctest/keyboardinterrupt.py # Unhandled KeyboardInterrupt\n------------------------------------------------------------------------\nTotal time for all tests: 1.1 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\nThe expected result is that the test passes.  I don't mind if you don't fix this (currently, it's also broken), but I thought you should know...",
    "created_at": "2012-07-13T08:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143179",
    "user": "jdemeyer"
}
```

The `KeyboardInterrupt` example [http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py](http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py) still doesn't work correctly:

```
Running doctests with ID 2012-07-13-10-53-02-ed232e22.
Doctesting 1 file.
sage -t /home/jdemeyer/doctest/keyboardinterrupt.py
    Unexpected KeyboardInterrupt raised in file
********************************************************************************
Tests run before interrupt:
sage: raise KeyboardInterrupt ## line 2 ##

********************************************************************************
------------------------------------------------------------------------
sage -t /home/jdemeyer/doctest/keyboardinterrupt.py # Unhandled KeyboardInterrupt
------------------------------------------------------------------------
Total time for all tests: 1.1 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```

The expected result is that the test passes.  I don't mind if you don't fix this (currently, it's also broken), but I thought you should know...



---

archive/issue_comments_143180.json:
```json
{
    "body": "Concerning the logfile error: I think you are making the mistaken assumption that `$SAGE_TESTDIR` is an existing directory. But I also find it  strange that a *doctest* writes to a logfile inside `SAGE_TESTDIR`, I don't really like that.",
    "created_at": "2012-07-13T09:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143180",
    "user": "jdemeyer"
}
```

Concerning the logfile error: I think you are making the mistaken assumption that `$SAGE_TESTDIR` is an existing directory. But I also find it  strange that a *doctest* writes to a logfile inside `SAGE_TESTDIR`, I don't really like that.



---

archive/issue_comments_143181.json:
```json
{
    "body": "When testing `sage/tests/interrupt.pyx` verbosely, I regularly get errors of the form\n\n```\n[...]\nTrying (line 637):    test_try_finally_signal()\nExpecting:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Aborted\nok [0.23s]\nTrying (line 100631):    sig_on_count()\nExpecting:\n    0\nok [0.00s]\nsage -t --long devel/sage/sage/tests/interrupt.pyx\nTraceback (most recent call last):\n  File \"/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1634, in __call__\n  File \"/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 725, in run\n  File \"/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 556, in _run\nAttributeError: Example instance has no attribute 'options'\n\n------------------------------------------------------------------------\nsage -t --long devel/sage/sage/tests/interrupt.pyx # AttributeError in loading\n------------------------------------------------------------------------\nTotal time for all tests: 12.7 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\n\nThis looks like a bug in the doctesting framework (unless somehow the interrupt tests corrupt the doctest process?)",
    "created_at": "2012-07-13T14:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143181",
    "user": "jdemeyer"
}
```

When testing `sage/tests/interrupt.pyx` verbosely, I regularly get errors of the form

```
[...]
Trying (line 637):    test_try_finally_signal()
Expecting:
    Traceback (most recent call last):
    ...
    RuntimeError: Aborted
ok [0.23s]
Trying (line 100631):    sig_on_count()
Expecting:
    0
ok [0.00s]
sage -t --long devel/sage/sage/tests/interrupt.pyx
Traceback (most recent call last):
  File "/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1634, in __call__
  File "/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 725, in run
  File "/release/merger/sage-5.1-12415/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 556, in _run
AttributeError: Example instance has no attribute 'options'

------------------------------------------------------------------------
sage -t --long devel/sage/sage/tests/interrupt.pyx # AttributeError in loading
------------------------------------------------------------------------
Total time for all tests: 12.7 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```


This looks like a bug in the doctesting framework (unless somehow the interrupt tests corrupt the doctest process?)



---

archive/issue_comments_143182.json:
```json
{
    "body": "Replying to [comment:106 jdemeyer]:\n> The `KeyboardInterrupt` example [http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py](http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py) still doesn't work correctly:\n> {{{\n> Running doctests with ID 2012-07-13-10-53-02-ed232e22.\n> Doctesting 1 file.\n> sage -t /home/jdemeyer/doctest/keyboardinterrupt.py\n>     Unexpected KeyboardInterrupt raised in file\n> ********************************************************************************\n> Tests run before interrupt:\n> sage: raise KeyboardInterrupt ## line 2 ##\n> \n> ********************************************************************************\n> ------------------------------------------------------------------------\n> sage -t /home/jdemeyer/doctest/keyboardinterrupt.py # Unhandled KeyboardInterrupt\n> ------------------------------------------------------------------------\n> Total time for all tests: 1.1 seconds\n>     cpu time: 0.0 seconds\n>     cumulative wall time: 0.0 seconds\n> }}}\n> The expected result is that the test passes.  I don't mind if you don't fix this (currently, it's also broken), but I thought you should know...\n\nThat's because your expected output has an extra colon.  If you delete the trailing colon it passes tests.\n\nWith the extra colon it's an unexpected `KeyboardInterrupt`.",
    "created_at": "2012-07-13T19:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143182",
    "user": "roed"
}
```

Replying to [comment:106 jdemeyer]:
> The `KeyboardInterrupt` example [http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py](http://boxen.math.washington.edu/home/jdemeyer/doctest/keyboardinterrupt.py) still doesn't work correctly:
> {{{
> Running doctests with ID 2012-07-13-10-53-02-ed232e22.
> Doctesting 1 file.
> sage -t /home/jdemeyer/doctest/keyboardinterrupt.py
>     Unexpected KeyboardInterrupt raised in file
> ********************************************************************************
> Tests run before interrupt:
> sage: raise KeyboardInterrupt ## line 2 ##
> 
> ********************************************************************************
> ------------------------------------------------------------------------
> sage -t /home/jdemeyer/doctest/keyboardinterrupt.py # Unhandled KeyboardInterrupt
> ------------------------------------------------------------------------
> Total time for all tests: 1.1 seconds
>     cpu time: 0.0 seconds
>     cumulative wall time: 0.0 seconds
> }}}
> The expected result is that the test passes.  I don't mind if you don't fix this (currently, it's also broken), but I thought you should know...

That's because your expected output has an extra colon.  If you delete the trailing colon it passes tests.

With the extra colon it's an unexpected `KeyboardInterrupt`.



---

archive/issue_comments_143183.json:
```json
{
    "body": "Replying to [comment:105 jdemeyer]:\n> Just one failure remaining related to this ticket:\n> {{{\n> **********************************************************************\n> File \"devel/sage/sage/doctest/control.py\", line 258, in sage.doctest.control.DocTestController.add_files\n> Failed example:\n>     DC = DocTestController(DD, [])\n> Expected nothing\n> Got:\n>     Unable to open logfile at /release/merger/sage-5.1-12415/home/.sage//tmp/test.log\n>     Proceeding without logging.\n> sage -t devel/sage/sage/ext/gmp.pxi\n>     [0 tests, 0.0 s]\n> **********************************************************************\n> 1 items had failures:\n>    1 of  15 in sage.doctest.control.DocTestController.add_files\n> ***Test Failed*** 1 failures.\n> sage -t devel/sage/sage/doctest/control.py\n>     [115 tests, 3.6 s]\n> }}}\n> \n> But also the formatting of the above failure looks strange:\n> \n> 1) Why does\n> {{{\n> sage -t devel/sage/sage/ext/gmp.pxi\n>     [0 tests, 0.0 s]\n> }}}\n> appear in the middle of the failure?\n> \n> 2) Could you format the output as\n> {{{\n> sage -t devel/sage/sage/doctest/control.py\n> **********************************************************************\n> [...failure...]\n> **********************************************************************\n> 1 items had failures:\n>    1 of  15 in sage.doctest.control.DocTestController.add_files\n> ***Test Failed*** 1 failures.\n>     [115 tests, 3.6 s]\n> }}}\n> \n> I would even shorten the last two lines to\n> {{{\n>     [115 tests, 1 failed, 3.6 s]\n> }}}\n> \n> And I would add a function like\n> {{{\n> def count_noun(number, noun):\n>     if number == 1:\n>         return \"1 %s\"%noun\n>     else:\n>         return \"%d %ss\"%(number,noun)\n> }}}\n> So you can do\n> {{{\n> print count_noun(n, 'item'), \"had failures\"\n> }}}\n\n\nCool.  I will work on these.\n\nI'm going to be mostly (or entirely) out of communication for the next few days.  Hopefully I'll have some changes available on Monday.",
    "created_at": "2012-07-13T19:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143183",
    "user": "roed"
}
```

Replying to [comment:105 jdemeyer]:
> Just one failure remaining related to this ticket:
> {{{
> **********************************************************************
> File "devel/sage/sage/doctest/control.py", line 258, in sage.doctest.control.DocTestController.add_files
> Failed example:
>     DC = DocTestController(DD, [])
> Expected nothing
> Got:
>     Unable to open logfile at /release/merger/sage-5.1-12415/home/.sage//tmp/test.log
>     Proceeding without logging.
> sage -t devel/sage/sage/ext/gmp.pxi
>     [0 tests, 0.0 s]
> **********************************************************************
> 1 items had failures:
>    1 of  15 in sage.doctest.control.DocTestController.add_files
> ***Test Failed*** 1 failures.
> sage -t devel/sage/sage/doctest/control.py
>     [115 tests, 3.6 s]
> }}}
> 
> But also the formatting of the above failure looks strange:
> 
> 1) Why does
> {{{
> sage -t devel/sage/sage/ext/gmp.pxi
>     [0 tests, 0.0 s]
> }}}
> appear in the middle of the failure?
> 
> 2) Could you format the output as
> {{{
> sage -t devel/sage/sage/doctest/control.py
> **********************************************************************
> [...failure...]
> **********************************************************************
> 1 items had failures:
>    1 of  15 in sage.doctest.control.DocTestController.add_files
> ***Test Failed*** 1 failures.
>     [115 tests, 3.6 s]
> }}}
> 
> I would even shorten the last two lines to
> {{{
>     [115 tests, 1 failed, 3.6 s]
> }}}
> 
> And I would add a function like
> {{{
> def count_noun(number, noun):
>     if number == 1:
>         return "1 %s"%noun
>     else:
>         return "%d %ss"%(number,noun)
> }}}
> So you can do
> {{{
> print count_noun(n, 'item'), "had failures"
> }}}


Cool.  I will work on these.

I'm going to be mostly (or entirely) out of communication for the next few days.  Hopefully I'll have some changes available on Monday.



---

archive/issue_comments_143184.json:
```json
{
    "body": "From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion): would it be possible to optionally print extra information after doctesting: how many optional doctests were skipped, and perhaps how they were labeled? (\"skipped 5 doctests marked \"optional -- bug\")",
    "created_at": "2012-07-19T22:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143184",
    "user": "jhpalmieri"
}
```

From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion): would it be possible to optionally print extra information after doctesting: how many optional doctests were skipped, and perhaps how they were labeled? ("skipped 5 doctests marked "optional -- bug")



---

archive/issue_comments_143185.json:
```json
{
    "body": "Replying to [comment:111 jhpalmieri]:\n> From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion): would it be possible to optionally print extra information after doctesting: how many optional doctests were skipped, and perhaps how they were labeled? (\"skipped 5 doctests marked \"optional -- bug\")\n\nYeah, that shouldn't be a problem.  But I'd like to put a feature freeze on this ticket and open a new ticket for it: I'm already regretting adding the new debugging feature since I'm struggling with debugging its interaction with `KeyboardInterrupts`.\n\nI just opened #13278 for this.",
    "created_at": "2012-07-19T23:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143185",
    "user": "roed"
}
```

Replying to [comment:111 jhpalmieri]:
> From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion): would it be possible to optionally print extra information after doctesting: how many optional doctests were skipped, and perhaps how they were labeled? ("skipped 5 doctests marked "optional -- bug")

Yeah, that shouldn't be a problem.  But I'd like to put a feature freeze on this ticket and open a new ticket for it: I'm already regretting adding the new debugging feature since I'm struggling with debugging its interaction with `KeyboardInterrupts`.

I just opened #13278 for this.



---

archive/issue_comments_143186.json:
```json
{
    "body": "Ping - should this still be needs_work?",
    "created_at": "2012-08-31T08:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143186",
    "user": "kini"
}
```

Ping - should this still be needs_work?



---

archive/issue_comments_143187.json:
```json
{
    "body": "There's still the `interrupt.pyx` failures which need to be investigated (probably by me since I know most about interrupts).",
    "created_at": "2012-08-31T09:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143187",
    "user": "jdemeyer"
}
```

There's still the `interrupt.pyx` failures which need to be investigated (probably by me since I know most about interrupts).



---

archive/issue_comments_143188.json:
```json
{
    "body": "If you could look at those it would be great.  My computer is currently being repaired, but I can try to take another shot at this next week.",
    "created_at": "2012-09-01T03:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143188",
    "user": "roed"
}
```

If you could look at those it would be great.  My computer is currently being repaired, but I can try to take another shot at this next week.



---

archive/issue_comments_143189.json:
```json
{
    "body": "Alright, I've rebased this against 5.4.rc1 and made the suggested changes in #13147.  There's still an intermittent failure in sage.tests.interrupt and I'm at a loss for what's causing it.  Help would be appreciated.",
    "created_at": "2012-10-17T05:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143189",
    "user": "roed"
}
```

Alright, I've rebased this against 5.4.rc1 and made the suggested changes in #13147.  There's still an intermittent failure in sage.tests.interrupt and I'm at a loss for what's causing it.  Help would be appreciated.



---

archive/issue_comments_143190.json:
```json
{
    "body": "I've put the output before segfault from a case where interrupt.pyx failed at http://pastebin.com/Yvs8Ev68 (expiring in 1 month).",
    "created_at": "2012-10-17T05:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143190",
    "user": "roed"
}
```

I've put the output before segfault from a case where interrupt.pyx failed at http://pastebin.com/Yvs8Ev68 (expiring in 1 month).



---

archive/issue_comments_143191.json:
```json
{
    "body": "I've moved the debug functionality that triggers on an incorrect result to #13610 since I was struggling to get the interrupt handling working correctly (IPython embedded shells intercept `KeyboardInterrupts`).  With this change the only work issue I'm aware of on this ticket is the intermittent failure in interrupt.pyx.  Testing just interrupt.pyx doesn't trigger this failure (or at least does so rarely); run `sage -t sage/tests/parigp.py sage/tests/interrupt.pyx` for example.",
    "created_at": "2012-10-17T05:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143191",
    "user": "roed"
}
```

I've moved the debug functionality that triggers on an incorrect result to #13610 since I was struggling to get the interrupt handling working correctly (IPython embedded shells intercept `KeyboardInterrupts`).  With this change the only work issue I'm aware of on this ticket is the intermittent failure in interrupt.pyx.  Testing just interrupt.pyx doesn't trigger this failure (or at least does so rarely); run `sage -t sage/tests/parigp.py sage/tests/interrupt.pyx` for example.



---

archive/issue_comments_143192.json:
```json
{
    "body": "Ok, I found another issue which I'm not going to fix tonight.  The code that parses a file and generates the tests has a bug somewhere that means some files with tests are not getting tested.  I need to track down the bug and add some doctests to make sure this kind of thing doesn't happen again.",
    "created_at": "2012-10-17T08:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143192",
    "user": "roed"
}
```

Ok, I found another issue which I'm not going to fix tonight.  The code that parses a file and generates the tests has a bug somewhere that means some files with tests are not getting tested.  I need to track down the bug and add some doctests to make sure this kind of thing doesn't happen again.



---

archive/issue_comments_143193.json:
```json
{
    "body": "Alright, I fixed a bunch of bugs in the parsing of files.  I added two new patches since the old ones were getting big.  Sorry for the huge size of this ticket: some of the changes in [attachment:12415_more_doctest_fixes.patch] can be split off into new tickets, but many of them need to be made along with the switch to the new testing code.",
    "created_at": "2012-10-24T03:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143193",
    "user": "roed"
}
```

Alright, I fixed a bunch of bugs in the parsing of files.  I added two new patches since the old ones were getting big.  Sorry for the huge size of this ticket: some of the changes in [attachment:12415_more_doctest_fixes.patch] can be split off into new tickets, but many of them need to be made along with the switch to the new testing code.



---

archive/issue_comments_143194.json:
```json
{
    "body": "Here's my current status on the `interrupt.pyx` problem.\n\n* It occurs only if `interrupt.pyx` is not the first file being tested (so `sage -t rings/big_oh.py tests/interrupt.pyx` will show it for example)\n* The segfault is actually caused by the test at line 694 of `interrupt.pyx`: `sage: test_sig_block()`\n \nI tried looking into the signal handling code but got lost.  Any ideas?",
    "created_at": "2012-10-24T04:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143194",
    "user": "roed"
}
```

Here's my current status on the `interrupt.pyx` problem.

* It occurs only if `interrupt.pyx` is not the first file being tested (so `sage -t rings/big_oh.py tests/interrupt.pyx` will show it for example)
* The segfault is actually caused by the test at line 694 of `interrupt.pyx`: `sage: test_sig_block()`
 
I tried looking into the signal handling code but got lost.  Any ideas?



---

archive/issue_comments_143195.json:
```json
{
    "body": "I can have a look at the interrupt code, but not now...",
    "created_at": "2012-10-24T07:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143195",
    "user": "jdemeyer"
}
```

I can have a look at the interrupt code, but not now...



---

archive/issue_comments_143196.json:
```json
{
    "body": "Fair enough.  Do you have any idea when you might have a chance?  Or any suggestions for debugging it myself?",
    "created_at": "2012-10-24T07:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143196",
    "user": "roed"
}
```

Fair enough.  Do you have any idea when you might have a chance?  Or any suggestions for debugging it myself?



---

archive/issue_comments_143197.json:
```json
{
    "body": "I have no idea what's going on, but to follow up on David's comment: on an OS X 10.8 machine, if I run `sage -t rings/big_oh.py tests/interrupt.pyx`, I get an error at line 744. If I make *either* of the following two changes, the error goes away:\n\n```diff\ndiff --git a/sage/tests/interrupt.pyx b/sage/tests/interrupt.pyx\n--- a/sage/tests/interrupt.pyx\n+++ b/sage/tests/interrupt.pyx\n@@ -691,8 +691,6 @@ def test_sig_block(long delay = DEFAULT_\n     TESTS::\n \n         sage: from sage.tests.interrupt import *\n-        sage: test_sig_block()\n-        42\n     \"\"\"\n     cdef volatile_int v = 0\n \n```\n\nor\n\n```diff\ndiff --git a/sage/tests/interrupt.pyx b/sage/tests/interrupt.pyx\n--- a/sage/tests/interrupt.pyx\n+++ b/sage/tests/interrupt.pyx\n@@ -741,9 +741,6 @@ def test_signal_during_malloc(long delay\n \n     TESTS::\n \n-        sage: from sage.tests.interrupt import *\n-        sage: for i in range(4):  # Several times to reduce chances of false positive\n-        ...       test_signal_during_malloc()\n     \"\"\"\n     signal_after_delay(SIGINT, delay)\n     try:\n```\n\nFor the second one, I still get the error if I keep line 744,\n\n```\nsage: from sage.tests.interrupt import *\n```\n\nbut remove the actual doctest. Does this have any significance for anyone?",
    "created_at": "2012-11-13T19:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143197",
    "user": "jhpalmieri"
}
```

I have no idea what's going on, but to follow up on David's comment: on an OS X 10.8 machine, if I run `sage -t rings/big_oh.py tests/interrupt.pyx`, I get an error at line 744. If I make *either* of the following two changes, the error goes away:

```diff
diff --git a/sage/tests/interrupt.pyx b/sage/tests/interrupt.pyx
--- a/sage/tests/interrupt.pyx
+++ b/sage/tests/interrupt.pyx
@@ -691,8 +691,6 @@ def test_sig_block(long delay = DEFAULT_
     TESTS::
 
         sage: from sage.tests.interrupt import *
-        sage: test_sig_block()
-        42
     """
     cdef volatile_int v = 0
 
```

or

```diff
diff --git a/sage/tests/interrupt.pyx b/sage/tests/interrupt.pyx
--- a/sage/tests/interrupt.pyx
+++ b/sage/tests/interrupt.pyx
@@ -741,9 +741,6 @@ def test_signal_during_malloc(long delay
 
     TESTS::
 
-        sage: from sage.tests.interrupt import *
-        sage: for i in range(4):  # Several times to reduce chances of false positive
-        ...       test_signal_during_malloc()
     """
     signal_after_delay(SIGINT, delay)
     try:
```

For the second one, I still get the error if I keep line 744,

```
sage: from sage.tests.interrupt import *
```

but remove the actual doctest. Does this have any significance for anyone?



---

archive/issue_comments_143198.json:
```json
{
    "body": "The problem seems to be caused by \n\n```\nsage: test_sig_block()\n42\n```\n\n\nbut it only shows up if enough time is taken up by later tests.  So you can delete\n\n```\nsage: from sage.tests.interrupt import *\nsage: for i in range(4):  # Several times to reduce chances of false positive\n...       test_signal_during_malloc()\n```\n\nand add something else, and you still get the error.",
    "created_at": "2012-11-24T06:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143198",
    "user": "roed"
}
```

The problem seems to be caused by 

```
sage: test_sig_block()
42
```


but it only shows up if enough time is taken up by later tests.  So you can delete

```
sage: from sage.tests.interrupt import *
sage: for i in range(4):  # Several times to reduce chances of false positive
...       test_signal_during_malloc()
```

and add something else, and you still get the error.



---

archive/issue_comments_143199.json:
```json
{
    "body": "By commenting out most of the tests in that file, I can get the following error message:\n\n\n```\nFatal Python error: GC object already tracked\n```\n\nI still get a SIGABRT, but now the bad exit code is -6 rather than -11.",
    "created_at": "2012-11-24T06:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143199",
    "user": "roed"
}
```

By commenting out most of the tests in that file, I can get the following error message:


```
Fatal Python error: GC object already tracked
```

I still get a SIGABRT, but now the bad exit code is -6 rather than -11.



---

archive/issue_comments_143200.json:
```json
{
    "body": "Alright.  I have a minimal example that doesn't rely on the doctesting framework.  Of course, I still don't know how to resolve the issue, but at least it should be easier to work on.  See #13748.",
    "created_at": "2012-11-24T13:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143200",
    "user": "roed"
}
```

Alright.  I have a minimal example that doesn't rely on the doctesting framework.  Of course, I still don't know how to resolve the issue, but at least it should be easier to work on.  See #13748.



---

archive/issue_comments_143201.json:
```json
{
    "body": "If the issue isn't related to the new doctesting framework, but is a pre-existing condition revealed by it, then it shouldn't be a dependency, but a separate issue. If that was the only issue with this ticket, then this ticket could be merged, right?",
    "created_at": "2012-11-24T16:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143201",
    "user": "jhpalmieri"
}
```

If the issue isn't related to the new doctesting framework, but is a pre-existing condition revealed by it, then it shouldn't be a dependency, but a separate issue. If that was the only issue with this ticket, then this ticket could be merged, right?



---

archive/issue_comments_143202.json:
```json
{
    "body": "Replying to [comment:131 jhpalmieri]:\n> If the issue isn't related to the new doctesting framework, but is a pre-existing condition revealed by it, then it shouldn't be a dependency, but a separate issue. If that was the only issue with this ticket, then this ticket could be merged, right?\n\nI have no problem with that interpretation.  But in some sense it is related to the new doctesting framework since we weren't using Python's multiprocessing module before.\n\nSo, does anyone want to give this ticket a positive review?",
    "created_at": "2012-11-24T23:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143202",
    "user": "roed"
}
```

Replying to [comment:131 jhpalmieri]:
> If the issue isn't related to the new doctesting framework, but is a pre-existing condition revealed by it, then it shouldn't be a dependency, but a separate issue. If that was the only issue with this ticket, then this ticket could be merged, right?

I have no problem with that interpretation.  But in some sense it is related to the new doctesting framework since we weren't using Python's multiprocessing module before.

So, does anyone want to give this ticket a positive review?



---

archive/issue_comments_143203.json:
```json
{
    "body": "Rebased and merged the two doctest patches.",
    "created_at": "2013-01-03T18:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143203",
    "user": "jdemeyer"
}
```

Rebased and merged the two doctest patches.



---

archive/issue_comments_143204.json:
```json
{
    "body": "Merged the two framework patches, removed the change to `sage/tests/interrupt.pyx`",
    "created_at": "2013-01-03T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143204",
    "user": "jdemeyer"
}
```

Merged the two framework patches, removed the change to `sage/tests/interrupt.pyx`



---

archive/issue_comments_143205.json:
```json
{
    "body": "I still don't like the `DocTestWorker.annihilate()` method which parses `ps` output to figure out which processes to kill.",
    "created_at": "2013-01-03T19:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143205",
    "user": "jdemeyer"
}
```

I still don't like the `DocTestWorker.annihilate()` method which parses `ps` output to figure out which processes to kill.



---

archive/issue_comments_143206.json:
```json
{
    "body": "Robert wrote that code.  :-)  I think the issue is that some doctests may spawn new processes that can survive their death.  Do you have an alternate approach to suggest?\n\nI'm very happy that you found the problem in #13748; I will try to take a look at this while I'm at the Joint meetings next week.  In general I have very little time this month....",
    "created_at": "2013-01-04T07:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143206",
    "user": "roed"
}
```

Robert wrote that code.  :-)  I think the issue is that some doctests may spawn new processes that can survive their death.  Do you have an alternate approach to suggest?

I'm very happy that you found the problem in #13748; I will try to take a look at this while I'm at the Joint meetings next week.  In general I have very little time this month....



---

archive/issue_comments_143207.json:
```json
{
    "body": "There are various new doctest errors, all of them look easy to fix. But also two errors in the doctest framework itself:\n\n```\nsage -t --long devel/sage/sage/doctest/sources.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/sources.py\", line 177, in sage.doctest.sources.DocTestSource._process_doc\nFailed example:\n    doctests == manual_doctests\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage/sage/doctest/sources.py\", line 655, in sage.doctest.sources.FileDocTestSource._test_enough_doctests\nFailed example:\n    for path, dirs, files in itertools.chain(os.walk(sage_loc), os.walk(doc_loc)): # long time\n        path = os.path.relpath(path)\n        for F in files:\n            _, ext = os.path.splitext(F)\n            if ext in ('.py', '.pyx', '.sage', '.spyx', '.rst', '.tex'):\n                filename = os.path.join(path, F)\n                FDS = FileDocTestSource(filename, True, True, True, False)\n                FDS._test_enough_doctests(verbose=False)\nExpected:\n    There are 3 unexpected tests being run in .../sage/doctest/parsing.py\n    There are 1 tests in .../sage/ext/c_lib.pyx that are not being run\n    There are 2 tests in .../sage/server/notebook/worksheet.py that are not being run\n    There are 5 tests in .../doc/en/tutorial/interfaces.rst that are not being run\nGot:\n    There are 2 tests in devel/sage/sage/server/notebook/worksheet.py that are not being run\n    There are 2 unexpected tests being run in devel/sage/sage/misc/cython.py\n    There are 1 tests in devel/sage/sage/ext/c_lib.pyx that are not being run\n    There are 3 unexpected tests being run in devel/sage/sage/doctest/parsing.py\n    There are 5 tests in devel/sage/doc/en/tutorial/interfaces.rst that are not being run\n    There are 1130 tests in devel/sage/doc/output/latex/en/reference/reference.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/en/tutorial/SageTutorial.tex that are not being run\n    There are 4 tests in devel/sage/doc/output/latex/en/thematic_tutorials/thematic_tutorials.tex that are not being run\n    There are 6 tests in devel/sage/doc/output/latex/en/prep/prep_tutorials.tex that are not being run\n    There are 2 tests in devel/sage/doc/output/latex/en/numerical_sage/numerical_sage.tex that are not being run\n    There are 15 tests in devel/sage/doc/output/latex/en/developer/developer.tex that are not being run\n    There are 16 tests in devel/sage/doc/output/latex/en/constructions/constructions.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/ru/tutorial/SageTutorial_ru.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/fr/tutorial/tutorial-fr.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/de/tutorial/SageTutorial-de.tex that are not being run\n**********************************************************************\n```\n\n\nAlso, the directory `devel/sagenb/sagenb/data` should probably not be tested, as there are failures because of TAB characters in the MathJax rst documentation.",
    "created_at": "2013-01-04T07:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143207",
    "user": "jdemeyer"
}
```

There are various new doctest errors, all of them look easy to fix. But also two errors in the doctest framework itself:

```
sage -t --long devel/sage/sage/doctest/sources.py
**********************************************************************
File "devel/sage/sage/doctest/sources.py", line 177, in sage.doctest.sources.DocTestSource._process_doc
Failed example:
    doctests == manual_doctests
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage/sage/doctest/sources.py", line 655, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk(sage_loc), os.walk(doc_loc)): # long time
        path = os.path.relpath(path)
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.sage', '.spyx', '.rst', '.tex'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, True, True, True, False)
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 3 unexpected tests being run in .../sage/doctest/parsing.py
    There are 1 tests in .../sage/ext/c_lib.pyx that are not being run
    There are 2 tests in .../sage/server/notebook/worksheet.py that are not being run
    There are 5 tests in .../doc/en/tutorial/interfaces.rst that are not being run
Got:
    There are 2 tests in devel/sage/sage/server/notebook/worksheet.py that are not being run
    There are 2 unexpected tests being run in devel/sage/sage/misc/cython.py
    There are 1 tests in devel/sage/sage/ext/c_lib.pyx that are not being run
    There are 3 unexpected tests being run in devel/sage/sage/doctest/parsing.py
    There are 5 tests in devel/sage/doc/en/tutorial/interfaces.rst that are not being run
    There are 1130 tests in devel/sage/doc/output/latex/en/reference/reference.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/en/tutorial/SageTutorial.tex that are not being run
    There are 4 tests in devel/sage/doc/output/latex/en/thematic_tutorials/thematic_tutorials.tex that are not being run
    There are 6 tests in devel/sage/doc/output/latex/en/prep/prep_tutorials.tex that are not being run
    There are 2 tests in devel/sage/doc/output/latex/en/numerical_sage/numerical_sage.tex that are not being run
    There are 15 tests in devel/sage/doc/output/latex/en/developer/developer.tex that are not being run
    There are 16 tests in devel/sage/doc/output/latex/en/constructions/constructions.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/ru/tutorial/SageTutorial_ru.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/fr/tutorial/tutorial-fr.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/de/tutorial/SageTutorial-de.tex that are not being run
**********************************************************************
```


Also, the directory `devel/sagenb/sagenb/data` should probably not be tested, as there are failures because of TAB characters in the MathJax rst documentation.



---

archive/issue_comments_143208.json:
```json
{
    "body": "Do you guys consider it a feature or a bug that\n\n```\n\"\"\"\nsage: 1e16     # relative tol 1e-10\n10^16\n\"\"\"\n```\n\ndoesn't work? See #12815.",
    "created_at": "2013-01-04T07:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143208",
    "user": "jdemeyer"
}
```

Do you guys consider it a feature or a bug that

```
"""
sage: 1e16     # relative tol 1e-10
10^16
"""
```

doesn't work? See #12815.



---

archive/issue_comments_143209.json:
```json
{
    "body": "What I'm missing in this patchbomb is a high-level overview of how everything works. To me, it looks like a large lump of code (which seems to work pretty well) which is hard to understand.",
    "created_at": "2013-01-04T09:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143209",
    "user": "jdemeyer"
}
```

What I'm missing in this patchbomb is a high-level overview of how everything works. To me, it looks like a large lump of code (which seems to work pretty well) which is hard to understand.



---

archive/issue_comments_143210.json:
```json
{
    "body": "Typo:\n\n```\nComparison ist just comparison of the underlying lists.\n```\n",
    "created_at": "2013-01-04T09:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143210",
    "user": "jdemeyer"
}
```

Typo:

```
Comparison ist just comparison of the underlying lists.
```




---

archive/issue_comments_143211.json:
```json
{
    "body": "Replying to [comment:138 roed]:\n> Robert wrote that code.  :-)  I think the issue is that some doctests may spawn new processes that can survive their death.  Do you have an alternate approach to suggest?\nThere is some commented-out code mentioning process groups, it would be a good idea to make that work.\n\nBut I'm also a bit lost on how the fork()ing actually works and how many Sage sessions are involved.",
    "created_at": "2013-01-04T09:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143211",
    "user": "jdemeyer"
}
```

Replying to [comment:138 roed]:
> Robert wrote that code.  :-)  I think the issue is that some doctests may spawn new processes that can survive their death.  Do you have an alternate approach to suggest?
There is some commented-out code mentioning process groups, it would be a good idea to make that work.

But I'm also a bit lost on how the fork()ing actually works and how many Sage sessions are involved.



---

archive/issue_comments_143212.json:
```json
{
    "body": "Replying to [comment:143 jdemeyer]:\n> What I'm missing in this patchbomb is a high-level overview of how everything works. To me, it looks like a large lump of code (which seems to work pretty well) which is hard to understand.\n\nI will add somw top level documentation next week.",
    "created_at": "2013-01-04T20:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143212",
    "user": "roed"
}
```

Replying to [comment:143 jdemeyer]:
> What I'm missing in this patchbomb is a high-level overview of how everything works. To me, it looks like a large lump of code (which seems to work pretty well) which is hard to understand.

I will add somw top level documentation next week.



---

archive/issue_comments_143213.json:
```json
{
    "body": "#13908 might also help with proper killing.",
    "created_at": "2013-01-04T20:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143213",
    "user": "jdemeyer"
}
```

#13908 might also help with proper killing.



---

archive/issue_comments_143214.json:
```json
{
    "body": "Replying to [comment:142 jdemeyer]:\n> Do you guys consider it a feature or a bug that\n> {{{\n> \"\"\"\n> sage: 1e16     # relative tol 1e-10\n> 10^16\n> \"\"\"\n> }}}\n> doesn't work? See #12815.\n\nFeature. See new comment on that ticket.",
    "created_at": "2013-01-05T05:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143214",
    "user": "robertwb"
}
```

Replying to [comment:142 jdemeyer]:
> Do you guys consider it a feature or a bug that
> {{{
> """
> sage: 1e16     # relative tol 1e-10
> 10^16
> """
> }}}
> doesn't work? See #12815.

Feature. See new comment on that ticket.



---

archive/issue_comments_143215.json:
```json
{
    "body": "Looks like I have to depend on this for the numpy-1.7 upgrade at #11334, so I am tagging along :)",
    "created_at": "2013-01-14T21:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143215",
    "user": "fbissey"
}
```

Looks like I have to depend on this for the numpy-1.7 upgrade at #11334, so I am tagging along :)



---

archive/issue_comments_143216.json:
```json
{
    "body": "It is interesting. With each new version of numpy we seem to have new instances of \n\n```\nWarning: divide by zero encountered in divide\n```\n\nappearing in doctests. This suggest that numpy sometimes mixes stderr and stdout or that they are very intent to tell you about these warnings. All the instances of this warning that are fixed in [attachment:12415_stderr_vs_51b5.patch] also appears with the upgrade to numpy 1.7.0 - plus some more.",
    "created_at": "2013-01-15T09:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143216",
    "user": "fbissey"
}
```

It is interesting. With each new version of numpy we seem to have new instances of 

```
Warning: divide by zero encountered in divide
```

appearing in doctests. This suggest that numpy sometimes mixes stderr and stdout or that they are very intent to tell you about these warnings. All the instances of this warning that are fixed in [attachment:12415_stderr_vs_51b5.patch] also appears with the upgrade to numpy 1.7.0 - plus some more.



---

archive/issue_comments_143217.json:
```json
{
    "body": "Combined [attachment:12415_stderr_vs_51b5.patch] and [attachment:12415_doctest_fixes.patch] and rebased.\n\n[attachment:12415_framework.patch] needs to be rebased but `displayhook.py` changed substantially in #12719, so I don't know what to do.",
    "created_at": "2013-01-29T13:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143217",
    "user": "jdemeyer"
}
```

Combined [attachment:12415_stderr_vs_51b5.patch] and [attachment:12415_doctest_fixes.patch] and rebased.

[attachment:12415_framework.patch] needs to be rebased but `displayhook.py` changed substantially in #12719, so I don't know what to do.



---

archive/issue_comments_143218.json:
```json
{
    "body": "Attachment [12415_spkg_bin_sage.patch](tarball://root/attachments/some-uuid/ticket12415/12415_spkg_bin_sage.patch) by jdemeyer created at 2013-01-29 13:31:47\n\nApply to root repository",
    "created_at": "2013-01-29T13:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143218",
    "user": "jdemeyer"
}
```

Attachment [12415_spkg_bin_sage.patch](tarball://root/attachments/some-uuid/ticket12415/12415_spkg_bin_sage.patch) by jdemeyer created at 2013-01-29 13:31:47

Apply to root repository



---

archive/issue_comments_143219.json:
```json
{
    "body": "Patch to script repo; now removes old files",
    "created_at": "2013-01-29T13:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143219",
    "user": "jdemeyer"
}
```

Patch to script repo; now removes old files



---

archive/issue_comments_143220.json:
```json
{
    "body": "Attachment [12415_script.patch](tarball://root/attachments/some-uuid/ticket12415/12415_script.patch) by jdemeyer created at 2013-01-29 14:36:42\n\nIs this because of the displayhook?\n\n```\nFile \"devel/sage/sage/combinat/cluster_algebra_quiver/quiver.py\", line 996, in sage.combinat.cluster_algebra_quiver.quiver.ClusterQuiver.mutation_sequence\nFailed example:\n    [T.b_matrix() for T in seq]\nExpected:\n    [\n    [ 0  1  0  0]  [ 0 -1  0  0]  [ 0  1 -1  0]\n    [-1  0 -1  0]  [ 1  0 -1  0]  [-1  0  1  0]\n    [ 0  1  0  1]  [ 0  1  0  1]  [ 1 -1  0  1]\n    [ 0  0 -1  0], [ 0  0 -1  0], [ 0  0 -1  0]\n    ]\nGot:\n    [[ 0  1  0  0]\n    [-1  0 -1  0]\n    [ 0  1  0  1]\n    [ 0  0 -1  0], [ 0 -1  0  0]\n    [ 1  0 -1  0]\n    [ 0  1  0  1]\n    [ 0  0 -1  0], [ 0  1 -1  0]\n    [-1  0  1  0]\n    [ 1 -1  0  1]\n    [ 0  0 -1  0]]\n```\n",
    "created_at": "2013-01-29T14:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143220",
    "user": "jdemeyer"
}
```

Attachment [12415_script.patch](tarball://root/attachments/some-uuid/ticket12415/12415_script.patch) by jdemeyer created at 2013-01-29 14:36:42

Is this because of the displayhook?

```
File "devel/sage/sage/combinat/cluster_algebra_quiver/quiver.py", line 996, in sage.combinat.cluster_algebra_quiver.quiver.ClusterQuiver.mutation_sequence
Failed example:
    [T.b_matrix() for T in seq]
Expected:
    [
    [ 0  1  0  0]  [ 0 -1  0  0]  [ 0  1 -1  0]
    [-1  0 -1  0]  [ 1  0 -1  0]  [-1  0  1  0]
    [ 0  1  0  1]  [ 0  1  0  1]  [ 1 -1  0  1]
    [ 0  0 -1  0], [ 0  0 -1  0], [ 0  0 -1  0]
    ]
Got:
    [[ 0  1  0  0]
    [-1  0 -1  0]
    [ 0  1  0  1]
    [ 0  0 -1  0], [ 0 -1  0  0]
    [ 1  0 -1  0]
    [ 0  1  0  1]
    [ 0  0 -1  0], [ 0  1 -1  0]
    [-1  0  1  0]
    [ 1 -1  0  1]
    [ 0  0 -1  0]]
```




---

archive/issue_comments_143221.json:
```json
{
    "body": "Replying to [comment:153 jdemeyer]:\n> Is this because of the displayhook?\n> {{{\n> File \"devel/sage/sage/combinat/cluster_algebra_quiver/quiver.py\", line 996, in sage.combinat.cluster_algebra_quiver.quiver.ClusterQuiver.mutation_sequence\n> Failed example:\n>     [T.b_matrix() for T in seq]\n> Expected:\n>     [\n>     [ 0  1  0  0]  [ 0 -1  0  0]  [ 0  1 -1  0]\n>     [-1  0 -1  0]  [ 1  0 -1  0]  [-1  0  1  0]\n>     [ 0  1  0  1]  [ 0  1  0  1]  [ 1 -1  0  1]\n>     [ 0  0 -1  0], [ 0  0 -1  0], [ 0  0 -1  0]\n>     ]\n> Got:\n>     [[ 0  1  0  0]\n>     [-1  0 -1  0]\n>     [ 0  1  0  1]\n>     [ 0  0 -1  0], [ 0 -1  0  0]\n>     [ 1  0 -1  0]\n>     [ 0  1  0  1]\n>     [ 0  0 -1  0], [ 0  1 -1  0]\n>     [-1  0  1  0]\n>     [ 1 -1  0  1]\n>     [ 0  0 -1  0]]\n> }}}\n\nYeah, that's the kind of error that would occur because of displayhook.  I'll take a look.",
    "created_at": "2013-01-29T15:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143221",
    "user": "roed"
}
```

Replying to [comment:153 jdemeyer]:
> Is this because of the displayhook?
> {{{
> File "devel/sage/sage/combinat/cluster_algebra_quiver/quiver.py", line 996, in sage.combinat.cluster_algebra_quiver.quiver.ClusterQuiver.mutation_sequence
> Failed example:
>     [T.b_matrix() for T in seq]
> Expected:
>     [
>     [ 0  1  0  0]  [ 0 -1  0  0]  [ 0  1 -1  0]
>     [-1  0 -1  0]  [ 1  0 -1  0]  [-1  0  1  0]
>     [ 0  1  0  1]  [ 0  1  0  1]  [ 1 -1  0  1]
>     [ 0  0 -1  0], [ 0  0 -1  0], [ 0  0 -1  0]
>     ]
> Got:
>     [[ 0  1  0  0]
>     [-1  0 -1  0]
>     [ 0  1  0  1]
>     [ 0  0 -1  0], [ 0 -1  0  0]
>     [ 1  0 -1  0]
>     [ 0  1  0  1]
>     [ 0  0 -1  0], [ 0  1 -1  0]
>     [-1  0  1  0]
>     [ 1 -1  0  1]
>     [ 0  0 -1  0]]
> }}}

Yeah, that's the kind of error that would occur because of displayhook.  I'll take a look.



---

archive/issue_comments_143222.json:
```json
{
    "body": "All other files (except [attachment:12415_framework.patch]) have been rebased to sage-5.7.beta1.",
    "created_at": "2013-01-29T15:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143222",
    "user": "jdemeyer"
}
```

All other files (except [attachment:12415_framework.patch]) have been rebased to sage-5.7.beta1.



---

archive/issue_comments_143223.json:
```json
{
    "body": "Great.  I'm building a copy of sage-5.7.beta1 now and will try to rebase [attachment:12415_framework.patch] to it later today.",
    "created_at": "2013-01-29T16:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143223",
    "user": "roed"
}
```

Great.  I'm building a copy of sage-5.7.beta1 now and will try to rebase [attachment:12415_framework.patch] to it later today.



---

archive/issue_comments_143224.json:
```json
{
    "body": "Replying to [comment:156 roed]:\n> Great.  I'm building a copy of sage-5.7.beta1 now and will try to rebase [attachment:12415_framework.patch] to it later today.\nThat would be great!\n\nI would really like to finish this ticket.  I feel that we're almost there, the main thing I would like to change is the handling of subprocesses (including but not limited to killing).",
    "created_at": "2013-01-30T16:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143224",
    "user": "jdemeyer"
}
```

Replying to [comment:156 roed]:
> Great.  I'm building a copy of sage-5.7.beta1 now and will try to rebase [attachment:12415_framework.patch] to it later today.
That would be great!

I would really like to finish this ticket.  I feel that we're almost there, the main thing I would like to change is the handling of subprocesses (including but not limited to killing).



---

archive/issue_comments_143225.json:
```json
{
    "body": "The new doctesting code",
    "created_at": "2013-01-31T05:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143225",
    "user": "roed"
}
```

The new doctesting code



---

archive/issue_comments_143226.json:
```json
{
    "body": "Attachment [12415_framework.patch](tarball://root/attachments/some-uuid/ticket12415/12415_framework.patch) by roed created at 2013-01-31 05:42:06\n\nI think I've fixed the display hook problem.  I just ran make ptestlong and found some errors; I'm looking into them and will report back.\n\nI'm working on some general documentation, but some help on the `annihilate` method would be useful, since I know nothing about process control groups.",
    "created_at": "2013-01-31T05:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143226",
    "user": "roed"
}
```

Attachment [12415_framework.patch](tarball://root/attachments/some-uuid/ticket12415/12415_framework.patch) by roed created at 2013-01-31 05:42:06

I think I've fixed the display hook problem.  I just ran make ptestlong and found some errors; I'm looking into them and will report back.

I'm working on some general documentation, but some help on the `annihilate` method would be useful, since I know nothing about process control groups.



---

archive/issue_comments_143227.json:
```json
{
    "body": "There are still doctest failures in the doctest framework, see comment [comment:140].",
    "created_at": "2013-02-06T12:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143227",
    "user": "jdemeyer"
}
```

There are still doctest failures in the doctest framework, see comment [comment:140].



---

archive/issue_comments_143228.json:
```json
{
    "body": "More doctest framework doctest failures:\n\n```\nsage -t --long devel/sage/sage/doctest/control.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/control.py\", line 566, in sage.doctest.control.DocTestController.cleanup\nFailed example:\n    DC.run()\nException raised:\n    Traceback (most recent call last):\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 595, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 980, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.cleanup[8]>\", line 1, in <module>\n        DC.run()\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 725, in run\n        self.test_safe_directory()\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 270, in test_safe_directory\n        .format(os.getcwd()))\n    RuntimeError: refusing to run doctests from the current directory '/home/jdemeyer/.sage/temp/sage.math.washington.edu/10273/dir_2B_1k4/test' since untrusted users could put files in this directory, making it unsafe to run Sage code from\n**********************************************************************\n```\n\n\nThen there is a bunch of\n\n```\n/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparis\non failed to convert both arguments to Unicode - interpreting them as being unequal\n  if code[q-1] == u'\\\\':\n```\n\nin between the tests, for example:\n\n```\nsage -t --long devel/sage/sage/combinat/species/empty_species.py\n    [38 tests, 0.1 s]\nsage -t --long devel/sage/sage/combinat/sf/kfpoly.py\n    [60 tests, 0.1 s]\nsage -t --long devel/sage/sage/combinat/words/shuffle_product.py\n    [63 tests, 0.1 s]\n/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparis\non failed to convert both arguments to Unicode - interpreting them as being unequal\n  if code[q-1] == u'\\\\':\nsage -t --long devel/sage/sage/categories/algebra_modules.py\n    [9 tests, 0.1 s]\nsage -t --long devel/sage/sage/numerical/backends/ppl_backend.pyx\n    [167 tests, 0.1 s]\nsage -t --long devel/sagenb-main/sagenb/misc/misc.py\n    [36 tests, 0.0 s]\n```\n",
    "created_at": "2013-02-06T12:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143228",
    "user": "jdemeyer"
}
```

More doctest framework doctest failures:

```
sage -t --long devel/sage/sage/doctest/control.py
**********************************************************************
File "devel/sage/sage/doctest/control.py", line 566, in sage.doctest.control.DocTestController.cleanup
Failed example:
    DC.run()
Exception raised:
    Traceback (most recent call last):
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 595, in _run
        self.execute(example, compiled, test.globs)
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 980, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.cleanup[8]>", line 1, in <module>
        DC.run()
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py", line 725, in run
        self.test_safe_directory()
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/control.py", line 270, in test_safe_directory
        .format(os.getcwd()))
    RuntimeError: refusing to run doctests from the current directory '/home/jdemeyer/.sage/temp/sage.math.washington.edu/10273/dir_2B_1k4/test' since untrusted users could put files in this directory, making it unsafe to run Sage code from
**********************************************************************
```


Then there is a bunch of

```
/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparis
on failed to convert both arguments to Unicode - interpreting them as being unequal
  if code[q-1] == u'\\':
```

in between the tests, for example:

```
sage -t --long devel/sage/sage/combinat/species/empty_species.py
    [38 tests, 0.1 s]
sage -t --long devel/sage/sage/combinat/sf/kfpoly.py
    [60 tests, 0.1 s]
sage -t --long devel/sage/sage/combinat/words/shuffle_product.py
    [63 tests, 0.1 s]
/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparis
on failed to convert both arguments to Unicode - interpreting them as being unequal
  if code[q-1] == u'\\':
sage -t --long devel/sage/sage/categories/algebra_modules.py
    [9 tests, 0.1 s]
sage -t --long devel/sage/sage/numerical/backends/ppl_backend.pyx
    [167 tests, 0.1 s]
sage -t --long devel/sagenb-main/sagenb/misc/misc.py
    [36 tests, 0.0 s]
```




---

archive/issue_comments_143229.json:
```json
{
    "body": "Quick question: how many `DocTestWorker` instances are created?  Just one?  Or N if we set `MAKE=make -jN`?",
    "created_at": "2013-02-06T13:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143229",
    "user": "jdemeyer"
}
```

Quick question: how many `DocTestWorker` instances are created?  Just one?  Or N if we set `MAKE=make -jN`?



---

archive/issue_comments_143230.json:
```json
{
    "body": "There is a lot of\n\n```\nif output_semaphore is not None:\n    output_semaphore.acquire()\n```\n\nin the code which could be simplified assuming that `output_semaphore` is never `None`. Could we ensure that?\n\nIn fact, the whole block\n\n```\ntry:\n    if output_semaphore is not None:\n        output_semaphore.acquire()\n    do_something()\nfinally:\n    if output_semaphore is not None:\n        output_semaphore.release()\n```\n\ncould be simplified to\n\n```\nwith output_semaphore:\n    do_something()\n```\n",
    "created_at": "2013-02-06T14:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143230",
    "user": "jdemeyer"
}
```

There is a lot of

```
if output_semaphore is not None:
    output_semaphore.acquire()
```

in the code which could be simplified assuming that `output_semaphore` is never `None`. Could we ensure that?

In fact, the whole block

```
try:
    if output_semaphore is not None:
        output_semaphore.acquire()
    do_something()
finally:
    if output_semaphore is not None:
        output_semaphore.release()
```

could be simplified to

```
with output_semaphore:
    do_something()
```




---

archive/issue_comments_143231.json:
```json
{
    "body": "Replying to [comment:81 roed]:\n> The main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)\nI vote to completely remove the `--serial` option since for me the only effect is that it makes the code more complicated. Consider for example:\n\n```\n        except KeyboardInterrupt:\n            if result_pipe is None:\n                # We're in serial mode\n                raise\n            # Otherwise, we've been started by a worker: we'll return the result in the finally block\n            result = 0, DictAsObject(dict(err='ctlC')), \"\"\n[...]\n        finally:\n            if result_pipe is None:\n                return result\n            else:\n                result_pipe.put(result, False)\n```\n\n\nIf I want to fix `KeyboardInterrupt`s in doctests, I now have to think about *two* code paths instead of one.",
    "created_at": "2013-02-06T14:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143231",
    "user": "jdemeyer"
}
```

Replying to [comment:81 roed]:
> The main point of `--serial` is that it allows you to debug problems in the doctesting framework without worrying about multiprocessing.  :-)
I vote to completely remove the `--serial` option since for me the only effect is that it makes the code more complicated. Consider for example:

```
        except KeyboardInterrupt:
            if result_pipe is None:
                # We're in serial mode
                raise
            # Otherwise, we've been started by a worker: we'll return the result in the finally block
            result = 0, DictAsObject(dict(err='ctlC')), ""
[...]
        finally:
            if result_pipe is None:
                return result
            else:
                result_pipe.put(result, False)
```


If I want to fix `KeyboardInterrupt`s in doctests, I now have to think about *two* code paths instead of one.



---

archive/issue_comments_143232.json:
```json
{
    "body": "Any clue where this failure comes from?\n\n```\nsage -t --long devel/sagenb-main/sagenb/notebook/worksheet.py\n**********************************************************************\nFile \"devel/sagenb-main/sagenb/notebook/worksheet.py\", line 197, in sagenb.notebook.worksheet.Worksheet.?\nFailed example:\n    sagenb.notebook.misc.notebook = nb\nException raised:\n    Traceback (most recent call last):\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 595, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 980, in execute\n        exec compiled in globs\n      File \"<doctest sagenb.notebook.worksheet.Worksheet.?[2]>\", line 1, in <module>\n        sagenb.notebook.misc.notebook = nb\n    AttributeError: 'module' object has no attribute 'misc'\n**********************************************************************\n```\n",
    "created_at": "2013-02-06T17:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143232",
    "user": "jdemeyer"
}
```

Any clue where this failure comes from?

```
sage -t --long devel/sagenb-main/sagenb/notebook/worksheet.py
**********************************************************************
File "devel/sagenb-main/sagenb/notebook/worksheet.py", line 197, in sagenb.notebook.worksheet.Worksheet.?
Failed example:
    sagenb.notebook.misc.notebook = nb
Exception raised:
    Traceback (most recent call last):
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 595, in _run
        self.execute(example, compiled, test.globs)
      File "/release/sage-5.7.beta3-doctest/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 980, in execute
        exec compiled in globs
      File "<doctest sagenb.notebook.worksheet.Worksheet.?[2]>", line 1, in <module>
        sagenb.notebook.misc.notebook = nb
    AttributeError: 'module' object has no attribute 'misc'
**********************************************************************
```




---

archive/issue_comments_143233.json:
```json
{
    "body": "Answering my own question, it seems that N `DocTestWorkers` are started with `make -j N`.\n\nBut I don't understand the design choice of having **two levels** of multiprocessing: one from the master process to the `DocTestWorker` and one from the `DocTestWorker` to the `DocTestTask`.\n\nI surely need to think more about this, but I propose a redesign with only one level of multiprocessing, completely bypassing the `DocTestWorker` class. This would give the benefits of \"serial\" processing while still allowing parallel doctests.",
    "created_at": "2013-02-06T19:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143233",
    "user": "jdemeyer"
}
```

Answering my own question, it seems that N `DocTestWorkers` are started with `make -j N`.

But I don't understand the design choice of having **two levels** of multiprocessing: one from the master process to the `DocTestWorker` and one from the `DocTestWorker` to the `DocTestTask`.

I surely need to think more about this, but I propose a redesign with only one level of multiprocessing, completely bypassing the `DocTestWorker` class. This would give the benefits of "serial" processing while still allowing parallel doctests.



---

archive/issue_comments_143234.json:
```json
{
    "body": "I would love to cooperate on this ticket, but I'm having a really hard time to understand everything.  As I said before, this absolutely needs some high-level documentation explaining the various classes involved and their inter-relations (in particular, the classes in `forker.py`).",
    "created_at": "2013-02-10T10:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143234",
    "user": "jdemeyer"
}
```

I would love to cooperate on this ticket, but I'm having a really hard time to understand everything.  As I said before, this absolutely needs some high-level documentation explaining the various classes involved and their inter-relations (in particular, the classes in `forker.py`).



---

archive/issue_comments_143235.json:
```json
{
    "body": "Replying to [comment:169 jdemeyer]:\n> I would love to cooperate on this ticket, but I'm having a really hard time to understand everything.  As I said before, this absolutely needs some high-level documentation explaining the various classes involved and their inter-relations (in particular, the classes in `forker.py`).\n\nHi Jeroen,\nSorry for the slow response time: I've had a visitor here in Calgary who's leaving this evening.  I've started writing up overall documentation, and will work on it tonight.\n\nIn answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.  I certainly wouldn't call myself an expert on writing multi-process code.\n\nI'll write more this evening, and also review #14079 and #14080.",
    "created_at": "2013-02-10T18:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143235",
    "user": "roed"
}
```

Replying to [comment:169 jdemeyer]:
> I would love to cooperate on this ticket, but I'm having a really hard time to understand everything.  As I said before, this absolutely needs some high-level documentation explaining the various classes involved and their inter-relations (in particular, the classes in `forker.py`).

Hi Jeroen,
Sorry for the slow response time: I've had a visitor here in Calgary who's leaving this evening.  I've started writing up overall documentation, and will work on it tonight.

In answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.  I certainly wouldn't call myself an expert on writing multi-process code.

I'll write more this evening, and also review #14079 and #14080.



---

archive/issue_comments_143236.json:
```json
{
    "body": "Replying to [comment:170 roed]:\n> In answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.\nWe obviously need one level of multiprocessing to allow segmentation faults. But my idea would be to skip the first level of multiprocessing and move the code which is currently in `DocTestWorker` to the top-level process. I think that would simplify the code substantially.",
    "created_at": "2013-02-10T22:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143236",
    "user": "jdemeyer"
}
```

Replying to [comment:170 roed]:
> In answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.
We obviously need one level of multiprocessing to allow segmentation faults. But my idea would be to skip the first level of multiprocessing and move the code which is currently in `DocTestWorker` to the top-level process. I think that would simplify the code substantially.



---

archive/issue_comments_143237.json:
```json
{
    "body": "Replying to [comment:171 jdemeyer]:\n> Replying to [comment:170 roed]:\n> > In answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.\n> We obviously need one level of multiprocessing to allow segmentation faults. But my idea would be to skip the first level of multiprocessing and move the code which is currently in `DocTestWorker` to the top-level process. I think that would simplify the code substantially.\n\nHow would you run multiple files in parallel then?",
    "created_at": "2013-02-11T05:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143237",
    "user": "roed"
}
```

Replying to [comment:171 jdemeyer]:
> Replying to [comment:170 roed]:
> > In answer to your question about two layers of multiprocessing, the reason is to insulate the controlling process from segfaults and serious failures in the files being tested.  If we come up with a design that satisfies that goal and also allows testing with multiple processes through `sage -t -p N` I'm happy to change things.
> We obviously need one level of multiprocessing to allow segmentation faults. But my idea would be to skip the first level of multiprocessing and move the code which is currently in `DocTestWorker` to the top-level process. I think that would simplify the code substantially.

How would you run multiple files in parallel then?



---

archive/issue_comments_143238.json:
```json
{
    "body": "Replying to [comment:172 roed]:\n> How would you run multiple files in parallel then?\nLike I said. Have one master process doing the jobs of the current master process + the current `DocTestWorker`. That master process would start child processes for every file to be doctested, check for timeouts and crashes of the child processes.\n\nAnd use #14079 to manage everything without busy-waiting.",
    "created_at": "2013-02-11T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143238",
    "user": "jdemeyer"
}
```

Replying to [comment:172 roed]:
> How would you run multiple files in parallel then?
Like I said. Have one master process doing the jobs of the current master process + the current `DocTestWorker`. That master process would start child processes for every file to be doctested, check for timeouts and crashes of the child processes.

And use #14079 to manage everything without busy-waiting.



---

archive/issue_comments_143239.json:
```json
{
    "body": "Okay.  I have no objections to removing the `-serial` option and changing the process management as you suggest.  It sounds like you have a good idea of how to rewrite it; how can I be useful?  I can certainly review #14080 and #14079 and add overall documentation.  What else would be useful?",
    "created_at": "2013-02-11T08:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143239",
    "user": "roed"
}
```

Okay.  I have no objections to removing the `-serial` option and changing the process management as you suggest.  It sounds like you have a good idea of how to rewrite it; how can I be useful?  I can certainly review #14080 and #14079 and add overall documentation.  What else would be useful?



---

archive/issue_comments_143240.json:
```json
{
    "body": "Replying to [comment:174 roed]:\n> how can I be useful?\nThere are still some doctest failures left. I fixed a few in my reviewer patch (and #14070) but there are some I couldn't immediately fix. There is also the issue with TAB characters in `devel/sagenb/sagenb/data`, ideally that directory would be skipped from doctesting.\n\nBut try not to change `forker.py` too much, as I'm thinking of substantial changes there.",
    "created_at": "2013-02-11T09:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143240",
    "user": "jdemeyer"
}
```

Replying to [comment:174 roed]:
> how can I be useful?
There are still some doctest failures left. I fixed a few in my reviewer patch (and #14070) but there are some I couldn't immediately fix. There is also the issue with TAB characters in `devel/sagenb/sagenb/data`, ideally that directory would be skipped from doctesting.

But try not to change `forker.py` too much, as I'm thinking of substantial changes there.



---

archive/issue_comments_143241.json:
```json
{
    "body": "Replying to [comment:175 jdemeyer]:\n> Replying to [comment:174 roed]:\n> > how can I be useful?\n> There are still some doctest failures left. I fixed a few in my reviewer patch (and #14070) but there are some I couldn't immediately fix. There is also the issue with TAB characters in `devel/sagenb/sagenb/data`, ideally that directory would be skipped from doctesting.\n> \n> But try not to change `forker.py` too much, as I'm thinking of substantial changes there.\n\nSounds good.  I'll work on fixing doctest failures.",
    "created_at": "2013-02-11T09:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143241",
    "user": "roed"
}
```

Replying to [comment:175 jdemeyer]:
> Replying to [comment:174 roed]:
> > how can I be useful?
> There are still some doctest failures left. I fixed a few in my reviewer patch (and #14070) but there are some I couldn't immediately fix. There is also the issue with TAB characters in `devel/sagenb/sagenb/data`, ideally that directory would be skipped from doctesting.
> 
> But try not to change `forker.py` too much, as I'm thinking of substantial changes there.

Sounds good.  I'll work on fixing doctest failures.



---

archive/issue_comments_143242.json:
```json
{
    "body": "I also don't like this:\n\n```\n        except IOError:\n            # File doesn't exist\n            result = 0, DictAsObject(dict(err='file')), \"\"\n```\n\n\nYou assume that *any* `IOError` comes from the fact that the doctested file doesn't exist. But it could also be a problem instead with the temporary file used for output (no space on `/tmp` for example). Then the error message \"File not found\" would be very confusing. I think we need to explicitly check the existence of the doctested file and not handle `IOError` specially.",
    "created_at": "2013-02-11T13:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143242",
    "user": "jdemeyer"
}
```

I also don't like this:

```
        except IOError:
            # File doesn't exist
            result = 0, DictAsObject(dict(err='file')), ""
```


You assume that *any* `IOError` comes from the fact that the doctested file doesn't exist. But it could also be a problem instead with the temporary file used for output (no space on `/tmp` for example). Then the error message "File not found" would be very confusing. I think we need to explicitly check the existence of the doctested file and not handle `IOError` specially.



---

archive/issue_comments_143243.json:
```json
{
    "body": "In \"normal\" mode (non-verbose, non-debug, non-serial), does the `DocTestTask` or `DocTestRunner` ever print something to the real (unspoofed) stdout/stderr?",
    "created_at": "2013-02-11T13:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143243",
    "user": "jdemeyer"
}
```

In "normal" mode (non-verbose, non-debug, non-serial), does the `DocTestTask` or `DocTestRunner` ever print something to the real (unspoofed) stdout/stderr?



---

archive/issue_comments_143244.json:
```json
{
    "body": "Replying to [comment:178 jdemeyer]:\n> In \"normal\" mode (non-verbose, non-debug, non-serial), does the `DocTestTask` or `DocTestRunner` ever print something to the real (unspoofed) stdout/stderr?\n\nI don't think so.",
    "created_at": "2013-02-11T14:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143244",
    "user": "roed"
}
```

Replying to [comment:178 jdemeyer]:
> In "normal" mode (non-verbose, non-debug, non-serial), does the `DocTestTask` or `DocTestRunner` ever print something to the real (unspoofed) stdout/stderr?

I don't think so.



---

archive/issue_comments_143245.json:
```json
{
    "body": "Replying to [comment:177 jdemeyer]:\n> I also don't like this:\n> {{{\n>         except IOError:\n>             # File doesn't exist\n>             result = 0, DictAsObject(dict(err='file')), \"\"\n> }}}\n> \n> You assume that *any* `IOError` comes from the fact that the doctested file doesn't exist. But it could also be a problem instead with the temporary file used for output (no space on `/tmp` for example). Then the error message \"File not found\" would be very confusing. I think we need to explicitly check the existence of the doctested file and not handle `IOError` specially.\n\nFair enough.",
    "created_at": "2013-02-11T14:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143245",
    "user": "roed"
}
```

Replying to [comment:177 jdemeyer]:
> I also don't like this:
> {{{
>         except IOError:
>             # File doesn't exist
>             result = 0, DictAsObject(dict(err='file')), ""
> }}}
> 
> You assume that *any* `IOError` comes from the fact that the doctested file doesn't exist. But it could also be a problem instead with the temporary file used for output (no space on `/tmp` for example). Then the error message "File not found" would be very confusing. I think we need to explicitly check the existence of the doctested file and not handle `IOError` specially.

Fair enough.



---

archive/issue_comments_143246.json:
```json
{
    "body": "I think the word \"output\" is badly overused (there is the standard output, the file `output=os.tmpfile()`, the string `output` referring to the *contents* of the `output` file and `delayed_output`).\n\nI propose to rename:\n- `delayed_output` to `messages`\n- `output` (the file) to `outtmpfile` (or `tmpoutfile`?)\n\nAnd am I right that `delayed_output` is empty in normal mode when there are no doctest failures?",
    "created_at": "2013-02-11T14:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143246",
    "user": "jdemeyer"
}
```

I think the word "output" is badly overused (there is the standard output, the file `output=os.tmpfile()`, the string `output` referring to the *contents* of the `output` file and `delayed_output`).

I propose to rename:
- `delayed_output` to `messages`
- `output` (the file) to `outtmpfile` (or `tmpoutfile`?)

And am I right that `delayed_output` is empty in normal mode when there are no doctest failures?



---

archive/issue_comments_143247.json:
```json
{
    "body": "Replying to [comment:181 jdemeyer]:\n> Can I replace \"`delayed_output`\" by \"`messages`\" because I think the word \"output\" is overused (there is the standard output, the file `outfile=os.tmpfile()` and `delayed_output`).\n> \n> And am I right that `delayed_output` is empty in normal mode when there are no doctest failures?\n\nSure, either \"`messages`\" or \"`delayed_messages`\" is fine.  It should be empty in normal mode with no failures.",
    "created_at": "2013-02-11T14:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143247",
    "user": "roed"
}
```

Replying to [comment:181 jdemeyer]:
> Can I replace "`delayed_output`" by "`messages`" because I think the word "output" is overused (there is the standard output, the file `outfile=os.tmpfile()` and `delayed_output`).
> 
> And am I right that `delayed_output` is empty in normal mode when there are no doctest failures?

Sure, either "`messages`" or "`delayed_messages`" is fine.  It should be empty in normal mode with no failures.



---

archive/issue_comments_143248.json:
```json
{
    "body": "Edited [comment:181] because I noticed there is `output` the file and `output` the contents of the file.",
    "created_at": "2013-02-11T14:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143248",
    "user": "jdemeyer"
}
```

Edited [comment:181] because I noticed there is `output` the file and `output` the contents of the file.



---

archive/issue_comments_143249.json:
```json
{
    "body": "Changing assignee from mvngu to jdemeyer.",
    "created_at": "2013-02-11T14:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143249",
    "user": "jdemeyer"
}
```

Changing assignee from mvngu to jdemeyer.



---

archive/issue_comments_143250.json:
```json
{
    "body": "Replying to [comment:181 jdemeyer]:\n> I think the word \"output\" is badly overused (there is the standard output, the file `output=os.tmpfile()`, the string `output` referring to the *contents* of the `output` file and `delayed_output`).\n> \n> I propose to rename:\n> - `delayed_output` to `messages`\n> - `output` (the file) to `outtmpfile` (or `tmpoutfile`?)\n\nI like `outtmpfile`.",
    "created_at": "2013-02-11T14:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143250",
    "user": "roed"
}
```

Replying to [comment:181 jdemeyer]:
> I think the word "output" is badly overused (there is the standard output, the file `output=os.tmpfile()`, the string `output` referring to the *contents* of the `output` file and `delayed_output`).
> 
> I propose to rename:
> - `delayed_output` to `messages`
> - `output` (the file) to `outtmpfile` (or `tmpoutfile`?)

I like `outtmpfile`.



---

archive/issue_comments_143251.json:
```json
{
    "body": "First version of my updated doctesting framework.",
    "created_at": "2013-02-11T23:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143251",
    "user": "jdemeyer"
}
```

First version of my updated doctesting framework.



---

archive/issue_comments_143252.json:
```json
{
    "body": "Replying to [comment:185 jdemeyer]:\n> First version of my updated doctesting framework.\n\nSome comments: \n* For compatibility with Python's `doctest` module, `summarize` should take `verbose` as the first argument and `msgfile` as an optional second argument.\n* It's `sage.ext.pselecter` rather than `sage.ext.pselect, unless you changed #14079.\n* Currently I get a timeout whenever I run tests on a file.\n* Why did you disable the code that sets `following` in `_parallel_dispatch`?\n\nOverall, I think the changes are good ones.",
    "created_at": "2013-02-12T11:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143252",
    "user": "roed"
}
```

Replying to [comment:185 jdemeyer]:
> First version of my updated doctesting framework.

Some comments: 
* For compatibility with Python's `doctest` module, `summarize` should take `verbose` as the first argument and `msgfile` as an optional second argument.
* It's `sage.ext.pselecter` rather than `sage.ext.pselect, unless you changed #14079.
* Currently I get a timeout whenever I run tests on a file.
* Why did you disable the code that sets `following` in `_parallel_dispatch`?

Overall, I think the changes are good ones.



---

archive/issue_comments_143253.json:
```json
{
    "body": "Replying to [comment:186 roed]:\n> * For compatibility with Python's `doctest` module, `summarize` should take `verbose` as the first argument and `msgfile` as an optional second argument.\nFair enough. I never considered this compatibility, so it is quite possible that I introduced more incompatibilities.\n\n> * It's `sage.ext.pselecter` rather than `sage.ext.pselect, unless you changed #14079.\nYes, I did change #14079 but didn't realise that I hadn't uploaded the new patch. Anyway, I am looking into the problem on OS X.\n\n> * Currently I get a timeout whenever I run tests on a file.\nCould be the same OS-dependent problem as the one you reported in #14079.\n\n> * Why did you disable the code that sets `following` in `_parallel_dispatch`?\nSimply because it is work in progress, new tests are needed. My `DocTestWorker` has a substantially different function from the old `DocTestWorker`, so I cannot recycle the tests.",
    "created_at": "2013-02-12T13:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143253",
    "user": "jdemeyer"
}
```

Replying to [comment:186 roed]:
> * For compatibility with Python's `doctest` module, `summarize` should take `verbose` as the first argument and `msgfile` as an optional second argument.
Fair enough. I never considered this compatibility, so it is quite possible that I introduced more incompatibilities.

> * It's `sage.ext.pselecter` rather than `sage.ext.pselect, unless you changed #14079.
Yes, I did change #14079 but didn't realise that I hadn't uploaded the new patch. Anyway, I am looking into the problem on OS X.

> * Currently I get a timeout whenever I run tests on a file.
Could be the same OS-dependent problem as the one you reported in #14079.

> * Why did you disable the code that sets `following` in `_parallel_dispatch`?
Simply because it is work in progress, new tests are needed. My `DocTestWorker` has a substantially different function from the old `DocTestWorker`, so I cannot recycle the tests.



---

archive/issue_comments_143254.json:
```json
{
    "body": "Updated patch (I haven't looked at the OS X specific issue).",
    "created_at": "2013-02-12T17:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143254",
    "user": "jdemeyer"
}
```

Updated patch (I haven't looked at the OS X specific issue).



---

archive/issue_comments_143255.json:
```json
{
    "body": "I noticed a change in behaviour and I'm wondering whether it is intentional.\n\nOld doctesting framework outputs like:\n\n```\nsage -t file.py\n<messages>\n         [4.1 s]\n```\n\n\nNew doctesting framework outputs like:\n\n```\n<messages>\nsage -t file.py\n    [1 test, 1 failure, 1.7 s]\n```\n\n\nI dislike the last way of outputting, especially in `--verbose` mode, because there is no mention of what file is being tested. You see:\n\n```\nRunning doctests with ID 2013-02-13-12-55-39-de348564.\nDoctesting 1 file.\nTrying (line 2):    cython('sig_on()')\nExpecting nothing\nok [1.61 s]\n...\n```\n\n\"line 2\" of which file?...",
    "created_at": "2013-02-13T11:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143255",
    "user": "jdemeyer"
}
```

I noticed a change in behaviour and I'm wondering whether it is intentional.

Old doctesting framework outputs like:

```
sage -t file.py
<messages>
         [4.1 s]
```


New doctesting framework outputs like:

```
<messages>
sage -t file.py
    [1 test, 1 failure, 1.7 s]
```


I dislike the last way of outputting, especially in `--verbose` mode, because there is no mention of what file is being tested. You see:

```
Running doctests with ID 2013-02-13-12-55-39-de348564.
Doctesting 1 file.
Trying (line 2):    cython('sig_on()')
Expecting nothing
ok [1.61 s]
...
```

"line 2" of which file?...



---

archive/issue_comments_143256.json:
```json
{
    "body": "Replying to [comment:189 jdemeyer]:\n> I noticed a change in behaviour and I'm wondering whether it is intentional.\n> \n> Old doctesting framework outputs like:\n> {{{\n> sage -t file.py\n> <messages>\n>          [4.1 s]\n> }}}\n> \n> New doctesting framework outputs like:\n> {{{\n> <messages>\n> sage -t file.py\n>     [1 test, 1 failure, 1.7 s]\n> }}}\n>\n> I dislike the last way of outputting, especially in `--verbose` mode, because there is no mention of what file is being tested. You see:\n> {{{\n> Running doctests with ID 2013-02-13-12-55-39-de348564.\n> Doctesting 1 file.\n> Trying (line 2):    cython('sig_on()')\n> Expecting nothing\n> ok [1.61 s]\n> ...\n> }}}\n> \"line 2\" of which file?...\n\nAdding the number of tests and number of failures was intentional (to which I assume you don't object).  The change in order is an artifact of the code that delayed printing.  When there are lots of processes running parallel, you can't output \n\n\n```\nsage -t file.py\n```\n\n\nbefore starting testing, since the messages will get mixed up.  I agree that the line describing which file is being tested should come at the beginning.",
    "created_at": "2013-02-13T12:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143256",
    "user": "roed"
}
```

Replying to [comment:189 jdemeyer]:
> I noticed a change in behaviour and I'm wondering whether it is intentional.
> 
> Old doctesting framework outputs like:
> {{{
> sage -t file.py
> <messages>
>          [4.1 s]
> }}}
> 
> New doctesting framework outputs like:
> {{{
> <messages>
> sage -t file.py
>     [1 test, 1 failure, 1.7 s]
> }}}
>
> I dislike the last way of outputting, especially in `--verbose` mode, because there is no mention of what file is being tested. You see:
> {{{
> Running doctests with ID 2013-02-13-12-55-39-de348564.
> Doctesting 1 file.
> Trying (line 2):    cython('sig_on()')
> Expecting nothing
> ok [1.61 s]
> ...
> }}}
> "line 2" of which file?...

Adding the number of tests and number of failures was intentional (to which I assume you don't object).  The change in order is an artifact of the code that delayed printing.  When there are lots of processes running parallel, you can't output 


```
sage -t file.py
```


before starting testing, since the messages will get mixed up.  I agree that the line describing which file is being tested should come at the beginning.



---

archive/issue_comments_143257.json:
```json
{
    "body": "Replying to [comment:190 roed]:\n> I agree that the line describing which file is being tested should come at the beginning.\nOK, so you agree with\n\n```\nsage -t file.py\n<messages>\n    [1 test, 1 failure, 1.7 s]\n```\n\n\nI would move the part of `report()` which prints the \"sage -t ...\" header to a new function `report_start()` (for example) and then correct the logic in `forker.py` to call that function at the appropriate time. Does that sound good?",
    "created_at": "2013-02-13T12:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143257",
    "user": "jdemeyer"
}
```

Replying to [comment:190 roed]:
> I agree that the line describing which file is being tested should come at the beginning.
OK, so you agree with

```
sage -t file.py
<messages>
    [1 test, 1 failure, 1.7 s]
```


I would move the part of `report()` which prints the "sage -t ..." header to a new function `report_start()` (for example) and then correct the logic in `forker.py` to call that function at the appropriate time. Does that sound good?



---

archive/issue_comments_143258.json:
```json
{
    "body": "Replying to [comment:191 jdemeyer]:\n> Replying to [comment:190 roed]:\n> > I agree that the line describing which file is being tested should come at the beginning.\n> OK, so you agree with\n> {{{\n> sage -t file.py\n> <messages>\n>     [1 test, 1 failure, 1.7 s]\n> }}}\n> \n> I would move the part of `report()` which prints the \"sage -t ...\" header to a new function `report_start()` (for example) and then correct the logic in `forker.py` to call that function at the appropriate time. Does that sound good?\n\nSounds good.  Presumably it will get printed to the `msgfile` before all of the other messages and then actually printed to the screen in whatever way is appropriate.",
    "created_at": "2013-02-13T13:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143258",
    "user": "roed"
}
```

Replying to [comment:191 jdemeyer]:
> Replying to [comment:190 roed]:
> > I agree that the line describing which file is being tested should come at the beginning.
> OK, so you agree with
> {{{
> sage -t file.py
> <messages>
>     [1 test, 1 failure, 1.7 s]
> }}}
> 
> I would move the part of `report()` which prints the "sage -t ..." header to a new function `report_start()` (for example) and then correct the logic in `forker.py` to call that function at the appropriate time. Does that sound good?

Sounds good.  Presumably it will get printed to the `msgfile` before all of the other messages and then actually printed to the screen in whatever way is appropriate.



---

archive/issue_comments_143259.json:
```json
{
    "body": "Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).",
    "created_at": "2013-02-15T19:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143259",
    "user": "jdemeyer"
}
```

Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).



---

archive/issue_comments_143260.json:
```json
{
    "body": "Replying to [comment:193 jdemeyer]:\n> Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).\n\nI'm running tests on OS X 10.6.8 with sage 5.7.beta1.\n\n* Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.\n* I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`): it prints out a bunch of help text from IPython, ending with\n\n```\n[SageTerminalApp] Bad config encountered during initialization:\n[SageTerminalApp] Unrecognized flag: '--all'\n```\n\nI'm not really sure what's happening here: perhaps it's related to the IPython upgrade?\n* The same thing happens in `sage.misc.sage_extension` at line 22.\n* There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.\n* There are problems running some tests in `sage.doctest.control` that may go away with your new code.  If not I have fixes for them.\n\nHow is [attachment:12415_review.patch] coming along?",
    "created_at": "2013-02-16T06:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143260",
    "user": "roed"
}
```

Replying to [comment:193 jdemeyer]:
> Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).

I'm running tests on OS X 10.6.8 with sage 5.7.beta1.

* Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.
* I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`): it prints out a bunch of help text from IPython, ending with

```
[SageTerminalApp] Bad config encountered during initialization:
[SageTerminalApp] Unrecognized flag: '--all'
```

I'm not really sure what's happening here: perhaps it's related to the IPython upgrade?
* The same thing happens in `sage.misc.sage_extension` at line 22.
* There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.
* There are problems running some tests in `sage.doctest.control` that may go away with your new code.  If not I have fixes for them.

How is [attachment:12415_review.patch] coming along?



---

archive/issue_comments_143261.json:
```json
{
    "body": "Replying to [comment:194 roed]:\n> Replying to [comment:193 jdemeyer]:\n> > Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).\n> \n> I'm running tests on OS X 10.6.8 with sage 5.7.beta1.\n> \n> * Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.\nThe difference is between plain ASCII characters and some fancy Unicode characters for the display. Not sure what to do with this.\n\n> * I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`):\nDid you apply #14070?\n\n> * There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.\nGood, then please fix it.\n\n> How is [attachment:12415_review.patch] coming along?\nI think it works well for normal testing. I still have to think about `--debug` and things like `--gdb`.  It seems it will be necessary to have a serial mode for example for `--gdb`, so  I have to put that back in.  I would also like to force `--serial` when `--debug` is used, mainly to simplify the code.\n\nBut first I'm going to look at #14079 on OS X.",
    "created_at": "2013-02-16T10:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143261",
    "user": "jdemeyer"
}
```

Replying to [comment:194 roed]:
> Replying to [comment:193 jdemeyer]:
> > Could you please review [attachment:12415_doctest_review.patch]? It contains all my reviewer changes for doctests in the Sage library (i.e. all changes not for the doctest framework).
> 
> I'm running tests on OS X 10.6.8 with sage 5.7.beta1.
> 
> * Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.
The difference is between plain ASCII characters and some fancy Unicode characters for the display. Not sure what to do with this.

> * I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`):
Did you apply #14070?

> * There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.
Good, then please fix it.

> How is [attachment:12415_review.patch] coming along?
I think it works well for normal testing. I still have to think about `--debug` and things like `--gdb`.  It seems it will be necessary to have a serial mode for example for `--gdb`, so  I have to put that back in.  I would also like to force `--serial` when `--debug` is used, mainly to simplify the code.

But first I'm going to look at #14079 on OS X.



---

archive/issue_comments_143262.json:
```json
{
    "body": "> > * Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.\n> The difference is between plain ASCII characters and some fancy Unicode characters for the display. Not sure what to do with this.\n\nI fixed it by temporarily turning off unicode in pretting printing.  I updated the patch with this change.\n\n> > * I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`):\n> Did you apply #14070?\n\nNope: applying #14070 fixed the problem.\n\n> > * There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.\n> Good, then please fix it.\n\nOkay, the easy fix I remembered is to add a line to sagenb.notebook.worksheet:\n\n\n```\n         EXAMPLES: We test the constructor via an indirect doctest::\n \n             sage: nb = sagenb.notebook.notebook.Notebook(tmp_dir()+'.sagenb')\n+            sage: import sagenb.notebook.misc\n             sage: sagenb.notebook.misc.notebook = nb\n             sage: W = nb.create_new_worksheet('Test with unicode \u011b\u0161\u010d\u0159\u017e\u00fd\u00e1\u00ed\u00e9\u010f\u010e', 'admin')\n             sage: W\n\n```\n\n\nI haven't made any changes to `sagenb` for a long time.  I assume this would require a new spkg?\n\n> > How is [attachment:12415_review.patch] coming along?\n> I think it works well for normal testing. I still have to think about `--debug` and things like `--gdb`.  It seems it will be necessary to have a serial mode for example for `--gdb`, so  I have to put that back in.  I would also like to force `--serial` when `--debug` is used, mainly to simplify the code.\n\nMakes sense.\n\n> But first I'm going to look at #14079 on OS X.\n\nGood luck.",
    "created_at": "2013-02-16T12:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143262",
    "user": "roed"
}
```

> > * Your changes to `sage.calculus.test_sympy` break doctests on my machine: they were correct before the change.  Presumably these results are system dependent and should be changed somehow.
> The difference is between plain ASCII characters and some fancy Unicode characters for the display. Not sure what to do with this.

I fixed it by temporarily turning off unicode in pretting printing.  I updated the patch with this change.

> > * I get a bad exit in sage.misc.interpreter at line 132 (in `get_test_shell()`):
> Did you apply #14070?

Nope: applying #14070 fixed the problem.

> > * There's still an error in `sagenb.notebook.worksheet` line 196: `sagenb.notebook` has no attribute `misc`.  I've seen this before and it should be easy to fix.
> Good, then please fix it.

Okay, the easy fix I remembered is to add a line to sagenb.notebook.worksheet:


```
         EXAMPLES: We test the constructor via an indirect doctest::
 
             sage: nb = sagenb.notebook.notebook.Notebook(tmp_dir()+'.sagenb')
+            sage: import sagenb.notebook.misc
             sage: sagenb.notebook.misc.notebook = nb
             sage: W = nb.create_new_worksheet('Test with unicode ', 'admin')
             sage: W

```


I haven't made any changes to `sagenb` for a long time.  I assume this would require a new spkg?

> > How is [attachment:12415_review.patch] coming along?
> I think it works well for normal testing. I still have to think about `--debug` and things like `--gdb`.  It seems it will be necessary to have a serial mode for example for `--gdb`, so  I have to put that back in.  I would also like to force `--serial` when `--debug` is used, mainly to simplify the code.

Makes sense.

> But first I'm going to look at #14079 on OS X.

Good luck.



---

archive/issue_comments_143263.json:
```json
{
    "body": "Replying to [comment:196 roed]:\n> I haven't made any changes to `sagenb` for a long time.  I assume this would require a new spkg?\nNo, sagenb is now officially a separate project. I have sent a patch to \"upstream\" sagenb.",
    "created_at": "2013-02-16T16:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143263",
    "user": "jdemeyer"
}
```

Replying to [comment:196 roed]:
> I haven't made any changes to `sagenb` for a long time.  I assume this would require a new spkg?
No, sagenb is now officially a separate project. I have sent a patch to "upstream" sagenb.



---

archive/issue_comments_143264.json:
```json
{
    "body": "New major update of my code. Now adds support for `--debug`.\n\nI removed `SagePdb` since the motivation of the output-redirection in the Python doctesting framework seems to be doctesting `Pdb` itself, not running a debugger inside the doctesting framework. For the new doctesting framework, we just need to stop spoofing before entering the debugger and start spoofing after the debugger is finished and that's all.",
    "created_at": "2013-02-18T15:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143264",
    "user": "jdemeyer"
}
```

New major update of my code. Now adds support for `--debug`.

I removed `SagePdb` since the motivation of the output-redirection in the Python doctesting framework seems to be doctesting `Pdb` itself, not running a debugger inside the doctesting framework. For the new doctesting framework, we just need to stop spoofing before entering the debugger and start spoofing after the debugger is finished and that's all.



---

archive/issue_comments_143265.json:
```json
{
    "body": "I fixed a few doctests errors, now the only remaining failure is\n\n```\nsage -t --long devel/sage/sage/doctest/sources.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/sources.py\", line 653, in sage.doctest.sources.FileDocTestSource._test_enough_doctests\nFailed example:\n    for path, dirs, files in itertools.chain(os.walk(sage_loc), os.walk(doc_loc)): # long time\n        path = os.path.relpath(path)\n        for F in files:\n            _, ext = os.path.splitext(F)\n            if ext in ('.py', '.pyx', '.sage', '.spyx', '.rst', '.tex'):\n                filename = os.path.join(path, F)\n                FDS = FileDocTestSource(filename, True, True, True, False)\n                FDS._test_enough_doctests(verbose=False)\nExpected:\n    There are 3 unexpected tests being run in .../sage/doctest/parsing.py\n    There are 1 tests in .../sage/ext/c_lib.pyx that are not being run\n    There are 2 tests in .../sage/server/notebook/worksheet.py that are not being run\n    There are 5 tests in .../doc/en/tutorial/interfaces.rst that are not being run\nGot:\n    doctest:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal\n    There are 2 tests in devel/sage/sage/server/notebook/worksheet.py that are not being run\n    There are 2 unexpected tests being run in devel/sage/sage/misc/cython.py\n    There are 9 tests in devel/sage/sage/graphs/graph_plot.py that are not being run\n    There are 1 tests in devel/sage/sage/ext/c_lib.pyx that are not being run\n    There are 3 unexpected tests being run in devel/sage/sage/doctest/parsing.py\n    There are 5 tests in devel/sage/doc/en/tutorial/interfaces.rst that are not being run\n    There are 1152 tests in devel/sage/doc/output/latex/en/reference/reference.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/en/tutorial/SageTutorial.tex that are not being run\n    There are 4 tests in devel/sage/doc/output/latex/en/thematic_tutorials/thematic_tutorials.tex that are not being run\n    There are 6 tests in devel/sage/doc/output/latex/en/prep/prep_tutorials.tex that are not being run\n    There are 2 tests in devel/sage/doc/output/latex/en/numerical_sage/numerical_sage.tex that are not being run\n    There are 15 tests in devel/sage/doc/output/latex/en/developer/developer.tex that are not being run\n    There are 16 tests in devel/sage/doc/output/latex/en/constructions/constructions.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/ru/tutorial/SageTutorial_ru.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/fr/tutorial/tutorial-fr.tex that are not being run\n    There are 51 tests in devel/sage/doc/output/latex/de/tutorial/SageTutorial-de.tex that are not being run\n**********************************************************************\n```\n\n\nAnd there are still messages about TABs in `sagenb/data`.",
    "created_at": "2013-02-18T20:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143265",
    "user": "jdemeyer"
}
```

I fixed a few doctests errors, now the only remaining failure is

```
sage -t --long devel/sage/sage/doctest/sources.py
**********************************************************************
File "devel/sage/sage/doctest/sources.py", line 653, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk(sage_loc), os.walk(doc_loc)): # long time
        path = os.path.relpath(path)
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.sage', '.spyx', '.rst', '.tex'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, True, True, True, False)
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 3 unexpected tests being run in .../sage/doctest/parsing.py
    There are 1 tests in .../sage/ext/c_lib.pyx that are not being run
    There are 2 tests in .../sage/server/notebook/worksheet.py that are not being run
    There are 5 tests in .../doc/en/tutorial/interfaces.rst that are not being run
Got:
    doctest:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
    There are 2 tests in devel/sage/sage/server/notebook/worksheet.py that are not being run
    There are 2 unexpected tests being run in devel/sage/sage/misc/cython.py
    There are 9 tests in devel/sage/sage/graphs/graph_plot.py that are not being run
    There are 1 tests in devel/sage/sage/ext/c_lib.pyx that are not being run
    There are 3 unexpected tests being run in devel/sage/sage/doctest/parsing.py
    There are 5 tests in devel/sage/doc/en/tutorial/interfaces.rst that are not being run
    There are 1152 tests in devel/sage/doc/output/latex/en/reference/reference.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/en/tutorial/SageTutorial.tex that are not being run
    There are 4 tests in devel/sage/doc/output/latex/en/thematic_tutorials/thematic_tutorials.tex that are not being run
    There are 6 tests in devel/sage/doc/output/latex/en/prep/prep_tutorials.tex that are not being run
    There are 2 tests in devel/sage/doc/output/latex/en/numerical_sage/numerical_sage.tex that are not being run
    There are 15 tests in devel/sage/doc/output/latex/en/developer/developer.tex that are not being run
    There are 16 tests in devel/sage/doc/output/latex/en/constructions/constructions.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/ru/tutorial/SageTutorial_ru.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/fr/tutorial/tutorial-fr.tex that are not being run
    There are 51 tests in devel/sage/doc/output/latex/de/tutorial/SageTutorial-de.tex that are not being run
**********************************************************************
```


And there are still messages about TABs in `sagenb/data`.



---

archive/issue_comments_143266.json:
```json
{
    "body": "I have been thinking about the encoding warnings (and encodings in doctests in general). I think there are two options:\n1. either we ignore the Cython warnings and continue working with pure strings,\n2. or we make the doctester completely Unicode-aware.\n\nI don't really see any middle ground. I'm inclined to go for the first option initially, but eventually migrating to the second option *in a different ticket*.\n\nBut I'm open to opinions on this.",
    "created_at": "2013-02-19T19:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143266",
    "user": "jdemeyer"
}
```

I have been thinking about the encoding warnings (and encodings in doctests in general). I think there are two options:
1. either we ignore the Cython warnings and continue working with pure strings,
2. or we make the doctester completely Unicode-aware.

I don't really see any middle ground. I'm inclined to go for the first option initially, but eventually migrating to the second option *in a different ticket*.

But I'm open to opinions on this.



---

archive/issue_comments_143267.json:
```json
{
    "body": "Replying to [comment:200 jdemeyer]:\n> I have been thinking about the encoding warnings (and encodings in doctests in general). I think there are two options:\n>  1. either we ignore the Cython warnings and continue working with pure strings,\n>  2. or we make the doctester completely Unicode-aware.\n> \n> I don't really see any middle ground. I'm inclined to go for the first option initially, but eventually migrating to the second option *in a different ticket*.\n> \n> But I'm open to opinions on this.\n\nSounds like a good plan to me.  I prefer to avoid unicode when I can.",
    "created_at": "2013-02-19T19:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143267",
    "user": "roed"
}
```

Replying to [comment:200 jdemeyer]:
> I have been thinking about the encoding warnings (and encodings in doctests in general). I think there are two options:
>  1. either we ignore the Cython warnings and continue working with pure strings,
>  2. or we make the doctester completely Unicode-aware.
> 
> I don't really see any middle ground. I'm inclined to go for the first option initially, but eventually migrating to the second option *in a different ticket*.
> 
> But I'm open to opinions on this.

Sounds like a good plan to me.  I prefer to avoid unicode when I can.



---

archive/issue_comments_143268.json:
```json
{
    "body": "With these patches + the patched sagenb (https://github.com/sagemath/sagenb/pull/84), I get just one sporadic failure:\n\n```\nsage -t --long devel/sage/sage/homology/simplicial_complex.py\n**********************************************************************\nFile \"devel/sage/sage/homology/simplicial_complex.py\", line 2188, in sage.homology.simplicial_complex.SimplicialComplex.is_cohen_macaulay\nFailed example:\n    S.is_cohen_macaulay(ncpus=3)\nExpected:\n    False\nGot:\n    Exception OSError: (10, 'No child processes') in <generator object __call__ at 0x646f1e0> ignored\n    False\n**********************************************************************\n```\n\n\nI have not investigated, but I assume it must be some strange interaction between the `DocTestWorker` processes and the `cohen_macaulay` subprocesses.\n\nSince `bsd.math` has been down for a while (now it is back up), I haven't been able to look into the OS X issues.\n\nI guess the only remaining issue is `--gdb` (and `--valgrind`...) support.",
    "created_at": "2013-02-20T08:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143268",
    "user": "jdemeyer"
}
```

With these patches + the patched sagenb (https://github.com/sagemath/sagenb/pull/84), I get just one sporadic failure:

```
sage -t --long devel/sage/sage/homology/simplicial_complex.py
**********************************************************************
File "devel/sage/sage/homology/simplicial_complex.py", line 2188, in sage.homology.simplicial_complex.SimplicialComplex.is_cohen_macaulay
Failed example:
    S.is_cohen_macaulay(ncpus=3)
Expected:
    False
Got:
    Exception OSError: (10, 'No child processes') in <generator object __call__ at 0x646f1e0> ignored
    False
**********************************************************************
```


I have not investigated, but I assume it must be some strange interaction between the `DocTestWorker` processes and the `cohen_macaulay` subprocesses.

Since `bsd.math` has been down for a while (now it is back up), I haven't been able to look into the OS X issues.

I guess the only remaining issue is `--gdb` (and `--valgrind`...) support.



---

archive/issue_comments_143269.json:
```json
{
    "body": "So is this ready for review by me?",
    "created_at": "2013-02-20T22:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143269",
    "user": "roed"
}
```

So is this ready for review by me?



---

archive/issue_comments_143270.json:
```json
{
    "body": "Parallel testing still doesn't work on OS X.  1-process testing (`-p 1`) works.",
    "created_at": "2013-02-23T00:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143270",
    "user": "jdemeyer"
}
```

Parallel testing still doesn't work on OS X.  1-process testing (`-p 1`) works.



---

archive/issue_comments_143271.json:
```json
{
    "body": "Do you know why parallel testing doesn't work?",
    "created_at": "2013-02-24T11:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143271",
    "user": "roed"
}
```

Do you know why parallel testing doesn't work?



---

archive/issue_comments_143272.json:
```json
{
    "body": "What's the point of running optional tests without optional \"sage\" tests? Because that would badly fail with code like\n\n```\nsage: a = some_object()\nsage: a.some_standard_method()\nsage: a.use_mypackage()  # optional: mypackage\n```\n\n(only the last line would be executed)\n\nAre all doctests supposed to be written like\n\n```\nsage: a = some_object()\nsage: a.some_standard_method()\n\nsage: a = some_object()  # optional: mypackage\nsage: a.use_mypackage()  # optional: mypackage\n```\n",
    "created_at": "2013-02-25T16:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143272",
    "user": "jdemeyer"
}
```

What's the point of running optional tests without optional "sage" tests? Because that would badly fail with code like

```
sage: a = some_object()
sage: a.some_standard_method()
sage: a.use_mypackage()  # optional: mypackage
```

(only the last line would be executed)

Are all doctests supposed to be written like

```
sage: a = some_object()
sage: a.some_standard_method()

sage: a = some_object()  # optional: mypackage
sage: a.use_mypackage()  # optional: mypackage
```




---

archive/issue_comments_143273.json:
```json
{
    "body": "Replying to [comment:210 jdemeyer]:\n> What's the point of running optional tests without optional \"sage\" tests? Because that would badly fail with code like\n> {{{\n> sage: a = some_object()\n> sage: a.some_standard_method()\n> sage: a.use_mypackage()  # optional: mypackage\n> }}}\n> (only the last line would be executed)\n> \n> Are all doctests supposed to be written like\n> {{{\n> sage: a = some_object()\n> sage: a.some_standard_method()\n> \n> sage: a = some_object()  # optional: mypackage\n> sage: a.use_mypackage()  # optional: mypackage\n> }}}\n\nI agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only files with optional gap tests be run.",
    "created_at": "2013-02-25T21:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143273",
    "user": "roed"
}
```

Replying to [comment:210 jdemeyer]:
> What's the point of running optional tests without optional "sage" tests? Because that would badly fail with code like
> {{{
> sage: a = some_object()
> sage: a.some_standard_method()
> sage: a.use_mypackage()  # optional: mypackage
> }}}
> (only the last line would be executed)
> 
> Are all doctests supposed to be written like
> {{{
> sage: a = some_object()
> sage: a.some_standard_method()
> 
> sage: a = some_object()  # optional: mypackage
> sage: a.use_mypackage()  # optional: mypackage
> }}}

I agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only files with optional gap tests be run.



---

archive/issue_comments_143274.json:
```json
{
    "body": "Replying to [comment:213 roed]:\n> I agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only **files with** optional gap tests be run.\nSo this is basically an option waiting for a better future implementation?",
    "created_at": "2013-02-25T22:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143274",
    "user": "jdemeyer"
}
```

Replying to [comment:213 roed]:
> I agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only **files with** optional gap tests be run.
So this is basically an option waiting for a better future implementation?



---

archive/issue_comments_143275.json:
```json
{
    "body": "Replying to [comment:214 jdemeyer]:\n> Replying to [comment:213 roed]:\n> > I agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only **files with** optional gap tests be run.\n> So this is basically an option waiting for a better future implementation?\n\nYeah, that's how I see it.  I don't really run optional tests very often, but it seems like it could be useful to quickly run the tests that directly depend on gap when you update an spkg or something.  But I'm not really attached to the particulars of the interface, so feel free to change it.",
    "created_at": "2013-02-25T23:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143275",
    "user": "roed"
}
```

Replying to [comment:214 jdemeyer]:
> Replying to [comment:213 roed]:
> > I agree that the current implementation is kinda dumb.  But I could see wanting to run `sage -t --all --optional gap` and have only **files with** optional gap tests be run.
> So this is basically an option waiting for a better future implementation?

Yeah, that's how I see it.  I don't really run optional tests very often, but it seems like it could be useful to quickly run the tests that directly depend on gap when you update an spkg or something.  But I'm not really attached to the particulars of the interface, so feel free to change it.



---

archive/issue_comments_143276.json:
```json
{
    "body": "A question about this new framework: at #13928, it was pointed out that if you (for whatever reason) put the Sage directory into a directory whose path contains \"/.\" (like \"/home/user/.Sage-stuff/sage-5.8.beta0/\"), then it will refuse to doctest any files in the Sage library. Will that still be true with this new setup? Basically, I'm wondering if this ticket supersedes #13928.",
    "created_at": "2013-02-26T03:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143276",
    "user": "jhpalmieri"
}
```

A question about this new framework: at #13928, it was pointed out that if you (for whatever reason) put the Sage directory into a directory whose path contains "/." (like "/home/user/.Sage-stuff/sage-5.8.beta0/"), then it will refuse to doctest any files in the Sage library. Will that still be true with this new setup? Basically, I'm wondering if this ticket supersedes #13928.



---

archive/issue_comments_143277.json:
```json
{
    "body": "Replying to [comment:216 jhpalmieri]:\n> A question about this new framework: at #13928, it was pointed out that if you (for whatever reason) put the Sage directory into a directory whose path contains \"/.\" (like \"/home/user/.Sage-stuff/sage-5.8.beta0/\")\nHiding Sage from the boss?\n\n> then it will refuse to doctest any files in the Sage library. Will that still be true with this new setup?\nNo, see `sage/doctest/control.py`, line 456.",
    "created_at": "2013-02-26T06:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143277",
    "user": "jdemeyer"
}
```

Replying to [comment:216 jhpalmieri]:
> A question about this new framework: at #13928, it was pointed out that if you (for whatever reason) put the Sage directory into a directory whose path contains "/." (like "/home/user/.Sage-stuff/sage-5.8.beta0/")
Hiding Sage from the boss?

> then it will refuse to doctest any files in the Sage library. Will that still be true with this new setup?
No, see `sage/doctest/control.py`, line 456.



---

archive/issue_comments_143278.json:
```json
{
    "body": "Nathann has a reason for putting his entire Sage installation in a hidden directory. I can understand why we would skip testing files in directories within the Sage library that start with \".\" (like \".hg\"), but why not just have that limitation and let the user put their Sage directory anywhere?",
    "created_at": "2013-02-26T15:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143278",
    "user": "jhpalmieri"
}
```

Nathann has a reason for putting his entire Sage installation in a hidden directory. I can understand why we would skip testing files in directories within the Sage library that start with "." (like ".hg"), but why not just have that limitation and let the user put their Sage directory anywhere?



---

archive/issue_comments_143279.json:
```json
{
    "body": "Replying to [comment:218 jhpalmieri]:\n> Nathann has a reason for putting his entire Sage installation in a hidden directory. I can understand why we would skip testing files in directories within the Sage library that start with \".\" (like \".hg\"), but why not just have that limitation\n\nI believe that's precisely what we're doing, unless I am mistaken.",
    "created_at": "2013-02-26T16:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143279",
    "user": "jdemeyer"
}
```

Replying to [comment:218 jhpalmieri]:
> Nathann has a reason for putting his entire Sage installation in a hidden directory. I can understand why we would skip testing files in directories within the Sage library that start with "." (like ".hg"), but why not just have that limitation

I believe that's precisely what we're doing, unless I am mistaken.



---

archive/issue_comments_143280.json:
```json
{
    "body": "Sorry John, I misread your original question.",
    "created_at": "2013-02-26T16:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143280",
    "user": "jdemeyer"
}
```

Sorry John, I misread your original question.



---

archive/issue_comments_143281.json:
```json
{
    "body": "Okay, good, then I suggest that we close #13928 as a duplicate of this one, or at least close #13928 when this one is merged.",
    "created_at": "2013-02-26T16:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143281",
    "user": "jhpalmieri"
}
```

Okay, good, then I suggest that we close #13928 as a duplicate of this one, or at least close #13928 when this one is merged.



---

archive/issue_comments_143282.json:
```json
{
    "body": "> I can understand why we would skip testing files in directories within the Sage library that start with \".\" (like \".hg\"), but why not just have that limitation\n> \n> I believe that's precisely what we're doing, unless I am mistaken.\n\nSorry, but I don't get it `O_o`\n\nAfter this patch is applied, will all files be skipped if SAGE_ROOT contains a `/.` somewhere, even if it is not a `/.hg` ?\n\nNathann",
    "created_at": "2013-02-26T16:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143282",
    "user": "ncohen"
}
```

> I can understand why we would skip testing files in directories within the Sage library that start with "." (like ".hg"), but why not just have that limitation
> 
> I believe that's precisely what we're doing, unless I am mistaken.

Sorry, but I don't get it `O_o`

After this patch is applied, will all files be skipped if SAGE_ROOT contains a `/.` somewhere, even if it is not a `/.hg` ?

Nathann



---

archive/issue_comments_143283.json:
```json
{
    "body": "> Okay, good, then I suggest that we close #13928 as a duplicate of this one, or at least close #13928 when this one is merged.\n\nGloops. That answers my question too `:-)`\n\nThen I will set #13928 to \"positive review/duplicate\", as I can safely have faith in our release manager and this patch `:-)`\n\nNathann",
    "created_at": "2013-02-26T17:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143283",
    "user": "ncohen"
}
```

> Okay, good, then I suggest that we close #13928 as a duplicate of this one, or at least close #13928 when this one is merged.

Gloops. That answers my question too `:-)`

Then I will set #13928 to "positive review/duplicate", as I can safely have faith in our release manager and this patch `:-)`

Nathann



---

archive/issue_comments_143284.json:
```json
{
    "body": "What goes wrong with parallel testing on OS X? I've installed the patches on an OS X 10.8.2 box, and running `./sage -tp devel/sage/sage/homology devel/sage/sage/parallel/` works fine, correctly detecting two cores, and completing testing faster than `./sage -t ...`. Using `./sage -tp 3 ...` runs even slightly faster.",
    "created_at": "2013-02-26T17:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143284",
    "user": "jhpalmieri"
}
```

What goes wrong with parallel testing on OS X? I've installed the patches on an OS X 10.8.2 box, and running `./sage -tp devel/sage/sage/homology devel/sage/sage/parallel/` works fine, correctly detecting two cores, and completing testing faster than `./sage -t ...`. Using `./sage -tp 3 ...` runs even slightly faster.



---

archive/issue_comments_143285.json:
```json
{
    "body": "Replying to [comment:225 jhpalmieri]:\n> What goes wrong with parallel testing on OS X? I've installed the patches on an OS X 10.8.2 box, and running `./sage -tp devel/sage/sage/homology devel/sage/sage/parallel/` works fine, correctly detecting two cores, and completing testing faster than `./sage -t ...`. Using `./sage -tp 3 ...` runs even slightly faster.\n\nJeroen said at #14079 that the parallel testing problem on OS X should be fixed now.",
    "created_at": "2013-02-26T19:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143285",
    "user": "roed"
}
```

Replying to [comment:225 jhpalmieri]:
> What goes wrong with parallel testing on OS X? I've installed the patches on an OS X 10.8.2 box, and running `./sage -tp devel/sage/sage/homology devel/sage/sage/parallel/` works fine, correctly detecting two cores, and completing testing faster than `./sage -t ...`. Using `./sage -tp 3 ...` runs even slightly faster.

Jeroen said at #14079 that the parallel testing problem on OS X should be fixed now.



---

archive/issue_comments_143286.json:
```json
{
    "body": "So far, OS X has not been my priority. I think it has to do with the way terminals are handled (try `./sage -t ... </dev/null 2>&1 | cat` for example, completely bypassing terminal I/O)",
    "created_at": "2013-02-26T21:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143286",
    "user": "jdemeyer"
}
```

So far, OS X has not been my priority. I think it has to do with the way terminals are handled (try `./sage -t ... </dev/null 2>&1 | cat` for example, completely bypassing terminal I/O)



---

archive/issue_comments_143287.json:
```json
{
    "body": "Concerning terminals, I also noted (on Linux) that piping output to `less` (`./sage -t ... | less`) doesn't quite work properly.",
    "created_at": "2013-02-26T21:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143287",
    "user": "jdemeyer"
}
```

Concerning terminals, I also noted (on Linux) that piping output to `less` (`./sage -t ... | less`) doesn't quite work properly.



---

archive/issue_comments_143288.json:
```json
{
    "body": "Without applying any of the patches here, if a user modifies their configuration, say via #14188, some doctests may fail. I assume the same will be true after applying the patches here. My question: should `make ptest` (etc.) run with the `--nodotsage` setting, while `sage -t ...` uses the user's configuration? Or should both use `--nodotsage`, or neither use it?",
    "created_at": "2013-02-27T16:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143288",
    "user": "jhpalmieri"
}
```

Without applying any of the patches here, if a user modifies their configuration, say via #14188, some doctests may fail. I assume the same will be true after applying the patches here. My question: should `make ptest` (etc.) run with the `--nodotsage` setting, while `sage -t ...` uses the user's configuration? Or should both use `--nodotsage`, or neither use it?



---

archive/issue_comments_143289.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-27T19:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143289",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143290.json:
```json
{
    "body": "Replying to [comment:229 jhpalmieri]:\n> Without applying any of the patches here, if a user modifies their configuration, say via #14188, some doctests may fail. I assume the same will be true after applying the patches here. My question: should `make ptest` (etc.) run with the `--nodotsage` setting, while `sage -t ...` uses the user's configuration? Or should both use `--nodotsage`, or neither use it?\n\nI would say that both should use it: I don't see why the user might need their custom configuration when doctesting.",
    "created_at": "2013-02-27T21:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143290",
    "user": "roed"
}
```

Replying to [comment:229 jhpalmieri]:
> Without applying any of the patches here, if a user modifies their configuration, say via #14188, some doctests may fail. I assume the same will be true after applying the patches here. My question: should `make ptest` (etc.) run with the `--nodotsage` setting, while `sage -t ...` uses the user's configuration? Or should both use `--nodotsage`, or neither use it?

I would say that both should use it: I don't see why the user might need their custom configuration when doctesting.



---

archive/issue_comments_143291.json:
```json
{
    "body": "I have a request/suggestion: move `DOCTEST_MODE` out of plot.py and into a file in the doctest directory. Right now, importing from plot.py can be lead to circular imports, etc. Also, it never belonged in plot.py in the first place. Can we do that on this ticket, or should it be on a followup?",
    "created_at": "2013-02-28T06:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143291",
    "user": "jhpalmieri"
}
```

I have a request/suggestion: move `DOCTEST_MODE` out of plot.py and into a file in the doctest directory. Right now, importing from plot.py can be lead to circular imports, etc. Also, it never belonged in plot.py in the first place. Can we do that on this ticket, or should it be on a followup?



---

archive/issue_comments_143292.json:
```json
{
    "body": "Replying to [comment:82 roed]:\n> Do you ever use `sage -t` with valgrind?  I'm not sure exactly what's wrong with `sage -t --valgrind <FILENAME>`.\nIt used to work and I used it at some point to deal with the nice random failures caused by the introduction of weak caches of #715.\nNote the optional spkg we currently propose is really old (and surely dysfunctional on most systems), but there's an update rotting at #13060.\nI wouldn't mind making valgrind working again a follow-up ticket as I'm not actively using it right now.",
    "created_at": "2013-02-28T09:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143292",
    "user": "jpflori"
}
```

Replying to [comment:82 roed]:
> Do you ever use `sage -t` with valgrind?  I'm not sure exactly what's wrong with `sage -t --valgrind <FILENAME>`.
It used to work and I used it at some point to deal with the nice random failures caused by the introduction of weak caches of #715.
Note the optional spkg we currently propose is really old (and surely dysfunctional on most systems), but there's an update rotting at #13060.
I wouldn't mind making valgrind working again a follow-up ticket as I'm not actively using it right now.



---

archive/issue_comments_143293.json:
```json
{
    "body": "Concerning `DOT_SAGE`: it's not as easy as you think. The problem is that the doctesting framework needs `DOT_SAGE` in a few places, for example to store the timing information. So running\n\n```\nsage --nodotsage -t ...\n```\n\nis not an option.\n\nPerhaps changing `$IPYTHONDIR` is sufficient? That could be done within the doctesting framework.",
    "created_at": "2013-02-28T09:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143293",
    "user": "jdemeyer"
}
```

Concerning `DOT_SAGE`: it's not as easy as you think. The problem is that the doctesting framework needs `DOT_SAGE` in a few places, for example to store the timing information. So running

```
sage --nodotsage -t ...
```

is not an option.

Perhaps changing `$IPYTHONDIR` is sufficient? That could be done within the doctesting framework.



---

archive/issue_comments_143294.json:
```json
{
    "body": "Replying to [comment:232 jhpalmieri]:\n> I have a request/suggestion: move `DOCTEST_MODE` out of plot.py and into a file in the doctest directory. Right now, importing from plot.py can be lead to circular imports, etc. Also, it never belonged in plot.py in the first place. Can we do that on this ticket, or should it be on a followup?\nThis ticket is already big enough, so I created the follow-up #14203.",
    "created_at": "2013-02-28T09:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143294",
    "user": "jdemeyer"
}
```

Replying to [comment:232 jhpalmieri]:
> I have a request/suggestion: move `DOCTEST_MODE` out of plot.py and into a file in the doctest directory. Right now, importing from plot.py can be lead to circular imports, etc. Also, it never belonged in plot.py in the first place. Can we do that on this ticket, or should it be on a followup?
This ticket is already big enough, so I created the follow-up #14203.



---

archive/issue_comments_143295.json:
```json
{
    "body": "Attachment [12415_doctest_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doctest_review.patch) by jdemeyer created at 2013-02-28 13:44:42",
    "created_at": "2013-02-28T13:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143295",
    "user": "jdemeyer"
}
```

Attachment [12415_doctest_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doctest_review.patch) by jdemeyer created at 2013-02-28 13:44:42



---

archive/issue_comments_143296.json:
```json
{
    "body": "Attachment [12415_script_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_script_review.patch) by jdemeyer created at 2013-02-28 16:12:26",
    "created_at": "2013-02-28T16:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143296",
    "user": "jdemeyer"
}
```

Attachment [12415_script_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_script_review.patch) by jdemeyer created at 2013-02-28 16:12:26



---

archive/issue_comments_143297.json:
```json
{
    "body": "All tests pass for me.  I'm reading through [attachment:12415_review.patch].",
    "created_at": "2013-02-28T19:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143297",
    "user": "roed"
}
```

All tests pass for me.  I'm reading through [attachment:12415_review.patch].



---

archive/issue_comments_143298.json:
```json
{
    "body": "Fixed a conflict (nothing serious) with #14054.",
    "created_at": "2013-02-28T19:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143298",
    "user": "jdemeyer"
}
```

Fixed a conflict (nothing serious) with #14054.



---

archive/issue_comments_143299.json:
```json
{
    "body": "Still working through [attachment:12415_review.patch], but note that four functions in sage.doctest.forker don't have tests.",
    "created_at": "2013-02-28T20:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143299",
    "user": "roed"
}
```

Still working through [attachment:12415_review.patch], but note that four functions in sage.doctest.forker don't have tests.



---

archive/issue_comments_143300.json:
```json
{
    "body": "Here's a review patch which adds doctests for the four functions that were missing them and makes a few other minor changes.  Other than this, I'm happy with Jeroen's changes.",
    "created_at": "2013-03-01T01:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143300",
    "user": "roed"
}
```

Here's a review patch which adds doctests for the four functions that were missing them and makes a few other minor changes.  Other than this, I'm happy with Jeroen's changes.



---

archive/issue_comments_143301.json:
```json
{
    "body": "In [attachment:12415_review_review.patch], line 693 of control.py, \"sage.supp\" got changed to \"sage.sup\". Was this intentional?",
    "created_at": "2013-03-01T04:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143301",
    "user": "jhpalmieri"
}
```

In [attachment:12415_review_review.patch], line 693 of control.py, "sage.supp" got changed to "sage.sup". Was this intentional?



---

archive/issue_comments_143302.json:
```json
{
    "body": "When I run `make ptestlong`, things look fine on the screen, but I see some funny characters in ptestlong.log (this is on OS X 10.8.2):\n\n```\nDoctesting 2283 files using 2 threads.\n^[\ufffd[?1034hsage -t --long devel/sage/sage/misc/interpreter.py\n    [107 tests, 12.0 s]\n```\n\nSo far, this is the only instance of this in the file. Could it be some sort of terminal color escape sequence? I see it on one machine but not another, so maybe it was just a cosmic ray...",
    "created_at": "2013-03-01T05:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143302",
    "user": "jhpalmieri"
}
```

When I run `make ptestlong`, things look fine on the screen, but I see some funny characters in ptestlong.log (this is on OS X 10.8.2):

```
Doctesting 2283 files using 2 threads.
^[[?1034hsage -t --long devel/sage/sage/misc/interpreter.py
    [107 tests, 12.0 s]
```

So far, this is the only instance of this in the file. Could it be some sort of terminal color escape sequence? I see it on one machine but not another, so maybe it was just a cosmic ray...



---

archive/issue_comments_143303.json:
```json
{
    "body": "Replying to [comment:243 jhpalmieri]:\n> In [attachment:12415_review_review.patch], line 693 of control.py, \"sage.supp\" got changed to \"sage.sup\". Was this intentional?\n\nNope: thanks for catching that.",
    "created_at": "2013-03-01T05:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143303",
    "user": "roed"
}
```

Replying to [comment:243 jhpalmieri]:
> In [attachment:12415_review_review.patch], line 693 of control.py, "sage.supp" got changed to "sage.sup". Was this intentional?

Nope: thanks for catching that.



---

archive/issue_comments_143304.json:
```json
{
    "body": "Replying to [comment:244 jhpalmieri]:\n> When I run `make ptestlong`, things look fine on the screen, but I see some funny characters in ptestlong.log (this is on OS X 10.8.2):\n> {{{\n> Doctesting 2283 files using 2 threads.\n> ^[[?1034hsage -t --long devel/sage/sage/misc/interpreter.py\n>     [107 tests, 12.0 s]\n> }}}\n> So far, this is the only instance of this in the file. Could it be some sort of terminal color escape sequence?\nYes. It most likely comes from the `import readline` I added in `init_sage()` (this happens once, so it's normal you see it only once in `ptestlong.log`). I have been fighting quite a bit with terminal I/O in this new doctester, and this is yet another manifestion of terminal issues :-(",
    "created_at": "2013-03-01T08:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143304",
    "user": "jdemeyer"
}
```

Replying to [comment:244 jhpalmieri]:
> When I run `make ptestlong`, things look fine on the screen, but I see some funny characters in ptestlong.log (this is on OS X 10.8.2):
> {{{
> Doctesting 2283 files using 2 threads.
> ^[[?1034hsage -t --long devel/sage/sage/misc/interpreter.py
>     [107 tests, 12.0 s]
> }}}
> So far, this is the only instance of this in the file. Could it be some sort of terminal color escape sequence?
Yes. It most likely comes from the `import readline` I added in `init_sage()` (this happens once, so it's normal you see it only once in `ptestlong.log`). I have been fighting quite a bit with terminal I/O in this new doctester, and this is yet another manifestion of terminal issues :-(



---

archive/issue_comments_143305.json:
```json
{
    "body": "Could you do me a favour since I don't have access to an OS X 10.8 system:\n\nRemove that `import readline` statement and run\n\n```\n./sage -btp N --long devel/sage/sage/doctest devel/sage/sage/tests\n```\n\nin the following ways:\n1. Normal doctest run in the terminal, let it finish\n2. Interrupt (CTRL-C) the tests somewhere in the middle of the run\n3. Pipe the output through `less`: `./sage -tp 2 ... | less`\nAnd all this both with `-p 1` and with `-p N` for some `N > 1`.",
    "created_at": "2013-03-01T08:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143305",
    "user": "jdemeyer"
}
```

Could you do me a favour since I don't have access to an OS X 10.8 system:

Remove that `import readline` statement and run

```
./sage -btp N --long devel/sage/sage/doctest devel/sage/sage/tests
```

in the following ways:
1. Normal doctest run in the terminal, let it finish
2. Interrupt (CTRL-C) the tests somewhere in the middle of the run
3. Pipe the output through `less`: `./sage -tp 2 ... | less`
And all this both with `-p 1` and with `-p N` for some `N > 1`.



---

archive/issue_comments_143306.json:
```json
{
    "body": "David, I noticed that `doc/en/developer/doctesting.rst` in [attachment:12415_doc.patch] is full of TAB characters. Could you please replace those by 8 spaces?\n\nI agree with [attachment:12415_review_review.patch].\n\nDid you also look at [attachment:12415_doctest_review.patch], [attachment:12415_script_review.patch] and [attachment:12415_test.patch]?",
    "created_at": "2013-03-01T08:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143306",
    "user": "jdemeyer"
}
```

David, I noticed that `doc/en/developer/doctesting.rst` in [attachment:12415_doc.patch] is full of TAB characters. Could you please replace those by 8 spaces?

I agree with [attachment:12415_review_review.patch].

Did you also look at [attachment:12415_doctest_review.patch], [attachment:12415_script_review.patch] and [attachment:12415_test.patch]?



---

archive/issue_comments_143307.json:
```json
{
    "body": "Sorry, too fast. This is dangerous:\n\n```\nsage: W.start() \nsage: W.join() \nsage: while W.rmessages is not None: \n....:   W.read_messages() \nsage: len(W.messages) > 0 \nTrue \n```\n\nYou should read the messages *while* the worker is running, because otherwise the pipe buffer might get full, leading to a block. So put `W.join()` at the end instead of at the beginning. Apart from that, it's a useful and good test.",
    "created_at": "2013-03-01T08:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143307",
    "user": "jdemeyer"
}
```

Sorry, too fast. This is dangerous:

```
sage: W.start() 
sage: W.join() 
sage: while W.rmessages is not None: 
....:   W.read_messages() 
sage: len(W.messages) > 0 
True 
```

You should read the messages *while* the worker is running, because otherwise the pipe buffer might get full, leading to a block. So put `W.join()` at the end instead of at the beginning. Apart from that, it's a useful and good test.



---

archive/issue_comments_143308.json:
```json
{
    "body": "Replying to [comment:248 jdemeyer]:\n> David, I noticed that `doc/en/developer/doctesting.rst` in [attachment:12415_doc.patch] is full of TAB characters. Could you please replace those by 8 spaces?\n\nThat's ironic.  I replaced them, though I left the ones you're deleting in [attachment:12415_review.patch] so that it applies cleanly.\n\n> Did you also look at [attachment:12415_doctest_review.patch], [attachment:12415_script_review.patch] and [attachment:12415_test.patch]?\n\n[attachment:12415_doctest_review.patch] and [attachment:12415_script_review.patch] both look fine.\n\nFor [attachment:12415_test.patch], you never run some of the files in the test directory (`sig_on.rst` and `sleep_and_raise.rst`).  Otherwise they look good.",
    "created_at": "2013-03-01T10:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143308",
    "user": "roed"
}
```

Replying to [comment:248 jdemeyer]:
> David, I noticed that `doc/en/developer/doctesting.rst` in [attachment:12415_doc.patch] is full of TAB characters. Could you please replace those by 8 spaces?

That's ironic.  I replaced them, though I left the ones you're deleting in [attachment:12415_review.patch] so that it applies cleanly.

> Did you also look at [attachment:12415_doctest_review.patch], [attachment:12415_script_review.patch] and [attachment:12415_test.patch]?

[attachment:12415_doctest_review.patch] and [attachment:12415_script_review.patch] both look fine.

For [attachment:12415_test.patch], you never run some of the files in the test directory (`sig_on.rst` and `sleep_and_raise.rst`).  Otherwise they look good.



---

archive/issue_comments_143309.json:
```json
{
    "body": "Attachment [12415_review_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review_review.patch) by roed created at 2013-03-01 10:12:28\n\nReplying to [comment:249 jdemeyer]:\n> Sorry, too fast. This is dangerous:\n> {{{\n> sage: W.start() \n> sage: W.join() \n> sage: while W.rmessages is not None: \n> ....:   W.read_messages() \n> sage: len(W.messages) > 0 \n> True \n> }}}\n> You should read the messages *while* the worker is running, because otherwise the pipe buffer might get full, leading to a block. So put `W.join()` at the end instead of at the beginning. Apart from that, it's a useful and good test.\n\nDone.  I also updated the tests for `kill` and `save_result_output` to be more robust.",
    "created_at": "2013-03-01T10:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143309",
    "user": "roed"
}
```

Attachment [12415_review_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review_review.patch) by roed created at 2013-03-01 10:12:28

Replying to [comment:249 jdemeyer]:
> Sorry, too fast. This is dangerous:
> {{{
> sage: W.start() 
> sage: W.join() 
> sage: while W.rmessages is not None: 
> ....:   W.read_messages() 
> sage: len(W.messages) > 0 
> True 
> }}}
> You should read the messages *while* the worker is running, because otherwise the pipe buffer might get full, leading to a block. So put `W.join()` at the end instead of at the beginning. Apart from that, it's a useful and good test.

Done.  I also updated the tests for `kill` and `save_result_output` to be more robust.



---

archive/issue_comments_143310.json:
```json
{
    "body": "Replying to [comment:247 jdemeyer]:\n> Could you do me a favour since I don't have access to an OS X 10.8 system:\n\nIs this useful for me to run on OS X 10.6.8?\n \n> Remove that `import readline` statement and run\n> {{{\n> ./sage -btp N --long devel/sage/sage/doctest devel/sage/sage/tests\n> }}}\n> in the following ways:\n>  1. Normal doctest run in the terminal, let it finish\n>  2. Interrupt (CTRL-C) the tests somewhere in the middle of the run\n>  3. Pipe the output through `less`: `./sage -tp 2 ... | less`\n> And all this both with `-p 1` and with `-p N` for some `N > 1`.",
    "created_at": "2013-03-01T10:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143310",
    "user": "roed"
}
```

Replying to [comment:247 jdemeyer]:
> Could you do me a favour since I don't have access to an OS X 10.8 system:

Is this useful for me to run on OS X 10.6.8?
 
> Remove that `import readline` statement and run
> {{{
> ./sage -btp N --long devel/sage/sage/doctest devel/sage/sage/tests
> }}}
> in the following ways:
>  1. Normal doctest run in the terminal, let it finish
>  2. Interrupt (CTRL-C) the tests somewhere in the middle of the run
>  3. Pipe the output through `less`: `./sage -tp 2 ... | less`
> And all this both with `-p 1` and with `-p N` for some `N > 1`.



---

archive/issue_comments_143311.json:
```json
{
    "body": "Replying to [comment:250 roed]:\n> For [attachment:12415_test.patch], you never run some of the files in the test directory (`sig_on.rst` and `sleep_and_raise.rst`).\nWell, I found `sleep_and_raise.rst` useful for manual testing, so I left it.\n\nAnd `sig_on.rst` will be tested in the follow-up #14152 (which will be an easy ticket).",
    "created_at": "2013-03-01T11:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143311",
    "user": "jdemeyer"
}
```

Replying to [comment:250 roed]:
> For [attachment:12415_test.patch], you never run some of the files in the test directory (`sig_on.rst` and `sleep_and_raise.rst`).
Well, I found `sleep_and_raise.rst` useful for manual testing, so I left it.

And `sig_on.rst` will be tested in the follow-up #14152 (which will be an easy ticket).



---

archive/issue_comments_143312.json:
```json
{
    "body": "On OS X 10.8.2.\n\nRunning with `sage -btp 1 ...`:\n\n```\nsage -t --long devel/sage/sage/tests/french_book/polynomes.py\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal\n  if code[q-1] == u'\\\\':\n    [107 tests, 2.6 s]\n```\n\nRunning with `sage -btp 2 ...` \u2014 note the random (?) placement of the unicode warning:\n\n```\nsage -t --long devel/sage/sage/tests/book_stein_modform.py\n    [239 tests, 3.3 s]\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal\n  if code[q-1] == u'\\\\':\nsage -t --long devel/sage/sage/tests/french_book/polynomes.py\n    [107 tests, 2.3 s]\n```\n\n\nWithout the `import readline` statement, I got one nonrepeatable failure with `sage -btp 2 ...` (probably has nothing to do with readline, but have you seen this before?):\n\n```\nsage -t --long devel/sage/sage/doctest/forker.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/forker.py\", line 1693, in sage.doctest.forker.DocTestWorker.read_messages\nFailed example:\n    while W.rmessages is not None:\n        W.read_messages()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 436, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 792, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.forker.DocTestWorker.read_messages[9]>\", line 2, in <module>\n        W.read_messages()\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1703, in read_messages\n        s = os.read(self.rmessages, 4096)\n    OSError: [Errno 4] Interrupted system call\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.doctest.forker.DocTestWorker.read_messages\n    [384 tests, 1 failure, 17.3 s]\n```\n\nWith or without the `import readline` statement, I see this when piping through `less`, with `-btp 1` or `-btp 2`:\n\n```\nInstalling c_lib\nESC[?1034hscons: `install' is up to date.\n```\n\n\nExcept for the nonrepeatable failure, I see no difference with or without `import readline`.",
    "created_at": "2013-03-01T17:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143312",
    "user": "jhpalmieri"
}
```

On OS X 10.8.2.

Running with `sage -btp 1 ...`:

```
sage -t --long devel/sage/sage/tests/french_book/polynomes.py
/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
  if code[q-1] == u'\\':
    [107 tests, 2.6 s]
```

Running with `sage -btp 2 ...`  note the random (?) placement of the unicode warning:

```
sage -t --long devel/sage/sage/tests/book_stein_modform.py
    [239 tests, 3.3 s]
/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
  if code[q-1] == u'\\':
sage -t --long devel/sage/sage/tests/french_book/polynomes.py
    [107 tests, 2.3 s]
```


Without the `import readline` statement, I got one nonrepeatable failure with `sage -btp 2 ...` (probably has nothing to do with readline, but have you seen this before?):

```
sage -t --long devel/sage/sage/doctest/forker.py
**********************************************************************
File "devel/sage/sage/doctest/forker.py", line 1693, in sage.doctest.forker.DocTestWorker.read_messages
Failed example:
    while W.rmessages is not None:
        W.read_messages()
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 436, in _run
        self.execute(example, compiled, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 792, in execute
        exec compiled in globs
      File "<doctest sage.doctest.forker.DocTestWorker.read_messages[9]>", line 2, in <module>
        W.read_messages()
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1703, in read_messages
        s = os.read(self.rmessages, 4096)
    OSError: [Errno 4] Interrupted system call
**********************************************************************
1 item had failures:
   1 of  13 in sage.doctest.forker.DocTestWorker.read_messages
    [384 tests, 1 failure, 17.3 s]
```

With or without the `import readline` statement, I see this when piping through `less`, with `-btp 1` or `-btp 2`:

```
Installing c_lib
ESC[?1034hscons: `install' is up to date.
```


Except for the nonrepeatable failure, I see no difference with or without `import readline`.



---

archive/issue_comments_143313.json:
```json
{
    "body": "Replying to [comment:254 jhpalmieri]:\n> {{{\n> sage -t --long devel/sage/sage/doctest/forker.py\n> **********************************************************************\n> File \"devel/sage/sage/doctest/forker.py\", line 1693, in sage.doctest.forker.DocTestWorker.read_messages\n> Failed example:\n>     while W.rmessages is not None:\n>         W.read_messages()\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 436, in _run\n>         self.execute(example, compiled, test.globs)\n>       File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 792, in execute\n>         exec compiled in globs\n>       File \"<doctest sage.doctest.forker.DocTestWorker.read_messages[9]>\", line 2, in <module>\n>         W.read_messages()\n>       File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1703, in read_messages\n>         s = os.read(self.rmessages, 4096)\n>     OSError: [Errno 4] Interrupted system call\n> **********************************************************************\n> 1 item had failures:\n>    1 of  13 in sage.doctest.forker.DocTestWorker.read_messages\n>     [384 tests, 1 failure, 17.3 s]\n> }}}\nThat actually looks serious, I'll have a look.\n\n> {{{\n> Installing c_lib\n> ESC[?1034hscons: `install' is up to date.\n> }}}\nThat's before the doctester starts, so it's not our problem.\n\n> Except for the nonrepeatable failure, I see no difference with or without `import readline`.\nIs the `[[?1034h` control code gone when you remove `import readline`?",
    "created_at": "2013-03-01T19:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143313",
    "user": "jdemeyer"
}
```

Replying to [comment:254 jhpalmieri]:
> {{{
> sage -t --long devel/sage/sage/doctest/forker.py
> **********************************************************************
> File "devel/sage/sage/doctest/forker.py", line 1693, in sage.doctest.forker.DocTestWorker.read_messages
> Failed example:
>     while W.rmessages is not None:
>         W.read_messages()
> Exception raised:
>     Traceback (most recent call last):
>       File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 436, in _run
>         self.execute(example, compiled, test.globs)
>       File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 792, in execute
>         exec compiled in globs
>       File "<doctest sage.doctest.forker.DocTestWorker.read_messages[9]>", line 2, in <module>
>         W.read_messages()
>       File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.8.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1703, in read_messages
>         s = os.read(self.rmessages, 4096)
>     OSError: [Errno 4] Interrupted system call
> **********************************************************************
> 1 item had failures:
>    1 of  13 in sage.doctest.forker.DocTestWorker.read_messages
>     [384 tests, 1 failure, 17.3 s]
> }}}
That actually looks serious, I'll have a look.

> {{{
> Installing c_lib
> ESC[?1034hscons: `install' is up to date.
> }}}
That's before the doctester starts, so it's not our problem.

> Except for the nonrepeatable failure, I see no difference with or without `import readline`.
Is the `[[?1034h` control code gone when you remove `import readline`?



---

archive/issue_comments_143314.json:
```json
{
    "body": "> Is the [[?1034h control code gone when you remove import readline?\n\nNo, it's there either way.",
    "created_at": "2013-03-01T19:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143314",
    "user": "jhpalmieri"
}
```

> Is the [[?1034h control code gone when you remove import readline?

No, it's there either way.



---

archive/issue_comments_143315.json:
```json
{
    "body": "Another random failure:\n\n```\nsage -t devel/sage/sage/doctest/forker.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/forker.py\", line 1729, in sage.doctest.forker.DocTestWorker.save_result_output\nFailed example:\n    sorted(W.result[1].keys())\nExpected:\n    ['cputime', 'err', 'failures', 'walltime']\nGot:\n    ['err']\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.doctest.forker.DocTestWorker.save_result_output\n    [384 tests, 1 failure, 17.4 s]\n```\n",
    "created_at": "2013-03-01T19:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143315",
    "user": "jhpalmieri"
}
```

Another random failure:

```
sage -t devel/sage/sage/doctest/forker.py
**********************************************************************
File "devel/sage/sage/doctest/forker.py", line 1729, in sage.doctest.forker.DocTestWorker.save_result_output
Failed example:
    sorted(W.result[1].keys())
Expected:
    ['cputime', 'err', 'failures', 'walltime']
Got:
    ['err']
**********************************************************************
1 item had failures:
   1 of  14 in sage.doctest.forker.DocTestWorker.save_result_output
    [384 tests, 1 failure, 17.4 s]
```




---

archive/issue_comments_143316.json:
```json
{
    "body": "Replying to [comment:256 jhpalmieri]:\n> > Is the [[?1034h control code gone when you remove import readline?\n> \n> No, it's there either way.\nIn serial and in parallel?",
    "created_at": "2013-03-01T19:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143316",
    "user": "jdemeyer"
}
```

Replying to [comment:256 jhpalmieri]:
> > Is the [[?1034h control code gone when you remove import readline?
> 
> No, it's there either way.
In serial and in parallel?



---

archive/issue_comments_143317.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-01T19:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143317",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143318.json:
```json
{
    "body": "Attachment [12415_doc.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doc.patch) by jdemeyer created at 2013-03-01 21:54:51\n\nUpdates documention",
    "created_at": "2013-03-01T21:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143318",
    "user": "jdemeyer"
}
```

Attachment [12415_doc.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doc.patch) by jdemeyer created at 2013-03-01 21:54:51

Updates documention



---

archive/issue_comments_143319.json:
```json
{
    "body": "Attachment [12415_test.patch](tarball://root/attachments/some-uuid/ticket12415/12415_test.patch) by jdemeyer created at 2013-03-01 21:56:38",
    "created_at": "2013-03-01T21:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143319",
    "user": "jdemeyer"
}
```

Attachment [12415_test.patch](tarball://root/attachments/some-uuid/ticket12415/12415_test.patch) by jdemeyer created at 2013-03-01 21:56:38



---

archive/issue_comments_143320.json:
```json
{
    "body": "Attachment [12415_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review.patch) by jdemeyer created at 2013-03-01 21:56:45",
    "created_at": "2013-03-01T21:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143320",
    "user": "jdemeyer"
}
```

Attachment [12415_review.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review.patch) by jdemeyer created at 2013-03-01 21:56:45



---

archive/issue_comments_143321.json:
```json
{
    "body": "* Merged two doctest patches\n\n* Merged the patches to the documentation into [attachment:12415_doc.patch] and changed version numbers to sage-5.9.\n\n* [attachment:12415_test.patch]: removed unused `sig_on.rst`.",
    "created_at": "2013-03-01T22:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143321",
    "user": "jdemeyer"
}
```

* Merged two doctest patches

* Merged the patches to the documentation into [attachment:12415_doc.patch] and changed version numbers to sage-5.9.

* [attachment:12415_test.patch]: removed unused `sig_on.rst`.



---

archive/issue_comments_143322.json:
```json
{
    "body": "John: I think both your failures are due to not resetting the `SIGCHLD` signal handler, that should be fixed now.",
    "created_at": "2013-03-01T22:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143322",
    "user": "jdemeyer"
}
```

John: I think both your failures are due to not resetting the `SIGCHLD` signal handler, that should be fixed now.



---

archive/issue_comments_143323.json:
```json
{
    "body": "Replying to [comment:262 jdemeyer]:\n> John: I think both your failures are due to not resetting the `SIGCHLD` signal handler, that should be fixed now.\n\nI still get the following failures:\n\n\n```\nsage -t sage/doctest/forker.py\n**********************************************************************\nFile \"sage/doctest/forker.py\", line 1777, in sage.doctest.forker.DocTestWorker.kill\nFailed example:\n    W.kill()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 432, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 788, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.forker.DocTestWorker.kill[14]>\", line 1, in <module>\n        W.kill()\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1791, in kill\n        os.killpg(self.pid, signal.SIGHUP)\n    OSError: [Errno 3] No such process\n**********************************************************************\nFile \"sage/doctest/forker.py\", line 1781, in sage.doctest.forker.DocTestWorker.kill\nFailed example:\n    W.kill()         # Worker dies now\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 432, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 788, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.forker.DocTestWorker.kill[17]>\", line 1, in <module>\n        W.kill()         # Worker dies now\n      File \"/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1793, in kill\n        os.killpg(self.pid, signal.SIGKILL)\n    OSError: [Errno 1] Operation not permitted\n**********************************************************************\n\n```\n",
    "created_at": "2013-03-01T23:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143323",
    "user": "roed"
}
```

Replying to [comment:262 jdemeyer]:
> John: I think both your failures are due to not resetting the `SIGCHLD` signal handler, that should be fixed now.

I still get the following failures:


```
sage -t sage/doctest/forker.py
**********************************************************************
File "sage/doctest/forker.py", line 1777, in sage.doctest.forker.DocTestWorker.kill
Failed example:
    W.kill()
Exception raised:
    Traceback (most recent call last):
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 432, in _run
        self.execute(example, compiled, test.globs)
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 788, in execute
        exec compiled in globs
      File "<doctest sage.doctest.forker.DocTestWorker.kill[14]>", line 1, in <module>
        W.kill()
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1791, in kill
        os.killpg(self.pid, signal.SIGHUP)
    OSError: [Errno 3] No such process
**********************************************************************
File "sage/doctest/forker.py", line 1781, in sage.doctest.forker.DocTestWorker.kill
Failed example:
    W.kill()         # Worker dies now
Exception raised:
    Traceback (most recent call last):
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 432, in _run
        self.execute(example, compiled, test.globs)
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 788, in execute
        exec compiled in globs
      File "<doctest sage.doctest.forker.DocTestWorker.kill[17]>", line 1, in <module>
        W.kill()         # Worker dies now
      File "/Users/roed/sage/sage-5.8.beta0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1793, in kill
        os.killpg(self.pid, signal.SIGKILL)
    OSError: [Errno 1] Operation not permitted
**********************************************************************

```




---

archive/issue_comments_143324.json:
```json
{
    "body": "Got it! It's trying to kill the *process group*, but we're not sure at this point that the worker already changed its process group.",
    "created_at": "2013-03-02T08:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143324",
    "user": "jdemeyer"
}
```

Got it! It's trying to kill the *process group*, but we're not sure at this point that the worker already changed its process group.



---

archive/issue_comments_143325.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-02T09:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143325",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143326.json:
```json
{
    "body": "David: thanks for your added doctests. They really did expose some bugs.",
    "created_at": "2013-03-02T09:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143326",
    "user": "jdemeyer"
}
```

David: thanks for your added doctests. They really did expose some bugs.



---

archive/issue_comments_143327.json:
```json
{
    "body": "Attachment [12415_review3.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review3.patch) by jdemeyer created at 2013-03-02 10:37:58",
    "created_at": "2013-03-02T10:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143327",
    "user": "jdemeyer"
}
```

Attachment [12415_review3.patch](tarball://root/attachments/some-uuid/ticket12415/12415_review3.patch) by jdemeyer created at 2013-03-02 10:37:58



---

archive/issue_comments_143328.json:
```json
{
    "body": "Excellent!  I suspect there's more trouble somewhere, but I would suggest dealing with it in follow-up tickets.\n\nThe changes all look fine to me, but I haven't run full doctests (and am probably not going to be able to today since I'm traveling).  I'm happy giving this positive review subject to all doctests passing.",
    "created_at": "2013-03-02T20:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143328",
    "user": "roed"
}
```

Excellent!  I suspect there's more trouble somewhere, but I would suggest dealing with it in follow-up tickets.

The changes all look fine to me, but I haven't run full doctests (and am probably not going to be able to today since I'm traveling).  I'm happy giving this positive review subject to all doctests passing.



---

archive/issue_comments_143329.json:
```json
{
    "body": "Attachment [12415_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doctest_fixes.patch) by jdemeyer created at 2013-03-03 13:15:14\n\nDoctest changes that are needed to account for differences in the new framework",
    "created_at": "2013-03-03T13:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143329",
    "user": "jdemeyer"
}
```

Attachment [12415_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket12415/12415_doctest_fixes.patch) by jdemeyer created at 2013-03-03 13:15:14

Doctest changes that are needed to account for differences in the new framework



---

archive/issue_comments_143330.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-03T13:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143330",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_143331.json:
```json
{
    "body": "Rebased again.\n\nI take David's comment as meaning \"positive review\".",
    "created_at": "2013-03-03T13:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143331",
    "user": "jdemeyer"
}
```

Rebased again.

I take David's comment as meaning "positive review".



---

archive/issue_comments_143332.json:
```json
{
    "body": "Attachment [12415_manifest.patch](tarball://root/attachments/some-uuid/ticket12415/12415_manifest.patch) by jdemeyer created at 2013-03-03 15:57:39",
    "created_at": "2013-03-03T15:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143332",
    "user": "jdemeyer"
}
```

Attachment [12415_manifest.patch](tarball://root/attachments/some-uuid/ticket12415/12415_manifest.patch) by jdemeyer created at 2013-03-03 15:57:39



---

archive/issue_comments_143333.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-03-03T15:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143333",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_143334.json:
```json
{
    "body": "[attachment:12415_manifest.patch] needs review.",
    "created_at": "2013-03-03T15:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143334",
    "user": "jdemeyer"
}
```

[attachment:12415_manifest.patch] needs review.



---

archive/issue_comments_143335.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-03T15:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143335",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143336.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-03T20:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143336",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_143337.json:
```json
{
    "body": "Replying to [comment:270 jdemeyer]:\n> [attachment:12415_manifest.patch] needs review.\n\nIt looks fine to me, though I don't see why it's relevant to doctesting.",
    "created_at": "2013-03-03T20:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143337",
    "user": "roed"
}
```

Replying to [comment:270 jdemeyer]:
> [attachment:12415_manifest.patch] needs review.

It looks fine to me, though I don't see why it's relevant to doctesting.



---

archive/issue_comments_143338.json:
```json
{
    "body": "Replying to [comment:271 roed]:\n> I don't see why it's relevant to doctesting.\nMy patch adds `.rst` files (mainly because I wanted to use something else than `.py` files for a change).",
    "created_at": "2013-03-03T22:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143338",
    "user": "jdemeyer"
}
```

Replying to [comment:271 roed]:
> I don't see why it's relevant to doctesting.
My patch adds `.rst` files (mainly because I wanted to use something else than `.py` files for a change).



---

archive/issue_comments_143339.json:
```json
{
    "body": "Further testing revealed some more subtle problems. I will simply extend the file [attachment:12415_rebase_58.patch] until this ticket is ready to be merged.",
    "created_at": "2013-03-05T11:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143339",
    "user": "jdemeyer"
}
```

Further testing revealed some more subtle problems. I will simply extend the file [attachment:12415_rebase_58.patch] until this ticket is ready to be merged.



---

archive/issue_comments_143340.json:
```json
{
    "body": "Replying to [comment:273 jdemeyer]:\n> Further testing revealed some more subtle problems. I will simply extend the file [attachment:12415_rebase_58.patch] until this ticket is ready to be merged.\n\nOkay.  Let me know when you want me to review it.",
    "created_at": "2013-03-05T20:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143340",
    "user": "roed"
}
```

Replying to [comment:273 jdemeyer]:
> Further testing revealed some more subtle problems. I will simply extend the file [attachment:12415_rebase_58.patch] until this ticket is ready to be merged.

Okay.  Let me know when you want me to review it.



---

archive/issue_comments_143341.json:
```json
{
    "body": "While you were developing this, did you consider using Python's [DocTestFinder](http://docs.python.org/2/library/doctest.html#doctest.DocTestFinder) to extract docstrings from Python files? The current code here doesn't use `object.__doc__`, perhaps the Python doctest module does. I ask because #13605 added several classes with a dynamic `__doc__`.",
    "created_at": "2013-03-06T07:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143341",
    "user": "jdemeyer"
}
```

While you were developing this, did you consider using Python's [DocTestFinder](http://docs.python.org/2/library/doctest.html#doctest.DocTestFinder) to extract docstrings from Python files? The current code here doesn't use `object.__doc__`, perhaps the Python doctest module does. I ask because #13605 added several classes with a dynamic `__doc__`.



---

archive/issue_comments_143342.json:
```json
{
    "body": "Replying to [comment:276 jdemeyer]:\n> While you were developing this, did you consider using Python's [DocTestFinder](http://docs.python.org/2/library/doctest.html#doctest.DocTestFinder) to extract docstrings from Python files? The current code here doesn't use `object.__doc__`, perhaps the Python doctest module does. I ask because #13605 added several classes with a dynamic `__doc__`.\n\nI didn't, and it sounds like a good idea.  We can override it to deal with Cython classes if necessary.\n\nDo you think we should make this change on this ticket or a followup?  I won't be able to work on it much until next week (I'm still in Hawaii after Sage Days 46).",
    "created_at": "2013-03-08T07:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143342",
    "user": "roed"
}
```

Replying to [comment:276 jdemeyer]:
> While you were developing this, did you consider using Python's [DocTestFinder](http://docs.python.org/2/library/doctest.html#doctest.DocTestFinder) to extract docstrings from Python files? The current code here doesn't use `object.__doc__`, perhaps the Python doctest module does. I ask because #13605 added several classes with a dynamic `__doc__`.

I didn't, and it sounds like a good idea.  We can override it to deal with Cython classes if necessary.

Do you think we should make this change on this ticket or a followup?  I won't be able to work on it much until next week (I'm still in Hawaii after Sage Days 46).



---

archive/issue_comments_143343.json:
```json
{
    "body": "Replying to [comment:281 roed]:\n> Do you think we should make this change on this ticket or a followup?\nNot on this ticket, it's already too big.",
    "created_at": "2013-03-10T22:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143343",
    "user": "jdemeyer"
}
```

Replying to [comment:281 roed]:
> Do you think we should make this change on this ticket or a followup?
Not on this ticket, it's already too big.



---

archive/issue_comments_143344.json:
```json
{
    "body": "Attachment [12415_rebase_58.patch](tarball://root/attachments/some-uuid/ticket12415/12415_rebase_58.patch) by jdemeyer created at 2013-03-13 09:09:44",
    "created_at": "2013-03-13T09:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143344",
    "user": "jdemeyer"
}
```

Attachment [12415_rebase_58.patch](tarball://root/attachments/some-uuid/ticket12415/12415_rebase_58.patch) by jdemeyer created at 2013-03-13 09:09:44



---

archive/issue_comments_143345.json:
```json
{
    "body": "All well on the buildbots. So please do the final review of [attachment:12415_rebase_58.patch].",
    "created_at": "2013-03-14T08:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143345",
    "user": "jdemeyer"
}
```

All well on the buildbots. So please do the final review of [attachment:12415_rebase_58.patch].



---

archive/issue_comments_143346.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-03-14T15:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143346",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_143347.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-14T15:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143347",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143348.json:
```json
{
    "body": "The only thing I'm concerned about is\n\n```\nThere are 18 tests in sage/combinat/partition.py that are not being run\nThere are 12 tests in sage/combinat/tableau.py that are not being run\n```\n\n\nDo you know why that changed?",
    "created_at": "2013-03-14T17:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143348",
    "user": "roed"
}
```

The only thing I'm concerned about is

```
There are 18 tests in sage/combinat/partition.py that are not being run
There are 12 tests in sage/combinat/tableau.py that are not being run
```


Do you know why that changed?



---

archive/issue_comments_143349.json:
```json
{
    "body": "Replying to [comment:289 roed]:\n> Do you know why that changed?\nSee [comment:276]",
    "created_at": "2013-03-14T18:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143349",
    "user": "jdemeyer"
}
```

Replying to [comment:289 roed]:
> Do you know why that changed?
See [comment:276]



---

archive/issue_comments_143350.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-14T20:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143350",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_143351.json:
```json
{
    "body": "Replying to [comment:290 jdemeyer]:\n> Replying to [comment:289 roed]:\n> > Do you know why that changed?\n> See [comment:276]\n\nAlright.  I've created #14272 to fix these doctests (which are currently not tested).  Otherwise I'm happy.",
    "created_at": "2013-03-14T20:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143351",
    "user": "roed"
}
```

Replying to [comment:290 jdemeyer]:
> Replying to [comment:289 roed]:
> > Do you know why that changed?
> See [comment:276]

Alright.  I've created #14272 to fix these doctests (which are currently not tested).  Otherwise I'm happy.



---

archive/issue_comments_143352.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-14T22:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143352",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_143353.json:
```json
{
    "body": "Replying to [comment:293 jdemeyer]:\n\nYay!",
    "created_at": "2013-03-14T22:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143353",
    "user": "roed"
}
```

Replying to [comment:293 jdemeyer]:

Yay!



---

archive/issue_comments_143354.json:
```json
{
    "body": "I'm working on #12281 and noticed that `sage -t --debug` doesn't work for me on OS X 10.6.8 (it starts the tests but then just hangs).  Strangely, the tests in `sage.doctest.forker.SageDocTestRunner.report_unexpected_exception` seem to succeed.  I haven't tried running tests in debug mode since Jeroen changed it in [attachment:12415_review.patch]; can anyone else duplicate this problem on another platform?",
    "created_at": "2013-03-14T23:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143354",
    "user": "roed"
}
```

I'm working on #12281 and noticed that `sage -t --debug` doesn't work for me on OS X 10.6.8 (it starts the tests but then just hangs).  Strangely, the tests in `sage.doctest.forker.SageDocTestRunner.report_unexpected_exception` seem to succeed.  I haven't tried running tests in debug mode since Jeroen changed it in [attachment:12415_review.patch]; can anyone else duplicate this problem on another platform?



---

archive/issue_comments_143355.json:
```json
{
    "body": "Changing component from doctest to doctest framework.",
    "created_at": "2013-03-28T22:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143355",
    "user": "roed"
}
```

Changing component from doctest to doctest framework.



---

archive/issue_comments_143356.json:
```json
{
    "body": "This patch breaks the fixdoctests script. The problem is that the strings which sage-fixdoctests searches for in order to identify the line numbers have changed with the new output implemented in the current patch. \n\nI have just uploaded the patch #10589 which makes ```sage -fixdoctests``` work properly with the new doctest output (as stated on the ticket for #10589, the main point of this patch is to fix some different problems with fixdoctests). This patch also adds a test to sage/tests/cmdline.py for the fixdoctests script so that the doctest framework now has a chance of identifying patches which break it in future.",
    "created_at": "2013-05-02T03:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143356",
    "user": "andrew.mathas"
}
```

This patch breaks the fixdoctests script. The problem is that the strings which sage-fixdoctests searches for in order to identify the line numbers have changed with the new output implemented in the current patch. 

I have just uploaded the patch #10589 which makes ```sage -fixdoctests``` work properly with the new doctest output (as stated on the ticket for #10589, the main point of this patch is to fix some different problems with fixdoctests). This patch also adds a test to sage/tests/cmdline.py for the fixdoctests script so that the doctest framework now has a chance of identifying patches which break it in future.



---

archive/issue_comments_143357.json:
```json
{
    "body": "Neither here nor on #14184 is there any public discussion of having removed `--only-optional`/`--only_optional`.  The [developer conventions](http://www.sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples) have a nice unified way of testing examples, but it was very useful to just skip the \"regular\" tests.  Did I miss a different place where this was disabled (and why? presumably technical)?",
    "created_at": "2013-06-14T15:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143357",
    "user": "kcrisman"
}
```

Neither here nor on #14184 is there any public discussion of having removed `--only-optional`/`--only_optional`.  The [developer conventions](http://www.sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples) have a nice unified way of testing examples, but it was very useful to just skip the "regular" tests.  Did I miss a different place where this was disabled (and why? presumably technical)?



---

archive/issue_comments_143358.json:
```json
{
    "body": "`--only-optional` was replaced by `--optional`. The old documentation was very unclear about what `--optional` and `--only-optional` did, so we basically just implemented what we could understand.",
    "created_at": "2013-06-15T07:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12243#issuecomment-143358",
    "user": "jdemeyer"
}
```

`--only-optional` was replaced by `--optional`. The old documentation was very unclear about what `--optional` and `--only-optional` did, so we basically just implemented what we could understand.
