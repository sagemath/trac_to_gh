# Issue 33726: wrong sign for symbolic Legendre polynomial at 0

Issue created by migration from https://trac.sagemath.org/ticket/33963

Original creator: @DaveWitteMorris

Original creation time: 2022-06-08 19:31:18

Keywords: parity, sign error, pynac

Trac ticket #33962 fixed the sign of `legendre_P(n, 0)` when `n` is an explicit integer. The patch also tried to fix the sign when `n` is a symbolic integer variable, but the patch does not work. Even with the patch, we have:

```
sage: n = var("n")
sage: assume(n, "integer")
sage: assume(n, "even")
sage: legendre_P(n, 0)
2^(-n + 2)*gamma(n)/(n*gamma(1/2*n)^2)
```

This is missing a factor of `(-1)^(n/2)`.

The incorrect value arises because pynac erroneously simplifies the expression `pow(_ex_1, n / _ex2)` to `1`. (The constant `_ex_1` is pynac's name for `-1`.)
The problem seems to be that pynac thinks `n / _ex2` is even: printing `(n / _ex2).info(info_flags::even)` at this point in the code yields `1` (meaning the flag is set).


---

Comment by @DaveWitteMorris created at 2022-06-09 05:09:19

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2022-06-09 05:09:19

The bug is in `case info_flags::even` of pynac's `mul::info` method. A product is even if all of the factors are integers, and at least one of the factors is even. However, one of the factors in a `mul` object is the `overall coefficient`, and the method neglected to check that this coefficient is an integer. 

In the example of the ticket description, pynac represents the expression `n/2` as the product `1/2 * n`, where `1/2` is the overall coefficient. This coefficient is obviously not an integer.
----
New commits:


---

Comment by @DaveWitteMorris created at 2022-06-09 05:38:58

Follow-up: #33964. When `n` is odd, `legendre_P(n, 0)` should be 0.
----
New commits:


---

Comment by tscrim created at 2022-06-10 04:50:13

LGTM modulo the doc change:

```diff
-        # verify that :trac:`33963` is fixed
+
+    Verify that :trac:`33963` is fixed::
+
         sage: n = var("n")
```



---

Comment by tscrim created at 2022-06-10 04:50:56

Once changed, you can set a positive review on my behalf.


---

Comment by @DaveWitteMorris created at 2022-06-11 00:45:48

Thanks for the review and corrections of this ticket, too.  

I rebased on #33962, and will set to positive review when the patchbot is green again.
----
New commits:


---

Comment by @DaveWitteMorris created at 2022-06-11 03:10:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-06-12 23:08:32

Resolution: fixed
