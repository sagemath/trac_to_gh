# Issue 33726: wrong sign for symbolic Legendre polynomial at 0

archive/issues_033726.json:
```json
{
    "body": "Keywords: parity, sign error, pynac\n\nTrac ticket #33962 fixed the sign of `legendre_P(n, 0)` when `n` is an explicit integer. The patch also tried to fix the sign when `n` is a symbolic integer variable, but the patch does not work. Even with the patch, we have:\n\n```\nsage: n = var(\"n\")\nsage: assume(n, \"integer\")\nsage: assume(n, \"even\")\nsage: legendre_P(n, 0)\n2^(-n + 2)*gamma(n)/(n*gamma(1/2*n)^2)\n```\n\nThis is missing a factor of `(-1)^(n/2)`.\n\nThe incorrect value arises because pynac erroneously simplifies the expression `pow(_ex_1, n / _ex2)` to `1`. (The constant `_ex_1` is pynac's name for `-1`.)\nThe problem seems to be that pynac thinks `n / _ex2` is even: printing `(n / _ex2).info(info_flags::even)` at this point in the code yields `1` (meaning the flag is set).\n\nIssue created by migration from https://trac.sagemath.org/ticket/33963\n\n",
    "created_at": "2022-06-08T19:31:18Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "wrong sign for symbolic Legendre polynomial at 0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33726",
    "user": "https://github.com/DaveWitteMorris"
}
```
Keywords: parity, sign error, pynac

Trac ticket #33962 fixed the sign of `legendre_P(n, 0)` when `n` is an explicit integer. The patch also tried to fix the sign when `n` is a symbolic integer variable, but the patch does not work. Even with the patch, we have:

```
sage: n = var("n")
sage: assume(n, "integer")
sage: assume(n, "even")
sage: legendre_P(n, 0)
2^(-n + 2)*gamma(n)/(n*gamma(1/2*n)^2)
```

This is missing a factor of `(-1)^(n/2)`.

The incorrect value arises because pynac erroneously simplifies the expression `pow(_ex_1, n / _ex2)` to `1`. (The constant `_ex_1` is pynac's name for `-1`.)
The problem seems to be that pynac thinks `n / _ex2` is even: printing `(n / _ex2).info(info_flags::even)` at this point in the code yields `1` (meaning the flag is set).

Issue created by migration from https://trac.sagemath.org/ticket/33963





---

archive/issue_comments_479132.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479132",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479133.json:
```json
{
    "body": "The bug is in `case info_flags::even` of pynac's `mul::info` method. A product is even if all of the factors are integers, and at least one of the factors is even. However, one of the factors in a `mul` object is the `overall coefficient`, and the method neglected to check that this coefficient is an integer. \n\nIn the example of the ticket description, pynac represents the expression `n/2` as the product `1/2 * n`, where `1/2` is the overall coefficient. This coefficient is obviously not an integer.\n----\nNew commits:",
    "created_at": "2022-06-09T05:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479133",
    "user": "https://github.com/DaveWitteMorris"
}
```

The bug is in `case info_flags::even` of pynac's `mul::info` method. A product is even if all of the factors are integers, and at least one of the factors is even. However, one of the factors in a `mul` object is the `overall coefficient`, and the method neglected to check that this coefficient is an integer. 

In the example of the ticket description, pynac represents the expression `n/2` as the product `1/2 * n`, where `1/2` is the overall coefficient. This coefficient is obviously not an integer.
----
New commits:



---

archive/issue_comments_479134.json:
```json
{
    "body": "Follow-up: #33964. When `n` is odd, `legendre_P(n, 0)` should be 0.\n----\nNew commits:",
    "created_at": "2022-06-09T05:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479134",
    "user": "https://github.com/DaveWitteMorris"
}
```

Follow-up: #33964. When `n` is odd, `legendre_P(n, 0)` should be 0.
----
New commits:



---

archive/issue_comments_479135.json:
```json
{
    "body": "LGTM modulo the doc change:\n\n```diff\n-        # verify that :trac:`33963` is fixed\n+\n+    Verify that :trac:`33963` is fixed::\n+\n         sage: n = var(\"n\")\n```\n",
    "created_at": "2022-06-10T04:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479135",
    "user": "https://github.com/tscrim"
}
```

LGTM modulo the doc change:

```diff
-        # verify that :trac:`33963` is fixed
+
+    Verify that :trac:`33963` is fixed::
+
         sage: n = var("n")
```




---

archive/issue_comments_479136.json:
```json
{
    "body": "Once changed, you can set a positive review on my behalf.",
    "created_at": "2022-06-10T04:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479136",
    "user": "https://github.com/tscrim"
}
```

Once changed, you can set a positive review on my behalf.



---

archive/issue_comments_479137.json:
```json
{
    "body": "Thanks for the review and corrections of this ticket, too.  \n\nI rebased on #33962, and will set to positive review when the patchbot is green again.\n----\nNew commits:",
    "created_at": "2022-06-11T00:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479137",
    "user": "https://github.com/DaveWitteMorris"
}
```

Thanks for the review and corrections of this ticket, too.  

I rebased on #33962, and will set to positive review when the patchbot is green again.
----
New commits:



---

archive/issue_comments_479138.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-11T03:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479138",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_030408.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-06-12T23:08:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33726#event-30408"
}
```



---

archive/issue_comments_479139.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T23:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33726#issuecomment-479139",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
