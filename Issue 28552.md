# Issue 28552: Zeta functions of hyperelliptic curves giving wrong answers

Issue created by migration from https://trac.sagemath.org/ticket/28789

Original creator: kedlaya

Original creation time: 2019-11-22 19:54:15

CC:  roed

Example from 9.0.beta5:

```
sage: P.<x> = PolynomialRing(GF(3))
sage: u = x^10 + x^9 + x^8 + x
sage: C = HyperellipticCurve(u)
sage: C.frobenius_polynomial()
x^8 + 731*x^7 + 6*x^6 - 720*x^5 + 18*x^4 - 2160*x^3 + 54*x^2 + 19737*x + 81
```

This is being computed using Pari, but actually gp gives the correct answer:

```
? u = Mod(1,3)*(x^10 + x^9 + x^8 + x)
? hyperellcharpoly(u)
%1 = x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81
```

Since the `x^7` term is off by `3^6`, this is presumably an issue with not enough p-adic precision in the Frobenius matrix we are getting from Pari.


---

Comment by kedlaya created at 2019-11-22 21:06:12

It looks like this was a bug which was just fixed upstream: I can reproduce the bug in gp version 2.11.1, but I get the correct answer in 2.11.2 (which is what I originally tried). So a simple Pari update should suffice.


---

Comment by kedlaya created at 2019-11-25 00:59:25

See #28424 for a Pari upgrade ticket that would resolve this issue.


---

Comment by fbissey created at 2019-12-03 20:49:35

#28424 is somewhat exploratory to check for broken stuff. Of course we have gone on the pari git branch in the past when Jeroen was after new features.

But #28424 shouldn't prevent you from making this ticket an upgrade to 2.11.2 to fix your issue. If that make fell you better most sage-on-distros are probably already using 2.11.2 without reported side effects (apart from getting the right answer in the problem pointed out by this ticket - I know I do in sage-on-gentoo).


---

Comment by kedlaya created at 2019-12-04 07:36:38

OK, so let's make this a ticket to upgrade Pari to 2.11.2. Unfortunately, updating an spkg falls outside of my expertise; but it should be trivial for someone more familiar with the build system.


---

Comment by chapoton created at 2019-12-04 12:21:03

I have made #28840 for the upgrade to pari 2.11.2


---

Comment by slelievre created at 2019-12-09 05:05:57

Now that #28840 is in, it would be nice to add the example from this ticket
as a doctest in Sage's documentation. Something like:

```
Check that :trac:`28789` is fixed::

    sage: P.<x> = PolynomialRing(GF(3))
    sage: u = x^10 + x^9 + x^8 + x
    sage: C = HyperellipticCurve(u)
    sage: C.frobenius_polynomial()
    x^8 + 2*x^7 + 6*x^6 + 9*x^5 + 18*x^4 + 27*x^3 + 54*x^2 + 54*x + 81
```



---

Comment by kedlaya created at 2019-12-11 15:44:46

Changing keywords from "" to "hyperelliptic curves, zeta functions".


---

Comment by kedlaya created at 2019-12-11 15:44:46

Changing status from new to needs_review.


---

Comment by kedlaya created at 2019-12-11 15:44:46

Agreed! I doctested both `frobenius_polynomial` and `frobenius_polynomial_pari`.
----
New commits:


---

Comment by chapoton created at 2019-12-11 19:49:08

ok, good to go. Thanks


---

Comment by chapoton created at 2019-12-11 19:49:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-12-16 23:15:09

Resolution: fixed


---

Comment by slelievre created at 2020-01-10 18:49:22

Possibly related problem reported on sage-support with Sage 9.0:

- https://groups.google.com/d/topic/sage-support/JpbRY1HLEE8/discussion
