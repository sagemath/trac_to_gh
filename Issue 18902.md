# Issue 18902: Implement categories for KR crystals

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2015-09-05 12:55:50

Assignee: sage-combinat

CC:  sage-combinat aschilling bsalisbury1 bump nthiery

Keywords: crystals, KR

The aim of this ticket is to implement a category for KR crystals and their tensor products. We do so by implementing a category for (abstract) U<sub>q</sub>'(_g_)-crystals, which I have called `AffineDerivedSubaglebraCrystals`. Tthere will be a regular affine derived subalgebra crystals subcategory, and from that, the subcategories with be KR crystals and their tensor products (which do not have a subcategory relationship).

This allows for a uniform interface for all KR crystals, allowing us to define things like `energy_function` for only tensor products of KR crystals where we don't have to check types. This also makes the default weight lattice for general crystals of affine type be the extended affine weight lattice, but anything in the affine derived subalgebra category will use the non-extended weight lattice. As a consequence, it removes duplication of trivial `weight_lattice_realization` methods. This category also allows a better interface which to draw 0-arrows in reverse for digraphs.


---

Comment by tscrim created at 2015-09-05 12:58:57

Changing keywords from "crystals, KR" to "crystals, KR crystals, category".


---

Comment by tscrim created at 2015-09-05 12:58:57

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-09-05 12:58:57

I'm not completely set on the name "affine derived subalgebra crystals", but it was the best I could come up with to stay as general as possible. I didn't want to do "* derived crystals" because derived has special meaning in terms of category theory, and nothing else I came up with kept the generality I wanted. Suggestions welcomed.
----
New commits:


---

Comment by git created at 2015-09-13 19:22:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-10-20 19:48:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-10-20 20:08:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-02 16:13:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-25 23:35:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-26 03:16:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-29 03:00:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-05 22:06:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-16 14:43:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-26 03:13:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-26 03:17:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-27 15:59:32

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-07-27 16:01:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2017-01-12 06:43:57

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2017-01-12 06:43:57

does not merge


---

Comment by git created at 2017-02-04 20:30:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-02-05 07:04:13

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-05-01 17:36:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-01 17:37:23

Rebased over #22429.


---

Comment by bsalisbury1 created at 2017-05-04 00:32:27

Hi everyone,

Was there ever any opposition to the name "affine derived subalgebra crystals" that didn't make it to the discussion here?  If so, is there a better suggestion for naming these objects?


---

Comment by tscrim created at 2017-05-04 01:10:46

The other thought I had was "Weyl crystals," thinking of them as being crystals associated to (local) Weyl modules, but that would be more for tensor products of KR crystals. Although in that direction, what about "loop crystals," in reference to the loop algebra? Another name that comes to mind is "(affine?) prime crystals" (although that is more tongue-in-cheek).


---

Comment by bsalisbury1 created at 2017-05-04 01:33:28

Loop crystals was something I had thought of, too.  It certainly has the advantage of being shorter...

"Weyl crystals" probably isn't a good idea.  If tongue-in-cheek suggestions are in play, then how about "AffiniteCrystals"?!


---

Comment by tscrim created at 2017-05-04 01:55:08

"Affinite crystals" might be a legitimate idea, but I think it suggests a little too much that they are finite crystals.


---

Comment by bsalisbury1 created at 2017-05-05 00:49:34

For the sake of getting this merged, can we (for now) agree on `LoopCrystals`?  IMO, it's not necessarily any better than `AffineDerivedSubalgebraCrystals` except that it's shorter.


---

Comment by tscrim created at 2017-05-05 01:35:31

I am good with `LoopCrystals`. I will make the change shortly.


---

Comment by git created at 2017-05-05 01:45:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-06 00:29:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2017-05-06 00:30:24

First, the documentation does not build.

Second, I merged beta5, removed a typo introduced in `monomial_crystals.py`, and added `loop_crystals` to the `src/doc/en/reference/categories/index.rst`.

Some comments/questions:

- In `affinization.py`, there is a `#TODO` which suggests that the `digraph` method should be removed when this category gets implemented.  Probably either that `#TODO` or the method should be deleted?

- While not added on this ticket, there is a reference to "pg. 48 of Kac" under the `affine_weight` method in `KR_type_E6`.  That reference should be explicit, and why not fix it now?

I'll read through the html documentation of `LoopCrystals` after it's been added to rst file.


---

Comment by git created at 2017-05-06 04:36:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-06 04:39:01

Replying to [comment:31 bsalisbury1]:
> First, the documentation does not build.

Fixed. There was an extra space. I also merged in the latest #22429.

> Second, I merged beta5, removed a typo introduced in `monomial_crystals.py`, and added `loop_crystals` to the `src/doc/en/reference/categories/index.rst`.

Thank you.

> Some comments/questions:
> 
> - In `affinization.py`, there is a `#TODO` which suggests that the `digraph` method should be removed when this category gets implemented.  Probably either that `#TODO` or the method should be deleted?

Good point; it was there to get rid of the up arrows. Done.

> - While not added on this ticket, there is a reference to "pg. 48 of Kac" under the `affine_weight` method in `KR_type_E6`.  That reference should be explicit, and why not fix it now?

Done.

> I'll read through the html documentation of `LoopCrystals` after it's been added to rst file.

Thank you.


---

Comment by git created at 2017-05-06 17:55:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2017-05-06 18:44:33

There were some documentation errors which caused the docbuild to fail.  These are now fixed with the last push.  

Now all tests passed and both HTML and PDF documentation build.  I read through the documentation, and it looks good.  In particular, it doesn't look like any doctests were lost in the conversion to this ticket.  

Some more comments/questions regarding `loop_crystals.py`:

- Should ":meth:`module_generator()`" result in a hyperlink in the R-matrix documentation?

- Why are the subscripts missing from ":meth:`local energy function <...>`"?  Should this be ":meth:`local_energy_function <...>`"?

- `#TODO: Implement a version of tensor products for KR crystals.` remains in the documentation.  Should this now be removed?


---

Comment by git created at 2017-05-06 19:07:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-06 19:10:20

Replying to [comment:35 bsalisbury1]:
> There were some documentation errors which caused the docbuild to fail.  These are now fixed with the last push.  

Thank you.

> Some more comments/questions regarding `loop_crystals.py`:
> 
> - Should ":meth:`module_generator()`" result in a hyperlink in the R-matrix documentation?

A better link would be to `:meth:`maximal_vector``; changed.

> - Why are the subscripts missing from ":meth:`local energy function <...>`"?  Should this be ":meth:`local_energy_function <...>`"?

Because the stuff not in `<...>` is what is actually displayed (which could be anything). For comparison, if you have `:meth:`foo <bar>``, it is like the html `<a href="bar">foo</a>`.

> - `#TODO: Implement a version of tensor products for KR crystals.` remains in the documentation.  Should this now be removed?

No, because the method is currently only implemented for non-tensor products.


---

Comment by bsalisbury1 created at 2017-05-06 19:15:15

Replying to [comment:37 tscrim]:
>
> > - Why are the subscripts missing from ":meth:`local energy function <...>`"?  Should this be ":meth:`local_energy_function <...>`"?
> 
> Because the stuff not in `<...>` is what is actually displayed (which could be anything). For comparison, if you have `:meth:`foo <bar>``, it is like the html `<a href="bar">foo</a>`.

I understand the concept behind the code, but it seems the convention in other locations has been to include the subscripts.  Anyway, if there is no standard for displaying such links, then it doesn't matter.


---

Comment by tscrim created at 2017-05-06 19:16:56

Replying to [comment:38 bsalisbury1]:
> Replying to [comment:37 tscrim]:
> >
> > > - Why are the subscripts missing from ":meth:`local energy function <...>`"?  Should this be ":meth:`local_energy_function <...>`"?
> > 
> > Because the stuff not in `<...>` is what is actually displayed (which could be anything). For comparison, if you have `:meth:`foo <bar>``, it is like the html `<a href="bar">foo</a>`.
> 
> I understand the concept behind the code, but it seems the convention in other locations has been to include the subscripts.  Anyway, if there is no standard for displaying such links, then it doesn't matter.  

In other places, they usually just do `:meth:`~foo.bar``, which shortens the output to `bar`. However, there is no standard AFAIK, but I think this looks a little better.


---

Comment by bsalisbury1 created at 2017-05-06 19:25:17

Changing status from needs_review to positive_review.


---

Comment by aschilling created at 2017-05-06 22:18:19

There are actually two energy function (left and right energy, depending on which way the tensor product is read). It might be a good idea to put this option in the energy function method!


---

Comment by vbraun created at 2017-05-08 21:22:36

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-05-08 21:22:36

Merge conflict


---

Comment by git created at 2017-05-09 04:27:32

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tscrim created at 2017-05-09 04:29:29

Rebased over #22642.


---

Comment by tscrim created at 2017-05-09 04:29:29

Changing status from needs_work to needs_review.


---

Comment by bsalisbury1 created at 2017-05-09 20:53:01

Successful rebase.  All tests passed and documentation builds (both PDF and HTML).


---

Comment by bsalisbury1 created at 2017-05-09 20:53:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-13 10:33:38

Resolution: fixed
