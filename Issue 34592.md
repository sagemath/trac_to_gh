# Issue 34592: sage --pytest does not support out of Sage tree Sage doctests

Issue created by migration from https://trac.sagemath.org/ticket/34829

Original creator: dimpase

Original creation time: 2022-12-07 10:12:30

Running `sage --pytest foo.py` on an out of tree `foo.py` ignores `sage:`-prompted docstrings, and happily tests `>>>`-prompted docstrings. E.g. with

```python
# foo.py
class tst:
    """
    sage: len(tst.__subclasses__()) >= 0
    True
    """
    pass
```

one has

```
$ ./sage --pytest src/sage/interfaces/foo.py 
===================================== test session starts ======================================
platform linux -- Python 3.9.2, pytest-7.1.3, pluggy-1.0.0
rootdir: /home/dimpase/work/software/sage/src, configfile: tox.ini
collected 1 item                                                                               

src/sage/interfaces/foo.py .                                                               [100%]

====================================== 1 passed in 0.04s =======================================
```

but

```
$ ./sage --pytest foo.py 
===================================== test session starts ======================================
platform linux -- Python 3.9.2, pytest-7.1.3, pluggy-1.0.0
rootdir: /home/dimpase/work/software/sage/src
collected 0 items                                                                              

==================================== no tests ran in 0.01s =====================================
```


So there is some magic happening here, with `tox.ini` used in the former case, but not in the latter case.


---

Comment by mkoeppe created at 2022-12-07 19:18:29

`src/conftest.py` has the magic


---

Comment by mkoeppe created at 2022-12-07 19:24:50

It would probably be sufficient if we document how user projects should configure pytest by providing their own confest.py


---

Comment by dimpase created at 2022-12-07 21:53:21

Replying to [comment:1 Matthias KÃ¶ppe]:
> `src/conftest.py` has the magic

Thanks. Perhaps you also know where to monkey-patch `warnings.showwarning` - see
https://trac.sagemath.org/ticket/33826#comment:8 -
so that pytest correctly processes deprecation warnings in doctests...


---

Comment by dimpase created at 2022-12-07 22:08:51

Oh, it *can* be monkey-patched in `src/conftest.py` - it's in a diffrent format then, so that's something to look into...
