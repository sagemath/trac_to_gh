# Issue 24744: Include length into the comparison of monomial orderings

archive/issues_024744.json:
```json
{
    "body": "Keywords: block order, comparison\n\nIn the following example, it is attempted to create two polynomial rings with mathematically distinct block orders, but Sage treats them as equal:\n\n\n```\nsage: R = PolynomialRing(QQ, 6, 'x', order=\"lex(1),degrevlex(5)\")\nsage: S = R.change_ring(order=\"lex(2),degrevlex(4)\")\nsage: R is S\nTrue\n```\n\n\nProbable underlying reason: Comparison of block orders takes into account the way in which each block is ordered (lex or degrevlex, in this example), but fails to take into account the length of the blocks.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24981\n\n",
    "created_at": "2018-03-15T07:07:02Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "title": "Include length into the comparison of monomial orderings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24744",
    "user": "SimonKing"
}
```
Keywords: block order, comparison

In the following example, it is attempted to create two polynomial rings with mathematically distinct block orders, but Sage treats them as equal:


```
sage: R = PolynomialRing(QQ, 6, 'x', order="lex(1),degrevlex(5)")
sage: S = R.change_ring(order="lex(2),degrevlex(4)")
sage: R is S
True
```


Probable underlying reason: Comparison of block orders takes into account the way in which each block is ordered (lex or degrevlex, in this example), but fails to take into account the length of the blocks.

Issue created by migration from https://trac.sagemath.org/ticket/24981





---

archive/issue_comments_347312.json:
```json
{
    "body": "I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:\n\n```\nsage: R = PolynomialRing(QQ, 6, 'x', order=\"lex(1),degrevlex(5)\")\nsage: S = R.change_ring(order=\"lex(2),degrevlex(4)\")\nsage: R is S\n```\n",
    "created_at": "2018-03-15T08:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347312",
    "user": "nbruin"
}
```

I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:

```
sage: R = PolynomialRing(QQ, 6, 'x', order="lex(1),degrevlex(5)")
sage: S = R.change_ring(order="lex(2),degrevlex(4)")
sage: R is S
```




---

archive/issue_comments_347313.json:
```json
{
    "body": "Replying to [comment:1 nbruin]:\n> I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:\n\nSure, see ticket description. And since the term orders are mathematically not the same, having \"R is S\" is a bug.",
    "created_at": "2018-03-15T08:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347313",
    "user": "SimonKing"
}
```

Replying to [comment:1 nbruin]:
> I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:

Sure, see ticket description. And since the term orders are mathematically not the same, having "R is S" is a bug.



---

archive/issue_comments_347314.json:
```json
{
    "body": "This behaviour was changed in commit 63e72fc3 of trac #11316 which added weighted term orders.\nIn particular, doctests for equality of block orders were changed to the opposite.\nBefore that commit, comparison was based on the `_singular_str` of a term order, which contains block sizes for block orders, but not for other orders.\nFor example, `TermOrder('lex', 2) == TermOrder('lex', 3)` was true \u2013 and still is true in the current implementation.\nThis explains why length is not considered in the current implementation.\n\nBased on that, I suggest to include the block sizes in equality checks only if the term order is a block order.\nThis is mainly for backwards compatibility and is implemented on the new branch.\n\nSide note: Personally, I would prefer to always include length in comparisons for any order because this seems to be more intuitive.\nHowever, some existing code seems to depend on the opposite. For example, in `MPolynomialRing_libsingular._element_constructor_` this assumption is used to determine whether the term order of a polynomial ring restricts to the term order of a polynomial ring in fewer variables in order to avoid unnecessary resorting of monomials. Admittedly, that use is a bit dubious as it does not cover all the cases in which a term order can restrict to one in fewer variables.\n----\nNew commits:",
    "created_at": "2018-08-10T18:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347314",
    "user": "@mwageringel"
}
```

This behaviour was changed in commit 63e72fc3 of trac #11316 which added weighted term orders.
In particular, doctests for equality of block orders were changed to the opposite.
Before that commit, comparison was based on the `_singular_str` of a term order, which contains block sizes for block orders, but not for other orders.
For example, `TermOrder('lex', 2) == TermOrder('lex', 3)` was true â€“ and still is true in the current implementation.
This explains why length is not considered in the current implementation.

Based on that, I suggest to include the block sizes in equality checks only if the term order is a block order.
This is mainly for backwards compatibility and is implemented on the new branch.

Side note: Personally, I would prefer to always include length in comparisons for any order because this seems to be more intuitive.
However, some existing code seems to depend on the opposite. For example, in `MPolynomialRing_libsingular._element_constructor_` this assumption is used to determine whether the term order of a polynomial ring restricts to the term order of a polynomial ring in fewer variables in order to avoid unnecessary resorting of monomials. Admittedly, that use is a bit dubious as it does not cover all the cases in which a term order can restrict to one in fewer variables.
----
New commits:



---

archive/issue_comments_347315.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-10T18:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347315",
    "user": "@mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347316.json:
```json
{
    "body": "ok",
    "created_at": "2019-01-23T07:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347316",
    "user": "chapoton"
}
```

ok



---

archive/issue_comments_347317.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-23T07:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347317",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347318.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-24T18:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24744#issuecomment-347318",
    "user": "vbraun"
}
```

Resolution: fixed
