# Issue 24744: Include length into the comparison of monomial orderings

Issue created by migration from https://trac.sagemath.org/ticket/24981

Original creator: SimonKing

Original creation time: 2018-03-15 07:07:02

Keywords: block order, comparison

In the following example, it is attempted to create two polynomial rings with mathematically distinct block orders, but Sage treats them as equal:


```
sage: R = PolynomialRing(QQ, 6, 'x', order="lex(1),degrevlex(5)")
sage: S = R.change_ring(order="lex(2),degrevlex(4)")
sage: R is S
True
```


Probable underlying reason: Comparison of block orders takes into account the way in which each block is ordered (lex or degrevlex, in this example), but fails to take into account the length of the blocks.


---

Comment by nbruin created at 2018-03-15 08:38:01

I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:

```
sage: R = PolynomialRing(QQ, 6, 'x', order="lex(1),degrevlex(5)")
sage: S = R.change_ring(order="lex(2),degrevlex(4)")
sage: R is S
```



---

Comment by SimonKing created at 2018-03-15 08:57:57

Replying to [comment:1 nbruin]:
> I haven't checked, but I'd expect that in the following example there is actually a difference in how the term orders behave:

Sure, see ticket description. And since the term orders are mathematically not the same, having "R is S" is a bug.


---

Comment by @mwageringel created at 2018-08-10 18:02:59

This behaviour was changed in commit 63e72fc3 of trac #11316 which added weighted term orders.
In particular, doctests for equality of block orders were changed to the opposite.
Before that commit, comparison was based on the `_singular_str` of a term order, which contains block sizes for block orders, but not for other orders.
For example, `TermOrder('lex', 2) == TermOrder('lex', 3)` was true â€“ and still is true in the current implementation.
This explains why length is not considered in the current implementation.

Based on that, I suggest to include the block sizes in equality checks only if the term order is a block order.
This is mainly for backwards compatibility and is implemented on the new branch.

Side note: Personally, I would prefer to always include length in comparisons for any order because this seems to be more intuitive.
However, some existing code seems to depend on the opposite. For example, in `MPolynomialRing_libsingular._element_constructor_` this assumption is used to determine whether the term order of a polynomial ring restricts to the term order of a polynomial ring in fewer variables in order to avoid unnecessary resorting of monomials. Admittedly, that use is a bit dubious as it does not cover all the cases in which a term order can restrict to one in fewer variables.
----
New commits:


---

Comment by @mwageringel created at 2018-08-10 18:02:59

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-01-23 07:20:48

ok


---

Comment by chapoton created at 2019-01-23 07:20:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-01-24 18:18:07

Resolution: fixed
