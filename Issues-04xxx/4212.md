# Issue 4212: [with patch, positive review] Invalid read of size 8 in totallyreal.pyx

archive/issues_004212.json:
```json
{
    "body": "```\n==29696== Invalid read of size 8\n==29696==    at 0x1320D5D9: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2777)\n==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)\n==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)\n==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)\n==29696==    by 0x4A77AF: PyRun_SimpleFileExFlags (pythonrun.c:879)\n==29696==    by 0x41215F: Py_Main (main.c:523)\n==29696==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)\n==29696==  Address 0x8e598b0 is 8 bytes after a block of size 48 alloc'd\n==29696==    at 0x4A1BE1B: malloc (vg_replace_malloc.c:207)\n==29696==    by 0x133508CA: PyArray_NewFromDescr (arrayobject.c:5633)\n==29696==    by 0x13377F52: PyArray_Concatenate (multiarraymodule.c:1846)\n==29696==    by 0x13377A5C: PyArray_Concatenate (multiarraymodule.c:1745)\n==29696==    by 0x133780EF: array_concatenate (multiarraymodule.c:6745)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x48491B: PyEval_EvalFrameEx (ceval.c:3659)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x4CF3F7: function_call (funcobject.c:517)\n==29696==    by 0x415832: PyObject_Call (abstract.c:1861)\n==29696==    by 0x1320D1D0: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2670)\n==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)\n==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)\n==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)\n==29696== \n==29696== Invalid read of size 8\n==29696==    at 0x1320DBF9: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2792)\n==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)\n==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)\n==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)\n==29696==    by 0x4A77AF: PyRun_SimpleFileExFlags (pythonrun.c:879)\n==29696==    by 0x41215F: Py_Main (main.c:523)\n==29696==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)\n==29696==  Address 0x8e598a8 is 0 bytes after a block of size 48 alloc'd\n==29696==    at 0x4A1BE1B: malloc (vg_replace_malloc.c:207)\n==29696==    by 0x133508CA: PyArray_NewFromDescr (arrayobject.c:5633)\n==29696==    by 0x13377F52: PyArray_Concatenate (multiarraymodule.c:1846)\n==29696==    by 0x13377A5C: PyArray_Concatenate (multiarraymodule.c:1745)\n==29696==    by 0x133780EF: array_concatenate (multiarraymodule.c:6745)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x48491B: PyEval_EvalFrameEx (ceval.c:3659)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x4CF3F7: function_call (funcobject.c:517)\n==29696==    by 0x415832: PyObject_Call (abstract.c:1861)\n==29696==    by 0x1320D1D0: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2670)\n==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)\n==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)\n==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)\n==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)\n==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)\n==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)\n```\nThis is perplexing considering that we are having a degree six polynomial. *But* when the roots are real numpy returns an array of doubles and not complex numbers. With the following patch applied\n\n```\n--- a/sage/rings/number_field/totallyreal_data.pyx Sun Sep 21 20:50:32 2008 -0700\n+++ b/sage/rings/number_field/totallyreal_data.pyx Sun Sep 28 00:41:17 2008 -0700\n@@ -326,6 +326,10 @@\n         \n         fcoeff = [ int(coeffs[i]) for i in range(7) ]\n         rts = numpy.roots(fcoeff)\n+\n+        import sys\n+        sys.stderr.write(str(fcoeff)+\"\\n\")\n+        sys.stderr.write(str(rts)+\"\\n\")\n \n         roots_data = <double *>((<ndarray>rts).data)\n         for i from 0 <= i < 6:\n```\nwe get:\n\n```\n<SNIP>\n[200, -480, -2712, 4052, 18072, -10800, -54000]\n[ 3.25148114+0.j          2.61459959+0.75768433j  2.61459959-0.75768433j\n -1.91214896+1.14457619j -1.91214896-1.14457619j -2.25638240+0.j        ]\n[200, -480, -2712, 4592, 17424, -13824, -53568]\n[ 3.18809326+0.j          2.64899261+0.91101386j  2.64899261-0.91101386j\n -1.88057770+1.03363004j -1.88057770-1.03363004j -2.32492308+0.j        ]\n[225, -540, -2196, 3744, 6192, -4032, 576]\n[ 2.92664989  2.92664995 -2.00000003 -1.99999997  0.27335008  0.27335009]\n```\nNotice that the last output for rst is six doubles, i.e. an array of 48 bytes. The fix is to ask for rts as complex128, i.e.\n\n```\nrts = numpy.roots(fcoeff).astype(\"complex128\")\n```\n\nCheers,\n\nMichael\n\nAssignee: mabshoff\n\nCC:  @mwhansen @craigcitro @jvoight\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4212\n\n",
    "closed_at": "2008-09-28T08:05:39Z",
    "created_at": "2008-09-28T07:48:32Z",
    "labels": [
        "component: memleak",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.1.3",
    "title": "[with patch, positive review] Invalid read of size 8 in totallyreal.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4212",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```
```
==29696== Invalid read of size 8
==29696==    at 0x1320D5D9: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2777)
==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)
==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)
==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)
==29696==    by 0x4A77AF: PyRun_SimpleFileExFlags (pythonrun.c:879)
==29696==    by 0x41215F: Py_Main (main.c:523)
==29696==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)
==29696==  Address 0x8e598b0 is 8 bytes after a block of size 48 alloc'd
==29696==    at 0x4A1BE1B: malloc (vg_replace_malloc.c:207)
==29696==    by 0x133508CA: PyArray_NewFromDescr (arrayobject.c:5633)
==29696==    by 0x13377F52: PyArray_Concatenate (multiarraymodule.c:1846)
==29696==    by 0x13377A5C: PyArray_Concatenate (multiarraymodule.c:1745)
==29696==    by 0x133780EF: array_concatenate (multiarraymodule.c:6745)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x48491B: PyEval_EvalFrameEx (ceval.c:3659)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x4CF3F7: function_call (funcobject.c:517)
==29696==    by 0x415832: PyObject_Call (abstract.c:1861)
==29696==    by 0x1320D1D0: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2670)
==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)
==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)
==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)
==29696== 
==29696== Invalid read of size 8
==29696==    at 0x1320DBF9: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2792)
==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)
==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)
==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)
==29696==    by 0x4A77AF: PyRun_SimpleFileExFlags (pythonrun.c:879)
==29696==    by 0x41215F: Py_Main (main.c:523)
==29696==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)
==29696==  Address 0x8e598a8 is 0 bytes after a block of size 48 alloc'd
==29696==    at 0x4A1BE1B: malloc (vg_replace_malloc.c:207)
==29696==    by 0x133508CA: PyArray_NewFromDescr (arrayobject.c:5633)
==29696==    by 0x13377F52: PyArray_Concatenate (multiarraymodule.c:1846)
==29696==    by 0x13377A5C: PyArray_Concatenate (multiarraymodule.c:1745)
==29696==    by 0x133780EF: array_concatenate (multiarraymodule.c:6745)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x48491B: PyEval_EvalFrameEx (ceval.c:3659)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x4CF3F7: function_call (funcobject.c:517)
==29696==    by 0x415832: PyObject_Call (abstract.c:1861)
==29696==    by 0x1320D1D0: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_lagrange_degree_3 (totallyreal_data.c:2670)
==29696==    by 0x1321C5B5: __pyx_f_4sage_5rings_12number_field_16totallyreal_data_7tr_data_incr (totallyreal_data.c:5957)
==29696==    by 0x130E6BBA: __pyx_pf_4sage_5rings_12number_field_11totallyreal_enumerate_totallyreal_fields_prim (totallyreal.c:4212)
==29696==    by 0x483E46: PyEval_EvalFrameEx (ceval.c:3573)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x484AF1: PyEval_EvalFrameEx (ceval.c:494)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x483F76: PyEval_EvalFrameEx (ceval.c:3669)
==29696==    by 0x485DB1: PyEval_EvalCodeEx (ceval.c:2836)
==29696==    by 0x486051: PyEval_EvalCode (ceval.c:494)
==29696==    by 0x4A751D: PyRun_FileExFlags (pythonrun.c:1273)
```
This is perplexing considering that we are having a degree six polynomial. *But* when the roots are real numpy returns an array of doubles and not complex numbers. With the following patch applied

```
--- a/sage/rings/number_field/totallyreal_data.pyx Sun Sep 21 20:50:32 2008 -0700
+++ b/sage/rings/number_field/totallyreal_data.pyx Sun Sep 28 00:41:17 2008 -0700
@@ -326,6 +326,10 @@
         
         fcoeff = [ int(coeffs[i]) for i in range(7) ]
         rts = numpy.roots(fcoeff)
+
+        import sys
+        sys.stderr.write(str(fcoeff)+"\n")
+        sys.stderr.write(str(rts)+"\n")
 
         roots_data = <double *>((<ndarray>rts).data)
         for i from 0 <= i < 6:
```
we get:

```
<SNIP>
[200, -480, -2712, 4052, 18072, -10800, -54000]
[ 3.25148114+0.j          2.61459959+0.75768433j  2.61459959-0.75768433j
 -1.91214896+1.14457619j -1.91214896-1.14457619j -2.25638240+0.j        ]
[200, -480, -2712, 4592, 17424, -13824, -53568]
[ 3.18809326+0.j          2.64899261+0.91101386j  2.64899261-0.91101386j
 -1.88057770+1.03363004j -1.88057770-1.03363004j -2.32492308+0.j        ]
[225, -540, -2196, 3744, 6192, -4032, 576]
[ 2.92664989  2.92664995 -2.00000003 -1.99999997  0.27335008  0.27335009]
```
Notice that the last output for rst is six doubles, i.e. an array of 48 bytes. The fix is to ask for rts as complex128, i.e.

```
rts = numpy.roots(fcoeff).astype("complex128")
```

Cheers,

Michael

Assignee: mabshoff

CC:  @mwhansen @craigcitro @jvoight

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/4212





---

archive/issue_comments_031325.json:
```json
{
    "body": "<a id='comment:1'></a>With the patch applied the problem goes away, i.e.:\n\n```\nTrying:\n    ls = enumerate_totallyreal_fields_prim(Integer(5),Integer(10)**Integer(5)) ; ls###line 171:_sage_    >>> ls = enumerate_totallyreal_fields_prim(5,10^5) ; ls\nExpecting:\n    [[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],\n     [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],\n     [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],\n     [38569, x^5 - 5*x^3 + 4*x - 1],\n     [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],\n     [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1],\n     [81509, x^5 - x^4 - 5*x^3 + 3*x^2 + 5*x - 2],\n     [81589, x^5 - 6*x^3 + 8*x - 1],\n     [89417, x^5 - 6*x^3 - x^2 + 8*x + 3]]\nok\n```\n\nJohn, Craig, \n\nplease audit the totallyreal* code for similar problems arising from numpy. I consider it quite a coincidence that we hit this issue.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-28T07:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31325",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>With the patch applied the problem goes away, i.e.:

```
Trying:
    ls = enumerate_totallyreal_fields_prim(Integer(5),Integer(10)**Integer(5)) ; ls###line 171:_sage_    >>> ls = enumerate_totallyreal_fields_prim(5,10^5) ; ls
Expecting:
    [[14641, x^5 - x^4 - 4*x^3 + 3*x^2 + 3*x - 1],
     [24217, x^5 - 5*x^3 - x^2 + 3*x + 1],
     [36497, x^5 - 2*x^4 - 3*x^3 + 5*x^2 + x - 1],
     [38569, x^5 - 5*x^3 + 4*x - 1],
     [65657, x^5 - x^4 - 5*x^3 + 2*x^2 + 5*x + 1],
     [70601, x^5 - x^4 - 5*x^3 + 2*x^2 + 3*x - 1],
     [81509, x^5 - x^4 - 5*x^3 + 3*x^2 + 5*x - 2],
     [81589, x^5 - 6*x^3 + 8*x - 1],
     [89417, x^5 - 6*x^3 - x^2 + 8*x + 3]]
ok
```

John, Craig, 

please audit the totallyreal* code for similar problems arising from numpy. I consider it quite a coincidence that we hit this issue.

Cheers,

Michael



---

archive/issue_comments_031326.json:
```json
{
    "body": "Attachment [trac_4212.patch](tarball://root/attachments/some-uuid/ticket4212/trac_4212.patch) by mabshoff created at 2008-09-28 07:57:43",
    "created_at": "2008-09-28T07:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31326",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Attachment [trac_4212.patch](tarball://root/attachments/some-uuid/ticket4212/trac_4212.patch) by mabshoff created at 2008-09-28 07:57:43



---

archive/issue_comments_031327.json:
```json
{
    "body": "<a id='comment:2'></a>For the record: This fix has been a joined mhansen & mabshoff production and review.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-28T07:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31327",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>For the record: This fix has been a joined mhansen & mabshoff production and review.

Cheers,

Michael



---

archive/issue_comments_031328.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2008-09-28T07:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31328",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Changing status from new to assigned.



---

archive/issue_comments_031329.json:
```json
{
    "body": "Changing assignee from craigcitro, jvoight to mabshoff.",
    "created_at": "2008-09-28T07:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31329",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Changing assignee from craigcitro, jvoight to mabshoff.



---

archive/issue_comments_031330.json:
```json
{
    "body": "<a id='comment:3'></a>Looks good to me.",
    "created_at": "2008-09-28T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31330",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>Looks good to me.



---

archive/issue_events_009543.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-09-28T08:05:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4212#event-9543"
}
```



---

archive/issue_comments_031331.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-09-28T08:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31331",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_031332.json:
```json
{
    "body": "<a id='comment:4'></a>Merged in Sage 3.1.3.alpha2",
    "created_at": "2008-09-28T08:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31332",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>Merged in Sage 3.1.3.alpha2



---

archive/issue_comments_031333.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -94,8 +94,8 @@\n This is perplexing considering that we are having a degree six polynomial. *But* when the roots are real numpy returns an array of doubles and not complex numbers. With the following patch applied\n \n ```\n---- a/sage/rings/number_field/totallyreal_data.pyx\tSun Sep 21 20:50:32 2008 -0700\n-+++ b/sage/rings/number_field/totallyreal_data.pyx\tSun Sep 28 00:41:17 2008 -0700\n+--- a/sage/rings/number_field/totallyreal_data.pyx Sun Sep 21 20:50:32 2008 -0700\n++++ b/sage/rings/number_field/totallyreal_data.pyx Sun Sep 28 00:41:17 2008 -0700\n @@ -326,6 +326,10 @@\n          \n          fcoeff = [ int(coeffs[i]) for i in range(7) ]\n@@ -131,8 +131,6 @@\n \n Michael\n \n-Assignee: craigcitro, jvoight\n-\n Comment: 1\n \n Summary: [with patch, needs review] Invalid read of size 8 in totallyreal.pyx\n``````\n",
    "created_at": "2015-09-06T15:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4212#issuecomment-31333",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -94,8 +94,8 @@
 This is perplexing considering that we are having a degree six polynomial. *But* when the roots are real numpy returns an array of doubles and not complex numbers. With the following patch applied
 
 ```
---- a/sage/rings/number_field/totallyreal_data.pyx	Sun Sep 21 20:50:32 2008 -0700
-+++ b/sage/rings/number_field/totallyreal_data.pyx	Sun Sep 28 00:41:17 2008 -0700
+--- a/sage/rings/number_field/totallyreal_data.pyx Sun Sep 21 20:50:32 2008 -0700
++++ b/sage/rings/number_field/totallyreal_data.pyx Sun Sep 28 00:41:17 2008 -0700
 @@ -326,6 +326,10 @@
          
          fcoeff = [ int(coeffs[i]) for i in range(7) ]
@@ -131,8 +131,6 @@
 
 Michael
 
-Assignee: craigcitro, jvoight
-
 Comment: 1
 
 Summary: [with patch, needs review] Invalid read of size 8 in totallyreal.pyx
``````

