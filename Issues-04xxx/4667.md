# Issue 4667: quadratic twists for p-adic L-functions

archive/issues_004667.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": " This ticket is aimed at implementing p-adic L-function of quadratic twists of elliptic curves.\n\nOf course one could compute the modular symbols for the twist and then the p-adic L-function, but it is much faster to use the simple formula for the twisted modular symbols as a sum of \nmodular symbols. See section 8 in Mazur-Tate-Teitelbaum = [MTT].\n\nHere is a list of things implemented and changed by this patch. Maybe this is too long and it\nwould be preferable to split it up into smaller patches. I will add more documentation and more compatibility checks in the docstring.\n\n## ell_modular_symbol.py\n\nI changed completely the normalization. Until now, the normalization was done in such a way as to guarantee that [0]+, the modular_symbol(0) for sign=+1, is equal to L(E_0,1)/Omega_E_0, where E_0 is the optimal X_0(N) curve in the isogeny class of E and Omega_* is the least positive real period of E. Up to sign, which was arbitrary, and up to a factor 2, which comes from the fact that we do not know that the Manin-constant is 1 as it should be. (I hope I got this right).\n\nNow instead I normalize it in such a way as to make sure that [0]+ is equal to L(E,1)/Omega_E. So the result will depend on the curve E and not only on the isogeny class. Let {0}+ be the non-normalized modular symbol. If the above algebraic L-value is non-zero, then so is {0}+ and they are rational multiples of each other with small numerator and denominator. So we just compute a real approximation to this fraction and we scale {0}+ to get [0]+. If the L-value is zero, then we try to use a quadratic twist of E by a small positive (or later negative) fundamental discriminant, hoping that we will hit one that is not zero. If we fail to find one, we have to go back to the previous way of normalizing, but multiplying with Omega_E_0/Omega_E as to make sure that the missed factor +-1/2 is the same for all curves in the isogeny class. And we issue a warning to the user.\n\nRight now, I substituted the normalization by mine, it would be easy to change the optional argument in such a way as to allow the user to choose between the two normalizations.\n\nI have tested the correctness of this for hundreds of curves, using twists by -31 and 37 that do\nnot appear in the code. Of course, there will be curves for which the new normalization fails. For negative modular symbols we only use negative twists (in order to avoid an obvious infinite loop). But we are safe to assume that negative modular symbols are not very often used without the positive ones.\n\nI have not rewritten the normalization of modular symbols coming from ec_lib in padic_lseries.py. This should be done, but I have no idea if the negative symbols can be computed with that library.\n\nAdded more docstrings.\n\n## padic_lseries.py\n\nI got rid of _quotient_of_period which is no longer needed because of the above normalization.\nI added a try around the cremona-label look-up. Caused a bug before. modular_symbol has now an optional argument to twist by a fundamental discriminant D. Similar for measure and series.\nNew we need a function to compute the quotient of Omega_E by Omega_(ED)*sqrt(D), if D>0, or Omega-_E by  Omega_(ED)*sqrt(-D), if D<0. According to [MTT] this should be 1 or 2. This\nis done in _quotient_of_periods_to_twist.\n\nFurthermore, I have changed the sign of the Dp-values height, just like I had to change the sign in the canonical p-adic height in the ordinary case.\n \nSo far I have tested this on good ordinary primes for curves of rank 0 and rank 1 and some rank 2 curves. I have also checked a few supersingular cases.\n\n## padics.py\n\nI changed the sign of the padic height. It is now clear that there must be a -1 in front to make sure that the p-adic BSD conjecture holds as stated in [MTT].\nI also removed the statement that the equation must be globally minimal to compute the height as the gens() no longer fails for non-minimal curves.\n\n\n## ell_rational_field.py\n\nadjusted the documentation according to the change in ell_modular_symbol.\nadded a function minimal_quadratic_twist that find a twist of E with minimal conductor. This is used in sha_tate.py but could be of use later in rank as well.\n\ntodo : normalization if using ec_lib (?)\n\ntodo : add in rank() the possibility to use modular-symbols for a twisted curve with low conductor\n\n## sha_tate.py\n\nan_padic has now an optional argument to control whether the modular symbols computations can be done on a minimal quadratic twist instead. \n\n\nCC:  @JohnCremona @williamstein\n\nKeywords: **padic l-functions, quadratic twists**\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4667_\n\n",
    "closed_at": "2009-03-31T21:29:24Z",
    "created_at": "2008-12-01T00:07:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "quadratic twists for p-adic L-functions",
    "type": "issue",
    "updated_at": "2009-03-31T21:29:24Z",
    "url": "https://github.com/sagemath/sage/issues/4667",
    "user": "https://github.com/categorie"
}
```
 This ticket is aimed at implementing p-adic L-function of quadratic twists of elliptic curves.

Of course one could compute the modular symbols for the twist and then the p-adic L-function, but it is much faster to use the simple formula for the twisted modular symbols as a sum of 
modular symbols. See section 8 in Mazur-Tate-Teitelbaum = [MTT].

Here is a list of things implemented and changed by this patch. Maybe this is too long and it
would be preferable to split it up into smaller patches. I will add more documentation and more compatibility checks in the docstring.

## ell_modular_symbol.py

I changed completely the normalization. Until now, the normalization was done in such a way as to guarantee that [0]+, the modular_symbol(0) for sign=+1, is equal to L(E_0,1)/Omega_E_0, where E_0 is the optimal X_0(N) curve in the isogeny class of E and Omega_* is the least positive real period of E. Up to sign, which was arbitrary, and up to a factor 2, which comes from the fact that we do not know that the Manin-constant is 1 as it should be. (I hope I got this right).

Now instead I normalize it in such a way as to make sure that [0]+ is equal to L(E,1)/Omega_E. So the result will depend on the curve E and not only on the isogeny class. Let {0}+ be the non-normalized modular symbol. If the above algebraic L-value is non-zero, then so is {0}+ and they are rational multiples of each other with small numerator and denominator. So we just compute a real approximation to this fraction and we scale {0}+ to get [0]+. If the L-value is zero, then we try to use a quadratic twist of E by a small positive (or later negative) fundamental discriminant, hoping that we will hit one that is not zero. If we fail to find one, we have to go back to the previous way of normalizing, but multiplying with Omega_E_0/Omega_E as to make sure that the missed factor +-1/2 is the same for all curves in the isogeny class. And we issue a warning to the user.

Right now, I substituted the normalization by mine, it would be easy to change the optional argument in such a way as to allow the user to choose between the two normalizations.

I have tested the correctness of this for hundreds of curves, using twists by -31 and 37 that do
not appear in the code. Of course, there will be curves for which the new normalization fails. For negative modular symbols we only use negative twists (in order to avoid an obvious infinite loop). But we are safe to assume that negative modular symbols are not very often used without the positive ones.

I have not rewritten the normalization of modular symbols coming from ec_lib in padic_lseries.py. This should be done, but I have no idea if the negative symbols can be computed with that library.

Added more docstrings.

## padic_lseries.py

I got rid of _quotient_of_period which is no longer needed because of the above normalization.
I added a try around the cremona-label look-up. Caused a bug before. modular_symbol has now an optional argument to twist by a fundamental discriminant D. Similar for measure and series.
New we need a function to compute the quotient of Omega_E by Omega_(ED)*sqrt(D), if D>0, or Omega-_E by  Omega_(ED)*sqrt(-D), if D<0. According to [MTT] this should be 1 or 2. This
is done in _quotient_of_periods_to_twist.

Furthermore, I have changed the sign of the Dp-values height, just like I had to change the sign in the canonical p-adic height in the ordinary case.
 
So far I have tested this on good ordinary primes for curves of rank 0 and rank 1 and some rank 2 curves. I have also checked a few supersingular cases.

## padics.py

I changed the sign of the padic height. It is now clear that there must be a -1 in front to make sure that the p-adic BSD conjecture holds as stated in [MTT].
I also removed the statement that the equation must be globally minimal to compute the height as the gens() no longer fails for non-minimal curves.


## ell_rational_field.py

adjusted the documentation according to the change in ell_modular_symbol.
added a function minimal_quadratic_twist that find a twist of E with minimal conductor. This is used in sha_tate.py but could be of use later in rank as well.

todo : normalization if using ec_lib (?)

todo : add in rank() the possibility to use modular-symbols for a twisted curve with low conductor

## sha_tate.py

an_padic has now an optional argument to control whether the modular symbols computations can be done on a minimal quadratic twist instead. 


CC:  @JohnCremona @williamstein

Keywords: **padic l-functions, quadratic twists**

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/4667_





---

archive/issue_events_053019.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-01T00:07:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53019"
}
```



---

archive/issue_events_053020.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-01T00:07:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53020"
}
```



---

archive/issue_events_053021.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-01T00:07:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53021"
}
```



---

archive/issue_events_053022.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-01T00:07:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53022"
}
```



---

archive/issue_events_053023.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-12-01T00:07:59Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "subject": "https://github.com/categorie",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53023"
}
```



---

archive/issue_comments_027908.json:
```json
{
    "body": "the first part.",
    "created_at": "2008-12-01T00:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27908",
    "user": "https://github.com/categorie"
}
```

the first part.



---

archive/issue_events_053024.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-10T12:48:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "quadratic twists for p-adic L-functions",
    "title_was": "[with first patch, not ready for review] quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53024"
}
```



---

archive/issue_events_053025.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-10T12:48:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53025"
}
```



---

archive/issue_comments_027909.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[twisted_padic_l_functions.1.patch.gz](https://github.com/sagemath/sage/files/ticket4667/twisted_padic_l_functions.1.patch.gz)**\n\nWith respect to the above description, this new version of the patch does everything as said before, but the modular_symbols are handled differently.\n\nIn ell_modular_symbol there are now two option, either to use or not to use eclib (for the + part at least). I implemented an optional argument that controls what method is used to normalize the modular symbols, for both eclib and sage's own modular symbols.",
    "created_at": "2008-12-10T12:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27909",
    "user": "https://github.com/categorie"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[twisted_padic_l_functions.1.patch.gz](https://github.com/sagemath/sage/files/ticket4667/twisted_padic_l_functions.1.patch.gz)**

With respect to the above description, this new version of the patch does everything as said before, but the modular_symbols are handled differently.

In ell_modular_symbol there are now two option, either to use or not to use eclib (for the + part at least). I implemented an optional argument that controls what method is used to normalize the modular symbols, for both eclib and sage's own modular symbols.



---

archive/issue_events_053026.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-10T12:48:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53026"
}
```



---

archive/issue_events_053027.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2008-12-10T12:48:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.2.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53027"
}
```



---

archive/issue_comments_027910.json:
```json
{
    "body": "New Patch, replaces the first patch. Exported against 3.2.1.",
    "created_at": "2008-12-10T12:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27910",
    "user": "https://github.com/categorie"
}
```

New Patch, replaces the first patch. Exported against 3.2.1.



---

archive/issue_comments_027911.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[twisted_padic_lseries.patch.gz](https://github.com/sagemath/sage/files/ticket4667/twisted_padic_lseries.patch.gz)**\n\nTarget time for the review: January 10th",
    "created_at": "2008-12-29T21:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27911",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[twisted_padic_lseries.patch.gz](https://github.com/sagemath/sage/files/ticket4667/twisted_padic_lseries.patch.gz)**

Target time for the review: January 10th



---

archive/issue_events_053028.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-12-29T21:12:25Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "[under review by gsw] quadratic twists for p-adic L-functions",
    "title_was": "quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53028"
}
```



---

archive/issue_comments_027912.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nRescheduled for January 18th",
    "created_at": "2009-01-15T21:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27912",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:3" align="right">comment:3</div>

Rescheduled for January 18th



---

archive/issue_events_053029.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-15T22:15:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "quadratic twists for p-adic L-functions",
    "title_was": "[under review by gsw] quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53029"
}
```



---

archive/issue_events_053030.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-01-18T23:43:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53030"
}
```



---

archive/issue_events_053031.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-01-18T23:43:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53031"
}
```



---

archive/issue_comments_027913.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNeeds work, but only minor issues:\n\n```\napplying ../../../patches/twisted_padic_lseries.patch\npatching file sage/schemes/elliptic_curves/ell_rational_field.py\nHunk #5 FAILED at 4640\n1 out of 5 hunks FAILED -- saving rejects to file sage/schemes/elliptic_curves/ell_rational_field.py.rej\nabort: patch failed to apply\n```\nThat one hunk is only an empty line replacing an empty line (?!?), so could be ignored (and wouldn't prevent a positive review from my side). But there's real work also, some doctest failures:\n\n```\nsage -t -long \"local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\"\n**********************************************************************\nFile \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\", line 644:\n    sage: E.quadratic_twist(-19).label()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_14[22]>\", line 1, in <module>\n        E.quadratic_twist(-Integer(19)).label()###line 644:\n    sage: E.quadratic_twist(-19).label()\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2720, in cremona_label\n        raise RuntimeError, \"Cremona label not known for %s.\"%self\n    RuntimeError: Cremona label not known for Elliptic Curve defined by y^2 + y = x^3 - x^2 - 120*x - 2183 over Rational Field.\n**********************************************************************\n1 items had failures:\n   1 of  23 in __main__.example_14\n***Test Failed*** 1 failures.\n```\nThe doctest failure above seems to come from that I used a vanilla Sage 3.2.3, and the example seems to need the optional extended Cremona tables --- so just add a \"#optional\" or so.\n\nThere are also a bunch of doctest failures for \"sha_tate.py\", which pop up (only) if the doctest \"-long\" option is used.\n\n```\nsage -t -long \"local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\"\n**********************************************************************\nFile \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 276:\n    sage: EllipticCurve('123a1').sha().an_padic(41) #rank 1    (long time)\nExpected:\n    1 + O(41)\nGot:\n    40 + O(41)\n**********************************************************************\nFile \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 283:\n    sage: EllipticCurve('34a1').sha().an_padic(5) # rank 0     (long time)\nException raised:\n.......\n    sage: EllipticCurve('34a1').sha().an_padic(5) # rank 0     (long time)\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 394, in an_padic\n        lps = lp.Dp_valued_series(n,quadratic_twist=D,prec=r+1)\n    TypeError: Dp_valued_series() got an unexpected keyword argument 'quadratic_twist'\n........\n    sage: e.sha().p_primary_bound(7)           # long time\n      File \"/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 458, in p_primary_bound\n        shan = self.an_padic(p,prec = 0,use_twist=True)\n    TypeError: an_padic() got an unexpected keyword argument 'use_twist'\n```\nExcept for the first (which might be architecture related, the old file had this doctest with a \"#random\" comment --- I'm using a Mac) all the following \"long\" doctest failures in sha_tate.py just seem to be artifacts from development, easily to be cleaned up.\n\nAll in all: nothing serious, but as-is it can't go in.",
    "created_at": "2009-01-18T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27913",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:5" align="right">comment:5</div>

Needs work, but only minor issues:

```
applying ../../../patches/twisted_padic_lseries.patch
patching file sage/schemes/elliptic_curves/ell_rational_field.py
Hunk #5 FAILED at 4640
1 out of 5 hunks FAILED -- saving rejects to file sage/schemes/elliptic_curves/ell_rational_field.py.rej
abort: patch failed to apply
```
That one hunk is only an empty line replacing an empty line (?!?), so could be ignored (and wouldn't prevent a positive review from my side). But there's real work also, some doctest failures:

```
sage -t -long "local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py"
**********************************************************************
File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py", line 644:
    sage: E.quadratic_twist(-19).label()
Exception raised:
    Traceback (most recent call last):
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_14[22]>", line 1, in <module>
        E.quadratic_twist(-Integer(19)).label()###line 644:
    sage: E.quadratic_twist(-19).label()
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 2720, in cremona_label
        raise RuntimeError, "Cremona label not known for %s."%self
    RuntimeError: Cremona label not known for Elliptic Curve defined by y^2 + y = x^3 - x^2 - 120*x - 2183 over Rational Field.
**********************************************************************
1 items had failures:
   1 of  23 in __main__.example_14
***Test Failed*** 1 failures.
```
The doctest failure above seems to come from that I used a vanilla Sage 3.2.3, and the example seems to need the optional extended Cremona tables --- so just add a "#optional" or so.

There are also a bunch of doctest failures for "sha_tate.py", which pop up (only) if the doctest "-long" option is used.

```
sage -t -long "local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py"
**********************************************************************
File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 276:
    sage: EllipticCurve('123a1').sha().an_padic(41) #rank 1    (long time)
Expected:
    1 + O(41)
Got:
    40 + O(41)
**********************************************************************
File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 283:
    sage: EllipticCurve('34a1').sha().an_padic(5) # rank 0     (long time)
Exception raised:
.......
    sage: EllipticCurve('34a1').sha().an_padic(5) # rank 0     (long time)
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 394, in an_padic
        lps = lp.Dp_valued_series(n,quadratic_twist=D,prec=r+1)
    TypeError: Dp_valued_series() got an unexpected keyword argument 'quadratic_twist'
........
    sage: e.sha().p_primary_bound(7)           # long time
      File "/Users/georgweber/Public/sage/sage-3.2.3/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 458, in p_primary_bound
        shan = self.an_padic(p,prec = 0,use_twist=True)
    TypeError: an_padic() got an unexpected keyword argument 'use_twist'
```
Except for the first (which might be architecture related, the old file had this doctest with a "#random" comment --- I'm using a Mac) all the following "long" doctest failures in sha_tate.py just seem to be artifacts from development, easily to be cleaned up.

All in all: nothing serious, but as-is it can't go in.



---

archive/issue_comments_027914.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFinally it was easier to correct than what I thought. I simply forgot to change the sign in the p-adic height for split multiplicative primes. \n\nThe new patch should apply cleanly against 3.3.rc3 ( i hope ) and no test (with -long) failed except for\n\nthe issue about the unknown Cremona label in line 644 that Gregor mentioned. I don't know how to solve this; the error only occurs if the optional package `_is_` present. It does not belong to this trac ticket anyway.\n\nchris.",
    "created_at": "2009-02-21T16:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27914",
    "user": "https://github.com/categorie"
}
```

<div id="comment:6" align="right">comment:6</div>

Finally it was easier to correct than what I thought. I simply forgot to change the sign in the p-adic height for split multiplicative primes. 

The new patch should apply cleanly against 3.3.rc3 ( i hope ) and no test (with -long) failed except for

the issue about the unknown Cremona label in line 644 that Gregor mentioned. I don't know how to solve this; the error only occurs if the optional package `_is_` present. It does not belong to this trac ticket anyway.

chris.



---

archive/issue_events_053032.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2009-02-21T16:49:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53032"
}
```



---

archive/issue_events_053033.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2009-02-21T16:49:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53033"
}
```



---

archive/issue_comments_027915.json:
```json
{
    "body": "New patch, replaces the previous two. Exported against 3.3.rc3",
    "created_at": "2009-02-21T16:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27915",
    "user": "https://github.com/categorie"
}
```

New patch, replaces the previous two. Exported against 3.3.rc3



---

archive/issue_comments_027916.json:
```json
{
    "body": "Attachment: **[trac4667.twisted_padic_lseries.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac4667.twisted_padic_lseries.patch.gz)**\n\napply after the last one above (it changes only one line)",
    "created_at": "2009-02-26T05:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27916",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

Attachment: **[trac4667.twisted_padic_lseries.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac4667.twisted_padic_lseries.patch.gz)**

apply after the last one above (it changes only one line)



---

archive/issue_events_053034.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-02-26T05:24:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "[needs rebase] quadratic twists for p-adic L-functions",
    "title_was": "quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53034"
}
```



---

archive/issue_events_053035.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-02-26T05:24:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53035"
}
```



---

archive/issue_events_053036.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-02-26T05:24:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53036"
}
```



---

archive/issue_comments_027917.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac4667_doctestfix.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac4667_doctestfix.patch.gz)**\n\nAs I said in my remark of #4933, this patch here definitely should be applied before any work on #4933 is done.\n\nCould you help with the rebase? It's just two of the six files where rebasing is needed, and with the scripts, shouldn't it be rather easy?\n\nP.S.:\n\nApply the last two patches only, the latter is just a one-liner that makes a certain doctest optional. That doctest is only of illustrative nature anyway, and depends on the optional larger Cremona ell curves database for curves of conductor between 10000 and 130000. (A curve of conductor around 15000 is involved.)",
    "created_at": "2009-02-26T05:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27917",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac4667_doctestfix.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac4667_doctestfix.patch.gz)**

As I said in my remark of #4933, this patch here definitely should be applied before any work on #4933 is done.

Could you help with the rebase? It's just two of the six files where rebasing is needed, and with the scripts, shouldn't it be rather easy?

P.S.:

Apply the last two patches only, the latter is just a one-liner that makes a certain doctest optional. That doctest is only of illustrative nature anyway, and depends on the optional larger Cremona ell curves database for curves of conductor between 10000 and 130000. (A curve of conductor around 15000 is involved.)



---

archive/issue_events_053037.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-02-26T05:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53037"
}
```



---

archive/issue_events_053038.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-02-26T05:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53038"
}
```



---

archive/issue_comments_027918.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-\n  This ticket is aimed at implementing p-adic L-function of quadratic twists of elliptic curves.\n \n Of course one could compute the modular symbols for the twist and then the p-adic L-function, but it is much faster to use the simple formula for the twisted modular symbols as a sum of \n``````\n",
    "created_at": "2009-03-01T02:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27918",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-
  This ticket is aimed at implementing p-adic L-function of quadratic twists of elliptic curves.
 
 Of course one could compute the modular symbols for the twist and then the p-adic L-function, but it is much faster to use the simple formula for the twisted modular symbols as a sum of 
``````




---

archive/issue_events_053039.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-01T02:03:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53039"
}
```



---

archive/issue_events_053040.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-01T02:03:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53040"
}
```



---

archive/issue_comments_027919.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOnce the rebase has been done the positive review can be added back.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-25T07:20:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27919",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:9" align="right">comment:9</div>

Once the rebase has been done the positive review can be added back.

Cheers,

Michael



---

archive/issue_events_053041.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2009-03-25T19:22:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "quadratic twists for p-adic L-functions",
    "title_was": "[needs rebase] quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53041"
}
```



---

archive/issue_comments_027920.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOK, it took me some work to rebase it. Of course the docstrings are not all restified, but this should be done in #4933.\n\nI attach a new patch that will replace all others before. It was exported against my sage 3.4.\n\nI added the 'positive review' back, but maybe soneone else should check the tests again, indep. of me.",
    "created_at": "2009-03-25T19:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27920",
    "user": "https://github.com/categorie"
}
```

<div id="comment:10" align="right">comment:10</div>

OK, it took me some work to rebase it. Of course the docstrings are not all restified, but this should be done in #4933.

I attach a new patch that will replace all others before. It was exported against my sage 3.4.

I added the 'positive review' back, but maybe soneone else should check the tests again, indep. of me.



---

archive/issue_comments_027921.json:
```json
{
    "body": "Attachment: **[trac_4667_z.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac_4667_z.patch.gz)**\n\nReplaces all previous patches.",
    "created_at": "2009-03-25T19:23:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27921",
    "user": "https://github.com/categorie"
}
```

Attachment: **[trac_4667_z.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac_4667_z.patch.gz)**

Replaces all previous patches.



---

archive/issue_events_053042.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-25T23:45:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53042"
}
```



---

archive/issue_events_053043.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-25T23:45:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53043"
}
```



---

archive/issue_comments_027922.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe latest patch causes doctest failures in two files:\n\n```\n\tsage -t -long devel/sage/doc/en/bordeaux_2008/elliptic_curves.rst # 2 doctests failed\n\tsage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 6 doctests failed\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-03-25T23:45:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27922",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:11" align="right">comment:11</div>

The latest patch causes doctest failures in two files:

```
	sage -t -long devel/sage/doc/en/bordeaux_2008/elliptic_curves.rst # 2 doctests failed
	sage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 6 doctests failed
```

Cheers,

Michael



---

archive/issue_comments_027923.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nMichael,\n\nbegging your pardon, but I see none of these doctest failures against vanilla Sage-3.4 on my MacIntel box. I do confirm \"positive review\" (just finished testlong and docbuild)! Let's wait for 3.4.1.alpha and see, I think the reason is that some other patch that went already in your local tree causes this. It should be sorted out easily, once the first 3.4.1.alpha release is out. :-)\n\nCheers,\ngsw",
    "created_at": "2009-03-26T00:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27923",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:12" align="right">comment:12</div>

Michael,

begging your pardon, but I see none of these doctest failures against vanilla Sage-3.4 on my MacIntel box. I do confirm "positive review" (just finished testlong and docbuild)! Let's wait for 3.4.1.alpha and see, I think the reason is that some other patch that went already in your local tree causes this. It should be sorted out easily, once the first 3.4.1.alpha release is out. :-)

Cheers,
gsw



---

archive/issue_events_053044.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-26T00:19:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53044"
}
```



---

archive/issue_events_053045.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-26T00:19:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53045"
}
```



---

archive/issue_events_053046.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-26T00:19:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "[with patch, positive review, 3.4.1.alpha doctest issues(?!)] quadratic twists for p-adic L-functions",
    "title_was": "quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53046"
}
```



---

archive/issue_comments_027924.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@sagetrac-GeorgSWeber](#comment:12):\n> Michael,\n> \n> begging your pardon, but I see none of these doctest failures against vanilla Sage-3.4 on my MacIntel box. I do confirm \"positive review\" (just finished testlong and docbuild)! Let's wait for 3.4.1.alpha and see, I think the reason is that some other patch that went already in your local tree causes this. It should be sorted out easily, once the first 3.4.1.alpha release is out. :-)\n\nThese failures happen against my merge tree, so no point in reinstating the positive review. I would also prefer if William took a look at this patch since he seemed to have written most of the original code.\n\n> Cheers,\n> gsw\n\nCheers,\n\nMichael",
    "created_at": "2009-03-26T00:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27924",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@sagetrac-GeorgSWeber](#comment:12):
> Michael,
> 
> begging your pardon, but I see none of these doctest failures against vanilla Sage-3.4 on my MacIntel box. I do confirm "positive review" (just finished testlong and docbuild)! Let's wait for 3.4.1.alpha and see, I think the reason is that some other patch that went already in your local tree causes this. It should be sorted out easily, once the first 3.4.1.alpha release is out. :-)

These failures happen against my merge tree, so no point in reinstating the positive review. I would also prefer if William took a look at this patch since he seemed to have written most of the original code.

> Cheers,
> gsw

Cheers,

Michael



---

archive/issue_events_053047.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-26T00:24:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "title_is": "quadratic twists for p-adic L-functions",
    "title_was": "[with patch, positive review, 3.4.1.alpha doctest issues(?!)] quadratic twists for p-adic L-functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53047"
}
```



---

archive/issue_events_053048.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-26T00:55:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53048"
}
```



---

archive/issue_events_053049.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-26T00:55:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53049"
}
```



---

archive/issue_comments_027925.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nUh oh.\n\nNo offense meant, I was just too excited so I started the review after midnight.\n\nAnd sorry, my fault, I re-checked my setup and it seems that somehow I had forgotten a \"sage -b\" in the course. I do see the failures against vanilla sage-3.4, and they seem to be severe:\n\n```\nFile \"/Users/georgweber/Public/sage/sage-3.4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 5164:\n    sage: [P[0] for P in EllipticCurve([0,0,0,-468,2592]).integral_points()]\nExpected:\n    [-24, -18, -14, -6, -3, 4, 6, 18, 21, 24, 36, 46, 102, 168, 186, 381, 1476, 2034, 67246]\nGot:\n    [-24, -18, -14, -6, -3, 4, 6, 18, 21, 24, 36, 46, 102, 186]\n```\nand most of the other failed doctests also point to missing integral points. There had been a patch of John (IIRC) that had healed an issue with this, and the current patch of Chris seems to miss these parts (more precisely seems to revert the code to the old buggy state).\n\nAs a by-result, this means that I definitely shouldn't try to review patches without being well-rested. Which probably means I won't be able to do reviews at all. :-((( \n\nCheers,\ngsw",
    "created_at": "2009-03-26T00:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27925",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:14" align="right">comment:14</div>

Uh oh.

No offense meant, I was just too excited so I started the review after midnight.

And sorry, my fault, I re-checked my setup and it seems that somehow I had forgotten a "sage -b" in the course. I do see the failures against vanilla sage-3.4, and they seem to be severe:

```
File "/Users/georgweber/Public/sage/sage-3.4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 5164:
    sage: [P[0] for P in EllipticCurve([0,0,0,-468,2592]).integral_points()]
Expected:
    [-24, -18, -14, -6, -3, 4, 6, 18, 21, 24, 36, 46, 102, 168, 186, 381, 1476, 2034, 67246]
Got:
    [-24, -18, -14, -6, -3, 4, 6, 18, 21, 24, 36, 46, 102, 186]
```
and most of the other failed doctests also point to missing integral points. There had been a patch of John (IIRC) that had healed an issue with this, and the current patch of Chris seems to miss these parts (more precisely seems to revert the code to the old buggy state).

As a by-result, this means that I definitely shouldn't try to review patches without being well-rested. Which probably means I won't be able to do reviews at all. :-((( 

Cheers,
gsw



---

archive/issue_comments_027926.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nUiuiui, I am sorry that was quite bad. I did not merge well ell_rational_field. \n\nI add another patch that should be applied after the previous. \nIt looks to me as if everything passes now. Except\n\n```\nFile \"/maths/staff/pmzcw/Desktop/sage/twists/elliptic_curves/ell_rational_field.py\", line 3096:\n    sage: E.cremona_label()\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Cremona label not known for Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 5 over Rational Field.\nGot:\n    '10351a1'\n```\n\nbut this is due to having installed the optional package. I still don't know if there is a way to include a test only if the optional package is NOT there. But anyway that is not in my code.",
    "created_at": "2009-03-26T15:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27926",
    "user": "https://github.com/categorie"
}
```

<div id="comment:15" align="right">comment:15</div>

Uiuiui, I am sorry that was quite bad. I did not merge well ell_rational_field. 

I add another patch that should be applied after the previous. 
It looks to me as if everything passes now. Except

```
File "/maths/staff/pmzcw/Desktop/sage/twists/elliptic_curves/ell_rational_field.py", line 3096:
    sage: E.cremona_label()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Cremona label not known for Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 5 over Rational Field.
Got:
    '10351a1'
```

but this is due to having installed the optional package. I still don't know if there is a way to include a test only if the optional package is NOT there. But anyway that is not in my code.



---

archive/issue_comments_027927.json:
```json
{
    "body": "Attachment: **[trac_4667_z2.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac_4667_z2.patch.gz)**\n\napply after the previous patch",
    "created_at": "2009-03-26T15:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27927",
    "user": "https://github.com/categorie"
}
```

Attachment: **[trac_4667_z2.patch.gz](https://github.com/sagemath/sage/files/ticket4667/trac_4667_z2.patch.gz)**

apply after the previous patch



---

archive/issue_comments_027928.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI just found out that my issue with the optional package has actually a trac ticket : #5346 .",
    "created_at": "2009-03-26T15:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27928",
    "user": "https://github.com/categorie"
}
```

<div id="comment:16" align="right">comment:16</div>

I just found out that my issue with the optional package has actually a trac ticket : #5346 .



---

archive/issue_comments_027929.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOk, changed the summary to have the ticket picked up by the right reports again. I would also be happy if John and/or William looked at this code since it seems to touch code they have written.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-26T20:40:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27929",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:17" align="right">comment:17</div>

Ok, changed the summary to have the ticket picked up by the right reports again. I would also be happy if John and/or William looked at this code since it seems to touch code they have written.

Cheers,

Michael



---

archive/issue_events_053050.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-26T20:40:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53050"
}
```



---

archive/issue_events_053051.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-26T20:40:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53051"
}
```



---

archive/issue_comments_027930.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThere are two aspects to be considered with a patch of this kind:\n\n- The technical one (is the code correctly merged into the system, or are regressions introduced?). In this area of Sage I would trust the doctests, especially John has added valuable ones that should cover enough cases so regressions are caught. As was exactly the case, BTW! A reviewer has to have an eye on the new code in this regard, too --- would the new doctests show regressions possibly introduced later? (Let's say some erronuous future patch to the core code of the p-adic numbers?) I did covince myself of that two months ago, but would like to look into it again now. And alas, I seem to desparately need the oncoming two weeks Easter vacation (where I will have no Internet access at all).\n\n- The theoretical one (do the mathematics make sense, are the normalizations reasonable, and such?) In this regard, the patch of Chris is an absolute win for Sage. The original p-adic L-series code of William was OK, and it was good to have that code in Sage at all. But the reworkings of Chris are certainly enhancements heading in the right direction --- William?\n\nI certainly want to make Michael's (the integrator's) life easier, not harder. And from the experience yesterday I don't trust myself right now (it's again only 10 minutes before midnight). So either the review has to wait for, say, another month or so, or a new reviewer steps in. William, John?",
    "created_at": "2009-03-26T22:57:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27930",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:18" align="right">comment:18</div>

There are two aspects to be considered with a patch of this kind:

- The technical one (is the code correctly merged into the system, or are regressions introduced?). In this area of Sage I would trust the doctests, especially John has added valuable ones that should cover enough cases so regressions are caught. As was exactly the case, BTW! A reviewer has to have an eye on the new code in this regard, too --- would the new doctests show regressions possibly introduced later? (Let's say some erronuous future patch to the core code of the p-adic numbers?) I did covince myself of that two months ago, but would like to look into it again now. And alas, I seem to desparately need the oncoming two weeks Easter vacation (where I will have no Internet access at all).

- The theoretical one (do the mathematics make sense, are the normalizations reasonable, and such?) In this regard, the patch of Chris is an absolute win for Sage. The original p-adic L-series code of William was OK, and it was good to have that code in Sage at all. But the reworkings of Chris are certainly enhancements heading in the right direction --- William?

I certainly want to make Michael's (the integrator's) life easier, not harder. And from the experience yesterday I don't trust myself right now (it's again only 10 minutes before midnight). So either the review has to wait for, say, another month or so, or a new reviewer steps in. William, John?



---

archive/issue_comments_027931.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nConcerning the issue with the optional database: I have added a comment to trac #5346 with an idea how to address it --- this idea applies verbatim here. Chris, you certainly are able to provide a concrete example of a (twist of a) curve such that the resulting conductor is larger than 130000, in less than a minute? \n\nCheers, gsw",
    "created_at": "2009-03-26T23:10:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27931",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:19" align="right">comment:19</div>

Concerning the issue with the optional database: I have added a comment to trac #5346 with an idea how to address it --- this idea applies verbatim here. Chris, you certainly are able to provide a concrete example of a (twist of a) curve such that the resulting conductor is larger than 130000, in less than a minute? 

Cheers, gsw



---

archive/issue_comments_027932.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHi Georg,\n\nwell, all I am saying is that someone ought to take a second look that nothing got broken that used to work before and that we do not notice because the doctest was \"corrected\". I am not claiming that this is the case, but I want to be 100% on this. I personally have no clue about padic l-functions and do not know who the experts are in the field, so I wanted to err on the side of caution by pinging John and William. I did mention this patch to William while he was sitting next to me yesterday and hopefully he will have time to look at this during the weekend - most likely sunday, but we will see what happens. It would be very nice to get this into 3.4.1 :)\n\nI will certainly doctest the two current patches and give feedback.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-26T23:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27932",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:20" align="right">comment:20</div>

Hi Georg,

well, all I am saying is that someone ought to take a second look that nothing got broken that used to work before and that we do not notice because the doctest was "corrected". I am not claiming that this is the case, but I want to be 100% on this. I personally have no clue about padic l-functions and do not know who the experts are in the field, so I wanted to err on the side of caution by pinging John and William. I did mention this patch to William while he was sitting next to me yesterday and hopefully he will have time to look at this during the weekend - most likely sunday, but we will see what happens. It would be very nice to get this into 3.4.1 :)

I will certainly doctest the two current patches and give feedback.

Cheers,

Michael



---

archive/issue_comments_027933.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nFYI: if I apply trac_4667_z.patch and trac_4667_z2.patch to my 3.4.1.alpha0 merge tree all tests pass.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-26T23:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27933",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:21" align="right">comment:21</div>

FYI: if I apply trac_4667_z.patch and trac_4667_z2.patch to my 3.4.1.alpha0 merge tree all tests pass.

Cheers,

Michael



---

archive/issue_events_053052.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-31T18:11:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53052"
}
```



---

archive/issue_events_053053.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-31T18:11:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53053"
}
```



---

archive/issue_comments_027934.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nCan't help it, this code does look good to me.\n\nTested against Sage-3.4.1.alpha0.",
    "created_at": "2009-03-31T18:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27934",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:22" align="right">comment:22</div>

Can't help it, this code does look good to me.

Tested against Sage-3.4.1.alpha0.



---

archive/issue_events_053054.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-31T18:11:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53054"
}
```



---

archive/issue_events_053055.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2009-03-31T18:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53055"
}
```



---

archive/issue_comments_027935.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMerged  trac_4667_z.patch and trac_4667_z2.patch in Sage 3.4.1.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-31T21:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4667#issuecomment-27935",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:23" align="right">comment:23</div>

Merged  trac_4667_z.patch and trac_4667_z2.patch in Sage 3.4.1.rc0.

Cheers,

Michael



---

archive/issue_events_053056.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-31T21:29:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53056"
}
```



---

archive/issue_events_053057.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-03-31T21:29:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4667",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4667#event-53057"
}
```
