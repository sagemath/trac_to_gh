# Issue 4990: [with positive review] Add code to compute Hilbert class polynomials

archive/issues_004990.json:
```json
{
    "body": "The attached Sage code has been written by\n\n* Eduardo Ocampo Alvarez\n* Andrey Timofeev\n\nfrom the University of Essen in Germany. It needs some integration, but other than that it should be ready to be merged.\n\nCheers,\n\nMichael\n\n**Assignee:** @aghitza\n\n**Keywords:** hilbert class polynomial\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4990\n\n",
    "closed_at": "2009-04-05T23:16:17Z",
    "created_at": "2009-01-17T08:47:24Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.4.1",
    "title": "[with positive review] Add code to compute Hilbert class polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4990",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```
The attached Sage code has been written by

* Eduardo Ocampo Alvarez
* Andrey Timofeev

from the University of Essen in Germany. It needs some integration, but other than that it should be ready to be merged.

Cheers,

Michael

**Assignee:** @aghitza

**Keywords:** hilbert class polynomial

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/4990





---

archive/issue_comments_045101.json:
```json
{
    "body": "This is the third verion of the code",
    "created_at": "2009-01-17T08:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45101",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

This is the third verion of the code



---

archive/attachments_005612.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "hcp3.sage.txt",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4990/hcp3.sage.txt",
    "created_at": "2009-01-17T22:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.txt",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_045102.json:
```json
{
    "body": "<a id='comment:1'></a>\nOne thing that needs to be done is to convert everything to four spaces.",
    "created_at": "2009-01-17T22:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45102",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>
One thing that needs to be done is to convert everything to four spaces.



---

archive/issue_events_015011.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "rename": {
        "from": "[with code] Add code to compute Hilber class polynomials",
        "to": "[with code] Add code to compute Hilbert class polynomials"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4990#event-15011"
}
```



---

archive/issue_comments_045103.json:
```json
{
    "body": "**Changing status** from needs_work to needs_work.",
    "created_at": "2009-04-03T10:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45103",
    "user": "https://github.com/aghitza"
}
```

**Changing status** from needs_work to needs_work.



---

archive/issue_comments_045104.json:
```json
{
    "body": "**Changing assignee** from @williamstein to @aghitza.",
    "created_at": "2009-04-03T10:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45104",
    "user": "https://github.com/aghitza"
}
```

**Changing assignee** from @williamstein to @aghitza.



---

archive/issue_comments_045105.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"hilbert class polynomial\".",
    "created_at": "2009-04-03T10:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45105",
    "user": "https://github.com/aghitza"
}
```

**Changing keywords** from "" to "hilbert class polynomial".



---

archive/issue_comments_045106.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2009-04-03T10:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45106",
    "user": "https://github.com/aghitza"
}
```

**Changing status** from new to assigned.



---

archive/attachments_005613.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4990.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4990/trac_4990.patch",
    "created_at": "2009-04-04T07:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/aghitza"
}
```



---

archive/issue_comments_045107.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe attached patch adds the method `hilbert_class_polynomial()` to `NumberField_quadratic` and cleans the code up a little bit.\n\nI cannot perform comparative timings since I don't have access to Magma at the moment.  Doing `%prun` with large discriminants indicates that the large majority of the time is spent in the Pari library computing the j-invariants of the representative tau's.  So I don't think rewriting the method in Cython will have a significant effect.\n\nSee also the discussion at\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/6c9aedf63106cc2d",
    "created_at": "2009-04-04T07:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45107",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:5'></a>
The attached patch adds the method `hilbert_class_polynomial()` to `NumberField_quadratic` and cleans the code up a little bit.

I cannot perform comparative timings since I don't have access to Magma at the moment.  Doing `%prun` with large discriminants indicates that the large majority of the time is spent in the Pari library computing the j-invariants of the representative tau's.  So I don't think rewriting the method in Cython will have a significant effect.

See also the discussion at

http://groups.google.com/group/sage-devel/browse_thread/thread/6c9aedf63106cc2d



---

archive/issue_events_015012.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-04T07:18:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4990#event-15012"
}
```



---

archive/issue_events_015013.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "rename": {
        "from": "[with code] Add code to compute Hilbert class polynomials",
        "to": "Add code to compute Hilbert class polynomials"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4990#event-15013"
}
```



---

archive/issue_comments_045108.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-04T07:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45108",
    "user": "https://github.com/aghitza"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_045109.json:
```json
{
    "body": "<a id='comment:6'></a>\nAlex, is your patch to be applied by itself, ignoring  the .txt file which it seems to be based on?  I assume so.  Is this intended to work on 3.4.1(.alpha0, say)?\n\nJohn",
    "created_at": "2009-04-04T15:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45109",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Alex, is your patch to be applied by itself, ignoring  the .txt file which it seems to be based on?  I assume so.  Is this intended to work on 3.4.1(.alpha0, say)?

John



---

archive/issue_comments_045110.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes: apply only the patch, to 3.4.1.alpha0.",
    "created_at": "2009-04-04T21:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45110",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:7'></a>
Yes: apply only the patch, to 3.4.1.alpha0.



---

archive/issue_events_015014.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "rename": {
        "from": "Add code to compute Hilbert class polynomials",
        "to": "[with positive review] Add code to compute Hilbert class polynomials"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4990#event-15014"
}
```



---

archive/issue_comments_045111.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooks good to me.  I tested it with the following script, and found a lot of curves with the correct endomorphism rings :)\n\n```\nK.<a> = QuadraticField(-34)\nf = K.hilbert_class_polynomial()\nassert K.class_number() == f.degree()\n\nfor P in K.primes_of_degree_one_list(20):\n    p = P.norm()\n    k = GF(p)\n    rts = f.roots(k, multiplicities=False)\n    for jj in rts:\n        assert P.is_principal()\n        E = EllipticCurve(jj)\n        print E\n        assert E.frobenius_order().number_field().is_isomorphic(K)\n    if not rts:\n        print \"XXX\", p\n        assert not P.is_principal()\n```",
    "created_at": "2009-04-05T03:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45111",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:8'></a>
Looks good to me.  I tested it with the following script, and found a lot of curves with the correct endomorphism rings :)

```
K.<a> = QuadraticField(-34)
f = K.hilbert_class_polynomial()
assert K.class_number() == f.degree()

for P in K.primes_of_degree_one_list(20):
    p = P.norm()
    k = GF(p)
    rts = f.roots(k, multiplicities=False)
    for jj in rts:
        assert P.is_principal()
        E = EllipticCurve(jj)
        print E
        assert E.frobenius_order().number_field().is_isomorphic(K)
    if not rts:
        print "XXX", p
        assert not P.is_principal()
```



---

archive/issue_comments_045112.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-04-05T23:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45112",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_045113.json:
```json
{
    "body": "<a id='comment:9'></a>\nMerged in Sage 3.4.1.rc1.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-05T23:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45113",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
Merged in Sage 3.4.1.rc1.

Cheers,

Michael



---

archive/issue_events_015015.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-05T23:16:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4990#event-15015"
}
```



---

archive/issue_comments_045114.json:
```json
{
    "body": "<a id='comment:10'></a>\nPosted to sage-nt 2009-04-20:\n\nTicket #4990 implemented a hilbert_class_polynomial() method for\nimaginary quadratic fields.  It is actually a function of the field's\ndiscriminant, i.e. of a fundamental (negative) discriminant.  It was\nwritten by      Eduardo Ocampo Alvarez and  Andrey Timofeev  from\nEssen and is in sage/rings/number_field/number_field.py.\n\nWe also have a function in sage/schemes/elliptic_curves/cm.py called\nhilbert_class_polynomial(D), which uses Magma to find more general\nH.C.polys (D is any negative integer congruent to 0,1 mod 4).\n\nFor fundamental discriminants D, these give the same answer, i.e.\nQuadraticField(D,'a').hilbert_class_polynomial() ==\nhilbert_class_polynomial(D).\n\nQuestion 1: does the code at #4990 (now merged actually work for\nnon-fundamental discriminants?  Someone might know;  testing it would\nneed a bit of coding, and I haven't done so.\n\nAssuming that the answer is \"yes\",\n\nQuestion 2: should we re-write the stand-alone function which takes as\nits argument any negative discriminant (not necessarily fundamental)\nand returns the appropriate H.C.poly, using the code now in\nnumber_field.py instead of calling Magma;  and then change the current\nmethod in number_field.py to just call that?  If so, where should the\nstand-alone function go:  (a) where it now is, in\nsage/schemes/elliptic_curves/cm.py, (b) in\nsage/rings/number_field/somewhere, (c) somewhere else ?  We could then\nalso make the H.C.poly a function of (possibly non-maximal) orders in\n(imaginary quadratic) number fields.\n\nJohn\n\nPS I found this out while converting cm.py to ReST for inclusion in\nthe manual.  Isn't it amazing what you find!",
    "created_at": "2009-04-20T12:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4990#issuecomment-45114",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
Posted to sage-nt 2009-04-20:

Ticket #4990 implemented a hilbert_class_polynomial() method for
imaginary quadratic fields.  It is actually a function of the field's
discriminant, i.e. of a fundamental (negative) discriminant.  It was
written by      Eduardo Ocampo Alvarez and  Andrey Timofeev  from
Essen and is in sage/rings/number_field/number_field.py.

We also have a function in sage/schemes/elliptic_curves/cm.py called
hilbert_class_polynomial(D), which uses Magma to find more general
H.C.polys (D is any negative integer congruent to 0,1 mod 4).

For fundamental discriminants D, these give the same answer, i.e.
QuadraticField(D,'a').hilbert_class_polynomial() ==
hilbert_class_polynomial(D).

Question 1: does the code at #4990 (now merged actually work for
non-fundamental discriminants?  Someone might know;  testing it would
need a bit of coding, and I haven't done so.

Assuming that the answer is "yes",

Question 2: should we re-write the stand-alone function which takes as
its argument any negative discriminant (not necessarily fundamental)
and returns the appropriate H.C.poly, using the code now in
number_field.py instead of calling Magma;  and then change the current
method in number_field.py to just call that?  If so, where should the
stand-alone function go:  (a) where it now is, in
sage/schemes/elliptic_curves/cm.py, (b) in
sage/rings/number_field/somewhere, (c) somewhere else ?  We could then
also make the H.C.poly a function of (possibly non-maximal) orders in
(imaginary quadratic) number fields.

John

PS I found this out while converting cm.py to ReST for inclusion in
the manual.  Isn't it amazing what you find!
