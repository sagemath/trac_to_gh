# Issue 4990: Add code to compute Hilbert class polynomials

archive/issues_004990.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "The attached Sage code has been written by\n\n* Eduardo Ocampo Alvarez\n* Andrey Timofeev\n\nfrom the University of Essen in Germany. It needs some integration, but other than that it should be ready to be merged.\n\nCheers,\n\nMichael\n\nComponent: **number theory**\n\nKeywords: **hilbert class polynomial**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4990_\n\n",
    "closed_at": "2009-04-05T23:16:17Z",
    "created_at": "2009-01-17T08:47:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add code to compute Hilbert class polynomials",
    "type": "issue",
    "updated_at": "2009-04-20T12:44:33Z",
    "url": "https://github.com/sagemath/sage/issues/4990",
    "user": "https://github.com/sagetrac-mabshoff"
}
```
The attached Sage code has been written by

* Eduardo Ocampo Alvarez
* Andrey Timofeev

from the University of Essen in Germany. It needs some integration, but other than that it should be ready to be merged.

Cheers,

Michael

Component: **number theory**

Keywords: **hilbert class polynomial**

_Issue created by migration from https://trac.sagemath.org/ticket/4990_





---

archive/issue_events_057448.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57448"
}
```



---

archive/issue_events_057449.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57449"
}
```



---

archive/issue_events_057450.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57450"
}
```



---

archive/issue_events_057451.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57451"
}
```



---

archive/issue_events_057452.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57452"
}
```



---

archive/issue_events_057453.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-17T08:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57453"
}
```



---

archive/issue_comments_030380.json:
```json
{
    "body": "This is the third verion of the code",
    "created_at": "2009-01-17T08:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30380",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

This is the third verion of the code



---

archive/issue_comments_030381.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[hcp3.sage.txt](https://github.com/sagemath/sage/files/ticket4990/hcp3.sage.txt)**\n\nOne thing that needs to be done is to convert everything to four spaces.",
    "created_at": "2009-01-17T22:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30381",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[hcp3.sage.txt](https://github.com/sagemath/sage/files/ticket4990/hcp3.sage.txt)**

One thing that needs to be done is to convert everything to four spaces.



---

archive/issue_events_057454.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:07:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57454"
}
```



---

archive/issue_events_057455.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:07:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57455"
}
```



---

archive/issue_events_057456.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-03T10:11:13Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "title_is": "[with code] Add code to compute Hilbert class polynomials",
    "title_was": "[with code] Add code to compute Hilber class polynomials",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57456"
}
```



---

archive/issue_events_057457.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-03T10:11:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57457"
}
```



---

archive/issue_events_057458.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-03T10:13:16Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "subject": "https://github.com/aghitza",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57458"
}
```



---

archive/issue_events_057459.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-03T10:13:16Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "subject": "https://github.com/aghitza",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57459"
}
```



---

archive/issue_comments_030382.json:
```json
{
    "body": "Changed keywords from none to **hilbert class polynomial**",
    "created_at": "2009-04-03T10:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30382",
    "user": "https://github.com/aghitza"
}
```

Changed keywords from none to **hilbert class polynomial**



---

archive/issue_events_057460.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-03T10:13:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57460"
}
```



---

archive/issue_comments_030383.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_4990.patch.gz](https://github.com/sagemath/sage/files/ticket4990/trac_4990.patch.gz)**\n\nThe attached patch adds the method `hilbert_class_polynomial()` to `NumberField_quadratic` and cleans the code up a little bit.\n\nI cannot perform comparative timings since I don't have access to Magma at the moment.  Doing `%prun` with large discriminants indicates that the large majority of the time is spent in the Pari library computing the j-invariants of the representative tau's.  So I don't think rewriting the method in Cython will have a significant effect.\n\nSee also the discussion at\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/6c9aedf63106cc2d",
    "created_at": "2009-04-04T07:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30383",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_4990.patch.gz](https://github.com/sagemath/sage/files/ticket4990/trac_4990.patch.gz)**

The attached patch adds the method `hilbert_class_polynomial()` to `NumberField_quadratic` and cleans the code up a little bit.

I cannot perform comparative timings since I don't have access to Magma at the moment.  Doing `%prun` with large discriminants indicates that the large majority of the time is spent in the Pari library computing the j-invariants of the representative tau's.  So I don't think rewriting the method in Cython will have a significant effect.

See also the discussion at

http://groups.google.com/group/sage-devel/browse_thread/thread/6c9aedf63106cc2d



---

archive/issue_events_057461.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-04T07:18:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57461"
}
```



---

archive/issue_events_057462.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-04T07:18:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57462"
}
```



---

archive/issue_events_057463.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-04T07:18:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "title_is": "Add code to compute Hilbert class polynomials",
    "title_was": "[with code] Add code to compute Hilbert class polynomials",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57463"
}
```



---

archive/issue_events_057464.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-04-04T07:18:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57464"
}
```



---

archive/issue_comments_030384.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlex, is your patch to be applied by itself, ignoring  the .txt file which it seems to be based on?  I assume so.  Is this intended to work on 3.4.1(.alpha0, say)?\n\nJohn",
    "created_at": "2009-04-04T15:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30384",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:6" align="right">comment:6</div>

Alex, is your patch to be applied by itself, ignoring  the .txt file which it seems to be based on?  I assume so.  Is this intended to work on 3.4.1(.alpha0, say)?

John



---

archive/issue_comments_030385.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYes: apply only the patch, to 3.4.1.alpha0.",
    "created_at": "2009-04-04T21:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30385",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:7" align="right">comment:7</div>

Yes: apply only the patch, to 3.4.1.alpha0.



---

archive/issue_events_057465.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-04-05T03:50:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57465"
}
```



---

archive/issue_events_057466.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-04-05T03:50:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57466"
}
```



---

archive/issue_comments_030386.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLooks good to me.  I tested it with the following script, and found a lot of curves with the correct endomorphism rings :)\n\n```\nK.<a> = QuadraticField(-34)\nf = K.hilbert_class_polynomial()\nassert K.class_number() == f.degree()\n\nfor P in K.primes_of_degree_one_list(20):\n    p = P.norm()\n    k = GF(p)\n    rts = f.roots(k, multiplicities=False)\n    for jj in rts:\n        assert P.is_principal()\n        E = EllipticCurve(jj)\n        print E\n        assert E.frobenius_order().number_field().is_isomorphic(K)\n    if not rts:\n        print \"XXX\", p\n        assert not P.is_principal()\n```",
    "created_at": "2009-04-05T03:50:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30386",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:8" align="right">comment:8</div>

Looks good to me.  I tested it with the following script, and found a lot of curves with the correct endomorphism rings :)

```
K.<a> = QuadraticField(-34)
f = K.hilbert_class_polynomial()
assert K.class_number() == f.degree()

for P in K.primes_of_degree_one_list(20):
    p = P.norm()
    k = GF(p)
    rts = f.roots(k, multiplicities=False)
    for jj in rts:
        assert P.is_principal()
        E = EllipticCurve(jj)
        print E
        assert E.frobenius_order().number_field().is_isomorphic(K)
    if not rts:
        print "XXX", p
        assert not P.is_principal()
```



---

archive/issue_comments_030387.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nMerged in Sage 3.4.1.rc1.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-05T23:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30387",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:9" align="right">comment:9</div>

Merged in Sage 3.4.1.rc1.

Cheers,

Michael



---

archive/issue_events_057467.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-04-05T23:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57467"
}
```



---

archive/issue_events_057468.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-04-05T23:16:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4990#event-57468"
}
```



---

archive/issue_comments_030388.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nPosted to sage-nt 2009-04-20:\n\nTicket #4990 implemented a hilbert_class_polynomial() method for\nimaginary quadratic fields.  It is actually a function of the field's\ndiscriminant, i.e. of a fundamental (negative) discriminant.  It was\nwritten by      Eduardo Ocampo Alvarez and  Andrey Timofeev  from\nEssen and is in sage/rings/number_field/number_field.py.\n\nWe also have a function in sage/schemes/elliptic_curves/cm.py called\nhilbert_class_polynomial(D), which uses Magma to find more general\nH.C.polys (D is any negative integer congruent to 0,1 mod 4).\n\nFor fundamental discriminants D, these give the same answer, i.e.\nQuadraticField(D,'a').hilbert_class_polynomial() ==\nhilbert_class_polynomial(D).\n\nQuestion 1: does the code at #4990 (now merged actually work for\nnon-fundamental discriminants?  Someone might know;  testing it would\nneed a bit of coding, and I haven't done so.\n\nAssuming that the answer is \"yes\",\n\nQuestion 2: should we re-write the stand-alone function which takes as\nits argument any negative discriminant (not necessarily fundamental)\nand returns the appropriate H.C.poly, using the code now in\nnumber_field.py instead of calling Magma;  and then change the current\nmethod in number_field.py to just call that?  If so, where should the\nstand-alone function go:  (a) where it now is, in\nsage/schemes/elliptic_curves/cm.py, (b) in\nsage/rings/number_field/somewhere, (c) somewhere else ?  We could then\nalso make the H.C.poly a function of (possibly non-maximal) orders in\n(imaginary quadratic) number fields.\n\nJohn\n\nPS I found this out while converting cm.py to ReST for inclusion in\nthe manual.  Isn't it amazing what you find!",
    "created_at": "2009-04-20T12:44:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4990#issuecomment-30388",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:10" align="right">comment:10</div>

Posted to sage-nt 2009-04-20:

Ticket #4990 implemented a hilbert_class_polynomial() method for
imaginary quadratic fields.  It is actually a function of the field's
discriminant, i.e. of a fundamental (negative) discriminant.  It was
written by      Eduardo Ocampo Alvarez and  Andrey Timofeev  from
Essen and is in sage/rings/number_field/number_field.py.

We also have a function in sage/schemes/elliptic_curves/cm.py called
hilbert_class_polynomial(D), which uses Magma to find more general
H.C.polys (D is any negative integer congruent to 0,1 mod 4).

For fundamental discriminants D, these give the same answer, i.e.
QuadraticField(D,'a').hilbert_class_polynomial() ==
hilbert_class_polynomial(D).

Question 1: does the code at #4990 (now merged actually work for
non-fundamental discriminants?  Someone might know;  testing it would
need a bit of coding, and I haven't done so.

Assuming that the answer is "yes",

Question 2: should we re-write the stand-alone function which takes as
its argument any negative discriminant (not necessarily fundamental)
and returns the appropriate H.C.poly, using the code now in
number_field.py instead of calling Magma;  and then change the current
method in number_field.py to just call that?  If so, where should the
stand-alone function go:  (a) where it now is, in
sage/schemes/elliptic_curves/cm.py, (b) in
sage/rings/number_field/somewhere, (c) somewhere else ?  We could then
also make the H.C.poly a function of (possibly non-maximal) orders in
(imaginary quadratic) number fields.

John

PS I found this out while converting cm.py to ReST for inclusion in
the manual.  Isn't it amazing what you find!
