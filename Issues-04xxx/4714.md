# Issue 4714: use easy/load.js when loading jsmath in the notebook

archive/issues_004714.json:
```json
{
    "body": "The patch\n\n* [attachment:trac_4714-sagenb_jsmath_init_v3.patch]\n\nconsolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.\n\n**Assignee:** boothby\n\n**CC:**  @jhpalmieri @TimDumol @williamstein\n\n**Resolution:** fixed\n\n**Author:** Mitesh Patel\n\n**Reviewer:** William Stein\n\n**Merged:** sagenb-0.4.6\n\nIssue created by migration from https://trac.sagemath.org/ticket/4714\n\n",
    "closed_at": "2009-12-09T01:12:41Z",
    "created_at": "2008-12-05T10:10:42Z",
    "labels": [
        "component: notebook",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3",
    "title": "use easy/load.js when loading jsmath in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4714",
    "user": "https://github.com/jasongrout"
}
```
The patch

* [attachment:trac_4714-sagenb_jsmath_init_v3.patch]

consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.

**Assignee:** boothby

**CC:**  @jhpalmieri @TimDumol @williamstein

**Resolution:** fixed

**Author:** Mitesh Patel

**Reviewer:** William Stein

**Merged:** sagenb-0.4.6

Issue created by migration from https://trac.sagemath.org/ticket/4714





---

archive/issue_comments_041924.json:
```json
{
    "body": "<a id='comment:1'></a>\nCopied from [comment:ticket:5653:27 jason]:\n> Replying to [comment:ticket:5653:24 mpatel]:\n> \n> > A related issue:  It would be nice to have just one `<script>` element load jsMath with all of Sage's customizations (extensions, plug-ins, macros, etc.) into regular, published, printed, and docbrowser worksheets, as well as \"torn out\" introspection windows and offline documentation.  Maybe `easy/load.js` is the right place (see #4714),\n> > but I think notebook.py generates the macro list on-the-fly.\n\n> \n> Davide (author of jsmath) sent these comments about the above paragraph:\n> \n> Mpatel is right that jsMath/easy/load.js could be used for this.  Rather than putting calls to jsMath.Setup.Script() or jsMath.Extention.Require() in-line in the document itself, these can be be put in the loadFiles array in easy/load.js.  It is also possible to put the jsMath.Macro() calls into a file (say jsMath/local/sage.js), and add that file to the loadFiles array as well rather than put them in-line.  Any sage-specific customization could go in local/sage.js as well.  In the latest version of jsMath, there is even a macros array in easy/load.js for custom macros, so you would not even need an extra file for that.  These features are, in fact, one of the important reasons for easy/load.js, so I hope you are able to take advantage of them.\n",
    "created_at": "2009-05-07T00:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41924",
    "user": "https://github.com/qed777"
}
```

<a id='comment:1'></a>
Copied from [comment:ticket:5653:27 jason]:
> Replying to [comment:ticket:5653:24 mpatel]:
> 
> > A related issue:  It would be nice to have just one `<script>` element load jsMath with all of Sage's customizations (extensions, plug-ins, macros, etc.) into regular, published, printed, and docbrowser worksheets, as well as "torn out" introspection windows and offline documentation.  Maybe `easy/load.js` is the right place (see #4714),
> > but I think notebook.py generates the macro list on-the-fly.

> 
> Davide (author of jsmath) sent these comments about the above paragraph:
> 
> Mpatel is right that jsMath/easy/load.js could be used for this.  Rather than putting calls to jsMath.Setup.Script() or jsMath.Extention.Require() in-line in the document itself, these can be be put in the loadFiles array in easy/load.js.  It is also possible to put the jsMath.Macro() calls into a file (say jsMath/local/sage.js), and add that file to the loadFiles array as well rather than put them in-line.  Any sage-specific customization could go in local/sage.js as well.  In the latest version of jsMath, there is even a macros array in easy/load.js for custom macros, so you would not even need an extra file for that.  These features are, in fact, one of the important reasons for easy/load.js, so I hope you are able to take advantage of them.




---

archive/issue_comments_041925.json:
```json
{
    "body": "<a id='comment:3'></a>\nA few *estions:\n\n* Should we patch the spkg's `jsmath/easy/load.js`?\n* Add `jsmath/local/sage.js` to its `loadFiles` array?\n* Re-generate this `sage.js` from the list in `sage/misc/latex_macros.py` during\n  1. `sage -docbuild`, in `doc/common/conf.py`?  \n  2. `sage -b`?\n  3. notebook startup?",
    "created_at": "2009-06-18T07:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41925",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>
A few *estions:

* Should we patch the spkg's `jsmath/easy/load.js`?
* Add `jsmath/local/sage.js` to its `loadFiles` array?
* Re-generate this `sage.js` from the list in `sage/misc/latex_macros.py` during
  1. `sage -docbuild`, in `doc/common/conf.py`?  
  2. `sage -b`?
  3. notebook startup?



---

archive/issue_comments_041926.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis is misfiled (should be under \"documentation\").",
    "created_at": "2009-07-13T16:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41926",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:4'></a>
This is misfiled (should be under "documentation").



---

archive/issue_events_014029.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "label": "component: notebook",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14029"
}
```



---

archive/issue_events_014030.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14030"
}
```



---

archive/issue_comments_041927.json:
```json
{
    "body": "**Remove assignee** boothby.",
    "created_at": "2009-07-13T16:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41927",
    "user": "https://github.com/loefflerd"
}
```

**Remove assignee** boothby.



---

archive/issue_comments_041928.json:
```json
{
    "body": "<a id='comment:5'></a>\nAfter #5799, we have two copies of the `jsmath` tree, one in `doc/common/static` and another in `javascript_local`.  That is, one from `sage-4.1.spkg` and another from `jsmath-3.6b.p1.spkg`.  Can we avoid this?  Or should we maintain separate `load.js` files for the notebook and documentation?",
    "created_at": "2009-07-17T10:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41928",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>
After #5799, we have two copies of the `jsmath` tree, one in `doc/common/static` and another in `javascript_local`.  That is, one from `sage-4.1.spkg` and another from `jsmath-3.6b.p1.spkg`.  Can we avoid this?  Or should we maintain separate `load.js` files for the notebook and documentation?



---

archive/issue_comments_041929.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mpatel](#comment%3A5):\n> After #5799, we have two copies of the `jsmath` tree, one in `doc/common/static` and another in `javascript_local`.  That is, one from `sage-4.1.spkg` and another from `jsmath-3.6b.p1.spkg`.  Can we avoid this?  Or should we maintain separate `load.js` files for the notebook and documentation?\n\nSee #6614 for a potential resolution.",
    "created_at": "2009-08-02T21:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41929",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>
Replying to [mpatel](#comment%3A5):
> After #5799, we have two copies of the `jsmath` tree, one in `doc/common/static` and another in `javascript_local`.  That is, one from `sage-4.1.spkg` and another from `jsmath-3.6b.p1.spkg`.  Can we avoid this?  Or should we maintain separate `load.js` files for the notebook and documentation?

See #6614 for a potential resolution.



---

archive/issue_comments_041930.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe latest patch at #6614 tells Sphinx to copy jsMath directly from `javascript_local` to `doc/output/html/en/*/_static`.  In particular, it does this *before* it copies the files in `doc/common/static`.  How about putting a custom `easy/load.js` there?\n\nIf we're not adding new doc macros frequently, we could just paste them from `latex_macros.py`.  Or we might add an option to `sage -docbuild` to regenerate `load.js` on demand (cf. #6187).  If we overwrite the file during *every* build, we may need to synchronize access from multiple Sphinx processes (cf. #6255).\n\n(Note: Sphinx 0.6.2 supports HTML themes, including [static templates](http://sphinx.pocoo.org/theming.html#static-templates).  It's tempting to create a template `static/easy/load.js_t`.  However, Sphinx does not process user templates in `static`'s *subdirectories*.)\n\nOn the notebook:  I believe we can move nearly all jsMath directives from `notebook.py` to a custom `javascript_local/jsmath/easy/load.js` that's overwritten on notebook start-up.  Perhaps in `twist.py`?\n\nI'd really like to get moving on this, provided there's agreement.  Of course, we can split this into two tickets, [at least] one each for the docs and notebook.  Thoughts?",
    "created_at": "2009-08-02T22:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41930",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
The latest patch at #6614 tells Sphinx to copy jsMath directly from `javascript_local` to `doc/output/html/en/*/_static`.  In particular, it does this *before* it copies the files in `doc/common/static`.  How about putting a custom `easy/load.js` there?

If we're not adding new doc macros frequently, we could just paste them from `latex_macros.py`.  Or we might add an option to `sage -docbuild` to regenerate `load.js` on demand (cf. #6187).  If we overwrite the file during *every* build, we may need to synchronize access from multiple Sphinx processes (cf. #6255).

(Note: Sphinx 0.6.2 supports HTML themes, including [static templates](http://sphinx.pocoo.org/theming.html#static-templates).  It's tempting to create a template `static/easy/load.js_t`.  However, Sphinx does not process user templates in `static`'s *subdirectories*.)

On the notebook:  I believe we can move nearly all jsMath directives from `notebook.py` to a custom `javascript_local/jsmath/easy/load.js` that's overwritten on notebook start-up.  Perhaps in `twist.py`?

I'd really like to get moving on this, provided there's agreement.  Of course, we can split this into two tickets, [at least] one each for the docs and notebook.  Thoughts?



---

archive/issue_comments_041931.json:
```json
{
    "body": "Minimal approach for docs.  Depends on #6614.",
    "created_at": "2009-08-04T04:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41931",
    "user": "https://github.com/qed777"
}
```

Minimal approach for docs.  Depends on #6614.



---

archive/issue_comments_041932.json:
```json
{
    "body": "<a id='comment:8'></a>\nAttachment [trac_4714-minimal_doc.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-minimal_doc.patch) by @qed777 created at 2009-08-04 04:41:59\n\nThis [attachment:trac_4714-minimal_doc.patch p(r)oof of concept], which depends on a [attachment:ticket:6614:trac_6614-jsmath_repo_v2.patch patch] at #6614,\n\n* Adds `doc/common/static/jsmath_sage.js`.\n* Sets `jsmath_path=jsmath_sage.js` in `doc/common/conf.py`.\n\nThe new static file is jsMath's \"stock\" `easy/load.js` plus all Sage-related customizations I could find, including extensions, macros, and a few other bits from `notebook.py`.  I've also made changes below `DO NOT MAKE CHANGES BELOW THIS` (gasp!) to help the loader find jsMath from its new [relative] location.\n\nI think this means we don't need to patch the spkg.  Later, we may be able to use Sphinx 0.6.2's static templates to insert an updated macro list at build time (cf. #6586).\n\nPerhaps we can do something similar for the notebook, e.g., in `sage/server/notebook/templates`.",
    "created_at": "2009-08-04T04:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41932",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
Attachment [trac_4714-minimal_doc.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-minimal_doc.patch) by @qed777 created at 2009-08-04 04:41:59

This [attachment:trac_4714-minimal_doc.patch p(r)oof of concept], which depends on a [attachment:ticket:6614:trac_6614-jsmath_repo_v2.patch patch] at #6614,

* Adds `doc/common/static/jsmath_sage.js`.
* Sets `jsmath_path=jsmath_sage.js` in `doc/common/conf.py`.

The new static file is jsMath's "stock" `easy/load.js` plus all Sage-related customizations I could find, including extensions, macros, and a few other bits from `notebook.py`.  I've also made changes below `DO NOT MAKE CHANGES BELOW THIS` (gasp!) to help the loader find jsMath from its new [relative] location.

I think this means we don't need to patch the spkg.  Later, we may be able to use Sphinx 0.6.2's static templates to insert an updated macro list at build time (cf. #6586).

Perhaps we can do something similar for the notebook, e.g., in `sage/server/notebook/templates`.



---

archive/issue_comments_041933.json:
```json
{
    "body": "<a id='comment:9'></a>\nWith major changes in afoot in the notebook at #6568, I've put the doc patch up for review at #6673 and made this ticket specific to the notebook.",
    "created_at": "2009-08-04T07:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41933",
    "user": "https://github.com/qed777"
}
```

<a id='comment:9'></a>
With major changes in afoot in the notebook at #6568, I've put the doc patch up for review at #6673 and made this ticket specific to the notebook.



---

archive/issue_events_014031.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "rename": {
        "from": "use easy/load.js when loading jsmath",
        "to": "use easy/load.js when loading jsmath in the notebook"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14031"
}
```



---

archive/issue_events_014032.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14032"
}
```



---

archive/issue_events_014033.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "label": "component: notebook",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14033"
}
```



---

archive/issue_comments_041934.json:
```json
{
    "body": "**Assignee:** boothby",
    "created_at": "2009-08-04T07:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41934",
    "user": "https://github.com/qed777"
}
```

**Assignee:** boothby



---

archive/issue_comments_041935.json:
```json
{
    "body": "<a id='comment:10'></a>\nSee [comment:ticket:6673:10 this comment] (and the next one) at #6673 for a suggested path to \"unification.\"",
    "created_at": "2009-10-16T07:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41935",
    "user": "https://github.com/qed777"
}
```

<a id='comment:10'></a>
See [comment:ticket:6673:10 this comment] (and the next one) at #6673 for a suggested path to "unification."



---

archive/issue_comments_041936.json:
```json
{
    "body": "<a id='comment:11'></a>\nIn `sagenb.notebook.twist`, we can use a cached `sage.misc.latex_macros.sage_jsmath_macros_easy` (cf. #6673's [attachment:trac_6673-jsmath_macros_docs_v3.patch:ticket:6673 v3]) and `JSMATH_IMAGE_FONTS`, plus a user's own macros, to serve a dynamic `javascript/jsmath.js`.",
    "created_at": "2009-10-21T19:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41936",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>
In `sagenb.notebook.twist`, we can use a cached `sage.misc.latex_macros.sage_jsmath_macros_easy` (cf. #6673's [attachment:trac_6673-jsmath_macros_docs_v3.patch:ticket:6673 v3]) and `JSMATH_IMAGE_FONTS`, plus a user's own macros, to serve a dynamic `javascript/jsmath.js`.



---

archive/issue_comments_041937.json:
```json
{
    "body": "Consolidate jsMath setup.  Apply to sagenb repository.  Apply only this patch.",
    "created_at": "2009-10-23T07:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41937",
    "user": "https://github.com/qed777"
}
```

Consolidate jsMath setup.  Apply to sagenb repository.  Apply only this patch.



---

archive/issue_comments_041938.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-10-23T07:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41938",
    "user": "https://github.com/qed777"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_041939.json:
```json
{
    "body": "<a id='comment:12'></a>\nAttachment [trac_4714-sagenb_jsmath_init.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init.patch) by @qed777 created at 2009-10-23 07:10:01\n\nThe patch [attachment:trac_4714-sagenb_jsmath_init.patch] consolidates jsMath setup in `/javascript/jsmath.js`.  It depends on #6673.\n\nThe patch still hard-codes the `sage.misc.latex_macros`'s macros.  Still to do: Generate the macros from server/user settings and `latex_macros`'s helper functions.",
    "created_at": "2009-10-23T07:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41939",
    "user": "https://github.com/qed777"
}
```

<a id='comment:12'></a>
Attachment [trac_4714-sagenb_jsmath_init.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init.patch) by @qed777 created at 2009-10-23 07:10:01

The patch [attachment:trac_4714-sagenb_jsmath_init.patch] consolidates jsMath setup in `/javascript/jsmath.js`.  It depends on #6673.

The patch still hard-codes the `sage.misc.latex_macros`'s macros.  Still to do: Generate the macros from server/user settings and `latex_macros`'s helper functions.



---

archive/issue_comments_041940.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2009-10-23T07:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41940",
    "user": "https://github.com/qed777"
}
```

**Author:** Mitesh Patel



---

archive/issue_comments_041941.json:
```json
{
    "body": "Hard-code jsMath macros.  Apply to sagenb repository.",
    "created_at": "2009-10-24T18:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41941",
    "user": "https://github.com/qed777"
}
```

Hard-code jsMath macros.  Apply to sagenb repository.



---

archive/issue_comments_041942.json:
```json
{
    "body": "<a id='comment:13'></a>\nAttachment [trac_4714-sagenb_hard_code_macros.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_hard_code_macros.patch) by @qed777 created at 2009-10-24 18:51:10\n\nI've reattached [attachment:trac_4714-sagenb_hard_code_macros.patch], since my first try didn't work (server problems?).",
    "created_at": "2009-10-24T18:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41942",
    "user": "https://github.com/qed777"
}
```

<a id='comment:13'></a>
Attachment [trac_4714-sagenb_hard_code_macros.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_hard_code_macros.patch) by @qed777 created at 2009-10-24 18:51:10

I've reattached [attachment:trac_4714-sagenb_hard_code_macros.patch], since my first try didn't work (server problems?).



---

archive/issue_comments_041943.json:
```json
{
    "body": "<a id='comment:14'></a>\nNote: With Jinja2 (cf. #7269, #7249), we can instead use, e.g.,\n\n```js\n    macros: {\n       {{ jsmath_macros|join(',\\n') }}\n    },\n```\nin `jsmath.js` (cf. #6673).",
    "created_at": "2009-10-24T19:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41943",
    "user": "https://github.com/qed777"
}
```

<a id='comment:14'></a>
Note: With Jinja2 (cf. #7269, #7249), we can instead use, e.g.,

```js
    macros: {
       {{ jsmath_macros|join(',\n') }}
    },
```
in `jsmath.js` (cf. #6673).



---

archive/issue_comments_041944.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,26 +1,11 @@\n-From http://groups.google.com/group/sage-support/t/178d0bd277044918\n+The patch\n \n-```\n-Yes, that looks correct.  I'm not sure why people are getting the \n-error -7 under these conditions.  It means that something has gone \n-wrong when trying to load the fallback method, and that usually means \n-it can't read the image font definition files.  There are a couple of \n-other possibilities as well:  perhaps the noImageFonts plugin was not \n-able to be read (permission issue?) or the unicode fallback file could \n-not be read.  Given your use of noImageFonts, I suspect it may be the \n-latter.  If the users who are getting error -7 are using Firefox3, \n-that may well be it.  There were changes to the same-origin security \n-policy in Firefox3 that prevent jsMath from loading local files from \n-directories other than the one in which the HTML file is found.  I \n-worked around this in jsMath v3.6 (released Sept. 2008), so those \n-users should update to the latest version of jsMath to avoid that \n-problem. \n-> I'm pretty sure we don't use the easy/load.js (and I'm not sure why). \n+* [attachment:trac_4714-sagenb_jsmath_init.patch]\n \n-Probably because it didn't exist when jsMath support was added to \n-sage.  The easy/load.js file was a relatively late addition to jsMath, \n-but certainly makes things easier for people.  You might consider \n-whether you want to use that instead. \n+consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.  It hard-codes the jsMath macros in `sagenb.misc.misc`, for now.\n \n-Davide\n+A quicker fix for shipping Sage 4.2 is this patch:\n \n+* [attachment:trac_4714-sagenb_hard_code_macros.patch]\n+\n+It does only the hard-coding, so it does not depend on #6673.\n``````\n",
    "created_at": "2009-10-24T19:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41944",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,26 +1,11 @@
-From http://groups.google.com/group/sage-support/t/178d0bd277044918
+The patch
 
-```
-Yes, that looks correct.  I'm not sure why people are getting the 
-error -7 under these conditions.  It means that something has gone 
-wrong when trying to load the fallback method, and that usually means 
-it can't read the image font definition files.  There are a couple of 
-other possibilities as well:  perhaps the noImageFonts plugin was not 
-able to be read (permission issue?) or the unicode fallback file could 
-not be read.  Given your use of noImageFonts, I suspect it may be the 
-latter.  If the users who are getting error -7 are using Firefox3, 
-that may well be it.  There were changes to the same-origin security 
-policy in Firefox3 that prevent jsMath from loading local files from 
-directories other than the one in which the HTML file is found.  I 
-worked around this in jsMath v3.6 (released Sept. 2008), so those 
-users should update to the latest version of jsMath to avoid that 
-problem. 
-> I'm pretty sure we don't use the easy/load.js (and I'm not sure why). 
+* [attachment:trac_4714-sagenb_jsmath_init.patch]
 
-Probably because it didn't exist when jsMath support was added to 
-sage.  The easy/load.js file was a relatively late addition to jsMath, 
-but certainly makes things easier for people.  You might consider 
-whether you want to use that instead. 
+consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.  It hard-codes the jsMath macros in `sagenb.misc.misc`, for now.
 
-Davide
+A quicker fix for shipping Sage 4.2 is this patch:
 
+* [attachment:trac_4714-sagenb_hard_code_macros.patch]
+
+It does only the hard-coding, so it does not depend on #6673.
``````




---

archive/issue_comments_041945.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis works: trac_4714-sagenb_hard_code_macros.patc",
    "created_at": "2009-10-25T02:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41945",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:15'></a>
This works: trac_4714-sagenb_hard_code_macros.patc



---

archive/issue_comments_041946.json:
```json
{
    "body": "<a id='comment:16'></a>\nReminder: Rebase vs. #7269.",
    "created_at": "2009-10-25T09:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41946",
    "user": "https://github.com/qed777"
}
```

<a id='comment:16'></a>
Reminder: Rebase vs. #7269.



---

archive/issue_events_014034.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-10-25T09:42:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "milestone": "sage-4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14034"
}
```



---

archive/issue_events_014035.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-11-20T00:22:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "milestone": "sage-4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14035"
}
```



---

archive/issue_events_014036.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-11-20T00:22:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "milestone": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14036"
}
```



---

archive/issue_comments_041947.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2009-11-26T05:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41947",
    "user": "https://github.com/qed777"
}
```

**Upstream:** N/A



---

archive/issue_comments_041948.json:
```json
{
    "body": "**Work_Issues:** rebase",
    "created_at": "2009-11-26T05:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41948",
    "user": "https://github.com/qed777"
}
```

**Work_Issues:** rebase



---

archive/issue_comments_041949.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-11-26T05:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41949",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_041950.json:
```json
{
    "body": "Rebased.  See the comment for the queue.  Apply only this patch.  sagenb repo.",
    "created_at": "2009-11-26T06:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41950",
    "user": "https://github.com/qed777"
}
```

Rebased.  See the comment for the queue.  Apply only this patch.  sagenb repo.



---

archive/issue_comments_041951.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-11-26T06:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41951",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_041952.json:
```json
{
    "body": "<a id='comment:19'></a>\nAttachment [trac_4714-sagenb_jsmath_init_v2.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init_v2.patch) by @qed777 created at 2009-11-26 06:33:37\n\nRebased against this sequence:\n\n```\ntrac_7390-sagenb_test_report_A.patch\ntrac_7390-sagenb_test_report_B_v2.patch\ntrac_7390-sagenb_test_report_referee.patch\ntrac_7402-pkg_resources.patch\ntrac_7428-publish_last_edited_v2.patch\ntrac_7444-search_after_publish.patch\ntrac_7376-search_by_username_v2.patch\ntrac_1321-sagenb_graphed.patch\nsagenb_7483.patch\nsagenb_7482.patch\nsagenb-7495.patch\nsagenb_3849.patch\ntrac_4714-sagenb_jsmath_init_v2.patch\n```",
    "created_at": "2009-11-26T06:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41952",
    "user": "https://github.com/qed777"
}
```

<a id='comment:19'></a>
Attachment [trac_4714-sagenb_jsmath_init_v2.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init_v2.patch) by @qed777 created at 2009-11-26 06:33:37

Rebased against this sequence:

```
trac_7390-sagenb_test_report_A.patch
trac_7390-sagenb_test_report_B_v2.patch
trac_7390-sagenb_test_report_referee.patch
trac_7402-pkg_resources.patch
trac_7428-publish_last_edited_v2.patch
trac_7444-search_after_publish.patch
trac_7376-search_by_username_v2.patch
trac_1321-sagenb_graphed.patch
sagenb_7483.patch
sagenb_7482.patch
sagenb-7495.patch
sagenb_3849.patch
trac_4714-sagenb_jsmath_init_v2.patch
```



---

archive/issue_comments_041953.json:
```json
{
    "body": "**Changing work_issues** from \"rebase\" to \"\".",
    "created_at": "2009-11-26T06:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41953",
    "user": "https://github.com/qed777"
}
```

**Changing work_issues** from "rebase" to "".



---

archive/issue_comments_041954.json:
```json
{
    "body": "Attachment [trac_4714-sagenb_jsmath_init_v3.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init_v3.patch) by @qed777 created at 2009-12-02 23:35:14\n\nForce jsMath to load always.  This patch only.  sagenb repo.",
    "created_at": "2009-12-02T23:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41954",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_4714-sagenb_jsmath_init_v3.patch](tarball://root/attachments/some-uuid/ticket4714/trac_4714-sagenb_jsmath_init_v3.patch) by @qed777 created at 2009-12-02 23:35:14

Force jsMath to load always.  This patch only.  sagenb repo.



---

archive/issue_comments_041955.json:
```json
{
    "body": "<a id='comment:22'></a>\nVersion 3:\n\n* Disables jsMath's autoload plug-in.  Otherwise, jsMath does not load itself and run in worksheets that *initially* do not contain expressions to typeset.",
    "created_at": "2009-12-02T23:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41955",
    "user": "https://github.com/qed777"
}
```

<a id='comment:22'></a>
Version 3:

* Disables jsMath's autoload plug-in.  Otherwise, jsMath does not load itself and run in worksheets that *initially* do not contain expressions to typeset.



---

archive/issue_comments_041956.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,5 @@\n The patch\n \n-* [attachment:trac_4714-sagenb_jsmath_init.patch]\n+* [attachment:trac_4714-sagenb_jsmath_init_v3.patch]\n \n-consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.  It hard-codes the jsMath macros in `sagenb.misc.misc`, for now.\n-\n-A quicker fix for shipping Sage 4.2 is this patch:\n-\n-* [attachment:trac_4714-sagenb_hard_code_macros.patch]\n-\n-It does only the hard-coding, so it does not depend on #6673.\n+consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.\n``````\n",
    "created_at": "2009-12-02T23:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41956",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,5 @@
 The patch
 
-* [attachment:trac_4714-sagenb_jsmath_init.patch]
+* [attachment:trac_4714-sagenb_jsmath_init_v3.patch]
 
-consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.  It hard-codes the jsMath macros in `sagenb.misc.misc`, for now.
-
-A quicker fix for shipping Sage 4.2 is this patch:
-
-* [attachment:trac_4714-sagenb_hard_code_macros.patch]
-
-It does only the hard-coding, so it does not depend on #6673.
+consolidates jsMath setup in `/javascript/jsmath.js`. It depends on #6673.
``````




---

archive/issue_comments_041957.json:
```json
{
    "body": "<a id='comment:23'></a>\nLooks good to me.",
    "created_at": "2009-12-08T23:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41957",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:23'></a>
Looks good to me.



---

archive/issue_comments_041958.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2009-12-08T23:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41958",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_041959.json:
```json
{
    "body": "<a id='comment:24'></a>\nI merged this patch into sagenb-0.4.6.",
    "created_at": "2009-12-09T01:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41959",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:24'></a>
I merged this patch into sagenb-0.4.6.



---

archive/issue_comments_041960.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-12-09T01:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41960",
    "user": "https://github.com/williamstein"
}
```

**Resolution:** fixed



---

archive/issue_events_014037.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-09T01:12:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4714#event-14037"
}
```



---

archive/issue_comments_041961.json:
```json
{
    "body": "**Merged:** sagenb-0.4.6",
    "created_at": "2009-12-27T01:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41961",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** sagenb-0.4.6



---

archive/issue_comments_041962.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2009-12-27T01:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4714#issuecomment-41962",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Reviewer:** William Stein
