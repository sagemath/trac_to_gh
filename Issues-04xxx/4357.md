# Issue 4357: modular forms -- new subspace used to work and now broken

archive/issues_004357.json:
```json
{
    "body": "This used to work and is now broken.  It is used in my modular forms book.\n\n```\nsage: CuspForms(45).new_subspace()\nTraceback (most recent call last):\n...\nNotImplementedError: computation of new submodule not yet implemented\n```\n\n**Assignee:** @loefflerd\n\n**Author:** David Loeffler\n\n**Reviewer:** Craig Citro\n\n**Merged:** 4.0.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/4357\n\n",
    "closed_at": "2009-05-11T07:58:56Z",
    "created_at": "2008-10-24T02:04:23Z",
    "labels": [
        "component: modular forms",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0",
    "title": "modular forms -- new subspace used to work and now broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4357",
    "user": "https://github.com/williamstein"
}
```
This used to work and is now broken.  It is used in my modular forms book.

```
sage: CuspForms(45).new_subspace()
Traceback (most recent call last):
...
NotImplementedError: computation of new submodule not yet implemented
```

**Assignee:** @loefflerd

**Author:** David Loeffler

**Reviewer:** Craig Citro

**Merged:** 4.0.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/4357





---

archive/issue_events_012538.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "rename": {
        "from": "modualr forms -- new subspace used to work and now broken",
        "to": "modular forms -- new subspace used to work and now broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4357#event-12538"
}
```



---

archive/issue_comments_033379.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2008-10-27T19:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33379",
    "user": "https://github.com/craigcitro"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_033380.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis functionality was removed because it was broken. Indeed, the result returned in William's book is incorrect -- it **should** be:\n\n```\nCuspForms(Gamma0(45), 2, prec=14).new_subspace().basis()\n(q + q^2 - q^4 - q^5 - 3*q^8 - q^10 + 4*q^11 - 2*q^13 + O(q^14),)\n```\n\nWilliam and I have discussed a fix for this, which I'll take care of soon, unless William beats me to it.",
    "created_at": "2008-10-27T19:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33380",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:2'></a>
This functionality was removed because it was broken. Indeed, the result returned in William's book is incorrect -- it **should** be:

```
CuspForms(Gamma0(45), 2, prec=14).new_subspace().basis()
(q + q^2 - q^4 - q^5 - 3*q^8 - q^10 + 4*q^11 - 2*q^13 + O(q^14),)
```

William and I have discussed a fix for this, which I'll take care of soon, unless William beats me to it.



---

archive/issue_comments_033381.json:
```json
{
    "body": "patch against 3.4.2.alpha0",
    "created_at": "2009-04-30T18:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33381",
    "user": "https://github.com/loefflerd"
}
```

patch against 3.4.2.alpha0



---

archive/issue_comments_033382.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-04-30T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33382",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_033383.json:
```json
{
    "body": "**Changing status** from assigned to new.",
    "created_at": "2009-04-30T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33383",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from assigned to new.



---

archive/issue_comments_033384.json:
```json
{
    "body": "**Changing assignee** from @craigcitro to @loefflerd.",
    "created_at": "2009-04-30T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33384",
    "user": "https://github.com/loefflerd"
}
```

**Changing assignee** from @craigcitro to @loefflerd.



---

archive/attachments_004671.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4357.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4357/trac_4357.patch",
    "created_at": "2009-04-30T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/loefflerd"
}
```



---

archive/issue_comments_033385.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have uploaded a patch which I think fixes this -- it certainly gives the above result for level 45 and weight 2.",
    "created_at": "2009-04-30T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33385",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:3'></a>
I have uploaded a patch which I think fixes this -- it certainly gives the above result for level 45 and weight 2.



---

archive/issue_comments_033386.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2009-04-30T18:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33386",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from new to assigned.



---

archive/issue_events_012539.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "rename": {
        "from": "modular forms -- new subspace used to work and now broken",
        "to": "[with positive review after minor changes] modular forms -- new subspace used to work and now broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4357#event-12539"
}
```



---

archive/issue_comments_033387.json:
```json
{
    "body": "<a id='comment:5'></a>\nREFEREE REPORT:\n\nLooks good! I'm happy to see this code get merged, modulo a few really tiny things:\n\n* On line 238 of `modular/modform/ambient.py`, I think a line needs to be split.\n\n* In the same file, at line 521, I think we should reverse the order of the cuspidal and Eisenstein parts, so that it matches the order we have for the basis of the modular forms space itself. (Of course, there's no real reason it should be one order over another, but it should be consistent, and the basis code has been around much longer.)\n\n* Note that there's an issue with the `atkin_lehner_eigenvalue` code, but this is fixed in your patch at #5262, so I'm not worried. (I'm about to review that one.)\n\n* On this last one, I mostly have a question -- I could just be confused. You've added a new argument `t` to all the `_degeneracy_raising_matrix` functions, which makes sense with the other changes you've made. But why do you raise a `RuntimeError` if the value isn't 1? Shouldn't it be something like a `NotImplementedError`, or am I missing something? Or if no argument but `t=1` makes sense (for a reason I don't see), then I think it should be a `ValueError`.\n\nOnce those get fixed, I'm happy to see this code go in.",
    "created_at": "2009-05-08T07:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33387",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:5'></a>
REFEREE REPORT:

Looks good! I'm happy to see this code get merged, modulo a few really tiny things:

* On line 238 of `modular/modform/ambient.py`, I think a line needs to be split.

* In the same file, at line 521, I think we should reverse the order of the cuspidal and Eisenstein parts, so that it matches the order we have for the basis of the modular forms space itself. (Of course, there's no real reason it should be one order over another, but it should be consistent, and the basis code has been around much longer.)

* Note that there's an issue with the `atkin_lehner_eigenvalue` code, but this is fixed in your patch at #5262, so I'm not worried. (I'm about to review that one.)

* On this last one, I mostly have a question -- I could just be confused. You've added a new argument `t` to all the `_degeneracy_raising_matrix` functions, which makes sense with the other changes you've made. But why do you raise a `RuntimeError` if the value isn't 1? Shouldn't it be something like a `NotImplementedError`, or am I missing something? Or if no argument but `t=1` makes sense (for a reason I don't see), then I think it should be a `ValueError`.

Once those get fixed, I'm happy to see this code go in.



---

archive/issue_comments_033388.json:
```json
{
    "body": "<a id='comment:6'></a>\nAs for the t argument thing: for modular symbols, where the raising matrices are complicated trace-like operators, the argument t is not used, since the degeneracy raising matrix for all values of t is calculated from the one for t = 1 by composing with a Hecke operator. But for modular forms, the degeneracy raising matrices are pretty easy (since we're working in a \"cohomological\" setup rather than a \"homological\" one) so it is easier to calculate them directly for each t.\n\nHence if _compute_degeneracy_raising matrix is getting called on a modular symbols space with t != 1, that's a runtime error, but on a modular forms space that's not the case. That should be explained in docstrings somewhere; I'll do a follow-up patch.\n\nDavid",
    "created_at": "2009-05-08T07:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33388",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:6'></a>
As for the t argument thing: for modular symbols, where the raising matrices are complicated trace-like operators, the argument t is not used, since the degeneracy raising matrix for all values of t is calculated from the one for t = 1 by composing with a Hecke operator. But for modular forms, the degeneracy raising matrices are pretty easy (since we're working in a "cohomological" setup rather than a "homological" one) so it is easier to calculate them directly for each t.

Hence if _compute_degeneracy_raising matrix is getting called on a modular symbols space with t != 1, that's a runtime error, but on a modular forms space that's not the case. That should be explained in docstrings somewhere; I'll do a follow-up patch.

David



---

archive/issue_comments_033389.json:
```json
{
    "body": "<a id='comment:7'></a>\nOK, here's a new patch. This makes absolutely no changes in functionality, but it moves stuff around a bit to clarify what's going on with this mysterious \"t\" argument -- the calculation of the other degeneracy maps from the t=1 one now happens entirely in modsym/ambient.py, which is only right and proper.\n\nI've swapped the order of the sum of cuspidal and Eisenstein parts, but this is solely cosmetic: addition of subspaces of vector spaces in Sage *is* commutative (because the subspace constructor echelon-reduces the basis vectors), and one can check that even with the old patch, for `ModularForms(9, 12).new_subspace()`, the single new Eisenstein series gets listed last, not first.",
    "created_at": "2009-05-08T10:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33389",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:7'></a>
OK, here's a new patch. This makes absolutely no changes in functionality, but it moves stuff around a bit to clarify what's going on with this mysterious "t" argument -- the calculation of the other degeneracy maps from the t=1 one now happens entirely in modsym/ambient.py, which is only right and proper.

I've swapped the order of the sum of cuspidal and Eisenstein parts, but this is solely cosmetic: addition of subspaces of vector spaces in Sage *is* commutative (because the subspace constructor echelon-reduces the basis vectors), and one can check that even with the old patch, for `ModularForms(9, 12).new_subspace()`, the single new Eisenstein series gets listed last, not first.



---

archive/attachments_004672.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4357_pt2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4357/trac_4357_pt2.patch",
    "created_at": "2009-05-08T10:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/loefflerd"
}
```



---

archive/issue_comments_033390.json:
```json
{
    "body": "",
    "created_at": "2009-05-08T10:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33390",
    "user": "https://github.com/loefflerd"
}
```





---

archive/issue_comments_033391.json:
```json
{
    "body": "<a id='comment:8'></a>\nExcellent ... I'm very happy with all the changes. The `t` stuff is cleaner, and good point about the swapping being cosmetic -- I was reading it and thought \"oh, that should match the order for the ambient space\" without actually realizing that it was irrelevant, since the subspace will have an echelon basis.\n\nTwo thumbs way up.",
    "created_at": "2009-05-10T05:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33391",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:8'></a>
Excellent ... I'm very happy with all the changes. The `t` stuff is cleaner, and good point about the swapping being cosmetic -- I was reading it and thought "oh, that should match the order for the ambient space" without actually realizing that it was irrelevant, since the subspace will have an echelon basis.

Two thumbs way up.



---

archive/issue_events_012540.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "rename": {
        "from": "[with positive review after minor changes] modular forms -- new subspace used to work and now broken",
        "to": "modular forms -- new subspace used to work and now broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4357#event-12540"
}
```



---

archive/issue_comments_033392.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2009-05-10T05:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33392",
    "user": "https://github.com/craigcitro"
}
```

**Changing status** from new to positive_review.



---

archive/issue_events_012541.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-05-11T07:58:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4357#event-12541"
}
```



---

archive/issue_comments_033393.json:
```json
{
    "body": "<a id='comment:9'></a>\nMerged both patches in Sage 4.0.alpha0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-11T07:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33393",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
Merged both patches in Sage 4.0.alpha0.

Cheers,

Michael



---

archive/issue_comments_033394.json:
```json
{
    "body": "**Author:** David Loeffler",
    "created_at": "2009-06-07T09:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33394",
    "user": "https://github.com/loefflerd"
}
```

**Author:** David Loeffler



---

archive/issue_comments_033395.json:
```json
{
    "body": "**Merged:** 4.0.alpha0",
    "created_at": "2009-06-07T09:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33395",
    "user": "https://github.com/loefflerd"
}
```

**Merged:** 4.0.alpha0



---

archive/issue_comments_033396.json:
```json
{
    "body": "**Reviewer:** Craig Citro",
    "created_at": "2009-06-07T09:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4357#issuecomment-33396",
    "user": "https://github.com/loefflerd"
}
```

**Reviewer:** Craig Citro
