# Issue 4217: notebook -- formatting of cells  beginning with "%hide %html" is not saved

archive/issues_004217.json:
```json
{
    "body": "In http://groups.google.com/group/sage-support/browse_thread/thread/642313d7270e789f it was reported:\n\n```\nAs of version 3.1.2, plots are saved correctly in notebooks. Thanks to \nthose that fixed it. However, I noticed that the formatting of cells \nbeginning with \"%hide %html\" is not saved. I need to re-evaluate all \nof those cells to get the formatting back. Is this a bug in SAGE or \ndoes it have something to do with the web browser (Firefox 3.0.3 on \nMac OS X 10.4)? \nThanks again for the great effort! \n\nStan\n```\n\n**Assignee:** @mwhansen\n\n**Author:** Tim Dumol\n\n**Reviewer:** Mitesh Patel\n\n**Merged:** sagenb-0.7\n\nIssue created by migration from https://trac.sagemath.org/ticket/4217\n\n",
    "closed_at": "2010-01-25T00:51:44Z",
    "created_at": "2008-09-29T18:17:11Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.2",
    "title": "notebook -- formatting of cells  beginning with \"%hide %html\" is not saved",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4217",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```
In http://groups.google.com/group/sage-support/browse_thread/thread/642313d7270e789f it was reported:

```
As of version 3.1.2, plots are saved correctly in notebooks. Thanks to 
those that fixed it. However, I noticed that the formatting of cells 
beginning with "%hide %html" is not saved. I need to re-evaluate all 
of those cells to get the formatting back. Is this a bug in SAGE or 
does it have something to do with the web browser (Firefox 3.0.3 on 
Mac OS X 10.4)? 
Thanks again for the great effort! 

Stan
```

**Assignee:** @mwhansen

**Author:** Tim Dumol

**Reviewer:** Mitesh Patel

**Merged:** sagenb-0.7

Issue created by migration from https://trac.sagemath.org/ticket/4217





---

archive/issue_comments_025512.json:
```json
{
    "body": "<a id='comment:1'></a>\nNotice that now there is a concrete example in the above thread. It cannot be copy and pasted here since the wiki interprets part of the syntax.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-30T08:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25512",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
Notice that now there is a concrete example in the above thread. It cannot be copy and pasted here since the wiki interprets part of the syntax.

Cheers,

Michael



---

archive/issue_comments_025513.json:
```json
{
    "body": "<a id='comment:2'></a>\nI can reproduce this on sagenb.org, but I can't after some of my notebook patches.  I think we might be able to resolve this as fixed in 3.3.  I'll check in 3.3.alpha1 when I get ahold of it.",
    "created_at": "2009-01-24T05:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25513",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
I can reproduce this on sagenb.org, but I can't after some of my notebook patches.  I think we might be able to resolve this as fixed in 3.3.  I'll check in 3.3.alpha1 when I get ahold of it.



---

archive/issue_comments_025514.json:
```json
{
    "body": "**Changing assignee** from boothby to @mwhansen.",
    "created_at": "2009-01-24T05:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25514",
    "user": "https://github.com/mwhansen"
}
```

**Changing assignee** from boothby to @mwhansen.



---

archive/attachments_004470.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4217-html-system-formatting.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4217/trac_4217-html-system-formatting.patch",
    "created_at": "2010-01-17T01:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/TimDumol"
}
```



---

archive/issue_comments_025515.json:
```json
{
    "body": "Removes Cell.__is_html and instead depends on the Cell.system() call for html cell detection",
    "created_at": "2010-01-17T01:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25515",
    "user": "https://github.com/TimDumol"
}
```

Removes Cell.__is_html and instead depends on the Cell.system() call for html cell detection



---

archive/issue_events_024857.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-17T01:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4217#event-24857"
}
```



---

archive/issue_comments_025516.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2010-01-17T01:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25516",
    "user": "https://github.com/TimDumol"
}
```

**Upstream:** N/A



---

archive/issue_comments_025517.json:
```json
{
    "body": "**Author:** Tim Dumol",
    "created_at": "2010-01-17T01:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25517",
    "user": "https://github.com/TimDumol"
}
```

**Author:** Tim Dumol



---

archive/issue_comments_025518.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe line breaks should not have been visible in the output in the first place as linebreaks are ignored in html. The line breaks were visible because the output was mistakenly surrounded by <pre> tags, which preformat the whitespace. This is because Cell.__is_html is not properly set on evaluation. This patch removes Cell.__is_html to prevent any future problems, and instead uses the previously included check using Cell.system().",
    "created_at": "2010-01-17T01:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25518",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:3'></a>
The line breaks should not have been visible in the output in the first place as linebreaks are ignored in html. The line breaks were visible because the output was mistakenly surrounded by <pre> tags, which preformat the whitespace. This is because Cell.__is_html is not properly set on evaluation. This patch removes Cell.__is_html to prevent any future problems, and instead uses the previously included check using Cell.system().



---

archive/attachments_004471.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4217-html-system-formatting.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4217/trac_4217-html-system-formatting.2.patch",
    "created_at": "2010-01-17T21:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/TimDumol"
}
```



---

archive/issue_comments_025519.json:
```json
{
    "body": "Rebase on new",
    "created_at": "2010-01-17T21:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25519",
    "user": "https://github.com/TimDumol"
}
```

Rebase on new



---

archive/issue_comments_025520.json:
```json
{
    "body": "<a id='comment:4'></a>\nThat comment was suppoesd to be \"Rebase on new patch sent\"\n\n```\ntrac_7650-sagenb_doctesting_v6.patch\ntrac_7650-reviewer.patch\ntrac_7648-missing_indent.patch\ntrac_7663-rstrip_prompt.patch\ntrac_7847-empty-trash-no-referer.patch\ntrac_7786-template-jinja-idiomatic.patch\ntrac_7863-declare_vars_aux_js_v2.patch\ntrac_7874-typeset_interact_labels.patch\ntrac_7858-key_binding_vars_v2.patch\ntrac_7666-alphanumeric_cell_ids_B5.patch\ntrac_7666-reviewer.patch\ntrac_7835-preparsing-unicode_v2.patch\ntrac_7249_jinja2_v5.patch\ntrac_2779-sagenb-error-message.patch\n2779_2_banner.patch\ntrac_3154-spurious-u0027-output.patch\ntrac_7969-escaped-backslash.patch\ntrac_7937-sass_manifest.patch\ntrac_4217-html-system-formatting.patch\n```\n\nSorry for the immense patch queue.",
    "created_at": "2010-01-17T21:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25520",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:4'></a>
That comment was suppoesd to be "Rebase on new patch sent"

```
trac_7650-sagenb_doctesting_v6.patch
trac_7650-reviewer.patch
trac_7648-missing_indent.patch
trac_7663-rstrip_prompt.patch
trac_7847-empty-trash-no-referer.patch
trac_7786-template-jinja-idiomatic.patch
trac_7863-declare_vars_aux_js_v2.patch
trac_7874-typeset_interact_labels.patch
trac_7858-key_binding_vars_v2.patch
trac_7666-alphanumeric_cell_ids_B5.patch
trac_7666-reviewer.patch
trac_7835-preparsing-unicode_v2.patch
trac_7249_jinja2_v5.patch
trac_2779-sagenb-error-message.patch
2779_2_banner.patch
trac_3154-spurious-u0027-output.patch
trac_7969-escaped-backslash.patch
trac_7937-sass_manifest.patch
trac_4217-html-system-formatting.patch
```

Sorry for the immense patch queue.



---

archive/issue_comments_025521.json:
```json
{
    "body": "<a id='comment:5'></a>\nA related problem: The input cells with the `%hide` directive are not hidden upon page load.  I think we just need to use `input_cls` in `cell.html`.",
    "created_at": "2010-01-18T11:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25521",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>
A related problem: The input cells with the `%hide` directive are not hidden upon page load.  I think we just need to use `input_cls` in `cell.html`.



---

archive/issue_comments_025522.json:
```json
{
    "body": "Uses `input_cell` in `cell.html`.  Replaces previous.",
    "created_at": "2010-01-19T11:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25522",
    "user": "https://github.com/qed777"
}
```

Uses `input_cell` in `cell.html`.  Replaces previous.



---

archive/issue_comments_025523.json:
```json
{
    "body": "**Reviewer:** Mitesh Patel",
    "created_at": "2010-01-19T13:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25523",
    "user": "https://github.com/qed777"
}
```

**Reviewer:** Mitesh Patel



---

archive/issue_events_024858.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-19T13:18:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4217#event-24858"
}
```



---

archive/issue_events_024859.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-19T13:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4217#event-24859"
}
```



---

archive/attachments_004472.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4217-html-system-formatting.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4217/trac_4217-html-system-formatting.3.patch",
    "created_at": "2010-01-19T13:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_025524.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've attached V3, which just uses `cell.html`'s `input_cls`.\n\nSometimes, evaluating a cell with `%hide` at its top doesn't hide it.  This is a separate problem, apparently\n\nPositive review on this ticket.  Feel free to ignore V3.",
    "created_at": "2010-01-19T13:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25524",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>
I've attached V3, which just uses `cell.html`'s `input_cls`.

Sometimes, evaluating a cell with `%hide` at its top doesn't hide it.  This is a separate problem, apparently

Positive review on this ticket.  Feel free to ignore V3.



---

archive/issue_comments_025525.json:
```json
{
    "body": "**Merged:** sagenb-0.7",
    "created_at": "2010-01-25T00:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25525",
    "user": "https://github.com/qed777"
}
```

**Merged:** sagenb-0.7



---

archive/issue_events_024860.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:51:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4217#event-24860"
}
```



---

archive/issue_events_024861.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:51:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4217#event-24861"
}
```



---

archive/issue_comments_025526.json:
```json
{
    "body": "<a id='comment:8'></a>\nNote: The commit strings for all of the patches above are actually for #3154.  I merged version 3 into SageNB 0.7 at #8051.",
    "created_at": "2010-02-06T19:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4217",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4217#issuecomment-25526",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
Note: The commit strings for all of the patches above are actually for #3154.  I merged version 3 into SageNB 0.7 at #8051.
