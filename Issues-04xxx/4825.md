# Issue 4825: extract worksheets embedded in pdf files

archive/issues_004825.json:
```json
{
    "assignees": [],
    "body": "This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a\n\nBasically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.\n\nWe can use pdfminer to extract the data.  Here's a sample program which extracts the first embedded file in a pdf named 'foo.pdf'.\n\n```\nfrom pdflib.pdfparser import PDFDocument, PDFParser\nimport sys\nstdout = sys.stdout\n\ndoc = PDFDocument()\nfp = file('foo.pdf', 'rb')\nparser = PDFParser(doc, fp)\ndoc.initialize()\n\nfor xref in doc.xrefs:\n    for objid in xref.objids():\n        try:\n            obj = doc.getobj(objid)\n        except:\n            continue\n        if isinstance(obj,dict) and 'Type' in obj and obj['Type'].name == \"Annot\":\n            if 'Subtype' in obj and obj['Subtype'].name == \"FileAttachment\":\n                # We have an attached file!\n                filespec = obj['FS']\n                # Look for embedded file; we could try to extract the\n                # filename too (and make sure it's an sws file). but that is platform dependent.  See page\n                # 182 (Section 3.10.2) of\n                # http://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf.\n                if 'EF' in filespec:\n                    fileobj = filespec['EF']['F']\n                    embeddedspec = filespec['EF']\n                    stdout.write(fileobj.resolve().get_data())\n                    # Just output the first file found.\n                    exit()\n```\n\n\nAssignee: **boothby**\n\nCC:  @dandrake\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4825_\n\n",
    "closed_at": "2020-08-29T15:28:09Z",
    "created_at": "2008-12-18T09:08:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20notebook",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "extract worksheets embedded in pdf files",
    "type": "issue",
    "updated_at": "2020-08-29T15:28:09Z",
    "url": "https://github.com/sagemath/sage/issues/4825",
    "user": "https://github.com/jasongrout"
}
```
This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a

Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.

We can use pdfminer to extract the data.  Here's a sample program which extracts the first embedded file in a pdf named 'foo.pdf'.

```
from pdflib.pdfparser import PDFDocument, PDFParser
import sys
stdout = sys.stdout

doc = PDFDocument()
fp = file('foo.pdf', 'rb')
parser = PDFParser(doc, fp)
doc.initialize()

for xref in doc.xrefs:
    for objid in xref.objids():
        try:
            obj = doc.getobj(objid)
        except:
            continue
        if isinstance(obj,dict) and 'Type' in obj and obj['Type'].name == "Annot":
            if 'Subtype' in obj and obj['Subtype'].name == "FileAttachment":
                # We have an attached file!
                filespec = obj['FS']
                # Look for embedded file; we could try to extract the
                # filename too (and make sure it's an sws file). but that is platform dependent.  See page
                # 182 (Section 3.10.2) of
                # http://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf.
                if 'EF' in filespec:
                    fileobj = filespec['EF']['F']
                    embeddedspec = filespec['EF']
                    stdout.write(fileobj.resolve().get_data())
                    # Just output the first file found.
                    exit()
```


Assignee: **boothby**

CC:  @dandrake

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/4825_





---

archive/issue_events_048601.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-12-18T09:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48601"
}
```



---

archive/issue_events_048602.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-12-18T09:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20notebook",
    "label_color": "000080",
    "label_name": "component: notebook",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48602"
}
```



---

archive/issue_events_048603.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-12-18T09:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48603"
}
```



---

archive/issue_events_048604.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-19T11:36:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48604"
}
```



---

archive/issue_events_048605.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-19T11:36:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48605"
}
```



---

archive/issue_comments_030258.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\n3.3 is foremost about the ReST transition, so all tickets should be opened against 3.4.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-19T11:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30258",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:1'>Comment 1:</a>
3.3 is foremost about the ReST transition, so all tickets should be opened against 3.4.

Cheers,

Michael



---

archive/issue_events_048606.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T02:51:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48606"
}
```



---

archive/issue_events_048607.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T02:51:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48607"
}
```



---

archive/issue_comments_030259.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This is an ongoing discussion on sage-devel right now.\n+This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a\n \n Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.\n \n``````\n",
    "created_at": "2009-12-09T14:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30259",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This is an ongoing discussion on sage-devel right now.
+This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a
 
 Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.
 
``````




---

archive/issue_comments_030260.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\npdfminer is about 350Kb of code.",
    "created_at": "2009-12-09T15:10:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30260",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'>Comment 4:</a>
pdfminer is about 350Kb of code.



---

archive/issue_events_048608.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48608"
}
```



---

archive/issue_events_048609.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48609"
}
```



---

archive/issue_events_048610.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48610"
}
```



---

archive/issue_events_048611.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48611"
}
```



---

archive/issue_events_048612.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48612"
}
```



---

archive/issue_events_048613.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48613"
}
```



---

archive/issue_events_048614.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48614"
}
```



---

archive/issue_events_048615.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48615"
}
```



---

archive/issue_comments_030261.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI feel like maybe this is possible now?",
    "created_at": "2014-09-18T02:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30261",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'>Comment 10:</a>
I feel like maybe this is possible now?



---

archive/issue_comments_030262.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nUnsure if this should be closed, as it could conceivably be useful for historical purposes.  Thoughts?",
    "created_at": "2020-03-29T02:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30262",
    "user": "https://github.com/sagetrac-boothby"
}
```

<a id='comment:11'>Comment 11:</a>
Unsure if this should be closed, as it could conceivably be useful for historical purposes.  Thoughts?



---

archive/issue_comments_030263.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nsagenb is gone, so...",
    "created_at": "2020-08-25T09:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30263",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'>Comment 12:</a>
sagenb is gone, so...



---

archive/issue_events_048616.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48616"
}
```



---

archive/issue_events_048617.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48617"
}
```



---

archive/issue_comments_030264.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-08-25T09:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4825#issuecomment-30264",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_048618.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48618"
}
```



---

archive/issue_events_048619.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48619"
}
```



---

archive/issue_events_048620.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-29T15:28:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48620"
}
```



---

archive/issue_events_048621.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-29T15:28:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4825",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4825#event-48621"
}
```
