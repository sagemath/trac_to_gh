# Issue 4825: extract worksheets embedded in pdf files

archive/issues_004825.json:
```json
{
    "body": "This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a\n\nBasically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.\n\nWe can use pdfminer to extract the data.  Here's a sample program which extracts the first embedded file in a pdf named 'foo.pdf'.\n\n```\nfrom pdflib.pdfparser import PDFDocument, PDFParser\nimport sys\nstdout = sys.stdout\n\ndoc = PDFDocument()\nfp = file('foo.pdf', 'rb')\nparser = PDFParser(doc, fp)\ndoc.initialize()\n\nfor xref in doc.xrefs:\n    for objid in xref.objids():\n        try:\n            obj = doc.getobj(objid)\n        except:\n            continue\n        if isinstance(obj,dict) and 'Type' in obj and obj['Type'].name == \"Annot\":\n            if 'Subtype' in obj and obj['Subtype'].name == \"FileAttachment\":\n                # We have an attached file!\n                filespec = obj['FS']\n                # Look for embedded file; we could try to extract the\n                # filename too (and make sure it's an sws file). but that is platform dependent.  See page\n                # 182 (Section 3.10.2) of\n                # http://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf.\n                if 'EF' in filespec:\n                    fileobj = filespec['EF']['F']\n                    embeddedspec = filespec['EF']\n                    stdout.write(fileobj.resolve().get_data())\n                    # Just output the first file found.\n                    exit()\n```\n\n\n**Assignee:** boothby\n\n**CC:**  @dandrake\n\n**Reviewer:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/4825\n\n",
    "closed_at": "2020-08-29T15:28:09Z",
    "created_at": "2008-12-18T09:08:05Z",
    "labels": [
        "component: notebook",
        "enhancement",
        "invalid"
    ],
    "title": "extract worksheets embedded in pdf files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4825",
    "user": "https://github.com/jasongrout"
}
```
This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a

Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.

We can use pdfminer to extract the data.  Here's a sample program which extracts the first embedded file in a pdf named 'foo.pdf'.

```
from pdflib.pdfparser import PDFDocument, PDFParser
import sys
stdout = sys.stdout

doc = PDFDocument()
fp = file('foo.pdf', 'rb')
parser = PDFParser(doc, fp)
doc.initialize()

for xref in doc.xrefs:
    for objid in xref.objids():
        try:
            obj = doc.getobj(objid)
        except:
            continue
        if isinstance(obj,dict) and 'Type' in obj and obj['Type'].name == "Annot":
            if 'Subtype' in obj and obj['Subtype'].name == "FileAttachment":
                # We have an attached file!
                filespec = obj['FS']
                # Look for embedded file; we could try to extract the
                # filename too (and make sure it's an sws file). but that is platform dependent.  See page
                # 182 (Section 3.10.2) of
                # http://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf.
                if 'EF' in filespec:
                    fileobj = filespec['EF']['F']
                    embeddedspec = filespec['EF']
                    stdout.write(fileobj.resolve().get_data())
                    # Just output the first file found.
                    exit()
```


**Assignee:** boothby

**CC:**  @dandrake

**Reviewer:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/4825





---

archive/issue_events_029888.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-12-19T11:36:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29888"
}
```



---

archive/issue_events_029889.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-12-19T11:36:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29889"
}
```



---

archive/issue_comments_030884.json:
```json
{
    "body": "<a id='comment:1'></a>\n3.3 is foremost about the ReST transition, so all tickets should be opened against 3.4.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-19T11:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30884",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
3.3 is foremost about the ReST transition, so all tickets should be opened against 3.4.

Cheers,

Michael



---

archive/issue_events_029890.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T02:51:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29890"
}
```



---

archive/issue_events_029891.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T02:51:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29891"
}
```



---

archive/issue_comments_030885.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2009-12-09T14:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30885",
    "user": "https://github.com/jasongrout"
}
```

**Upstream:** N/A



---

archive/issue_comments_030886.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This is an ongoing discussion on sage-devel right now.\n+This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a\n \n Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.\n \n``````\n",
    "created_at": "2009-12-09T14:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30886",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This is an ongoing discussion on sage-devel right now.
+This is an ongoing discussion on sage-devel right now: http://groups.google.com/group/sage-devel/browse_frm/thread/65a932ea328b1afb/91ced495a0a1c27a
 
 Basically, we'd like to embed an sws file in a pdf and then be able to upload the pdf file to the notebook and have the notebook automatically extract the sws file and create the worksheet.
 
``````




---

archive/issue_comments_030887.json:
```json
{
    "body": "<a id='comment:4'></a>\npdfminer is about 350Kb of code.",
    "created_at": "2009-12-09T15:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30887",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
pdfminer is about 350Kb of code.



---

archive/issue_events_029892.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29892"
}
```



---

archive/issue_events_029893.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29893"
}
```



---

archive/issue_events_029894.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29894"
}
```



---

archive/issue_events_029895.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29895"
}
```



---

archive/issue_events_029896.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29896"
}
```



---

archive/issue_events_029897.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29897"
}
```



---

archive/issue_events_029898.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29898"
}
```



---

archive/issue_events_029899.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29899"
}
```



---

archive/issue_comments_030888.json:
```json
{
    "body": "<a id='comment:10'></a>\nI feel like maybe this is possible now?",
    "created_at": "2014-09-18T02:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30888",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>
I feel like maybe this is possible now?



---

archive/issue_comments_030889.json:
```json
{
    "body": "<a id='comment:11'></a>\nUnsure if this should be closed, as it could conceivably be useful for historical purposes.  Thoughts?",
    "created_at": "2020-03-29T02:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30889",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:11'></a>
Unsure if this should be closed, as it could conceivably be useful for historical purposes.  Thoughts?



---

archive/issue_comments_030890.json:
```json
{
    "body": "<a id='comment:12'></a>\nsagenb is gone, so...",
    "created_at": "2020-08-25T09:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30890",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
sagenb is gone, so...



---

archive/issue_events_029900.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29900"
}
```



---

archive/issue_events_029901.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29901"
}
```



---

archive/issue_events_029902.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29902"
}
```



---

archive/issue_comments_030891.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-08-25T09:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4825#issuecomment-30891",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_029903.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29903"
}
```



---

archive/issue_events_029904.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:29:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29904"
}
```



---

archive/issue_events_029905.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-29T15:28:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29905"
}
```



---

archive/issue_events_029906.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-29T15:28:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4825",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4825#event-29906"
}
```
