# Issue 4740: avoid creating unneeded homsets when coercing

archive/issues_004740.json:
```json
{
    "assignees": [],
    "body": "Burcin reported at #4639:\n\n```\nsage: F = GF(13)\nsage: get_memory_usage()\n708.02734375\nsage: for _ in xrange(10000):\n....:     t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n728.15234375\nsage: for _ in xrange(100000):\n    t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n932.3125\nsage: for _ in xrange(100000):\n    t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n1136.35546875\n```\nSince the patch by RobertWB at that ticket fixes the issue Burcin reported, but not the original one I am moving it over to this ticket.\n\nCheers,\n\nMichael\n\n__Apply__\n\n[attachment:trac4740-cache_coerce_from_self.patch\u200b](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch\u200b)\n\nDepends on #14519\n\n**Assignee:** @robertwb\n\n**CC:**  @burcin @robertwb @simon-king-jena\n\n**Reviewer:** Mike Hansen\n\n**Author:** Simon King\n\n**Merged:** sage-5.12.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/4740\n\n",
    "closed_at": "2013-08-20T12:56:42Z",
    "created_at": "2008-12-08T11:23:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20memleak",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "avoid creating unneeded homsets when coercing",
    "type": "issue",
    "updated_at": "2013-08-20T12:56:42Z",
    "url": "https://github.com/sagemath/sage/issues/4740",
    "user": "https://github.com/sagetrac-mabshoff"
}
```
Burcin reported at #4639:

```
sage: F = GF(13)
sage: get_memory_usage()
708.02734375
sage: for _ in xrange(10000):
....:     t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
728.15234375
sage: for _ in xrange(100000):
    t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
932.3125
sage: for _ in xrange(100000):
    t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
1136.35546875
```
Since the patch by RobertWB at that ticket fixes the issue Burcin reported, but not the original one I am moving it over to this ticket.

Cheers,

Michael

__Apply__

[attachment:trac4740-cache_coerce_from_self.patch​](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch​)

Depends on #14519

**Assignee:** @robertwb

**CC:**  @burcin @robertwb @simon-king-jena

**Reviewer:** Mike Hansen

**Author:** Simon King

**Merged:** sage-5.12.beta3

Issue created by migration from https://trac.sagemath.org/ticket/4740





---

archive/issue_events_044597.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:23:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44597"
}
```



---

archive/issue_events_044598.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20memleak",
    "label_color": "08517b",
    "label_name": "component: memleak",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44598"
}
```



---

archive/issue_events_044599.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44599"
}
```



---

archive/issue_events_044600.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44600"
}
```



---

archive/issue_comments_029586.json:
```json
{
    "body": "**Attachment:** [trac_4740_coerce-leak.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac_4740_coerce-leak.patch.gz)\n\nPatch by RobertWB, originally from #4639",
    "created_at": "2008-12-08T11:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29586",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

**Attachment:** [trac_4740_coerce-leak.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac_4740_coerce-leak.patch.gz)

Patch by RobertWB, originally from #4639



---

archive/issue_events_044601.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:28:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44601"
}
```



---

archive/issue_events_044602.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:28:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44602"
}
```



---

archive/issue_comments_029587.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nPatch by RobertWB, review by William. \n\nCheers,\n\nMichael",
    "created_at": "2008-12-08T11:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29587",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:1'>**Comment 1:**</a>
Patch by RobertWB, review by William. 

Cheers,

Michael



---

archive/issue_comments_029588.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nThis patch causes a failure with the pickle jar:\n\n```\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.2.2.alpha1/devel/sage/sage/structure/sage_object.pyx\", line 371, in __main__.example_16\nFailed example:\n    sage.structure.sage_object.unpickle_all(std)###line 682:_sage_    >>> sage.structure.sage_object.unpickle_all(std)\nExpected:\n    doctest:...: DeprecationWarning: Your data is stored in an old format. Please use the save() function to store your data in a more recent format.\n    Successfully unpickled ... objects.\n    Failed to unpickle 0 objects.\nGot:\n    doctest:1172: DeprecationWarning: Your data is stored in an old format. Please use the save() function to store your data in a more recent format.\n    ** failed:  _class__sage_rings_finite_field_morphism_FiniteFieldHomset__.sobj\n    Failed:\n    _class__sage_rings_finite_field_morphism_FiniteFieldHomset__.sobj\n    Successfully unpickled 453 objects.\n    Failed to unpickle 1 objects.\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_16\n```\n\nCheers,\n\nMichael",
    "created_at": "2008-12-08T11:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29588",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:2'>**Comment 2:**</a>
This patch causes a failure with the pickle jar:

```
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.2.2.alpha1/devel/sage/sage/structure/sage_object.pyx", line 371, in __main__.example_16
Failed example:
    sage.structure.sage_object.unpickle_all(std)###line 682:_sage_    >>> sage.structure.sage_object.unpickle_all(std)
Expected:
    doctest:...: DeprecationWarning: Your data is stored in an old format. Please use the save() function to store your data in a more recent format.
    Successfully unpickled ... objects.
    Failed to unpickle 0 objects.
Got:
    doctest:1172: DeprecationWarning: Your data is stored in an old format. Please use the save() function to store your data in a more recent format.
    ** failed:  _class__sage_rings_finite_field_morphism_FiniteFieldHomset__.sobj
    Failed:
    _class__sage_rings_finite_field_morphism_FiniteFieldHomset__.sobj
    Successfully unpickled 453 objects.
    Failed to unpickle 1 objects.
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_16
```

Cheers,

Michael



---

archive/issue_events_044603.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:52:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44603"
}
```



---

archive/issue_events_044604.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-08T11:52:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44604"
}
```



---

archive/issue_comments_029589.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nOnce the pickling issue is fixed this should go in.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-15T18:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29589",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:3'>**Comment 3:**</a>
Once the pickling issue is fixed this should go in.

Cheers,

Michael



---

archive/issue_events_044605.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-15T18:42:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44605"
}
```



---

archive/issue_events_044606.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-15T18:42:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44606"
}
```



---

archive/issue_events_044607.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-15T18:42:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.2.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44607"
}
```



---

archive/issue_events_044608.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-21T00:53:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44608"
}
```



---

archive/issue_events_044609.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-21T00:53:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.2.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44609"
}
```



---

archive/issue_comments_029590.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nRobert,\n\nthe leak seems to be gone in 3.2.2:\n\n```\n----------------------------------------------------------------------\n| Sage Version 3.2.2, Release Date: 2008-12-18                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: F = GF(13)\nsage: get_memory_usage()\n689.02734375\nsage: for _ in xrange(10000):\n....:     t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n689.02734375\nsage: for _ in xrange(100000):\n....:     t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n689.02734375\nsage: for _ in xrange(100000):\n....:     t = F.coerce(F(234234))\n....:     \nsage: get_memory_usage()\n689.02734375\nsage: \n```\nShould we close this ticket as won't fix or is the patch her still relevant? In that case we should update the ticket to reflect the actual issue being fixed here.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-21T00:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29590",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:4'>**Comment 4:**</a>
Robert,

the leak seems to be gone in 3.2.2:

```
----------------------------------------------------------------------
| Sage Version 3.2.2, Release Date: 2008-12-18                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: F = GF(13)
sage: get_memory_usage()
689.02734375
sage: for _ in xrange(10000):
....:     t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
689.02734375
sage: for _ in xrange(100000):
....:     t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
689.02734375
sage: for _ in xrange(100000):
....:     t = F.coerce(F(234234))
....:     
sage: get_memory_usage()
689.02734375
sage: 
```
Should we close this ticket as won't fix or is the patch her still relevant? In that case we should update the ticket to reflect the actual issue being fixed here.

Cheers,

Michael



---

archive/issue_events_044610.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-12-21T09:57:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44610"
}
```



---

archive/issue_comments_029591.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nThe patch is still relevant here. What is going on is every time coerce is called, a new homset is created. Creating a new homset doesn't leak anymore, but it's still sub-optimal. \n\nI don't know that I'll have time to look into this anytime soon, but it's not a blocker anymore as the leak is solved elsewhere.",
    "created_at": "2008-12-21T09:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29591",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'>**Comment 5:**</a>
The patch is still relevant here. What is going on is every time coerce is called, a new homset is created. Creating a new homset doesn't leak anymore, but it's still sub-optimal. 

I don't know that I'll have time to look into this anytime soon, but it's not a blocker anymore as the leak is solved elsewhere.



---

archive/issue_events_044611.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-12-21T09:57:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.2.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44611"
}
```



---

archive/issue_events_044612.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-12-21T09:57:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44612"
}
```



---

archive/issue_comments_029592.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nok, \n\nI renamed the ticket then.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-21T09:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29592",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:6'>**Comment 6:**</a>
ok, 

I renamed the ticket then.

Cheers,

Michael



---

archive/issue_events_044613.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-12-21T09:59:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "rename": {
        "from": "Fix memory leak in finite field coercion",
        "to": "avoid creating unneeded homsets when coercing"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44613"
}
```



---

archive/issue_comments_029593.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nHi Robert,\n\naccidentally I found this rather old ticket.\n\nReplying to [@robertwb](#comment%3A5):\n> The patch is still relevant here. What is going on is every time coerce is called, a new homset is created. Creating a new homset doesn't leak anymore, but it's still sub-optimal. \n\nIs this still the case? In what situation is the homset created? Is it not cached? In what files does it occur?\n\nCheers,\nSimon",
    "created_at": "2010-06-14T08:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29593",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'>**Comment 7:**</a>
Hi Robert,

accidentally I found this rather old ticket.

Replying to [@robertwb](#comment%3A5):
> The patch is still relevant here. What is going on is every time coerce is called, a new homset is created. Creating a new homset doesn't leak anymore, but it's still sub-optimal. 

Is this still the case? In what situation is the homset created? Is it not cached? In what files does it occur?

Cheers,
Simon



---

archive/issue_comments_029594.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nI also found this ticket. It could be very well that this is still causing memory leaks. Look for example at the reference chain that is keeping ModularSymbols alive at #10548",
    "created_at": "2011-01-08T01:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29594",
    "user": "https://github.com/koffie"
}
```

<a id='comment:8'>**Comment 8:**</a>
I also found this ticket. It could be very well that this is still causing memory leaks. Look for example at the reference chain that is keeping ModularSymbols alive at #10548



---

archive/issue_comments_029595.json:
```json
{
    "body": "**Author:** Mike Hansen",
    "created_at": "2013-07-22T15:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29595",
    "user": "https://github.com/mwhansen"
}
```

**Author:** Mike Hansen



---

archive/issue_events_044614.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:10:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44614"
}
```



---

archive/issue_events_044615.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:10:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44615"
}
```



---

archive/issue_comments_029596.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nI think homesets are still created each time.  We could try the following patch which does fix the issue.  The timings also improved:\n\nBefore:\n\n```\nsage: %timeit t = F.coerce(F(234234))\n10000 loops, best of 3: 197 us per loop\n```\n\nAfter:\n\n```\nsage: %timeit t = F.coerce(F(234234))\n10000 loops, best of 3: 23.4 us per loop\n```\n\nSimon -- see any issues here?",
    "created_at": "2013-07-22T15:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29596",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:9'>**Comment 9:**</a>
I think homesets are still created each time.  We could try the following patch which does fix the issue.  The timings also improved:

Before:

```
sage: %timeit t = F.coerce(F(234234))
10000 loops, best of 3: 197 us per loop
```

After:

```
sage: %timeit t = F.coerce(F(234234))
10000 loops, best of 3: 23.4 us per loop
```

Simon -- see any issues here?



---

archive/issue_comments_029597.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Attachment:** [trac_4740.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac_4740.patch.gz)\n\nApply trac_4740.patch",
    "created_at": "2013-07-22T15:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29597",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Attachment:** [trac_4740.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac_4740.patch.gz)

Apply trac_4740.patch



---

archive/issue_events_044616.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T16:40:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44616"
}
```



---

archive/issue_events_044617.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T16:40:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44617"
}
```



---

archive/issue_comments_029598.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nReplying to [@mwhansen](#comment%3A9):\n> Simon -- see any issues here?\n\nYes, and a quite severe issue.\n\nThe problem is, as often, unique versus non-unique parent structures. For coercion, we need that the domain and codomain of a coercion from A to B are not just equal but identical to A and B. But with `UniqueRepresentation`, the given input arguments are compared by equality, not by identity. That's why it was a conscious decision to use `TripleDict` for caching homsets.\n\nThe cache is provided by the `Hom()` function in sage.categories.homset. If homsets are really created over and over again, then there seems to be a rogue call to `Homset(...)`. The solution is not to make `Homset` a cached class, but to call the `Hom()` function instead.",
    "created_at": "2013-07-22T16:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29598",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'>**Comment 12:**</a>
Replying to [@mwhansen](#comment%3A9):
> Simon -- see any issues here?

Yes, and a quite severe issue.

The problem is, as often, unique versus non-unique parent structures. For coercion, we need that the domain and codomain of a coercion from A to B are not just equal but identical to A and B. But with `UniqueRepresentation`, the given input arguments are compared by equality, not by identity. That's why it was a conscious decision to use `TripleDict` for caching homsets.

The cache is provided by the `Hom()` function in sage.categories.homset. If homsets are really created over and over again, then there seems to be a rogue call to `Homset(...)`. The solution is not to make `Homset` a cached class, but to call the `Hom()` function instead.



---

archive/issue_comments_029599.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nPS: For the same reason I don't like Robert's original patch.\n\nI think we should first find out where the homset constructor is called when Hom should be called instead.",
    "created_at": "2013-07-22T16:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29599",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'>**Comment 13:**</a>
PS: For the same reason I don't like Robert's original patch.

I think we should first find out where the homset constructor is called when Hom should be called instead.



---

archive/issue_comments_029600.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nInteresting. I found the following, by inserting a print statement into `Homset.__init__`:\n\n```\nsage: F = GF(13)\nsage: x = F(234234)\ncalling Homset Integer Ring Finite Field of size 13 Category of euclidean domains\nsage: x = F(234234)   # the homset is created only once, which is fine\nsage: t = F.coerce(F(234234))   # there is a homset created...\ncalling Homset Finite Field of size 13 Finite Field of size 13 Category of rings\nsage: t = F.coerce(F(234234))   # ... repeatedly\ncalling Homset Finite Field of size 13 Finite Field of size 13 Category of rings\nsage: t = F.coerce(F(234234))\ncalling Homset Finite Field of size 13 Finite Field of size 13 Category of rings\nsage: I = F.coerce_map_from(F)  # creating a coerce map, the homset is created again, but...\ncalling Homset Finite Field of size 13 Finite Field of size 13 Category of rings\nsage: t = F.coerce(F(234234))   # ... now the problem is fixed!\nsage: t = F.coerce(F(234234))\n```\n\nThis seems to suggest that\n1. `F.coerce` seems to use a cached coerce map from F to F, but if it isn't cached, it would create the coerce map repeatedly.\n2. It re-creates the coercion map such that the parent of the coercion map is re-created as well.",
    "created_at": "2013-07-22T16:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29600",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'>**Comment 14:**</a>
Interesting. I found the following, by inserting a print statement into `Homset.__init__`:

```
sage: F = GF(13)
sage: x = F(234234)
calling Homset Integer Ring Finite Field of size 13 Category of euclidean domains
sage: x = F(234234)   # the homset is created only once, which is fine
sage: t = F.coerce(F(234234))   # there is a homset created...
calling Homset Finite Field of size 13 Finite Field of size 13 Category of rings
sage: t = F.coerce(F(234234))   # ... repeatedly
calling Homset Finite Field of size 13 Finite Field of size 13 Category of rings
sage: t = F.coerce(F(234234))
calling Homset Finite Field of size 13 Finite Field of size 13 Category of rings
sage: I = F.coerce_map_from(F)  # creating a coerce map, the homset is created again, but...
calling Homset Finite Field of size 13 Finite Field of size 13 Category of rings
sage: t = F.coerce(F(234234))   # ... now the problem is fixed!
sage: t = F.coerce(F(234234))
```

This seems to suggest that
1. `F.coerce` seems to use a cached coerce map from F to F, but if it isn't cached, it would create the coerce map repeatedly.
2. It re-creates the coercion map such that the parent of the coercion map is re-created as well.



---

archive/issue_comments_029601.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nI just tried to use `trace(\"F.coerce(x)\")` to see what happens. And now, it seems to me that `Hom()` is called as it should---but its cache is broken, for a reason that I don't understand.",
    "created_at": "2013-07-22T17:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29601",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'>**Comment 15:**</a>
I just tried to use `trace("F.coerce(x)")` to see what happens. And now, it seems to me that `Hom()` is called as it should---but its cache is broken, for a reason that I don't understand.



---

archive/issue_comments_029602.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nI found the problem!!\n\nThe homset is stored in the cache, but it is then immediately erased again. Apparently, a strong reference to the homset is missing.",
    "created_at": "2013-07-22T17:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29602",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'>**Comment 16:**</a>
I found the problem!!

The homset is stored in the cache, but it is then immediately erased again. Apparently, a strong reference to the homset is missing.



---

archive/issue_comments_029603.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nNext observation: If one creates\n\n```\nsage: I = F.coerce_map_from(F)\n```\nand then does `del I`, the homset is again erased from the cache.\n\nBut this must not happen! Namely, `F.coerce_map_from(...)` is supposed to use a cache. Granted, the cache is again using weak keys (via `MonoDict`), but as long as `F` is kept in memory, the coercion from F to F must not vanish.",
    "created_at": "2013-07-22T17:26:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29603",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:17'>**Comment 17:**</a>
Next observation: If one creates

```
sage: I = F.coerce_map_from(F)
```
and then does `del I`, the homset is again erased from the cache.

But this must not happen! Namely, `F.coerce_map_from(...)` is supposed to use a cache. Granted, the cache is again using weak keys (via `MonoDict`), but as long as `F` is kept in memory, the coercion from F to F must not vanish.



---

archive/issue_comments_029604.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nLook at the following snippet from `Parent.coerce_map_from(self,S)`:\n\n```python\n        if S == self:\n            # non-unique parents\n            if unique_parent_warnings:\n                print \"Warning: non-unique parents %s\"%(type(S))\n            return self._generic_convert_map(S)\n```\n`self._generic_convert_map(S)` does not do caching.\n\nHence, the general problem is: A coercion from self to self will never be cached.",
    "created_at": "2013-07-22T17:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29604",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'>**Comment 18:**</a>
Look at the following snippet from `Parent.coerce_map_from(self,S)`:

```python
        if S == self:
            # non-unique parents
            if unique_parent_warnings:
                print "Warning: non-unique parents %s"%(type(S))
            return self._generic_convert_map(S)
```
`self._generic_convert_map(S)` does not do caching.

Hence, the general problem is: A coercion from self to self will never be cached.



---

archive/issue_comments_029605.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nI see two potential solutions, and the \"info\" I am seeking is: What would you prefer?\n\nWe could\n\n1. let `F.coerce_map_from(F)` use the cache (I think this is what I would prefer), or\n2. let `F.coerce(x)` avoid creating a morphism, if the parent of x is F.\n\nIt might even make sense to do both, 2. for efficiency.",
    "created_at": "2013-07-22T17:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29605",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'>**Comment 19:**</a>
I see two potential solutions, and the "info" I am seeking is: What would you prefer?

We could

1. let `F.coerce_map_from(F)` use the cache (I think this is what I would prefer), or
2. let `F.coerce(x)` avoid creating a morphism, if the parent of x is F.

It might even make sense to do both, 2. for efficiency.



---

archive/issue_events_044618.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T17:37:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44618"
}
```



---

archive/issue_events_044619.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T17:37:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44619"
}
```



---

archive/issue_comments_029606.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nI didn't notice that `self.coerce_map_from(S)` also has a special case when `S is self`. However, the result is again not cached.\n\n```python\n        if S is self:\n            from sage.categories.homset import Hom\n            return Hom(self, self).identity()\n```",
    "created_at": "2013-07-22T18:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29606",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:20'>**Comment 20:**</a>
I didn't notice that `self.coerce_map_from(S)` also has a special case when `S is self`. However, the result is again not cached.

```python
        if S is self:
            from sage.categories.homset import Hom
            return Hom(self, self).identity()
```



---

archive/issue_comments_029607.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nReplying to [@simon-king-jena](#comment%3A19):\n> 2. let `F.coerce(x)` avoid creating a morphism, if the parent of x is F.\n\nHm. On second thought, do we really want that `F.coerce(x) is x`? I guess it is better to preserve the current behaviour and return a copy of x.",
    "created_at": "2013-07-22T18:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29607",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'>**Comment 21:**</a>
Replying to [@simon-king-jena](#comment%3A19):
> 2. let `F.coerce(x)` avoid creating a morphism, if the parent of x is F.

Hm. On second thought, do we really want that `F.coerce(x) is x`? I guess it is better to preserve the current behaviour and return a copy of x.



---

archive/issue_comments_029608.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,3 +25,7 @@\n Cheers,\n \n Michael\n+\n+__Apply__\n+\n+- [attachment:trac4740-cache_coerce_from_self.patch\u200b](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch\u200b)\n``````\n",
    "created_at": "2013-07-22T18:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29608",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,3 +25,7 @@
 Cheers,
 
 Michael
+
+__Apply__
+
+- [attachment:trac4740-cache_coerce_from_self.patch​](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch​)
``````




---

archive/issue_comments_029609.json:
```json
{
    "body": "**Changing author** from \"Mike Hansen\" to \"Simon King\".",
    "created_at": "2013-07-22T18:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29609",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing author** from "Mike Hansen" to "Simon King".



---

archive/issue_events_044620.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T18:25:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44620"
}
```



---

archive/issue_events_044621.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-07-22T18:25:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44621"
}
```



---

archive/issue_comments_029610.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nWhat do people think about the patch that I just attached?\n\nWe now have\n\n```\nsage: F = GF(13)\nsage: F.coerce_map_from(F) is F.coerce_map_from(F)\nTrue\nsage: x = F(234234)\nsage: %timeit t = F.coerce(x)\n1000000 loops, best of 3: 862 ns per loop\n```\nand used to have\n\n```\nsage: F = GF(13)\nsage: F.coerce_map_from(F) is F.coerce_map_from(F)\nFalse\nsage: x = F(234234)\nsage: %timeit t = F.coerce(x)\n10000 loops, best of 3: 132 us per loop\n```\n\nApply trac4740-cache_coerce_from_self.patch\u200b",
    "created_at": "2013-07-22T18:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29610",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'>**Comment 22:**</a>
What do people think about the patch that I just attached?

We now have

```
sage: F = GF(13)
sage: F.coerce_map_from(F) is F.coerce_map_from(F)
True
sage: x = F(234234)
sage: %timeit t = F.coerce(x)
1000000 loops, best of 3: 862 ns per loop
```
and used to have

```
sage: F = GF(13)
sage: F.coerce_map_from(F) is F.coerce_map_from(F)
False
sage: x = F(234234)
sage: %timeit t = F.coerce(x)
10000 loops, best of 3: 132 us per loop
```

Apply trac4740-cache_coerce_from_self.patch​



---

archive/issue_comments_029611.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nPS: The memleak in the ticket description has already been fixed elsewhere, this is now only about efficiency.",
    "created_at": "2013-07-22T18:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29611",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:23'>**Comment 23:**</a>
PS: The memleak in the ticket description has already been fixed elsewhere, this is now only about efficiency.



---

archive/issue_comments_029612.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -28,4 +28,4 @@\n \n __Apply__\n \n-- [attachment:trac4740-cache_coerce_from_self.patch\u200b](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch\u200b)\n+[attachment:trac4740-cache_coerce_from_self.patch\u200b](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch\u200b)\n``````\n",
    "created_at": "2013-07-22T19:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29612",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -28,4 +28,4 @@
 
 __Apply__
 
-- [attachment:trac4740-cache_coerce_from_self.patch​](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch​)
+[attachment:trac4740-cache_coerce_from_self.patch​](https://github.com/sagemath/sage/files/ticket4740/febd15ba03f6e10ce2f7783c12bea502.patch​)
``````




---

archive/issue_comments_029613.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nIt seems that the patchbot tries to apply both patches. Trying to get it right:\n\nApply trac4740-cache_coerce_from_self.patch\u200b",
    "created_at": "2013-07-22T19:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29613",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'>**Comment 24:**</a>
It seems that the patchbot tries to apply both patches. Trying to get it right:

Apply trac4740-cache_coerce_from_self.patch​



---

archive/issue_comments_029614.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nFor the record: All tests pass, and I really don't see why the patchbot is trying to apply *two* patches.",
    "created_at": "2013-07-22T20:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29614",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:25'>**Comment 25:**</a>
For the record: All tests pass, and I really don't see why the patchbot is trying to apply *two* patches.



---

archive/issue_comments_029615.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nYour changes look good to me.  I knew the patch I posted was probably dodgy, but you'd be the one who'd have the best grasp on it.\n\nThanks!",
    "created_at": "2013-07-23T00:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29615",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:26'>**Comment 26:**</a>
Your changes look good to me.  I knew the patch I posted was probably dodgy, but you'd be the one who'd have the best grasp on it.

Thanks!



---

archive/issue_events_044622.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-23T00:16:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44622"
}
```



---

archive/issue_events_044623.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-23T00:16:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44623"
}
```



---

archive/issue_comments_029616.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2013-07-23T00:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29616",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_events_044624.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-24T06:26:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44624"
}
```



---

archive/issue_events_044625.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-24T06:26:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44625"
}
```



---

archive/issue_events_044626.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:37:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44626"
}
```



---

archive/issue_events_044627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44627"
}
```



---

archive/issue_comments_029617.json:
```json
{
    "body": "**Dependencies:** #14519",
    "created_at": "2013-08-16T21:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29617",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #14519



---

archive/issue_comments_029618.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nThis needs to be rebased to sage-5.12.beta0 + #14516 + #14519.",
    "created_at": "2013-08-16T21:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29618",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>**Comment 28:**</a>
This needs to be rebased to sage-5.12.beta0 + #14516 + #14519.



---

archive/issue_comments_029619.json:
```json
{
    "body": "**Attachment:** [trac4740-cache_coerce_from_self.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac4740-cache_coerce_from_self.patch.gz)\n\nCache coercion from self to self",
    "created_at": "2013-08-17T07:51:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29619",
    "user": "https://github.com/simon-king-jena"
}
```

**Attachment:** [trac4740-cache_coerce_from_self.patch.gz](https://github.com/sagemath/sage/files/ticket4740/trac4740-cache_coerce_from_self.patch.gz)

Cache coercion from self to self



---

archive/issue_comments_029620.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nDone! The only change concerns the new syntax for debug options. I guess I may revert to \"positive review\".\n\nApply trac4740-cache_coerce_from_self.patch\u200b",
    "created_at": "2013-08-17T07:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29620",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:29'>**Comment 29:**</a>
Done! The only change concerns the new syntax for debug options. I guess I may revert to "positive review".

Apply trac4740-cache_coerce_from_self.patch​



---

archive/issue_events_044628.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-08-17T07:53:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44628"
}
```



---

archive/issue_events_044629.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-08-17T07:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44629"
}
```



---

archive/issue_comments_029621.json:
```json
{
    "body": "**Merged:** sage-5.12.beta3",
    "created_at": "2013-08-20T12:56:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4740#issuecomment-29621",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.12.beta3



---

archive/issue_events_044630.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44630"
}
```



---

archive/issue_events_044631.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4740",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4740#event-44631"
}
```
