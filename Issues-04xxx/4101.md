# Issue 4101: cpdef horribly broken in last Cython

archive/issues_004101.json:
```json
{
    "assignees": [],
    "body": "The way cpdef functions were implemented broke in some classes when being used across modules. This came up now because the new coercion uses cpdef much more. This is just the old cython+bug fix rather than a new release for time reasons, and passes sage -testall with the attached (nearly trivial) patch. A sage -ba is required. \n\nhttp://sage.math.washington.edu/home/robertwb/cython/cython-0.9.8.1.1p1.spkg\n\n\n\nAssignee: **mabshoff**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4101_\n\n",
    "closed_at": "2008-09-13T01:52:10Z",
    "created_at": "2008-09-11T17:14:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.1.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cpdef horribly broken in last Cython",
    "type": "issue",
    "updated_at": "2008-09-13T04:07:07Z",
    "url": "https://github.com/sagemath/sage/issues/4101",
    "user": "https://github.com/robertwb"
}
```
The way cpdef functions were implemented broke in some classes when being used across modules. This came up now because the new coercion uses cpdef much more. This is just the old cython+bug fix rather than a new release for time reasons, and passes sage -testall with the attached (nearly trivial) patch. A sage -ba is required. 

http://sage.math.washington.edu/home/robertwb/cython/cython-0.9.8.1.1p1.spkg



Assignee: **mabshoff**

_Issue created by migration from https://trac.sagemath.org/ticket/4101_





---

archive/issue_events_039940.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-09-11T17:14:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "milestone_number": null,
    "milestone_title": "sage-3.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39940"
}
```



---

archive/issue_events_039941.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-09-11T17:14:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39941"
}
```



---

archive/issue_events_039942.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-09-11T17:14:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39942"
}
```



---

archive/issue_events_039943.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-09-11T17:14:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39943"
}
```



---

archive/issue_events_039944.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-09-11T17:14:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39944"
}
```



---

archive/issue_comments_024095.json:
```json
{
    "body": "Attachment: **[4101-cpdef-fix.patch.gz](https://github.com/sagemath/sage/files/ticket4101/4101-cpdef-fix.patch.gz)**",
    "created_at": "2008-09-11T17:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24095",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[4101-cpdef-fix.patch.gz](https://github.com/sagemath/sage/files/ticket4101/4101-cpdef-fix.patch.gz)**



---

archive/issue_comments_024096.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nHi Robert,\n\nI fixed some issues in the spkg, which is now at\n\nhttp://sage.math.washington.edu/home/mabshoff/release-cycles-3.1.2/rc2/cython-0.9.8.1.1.p0.spkg\n\nNote that the patch level usually starts at p0 and that the name of the spkg and the directory name were not in sync.\n\nI am testing the spkg with the patch to the Sage library applied right now, so expect a review in about 45 minutes.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-13T00:29:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24096",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:1'>Comment 1:</a>
Hi Robert,

I fixed some issues in the spkg, which is now at

http://sage.math.washington.edu/home/mabshoff/release-cycles-3.1.2/rc2/cython-0.9.8.1.1.p0.spkg

Note that the patch level usually starts at p0 and that the name of the spkg and the directory name were not in sync.

I am testing the spkg with the patch to the Sage library applied right now, so expect a review in about 45 minutes.

Cheers,

Michael



---

archive/issue_events_039945.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-13T01:51:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39945"
}
```



---

archive/issue_comments_024097.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nSpkg and a following `-ba` passes doctests. Positive review. Let's hope this spkg does not bite us in the ass so late in the release cycle :)\n\nCheers,\n\nMichael",
    "created_at": "2008-09-13T01:51:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24097",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:2'>Comment 2:</a>
Spkg and a following `-ba` passes doctests. Positive review. Let's hope this spkg does not bite us in the ass so late in the release cycle :)

Cheers,

Michael



---

archive/issue_comments_024098.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nMerged in Sage 3.1.2.rc2",
    "created_at": "2008-09-13T01:52:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24098",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:3'>Comment 3:</a>
Merged in Sage 3.1.2.rc2



---

archive/issue_events_039946.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-13T01:52:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39946"
}
```



---

archive/issue_events_039947.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-13T01:52:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4101#event-39947"
}
```



---

archive/issue_comments_024099.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThanks. I realized later that I had changed the name of the spkg rather than the folder name, but I was at work by then. \n\nThis is intentionally a p0 rather than the next release, so I'm pretty sure it won't bite us. (Famous last words...)",
    "created_at": "2008-09-13T03:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24099",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'>Comment 4:</a>
Thanks. I realized later that I had changed the name of the spkg rather than the folder name, but I was at work by then. 

This is intentionally a p0 rather than the next release, so I'm pretty sure it won't bite us. (Famous last words...)



---

archive/issue_comments_024100.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@robertwb](#comment%3A4):\n> Thanks. I realized later that I had changed the name of the spkg rather than the folder name, but I was at work by then. \n\nCool. It would be nice if you could base future cython.spkg off this on in 3.1.2.rc2. I did some fixed to spkg-install and SPKG.txt. It would also be great if you could add to the changes in SPKG.txt once you update it.\n\n> This is intentionally a p0 rather than the next release, so I'm pretty sure it won't bite us. \n\nWell, the name was p1, so that was mostly my point. I fully understand that you added only one patch on top of the latest Cython release.\n\n> (Famous last words...)\n\nYeah, what could go wrong :)\n\nI am valgrinding the startup of 3.1.2.rc2 to see if anything fishy was introduced.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-13T04:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4101#issuecomment-24100",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@robertwb](#comment%3A4):
> Thanks. I realized later that I had changed the name of the spkg rather than the folder name, but I was at work by then. 

Cool. It would be nice if you could base future cython.spkg off this on in 3.1.2.rc2. I did some fixed to spkg-install and SPKG.txt. It would also be great if you could add to the changes in SPKG.txt once you update it.

> This is intentionally a p0 rather than the next release, so I'm pretty sure it won't bite us. 

Well, the name was p1, so that was mostly my point. I fully understand that you added only one patch on top of the latest Cython release.

> (Famous last words...)

Yeah, what could go wrong :)

I am valgrinding the startup of 3.1.2.rc2 to see if anything fishy was introduced.

Cheers,

Michael
