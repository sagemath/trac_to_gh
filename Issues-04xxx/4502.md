# Issue 4502: numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix

archive/issues_004502.json:
```json
{
    "assignees": [],
    "body": "(This has only been reported on intel macs running 10.4 or 10.5.)\n\nFrom [sage-devel](http://groups.google.com/group/sage-devel/browse_frm/thread/fae59a9a9a53b8c0):\n\n```\nsage: A = matrix(RDF,3,range(1,10));A\n\n[1.0 2.0 3.0]\n[4.0 5.0 6.0]\n[7.0 8.0 9.0]\nsage: A.determinant()\n0.0\nsage: -A\n\n[-1.0 -2.0 -3.0]\n[-4.0 -5.0 -6.0]\n[-7.0 -8.0 -9.0]\nsage: b = A.numpy(); b\n\narray([[ 1.,  2.,  3.],\n       [ 4.,  5.,  6.],\n       [ 7.,  8.,  9.]])\nsage: import scipy\nsage: import scipy.linalg\nsage: scipy.linalg.det(b)\n0.0\nsage: scipy.linalg.inv(b)\n\narray([[ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15],\n       [  9.00719925e+15,  -1.80143985e+16,   9.00719925e+15],\n       [ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15]])\n```\n\nThis leads to a doctest failure for `matrix_double_dense.py`.\n\nKeywords: **numerical noise, matrix**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4502_\n\n",
    "closed_at": "2008-11-19T19:44:24Z",
    "created_at": "2008-11-12T17:57:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue",
    "updated_at": "2008-11-19T19:44:24Z",
    "url": "https://github.com/sagemath/sage/issues/4502",
    "user": "https://github.com/jhpalmieri"
}
```
(This has only been reported on intel macs running 10.4 or 10.5.)

From [sage-devel](http://groups.google.com/group/sage-devel/browse_frm/thread/fae59a9a9a53b8c0):

```
sage: A = matrix(RDF,3,range(1,10));A

[1.0 2.0 3.0]
[4.0 5.0 6.0]
[7.0 8.0 9.0]
sage: A.determinant()
0.0
sage: -A

[-1.0 -2.0 -3.0]
[-4.0 -5.0 -6.0]
[-7.0 -8.0 -9.0]
sage: b = A.numpy(); b

array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.],
       [ 7.,  8.,  9.]])
sage: import scipy
sage: import scipy.linalg
sage: scipy.linalg.det(b)
0.0
sage: scipy.linalg.inv(b)

array([[ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15],
       [  9.00719925e+15,  -1.80143985e+16,   9.00719925e+15],
       [ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15]])
```

This leads to a doctest failure for `matrix_double_dense.py`.

Keywords: **numerical noise, matrix**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/4502_





---

archive/issue_events_050697.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2008-11-12T17:57:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "milestone_number": null,
    "milestone_title": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50697"
}
```



---

archive/issue_events_050698.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2008-11-12T17:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50698"
}
```



---

archive/issue_events_050699.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2008-11-12T17:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50699"
}
```



---

archive/issue_events_050700.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2008-11-12T17:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50700"
}
```



---

archive/issue_comments_026266.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI think the easiest way to avoid this (until we update to the latest scipy and test this again) is to check the scipy.linalg.det explicitly before attempting doing an inverse.  If that determinant is zero (or close enough to it), then return the same error as the doctest returns (i.e., some scipy error).",
    "created_at": "2008-11-14T05:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26266",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:1" align="right">comment:1</div>

I think the easiest way to avoid this (until we update to the latest scipy and test this again) is to check the scipy.linalg.det explicitly before attempting doing an inverse.  If that determinant is zero (or close enough to it), then return the same error as the doctest returns (i.e., some scipy error).



---

archive/issue_comments_026267.json:
```json
{
    "body": "patch against Sage 3.2.rc1",
    "created_at": "2008-11-16T09:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26267",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

patch against Sage 3.2.rc1



---

archive/issue_comments_026268.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[4502-crude_hack.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-crude_hack.patch.gz)**\n\nWell, this makes the doctest failure go away on my Intel Mac. (I followed the proposal from Jason.)\n\nBut please someone have a look if it is worth the price paid.",
    "created_at": "2008-11-16T09:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26268",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[4502-crude_hack.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-crude_hack.patch.gz)**

Well, this makes the doctest failure go away on my Intel Mac. (I followed the proposal from Jason.)

But please someone have a look if it is worth the price paid.



---

archive/issue_events_050701.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-16T09:54:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50701"
}
```



---

archive/issue_comments_026269.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt fixes the doctest failure for me, too.  One or two questions:\n\nCould the error message \n\n```\nraise ValueError, \"self must be square\" \n```\nbe changed to something like \"matrix must be square\"?  Actually, why is this here?  I get an error message about non-square matrices (I think produced by scipy) before applying the patch.",
    "created_at": "2008-11-16T16:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26269",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

It fixes the doctest failure for me, too.  One or two questions:

Could the error message 

```
raise ValueError, "self must be square" 
```
be changed to something like "matrix must be square"?  Actually, why is this here?  I get an error message about non-square matrices (I think produced by scipy) before applying the patch.



---

archive/issue_comments_026270.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI don't think this fix is worth the performance penalty, which for me looks like about a 25% hit.  The determinant is not a great measure of singularity.  I think it would be better to just change the doctest.",
    "created_at": "2008-11-18T16:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26270",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<div id="comment:4" align="right">comment:4</div>

I don't think this fix is worth the performance penalty, which for me looks like about a 25% hit.  The determinant is not a great measure of singularity.  I think it would be better to just change the doctest.



---

archive/issue_events_050702.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "title_is": "[with review] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "title_was": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50702"
}
```



---

archive/issue_events_050703.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50703"
}
```



---

archive/issue_events_050704.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50704"
}
```



---

archive/issue_events_050705.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "title_is": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "title_was": "[with review] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50705"
}
```



---

archive/issue_events_050706.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50706"
}
```



---

archive/issue_events_050707.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50707"
}
```



---

archive/issue_comments_026271.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_4502.patch.gz](https://github.com/sagemath/sage/files/ticket4502/trac_4502.patch.gz)**\n\ndoctest changed in trac_4502.patch.  Apply instead of previous patch.",
    "created_at": "2008-11-18T16:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26271",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_4502.patch.gz](https://github.com/sagemath/sage/files/ticket4502/trac_4502.patch.gz)**

doctest changed in trac_4502.patch.  Apply instead of previous patch.



---

archive/issue_comments_026272.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nPositive review on trac_4502.patch\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T17:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26272",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:6" align="right">comment:6</div>

Positive review on trac_4502.patch

Cheers,

Michael



---

archive/issue_events_050708.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T17:01:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50708"
}
```



---

archive/issue_events_050709.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T17:01:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50709"
}
```



---

archive/issue_events_050710.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T17:44:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50710"
}
```



---

archive/issue_events_050711.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T17:44:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50711"
}
```



---

archive/issue_comments_026273.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSorry, I spoke too soon. This needs work since it does not apply as is.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T17:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26273",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:7" align="right">comment:7</div>

Sorry, I spoke too soon. This needs work since it does not apply as is.

Cheers,

Michael



---

archive/issue_comments_026274.json:
```json
{
    "body": "Attachment: **[4502-next_try.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.patch.gz)**\n\npatch against Sage 3.2.rc1; apply only this one",
    "created_at": "2008-11-18T21:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26274",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

Attachment: **[4502-next_try.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.patch.gz)**

patch against Sage 3.2.rc1; apply only this one



---

archive/issue_comments_026275.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nJust changes the failing doctest (and only that single one) to be #random, and should apply cleanly against Sage 3.2.rc1. Now on my box, the doctest for this file passes.",
    "created_at": "2008-11-18T21:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26275",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:8" align="right">comment:8</div>

Just changes the failing doctest (and only that single one) to be #random, and should apply cleanly against Sage 3.2.rc1. Now on my box, the doctest for this file passes.



---

archive/issue_events_050712.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-18T21:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50712"
}
```



---

archive/issue_events_050713.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-18T21:26:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50713"
}
```



---

archive/issue_comments_026276.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n`#random` does not fix it since the exception still gets thrown. I tried it, so that is how I found out. In IRC we concluded to nuke the doctests for now and deal with that once SciPy 0.7 is out.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T21:28:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26276",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:9" align="right">comment:9</div>

`#random` does not fix it since the exception still gets thrown. I tried it, so that is how I found out. In IRC we concluded to nuke the doctests for now and deal with that once SciPy 0.7 is out.

Cheers,

Michael



---

archive/issue_events_050714.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T21:28:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50714"
}
```



---

archive/issue_events_050715.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-18T21:28:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50715"
}
```



---

archive/issue_comments_026277.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHi John,\n>Could the error message\n\n\n```\nraise ValueError, \"self must be square\" \n```\n>be changed to something like \"matrix must be square\"? Actually, why is this here? I get an error message about non-square matrices (I think produced by scipy) before applying the patch.\n\nThis test and error message were copied verbatim from lines 759/760 of that same file (function \"def determinant(self)\"). In my first patch, I introduced the additional calculation of the determinant in the function for inverting the matrix, and I wanted to make sure that all necessary sanity checks were in place.\n\nWould it be possible for you to provide not only a concrete wording, but a new trac ticket with patch, if you like some other wording better for that error message? I'll review it then. (Maybe just removing this test from the .pyx file and relying on scipy producing the error message for us also for determinants on non-square matrices is an option here.)\n\nCheers,\n\ngsw",
    "created_at": "2008-11-18T21:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26277",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:10" align="right">comment:10</div>

Hi John,
>Could the error message


```
raise ValueError, "self must be square" 
```
>be changed to something like "matrix must be square"? Actually, why is this here? I get an error message about non-square matrices (I think produced by scipy) before applying the patch.

This test and error message were copied verbatim from lines 759/760 of that same file (function "def determinant(self)"). In my first patch, I introduced the additional calculation of the determinant in the function for inverting the matrix, and I wanted to make sure that all necessary sanity checks were in place.

Would it be possible for you to provide not only a concrete wording, but a new trac ticket with patch, if you like some other wording better for that error message? I'll review it then. (Maybe just removing this test from the .pyx file and relying on scipy producing the error message for us also for determinants on non-square matrices is an option here.)

Cheers,

gsw



---

archive/issue_comments_026278.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n>#random does not fix it since the exception still gets thrown. I tried it, so that is how I found out. \n\nStrange. So does this mean the doctest passing as follows:\n\n```\nsusanne-webers-computer:~/Public/sage/sage-3.2.rc1/devel/sage georgweber$ sage -t sage/matrix/matrix_double_dense.pyx\nsage -t  devel/sage-test2/sage/matrix/matrix_double_dense.pyx\n         [4.2 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 4.2 seconds\n```\nis not enough here? I'm a bit puzzled, which exception exactly gets \"thrown nevertheless\" and when? I'm fine with nuking the doctest and postponing the issue till scipy 0.7 is there and included, I ask just out of curiosity.",
    "created_at": "2008-11-18T21:48:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26278",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:11" align="right">comment:11</div>

>#random does not fix it since the exception still gets thrown. I tried it, so that is how I found out. 

Strange. So does this mean the doctest passing as follows:

```
susanne-webers-computer:~/Public/sage/sage-3.2.rc1/devel/sage georgweber$ sage -t sage/matrix/matrix_double_dense.pyx
sage -t  devel/sage-test2/sage/matrix/matrix_double_dense.pyx
         [4.2 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.2 seconds
```
is not enough here? I'm a bit puzzled, which exception exactly gets "thrown nevertheless" and when? I'm fine with nuking the doctest and postponing the issue till scipy 0.7 is there and included, I ask just out of curiosity.



---

archive/issue_comments_026279.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWith\n\n```\ndiff -r 50c6651a1286 sage/matrix/matrix_double_dense.pyx\n--- a/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 08:58:27 2008 -0800\n+++ b/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 13:49:26 2008 -0800\n@@ -441,7 +441,7 @@\n             \n             sage: A.determinant() < 10e-12\n             True\n-            sage: ~A\n+            sage: ~A # random\n             Traceback (most recent call last):\n             ...\n             LinAlgError: singular matrix\n```\nI get\n\n```\nsage -t  devel/sage/sage/matrix/matrix_double_dense.pyx     \n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/devel/sage/sage/matrix/matrix_double_dense.pyx\", line 444:\n    sage: print \"ignore this\";  ~A # random\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_15[10]>\", line 1, in <module>\n        print \"ignore this\";  ~A # random###line 444:\n    sage: print \"ignore this\";  ~A # random\n      File \"matrix_double_dense.pyx\", line 460, in sage.matrix.matrix_double_dense.Matrix_double_dense.__invert__ (sage/matrix/matrix_double_dense.c:3878)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/lib/python2.5/site-packages/scipy/linalg/basic.py\", line 306, in inv\n        if info>0: raise LinAlgError, \"singular matrix\"\n    LinAlgError: singular matrix\n**********************************************************************\n1 items had failures:\n   1 of  11 in __main__.example_15\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.2.rc2/tmp/.doctest_matrix_double_dense.py\n         [2.4 s]\nexit code: 1024\n```",
    "created_at": "2008-11-18T21:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26279",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:12" align="right">comment:12</div>

With

```
diff -r 50c6651a1286 sage/matrix/matrix_double_dense.pyx
--- a/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 08:58:27 2008 -0800
+++ b/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 13:49:26 2008 -0800
@@ -441,7 +441,7 @@
             
             sage: A.determinant() < 10e-12
             True
-            sage: ~A
+            sage: ~A # random
             Traceback (most recent call last):
             ...
             LinAlgError: singular matrix
```
I get

```
sage -t  devel/sage/sage/matrix/matrix_double_dense.pyx     
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/devel/sage/sage/matrix/matrix_double_dense.pyx", line 444:
    sage: print "ignore this";  ~A # random
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_15[10]>", line 1, in <module>
        print "ignore this";  ~A # random###line 444:
    sage: print "ignore this";  ~A # random
      File "matrix_double_dense.pyx", line 460, in sage.matrix.matrix_double_dense.Matrix_double_dense.__invert__ (sage/matrix/matrix_double_dense.c:3878)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/lib/python2.5/site-packages/scipy/linalg/basic.py", line 306, in inv
        if info>0: raise LinAlgError, "singular matrix"
    LinAlgError: singular matrix
**********************************************************************
1 items had failures:
   1 of  11 in __main__.example_15
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.2.rc2/tmp/.doctest_matrix_double_dense.py
         [2.4 s]
exit code: 1024
```



---

archive/issue_comments_026280.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAhhh, sorry for the noise --- the exception does not fly on my box because my box believes the matrix would be invertible and provides an inverse matrix --- but on other computers the matrix is not invertible and there, the exception comes up.\n\nWould that not be an issue to enhance the \"#random\" pragma then?\n\nMore precisely: Allowing on certain boxes the calculation to finish (but throw away the result), and on other boxes having an exception (but again throwing the outcome)?\n\nJust point out to me the respective parts of the IRC conversation if all that info is in there ... and if you find the time and have patience to do so ... ;-)",
    "created_at": "2008-11-18T21:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26280",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:13" align="right">comment:13</div>

Ahhh, sorry for the noise --- the exception does not fly on my box because my box believes the matrix would be invertible and provides an inverse matrix --- but on other computers the matrix is not invertible and there, the exception comes up.

Would that not be an issue to enhance the "#random" pragma then?

More precisely: Allowing on certain boxes the calculation to finish (but throw away the result), and on other boxes having an exception (but again throwing the outcome)?

Just point out to me the respective parts of the IRC conversation if all that info is in there ... and if you find the time and have patience to do so ... ;-)



---

archive/issue_comments_026281.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe issue is the following:\n\n```\n[10:34am] wstein|afk: mabshoff -- all that #random does is the following.\n[10:35am] wstein|afk: sage: foo # random\n[10:35am] wstein|afk: gets replaced by\n[10:35am] wstein|afk: sage: _ = foo\n[10:35am] wstein|afk: That's it.\n[10:35am] mabshoff: mhh\n[10:35am] wstein|afk: So it won't work at all with exceptions.\n[10:35am] wstein|afk: Better might be:\n[10:35am] wstein|afk: sage: foo # random\n[10:35am] wstein|afk: gets replaced by\n[10:35am] wstein|afk: sage: foo\n[10:35am] wstein|afk: ...\n[10:35am] wstein|afk: If that worked.\n[10:35am] wstein|afk: I didn't know about ... when I wrote # random.\n```\nThe goal now is to get 3.2 out and the easiest way to do this is to nuke the affected doctests and then deal with `#random` properly in 3.2.1.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T22:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26281",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:14" align="right">comment:14</div>

The issue is the following:

```
[10:34am] wstein|afk: mabshoff -- all that #random does is the following.
[10:35am] wstein|afk: sage: foo # random
[10:35am] wstein|afk: gets replaced by
[10:35am] wstein|afk: sage: _ = foo
[10:35am] wstein|afk: That's it.
[10:35am] mabshoff: mhh
[10:35am] wstein|afk: So it won't work at all with exceptions.
[10:35am] wstein|afk: Better might be:
[10:35am] wstein|afk: sage: foo # random
[10:35am] wstein|afk: gets replaced by
[10:35am] wstein|afk: sage: foo
[10:35am] wstein|afk: ...
[10:35am] wstein|afk: If that worked.
[10:35am] wstein|afk: I didn't know about ... when I wrote # random.
```
The goal now is to get 3.2 out and the easiest way to do this is to nuke the affected doctests and then deal with `#random` properly in 3.2.1.

Cheers,

Michael



---

archive/issue_comments_026282.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks a lot!!!",
    "created_at": "2008-11-18T22:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26282",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks a lot!!!



---

archive/issue_comments_026283.json:
```json
{
    "body": "Attachment: **[4502-next_try.2.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.2.patch.gz)**\n\napply only this one (doctest just nuked)",
    "created_at": "2008-11-18T22:17:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26283",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

Attachment: **[4502-next_try.2.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.2.patch.gz)**

apply only this one (doctest just nuked)



---

archive/issue_comments_026284.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIs it that what you mean by \"nuke\"ing?",
    "created_at": "2008-11-18T22:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26284",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:16" align="right">comment:16</div>

Is it that what you mean by "nuke"ing?



---

archive/issue_events_050716.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-18T22:19:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50716"
}
```



---

archive/issue_events_050717.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-18T22:19:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50717"
}
```



---

archive/issue_comments_026285.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYes, but two things:\n\n* a comment would be nice that the issue needs to be fixed with a reference to the ticket\n* The other test right before, i.e. \"sage: A.inverse().det()\" also needs to be commented out\n\nOnce the above two happen with a new patch I will give this a positive review.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T22:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26285",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:17" align="right">comment:17</div>

Yes, but two things:

* a comment would be nice that the issue needs to be fixed with a reference to the ticket
* The other test right before, i.e. "sage: A.inverse().det()" also needs to be commented out

Once the above two happen with a new patch I will give this a positive review.

Cheers,

Michael



---

archive/issue_comments_026286.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOK, no problem. (Except for the time it will take --- another 12 hours or so till I am back home.)",
    "created_at": "2008-11-19T07:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26286",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<div id="comment:18" align="right">comment:18</div>

OK, no problem. (Except for the time it will take --- another 12 hours or so till I am back home.)



---

archive/issue_comments_026287.json:
```json
{
    "body": "Attachment: **[4502-next_try.3.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.3.patch.gz)**\n\naddressing the reviewers wishes (hopefully)",
    "created_at": "2008-11-19T18:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26287",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

Attachment: **[4502-next_try.3.patch.gz](https://github.com/sagemath/sage/files/ticket4502/4502-next_try.3.patch.gz)**

addressing the reviewers wishes (hopefully)



---

archive/issue_events_050718.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2008-11-19T18:08:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "title_is": "[with even newer patch] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "title_was": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50718"
}
```



---

archive/issue_events_050719.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "title_is": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "title_was": "[with even newer patch] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50719"
}
```



---

archive/issue_events_050720.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50720"
}
```



---

archive/issue_events_050721.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50721"
}
```



---

archive/issue_comments_026288.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPositive review for 4502-next_try.3.patch. Thanks.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-19T19:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26288",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:20" align="right">comment:20</div>

Positive review for 4502-next_try.3.patch. Thanks.

Cheers,

Michael



---

archive/issue_events_050722.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-19T19:44:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50722"
}
```



---

archive/issue_events_050723.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-19T19:44:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4502#event-50723"
}
```



---

archive/issue_comments_026289.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nMerged in Sage 3.2.rc2",
    "created_at": "2008-11-19T19:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4502#issuecomment-26289",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:21" align="right">comment:21</div>

Merged in Sage 3.2.rc2
