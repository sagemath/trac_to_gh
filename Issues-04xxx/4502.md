# Issue 4502: numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix

archive/issues_004502.json:
```json
{
    "body": "(This has only been reported on intel macs running 10.4 or 10.5.)\n\nFrom [sage-devel](http://groups.google.com/group/sage-devel/browse_frm/thread/fae59a9a9a53b8c0):\n\n```\nsage: A = matrix(RDF,3,range(1,10));A\n\n[1.0 2.0 3.0]\n[4.0 5.0 6.0]\n[7.0 8.0 9.0]\nsage: A.determinant()\n0.0\nsage: -A\n\n[-1.0 -2.0 -3.0]\n[-4.0 -5.0 -6.0]\n[-7.0 -8.0 -9.0]\nsage: b = A.numpy(); b\n\narray([[ 1.,  2.,  3.],\n       [ 4.,  5.,  6.],\n       [ 7.,  8.,  9.]])\nsage: import scipy\nsage: import scipy.linalg\nsage: scipy.linalg.det(b)\n0.0\nsage: scipy.linalg.inv(b)\n\narray([[ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15],\n       [  9.00719925e+15,  -1.80143985e+16,   9.00719925e+15],\n       [ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15]])\n```\n\nThis leads to a doctest failure for `matrix_double_dense.py`.\n\n**Keywords:** numerical noise, matrix\n\nIssue created by migration from https://trac.sagemath.org/ticket/4502\n\n",
    "closed_at": "2008-11-19T19:44:24Z",
    "created_at": "2008-11-12T17:57:19Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2",
    "title": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4502",
    "user": "https://github.com/jhpalmieri"
}
```
(This has only been reported on intel macs running 10.4 or 10.5.)

From [sage-devel](http://groups.google.com/group/sage-devel/browse_frm/thread/fae59a9a9a53b8c0):

```
sage: A = matrix(RDF,3,range(1,10));A

[1.0 2.0 3.0]
[4.0 5.0 6.0]
[7.0 8.0 9.0]
sage: A.determinant()
0.0
sage: -A

[-1.0 -2.0 -3.0]
[-4.0 -5.0 -6.0]
[-7.0 -8.0 -9.0]
sage: b = A.numpy(); b

array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.],
       [ 7.,  8.,  9.]])
sage: import scipy
sage: import scipy.linalg
sage: scipy.linalg.det(b)
0.0
sage: scipy.linalg.inv(b)

array([[ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15],
       [  9.00719925e+15,  -1.80143985e+16,   9.00719925e+15],
       [ -4.50359963e+15,   9.00719925e+15,  -4.50359963e+15]])
```

This leads to a doctest failure for `matrix_double_dense.py`.

**Keywords:** numerical noise, matrix

Issue created by migration from https://trac.sagemath.org/ticket/4502





---

archive/issue_comments_027896.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think the easiest way to avoid this (until we update to the latest scipy and test this again) is to check the scipy.linalg.det explicitly before attempting doing an inverse.  If that determinant is zero (or close enough to it), then return the same error as the doctest returns (i.e., some scipy error).",
    "created_at": "2008-11-14T05:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27896",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
I think the easiest way to avoid this (until we update to the latest scipy and test this again) is to check the scipy.linalg.det explicitly before attempting doing an inverse.  If that determinant is zero (or close enough to it), then return the same error as the doctest returns (i.e., some scipy error).



---

archive/issue_comments_027897.json:
```json
{
    "body": "patch against Sage 3.2.rc1",
    "created_at": "2008-11-16T09:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27897",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

patch against Sage 3.2.rc1



---

archive/attachments_004884.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "4502-crude_hack.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4502/4502-crude_hack.patch",
    "created_at": "2008-11-16T09:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```



---

archive/issue_comments_027898.json:
```json
{
    "body": "<a id='comment:2'></a>\nWell, this makes the doctest failure go away on my Intel Mac. (I followed the proposal from Jason.)\n\nBut please someone have a look if it is worth the price paid.",
    "created_at": "2008-11-16T09:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27898",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:2'></a>
Well, this makes the doctest failure go away on my Intel Mac. (I followed the proposal from Jason.)

But please someone have a look if it is worth the price paid.



---

archive/issue_events_027124.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-16T09:54:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27124"
}
```



---

archive/issue_comments_027899.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt fixes the doctest failure for me, too.  One or two questions:\n\nCould the error message \n\n```\nraise ValueError, \"self must be square\" \n```\nbe changed to something like \"matrix must be square\"?  Actually, why is this here?  I get an error message about non-square matrices (I think produced by scipy) before applying the patch.",
    "created_at": "2008-11-16T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27899",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
It fixes the doctest failure for me, too.  One or two questions:

Could the error message 

```
raise ValueError, "self must be square" 
```
be changed to something like "matrix must be square"?  Actually, why is this here?  I get an error message about non-square matrices (I think produced by scipy) before applying the patch.



---

archive/issue_comments_027900.json:
```json
{
    "body": "<a id='comment:4'></a>\nI don't think this fix is worth the performance penalty, which for me looks like about a 25% hit.  The determinant is not a great measure of singularity.  I think it would be better to just change the doctest.",
    "created_at": "2008-11-18T16:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27900",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:4'></a>
I don't think this fix is worth the performance penalty, which for me looks like about a 25% hit.  The determinant is not a great measure of singularity.  I think it would be better to just change the doctest.



---

archive/issue_events_027125.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "rename": {
        "from": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
        "to": "[with review] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27125"
}
```



---

archive/issue_events_027126.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27126"
}
```



---

archive/issue_events_027127.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-11-18T16:46:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27127"
}
```



---

archive/issue_events_027128.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "rename": {
        "from": "[with review] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
        "to": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27128"
}
```



---

archive/issue_events_027129.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27129"
}
```



---

archive/issue_events_027130.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2008-11-18T16:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27130"
}
```



---

archive/attachments_004885.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_4502.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4502/trac_4502.patch",
    "created_at": "2008-11-18T16:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_027901.json:
```json
{
    "body": "<a id='comment:5'></a>\ndoctest changed in trac_4502.patch.  Apply instead of previous patch.",
    "created_at": "2008-11-18T16:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27901",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
doctest changed in trac_4502.patch.  Apply instead of previous patch.



---

archive/issue_comments_027902.json:
```json
{
    "body": "<a id='comment:6'></a>\nPositive review on trac_4502.patch\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T17:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27902",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Positive review on trac_4502.patch

Cheers,

Michael



---

archive/issue_events_027131.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T17:01:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27131"
}
```



---

archive/issue_events_027132.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T17:01:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27132"
}
```



---

archive/issue_events_027133.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T17:44:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27133"
}
```



---

archive/issue_events_027134.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T17:44:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27134"
}
```



---

archive/issue_comments_027903.json:
```json
{
    "body": "<a id='comment:7'></a>\nSorry, I spoke too soon. This needs work since it does not apply as is.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T17:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27903",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
Sorry, I spoke too soon. This needs work since it does not apply as is.

Cheers,

Michael



---

archive/attachments_004886.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "4502-next_try.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4502/4502-next_try.patch",
    "created_at": "2008-11-18T21:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```



---

archive/issue_comments_027904.json:
```json
{
    "body": "patch against Sage 3.2.rc1; apply only this one",
    "created_at": "2008-11-18T21:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27904",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

patch against Sage 3.2.rc1; apply only this one



---

archive/issue_comments_027905.json:
```json
{
    "body": "<a id='comment:8'></a>\nJust changes the failing doctest (and only that single one) to be #random, and should apply cleanly against Sage 3.2.rc1. Now on my box, the doctest for this file passes.",
    "created_at": "2008-11-18T21:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27905",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:8'></a>
Just changes the failing doctest (and only that single one) to be #random, and should apply cleanly against Sage 3.2.rc1. Now on my box, the doctest for this file passes.



---

archive/issue_events_027135.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-18T21:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27135"
}
```



---

archive/issue_events_027136.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-18T21:26:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27136"
}
```



---

archive/issue_comments_027906.json:
```json
{
    "body": "<a id='comment:9'></a>\n`#random` does not fix it since the exception still gets thrown. I tried it, so that is how I found out. In IRC we concluded to nuke the doctests for now and deal with that once SciPy 0.7 is out.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T21:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27906",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
`#random` does not fix it since the exception still gets thrown. I tried it, so that is how I found out. In IRC we concluded to nuke the doctests for now and deal with that once SciPy 0.7 is out.

Cheers,

Michael



---

archive/issue_events_027137.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T21:28:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27137"
}
```



---

archive/issue_events_027138.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-18T21:28:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27138"
}
```



---

archive/issue_comments_027907.json:
```json
{
    "body": "<a id='comment:10'></a>\nHi John,\n>Could the error message\n\n\n```\n raise ValueError, \"self must be square\" \n```\n>be changed to something like \"matrix must be square\"? Actually, why is this here? I get an error message about non-square matrices (I think produced by scipy) before applying the patch.\n\n\nThis test and error message were copied verbatim from lines 759/760 of that same file (function \"def determinant(self)\"). In my first patch, I introduced the additional calculation of the determinant in the function for inverting the matrix, and I wanted to make sure that all necessary sanity checks were in place.\n\nWould it be possible for you to provide not only a concrete wording, but a new trac ticket with patch, if you like some other wording better for that error message? I'll review it then. (Maybe just removing this test from the .pyx file and relying on scipy producing the error message for us also for determinants on non-square matrices is an option here.)\n\nCheers,\n\ngsw",
    "created_at": "2008-11-18T21:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27907",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:10'></a>
Hi John,
>Could the error message


```
 raise ValueError, "self must be square" 
```
>be changed to something like "matrix must be square"? Actually, why is this here? I get an error message about non-square matrices (I think produced by scipy) before applying the patch.


This test and error message were copied verbatim from lines 759/760 of that same file (function "def determinant(self)"). In my first patch, I introduced the additional calculation of the determinant in the function for inverting the matrix, and I wanted to make sure that all necessary sanity checks were in place.

Would it be possible for you to provide not only a concrete wording, but a new trac ticket with patch, if you like some other wording better for that error message? I'll review it then. (Maybe just removing this test from the .pyx file and relying on scipy producing the error message for us also for determinants on non-square matrices is an option here.)

Cheers,

gsw



---

archive/issue_comments_027908.json:
```json
{
    "body": "<a id='comment:11'></a>\n>#random does not fix it since the exception still gets thrown. I tried it, so that is how I found out. \nStrange. So does this mean the doctest passing as follows:\n\n```\nsusanne-webers-computer:~/Public/sage/sage-3.2.rc1/devel/sage georgweber$ sage -t sage/matrix/matrix_double_dense.pyx\nsage -t  devel/sage-test2/sage/matrix/matrix_double_dense.pyx\n         [4.2 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 4.2 seconds\n```\nis not enough here? I'm a bit puzzled, which exception exactly gets \"thrown nevertheless\" and when? I'm fine with nuking the doctest and postponing the issue till scipy 0.7 is there and included, I ask just out of curiosity.",
    "created_at": "2008-11-18T21:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27908",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:11'></a>
>#random does not fix it since the exception still gets thrown. I tried it, so that is how I found out. 
Strange. So does this mean the doctest passing as follows:

```
susanne-webers-computer:~/Public/sage/sage-3.2.rc1/devel/sage georgweber$ sage -t sage/matrix/matrix_double_dense.pyx
sage -t  devel/sage-test2/sage/matrix/matrix_double_dense.pyx
         [4.2 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.2 seconds
```
is not enough here? I'm a bit puzzled, which exception exactly gets "thrown nevertheless" and when? I'm fine with nuking the doctest and postponing the issue till scipy 0.7 is there and included, I ask just out of curiosity.



---

archive/issue_comments_027909.json:
```json
{
    "body": "<a id='comment:12'></a>\nWith\n\n```\ndiff -r 50c6651a1286 sage/matrix/matrix_double_dense.pyx\n--- a/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 08:58:27 2008 -0800\n+++ b/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 13:49:26 2008 -0800\n@@ -441,7 +441,7 @@\n             \n             sage: A.determinant() < 10e-12\n             True\n-            sage: ~A\n+            sage: ~A # random\n             Traceback (most recent call last):\n             ...\n             LinAlgError: singular matrix\n```\nI get\n\n```\nsage -t  devel/sage/sage/matrix/matrix_double_dense.pyx     \n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/devel/sage/sage/matrix/matrix_double_dense.pyx\", line 444:\n    sage: print \"ignore this\";  ~A # random\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_15[10]>\", line 1, in <module>\n        print \"ignore this\";  ~A # random###line 444:\n    sage: print \"ignore this\";  ~A # random\n      File \"matrix_double_dense.pyx\", line 460, in sage.matrix.matrix_double_dense.Matrix_double_dense.__invert__ (sage/matrix/matrix_double_dense.c:3878)\n      File \"/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/lib/python2.5/site-packages/scipy/linalg/basic.py\", line 306, in inv\n        if info>0: raise LinAlgError, \"singular matrix\"\n    LinAlgError: singular matrix\n**********************************************************************\n1 items had failures:\n   1 of  11 in __main__.example_15\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.2.rc2/tmp/.doctest_matrix_double_dense.py\n         [2.4 s]\nexit code: 1024\n```",
    "created_at": "2008-11-18T21:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27909",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:12'></a>
With

```
diff -r 50c6651a1286 sage/matrix/matrix_double_dense.pyx
--- a/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 08:58:27 2008 -0800
+++ b/sage/matrix/matrix_double_dense.pyx       Tue Nov 18 13:49:26 2008 -0800
@@ -441,7 +441,7 @@
             
             sage: A.determinant() < 10e-12
             True
-            sage: ~A
+            sage: ~A # random
             Traceback (most recent call last):
             ...
             LinAlgError: singular matrix
```
I get

```
sage -t  devel/sage/sage/matrix/matrix_double_dense.pyx     
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/devel/sage/sage/matrix/matrix_double_dense.pyx", line 444:
    sage: print "ignore this";  ~A # random
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_15[10]>", line 1, in <module>
        print "ignore this";  ~A # random###line 444:
    sage: print "ignore this";  ~A # random
      File "matrix_double_dense.pyx", line 460, in sage.matrix.matrix_double_dense.Matrix_double_dense.__invert__ (sage/matrix/matrix_double_dense.c:3878)
      File "/scratch/mabshoff/release-cycle/sage-3.2.rc2/local/lib/python2.5/site-packages/scipy/linalg/basic.py", line 306, in inv
        if info>0: raise LinAlgError, "singular matrix"
    LinAlgError: singular matrix
**********************************************************************
1 items had failures:
   1 of  11 in __main__.example_15
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.2.rc2/tmp/.doctest_matrix_double_dense.py
         [2.4 s]
exit code: 1024
```



---

archive/issue_comments_027910.json:
```json
{
    "body": "<a id='comment:13'></a>\nAhhh, sorry for the noise --- the exception does not fly on my box because my box believes the matrix would be invertible and provides an inverse matrix --- but on other computers the matrix is not invertible and there, the exception comes up.\n\nWould that not be an issue to enhance the \"#random\" pragma then?\n\nMore precisely: Allowing on certain boxes the calculation to finish (but throw away the result), and on other boxes having an exception (but again throwing the outcome)?\n\nJust point out to me the respective parts of the IRC conversation if all that info is in there ... and if you find the time and have patience to do so ... ;-)",
    "created_at": "2008-11-18T21:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27910",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:13'></a>
Ahhh, sorry for the noise --- the exception does not fly on my box because my box believes the matrix would be invertible and provides an inverse matrix --- but on other computers the matrix is not invertible and there, the exception comes up.

Would that not be an issue to enhance the "#random" pragma then?

More precisely: Allowing on certain boxes the calculation to finish (but throw away the result), and on other boxes having an exception (but again throwing the outcome)?

Just point out to me the respective parts of the IRC conversation if all that info is in there ... and if you find the time and have patience to do so ... ;-)



---

archive/issue_comments_027911.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe issue is the following:\n\n```\n[10:34am] wstein|afk: mabshoff -- all that #random does is the following.\n[10:35am] wstein|afk: sage: foo # random\n[10:35am] wstein|afk: gets replaced by\n[10:35am] wstein|afk: sage: _ = foo\n[10:35am] wstein|afk: That's it.\n[10:35am] mabshoff: mhh\n[10:35am] wstein|afk: So it won't work at all with exceptions.\n[10:35am] wstein|afk: Better might be:\n[10:35am] wstein|afk: sage: foo # random\n[10:35am] wstein|afk: gets replaced by\n[10:35am] wstein|afk: sage: foo\n[10:35am] wstein|afk: ...\n[10:35am] wstein|afk: If that worked.\n[10:35am] wstein|afk: I didn't know about ... when I wrote # random.\n```\nThe goal now is to get 3.2 out and the easiest way to do this is to nuke the affected doctests and then deal with `#random` properly in 3.2.1.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T22:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27911",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>
The issue is the following:

```
[10:34am] wstein|afk: mabshoff -- all that #random does is the following.
[10:35am] wstein|afk: sage: foo # random
[10:35am] wstein|afk: gets replaced by
[10:35am] wstein|afk: sage: _ = foo
[10:35am] wstein|afk: That's it.
[10:35am] mabshoff: mhh
[10:35am] wstein|afk: So it won't work at all with exceptions.
[10:35am] wstein|afk: Better might be:
[10:35am] wstein|afk: sage: foo # random
[10:35am] wstein|afk: gets replaced by
[10:35am] wstein|afk: sage: foo
[10:35am] wstein|afk: ...
[10:35am] wstein|afk: If that worked.
[10:35am] wstein|afk: I didn't know about ... when I wrote # random.
```
The goal now is to get 3.2 out and the easiest way to do this is to nuke the affected doctests and then deal with `#random` properly in 3.2.1.

Cheers,

Michael



---

archive/issue_comments_027912.json:
```json
{
    "body": "<a id='comment:15'></a>\nThanks a lot!!!",
    "created_at": "2008-11-18T22:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27912",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:15'></a>
Thanks a lot!!!



---

archive/attachments_004887.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "4502-next_try.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4502/4502-next_try.2.patch",
    "created_at": "2008-11-18T22:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```



---

archive/issue_comments_027913.json:
```json
{
    "body": "apply only this one (doctest just nuked)",
    "created_at": "2008-11-18T22:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27913",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

apply only this one (doctest just nuked)



---

archive/issue_comments_027914.json:
```json
{
    "body": "<a id='comment:16'></a>\nIs it that what you mean by \"nuke\"ing?",
    "created_at": "2008-11-18T22:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27914",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:16'></a>
Is it that what you mean by "nuke"ing?



---

archive/issue_events_027139.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-18T22:19:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27139"
}
```



---

archive/issue_events_027140.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-18T22:19:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27140"
}
```



---

archive/issue_comments_027915.json:
```json
{
    "body": "<a id='comment:17'></a>\nYes, but two things:\n\n* a comment would be nice that the issue needs to be fixed with a reference to the ticket\n* The other test right before, i.e. \"sage: A.inverse().det()\" also needs to be commented out\n\nOnce the above two happen with a new patch I will give this a positive review.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-18T22:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27915",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:17'></a>
Yes, but two things:

* a comment would be nice that the issue needs to be fixed with a reference to the ticket
* The other test right before, i.e. "sage: A.inverse().det()" also needs to be commented out

Once the above two happen with a new patch I will give this a positive review.

Cheers,

Michael



---

archive/issue_comments_027916.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK, no problem. (Except for the time it will take --- another 12 hours or so till I am back home.)",
    "created_at": "2008-11-19T07:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27916",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:18'></a>
OK, no problem. (Except for the time it will take --- another 12 hours or so till I am back home.)



---

archive/attachments_004888.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "4502-next_try.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4502/4502-next_try.3.patch",
    "created_at": "2008-11-19T18:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```



---

archive/issue_comments_027917.json:
```json
{
    "body": "addressing the reviewers wishes (hopefully)",
    "created_at": "2008-11-19T18:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27917",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

addressing the reviewers wishes (hopefully)



---

archive/issue_events_027141.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2008-11-19T18:08:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "rename": {
        "from": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
        "to": "[with even newer patch] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27141"
}
```



---

archive/issue_events_027142.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "rename": {
        "from": "[with even newer patch] numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix",
        "to": "numerical noise in matrix_double_dense on intel mac os X 10.5: inverting a singular matrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27142"
}
```



---

archive/issue_events_027143.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27143"
}
```



---

archive/issue_events_027144.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-19T19:43:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27144"
}
```



---

archive/issue_comments_027918.json:
```json
{
    "body": "<a id='comment:20'></a>\nPositive review for 4502-next_try.3.patch. Thanks.\n\nCheers,\n\nMichael",
    "created_at": "2008-11-19T19:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27918",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:20'></a>
Positive review for 4502-next_try.3.patch. Thanks.

Cheers,

Michael



---

archive/issue_events_027145.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-19T19:44:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27145"
}
```



---

archive/issue_events_027146.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-19T19:44:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4502#event-27146"
}
```



---

archive/issue_comments_027919.json:
```json
{
    "body": "<a id='comment:21'></a>\nMerged in Sage 3.2.rc2",
    "created_at": "2008-11-19T19:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4502#issuecomment-27919",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:21'></a>
Merged in Sage 3.2.rc2
