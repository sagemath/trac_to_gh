# Issue 4756: eigenmatrix_right totally broken

archive/issues_004756.json:
```json
{
    "body": "```\nsage: a = matrix(CDF,2,[1,2,4,7])\nsage: a.eigenmatrix_right()\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n\n/Users/wstein/sage/build/sage-3.2.2.alpha0/<ipython console> in <module>()\n\n/Users/wstein/sage/build/sage-3.2.2.alpha0/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_right (sage/matrix/matrix2.c:18170)()\n\n/Users/wstein/sage/build/sage-3.2.2.alpha0/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_left (sage/matrix/matrix2.c:17965)()\n\nIndexError: list index out of range\n```\n\nAssignee: @williamstein\n\nCC:  @jasongrout\n\nResolution: fixed\n\nAuthor: Rob Beezer\n\nReviewer: Alex Ghitza\n\nMerged: sage-4.4.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/4756\n\n",
    "closed_at": "2010-04-15T20:12:15Z",
    "created_at": "2008-12-11T05:11:14Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4",
    "title": "eigenmatrix_right totally broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4756",
    "user": "https://github.com/williamstein"
}
```
```
sage: a = matrix(CDF,2,[1,2,4,7])
sage: a.eigenmatrix_right()
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)

/Users/wstein/sage/build/sage-3.2.2.alpha0/<ipython console> in <module>()

/Users/wstein/sage/build/sage-3.2.2.alpha0/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_right (sage/matrix/matrix2.c:18170)()

/Users/wstein/sage/build/sage-3.2.2.alpha0/local/lib/python2.5/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.eigenmatrix_left (sage/matrix/matrix2.c:17965)()

IndexError: list index out of range
```

Assignee: @williamstein

CC:  @jasongrout

Resolution: fixed

Author: Rob Beezer

Reviewer: Alex Ghitza

Merged: sage-4.4.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/4756





---

archive/issue_comments_036892.json:
```json
{
    "body": "<a id='comment:1'></a>This is because the eigenvectors_left and eigenvectors_right for CDF and RDF matrices returns the data in a way that is totally incompatible with what the parent is expecting.\n\nI can make a patch for this once I have a 3.2.2alpha1 build.  Otherwise, if Jason would like to do this, I wouldn't object :-)",
    "created_at": "2008-12-11T08:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36892",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>This is because the eigenvectors_left and eigenvectors_right for CDF and RDF matrices returns the data in a way that is totally incompatible with what the parent is expecting.

I can make a patch for this once I have a 3.2.2alpha1 build.  Otherwise, if Jason would like to do this, I wouldn't object :-)



---

archive/issue_comments_036893.json:
```json
{
    "body": "<a id='comment:2'></a>Patch causes `left_eigenvectors()` and `right_eigenvectors()` for CDF and RDF to return eigenvalues and eigenvectors in the same format as for exact matrices.  Then eigenmatrices for these matrices behave as they should.  No attempt is made to identify eigenvalues with multiplicity greater than one.\n\nPatch is failing doctests in the modular form code right now, so will need some more work.",
    "created_at": "2010-01-19T02:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36893",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>Patch causes `left_eigenvectors()` and `right_eigenvectors()` for CDF and RDF to return eigenvalues and eigenvectors in the same format as for exact matrices.  Then eigenmatrices for these matrices behave as they should.  No attempt is made to identify eigenvalues with multiplicity greater than one.

Patch is failing doctests in the modular form code right now, so will need some more work.



---

archive/issue_comments_036894.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-01-19T02:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36894",
    "user": "https://github.com/rbeezer"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_036895.json:
```json
{
    "body": "Attachment [trac_4756_eigenmatrices_double.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756_eigenmatrices_double.patch) by @rbeezer created at 2010-01-19 02:47:05",
    "created_at": "2010-01-19T02:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36895",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_4756_eigenmatrices_double.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756_eigenmatrices_double.patch) by @rbeezer created at 2010-01-19 02:47:05



---

archive/issue_comments_036896.json:
```json
{
    "body": "Self-contained patch, apply only this",
    "created_at": "2010-01-23T23:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36896",
    "user": "https://github.com/rbeezer"
}
```

Self-contained patch, apply only this



---

archive/issue_comments_036897.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_4756-double-eigen.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.patch) by @rbeezer created at 2010-01-23 23:41:49\n\nThis patch fixes the bug and generally brings double-precision eigenvectors up-to-date.\n\n`left_eigenvectors` and `right_eigenvectors` now return their results in the same format as for exact matrices, so routines like `eigenmatrix_right` can digest the results properly.\n\nConsequently, `eigenspaces_left` was adjusted for this new format.  There was no `eigenspaces_right`, now there is.\n\nThe changed code in `modular/modform/numerical.py` simply adjusts for the new format to allow doctests to pass and is probably sub-optimal.  There is a bug nearby, so this will be addressed on #8018.\n\nDoctests:  I had some strange behavior for zero eigenvalues (ie very, very small eigenvalues), so the doctests avoid these.  For these eigenvalues, the tests would fail on a first run, but would pass on all subsequent runs (or vice-versa).  This was observed on my own machine and  boxen.math.washington.edu.  So I've avoided these eigenvalues by selecting certain ones in the doctests.\n\nDocumentation:  documentation was tested for these four functions via notebook introspection.  The rest of the file needs attention before it can go into the documentation, see #8046.",
    "created_at": "2010-01-23T23:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36897",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>Attachment [trac_4756-double-eigen.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.patch) by @rbeezer created at 2010-01-23 23:41:49

This patch fixes the bug and generally brings double-precision eigenvectors up-to-date.

`left_eigenvectors` and `right_eigenvectors` now return their results in the same format as for exact matrices, so routines like `eigenmatrix_right` can digest the results properly.

Consequently, `eigenspaces_left` was adjusted for this new format.  There was no `eigenspaces_right`, now there is.

The changed code in `modular/modform/numerical.py` simply adjusts for the new format to allow doctests to pass and is probably sub-optimal.  There is a bug nearby, so this will be addressed on #8018.

Doctests:  I had some strange behavior for zero eigenvalues (ie very, very small eigenvalues), so the doctests avoid these.  For these eigenvalues, the tests would fail on a first run, but would pass on all subsequent runs (or vice-versa).  This was observed on my own machine and  boxen.math.washington.edu.  So I've avoided these eigenvalues by selecting certain ones in the doctests.

Documentation:  documentation was tested for these four functions via notebook introspection.  The rest of the file needs attention before it can go into the documentation, see #8046.



---

archive/issue_comments_036898.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-24T01:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36898",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_036899.json:
```json
{
    "body": "<a id='comment:5'></a>Great job!\n\nI think these changes would make the code easier to read:\n\n```\n \t662\t        for k in range(len(spectrum)): \n \t663\t            evalue = spectrum[k][0] \n \t664\t            evector = spectrum[k][1][0] \n \t665\t            pairs.append((evalue, evector.parent().span_of_basis([evector],check=False))) \n\nchanged to\n\nfor eval,evectors in spectrum:\n    evec = evectors[0]\n    evector = evec.parent().span_of_basis([evec],check=False)\n    pairs.append((evalue, evector))\n\n```\n\n(similarly on lines 722-725)\n\nAlso:\n\n```\nB = matrix(CDF, [spectrum[i][1][0] for i in range(len(spectrum))]).transpose() \n\nchanged to\n\nB = matrix(CDF, [evecs[0] for _,evecs in spectrum]).transpose() \n\n```",
    "created_at": "2010-01-24T01:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36899",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>Great job!

I think these changes would make the code easier to read:

```
 	662	        for k in range(len(spectrum)): 
 	663	            evalue = spectrum[k][0] 
 	664	            evector = spectrum[k][1][0] 
 	665	            pairs.append((evalue, evector.parent().span_of_basis([evector],check=False))) 

changed to

for eval,evectors in spectrum:
    evec = evectors[0]
    evector = evec.parent().span_of_basis([evec],check=False)
    pairs.append((evalue, evector))

```

(similarly on lines 722-725)

Also:

```
B = matrix(CDF, [spectrum[i][1][0] for i in range(len(spectrum))]).transpose() 

changed to

B = matrix(CDF, [evecs[0] for _,evecs in spectrum]).transpose() 

```



---

archive/issue_comments_036900.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-24T01:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36900",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_036901.json:
```json
{
    "body": "<a id='comment:7'></a>Jason,\n\nThanks for helping me be more Pythonic.\n\nThe bit in the modular form module is going to be replaced in #8018 by totally different code, so I didn't change that.  First suggestion (in spirit) has been incorporated in updated patch.\n\nRob",
    "created_at": "2010-01-24T04:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36901",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>Jason,

Thanks for helping me be more Pythonic.

The bit in the modular form module is going to be replaced in #8018 by totally different code, so I didn't change that.  First suggestion (in spirit) has been incorporated in updated patch.

Rob



---

archive/issue_comments_036902.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-24T04:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36902",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_036903.json:
```json
{
    "body": "Self-contained patch, apply only this.",
    "created_at": "2010-01-24T04:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36903",
    "user": "https://github.com/rbeezer"
}
```

Self-contained patch, apply only this.



---

archive/issue_comments_036904.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-24T05:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36904",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_036905.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [trac_4756-double-eigen.2.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.2.patch) by @rbeezer created at 2010-01-24 05:13:23\n\nI've got some doctests failing on another machine due to \"zero\" eigenvalues, so I'm going to rework some of the doctests.",
    "created_at": "2010-01-24T05:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36905",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>Attachment [trac_4756-double-eigen.2.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.2.patch) by @rbeezer created at 2010-01-24 05:13:23

I've got some doctests failing on another machine due to "zero" eigenvalues, so I'm going to rework some of the doctests.



---

archive/issue_comments_036906.json:
```json
{
    "body": "Attachment [trac_4756-double-eigen.3.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.3.patch) by @rbeezer created at 2010-01-24 06:34:43\n\nSelf conatined",
    "created_at": "2010-01-24T06:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36906",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_4756-double-eigen.3.patch](tarball://root/attachments/some-uuid/ticket4756/trac_4756-double-eigen.3.patch) by @rbeezer created at 2010-01-24 06:34:43

Self conatined



---

archive/issue_comments_036907.json:
```json
{
    "body": "<a id='comment:9'></a>dot-3 patch has better doctests in it, totally avoiding \"zero\" eigenvalues and \"zero\" entries of eigenvectors.  Apply just this one patch.",
    "created_at": "2010-01-24T06:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36907",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>dot-3 patch has better doctests in it, totally avoiding "zero" eigenvalues and "zero" entries of eigenvectors.  Apply just this one patch.



---

archive/issue_comments_036908.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-24T06:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36908",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_036909.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2010-02-22T00:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36909",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_036910.json:
```json
{
    "body": "<a id='comment:10'></a>Has this been checked on Solaris? \n\nThere's general information about building on Solaris at\n\n http://wiki.sagemath.org/solaris\n\nInformation specifically for 't2' at\n\n http://wiki.sagemath.org/devel/Building-Sage-on-the-T5240-t2\n\nBoth the source (4.3.0.1 is the latest to build on Solaris) and a binary which will run on any SPARC can be found at http://www.sagemath.org/download-source.html\n\nDave",
    "created_at": "2010-02-22T00:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36910",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:10'></a>Has this been checked on Solaris? 

There's general information about building on Solaris at

 http://wiki.sagemath.org/solaris

Information specifically for 't2' at

 http://wiki.sagemath.org/devel/Building-Sage-on-the-T5240-t2

Both the source (4.3.0.1 is the latest to build on Solaris) and a binary which will run on any SPARC can be found at http://www.sagemath.org/download-source.html

Dave



---

archive/issue_comments_036911.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2010-03-17T20:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36911",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_036912.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 drkirkby]:\n> Has this been checked on Solaris? \n\n\nHi Dave,\n\nNot that I know of.  I develop with KUbuntu.\n\nMaybe a reviewer with Solaris experience can put it through its paces.  Totally Python, so I'd guess numerical issues might be the only distinction.\n\nThanks,\nRob",
    "created_at": "2010-03-17T20:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36912",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:11'></a>Replying to [comment:10 drkirkby]:
> Has this been checked on Solaris? 


Hi Dave,

Not that I know of.  I develop with KUbuntu.

Maybe a reviewer with Solaris experience can put it through its paces.  Totally Python, so I'd guess numerical issues might be the only distinction.

Thanks,
Rob



---

archive/issue_comments_036913.json:
```json
{
    "body": "<a id='comment:12'></a>Looks good to me.",
    "created_at": "2010-04-03T07:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36913",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:12'></a>Looks good to me.



---

archive/issue_comments_036914.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-04-03T07:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36914",
    "user": "https://github.com/aghitza"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_036915.json:
```json
{
    "body": "<a id='comment:13'></a>Merged \"trac_4756-double-eigen.3.patch\" in 4.4.alpha0",
    "created_at": "2010-04-15T20:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36915",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Merged "trac_4756-double-eigen.3.patch" in 4.4.alpha0



---

archive/issue_events_010878.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-15T20:12:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4756#event-10878"
}
```



---

archive/issue_comments_036916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-04-15T20:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4756#issuecomment-36916",
    "user": "https://github.com/jhpalmieri"
}
```

Resolution: fixed
