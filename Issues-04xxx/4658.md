# Issue 4658: magma -- get rid of redundant caching: just have _magma_init_

archive/issues_004658.json:
```json
{
    "body": "* Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.\n* Add more magma doctests throughout. \n* In some cases there were three totally different caching mechanisms being used.  Cleaned this up.\n* Created a new \"reference\" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. \n* Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. \n* Made a bunch of cython code much shorter/cleaner by using list compressions.\n* Fixed some ints that should be Py_ssize_t's.\n\nTo doctest this apply the one patch to sage >= 3.2.1 and do\n\n```\ncd SAGE_ROOT/devel/sage/sage\nsage -tp 6 -only_optional=magma .\n```\n\nAll doctests should pass on Linux.   On OS X some may fail, due to bugs in Magma (segfaults). \n\nSince this touches code all of the tree it is high priority to get into sage asap. \n\n**Assignee:** @williamstein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4658\n\n",
    "closed_at": "2008-11-30T08:35:50Z",
    "created_at": "2008-11-29T23:50:12Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2.1",
    "title": "magma -- get rid of redundant caching: just have _magma_init_",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4658",
    "user": "https://github.com/williamstein"
}
```
* Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.
* Add more magma doctests throughout. 
* In some cases there were three totally different caching mechanisms being used.  Cleaned this up.
* Created a new "reference" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. 
* Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. 
* Made a bunch of cython code much shorter/cleaner by using list compressions.
* Fixed some ints that should be Py_ssize_t's.

To doctest this apply the one patch to sage >= 3.2.1 and do

```
cd SAGE_ROOT/devel/sage/sage
sage -tp 6 -only_optional=magma .
```

All doctests should pass on Linux.   On OS X some may fail, due to bugs in Magma (segfaults). 

Since this touches code all of the tree it is high priority to get into sage asap. 

**Assignee:** @williamstein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/4658





---

archive/issue_comments_041351.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,24 @@\n+* Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.\n \n+* Add more magma doctests throughout. \n+\n+* In some cases there were three totally different caching mechanisms being used.  Cleaned this up.\n+\n+* Created a new \"reference\" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. \n+\n+* Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. \n+\n+* Made a bunch of cython code much shorter/cleaner by using list compressions.\n+\n+* Fixed some ints that should be Py_ssize_t's.\n+\n+To doctest this apply the one patch to sage >= 3.2.1 and do\n+\n+```\n+cd SAGE_ROOT/devel/sage/sage\n+sage -tp 6 -only_optional=magma .\n+```\n+\n+All doctests should pass on Linux.   On OS X some may fail, due to bugs in Magma (segfaults). \n+\n+Since this touches code all of the tree it is high priority to get into sage asap. \n``````\n",
    "created_at": "2008-11-30T06:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41351",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,24 @@
+* Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.
 
+* Add more magma doctests throughout. 
+
+* In some cases there were three totally different caching mechanisms being used.  Cleaned this up.
+
+* Created a new "reference" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. 
+
+* Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. 
+
+* Made a bunch of cython code much shorter/cleaner by using list compressions.
+
+* Fixed some ints that should be Py_ssize_t's.
+
+To doctest this apply the one patch to sage >= 3.2.1 and do
+
+```
+cd SAGE_ROOT/devel/sage/sage
+sage -tp 6 -only_optional=magma .
+```
+
+All doctests should pass on Linux.   On OS X some may fail, due to bugs in Magma (segfaults). 
+
+Since this touches code all of the tree it is high priority to get into sage asap. 
``````




---

archive/issue_events_013844.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-30T07:12:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "milestone": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4658#event-13844"
}
```



---

archive/issue_comments_041352.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,9 @@\n * Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.\n-\n * Add more magma doctests throughout. \n-\n * In some cases there were three totally different caching mechanisms being used.  Cleaned this up.\n-\n * Created a new \"reference\" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. \n-\n * Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. \n-\n * Made a bunch of cython code much shorter/cleaner by using list compressions.\n-\n * Fixed some ints that should be Py_ssize_t's.\n \n To doctest this apply the one patch to sage >= 3.2.1 and do\n``````\n",
    "created_at": "2008-11-30T07:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41352",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,9 @@
 * Get rid of _magma_ and _magma_convert_. Now there is *only* _magma_init_.  The other two are not necessary.
-
 * Add more magma doctests throughout. 
-
 * In some cases there were three totally different caching mechanisms being used.  Cleaned this up.
-
 * Created a new "reference" system, (see the _ref method), that nicely solves a seemingly difficult issue with objects being freed before they are used. 
-
 * Cache all parents no matter what, even if they don't explicit support caching.  This fixes several subtle cases. 
-
 * Made a bunch of cython code much shorter/cleaner by using list compressions.
-
 * Fixed some ints that should be Py_ssize_t's.
 
 To doctest this apply the one patch to sage >= 3.2.1 and do
``````




---

archive/issue_comments_041353.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-11-30T07:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41353",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_041354.json:
```json
{
    "body": "Attachment [trac_extcode-4658.patch](tarball://root/attachments/some-uuid/ticket4658/trac_extcode-4658.patch) by @williamstein created at 2008-11-30 07:35:48",
    "created_at": "2008-11-30T07:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41354",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_extcode-4658.patch](tarball://root/attachments/some-uuid/ticket4658/trac_extcode-4658.patch) by @williamstein created at 2008-11-30 07:35:48



---

archive/issue_comments_041355.json:
```json
{
    "body": "Attachment [trac_4658-sage.patch](tarball://root/attachments/some-uuid/ticket4658/trac_4658-sage.patch) by @williamstein created at 2008-11-30 07:42:03",
    "created_at": "2008-11-30T07:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41355",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_4658-sage.patch](tarball://root/attachments/some-uuid/ticket4658/trac_4658-sage.patch) by @williamstein created at 2008-11-30 07:42:03



---

archive/issue_comments_041356.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2008-11-30T08:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41356",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_041357.json:
```json
{
    "body": "<a id='comment:4'></a>\nPositive review. I had various discussions with William about this patch while he was writing it. \n\nThe patch passes doctests with a booby trapped magma to flush out doctest failures without magma, it passes standard long doctests as well as -only_optional=magma. \n\nCheers,\n\nMichael",
    "created_at": "2008-11-30T08:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41357",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Positive review. I had various discussions with William about this patch while he was writing it. 

The patch passes doctests with a booby trapped magma to flush out doctest failures without magma, it passes standard long doctests as well as -only_optional=magma. 

Cheers,

Michael



---

archive/issue_comments_041358.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-11-30T08:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41358",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_041359.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged in Sage 3.2.1.rc1",
    "created_at": "2008-11-30T08:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4658#issuecomment-41359",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged in Sage 3.2.1.rc1



---

archive/issue_events_013845.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-11-30T08:35:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4658",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4658#event-13845"
}
```
