# Issue 4721: [with patch; positive review] Indefinite integration for piecewise functions

archive/issues_004721.json:
```json
{
    "body": "It would be nice to be able to do indefinite integration of piecewise functions in Sage.\n\nI've created a patch which does this. I have made the default behavior of the integral() function of a piecewise function be to return the indefinite integral, and the definite integral is returned only when definite=True is supplied.\n\n```\nsage: pw = Piecewise([[(0,1), x*2], [(1,2), x + 3]])\nsage: pw.integral()\nPiecewise defined function with 2 parts, [[(0, 1), x^2], [(1, 2), (x^2 + 6*x)/2 - 5/2]]\nsage: pw.integral(definite=True)\n11/2\n```\n\n\n\nAssignee: @burcin\n\nCC:  @mwhansen\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4721\n\n",
    "closed_at": "2009-02-09T08:26:22Z",
    "created_at": "2008-12-05T22:37:17Z",
    "labels": [
        "component: calculus"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "[with patch; positive review] Indefinite integration for piecewise functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4721",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```
It would be nice to be able to do indefinite integration of piecewise functions in Sage.

I've created a patch which does this. I have made the default behavior of the integral() function of a piecewise function be to return the indefinite integral, and the definite integral is returned only when definite=True is supplied.

```
sage: pw = Piecewise([[(0,1), x*2], [(1,2), x + 3]])
sage: pw.integral()
Piecewise defined function with 2 parts, [[(0, 1), x^2], [(1, 2), (x^2 + 6*x)/2 - 5/2]]
sage: pw.integral(definite=True)
11/2
```



Assignee: @burcin

CC:  @mwhansen

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/4721





---

archive/issue_comments_038675.json:
```json
{
    "body": "<a id='comment:1'></a>\nI don't agree that this should be the default. First, how is the indefinite integral of piecewise function even well-defined? Assuming it somehow makes sense, the definite integral should be the default and the indefinite one (which should be very well documented) should require options. Also, my vote is that one should require the optional \"method=indefinite\" as opposed to \"definite=True\". I think \"method\" is more of a Sage standard.",
    "created_at": "2008-12-05T22:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38675",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:1'></a>
I don't agree that this should be the default. First, how is the indefinite integral of piecewise function even well-defined? Assuming it somehow makes sense, the definite integral should be the default and the indefinite one (which should be very well documented) should require options. Also, my vote is that one should require the optional "method=indefinite" as opposed to "definite=True". I think "method" is more of a Sage standard.



---

archive/issue_comments_038676.json:
```json
{
    "body": "Attachment [piecewise_integration.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration.patch) by pbutler created at 2008-12-05 22:50:30",
    "created_at": "2008-12-05T22:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38676",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [piecewise_integration.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration.patch) by pbutler created at 2008-12-05 22:50:30



---

archive/issue_comments_038677.json:
```json
{
    "body": "<a id='comment:2'></a>\nI made integration the default for consistency with other functions. For example,\n\n```\nsage: f(x)=3\nsage: f.integral()\nx |--> 3*x\nsage: (x*8).integral()\n4*x^2\nsage: sin(x).integral()\n-cos(x)\n```\n\nWhen integrating a piecewise function in Maple, the result is the indefinite integral. The only difference between the Maple result and the patched Sage code is that Maple defines the integral outside the bounds of the original piecewise function, which my code does not.",
    "created_at": "2008-12-05T23:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38677",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:2'></a>
I made integration the default for consistency with other functions. For example,

```
sage: f(x)=3
sage: f.integral()
x |--> 3*x
sage: (x*8).integral()
4*x^2
sage: sin(x).integral()
-cos(x)
```

When integrating a piecewise function in Maple, the result is the indefinite integral. The only difference between the Maple result and the patched Sage code is that Maple defines the integral outside the bounds of the original piecewise function, which my code does not.



---

archive/issue_comments_038678.json:
```json
{
    "body": "<a id='comment:3'></a>\nOkay. It makes good sense to usually copy the default, or implement an idea used in Maple's interface design. \n\nBut in this case, the indefinite integral of a piecewise defined function is not well-defined. I have no idea why Maple implemented it. I'm sure they had some reason. But IMHO Sage should not be implementing methods which so not have a well-defined mathematical meaning as a default. As an option (which is very well-documented), I have no objection because whoever would be using it presumably know what it means. However, I don't know what it means to indefinitely integrate a piecewise defined function and your code does not explain it.\n\nIt might be useful for some, so could you please revise it a bit?",
    "created_at": "2008-12-05T23:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38678",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:3'></a>
Okay. It makes good sense to usually copy the default, or implement an idea used in Maple's interface design. 

But in this case, the indefinite integral of a piecewise defined function is not well-defined. I have no idea why Maple implemented it. I'm sure they had some reason. But IMHO Sage should not be implementing methods which so not have a well-defined mathematical meaning as a default. As an option (which is very well-documented), I have no objection because whoever would be using it presumably know what it means. However, I don't know what it means to indefinitely integrate a piecewise defined function and your code does not explain it.

It might be useful for some, so could you please revise it a bit?



---

archive/issue_comments_038679.json:
```json
{
    "body": "<a id='comment:4'></a>\nInterestingly, Mathematica Online Integrator gives an answer too, but chops off the constant in each piece. You still get a valid antiderivative, but it is not useful as an indefinite integral. (Since it is discontinuous, it doesn't have to satisfy the conclusion of the FTC.)\n\nI do see the value of keeping to mathematically well-defined results, but there is also value in consistency. integrate(f) returning an antiderivative in some cases and a definite integral in others doesn't feel intuitive to me.\n\nIn any case, I'll clean this code up so that it can be included. It should be useful for people working with continuous probability distributions, if nothing else. (Actually, there must be some other use for it too, because Mathematica does it and their results would not be useful for probability.)",
    "created_at": "2008-12-06T01:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38679",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:4'></a>
Interestingly, Mathematica Online Integrator gives an answer too, but chops off the constant in each piece. You still get a valid antiderivative, but it is not useful as an indefinite integral. (Since it is discontinuous, it doesn't have to satisfy the conclusion of the FTC.)

I do see the value of keeping to mathematically well-defined results, but there is also value in consistency. integrate(f) returning an antiderivative in some cases and a definite integral in others doesn't feel intuitive to me.

In any case, I'll clean this code up so that it can be included. It should be useful for people working with continuous probability distributions, if nothing else. (Actually, there must be some other use for it too, because Mathematica does it and their results would not be useful for probability.)



---

archive/issue_comments_038680.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Paul,\n\ndesign discussions like this should not be done in trac since the number of people actually getting emails from this is minuscule compared to the audience on sage-devel. So please send an email with a summary what is proposed and what has been discussed so far to sage-devel. Also mention the ticket and that there are some more details there.\n\nThanks and keep up the good work.\n\nCheers,\n\nMichael",
    "created_at": "2008-12-06T01:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38680",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Hi Paul,

design discussions like this should not be done in trac since the number of people actually getting emails from this is minuscule compared to the audience on sage-devel. So please send an email with a summary what is proposed and what has been discussed so far to sage-devel. Also mention the ticket and that there are some more details there.

Thanks and keep up the good work.

Cheers,

Michael



---

archive/issue_comments_038681.json:
```json
{
    "body": "Attachment [piecewise_integration2.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration2.patch) by pbutler created at 2008-12-11 16:46:29",
    "created_at": "2008-12-11T16:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38681",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [piecewise_integration2.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration2.patch) by pbutler created at 2008-12-11 16:46:29



---

archive/issue_comments_038682.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've made some changes and added a new patch. Changing from needs work to needs review.",
    "created_at": "2008-12-11T16:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38682",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:6'></a>
I've made some changes and added a new patch. Changing from needs work to needs review.



---

archive/issue_comments_038683.json:
```json
{
    "body": "<a id='comment:7'></a>\nWorks as advertised.  I don't care about any design / structure details of calculus, so I think somebody else should look at it.",
    "created_at": "2009-01-24T11:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38683",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:7'></a>
Works as advertised.  I don't care about any design / structure details of calculus, so I think somebody else should look at it.



---

archive/issue_comments_038684.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry, I didn't see this earlier or I would've reviewed it.\n\nThis does not seem to work as advertised. There was a long thread in sage-devel which I though settled some design issues. One of them was that the FTC should be true for this indefinite integral. For example, the indef int F of the function f defined on (-4,3) \n\n```\n\n sage: f1(y) = -1\n sage: f2(y) = y + 3\n sage: f3(y) = -y - 1\n sage: f4(y) = y^2 - 1\n sage: f5(y) = 3\n sage: f = Piecewise([[(-4,-3),f1],[(-3,-2),f2],[(-2,0),f3],[(0,2),f4],[(2,3),f5]])\n sage: F = f.integral(y)\n\n```\n\nshould have the property that F(3)-F(-4) is the area under the curve.\nThis *is* true, as the following shows:\n\n```\nsage: f.integral(y,(-4,3))\n19/6\nsage: F(3)-F(-4)\n19/6\n```\n\nThis is not tested. In my option, this needs to be added to the docstring.\n\n*However*, what the docstring says is \"If definite=True is given, returns the definite integral.\"\nI don't know what the output\n\n```\nsage: f.integral(definite=True)\n2*(y^2 - 1) + y + 2*(-y - 1) + 5\n```\n\nmeans. I would expect it to be 19/6. Don't you assume the function is 0 outside \n(-4,3)? In any case, the definite integral seems incorrect, and is not consistenet\nwith the old behaviour, as you said it would be in the thread referred to above.",
    "created_at": "2009-01-24T13:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38684",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:8'></a>
Sorry, I didn't see this earlier or I would've reviewed it.

This does not seem to work as advertised. There was a long thread in sage-devel which I though settled some design issues. One of them was that the FTC should be true for this indefinite integral. For example, the indef int F of the function f defined on (-4,3) 

```

 sage: f1(y) = -1
 sage: f2(y) = y + 3
 sage: f3(y) = -y - 1
 sage: f4(y) = y^2 - 1
 sage: f5(y) = 3
 sage: f = Piecewise([[(-4,-3),f1],[(-3,-2),f2],[(-2,0),f3],[(0,2),f4],[(2,3),f5]])
 sage: F = f.integral(y)

```

should have the property that F(3)-F(-4) is the area under the curve.
This *is* true, as the following shows:

```
sage: f.integral(y,(-4,3))
19/6
sage: F(3)-F(-4)
19/6
```

This is not tested. In my option, this needs to be added to the docstring.

*However*, what the docstring says is "If definite=True is given, returns the definite integral."
I don't know what the output

```
sage: f.integral(definite=True)
2*(y^2 - 1) + y + 2*(-y - 1) + 5
```

means. I would expect it to be 19/6. Don't you assume the function is 0 outside 
(-4,3)? In any case, the definite integral seems incorrect, and is not consistenet
with the old behaviour, as you said it would be in the thread referred to above.



---

archive/issue_comments_038685.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt works as expected if you specify the variable:\n\n```\nsage: f.integral(definite=True)\n2*(y^2 - 1) + y + 2*(-y - 1) + 5\nsage: f.integral(y,definite=True)\n19/6\n```\n\nI suppose in functions of one variable it would be more consistent (within Sage) to figure out the variable automatically, though?",
    "created_at": "2009-01-24T22:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38685",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:9'></a>
It works as expected if you specify the variable:

```
sage: f.integral(definite=True)
2*(y^2 - 1) + y + 2*(-y - 1) + 5
sage: f.integral(y,definite=True)
19/6
```

I suppose in functions of one variable it would be more consistent (within Sage) to figure out the variable automatically, though?



---

archive/issue_comments_038686.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes. Can you please do that and add the FTC example to the docstring?",
    "created_at": "2009-01-24T22:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38686",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:10'></a>
Yes. Can you please do that and add the FTC example to the docstring?



---

archive/issue_comments_038687.json:
```json
{
    "body": "Attachment [piecewise_integration3.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration3.patch) by pbutler created at 2009-01-25 02:06:00",
    "created_at": "2009-01-25T02:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38687",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [piecewise_integration3.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_integration3.patch) by pbutler created at 2009-01-25 02:06:00



---

archive/issue_comments_038688.json:
```json
{
    "body": "<a id='comment:11'></a>\nI've added a patch with the changes requested.",
    "created_at": "2009-01-25T02:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38688",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:11'></a>
I've added a patch with the changes requested.



---

archive/issue_comments_038689.json:
```json
{
    "body": "<a id='comment:12'></a>\nCan you explain how to apply the patches? The third one does not apply cleanly on top of the second one, in 3.3.alpha1.",
    "created_at": "2009-01-25T02:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38689",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:12'></a>
Can you explain how to apply the patches? The third one does not apply cleanly on top of the second one, in 3.3.alpha1.



---

archive/issue_comments_038690.json:
```json
{
    "body": "<a id='comment:13'></a>\nI did manage to apply patch #3 and apply it to 3.3.alpha1 but sage -t timed out on my machine. \n\nI'll try this on my macbook but this will take awhile since it's very slow. If the patch is as described then I hope to (finally) give it a positive review.",
    "created_at": "2009-01-25T02:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38690",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:13'></a>
I did manage to apply patch #3 and apply it to 3.3.alpha1 but sage -t timed out on my machine. 

I'll try this on my macbook but this will take awhile since it's very slow. If the patch is as described then I hope to (finally) give it a positive review.



---

archive/issue_comments_038691.json:
```json
{
    "body": "<a id='comment:14'></a>\nAttachment [default_variable.patch](tarball://root/attachments/some-uuid/ticket4721/default_variable.patch) by pbutler created at 2009-01-25 03:52:48\n\nI should have mentioned that the patches are not meant to be applied on top of each other. I kept the old ones up simply for comparison. Sorry for the confusion.\n\nFor comparison, my (fairly modest) laptop finishes the tests in 126s. Looking through the code again, I realized that I didn't make `default_variable()` cache the results, so I've prepared a patch (`default_variable.patch`) to be applied on top of `piecewise_integration3.patch`.",
    "created_at": "2009-01-25T03:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38691",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:14'></a>
Attachment [default_variable.patch](tarball://root/attachments/some-uuid/ticket4721/default_variable.patch) by pbutler created at 2009-01-25 03:52:48

I should have mentioned that the patches are not meant to be applied on top of each other. I kept the old ones up simply for comparison. Sorry for the confusion.

For comparison, my (fairly modest) laptop finishes the tests in 126s. Looking through the code again, I realized that I didn't make `default_variable()` cache the results, so I've prepared a patch (`default_variable.patch`) to be applied on top of `piecewise_integration3.patch`.



---

archive/issue_comments_038692.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe last two patches together (first patch #3 then the \"default\" patch) apply cleanly to 3.3.alpha2. They also pass sage -t.\n\nA few comments:\n\n1) You have \n\n```\n            sage: f1(y) = (x+3)^2\n            sage: f2(y) = x+3\n            sage: f3(y) = 3\n            sage: f = Piecewise([[(-infinity, -3), f1], [(-3, 0), f2], [(0, infinity), f3]])\n            sage: f.integral()\n            Piecewise defined function with 3 parts, [[(-Infinity, -3), (x^3 + 9*x^2 + 27*x)/3 + 9],\n            [(-3, 0), (x^2 + 6*x)/2 + 9/2], [(0, +Infinity), 3*x + 9/2]]\n```\nin the docstring. Is this mixing of x's and y's intended or a typo? If intended, why?\n\n2) I would have perferred that you add yourself to the AUTHR field at the top and add \n\n```\nAUTHOR:\n  P Butler\n```\nin the docstring of the function itself. Not crutial, but it will help others in the future know which part is whose.\n\n3) You have the comment:\n\n\n```\n            # if this piece starts at negative infinity, we won't\n            # try to compute the definite integral of the piece.\n```\nyet you have the definite integral\n\n```\n\n            sage: f1(x) = e^(-abs(x))\n            sage: f = Piecewise([[(-infinity, infinity), f1]])\n            sage: f.integral(definite=True)\n            2\n```\nCould you explain this please? I think maybe you meant to say \n\"...try to compute the indefinite...\":\n\n```\nsage: f.integral()\nPiecewise defined function with 1 parts, [[(-Infinity, +Infinity), -integrate(e^(-abs(x)), x, x, +Infinity)]]\n```\nIf so, could you add this example and comment to the docstring please?\n\n\nIf you agree to all this, could you just make a small patch to go on top of the previous 2 so I can just apply it in my clone, run sage -t, and give this a positive review?",
    "created_at": "2009-01-25T15:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38692",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:15'></a>
The last two patches together (first patch #3 then the "default" patch) apply cleanly to 3.3.alpha2. They also pass sage -t.

A few comments:

1) You have 

```
            sage: f1(y) = (x+3)^2
            sage: f2(y) = x+3
            sage: f3(y) = 3
            sage: f = Piecewise([[(-infinity, -3), f1], [(-3, 0), f2], [(0, infinity), f3]])
            sage: f.integral()
            Piecewise defined function with 3 parts, [[(-Infinity, -3), (x^3 + 9*x^2 + 27*x)/3 + 9],
            [(-3, 0), (x^2 + 6*x)/2 + 9/2], [(0, +Infinity), 3*x + 9/2]]
```
in the docstring. Is this mixing of x's and y's intended or a typo? If intended, why?

2) I would have perferred that you add yourself to the AUTHR field at the top and add 

```
AUTHOR:
  P Butler
```
in the docstring of the function itself. Not crutial, but it will help others in the future know which part is whose.

3) You have the comment:


```
            # if this piece starts at negative infinity, we won't
            # try to compute the definite integral of the piece.
```
yet you have the definite integral

```

            sage: f1(x) = e^(-abs(x))
            sage: f = Piecewise([[(-infinity, infinity), f1]])
            sage: f.integral(definite=True)
            2
```
Could you explain this please? I think maybe you meant to say 
"...try to compute the indefinite...":

```
sage: f.integral()
Piecewise defined function with 1 parts, [[(-Infinity, +Infinity), -integrate(e^(-abs(x)), x, x, +Infinity)]]
```
If so, could you add this example and comment to the docstring please?


If you agree to all this, could you just make a small patch to go on top of the previous 2 so I can just apply it in my clone, run sage -t, and give this a positive review?



---

archive/issue_comments_038693.json:
```json
{
    "body": "<a id='comment:16'></a>\nAttachment [docstring.patch](tarball://root/attachments/some-uuid/ticket4721/docstring.patch) by pbutler created at 2009-01-25 17:15:32\n\nI've attached `docstring.patch` which fixes these issues.",
    "created_at": "2009-01-25T17:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38693",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:16'></a>
Attachment [docstring.patch](tarball://root/attachments/some-uuid/ticket4721/docstring.patch) by pbutler created at 2009-01-25 17:15:32

I've attached `docstring.patch` which fixes these issues.



---

archive/issue_comments_038694.json:
```json
{
    "body": "<a id='comment:17'></a>\nThese last three patches apply cleanly to 3.3.alpha2 and sage -t passes.\n\nI'm giving this a positive review, finally, Thanks Paul for making the changes.",
    "created_at": "2009-01-25T20:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38694",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:17'></a>
These last three patches apply cleanly to 3.3.alpha2 and sage -t passes.

I'm giving this a positive review, finally, Thanks Paul for making the changes.



---

archive/issue_comments_038695.json:
```json
{
    "body": "<a id='comment:18'></a>\nI am seeing two doctests failure:\n\n```\nsage -t -long \"devel/doc/const/const.tex\"\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha3/devel/doc/const/const.tex\", line 525:\n    : f.integral()\nExpected:\n    3\nGot:\n    Piecewise defined function with 2 parts, [[(0, 1), x^3/3], [(1, 2), (15*x - x^3)/3 - 13/3]]\n**********************************************************************\n```\nand\n\n```\nsage -t -long \"devel/sage/sage/calculus/wester.py\"\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha3/devel/sage/sage/calculus/wester.py\", line 454:\n    : f.integral()\nExpected:\n    100\nGot:\n    Piecewise defined function with 2 parts, [[(-10, 0), 50 - x^2/2], [(0, 10), x^2/2 + 50]]\n**********************************************************************\n```\n\nIf someone posts additional patches please also fold the patches together.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-28T16:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38695",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:18'></a>
I am seeing two doctests failure:

```
sage -t -long "devel/doc/const/const.tex"
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha3/devel/doc/const/const.tex", line 525:
    : f.integral()
Expected:
    3
Got:
    Piecewise defined function with 2 parts, [[(0, 1), x^3/3], [(1, 2), (15*x - x^3)/3 - 13/3]]
**********************************************************************
```
and

```
sage -t -long "devel/sage/sage/calculus/wester.py"
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha3/devel/sage/sage/calculus/wester.py", line 454:
    : f.integral()
Expected:
    100
Got:
    Piecewise defined function with 2 parts, [[(-10, 0), 50 - x^2/2], [(0, 10), x^2/2 + 50]]
**********************************************************************
```

If someone posts additional patches please also fold the patches together.

Cheers,

Michael



---

archive/issue_comments_038696.json:
```json
{
    "body": "Attachment [const_doctest.patch](tarball://root/attachments/some-uuid/ticket4721/const_doctest.patch) by pbutler created at 2009-01-29 03:18:50",
    "created_at": "2009-01-29T03:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38696",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [const_doctest.patch](tarball://root/attachments/some-uuid/ticket4721/const_doctest.patch) by pbutler created at 2009-01-29 03:18:50



---

archive/issue_comments_038697.json:
```json
{
    "body": "<a id='comment:19'></a>\nAttachment [piecewise_all_patches.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_all_patches.patch) by pbutler created at 2009-01-29 03:22:06\n\nOk, I've added the patches.\n\n`piecewise_all_patches.patch` fixes the problem in `calculus/wester.py` and *replaces all previous patches* that are part of this ticket.\n\n`const_doctest.patch` fixes the problem in `doc/const/const.tex`.",
    "created_at": "2009-01-29T03:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38697",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:19'></a>
Attachment [piecewise_all_patches.patch](tarball://root/attachments/some-uuid/ticket4721/piecewise_all_patches.patch) by pbutler created at 2009-01-29 03:22:06

Ok, I've added the patches.

`piecewise_all_patches.patch` fixes the problem in `calculus/wester.py` and *replaces all previous patches* that are part of this ticket.

`const_doctest.patch` fixes the problem in `doc/const/const.tex`.



---

archive/issue_comments_038698.json:
```json
{
    "body": "<a id='comment:20'></a>\nTwo strange things:\n\n(1) For some reason, I cannot apply the const patch to 3.3.alpha2. However, the diff looks good to me.\n\n(2) I applied the \"all\" patch. This is what I got (intel macbook running 10.4):\n\n```\n...\nThe following tests failed:\n\n\n        sage -t  \"devel/sage/sage/interfaces/maple.py\"\n        sage -t  \"devel/sage/sage/interfaces/octave.py\"\n        sage -t  \"devel/sage/sage/rings/polynomial/toy_d_basis.py\"\n```\n\n*However*, I know const.tex fails (see Michael's comment above), so I ran sage -testall and waited for the doctests to finish (which is near the beginning of the process). Sure enough,\n\n```\nTesting Sage constructions guide\nsage -t  \"devel/doc/const/const.tex\"                        \n**********************************************************************\nFile \"/Volumes/G-DRIVE-MINI/sagestuff/sage-3.3.alpha2/devel/doc/const/const.tex\", line 525:\n    : f.integral()\nExpected:\n    3\nGot:\n    Piecewise defined function with 2 parts, [[(0, 1), x^3/3], [(1, 2), (15*x - x^3)/3 - 13/3]]\n**********************************************************************\n```\nSo I think sage -testall is not reporting all the failures on my machine for some reason.\n\nIn any case, I would gives this a positive review if I knew it would pass sage -testall. However, it isn't clear to me if the output of sage -testall after this patch is \"positive enough\" to make a \"positive review\" appropriate. Any suggestions Michael?",
    "created_at": "2009-01-29T21:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38698",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:20'></a>
Two strange things:

(1) For some reason, I cannot apply the const patch to 3.3.alpha2. However, the diff looks good to me.

(2) I applied the "all" patch. This is what I got (intel macbook running 10.4):

```
...
The following tests failed:


        sage -t  "devel/sage/sage/interfaces/maple.py"
        sage -t  "devel/sage/sage/interfaces/octave.py"
        sage -t  "devel/sage/sage/rings/polynomial/toy_d_basis.py"
```

*However*, I know const.tex fails (see Michael's comment above), so I ran sage -testall and waited for the doctests to finish (which is near the beginning of the process). Sure enough,

```
Testing Sage constructions guide
sage -t  "devel/doc/const/const.tex"                        
**********************************************************************
File "/Volumes/G-DRIVE-MINI/sagestuff/sage-3.3.alpha2/devel/doc/const/const.tex", line 525:
    : f.integral()
Expected:
    3
Got:
    Piecewise defined function with 2 parts, [[(0, 1), x^3/3], [(1, 2), (15*x - x^3)/3 - 13/3]]
**********************************************************************
```
So I think sage -testall is not reporting all the failures on my machine for some reason.

In any case, I would gives this a positive review if I knew it would pass sage -testall. However, it isn't clear to me if the output of sage -testall after this patch is "positive enough" to make a "positive review" appropriate. Any suggestions Michael?



---

archive/issue_comments_038699.json:
```json
{
    "body": "<a id='comment:21'></a>\nWhen I ran `-testall` on my own install, only one test failed. I don't recall which, but it was a `.tex` file. Oddly enough, when I ran just that file's test it passed.\n\nI'm not sure why the polynomial ring test failed on yours but not on mine. Maybe I'm not working with the latest version of sage. I can understand the interface tests failing, because I don't have those interfaces enabled (unfortunately, I don't have my Maple CD with me so I can't test it, unless the interface works with a remote server).",
    "created_at": "2009-01-31T22:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38699",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:21'></a>
When I ran `-testall` on my own install, only one test failed. I don't recall which, but it was a `.tex` file. Oddly enough, when I ran just that file's test it passed.

I'm not sure why the polynomial ring test failed on yours but not on mine. Maybe I'm not working with the latest version of sage. I can understand the interface tests failing, because I don't have those interfaces enabled (unfortunately, I don't have my Maple CD with me so I can't test it, unless the interface works with a remote server).



---

archive/issue_comments_038700.json:
```json
{
    "body": "<a id='comment:22'></a>\nIf it was a *.tex file then it might have been a doc test failure. Can you please run sage -testall on your machine again? \n\nI ran my tests on an old intel macbook, which might have it's own oddities.",
    "created_at": "2009-01-31T22:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38700",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:22'></a>
If it was a *.tex file then it might have been a doc test failure. Can you please run sage -testall on your machine again? 

I ran my tests on an old intel macbook, which might have it's own oddities.



---

archive/issue_comments_038701.json:
```json
{
    "body": "<a id='comment:23'></a>\nThis time, a different test failed. Same as last time, when I ran that test by itself it passed.\n\n```\n./sage -testall\n\n[snip]\n\n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage/sage/rings/qqbar.py\"\nTotal time for all tests: 5392.0 seconds\nPlease see /home/paul/sage/tmp/test.log for the complete log from this test.\npaul@wildcard:~/sage$ ./sage -t \"devel/sage/sage/rings/qqbar.py\"\nsage -t  \"devel/sage/sage/rings/qqbar.py\"                   \n\t [27.4 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 27.4 seconds\npaul@wildcard:~/sage$ \n```\n\nFrom the log:\n\n```\nsage -t  \"devel/sage/sage/rings/qqbar.py\"\n*** *** Error: TIMED OUT! PROCESS KILLED! *** ***\n*** *** Error: TIMED OUT! *** ***\n*** *** Error: TIMED OUT! *** ***\n     [360.4 s]\n```\n\nSo it was just a timeout, not a bad value. Is there a way to disable or extend timeouts?",
    "created_at": "2009-02-01T04:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38701",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:23'></a>
This time, a different test failed. Same as last time, when I ran that test by itself it passed.

```
./sage -testall

[snip]

----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage/sage/rings/qqbar.py"
Total time for all tests: 5392.0 seconds
Please see /home/paul/sage/tmp/test.log for the complete log from this test.
paul@wildcard:~/sage$ ./sage -t "devel/sage/sage/rings/qqbar.py"
sage -t  "devel/sage/sage/rings/qqbar.py"                   
	 [27.4 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 27.4 seconds
paul@wildcard:~/sage$ 
```

From the log:

```
sage -t  "devel/sage/sage/rings/qqbar.py"
*** *** Error: TIMED OUT! PROCESS KILLED! *** ***
*** *** Error: TIMED OUT! *** ***
*** *** Error: TIMED OUT! *** ***
     [360.4 s]
```

So it was just a timeout, not a bad value. Is there a way to disable or extend timeouts?



---

archive/issue_comments_038702.json:
```json
{
    "body": "<a id='comment:24'></a>\n(a) You can try sage -t -long (see sage -advanced for the details), but that might not help in this case.\n\n(b) Since Michael didn't respond with a suggestion of what I should do in this case, \nbased on your tests, and my visual inspection of the doc patch\nI couldn't get to apply, I'm giving this a positive review again. It might get kicked back \nthough if Michael has problems applying it too. I'm guessing you are using an older version of Sage than I and the problem is someone else made changed since you created your doc patch.",
    "created_at": "2009-02-01T13:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38702",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:24'></a>
(a) You can try sage -t -long (see sage -advanced for the details), but that might not help in this case.

(b) Since Michael didn't respond with a suggestion of what I should do in this case, 
based on your tests, and my visual inspection of the doc patch
I couldn't get to apply, I'm giving this a positive review again. It might get kicked back 
though if Michael has problems applying it too. I'm guessing you are using an older version of Sage than I and the problem is someone else made changed since you created your doc patch.



---

archive/issue_comments_038703.json:
```json
{
    "body": "<a id='comment:25'></a>\nconst_doctest.patch applies cleanly for me. The timeout issue will not go away with -long since this is a pexpect problem.\n\nI did not try the patch and I am hesitant to merge it since it changes default behavior. I do remember a discussion about this on sage-devel, so if someone could point me to that and show me that we agreed on this change I am more than happy to merge this patch.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-02T05:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38703",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:25'></a>
const_doctest.patch applies cleanly for me. The timeout issue will not go away with -long since this is a pexpect problem.

I did not try the patch and I am hesitant to merge it since it changes default behavior. I do remember a discussion about this on sage-devel, so if someone could point me to that and show me that we agreed on this change I am more than happy to merge this patch.

Cheers,

Michael



---

archive/issue_comments_038704.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe thread was\n\n```\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/f6cb26796d39c67/c19f18e80a65164e?lnk=gst&q=Integral+of+piecewise+functions#c19f18e80a65164e\n```\n(or search \"Integral of piecewise functions\" Dec 6, 2008).\n\nI can try to install the patches on my work machine but it will take several days to even\ninstall the latest version of Sage. Recently, they significantly lowered the download speed for \neveryone for some reason.",
    "created_at": "2009-02-02T12:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38704",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:26'></a>
The thread was

```
http://groups.google.com/group/sage-devel/browse_thread/thread/f6cb26796d39c67/c19f18e80a65164e?lnk=gst&q=Integral+of+piecewise+functions#c19f18e80a65164e
```
(or search "Integral of piecewise functions" Dec 6, 2008).

I can try to install the patches on my work machine but it will take several days to even
install the latest version of Sage. Recently, they significantly lowered the download speed for 
everyone for some reason.



---

archive/issue_comments_038705.json:
```json
{
    "body": "<a id='comment:27'></a>\nI checked the above thread and I am not seeing any consensus by a majority of Sage people that this change is a good idea. I still think it should go in, but I would like to see \n\n* a discussion on sage-devel where at least a certain number of people sign off on this change\n* a detailed entry that can be added to the Sage 3.3 release notes about this change showing the before and after, changed defaults, etc.\n\nI am sorry to be a pain here, but this is how it is :)\n\nCheers,\n\nMichael",
    "created_at": "2009-02-05T11:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38705",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:27'></a>
I checked the above thread and I am not seeing any consensus by a majority of Sage people that this change is a good idea. I still think it should go in, but I would like to see 

* a discussion on sage-devel where at least a certain number of people sign off on this change
* a detailed entry that can be added to the Sage 3.3 release notes about this change showing the before and after, changed defaults, etc.

I am sorry to be a pain here, but this is how it is :)

Cheers,

Michael



---

archive/issue_comments_038706.json:
```json
{
    "body": "<a id='comment:28'></a>\nThanks Paul,\n\nthere seems to be a strong consensus to make this go in (and William signed off on it, too), so this will be in 3.3.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-08T23:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38706",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:28'></a>
Thanks Paul,

there seems to be a strong consensus to make this go in (and William signed off on it, too), so this will be in 3.3.

Cheers,

Michael



---

archive/issue_events_010785.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-08T23:17:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4721#event-10785"
}
```



---

archive/issue_comments_038707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-02-09T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38707",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_events_010786.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-09T08:26:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4721#event-10786"
}
```



---

archive/issue_comments_038708.json:
```json
{
    "body": "<a id='comment:29'></a>\nMerged const_doctest.patch and piecewise_all_patches.patch in Sage 3.3.rc0.\n\nMike: const_doctest.patch touches one doctest in const.tex.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4721#issuecomment-38708",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:29'></a>
Merged const_doctest.patch and piecewise_all_patches.patch in Sage 3.3.rc0.

Mike: const_doctest.patch touches one doctest in const.tex.

Cheers,

Michael
