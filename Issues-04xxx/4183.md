# Issue 4183: ?? can't always find the source for new style classes

archive/issues_004183.json:
```json
{
    "body": "I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the `__class__.__flags__` attribute to see if one should do the same trick as in #2777 or something like that. \n\n**Assignee:** @williamstein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4183\n\n",
    "closed_at": "2008-10-18T12:03:30Z",
    "created_at": "2008-09-24T01:25:02Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2",
    "title": "?? can't always find the source for new style classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4183",
    "user": "https://github.com/robertwb"
}
```
I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the `__class__.__flags__` attribute to see if one should do the same trick as in #2777 or something like that. 

**Assignee:** @williamstein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/4183





---

archive/issue_comments_035369.json:
```json
{
    "body": "<a id='comment:1'></a>\nI didn't though about if for #2777, but based on [http://psyco.sourceforge.net/psycoguide/metaclass.html](http://psyco.sourceforge.net/psycoguide/metaclass.html), i.e. part \"... if `x` contains an instance of ... a new-style class, then `type(x)` will be `x.__class__` instead of `types.InstanceType`.\" - I think that test like:\n\n`hasattr(arg, __class__) and type(arg) == arg.__class__`\n\ncould do the thing, maybe not best way but it works for example with instances of `sage.rings.rational_field.RationalField`... no code to attach yet (just in-place tests in console, it's 4:30 am here) - will try to do some small patch soon",
    "created_at": "2008-09-24T02:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35369",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```

<a id='comment:1'></a>
I didn't though about if for #2777, but based on [http://psyco.sourceforge.net/psycoguide/metaclass.html](http://psyco.sourceforge.net/psycoguide/metaclass.html), i.e. part "... if `x` contains an instance of ... a new-style class, then `type(x)` will be `x.__class__` instead of `types.InstanceType`." - I think that test like:

`hasattr(arg, __class__) and type(arg) == arg.__class__`

could do the thing, maybe not best way but it works for example with instances of `sage.rings.rational_field.RationalField`... no code to attach yet (just in-place tests in console, it's 4:30 am here) - will try to do some small patch soon



---

archive/issue_comments_035370.json:
```json
{
    "body": "<a id='comment:2'></a>\nAh, that sounds like a much nicer way to detect it.",
    "created_at": "2008-09-24T05:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35370",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>
Ah, that sounds like a much nicer way to detect it.



---

archive/issue_comments_035371.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-09-24T22:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35371",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_035372.json:
```json
{
    "body": "<a id='comment:3'></a>\nUsed other approach, above with type equal class is true for too much, for example:\n\n```\nsage: type(arg)\n<type 'function'>\nsage: arg.__class__\n<type 'function'>\n```\n\nCheck like:\n\n`obj.__class__.__module__ not in ('__builtin__', 'exceptions')`\n\nseems to work both old and new style classes, the problem seems to be that everything is object, so best we can do is check if something is object of non built-in class",
    "created_at": "2008-09-24T22:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35372",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```

<a id='comment:3'></a>
Used other approach, above with type equal class is true for too much, for example:

```
sage: type(arg)
<type 'function'>
sage: arg.__class__
<type 'function'>
```

Check like:

`obj.__class__.__module__ not in ('__builtin__', 'exceptions')`

seems to work both old and new style classes, the problem seems to be that everything is object, so best we can do is check if something is object of non built-in class



---

archive/issue_comments_035373.json:
```json
{
    "body": "second try",
    "created_at": "2008-09-25T00:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35373",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```

second try



---

archive/attachments_004435.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "4183-2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket4183/4183-2.patch",
    "created_at": "2008-09-25T00:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```



---

archive/issue_comments_035374.json:
```json
{
    "body": "<a id='comment:4'></a>\nin previous patch I trusted the \"everything is object\" too much... so not everything have `__class__`, that's why I added back the check for `__class__` and also `__module__`, though every class should have one... better safe than sorry",
    "created_at": "2008-09-25T00:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35374",
    "user": "https://trac.sagemath.org/admin/accounts/users/aginiewicz"
}
```

<a id='comment:4'></a>
in previous patch I trusted the "everything is object" too much... so not everything have `__class__`, that's why I added back the check for `__class__` and also `__module__`, though every class should have one... better safe than sorry



---

archive/issue_comments_035375.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2008-10-14T19:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35375",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_035376.json:
```json
{
    "body": "<a id='comment:5'></a>\nApplies cleanly and works well. This is very nice.",
    "created_at": "2008-10-14T19:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35376",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'></a>
Applies cleanly and works well. This is very nice.



---

archive/issue_comments_035377.json:
```json
{
    "body": "<a id='comment:6'></a>\nNote: apply only the second patch.",
    "created_at": "2008-10-14T19:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35377",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>
Note: apply only the second patch.



---

archive/issue_comments_035378.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-10-18T12:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35378",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_012397.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-18T12:03:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4183#event-12397"
}
```



---

archive/issue_comments_035379.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged 4183-2.patch in Sage 3.2.alpha0",
    "created_at": "2008-10-18T12:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35379",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
Merged 4183-2.patch in Sage 3.2.alpha0



---

archive/issue_comments_035380.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the __class__.__flags__ attribute to see if one should do the same trick as in #2777 or something like that. \n+I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the `__class__.__flags__` attribute to see if one should do the same trick as in #2777 or something like that. \n``````\n",
    "created_at": "2008-11-10T03:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4183#issuecomment-35380",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the __class__.__flags__ attribute to see if one should do the same trick as in #2777 or something like that. 
+I think one needs to check bit 9 (Py_TPFLAGS_HEAPTYPE) of the `__class__.__flags__` attribute to see if one should do the same trick as in #2777 or something like that. 
``````

