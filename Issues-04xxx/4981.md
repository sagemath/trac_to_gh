# Issue 4981: clean up polynomial_ring.py

archive/issues_004981.json:
```json
{
    "body": "The way element classes are chosen in `sage/rings/polynomial/polynomial_ring.py` goes very much against object oriented design, and is basically ugly. :)\n\nAttached patch tries to clean up this file, moves the decision of element classes to the immediate parents, adds some tests, and unifies the `__call__` methods. This also makes it much easier to add support for specialized polynomial classes.\n\n**Assignee:** @burcin\n\n**CC:**  @malb\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4981\n\n",
    "closed_at": "2009-01-24T17:45:36Z",
    "created_at": "2009-01-15T13:17:33Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "clean up polynomial_ring.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4981",
    "user": "https://github.com/burcin"
}
```
The way element classes are chosen in `sage/rings/polynomial/polynomial_ring.py` goes very much against object oriented design, and is basically ugly. :)

Attached patch tries to clean up this file, moves the decision of element classes to the immediate parents, adds some tests, and unifies the `__call__` methods. This also makes it much easier to add support for specialized polynomial classes.

**Assignee:** @burcin

**CC:**  @malb

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/4981





---

archive/issue_events_014984.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "rename": {
        "from": "clean up polynomial_ring.py",
        "to": "[with positive review] clean up polynomial_ring.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14984"
}
```



---

archive/issue_comments_044978.json:
```json
{
    "body": "<a id='comment:1'></a>\nReview:  Patch applies cleanly to 3.2.3.  All looks very sensible to me, and I trust burcin to know what he is doing, though I cannot say that I followed through all the logic.  All doctests in rings/polynomial pass, so I think that this is good to go.",
    "created_at": "2009-01-18T17:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44978",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
Review:  Patch applies cleanly to 3.2.3.  All looks very sensible to me, and I trust burcin to know what he is doing, though I cannot say that I followed through all the logic.  All doctests in rings/polynomial pass, so I think that this is good to go.



---

archive/issue_events_014985.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "rename": {
        "from": "[with positive review] clean up polynomial_ring.py",
        "to": "clean up polynomial_ring.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14985"
}
```



---

archive/issue_comments_044979.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2009-01-19T03:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44979",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_044980.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch causes the following trivial to fix doctest failure:\n\n```\nmabshoff@geom:/scratch/mabshoff/sage-3.3.alpha0$ ./sage -t -long devel/sage/sage/calculus/calculus.py\nsage -t -long \"devel/sage/sage/calculus/calculus.py\"        \n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha0/devel/sage/sage/calculus/calculus.py\", line 1912:\n    sage: type(a)\nExpected:\n    <type 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense'>\nGot:\n    <class 'sage.rings.polynomial.polynomial_element_generic.Polynomial_generic_dense_field'>\n**********************************************************************\n```\nUnfortunately the following test\n\n```\nTrying:\n    Integer(2)*P + Integer(2)*Q # indirect doctest###line 208:_sage_    >>> 2*P + 2*Q # indirect doctest\nExpecting:\n    (x^2 - 2*x + 1, y - 3/2*a*x + 1/2*a)\n```\nin sage/schemes/hyperelliptic_curves/jacobian_morphism.py seems to loop forever - at least I killed it after it used 22 minutes of CPU time on the new sage.math.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-19T03:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44980",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
This patch causes the following trivial to fix doctest failure:

```
mabshoff@geom:/scratch/mabshoff/sage-3.3.alpha0$ ./sage -t -long devel/sage/sage/calculus/calculus.py
sage -t -long "devel/sage/sage/calculus/calculus.py"        
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha0/devel/sage/sage/calculus/calculus.py", line 1912:
    sage: type(a)
Expected:
    <type 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense'>
Got:
    <class 'sage.rings.polynomial.polynomial_element_generic.Polynomial_generic_dense_field'>
**********************************************************************
```
Unfortunately the following test

```
Trying:
    Integer(2)*P + Integer(2)*Q # indirect doctest###line 208:_sage_    >>> 2*P + 2*Q # indirect doctest
Expecting:
    (x^2 - 2*x + 1, y - 3/2*a*x + 1/2*a)
```
in sage/schemes/hyperelliptic_curves/jacobian_morphism.py seems to loop forever - at least I killed it after it used 22 minutes of CPU time on the new sage.math.

Cheers,

Michael



---

archive/issue_comments_044981.json:
```json
{
    "body": "<a id='comment:3'></a>\nA new patch which fixes the doctests is attached.",
    "created_at": "2009-01-21T08:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44981",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>
A new patch which fixes the doctests is attached.



---

archive/issue_comments_044982.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-01-21T08:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44982",
    "user": "https://github.com/burcin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_014986.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "rename": {
        "from": "clean up polynomial_ring.py",
        "to": "[with positive review] clean up polynomial_ring.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14986"
}
```



---

archive/issue_comments_044983.json:
```json
{
    "body": "<a id='comment:4'></a>\nCode wise: this looks great!  I heartily agree with the sentiment and implementation.\n\nTesting wise: I tested this on sage.math and think that it works.",
    "created_at": "2009-01-21T19:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44983",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:4'></a>
Code wise: this looks great!  I heartily agree with the sentiment and implementation.

Testing wise: I tested this on sage.math and think that it works.



---

archive/issue_events_014987.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "rename": {
        "from": "[with positive review] clean up polynomial_ring.py",
        "to": "[with positive review, needs rebase] clean up polynomial_ring.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14987"
}
```



---

archive/issue_comments_044984.json:
```json
{
    "body": "<a id='comment:5'></a>\nUnfortunately this has been broken due to other merges, probably #4965:\n\n```\nmabshoff@geom:/scratch/mabshoff/sage-3.3.alpha1/devel/sage$ patch -p1 < trac_4981_polynomial_ring.patch \npatching file sage/calculus/calculus.py\npatching file sage/misc/classgraph.py\npatching file sage/rings/polynomial/polynomial_ring.py\nHunk #2 succeeded at 86 with fuzz 2 (offset 2 lines).\nHunk #3 succeeded at 102 (offset 2 lines).\nHunk #4 succeeded at 111 (offset 2 lines).\nHunk #5 succeeded at 156 (offset 2 lines).\nHunk #6 succeeded at 167 (offset 2 lines).\nHunk #7 succeeded at 231 (offset 2 lines).\nHunk #8 succeeded at 277 (offset 2 lines).\nHunk #9 succeeded at 490 (offset 2 lines).\nHunk #10 FAILED at 504.\nHunk #11 succeeded at 968 (offset 2 lines).\nHunk #12 succeeded at 983 (offset 2 lines).\nHunk #13 FAILED at 1125.\n2 out of 13 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_ring.py.rej\npatching file sage/rings/polynomial/polynomial_template.pxi\nHunk #1 FAILED at 85.\n1 out of 1 hunk FAILED -- saving rejects to file sage/rings/polynomial/polynomial_template.pxi.rej\n```\nPlease rebase for 3.3.alpha1.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-23T02:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44984",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Unfortunately this has been broken due to other merges, probably #4965:

```
mabshoff@geom:/scratch/mabshoff/sage-3.3.alpha1/devel/sage$ patch -p1 < trac_4981_polynomial_ring.patch 
patching file sage/calculus/calculus.py
patching file sage/misc/classgraph.py
patching file sage/rings/polynomial/polynomial_ring.py
Hunk #2 succeeded at 86 with fuzz 2 (offset 2 lines).
Hunk #3 succeeded at 102 (offset 2 lines).
Hunk #4 succeeded at 111 (offset 2 lines).
Hunk #5 succeeded at 156 (offset 2 lines).
Hunk #6 succeeded at 167 (offset 2 lines).
Hunk #7 succeeded at 231 (offset 2 lines).
Hunk #8 succeeded at 277 (offset 2 lines).
Hunk #9 succeeded at 490 (offset 2 lines).
Hunk #10 FAILED at 504.
Hunk #11 succeeded at 968 (offset 2 lines).
Hunk #12 succeeded at 983 (offset 2 lines).
Hunk #13 FAILED at 1125.
2 out of 13 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_ring.py.rej
patching file sage/rings/polynomial/polynomial_template.pxi
Hunk #1 FAILED at 85.
1 out of 1 hunk FAILED -- saving rejects to file sage/rings/polynomial/polynomial_template.pxi.rej
```
Please rebase for 3.3.alpha1.

Cheers,

Michael



---

archive/issue_events_014988.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "rename": {
        "from": "[with positive review, needs rebase] clean up polynomial_ring.py",
        "to": "clean up polynomial_ring.py"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14988"
}
```



---

archive/issue_comments_044985.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2009-01-24T17:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44985",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to positive_review.



---

archive/issue_comments_044986.json:
```json
{
    "body": "<a id='comment:6'></a>\nI fixed a tiny doctesting issue in the second patch:\n\n```\nsage -t -long \"devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py\"\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.3.alpha2/devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py\", line 84:\n    sage: A.<y> = PolynomialRing(GF(2)); A\nExpected:\n    Univariate Polynomial Ring in y over Finite Field of size 2\nGot:\n    Univariate Polynomial Ring in y over Finite Field of size 2 (using NTL)\n**********************************************************************\n1 items had failures:\n```\nBurcin explained how he fixed the hang, positive review.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-24T17:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44986",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
I fixed a tiny doctesting issue in the second patch:

```
sage -t -long "devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py"
**********************************************************************
File "/scratch/mabshoff/sage-3.3.alpha2/devel/sage/sage/rings/polynomial/polynomial_quotient_ring.py", line 84:
    sage: A.<y> = PolynomialRing(GF(2)); A
Expected:
    Univariate Polynomial Ring in y over Finite Field of size 2
Got:
    Univariate Polynomial Ring in y over Finite Field of size 2 (using NTL)
**********************************************************************
1 items had failures:
```
Burcin explained how he fixed the hang, positive review.

Cheers,

Michael



---

archive/issue_comments_044987.json:
```json
{
    "body": "clean up polynomial_ring.py (take 4)",
    "created_at": "2009-01-24T17:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44987",
    "user": "https://github.com/burcin"
}
```

clean up polynomial_ring.py (take 4)



---

archive/issue_comments_044988.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-01-24T17:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44988",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_044989.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [polynomial_ring.patch](tarball://root/attachments/some-uuid/ticket4981/polynomial_ring.patch) by mabshoff created at 2009-01-24 17:45:36\n\nMerged polynomial_ring.py (take 4) in Sage 3.3.alpha2",
    "created_at": "2009-01-24T17:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4981#issuecomment-44989",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
Attachment [polynomial_ring.patch](tarball://root/attachments/some-uuid/ticket4981/polynomial_ring.patch) by mabshoff created at 2009-01-24 17:45:36

Merged polynomial_ring.py (take 4) in Sage 3.3.alpha2



---

archive/issue_events_014989.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-24T17:45:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4981",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4981#event-14989"
}
```
