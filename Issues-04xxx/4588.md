# Issue 4588: [with patch; positive review] doctest -- get rid of the "feature" where docstrings with require, optional, and package all in them are automatically marked optional

archive/issues_004588.json:
```json
{
    "body": "This \"feature\" that I introduced years ago is incredibly confusing.  3 people at least got very confused by this in the last 3-4 days. \n\nTo close this ticket:\n1. remove this functionality from local/bin/sage-*test*\n\n2. rewrite all the files that use this by tediously marking each optional line with #optional.   This is tedious, but it is much much clearer what is going on.  \n\nNote -- only do this *after* apply #4583, which already does some of part 2 above. \n\nAssignee: mabshoff\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4588\n\n",
    "closed_at": "2009-01-24T15:30:38Z",
    "created_at": "2008-11-23T02:44:06Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "[with patch; positive review] doctest -- get rid of the \"feature\" where docstrings with require, optional, and package all in them are automatically marked optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4588",
    "user": "https://github.com/williamstein"
}
```
This "feature" that I introduced years ago is incredibly confusing.  3 people at least got very confused by this in the last 3-4 days. 

To close this ticket:
1. remove this functionality from local/bin/sage-*test*

2. rewrite all the files that use this by tediously marking each optional line with #optional.   This is tedious, but it is much much clearer what is going on.  

Note -- only do this *after* apply #4583, which already does some of part 2 above. 

Assignee: mabshoff

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/4588





---

archive/issue_comments_037318.json:
```json
{
    "body": "<a id='comment:1'></a>\nNOTE: Some people want a \n\n```\n# start optional\n...\n# end optional\n```\nsystem to allow for optional blocks. \n\nI'm not sure.  I think I don't like this.\n\nOne way to implement this though would be in sage-doctest when parsing the docstring if start optional appears, just mark everything # optional through to where end optional appears.  I guess.",
    "created_at": "2008-11-23T02:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37318",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>
NOTE: Some people want a 

```
# start optional
...
# end optional
```
system to allow for optional blocks. 

I'm not sure.  I think I don't like this.

One way to implement this though would be in sage-doctest when parsing the docstring if start optional appears, just mark everything # optional through to where end optional appears.  I guess.



---

archive/issue_events_010437.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-01-23T01:34:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "milestone": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4588#event-10437"
}
```



---

archive/issue_comments_037319.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [trac_4588-scripts.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-scripts.patch) by @williamstein created at 2009-01-23 01:34:23\n\nFallout after applying the patch:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 1 doctests failed\n        sage -t  devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # 1 doctests failed\n        sage -t  devel/sage/sage/interfaces/matlab.py # 1 doctests failed\n        sage -t  devel/sage/sage/interfaces/macaulay2.py # 1 doctests failed\n        sage -t  devel/sage/sage/interfaces/octave.py # 2 doctests failed\n        sage -t  devel/sage/sage/interfaces/scilab.py # 5 doctests failed\n        sage -t  devel/sage/sage/interfaces/lie.py # 1 doctests failed\n        sage -t  devel/sage/sage/interfaces/kash.py # 100 doctests failed\n        sage -t  devel/sage/sage/interfaces/maple.py # 40 doctests failed\n        sage -t  devel/sage/sage/interfaces/mupad.py # 19 doctests failed\n        sage -t  devel/sage/sage/interfaces/qepcad.py # 66 doctests failed\n        sage -t  devel/sage/sage/combinat/designs/incidence_structures.py # 1 doctests failed\n        sage -t  devel/sage/sage/databases/sloane.py # 3 doctests failed\n        sage -t  devel/sage/sage/databases/jones.py # 4 doctests failed\n        sage -t  devel/sage/sage/databases/stein_watkins.py # 21 doctests failed\n        sage -t  devel/sage/sage/groups/perm_gps/permgroup.py # 1 doctests failed\n        sage -t  devel/sage/sage/graphs/graph_database.py # 1 doctests failed\n        sage -t  devel/sage/sage/coding/linear_code.py # 4 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 171.8 seconds\n```",
    "created_at": "2009-01-23T01:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37319",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
Attachment [trac_4588-scripts.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-scripts.patch) by @williamstein created at 2009-01-23 01:34:23

Fallout after applying the patch:

```
----------------------------------------------------------------------

The following tests failed:

        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 1 doctests failed
        sage -t  devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # 1 doctests failed
        sage -t  devel/sage/sage/interfaces/matlab.py # 1 doctests failed
        sage -t  devel/sage/sage/interfaces/macaulay2.py # 1 doctests failed
        sage -t  devel/sage/sage/interfaces/octave.py # 2 doctests failed
        sage -t  devel/sage/sage/interfaces/scilab.py # 5 doctests failed
        sage -t  devel/sage/sage/interfaces/lie.py # 1 doctests failed
        sage -t  devel/sage/sage/interfaces/kash.py # 100 doctests failed
        sage -t  devel/sage/sage/interfaces/maple.py # 40 doctests failed
        sage -t  devel/sage/sage/interfaces/mupad.py # 19 doctests failed
        sage -t  devel/sage/sage/interfaces/qepcad.py # 66 doctests failed
        sage -t  devel/sage/sage/combinat/designs/incidence_structures.py # 1 doctests failed
        sage -t  devel/sage/sage/databases/sloane.py # 3 doctests failed
        sage -t  devel/sage/sage/databases/jones.py # 4 doctests failed
        sage -t  devel/sage/sage/databases/stein_watkins.py # 21 doctests failed
        sage -t  devel/sage/sage/groups/perm_gps/permgroup.py # 1 doctests failed
        sage -t  devel/sage/sage/graphs/graph_database.py # 1 doctests failed
        sage -t  devel/sage/sage/coding/linear_code.py # 4 doctests failed
----------------------------------------------------------------------
Total time for all tests: 171.8 seconds
```



---

archive/issue_comments_037320.json:
```json
{
    "body": "fix fallout in the core library.",
    "created_at": "2009-01-23T09:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37320",
    "user": "https://github.com/williamstein"
}
```

fix fallout in the core library.



---

archive/issue_comments_037321.json:
```json
{
    "body": "Attachment [trac_4588-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-sage.patch) by @williamstein created at 2009-01-23 09:28:32",
    "created_at": "2009-01-23T09:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37321",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_4588-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-sage.patch) by @williamstein created at 2009-01-23 09:28:32



---

archive/issue_comments_037322.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_4588-part2-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-part2-sage.patch) by @williamstein created at 2009-01-23 09:30:52\n\nThe attached sage patches fix all missing # optionals after applying the scripts patch (the first one -- trac_4588-scripts.patch).  I also greatly improve the use of \n\n```\n  # optional -- name_of_package\n```\nwhile I was at it.\n\nHowever, note that this revealed some bugs in David Joyner's linear_code.py stuff.  See #5067. Thus I believe this patch should receive a positive review *despite* that after applying it suddenly four doctests will fail.   I've made #5067 a blocker.",
    "created_at": "2009-01-23T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37322",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
Attachment [trac_4588-part2-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-part2-sage.patch) by @williamstein created at 2009-01-23 09:30:52

The attached sage patches fix all missing # optionals after applying the scripts patch (the first one -- trac_4588-scripts.patch).  I also greatly improve the use of 

```
  # optional -- name_of_package
```
while I was at it.

However, note that this revealed some bugs in David Joyner's linear_code.py stuff.  See #5067. Thus I believe this patch should receive a positive review *despite* that after applying it suddenly four doctests will fail.   I've made #5067 a blocker.



---

archive/issue_comments_037323.json:
```json
{
    "body": "Attachment [trac_4588-part3-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-part3-sage.patch) by @williamstein created at 2009-01-24 00:55:53",
    "created_at": "2009-01-24T00:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37323",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_4588-part3-sage.patch](tarball://root/attachments/some-uuid/ticket4588/trac_4588-part3-sage.patch) by @williamstein created at 2009-01-24 00:55:53



---

archive/issue_comments_037324.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think that this set of patches should be merged in. They all applied cleanly to alpha0 (I don't know about alpha1), and this definitely needs to be done. I think that any remaining issues which arise once this does get merged should become their own ticket.",
    "created_at": "2009-01-24T13:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37324",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:4'></a>
I think that this set of patches should be merged in. They all applied cleanly to alpha0 (I don't know about alpha1), and this definitely needs to be done. I think that any remaining issues which arise once this does get merged should become their own ticket.



---

archive/issue_comments_037325.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-01-24T15:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37325",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_037326.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged in Sage 3.3.alpha2",
    "created_at": "2009-01-24T15:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4588#issuecomment-37326",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged in Sage 3.3.alpha2



---

archive/issue_events_010438.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-01-24T15:30:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4588",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4588#event-10438"
}
```
