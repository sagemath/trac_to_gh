# Issue 4949: Optionally build spkgs in $SAGE_BUILD_DIR

archive/issues_004949.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mabshoff"
    ],
    "body": "`$SAGE_ROOT/spkg/build` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_DIR` instead of `$SAGE_ROOT/spkg/build/`.\n\n---\n\nApply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) and [attachment: 4949_review.patch](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz) to the Sage **root repository**.\n\nApply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.\n\n\nCC:  @sagetrac-drkirkby @nexttime\n\nKeywords: **sd32**\n\nComponent: **build**\n\nAuthor: **John Palmieri**\n\nReviewer: **Mariah Lenox, Leif Leonhardy, Maarten Derickx, Jeroen Demeyer**\n\nMerged: **sage-5.0.beta5**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4949_\n\n",
    "closed_at": "2012-02-22T10:43:54Z",
    "created_at": "2009-01-07T05:20:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Optionally build spkgs in $SAGE_BUILD_DIR",
    "type": "issue",
    "updated_at": "2012-03-06T19:39:09Z",
    "url": "https://github.com/sagemath/sage/issues/4949",
    "user": "https://github.com/sagetrac-mabshoff"
}
```
`$SAGE_ROOT/spkg/build` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_DIR` instead of `$SAGE_ROOT/spkg/build/`.

---

Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) and [attachment: 4949_review.patch](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz) to the Sage **root repository**.

Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.


CC:  @sagetrac-drkirkby @nexttime

Keywords: **sd32**

Component: **build**

Author: **John Palmieri**

Reviewer: **Mariah Lenox, Leif Leonhardy, Maarten Derickx, Jeroen Demeyer**

Merged: **sage-5.0.beta5**

_Issue created by migration from https://trac.sagemath.org/ticket/4949_





---

archive/issue_events_057510.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-07T05:20:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57510"
}
```



---

archive/issue_events_057511.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-07T05:20:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57511"
}
```



---

archive/issue_events_057512.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-07T05:20:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57512"
}
```



---

archive/issue_events_057513.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-07T05:20:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57513"
}
```



---

archive/issue_events_057514.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-07T05:20:19Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57514"
}
```



---

archive/issue_comments_029937.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs a temporary hack to see how this \"feels\" you could delete spkg/build, then make it a symlink to /tmp/build/.",
    "created_at": "2009-01-09T17:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29937",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">comment:2</div>

As a temporary hack to see how this "feels" you could delete spkg/build, then make it a symlink to /tmp/build/.



---

archive/issue_events_057515.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-08-06T21:50:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57515"
}
```



---

archive/issue_events_057516.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-08-06T21:50:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57516"
}
```



---

archive/issue_comments_029938.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2010-08-06T21:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29938",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_events_057517.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-08-06T21:50:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57517"
}
```



---

archive/issue_comments_029939.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHere's a patch.  This implements both `SAGE_BUILD_TMPDIR` and `SAGE_KEEP_BUILT_SPKGS` -- see #9444.  (This is an incremental change rather than a complete reworking of the sage-spkg script, which might be called for.)",
    "created_at": "2010-08-06T21:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29939",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

Here's a patch.  This implements both `SAGE_BUILD_TMPDIR` and `SAGE_KEEP_BUILT_SPKGS` -- see #9444.  (This is an incremental change rather than a complete reworking of the sage-spkg script, which might be called for.)



---

archive/issue_comments_029940.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nA little explanation: BUILD is defined (as \"build\") by sage-env, but it was used sporadically in sage-spkg.  With this patch, it is used more consistently.",
    "created_at": "2010-08-06T22:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29940",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

A little explanation: BUILD is defined (as "build") by sage-env, but it was used sporadically in sage-spkg.  With this patch, it is used more consistently.



---

archive/issue_comments_029941.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIf/when this merges, we should consider closing #6550.  `SAGE_KEEP_BUILT_SPKGS` is a much better name than `SAGE_KEEP_SPKG_BUILD`.",
    "created_at": "2010-08-06T22:37:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29941",
    "user": "https://github.com/qed777"
}
```

<div id="comment:5" align="right">comment:5</div>

If/when this merges, we should consider closing #6550.  `SAGE_KEEP_BUILT_SPKGS` is a much better name than `SAGE_KEEP_SPKG_BUILD`.



---

archive/issue_comments_029942.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To so so use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.\n+$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.\n \n Cheers,\n \n``````\n",
    "created_at": "2010-08-06T22:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29942",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To so so use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.
+$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.
 
 Cheers,
 
``````




---

archive/issue_comments_029943.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNice to see progress in the build process... :)\n\nSee also https://github.com/sagemath/sage/issues/6550#comment:7 .",
    "created_at": "2010-08-06T22:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29943",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Nice to see progress in the build process... :)

See also https://github.com/sagemath/sage/issues/6550#comment:7 .



---

archive/issue_comments_029944.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nShould `SAGE_BUILD_TMPDIR` default to `SAGE_TMPDIR`?\n\n(We have btw. lots of - in some cases not very well-named - environment variables.)\n\nMaking use of e.g. a RAM disk (or some user-provided directory) for doctesting is also worth doing.",
    "created_at": "2010-08-06T22:47:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29944",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Should `SAGE_BUILD_TMPDIR` default to `SAGE_TMPDIR`?

(We have btw. lots of - in some cases not very well-named - environment variables.)

Making use of e.g. a RAM disk (or some user-provided directory) for doctesting is also worth doing.



---

archive/issue_comments_029945.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nexttime](#comment:7):\n> Making use of e.g. a RAM disk (or some user-provided directory) for doctesting is also worth doing.\n\nYou can already set `SAGE_TESTDIR` (or `DOT_SAGE`) to do this.  Or maybe I misunderstand?",
    "created_at": "2010-08-19T21:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29945",
    "user": "https://github.com/qed777"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nexttime](#comment:7):
> Making use of e.g. a RAM disk (or some user-provided directory) for doctesting is also worth doing.

You can already set `SAGE_TESTDIR` (or `DOT_SAGE`) to do this.  Or maybe I misunderstand?



---

archive/issue_events_057518.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-20T14:01:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57518"
}
```



---

archive/issue_events_057519.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-20T14:01:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57519"
}
```



---

archive/issue_comments_029946.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n[attachment: trac_4949-scripts.patch] does not apply:\n\n```\nsage: hg_sage.apply(\"/home/mariah/trac_4949-scripts.patch\")\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage\" && hg import   \"/home/mariah/trac_4949-scripts.patch\"\napplying /home/mariah/trac_4949-scripts.patch\nunable to find 'sage-spkg' for patching\n5 out of 5 hunks FAILED -- saving rejects to file sage-spkg.rej\nabort: patch failed to apply\nsage: \n```",
    "created_at": "2011-05-20T14:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29946",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:9" align="right">comment:9</div>

[attachment: trac_4949-scripts.patch] does not apply:

```
sage: hg_sage.apply("/home/mariah/trac_4949-scripts.patch")
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-core2-fc/devel/sage" && hg import   "/home/mariah/trac_4949-scripts.patch"
applying /home/mariah/trac_4949-scripts.patch
unable to find 'sage-spkg' for patching
5 out of 5 hunks FAILED -- saving rejects to file sage-spkg.rej
abort: patch failed to apply
sage: 
```



---

archive/issue_events_057520.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-20T14:01:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57520"
}
```



---

archive/issue_events_057521.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-20T14:01:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57521"
}
```



---

archive/issue_events_057522.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-05-20T14:40:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57522"
}
```



---

archive/issue_events_057523.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-05-20T14:40:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57523"
}
```



---

archive/issue_comments_029947.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHere's a rebased version of [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz).  Note that it's for the scripts repository, so you have to apply it with \"hg_scripts.apply(...)\" rather than \"hg_sage.apply(...)\".",
    "created_at": "2011-05-20T14:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29947",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Here's a rebased version of [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz).  Note that it's for the scripts repository, so you have to apply it with "hg_scripts.apply(...)" rather than "hg_sage.apply(...)".



---

archive/issue_comments_029948.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI applied the patch [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz), then moved\nthe modified sage-spkg file to a fresh source directory of sage-4.7.rc4.  I set SAGE_BUILD_TMPDIR and SAGE_KEEP_BUILT_SPKGS, and\ndid 'make testlong'.  The builds took place in the location SAGE_BUILD_TMPDIR and all tests passed.  I applied the patch [attachment: trac_4949-installation.patch], did 'sage -b', then 'sage -docbuild installation html' and verified that the documentation change was made and makes sense.  Positive review.",
    "created_at": "2011-05-25T13:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29948",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:11" align="right">comment:11</div>

I applied the patch [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz), then moved
the modified sage-spkg file to a fresh source directory of sage-4.7.rc4.  I set SAGE_BUILD_TMPDIR and SAGE_KEEP_BUILT_SPKGS, and
did 'make testlong'.  The builds took place in the location SAGE_BUILD_TMPDIR and all tests passed.  I applied the patch [attachment: trac_4949-installation.patch], did 'sage -b', then 'sage -docbuild installation html' and verified that the documentation change was made and makes sense.  Positive review.



---

archive/issue_events_057524.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-25T13:35:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57524"
}
```



---

archive/issue_events_057525.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-25T13:35:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57525"
}
```



---

archive/issue_comments_029949.json:
```json
{
    "body": "Reviewer: **Mariah Lenox**",
    "created_at": "2011-05-25T13:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29949",
    "user": "https://github.com/sagetrac-mariah"
}
```

Reviewer: **Mariah Lenox**



---

archive/issue_comments_029950.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,8 @@\n $HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.\n \n-Cheers,\n+**Apply:** \n \n-Michael\n+1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) \n+\n+2. [attachment: trac_4949-installation.patch]\n+\n``````\n",
    "created_at": "2011-05-25T13:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29950",
    "user": "https://github.com/sagetrac-mariah"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,8 @@
 $HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.
 
-Cheers,
+**Apply:** 
 
-Michael
+1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) 
+
+2. [attachment: trac_4949-installation.patch]
+
``````




---

archive/issue_comments_029951.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,6 @@\n $HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.\n \n-**Apply:** \n+**Apply:**\n+1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)\n+2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)\n \n-1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) \n-\n-2. [attachment: trac_4949-installation.patch]\n-\n``````\n",
    "created_at": "2011-05-27T08:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29951",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,6 @@
 $HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.
 
-**Apply:** 
+**Apply:**
+1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)
+2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)
 
-1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) 
-
-2. [attachment: trac_4949-installation.patch]
-
``````




---

archive/issue_events_057526.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-27T08:07:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57526"
}
```



---

archive/issue_events_057527.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-27T08:07:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57527"
}
```



---

archive/issue_comments_029952.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI think one should add a note in the documentation about how much disk space this is expected to use.  Are the spkgs first all built and then all deleted or are they built-deleted one by one?",
    "created_at": "2011-05-27T08:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29952",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

I think one should add a note in the documentation about how much disk space this is expected to use.  Are the spkgs first all built and then all deleted or are they built-deleted one by one?



---

archive/issue_comments_029953.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWouldn't it be sufficient to just (keep the -- perhaps slightly modified -- documentation and the three lines honoring `SAGE_KEEP_BUILT_SPKGS` and) change the variable `BUILD` (bad name btw.) in `sage-env` if `SAGE_BUILD_TMPDIR` is set?\n\nThat way this ticket would hardly collide with #11021, which fixes a lot in `sage-spkg` (and a bug in `sage-env` w.r.t. `BUILD`), also using `$BUILD` consistently there.\n\nI also would use `SAGE_BUILD_TMPDIR` \"directly\", without creating yet another subdirectory (`build`) in it; the spkgs are extracted into their own directories anyway.",
    "created_at": "2011-08-03T14:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29953",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

Wouldn't it be sufficient to just (keep the -- perhaps slightly modified -- documentation and the three lines honoring `SAGE_KEEP_BUILT_SPKGS` and) change the variable `BUILD` (bad name btw.) in `sage-env` if `SAGE_BUILD_TMPDIR` is set?

That way this ticket would hardly collide with #11021, which fixes a lot in `sage-spkg` (and a bug in `sage-env` w.r.t. `BUILD`), also using `$BUILD` consistently there.

I also would use `SAGE_BUILD_TMPDIR` "directly", without creating yet another subdirectory (`build`) in it; the spkgs are extracted into their own directories anyway.



---

archive/issue_comments_029954.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOoops, unfortunately it's not *that* easy, because `$BUILD` is also just used as a *sub*directory name in `sage-spkg`.",
    "created_at": "2011-08-03T14:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29954",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

Ooops, unfortunately it's not *that* easy, because `$BUILD` is also just used as a *sub*directory name in `sage-spkg`.



---

archive/issue_comments_029955.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> I think one should add a note in the documentation about how much disk space this is expected to use.  Are the spkgs first all built and then all deleted or are they built-deleted one by one?\n\nI've modified the documentation to try to address this.  I built Sage on various machines (sage.math, David Kirkby's machine hawk, various skynet machines), and found that\n\n- the single largest subdirectory of \"build\" can be up to 1165M (building eclib on the skynet machines iras and cleo, ia64 processors).  On all of the other machines, it took at most 880M.  On sage.math, cicero, and my mac, the largest took 320M.\n\n- the total amount of disk space, if you keep all of the subdirectories can be as large as 5.3G (iras and cleo again) or as small as 2.2G (hawk).\n\nI've put in conservative estimates for these in the documentation.",
    "created_at": "2011-08-04T15:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29955",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> I think one should add a note in the documentation about how much disk space this is expected to use.  Are the spkgs first all built and then all deleted or are they built-deleted one by one?

I've modified the documentation to try to address this.  I built Sage on various machines (sage.math, David Kirkby's machine hawk, various skynet machines), and found that

- the single largest subdirectory of "build" can be up to 1165M (building eclib on the skynet machines iras and cleo, ia64 processors).  On all of the other machines, it took at most 880M.  On sage.math, cicero, and my mac, the largest took 320M.

- the total amount of disk space, if you keep all of the subdirectories can be as large as 5.3G (iras and cleo again) or as small as 2.2G (hawk).

I've put in conservative estimates for these in the documentation.



---

archive/issue_events_057528.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-08-04T15:27:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57528"
}
```



---

archive/issue_events_057529.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-08-04T15:27:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57529"
}
```



---

archive/issue_comments_029956.json:
```json
{
    "body": "Changed reviewer from **Mariah Lenox** to **Mariah Lenox, Leif Leonhardy**",
    "created_at": "2011-08-04T18:12:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29956",
    "user": "https://github.com/nexttime"
}
```

Changed reviewer from **Mariah Lenox** to **Mariah Lenox, Leif Leonhardy**



---

archive/issue_comments_029957.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment:16):\n> I've modified the documentation to try to address this.\n\nThe usage of `$` is a bit inconsistent: <code>:file:\\`$SAGE_ROOT/...\\`</code> vs. <code>:file:\\`SAGE_BUILD_TMPDIR/...\\`</code>.\n\nI would add a warning that `SAGE_BUILD_TMPDIR` must not contain spaces, and should be an absolute path (starting with a slash or whatever). Note that none of this is checked in `sage-spkg`; also, a broken `test` might return `true` for an empty string, so I would also `test -n \"$SAGE_BUILD_TMPDIR\"`.\n\nAlso, if `SAGE_BUILD_TMPDIR` is set but the directory does not exist, no warning or error message is printed.\n\n\n\n\n> I built Sage on various machines [...] and found that [...]\n> I've put in conservative estimates for these in the documentation.\n\nThe actual space required or used does hardly depend on the platform, but the file system characteristics, i.e. the block size.\n\nThe worst case space usage is theoretically unlimited when taking into account rebuilds and (re)installations of newer packages, as old build dirs are moved to the `$BUILD/old/` directory if `-s` was specified or `SAGE_KEEP_BUILT_SPKGS=yes`.\n\n(Btw., for some reason the build dirs of the base packages never get deleted. Perhaps that's a side-effect of the \"`BUILD` bug\", haven't tracked this down.)\n\nI would mention the relationship to the `-s` parameter when installing packages with `sage`; the main reason for the additional environment variable is that there's no other way to achieve what `-s` does when using `make`.",
    "created_at": "2011-08-04T18:12:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29957",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment:16):
> I've modified the documentation to try to address this.

The usage of `$` is a bit inconsistent: <code>:file:\`$SAGE_ROOT/...\`</code> vs. <code>:file:\`SAGE_BUILD_TMPDIR/...\`</code>.

I would add a warning that `SAGE_BUILD_TMPDIR` must not contain spaces, and should be an absolute path (starting with a slash or whatever). Note that none of this is checked in `sage-spkg`; also, a broken `test` might return `true` for an empty string, so I would also `test -n "$SAGE_BUILD_TMPDIR"`.

Also, if `SAGE_BUILD_TMPDIR` is set but the directory does not exist, no warning or error message is printed.




> I built Sage on various machines [...] and found that [...]
> I've put in conservative estimates for these in the documentation.

The actual space required or used does hardly depend on the platform, but the file system characteristics, i.e. the block size.

The worst case space usage is theoretically unlimited when taking into account rebuilds and (re)installations of newer packages, as old build dirs are moved to the `$BUILD/old/` directory if `-s` was specified or `SAGE_KEEP_BUILT_SPKGS=yes`.

(Btw., for some reason the build dirs of the base packages never get deleted. Perhaps that's a side-effect of the "`BUILD` bug", haven't tracked this down.)

I would mention the relationship to the `-s` parameter when installing packages with `sage`; the main reason for the additional environment variable is that there's no other way to achieve what `-s` does when using `make`.



---

archive/issue_comments_029958.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@nexttime](#comment:17):\n> The actual space required or used does hardly depend on the platform, but the file system characteristics, i.e. the block size.\n\nWell, many of the systems on which I tested were on skynet, built in subdirectories of a shared home directory -- all of the skynet machines use the same $HOME.  On some of those machines, building eclib took over 1 gigabyte, while on others, it took under 320 megabytes.  There are certainly differences between the types of libraries produced: .so files on linux, .dylib files on darwin, etc.  I would also guess that the size of the library files might vary depending on the compiler, whether it's 32- or 64-bit, etc.\n\n> The worst case space usage is theoretically unlimited when taking into account rebuilds and (re)installations of newer packages, as old build dirs are moved to the $BUILD/old/ directory if -s was specified or SAGE_KEEP_BUILT_SPKGS=yes.\n\nRight, but the documentation as written is accurate (\"After a full build of Sage...\") and I think is good enough.  Anyone who sets this variable should be paying attention to the build directory anyway.\n\n> (Btw., for some reason the build dirs of the base packages never get deleted. Perhaps that's a side-effect of the \"BUILD bug\", haven't tracked this down.)\n\n`prereq` and `bzip` are not installed by sage-spkg but by their own install scripts (`prereq-0.9-install` and `bzip2-1.0.5-install`), which create subdirectories of `build` but don't delete them when they're done.\n\nAdding a comment about the relationship to the `-s` option is a good idea.  I'll try to add some tests for `SAGE_BUILD_TEMPDIR`, too.",
    "created_at": "2011-08-07T20:50:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29958",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@nexttime](#comment:17):
> The actual space required or used does hardly depend on the platform, but the file system characteristics, i.e. the block size.

Well, many of the systems on which I tested were on skynet, built in subdirectories of a shared home directory -- all of the skynet machines use the same $HOME.  On some of those machines, building eclib took over 1 gigabyte, while on others, it took under 320 megabytes.  There are certainly differences between the types of libraries produced: .so files on linux, .dylib files on darwin, etc.  I would also guess that the size of the library files might vary depending on the compiler, whether it's 32- or 64-bit, etc.

> The worst case space usage is theoretically unlimited when taking into account rebuilds and (re)installations of newer packages, as old build dirs are moved to the $BUILD/old/ directory if -s was specified or SAGE_KEEP_BUILT_SPKGS=yes.

Right, but the documentation as written is accurate ("After a full build of Sage...") and I think is good enough.  Anyone who sets this variable should be paying attention to the build directory anyway.

> (Btw., for some reason the build dirs of the base packages never get deleted. Perhaps that's a side-effect of the "BUILD bug", haven't tracked this down.)

`prereq` and `bzip` are not installed by sage-spkg but by their own install scripts (`prereq-0.9-install` and `bzip2-1.0.5-install`), which create subdirectories of `build` but don't delete them when they're done.

Adding a comment about the relationship to the `-s` option is a good idea.  I'll try to add some tests for `SAGE_BUILD_TEMPDIR`, too.



---

archive/issue_comments_029959.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHere are two new patches.  The scripts patch checks for the existence of SAGE_BUILD_TMPDIR, and it also should correctly delete the build subdirectories afterwards -- I had missed this in the previous patch.",
    "created_at": "2011-08-08T03:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29959",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Here are two new patches.  The scripts patch checks for the existence of SAGE_BUILD_TMPDIR, and it also should correctly delete the build subdirectories afterwards -- I had missed this in the previous patch.



---

archive/issue_comments_029960.json:
```json
{
    "body": "scripts repo",
    "created_at": "2011-08-08T03:05:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29960",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/issue_comments_029961.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac_4949-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)**\n\nThere's a `$` missing in\n\n```\n:file:`$SAGE_ROOT/spkg/build` or :file:`SAGE_BUILD_TMPDIR/build`\n```\n\nI would clarify that `SAGE_KEEP_BUILT_SPKGS=yes` affects *all* spkg installations (whether with `./sage [-i|-f]` or `make`, the latter also when *re*building [parts of] Sage), and that the build directory (within the Sage tree or in `$SAGE_BUILD_TMPDIR/`) will definitely grow over time, i.e., whenever new packages get installed or already existing / built packages reinstalled, unless one unsets `SAGE_KEEP_BUILT_SPKGS` at some point (which of course doesn't delete existing subdirectories in the first place).\n\n\n\n\nYour observations regarding the build tree sizes on skynet are interesting; there IMHO shouldn't be such a large difference, at least not when doing \"the same thing\".\n\nThere are differences in object code size between RISC and CISC architectures (on the former usually larger, but *at most* by a factor of 2 I think) and between 32-bit and 64-bit (mostly on RISC architectures, and also if there's a lot of static data involving e.g. pointers or integers of different size); other differences might be due to debug symbols and *how and what* we build (e.g. assembly implementations, static or dynamic libraries in addition) on a specific platform.\n\nI would mention the effect of the block size of the file system though (as a note perhaps), since many packages consist of a large number of small files.",
    "created_at": "2011-08-08T12:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29961",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac_4949-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)**

There's a `$` missing in

```
:file:`$SAGE_ROOT/spkg/build` or :file:`SAGE_BUILD_TMPDIR/build`
```

I would clarify that `SAGE_KEEP_BUILT_SPKGS=yes` affects *all* spkg installations (whether with `./sage [-i|-f]` or `make`, the latter also when *re*building [parts of] Sage), and that the build directory (within the Sage tree or in `$SAGE_BUILD_TMPDIR/`) will definitely grow over time, i.e., whenever new packages get installed or already existing / built packages reinstalled, unless one unsets `SAGE_KEEP_BUILT_SPKGS` at some point (which of course doesn't delete existing subdirectories in the first place).




Your observations regarding the build tree sizes on skynet are interesting; there IMHO shouldn't be such a large difference, at least not when doing "the same thing".

There are differences in object code size between RISC and CISC architectures (on the former usually larger, but *at most* by a factor of 2 I think) and between 32-bit and 64-bit (mostly on RISC architectures, and also if there's a lot of static data involving e.g. pointers or integers of different size); other differences might be due to debug symbols and *how and what* we build (e.g. assembly implementations, static or dynamic libraries in addition) on a specific platform.

I would mention the effect of the block size of the file system though (as a note perhaps), since many packages consist of a large number of small files.



---

archive/issue_comments_029962.json:
```json
{
    "body": "Attachment: **[trac_4949-installation.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)**\n\nsage repo: update installation guide",
    "created_at": "2011-08-08T15:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29962",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-installation.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)**

sage repo: update installation guide



---

archive/issue_comments_029963.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@nexttime](#comment:20):\n> I would clarify that `SAGE_KEEP_BUILT_SPKGS=yes` affects *all* spkg installations.\n\nDone\n\n> and that the build directory will definitely grow over time\n\nI've added some explanation.  It doesn't grow quite as fast as it might, since pre-existing subdirectories are moved to SAGE_ROOT/spkg/build/old/, *overwriting* copies that were already there.  So just reinstalling Sage over and over again will just use twice as much as space as doing it once.  Upgrading will then take up more space.\n\n> Your observations regarding the build tree sizes on skynet are interesting; there IMHO shouldn't be such a large difference, at least not when doing \"the same thing\".\n\n\"eclib\" is the usual culprit.  There are huge differences in the amount of disk space it uses, so on some systems it is by far the largest, and on others, it isn't.  On the skynet machines, \"moin\" uses a consistent 320 megabytes, whereas eclib ranges from something under that to over 1 gig, depending on the OS and the processor.\n\n> I would mention the effect of the block size of the file system though (as a note perhaps), since many packages consist of a large number of small files.\n\nDone.",
    "created_at": "2011-08-08T16:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29963",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@nexttime](#comment:20):
> I would clarify that `SAGE_KEEP_BUILT_SPKGS=yes` affects *all* spkg installations.

Done

> and that the build directory will definitely grow over time

I've added some explanation.  It doesn't grow quite as fast as it might, since pre-existing subdirectories are moved to SAGE_ROOT/spkg/build/old/, *overwriting* copies that were already there.  So just reinstalling Sage over and over again will just use twice as much as space as doing it once.  Upgrading will then take up more space.

> Your observations regarding the build tree sizes on skynet are interesting; there IMHO shouldn't be such a large difference, at least not when doing "the same thing".

"eclib" is the usual culprit.  There are huge differences in the amount of disk space it uses, so on some systems it is by far the largest, and on others, it isn't.  On the skynet machines, "moin" uses a consistent 320 megabytes, whereas eclib ranges from something under that to over 1 gig, depending on the OS and the processor.

> I would mention the effect of the block size of the file system though (as a note perhaps), since many packages consist of a large number of small files.

Done.



---

archive/issue_events_057530.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-08-24T02:46:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57530"
}
```



---

archive/issue_events_057531.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-08-24T02:46:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57531"
}
```



---

archive/issue_comments_029964.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI've build sage entirely from scratch after applying the patch and replacing the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base and passing all doctest . Both with and without the environment variables set. So I think this one is ready to get merged.",
    "created_at": "2011-08-24T02:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29964",
    "user": "https://github.com/koffie"
}
```

<div id="comment:22" align="right">comment:22</div>

I've build sage entirely from scratch after applying the patch and replacing the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base and passing all doctest . Both with and without the environment variables set. So I think this one is ready to get merged.



---

archive/issue_comments_029965.json:
```json
{
    "body": "Changed reviewer from **Mariah Lenox, Leif Leonhardy** to **Mariah Lenox, Leif Leonhardy, Maarten Derickx**",
    "created_at": "2011-08-24T02:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29965",
    "user": "https://github.com/koffie"
}
```

Changed reviewer from **Mariah Lenox, Leif Leonhardy** to **Mariah Lenox, Leif Leonhardy, Maarten Derickx**



---

archive/issue_comments_029966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,4 @@\n 1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)\n 2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)\n \n+after applying replace the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base with the new version\n``````\n",
    "created_at": "2011-08-24T02:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29966",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,4 @@
 1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)
 2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)
 
+after applying replace the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base with the new version
``````




---

archive/issue_comments_029967.json:
```json
{
    "body": "Changed keywords from none to **sd32**",
    "created_at": "2011-08-24T23:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29967",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from none to **sd32**



---

archive/issue_comments_029968.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThen all of the changes of #11021 will have to be rebased on this one...\n\nPerhaps easier the other way around. (Note that I still haven't updated the patches there though.)",
    "created_at": "2011-08-25T05:16:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29968",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

Then all of the changes of #11021 will have to be rebased on this one...

Perhaps easier the other way around. (Note that I still haven't updated the patches there though.)



---

archive/issue_events_057532.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-09T05:16:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57532"
}
```



---

archive/issue_events_057533.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-09T05:16:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57533"
}
```



---

archive/issue_comments_029969.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n-$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.\n+`$HOME` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.\n \n-**Apply:**\n-1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)\n-2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)\n+---\n \n-after applying replace the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base with the new version\n+Apply [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) to the Sage **scripts repository**.\n+\n+Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.\n+\n+**After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version.**\n``````\n",
    "created_at": "2011-09-09T05:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29969",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
-$HOME can be slow in case it is NFS mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use $SAGE_BUILD_TMPDIR in case it exists instead of $SAGE_ROOT/spkg/build.
+`$HOME` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.
 
-**Apply:**
-1. [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz)
-2. [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz)
+---
 
-after applying replace the bootstrap version of sage-spkg in SAGE_ROOT/spkg/base with the new version
+Apply [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) to the Sage **scripts repository**.
+
+Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.
+
+**After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version.**
``````




---

archive/issue_comments_029970.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nBy the way, regarding \"After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version\": this is taken care of automatically by the `sage-sdist` script, if one is making a new source distribution.  You just have to make sure that the version in local/bin is up to date.",
    "created_at": "2011-09-09T22:15:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29970",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

By the way, regarding "After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version": this is taken care of automatically by the `sage-sdist` script, if one is making a new source distribution.  You just have to make sure that the version in local/bin is up to date.



---

archive/issue_comments_029971.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jhpalmieri](#comment:27):\n> By the way, regarding \"After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version\": this is taken care of automatically by the `sage-sdist` script, if one is making a new source distribution.  You just have to make sure that the version in local/bin is up to date.\n\nYep.\n\nHope you don't mind me temporarily moving this to \"sage-pending\"; I intend to finish #11021 and rebase the patch(es) here on that, the latter presumably much easier than the other way around.\n\nIf I don't find the time, I'll set the milestone back to 4.7.2 of course.",
    "created_at": "2011-09-09T22:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29971",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jhpalmieri](#comment:27):
> By the way, regarding "After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version": this is taken care of automatically by the `sage-sdist` script, if one is making a new source distribution.  You just have to make sure that the version in local/bin is up to date.

Yep.

Hope you don't mind me temporarily moving this to "sage-pending"; I intend to finish #11021 and rebase the patch(es) here on that, the latter presumably much easier than the other way around.

If I don't find the time, I'll set the milestone back to 4.7.2 of course.



---

archive/issue_comments_029972.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSee also #329 which touches sage-spkg, although not in a very complicated way.",
    "created_at": "2011-09-10T01:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29972",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

See also #329 which touches sage-spkg, although not in a very complicated way.



---

archive/issue_comments_029973.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIs there any update to this?  It has been several months since the last update, and some of us are eagerly anticipating this. :)",
    "created_at": "2012-01-22T21:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29973",
    "user": "https://github.com/swenson"
}
```

<div id="comment:30" align="right">comment:30</div>

Is there any update to this?  It has been several months since the last update, and some of us are eagerly anticipating this. :)



---

archive/issue_comments_029974.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI've rebased this to Sage 5.0.beta1.  It had a positive review already, so I'm leaving it that way.",
    "created_at": "2012-01-23T15:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29974",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">comment:31</div>

I've rebased this to Sage 5.0.beta1.  It had a positive review already, so I'm leaving it that way.



---

archive/issue_events_057534.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-23T15:49:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57534"
}
```



---

archive/issue_events_057535.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-23T15:49:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57535"
}
```



---

archive/issue_comments_029975.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) to the Sage **scripts repository**.\n+Apply [attachment: trac_4949-root.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz) to the Sage **root repository**.\n \n Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.\n \n-**After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version.**\n``````\n",
    "created_at": "2012-01-23T15:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29975",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-scripts.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-scripts.patch.gz) to the Sage **scripts repository**.
+Apply [attachment: trac_4949-root.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz) to the Sage **root repository**.
 
 Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.
 
-**After applying, replace the bootstrap version of `sage-spkg` in `$SAGE_ROOT/spkg/base/` with the new version.**
``````




---

archive/issue_comments_029976.json:
```json
{
    "body": "Attachment: **[trac_4949-root.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz)**\n\nroot repo",
    "created_at": "2012-01-23T15:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29976",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz)**

root repo



---

archive/issue_comments_029977.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nDo we *really* want\n\n```\nBUILD=build\n```\n?\n\nI think we have too many variables already.\n\nAlso, why introduce a new variable `$BUILD_DIR` instead of using `$SAGE_BUILD_TMPDIR`?",
    "created_at": "2012-01-23T16:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29977",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Do we *really* want

```
BUILD=build
```
?

I think we have too many variables already.

Also, why introduce a new variable `$BUILD_DIR` instead of using `$SAGE_BUILD_TMPDIR`?



---

archive/issue_comments_029978.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@jdemeyer](#comment:32):\n> Do we *really* want\n\n\n ```\n BUILD=build\n ```\n> ?\n\nI don't see a reason for it, it was there before.  Should I create a new patch which removes it?  I think that would fix one or two of the issues from #11021.\n\n> Also, why introduce a new variable `$BUILD_DIR` instead of using `$SAGE_BUILD_TMPDIR`?\n\nThe code says, roughly\n\n```\nif $SAGE_BUILD_TMPDIR is not empty and points to an existing directory:\n    BUILD_DIR=$SAGE_BUILD_TMPDIR\nelse\n    BUILD_DIR=$SAGE_PACKAGES\nfi\n\nbuild Sage in $BUILD_DIR\n```",
    "created_at": "2012-01-23T18:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29978",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@jdemeyer](#comment:32):
> Do we *really* want


 ```
 BUILD=build
 ```
> ?

I don't see a reason for it, it was there before.  Should I create a new patch which removes it?  I think that would fix one or two of the issues from #11021.

> Also, why introduce a new variable `$BUILD_DIR` instead of using `$SAGE_BUILD_TMPDIR`?

The code says, roughly

```
if $SAGE_BUILD_TMPDIR is not empty and points to an existing directory:
    BUILD_DIR=$SAGE_BUILD_TMPDIR
else
    BUILD_DIR=$SAGE_PACKAGES
fi

build Sage in $BUILD_DIR
```



---

archive/issue_comments_029979.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nBut why not simplify this to:\n\n```\nif $SAGE_BUILD_TMPDIR is not empty:\n    sanity check $SAGE_BUILD_TMPDIR but don't change any variables\nelse\n    SAGE_BUILD_TMPDIR=$SAGE_PACKAGES\nfi\n\nbuild Sage in $SAGE_BUILD_TMPDIR\n```",
    "created_at": "2012-01-23T18:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29979",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

But why not simplify this to:

```
if $SAGE_BUILD_TMPDIR is not empty:
    sanity check $SAGE_BUILD_TMPDIR but don't change any variables
else
    SAGE_BUILD_TMPDIR=$SAGE_PACKAGES
fi

build Sage in $SAGE_BUILD_TMPDIR
```



---

archive/issue_events_057536.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-23T18:17:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57536"
}
```



---

archive/issue_events_057537.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-23T18:17:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57537"
}
```



---

archive/issue_comments_029980.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nConcerning `$BUILD`: it existed before, but was almost not used.  If the variable serves no purpose and is not meant to be customized, it is cleaner to delete it.",
    "created_at": "2012-01-23T18:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29980",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Concerning `$BUILD`: it existed before, but was almost not used.  If the variable serves no purpose and is not meant to be customized, it is cleaner to delete it.



---

archive/issue_comments_029981.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nSomething else: do we really want to build in\n\n```\n$SAGE_BUILD_TMPDIR/build/atlas-3.8.4.p1/\n```\n\nI would find it more natural to build in\n\n```\n$SAGE_BUILD_TMPDIR/atlas-3.8.4.p1/\n```\n\nAnd therefore, let $SAGE_BUILD_TMPDIR by default be equal to\n\n```\n$SAGE_ROOT/spkg/build/\n```\n\nAnd perhaps drop the requirement for `$SAGE_BUILD_TMPDIR` to be an existing directory: just create it if needed.\n\n(This is just an idea: I don't have strong feelings about this)",
    "created_at": "2012-01-23T18:22:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29981",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Something else: do we really want to build in

```
$SAGE_BUILD_TMPDIR/build/atlas-3.8.4.p1/
```

I would find it more natural to build in

```
$SAGE_BUILD_TMPDIR/atlas-3.8.4.p1/
```

And therefore, let $SAGE_BUILD_TMPDIR by default be equal to

```
$SAGE_ROOT/spkg/build/
```

And perhaps drop the requirement for `$SAGE_BUILD_TMPDIR` to be an existing directory: just create it if needed.

(This is just an idea: I don't have strong feelings about this)



---

archive/issue_comments_029982.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-root.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz) to the Sage **root repository**.\n+Apply [attachment: trac_4949-root.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz) to the Sage **root repository**.\n \n Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.\n \n``````\n",
    "created_at": "2012-01-23T23:13:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29982",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-root.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.patch.gz) to the Sage **root repository**.
+Apply [attachment: trac_4949-root.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz) to the Sage **root repository**.
 
 Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.
 
``````




---

archive/issue_comments_029983.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nIf you run \"sage -i blah\"  and \"blah\" is an optional spkg which needs to be downloaded, would it make more sense to save the spkg in $SAGE_ROOT/spkg/optional/ or in $SAGE_BUILD_TMPDIR/optional? The previous versions of the patch do the second of these, but I think it makes more sense to do the first: downloading spkg files for optional packages is not the same as building, so setting SAGE_BUILD_TMPDIR shouldn't cause the spkg files to end up somewhere nonstandard.  Another way to say it: I don't view downloaded spkg files for optional spkgs as temporary, the way build directories are.\n\nHere's a new patch.  I've removed the variables \"BUILD\" and \"BUILD_DIR\", and I've appended \"build\" to the setting of \"$SAGE_BUILD_TMPDIR\".  I still check whether `$SAGE_BUILD_TMPDIR` exists, as a safeguard against typos, for example.  Optional spkgs are kept in `$SAGE_PACKAGES/optional` regardless of the setting of `$SAGE_BUILD_TMPDIR.`",
    "created_at": "2012-01-23T23:13:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29983",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

If you run "sage -i blah"  and "blah" is an optional spkg which needs to be downloaded, would it make more sense to save the spkg in $SAGE_ROOT/spkg/optional/ or in $SAGE_BUILD_TMPDIR/optional? The previous versions of the patch do the second of these, but I think it makes more sense to do the first: downloading spkg files for optional packages is not the same as building, so setting SAGE_BUILD_TMPDIR shouldn't cause the spkg files to end up somewhere nonstandard.  Another way to say it: I don't view downloaded spkg files for optional spkgs as temporary, the way build directories are.

Here's a new patch.  I've removed the variables "BUILD" and "BUILD_DIR", and I've appended "build" to the setting of "$SAGE_BUILD_TMPDIR".  I still check whether `$SAGE_BUILD_TMPDIR` exists, as a safeguard against typos, for example.  Optional spkgs are kept in `$SAGE_PACKAGES/optional` regardless of the setting of `$SAGE_BUILD_TMPDIR.`



---

archive/issue_events_057538.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-23T23:13:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57538"
}
```



---

archive/issue_events_057539.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-23T23:13:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57539"
}
```



---

archive/issue_comments_029984.json:
```json
{
    "body": "Attachment: **[trac_4949-root.v2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz)**\n\nroot repo",
    "created_at": "2012-01-23T23:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29984",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root.v2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz)**

root repo



---

archive/issue_comments_029985.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\n`make clean` does not clean ` $SAGE_BUILD_TMPDIR `...\n\nI would also like ` $SAGE_BUILD_TMPDIR ` to be created if it does not exist, but I can live without.",
    "created_at": "2012-02-10T10:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29985",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:38" align="right">comment:38</div>

`make clean` does not clean ` $SAGE_BUILD_TMPDIR `...

I would also like ` $SAGE_BUILD_TMPDIR ` to be created if it does not exist, but I can live without.



---

archive/issue_events_057540.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-10T10:29:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57540"
}
```



---

archive/issue_events_057541.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-10T10:29:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57541"
}
```



---

archive/issue_events_057542.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-10T22:37:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57542"
}
```



---

archive/issue_events_057543.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-10T22:37:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57543"
}
```



---

archive/issue_comments_029986.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-root.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz) to the Sage **root repository**.\n+Apply [attachment: trac_4949-root.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz) to the Sage **root repository**.\n \n-Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.\n+Apply [attachment: trac_4949-installation.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz) to the **Sage library**.\n \n``````\n",
    "created_at": "2012-02-10T22:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29986",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-root.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v2.patch.gz) to the Sage **root repository**.
+Apply [attachment: trac_4949-root.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz) to the Sage **root repository**.
 
-Apply [attachment: trac_4949-installation.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.patch.gz) to the **Sage library**.
+Apply [attachment: trac_4949-installation.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz) to the **Sage library**.
 
``````




---

archive/issue_comments_029987.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOkay, here are new patches.  `make clean` and `make distclean` now clean `$SAGE_BUILD_TMPDIR`, and in sage-spkg, if the directory doesn't exist, it is created.  The documentation has been changed to reflect this.  (The \"delta\" patches are the differences between the old versions and the new ones, for reference.)",
    "created_at": "2012-02-10T22:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29987",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

Okay, here are new patches.  `make clean` and `make distclean` now clean `$SAGE_BUILD_TMPDIR`, and in sage-spkg, if the directory doesn't exist, it is created.  The documentation has been changed to reflect this.  (The "delta" patches are the differences between the old versions and the new ones, for reference.)



---

archive/issue_comments_029988.json:
```json
{
    "body": "root repo",
    "created_at": "2012-02-10T22:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29988",
    "user": "https://github.com/jhpalmieri"
}
```

root repo



---

archive/issue_comments_029989.json:
```json
{
    "body": "Attachment: **[trac_4949-root.v3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz)**\n\nroot repo: diff between v2 and v3",
    "created_at": "2012-02-10T22:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29989",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root.v3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz)**

root repo: diff between v2 and v3



---

archive/issue_comments_029990.json:
```json
{
    "body": "Attachment: **[trac_4949-root-delta2to3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta2to3.patch.gz)**\n\nsage repo: update installation guide",
    "created_at": "2012-02-10T22:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29990",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root-delta2to3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta2to3.patch.gz)**

sage repo: update installation guide



---

archive/issue_comments_029991.json:
```json
{
    "body": "Attachment: **[trac_4949-installation.v2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz)**\n\nAttachment: **[trac_4949-installation-delta1to2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation-delta1to2.patch.gz)**\n\nsage repo: diff between original and v2",
    "created_at": "2012-02-10T22:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29991",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-installation.v2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz)**

Attachment: **[trac_4949-installation-delta1to2.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation-delta1to2.patch.gz)**

sage repo: diff between original and v2



---

archive/issue_comments_029992.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jhpalmieri](#comment:37):\n> Optional spkgs are kept in `$SAGE_PACKAGES/optional` regardless of the setting of `$SAGE_BUILD_TMPDIR.`\n\nI totally agree on this.",
    "created_at": "2012-02-12T12:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29992",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jhpalmieri](#comment:37):
> Optional spkgs are kept in `$SAGE_PACKAGES/optional` regardless of the setting of `$SAGE_BUILD_TMPDIR.`

I totally agree on this.



---

archive/issue_comments_029993.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jhpalmieri](#comment:37):\n> I've appended \"build\" to the setting of \"$SAGE_BUILD_TMPDIR\".\n\nI ask you again: why???",
    "created_at": "2012-02-12T12:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29993",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jhpalmieri](#comment:37):
> I've appended "build" to the setting of "$SAGE_BUILD_TMPDIR".

I ask you again: why???



---

archive/issue_events_057544.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-12T12:35:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57544"
}
```



---

archive/issue_events_057545.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-12T12:35:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57545"
}
```



---

archive/issue_comments_029994.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@jdemeyer](#comment:41):\n> Replying to [@jhpalmieri](#comment:37):\n> > I've appended \"build\" to the setting of \"$SAGE_BUILD_TMPDIR\".\n\n> \n> I ask you again: why???\n\nIt feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should \"Also delete files in other directories if they are created by this makefile.\"",
    "created_at": "2012-02-12T16:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29994",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@jdemeyer](#comment:41):
> Replying to [@jhpalmieri](#comment:37):
> > I've appended "build" to the setting of "$SAGE_BUILD_TMPDIR".

> 
> I ask you again: why???

It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should "Also delete files in other directories if they are created by this makefile."



---

archive/issue_comments_029995.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@jhpalmieri](#comment:42):\n> Replying to [@jdemeyer](#comment:41):\n> > Replying to [@jhpalmieri](#comment:37):\n> > > I've appended \"build\" to the setting of \"$SAGE_BUILD_TMPDIR\".\n\n> > \n> > I ask you again: why???\n\n> \n> It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.\n\nMy opinion is that the user should set `SAGE_BUILD_TMPDIR=/tmp/build` if that's what he wants.\n\n> Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should \"Also delete files in other directories if they are created by this makefile.\"  \n\nI think it does make sense if `make clean` would always clean `$SAGE_ROOT/spkg/build` and not `SAGE_BUILD_TMPDIR`.\n\nAnyway: I don't want to fight over this.  I'm happy with whatever the outcome.  The last thing I want is that this ticket gets abandoned.",
    "created_at": "2012-02-14T09:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29995",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@jhpalmieri](#comment:42):
> Replying to [@jdemeyer](#comment:41):
> > Replying to [@jhpalmieri](#comment:37):
> > > I've appended "build" to the setting of "$SAGE_BUILD_TMPDIR".

> > 
> > I ask you again: why???

> 
> It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.

My opinion is that the user should set `SAGE_BUILD_TMPDIR=/tmp/build` if that's what he wants.

> Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should "Also delete files in other directories if they are created by this makefile."  

I think it does make sense if `make clean` would always clean `$SAGE_ROOT/spkg/build` and not `SAGE_BUILD_TMPDIR`.

Anyway: I don't want to fight over this.  I'm happy with whatever the outcome.  The last thing I want is that this ticket gets abandoned.



---

archive/issue_events_057546.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T09:46:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "title_is": "`",
    "title_was": "Optionally build spkgs in $SAGE_BUILD_TMPDIR",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57546"
}
```



---

archive/issue_comments_029996.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nOne other small thing: I would prefer the directory `build/old` to be created only when needed: replace the line\n\n```\nmkdir -p \"$SAGE_BUILD_TMPDIR/build/old\"\n```\nby\n\n```\nmkdir -p \"$SAGE_BUILD_TMPDIR/build\"\n```\n(and change the error message below)\n\nAnd also replace\n\n```\n\n    mv -f \"$PKG_BASE-\"* old/  2>/dev/null\n```\nby\n\n```\n    mkdir -p old\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error creating directory $SAGE_BUILD_TMPDIR/old.\"\n        exit 1\n    fi\n    mv -f \"$PKG_BASE-\"* old/\n```",
    "created_at": "2012-02-14T09:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29996",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

One other small thing: I would prefer the directory `build/old` to be created only when needed: replace the line

```
mkdir -p "$SAGE_BUILD_TMPDIR/build/old"
```
by

```
mkdir -p "$SAGE_BUILD_TMPDIR/build"
```
(and change the error message below)

And also replace

```

    mv -f "$PKG_BASE-"* old/  2>/dev/null
```
by

```
    mkdir -p old
    if [ $? -ne 0 ]; then
        echo >&2 "Error creating directory $SAGE_BUILD_TMPDIR/old."
        exit 1
    fi
    mv -f "$PKG_BASE-"* old/
```



---

archive/issue_comments_029997.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nIf you really want to go with the \"build\" subdirectory, I would prefer appending it immediately:\n\n```\nif [ -n \"$SAGE_BUILD_TMPDIR\" ]; then\n    SAGE_BUILD_TMPDIR=\"$SAGE_BUILD_TMPDIR/build\"\n    if [ ! -d \"$SAGE_BUILD_TMPDIR\" ]; then\n        echo \"Creating directory \\$SAGE_BUILD_TMPDIR (=$SAGE_BUILD_TMPDIR).\"\n        mkdir -p \"$SAGE_BUILD_TMPDIR\"\n    fi\n    echo \"Building in $SAGE_BUILD_TMPDIR.\"\nelse\n    SAGE_BUILD_TMPDIR=\"$SAGE_PACKAGES/build\"\nfi\n```\n(Actually, the whole `if [ ! -d ] ... fi` block can be removed).",
    "created_at": "2012-02-14T09:46:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29997",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

If you really want to go with the "build" subdirectory, I would prefer appending it immediately:

```
if [ -n "$SAGE_BUILD_TMPDIR" ]; then
    SAGE_BUILD_TMPDIR="$SAGE_BUILD_TMPDIR/build"
    if [ ! -d "$SAGE_BUILD_TMPDIR" ]; then
        echo "Creating directory \$SAGE_BUILD_TMPDIR (=$SAGE_BUILD_TMPDIR)."
        mkdir -p "$SAGE_BUILD_TMPDIR"
    fi
    echo "Building in $SAGE_BUILD_TMPDIR."
else
    SAGE_BUILD_TMPDIR="$SAGE_PACKAGES/build"
fi
```
(Actually, the whole `if [ ! -d ] ... fi` block can be removed).



---

archive/issue_events_057547.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T09:49:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "title_is": "Optionally build spkgs in $SAGE_BUILD_TMPDIR",
    "title_was": "`",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57547"
}
```



---

archive/issue_comments_029998.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-`$HOME` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.\n+`$SAGE_ROOT/spkg` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.\n \n ---\n \n``````\n",
    "created_at": "2012-02-14T09:49:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29998",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-`$HOME` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.
+`$SAGE_ROOT/spkg` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.
 
 ---
 
``````




---

archive/issue_comments_029999.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@jhpalmieri](#comment:42):\n> Replying to [@jdemeyer](#comment:41):\n> > I ask you again: why???\n\n> \n> It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should \"Also delete files in other directories if they are created by this makefile.\"  \n\nJohn, \n\nhow do you avoid a possible race condition if two or more instances of Sage (or some other program), want to use /tmp/build? Perhaps /tmp/$user-sage-$SageVersion.$$ might be better. Someone can then find their own Sage-related files easily (for example \n\n```\nrm -rf /tmp/drkirkby-sage-4.5.6*\n```\nwithout risk of their being any race condition. \n\n\nDave",
    "created_at": "2012-02-14T22:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-29999",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@jhpalmieri](#comment:42):
> Replying to [@jdemeyer](#comment:41):
> > I ask you again: why???

> 
> It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should "Also delete files in other directories if they are created by this makefile."  

John, 

how do you avoid a possible race condition if two or more instances of Sage (or some other program), want to use /tmp/build? Perhaps /tmp/$user-sage-$SageVersion.$$ might be better. Someone can then find their own Sage-related files easily (for example 

```
rm -rf /tmp/drkirkby-sage-4.5.6*
```
without risk of their being any race condition. 


Dave



---

archive/issue_comments_030000.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@sagetrac-drkirkby](#comment:47):\n> Replying to [@jhpalmieri](#comment:42):\n> > Replying to [@jdemeyer](#comment:41):\n> > > I ask you again: why???\n\n> > \n> > It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should \"Also delete files in other directories if they are created by this makefile.\"  \n\n> \n> John, \n> \n> how do you avoid a possible race condition if two or more instances of Sage (or some other program), want to use /tmp/build? \n\nI don't.  If someone wants to set `$SAGE_BUILD_TMPDIR`, then I'm making it their responsibility to make sure that the directory is available and in good shape.  (If someone does `export SAGE_BUILD_TMPDIR=/tmp/sage` and then we mangle the file name somehow, I think that will lead to confusion much more often than it will help.  We could instead build in `SAGE_BUILD_TMPDIR/subdir` where we choose `subdir` to avoid race conditions.  But I'm not going to do that.)\n\nMeanwhile, I have new versions of the patches.  I'm going to give in on the \"build\" subdirectory: Sage will now build in `SAGE_BUILD_TMPDIR`.  Oh, and I changed the name to `SAGE_BUILD_DIR` instead; I think that name makes more sense.  I also patched bzip2 and prereq so they build in `SAGE_BUILD_DIR` as well \u2014 easy to do now that the base repo has been merged with the root repo.  `make clean` no longer touches `SAGE_BUILD_DIR`, nor does `make distclean`.  (Also, `make clean` no longer recreates `spkg/build` or `spkg/archive` \u2014 what's that directory for, anyway?).\n\nI updated the documentation accordingly.",
    "created_at": "2012-02-14T23:19:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30000",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@sagetrac-drkirkby](#comment:47):
> Replying to [@jhpalmieri](#comment:42):
> > Replying to [@jdemeyer](#comment:41):
> > > I ask you again: why???

> > 
> > It feels cleaner to me: if I set `$SAGE_BUILD_TMPDIR=/tmp`, then rather than producing many subdirectories of `tmp`, everything will live in `/tmp/build`.  It's easier to clean up by hand, and `make clean` is easier to implement this way; otherwise, I suppose it would have to delete `/tmp/atlas-3.8.4.p1/`, `/tmp/blas-...`, etc.  Or `make clean` could not modify SAGE_BUILD_TMPDIR at all, but the Make manual suggests that `make clean` (and `make distclean`) should "Also delete files in other directories if they are created by this makefile."  

> 
> John, 
> 
> how do you avoid a possible race condition if two or more instances of Sage (or some other program), want to use /tmp/build? 

I don't.  If someone wants to set `$SAGE_BUILD_TMPDIR`, then I'm making it their responsibility to make sure that the directory is available and in good shape.  (If someone does `export SAGE_BUILD_TMPDIR=/tmp/sage` and then we mangle the file name somehow, I think that will lead to confusion much more often than it will help.  We could instead build in `SAGE_BUILD_TMPDIR/subdir` where we choose `subdir` to avoid race conditions.  But I'm not going to do that.)

Meanwhile, I have new versions of the patches.  I'm going to give in on the "build" subdirectory: Sage will now build in `SAGE_BUILD_TMPDIR`.  Oh, and I changed the name to `SAGE_BUILD_DIR` instead; I think that name makes more sense.  I also patched bzip2 and prereq so they build in `SAGE_BUILD_DIR` as well  easy to do now that the base repo has been merged with the root repo.  `make clean` no longer touches `SAGE_BUILD_DIR`, nor does `make distclean`.  (Also, `make clean` no longer recreates `spkg/build` or `spkg/archive`  what's that directory for, anyway?).

I updated the documentation accordingly.



---

archive/issue_events_057548.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-14T23:19:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57548"
}
```



---

archive/issue_events_057549.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-14T23:19:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57549"
}
```



---

archive/issue_comments_030001.json:
```json
{
    "body": "installation guide: diff between v2 and v3",
    "created_at": "2012-02-14T23:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30001",
    "user": "https://github.com/jhpalmieri"
}
```

installation guide: diff between v2 and v3



---

archive/issue_comments_030002.json:
```json
{
    "body": "Attachment: **[trac_4949-installation-delta2to3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation-delta2to3.patch.gz)**\n\nsage repo: update installation guide",
    "created_at": "2012-02-14T23:20:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30002",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-installation-delta2to3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation-delta2to3.patch.gz)**

sage repo: update installation guide



---

archive/issue_comments_030003.json:
```json
{
    "body": "Attachment: **[trac_4949-installation.v3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz)**\n\nroot repo: diff between v3 and v4",
    "created_at": "2012-02-14T23:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30003",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-installation.v3.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz)**

root repo: diff between v3 and v4



---

archive/issue_comments_030004.json:
```json
{
    "body": "Attachment: **[trac_4949-root-delta3to4.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta3to4.patch.gz)**\n\nroot repo",
    "created_at": "2012-02-14T23:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30004",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root-delta3to4.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta3to4.patch.gz)**

root repo



---

archive/issue_comments_030005.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nAttachment: **[trac_4949-root.v4.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz)**",
    "created_at": "2012-02-14T23:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30005",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:49" align="right">comment:49</div>

Attachment: **[trac_4949-root.v4.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz)**



---

archive/issue_comments_030006.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-root.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz) to the Sage **root repository**.\n+Apply [attachment: trac_4949-root.v4.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz) to the Sage **root repository**.\n \n-Apply [attachment: trac_4949-installation.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz) to the **Sage library**.\n+Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.\n \n``````\n",
    "created_at": "2012-02-14T23:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30006",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-root.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v3.patch.gz) to the Sage **root repository**.
+Apply [attachment: trac_4949-root.v4.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz) to the Sage **root repository**.
 
-Apply [attachment: trac_4949-installation.v2.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v2.patch.gz) to the **Sage library**.
+Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.
 
``````




---

archive/issue_events_057550.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-15T08:31:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57550"
}
```



---

archive/issue_events_057551.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-15T08:31:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57551"
}
```



---

archive/issue_comments_030007.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nLines 210 and 216 of `sage-spkg`: you have twice cd \"$SAGE_BUILD_DIR\".  Remove the second and move the check (line 219) up, after the first cd.  You probably want to \"exit 1\" if cd fails.\n\nLine 227 of `sage-spkg`: replace\n\n```\nif [ -e \"$dir\" ]; then\n```\nby\n\n```\nif [ -d \"$dir\" ]; then\n```",
    "created_at": "2012-02-15T08:31:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30007",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Lines 210 and 216 of `sage-spkg`: you have twice cd "$SAGE_BUILD_DIR".  Remove the second and move the check (line 219) up, after the first cd.  You probably want to "exit 1" if cd fails.

Line 227 of `sage-spkg`: replace

```
if [ -e "$dir" ]; then
```
by

```
if [ -d "$dir" ]; then
```



---

archive/issue_comments_030008.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nLine 235: why \"mv -f\" and not simply \"mv\"?",
    "created_at": "2012-02-15T09:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30008",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Line 235: why "mv -f" and not simply "mv"?



---

archive/issue_events_057552.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-15T18:08:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57552"
}
```



---

archive/issue_events_057553.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-15T18:08:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57553"
}
```



---

archive/issue_comments_030009.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@jdemeyer](#comment:50):\n> Lines 210 and 216 of `sage-spkg`: you have twice cd \"$SAGE_BUILD_DIR\".  Remove the second and move the check (line 219) up, after the first cd.  You probably want to \"exit 1\" if cd fails.\n\nWell, the old version had a second 'cd' command, justified by the comment\n\n```\n# Make triply sure that we are in the build directory before doing  \n# a scary \"rm -rf\"\n```\nSo I left the second one in.  You think I should change this?  In any case, you're right about the \"exit 1\".\n\n> Line 227 of `sage-spkg`: replace\n\n\n```\nif [ -e \"$dir\" ]; then\n```\n> by\n\n\n```\nif [ -d \"$dir\" ]; then\n```\n\nOn the off-chance that there is a file (not a directory) in the build directory with the wrong name, shouldn't we move it, too?\n\nReplying to [@jdemeyer](#comment:51):\n> Line 235: why \"mv -f\" and not simply \"mv\"?\n\nLeft over from the previous version. I can fix that.",
    "created_at": "2012-02-15T18:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30009",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@jdemeyer](#comment:50):
> Lines 210 and 216 of `sage-spkg`: you have twice cd "$SAGE_BUILD_DIR".  Remove the second and move the check (line 219) up, after the first cd.  You probably want to "exit 1" if cd fails.

Well, the old version had a second 'cd' command, justified by the comment

```
# Make triply sure that we are in the build directory before doing  
# a scary "rm -rf"
```
So I left the second one in.  You think I should change this?  In any case, you're right about the "exit 1".

> Line 227 of `sage-spkg`: replace


```
if [ -e "$dir" ]; then
```
> by


```
if [ -d "$dir" ]; then
```

On the off-chance that there is a file (not a directory) in the build directory with the wrong name, shouldn't we move it, too?

Replying to [@jdemeyer](#comment:51):
> Line 235: why "mv -f" and not simply "mv"?

Left over from the previous version. I can fix that.



---

archive/issue_comments_030010.json:
```json
{
    "body": "Attachment: **[trac_4949-root-delta4to5.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta4to5.patch.gz)**",
    "created_at": "2012-02-15T18:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30010",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_4949-root-delta4to5.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root-delta4to5.patch.gz)**



---

archive/issue_comments_030011.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-root.v4.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz) to the Sage **root repository**.\n+Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) to the Sage **root repository**.\n \n Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.\n \n``````\n",
    "created_at": "2012-02-15T18:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30011",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-root.v4.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v4.patch.gz) to the Sage **root repository**.
+Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) to the Sage **root repository**.
 
 Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.
 
``````




---

archive/issue_comments_030012.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAttachment: **[trac_4949-root.v5.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz)**",
    "created_at": "2012-02-15T18:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30012",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:53" align="right">comment:53</div>

Attachment: **[trac_4949-root.v5.patch.gz](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz)**



---

archive/issue_comments_030013.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nAttachment: **[4949_review.patch.gz](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz)**",
    "created_at": "2012-02-15T18:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30013",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

Attachment: **[4949_review.patch.gz](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz)**



---

archive/issue_comments_030014.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ---\n \n-Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) to the Sage **root repository**.\n+Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) and [attachment: 4949_review.patch](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz) to the Sage **root repository**.\n \n Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.\n \n``````\n",
    "created_at": "2012-02-15T18:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30014",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ---
 
-Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) to the Sage **root repository**.
+Apply [attachment: trac_4949-root.v5.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-root.v5.patch.gz) and [attachment: 4949_review.patch](https://github.com/sagemath/sage/files/ticket4949/4949_review.patch.gz) to the Sage **root repository**.
 
 Apply [attachment: trac_4949-installation.v3.patch](https://github.com/sagemath/sage/files/ticket4949/trac_4949-installation.v3.patch.gz) to the **Sage library**.
 
``````




---

archive/issue_comments_030015.json:
```json
{
    "body": "Changed reviewer from **Mariah Lenox, Leif Leonhardy, Maarten Derickx** to **Mariah Lenox, Leif Leonhardy, Maarten Derickx, Jeroen Demeyer**",
    "created_at": "2012-02-15T18:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30015",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Mariah Lenox, Leif Leonhardy, Maarten Derickx** to **Mariah Lenox, Leif Leonhardy, Maarten Derickx, Jeroen Demeyer**



---

archive/issue_events_057554.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-15T18:43:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "title_is": "Optionally build spkgs in $SAGE_BUILD_DIR",
    "title_was": "Optionally build spkgs in $SAGE_BUILD_TMPDIR",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57554"
}
```



---

archive/issue_comments_030016.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-`$SAGE_ROOT/spkg` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.\n+`$SAGE_ROOT/spkg/build` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_DIR` instead of `$SAGE_ROOT/spkg/build/`.\n \n ---\n \n``````\n",
    "created_at": "2012-02-15T18:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30016",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-`$SAGE_ROOT/spkg` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_TMPDIR/build/` in case it exists instead of `$SAGE_ROOT/spkg/build/`.
+`$SAGE_ROOT/spkg/build` can be slow in case it is NFS-mounted for example. So using local scratch space or even better a RAM disk should speed up the build by a nice factor. To do so, use `$SAGE_BUILD_DIR` instead of `$SAGE_ROOT/spkg/build/`.
 
 ---
 
``````




---

archive/issue_comments_030017.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThe review patch looks okay to me.",
    "created_at": "2012-02-15T21:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30017",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">comment:56</div>

The review patch looks okay to me.



---

archive/issue_comments_030018.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nLooks good to me too.",
    "created_at": "2012-02-16T21:20:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30018",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Looks good to me too.



---

archive/issue_events_057555.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-16T21:20:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57555"
}
```



---

archive/issue_events_057556.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-16T21:20:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57556"
}
```



---

archive/issue_comments_030019.json:
```json
{
    "body": "Merged: **sage-5.0.beta5**",
    "created_at": "2012-02-22T10:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30019",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta5**



---

archive/issue_events_057557.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-22T10:43:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57557"
}
```



---

archive/issue_events_057558.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-22T10:43:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4949#event-57558"
}
```



---

archive/issue_comments_030020.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nSee #12637 for a followup.",
    "created_at": "2012-03-06T19:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4949#issuecomment-30020",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:59" align="right">comment:59</div>

See #12637 for a followup.
