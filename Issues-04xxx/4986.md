# Issue 4986: [do not review] import audit class to sage/all.py

archive/issues_004986.json:
```json
{
    "assignees": [],
    "body": "It is currently way to easy to introduce circular imports in Sage, and a mess to try and hunt time down. An order in which things are imported is found in sage.all, but due to the cascade of imports in sage.misc (and elsewhere) this is not an accurate representation of what actually happens. This could stand to be cleaned up a lot. Ideally, little/none of sage.foo.* should be used before sage.foo.all is imported. \n\nThis patch prints out imports as they happen, and where they're initiated. \n\nAssignee: **mabshoff**\n\nCC:  @craigcitro @nexttime @kcrisman\n\nAuthor: **Robert Bradshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/4986_\n\n",
    "created_at": "2009-01-16T04:04:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wishlist%20item",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "[do not review] import audit class to sage/all.py",
    "type": "issue",
    "updated_at": "2011-08-21T06:11:13Z",
    "url": "https://github.com/sagemath/sage/issues/4986",
    "user": "https://github.com/robertwb"
}
```
It is currently way to easy to introduce circular imports in Sage, and a mess to try and hunt time down. An order in which things are imported is found in sage.all, but due to the cascade of imports in sage.misc (and elsewhere) this is not an accurate representation of what actually happens. This could stand to be cleaned up a lot. Ideally, little/none of sage.foo.* should be used before sage.foo.all is imported. 

This patch prints out imports as they happen, and where they're initiated. 

Assignee: **mabshoff**

CC:  @craigcitro @nexttime @kcrisman

Author: **Robert Bradshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/4986_





---

archive/issue_events_051831.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T04:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51831"
}
```



---

archive/issue_events_051832.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T04:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51832"
}
```



---

archive/issue_events_051833.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T04:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51833"
}
```



---

archive/issue_events_051834.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T04:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51834"
}
```



---

archive/issue_events_051835.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T04:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51835"
}
```



---

archive/issue_comments_031515.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI guess the patch isn't posted yet, but this seems like \"sage -startuptime\" which prints out imports as they occur.",
    "created_at": "2009-01-16T04:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31515",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'>Comment 1:</a>
I guess the patch isn't posted yet, but this seems like "sage -startuptime" which prints out imports as they occur.



---

archive/issue_comments_031516.json:
```json
{
    "body": "Attachment: **[import-audit.patch.gz](https://github.com/sagemath/sage/files/ticket4986/import-audit.patch.gz)**",
    "created_at": "2009-01-16T04:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31516",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[import-audit.patch.gz](https://github.com/sagemath/sage/files/ticket4986/import-audit.patch.gz)**



---

archive/issue_comments_031517.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nYes, it is a lot like sage -startuptime. One difference is that it prints out where each import is coming from, and also filters based on whether or not the corresponding *.all module has been loaded.",
    "created_at": "2009-01-16T04:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31517",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'>Comment 2:</a>
Yes, it is a lot like sage -startuptime. One difference is that it prints out where each import is coming from, and also filters based on whether or not the corresponding *.all module has been loaded.



---

archive/issue_events_051836.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-16T06:39:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51836"
}
```



---

archive/issue_events_051837.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-16T06:39:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51837"
}
```



---

archive/issue_events_051838.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-16T06:39:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "title_is": "import audit class to sage/all.py",
    "title_was": "import audit",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51838"
}
```



---

archive/issue_events_051839.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-16T06:39:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51839"
}
```



---

archive/issue_events_051840.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-16T06:39:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51840"
}
```



---

archive/issue_events_051841.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T07:31:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "title_is": "[do not review] import audit class to sage/all.py",
    "title_was": "import audit class to sage/all.py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51841"
}
```



---

archive/issue_events_051842.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T07:31:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51842"
}
```



---

archive/issue_events_051843.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-01-16T07:31:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51843"
}
```



---

archive/issue_comments_031518.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nTo clarify, this patch should not be applied (unless we want the info to come up with every startup, or only enable it with a flag). Also, the work has not been done, What is attached is just a diagnostic tool.",
    "created_at": "2009-01-16T07:31:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31518",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'>Comment 4:</a>
To clarify, this patch should not be applied (unless we want the info to come up with every startup, or only enable it with a flag). Also, the work has not been done, What is attached is just a diagnostic tool.



---

archive/issue_events_051844.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:08:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51844"
}
```



---

archive/issue_events_051845.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:08:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/4986#event-51845"
}
```



---

archive/issue_comments_031519.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2011-08-21T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31519",
    "user": "https://github.com/nexttime"
}
```

Author: **Robert Bradshaw**



---

archive/issue_comments_031520.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nIn case anything should happen here...",
    "created_at": "2011-08-21T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31520",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'>Comment 6:</a>
In case anything should happen here...



---

archive/issue_comments_031521.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nDitto.",
    "created_at": "2011-08-21T04:15:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31521",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'>Comment 7:</a>
Ditto.



---

archive/issue_comments_031522.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@kcrisman](#comment%3A7):\n> Ditto.\n\nRe: sage-devel thread: I was wondering what you were waiting for.\n\n(Haven't tested the patch here; I think you won't be able to print PARI's variables with this method anyway, at least not easily.)\n\nNote that you can inject code into the C files generated by Cython, e.g. with your favourite friend `sed`, especially into the functions called upon module initialization:\n\n```sh\n$ cd devel/sage/sage/rings\n$ sed -i -e '/^PyMODINIT_FUNC PyInit_.*(void)$/,+3s/^{$/{\\n  printf(\"Hello!\\\\n\");\\n/' real_mpfr.c\n$ ../../../../sage -br\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n...\nbuilding 'sage.rings.real_mpfr' extension\nExecute 1 commands (using 1 threads)\n...\n----------------------------------------------------------------------\n| Sage Version 4.7.2.alpha1, Release Date: 2011-08-17                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nHello!\nsage: \n```\n(This example is of course quite specific to the current layout of the C code generated by Cython. Also, for simplicity I've used the less portable `-i` option.)\n\nJust a \"proof of concept\"; I can write an appropriate shell script for your debugging purpose once I've found the relevant ticket... ;-)",
    "created_at": "2011-08-21T06:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/4986",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/4986#issuecomment-31522",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@kcrisman](#comment%3A7):
> Ditto.

Re: sage-devel thread: I was wondering what you were waiting for.

(Haven't tested the patch here; I think you won't be able to print PARI's variables with this method anyway, at least not easily.)

Note that you can inject code into the C files generated by Cython, e.g. with your favourite friend `sed`, especially into the functions called upon module initialization:

```sh
$ cd devel/sage/sage/rings
$ sed -i -e '/^PyMODINIT_FUNC PyInit_.*(void)$/,+3s/^{$/{\n  printf("Hello!\\n");\n/' real_mpfr.c
$ ../../../../sage -br
----------------------------------------------------------
sage: Building and installing modified Sage library files.
...
building 'sage.rings.real_mpfr' extension
Execute 1 commands (using 1 threads)
...
----------------------------------------------------------------------
| Sage Version 4.7.2.alpha1, Release Date: 2011-08-17                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
Hello!
sage: 
```
(This example is of course quite specific to the current layout of the C code generated by Cython. Also, for simplicity I've used the less portable `-i` option.)

Just a "proof of concept"; I can write an appropriate shell script for your debugging purpose once I've found the relevant ticket... ;-)
