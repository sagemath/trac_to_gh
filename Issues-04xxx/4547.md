# Issue 4547: [with patch, positive review] The Sage Notebook doesn't specify the Content-Type header in its responses

archive/issues_004547.json:
```json
{
    "body": "This causes Apache rewriting for example to just display plain text instead of HTML.  This hasn't been an issue because browsers are relatively smart about dealing with unspecified Content-Types.\n\nAssignee: @mwhansen\n\nCC:  @jasongrout\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/4547\n\n",
    "closed_at": "2009-03-23T21:54:54Z",
    "created_at": "2008-11-19T15:01:12Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.4.1",
    "title": "[with patch, positive review] The Sage Notebook doesn't specify the Content-Type header in its responses",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/4547",
    "user": "https://github.com/mwhansen"
}
```
This causes Apache rewriting for example to just display plain text instead of HTML.  This hasn't been an issue because browsers are relatively smart about dealing with unspecified Content-Types.

Assignee: @mwhansen

CC:  @jasongrout

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/4547





---

archive/issue_comments_034886.json:
```json
{
    "body": "<a id='comment:1'></a>I attached a patch (which may or may not apply to the current version) which only fixes the problem for HTML pages.  CSS, Javascript, etc. should also be handled.",
    "created_at": "2008-11-19T15:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34886",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>I attached a patch (which may or may not apply to the current version) which only fixes the problem for HTML pages.  CSS, Javascript, etc. should also be handled.



---

archive/issue_comments_034887.json:
```json
{
    "body": "<a id='comment:2'></a>This *has* been an issue.   I have been working around by putting this in my httpd.conf:\n\n```\n\n<VirtualHost *>\n        ServerName sagenb.org\n        ProxyPass    / http://sagenb.org:8000/\n        ProxyPassReverse / http://sagenb.org:8000/\n\n        <Location />\n           DefaultType text/html\n        </Location>\n</VirtualHost>\n\n\n```",
    "created_at": "2008-11-20T05:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34887",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>This *has* been an issue.   I have been working around by putting this in my httpd.conf:

```

<VirtualHost *>
        ServerName sagenb.org
        ProxyPass    / http://sagenb.org:8000/
        ProxyPassReverse / http://sagenb.org:8000/

        <Location />
           DefaultType text/html
        </Location>
</VirtualHost>


```



---

archive/issue_comments_034888.json:
```json
{
    "body": "<a id='comment:3'></a>I rebased Mike's patch against 3.3.alpha6, and added a \"charset: utf-8\" bit; this ticket is in some sense the other half of #5211.\n\nThis ticket was originally motivated by Apache rewriting; I'm here because some users have UTF-8 text in their worksheets and browsers are not always figuring out the correct encoding. If my patch fixes the encoding/browser problems, perhaps we should merge this ticket and open another for adding Content-Type headers to CSS, Javascript, and so on.",
    "created_at": "2009-02-10T09:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34888",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:3'></a>I rebased Mike's patch against 3.3.alpha6, and added a "charset: utf-8" bit; this ticket is in some sense the other half of #5211.

This ticket was originally motivated by Apache rewriting; I'm here because some users have UTF-8 text in their worksheets and browsers are not always figuring out the correct encoding. If my patch fixes the encoding/browser problems, perhaps we should merge this ticket and open another for adding Content-Type headers to CSS, Javascript, and so on.



---

archive/issue_comments_034889.json:
```json
{
    "body": "<a id='comment:4'></a>Since you rebased the patch please change the summary to \"needs review\" as I just did. Otherwise it will just bitrot since no one will know it is even there :(\n\nCheers,\n\nMichael",
    "created_at": "2009-02-10T09:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34889",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>Since you rebased the patch please change the summary to "needs review" as I just did. Otherwise it will just bitrot since no one will know it is even there :(

Cheers,

Michael



---

archive/issue_comments_034890.json:
```json
{
    "body": "<a id='comment:5'></a>Well, looking around further into the ticket history it seems that additional work is needed. But if this patch does get a positive review I would recommend to open another ticket to deal with CSS and javasscript encoding settings, even though this is somewhat less pressing (who adds  utf-8 characters into CSS or javasscript?).\n\nMike: any take on this?\n\nCheers,\n\nMichael",
    "created_at": "2009-02-10T09:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34890",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>Well, looking around further into the ticket history it seems that additional work is needed. But if this patch does get a positive review I would recommend to open another ticket to deal with CSS and javasscript encoding settings, even though this is somewhat less pressing (who adds  utf-8 characters into CSS or javasscript?).

Mike: any take on this?

Cheers,

Michael



---

archive/issue_comments_034891.json:
```json
{
    "body": "<a id='comment:7'></a>I've rebased the patch against 3.4.alpha0 -- that's \"trac_4547-ddrake.2.patch\", which is the only one of the three patches which needs to be applied.",
    "created_at": "2009-03-02T06:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34891",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:7'></a>I've rebased the patch against 3.4.alpha0 -- that's "trac_4547-ddrake.2.patch", which is the only one of the three patches which needs to be applied.



---

archive/issue_comments_034892.json:
```json
{
    "body": "<a id='comment:8'></a>apply trac-4547_3.patch",
    "created_at": "2009-03-16T20:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34892",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

<a id='comment:8'></a>apply trac-4547_3.patch



---

archive/issue_comments_034893.json:
```json
{
    "body": "<a id='comment:9'></a>Depends on #4135",
    "created_at": "2009-03-16T20:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34893",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

<a id='comment:9'></a>Depends on #4135



---

archive/issue_comments_034894.json:
```json
{
    "body": "<a id='comment:10'></a>I've noticed that some javascript and css doesn't have content-type headers being sent (but some do); should we open separate tickets for those as well?\n\nAlso, Timothy, can you take a look at #5211 as well? That adds a http-equiv header to the html itself, just to make sure browsers really do understand that we're sending utf8.",
    "created_at": "2009-03-16T23:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34894",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:10'></a>I've noticed that some javascript and css doesn't have content-type headers being sent (but some do); should we open separate tickets for those as well?

Also, Timothy, can you take a look at #5211 as well? That adds a http-equiv header to the html itself, just to make sure browsers really do understand that we're sending utf8.



---

archive/issue_comments_034895.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2009-03-19T12:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34895",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to assigned.



---

archive/issue_comments_034896.json:
```json
{
    "body": "<a id='comment:11'></a>I've attached trac_4547.patch which applies cleanly against 3.4.  Note that this patch DOES NOT depend on #4135.\n\nWe should open new tickets for CSS / Javascript / etc.",
    "created_at": "2009-03-19T12:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34896",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:11'></a>I've attached trac_4547.patch which applies cleanly against 3.4.  Note that this patch DOES NOT depend on #4135.

We should open new tickets for CSS / Javascript / etc.



---

archive/issue_events_010355.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-03-19T12:00:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4547#event-10355"
}
```



---

archive/issue_comments_034897.json:
```json
{
    "body": "Changing assignee from boothby to @mwhansen.",
    "created_at": "2009-03-19T12:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34897",
    "user": "https://github.com/mwhansen"
}
```

Changing assignee from boothby to @mwhansen.



---

archive/issue_comments_034898.json:
```json
{
    "body": "<a id='comment:12'></a>This patch requires two trivial fixes unless these are provided via some other patch as a dependency:\n\n```\nsage-3.4.1.alpha0$ ./sage -t -long devel/sage/sage/server/notebook/twist.py \nsage -t -long \"devel/sage/sage/server/notebook/twist.py\"    \n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.4.1.alpha0/devel/sage/sage/server/notebook/twist.py\", line 139:\n    sage: response.headers\nExpected:\n    <Headers: Raw: {'content-type': ['text/html']} Parsed: {'content-type': <RecalcNeeded>}>\nGot:\n    <Headers: Raw: {'content-type': ['text/html; charset=utf-8']} Parsed: {'content-type': <RecalcNeeded>}>\n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.4.1.alpha0/devel/sage/sage/server/notebook/twist.py\", line 1511:\n    sage: E.render(None)\nExpected:\n    <twisted.web2.HTMLResponse code=200, streamlen=...>\nGot:\n    <twisted.web2.http.Response code=200, streamlen=240>\n**********************************************************************\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-03-23T18:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34898",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:12'></a>This patch requires two trivial fixes unless these are provided via some other patch as a dependency:

```
sage-3.4.1.alpha0$ ./sage -t -long devel/sage/sage/server/notebook/twist.py 
sage -t -long "devel/sage/sage/server/notebook/twist.py"    
**********************************************************************
File "/scratch/mabshoff/sage-3.4.1.alpha0/devel/sage/sage/server/notebook/twist.py", line 139:
    sage: response.headers
Expected:
    <Headers: Raw: {'content-type': ['text/html']} Parsed: {'content-type': <RecalcNeeded>}>
Got:
    <Headers: Raw: {'content-type': ['text/html; charset=utf-8']} Parsed: {'content-type': <RecalcNeeded>}>
**********************************************************************
File "/scratch/mabshoff/sage-3.4.1.alpha0/devel/sage/sage/server/notebook/twist.py", line 1511:
    sage: E.render(None)
Expected:
    <twisted.web2.HTMLResponse code=200, streamlen=...>
Got:
    <twisted.web2.http.Response code=200, streamlen=240>
**********************************************************************
```

Cheers,

Michael



---

archive/issue_comments_034899.json:
```json
{
    "body": "Attachment [trac_4547.patch](tarball://root/attachments/some-uuid/ticket4547/trac_4547.patch) by mabshoff created at 2009-03-23 21:52:13\n\nUpdate version of mhansen's patch that does pass doctests",
    "created_at": "2009-03-23T21:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34899",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Attachment [trac_4547.patch](tarball://root/attachments/some-uuid/ticket4547/trac_4547.patch) by mabshoff created at 2009-03-23 21:52:13

Update version of mhansen's patch that does pass doctests



---

archive/issue_comments_034900.json:
```json
{
    "body": "<a id='comment:13'></a>How on earth can this patch get a positive review when it doesn't even pass doctests for the file it patches?\n\nI have update mhansen's patch to pass doctests.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-23T21:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34900",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>How on earth can this patch get a positive review when it doesn't even pass doctests for the file it patches?

I have update mhansen's patch to pass doctests.

Cheers,

Michael



---

archive/issue_comments_034901.json:
```json
{
    "body": "<a id='comment:14'></a>Merged in Sage 3.4.1.alpha0.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-23T21:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34901",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>Merged in Sage 3.4.1.alpha0.

Cheers,

Michael



---

archive/issue_events_010356.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-03-23T21:54:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/4547#event-10356"
}
```



---

archive/issue_comments_034902.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-03-23T21:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/4547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/4547#issuecomment-34902",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed
