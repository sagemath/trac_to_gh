# Issue 25199: Moving connectivity related functions to a new file

Issue created by migration from Trac.

Original creator: meghanamreddy

Original creation time: 2018-05-24 11:35:52

CC:  dcoudert dimpase saiharsh

Keywords: Connectivity

Moving all the connectivity related functions from `generic_graph.py`, `graph.py` and `digraph.py` to a new file `connectivity.pyx`.


---

Comment by git created at 2018-05-24 11:37:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-24 11:50:27

I created a new file `connectivity.pyx`. I started moving all the connectivity related functions from `generic_graph.py` and `digraph.py` to the new file. As of now, the functions in `generic_graph.py` and `digraph.py` haven't been removed, I made a function call to `connectivity.pyx`, because I was not able to get the alias working.

I have the following issues:
* As in `generic_graph.py` and `digraph.py` classes, an alias to a function in a different module can be done using `from sage.graphs.connectivity import is_connected as is_connected`. I tried doing this, it partially worked. The function `is_connected` showed up correctly in the html docs. But the code gave me an error saying `is_connected function expects exactly one argument`. This should technically not happen and it should accept `self.is_connected()` the way it works with other aliases. Maybe I am missing something. I am working on it, but please let me know if you have any idea.

* The function `strongly_connected_components` uses the implementation in `sage\graphs\base\static_sparse_graph`. Do I create an interface for this function also in `connectivity.pyx`? As of now, this function is used as an alias in `digraph.py`.

* I was not sure if the function [`immediate_dominators()`](http://doc.sagemath.org/html/en/reference/graphs/sage/graphs/digraph.html#sage.graphs.digraph.DiGraph.immediate_dominators) in `digraph.py` is related to connectivity or just dominator vertices? Should I move it to `connectivity.py`?


---

Comment by dcoudert created at 2018-05-24 20:23:27

> I have the following issues:
> * As in `generic_graph.py` and `digraph.py` classes, an alias to a function in a different module can be done using `from sage.graphs.connectivity import is_connected as is_connected`. I tried doing this, it partially worked. The function `is_connected` showed up correctly in the html docs. But the code gave me an error saying `is_connected function expects exactly one argument`. This should technically not happen and it should accept `self.is_connected()` the way it works with other aliases. Maybe I am missing something. I am working on it, but please let me know if you have any idea.

In some files like `asteroidal_triples.pyx`, `comparability.pyx`, `static_sparse_graph.pyx`, etc., the first line of the file is 

```
# cython: binding=True
```

I don't know what is means, but may be it's the solution ?

  

> * The function `strongly_connected_components` uses the implementation in `sage\graphs\base\static_sparse_graph`. Do I create an interface for this function also in `connectivity.pyx`? As of now, this function is used as an alias in `digraph.py`.

I think there is no need for it yet. If needed later, then we can add it.

  

> * I was not sure if the function [`immediate_dominators()`](http://doc.sagemath.org/html/en/reference/graphs/sage/graphs/digraph.html#sage.graphs.digraph.DiGraph.immediate_dominators) in `digraph.py` is related to connectivity or just dominator vertices? Should I move it to `connectivity.py`?
It is related, but you don't need to move it since it is deprecated => in 1 year we will remove it. Indeed, we have the boost method `dominator_tree` which is a bit faster, so we are now using is for `strong_articulation_points`?


---

Comment by git created at 2018-05-25 09:14:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-25 09:29:22

> {{{
> # cython: binding=True
> }}}
This worked perfectly, thank you.


> > * I was not sure if the function [`immediate_dominators()`](http://doc.sagemath.org/html/en/reference/graphs/sage/graphs/digraph.html#sage.graphs.digraph.DiGraph.immediate_dominators) in `digraph.py` is related to connectivity or just dominator vertices? Should I move it to `connectivity.py`?
> It is related, but you don't need to move it since it is deprecated => in 1 year we will remove it. Indeed, we have the boost method `dominator_tree` which is a bit faster, so we are now using is for `strong_articulation_points`?

Okay, the boost method `dominator_tree` is used as an alias in `generic_graph.py` also. But in the `strong_articulation_points` method of `digraph.py`, the function `immediate_dominators` is used.


---

Comment by git created at 2018-05-25 18:49:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-25 18:52:25

> It is related, but you don't need to move it since it is deprecated => in 1 year we will remove it. Indeed, we have the boost method `dominator_tree` which is a bit faster, so we are now using is for `strong_articulation_points`?

Yes, we are using `dominator_tree` for `strong_articulation_points` also. I was in the 8.2 version previously and got it wrong. I changed to 8.3beta2 now and it is fine.


---

Comment by git created at 2018-05-26 05:06:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saiharsh created at 2018-05-26 06:38:09

Does the function [`gomory_hu_tree`](http://doc.sagemath.org/html/en/reference/graphs/sage/graphs/graph.html?highlight=gomory_hu_tree#sage.graphs.graph.Graph.gomory_hu_tree) which is based on s-t cut, is related to connectivity.pyx or trees/flow?


---

Comment by dcoudert created at 2018-05-26 11:24:07

This patch is huge and touches many methods, so it may also affect other patchs. Consequently, I strongly recommend to not add more methods in it for now.

There is something weird in the way you have merged the patch with 8.3.beta2. For instance, it removes algorithm `boruvka` from method `min_spanning_tree`. I suspect that it also affects other recent modifications. Please check.

In case of doubt, it might be safer to redo the work, starting from 8.3.beta2, possibly splitting the work into several patchs.


---

Comment by git created at 2018-05-26 13:28:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-26 13:35:15

It was a mistake I did. I could not rebase the previous version. Hence, I took a backup of the edited files and started re-doing it on the 8.3beta2 version. And I did the mistake of changing the entire generic_graph.py. Hence, I worked on it again now. Hopefully, there must be no errors now since I have not changed any other methods apart from the ones moved to `connectivity.pyx`, and when I ran the command `./sage -t src/sage/graphs/`, all tests passed.

Is there some other place to check for failed tests?


---

Comment by dcoudert created at 2018-05-26 15:04:49

> Is there some other place to check for failed tests?
Not easy to say. Many modules use graphs, like `combinat`, `categories`, etc. So somehow we have to pass test on the full library. The patchbot should be helpful in this.

Another issue: your patch #25352 does not appear here (method `blocks_and_cut_vertices` with Boost).
Since the ticket is now closed, it shall be added to next beta version.
So I suggest that you don't move the method in this ticket yet. We might rebase on next beta and then do the move.


I'm wondering if at the top of the `connectivity` file, we should not have 2 tables to distinguish methods for `Graph` and for `DiGraph`.


---

Comment by git created at 2018-05-26 19:15:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-26 19:24:16

Replying to [comment:14 dcoudert]:
> > Is there some other place to check for failed tests?
> Not easy to say. Many modules use graphs, like `combinat`, `categories`, etc. So somehow we have to pass test on the full library. The patchbot should be helpful in this.
> 
So I ran doctests on the whole sage library and left it to run while I was away. There were some 4-5 failed tests (in src/bin, src/build, src/mac-app and an import error in src/setup.py), but none of them had anything related to the graph module in their logs. But the better thing would be to wait for the patchbot I guess.

> Another issue: your patch #25352 does not appear here (method `blocks_and_cut_vertices` with Boost).
> Since the ticket is now closed, it shall be added to next beta version.
> So I suggest that you don't move the method in this ticket yet. We might rebase on next beta and then do the move.
> 
Okay. I have moved the method `blocks_and_cut_vertices` back to `generic_graph.py`. Will wait for the next beta version.

> I'm wondering if at the top of the `connectivity` file, we should not have 2 tables to distinguish methods for `Graph` and for `DiGraph`.
> 
Yes, this does make it more clear. I have made the change now and split it into tables.


---

Comment by dcoudert created at 2018-05-28 08:27:18

> So I ran doctests on the whole sage library and left it to run while I was away. There were some 4-5 failed tests (in src/bin, src/build, src/mac-app and an import error in src/setup.py), but none of them had anything related to the graph module in their logs. But the better thing would be to wait for the patchbot I guess.

In general, `./sage -tp --long src/sage/` is enough.

For the patchbot, you have to set your patch to `needs review` I think.


> > I'm wondering if at the top of the `connectivity` file, we should not have 2 tables to distinguish methods for `Graph` and for `DiGraph`.
> > 
> Yes, this does make it more clear. I have made the change now and split it into tables.

For some reasons, I cannot check the html documentation. Have you built it and checked that it displays well ?


---

Comment by meghanamreddy created at 2018-05-28 14:45:50

Changing status from new to needs_review.


---

Comment by meghanamreddy created at 2018-05-28 14:47:28

I set the patch to `needs_review`. All tests passed in the `./sage -tp --long src/sage/` command.

And I did build the html documentation. It displayed as intended and all the links were working.


---

Comment by dcoudert created at 2018-05-28 16:22:17

There is a merge conflict with the last beta version (beta3). Note that 8.3.beta3 includes #25352.


---

Comment by git created at 2018-05-29 18:13:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-05-30 08:18:49

My only concern here is in the documentation / doctests, since you changed for instance `G.is_connected()` to `is_connected(G)`.


---

Comment by meghanamreddy created at 2018-05-30 10:37:11

Replying to [comment:23 dcoudert]:
> My only concern here is in the documentation / doctests, since you changed for instance `G.is_connected()` to `is_connected(G)`.

Since the methods are now in the connectivity.pyx file and not defined along with the `GenericGraph` class, I changed the doctests to 

```
from sage.graphs.connectivity import is_connected
is_connected(G)
```


`G.is_connected()` also works and gives the same output as `is_connected(G)` since `GenericGraph` class redirects to the method in `connectivity.pyx`. All the doctests passed with `is_connected(G)`. Should I add in the documentation that `G.is_connected()` will also work?


---

Comment by dimpase created at 2018-05-30 10:49:08

Perhaps needless to say, you must keep `G.is_connected()` available, at least during the deprecation period. In fact, I think we should keep these `G.is_connected()` - re-implement them by simply calling `is_connected()`.


---

Comment by meghanamreddy created at 2018-05-30 10:54:01

So in the files `GenericGraph.py`, instead of making an alias to the methods in `connectivity.pyx`, I will add those methods and call `connectivity.is_connected(G)` ? I will do the same with `digraph.py` and `graph.py`.


---

Comment by meghanamreddy created at 2018-05-30 10:59:10

Also, the patchbot shows some failed doctests. But all the doctests passed when I checked on my laptop. I ran the failed doctests listed by the patchbot again on my laptop and all the tests passed. Is it something I have to worry about?


---

Comment by dcoudert created at 2018-05-30 12:47:35

`@`dimpase: there is a misunderstanding, we are not changing the behavior, just moving the methods to a new file and adding imports / aliases in `GenericGraph` to keep the behavior => no deprecation, no change.

`@`meghana: 
- In the doctest, I think it's good to show that `G.is_connected()` is working.
- Let aliases in `generic_graph.py` and other files. We don't want to change the usage, it's just a gathering of methods in a new file.
- Concerning doctests failure, I discovered some errors in graph generators and opened ticket #25465. I don't know what's going on, and what's the cause of these issues.


---

Comment by git created at 2018-05-30 17:25:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-30 17:49:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-05-30 17:59:07

I added one example in each of the functions similar to `G.is_connected()` to demonstrate its working. And I also mentioned in the documentation of the file `connectivity.pyx` that the functions can be accessed either through this module or as class methods directly.


---

Comment by git created at 2018-05-31 09:35:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-06-02 17:38:57

Instead of creating a `REFERENCES` section, you should move the references to file `src/doc/en/reference/references/index.rst`.


---

Comment by git created at 2018-06-03 12:37:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by meghanamreddy created at 2018-06-03 12:40:30

Changing status from needs_review to needs_work.


---

Comment by meghanamreddy created at 2018-06-03 12:47:16

I moved the references to `src/doc/en/reference/references/index.rst` file. The references are reflected in the corresponding `index.html` page. But the citations in the `connectivity.pyx` and `generic_graph.py` files link to the `generic_graph.py` html page, whereas it should be redirecting to the `index.html` page. I tried deleting the sage docs and rebuilding sage. I tried searching through the developers mailing list and I don't seem to have missed some linking command. I am working on it.


---

Comment by dcoudert created at 2018-06-03 18:17:57

I don't have this issue. I have build the documentation and links are OK. For instance, in `generic_graph.html`, I have:

```
<p>We referred to <a class="reference internal" href="../../../references/index.html#harpri" id="id3">[HarPri]</a> and <a class="reference internal" href="../../../references/index.html#gallai" id="id4">[Gallai]</a> for blocks and cuts tree.</p>
```

and in `connectivity.html`

```
We implement the algorithm proposed by Tarjan in <a class="reference internal" href="../../../references/index.html#tarjan72" id="id1">[Tarjan72]</a>.
```

Have you tried `make doc-clean` ?


---

Comment by meghanamreddy created at 2018-06-05 05:33:26

Thankyou, `make doc-clean` worked. It had given me an error when I had run it a few days ago and running `make` after it did not fix anything - this was due to duplicate citations which I fixed later. So I did not want to run `make doc-clean` again. But it worked now.


---

Comment by meghanamreddy created at 2018-06-05 05:36:28

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-06-05 07:44:18

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2018-06-05 07:44:18

Looks good to me.


---

Comment by dcoudert created at 2018-06-05 15:28:16

Changing keywords from "Connectivity" to "Connectivity, gsoc2018".


---

Comment by vbraun created at 2018-06-07 22:15:05

Resolution: fixed
