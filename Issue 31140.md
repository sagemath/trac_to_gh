# Issue 31140: ./configure --enable-editable

archive/issues_031140.json:
```json
{
    "body": "CC:  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim\n\nThis configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using the traditional incremental build system.\n\nThis will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.\n\nIt may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.\n\nThis ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\nThe configure switch switches to this version of the build system.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31377\n\n",
    "created_at": "2021-02-10T20:34:37Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "./configure --enable-editable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31140",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim

This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using the traditional incremental build system.

This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.

It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.

This ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
The configure switch switches to this version of the build system.

Issue created by migration from https://trac.sagemath.org/ticket/31377





---

archive/issue_comments_444312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-10T21:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444313.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-10T21:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-10T22:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444315.json:
```json
{
    "body": "This almost works for me, except for some errors building modules:\n\n```\n[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o\n[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:\n[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'\n[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)\n[sagelib-9.3.beta7]     ^\n```\n\n\nThis is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.",
    "created_at": "2021-02-10T23:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444315",
    "user": "https://github.com/mkoeppe"
}
```

This almost works for me, except for some errors building modules:

```
[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o
[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:
[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'
[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)
[sagelib-9.3.beta7]     ^
```


This is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.



---

archive/issue_comments_444316.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-02-11T04:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_444317.json:
```json
{
    "body": "I have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.",
    "created_at": "2021-02-11T04:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444317",
    "user": "https://github.com/mkoeppe"
}
```

I have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.



---

archive/issue_comments_444318.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-11T04:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444318",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_444319.json:
```json
{
    "body": "This seems to reasonably work well here on macOS. There are a small number of doctest failures.\n\n```\nsage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed\nsage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/all.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed\nsage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n```\n\nThe last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nThis will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).",
    "created_at": "2021-02-11T05:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444319",
    "user": "https://github.com/mkoeppe"
}
```

This seems to reasonably work well here on macOS. There are a small number of doctest failures.

```
sage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed
sage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/all.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed
sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
```

The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

This will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).



---

archive/issue_comments_444320.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T07:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444321.json:
```json
{
    "body": "please stop adding me in cc",
    "created_at": "2021-02-11T08:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444321",
    "user": "https://github.com/fchapoton"
}
```

please stop adding me in cc



---

archive/issue_comments_444322.json:
```json
{
    "body": "So how does one test this?",
    "created_at": "2021-02-11T21:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444322",
    "user": "https://github.com/tobiasdiez"
}
```

So how does one test this?



---

archive/issue_comments_444323.json:
```json
{
    "body": "I've added quick instructions to the ticket description",
    "created_at": "2021-02-11T21:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444323",
    "user": "https://github.com/mkoeppe"
}
```

I've added quick instructions to the ticket description



---

archive/issue_comments_444324.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-02-12T16:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444324",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_444325.json:
```json
{
    "body": "The installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`",
    "created_at": "2021-02-12T17:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444325",
    "user": "https://github.com/mkoeppe"
}
```

The installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`



---

archive/issue_comments_444326.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> This seems to reasonably work well here on macOS. There are a small number of doctest failures.\n> {{{\n> ...\n> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n> }}}\n> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nWrong guess, this is actually #31389.",
    "created_at": "2021-02-12T19:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444326",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:13 mkoeppe]:
> This seems to reasonably work well here on macOS. There are a small number of doctest failures.
> {{{
> ...
> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
> }}}
> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

Wrong guess, this is actually #31389.



---

archive/issue_comments_444327.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T19:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T22:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444329.json:
```json
{
    "body": "``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.",
    "created_at": "2021-02-13T00:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444329",
    "user": "https://github.com/mkoeppe"
}
```

``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.



---

archive/issue_comments_444330.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-02-13T00:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444330",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_444331.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-13T01:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444332.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-13T02:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444333.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-02-13T02:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444333",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_444334.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-13T02:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444335.json:
```json
{
    "body": "Now the documentation builds OK and also `make ptest` is fine.",
    "created_at": "2021-02-13T02:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444335",
    "user": "https://github.com/mkoeppe"
}
```

Now the documentation builds OK and also `make ptest` is fine.



---

archive/issue_comments_444336.json:
```json
{
    "body": "Can you please include the most recent version of setup.py from #30371. Thanks!",
    "created_at": "2021-02-13T09:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444336",
    "user": "https://github.com/tobiasdiez"
}
```

Can you please include the most recent version of setup.py from #30371. Thanks!



---

archive/issue_comments_444337.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-02-13T09:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444337",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_444338.json:
```json
{
    "body": "The changes there conflict with the changes done and tested here already.",
    "created_at": "2021-02-13T18:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444338",
    "user": "https://github.com/mkoeppe"
}
```

The changes there conflict with the changes done and tested here already.



---

archive/issue_comments_444339.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-02-13T18:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444339",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_444340.json:
```json
{
    "body": "(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)",
    "created_at": "2021-02-13T18:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444340",
    "user": "https://github.com/mkoeppe"
}
```

(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)



---

archive/issue_comments_444341.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> The changes there conflict with the changes done and tested here already.\n\nWhat conflicts do you mean?\nI was referring to the improvements to this code:\n\n```\n+# Exclude a few files if the corresponding distribution is not loaded\n+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',\n+                     'coxeter3', 'fes', 'sirocco', 'meataxe']\n+not_installed_packages = [package for package in optional_packages\n+                          if not is_package_installed_and_updated(package)]\n+\n+distributions_to_exclude = [f\"sage-{pkg}\"\n+                            for pkg in not_installed_packages]\n+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)\n+\n+log.debug(f\"files_to_exclude = {files_to_exclude}\")\n+\n+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])\n+log.debug(f\"python_packages = {python_packages}\")\n+\n+log.info(f\"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.\")\n+\n+# from sage_build_cython:\n+import Cython.Compiler.Options\n+Cython.Compiler.Options.embed_pos_in_docstring = True\n+\n+try:\n+    log.info(\"Generating auto-generated sources\")\n+    from sage_setup.autogen import autogen_all\n+    autogen_all()\n+\n+    from Cython.Build import cythonize\n+    from sage.env import cython_aliases, sage_include_directories\n+    extensions = cythonize(\n+        [\"**/*.pyx\"],\n+        exclude=files_to_exclude,\n+        include_path=sage_include_directories(use_sources=True) + ['.'],\n+        compile_time_env=compile_time_env_variables(),\n+        compiler_directives=compiler_directives(False),\n+        aliases=cython_aliases(),\n+        create_extension=create_extension,\n+        nthreads=4)\n+except Exception as exception:\n+    log.warn(f\"Exception while generating and cythonizing source files: {exception}\")\n+    extensions = None\n```\n\n\nThis has a few problems/issues:\n- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n- You want to auto-generate code before filtering it / excluding parts of it.\n- The exception catch is to general and was meant to only capture module import errors.\n\nAll these things are fixed in #30371.\n-",
    "created_at": "2021-02-13T18:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444341",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:35 mkoeppe]:
> The changes there conflict with the changes done and tested here already.

What conflicts do you mean?
I was referring to the improvements to this code:

```
+# Exclude a few files if the corresponding distribution is not loaded
+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',
+                     'coxeter3', 'fes', 'sirocco', 'meataxe']
+not_installed_packages = [package for package in optional_packages
+                          if not is_package_installed_and_updated(package)]
+
+distributions_to_exclude = [f"sage-{pkg}"
+                            for pkg in not_installed_packages]
+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)
+
+log.debug(f"files_to_exclude = {files_to_exclude}")
+
+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])
+log.debug(f"python_packages = {python_packages}")
+
+log.info(f"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.")
+
+# from sage_build_cython:
+import Cython.Compiler.Options
+Cython.Compiler.Options.embed_pos_in_docstring = True
+
+try:
+    log.info("Generating auto-generated sources")
+    from sage_setup.autogen import autogen_all
+    autogen_all()
+
+    from Cython.Build import cythonize
+    from sage.env import cython_aliases, sage_include_directories
+    extensions = cythonize(
+        ["**/*.pyx"],
+        exclude=files_to_exclude,
+        include_path=sage_include_directories(use_sources=True) + ['.'],
+        compile_time_env=compile_time_env_variables(),
+        compiler_directives=compiler_directives(False),
+        aliases=cython_aliases(),
+        create_extension=create_extension,
+        nthreads=4)
+except Exception as exception:
+    log.warn(f"Exception while generating and cythonizing source files: {exception}")
+    extensions = None
```


This has a few problems/issues:
- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.
- You want to auto-generate code before filtering it / excluding parts of it.
- The exception catch is to general and was meant to only capture module import errors.

All these things are fixed in #30371.
-



---

archive/issue_comments_444342.json:
```json
{
    "body": "OK, fine, I'll do the merging.",
    "created_at": "2021-02-13T19:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444342",
    "user": "https://github.com/mkoeppe"
}
```

OK, fine, I'll do the merging.



---

archive/issue_comments_444343.json:
```json
{
    "body": "Concerning this change:\n\n```\n # distutils: language = c++\n+# distutils: extra_compile_args = -std=c++11\n```\n\nWoudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nI think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).",
    "created_at": "2021-02-13T19:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444343",
    "user": "https://github.com/tobiasdiez"
}
```

Concerning this change:

```
 # distutils: language = c++
+# distutils: extra_compile_args = -std=c++11
```

Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

I think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).



---

archive/issue_comments_444344.json:
```json
{
    "body": "Replying to [comment:40 gh-tobiasdiez]:\n> Concerning this change:\n> {{{\n>  # distutils: language = c++\n> +# distutils: extra_compile_args = -std=c++11\n> }}}\n> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nOf course, but you decided not to use the existing code. So I have made the changes that make it work.",
    "created_at": "2021-02-13T19:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444344",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:40 gh-tobiasdiez]:
> Concerning this change:
> {{{
>  # distutils: language = c++
> +# distutils: extra_compile_args = -std=c++11
> }}}
> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

Of course, but you decided not to use the existing code. So I have made the changes that make it work.



---

archive/issue_comments_444345.json:
```json
{
    "body": "Important to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.\n\nReplying to [comment:38 gh-tobiasdiez]:\n> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n\nNot important for this ticket; we do have Cython. \n\n> - You want to auto-generate code before filtering it / excluding parts of it.\n\nWhy? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.",
    "created_at": "2021-02-13T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444345",
    "user": "https://github.com/mkoeppe"
}
```

Important to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.

Replying to [comment:38 gh-tobiasdiez]:
> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.

Not important for this ticket; we do have Cython. 

> - You want to auto-generate code before filtering it / excluding parts of it.

Why? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.



---

archive/issue_comments_444346.json:
```json
{
    "body": "Replying to [comment:41 mkoeppe]:\n> Replying to [comment:40 gh-tobiasdiez]:\n> > Concerning this change:\n> > {{{\n> >  # distutils: language = c++\n> > +# distutils: extra_compile_args = -std=c++11\n> > }}}\n> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n> \n> Of course, but you decided not to use the existing code. So I have made the changes that make it work.\n> \n\nI couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?",
    "created_at": "2021-02-13T19:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444346",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:41 mkoeppe]:
> Replying to [comment:40 gh-tobiasdiez]:
> > Concerning this change:
> > {{{
> >  # distutils: language = c++
> > +# distutils: extra_compile_args = -std=c++11
> > }}}
> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.
> 
> Of course, but you decided not to use the existing code. So I have made the changes that make it work.
> 

I couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?



---

archive/issue_comments_444347.json:
```json
{
    "body": "Your approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.\n\nIn terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\nLet's try it out as is. \n\nIn some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.\nLet's do this when it becomes an issue; not now.",
    "created_at": "2021-02-13T19:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444347",
    "user": "https://github.com/mkoeppe"
}
```

Your approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.

In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
Let's try it out as is. 

In some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.
Let's do this when it becomes an issue; not now.



---

archive/issue_comments_444348.json:
```json
{
    "body": "Does this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?",
    "created_at": "2021-02-16T19:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444348",
    "user": "https://github.com/jhpalmieri"
}
```

Does this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?



---

archive/issue_comments_444349.json:
```json
{
    "body": "Thanks for catching the typo in the help string.",
    "created_at": "2021-02-16T19:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444349",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for catching the typo in the help string.



---

archive/issue_comments_444350.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-16T19:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444351.json:
```json
{
    "body": "I like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.\n\nWhat vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.",
    "created_at": "2021-02-16T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444351",
    "user": "https://github.com/kliem"
}
```

I like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.

What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.



---

archive/issue_comments_444352.json:
```json
{
    "body": "Replying to [comment:50 gh-kliem]:\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nTobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.",
    "created_at": "2021-02-16T20:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444352",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:50 gh-kliem]:
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

Tobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.



---

archive/issue_comments_444353.json:
```json
{
    "body": "Ok. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.\n\nYou introduced a trailing whitespace in `src/sage_setup/find.py`.",
    "created_at": "2021-02-16T20:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444353",
    "user": "https://github.com/kliem"
}
```

Ok. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.

You introduced a trailing whitespace in `src/sage_setup/find.py`.



---

archive/issue_comments_444354.json:
```json
{
    "body": "Why is it `python3` and not `$PYTHON`?\n\n```diff\n+if [ \"$SAGE_EDITABLE\" = yes ]; then\n+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n+else\n+    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n+fi\n+\n```\n",
    "created_at": "2021-02-16T20:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444354",
    "user": "https://github.com/kliem"
}
```

Why is it `python3` and not `$PYTHON`?

```diff
+if [ "$SAGE_EDITABLE" = yes ]; then
+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
+else
+    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
+fi
+
```




---

archive/issue_comments_444355.json:
```json
{
    "body": "You freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.\nI think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.",
    "created_at": "2021-02-16T20:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444355",
    "user": "https://github.com/kliem"
}
```

You freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.
I think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.



---

archive/issue_comments_444356.json:
```json
{
    "body": "We should probably merge #30984 too.",
    "created_at": "2021-02-16T20:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444356",
    "user": "https://github.com/mkoeppe"
}
```

We should probably merge #30984 too.



---

archive/issue_comments_444357.json:
```json
{
    "body": "Replying to [comment:53 gh-kliem]:\n> Why is it `python3` and not `$PYTHON`?\n> {{{#!diff\n> +if [ \"$SAGE_EDITABLE\" = yes ]; then\n> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n> +else\n> +    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n> +fi\n> +\n> }}}\n\nThanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).",
    "created_at": "2021-02-16T20:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444357",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:53 gh-kliem]:
> Why is it `python3` and not `$PYTHON`?
> {{{#!diff
> +if [ "$SAGE_EDITABLE" = yes ]; then
> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
> +else
> +    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
> +fi
> +
> }}}

Thanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).



---

archive/issue_comments_444358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-16T20:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444359.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-16T21:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444360.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-16T21:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444361.json:
```json
{
    "body": "Replying to [comment:50 gh-kliem]:\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nI think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.",
    "created_at": "2021-02-16T21:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444361",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:50 gh-kliem]:
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

I think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.



---

archive/issue_comments_444362.json:
```json
{
    "body": "I have created #31406 as a place for follow-up items.",
    "created_at": "2021-02-16T21:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444362",
    "user": "https://github.com/mkoeppe"
}
```

I have created #31406 as a place for follow-up items.



---

archive/issue_comments_444363.json:
```json
{
    "body": "Replying to [comment:44 mkoeppe]:\n\n> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\n> Let's try it out as is. \n\nOk, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a \"normal\" build) since the following code in sage_build_cython is no longer invoked:\n\n```\n            if sys.platform == 'cygwin':\n                # Cygwin (particularly newlib, Cygwin's libc) has some bugs\n                # with strict ANSI C/C++ in some headers; using the GNU\n                # extensions typically fares better:\n                # https://trac.sagemath.org/ticket/24192\n                if cplusplus:\n                    cflags.append(\"-std=gnu++11\")\n                else:\n                    cflags.append(\"-std=gnu99\")\n\n```\n\nI don't know if this may have negative side effects.",
    "created_at": "2021-02-16T21:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444363",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:44 mkoeppe]:

> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
> Let's try it out as is. 

Ok, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a "normal" build) since the following code in sage_build_cython is no longer invoked:

```
            if sys.platform == 'cygwin':
                # Cygwin (particularly newlib, Cygwin's libc) has some bugs
                # with strict ANSI C/C++ in some headers; using the GNU
                # extensions typically fares better:
                # https://trac.sagemath.org/ticket/24192
                if cplusplus:
                    cflags.append("-std=gnu++11")
                else:
                    cflags.append("-std=gnu99")

```

I don't know if this may have negative side effects.



---

archive/issue_comments_444364.json:
```json
{
    "body": "Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)",
    "created_at": "2021-02-16T21:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444364",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)



---

archive/issue_comments_444365.json:
```json
{
    "body": "A few more observations:\n- There is currently no documentation for how to use the inplace install (and why).\n- Running the configure command yields the following warning at the end:\n\n```\n....\nconfig.status: creating directory local/var/lib/sage/installed\nconfigure: WARNING: unrecognized options: --enable-editable\nconfigure:\n\n    notice: the following SPKGs did not find equivalent system packages\n...\n```\n\n- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form\n\n```\n /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'\n    nl_catd  catopen(const char *, int);\n    ^\n```\n\nSee e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true\n\n- On Linux (with wsl), the make build fails with\n\n```\n[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n[pplpy-0.8.6] Traceback (most recent call last):\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/bin/sphinx-build\", line 5, in <module>\n[pplpy-0.8.6]     from sphinx.cmd.build import main\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py\", line 25, in <module>\n[pplpy-0.8.6]     from sphinx.application import Sphinx\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py\", line 31, in <module>\n[pplpy-0.8.6]     from sphinx.config import Config\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py\", line 28, in <module>\n[pplpy-0.8.6]     from sphinx.util.tags import Tags\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py\", line 11, in <module>\n[pplpy-0.8.6]     from jinja2 import nodes\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py\", line 6, in <module>\n[pplpy-0.8.6]     from markupsafe import escape\n[pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n```\n\nThat's probably not related to this ticket, but prevents me from testing it.",
    "created_at": "2021-02-16T22:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444365",
    "user": "https://github.com/tobiasdiez"
}
```

A few more observations:
- There is currently no documentation for how to use the inplace install (and why).
- Running the configure command yields the following warning at the end:

```
....
config.status: creating directory local/var/lib/sage/installed
configure: WARNING: unrecognized options: --enable-editable
configure:

    notice: the following SPKGs did not find equivalent system packages
...
```

- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form

```
 /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'
    nl_catd  catopen(const char *, int);
    ^
```

See e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true

- On Linux (with wsl), the make build fails with

```
[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
[pplpy-0.8.6] Traceback (most recent call last):
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/bin/sphinx-build", line 5, in <module>
[pplpy-0.8.6]     from sphinx.cmd.build import main
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py", line 25, in <module>
[pplpy-0.8.6]     from sphinx.application import Sphinx
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py", line 31, in <module>
[pplpy-0.8.6]     from sphinx.config import Config
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py", line 28, in <module>
[pplpy-0.8.6]     from sphinx.util.tags import Tags
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py", line 11, in <module>
[pplpy-0.8.6]     from jinja2 import nodes
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py", line 6, in <module>
[pplpy-0.8.6]     from markupsafe import escape
[pplpy-0.8.6] ValueError: source code string cannot contain null bytes
[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
```

That's probably not related to this ticket, but prevents me from testing it.



---

archive/issue_comments_444366.json:
```json
{
    "body": "Replying to [comment:63 mkoeppe]:\n> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n\nThe point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.",
    "created_at": "2021-02-16T22:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444366",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:63 mkoeppe]:
> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)

The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.



---

archive/issue_comments_444367.json:
```json
{
    "body": "Replying to [comment:64 gh-tobiasdiez]:\n> - Running the configure command yields the following warning at the end:\n> {{{\n> ....\n> config.status: creating directory local/var/lib/sage/installed\n> configure: WARNING: unrecognized options: --enable-editable\n> }}}\n>\nForgot to run `./bootstrap`?",
    "created_at": "2021-02-16T22:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444367",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 gh-tobiasdiez]:
> - Running the configure command yields the following warning at the end:
> {{{
> ....
> config.status: creating directory local/var/lib/sage/installed
> configure: WARNING: unrecognized options: --enable-editable
> }}}
>
Forgot to run `./bootstrap`?



---

archive/issue_comments_444368.json:
```json
{
    "body": "Replying to [comment:64 gh-tobiasdiez]:\n> - My only means to test this on mac is with the github action added in #30371.\n\nLet's please not pull a discussion of these experimental GH actions from #30371 into this ticket.\n\nIf we add automatic testing, we will do it on the basis of the existing GH actions.",
    "created_at": "2021-02-16T22:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444368",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 gh-tobiasdiez]:
> - My only means to test this on mac is with the github action added in #30371.

Let's please not pull a discussion of these experimental GH actions from #30371 into this ticket.

If we add automatic testing, we will do it on the basis of the existing GH actions.



---

archive/issue_comments_444369.json:
```json
{
    "body": "Replying to [comment:65 gh-tobiasdiez]:\n> Replying to [comment:63 mkoeppe]:\n> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n> \n> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. \n\nYes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.",
    "created_at": "2021-02-16T22:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444369",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:65 gh-tobiasdiez]:
> Replying to [comment:63 mkoeppe]:
> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)
> 
> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. 

Yes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.



---

archive/issue_comments_444370.json:
```json
{
    "body": "Replying to [comment:64 gh-tobiasdiez]:\n> A few more observations:\n> - There is currently no documentation for how to use the inplace install (and why).\n\nWell, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.",
    "created_at": "2021-02-16T22:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444370",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 gh-tobiasdiez]:
> A few more observations:
> - There is currently no documentation for how to use the inplace install (and why).

Well, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.



---

archive/issue_comments_444371.json:
```json
{
    "body": "Replying to [comment:64 gh-tobiasdiez]:\n> - On Linux (with wsl), the make build fails with\n> {{{\n> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n> [pplpy-0.8.6]     from markupsafe import escape\n> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n> }}}\n> That's probably not related to this ticket, but prevents me from testing it.\n\nI have not seen this before and I don't think it has anything to with the present ticket.\nPlease check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.",
    "created_at": "2021-02-16T22:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444371",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 gh-tobiasdiez]:
> - On Linux (with wsl), the make build fails with
> {{{
> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
> [pplpy-0.8.6]     from markupsafe import escape
> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes
> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
> }}}
> That's probably not related to this ticket, but prevents me from testing it.

I have not seen this before and I don't think it has anything to with the present ticket.
Please check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.



---

archive/issue_comments_444372.json:
```json
{
    "body": "Replying to [comment:66 mkoeppe]:\n> Forgot to run `./bootstrap`?\n\nThat fixed it indeed. \n\nThe pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.",
    "created_at": "2021-02-16T22:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444372",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:66 mkoeppe]:
> Forgot to run `./bootstrap`?

That fixed it indeed. 

The pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.



---

archive/issue_comments_444373.json:
```json
{
    "body": "I'm getting a few doctest failures:\n\n\n```\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.97 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.0 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\nRunning doctests with ID 2021-02-17-08-07-40-53dddc3c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.32 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\nRunning doctests with ID 2021-02-17-08-07-42-447cd574.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 199, in sage_setup.find.filter_cython_sources\nFailed example:\n    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 324, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f,) = files_by_module['sage.structure.sage_object']; f\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[5]>\", line 1, in <module>\n        (f,) = files_by_module['sage.structure.sage_object']; f\n    ValueError: not enough values to unpack (expected 1, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 326, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f1, f2) = sorted(files_by_module['sage.structure'])\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[6]>\", line 1, in <module>\n        (f1, f2) = sorted(files_by_module['sage.structure'])\n    ValueError: not enough values to unpack (expected 2, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 327, in sage_setup.find.installed_files_by_module\nFailed example:\n    f1\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[7]>\", line 1, in <module>\n        f1\n    NameError: name 'f1' is not defined\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 329, in sage_setup.find.installed_files_by_module\nFailed example:\n    f2\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[8]>\", line 1, in <module>\n        f2\n    NameError: name 'f2' is not defined\n**********************************************************************\n3 items had failures:\n   1 of   7 in sage_setup.find.filter_cython_sources\n   1 of   7 in sage_setup.find.find_extra_files\n   4 of  11 in sage_setup.find.installed_files_by_module\n    [42 tests, 6 failures, 0.40 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 0.4 seconds\n```\n\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\nRunning doctests with ID 2021-02-17-08-07-44-7353eba5.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 586, in sage.tests.cmdline.test_executable\nFailed example:\n    out.startswith(\"3.\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 588, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 590, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 231 in sage.tests.cmdline.test_executable\n    [230 tests, 3 failures, 21.87 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n\n\nThe test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.",
    "created_at": "2021-02-17T07:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444373",
    "user": "https://github.com/kliem"
}
```

I'm getting a few doctest failures:


```
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.97 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.0 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
Running doctests with ID 2021-02-17-08-07-40-53dddc3c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.32 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
Running doctests with ID 2021-02-17-08-07-42-447cd574.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 199, in sage_setup.find.filter_cython_sources
Failed example:
    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
File "src/sage_setup/find.py", line 324, in sage_setup.find.installed_files_by_module
Failed example:
    (f,) = files_by_module['sage.structure.sage_object']; f
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[5]>", line 1, in <module>
        (f,) = files_by_module['sage.structure.sage_object']; f
    ValueError: not enough values to unpack (expected 1, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 326, in sage_setup.find.installed_files_by_module
Failed example:
    (f1, f2) = sorted(files_by_module['sage.structure'])
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[6]>", line 1, in <module>
        (f1, f2) = sorted(files_by_module['sage.structure'])
    ValueError: not enough values to unpack (expected 2, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 327, in sage_setup.find.installed_files_by_module
Failed example:
    f1
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[7]>", line 1, in <module>
        f1
    NameError: name 'f1' is not defined
**********************************************************************
File "src/sage_setup/find.py", line 329, in sage_setup.find.installed_files_by_module
Failed example:
    f2
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[8]>", line 1, in <module>
        f2
    NameError: name 'f2' is not defined
**********************************************************************
3 items had failures:
   1 of   7 in sage_setup.find.filter_cython_sources
   1 of   7 in sage_setup.find.find_extra_files
   4 of  11 in sage_setup.find.installed_files_by_module
    [42 tests, 6 failures, 0.40 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 0.4 seconds
```


```
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
Running doctests with ID 2021-02-17-08-07-44-7353eba5.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 586, in sage.tests.cmdline.test_executable
Failed example:
    out.startswith("3.")
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 588, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 590, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 231 in sage.tests.cmdline.test_executable
    [230 tests, 3 failures, 21.87 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```


The test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.



---

archive/issue_comments_444374.json:
```json
{
    "body": "I got failures in `repl/interpreter.py` and `sage_setup/find.py`.",
    "created_at": "2021-02-18T01:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444374",
    "user": "https://github.com/jhpalmieri"
}
```

I got failures in `repl/interpreter.py` and `sage_setup/find.py`.



---

archive/issue_comments_444375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T01:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444376.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T02:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444377.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T02:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444378.json:
```json
{
    "body": "The remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).\n\nThe failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.",
    "created_at": "2021-02-18T03:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444378",
    "user": "https://github.com/mkoeppe"
}
```

The remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).

The failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.



---

archive/issue_comments_444379.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T03:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444380.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T03:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444380",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T04:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444382.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T06:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444383.json:
```json
{
    "body": "This fixes the remaining doctests for me.",
    "created_at": "2021-02-18T06:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444383",
    "user": "https://github.com/mkoeppe"
}
```

This fixes the remaining doctests for me.



---

archive/issue_comments_444384.json:
```json
{
    "body": "Not for me:\n\nI still get `src/sage/tests/cmdline.py`, which can be ignored.\n\nOn top:\n\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-07-50-51-5ae2b230.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.94 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.3 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 1.9 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\nRunning doctests with ID 2021-02-18-07-51-08-57678760.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.33 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\nRunning doctests with ID 2021-02-18-07-51-21-d3281c6c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage_setup.find.find_extra_files\n    [41 tests, 1 failure, 0.47 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.5 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 0.5 seconds\n```\n",
    "created_at": "2021-02-18T06:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444384",
    "user": "https://github.com/kliem"
}
```

Not for me:

I still get `src/sage/tests/cmdline.py`, which can be ignored.

On top:


```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-07-50-51-5ae2b230.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.94 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.3 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 1.9 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
Running doctests with ID 2021-02-18-07-51-08-57678760.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.33 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
Running doctests with ID 2021-02-18-07-51-21-d3281c6c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
1 item had failures:
   1 of   7 in sage_setup.find.find_extra_files
    [41 tests, 1 failure, 0.47 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.5 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
```




---

archive/issue_comments_444385.json:
```json
{
    "body": "`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.",
    "created_at": "2021-02-18T06:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444385",
    "user": "https://github.com/kliem"
}
```

`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.



---

archive/issue_comments_444386.json:
```json
{
    "body": "After `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.",
    "created_at": "2021-02-18T07:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444386",
    "user": "https://github.com/mkoeppe"
}
```

After `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.



---

archive/issue_comments_444387.json:
```json
{
    "body": "My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`",
    "created_at": "2021-02-18T07:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444387",
    "user": "https://github.com/mkoeppe"
}
```

My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`



---

archive/issue_comments_444388.json:
```json
{
    "body": "The missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.\n\nCan you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.",
    "created_at": "2021-02-18T07:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444388",
    "user": "https://github.com/kliem"
}
```

The missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.

Can you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.



---

archive/issue_comments_444389.json:
```json
{
    "body": "Ran `make sagelib-clean sagelib` and `make build` and it still persists:\n\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-08-59-13-9182572c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 2.90 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 8.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.9 seconds\n```\n",
    "created_at": "2021-02-18T08:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444389",
    "user": "https://github.com/kliem"
}
```

Ran `make sagelib-clean sagelib` and `make build` and it still persists:


```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-08-59-13-9182572c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 2.90 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 8.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.9 seconds
```




---

archive/issue_comments_444390.json:
```json
{
    "body": "I mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.",
    "created_at": "2021-02-18T08:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444390",
    "user": "https://github.com/kliem"
}
```

I mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.



---

archive/issue_comments_444391.json:
```json
{
    "body": "Replying to [comment:86 mkoeppe]:\n> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n\nI think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.",
    "created_at": "2021-02-18T08:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444391",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:86 mkoeppe]:
> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`

I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.



---

archive/issue_comments_444392.json:
```json
{
    "body": "I think we can leave those failures for later fix, as long as we take care of them at some point.\n\nNone of the doctest failures is serious.\n\nI guess this isn't ready yet for being used for patchbots.",
    "created_at": "2021-02-18T08:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444392",
    "user": "https://github.com/kliem"
}
```

I think we can leave those failures for later fix, as long as we take care of them at some point.

None of the doctest failures is serious.

I guess this isn't ready yet for being used for patchbots.



---

archive/issue_comments_444393.json:
```json
{
    "body": "Replying to [comment:88 gh-kliem]:\n> Ran `make sagelib-clean sagelib` and `make build` and it still persists:\n\nI'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?",
    "created_at": "2021-02-18T16:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444393",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:88 gh-kliem]:
> Ran `make sagelib-clean sagelib` and `make build` and it still persists:

I'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?



---

archive/issue_comments_444394.json:
```json
{
    "body": "Replying to [comment:90 gh-tobiasdiez]:\n> Replying to [comment:86 mkoeppe]:\n> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n> \n> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.\n\nNo, calling autogen earlier does not help.",
    "created_at": "2021-02-18T16:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444394",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:90 gh-tobiasdiez]:
> Replying to [comment:86 mkoeppe]:
> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`
> 
> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.

No, calling autogen earlier does not help.



---

archive/issue_comments_444395.json:
```json
{
    "body": "For changes in Python source, one might even use `importlib` and not restart sage at all!",
    "created_at": "2021-02-18T17:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444395",
    "user": "https://github.com/videlec"
}
```

For changes in Python source, one might even use `importlib` and not restart sage at all!



---

archive/issue_comments_444396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T17:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444397.json:
```json
{
    "body": "Replying to [comment:95 vdelecroix]:\n> For changes in Python source, one might even use `importlib` and not restart sage at all!\n\nTrue, but let's not document this -- too many possible pitfalls related to class redefinitions",
    "created_at": "2021-02-18T17:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444397",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:95 vdelecroix]:
> For changes in Python source, one might even use `importlib` and not restart sage at all!

True, but let's not document this -- too many possible pitfalls related to class redefinitions



---

archive/issue_comments_444398.json:
```json
{
    "body": "(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)",
    "created_at": "2021-02-18T17:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444398",
    "user": "https://github.com/mkoeppe"
}
```

(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)



---

archive/issue_comments_444399.json:
```json
{
    "body": "Ready for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)",
    "created_at": "2021-02-18T17:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444399",
    "user": "https://github.com/mkoeppe"
}
```

Ready for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)



---

archive/issue_comments_444400.json:
```json
{
    "body": "After deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.",
    "created_at": "2021-02-18T18:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444400",
    "user": "https://github.com/kliem"
}
```

After deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.



---

archive/issue_comments_444401.json:
```json
{
    "body": "I'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...",
    "created_at": "2021-02-18T18:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444401",
    "user": "https://github.com/mkoeppe"
}
```

I'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...



---

archive/issue_comments_444402.json:
```json
{
    "body": "Or we can leave this issue for the follow-up ticket #31406, that would be fine with me too.",
    "created_at": "2021-02-18T18:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444402",
    "user": "https://github.com/mkoeppe"
}
```

Or we can leave this issue for the follow-up ticket #31406, that would be fine with me too.



---

archive/issue_comments_444403.json:
```json
{
    "body": "If we're to believe the doctest language (\"Check that Cython source code appears in tracebacks\"), then this is functioning properly, it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\n\n```diff\ndiff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py\nindex befa75fc38..3bd894851d 100644\n--- a/src/sage/repl/interpreter.py\n+++ b/src/sage/repl/interpreter.py\n@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::\n     ZeroDivisionError...Traceback (most recent call last)\n     <ipython-input-...> in <module>...\n     ----> 1 Integer(1)/Integer(0)\n-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...\n     ...\n     -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n        ....:            x = <Rational> Rational.__new__(Rational)\n```\n\nBy the way, `git status` tells me\n\n```\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tsrc/cython_debug/\n```\n",
    "created_at": "2021-02-18T19:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444403",
    "user": "https://github.com/jhpalmieri"
}
```

If we're to believe the doctest language ("Check that Cython source code appears in tracebacks"), then this is functioning properly, it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?

```diff
diff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py
index befa75fc38..3bd894851d 100644
--- a/src/sage/repl/interpreter.py
+++ b/src/sage/repl/interpreter.py
@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::
     ZeroDivisionError...Traceback (most recent call last)
     <ipython-input-...> in <module>...
     ----> 1 Integer(1)/Integer(0)
-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...
     ...
     -> ...                  raise ZeroDivisionError("rational division by zero")
        ....:            x = <Rational> Rational.__new__(Rational)
```

By the way, `git status` tells me

```
Untracked files:
  (use "git add <file>..." to include in what will be committed)
	src/cython_debug/
```




---

archive/issue_comments_444404.json:
```json
{
    "body": "I had also these untracked files in src/cython_debug.\n\nThe tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.",
    "created_at": "2021-02-18T20:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444404",
    "user": "https://github.com/tobiasdiez"
}
```

I had also these untracked files in src/cython_debug.

The tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.



---

archive/issue_comments_444405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T20:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444406.json:
```json
{
    "body": "Replying to [comment:103 jhpalmieri]:\n> it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\nI don't know if this information is important, perhaps someone who programs Cython can tell us?",
    "created_at": "2021-02-18T20:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444406",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:103 jhpalmieri]:
> it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?
I don't know if this information is important, perhaps someone who programs Cython can tell us?



---

archive/issue_comments_444407.json:
```json
{
    "body": "Using git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.\n\nHowever, things are out of our control.\n\nI think the reason why \"(.../cythonized/sage/rings/integer.c:...)()\" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.\n\nLong story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.",
    "created_at": "2021-02-18T20:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444407",
    "user": "https://github.com/kliem"
}
```

Using git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.

However, things are out of our control.

I think the reason why "(.../cythonized/sage/rings/integer.c:...)()" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.

Long story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.



---

archive/issue_comments_444408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T20:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_444409.json:
```json
{
    "body": "Thanks for investigating. This is sufficiently convincing, so I have removed the test.",
    "created_at": "2021-02-18T20:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444409",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for investigating. This is sufficiently convincing, so I have removed the test.



---

archive/issue_comments_444410.json:
```json
{
    "body": "Ok, all tests pass now (except for those two unrelated tests).",
    "created_at": "2021-02-19T15:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444410",
    "user": "https://github.com/kliem"
}
```

Ok, all tests pass now (except for those two unrelated tests).



---

archive/issue_comments_444411.json:
```json
{
    "body": "Any further concerns, or can we get this in?",
    "created_at": "2021-02-20T18:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444411",
    "user": "https://github.com/mkoeppe"
}
```

Any further concerns, or can we get this in?



---

archive/issue_comments_444412.json:
```json
{
    "body": "From my side this looks good.",
    "created_at": "2021-02-20T18:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444412",
    "user": "https://github.com/tobiasdiez"
}
```

From my side this looks good.



---

archive/issue_comments_444413.json:
```json
{
    "body": "I'm happy with it, but didn't have the time to understand everything yet.",
    "created_at": "2021-02-20T19:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444413",
    "user": "https://github.com/kliem"
}
```

I'm happy with it, but didn't have the time to understand everything yet.



---

archive/issue_comments_444414.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-24T09:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444414",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_444415.json:
```json
{
    "body": "LGTM.\n\nI don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.",
    "created_at": "2021-02-24T09:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444415",
    "user": "https://github.com/kliem"
}
```

LGTM.

I don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.



---

archive/issue_comments_444416.json:
```json
{
    "body": "Thanks! I've added your suggestion to #31406.",
    "created_at": "2021-02-24T15:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444416",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks! I've added your suggestion to #31406.



---

archive/issue_comments_444417.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2021-02-24T18:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444417",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the review!



---

archive/issue_comments_444418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-03-07T21:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_444419.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-03-07T21:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_444420.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-07T21:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444420",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_444421.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444421",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_082206.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31140#event-82206"
}
```



---

archive/issue_comments_444422.json:
```json
{
    "body": "I finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. \n\nUnlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.\n\nIs there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?",
    "created_at": "2021-03-09T21:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444422",
    "user": "https://github.com/kiwifb"
}
```

I finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. 

Unlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.

Is there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?



---

archive/issue_comments_444423.json:
```json
{
    "body": "I don't think this ticket changes anything if you don't use `configure --enable-editable`.",
    "created_at": "2021-03-09T22:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444423",
    "user": "https://github.com/mkoeppe"
}
```

I don't think this ticket changes anything if you don't use `configure --enable-editable`.



---

archive/issue_comments_444424.json:
```json
{
    "body": "Just be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.",
    "created_at": "2021-03-09T22:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444424",
    "user": "https://github.com/mkoeppe"
}
```

Just be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.



---

archive/issue_comments_444425.json:
```json
{
    "body": "I am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.\n\nOn a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.",
    "created_at": "2021-03-09T22:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444425",
    "user": "https://github.com/kiwifb"
}
```

I am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.

On a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.



---

archive/issue_comments_444426.json:
```json
{
    "body": "Replying to [comment:123 fbissey]:\n> By the sound of it, the change of behavior is accidental\n\nNo. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.",
    "created_at": "2021-03-09T22:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444426",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:123 fbissey]:
> By the sound of it, the change of behavior is accidental

No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.



---

archive/issue_comments_444427.json:
```json
{
    "body": "By the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.",
    "created_at": "2021-03-09T22:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444427",
    "user": "https://github.com/mkoeppe"
}
```

By the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.



---

archive/issue_comments_444428.json:
```json
{
    "body": "Replying to [comment:124 mkoeppe]:\n> Replying to [comment:123 fbissey]:\n> > By the sound of it, the change of behavior is accidental\n> \n> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.\n\nI hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.",
    "created_at": "2021-03-09T22:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444428",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:124 mkoeppe]:
> Replying to [comment:123 fbissey]:
> > By the sound of it, the change of behavior is accidental
> 
> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.

I hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.



---

archive/issue_comments_444429.json:
```json
{
    "body": "No, as of this ticket, it's used for `./configure --enable-editable`.",
    "created_at": "2021-03-09T22:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444429",
    "user": "https://github.com/mkoeppe"
}
```

No, as of this ticket, it's used for `./configure --enable-editable`.



---

archive/issue_comments_444430.json:
```json
{
    "body": "I think I am starting to get the picture. So those large looking differences are on purpose?",
    "created_at": "2021-03-09T23:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444430",
    "user": "https://github.com/kiwifb"
}
```

I think I am starting to get the picture. So those large looking differences are on purpose?



---

archive/issue_comments_444431.json:
```json
{
    "body": "It sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).",
    "created_at": "2021-03-09T23:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444431",
    "user": "https://github.com/jhpalmieri"
}
```

It sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).



---

archive/issue_comments_444432.json:
```json
{
    "body": "Replying to [comment:128 fbissey]:\n> So those large looking differences are on purpose?\n\nYes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.",
    "created_at": "2021-03-09T23:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31140#issuecomment-444432",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:128 fbissey]:
> So those large looking differences are on purpose?

Yes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.
