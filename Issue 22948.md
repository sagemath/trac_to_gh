# Issue 22948: A polynomial ring embeds into its fraction field

archive/issues_022948.json:
```json
{
    "body": "Currently, this fails:\n```\nsage: R.<x> = QQ[]\nsage: K.<x> = FractionField(QQ)\nsage: R.is_subring(K)\nNotImplementedError\n```\n\nbut it should return ``True``.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23185\n\n",
    "created_at": "2017-06-09T06:00:05Z",
    "labels": [
        "component: commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "A polynomial ring embeds into its fraction field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22948",
    "user": "https://github.com/saraedum"
}
```
Currently, this fails:
```
sage: R.<x> = QQ[]
sage: K.<x> = FractionField(QQ)
sage: R.is_subring(K)
NotImplementedError
```

but it should return ``True``.

Issue created by migration from https://trac.sagemath.org/ticket/23185





---

archive/issue_comments_320705.json:
```json
{
    "body": "Most likely, we need to patch `_coerce_map_from_` of function fields to return an injective homomorphism.",
    "created_at": "2017-06-09T06:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320705",
    "user": "https://github.com/saraedum"
}
```

Most likely, we need to patch `_coerce_map_from_` of function fields to return an injective homomorphism.



---

archive/issue_comments_320706.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd86.5\".",
    "created_at": "2017-06-09T06:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320706",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "sd86.5".



---

archive/issue_comments_320707.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-27T23:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320707",
    "user": "https://github.com/saraedum"
}
```

New commits:



---

archive/issue_comments_320708.json:
```json
{
    "body": "I expect quite a few doctest failures because error messages change.",
    "created_at": "2017-06-27T23:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320708",
    "user": "https://github.com/saraedum"
}
```

I expect quite a few doctest failures because error messages change.



---

archive/issue_comments_320709.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-27T23:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320709",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_320710.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-27T23:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320710",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-28T02:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-14T04:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320713.json:
```json
{
    "body": "Changing keywords from \"sd86.5\" to \"sd86.5, sd87\".",
    "created_at": "2017-07-17T17:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320713",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd86.5" to "sd86.5, sd87".



---

archive/issue_comments_320714.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-19T23:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320714",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T18:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T21:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320717.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-21T19:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320717",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T19:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320719.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-21T19:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320719",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320720.json:
```json
{
    "body": "This has a lot of doctests that fail:\n\n```\nsage -t --warn-long 100.3 src/sage/manifolds/differentiable/metric.py  # 1 doctest failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 5 doctests failed\nsage -t --warn-long 100.3 src/sage/symbolic/expression.pyx  # 3 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 11 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/projective/projective_morphism.py  # 38 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/sha_tate.py  # 1 doctest failed\nsage -t --warn-long 100.3 src/sage/tests/gosper-sum.py  # 12 doctests failed\nsage -t --warn-long 100.3 src/sage/modules/free_module_element.pyx  # 16 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/padics.py  # 2 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_point.py  # 5 doctests failed\nsage -t --warn-long 100.3 src/sage/modules/free_module.py  # 8 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/curves/affine_curve.py  # 16 doctests failed\nsage -t --warn-long 100.3 src/sage/combinat/perfect_matching.py  # 2 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/constructor.py  # 4 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_egros.py  # 3 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/projective/projective_point.py  # 1 doctest failed\nsage -t --warn-long 100.3 src/sage/schemes/affine/affine_morphism.py  # 29 doctests failed\nsage -t --warn-long 100.3 src/sage/rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed\nsage -t --warn-long 100.3 src/sage/rings/morphism.pyx  # 2 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_tate_curve.py  # 5 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/generic/morphism.py  # 9 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/affine/affine_point.py  # 6 doctests failed\nsage -t --warn-long 100.3 src/sage/rings/polynomial/skew_polynomial_element.pyx  # 8 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/projective/endPN_minimal_model.py  # 2 doctests failed\nsage -t --warn-long 100.3 src/sage/schemes/projective/projective_morphism_helper.pyx  # 3 doctests failed\n\n```\n\nIn particular, things that have non-unit denominators are failing to factor.",
    "created_at": "2017-07-21T21:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320720",
    "user": "https://github.com/adeines"
}
```

This has a lot of doctests that fail:

```
sage -t --warn-long 100.3 src/sage/manifolds/differentiable/metric.py  # 1 doctest failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 5 doctests failed
sage -t --warn-long 100.3 src/sage/symbolic/expression.pyx  # 3 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 11 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/projective/projective_morphism.py  # 38 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/sha_tate.py  # 1 doctest failed
sage -t --warn-long 100.3 src/sage/tests/gosper-sum.py  # 12 doctests failed
sage -t --warn-long 100.3 src/sage/modules/free_module_element.pyx  # 16 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/padics.py  # 2 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_point.py  # 5 doctests failed
sage -t --warn-long 100.3 src/sage/modules/free_module.py  # 8 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/curves/affine_curve.py  # 16 doctests failed
sage -t --warn-long 100.3 src/sage/combinat/perfect_matching.py  # 2 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/constructor.py  # 4 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_egros.py  # 3 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/projective/projective_point.py  # 1 doctest failed
sage -t --warn-long 100.3 src/sage/schemes/affine/affine_morphism.py  # 29 doctests failed
sage -t --warn-long 100.3 src/sage/rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed
sage -t --warn-long 100.3 src/sage/rings/morphism.pyx  # 2 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/elliptic_curves/ell_tate_curve.py  # 5 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/generic/morphism.py  # 9 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/affine/affine_point.py  # 6 doctests failed
sage -t --warn-long 100.3 src/sage/rings/polynomial/skew_polynomial_element.pyx  # 8 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/projective/endPN_minimal_model.py  # 2 doctests failed
sage -t --warn-long 100.3 src/sage/schemes/projective/projective_morphism_helper.pyx  # 3 doctests failed

```

In particular, things that have non-unit denominators are failing to factor.



---

archive/issue_comments_320721.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-21T21:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320721",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-07-22T03:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_320723.json:
```json
{
    "body": "Last 10 new commits:\n|                                                                                                                                          |                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[e891a88](https://git.sagemath.org/sage.git/commit?id=e891a884f8eca9e1e7d226306cb79b9cd827ee8b)|`Replace isinstance(RingHomomorphism)`|\n|[0c3d772](https://git.sagemath.org/sage.git/commit?id=0c3d77228a92891b5c381442e7edbb3102eec888)|`fix doctests`|\n|[b15febb](https://git.sagemath.org/sage.git/commit?id=b15febbb9c7ef9be0163d572343bef5297e3611d)|`Fixed two doctests typos.`|\n|[ea35cc4](https://git.sagemath.org/sage.git/commit?id=ea35cc4827370a4d133c1a115ff1d85954320598)|`Merge branch 'u/aly.deines/remove_ringhomomorphism_coercion' of git://trac.sagemath.org/sage into t/23204/remove_ringhomomorphism_coercion`|\n|[961b615](https://git.sagemath.org/sage.git/commit?id=961b6152a6187b88d9a536aa8929762f850b8d1c)|`Merge remote-tracking branch 'origin/develop' into t/23204/remove_ringhomomorphism_coercion`|\n|[d5affa7](https://git.sagemath.org/sage.git/commit?id=d5affa709b63178eac8a74eac90b8d61ff77d209)|`The \"morphism\" might just be a \"Map\", namely a DefaultConvertMap`|\n|[382e2d1](https://git.sagemath.org/sage.git/commit?id=382e2d180772eb9d355aa7fbf539dcc52607a379)|`fix docbuild`|\n|[05ee2ca](https://git.sagemath.org/sage.git/commit?id=05ee2ca55b56acf3241fc19b4ce62e1404cde002)|`Merge branch 't/23204/remove_ringhomomorphism_coercion' into t/23185/a_polynomial_ring_embeds_into_its_fraction_field`|\n|[1cf2b44](https://git.sagemath.org/sage.git/commit?id=1cf2b44352669236a029492cdac8b2c4393f7da9)|`fix doctest output`|\n|[faed28f](https://git.sagemath.org/sage.git/commit?id=faed28f4a7f263b8b84c78bbb96f28c8218ef583)|`Accept keyword parameters`|\n---\nLast 10 new commits:",
    "created_at": "2017-07-22T04:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320723",
    "user": "https://github.com/saraedum"
}
```

Last 10 new commits:
|                                                                                                                                          |                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[e891a88](https://git.sagemath.org/sage.git/commit?id=e891a884f8eca9e1e7d226306cb79b9cd827ee8b)|`Replace isinstance(RingHomomorphism)`|
|[0c3d772](https://git.sagemath.org/sage.git/commit?id=0c3d77228a92891b5c381442e7edbb3102eec888)|`fix doctests`|
|[b15febb](https://git.sagemath.org/sage.git/commit?id=b15febbb9c7ef9be0163d572343bef5297e3611d)|`Fixed two doctests typos.`|
|[ea35cc4](https://git.sagemath.org/sage.git/commit?id=ea35cc4827370a4d133c1a115ff1d85954320598)|`Merge branch 'u/aly.deines/remove_ringhomomorphism_coercion' of git://trac.sagemath.org/sage into t/23204/remove_ringhomomorphism_coercion`|
|[961b615](https://git.sagemath.org/sage.git/commit?id=961b6152a6187b88d9a536aa8929762f850b8d1c)|`Merge remote-tracking branch 'origin/develop' into t/23204/remove_ringhomomorphism_coercion`|
|[d5affa7](https://git.sagemath.org/sage.git/commit?id=d5affa709b63178eac8a74eac90b8d61ff77d209)|`The "morphism" might just be a "Map", namely a DefaultConvertMap`|
|[382e2d1](https://git.sagemath.org/sage.git/commit?id=382e2d180772eb9d355aa7fbf539dcc52607a379)|`fix docbuild`|
|[05ee2ca](https://git.sagemath.org/sage.git/commit?id=05ee2ca55b56acf3241fc19b4ce62e1404cde002)|`Merge branch 't/23204/remove_ringhomomorphism_coercion' into t/23185/a_polynomial_ring_embeds_into_its_fraction_field`|
|[1cf2b44](https://git.sagemath.org/sage.git/commit?id=1cf2b44352669236a029492cdac8b2c4393f7da9)|`fix doctest output`|
|[faed28f](https://git.sagemath.org/sage.git/commit?id=faed28f4a7f263b8b84c78bbb96f28c8218ef583)|`Accept keyword parameters`|
---
Last 10 new commits:



---

archive/issue_comments_320724.json:
```json
{
    "body": "There is no speed regression:\n\n```\nsage: R.<x> = ZpCA(2)[]\nsage: K=R.fraction_field()\nsage: a = x/K(3)\nsage: %timeit R(a)\n10000 loops, best of 3: 98.8 \u00b5s per loop # before\n10000 loops, best of 3: 84.3 \u00b5s per loop # after\nsage: o = K.one()\nsage: %timeit R(o)\n10000 loops, best of 3: 96.5 \u00b5s per loop # before\n10000 loops, best of 3: 82.2 \u00b5s per loop # after\n```",
    "created_at": "2017-07-22T04:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320724",
    "user": "https://github.com/saraedum"
}
```

There is no speed regression:

```
sage: R.<x> = ZpCA(2)[]
sage: K=R.fraction_field()
sage: a = x/K(3)
sage: %timeit R(a)
10000 loops, best of 3: 98.8 µs per loop # before
10000 loops, best of 3: 84.3 µs per loop # after
sage: o = K.one()
sage: %timeit R(o)
10000 loops, best of 3: 96.5 µs per loop # before
10000 loops, best of 3: 82.2 µs per loop # after
```



---

archive/issue_comments_320725.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-22T04:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320725",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320726.json:
```json
{
    "body": "The tests pass for the files that failed before.",
    "created_at": "2017-07-22T04:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320726",
    "user": "https://github.com/saraedum"
}
```

The tests pass for the files that failed before.



---

archive/issue_comments_320727.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-22T05:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320727",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-22T05:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320729.json:
```json
{
    "body": "The code looks good. Doctests in sage/rings pass. When the patchbot is happy I can give it a positive review.",
    "created_at": "2017-07-22T06:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320729",
    "user": "https://github.com/mmasdeu"
}
```

The code looks good. Doctests in sage/rings pass. When the patchbot is happy I can give it a positive review.



---

archive/issue_comments_320730.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-22T21:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320730",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320731.json:
```json
{
    "body": "Julian, quick (possibly stupid) question.  In the class FractionFieldEmbeddingSection, is _call_with_args doing anything that _call_ isn't?  Currently it's the function lacking coverage in fraction_field.py, but maybe we don't need this function?",
    "created_at": "2017-07-22T22:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320731",
    "user": "https://github.com/adeines"
}
```

Julian, quick (possibly stupid) question.  In the class FractionFieldEmbeddingSection, is _call_with_args doing anything that _call_ isn't?  Currently it's the function lacking coverage in fraction_field.py, but maybe we don't need this function?



---

archive/issue_comments_320732.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-23T06:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320732",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320733.json:
```json
{
    "body": "Replying to [comment:34 aly.deines]:\n> Julian, quick (possibly stupid) question.  In the class FractionFieldEmbeddingSection, is _call_with_args doing anything that _call_ isn't?  Currently it's the function lacking coverage in fraction_field.py, but maybe we don't need this function?\n\nSome code in schemes does essentially:\n\n```\nsage: K = some_ring.fraction_field()\nsage: some_ring(K.some_element(), check=False)\n```\nI guess it was put there for performance reasons. The `check` used to get passed on to the `element_constructor` of `R`. Now there is a proper map, so we need to consume the extra argument. This is done by implementing `_call_with_args`. It does not do anything that `_call_` does not but `Parent` is calling `_call_with_args` if there is any arguments. (I don't really know why `Parent` can't just call `_call_` with arguments.)",
    "created_at": "2017-07-23T06:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320733",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:34 aly.deines]:
> Julian, quick (possibly stupid) question.  In the class FractionFieldEmbeddingSection, is _call_with_args doing anything that _call_ isn't?  Currently it's the function lacking coverage in fraction_field.py, but maybe we don't need this function?

Some code in schemes does essentially:

```
sage: K = some_ring.fraction_field()
sage: some_ring(K.some_element(), check=False)
```
I guess it was put there for performance reasons. The `check` used to get passed on to the `element_constructor` of `R`. Now there is a proper map, so we need to consume the extra argument. This is done by implementing `_call_with_args`. It does not do anything that `_call_` does not but `Parent` is calling `_call_with_args` if there is any arguments. (I don't really know why `Parent` can't just call `_call_` with arguments.)



---

archive/issue_comments_320734.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-23T06:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320734",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-23T06:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320736.json:
```json
{
    "body": "Looks good once tests pass.",
    "created_at": "2017-07-23T06:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320736",
    "user": "https://github.com/roed314"
}
```

Looks good once tests pass.



---

archive/issue_comments_320737.json:
```json
{
    "body": "One should avoid comparison of types. Using isinstance is the correct way of doing that.",
    "created_at": "2017-07-23T07:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320737",
    "user": "https://github.com/fchapoton"
}
```

One should avoid comparison of types. Using isinstance is the correct way of doing that.



---

archive/issue_comments_320738.json:
```json
{
    "body": "chapoton: Do you refer to `_richcmp_`? So, in general I agree that `isinstance` is often better than equality of type. In this case, however, I don't see how someone would inherit from this class and mix this class and its subtype in the same homset \u2013 after all this is a coercion, so how should there be another coercion with the same domain and codomain around? At the same time, rewriting this to use `isinstance` makes the code more complicated.",
    "created_at": "2017-07-23T08:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320738",
    "user": "https://github.com/saraedum"
}
```

chapoton: Do you refer to `_richcmp_`? So, in general I agree that `isinstance` is often better than equality of type. In this case, however, I don't see how someone would inherit from this class and mix this class and its subtype in the same homset – after all this is a coercion, so how should there be another coercion with the same domain and codomain around? At the same time, rewriting this to use `isinstance` makes the code more complicated.



---

archive/issue_comments_320739.json:
```json
{
    "body": "Well, I just wanted to say that comparison of types is not allowed in python3. I spend a lot of time trying to make progress towards python3, and seeing yet more work to be done makes me rather unhappy.\n\nhttps://stackoverflow.com/questions/707674/how-to-compare-type-of-an-object-in-python",
    "created_at": "2017-07-23T09:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320739",
    "user": "https://github.com/fchapoton"
}
```

Well, I just wanted to say that comparison of types is not allowed in python3. I spend a lot of time trying to make progress towards python3, and seeing yet more work to be done makes me rather unhappy.

https://stackoverflow.com/questions/707674/how-to-compare-type-of-an-object-in-python



---

archive/issue_comments_320740.json:
```json
{
    "body": "Sure. I thought you were talking about `==` and `!=` but of course we should do something about `<=` and friends here.",
    "created_at": "2017-07-23T15:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320740",
    "user": "https://github.com/saraedum"
}
```

Sure. I thought you were talking about `==` and `!=` but of course we should do something about `<=` and friends here.



---

archive/issue_comments_320741.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-23T15:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320741",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320742.json:
```json
{
    "body": "There is no need for a new kind of richcmp variant. Just do not compare types, but use isinstance.",
    "created_at": "2017-07-23T18:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320742",
    "user": "https://github.com/fchapoton"
}
```

There is no need for a new kind of richcmp variant. Just do not compare types, but use isinstance.



---

archive/issue_comments_320743.json:
```json
{
    "body": "This is a very common task and it is apparently very easy to get wrong. So, I think there is a point in providing a helper that makes this easy to write (and mentioning it in `Element._richcmp_`) I'd like to keep this one line of code without caring about what `op` is exactly, so I'd like to have the new implementation be:\n\n```\nreturn richcmp_unordered((type(self),self.domain(),self.codomain()) == (type(other),other.domain(),other.codomain()), op)\n```\n\nOr do you have an idea for a similarly short implementation that gets all the cases right?",
    "created_at": "2017-07-23T21:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320743",
    "user": "https://github.com/saraedum"
}
```

This is a very common task and it is apparently very easy to get wrong. So, I think there is a point in providing a helper that makes this easy to write (and mentioning it in `Element._richcmp_`) I'd like to keep this one line of code without caring about what `op` is exactly, so I'd like to have the new implementation be:

```
return richcmp_unordered((type(self),self.domain(),self.codomain()) == (type(other),other.domain(),other.codomain()), op)
```

Or do you have an idea for a similarly short implementation that gets all the cases right?



---

archive/issue_comments_320744.json:
```json
{
    "body": "Actually\n\n```\nreturn richcmp_unordered(type(self) == type(other) and (self.domain(),self.codomain()) == (other.domain(),other.codomain()))\n```",
    "created_at": "2017-07-24T01:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320744",
    "user": "https://github.com/saraedum"
}
```

Actually

```
return richcmp_unordered(type(self) == type(other) and (self.domain(),self.codomain()) == (other.domain(),other.codomain()))
```



---

archive/issue_comments_320745.json:
```json
{
    "body": "Replying to [comment:50 saraedum]:\n> Actually\n> \n> ```\n> return richcmp_unordered(type(self) == type(other) and (self.domain(),self.codomain()) == (other.domain(),other.codomain()))\n> ```\n\nIf you want to do just that (go through a boolean), then use `rich_to_bool`\n\nIn most of the cases, one really wants to compare (for inequalities) the rest, once the type is checked to be correct.\n\n***EDIT*** maybe rich_to_bool is not the correct solution here. It is rather used to take as input the result of an oldstyle cmp.",
    "created_at": "2017-07-24T06:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320745",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:50 saraedum]:
> Actually
> 
> ```
> return richcmp_unordered(type(self) == type(other) and (self.domain(),self.codomain()) == (other.domain(),other.codomain()))
> ```

If you want to do just that (go through a boolean), then use `rich_to_bool`

In most of the cases, one really wants to compare (for inequalities) the rest, once the type is checked to be correct.

***EDIT*** maybe rich_to_bool is not the correct solution here. It is rather used to take as input the result of an oldstyle cmp.



---

archive/issue_comments_320746.json:
```json
{
    "body": "Trying to find a solution that both of us would agree on, I would suggest :\n\n0) Do no use your new proposal for a richmp_unordered here, but keep this ticket independent from that. You can then try elsewhere to convince that this is a good idea, without preventing the ticket here to be fixed.\n\n1) use here the standard way to implement richcmp, looking like\n\n```\nif not isinstance(other, FractionFieldEmbeddingSection):\n    return NotImplemented\nreturn richcmp((self.domain(), self.codomain()), (other.domain(), other.codomain()), op)\n```",
    "created_at": "2017-07-24T09:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320746",
    "user": "https://github.com/fchapoton"
}
```

Trying to find a solution that both of us would agree on, I would suggest :

0) Do no use your new proposal for a richmp_unordered here, but keep this ticket independent from that. You can then try elsewhere to convince that this is a good idea, without preventing the ticket here to be fixed.

1) use here the standard way to implement richcmp, looking like

```
if not isinstance(other, FractionFieldEmbeddingSection):
    return NotImplemented
return richcmp((self.domain(), self.codomain()), (other.domain(), other.codomain()), op)
```



---

archive/issue_comments_320747.json:
```json
{
    "body": "Ok. I think that I am fine with your proposal 1). The only thing I don't like about it is that if domain and codomain implement `<=` for whatever reason, then `self` will do as well. I am not sure if that's a good idea but I also don't mind.",
    "created_at": "2017-07-24T11:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320747",
    "user": "https://github.com/saraedum"
}
```

Ok. I think that I am fine with your proposal 1). The only thing I don't like about it is that if domain and codomain implement `<=` for whatever reason, then `self` will do as well. I am not sure if that's a good idea but I also don't mind.



---

archive/issue_comments_320748.json:
```json
{
    "body": "Shouldn't we raise a `TypeError` instead of `NotImplemented`? That seems to be what Python3 does:\n\n```\n>>> \"\" < 0\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: '<' not supported between instances of 'str' and 'int'\n```",
    "created_at": "2017-07-24T11:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320748",
    "user": "https://github.com/saraedum"
}
```

Shouldn't we raise a `TypeError` instead of `NotImplemented`? That seems to be what Python3 does:

```
>>> "" < 0
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: '<' not supported between instances of 'str' and 'int'
```



---

archive/issue_comments_320749.json:
```json
{
    "body": "Replying to [comment:54 saraedum]:\n> Shouldn't we raise a `TypeError` instead of `NotImplemented`? That seems to be what Python3 does:\n> \n> ```\n> >>> \"\" < 0\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n> TypeError: '<' not supported between instances of 'str' and 'int'\n> ```\n\n\nNo, I do not think so. It seems that NotImplemented is what one should answer when not knowing how to compare. Python will know what to do with that, hopefuly.",
    "created_at": "2017-07-24T12:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320749",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:54 saraedum]:
> Shouldn't we raise a `TypeError` instead of `NotImplemented`? That seems to be what Python3 does:
> 
> ```
> >>> "" < 0
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
> TypeError: '<' not supported between instances of 'str' and 'int'
> ```


No, I do not think so. It seems that NotImplemented is what one should answer when not knowing how to compare. Python will know what to do with that, hopefuly.



---

archive/issue_comments_320750.json:
```json
{
    "body": "Replying to [comment:54 saraedum]:\n> Shouldn't we raise a `TypeError` instead of `NotImplemented`?\n\n\nNo and let me elaborate on that:\n\nWhen doing `A < B`, Python first calls `A.__lt__(B)` (*). If that returns a value different from `NotImplemented`, or if this raises an exception, this value or exception is the result of `A < B`. On the other hand, if `A.__lt__(B)` returns `NotImplemented`, then Python calls `B.__gt__(A)` (*). If that also returns `NotImplemented`, then Python 3 raises a `TypeError`. Python 2 falls back to `__cmp__` instead.\n\nWhat I just described is the Python behaviour. In this case, if the parents are not equal, the coercion model is involved too and that by itself does a fallback in case of `NotImplemented`.\n\n(*) NOTE: to be very precise, it actually does `type(A).__lt__(A, B)`, but that is equivalent to `A.__lt__(B)`, except that it does not look in `A.__dict__`.",
    "created_at": "2017-07-24T12:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320750",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:54 saraedum]:
> Shouldn't we raise a `TypeError` instead of `NotImplemented`?


No and let me elaborate on that:

When doing `A < B`, Python first calls `A.__lt__(B)` (*). If that returns a value different from `NotImplemented`, or if this raises an exception, this value or exception is the result of `A < B`. On the other hand, if `A.__lt__(B)` returns `NotImplemented`, then Python calls `B.__gt__(A)` (*). If that also returns `NotImplemented`, then Python 3 raises a `TypeError`. Python 2 falls back to `__cmp__` instead.

What I just described is the Python behaviour. In this case, if the parents are not equal, the coercion model is involved too and that by itself does a fallback in case of `NotImplemented`.

(*) NOTE: to be very precise, it actually does `type(A).__lt__(A, B)`, but that is equivalent to `A.__lt__(B)`, except that it does not look in `A.__dict__`.



---

archive/issue_comments_320751.json:
```json
{
    "body": "Thanks for explaining, I was not aware of that.\n\nReplying to [comment:57 jdemeyer]:\n> Replying to [comment:54 saraedum]:\n> When doing `A < B`, Python first calls `A.__lt__(B)` (*). If that returns a value different from `NotImplemented`, or if this raises an exception, this value or exception is the result of `A < B`. On the other hand, if `A.__lt__(B)` returns `NotImplemented`, then Python calls `B.__gt__(A)` (*). If that also returns `NotImplemented`, then Python 3 raises a `TypeError`. Python 2 falls back to `__cmp__` instead.\n\n\nDoes that not mean that we should favor\n\n```\nif type(self) != type(other): return NotImplemented\n\u2026\n```\nover\n\n```\nif isinstance(other, MyType): return NotImplemented\n\u2026\n```\nas the former means that a subclass can override `_richcmp_` with a more specific check and it will always get called? Whereas in the latter it depends on the order of arguments what happens?",
    "created_at": "2017-07-27T23:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320751",
    "user": "https://github.com/saraedum"
}
```

Thanks for explaining, I was not aware of that.

Replying to [comment:57 jdemeyer]:
> Replying to [comment:54 saraedum]:
> When doing `A < B`, Python first calls `A.__lt__(B)` (*). If that returns a value different from `NotImplemented`, or if this raises an exception, this value or exception is the result of `A < B`. On the other hand, if `A.__lt__(B)` returns `NotImplemented`, then Python calls `B.__gt__(A)` (*). If that also returns `NotImplemented`, then Python 3 raises a `TypeError`. Python 2 falls back to `__cmp__` instead.


Does that not mean that we should favor

```
if type(self) != type(other): return NotImplemented
…
```
over

```
if isinstance(other, MyType): return NotImplemented
…
```
as the former means that a subclass can override `_richcmp_` with a more specific check and it will always get called? Whereas in the latter it depends on the order of arguments what happens?



---

archive/issue_comments_320752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-27T23:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320753.json:
```json
{
    "body": "New commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[d5cd3c2](https://git.sagemath.org/sage.git/commit?id=d5cd3c20eca8834d72e43dc25518ab74c2efe6dc)|`Correctly raise NotImplemented in _richcmp_`|\n---\nNew commits:",
    "created_at": "2017-07-27T23:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320753",
    "user": "https://github.com/saraedum"
}
```

New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[d5cd3c2](https://git.sagemath.org/sage.git/commit?id=d5cd3c20eca8834d72e43dc25518ab74c2efe6dc)|`Correctly raise NotImplemented in _richcmp_`|
---
New commits:



---

archive/issue_comments_320754.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-27T23:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320754",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320755.json:
```json
{
    "body": "I've changed the hashes, since there could be multiple rings with the same fraction field.  I ran tests, so if you're happy with these changes, feel free to give a positive review.",
    "created_at": "2017-08-04T05:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320755",
    "user": "https://github.com/roed314"
}
```

I've changed the hashes, since there could be multiple rings with the same fraction field.  I ran tests, so if you're happy with these changes, feel free to give a positive review.



---

archive/issue_comments_320756.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-08T16:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320756",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_320757.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-11T18:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22948#issuecomment-320757",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059868.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-11T18:17:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22948",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22948#event-59868"
}
```
