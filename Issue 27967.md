# Issue 27967: Let p_group_cohomology cope with meataxe changes

Issue created by migration from https://trac.sagemath.org/ticket/28204

Original creator: SimonKing

Original creation time: 2019-07-16 00:11:09

Keywords: modular cohomology meataxe

In #28188, the default location of MeatAxe's multiplication tables changed. The old location is hardcoded in `p_group_cohomology`. Proposed change: The location should be imported from `sage.libs.meataxe`.


---

Comment by SimonKing created at 2019-07-16 08:52:23

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by SimonKing created at 2019-07-16 08:52:23

Changing type from PLEASE CHANGE to defect.


---

Comment by SimonKing created at 2019-07-16 19:29:33

I hate it. It will again be a lot of work to get the new version running fine. For example, although I didn't change the logger since the last working version, it is now foobar.


---

Comment by SimonKing created at 2019-07-16 19:55:17

Replying to [comment:3 SimonKing]:
> I hate it. It will again be a lot of work to get the new version running fine. For example, although I didn't change the logger since the last working version, it is now foobar.

Apparently without me wanting it, my editor added some indentation to the code. So, after all, I DID change the logger, but without being aware of it.


---

Comment by SimonKing created at 2019-07-19 21:04:17

Changing keywords from "modular cohomology meataxe" to "modular cohomology meataxe days100".


---

Comment by SimonKing created at 2019-07-20 14:38:25

Is there meanwhile the option to provide a package's uninstall script?


---

Comment by SimonKing created at 2019-07-20 15:04:59

I am currently struggling with an error in the test suite that I cannot explain. The test and expected output is this:

```
            sage: H173.is_isomorphic(H176)              # long time
            IsomorphismTest(H^*(SmallGroup(64,173); GF(2)), H^*(SmallGroup(64,176); GF(2))):
                      Trying to find an isomorphism
            ...
                      gen(4) is rigid: b_1_0 --> 1*b_1_0
            ...
                      gen(3) is rigid: a_1_1 --> 1*a_1_1
                      1 potential assignments for ['gen(4)', 'gen(3)']
                      4 potential assignments for ['gen(4)', 'gen(3)', 'gen(5)']
                      30 potential assignments for ['gen(4)', 'gen(3)', 'gen(5)', 'gen(6)']
                      Verify if we found an isomorphism
                      >>> Not a homomorphism
            ...
                      0 potential assignments for ['gen(4)', 'gen(3)', 'gen(5)', 'gen(6)', 'gen(1)', 'gen(2)']
                      No conclusion on the existence of an isomorphism.
            IsomorphismTest(H^*(SmallGroup(64,173); GF(2)), H^*(SmallGroup(64,176); GF(2))):
                      Trying to find an isomorphism
                      64 potential assignments for ['gen(4)', 'gen(3)', 'gen(5)', 'gen(6)']
                      600 potential assignments for ['gen(4)', 'gen(3)', 'gen(5)', 'gen(6)', 'gen(1)']
            ...
                      Verify if we found an isomorphism
                      >>> Not a homomorphism
            ...
                      Verify if we found an isomorphism
                      Isomorphism found!
            ('1*c_2_4',
             '1*b_1_2*b_3_6+1*c_4_9+1*c_2_4*b_1_0*b_1_2',
             '1*a_1_1',
             '1*b_1_0',
             '1*b_1_2',
             '1*b_3_6')
```

If I put it into a file `bla.py` and run `sage -t --force-lib bla.py`, the error is:

```
    ValueError in doctesting framework
**********************************************************************
Traceback (most recent call last):
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2487, in __call__
    doctests, extras = self._run(runner, options, results)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2532, in _run
    doctests, extras = self.source.create_doctests(sage_namespace)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 738, in create_doctests
    return self._create_doctests(namespace)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 299, in _create_doctests
    self._process_doc(doctests, doc, namespace, start)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 220, in _process_doc
    new_doctests = self.parse_docstring(docstring, namespace, start)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 879, in parse_docstring
    self.printpath, start + 1)]
  File "/home/king/Sage/git/sage/local/lib/python2.7/doctest.py", line 671, in get_doctest
    return DocTest(self.get_examples(string, name), globs,
  File "/home/king/Sage/git/sage/local/lib/python2.7/doctest.py", line 685, in get_examples
    return [x for x in self.parse(string, name)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 796, in parse
    res = doctest.DocTestParser.parse(self, string, *args)
  File "/home/king/Sage/git/sage/local/lib/python2.7/doctest.py", line 647, in parse
    self._parse_example(m, name, lineno)
  File "/home/king/Sage/git/sage/local/lib/python2.7/doctest.py", line 706, in _parse_example
    self._check_prefix(source_lines[1:], ' '*indent + '.', name, lineno)
  File "/home/king/Sage/git/sage/local/lib/python2.7/doctest.py", line 803, in _check_prefix
    (lineno+i+1, name, line))
ValueError: line 12 of the docstring for bla has inconsistent leading whitespace: u'...'
```

Why is that? Because of the `>>>` in the line before? But I have `>>>` in other tests, which do not exhibit such error.


---

Comment by SimonKing created at 2019-07-20 21:14:30

Replying to [comment:7 SimonKing]:
> Why is that? Because of the `>>>` in the line before? But I have `>>>` in other tests, which do not exhibit such error.

For the record: I decided to replace the `>>>` by `...` in the expected output, so that the doctest framework doesn't get confused.


---

Comment by SimonKing created at 2019-07-20 23:59:06

Just in time before beginning of the next workshop, I (hopefully) finished the next version of my cohomology spkg.

THe new features are in the ticket description. The test suite during installation passes (although I get warnings about long running tests; my impression is that the harddisk of my laptop is deteriorating).

Because of passing tests, it is "needs review"!
----
New commits:


---

Comment by SimonKing created at 2019-07-20 23:59:06

Changing status from new to needs_review.


---

Comment by SimonKing created at 2019-07-21 00:02:50

PS: There should also be work on Sage's implementation of Hilbert series, fixing some corner cases (see #28110). Because of a modified normalisation of rational functions in #28110, it might be possible that some of the cohomology tests will have a different but mathematically equivalent form.

But that shouldn't prevent people from using the new package version...


---

Comment by SimonKing created at 2019-07-21 06:49:07

PS: I didn't check yet whether the optional tests in the Sage source tree pass (there are some that test against regressions in the cohomology spkg).


---

Comment by SimonKing created at 2019-07-23 06:57:50

Question: It is probably not nice that the package is called `p_group_cohomology`, but it provides a module called `pGroupCohomology`. Should I change it? I.e., change `pGroupCohomology` into `p_group_cohomology`, but such that `from pGroupCohomology import ...` still works with a deprecation warning?


---

Comment by tscrim created at 2019-07-25 07:46:20

Replying to [comment:14 SimonKing]:
> Question: It is probably not nice that the package is called `p_group_cohomology`, but it provides a module called `pGroupCohomology`. Should I change it? I.e., change `pGroupCohomology` into `p_group_cohomology`, but such that `from pGroupCohomology import ...` still works with a deprecation warning?

That is up to you since it is your package. However, Python conventions say modules should be `p_group_cohomology`. I wouldn't bother with the deprecation warning unless you think someone out there is using your package not through Sage.


---

Comment by SimonKing created at 2019-07-25 07:58:38

Replying to [comment:15 tscrim]:
> Replying to [comment:14 SimonKing]:
> > Question: It is probably not nice that the package is called `p_group_cohomology`, but it provides a module called `pGroupCohomology`. Should I change it? I.e., change `pGroupCohomology` into `p_group_cohomology`, but such that `from pGroupCohomology import ...` still works with a deprecation warning?
> 
> That is up to you since it is your package. However, Python conventions say modules should be `p_group_cohomology`. I wouldn't bother with the deprecation warning unless you think someone out there is using your package not through Sage.

I don't think it is possible to use my package not through Sage.

I guess in the package's setup.py it is possible to change the module name into p_group_cohomology even if the source code directory still is !pGroupCohomology. However, how would I add the deprecation warning for `from pGroupCohomology import ...`?


---

Comment by tscrim created at 2019-07-25 08:11:39

Replying to [comment:16 SimonKing]:
> Replying to [comment:15 tscrim]:
> > Replying to [comment:14 SimonKing]:
> > > Question: It is probably not nice that the package is called `p_group_cohomology`, but it provides a module called `pGroupCohomology`. Should I change it? I.e., change `pGroupCohomology` into `p_group_cohomology`, but such that `from pGroupCohomology import ...` still works with a deprecation warning?
> > 
> > That is up to you since it is your package. However, Python conventions say modules should be `p_group_cohomology`. I wouldn't bother with the deprecation warning unless you think someone out there is using your package not through Sage.
> 
> I don't think it is possible to use my package not through Sage.
> 
> I guess in the package's setup.py it is possible to change the module name into p_group_cohomology even if the source code directory still is !pGroupCohomology. However, how would I add the deprecation warning for `from pGroupCohomology import ...`?

Again, I wouldn't bother, but you could use `lazy_import`, which has a deprecation parameter that you pass the ticket number.


---

Comment by SimonKing created at 2019-07-25 09:50:54

I think I will change `pGroupCohomology` to `p_group_cohomology` only in the next version of the package, unless a reviewer requests to do it now.


---

Comment by tscrim created at 2019-07-25 16:49:07

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-07-25 16:49:07

LGTM. Thanks.


---

Comment by vbraun created at 2019-07-29 21:54:51

Resolution: fixed
