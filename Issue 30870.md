# Issue 30870: using libgap for word problem in abelian group

Issue created by migration from https://trac.sagemath.org/ticket/31107

Original creator: chapoton

Original creation time: 2020-12-25 15:30:40

CC:  tscrim slelievre

instead of pexpect gap


---

Comment by chapoton created at 2020-12-25 15:31:46

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-12-25 15:31:46

New commits:


---

Comment by chapoton created at 2020-12-25 18:16:08

green bot, please review


---

Comment by git created at 2020-12-25 20:33:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2020-12-26 17:06:37

Beaucoup plus propre en effet!

Quelques retouches cosmétiques optionnelles:

```diff
     from sage.libs.gap.libgap import libgap
     A = libgap.AbelianGroup(g.parent().gens_orders())
     gens = libgap.GeneratorsOfGroup(A)
-
     gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])
-
     gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])
              for w in words]
     H = libgap.Group(gensH)
-
     x = libgap.Factorization(H, gap_g)
-
-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)
+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)
-    indices = resu[0::2]
-    powers = resu[1::2]
+    # Want ((index, power), (index), power), etc) with indices shifted by one
+    indpow = zip(((i - 1) for i in ipipip[0::2]), ipipip[1::2])
     if verbose:
-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)
-                     for indi, powi in zip(indices, powers))
+        v = '*'.join('(%s)^%s' % (words[indi], powi) for indi, powi in indpow)
         print('%s = %s' % (g, v))
-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]
+    return [[words[indi], powi] for indi, powi in indpow]
```


ou même pour la fin:


```diff
-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)
+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)
-    indices = resu[0::2]
-    powers = resu[1::2]
+    # Want ((word, power), (word, power), etc)
+    wordpow = zip(words[i - 1] for i in ipipip[0::2]), ipipip[1::2])
     if verbose:
-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)
-                     for indi, powi in zip(indices, powers))
+        v = '*'.join(f"{wordi}^{powi}}" for wordi, powi in wordpow)
         print(f"{g} = {v}")
-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]
+    return [[wordi, powi] for wordi, powi in wordpow]
```


auquel cas la dernière ligne pourrait aussi être:


```diff
+    return [list(wp) for wp in wordpow]
```


Pour le début on pourrait aussi proposer:


```diff
-    gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])
-    gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])
-             for w in words]
+    gili = lambda h: libgap.Product([gi**Li for gi, Li in zip(gens, h.list())])
+    gap_g = gili(g)
+    gensH = [gili(w) for w in words]
```


Revue favorable de ma part avec ou sans ces modifications.


---

Comment by chapoton created at 2020-12-27 08:56:35

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-12-27 08:56:35

ok, suggestions valables, mais j'ai pas trop envie de passer plus de temps sur ca.

donc je passe en "positif" dans l'etat actuel


---

Comment by vbraun created at 2021-01-03 12:15:29

Resolution: fixed
