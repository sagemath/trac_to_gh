# Issue 10299: Test some command line options

archive/issues_010299.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  aapitzsch\n\nKeywords: command line tests\n\nThere should be a new test, say `sage/tests/cmdline.py` which tests that some command line options to `./sage` actually work.  In particular `./sage -startuptime` should be tested to prevent #10293 from happening again.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10300\n\n",
    "created_at": "2010-11-20T21:19:36Z",
    "labels": [
        "doctest coverage",
        "major",
        "enhancement"
    ],
    "title": "Test some command line options",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10299",
    "user": "jdemeyer"
}
```
Assignee: mvngu

CC:  aapitzsch

Keywords: command line tests

There should be a new test, say `sage/tests/cmdline.py` which tests that some command line options to `./sage` actually work.  In particular `./sage -startuptime` should be tested to prevent #10293 from happening again.

Issue created by migration from https://trac.sagemath.org/ticket/10300





---

archive/issue_comments_105428.json:
```json
{
    "body": "Attachment [10300_cmdline_test.2.patch](tarball://root/attachments/some-uuid/ticket10300/10300_cmdline_test.2.patch) by jdemeyer created at 2010-11-21 13:11:26",
    "created_at": "2010-11-21T13:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105428",
    "user": "jdemeyer"
}
```

Attachment [10300_cmdline_test.2.patch](tarball://root/attachments/some-uuid/ticket10300/10300_cmdline_test.2.patch) by jdemeyer created at 2010-11-21 13:11:26



---

archive/issue_comments_105429.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-11-21T13:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105429",
    "user": "jdemeyer"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_105430.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-21T13:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105430",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_105431.json:
```json
{
    "body": "Two tests failed with 4.6.1 alpha3. Are there other dependencies except for #10302 and #10306?\n\n```\nFile \"/scratch/sage-4.6.1a3/devel/sage-20101123/sage/tests/cmdline.py\", line 177:\n    sage: err\nExpected:\n    'Hello World\\n'\nGot:\n    ''\n**********************************************************************\nFile \"/scratch/sage-4.6.1a3/devel/sage-20101123/sage/tests/cmdline.py\", line 183:\n    sage: err\nExpected:\n    'Hello World\\n'\nGot:\n    ''\n```\n",
    "created_at": "2010-11-23T09:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105431",
    "user": "aapitzsch"
}
```

Two tests failed with 4.6.1 alpha3. Are there other dependencies except for #10302 and #10306?

```
File "/scratch/sage-4.6.1a3/devel/sage-20101123/sage/tests/cmdline.py", line 177:
    sage: err
Expected:
    'Hello World\n'
Got:
    ''
**********************************************************************
File "/scratch/sage-4.6.1a3/devel/sage-20101123/sage/tests/cmdline.py", line 183:
    sage: err
Expected:
    'Hello World\n'
Got:
    ''
```




---

archive/issue_comments_105432.json:
```json
{
    "body": "No, it should work. Which system is that?\n\nPlease do the following in a shell and post the output:\n\n```\nsage -sh -c 'echo $0; echo $BASH'\n```\n\n\n\n```\nsage -sh -c \"echo >&2 Hello World\"\n```\n\n\n\n```\nsage -sh -c \"echo >&2 Hello World\" >/dev/null\n```\n\n\n\n```\nsage -sh -c \"echo >&2 Hello World\" 2>/dev/null\n```\n\n\n\n```\nbash -c \"echo >&2 Hello World\"\n```\n\n\n\n```\nbash -c \"echo >&2 Hello World\" >/dev/null\n```\n\n\n\n```\nbash -c \"echo >&2 Hello World\" 2>/dev/null\n```\n",
    "created_at": "2010-11-23T09:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105432",
    "user": "jdemeyer"
}
```

No, it should work. Which system is that?

Please do the following in a shell and post the output:

```
sage -sh -c 'echo $0; echo $BASH'
```



```
sage -sh -c "echo >&2 Hello World"
```



```
sage -sh -c "echo >&2 Hello World" >/dev/null
```



```
sage -sh -c "echo >&2 Hello World" 2>/dev/null
```



```
bash -c "echo >&2 Hello World"
```



```
bash -c "echo >&2 Hello World" >/dev/null
```



```
bash -c "echo >&2 Hello World" 2>/dev/null
```




---

archive/issue_comments_105433.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2010-11-23T09:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105433",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_105434.json:
```json
{
    "body": "Fedora 12 (64bit)\nkernel 2.6.32.23-170.fc12.x86_64\n\n```\n$ ./sage -sh -c 'echo $0; echo $BASH'\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\ntcsh\nBASH: Undefined variable.\nExited Sage subshell.\n```\n\n\n```\n$ ./sage -sh -c \"echo >&2 Hello World\"\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nExited Sage subshell.\n```\n\n\n```\n$ ./sage -sh -c \"echo >&2 Hello World\" > /dev/null\n```\n\n(no output)\n\n```\n$ ./sage -sh -c \"echo >&2 Hello World\" 2>/dev/null\n```\n\n(no output)\n\n```\n$ bash -c \"echo >&2 Hello World\"\nHello World\n```\n\n\n```\n$ bash -c \"echo >&2 Hello World\" >/dev/null\nHello World\n```\n\n\n```\n$ bash -c \"echo >&2 Hello World\" 2>/dev/null\nHello World\n```\n",
    "created_at": "2010-11-23T09:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105434",
    "user": "aapitzsch"
}
```

Fedora 12 (64bit)
kernel 2.6.32.23-170.fc12.x86_64

```
$ ./sage -sh -c 'echo $0; echo $BASH'

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

tcsh
BASH: Undefined variable.
Exited Sage subshell.
```


```
$ ./sage -sh -c "echo >&2 Hello World"

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

Exited Sage subshell.
```


```
$ ./sage -sh -c "echo >&2 Hello World" > /dev/null
```

(no output)

```
$ ./sage -sh -c "echo >&2 Hello World" 2>/dev/null
```

(no output)

```
$ bash -c "echo >&2 Hello World"
Hello World
```


```
$ bash -c "echo >&2 Hello World" >/dev/null
Hello World
```


```
$ bash -c "echo >&2 Hello World" 2>/dev/null
Hello World
```




---

archive/issue_comments_105435.json:
```json
{
    "body": "Well, I don't know what to make of that output.  You're using a different shell (`tcsh`) but still...",
    "created_at": "2010-11-24T08:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105435",
    "user": "jdemeyer"
}
```

Well, I don't know what to make of that output.  You're using a different shell (`tcsh`) but still...



---

archive/issue_comments_105436.json:
```json
{
    "body": "Output redirection in tcsh has different syntax. `echo >&2 Hello World` will redirect both stdout and stderr to a file named 2.",
    "created_at": "2010-11-24T09:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105436",
    "user": "wjp"
}
```

Output redirection in tcsh has different syntax. `echo >&2 Hello World` will redirect both stdout and stderr to a file named 2.



---

archive/issue_comments_105437.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2010-11-24T09:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105437",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_105438.json:
```json
{
    "body": "Replying to [comment:9 wjp]:\n> Output redirection in tcsh has different syntax. `echo >&2 Hello World` will redirect both stdout and stderr to a file named 2.\n\nReally?  That's annoying.  I will rewrite the test without any redirections, the test in meant to test whether `sage -sh` actually does something.",
    "created_at": "2010-11-24T09:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105438",
    "user": "jdemeyer"
}
```

Replying to [comment:9 wjp]:
> Output redirection in tcsh has different syntax. `echo >&2 Hello World` will redirect both stdout and stderr to a file named 2.

Really?  That's annoying.  I will rewrite the test without any redirections, the test in meant to test whether `sage -sh` actually does something.



---

archive/issue_comments_105439.json:
```json
{
    "body": "I've not got chance to look at this now, but here are a few comments. \n\nThe csh is considered to be a pretty poor shell - see for example this article about it.\n\nhttp://www.ooblick.com/text/CshProgrammingConsideredHarmful.html\n\ntcsh is based on csh.\n\nThe first 150 or so lines of that article covers the issues of output redirection, which is the issue here. \n\nThe newsgroup {{{comp.unix.shell}} or the *autoconf* mailing list are good sources of information. \n\nAlso \n\nhttp://www.gnu.org/software/hello/manual/autoconf/Limitations-of-Builtins.html\n\nis worth a look. \n\nAlthough this particular test may be re-written without any redirections, the probability of something similar breaking elsewhere mush be high. \n\nI guess we should create an account using /bin/tcsh as the shell and test the whole of Sage. \n\nDave",
    "created_at": "2010-11-24T11:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105439",
    "user": "drkirkby"
}
```

I've not got chance to look at this now, but here are a few comments. 

The csh is considered to be a pretty poor shell - see for example this article about it.

http://www.ooblick.com/text/CshProgrammingConsideredHarmful.html

tcsh is based on csh.

The first 150 or so lines of that article covers the issues of output redirection, which is the issue here. 

The newsgroup {{{comp.unix.shell}} or the *autoconf* mailing list are good sources of information. 

Also 

http://www.gnu.org/software/hello/manual/autoconf/Limitations-of-Builtins.html

is worth a look. 

Although this particular test may be re-written without any redirections, the probability of something similar breaking elsewhere mush be high. 

I guess we should create an account using /bin/tcsh as the shell and test the whole of Sage. 

Dave



---

archive/issue_comments_105440.json:
```json
{
    "body": "Replying to [comment:11 drkirkby]:\n> I guess we should create an account using /bin/tcsh as the shell and test the whole of Sage. \n\nI've just installed `tcsh}} on sage.math and I'm doing a build now with the environment variable {{{SHELL` set to `/usr/bin/tcsh`.\n\nLet's see what happens...",
    "created_at": "2010-11-24T13:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105440",
    "user": "jdemeyer"
}
```

Replying to [comment:11 drkirkby]:
> I guess we should create an account using /bin/tcsh as the shell and test the whole of Sage. 

I've just installed `tcsh}} on sage.math and I'm doing a build now with the environment variable {{{SHELL` set to `/usr/bin/tcsh`.

Let's see what happens...



---

archive/issue_comments_105441.json:
```json
{
    "body": "This is not a big deal, but I would suggest changing the tests from `-advanced` to `--advanced`, etc.: use double hyphens for the long command-line options.  Every now and then there is discussion of forcing this sort of behavior, for example at #21, and it wouldn't hurt to be ready for it.",
    "created_at": "2010-11-24T15:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105441",
    "user": "jhpalmieri"
}
```

This is not a big deal, but I would suggest changing the tests from `-advanced` to `--advanced`, etc.: use double hyphens for the long command-line options.  Every now and then there is discussion of forcing this sort of behavior, for example at #21, and it wouldn't hurt to be ready for it.



---

archive/issue_comments_105442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-24T18:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105442",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_105443.json:
```json
{
    "body": "I created a new account (csh), and set the shell to `/bin/csh`, then built 4.6.1.alpha2 on OpenSolaris 06/2009. \n\nAll tests passed, with the exception of \n\n\n```\n\tsage -t  -long -force_lib devel/sage/sage/homology/examples.py # Time out\n```\n\n\nwhich is due to the fact the tests assumes the experimental homology package is installed, so is a bug in the test suite, rather than a test failure. \n\nI've not tried the `tcsh` shell yet (I need to install that first). \n\nI'll try this patch later. I'm going to look at John's SAGE64 patch first.",
    "created_at": "2010-11-24T20:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105443",
    "user": "drkirkby"
}
```

I created a new account (csh), and set the shell to `/bin/csh`, then built 4.6.1.alpha2 on OpenSolaris 06/2009. 

All tests passed, with the exception of 


```
	sage -t  -long -force_lib devel/sage/sage/homology/examples.py # Time out
```


which is due to the fact the tests assumes the experimental homology package is installed, so is a bug in the test suite, rather than a test failure. 

I've not tried the `tcsh` shell yet (I need to install that first). 

I'll try this patch later. I'm going to look at John's SAGE64 patch first.



---

archive/issue_comments_105444.json:
```json
{
    "body": "Build and test with `tcsh` on sage.math was 100% successful.",
    "created_at": "2010-11-24T20:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105444",
    "user": "jdemeyer"
}
```

Build and test with `tcsh` on sage.math was 100% successful.



---

archive/issue_comments_105445.json:
```json
{
    "body": "Attachment [10300_cmdline_test.patch](tarball://root/attachments/some-uuid/ticket10300/10300_cmdline_test.patch) by aapitzsch created at 2010-11-25 09:17:36\n\nCouldn't test optional kash but everything else passed.\n\nCode looks good except for a few redundant whitespaces.",
    "created_at": "2010-11-25T09:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105445",
    "user": "aapitzsch"
}
```

Attachment [10300_cmdline_test.patch](tarball://root/attachments/some-uuid/ticket10300/10300_cmdline_test.patch) by aapitzsch created at 2010-11-25 09:17:36

Couldn't test optional kash but everything else passed.

Code looks good except for a few redundant whitespaces.



---

archive/issue_comments_105446.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-25T09:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105446",
    "user": "aapitzsch"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_105447.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-11-25T21:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105447",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_105448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-25T21:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105448",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_105449.json:
```json
{
    "body": "The following IPython message when it's run for the first time messes up the IPython test:\n\n```\n**********************************************************************\nWelcome to IPython. I will try to create a personal configuration directory\nwhere you can customize many aspects of IPython's functionality in:\n\n/space/jdemeyer/home/.ipython\nInitializing from configuration /mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.alpha3/local/lib/python2.6/site-packages/IPython/UserConfig\n\nSuccessful installation!\n\nPlease read the sections 'Initial Configuration' and 'Quick Tips' in the\nIPython manual (there are both HTML and PDF versions supplied with the\ndistribution) to make sure that your system environment is properly configured\nto take advantage of IPython's features.\n\nImportant note: the configuration system has changed! The old system is\nstill in place, but its setting may be partly overridden by the settings in\n\"~/.ipython/ipy_user_conf.py\" config file. Please take a look at the file\nif some of the new settings bother you.\n\n\nPlease press <RETURN> to start IPython.\n```\n\n\nThe initial `\\n` as input should fix this, see the new patch.",
    "created_at": "2010-11-25T21:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105449",
    "user": "jdemeyer"
}
```

The following IPython message when it's run for the first time messes up the IPython test:

```
**********************************************************************
Welcome to IPython. I will try to create a personal configuration directory
where you can customize many aspects of IPython's functionality in:

/space/jdemeyer/home/.ipython
Initializing from configuration /mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.alpha3/local/lib/python2.6/site-packages/IPython/UserConfig

Successful installation!

Please read the sections 'Initial Configuration' and 'Quick Tips' in the
IPython manual (there are both HTML and PDF versions supplied with the
distribution) to make sure that your system environment is properly configured
to take advantage of IPython's features.

Important note: the configuration system has changed! The old system is
still in place, but its setting may be partly overridden by the settings in
"~/.ipython/ipy_user_conf.py" config file. Please take a look at the file
if some of the new settings bother you.


Please press <RETURN> to start IPython.
```


The initial `\n` as input should fix this, see the new patch.



---

archive/issue_comments_105450.json:
```json
{
    "body": "Apply on top of previous patch",
    "created_at": "2010-11-25T21:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105450",
    "user": "jdemeyer"
}
```

Apply on top of previous patch



---

archive/issue_comments_105451.json:
```json
{
    "body": "Attachment [10300_ipython_fix.patch](tarball://root/attachments/some-uuid/ticket10300/10300_ipython_fix.patch) by aapitzsch created at 2010-11-26 09:12:13",
    "created_at": "2010-11-26T09:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105451",
    "user": "aapitzsch"
}
```

Attachment [10300_ipython_fix.patch](tarball://root/attachments/some-uuid/ticket10300/10300_ipython_fix.patch) by aapitzsch created at 2010-11-26 09:12:13



---

archive/issue_comments_105452.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-26T09:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105452",
    "user": "aapitzsch"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_105453.json:
```json
{
    "body": "See #10326 for a follow-up ticket (cleaning up `sage-sage`)",
    "created_at": "2010-11-28T13:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105453",
    "user": "jdemeyer"
}
```

See #10326 for a follow-up ticket (cleaning up `sage-sage`)



---

archive/issue_comments_105454.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-12-02T16:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10299#issuecomment-105454",
    "user": "jdemeyer"
}
```

Resolution: fixed
