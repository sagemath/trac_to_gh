# Issue 18041: Variable to non-integral power for integer polynomials (using Flint) is broken

archive/issues_018041.json:
```json
{
    "body": "Keywords: integer polynomials, exponentiation\n\nCurrently:\n\n\n```\nsage: R.<x> = ZZ[]\nsage: x^(1/2)\n1\n```\n\n\nI correct to\n\n```\nsage: R.<x> = ZZ[]\nsage: x^(1/2)\nTraceback (most recent call last):\n...\nTypeError: non-integral exponents not supported\n```\n\n\nthat is consistent with the results in other polynomial rings.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18278\n\n",
    "created_at": "2015-04-22T13:30:23Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Variable to non-integral power for integer polynomials (using Flint) is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18041",
    "user": "bruno"
}
```
Keywords: integer polynomials, exponentiation

Currently:


```
sage: R.<x> = ZZ[]
sage: x^(1/2)
1
```


I correct to

```
sage: R.<x> = ZZ[]
sage: x^(1/2)
Traceback (most recent call last):
...
TypeError: non-integral exponents not supported
```


that is consistent with the results in other polynomial rings.

Issue created by migration from https://trac.sagemath.org/ticket/18278





---

archive/issue_comments_242861.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-22T13:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242861",
    "user": "bruno"
}
```

New commits:



---

archive/issue_comments_242862.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-22T13:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242862",
    "user": "bruno"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_242863.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-03T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242863",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_242864.json:
```json
{
    "body": "Salut Bruno,\n\n1. You introduced trailing whitespaces, please remove them.\n\n2. Why would you want to do that\n\n```\ntry:\n    nn = PyNumber_AsSsize_t (exp, OverflowError)\nexcept TypeError:\n   raise TypeError(\"non-integral exponents not supported\")\n```\n\n  the problem comes from the fact that you can cast rationals to Python int\n\n```\nsage: int(2/3)\n0\n```\n\n  I would very much prefer\n\n```\ncdef long u = exp\nif exp != u:\n    raise TypeError(\"...\")\n```\n\n\nVincent",
    "created_at": "2015-05-03T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242864",
    "user": "vdelecroix"
}
```

Salut Bruno,

1. You introduced trailing whitespaces, please remove them.

2. Why would you want to do that

```
try:
    nn = PyNumber_AsSsize_t (exp, OverflowError)
except TypeError:
   raise TypeError("non-integral exponents not supported")
```

  the problem comes from the fact that you can cast rationals to Python int

```
sage: int(2/3)
0
```

  I would very much prefer

```
cdef long u = exp
if exp != u:
    raise TypeError("...")
```


Vincent



---

archive/issue_comments_242865.json:
```json
{
    "body": "Actually, the proper solution is here\n\n    https://groups.google.com/forum/#!topic/sage-support/0ATjCgQlq4c",
    "created_at": "2015-05-03T20:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242865",
    "user": "vdelecroix"
}
```

Actually, the proper solution is here

    https://groups.google.com/forum/#!topic/sage-support/0ATjCgQlq4c



---

archive/issue_comments_242866.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-04T09:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242866",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242867.json:
```json
{
    "body": "Salut Vincent,\n\nI made the changes you propose. For the use of `PyNumber_AsSsize_t`, I actually borrowed this code from `sage/rings/polynomial/polynomial_rational_flint.pyx`. Should I use this ticket to change the test in this file too?",
    "created_at": "2015-05-04T09:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242867",
    "user": "bruno"
}
```

Salut Vincent,

I made the changes you propose. For the use of `PyNumber_AsSsize_t`, I actually borrowed this code from `sage/rings/polynomial/polynomial_rational_flint.pyx`. Should I use this ticket to change the test in this file too?



---

archive/issue_comments_242868.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-04T09:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242868",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_242869.json:
```json
{
    "body": "Do you really need this?\n\n```\nexcept TypeError:\n    raise TypeError(\"non-integral exponents not supported\")\n```\n\n\nI have a general dislike for code of the form\n\n```\nexcept E:\n    raise E(...)\n```\n",
    "created_at": "2015-05-04T09:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242869",
    "user": "jdemeyer"
}
```

Do you really need this?

```
except TypeError:
    raise TypeError("non-integral exponents not supported")
```


I have a general dislike for code of the form

```
except E:
    raise E(...)
```




---

archive/issue_comments_242870.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Do you really need this?\n\nIt is not needed indeed, it simply gives a more specific error message. But it may not be worth adding these lines.",
    "created_at": "2015-05-04T09:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242870",
    "user": "bruno"
}
```

Replying to [comment:7 jdemeyer]:
> Do you really need this?

It is not needed indeed, it simply gives a more specific error message. But it may not be worth adding these lines.



---

archive/issue_comments_242871.json:
```json
{
    "body": "Replying to [comment:8 bruno]:\n> Replying to [comment:7 jdemeyer]:\n> > Do you really need this?\n> \n> It is not needed indeed, it simply gives a more specific error message\n...I would say a *less specific* error message, since you throw away all information which is contained in the original `TypeError`.",
    "created_at": "2015-05-04T10:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242871",
    "user": "jdemeyer"
}
```

Replying to [comment:8 bruno]:
> Replying to [comment:7 jdemeyer]:
> > Do you really need this?
> 
> It is not needed indeed, it simply gives a more specific error message
...I would say a *less specific* error message, since you throw away all information which is contained in the original `TypeError`.



---

archive/issue_comments_242872.json:
```json
{
    "body": "My guess is that the code using `PyNumber_Index()` is slightly faster than `PyNumber_AsSsize_t()`. Also, `PyNumber_Index()` is more general, since you don't need the result to be a `Py_ssize_t`. But really, the difference between these 2 functions is very small.",
    "created_at": "2015-05-04T10:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242872",
    "user": "jdemeyer"
}
```

My guess is that the code using `PyNumber_Index()` is slightly faster than `PyNumber_AsSsize_t()`. Also, `PyNumber_Index()` is more general, since you don't need the result to be a `Py_ssize_t`. But really, the difference between these 2 functions is very small.



---

archive/issue_comments_242873.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-04T10:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242873",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242874.json:
```json
{
    "body": "Don't forget to update doctests.",
    "created_at": "2015-05-04T10:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242874",
    "user": "jdemeyer"
}
```

Don't forget to update doctests.



---

archive/issue_comments_242875.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-04T10:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242875",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_242876.json:
```json
{
    "body": "I would also like to see a doctest for exponent overflow:\n\n```\nsage: x^(2^100)\n```\n",
    "created_at": "2015-05-04T10:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242876",
    "user": "jdemeyer"
}
```

I would also like to see a doctest for exponent overflow:

```
sage: x^(2^100)
```




---

archive/issue_comments_242877.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-04T11:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242877",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_242878.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-04T11:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242878",
    "user": "bruno"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_242879.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-04T12:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242879",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_242880.json:
```json
{
    "body": "Thanks Vincent and Jeroen for your help!",
    "created_at": "2015-05-04T12:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242880",
    "user": "bruno"
}
```

Thanks Vincent and Jeroen for your help!



---

archive/issue_comments_242881.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-05T00:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18041#issuecomment-242881",
    "user": "vbraun"
}
```

Resolution: fixed
