# Issue 18041: Variable to non-integral power for integer polynomials (using Flint) is broken

Issue created by migration from Trac.

Original creator: bruno

Original creation time: 2015-04-22 13:30:23

Keywords: integer polynomials, exponentiation

Currently:


```
sage: R.<x> = ZZ[]
sage: x^(1/2)
1
```


I correct to

```
sage: R.<x> = ZZ[]
sage: x^(1/2)
Traceback (most recent call last):
...
TypeError: non-integral exponents not supported
```


that is consistent with the results in other polynomial rings.


---

Comment by bruno created at 2015-04-22 13:32:22

New commits:


---

Comment by bruno created at 2015-04-22 13:32:22

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-05-03 20:20:52

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-05-03 20:20:52

Salut Bruno,

1. You introduced trailing whitespaces, please remove them.

2. Why would you want to do that

```
try:
    nn = PyNumber_AsSsize_t (exp, OverflowError)
except TypeError:
   raise TypeError("non-integral exponents not supported")
```

  the problem comes from the fact that you can cast rationals to Python int

```
sage: int(2/3)
0
```

  I would very much prefer

```
cdef long u = exp
if exp != u:
    raise TypeError("...")
```


Vincent


---

Comment by vdelecroix created at 2015-05-03 20:54:56

Actually, the proper solution is here

    https://groups.google.com/forum/#!topic/sage-support/0ATjCgQlq4c


---

Comment by git created at 2015-05-04 09:48:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-05-04 09:51:10

Salut Vincent,

I made the changes you propose. For the use of `PyNumber_AsSsize_t`, I actually borrowed this code from `sage/rings/polynomial/polynomial_rational_flint.pyx`. Should I use this ticket to change the test in this file too?


---

Comment by bruno created at 2015-05-04 09:51:10

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-05-04 09:53:00

Do you really need this?

```
except TypeError:
    raise TypeError("non-integral exponents not supported")
```


I have a general dislike for code of the form

```
except E:
    raise E(...)
```



---

Comment by bruno created at 2015-05-04 09:57:44

Replying to [comment:7 jdemeyer]:
> Do you really need this?

It is not needed indeed, it simply gives a more specific error message. But it may not be worth adding these lines.


---

Comment by jdemeyer created at 2015-05-04 10:00:36

Replying to [comment:8 bruno]:
> Replying to [comment:7 jdemeyer]:
> > Do you really need this?
> 
> It is not needed indeed, it simply gives a more specific error message
...I would say a _less specific_ error message, since you throw away all information which is contained in the original `TypeError`.


---

Comment by jdemeyer created at 2015-05-04 10:05:04

My guess is that the code using `PyNumber_Index()` is slightly faster than `PyNumber_AsSsize_t()`. Also, `PyNumber_Index()` is more general, since you don't need the result to be a `Py_ssize_t`. But really, the difference between these 2 functions is very small.


---

Comment by git created at 2015-05-04 10:07:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-05-04 10:12:44

Don't forget to update doctests.


---

Comment by jdemeyer created at 2015-05-04 10:12:44

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-05-04 10:14:06

I would also like to see a doctest for exponent overflow:

```
sage: x^(2^100)
```



---

Comment by git created at 2015-05-04 11:42:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-05-04 11:43:58

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-05-04 12:20:10

Changing status from needs_review to positive_review.


---

Comment by bruno created at 2015-05-04 12:32:48

Thanks Vincent and Jeroen for your help!


---

Comment by vbraun created at 2015-05-05 00:32:30

Resolution: fixed
