# Issue 21369: LatticePoset: Add Alan Day's doubling construction

Issue created by migration from https://trac.sagemath.org/ticket/21606

Original creator: jmantysalo

Original creation time: 2016-09-28 07:58:35

CC:  tscrim chapoton â€‹nthiery

This patch add Alan Day's doubling construction to finite lattices.

Also this contains a picture.


---

Comment by jmantysalo created at 2016-09-28 08:05:21

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2016-09-28 08:05:21

Nicolas: This is an answer to your comment "YES!" on thread https://groups.google.com/forum/#!topic/sage-devel/3YKltRTZ4vM

This code should be reviewed. But what's more important, is this kind of picture a good idea at all? I think that Nicolas was only one to comment my question about one year ago.

And if this is theoretically good idea, how about this picture? I do not have eyes for graphical things. A good example, or bad? If good, a good visualization or not?
----
New commits:


---

Comment by chapoton created at 2016-09-29 19:48:51

may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)


---

Comment by jmantysalo created at 2016-09-30 03:17:29

Replying to [comment:3 chapoton]:
> may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)

What to do with non-doubled elements? Think about `LatticePoset({1:[(1,1)], (1,1): [(1,1,1)]})` or something similar.


---

Comment by chapoton created at 2016-09-30 15:36:40

I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..


---

Comment by jmantysalo created at 2016-09-30 16:10:17

Replying to [comment:5 chapoton]:
> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..

Ah, OK. Can be done.

What about the picture?


---

Comment by jmantysalo created at 2016-10-15 04:35:10

Ping. Any comments about the picture?

If I got none, I'll remove it and just add for code review.


---

Comment by mantepse created at 2016-10-17 19:05:45

Changing status from needs_review to positive_review.


---

Comment by mantepse created at 2016-10-17 19:05:45

I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  Perhaps adding 

```
sage: L = LatticePoset({0:["a"], "a":["b","c"], "b":[1], "c":[1]})
sage: L.day_doubling(["a", "b", "c"])
Finite lattice containing 8 elements
```

is helpful.  Maybe you also want

```
The subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.
```



In any case, I tried it on a few examples and I like it.


---

Comment by jmantysalo created at 2016-10-17 19:32:22

Changing status from positive_review to needs_work.


---

Comment by jmantysalo created at 2016-10-17 19:32:22

Back to needs_work because of this:

Replying to [comment:5 chapoton]:
> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..

and for your comments. Big thanks for checking the picture!


---

Comment by jmantysalo created at 2016-10-18 09:00:32

Replying to [comment:5 chapoton]:

> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled.

At least this made the code shorter. Hopefully I did not introduce bugs, please check.

Replying to [comment:8 mantepse]:

> I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  

Yep, automatically made plots are about never as good as hand-made, and Sage is not even a good at drawing. But still I think that the picture made by me is ugly. Hopefully some day someone with better color eye will change it.

Perhaps adding 
> {{{
> sage: L = LatticePoset({0:["a"], "a":["b","c"], "b":[1], "c":[1]})
> sage: L.day_doubling(["a", "b", "c"])
> Finite lattice containing 8 elements
> }}}
> is helpful.

I think that it should be easy to write by the user, there is already one example.

> Maybe you also want
> {{{
> The subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.
> }}}

Hasse diagram is kind of internal documentation, so I just spelled out in the main text what convex and connected means.


---

Comment by jmantysalo created at 2016-10-18 09:00:44

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-10-18 09:04:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-10-19 10:52:33

Looks good to me.  If you want to, you may replace

```
Resulting lattice `L[S]` has elements 
```

with

```
The resulting lattice `L[S]` has elements
```

I'm still compiling (wrong computer)


---

Comment by git created at 2016-10-19 10:55:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2016-10-19 14:23:38

Looks good!


---

Comment by mantepse created at 2016-10-19 14:23:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-10-21 06:54:06

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-10-21 06:54:06

Output order of these tests is not deterministic:

```
1994sage -t --long src/sage/combinat/posets/lattices.py
1995**********************************************************************
1996File "src/sage/combinat/posets/lattices.py", line 2450, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
1997Failed example:
1998    L2.upper_covers((1, 0))
1999Expected:
2000    [(2, 0), ('a', 0), ('b', 0)]
2001Got:
2002    [(2, 0), ('b', 0), ('a', 0)]
2003**********************************************************************
2004File "src/sage/combinat/posets/lattices.py", line 2452, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
2005Failed example:
2006    L2.upper_covers(('b', 0))
2007Expected:
2008    [('d', 0), ('b', 1), ('c', 0)]
2009Got:
2010    [('c', 0), ('b', 1), ('d', 0)]
2011**********************************************************************
20121 item had failures:
2013   2 of   9 in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
2014    [394 tests, 2 failures, 2.42 s]
```



---

Comment by git created at 2016-10-21 11:07:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-10-21 14:09:10

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-10-21 14:09:10

For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.


---

Comment by jmantysalo created at 2016-10-21 14:13:33

Replying to [comment:18 tscrim]:
> For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.

How? Python3 forbids `'a' < 1` and `sorted(['a', 1])`.


---

Comment by tscrim created at 2016-10-21 14:17:32

`sorted(['a',1], key=str)` works.


---

Comment by vbraun created at 2016-10-29 14:26:43

Resolution: fixed
