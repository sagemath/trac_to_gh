# Issue 18386: Allow calling variadic PARI closures

Issue created by migration from https://trac.sagemath.org/ticket/18623

Original creator: pbruin

Original creation time: 2015-06-06 10:38:17

CC:  jdemeyer

Keywords: pari closure

Calling a PARI closure with variadic arguments is not possible:

```
sage: f = pari("(v[..])->length(v)")  # returns the number of its arguments
sage: f()
Traceback (most recent call last):
...
TypeError: PARI closure takes at most -9223372036854775807 arguments (0 given)
```

This is because variadic PARI closures are not recognised by Sage and have a somewhat different calling convention.


---

Comment by pbruin created at 2015-06-08 08:20:56

Changing status from new to needs_review.


---

Comment by git created at 2015-06-08 09:34:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-08 11:27:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-08 22:12:14

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-06-08 22:12:14


```
sage -t --long src/sage/libs/pari/closure.pyx
**********************************************************************
File "src/sage/libs/pari/closure.pyx", line 158, in sage.libs.pari.closure.objtoclosure
Failed example:
    mul(*range(100))
Expected:
    Traceback (most recent call last):
    ...
    TypeError: PARI closure takes at most 5 arguments (100 given)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.pari.closure.objtoclosure[9]>", line 1, in <module>
        mul(*range(Integer(100)))
      File "sage/libs/pari/gen.pyx", line 7956, in sage.libs.pari.gen.gen.__call__ (build/cythonized/sage/libs/pari/gen.c:130162)
        return self.eval(*args, **kwds)
      File "sage/libs/pari/gen.pyx", line 7864, in sage.libs.pari.gen.gen.eval (build/cythonized/sage/libs/pari/gen.c:129597)
        pari_catch_sig_on()
      File "sage/libs/pari/handle_error.pyx", line 177, in sage.libs.pari.handle_error._pari_err_handle (build/cythonized/sage/libs/pari/handle_error.c:2823)
        raise PariError(errnum, pari_error_string, pari_instance.new_gen_noclear(E))
    PariError: call_python: too many parameters in user-defined function call
**********************************************************************
1 item had failures:
   1 of  12 in sage.libs.pari.closure.objtoclosure
```



---

Comment by git created at 2015-06-08 22:17:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2015-06-08 22:18:52

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-06-11 13:51:02

Resolution: fixed
