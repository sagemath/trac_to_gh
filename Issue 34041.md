# Issue 34041: RealSet: Add option cache=False

archive/issues_034041.json:
```json
{
    "body": "CC:  yzh tscrim\n\nWhen receiving `cache=False`, this would use an implementation class that does not inherit from `UniqueRepresentation` to avoid persistence in memory.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34278\n\n",
    "created_at": "2022-08-04T18:56:00Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "title": "RealSet: Add option cache=False",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34041",
    "user": "mkoeppe"
}
```
CC:  yzh tscrim

When receiving `cache=False`, this would use an implementation class that does not inherit from `UniqueRepresentation` to avoid persistence in memory.


Issue created by migration from https://trac.sagemath.org/ticket/34278





---

archive/issue_comments_483174.json:
```json
{
    "body": "here's a beginning (untested)\n----\nLast 10 new commits:",
    "created_at": "2022-08-05T19:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483174",
    "user": "mkoeppe"
}
```

here's a beginning (untested)
----
Last 10 new commits:



---

archive/issue_comments_483175.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-07T00:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483175",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_483176.json:
```json
{
    "body": "Rebased on new version of #34277",
    "created_at": "2022-08-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483176",
    "user": "mkoeppe"
}
```

Rebased on new version of #34277



---

archive/issue_comments_483177.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483177",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483178",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483179.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483179",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483180",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T01:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483181",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483182.json:
```json
{
    "body": "Can you give some more explanation why you want to do this? While this should not be an issue with coercion (equal-but-not-identical-parents are often a source of frustration there), it increases the overall code complexity.",
    "created_at": "2022-08-07T07:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483182",
    "user": "tscrim"
}
```

Can you give some more explanation why you want to do this? While this should not be an issue with coercion (equal-but-not-identical-parents are often a source of frustration there), it increases the overall code complexity.



---

archive/issue_comments_483183.json:
```json
{
    "body": "When algorithms create lots of `RealSet`s as intermediate objects, we don't want them to persist in memory for the remainder of the session",
    "created_at": "2022-08-07T18:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483183",
    "user": "mkoeppe"
}
```

When algorithms create lots of `RealSet`s as intermediate objects, we don't want them to persist in memory for the remainder of the session



---

archive/issue_comments_483184.json:
```json
{
    "body": "But now I realize the premise is wrong - `CachedRepresentation`/`UniqueRepresentation` use `WeakCachedFunction`, so it does not actually pin the objects into memory",
    "created_at": "2022-08-07T18:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483184",
    "user": "mkoeppe"
}
```

But now I realize the premise is wrong - `CachedRepresentation`/`UniqueRepresentation` use `WeakCachedFunction`, so it does not actually pin the objects into memory



---

archive/issue_comments_483185.json:
```json
{
    "body": "Indeed, it is a weak cache. However, if this needs to be done in a tight loop, the extra overhead of checking and maintaining the cache might matter. To the profiler!",
    "created_at": "2022-08-07T23:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34041#issuecomment-483185",
    "user": "tscrim"
}
```

Indeed, it is a weak cache. However, if this needs to be done in a tight loop, the extra overhead of checking and maintaining the cache might matter. To the profiler!
