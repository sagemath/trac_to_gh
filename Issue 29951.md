# Issue 29951: Modify shortest_paths method in boost_graph.pyx to take list of vertices as input

archive/issues_029951.json:
```json
{
    "body": "CC:  @dcoudert @slel\n\nKeywords: gsoc2020\n\nThis ticket aims to modify `shortest_paths` method in `boost_graph.pyx` to take list of vertices as input. \nThis will reduce the current scenario of converting sage graph to boost graph and then computing shortest_paths for each required vertex.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30188\n\n",
    "created_at": "2020-07-21T07:59:48Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Modify shortest_paths method in boost_graph.pyx to take list of vertices as input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29951",
    "user": "https://github.com/vipul79321"
}
```
CC:  @dcoudert @slel

Keywords: gsoc2020

This ticket aims to modify `shortest_paths` method in `boost_graph.pyx` to take list of vertices as input. 
This will reduce the current scenario of converting sage graph to boost graph and then computing shortest_paths for each required vertex.

Issue created by migration from https://trac.sagemath.org/ticket/30188





---

archive/issue_comments_425034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-21T13:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-21T13:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425036.json:
```json
{
    "body": "Please add your full name in the \"Authors\" field.\n\nPlease set to `needs_review` when ready for review.\n\nUse one more f-string:\n\n```\n-            raise ValueError(\"the starting vertex \" + str(v) + \" is not in \" +\n-                             \"the graph\")\n+            raise ValueError(f\"the starting vertex {v} is not in the graph\")\n```\n\n\nMaybe wrap long lines, for instance:\n\n```\n-                        raise RuntimeError(\"Dijkstra algorithm does not work with negative weights, use Bellman-Ford instead\")\n+                        raise RuntimeError(\"Dijkstra algorithm does not \"\n+                                           \"work with negative weights, \"\n+                                           \"use Bellman-Ford instead\")\n```\n\n\nMaybe remove unnecessary parentheses:\n\n```\n-    return (distances, predecessors)\n+    return distances, predecessors\n```\n",
    "created_at": "2020-07-21T22:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425036",
    "user": "https://github.com/slel"
}
```

Please add your full name in the "Authors" field.

Please set to `needs_review` when ready for review.

Use one more f-string:

```
-            raise ValueError("the starting vertex " + str(v) + " is not in " +
-                             "the graph")
+            raise ValueError(f"the starting vertex {v} is not in the graph")
```


Maybe wrap long lines, for instance:

```
-                        raise RuntimeError("Dijkstra algorithm does not work with negative weights, use Bellman-Ford instead")
+                        raise RuntimeError("Dijkstra algorithm does not "
+                                           "work with negative weights, "
+                                           "use Bellman-Ford instead")
```


Maybe remove unnecessary parentheses:

```
-    return (distances, predecessors)
+    return distances, predecessors
```




---

archive/issue_comments_425037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-22T15:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425038.json:
```json
{
    "body": "Replying to [comment:4 slelievre]:\n> Please add your full name in the \"Authors\" field.\n> \n> Please set to `needs_review` when ready for review.\n> \nCurrently, I am working on documentation. Will update as soon as I will be done.\n\nVipul",
    "created_at": "2020-07-22T15:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425038",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:4 slelievre]:
> Please add your full name in the "Authors" field.
> 
> Please set to `needs_review` when ready for review.
> 
Currently, I am working on documentation. Will update as soon as I will be done.

Vipul



---

archive/issue_comments_425039.json:
```json
{
    "body": "I have one query regarding the documentation of `shortest_path` method in `boost_graph.pyx`. It mentions that\n\n```\n    Note that, if the graph is undirected, a negative edge automatically creates\n    a negative cycle: for this reason, in this case, Dijkstra algorithm is\n    always better.\n```\n\n\nI dont understand since there is already negative weight, then why to use dijkstra. And further, in such graphs shortest path computation may not be possible to negative cycle.",
    "created_at": "2020-07-22T15:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425039",
    "user": "https://github.com/vipul79321"
}
```

I have one query regarding the documentation of `shortest_path` method in `boost_graph.pyx`. It mentions that

```
    Note that, if the graph is undirected, a negative edge automatically creates
    a negative cycle: for this reason, in this case, Dijkstra algorithm is
    always better.
```


I dont understand since there is already negative weight, then why to use dijkstra. And further, in such graphs shortest path computation may not be possible to negative cycle.



---

archive/issue_comments_425040.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-22T16:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425040",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425041.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-22T16:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425041",
    "user": "https://github.com/vipul79321"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_425042.json:
```json
{
    "body": "Replying to [comment:8 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[33e436d](https://git.sagemath.org/sage.git/commit/?id=33e436d58f9c4a2c5345168e188401701d3cdf12)||`documentation added`||\n\nI have added documentation.\n\nOne thing, I would like to mention is that when `vertext_list` contains only one vertex, I have returned two dicts, instead of two dicts of dict. I have done so to keep uniformity in output from our method and current `shortest_path` method. So that in future, it will be easy for use to replace `shortest_path` method.",
    "created_at": "2020-07-22T16:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425042",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:8 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[33e436d](https://git.sagemath.org/sage.git/commit/?id=33e436d58f9c4a2c5345168e188401701d3cdf12)||`documentation added`||

I have added documentation.

One thing, I would like to mention is that when `vertext_list` contains only one vertex, I have returned two dicts, instead of two dicts of dict. I have done so to keep uniformity in output from our method and current `shortest_path` method. So that in future, it will be easy for use to replace `shortest_path` method.



---

archive/issue_comments_425043.json:
```json
{
    "body": "Now after complete review, we just need to expose this method in `shortest_path_all_pairs`, `centrality_closeness` and all such methods in `generic_graph.py`",
    "created_at": "2020-07-22T16:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425043",
    "user": "https://github.com/vipul79321"
}
```

Now after complete review, we just need to expose this method in `shortest_path_all_pairs`, `centrality_closeness` and all such methods in `generic_graph.py`



---

archive/issue_comments_425044.json:
```json
{
    "body": "* Here you should first check if `vertex_list is None` \n\n```diff\n+    if not isinstance(vertex_list, list):\n+        vertex_list = [vertex_list]\n+\n+    for v in vertex_list:\n+        if v not in g:\n+            raise ValueError(f\"the starting vertex {v} is not in the graph\")\n+\n+    if vertex_list == None:\n+        vertex_list = list(g)\n```\n\n\n* A list is better here. It's faster to get a value from a list than from a dictionary\n\n```diff\n-    cdef dict int_to_v = dict(enumerate(g))\n+    cdef list int_to_v = list(g)\n```\n\n\n* Why this comment ?\n\n```diff\n+    # Needed for rational curves.\n```\n\n\n* define types of variables `distances`, `predecessors`, `pred_v`, etc.\n\n\nWhat I don't like here is that the method returns dict of dicts. A least a matrix would be a better choice. If the graph is large, it's a huge waste of time and space :(",
    "created_at": "2020-07-23T20:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425044",
    "user": "https://github.com/dcoudert"
}
```

* Here you should first check if `vertex_list is None` 

```diff
+    if not isinstance(vertex_list, list):
+        vertex_list = [vertex_list]
+
+    for v in vertex_list:
+        if v not in g:
+            raise ValueError(f"the starting vertex {v} is not in the graph")
+
+    if vertex_list == None:
+        vertex_list = list(g)
```


* A list is better here. It's faster to get a value from a list than from a dictionary

```diff
-    cdef dict int_to_v = dict(enumerate(g))
+    cdef list int_to_v = list(g)
```


* Why this comment ?

```diff
+    # Needed for rational curves.
```


* define types of variables `distances`, `predecessors`, `pred_v`, etc.


What I don't like here is that the method returns dict of dicts. A least a matrix would be a better choice. If the graph is large, it's a huge waste of time and space :(



---

archive/issue_comments_425045.json:
```json
{
    "body": "Replying to [comment:12 dcoudert]:\n\n> What I don't like here is that the method returns dict of dicts. A least a matrix would be a better choice. If the graph is large, it's a huge waste of time and space :(\n\nI was hoping maybe we could return dict instead of dict of dict. And in that dict key values will be vertex in vertex list. And item value will be a list or vector storing distances[v] in order of list(g). Meaning distances[v][i] will return shortest distance between v and list(g)[i].\n\nSimilarly for predecessor.\n\nIs it ok? \n\nP.S.- we can do similar thing with matrix. But i just feel that this will be nice way.",
    "created_at": "2020-07-25T18:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425045",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:12 dcoudert]:

> What I don't like here is that the method returns dict of dicts. A least a matrix would be a better choice. If the graph is large, it's a huge waste of time and space :(

I was hoping maybe we could return dict instead of dict of dict. And in that dict key values will be vertex in vertex list. And item value will be a list or vector storing distances[v] in order of list(g). Meaning distances[v][i] will return shortest distance between v and list(g)[i].

Similarly for predecessor.

Is it ok? 

P.S.- we can do similar thing with matrix. But i just feel that this will be nice way.



---

archive/issue_comments_425046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-26T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425047.json:
```json
{
    "body": "rebased on last beta and some minor improvements.",
    "created_at": "2020-07-26T17:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425047",
    "user": "https://github.com/dcoudert"
}
```

rebased on last beta and some minor improvements.



---

archive/issue_comments_425048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-28T19:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425048",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425049.json:
```json
{
    "body": "Replying to [comment:16 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[8ae8745](https://git.sagemath.org/sage.git/commit/?id=8ae87450b2709a36a5b8a3b91ee4ef5437f55b31)||`made list of lists as return type`||\n\nI have made the return type as list of lists. Now `for i, v in enumerate(vertex_list): distances[i] and predecessors[i] will give us the shortest path information from v`.\n\nAlthough, one thing I would like to mention is following scenario - \n\n\n```\nCurrent output using list of lists\nsage: G = Graph(5)\nsage: shortest_paths_from_vertices(G,0)\n([[0, +Infinity, +Infinity, +Infinity, +Infinity]],\n [[None, None, None, None, None]])\n\n```\n\n\n\n```\nwhen returning dict of dict\nsage: shortest_paths(G,0)\n({0: 0}, {0: None})\n```\n\n\nClearly, there is a need of extra memory in list of lists in case of disconnected graphs.\n\nOne bug that i encountered is:\n\n\n```\nsage: G = Graph([ (0,1,2), (1,2,0.7)], weighted = True)\nsage: shortest_paths_from_vertices(G, 0)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-12-1e6b63e11f81> in <module>()\n----> 1 shortest_paths_from_vertices(G, Integer(0))\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths_from_vertices (build/cythonized/sage/graphs/base/boost_graph.cpp:26092)()\n   2101     return LB\n   2102 \n-> 2103 cpdef shortest_paths_from_vertices(g, vertex_list=None, weight_function=None, algorithm=None):\n   2104     r\"\"\"\n   2105     Compute the shortest paths to all vertices from each vertex in\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths_from_vertices (build/cythonized/sage/graphs/base/boost_graph.cpp:25805)()\n   2312         for vert in range(g.num_verts()):\n   2313             if result.distances[vert] != sys.float_info.max:\n-> 2314                 dist_v.append(correct_type(result.distances[vert]))\n   2315                 pred = result.predecessors[vert]\n   2316                 if pred != vert:\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6091)()\n    684                     mpz_set_pylong(self.value, n)\n    685                 else:\n--> 686                     raise TypeError(\"Cannot convert non-integral float to integer\")\n    687 \n    688             elif isinstance(x, pari_gen):\n\nTypeError: Cannot convert non-integral float to integer\n\n```\n\n\nI guess, we have to remove code of correct_type.\n\nBest \nVipul",
    "created_at": "2020-07-28T19:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425049",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:16 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[8ae8745](https://git.sagemath.org/sage.git/commit/?id=8ae87450b2709a36a5b8a3b91ee4ef5437f55b31)||`made list of lists as return type`||

I have made the return type as list of lists. Now `for i, v in enumerate(vertex_list): distances[i] and predecessors[i] will give us the shortest path information from v`.

Although, one thing I would like to mention is following scenario - 


```
Current output using list of lists
sage: G = Graph(5)
sage: shortest_paths_from_vertices(G,0)
([[0, +Infinity, +Infinity, +Infinity, +Infinity]],
 [[None, None, None, None, None]])

```



```
when returning dict of dict
sage: shortest_paths(G,0)
({0: 0}, {0: None})
```


Clearly, there is a need of extra memory in list of lists in case of disconnected graphs.

One bug that i encountered is:


```
sage: G = Graph([ (0,1,2), (1,2,0.7)], weighted = True)
sage: shortest_paths_from_vertices(G, 0)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-12-1e6b63e11f81> in <module>()
----> 1 shortest_paths_from_vertices(G, Integer(0))

/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths_from_vertices (build/cythonized/sage/graphs/base/boost_graph.cpp:26092)()
   2101     return LB
   2102 
-> 2103 cpdef shortest_paths_from_vertices(g, vertex_list=None, weight_function=None, algorithm=None):
   2104     r"""
   2105     Compute the shortest paths to all vertices from each vertex in

/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths_from_vertices (build/cythonized/sage/graphs/base/boost_graph.cpp:25805)()
   2312         for vert in range(g.num_verts()):
   2313             if result.distances[vert] != sys.float_info.max:
-> 2314                 dist_v.append(correct_type(result.distances[vert]))
   2315                 pred = result.predecessors[vert]
   2316                 if pred != vert:

/home/vipul/sage/local/lib/python3.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6091)()
    684                     mpz_set_pylong(self.value, n)
    685                 else:
--> 686                     raise TypeError("Cannot convert non-integral float to integer")
    687 
    688             elif isinstance(x, pari_gen):

TypeError: Cannot convert non-integral float to integer

```


I guess, we have to remove code of correct_type.

Best 
Vipul



---

archive/issue_comments_425050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-28T19:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425051.json:
```json
{
    "body": "Replying to [comment:18 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[c309ab4](https://git.sagemath.org/sage.git/commit/?id=c309ab42d962c6ff7017aa4533c97d6f765a3236)||`minor mistake`||\n\nFixed a error, which i mistakenly introduced. \n\nI havent updated documentation yet. I will update it, when we finalize the changes",
    "created_at": "2020-07-28T19:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425051",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:18 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[c309ab4](https://git.sagemath.org/sage.git/commit/?id=c309ab42d962c6ff7017aa4533c97d6f765a3236)||`minor mistake`||

Fixed a error, which i mistakenly introduced. 

I havent updated documentation yet. I will update it, when we finalize the changes



---

archive/issue_comments_425052.json:
```json
{
    "body": "Deciding of the correct type to use is not easy. May be it's easier to not try to correct the type, no ?",
    "created_at": "2020-07-28T20:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425052",
    "user": "https://github.com/dcoudert"
}
```

Deciding of the correct type to use is not easy. May be it's easier to not try to correct the type, no ?



---

archive/issue_comments_425053.json:
```json
{
    "body": "Replying to [comment:20 dcoudert]:\n> Deciding of the correct type to use is not easy. May be it's easier to not try to correct the type, no ?\nYeah, i will remove that part.",
    "created_at": "2020-07-28T21:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425053",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:20 dcoudert]:
> Deciding of the correct type to use is not easy. May be it's easier to not try to correct the type, no ?
Yeah, i will remove that part.



---

archive/issue_comments_425054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-29T17:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425055.json:
```json
{
    "body": "Replying to [comment:22 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[10143a3](https://git.sagemath.org/sage.git/commit/?id=10143a3fe946e9e47c7023d842bb9ced936ee758)||`correct type code removed`||\n\nCorrect type code removed.\nIf we are on board on current return method, I will update the documentation and expose it in `generic_graph.py`",
    "created_at": "2020-07-29T17:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425055",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:22 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[10143a3](https://git.sagemath.org/sage.git/commit/?id=10143a3fe946e9e47c7023d842bb9ced936ee758)||`correct type code removed`||

Correct type code removed.
If we are on board on current return method, I will update the documentation and expose it in `generic_graph.py`



---

archive/issue_comments_425056.json:
```json
{
    "body": "Honestly, I'm not completely sure of what the method does and it's objective. Can you clarify how you plan to use it and where. I'm not sure it does exactly what is needed.",
    "created_at": "2020-07-29T17:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425056",
    "user": "https://github.com/dcoudert"
}
```

Honestly, I'm not completely sure of what the method does and it's objective. Can you clarify how you plan to use it and where. I'm not sure it does exactly what is needed.



---

archive/issue_comments_425057.json:
```json
{
    "body": "Goal of this ticket is avoid format conversion (from sage graph to boost graph) for each vertex during `shortest_path_all_pairs` computation or other such method in `generic_graph.py`.  For e.g, see the following code - \n\n```\n    from sage.graphs.base.boost_graph import shortest_paths\n    dist = dict()\n    pred = dict()\n    for u in self:\n        dist[u], pred[u] = shortest_paths(self, u, weight_function, algorithm)\n    return dist, pred\n```\n\n\nHere `shortest_paths` of `boost_graph.pyx` is called for each vertex and hence format conversion time for each vertex.\n\nThis ticket aims to implement a method in `boost_graph.pyx` and take list of vertices as input and return `shortest_path` information for each vertex. Thus avoid conversion overhead.\n\nOur current method `shortest_path_from_vertices` in `boost_graph.pyx` does that.\n\nI hope it clear your doubt about purpose of the ticket :)\n\nVipul",
    "created_at": "2020-07-29T17:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425057",
    "user": "https://github.com/vipul79321"
}
```

Goal of this ticket is avoid format conversion (from sage graph to boost graph) for each vertex during `shortest_path_all_pairs` computation or other such method in `generic_graph.py`.  For e.g, see the following code - 

```
    from sage.graphs.base.boost_graph import shortest_paths
    dist = dict()
    pred = dict()
    for u in self:
        dist[u], pred[u] = shortest_paths(self, u, weight_function, algorithm)
    return dist, pred
```


Here `shortest_paths` of `boost_graph.pyx` is called for each vertex and hence format conversion time for each vertex.

This ticket aims to implement a method in `boost_graph.pyx` and take list of vertices as input and return `shortest_path` information for each vertex. Thus avoid conversion overhead.

Our current method `shortest_path_from_vertices` in `boost_graph.pyx` does that.

I hope it clear your doubt about purpose of the ticket :)

Vipul



---

archive/issue_comments_425058.json:
```json
{
    "body": "my main concern is that this method returns lists of distances. Outside this method, the chosen order of the vertices is not known. So I don't know how this can be used.",
    "created_at": "2020-07-30T09:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425058",
    "user": "https://github.com/dcoudert"
}
```

my main concern is that this method returns lists of distances. Outside this method, the chosen order of the vertices is not known. So I don't know how this can be used.



---

archive/issue_comments_425059.json:
```json
{
    "body": "Replying to [comment:26 dcoudert]:\n> my main concern is that this method returns lists of distances. Outside this method, the chosen order of the vertices is not known. So I don't know how this can be used.\n\nI think we can do it as follows in methods calling this method for retreiving path information -\n\n```\ndistances , predecessors = shortest_path_from_vertices(G, vertex_list)\nfor i, v in enumerate(vertex_list):\n    dist_v = distances[i]\n    pred_v = predecessors[i]\n    \n    for id, vertex in enumerate(G):\n       distance of vertex from v  = dist_v[id]\n       predecessor of vertex in shortest_path from v = pred_v[id]\n```\n\n\nWill it work?",
    "created_at": "2020-07-30T11:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425059",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:26 dcoudert]:
> my main concern is that this method returns lists of distances. Outside this method, the chosen order of the vertices is not known. So I don't know how this can be used.

I think we can do it as follows in methods calling this method for retreiving path information -

```
distances , predecessors = shortest_path_from_vertices(G, vertex_list)
for i, v in enumerate(vertex_list):
    dist_v = distances[i]
    pred_v = predecessors[i]
    
    for id, vertex in enumerate(G):
       distance of vertex from v  = dist_v[id]
       predecessor of vertex in shortest_path from v = pred_v[id]
```


Will it work?



---

archive/issue_comments_425060.json:
```json
{
    "body": "I don't think it's a safe usage, but I may be wrong.",
    "created_at": "2020-07-31T09:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425060",
    "user": "https://github.com/dcoudert"
}
```

I don't think it's a safe usage, but I may be wrong.



---

archive/issue_comments_425061.json:
```json
{
    "body": "Replying to [comment:28 dcoudert]:\n> I don't think it's a safe usage, but I may be wrong.\n\nIf that's the case then, we can return`list of dicts`, although it will be slow, but it will be an overall improvement on current scenario. \n\nI will add a note about in meta-ticket.",
    "created_at": "2020-07-31T18:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425061",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:28 dcoudert]:
> I don't think it's a safe usage, but I may be wrong.

If that's the case then, we can return`list of dicts`, although it will be slow, but it will be an overall improvement on current scenario. 

I will add a note about in meta-ticket.



---

archive/issue_comments_425062.json:
```json
{
    "body": "2 ideas to consider:\n- add input parameter `order` or `int_to_vertex` to specify the order of the vertices in the list\n- have 2 possible returned types: dict of lists and dict of dicts. The decision could be either when the given ordering is `None`, or with an extra input parameter.",
    "created_at": "2020-08-01T09:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425062",
    "user": "https://github.com/dcoudert"
}
```

2 ideas to consider:
- add input parameter `order` or `int_to_vertex` to specify the order of the vertices in the list
- have 2 possible returned types: dict of lists and dict of dicts. The decision could be either when the given ordering is `None`, or with an extra input parameter.



---

archive/issue_comments_425063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-20T14:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425064.json:
```json
{
    "body": "We are almost done\n\n- to avoid potential issues when building the doc, avoid `:` in\n\n```\n+    The input graph can be weighted: if the algorithm is Dijkstra, no negative\n+    weights are allowed, while if the algorithm is Bellman-Ford, negative\n+    weights are allowed, but there must be no negative cycle (otherwise, the\n+    shortest paths might not exist).\n+\n+    However, Dijkstra algorithm is more efficient: for this reason, we suggest\n+    to use Bellman-Ford only if necessary (which is also the default option).\n```\n\n- in the inout blocks, when the sentences are short, the convention is to not end with `.`, e.g.,\n\n```diff\n-    - ``order`` -- list (default: ``None``); order of vertices of `g`.\n+    - ``order`` -- list (default: ``None``); order of vertices of `g`\n```\n\n  of course, if you have a paragraph with several sentences, a final `.` is needed\n- again avoid `:` in ` Two possible outputs:`. You can write for instead `The type of output depends on the input. More precisely,` \n\n- this is simpler and more efficient\n\n```diff\n-           for vertex in g:\n-                if vertex not in order:\n-                    raise ValueError(\"Given ordering is not valid\")\n+            if any(v not in g for v in order:\n+                raise ValueError(\"Given ordering is not valid\")\n```\n\n  indeed, since `order` is a list, the test `vertex not in order` has time complexity in `O(n)`, while testing `v not in g` takes constant time (I hope)",
    "created_at": "2020-08-23T17:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425064",
    "user": "https://github.com/dcoudert"
}
```

We are almost done

- to avoid potential issues when building the doc, avoid `:` in

```
+    The input graph can be weighted: if the algorithm is Dijkstra, no negative
+    weights are allowed, while if the algorithm is Bellman-Ford, negative
+    weights are allowed, but there must be no negative cycle (otherwise, the
+    shortest paths might not exist).
+
+    However, Dijkstra algorithm is more efficient: for this reason, we suggest
+    to use Bellman-Ford only if necessary (which is also the default option).
```

- in the inout blocks, when the sentences are short, the convention is to not end with `.`, e.g.,

```diff
-    - ``order`` -- list (default: ``None``); order of vertices of `g`.
+    - ``order`` -- list (default: ``None``); order of vertices of `g`
```

  of course, if you have a paragraph with several sentences, a final `.` is needed
- again avoid `:` in ` Two possible outputs:`. You can write for instead `The type of output depends on the input. More precisely,` 

- this is simpler and more efficient

```diff
-           for vertex in g:
-                if vertex not in order:
-                    raise ValueError("Given ordering is not valid")
+            if any(v not in g for v in order:
+                raise ValueError("Given ordering is not valid")
```

  indeed, since `order` is a list, the test `vertex not in order` has time complexity in `O(n)`, while testing `v not in g` takes constant time (I hope)



---

archive/issue_comments_425065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-24T09:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425066.json:
```json
{
    "body": "Replying to [comment:32 dcoudert]:\n\n> - this is simpler and more efficient\n> {{{#!diff\n> -           for vertex in g:\n> -                if vertex not in order:\n> -                    raise ValueError(\"Given ordering is not valid\")\n> +            if any(v not in g for v in order:\n> +                raise ValueError(\"Given ordering is not valid\")\n> }}}\n>   indeed, since `order` is a list, the test `vertex not in order` has time complexity in `O(n)`, while testing `v not in g` takes constant time (I hope)\n> \n\nTried this \n\n\n```diff\n +            if any(v not in g for v in order:\n +                raise ValueError(\"Given ordering is not valid\")\n```\n\n\nbut it gave the following error `closures inside cpdef functions not yet supported`.",
    "created_at": "2020-08-24T09:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425066",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:32 dcoudert]:

> - this is simpler and more efficient
> {{{#!diff
> -           for vertex in g:
> -                if vertex not in order:
> -                    raise ValueError("Given ordering is not valid")
> +            if any(v not in g for v in order:
> +                raise ValueError("Given ordering is not valid")
> }}}
>   indeed, since `order` is a list, the test `vertex not in order` has time complexity in `O(n)`, while testing `v not in g` takes constant time (I hope)
> 

Tried this 


```diff
 +            if any(v not in g for v in order:
 +                raise ValueError("Given ordering is not valid")
```


but it gave the following error `closures inside cpdef functions not yet supported`.



---

archive/issue_comments_425067.json:
```json
{
    "body": "LGTM.",
    "created_at": "2020-08-24T11:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425067",
    "user": "https://github.com/dcoudert"
}
```

LGTM.



---

archive/issue_comments_425068.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-24T11:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425068",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-30T08:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29951#issuecomment-425069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_027580.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-30T08:39:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29951",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29951#event-27580"
}
```
