# Issue 23576: Implement matrix action on polynomial scheme morphisms

Issue created by migration from https://trac.sagemath.org/ticket/23813

Original creator: atowsley

Original creation time: 2017-09-09 16:24:43

CC:  bhutz paulfili

Keywords: matrix action, scheme morphism

Created a left and right action by matrices on affine and projective polynomial scheme morphisms. The following examples now works:


```
sage: P.<x,y> = ProjectiveSpace(ZZ, 1)
sage: H = Hom(P,P)
sage: f = H([x^2 + y^2, y^2])
sage: matrix([[1,2], [0,1]]) * f
sage: f* matrix([[1,2], [0,1]]) 
```

Additionally, added conjugation by a matrix for affine dynamical systems. 


---

Comment by atowsley created at 2017-09-09 16:31:28

Last 10 new commits:


---

Comment by atowsley created at 2017-09-09 16:31:28

Changing status from new to needs_review.


---

Comment by bhutz created at 2017-09-09 17:20:16

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-09-09 17:20:16

Here are some comments for the code syntax

- Examples:: -> EXAMPLES::

- blank line after EXAMPELS in __init__

- isinstance(, ) #space between args

- all functions should have one line description before examples

- def funct(, ) #space between parameters

- blank line at end of action file

- I don't think you use the AlgebraicScheme import in matrix_space


Now some issues from functionality testing

endomorphisms do not remain endomorphisms

```
P.<x, y> = ProjectiveSpace(QQ, 1)
H = Hom(P, P)
f = H([x^2 + y^2, y^2])
m = matrix([[1,1], [0,1]])
f.is_endomorphism(),(m*f).is_endomorphism(), (f*m).is_endomorphism()
```


Affine scheme morhisms don't have the action function

```
P.<x, y> = AffineSpace(QQ, 2)
H = Hom(P, P)
f = H([x^2 + y^2, y^2])
m = matrix([[1,1,1], [0,1,0],[1,0,0]])
f*m, m*f
```


I think it would helpful to separate the errors

```
P.<x, y> = ProjectiveSpace(QQ, 1)
H = Hom(P, P)
f = H([x^2 + y^2, y^2])
m = matrix([[1]])
f.as_dynamical_system().conjugate(m)
```


When the matrix ring is contained in the morphism base ring it can't work out the parent

```
P.<x, y> = ProjectiveSpace(CC, 1)
H = Hom(P, P)
f = H([x^2 + y^2, y^2])
m = matrix(QQ,[[1,1], [1,0]])
m*f
```

even more troubling

```
P.<x, y> = ProjectiveSpace(RR, 1)
H = Hom(P, P)
f = H([x^2 + RR(sqrt(2))*y^2, y^2])
m = matrix(QQ,[[1,1], [1,0]])
m*f
```


Acting on a dynamical system gives back a projective morphism instead of a dynamical system

```
P.<x, y> = ProjectiveSpace(QQ, 1)
H = Hom(P, P)
f = H([x^2 + y^2, y^2])
m = matrix([[1,1], [1,0]])
fd=f.as_dynamical_system()
m*fd
```



---

Comment by git created at 2017-09-09 19:15:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by atowsley created at 2017-09-09 19:20:43

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-09-09 20:53:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2017-09-09 21:12:45

Most everything seems fixed, except here is another issue with affines. I think the issue may actually be in dehomogenize().


```
P.<x, y> = AffineSpace(QQ, 2)
P2.<u,v,w> = AffineSpace(QQ,3)
H = Hom(P2, P)
f = H([u^2 + v^2, w^2])
m = matrix([[1,1,1], [1,0,1],[0,0,1]])
m*f
```



---

Comment by git created at 2017-09-09 21:24:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-09 21:40:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulfili created at 2017-09-09 22:55:49

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2017-09-11 23:45:06

merge conflict


---

Comment by bhutz created at 2017-09-11 23:45:06

Changing status from positive_review to needs_work.


---

Comment by bhutz created at 2017-09-11 23:49:03

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-09-11 23:49:03

fixed. please check that i didn't break anything.
----
New commits:


---

Comment by paulfili created at 2017-09-13 15:54:42

Changing status from needs_review to needs_work.


---

Comment by paulfili created at 2017-09-13 15:54:42

I added a "minimal" option that finds the minimal field of definition. I haven't had a chance to test it much yet, or add a doctest illustrating the functionality. Can you guys check it out and see if it works as desired?
----
New commits:


---

Comment by bhutz created at 2017-09-14 20:11:37

merge conflict


---

Comment by bhutz created at 2017-09-26 20:49:27

I didn't see a new commit, but the conflict seems to be worked out. However, the code doesn't work


```
sage: K.<w>=QuadraticField(5)
sage: P.<x, y> = ProjectiveSpace(K, 1)
sage: f = DynamicalSystem([x^2 + 2*y^2, y^2])
sage: m = matrix(QQ,[[1,1], [1,0]])
sage: f.conjugate(m,minimal=True)
NameError: global name 'number_field_elements_from_algebraics' is not defined
```


I think this is probably better as a separate function as I can see more uses for this. Then conjugate can call that function based on the minimal parameter.

I'm also tempted to separate that out from matrix actions and make it its own ticket. What do you think?


---

Comment by paulfili created at 2017-09-26 22:01:22

Sure, we can make a new ticket with this functionality. I'll check what's going wrong as soon as I can, the examples I ran worked somehow.


---

Comment by atowsley created at 2017-09-27 13:39:20

I agree that this should probably be a new ticket since it can be used in other situations as well. I'll let Paul separate out the code and then I'll rerun the tests on this ticket.


---

Comment by @Torrencem created at 2019-07-03 19:04:16

Fix merge conflicts
----
New commits:


---

Comment by git created at 2019-07-03 19:27:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-03 20:06:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Torrencem created at 2019-07-09 13:17:09

Here's an updated branch with 8.9
----
New commits:


---

Comment by git created at 2019-07-11 12:55:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 13:18:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 14:27:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 14:49:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Torrencem created at 2019-07-11 14:51:42

Changing status from needs_work to needs_review.


---

Comment by @Torrencem created at 2019-07-11 14:51:42

The previous commits all fix test cases and add more descriptive error messages. I think the ticket is ready to be finally reviewed


---

Comment by @Torrencem created at 2019-07-11 16:34:52

Note that in Ticket #28174 there's a functionality change that is required for this ticket. In particular, in master currently `dehomogenize` fails for non-endomorphisms like in some of the examples here.


---

Comment by bhutz created at 2019-07-13 18:13:10

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2019-07-13 18:13:10

The functionality of the action looks good, but there are few things to do here:

- MatrixPolymapAction: functions need description + INPUT

- affine_morphism: delete multiplier function (the deprecated function was removed in #27900)

- careful with #23174 as I get a duplicate definition of M when both branch branches are merged in. I don't think you need 975 redefining M since you already have that defined as N on 969. Then the for loop on 976 should be with N.

- conjugate is giving a TypeError and the action a ValueError with bad matrices. These error types should match.

- I seem to be getting two doc test dehomogenization failures, affine_morphism and projective_morphism that are minor and need to be addressed


---

Comment by git created at 2019-07-18 13:48:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-18 14:33:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-18 14:35:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Torrencem created at 2019-07-18 14:44:09

Changing status from needs_work to needs_review.


---

Comment by @Torrencem created at 2019-07-18 14:44:09

All the suggested changes are added, and all the tests seem to pass now. Marking as `needs_review`


---

Comment by bhutz created at 2019-07-18 17:54:21

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2019-07-18 17:54:21

Just one minor issue here:

- missed an error type in polymap_times_matrix. It still is a ValueError when the rest are TypeErrors


---

Comment by @Torrencem created at 2019-07-25 13:55:20

Changing keywords from "matrix action, scheme morphism" to "matrix action, scheme morphism, SI2019".


---

Comment by git created at 2019-07-30 13:19:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Torrencem created at 2019-07-30 13:19:37

fixed


---

Comment by @Torrencem created at 2019-07-30 13:19:37

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2019-07-30 14:36:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-01 22:55:05

Resolution: fixed
