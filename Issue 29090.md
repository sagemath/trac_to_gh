# Issue 29090: Fix build errors with python3, giac, ecl, m4rie, libgd on conda-forge

Issue created by migration from https://trac.sagemath.org/ticket/29327

Original creator: mkoeppe

Original creation time: 2020-03-13 20:09:36

CC:  isuruf dimpase saraedum

`conda-forge-standard` (https://github.com/mkoeppe/sage/runs/506355319):

- `python3`  
    problem with `_crypt` as discussed in #29102, `_sqlite`, `zlib`
- `giac`:
     {{{
/opt/conda/x86_64-conda_cos6-linux-gnu/include/c++/7.3.0/tuple:1271:29: error: incomplete type 'std::tuple_size<giac::gen (*)(const giac::gen&)>' used in nested name specifier
     inline constexpr size_t tuple_size_v = tuple_size<_Tp>::value;
                             ^~~~~~~~~~~~
maple.cc: In function 'giac::gen giac::_evalc(const giac::gen&, const giac::context*)':
maple.cc:948:24: error: invalid use of 'void'
       vecteur lp=*apply(l,gen_feuille)._VECTptr;
                   ~~~~~^~~~~~~~~~~~~~~
maple.cc:948:24: error: invalid use of 'void'
maple.cc: In function 'giac::gen giac::crsolve(const giac::gen&, const giac::gen&, const giac::gen&, giac::vecteur&, const giac::context*)':
maple.cc:2765:19: error: invalid use of 'void'
     aplatir(*apply(initcond0,equal2diff)._VECTptr,initcond);
              ~~~~~^~~~~~~~~~~~~~~~~~~~~~
maple.cc:2765:19: error: invalid use of 'void'
make[4]: *** [Makefile:790: maple.lo] Error 1
    }}}

`conda-forge-minimal` (https://github.com/mkoeppe/sage/runs/506355315):

- `python3`
    (see above)
- `pari`
   {{{
###
### Readline library does not seem to work. Maybe install libncurses?
###
### Building without GNU readline support
...
/opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc  -o gp-dyn -L"/sage/local/var/tmp/sage/build/pari-2.11.2/src/Olinux-x86_64" -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /opt/conda/include -Wl,--export-dynamic -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/lib -Wl,-rpath-link,/opt/conda/lib -L/opt/conda/lib emacs.o gp.o gp_rl.o texmacs.o whatnow.o plotnone.o -Wl,-rpath,"/sage/local/var/tmp/sage/build/pari-2.11.2/src"/Olinux-x86_64:"/sage/local/lib":/sage/local/lib  -lpari  -lm
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: warning: libgmp.so.23, needed by /sage/local/var/tmp/sage/build/pari-2.11.2/src/Olinux-x86_64/libpari.so, not found (try using -rpath or -rpath-link)
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /sage/local/var/tmp/sage/build/pari-2.11.2/src/Olinux-x86_64/libpari.so: undefined reference to `__gmpn_divrem_1'
   }}}


- `ecl` 
    {{{
;;; Note:
;;;   Invoking external command:
;;;   /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc -o bin/ecl -L/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/build/ /sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/build/eclinitZhjSpA.o -L./ -Wl,--rpath,/sage/local/lib/ -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/lib -Wl,-rpath-link,/opt/conda/lib -L/opt/conda/lib libecl.so -lgc -ldl -lm /opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: warning: libgmp.so.23, needed by libecl.so, not found (try using -rpath or -rpath-link)
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: libecl.so: undefined reference to `__gmpz_get_si'
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: libecl.so: undefined reference to `__gmpz_scan1'
   }}}

- `m4rie`
   {{{
  [m4rie-20200115]   libtool: link: /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc -I/include -mmmx -msse -msse2 -msse3 -I.. -O2 -fPIC -Wall -pedantic -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include -I/sage/local/include -o test_multiplication test_multiplication.o  -L/lib ../.libs/libm4rie.so -lm4ri -lm -Wl,-rpath -Wl,/sage/local/var/tmp/sage/build/m4rie-20200115/src/.libs -Wl,-rpath -Wl,/sage/local/lib
  [m4rie-20200115]   /opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: cannot find -lm4ri
   }}}
- `libgd`
    {{{
libtool: link: /opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc -g -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /opt/conda/include -fvisibility=hidden -Wl,-rpath -Wl,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/opt/conda/lib -Wl,-rpath-link -Wl,/opt/conda/lib -o .libs/gdcmpgif gdcmpgif.o  -L/sage/local/lib -L/opt/conda/lib ./.libs/libgd.so -lz -lm -lpng16 -lfreetype -Wl,-rpath -Wl,/sage/local/lib
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: warning: libbz2.so.1, needed by /sage/local/lib/libfreetype.so, not found (try using -rpath or -rpath-link)
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /sage/local/lib/libfreetype.so: undefined reference to `BZ2_bzDecompressInit'
   }}}


---

Comment by mkoeppe created at 2020-04-24 02:08:20

conda builds on macos work, but on linux all of these errors show up.


---

Comment by mkoeppe created at 2020-04-24 02:08:32

Changing priority from major to critical.


---

Comment by dimpase created at 2020-04-24 10:35:04

Is this on docker only, or on "real" conda the same pops up too?


---

Comment by mkoeppe created at 2020-04-27 01:38:57

I do not have any "real" Linux installation. All my tests on Linux are via Docker and/or on [GitHub](GitHub) Actions.

Install on conda on macOS - works completely, with the last remaining bits being #29574 and #29572.

The present ticket is about conda on Linux. I have two types of tests here.

- `local-ubuntu-conda-forge` runs on an `ubuntu-latest` machine on [GitHub](GitHub) Actions. The conda-forge installation is done by `tox -e local-conda-forge`, which uses Miniforge. You can run this tox command on any Linux machine to test it.

- `docker-conda-forge` uses the `continuumio/miniconda3` image and switches to the conda-forge channel.

On both configurations I get similar installation failures, as in the ticket description.

It would be really nice to be able to say that one can install the Sage distribution even if conda is active... but this is not true at the moment because of these failures.


---

Comment by mkoeppe created at 2020-04-27 01:42:56

Most recent runs: 
- `conda-forge-ubuntu-minimal` https://github.com/mkoeppe/sage/runs/618647294
   - `m4rie`, `pari`, `python3`, `ecl` fail
- `conda-forge-ubuntu-standard` https://github.com/mkoeppe/sage/runs/618647333: 
   - `openblas` and `singular` fail
- `conda-forge-ubuntu-standard-python2` https://github.com/mkoeppe/sage/runs/618647336
   - `python2` and `python3` fail


---

Comment by isuruf created at 2020-04-27 03:24:34

https://trac.sagemath.org/ticket/29596 should fix the pari, ecl, libgd issue.


---

Comment by isuruf created at 2020-04-27 03:51:56

https://trac.sagemath.org/ticket/29597 should fix m4rie


---

Comment by isuruf created at 2020-04-27 04:04:52

Replying to [comment:10 mkoeppe]:

> - `conda-forge-ubuntu-standard` https://github.com/mkoeppe/sage/runs/618647333: 
>    - `openblas` and `singular` fail

Do you have the config.log? It fails to find openblas from conda-forge.


---

Comment by mkoeppe created at 2020-04-27 04:24:25

Replying to [comment:13 isuruf]:
> Replying to [comment:10 mkoeppe]:
> 
> > - `conda-forge-ubuntu-standard` https://github.com/mkoeppe/sage/runs/618647333: 
> >    - `openblas` and `singular` fail
> 
> Do you have the config.log? It fails to find openblas from conda-forge.

Whole log archive is at https://github.com/mkoeppe/sage/suites/628495286/artifacts/5093478


---

Comment by mkoeppe created at 2020-04-27 04:27:13

local-conda-forge-ubuntu-standard config.log


---

Attachment


```
## --------------------------------------------------------- ##
## Checking whether SageMath should install SPKG openblas... ##
## --------------------------------------------------------- ##
configure:11652: checking BLAS library
configure:11671: result: openblas
configure:11720: checking whether any of gfortran is installed as or will be installed as SPKG
configure:11729: result: no
configure:11740: checking for openblas >= 0.2.20
configure:11747: $PKG_CONFIG --exists --print-errors "openblas >= 0.2.20"
configure:11750: $? = 0
configure:11764: $PKG_CONFIG --exists --print-errors "openblas >= 0.2.20"
configure:11767: $? = 0
configure:12745: result: yes
configure:12755: $PKG_CONFIG --exists --print-errors "openblas"
configure:12758: $? = 0
configure:12779: checking for cblas_dgemm
configure:12779: /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/bin/x86_64-conda_cos6-linux-gnu-c++ -std=gnu++11 -o conftest -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/include -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib -Wl,-rpath-link,/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib -L/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib conftest.cpp -L/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib -lopenblas -larb -lflint -lmpfr -lgmp -lm  -lntl >&5
/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib/libopenblas.a(memory.o): in function `openblas_fork_handler':
memory.c:(.text.openblas_fork_handler+0x11): undefined reference to `pthread_atfork'
/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib/libopenblas.a(blas_server.o): in function `blas_thread_init':
blas_server.c:(.text.blas_thread_init+0x12f): undefined reference to `pthread_create'
/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-standard/conda/lib/libopenblas.a(blas_server.o): in function `blas_thread_shutdown_':
blas_server.c:(.text.blas_thread_shutdown_+0xc9): undefined reference to `pthread_join'
collect2: error: ld returned 1 exit status
configure:12779: $? = 1
```



---

Comment by isuruf created at 2020-04-27 04:40:51

Thanks. See #29598


---

Comment by mkoeppe created at 2020-04-27 04:50:51

Thanks very much. Running tests with these tickets merged at https://github.com/mkoeppe/sage/actions/runs/88744943


---

Comment by isuruf created at 2020-04-27 06:33:11

Singular issue is #29601


---

Comment by isuruf created at 2020-04-27 06:45:36

libatomic_ops issue is #29602


---

Comment by mkoeppe created at 2020-04-27 17:55:12

Replying to [comment:19 isuruf]:
> libatomic_ops issue is #29602
Let's use #26287 (Upgrade to gc 8.0.4 and libatomic 7.6.10)


---

Comment by mkoeppe created at 2020-04-27 18:17:40

New tests run at https://github.com/mkoeppe/sage/actions/runs/89365078


---

Comment by mkoeppe created at 2020-04-27 22:18:51

maxima (via ecl) has an issue with the linker flags too:

```
;      - Loading binary file "binary-ecl/init-cl.fas" 
;  - Providing system maxima
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: unrecognized option '--sort-common -Wl'
/opt/conda/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: use the --help option for usage information
collect2: error: ld returned 1 exit status
An error occurred during initialization:
Error code 1 when executing
(RUN-PROGRAM "/opt/conda/bin/x86_64-conda_cos6-linux-gnu-cc" ("-o"
                                                              "binary-ecl/maxima.fas"
                                                              "-L/sage/local/lib/"
                                                              "/tmp/eclinitM31sB3.o"
                                                              "binary-ecl/maxima-package.o"
                                                              "binary-ecl/ecl-port.o"
                                                              "binary-ecl/autoconf-variables.o"
                                                              "binary-ecl/intl.o"
                                                              "binary-ecl/nregex.o"
                                                              "binary-ecl/cl-info.o"
                                                              "binary-ecl/sloop.o"
                                                              "binary-ecl/lmdcls.o"
                                                              "binary-ecl/letmac.o"
                                                              "binary-ecl/generr.o"
                                                              "binary-ecl/clmacs.o"
                                                              "binary-ecl/commac.o"
                                                              "binary-ecl/mormac.o"
                                                              "binary-ecl/compat.o"
                                                              "binary-ecl/transm.o"
                                                              "binary-ecl/getopt.o"
                                                              "binary-ecl/command-line.o"
                                                              "binary-ecl/defcal.o"
                                                              "binary-ecl/maxmac.o"
                                                              "binary-ecl/mopers.o"
                                                              "binary-ecl/mforma.o"
                                                              "binary-ecl/mrgmac.o"
                                                              "binary-ecl/rzmac.o"
                                                              "binary-ecl/strmac.o"
                                                              "binary-ecl/displm.o"
                                                              "binary-ecl/safe-recursion.o"
                                                              "binary-ecl/ratmac.o"
                                                              "binary-ecl/mhayat.o"
                                                              "binary-ecl/opers.o"
                                                              "binary-ecl/utils.o"
                                                              "binary-ecl/sumcon.o"
                                                              "binary-ecl/sublis.o"
                                                              "binary-ecl/merror.o"
                                                              "binary-ecl/mformt.o"
                                                              "binary-ecl/mutils.o"
                                                              "binary-ecl/outmis.o"
                                                              "binary-ecl/ar.o"
                                                              "binary-ecl/comm.o"
                                                              "binary-ecl/comm2.o"
                                                              "binary-ecl/mlisp.o"
                                                              "binary-ecl/mmacro.o"
                                                              "binary-ecl/buildq.o"
                                                              "binary-ecl/numerical/f2cl-package.o"
                                                              "binary-ecl/numerical/slatec.o"
                                                              "binary-ecl/numerical/f2cl-lib.o"
                                                              "binary-ecl/numerical/slatec/fdump.o"
                                                              "binary-ecl/numerical/slatec/j4save.o"
                                                              "binary-ecl/numerical/slatec/xercnt.o"
                                                              "binary-ecl/numerical/slatec/xerhlt.o"
                                                              "binary-ecl/numerical/slatec/xgetua.o"
                                                              "binary-ecl/numerical/slatec/xerprn.o"
                                                              "binary-ecl/numerical/slatec/xersve.o"
                                                              "binary-ecl/numerical/slatec/xermsg.o"
                                                              "binary-ecl/numerical/slatec/initds.o"
                                                              "binary-ecl/numerical/slatec/dcsevl.o"
                                                              "binary-ecl/numerical/slatec/d9lgmc.o"
                                                              "binary-ecl/numerical/slatec/dgamlm.o"
                                                              "binary-ecl/numerical/slatec/dgamma.o"
                                                              "binary-ecl/numerical/slatec/dgamln.o"
                                                              "binary-ecl/numerical/slatec/dlngam.o"
                                                              "binary-ecl/numerical/slatec/d9b0mp.o"
                                                              "binary-ecl/numerical/slatec/d9b1mp.o"
                                                              "binary-ecl/numerical/slatec/dbesj0.o"
                                                              "binary-ecl/numerical/slatec/dbesj1.o"
                                                              "binary-ecl/numerical/slatec/djairy.o"
                                                              "binary-ecl/numerical/slatec/dasyjy.o"
                                                              "binary-ecl/numerical/slatec/dbesj.o"
                                                              "binary-ecl/numerical/slatec/dbsi0e.o"
                                                              "binary-ecl/numerical/slatec/dbsi1e.o"
                                                              "binary-ecl/numerical/slatec/dbesi0.o"
                                                              "binary-ecl/numerical/slatec/dbesi1.o"
                                                              "binary-ecl/numerical/slatec/dasyik.o"
                                                              "binary-ecl/numerical/slatec/dbesi.o"
                                                              "binary-ecl/numerical/slatec/zabs.o"
                                                              "binary-ecl/numerical/slatec/zdiv.o"
                                                              "binary-ecl/numerical/slatec/zexp.o"
                                                              "binary-ecl/numerical/slatec/zmlt.o"
                                                              "binary-ecl/numerical/slatec/zsqrt.o"
                                                              "binary-ecl/numerical/slatec/zasyi.o"
                                                              "binary-ecl/numerical/slatec/zuchk.o"
                                                              "binary-ecl/numerical/slatec/zlog.o"
                                                              "binary-ecl/numerical/slatec/zunik.o"
                                                              "binary-ecl/numerical/slatec/zunhj.o"
                                                              "binary-ecl/numerical/slatec/zuoik.o"
                                                              "binary-ecl/numerical/slatec/zuni1.o"
                                                              "binary-ecl/numerical/slatec/zkscl.o"
                                                              "binary-ecl/numerical/slatec/zshch.o"
                                                              "binary-ecl/numerical/slatec/zbknu.o"
                                                              "binary-ecl/numerical/slatec/zmlri.o"
                                                              "binary-ecl/numerical/slatec/zs1s2.o"
                                                              "binary-ecl/numerical/slatec/zseri.o"
                                                              "binary-ecl/numerical/slatec/zacai.o"
                                                              "binary-ecl/numerical/slatec/zairy.o"
                                                              "binary-ecl/numerical/slatec/zuni2.o"
                                                              "binary-ecl/numerical/slatec/zbuni.o"
                                                              "binary-ecl/numerical/slatec/zrati.o"
                                                              "binary-ecl/numerical/slatec/zwrsk.o"
                                                              "binary-ecl/numerical/slatec/zbinu.o"
                                                              "binary-ecl/numerical/slatec/zbesi.o"
                                                              "binary-ecl/numerical/slatec/zbesj.o"
                                                              "binary-ecl/numerical/slatec/dbesy0.o"
                                                              "binary-ecl/numerical/slatec/dbesy1.o"
                                                              "binary-ecl/numerical/slatec/dbsynu.o"
                                                              "binary-ecl/numerical/slatec/dyairy.o"
                                                              "binary-ecl/numerical/slatec/dbesy.o"
                                                              "binary-ecl/numerical/slatec/zacon.o"
                                                              "binary-ecl/numerical/slatec/zunk1.o"
                                                              "binary-ecl/numerical/slatec/zunk2.o"
                                                              "binary-ecl/numerical/slatec/zbunk.o"
                                                              "binary-ecl/numerical/slatec/zbesh.o"
                                                              "binary-ecl/numerical/slatec/zbesy.o"
                                                              "binary-ecl/numerical/slatec/dbsk0e.o"
                                                              "binary-ecl/numerical/slatec/dbesk0.o"
                                                              "binary-ecl/numerical/slatec/dbsk1e.o"
                                                              "binary-ecl/numerical/slatec/dbesk1.o"
                                                              "binary-ecl/numerical/slatec/dbsknu.o"
                                                              "binary-ecl/numerical/slatec/dbesk.o"
                                                              "binary-ecl/numerical/slatec/zbesk.o"
                                                              "binary-ecl/numerical/slatec/d9aimp.o"
                                                              "binary-ecl/numerical/slatec/daie.o"
                                                              "binary-ecl/numerical/slatec/dai.o"
                                                              "binary-ecl/numerical/slatec/dbie.o"
                                                              "binary-ecl/numerical/slatec/dbi.o"
                                                              "binary-ecl/numerical/slatec/zbiry.o"
                                                              "binary-ecl/numerical/slatec/derfc.o"
                                                              "binary-ecl/numerical/slatec/derf.o"
                                                              "binary-ecl/numerical/slatec/de1.o"
                                                              "binary-ecl/numerical/slatec/dei.o"
                                                              "binary-ecl/numerical/slatec/d9upak.o"
                                                              "binary-ecl/numerical/slatec/dspenc.o"
                                                              "binary-ecl/numerical/slatec/dqwgtf.o"
                                                              "binary-ecl/numerical/slatec/dqcheb.o"
                                                              "binary-ecl/numerical/slatec/dqk15w.o"
                                                              "binary-ecl/numerical/slatec/dqwgts.o"
                                                              "binary-ecl/numerical/slatec/dqwgtc.o"
                                                              "binary-ecl/numerical/slatec/dgtsl.o"
                                                              "binary-ecl/numerical/slatec/dqk15.o"
                                                              "binary-ecl/numerical/slatec/dqk31.o"
                                                              "binary-ecl/numerical/slatec/dqk41.o"
                                                              "binary-ecl/numerical/slatec/dqk51.o"
                                                              "binary-ecl/numerical/slatec/dqk61.o"
                                                              "binary-ecl/numerical/slatec/dqk21.o"
                                                              "binary-ecl/numerical/slatec/dqk15i.o"
                                                              "binary-ecl/numerical/slatec/dqelg.o"
                                                              "binary-ecl/numerical/slatec/dqpsrt.o"
                                                              "binary-ecl/numerical/slatec/dqc25s.o"
                                                              "binary-ecl/numerical/slatec/dqmomo.o"
                                                              "binary-ecl/numerical/slatec/dqc25c.o"
                                                              "binary-ecl/numerical/slatec/dqc25f.o"
                                                              "binary-ecl/numerical/slatec/dqage.o"
                                                              "binary-ecl/numerical/slatec/dqagie.o"
                                                              "binary-ecl/numerical/slatec/dqagpe.o"
                                                              "binary-ecl/numerical/slatec/dqagp.o"
                                                              "binary-ecl/numerical/slatec/dqagse.o"
                                                              "binary-ecl/numerical/slatec/dqawoe.o"
                                                              "binary-ecl/numerical/slatec/dqawfe.o"
                                                              "binary-ecl/numerical/slatec/dqawse.o"
                                                              "binary-ecl/numerical/slatec/dqawce.o"
                                                              "binary-ecl/numerical/slatec/dqng.o"
                                                              "binary-ecl/numerical/slatec/dqag.o"
                                                              "binary-ecl/numerical/slatec/dqags.o"
                                                              "binary-ecl/numerical/slatec/dqagi.o"
                                                              "binary-ecl/numerical/slatec/dqawf.o"
                                                              "binary-ecl/numerical/slatec/dqawo.o"
                                                              "binary-ecl/numerical/slatec/dqaws.o"
                                                              "binary-ecl/numerical/slatec/dqawc.o"
                                                              "binary-ecl/numerical/slatec/quadpack.o"
                                                              "binary-ecl/simp.o"
                                                              "binary-ecl/float.o"
                                                              "binary-ecl/csimp.o"
                                                              "binary-ecl/csimp2.o"
                                                              "binary-ecl/zero.o"
                                                              "binary-ecl/logarc.o"
                                                              "binary-ecl/rpart.o"
                                                              "binary-ecl/numeric.o"
                                                              "binary-ecl/server.o"
                                                              "binary-ecl/macsys.o"
                                                              "binary-ecl/mload.o"
                                                              "binary-ecl/suprv1.o"
                                                              "binary-ecl/dskfn.o"
                                                              "binary-ecl/lesfac.o"
                                                              "binary-ecl/factor.o"
                                                              "binary-ecl/algfac.o"
                                                              "binary-ecl/nalgfa.o"
                                                              "binary-ecl/ufact.o"
                                                              "binary-ecl/result.o"
                                                              "binary-ecl/ifactor.o"
                                                              "binary-ecl/rat3a.o"
                                                              "binary-ecl/rat3b.o"
                                                              "binary-ecl/rat3d.o"
                                                              "binary-ecl/rat3c.o"
                                                              "binary-ecl/rat3e.o"
                                                              "binary-ecl/nrat4.o"
                                                              "binary-ecl/ratout.o"
                                                              "binary-ecl/transl.o"
                                                              "binary-ecl/transs.o"
                                                              "binary-ecl/trans1.o"
                                                              "binary-ecl/trans2.o"
                                                              "binary-ecl/trans3.o"
                                                              "binary-ecl/trans4.o"
                                                              "binary-ecl/trans5.o"
                                                              "binary-ecl/transf.o"
                                                              "binary-ecl/troper.o"
                                                              "binary-ecl/trutil.o"
                                                              "binary-ecl/trmode.o"
                                                              "binary-ecl/trdata.o"
                                                              "binary-ecl/trpred.o"
                                                              "binary-ecl/transq.o"
                                                              "binary-ecl/acall.o"
                                                              "binary-ecl/fcall.o"
                                                              "binary-ecl/evalw.o"
                                                              "binary-ecl/trprop.o"
                                                              "binary-ecl/mdefun.o"
                                                              "binary-ecl/schatc.o"
                                                              "binary-ecl/matcom.o"
                                                              "binary-ecl/matrun.o"
                                                              "binary-ecl/nisimp.o"
                                                              "binary-ecl/trigi.o"
                                                              "binary-ecl/trigo.o"
                                                              "binary-ecl/trgred.o"
                                                              "binary-ecl/bessel.o"
                                                              "binary-ecl/ellipt.o"
                                                              "binary-ecl/airy.o"
                                                              "binary-ecl/plasma.o"
                                                              "binary-ecl/intpol.o"
                                                              "binary-ecl/nparse.o"
                                                              "binary-ecl/displa.o"
                                                              "binary-ecl/nforma.o"
                                                              "binary-ecl/grind.o"
                                                              "binary-ecl/spgcd.o"
                                                              "binary-ecl/ezgcd.o"
                                                              "binary-ecl/option.o"
                                                              "binary-ecl/macdes.o"
                                                              "binary-ecl/inmis.o"
                                                              "binary-ecl/db.o"
                                                              "binary-ecl/compar.o"
                                                              "binary-ecl/askp.o"
                                                              "binary-ecl/sinint.o"
                                                              "binary-ecl/sin.o"
                                                              "binary-ecl/risch.o"
                                                              "binary-ecl/hayat.o"
                                                              "binary-ecl/defint.o"
                                                              "binary-ecl/residu.o"
                                                              "binary-ecl/specfn.o"
                                                              "binary-ecl/mat.o"
                                                              "binary-ecl/linnew.o"
                                                              "binary-ecl/matrix.o"
                                                              "binary-ecl/sprdet.o"
                                                              "binary-ecl/newinv.o"
                                                              "binary-ecl/newdet.o"
                                                              "binary-ecl/tlimit.o"
                                                              "binary-ecl/limit.o"
                                                              "binary-ecl/solve.o"
                                                              "binary-ecl/psolve.o"
                                                              "binary-ecl/algsys.o"
                                                              "binary-ecl/sqrtdenest.o"
                                                              "binary-ecl/polyrz.o"
                                                              "binary-ecl/cpoly.o"
                                                              "binary-ecl/mtrace.o"
                                                              "binary-ecl/mdebug.o"
                                                              "binary-ecl/scs.o"
                                                              "binary-ecl/asum.o"
                                                              "binary-ecl/fortra.o"
                                                              "binary-ecl/optim.o"
                                                              "binary-ecl/marray.o"
                                                              "binary-ecl/mdot.o"
                                                              "binary-ecl/irinte.o"
                                                              "binary-ecl/series.o"
                                                              "binary-ecl/numth.o"
                                                              "binary-ecl/laplac.o"
                                                              "binary-ecl/pade.o"
                                                              "binary-ecl/homog.o"
                                                              "binary-ecl/combin.o"
                                                              "binary-ecl/nset.o"
                                                              "binary-ecl/rand-mt19937.o"
                                                              "binary-ecl/maxmin.o"
                                                              "binary-ecl/nummod.o"
                                                              "binary-ecl/conjugate.o"
                                                              "binary-ecl/expintegral.o"
                                                              "binary-ecl/gamma.o"
                                                              "binary-ecl/mstuff.o"
                                                              "binary-ecl/pois2.o"
                                                              "binary-ecl/pois3.o"
                                                              "binary-ecl/desoln.o"
                                                              "binary-ecl/elim.o"
                                                              "binary-ecl/invert.o"
                                                              "binary-ecl/hypgeo.o"
                                                              "binary-ecl/hyp.o"
                                                              "binary-ecl/todd-coxeter.o"
                                                              "binary-ecl/mactex.o"
                                                              "binary-ecl/plot.o"
                                                              "binary-ecl/gnuplot_def.o"
                                                              "binary-ecl/xmaxima_def.o"
                                                              "binary-ecl/autol.o"
                                                              "binary-ecl/max_ext.o"
                                                              "binary-ecl/share-subdirs.o"
                                                              "binary-ecl/init-cl.o"
                                                              "-Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/opt/conda/lib -Wl,-rpath-link,/opt/conda/lib -L/opt/conda/lib"
                                                              "-Wl,--rpath,/sage/local/lib/"
                                                              "-shared"
                                                              "-Wl,-rpath-link,/sage/local/lib"
                                                              "-L/sage/local/lib"
                                                              "-Wl,-rpath,/sage/local/lib"
                                                              "-Wl,-O2"
                                                              "-Wl,--sort-common"
                                                              "-Wl,--as-needed"
                                                              "-Wl,-z,relro"
                                                              "-Wl,-z,now"
                                                              "-Wl,--disable-new-dtags"
                                                              "-Wl,--gc-sections"
                                                              "-Wl,-rpath,/opt/conda/lib"
                                                              "-Wl,-rpath-link,/opt/conda/lib"
                                                              "-L/opt/conda/lib"
                                                              "-Wl,-rpath-link,/sage/local/lib"
                                                              "-L/sage/local/lib"
                                                              "-Wl,-rpath,/sage/local/lib"
                                                              "-Wl,-O2"
                                                              "-Wl,--sort-common"
                                                              "-Wl,--as-needed"
                                                              "-Wl,-z,relro"
                                                              "-Wl,-z,now"
                                                              "-Wl,--disable-new-dtags"
                                                              "-Wl,--gc-sections"
                                                              "-Wl,-rpath,/opt/conda/lib"
                                                              "-Wl,-rpath-link,/opt/conda/lib"
                                                              "-L/opt/conda/lib"
                                                              "-lecl" "-lgmp"
                                                              "-lgc" "-lffi"
                                                              "-lgc" "-ldl"
                                                              "-lm")).
make[5]: *** [Makefile:1350: binary-ecl/maxima] Error 1
make[5]: Target 'all' not remade because of errors.
make[5]: Leaving directory '/sage/local/var/tmp/sage/build/maxima-5.42.2/src/src'
Making all in lisp-utils
```



---

Comment by mkoeppe created at 2020-04-27 22:19:24

(This one is from `tox -e docker-conda-forge-standard `)


---

Comment by mkoeppe created at 2020-04-27 23:28:23

Fixed by #29606 (build/pkgs/maxima/spkg-install.in: Do not pass on LDFLAGS)


---

Comment by mkoeppe created at 2020-04-28 00:31:16

New tests at https://github.com/mkoeppe/sage/actions/runs/89649733


---

Comment by mkoeppe created at 2020-04-28 04:26:54

New tests at https://github.com/mkoeppe/sage/actions/runs/89771836


---

Comment by mkoeppe created at 2020-04-28 13:23:50

`docker-conda-forge-standard` now builds OK (https://github.com/mkoeppe/sage/runs/624793624), but a large number of doctest failures occurs

```
sage -t src/sage/categories/primer.py  # 1 doctest failed
sage -t src/sage/combinat/quickref.py  # 1 doctest failed
sage -t src/sage/combinat/tutorial.py  # 1 doctest failed
sage -t src/sage/geometry/cone.py  # 5 doctests failed
sage -t src/sage/geometry/fan.py  # 86 doctests failed
sage -t src/sage/geometry/fan_isomorphism.py  # 12 doctests failed
sage -t src/sage/geometry/fan_morphism.py  # 92 doctests failed
sage -t src/sage/geometry/lattice_polytope.py  # 174 doctests failed
sage -t src/sage/geometry/polyhedron/backend_normaliz.py  # 1 doctest failed
sage -t src/sage/geometry/polyhedron/base_ZZ.py  # 2 doctests failed
sage -t src/sage/geometry/polyhedron/palp_database.py  # 2 doctests failed
sage -t src/sage/geometry/polyhedron/base.py  # 7 doctests failed
sage -t src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 3 doctests failed
sage -t src/sage/geometry/toric_plotter.py  # 17 doctests failed
sage -t src/sage/geometry/triangulation/element.py  # 1 doctest failed
sage -t src/sage/libs/glpk/error.pyx  # 1 doctest failed
sage -t src/sage/misc/cython.py  # 3 doctests failed
sage -t src/sage/modules/filtered_vector_space.py  # 5 doctests failed
sage -t src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed
sage -t src/sage/rings/number_field/totallyreal_rel.py  # 4 doctests failed
sage -t src/sage/schemes/generic/algebraic_scheme.py  # 13 doctests failed
sage -t src/sage/schemes/generic/homset.py  # 3 doctests failed
sage -t src/sage/schemes/toric/chow_group.py  # 159 doctests failed
sage -t src/sage/schemes/toric/divisor.py  # 234 doctests failed
sage -t src/sage/schemes/toric/divisor_class.pyx  # 50 doctests failed
sage -t src/sage/schemes/toric/fano_variety.py  # 137 doctests failed
sage -t src/sage/schemes/toric/homset.py  # 72 doctests failed
sage -t src/sage/schemes/toric/library.py  # 74 doctests failed
sage -t src/sage/schemes/toric/morphism.py  # 194 doctests failed
sage -t src/sage/schemes/toric/points.py  # 108 doctests failed
sage -t src/sage/schemes/toric/sheaf/constructor.py  # 29 doctests failed
sage -t src/sage/schemes/toric/sheaf/klyachko.py  # 101 doctests failed
sage -t src/sage/schemes/toric/toric_subscheme.py  # 104 doctests failed
sage -t src/sage/schemes/toric/variety.py  # 229 doctests failed
sage -t src/sage/schemes/toric/weierstrass.py  # 6 doctests failed
sage -t src/sage/schemes/toric/weierstrass_covering.py  # 9 doctests failed
sage -t src/sage/tests/books/computational-mathematics-with-sagemath/combinat_doctest.py  # 1 doctest failed
```



---

Comment by mkoeppe created at 2020-04-28 13:26:35

`docker-conda-forge-minimal` (https://github.com/mkoeppe/sage/runs/624793614) got farther too, now has a testsuite failure  in `symmetrica`, and still the build error in `python3`.


---

Comment by isuruf created at 2020-04-28 13:31:23

Most of them are of the form,


```
2020-04-28T07:35:02.7114886Z File "src/sage/schemes/toric/divisor.py", line 1926, in sage.schemes.toric.divisor.ToricRationalDivisorClassGroup
2020-04-28T07:35:02.7115019Z Failed example:
2020-04-28T07:35:02.7115157Z     P2 = toric_varieties.P2()
2020-04-28T07:35:02.7115258Z Exception raised:
2020-04-28T07:35:02.7115360Z     Traceback (most recent call last):
2020-04-28T07:35:02.7115725Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
2020-04-28T07:35:02.7115858Z         self.compile_and_execute(example, compiler, test.globs)
2020-04-28T07:35:02.7116212Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
2020-04-28T07:35:02.7116337Z         exec(compiled, globs)
2020-04-28T07:35:02.7116448Z       File "<doctest sage.schemes.toric.divisor.ToricRationalDivisorClassGroup[0]>", line 1, in <module>
2020-04-28T07:35:02.7116576Z         P2 = toric_varieties.P2()
2020-04-28T07:35:02.7116910Z       File "/sage/local/lib/python3.7/site-packages/sage/schemes/toric/library.py", line 531, in P2
2020-04-28T07:35:02.7117218Z         return self._make_CPRFanoToricVariety('P2', names, base_ring)
2020-04-28T07:35:02.7117588Z       File "/sage/local/lib/python3.7/site-packages/sage/schemes/toric/library.py", line 267, in _make_CPRFanoToricVariety
2020-04-28T07:35:02.7117724Z         points = [tuple(_) for _ in polytope.points()]
2020-04-28T07:35:02.7118071Z       File "/sage/local/lib/python3.7/site-packages/sage/geometry/lattice_polytope.py", line 3747, in points
2020-04-28T07:35:02.7118190Z         points = read_palp_point_collection(StringIO(result), M)
2020-04-28T07:35:02.7118333Z       File "sage/geometry/point_collection.pyx", line 1000, in sage.geometry.point_collection.read_palp_point_collection (build/cythonized/sage/geometry/point_collection.c:8112)
2020-04-28T07:35:02.7118464Z         m = int(first_line[0])
2020-04-28T07:35:02.7118763Z     ValueError: invalid literal for int() with base 10: 'Bad'
```



---

Comment by mkoeppe created at 2020-04-28 13:35:11

Is this gfan?


---

Comment by isuruf created at 2020-04-28 13:40:30

It's a palp issue. #29612


---

Comment by mkoeppe created at 2020-04-29 16:57:26

Tests (also with #29607; but not with #29612) run at https://github.com/mkoeppe/sage/actions/runs/90914869


---

Comment by mkoeppe created at 2020-04-30 06:57:17

Failures of some optional packages on `conda-forge-macos` can be seen at https://github.com/mkoeppe/sage/runs/631927929


---

Comment by isuruf created at 2020-04-30 14:08:25

`libsemigroups` failure is fixed in later releases. Is there a config.log for `latte_int` failure?


---

Comment by mkoeppe created at 2020-05-07 02:32:30

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-05-07 02:32:30

Let's close this ticket and revisit optional package at some time in the 9.2 cycle after updates have been done, including probably a `latte_int` update.


---

Comment by slelievre created at 2020-10-05 10:06:19

Is there a follow-up ticket for this? We're well into the 9.2 cycle.


---

Comment by slelievre created at 2020-10-05 10:06:19

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-12-27 19:47:04

Resolution: invalid
