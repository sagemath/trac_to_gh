# Issue 11589: Upgrade Cython to 0.15

Issue created by migration from https://trac.sagemath.org/ticket/11761

Original creator: robertwb

Original creation time: 2011-08-31 05:14:39

Assignee: tbd

CC:  fbissey jpflori

Lots of improvements and bug fixes, including generators. http://wiki.cython.org/ReleaseNotes-0.15


---

Comment by leif created at 2011-08-31 05:33:28

Replying to [ticket:11761 robertwb]:
> ... including generators.

Yeah!


---

Comment by robertwb created at 2011-08-31 07:33:49

Changing status from new to needs_review.


---

Attachment

Spkg up at http://sage.math.washington.edu/home/robertwb/cython/cython-0.15.spkg


---

Comment by robertwb created at 2011-09-16 09:25:18

Note that 0.15.1 is around the corner, but it's not as big of a jump.


---

Comment by leif created at 2011-09-16 09:50:12

Would 0.15.1 require additional changes to Sage?


---

Comment by jason created at 2011-10-02 03:44:22

Just FYI, 0.15.1 is now released.


---

Comment by leif created at 2011-10-02 04:14:50

Replying to [comment:7 jason]:
> Just FYI, 0.15.1 is now released.

Oh, did you tell Robert?

(Although he said _"it's not as big of a jump"_.)


---

Comment by jason created at 2011-10-02 04:56:16

Replying to [comment:8 leif]:
> Replying to [comment:7 jason]:
> > Just FYI, 0.15.1 is now released.
> 
> Oh, did you tell Robert?

Oh, I'm sure he knows, since he's the BFDL for Cython, if there is such a position ;).

> 
> (Although he said _"it's not as big of a jump"_.)


---

Comment by leif created at 2011-10-02 05:35:37

Replying to [comment:9 jason]:
> Replying to [comment:8 leif]:
> > Replying to [comment:7 jason]:
> > > Just FYI, 0.15.1 is now released.
> > 
> > Oh, did you tell Robert?
> 
> Oh, I'm sure he knows, since he's the BFDL for Cython, if there is such a position ;).

I was just kidding.

(Wonder whether he updates the spkg... :P)


---

Comment by leif created at 2011-10-02 05:36:50

:)


---

Comment by robertwb created at 2011-10-04 06:35:59

No further patches needed for 0.15.1.


---

Attachment


---

Attachment

Diff for the new Cython spkg, for review only


---

Comment by jdemeyer created at 2011-10-31 12:31:45

Minor comment: `spkg-install` is not executable (I know it is made executable upon building, but better fix this in the spkg anyway).


---

Comment by jdemeyer created at 2011-10-31 12:34:35

Why is the directory `tests` missing from the Cython source?  This should either be fixed, or be documented.


---

Comment by jdemeyer created at 2011-10-31 12:34:35

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-10-31 13:33:26

What should be done with:

```
cdef mpz_t denom
mpz_init_set_si(denom, 1)
```

This code is correct but gives a `local variable 'denom' referenced before assignment` warning.
(there are many of these in `sage/matrix/misc.pyx` for example)


---

Comment by jdemeyer created at 2011-10-31 15:33:12

This new Cython really gives _a lot_ more warnings than the old one, in many cases for code which is perfectly fine.  For me, this isn't really a problem, but it is certainly annoying.


---

Comment by robertwb created at 2011-11-01 06:03:47

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2011-11-01 06:03:47

I've fixed the executable bit on spkg-install and added the tests to the spkg. (I remember someone complaining way back that they were too big, but I don't think it's an issue and we've regularly shipped them before, and it's easier to just have them there.) The spkg at the above link has been refreshed. 

The warnings are primarily due to the fact that `mpz_t` et al are declared as `void*` rather than arrays of size 1. http://hg.sagemath.org/sage-main/file/2a2abbcad325/sage/libs/gmp/types.pxd#l1 Once this is fixed the warnings should go away (and they are correct with respect to the current declarations). All the other warnings I've noticed are correct too, I simply haven't had the time to fix/update Sage's code.

Your review patch looks fine. You obviously looked at this, is the window closed for 4.7.2?


---

Comment by jdemeyer created at 2011-11-01 08:26:06

Replying to [comment:20 robertwb]:
> Your review patch looks fine.
In fact, it doesn't.  I removed one line too much, fixed now.

> You obviously looked at this, is the window closed for 4.7.2?
This will certainly not be merged in sage-4.7.2.


---

Attachment

Replying to [comment:20 robertwb]:
> The warnings are primarily due to the fact that `mpz_t` et al are declared as `void*` rather than arrays of size 1. http://hg.sagemath.org/sage-main/file/2a2abbcad325/sage/libs/gmp/types.pxd#l1 Once this is fixed the warnings should go away (and they are correct with respect to the current declarations).

If there is an easy way to fix this, then we should do this.  I'm saying we should fix every single warning but if it is possible to declare `mpz_t` such that there are no warnings, we should certainly do this.


---

Comment by jdemeyer created at 2011-11-01 08:29:27

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-11-01 08:30:20

Of course, that should have been "I'm *not* saying we should fix every single warning"


---

Comment by jdemeyer created at 2011-11-01 08:50:24

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-11-01 08:50:24

Replying to [comment:20 robertwb]:
> I've fixed the executable bit on spkg-install and added the tests to the spkg.

One more thing: changing permissions is a change which should be committed.  So could you please do a `hg commit` and re-upload the spkg?  Otherwise, the package and patch looks good.


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted


---

Comment by robertwb created at 2011-11-05 05:52:31

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2011-11-05 05:52:31

Spkg updated with executable bit set commit.


---

Comment by robertwb created at 2011-11-05 06:14:04

Yes, I agree these warnings should be fixed. #11992 .


---

Comment by jdemeyer created at 2011-11-05 13:20:45

Replying to [comment:26 robertwb]:
> Spkg updated with executable bit set commit.
Looks you forgot to update the spkg, it is exactly the same as before (last modified on 1 november):

```
$ ls -l /home/robertwb/cython/spkg/cython-0.15.1.spkg
-rw-r--r-- 1 robertwb robertwb 1420704 2011-11-01 06:57 /home/robertwb/cython/spkg/cython-0.15.1.spkg
```


Never mind, I will make the change.


---

Comment by jdemeyer created at 2011-11-05 13:22:20

Changing status from needs_review to positive_review.


---

Comment by robertwb created at 2011-11-05 16:19:11

Oops, I put it at 


```
robertwb@sage:~/cython$ ls -l /home/robertwb/cython/cython-0.15.1.spkg 
-rw-r--r-- 1 robertwb robertwb 1412114 2011-11-04 22:51 /home/robertwb/cython/cython-0.15.1.spkg
```


That's what comes of getting too little sleep. Go ahead and use that one (or if you've already done the trivial change, even better.)


---

Comment by jdemeyer created at 2011-11-07 10:12:01

Resolution: fixed


---

Comment by fbissey created at 2011-11-24 22:17:19

Sorry to be late to the party. I get an error building the optional mpc extension in 4.8.alpha2 and I suspect cython-0.15.1 is the problem

```
sage/rings/complex_mpc.c: In function '__pyx_pf_4sage_5rings_11complex_mpc_15MPComplexNumber_16__float__':
sage/rings/complex_mpc.c:9720:48: error: cast specifies array type
```

I am guessing the complex_mpc.pyx code needs to be updated but I don't really know how.
