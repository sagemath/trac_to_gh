# Issue 12992: Givaro 3.7.0 bus error on SPARC Solaris

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-06-25 20:59:30

Assignee: cpernet

CC:  jpflori

Keywords: SPARC givaro bus error

The `test-crt` in the Givaro test suite fails on SPARC with the following backtrace:

```
-bash-3.00$ /home/vbraun/opt/mark/gdb-7.4.1/gdb/gdb test-crt
GNU gdb (GDB) 7.4.1
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "sparc-sun-solaris2.10".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from
/home/vbraun/opt/mark/sage-5.1.beta3/spkg/build/givaro-3.7.0/src/tests/test-crt...done.
(gdb) run
Starting program:
/home/vbraun/opt/mark/sage-5.1.beta3/spkg/build/givaro-3.7.0/src/tests/test-crt
[Thread debugging using libthread_db enabled]
[New Thread 1 (LWP 1)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1 (LWP 1)]
0x00029030 in Givaro::GFqDom<long>::GFqDom (this=0x7eaec, F=...)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givgfq.h:100
100                     _dcharacteristic = F._dcharacteristic;
(gdb) bt
#0  0x00029030 in Givaro::GFqDom<long>::GFqDom (this=0x7eaec, F=...)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givgfq.h:100
#1  0x00033c3c in Givaro::GivaroMM<Givaro::GFqDom<long> >::initone
(p=0x7eaec, V=...)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givaromm.h:297
#2  0x00031110 in Givaro::GivaroMM<Givaro::GFqDom<long> >::initialize
(bloc=0x7eaec, s=15, V=...)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givaromm.h:300
#3  0x000268f8 in Givaro::Array0<Givaro::GFqDom<long> >::build
(this=0xffbff890, s=15, t=...)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givarray0.inl:30
#4  0x00021ad0 in Givaro::Array0<Givaro::GFqDom<long> >::Array0
(this=0xffbff890, s=15)
   at /home/vbraun/opt/mark/sage-5.1.beta3/local//include/givaro/givarray0.inl:39
#5  0x0001bf04 in tmain<Givaro::GFqDom<long> > (argc=1,
argv=0xffbffb3c, generator=...) at test-crt.C:49
#6  0x00013d00 in main (argc=1, argv=0xffbffb3c) at test-crt.C:151
(gdb) l
95              {
96                      zero = F.zero;
97                      one = F.one;
98                      mOne = F.mOne;
99                      _characteristic = F._characteristic;
100                     _dcharacteristic = F._dcharacteristic;
101                     _exponent = F._exponent;
102                     _irred = F._irred;
103                     _q = F._q;
104                     _qm1 = F._qm1;
```

This is related to placement new in the Givaro array class, which we do not use in Sage at this point. Nevertheless it would be nice to clean this up eventually.


---

Comment by vbraun created at 2012-06-27 14:21:34

This will be fixed in Givaro-3.7.1, which is scheduled to appear in July 2012.


---

Comment by jpflori created at 2012-08-09 09:44:18

givaro 3.7.1 was released on 11/07/2012.


---

Comment by jpflori created at 2012-08-09 15:24:36

I've packaged an updated spkg (just updating the src dir, no problems on linux) at
http://perso.telecom-paristech.fr/~flori/sage/givaro-3.7.1.spkg

No changes committed in yet (all in a queue patch).


---

Comment by vbraun created at 2012-08-24 11:42:54

I'll review it if you commit your changes.


---

Attachment

Spkg diff, for review only. Committed in spkg.


---

Comment by jpflori created at 2012-08-24 13:13:30

Changing keywords from "SPARC givaro bus error" to "SPARC givaro bus error spkg".


---

Comment by jpflori created at 2012-08-24 13:13:30

Changing status from new to needs_review.


---

Comment by jpflori created at 2012-08-24 13:13:30

SPKG reuploaded with committed changes.
I did not have the time to run make ptest on Linux x86_64, and even less on SPARC hardware.


---

Comment by jpflori created at 2012-08-24 14:22:47

make ptest passes on Ubuntu 12.04 on x86_64.


---

Comment by vbraun created at 2012-08-25 17:44:29

Fixes the testsuite bug on SPARC. Only minor changes wrt. 3.7.0. Tests fine on x86_64. LGTM


---

Comment by vbraun created at 2012-08-25 17:44:29

Changing status from needs_review to positive_review.


---

Attachment

Patch from #9511


---

Comment by jdemeyer created at 2012-09-10 15:10:36

Resolution: fixed
