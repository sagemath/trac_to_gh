# Issue 13087: Correcting definition of "negative" quantum integers

Issue created by migration from https://trac.sagemath.org/ticket/13259

Original creator: andrew.mathas

Original creation time: 2012-07-16 02:25:19

Assignee: sage-combinat

CC:  sage-combinat

Keywords: quantum integer

Currently, "negative" quantum integers are only defined for non-negative integers:


```
        sage: q_analogues.q_int(-2)
        Traceback (most recent call last):
        ...
        ValueError: Argument (-2) must be a nonnegative integer.
```

The correct definition is that the quantum integer [n]_q is

                  [n]_q  = { 1+q+...+q!^{n-1}, if n\ge 0
                             { -q!^-n[-n],             if n<0

This patch corrects this. 

Note: prior to trac !#11411 these quantum integers were defined to be zero, and #11411 made made q_int() return a ValueError. Patch !#11411 was motivated by q_binomial() returning incorrect answers. With this patch both q_int() and q_binom() now return correct answers.


---

Comment by andrew.mathas created at 2012-07-16 02:28:28

Uploaded patch .


---

Comment by andrew.mathas created at 2012-07-16 02:28:50

Changing status from new to needs_review.


---

Comment by arminstraub created at 2012-07-21 10:18:41

This is my first attempt at reviewing a ticket so please let me know if I am breaking any rules...

I just uploaded an update to your patch which addresses the following:
* I tried to correctly format the doc strings (but as I am no export on documentation, it would be good if somebody could check).
* Added an initial check whether n is an integer (previously, q_int(3/2) would result in 0 without complaint).

Because of these changes, I am leaving this ticket as needing review.

patchbot: apply trac_13259-negative_quantum_integers-am.patch trac_13259-review.patch


---

Comment by andrew.mathas created at 2012-07-23 12:48:15

Thanks for your review. I agree with all of your suggestions except for changing the return statement when n<0 to:

```
return -p**n * sum([p**i for i in range(-n)])
```

because multiplying polynomials tends to be expensive. Perhaps you thought the previous use of `range(-1,n-1,-1))` wasn't very nice? If so this could be replaced by 

```
return sum([-p**(n+i) for i in range(-n)])
```


I am also not very experienced as to what happens next in the review process... Because this patch is so short I am tempted to just incorporate your changes and post a new version.


---

Comment by andrew.mathas created at 2012-07-24 01:00:39

Changing assignee from sage-combinat to andrew.mathas.


---

Comment by arminstraub created at 2012-07-24 08:34:40

apply after original patch


---

Attachment

The updated patch just fixes a tiny latex issue.

Replying to [comment:6 andrew.mathas]:

You're right: I changed the return statement mostly because of "looks" and to make it visibly agree with the documentation.  However, it actually turns out that the new statement is also **much** faster than both the previous one or the one you suggested as an alternative:


```
sage: p = ZZ['q'].gens()[0]
sage: n = -10
sage: %timeit -sum(p**j for j in  range(-1,n-1,-1))
625 loops, best of 3: 972 µs per loop
sage: %timeit sum([-p**(n+i) for i in range(-n)])
625 loops, best of 3: 979 µs per loop
sage: %timeit -p**n * sum([p**i for i in range(-n)])
625 loops, best of 3: 158 µs per loop
sage: n = -100
sage: %timeit -sum(p**j for j in  range(-1,n-1,-1))
25 loops, best of 3: 22.7 ms per loop
sage: %timeit sum([-p**(n+i) for i in range(-n)])
25 loops, best of 3: 27.6 ms per loop
sage: %timeit -p**n * sum([p**i for i in range(-n)])
625 loops, best of 3: 716 µs per loop
```


I certainly didn't anticipate this.

Thus, I would suggest leaving the two patches as they are.  From my (little) experience, I would say that there is no need to combine the two patches into a single one.  However, I just noted that your patch does not contain the ticket number in the comment line (at the top).  So when changing this, you might as well combine the two patches.


---

Comment by andrew.mathas created at 2012-07-25 11:20:36

Thanks for this. I guess that the moral is that working with polynomials, rather than with Laurent polynomials, is more efficient. I have uploaded a combined patch.


For patchbot:

apply  trac_13259-negative_quantum_integers-am.patch


---

Comment by andrew.mathas created at 2012-08-01 06:16:05

For the patchbot:

Apply trac_13259-negative_quantum_integers-am.patch


---

Comment by andrew.mathas created at 2012-08-24 00:20:33

For patchbot:

apply trac_13259-negative_quantum_integers-am.patch


---

Comment by andrew.mathas created at 2012-08-24 10:10:35

For patchbot (why is this always necessary?-):

apply trac_13259-negative_quantum_integers-am.patch


---

Comment by andrew.mathas created at 2012-08-24 10:10:35

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-08-28 07:06:24

There is a problem building the documentation:

```
release/merger/sage-5.4.beta0/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py:docstring of sage.combinat.q_analogues.q_factorial:18: WARNING: Literal block expected; none found.
```


Have a look gain at the documentation of `q_factorial`, lines 80--82.

Reviewers: please put your _real name_ in the Reviewer field.


---

Comment by jdemeyer created at 2012-08-28 07:06:24

Changing status from positive_review to needs_work.


---

Comment by andrew.mathas created at 2012-08-28 12:31:45

Correcting error in documentation


---

Attachment

For patchbot:

apply trac_13259-negative_quantum_integers-am.patch


---

Comment by andrew.mathas created at 2012-08-28 12:33:23

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-09-03 12:53:08

Resolution: fixed
