# Issue 26261: each asymptotic ring gets its own term monoid factory

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2018-10-17 13:05:51




---

Comment by git created at 2018-10-18 13:30:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2018-10-18 13:30:30

Changing status from new to needs_review.


---

Comment by git created at 2018-10-20 15:15:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-12 12:07:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-16 14:00:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2019-04-16 14:14:12

Changing status from needs_review to positive_review.


---

Comment by behackl created at 2019-04-16 14:14:12

I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://git.sagemath.org/sage.git/commit/?id=4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.

Thus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.


---

Comment by tscrim created at 2019-04-17 01:31:51

Just a comment:

```
class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
```

has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.


---

Comment by dkrenn created at 2019-04-17 08:51:10

Replying to [comment:8 tscrim]:
> Just a comment:
> {{{
> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
> }}}
> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.

We have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?


---

Comment by tscrim created at 2019-04-17 12:29:31

What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.

IMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.

However, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).


---

Comment by vbraun created at 2019-04-18 19:56:51

Resolution: fixed
