# Issue 26261: each asymptotic ring gets its own term monoid factory

archive/issues_026261.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/26498\n\n",
    "created_at": "2018-10-17T13:05:51Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "each asymptotic ring gets its own term monoid factory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26261",
    "user": "https://github.com/dkrenn"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/26498





---

archive/issue_comments_369648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-18T13:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369649.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-18T13:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369649",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-20T15:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369651.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-12T12:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369651",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-16T14:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369653.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-16T14:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369653",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369654.json:
```json
{
    "body": "I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://git.sagemath.org/sage.git/commit/?id=4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.\n\nThus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.",
    "created_at": "2019-04-16T14:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369654",
    "user": "https://github.com/behackl"
}
```

I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://git.sagemath.org/sage.git/commit/?id=4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.

Thus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.



---

archive/issue_comments_369655.json:
```json
{
    "body": "Just a comment:\n\n```\nclass TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n```\n\nhas a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.",
    "created_at": "2019-04-17T01:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369655",
    "user": "https://github.com/tscrim"
}
```

Just a comment:

```
class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
```

has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.



---

archive/issue_comments_369656.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> Just a comment:\n> {{{\n> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n> }}}\n> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.\n\nWe have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?",
    "created_at": "2019-04-17T08:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369656",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:8 tscrim]:
> Just a comment:
> {{{
> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
> }}}
> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.

We have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?



---

archive/issue_comments_369657.json:
```json
{
    "body": "What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.\n\nIMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.\n\nHowever, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).",
    "created_at": "2019-04-17T12:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369657",
    "user": "https://github.com/tscrim"
}
```

What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.

IMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.

However, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).



---

archive/issue_comments_369658.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-18T19:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26261#issuecomment-369658",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
