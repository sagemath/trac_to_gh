# Issue 18157: Upgrade PARI to latest master

Issue created by migration from https://trac.sagemath.org/ticket/18394

Original creator: jdemeyer

Original creation time: 2015-05-10 07:57:16

The PARI command `make snapshot` (analogous to `make dist` in automake projects) is broken, causing some missing documentation in the PARI tarball distributed with Sage.

If the documentation does not get rebuilt, this can give errors while generating the `sumnummoninit` (recently added to PARI) function.


---

Comment by git created at 2015-05-11 07:58:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-05-11 12:09:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-05-11 12:43:06

Changing status from new to needs_review.


---

Comment by pbruin created at 2015-05-12 08:34:31

Is `make snapshot` still broken, i.e. did you have to do anything special to create a working tarball?  If so, what is the fix, and have you reported it upstream?


---

Comment by jdemeyer created at 2015-05-12 08:50:42

Replying to [comment:6 pbruin]:
> Is `make snapshot` still broken
Yes.

> did you have to do anything special to create a working tarball?
Just build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.

> If so, what is the fix
The correct dependencies (all generated source files, in particular `usersch3.tex`) have to be added to the `snapshot` target in the `Makefile`, but I don't know precisely which.

> have you reported it upstream?
I tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.


---

Comment by pbruin created at 2015-05-12 09:02:23

Replying to [comment:7 jdemeyer]:
> Just build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.
It seems so; I previously got an error and a truncated `auto_gen.pxi` while building PARI in Sage (saying that `sumnummon` or `sumnummoninit` did not have documentation) but this does not happen anymore.  I am now running doctests.
> I tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.
I had a similar problem recently; some messages I tried to send using Gnus with NNTP via `gmane.org` disappeared, but e-mail did work.


---

Comment by pbruin created at 2015-05-12 09:03:31

Sorry, accidentally reverted your edit.


---

Comment by pbruin created at 2015-05-12 09:24:36

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2015-05-12 09:24:36

Looks good and all tests pass.


---

Comment by jdemeyer created at 2015-05-12 09:36:22

Good, thanks!

In the mean time, I found out that installing PARI with `make -k` also fixes the problem (`make -k` means: don't stop when an error is encountered, build as much as you can). The problem is that the make target for `usersch3.tex` might not be reached if TeX fails.

See also [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10)


---

Comment by jdemeyer created at 2015-05-12 09:37:13

Depending on upstream's reaction, we could add the `make -k` option in `build/pkgs/pari/spkg-install` in a follow-up ticket.


---

Comment by vbraun created at 2015-05-13 20:11:25

Resolution: fixed
