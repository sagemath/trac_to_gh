# Issue 18157: Upgrade PARI to latest master

archive/issues_018157.json:
```json
{
    "body": "The PARI command `make snapshot` (analogous to `make dist` in automake projects) is broken, causing some missing documentation in the PARI tarball distributed with Sage.\n\nIf the documentation does not get rebuilt, this can give errors while generating the `sumnummoninit` (recently added to PARI) function.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18394\n\n",
    "created_at": "2015-05-10T07:57:16Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Upgrade PARI to latest master",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18157",
    "user": "@jdemeyer"
}
```
The PARI command `make snapshot` (analogous to `make dist` in automake projects) is broken, causing some missing documentation in the PARI tarball distributed with Sage.

If the documentation does not get rebuilt, this can give errors while generating the `sumnummoninit` (recently added to PARI) function.

Issue created by migration from https://trac.sagemath.org/ticket/18394





---

archive/issue_comments_244820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-11T07:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244820",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_244821.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-11T12:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244821",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_244822.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-11T12:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244822",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_244823.json:
```json
{
    "body": "Is `make snapshot` still broken, i.e. did you have to do anything special to create a working tarball?  If so, what is the fix, and have you reported it upstream?",
    "created_at": "2015-05-12T08:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244823",
    "user": "@pjbruin"
}
```

Is `make snapshot` still broken, i.e. did you have to do anything special to create a working tarball?  If so, what is the fix, and have you reported it upstream?



---

archive/issue_comments_244824.json:
```json
{
    "body": "Replying to [comment:6 pbruin]:\n> Is `make snapshot` still broken\nYes.\n\n> did you have to do anything special to create a working tarball?\nJust build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.\n\n> If so, what is the fix\nThe correct dependencies (all generated source files, in particular `usersch3.tex`) have to be added to the `snapshot` target in the `Makefile`, but I don't know precisely which.\n\n> have you reported it upstream?\nI tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.",
    "created_at": "2015-05-12T08:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244824",
    "user": "@jdemeyer"
}
```

Replying to [comment:6 pbruin]:
> Is `make snapshot` still broken
Yes.

> did you have to do anything special to create a working tarball?
Just build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.

> If so, what is the fix
The correct dependencies (all generated source files, in particular `usersch3.tex`) have to be added to the `snapshot` target in the `Makefile`, but I don't know precisely which.

> have you reported it upstream?
I tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.



---

archive/issue_comments_244825.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Just build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.\nIt seems so; I previously got an error and a truncated `auto_gen.pxi` while building PARI in Sage (saying that `sumnummon` or `sumnummoninit` did not have documentation) but this does not happen anymore.  I am now running doctests.\n> I tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.\nI had a similar problem recently; some messages I tried to send using Gnus with NNTP via `gmane.org` disappeared, but e-mail did work.",
    "created_at": "2015-05-12T09:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244825",
    "user": "@pjbruin"
}
```

Replying to [comment:7 jdemeyer]:
> Just build all of PARI first (`make gp doc snapshot` instead of `make snapshot`). I hope that is sufficient.
It seems so; I previously got an error and a truncated `auto_gen.pxi` while building PARI in Sage (saying that `sumnummon` or `sumnummoninit` did not have documentation) but this does not happen anymore.  I am now running doctests.
> I tried but for some reason I cannot send messages to `pari-dev` anymore (I sent 2 messages but they do not appear on the mailing list). Just now, I sent an actual bug report.
I had a similar problem recently; some messages I tried to send using Gnus with NNTP via `gmane.org` disappeared, but e-mail did work.



---

archive/issue_comments_244826.json:
```json
{
    "body": "Sorry, accidentally reverted your edit.",
    "created_at": "2015-05-12T09:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244826",
    "user": "@pjbruin"
}
```

Sorry, accidentally reverted your edit.



---

archive/issue_comments_244827.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-12T09:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244827",
    "user": "@pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_244828.json:
```json
{
    "body": "Looks good and all tests pass.",
    "created_at": "2015-05-12T09:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244828",
    "user": "@pjbruin"
}
```

Looks good and all tests pass.



---

archive/issue_comments_244829.json:
```json
{
    "body": "Good, thanks!\n\nIn the mean time, I found out that installing PARI with `make -k` also fixes the problem (`make -k` means: don't stop when an error is encountered, build as much as you can). The problem is that the make target for `usersch3.tex` might not be reached if TeX fails.\n\nSee also [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10)",
    "created_at": "2015-05-12T09:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244829",
    "user": "@jdemeyer"
}
```

Good, thanks!

In the mean time, I found out that installing PARI with `make -k` also fixes the problem (`make -k` means: don't stop when an error is encountered, build as much as you can). The problem is that the make target for `usersch3.tex` might not be reached if TeX fails.

See also [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1699#10)



---

archive/issue_comments_244830.json:
```json
{
    "body": "Depending on upstream's reaction, we could add the `make -k` option in `build/pkgs/pari/spkg-install` in a follow-up ticket.",
    "created_at": "2015-05-12T09:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244830",
    "user": "@jdemeyer"
}
```

Depending on upstream's reaction, we could add the `make -k` option in `build/pkgs/pari/spkg-install` in a follow-up ticket.



---

archive/issue_comments_244831.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-13T20:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18157#issuecomment-244831",
    "user": "@vbraun"
}
```

Resolution: fixed
