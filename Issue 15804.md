# Issue 15804: Get git to build on OS X 10.4 PPC

Issue created by migration from https://trac.sagemath.org/ticket/16041

Original creator: kcrisman

Original creation time: 2014-04-01 00:23:55

CC:  vbraun

As in the summary.


```
    CC http-backend.o
    LINK git-http-backend
/usr/bin/ld: warning multiple definitions of symbol _regcomp
libgit.a(regex.o) definition of _regcomp in section (__TEXT,__text)
/usr/lib/libSystem.dylib(regcomp.So) definition of _regcomp
/usr/bin/ld: warning multiple definitions of symbol _regexec
libgit.a(regex.o) definition of _regexec in section (__TEXT,__text)
/usr/lib/libSystem.dylib(regexec.So) definition of _regexec
/usr/bin/ld: warning multiple definitions of symbol _regfree
libgit.a(regex.o) definition of _regfree in section (__TEXT,__text)
/usr/lib/libSystem.dylib(regfree.So) definition of _regfree
    CC imap-send.o
imap-send.c:33:37: fatal error: CommonCrypto/CommonHMAC.h: No such file or directory
compilation terminated.
make[3]: *** [imap-send.o] Error 1
Error building git.

real    9m46.658s
user    5m48.673s
sys     1m46.609s
************************************************************************
Error installing package git-1.8.4.4
************************************************************************
```


Volker says [this macports ticket](http://trac.macports.org/ticket/39848) has the fix, which seems reasonable.


```diff
--- a/trunk/dports/devel/git-core/Portfile
+++ b/trunk/dports/devel/git-core/Portfile
@@ -202,4 +202,8 @@
 }
 
+platform darwin 8 {
+    build.args-append   NO_APPLE_COMMON_CRYPTO=1
+}
+
 default_variants    +doc +pcre +credential_osxkeychain
```



---

Comment by kcrisman created at 2014-04-01 20:31:13

Sorry, this means we have to add this to the flags.  I'll try something kludgy like adding

```
export NO_APPLE_COMMON_CRYPTO=1
```

in my own to try this out, but presumably we would want to do a case for Darwin 8 in spkg-install.


---

Comment by kcrisman created at 2014-04-01 21:04:04

Changing priority from major to blocker.


---

Comment by kcrisman created at 2014-04-01 21:04:04

Yes, this works.  In spkg-install, do

```
if { uname -sr | grep 'Darwin 8' ;} &>/dev/null; then
    export NO_APPLE_COMMON_CRYPTO=1
fi
```

I can't turn this into a branch yet on that machine, I don't think - at least, `sage -git diff` hangs - but I'll gladly approve this if someone does.  This shouldn't affect any other platform than Tiger, since we don't support Panther and anything after this supports this common crypto thingie.

Putting as blocker since fix is here and prevents building.


---

Comment by kcrisman created at 2014-04-02 17:57:21

Okay, I did this change on my other machine.  Needs review.
----
New commits:


---

Comment by kcrisman created at 2014-04-02 17:57:21

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-04-07 17:27:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-07 19:09:09

Resolution: fixed
