# Issue 23499: Teichmuller lift of residual element has wrong precision

archive/issues_023499.json:
```json
{
    "body": "CC:  @roed314\n\nKeywords: teichmuller lift\n\nSee below:\n\n```\nsage: R = Zp(5); R\n5-adic Ring with capped relative precision 20\nsage: R.teichmuller(2)\n2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)\nsage: R.teichmuller(GF(5)(2)) % should have precision 20?\n2 + O(5)\n```\n\nAccording to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23736\n\n",
    "created_at": "2017-08-28T17:09:24Z",
    "labels": [
        "padics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Teichmuller lift of residual element has wrong precision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23499",
    "user": "@kedlaya"
}
```
CC:  @roed314

Keywords: teichmuller lift

See below:

```
sage: R = Zp(5); R
5-adic Ring with capped relative precision 20
sage: R.teichmuller(2)
2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)
sage: R.teichmuller(GF(5)(2)) % should have precision 20?
2 + O(5)
```

According to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.


Issue created by migration from https://trac.sagemath.org/ticket/23736





---

archive/issue_comments_329342.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329342",
    "user": "@roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_329343.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329343",
    "user": "@roed314"
}
```

New commits:



---

archive/issue_comments_329344.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329344",
    "user": "@kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_329345.json:
```json
{
    "body": "This looks good on its own; but I get some doctest failures in adjacent files:\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed\nsage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed\nsage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed\n```\n\nwhich all appear to be of the form\n\n```\n    PrecisionError: Precision higher than allowed by the precision cap.\n```\n",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329345",
    "user": "@kedlaya"
}
```

This looks good on its own; but I get some doctest failures in adjacent files:

```
sage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed
sage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed
sage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed
```

which all appear to be of the form

```
    PrecisionError: Precision higher than allowed by the precision cap.
```




---

archive/issue_comments_329346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-28T18:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329346",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329347.json:
```json
{
    "body": "Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.\n\nHowever, there are now failing tests in\n\n```\nsage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed\nsage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed\n```\n\nwhich look more serious.\n\nI'm going to have to come back to this in a few days, since I need to get ready for the start of classes.",
    "created_at": "2017-08-28T19:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329347",
    "user": "@roed314"
}
```

Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.

However, there are now failing tests in

```
sage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed
sage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed
```

which look more serious.

I'm going to have to come back to this in a few days, since I need to get ready for the start of classes.



---

archive/issue_comments_329348.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T22:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329348",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329349.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329349",
    "user": "@roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_329350.json:
```json
{
    "body": "Alright, fixed it.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329350",
    "user": "@roed314"
}
```

Alright, fixed it.



---

archive/issue_comments_329351.json:
```json
{
    "body": "I just ran all tests in `src/sage` with no failures.",
    "created_at": "2017-09-20T22:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329351",
    "user": "@roed314"
}
```

I just ran all tests in `src/sage` with no failures.



---

archive/issue_comments_329352.json:
```json
{
    "body": "Looks good to me. Positive review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329352",
    "user": "@kedlaya"
}
```

Looks good to me. Positive review.



---

archive/issue_comments_329353.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329353",
    "user": "@kedlaya"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329354.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-26T06:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23499#issuecomment-329354",
    "user": "@vbraun"
}
```

Resolution: fixed
