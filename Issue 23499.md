# Issue 23499: Teichmuller lift of residual element has wrong precision

Issue created by migration from https://trac.sagemath.org/ticket/23736

Original creator: kedlaya

Original creation time: 2017-08-28 17:09:24

CC:  roed

Keywords: teichmuller lift

See below:

```
sage: R = Zp(5); R
5-adic Ring with capped relative precision 20
sage: R.teichmuller(2)
2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)
sage: R.teichmuller(GF(5)(2)) % should have precision 20?
2 + O(5)
```

According to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.



---

Comment by roed created at 2017-08-28 17:43:32

Changing status from new to needs_review.


---

Comment by roed created at 2017-08-28 17:43:32

New commits:


---

Comment by kedlaya created at 2017-08-28 18:11:34

Changing status from needs_review to needs_work.


---

Comment by kedlaya created at 2017-08-28 18:11:34

This looks good on its own; but I get some doctest failures in adjacent files:

```
sage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed
sage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed
sage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed
```

which all appear to be of the form

```
    PrecisionError: Precision higher than allowed by the precision cap.
```



---

Comment by git created at 2017-08-28 18:43:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-08-28 19:35:55

Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.

However, there are now failing tests in

```
sage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed
sage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed
```

which look more serious.

I'm going to have to come back to this in a few days, since I need to get ready for the start of classes.


---

Comment by git created at 2017-09-20 22:24:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-09-20 22:30:09

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-09-20 22:30:09

Alright, fixed it.


---

Comment by roed created at 2017-09-20 22:40:24

I just ran all tests in `src/sage` with no failures.


---

Comment by kedlaya created at 2017-09-23 00:42:23

Looks good to me. Positive review.


---

Comment by kedlaya created at 2017-09-23 00:42:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-26 06:58:17

Resolution: fixed
