# Issue 26892: py3: fix other doctests in graph.py

archive/issues_026892.json:
```json
{
    "body": "Keywords: py3, graph\n\nWe change some doctests in `cliques_containing_vertex` and `perfect_matchings` to support py3.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27129\n\n",
    "created_at": "2019-01-25T15:44:08Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "py3: fix other doctests in graph.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26892",
    "user": "dcoudert"
}
```
Keywords: py3, graph

We change some doctests in `cliques_containing_vertex` and `perfect_matchings` to support py3.

Issue created by migration from https://trac.sagemath.org/ticket/27129





---

archive/issue_comments_378363.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-25T15:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378363",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_378364.json:
```json
{
    "body": "With #27125 and #27127, this should fix all (currently) failing doctests with py3 in file `graph.py`.\n----\nNew commits:",
    "created_at": "2019-01-25T15:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378364",
    "user": "dcoudert"
}
```

With #27125 and #27127, this should fix all (currently) failing doctests with py3 in file `graph.py`.
----
New commits:



---

archive/issue_comments_378365.json:
```json
{
    "body": "Can you explain why this change is necessary?\n\n```diff\n-            sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])\n+            sage: G = Graph([(0, 1, 'a'), (0, 3, 'b'), (1, 2, 'c'), (2, 3, 'd')])\n             sage: list(G.perfect_matchings(labels=True))\n-            [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]\n+            [[(0, 1, 'a'), (2, 3, 'd')], [(0, 3, 'b'), (1, 2, 'c')]]\n```\n",
    "created_at": "2019-01-25T19:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378365",
    "user": "tscrim"
}
```

Can you explain why this change is necessary?

```diff
-            sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
+            sage: G = Graph([(0, 1, 'a'), (0, 3, 'b'), (1, 2, 'c'), (2, 3, 'd')])
             sage: list(G.perfect_matchings(labels=True))
-            [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
+            [[(0, 1, 'a'), (2, 3, 'd')], [(0, 3, 'b'), (1, 2, 'c')]]
```




---

archive/issue_comments_378366.json:
```json
{
    "body": "Essentially the same motivation as in [https://trac.sagemath.org/ticket/27127#comment:3](https://trac.sagemath.org/ticket/27127#comment:3). The order in which vertices are visited is not always the same in py2 and py3, and so the order in which solutions are discovered may differ.\n\nHere, with py3, we get `[[(-1, 1, 'a'), (-2, 2, 'b')], [(-1, 2, 'y'), (-2, 1, 'x')]]`. So same set of solutions than with py2, but matchings are reported in a different order, and the order of edges of each matching is different.\n\nThe proposed change is more stable with py2 and py3.\n\nAn alternative is to do:\n\n```\nsage: def compare(A, B):\n....:     return Set(map(Set, A)) == Set(map(Set, B))\nsage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])\nsage: expected = [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]\nsage: L = list(G.perfect_matchings(labels=True))\nsage: compare(L, expected)\nTrue\n```\n\nShould I do that ?",
    "created_at": "2019-01-26T09:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378366",
    "user": "dcoudert"
}
```

Essentially the same motivation as in [https://trac.sagemath.org/ticket/27127#comment:3](https://trac.sagemath.org/ticket/27127#comment:3). The order in which vertices are visited is not always the same in py2 and py3, and so the order in which solutions are discovered may differ.

Here, with py3, we get `[[(-1, 1, 'a'), (-2, 2, 'b')], [(-1, 2, 'y'), (-2, 1, 'x')]]`. So same set of solutions than with py2, but matchings are reported in a different order, and the order of edges of each matching is different.

The proposed change is more stable with py2 and py3.

An alternative is to do:

```
sage: def compare(A, B):
....:     return Set(map(Set, A)) == Set(map(Set, B))
sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
sage: expected = [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
sage: L = list(G.perfect_matchings(labels=True))
sage: compare(L, expected)
True
```

Should I do that ?



---

archive/issue_comments_378367.json:
```json
{
    "body": "That doesn't explain why this change is necessary. It just seems to replace a brittle test with another brittle test. Why not just run `sorted` on the output (since everything is a `(int, int, str)`, there should be no invalid comparisons)?",
    "created_at": "2019-01-26T20:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378367",
    "user": "tscrim"
}
```

That doesn't explain why this change is necessary. It just seems to replace a brittle test with another brittle test. Why not just run `sorted` on the output (since everything is a `(int, int, str)`, there should be no invalid comparisons)?



---

archive/issue_comments_378368.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-27T09:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378368",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_378369.json:
```json
{
    "body": "I agree. I'm now using `sorted` twice. This doctest should be stable now.",
    "created_at": "2019-01-27T10:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378369",
    "user": "dcoudert"
}
```

I agree. I'm now using `sorted` twice. This doctest should be stable now.



---

archive/issue_comments_378370.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-27T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378370",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_378371.json:
```json
{
    "body": "Thank you.",
    "created_at": "2019-01-27T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378371",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_378372.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-04T23:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26892#issuecomment-378372",
    "user": "vbraun"
}
```

Resolution: fixed
