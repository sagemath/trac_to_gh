# Issue 26892: py3: fix other doctests in graph.py

Issue created by migration from https://trac.sagemath.org/ticket/27129

Original creator: dcoudert

Original creation time: 2019-01-25 15:44:08

Keywords: py3, graph

We change some doctests in `cliques_containing_vertex` and `perfect_matchings` to support py3.


---

Comment by dcoudert created at 2019-01-25 15:47:13

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-01-25 15:47:13

With #27125 and #27127, this should fix all (currently) failing doctests with py3 in file `graph.py`.
----
New commits:


---

Comment by tscrim created at 2019-01-25 19:57:24

Can you explain why this change is necessary?

```diff
-            sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
+            sage: G = Graph([(0, 1, 'a'), (0, 3, 'b'), (1, 2, 'c'), (2, 3, 'd')])
             sage: list(G.perfect_matchings(labels=True))
-            [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
+            [[(0, 1, 'a'), (2, 3, 'd')], [(0, 3, 'b'), (1, 2, 'c')]]
```



---

Comment by dcoudert created at 2019-01-26 09:23:04

Essentially the same motivation as in [https://trac.sagemath.org/ticket/27127#comment:3](https://trac.sagemath.org/ticket/27127#comment:3). The order in which vertices are visited is not always the same in py2 and py3, and so the order in which solutions are discovered may differ.

Here, with py3, we get `[[(-1, 1, 'a'), (-2, 2, 'b')], [(-1, 2, 'y'), (-2, 1, 'x')]]`. So same set of solutions than with py2, but matchings are reported in a different order, and the order of edges of each matching is different.

The proposed change is more stable with py2 and py3.

An alternative is to do:

```
sage: def compare(A, B):
....:     return Set(map(Set, A)) == Set(map(Set, B))
sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
sage: expected = [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
sage: L = list(G.perfect_matchings(labels=True))
sage: compare(L, expected)
True
```

Should I do that ?


---

Comment by tscrim created at 2019-01-26 20:13:12

That doesn't explain why this change is necessary. It just seems to replace a brittle test with another brittle test. Why not just run `sorted` on the output (since everything is a `(int, int, str)`, there should be no invalid comparisons)?


---

Comment by git created at 2019-01-27 09:59:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-01-27 10:01:31

I agree. I'm now using `sorted` twice. This doctest should be stable now.


---

Comment by tscrim created at 2019-01-27 14:49:13

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-01-27 14:49:13

Thank you.


---

Comment by vbraun created at 2019-02-04 23:02:17

Resolution: fixed
