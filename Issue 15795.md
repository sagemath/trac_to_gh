# Issue 15795: Bug in IncidenceStructure.dual_design

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2014-03-30 20:54:44

CC:  dimpase

As the title says.

With some other improvements.

The original code seems to have been written by a mathematician.

Nathann


---

Comment by ncohen created at 2014-03-30 20:55:31

Changing status from new to needs_review.


---

Comment by git created at 2014-03-30 20:57:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2014-03-30 22:05:34

What is the bug in question?


---

Comment by dimpase created at 2014-03-30 22:47:14

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2014-03-30 22:47:14

there is a bug in the optional test: the line 422 in `incidence_structures.py` should be

```
sage: PP = designs.ProjectiveGeometryDesign(2,1,GF(4,'conway'), algorithm="gap") # optional - gap_design
```

actually, it's weird that `ProjectivePlaneDesign` does not known about `algorithm=` at all.
This is a bug to be fixed, IMHO, perhaps on this ticket...

------------------- details -------------

the patch is:

```
--- a/src/sage/combinat/designs/incidence_structures.py
+++ b/src/sage/combinat/designs/incidence_structures.py
`@``@` -419,7 +419,7 `@``@` class IncidenceStructure(object):
             sage: PP = designs.ProjectivePlaneDesign(4)
             sage: PP.dual_design().is_block_design()
             (True, [2, 21, 5, 1])
-            sage: PP = designs.ProjectivePlaneDesign(4, algorithm="gap") # optional - gap_design
+            sage: PP = designs.ProjectiveGeometryDesign(2,1,GF(4,'conway'), algorithm="gap") # optional - gap_design
             sage: PP.dual_design().is_block_design()                     # optional - gap_design
             (True, [2, 21, 5, 1])
```

without it, the test

```
sage -t --long --optional=sage,gap_design src/sage/combinat/designs/incidence_structures.py 
```

fails.


---

Comment by ncohen created at 2014-03-31 07:58:54

Yoooooooo !

> there is a bug in the optional test: the line 422 in `incidence_structures.py` should be
> {{{
> sage: PP = designs.ProjectiveGeometryDesign(2,1,GF(4,'conway'), algorithm="gap") # optional - gap_design
> }}}

Nononono, I meant this "algorithm=gap" to be an argument of the function I tests, i.e. `dual_design`.

And I rename this `gap_design` (which is not even the name of a spkg) to `gap_packages`.

> actually, it's weird that `ProjectivePlaneDesign` does not known about `algorithm=` at all.
> This is a bug to be fixed, IMHO, perhaps on this ticket...

The standard of the bugs I fix is MUCH higher than the bugs that are not fixed in combinat, really. If THIS is a bug their code should not even be allowed to run `:-P`

> without it, the test
> {{{
> sage -t --long --optional=sage,gap_design src/sage/combinat/designs/incidence_structures.py 
> }}}
> fails.

Well, as I said above the "algorithm=gap" was intended for the `dual_block` method. I don't see why we would call gap to compute a dual, but anyway `:-P`

Aaaaaaaaaaaaaand I added this `algorithm` argument in `ProjectivePlane` too.

Nathann


---

Comment by ncohen created at 2014-03-31 07:58:54

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-03-31 07:59:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2014-03-31 08:53:17

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2014-03-31 08:53:17

OK!


---

Comment by ncohen created at 2014-03-31 12:33:44

You don't mind my removing this "if", do you ? `:-PPPPP`

Nathann


---

Comment by git created at 2014-03-31 12:33:54

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-03-31 12:33:54

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2014-03-31 12:39:06

shouldn't these matrices be created sparse?


---

Comment by ncohen created at 2014-03-31 12:40:23

Ahahaha. Yes of course. Do I change that ?

This code is awful, I am already happy to see those two "for" reverted in order to avoid a useless test. Mathematicians should not write code, all they care about is whether the code can be read like a mathematical proof, and efficiency can go to hell.

Nathann


---

Comment by dimpase created at 2014-03-31 12:43:37

Replying to [comment:11 ncohen]:
> Ahahaha. Yes of course. Do I change that ?
yes please...

> 
> This code is awful, I am already happy to see those two "for" reverted in order to avoid a useless test. Mathematicians should not write code, all they care about is whether the code can be read like a mathematical proof, and efficiency can go to hell.

they can be taught to write good code, IMHO :)


---

Comment by ncohen created at 2014-03-31 12:50:00

Yooooooo !

> yes please...

Done !

> they can be taught to write good code, IMHO :)

Probably. But most of your efforts will be wasted, and in the meantime you have to re-do the work when they turn their back.

Nathann


---

Comment by git created at 2014-03-31 12:50:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2014-03-31 13:58:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-31 21:12:31

Resolution: fixed
