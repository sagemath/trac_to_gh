# Issue 23041: Force picklejar permissions test to pass on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/23278

Original creator: embray

Original creation time: 2017-06-19 13:53:44

There's a test in `sage.structure.sage_object` like:


```
        sage: os.chmod(dir, 0o000)
        sage: try:
        ....:     uid = os.getuid()
        ....: except AttributeError:
        ....:     uid = -1
        sage: if uid==0:
        ....:     raise OSError('You must not run the doctests as root, geez!')
        ....: else:
        ....:     sage.structure.sage_object.picklejar(1, dir + '/noaccess')
        Traceback (most recent call last):
        ...
        OSError: ...
```


This test normally works for me on my personal system, even under Cygwin.  However, I'm setting up the Cygwin patchbot, and found that this test always fails.

Although this can be worked around, this test can never be made truly reliable on Cygwin.  This is because Windows file permissions (ACLs) are much more complicated than traditional Unix permissions.  Cygwin (depending on how it's configured) can try to emulate Unix permissions on top of Windows ACLs, but there are holes in the system.  For example it's _possible_ to set `0o000` on a directory, but still have it be writable by the current user, especially if that user is an Admin.  

In some sense this scenario is a misconfiguration that can be avoided.  But it's a factor external to Sage that's pretty hard to control, so this test should just be avoided on Cygwin.


---

Comment by embray created at 2017-06-19 14:02:08

Changing keywords from "" to "windows cygwin tests".


---

Comment by embray created at 2017-06-19 14:02:08

Changing status from new to needs_review.


---

Comment by embray created at 2017-06-19 14:02:08

New commits:


---

Comment by tscrim created at 2017-06-20 01:16:53

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-06-20 01:16:53

LGTM.


---

Comment by embray created at 2017-06-20 07:51:01

Changing status from positive_review to needs_work.


---

Comment by embray created at 2017-06-20 07:51:01

Except for the in retrospect obvious syntax error.


---

Comment by git created at 2017-06-20 07:54:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-06-20 07:57:27

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-06-20 08:37:46

Right... <.< >.>


---

Comment by tscrim created at 2017-06-20 08:37:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-22 07:23:24

Resolution: fixed
