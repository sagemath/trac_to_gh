# Issue 25861: using Dokchitser setting direct from pari

archive/issues_025861.json:
```json
{
    "body": "CC:  cremona davidlowry\n\nto replace using the compute_L.gp script\n\nnot yet working.. help is welcome\n\nIssue created by migration from https://trac.sagemath.org/ticket/26098\n\n",
    "created_at": "2018-08-20T14:30:01Z",
    "labels": [
        "number theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "using Dokchitser setting direct from pari",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25861",
    "user": "chapoton"
}
```
CC:  cremona davidlowry

to replace using the compute_L.gp script

not yet working.. help is welcome

Issue created by migration from https://trac.sagemath.org/ticket/26098





---

archive/issue_comments_364931.json:
```json
{
    "body": "Changing keywords from \"\" to \"dokchitser\".",
    "created_at": "2018-08-20T14:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364931",
    "user": "chapoton"
}
```

Changing keywords from "" to "dokchitser".



---

archive/issue_comments_364932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-20T14:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364932",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-20T18:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364933",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364934.json:
```json
{
    "body": "Good idea! It's something that I always wanted to do but never found the time...\n\nSome immediate comments:\n\n1. Regarding\n\n```\n\"\"\"\nDokchitser's L-functions Calculator from Pari\n\nAUTHORS:\n\n- Tim Dokchitser (2002): original PARI code and algorithm (and the\n  documentation below is based on Dokchitser's docs).\n\n- William Stein (2006-03-08): Sage interface\n\n\"\"\"\n```\n\n\nTo what extent is this related to code from Dokchitser or Stein? If the answer is \"not at all\", then the author block, the copyright block, the name of the module and the name of the class `Dokchitser_Pari` should be fixed.\n\n2. Assigning `self.pari = Pari()` looks strange as there is really one PARI running. Better be honest about that and use a single global `pari` variable (you can import it from `sage.libs.pari`).\n\n3. `self.pari('default(realprecision, %s)')` is a bad idea for multiple reasons. The proper way to deal with precisions in library mode is either to set the precision argument for every function call or to use inexact inputs.\n\n4. Avoid using global PARI variables like in the `pari_precode` example `tau(n)=...`. Remember that there is only one global PARI instance, so global variables are global state! If you want functions, why not use actual functions (using the `->` syntax)?",
    "created_at": "2018-08-20T22:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364934",
    "user": "jdemeyer"
}
```

Good idea! It's something that I always wanted to do but never found the time...

Some immediate comments:

1. Regarding

```
"""
Dokchitser's L-functions Calculator from Pari

AUTHORS:

- Tim Dokchitser (2002): original PARI code and algorithm (and the
  documentation below is based on Dokchitser's docs).

- William Stein (2006-03-08): Sage interface

"""
```


To what extent is this related to code from Dokchitser or Stein? If the answer is "not at all", then the author block, the copyright block, the name of the module and the name of the class `Dokchitser_Pari` should be fixed.

2. Assigning `self.pari = Pari()` looks strange as there is really one PARI running. Better be honest about that and use a single global `pari` variable (you can import it from `sage.libs.pari`).

3. `self.pari('default(realprecision, %s)')` is a bad idea for multiple reasons. The proper way to deal with precisions in library mode is either to set the precision argument for every function call or to use inexact inputs.

4. Avoid using global PARI variables like in the `pari_precode` example `tau(n)=...`. Remember that there is only one global PARI instance, so global variables are global state! If you want functions, why not use actual functions (using the `->` syntax)?



---

archive/issue_comments_364935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T09:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T09:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364936",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T09:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364938.json:
```json
{
    "body": "Some more comments:\n\n5. You can replace `pari.FUNCTION(pari(FOO))` by `pari.FUNCTION(FOO)`.\n\n6. It is still not clear to me why you keeping using \"dokchitser\" (I may be missing something, but then it should be clarified)\n\n7. Using the `.sage()` method is often not the best way to convert a PARI object to Sage because you loose information about the parent. For example:\n\n```\nsage: x = RR.pi()\nsage: parix = pari(x)\nsage: parent(parix.sage())\nReal Field with 64 bits of precision\n```\n\nIt would be better to replace `parix.sage()` by `RR(parix)` in this case.",
    "created_at": "2018-08-21T09:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364938",
    "user": "jdemeyer"
}
```

Some more comments:

5. You can replace `pari.FUNCTION(pari(FOO))` by `pari.FUNCTION(FOO)`.

6. It is still not clear to me why you keeping using "dokchitser" (I may be missing something, but then it should be clarified)

7. Using the `.sage()` method is often not the best way to convert a PARI object to Sage because you loose information about the parent. For example:

```
sage: x = RR.pi()
sage: parix = pari(x)
sage: parent(parix.sage())
Real Field with 64 bits of precision
```

It would be better to replace `parix.sage()` by `RR(parix)` in this case.



---

archive/issue_comments_364939.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> Some more comments:\n> \n> 5. You can replace `pari.FUNCTION(pari(FOO))` by `pari.FUNCTION(FOO)`.\n\nwill do\n\n> 6. It is still not clear to me why you keeping using \"dokchitser\" (I may be missing something, but then it should be clarified)\n\nThere are Dokchitser's algorithms (described in a famous article in Experimental Math) and Dokchitser's implementation of them (that we use so far). Pari is using (maybe an enhanced version of) the algorithms of Dokchitser or at least similar basic ideas.",
    "created_at": "2018-08-21T10:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364939",
    "user": "chapoton"
}
```

Replying to [comment:9 jdemeyer]:
> Some more comments:
> 
> 5. You can replace `pari.FUNCTION(pari(FOO))` by `pari.FUNCTION(FOO)`.

will do

> 6. It is still not clear to me why you keeping using "dokchitser" (I may be missing something, but then it should be clarified)

There are Dokchitser's algorithms (described in a famous article in Experimental Math) and Dokchitser's implementation of them (that we use so far). Pari is using (maybe an enhanced version of) the algorithms of Dokchitser or at least similar basic ideas.



---

archive/issue_comments_364940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T10:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364940",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T12:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364941",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364942.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-21T12:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364942",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_364943.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> Pari is using (maybe an enhanced version of) the algorithms of Dokchitser or at least similar basic ideas.\n\nI don't think that is sufficient reason to use the name \"Dokchitser\". Personally, I think it is especially confusing because we also have Dokchitser's GP scripts (where he is the actual author). I would rather name the module `lfunctions_pari.py` or something along those lines.",
    "created_at": "2018-08-21T12:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364943",
    "user": "jdemeyer"
}
```

Replying to [comment:10 chapoton]:
> Pari is using (maybe an enhanced version of) the algorithms of Dokchitser or at least similar basic ideas.

I don't think that is sufficient reason to use the name "Dokchitser". Personally, I think it is especially confusing because we also have Dokchitser's GP scripts (where he is the actual author). I would rather name the module `lfunctions_pari.py` or something along those lines.



---

archive/issue_comments_364944.json:
```json
{
    "body": "here is a new branch, with squashed commits\n\nWhat is still lacking is a correct handling of precision\n\nTo people of lmfdb, is this something of interest for you ?\n----\nNew commits:",
    "created_at": "2018-08-21T15:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364944",
    "user": "chapoton"
}
```

here is a new branch, with squashed commits

What is still lacking is a correct handling of precision

To people of lmfdb, is this something of interest for you ?
----
New commits:



---

archive/issue_comments_364945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T15:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-21T15:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364947.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-21T15:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364947",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364948.json:
```json
{
    "body": "Replying to [comment:15 chapoton]:\n> What is still lacking is a correct handling of precision\n\nEvery function where precision matters takes a `precision` argument. For example\n\n```\nsage: pari(1).sin(precision=64).sage()\n0.841470984807896507\nsage: pari(1).sin(precision=256).sage()\n0.8414709848078965066525023216302989996225630607983710656727517099919104043912\n```\n",
    "created_at": "2018-08-21T18:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364948",
    "user": "jdemeyer"
}
```

Replying to [comment:15 chapoton]:
> What is still lacking is a correct handling of precision

Every function where precision matters takes a `precision` argument. For example

```
sage: pari(1).sin(precision=64).sage()
0.841470984807896507
sage: pari(1).sin(precision=256).sage()
0.8414709848078965066525023216302989996225630607983710656727517099919104043912
```




---

archive/issue_comments_364949.json:
```json
{
    "body": "It would be nice to support calling `lfuncreate` in `LFunction.__init__`. Something like\n\n```\n        if isinstance(lfun, lfun_generic):\n            # preparation using Dokchitser data\n            self._L = lfun.lfun()\n        elif isinstance(lfun, Gen):\n            # already some Pari lfun\n            self._L = lfun\n        else:\n            # create a PARI lfunction from input data\n            self._L = pari.lfuncreate(lfun)\n```\n\nThis would remove the need for `lfun_elliptic_curve()` and `lfun_number_field()`.",
    "created_at": "2018-08-21T19:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364949",
    "user": "jdemeyer"
}
```

It would be nice to support calling `lfuncreate` in `LFunction.__init__`. Something like

```
        if isinstance(lfun, lfun_generic):
            # preparation using Dokchitser data
            self._L = lfun.lfun()
        elif isinstance(lfun, Gen):
            # already some Pari lfun
            self._L = lfun
        else:
            # create a PARI lfunction from input data
            self._L = pari.lfuncreate(lfun)
```

This would remove the need for `lfun_elliptic_curve()` and `lfun_number_field()`.



---

archive/issue_comments_364950.json:
```json
{
    "body": "Note that PARI functions also act as methods. So you could replace\n\n```\npari.lfun(self._L, s)\n```\n\nby the simpler\n\n```\nself._L.lfun(s)\n```\n",
    "created_at": "2018-08-21T19:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364950",
    "user": "jdemeyer"
}
```

Note that PARI functions also act as methods. So you could replace

```
pari.lfun(self._L, s)
```

by the simpler

```
self._L.lfun(s)
```




---

archive/issue_comments_364951.json:
```json
{
    "body": "Concerning precision, this is not so easy..\n\n```\nsage: from sage.lfunctions.lfunctions_pari import *\nsage: lf = lfun_number_field(QQ)\nsage: pari.lfun(lf, 2)\n1.64493406684823\nsage: pari.lfun(lf, 2, precision=200)\n1.64493406684823\nsage: pari.lfun(lf, ComplexField(200)(2))\n1.64493406684823\n```\n\n\n\nI also have a difficulty with passing a function as you suggested.",
    "created_at": "2018-08-21T19:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364951",
    "user": "chapoton"
}
```

Concerning precision, this is not so easy..

```
sage: from sage.lfunctions.lfunctions_pari import *
sage: lf = lfun_number_field(QQ)
sage: pari.lfun(lf, 2)
1.64493406684823
sage: pari.lfun(lf, 2, precision=200)
1.64493406684823
sage: pari.lfun(lf, ComplexField(200)(2))
1.64493406684823
```



I also have a difficulty with passing a function as you suggested.



---

archive/issue_comments_364952.json:
```json
{
    "body": "Replying to [comment:23 chapoton]:\n> Concerning precision, this is not so easy..\n\nDon't confuse the printed output by PARI with the actual output. Try again adding `.sage()` to those examples.",
    "created_at": "2018-08-21T19:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364952",
    "user": "jdemeyer"
}
```

Replying to [comment:23 chapoton]:
> Concerning precision, this is not so easy..

Don't confuse the printed output by PARI with the actual output. Try again adding `.sage()` to those examples.



---

archive/issue_comments_364953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T19:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364954.json:
```json
{
    "body": "Replying to [comment:23 chapoton]:\n> I also have a difficulty with passing a function as you suggested.\n\nAre you getting the error `incorrect type in vecan_closure [wrong arity] (t_CLOSURE)`? That could be considered a `cypari2` bug.",
    "created_at": "2018-08-21T19:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364954",
    "user": "jdemeyer"
}
```

Replying to [comment:23 chapoton]:
> I also have a difficulty with passing a function as you suggested.

Are you getting the error `incorrect type in vecan_closure [wrong arity] (t_CLOSURE)`? That could be considered a `cypari2` bug.



---

archive/issue_comments_364955.json:
```json
{
    "body": "Support for functions in `cypari2` is still incomplete, but this hack works for me:\n\n```\nsage: def zeta_coeffs(n):\n....:     return [1 for i in range(n)]\nsage: zeta = pari.lfuncreate([pari(\"f -> (n -> f(n))\")(zeta_coeffs), 1, [0], 1, 1, 1, 1])\n```\n\n\nIt's quite important to keep a reference to the function `zeta_coeffs`, otherwise this will crash.",
    "created_at": "2018-08-21T19:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364955",
    "user": "jdemeyer"
}
```

Support for functions in `cypari2` is still incomplete, but this hack works for me:

```
sage: def zeta_coeffs(n):
....:     return [1 for i in range(n)]
sage: zeta = pari.lfuncreate([pari("f -> (n -> f(n))")(zeta_coeffs), 1, [0], 1, 1, 1, 1])
```


It's quite important to keep a reference to the function `zeta_coeffs`, otherwise this will crash.



---

archive/issue_comments_364956.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T19:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364956",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-23T19:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364957",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364958.json:
```json
{
    "body": "some things that remain to be done:\n\n* be able to have L function for Dirichlet characters\n* fix the doctest with Ramanujan tau, how to handle that ?\n* make sure that poles and residues are handled correctly",
    "created_at": "2018-08-23T19:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364958",
    "user": "chapoton"
}
```

some things that remain to be done:

* be able to have L function for Dirichlet characters
* fix the doctest with Ramanujan tau, how to handle that ?
* make sure that poles and residues are handled correctly



---

archive/issue_comments_364959.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-24T18:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364959",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-25T07:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364961.json:
```json
{
    "body": "according to K. Belabas, one should rather wait for pari 2.11",
    "created_at": "2018-08-25T07:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364961",
    "user": "chapoton"
}
```

according to K. Belabas, one should rather wait for pari 2.11



---

archive/issue_comments_364962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-25T14:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364962",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-28T06:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-29T15:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364964",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-03T12:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364965",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364966.json:
```json
{
    "body": "Still not able to make that work:\n\n```\n+        sage: from sage.lfunctions.lfunctions_pari import lfun_generic, LFunction\n+        sage: lf = lfun_generic(conductor=1, gammaV=[0,1], weight=12, eps=1)\n+        sage: tau = pari('n->(5*sigma(n,3)+7*sigma(n,5))*n/12 - 35*sum(k=1,n-1,(6*k-4*(n-k))*sigma(k,3)*sigma(n-k,5))')\n+        sage: lf.init_coeffs(tau)\n+        sage: L = LFunction(lf)\n```\n",
    "created_at": "2018-09-04T19:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364966",
    "user": "chapoton"
}
```

Still not able to make that work:

```
+        sage: from sage.lfunctions.lfunctions_pari import lfun_generic, LFunction
+        sage: lf = lfun_generic(conductor=1, gammaV=[0,1], weight=12, eps=1)
+        sage: tau = pari('n->(5*sigma(n,3)+7*sigma(n,5))*n/12 - 35*sum(k=1,n-1,(6*k-4*(n-k))*sigma(k,3)*sigma(n-k,5))')
+        sage: lf.init_coeffs(tau)
+        sage: L = LFunction(lf)
```




---

archive/issue_comments_364967.json:
```json
{
    "body": "To make it easier for me to help, it would be good to say why it doesn't work. I don't want to recompile this branch this branch every time just to answer your comments.",
    "created_at": "2018-09-04T19:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364967",
    "user": "jdemeyer"
}
```

To make it easier for me to help, it would be good to say why it doesn't work. I don't want to recompile this branch this branch every time just to answer your comments.



---

archive/issue_comments_364968.json:
```json
{
    "body": "Well.\n\n```\nsage: from sage.lfunctions.lfunctions_pari import lfun_generic, LFunction\nsage: lf = lfun_generic(conductor=1, gammaV=[0,1], weight=12, eps=1)\nsage: tau = pari('n->(5*sigma(n,3)+7*sigma(n,5))*n/12 - 35*sum(k=1,n-1,(6*k-4*(n\n....: -k))*sigma(k,3)*sigma(n-k,5))')\nsage: lf.init_coeffs(tau)\nsage: L = LFunction(lf)\n```\n\nAll this works, or seems to. But here is the traceback.\n\n```\nsage: L(5)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n<ipython-input-6-fd3c681015b7> in <module>()\n----> 1 L(Integer(5))\n\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/lfunctions/lfunctions_pari.pyc in __call__(self, s)\n    635             pass\n    636         try:\n--> 637             value = pari.lfun(self._L, s, precision=self.prec).sage()\n    638         except NameError:\n    639             raise ArithmeticError('pole here')\n\ncypari2/auto_instance.pxi in cypari2.pari_instance.Pari_auto.lfun()\n\ncypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()\n\nPariError: incorrect type in vecan_closure (t_INT)\n```\n\nNot clear to me where this \"t_INT\" could come from. And the failure appears only at a late stage..",
    "created_at": "2018-09-04T20:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364968",
    "user": "chapoton"
}
```

Well.

```
sage: from sage.lfunctions.lfunctions_pari import lfun_generic, LFunction
sage: lf = lfun_generic(conductor=1, gammaV=[0,1], weight=12, eps=1)
sage: tau = pari('n->(5*sigma(n,3)+7*sigma(n,5))*n/12 - 35*sum(k=1,n-1,(6*k-4*(n
....: -k))*sigma(k,3)*sigma(n-k,5))')
sage: lf.init_coeffs(tau)
sage: L = LFunction(lf)
```

All this works, or seems to. But here is the traceback.

```
sage: L(5)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
<ipython-input-6-fd3c681015b7> in <module>()
----> 1 L(Integer(5))

/home/chapoton/sage/local/lib/python2.7/site-packages/sage/lfunctions/lfunctions_pari.pyc in __call__(self, s)
    635             pass
    636         try:
--> 637             value = pari.lfun(self._L, s, precision=self.prec).sage()
    638         except NameError:
    639             raise ArithmeticError('pole here')

cypari2/auto_instance.pxi in cypari2.pari_instance.Pari_auto.lfun()

cypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()

PariError: incorrect type in vecan_closure (t_INT)
```

Not clear to me where this "t_INT" could come from. And the failure appears only at a late stage..



---

archive/issue_comments_364969.json:
```json
{
    "body": "The function is supposed to return a vector with `n` components, not a single number. See the docs for `lfuncreate`.\n\nSo you should conceptually replace `n->f(n)` by `n->vector(n, k, f(k))`.",
    "created_at": "2018-09-04T20:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364969",
    "user": "jdemeyer"
}
```

The function is supposed to return a vector with `n` components, not a single number. See the docs for `lfuncreate`.

So you should conceptually replace `n->f(n)` by `n->vector(n, k, f(k))`.



---

archive/issue_comments_364970.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-05T15:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364970",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364971.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-08T19:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364971",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364972.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-08T20:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364972",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364973.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T08:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364973",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364974.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T09:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364974",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364975.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T13:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364975",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364976.json:
```json
{
    "body": "ok, bot is green. Maybe ready for a first review ?",
    "created_at": "2018-09-09T17:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364976",
    "user": "chapoton"
}
```

ok, bot is green. Maybe ready for a first review ?



---

archive/issue_comments_364977.json:
```json
{
    "body": "Just a few quick comments to start with, as I have not yet built the code or looked in detail at the new interface:\n\n1. In the example for a Dirichlet L-function can you add the display of L itself to show the effect of its having been renamed?\n\n2. The docstring for delta_lseries is surely wrong: only one of the options interfaces with the (soon to be obsolete?) code of Tim Dok.  And why is the default not the new pari version?  Same for Dedekind Zeta.\n\n3. Should we have some examples computed with both gp and pari to show how they compare?",
    "created_at": "2018-09-09T18:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364977",
    "user": "cremona"
}
```

Just a few quick comments to start with, as I have not yet built the code or looked in detail at the new interface:

1. In the example for a Dirichlet L-function can you add the display of L itself to show the effect of its having been renamed?

2. The docstring for delta_lseries is surely wrong: only one of the options interfaces with the (soon to be obsolete?) code of Tim Dok.  And why is the default not the new pari version?  Same for Dedekind Zeta.

3. Should we have some examples computed with both gp and pari to show how they compare?



---

archive/issue_comments_364978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T19:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364978",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T19:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364979",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364980.json:
```json
{
    "body": "Replying to [comment:52 cremona]:\n> Just a few quick comments to start with, as I have not yet built the code or looked in detail at the new interface:\n> \n>    1. In the example for a Dirichlet L-function can you add the display of L itself to show the effect of its having been renamed?\n\nSure, done.\n\n>    2. The docstring for delta_lseries is surely wrong: only one of the options interfaces with the (soon to be obsolete?) code of Tim Dok.  And why is the default not the new pari version?  Same for Dedekind Zeta.\n\nFixed the docstring of delta_lseries\n\nConcerning the switch to \"pari\" by default, maybe this new interface is not yet mature enough.\n \n>    3. Should we have some examples computed with both gp and pari to show how they compare?\n\nBut this is already the case, I think.",
    "created_at": "2018-09-09T19:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364980",
    "user": "chapoton"
}
```

Replying to [comment:52 cremona]:
> Just a few quick comments to start with, as I have not yet built the code or looked in detail at the new interface:
> 
>    1. In the example for a Dirichlet L-function can you add the display of L itself to show the effect of its having been renamed?

Sure, done.

>    2. The docstring for delta_lseries is surely wrong: only one of the options interfaces with the (soon to be obsolete?) code of Tim Dok.  And why is the default not the new pari version?  Same for Dedekind Zeta.

Fixed the docstring of delta_lseries

Concerning the switch to "pari" by default, maybe this new interface is not yet mature enough.
 
>    3. Should we have some examples computed with both gp and pari to show how they compare?

But this is already the case, I think.



---

archive/issue_comments_364981.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T19:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364981",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364982.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-09T19:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364982",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364983.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T19:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364983",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364984.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-09T20:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364984",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364985.json:
```json
{
    "body": "As I mentioned before, try to avoid using the `.sage()` method for PARI objects, as it doesn't give control over the resulting parent. In general, an explicit conversion like\n\n```\nR(pari_object)\n```\n\nshould be preferred over\n\n```\npari_object.sage()\n```\n",
    "created_at": "2018-09-10T10:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364985",
    "user": "jdemeyer"
}
```

As I mentioned before, try to avoid using the `.sage()` method for PARI objects, as it doesn't give control over the resulting parent. In general, an explicit conversion like

```
R(pari_object)
```

should be preferred over

```
pari_object.sage()
```




---

archive/issue_comments_364986.json:
```json
{
    "body": "In other words: the `.sage()` method exists mostly for convenience, not for correctness.",
    "created_at": "2018-09-10T10:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364986",
    "user": "jdemeyer"
}
```

In other words: the `.sage()` method exists mostly for convenience, not for correctness.



---

archive/issue_comments_364987.json:
```json
{
    "body": "The changes to `src/sage/schemes/elliptic_curves/ell_generic.py` look independent from the rest of this ticket, could they be split off?",
    "created_at": "2018-09-10T10:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364987",
    "user": "jdemeyer"
}
```

The changes to `src/sage/schemes/elliptic_curves/ell_generic.py` look independent from the rest of this ticket, could they be split off?



---

archive/issue_comments_364988.json:
```json
{
    "body": "I have separated the change in pari conversion of elliptic curves over number fields (#26232).",
    "created_at": "2018-09-10T12:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364988",
    "user": "chapoton"
}
```

I have separated the change in pari conversion of elliptic curves over number fields (#26232).



---

archive/issue_comments_364989.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-10T12:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364989",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364990.json:
```json
{
    "body": "Not using \".sage()\" seems to result in 3 or 4 less digits...",
    "created_at": "2018-09-10T12:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364990",
    "user": "chapoton"
}
```

Not using ".sage()" seems to result in 3 or 4 less digits...



---

archive/issue_comments_364991.json:
```json
{
    "body": "I agree with `@`jdemeyer that using x.sage() is dangerous.  I am right now writing code which gets some quite complicated data back from gp functions and am having to write customised conversion functions.",
    "created_at": "2018-09-10T13:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364991",
    "user": "cremona"
}
```

I agree with `@`jdemeyer that using x.sage() is dangerous.  I am right now writing code which gets some quite complicated data back from gp functions and am having to write customised conversion functions.



---

archive/issue_comments_364992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-20T19:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364992",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364993.json:
```json
{
    "body": "the remaining failing doctest is due to the dependency to #26232",
    "created_at": "2018-09-21T15:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364993",
    "user": "chapoton"
}
```

the remaining failing doctest is due to the dependency to #26232



---

archive/issue_comments_364994.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-05T08:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364994",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364995.json:
```json
{
    "body": "Replacing the last .sage() seems to result in 3 less digits in the results. Should I do that nevertheless ?\n\n```\nFailed example:\n    L(2)\nExpected:\n    1.64493406684822644\nGot:\n    1.64493406684823\n```\n",
    "created_at": "2018-10-10T06:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364995",
    "user": "chapoton"
}
```

Replacing the last .sage() seems to result in 3 less digits in the results. Should I do that nevertheless ?

```
Failed example:
    L(2)
Expected:
    1.64493406684822644
Got:
    1.64493406684823
```




---

archive/issue_comments_364996.json:
```json
{
    "body": "Do you mean that it shows fewer decimals with .sage() than without?  When converting to/from pari remember that Sage allows any bit precision but pari only allows multiples of 32 (or something like that).  So often the underlying pari computation is more precise than necessary.",
    "created_at": "2018-10-10T08:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364996",
    "user": "cremona"
}
```

Do you mean that it shows fewer decimals with .sage() than without?  When converting to/from pari remember that Sage allows any bit precision but pari only allows multiples of 32 (or something like that).  So often the underlying pari computation is more precise than necessary.



---

archive/issue_comments_364997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-10T19:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364997",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364998.json:
```json
{
    "body": "Any other comment on this proposal ? I feel that this is not quite polished, but maybe already useful. I would appreciate feedback.",
    "created_at": "2018-11-09T13:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364998",
    "user": "chapoton"
}
```

Any other comment on this proposal ? I feel that this is not quite polished, but maybe already useful. I would appreciate feedback.



---

archive/issue_comments_364999.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-18T16:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-364999",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_365000.json:
```json
{
    "body": "Rebased to 8.7.beta5 (fixed trivial merge conflict).\n----\nNew commits:",
    "created_at": "2019-02-25T09:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365000",
    "user": "jdemeyer"
}
```

Rebased to 8.7.beta5 (fixed trivial merge conflict).
----
New commits:



---

archive/issue_comments_365001.json:
```json
{
    "body": "I have various comments, but it's probably easier for both of us if I just add an extra commit.",
    "created_at": "2019-02-25T10:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365001",
    "user": "jdemeyer"
}
```

I have various comments, but it's probably easier for both of us if I just add an extra commit.



---

archive/issue_comments_365002.json:
```json
{
    "body": "Yes, for sure. Please do.",
    "created_at": "2019-02-25T12:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365002",
    "user": "chapoton"
}
```

Yes, for sure. Please do.



---

archive/issue_comments_365003.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-25T16:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365003",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_365004.json:
```json
{
    "body": "This is very much work in progress. I'm currently working on cypari2 to add support for `__floordiv__` (for some reason, this was missing) and closures of a given arity. That will help for this ticket.",
    "created_at": "2019-02-25T16:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365004",
    "user": "jdemeyer"
}
```

This is very much work in progress. I'm currently working on cypari2 to add support for `__floordiv__` (for some reason, this was missing) and closures of a given arity. That will help for this ticket.



---

archive/issue_comments_365005.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-25T16:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365005",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_365006.json:
```json
{
    "body": "Changing keywords from \"dokchitser\" to \"dokchitser, lseries, zeta\".",
    "created_at": "2019-03-08T19:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365006",
    "user": "chapoton"
}
```

Changing keywords from "dokchitser" to "dokchitser, lseries, zeta".



---

archive/issue_comments_365007.json:
```json
{
    "body": "`@`jdemeyer, is the cypari part now ok ? I have seen the floordiv was added.",
    "created_at": "2019-03-16T17:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365007",
    "user": "chapoton"
}
```

`@`jdemeyer, is the cypari part now ok ? I have seen the floordiv was added.



---

archive/issue_comments_365008.json:
```json
{
    "body": "Yes indeed, I added some functionality to cypari2.",
    "created_at": "2019-03-16T20:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365008",
    "user": "jdemeyer"
}
```

Yes indeed, I added some functionality to cypari2.



---

archive/issue_comments_365009.json:
```json
{
    "body": "I have fixed some of the doctests. But I am slightly worried by the increase in the number of required coefficients.\n----\nNew commits:",
    "created_at": "2019-03-17T08:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365009",
    "user": "chapoton"
}
```

I have fixed some of the doctests. But I am slightly worried by the increase in the number of required coefficients.
----
New commits:



---

archive/issue_comments_365010.json:
```json
{
    "body": "One thing to note is that the default precision with the PARI implementation is 53, but it was 64 with the GP scripts.",
    "created_at": "2019-03-17T10:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365010",
    "user": "jdemeyer"
}
```

One thing to note is that the default precision with the PARI implementation is 53, but it was 64 with the GP scripts.



---

archive/issue_comments_365011.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365011",
    "user": "embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_365012.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-16T10:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365012",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_365013.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-16T10:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365013",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_365014.json:
```json
{
    "body": "doctests fixed, back to needs review",
    "created_at": "2019-04-16T10:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365014",
    "user": "chapoton"
}
```

doctests fixed, back to needs review



---

archive/issue_comments_365015.json:
```json
{
    "body": "and the bot is now green",
    "created_at": "2019-04-16T11:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365015",
    "user": "chapoton"
}
```

and the bot is now green



---

archive/issue_comments_365016.json:
```json
{
    "body": "A comment and a question:\n\n`RANK 1 ELLIPTIC CURVE:` -> `.. RUBRIC:: Rank 1 elliptic curve` (see, e.g., `combinat/root_system/cartan_type.py`)\n\nShould `init_coeffs` be exposed to the user as a public function? If so, should it be allowed to be run multiple times?",
    "created_at": "2019-04-17T22:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365016",
    "user": "tscrim"
}
```

A comment and a question:

`RANK 1 ELLIPTIC CURVE:` -> `.. RUBRIC:: Rank 1 elliptic curve` (see, e.g., `combinat/root_system/cartan_type.py`)

Should `init_coeffs` be exposed to the user as a public function? If so, should it be allowed to be run multiple times?



---

archive/issue_comments_365017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-24T11:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365017",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_365018.json:
```json
{
    "body": "Can we please try to move on here ? This seems to me to be a progress over the current situation, even if a tiny one.\n\nI think one can keep `init_coeffs` as a public method, to be used as explained:\n\n```\n+        Initialisation of a :pari:`lfun` from motivic data.\n+\n+        This can happen either in one stage or in two stages: the coefficients\n+        can be given using the ``init`` keyword, or entered using\n+        the :meth:`init_coeffs`.\n```\n\n\nThere remains something not very clear about the handling of poles and residues.\n\nI would like to get more feedback from lmfdb or pari people.",
    "created_at": "2019-05-22T15:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365018",
    "user": "chapoton"
}
```

Can we please try to move on here ? This seems to me to be a progress over the current situation, even if a tiny one.

I think one can keep `init_coeffs` as a public method, to be used as explained:

```
+        Initialisation of a :pari:`lfun` from motivic data.
+
+        This can happen either in one stage or in two stages: the coefficients
+        can be given using the ``init`` keyword, or entered using
+        the :meth:`init_coeffs`.
```


There remains something not very clear about the handling of poles and residues.

I would like to get more feedback from lmfdb or pari people.



---

archive/issue_comments_365019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-25T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_365020.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365020",
    "user": "embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_365021.json:
```json
{
    "body": "bot is morally green",
    "created_at": "2019-07-13T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365021",
    "user": "chapoton"
}
```

bot is morally green



---

archive/issue_comments_365022.json:
```json
{
    "body": "Sorry for taking time to get back to this.\n\nI do not quite understand the necessity of the `init_coeffs` method. I feel like there would be more standard ways to refactor that out (for example, just allowing initialization as normal). Or is this meant to be something done more lazily? You could also remove the `__init` attribute by just setting `self._L = None` in the `__init__` and checking against that.\n\nA little bit better doc formatting IMO:\n\n```diff\n-    Create a PARI `L`-function (:pari:`lfun` instance) with\n+    Create a PARI `L`-function (:pari:`lfun` instance) with::\n \n-    ``lfun_generic(conductor, gammaV, weight, eps, poles, residues, init)``\n+        lfun_generic(conductor, gammaV, weight, eps, poles, residues, init)\n```\n\n\nThis seems dubious to me:\n\n```python\n    values_on_gens = (chi(x) for x in pari_gens)\n\n    # now compute the input for pari (list of exponents)\n    P = chi.parent()\n    if is_ComplexField(P.base_ring()):\n        zeta = P.zeta()\n        zeta_argument = zeta.argument()\n        v = [int(round(x.argument() / zeta_argument))\n             for x in values_on_gens()]   # <<<---- This part here\n    else:\n        dlog = P._zeta_dlog\n        v = [dlog[x] for x in values_on_gens]\n```\n\nwith `value_on_gens` being a generator object, I don't think it should be callable.\n\n`check_functional_equation` could use some more standard docstring formatting.\n\nOtherwise everything else LGTM. A lot of these points I do not care about too much (since I doubt I will ever use this code because it is outside my research area), but I still feel it is worth a quick moment of thought.",
    "created_at": "2019-07-13T17:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365022",
    "user": "tscrim"
}
```

Sorry for taking time to get back to this.

I do not quite understand the necessity of the `init_coeffs` method. I feel like there would be more standard ways to refactor that out (for example, just allowing initialization as normal). Or is this meant to be something done more lazily? You could also remove the `__init` attribute by just setting `self._L = None` in the `__init__` and checking against that.

A little bit better doc formatting IMO:

```diff
-    Create a PARI `L`-function (:pari:`lfun` instance) with
+    Create a PARI `L`-function (:pari:`lfun` instance) with::
 
-    ``lfun_generic(conductor, gammaV, weight, eps, poles, residues, init)``
+        lfun_generic(conductor, gammaV, weight, eps, poles, residues, init)
```


This seems dubious to me:

```python
    values_on_gens = (chi(x) for x in pari_gens)

    # now compute the input for pari (list of exponents)
    P = chi.parent()
    if is_ComplexField(P.base_ring()):
        zeta = P.zeta()
        zeta_argument = zeta.argument()
        v = [int(round(x.argument() / zeta_argument))
             for x in values_on_gens()]   # <<<---- This part here
    else:
        dlog = P._zeta_dlog
        v = [dlog[x] for x in values_on_gens]
```

with `value_on_gens` being a generator object, I don't think it should be callable.

`check_functional_equation` could use some more standard docstring formatting.

Otherwise everything else LGTM. A lot of these points I do not care about too much (since I doubt I will ever use this code because it is outside my research area), but I still feel it is worth a quick moment of thought.



---

archive/issue_comments_365023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-14T08:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_365024.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-21T01:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365024",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_365025.json:
```json
{
    "body": "Thanks. LGTM. (Sorry, I didn't notice the update.)",
    "created_at": "2019-08-21T01:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365025",
    "user": "tscrim"
}
```

Thanks. LGTM. (Sorry, I didn't notice the update.)



---

archive/issue_comments_365026.json:
```json
{
    "body": "Regarding the Dirichlet L-functions, see also #16477.  Does this ticket supersede it or at least implement some of it?  (Maybe it only does it for Dirichlet characters and not general arithmetic functions.)",
    "created_at": "2019-08-21T02:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365026",
    "user": "kcrisman"
}
```

Regarding the Dirichlet L-functions, see also #16477.  Does this ticket supersede it or at least implement some of it?  (Maybe it only does it for Dirichlet characters and not general arithmetic functions.)



---

archive/issue_comments_365027.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-29T20:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25861#issuecomment-365027",
    "user": "vbraun"
}
```

Resolution: fixed
