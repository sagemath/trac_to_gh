# Issue 10841: Multiple loops and edges are lost upon pickling

Issue created by migration from https://trac.sagemath.org/ticket/10916

Original creator: nthiery

Original creation time: 2011-03-11 22:08:37

Assignee: jason, ncohen, rlm

CC:  sage-combinat ncohen brunellus

Keywords: graph, pickling

Title says it all:


```
sage: H = DiGraph(loops=True, multiedges=True)
sage: H.add_vertex(0)
sage: H.add_edge((0,0,0))
sage: H.add_edge((0,0,1))
sage: H.add_edge((0,1,0))
sage: H.add_edge((0,1,1))
sage: H.edges()
[(0, 0, 0), (0, 0, 1), (0, 1, 0), (0, 1, 1)]

sage: HH = loads(dumps(H))
sage: HH.edges()
sage: [(0, 0, 1), (0, 1, 1)]
```




---

Comment by brunellus created at 2012-01-21 02:17:33

Changing status from new to needs_review.


---

Attachment

Hellooooooooooo !!

Well, this fixes the bug but it also means that the object that is pickled does not necessarily correspond to the original one, as the new one admits multiple edges `^^;`

What about setting ``multiple_edges = self._multiple_edges`` as it seems to be defined ? And there is an ``allow_loops()`` method for the other argument.

Nathann


---

Comment by ncohen created at 2012-01-22 16:37:05

Changing status from needs_review to needs_work.


---

Comment by brunellus created at 2012-01-22 21:47:59

Hi! I think this is not the case because the DiGraph object is not used in the resulting tuple -- it is just a device to get all arcs. Maybe I don't understand it correctly, but I assume that allow_multiedges is pickled one level higher, in the SparseGraphBackend object.


```
sage: loads(dumps(Graph({0: [1]})))
Graph on 2 vertices
sage: loads(dumps(Graph({0: [1,1]})))
Multi-graph on 2 vertices
```


What do you think?


---

Comment by ncohen created at 2012-01-23 09:49:15

> What do you think?

Quite obviously that I said something stupid `:-)`

Give me a few seconds to give it a more attentive look `:-p`

Nathann


---

Comment by ncohen created at 2012-01-23 09:49:21

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2012-01-23 09:55:55

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2012-01-23 09:55:55

Hmmmm... You are totally right, your patch is good and sound. I do not explain why Sage's source code is written like that, but....
I **really** need to rewrite a lot of stuff there `O_O;;`

Thank you for this patch, and sorry for my stupid remark `:-)`

Nathann


---

Comment by brunellus created at 2012-01-24 11:07:02

Thanks for the fast review! The fix really looks like something everyone would _try_ without any thinking. :-)

Lukáš


---

Comment by jdemeyer created at 2012-02-06 21:23:27

Resolution: fixed
