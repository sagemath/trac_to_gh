# Issue 17441: special values of Bessel functions

archive/issues_017441.json:
```json
{
    "body": "CC:  @fchapoton @fredrik-johansson\n\nAt the moment everything Bessel is sent to mpmath and returns floating point but I<sub>n</sub>(0) and J<sub>n</sub>(0) are in (0,1). Also all I/J/K/Y<sub>n</sub>(x) with n in (-1/2,1/2) is a simple expression.\n\nFor the latter see p.10 of\nhttp://www.math.psu.edu/papikian/Kreh.pdf\n\nIssue created by migration from https://trac.sagemath.org/ticket/17678\n\n",
    "created_at": "2015-01-27T17:14:23Z",
    "labels": [
        "symbolics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "special values of Bessel functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17441",
    "user": "@rwst"
}
```
CC:  @fchapoton @fredrik-johansson

At the moment everything Bessel is sent to mpmath and returns floating point but I<sub>n</sub>(0) and J<sub>n</sub>(0) are in (0,1). Also all I/J/K/Y<sub>n</sub>(x) with n in (-1/2,1/2) is a simple expression.

For the latter see p.10 of
http://www.math.psu.edu/papikian/Kreh.pdf

Issue created by migration from https://trac.sagemath.org/ticket/17678





---

archive/issue_comments_232951.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-28T08:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232951",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232952.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-28T08:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232952",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_232953.json:
```json
{
    "body": "I like the general idea of this ticket!  What happens in the following scenario\n\n```\n+        if x == 0:\n+            if n == 0:\n+                return ZZ(1)\n```\n\nfor \n\n```\nsage: bessel_J(0.0, 0.0)\n1\n```\n\nshould it instead return `1.0`? I feel like we have a lot of code in Sage doing type conversions of this kind smartly - sadly, I was not the one gifted to write it.  Maybe something like saving the parents of the input and if one is inexact then so is the output, something along those lines... we had some issues with `sin(0)` versus `sin(0.0)` even, I think; currently\n\n```\nsage: sin(0)\n0\nsage: sin(0.0)\n0.000000000000000\nsage: sin(float(0))\n0.0\nsage: sin(RDF(0))\n0.0\nsage: sin(complex(0))\n0j\n```\n",
    "created_at": "2015-02-03T03:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232953",
    "user": "@kcrisman"
}
```

I like the general idea of this ticket!  What happens in the following scenario

```
+        if x == 0:
+            if n == 0:
+                return ZZ(1)
```

for 

```
sage: bessel_J(0.0, 0.0)
1
```

should it instead return `1.0`? I feel like we have a lot of code in Sage doing type conversions of this kind smartly - sadly, I was not the one gifted to write it.  Maybe something like saving the parents of the input and if one is inexact then so is the output, something along those lines... we had some issues with `sin(0)` versus `sin(0.0)` even, I think; currently

```
sage: sin(0)
0
sage: sin(0.0)
0.000000000000000
sage: sin(float(0))
0.0
sage: sin(RDF(0))
0.0
sage: sin(complex(0))
0j
```




---

archive/issue_comments_232954.json:
```json
{
    "body": "Replying to [comment:3 kcrisman]:\n> What happens in the following scenario\n> {{{\n> +        if x == 0:\n> +            if n == 0:\n> +                return ZZ(1)\n> }}}\n> for \n> {{{\n> sage: bessel_J(0.0, 0.0)\n> 1\n> }}}\n> should it instead return `1.0`?\nIt does.\n\nIn #17130 Jeroen automatized handling of type in `BuiltinFunction`.",
    "created_at": "2015-02-03T07:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232954",
    "user": "@rwst"
}
```

Replying to [comment:3 kcrisman]:
> What happens in the following scenario
> {{{
> +        if x == 0:
> +            if n == 0:
> +                return ZZ(1)
> }}}
> for 
> {{{
> sage: bessel_J(0.0, 0.0)
> 1
> }}}
> should it instead return `1.0`?
It does.

In #17130 Jeroen automatized handling of type in `BuiltinFunction`.



---

archive/issue_comments_232955.json:
```json
{
    "body": "I guess I didn't internalize that it would fix all future problems with this, very nice.",
    "created_at": "2015-02-03T13:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232955",
    "user": "@kcrisman"
}
```

I guess I didn't internalize that it would fix all future problems with this, very nice.



---

archive/issue_comments_232956.json:
```json
{
    "body": "These identities are also available (or derivable) from Wikipedia and Mathworld, so we are in good shape.\n\nQuestion: [W|A claims](http://www.wolframalpha.com/input/?i=besselj%28-5%2F2%2C0%29) that one has the complex infinity, not positive infinity, for some of the negative ones like `bessel_J(-5/2, 0)` or for `bessel_I`.  I don't know what to make of that, though.  Also, does `bessel_Y` have an analogous special value for x=0, negative n?\n\nOtherwise looks good.",
    "created_at": "2015-02-03T15:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232956",
    "user": "@kcrisman"
}
```

These identities are also available (or derivable) from Wikipedia and Mathworld, so we are in good shape.

Question: [W|A claims](http://www.wolframalpha.com/input/?i=besselj%28-5%2F2%2C0%29) that one has the complex infinity, not positive infinity, for some of the negative ones like `bessel_J(-5/2, 0)` or for `bessel_I`.  I don't know what to make of that, though.  Also, does `bessel_Y` have an analogous special value for x=0, negative n?

Otherwise looks good.



---

archive/issue_comments_232957.json:
```json
{
    "body": "Replying to [comment:6 kcrisman]:\n> Question: [W|A claims](http://www.wolframalpha.com/input/?i=besselj%28-5%2F2%2C0%29) that one has the complex infinity, not positive infinity, for some of the negative ones like `bessel_J(-5/2, 0)` or for `bessel_I`.  I don't know what to make of that, though.\nI got those values from mpmath and just tried to post about that to the mpmath group, but not yet approved.\n> Also, does `bessel_Y` have an analogous special value for x=0, negative n?\nAh, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).",
    "created_at": "2015-02-04T09:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232957",
    "user": "@rwst"
}
```

Replying to [comment:6 kcrisman]:
> Question: [W|A claims](http://www.wolframalpha.com/input/?i=besselj%28-5%2F2%2C0%29) that one has the complex infinity, not positive infinity, for some of the negative ones like `bessel_J(-5/2, 0)` or for `bessel_I`.  I don't know what to make of that, though.
I got those values from mpmath and just tried to post about that to the mpmath group, but not yet approved.
> Also, does `bessel_Y` have an analogous special value for x=0, negative n?
Ah, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).



---

archive/issue_comments_232958.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-12T04:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232958",
    "user": "@kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232959.json:
```json
{
    "body": "> Ah, I missed that. It should be easily derived from\nYes, I figured - but should it be included?  Sorry for not being clear.\n\nDid you hear back from Fredrik/mpmath?",
    "created_at": "2015-02-12T04:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232959",
    "user": "@kcrisman"
}
```

> Ah, I missed that. It should be easily derived from
Yes, I figured - but should it be included?  Sorry for not being clear.

Did you hear back from Fredrik/mpmath?



---

archive/issue_comments_232960.json:
```json
{
    "body": "Replying to [comment:8 kcrisman]:\n> > Ah, I missed that. It should be easily derived from\n> Yes, I figured - but should it be included?\nOf course!\n> Did you hear back from Fredrik/mpmath?\nhttps://groups.google.com/forum/?hl=en#!topic/mpmath/FJqtBMNhYFo\nSo, IMO the mpmath behaviour fits its numerical requirements but we should use \"zoo\" because it's more symbolically correct, and because we have it.",
    "created_at": "2015-02-12T06:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232960",
    "user": "@rwst"
}
```

Replying to [comment:8 kcrisman]:
> > Ah, I missed that. It should be easily derived from
> Yes, I figured - but should it be included?
Of course!
> Did you hear back from Fredrik/mpmath?
https://groups.google.com/forum/?hl=en#!topic/mpmath/FJqtBMNhYFo
So, IMO the mpmath behaviour fits its numerical requirements but we should use "zoo" because it's more symbolically correct, and because we have it.



---

archive/issue_comments_232961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-13T17:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232962.json:
```json
{
    "body": "This uncovered a bug so we depend on #17777 as soon as it is resolved.",
    "created_at": "2015-02-13T17:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232962",
    "user": "@rwst"
}
```

This uncovered a bug so we depend on #17777 as soon as it is resolved.



---

archive/issue_comments_232963.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-13T17:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232963",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-14T08:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232964",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232965.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-26T09:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232965",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232966.json:
```json
{
    "body": "There is a doctest fail in french_book that is not from #17777.",
    "created_at": "2015-02-26T09:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232966",
    "user": "@rwst"
}
```

There is a doctest fail in french_book that is not from #17777.



---

archive/issue_comments_232967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-05T07:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232967",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232968.json:
```json
{
    "body": "Squashed it all into one commit.\n----\nNew commits:",
    "created_at": "2015-03-05T07:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232968",
    "user": "@rwst"
}
```

Squashed it all into one commit.
----
New commits:



---

archive/issue_comments_232969.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2015-03-05T07:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232969",
    "user": "@rwst"
}
```

Changing priority from minor to major.



---

archive/issue_comments_232970.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-05T07:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232970",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232971.json:
```json
{
    "body": "> > Also, does `bessel_Y` have an analogous special value for x=0, negative n?\n> Ah, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).\nI didn't see anything about this in the many commits here, haven't looked at the 'squashed' one but assume it's not there either.  Otherwise this just requires (from my point of view) some testing.",
    "created_at": "2015-05-21T16:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232971",
    "user": "@kcrisman"
}
```

> > Also, does `bessel_Y` have an analogous special value for x=0, negative n?
> Ah, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).
I didn't see anything about this in the many commits here, haven't looked at the 'squashed' one but assume it's not there either.  Otherwise this just requires (from my point of view) some testing.



---

archive/issue_comments_232972.json:
```json
{
    "body": "Replying to [comment:17 kcrisman]:\n> > > Also, does `bessel_Y` have an analogous special value for x=0, negative n?\n> > Ah, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).\nAlso:\n\n```\nsage: bessel_J(-5./2,0.)\n+infinity\nsage: type(_)\n<type 'sage.rings.real_mpfr.RealNumber'>\n```\n\nI'm not sure what the \"right\" resolution is here, since MPFR may not have an unsigned infinity.\n\nPatchbot is happy and I don't expect my own last test run to go bad, so these two things are all that remains to resolve, perhaps they are even non-issues?",
    "created_at": "2015-05-21T19:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232972",
    "user": "@kcrisman"
}
```

Replying to [comment:17 kcrisman]:
> > > Also, does `bessel_Y` have an analogous special value for x=0, negative n?
> > Ah, I missed that. It should be easily derived from `Bessel_J` with Y<sub>n</sub>(z)=(J<sub>n</sub>(z)*cos(n*pi)-J<sub>-n</sub>(z))/sin(n*pi) (Abramowitz and Stegun 1972, p. 358).
Also:

```
sage: bessel_J(-5./2,0.)
+infinity
sage: type(_)
<type 'sage.rings.real_mpfr.RealNumber'>
```

I'm not sure what the "right" resolution is here, since MPFR may not have an unsigned infinity.

Patchbot is happy and I don't expect my own last test run to go bad, so these two things are all that remains to resolve, perhaps they are even non-issues?



---

archive/issue_comments_232973.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-05-21T19:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232973",
    "user": "@kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_232974.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-05-24T15:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232974",
    "user": "@rwst"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_232975.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> {{{\n> sage: bessel_J(-5./2,0.)\n> +infinity\n> sage: type(_)\n> <type 'sage.rings.real_mpfr.RealNumber'>\n> }}}\n> I'm not sure what the \"right\" resolution is here, since MPFR may not have an unsigned infinity.\nThis appears to be widespread, e.g. I just found `polylog(1.,1.)` vs. `polylog(1,1)` which is due to `zeta(1.)` vs. `zeta(1)`.",
    "created_at": "2015-05-25T16:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232975",
    "user": "@rwst"
}
```

Replying to [comment:18 kcrisman]:
> {{{
> sage: bessel_J(-5./2,0.)
> +infinity
> sage: type(_)
> <type 'sage.rings.real_mpfr.RealNumber'>
> }}}
> I'm not sure what the "right" resolution is here, since MPFR may not have an unsigned infinity.
This appears to be widespread, e.g. I just found `polylog(1.,1.)` vs. `polylog(1,1)` which is due to `zeta(1.)` vs. `zeta(1)`.



---

archive/issue_comments_232976.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-20T12:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232976",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232977.json:
```json
{
    "body": "The infinity inconsistency is handled by #19439. Please review.\n----\nNew commits:",
    "created_at": "2015-10-20T12:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232977",
    "user": "@rwst"
}
```

The infinity inconsistency is handled by #19439. Please review.
----
New commits:



---

archive/issue_comments_232978.json:
```json
{
    "body": "Thanks for opening that ticket, that is fine for that issue.\n\nStill a problem here:\n\n```\nsage: bessel_Y(-3,0)\nInfinity\nsage: bessel_Y(3,0)\nInfinity\nsage: bessel_Y(3.1,0)\n-infinity\nsage: bessel_Y(3.2,0)\n-infinity\nsage: bessel_Y(-3.2,0)\n+infinity\nsage: bessel_Y(-3.3,0)\n+infinity\nsage: bessel_Y(-33/10,0)\nInfinity\n```\n\n\n\nExtra `var('n')`?\n\n```\n+    def _eval_(self, n, x):\n+        \"\"\"\n+        EXAMPLES::\n+\n+            sage: n = var('n')\n+            sage: bessel_Y(1, 0)\n+            Infinity\n+            sage: bessel_Y(1/2, x)\n+            -sqrt(2)*sqrt(1/(pi*x))*cos(x)\n+            sage: bessel_Y(-1/2, x)\n+            sqrt(2)*sqrt(1/(pi*x))*sin(x)\n+        \"\"\"\n```\n",
    "created_at": "2015-10-20T13:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232978",
    "user": "@kcrisman"
}
```

Thanks for opening that ticket, that is fine for that issue.

Still a problem here:

```
sage: bessel_Y(-3,0)
Infinity
sage: bessel_Y(3,0)
Infinity
sage: bessel_Y(3.1,0)
-infinity
sage: bessel_Y(3.2,0)
-infinity
sage: bessel_Y(-3.2,0)
+infinity
sage: bessel_Y(-3.3,0)
+infinity
sage: bessel_Y(-33/10,0)
Infinity
```



Extra `var('n')`?

```
+    def _eval_(self, n, x):
+        """
+        EXAMPLES::
+
+            sage: n = var('n')
+            sage: bessel_Y(1, 0)
+            Infinity
+            sage: bessel_Y(1/2, x)
+            -sqrt(2)*sqrt(1/(pi*x))*cos(x)
+            sage: bessel_Y(-1/2, x)
+            sqrt(2)*sqrt(1/(pi*x))*sin(x)
+        """
```




---

archive/issue_comments_232979.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-06-12T08:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232979",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232980.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-08T11:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232980",
    "user": "@arminstraub"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232981.json:
```json
{
    "body": "We stumpled across the issue that `bessel_J(0,x).series(x,3)` didn't have the expected result during a summer school on special functions, in which I was advertising Sage.  It would be nice to report back to the students that the next version of Sage has this fixed :)\n\nThis is my first attempt at using git and I haven't used the trac server in many years, so please let me know if I messed something up or didn't follow best practices.  The branch I pushed is supposed to be a merge with the most recent version of Sage, with the following additional changes:\n\n* Removed the extra `var('n')` as noticed by Karl-Dieter.\n* In `Function_Bessel_J._eval_`, I replaced `n > 0` with `n.real() > 0`.  I also changed the behaviour to only return `unsigned_infinity` if the real part of `n` is negative.  The reason for these changes is that `bessel_J(i, 0)` should not be evaluated as `0`, as it previously was, nor should it be evaluated as infinite.  (Mathematica evaluates this value as `Indeterminate`.)\n* Likewise for `bessel_I`, for which the situation is equivalent.\n* Similarly, I changed `Function_Bessel_Y._eval_` so that indeterminate values like `bessel_Y(I,0)` are not evaluated.\n* Likewise for `bessel_K`.\n\nDoctesting the 5 involved files didn't reveal any troubles.\n----\nNew commits:",
    "created_at": "2016-08-08T11:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232981",
    "user": "@arminstraub"
}
```

We stumpled across the issue that `bessel_J(0,x).series(x,3)` didn't have the expected result during a summer school on special functions, in which I was advertising Sage.  It would be nice to report back to the students that the next version of Sage has this fixed :)

This is my first attempt at using git and I haven't used the trac server in many years, so please let me know if I messed something up or didn't follow best practices.  The branch I pushed is supposed to be a merge with the most recent version of Sage, with the following additional changes:

* Removed the extra `var('n')` as noticed by Karl-Dieter.
* In `Function_Bessel_J._eval_`, I replaced `n > 0` with `n.real() > 0`.  I also changed the behaviour to only return `unsigned_infinity` if the real part of `n` is negative.  The reason for these changes is that `bessel_J(i, 0)` should not be evaluated as `0`, as it previously was, nor should it be evaluated as infinite.  (Mathematica evaluates this value as `Indeterminate`.)
* Likewise for `bessel_I`, for which the situation is equivalent.
* Similarly, I changed `Function_Bessel_Y._eval_` so that indeterminate values like `bessel_Y(I,0)` are not evaluated.
* Likewise for `bessel_K`.

Doctesting the 5 involved files didn't reveal any troubles.
----
New commits:



---

archive/issue_comments_232982.json:
```json
{
    "body": "Replying to [comment:24 kcrisman]:\n> Still a problem here:\n> {{{\n> sage: bessel_Y(-3,0)\n> Infinity\n> sage: bessel_Y(3,0)\n> Infinity\n> sage: bessel_Y(3.1,0)\n> -infinity\n> sage: bessel_Y(3.2,0)\n> -infinity\n> sage: bessel_Y(-3.2,0)\n> +infinity\n> sage: bessel_Y(-3.3,0)\n> +infinity\n> sage: bessel_Y(-33/10,0)\n> Infinity\n> }}}\n\nIndeed, the behaviour for values of Bessel functions at zero is not consistent between symbolic and numeric input.  The symbolic evaluations as provided by this ticket seem appropriate to me (and, as far as I have tested, also agree with the values that Mathematica produces).\n\nOn the other hand, the numerical evaluation of Bessel functions is currently outsourced to `mpmath`.  I don't know about the conventions that `mpmath` is using when reporting the corresponding values for numeric `x` (for instance, for `bessel_Y(1/2,x) == -sqrt(2)*sqrt(1/(pi*x))*cos(x)` mpmath produces `mpmath.bessely(0.5,0) == mpf('-inf')`, which results in `bessel_Y(0.5,0) == -infinity`, which is clearly not the limiting value when x approaches zero on the imaginary axis).  To achieve perfect consistency, one could modify the `_evalf_` function to not let `mpmath` handle these cases.  This seems, however, not like an ideal solution.\n\nI would suggest that resolving this inconsistency is better suited for a different ticket (or, if desired, changing the behaviour within `mpmath` itself).",
    "created_at": "2016-08-08T11:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232982",
    "user": "@arminstraub"
}
```

Replying to [comment:24 kcrisman]:
> Still a problem here:
> {{{
> sage: bessel_Y(-3,0)
> Infinity
> sage: bessel_Y(3,0)
> Infinity
> sage: bessel_Y(3.1,0)
> -infinity
> sage: bessel_Y(3.2,0)
> -infinity
> sage: bessel_Y(-3.2,0)
> +infinity
> sage: bessel_Y(-3.3,0)
> +infinity
> sage: bessel_Y(-33/10,0)
> Infinity
> }}}

Indeed, the behaviour for values of Bessel functions at zero is not consistent between symbolic and numeric input.  The symbolic evaluations as provided by this ticket seem appropriate to me (and, as far as I have tested, also agree with the values that Mathematica produces).

On the other hand, the numerical evaluation of Bessel functions is currently outsourced to `mpmath`.  I don't know about the conventions that `mpmath` is using when reporting the corresponding values for numeric `x` (for instance, for `bessel_Y(1/2,x) == -sqrt(2)*sqrt(1/(pi*x))*cos(x)` mpmath produces `mpmath.bessely(0.5,0) == mpf('-inf')`, which results in `bessel_Y(0.5,0) == -infinity`, which is clearly not the limiting value when x approaches zero on the imaginary axis).  To achieve perfect consistency, one could modify the `_evalf_` function to not let `mpmath` handle these cases.  This seems, however, not like an ideal solution.

I would suggest that resolving this inconsistency is better suited for a different ticket (or, if desired, changing the behaviour within `mpmath` itself).



---

archive/issue_comments_232983.json:
```json
{
    "body": "By the way, what is the preferred approach of Sage to the following?\n\nWhen the index of the Bessel functions is a half-integer, they can be written in terms of elementary functions.  This is currently implemented for indices 1/2 and -1/2 only.  Would it be desirable to likewise implement the case of general half-integer indices?  Or, would it be better to leave, say, `bessel_J(21/2, x)` unevaluated and wait for the user to, somehow (how?), explicitly ask for a simplification?",
    "created_at": "2016-08-08T11:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232983",
    "user": "@arminstraub"
}
```

By the way, what is the preferred approach of Sage to the following?

When the index of the Bessel functions is a half-integer, they can be written in terms of elementary functions.  This is currently implemented for indices 1/2 and -1/2 only.  Would it be desirable to likewise implement the case of general half-integer indices?  Or, would it be better to leave, say, `bessel_J(21/2, x)` unevaluated and wait for the user to, somehow (how?), explicitly ask for a simplification?



---

archive/issue_comments_232984.json:
```json
{
    "body": "Replying to [comment:29 arminstraub]:\n>  It would be nice to report back to the students that the next version of Sage has this fixed :)\n\nIndeed, but the discussion focused a bit on the dependency on #17777, which I agree however does not exist, i.e. both issues are mutually independent.\n\nYour additions look fine, consider them reviewed. There is one failing doctest due to simplification in `src/sage/interfaces/maxima_lib.py`. A minor caveat is also in my previous branch, all the comparisons `n,x == 0` should rather read `n,x.is_trivial_zero()` because any nonnumerical symbolic expression will trigger the expensive proof machinery in `Expression.__nonzero__()`. So if you could please change these two minor issues you can set positive yourself. Thanks for your work.\n\n> By the way, what is the preferred approach of Sage to the following?\n> \n> When the index of the Bessel functions is a half-integer, they can be written in terms of elementary functions.  This is currently implemented for indices 1/2 and -1/2 only.  Would it be desirable to likewise implement the case of general half-integer indices?  Or, would it be better to leave, say, `bessel_J(21/2, x)` unevaluated and wait for the user to, somehow (how?), explicitly ask for a simplification?\n\nThis was not formalized up to now, the general behaviour was to give such conversions if the result is both more elementary and not very complicated. Full implementation can be done in a `Expression.expand_bessel()` function which would then, at some time later, be part of a general `rewrite()` tool (#10137). So to your question, automatic expansion yes, as long as the output doesn't exceed---say one line, and in a dedicated expand function always welcome.",
    "created_at": "2016-08-09T07:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232984",
    "user": "@rwst"
}
```

Replying to [comment:29 arminstraub]:
>  It would be nice to report back to the students that the next version of Sage has this fixed :)

Indeed, but the discussion focused a bit on the dependency on #17777, which I agree however does not exist, i.e. both issues are mutually independent.

Your additions look fine, consider them reviewed. There is one failing doctest due to simplification in `src/sage/interfaces/maxima_lib.py`. A minor caveat is also in my previous branch, all the comparisons `n,x == 0` should rather read `n,x.is_trivial_zero()` because any nonnumerical symbolic expression will trigger the expensive proof machinery in `Expression.__nonzero__()`. So if you could please change these two minor issues you can set positive yourself. Thanks for your work.

> By the way, what is the preferred approach of Sage to the following?
> 
> When the index of the Bessel functions is a half-integer, they can be written in terms of elementary functions.  This is currently implemented for indices 1/2 and -1/2 only.  Would it be desirable to likewise implement the case of general half-integer indices?  Or, would it be better to leave, say, `bessel_J(21/2, x)` unevaluated and wait for the user to, somehow (how?), explicitly ask for a simplification?

This was not formalized up to now, the general behaviour was to give such conversions if the result is both more elementary and not very complicated. Full implementation can be done in a `Expression.expand_bessel()` function which would then, at some time later, be part of a general `rewrite()` tool (#10137). So to your question, automatic expansion yes, as long as the output doesn't exceed---say one line, and in a dedicated expand function always welcome.



---

archive/issue_comments_232985.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-09T20:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232985",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232986.json:
```json
{
    "body": "Thanks for your swift and helpful feedback!\n\nI have fixed the failing doctest (the entire example needed to be replaced).\n\nYou also mentioned to use `sth.is_trivial_zero()` instead of `sth == 0`, and the reasoning makes perfect sense.  A minor trouble is that when calling, say, `sage: bessel_J(5/2, 0)`, then `x` and `n` are not expressions and so don't have the property `is_trivial_zero`.  One workaround would be to use `(isinstance(sth, Expression) and sth.is_trivial_zero()) or sth == 0` but that doesn't feel natural to me.  Another workaround would be `SR(sth).is_trivial_zero()` but that also doesn't feel right (and I couldn't find this being used in other Sage code).  After some more looking, I found that the code for hypergeometric functions uses things like `if not isinstance(z, Expression) and z == 0:` a couple of times.  For now, that's what I used also (only for `x` because the index `n` shouldn't usually be a complicated expression, and because other functions distinguish similarly).\n\nSince there was some choices to be made, I haven't set the ticket to positive review myself.  Could you please have a quick look!",
    "created_at": "2016-08-09T20:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232986",
    "user": "@arminstraub"
}
```

Thanks for your swift and helpful feedback!

I have fixed the failing doctest (the entire example needed to be replaced).

You also mentioned to use `sth.is_trivial_zero()` instead of `sth == 0`, and the reasoning makes perfect sense.  A minor trouble is that when calling, say, `sage: bessel_J(5/2, 0)`, then `x` and `n` are not expressions and so don't have the property `is_trivial_zero`.  One workaround would be to use `(isinstance(sth, Expression) and sth.is_trivial_zero()) or sth == 0` but that doesn't feel natural to me.  Another workaround would be `SR(sth).is_trivial_zero()` but that also doesn't feel right (and I couldn't find this being used in other Sage code).  After some more looking, I found that the code for hypergeometric functions uses things like `if not isinstance(z, Expression) and z == 0:` a couple of times.  For now, that's what I used also (only for `x` because the index `n` shouldn't usually be a complicated expression, and because other functions distinguish similarly).

Since there was some choices to be made, I haven't set the ticket to positive review myself.  Could you please have a quick look!



---

archive/issue_comments_232987.json:
```json
{
    "body": "On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero` for the purpose of comparing with zero, without working too hard to simplify?\n\n\n```\ndef is_trivial_zero(x):\n    try: return x.is_trivial_zero()\n    except AttributeError: return x == 0\n```\n\n\nOne place for such a function could be `sage/misc/functional.py` which already contains things like `is_even` (which I used as a blueprint here).\n\nDo you think it would be a good idea to have something like that?  If so, should a ticket be opened for that?",
    "created_at": "2016-08-09T20:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232987",
    "user": "@arminstraub"
}
```

On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero` for the purpose of comparing with zero, without working too hard to simplify?


```
def is_trivial_zero(x):
    try: return x.is_trivial_zero()
    except AttributeError: return x == 0
```


One place for such a function could be `sage/misc/functional.py` which already contains things like `is_even` (which I used as a blueprint here).

Do you think it would be a good idea to have something like that?  If so, should a ticket be opened for that?



---

archive/issue_comments_232988.json:
```json
{
    "body": "Replying to [comment:32 arminstraub]:\n> ... to use `(isinstance(sth, Expression) and sth.is_trivial_zero()) or sth == 0` \n\nNo, that calls `__nonzero__` after `is_trivial_zero()` returned `False`. You need `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)`.\n\n> After some more looking, I found that the code for hypergeometric functions uses things like `if not isinstance(z, Expression) and z == 0:` a couple of times.  For now, that's what I used also (only for `x` because the index `n` shouldn't usually be a complicated expression, and because other functions distinguish similarly).\n\nWell that misses the `SR(0)` case and looks buggy.\n\n> On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero`...\n\nTry opening a ticket, but see also #17158",
    "created_at": "2016-08-10T07:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232988",
    "user": "@rwst"
}
```

Replying to [comment:32 arminstraub]:
> ... to use `(isinstance(sth, Expression) and sth.is_trivial_zero()) or sth == 0` 

No, that calls `__nonzero__` after `is_trivial_zero()` returned `False`. You need `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)`.

> After some more looking, I found that the code for hypergeometric functions uses things like `if not isinstance(z, Expression) and z == 0:` a couple of times.  For now, that's what I used also (only for `x` because the index `n` shouldn't usually be a complicated expression, and because other functions distinguish similarly).

Well that misses the `SR(0)` case and looks buggy.

> On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero`...

Try opening a ticket, but see also #17158



---

archive/issue_comments_232989.json:
```json
{
    "body": "> Well that misses the `SR(0)` case and looks buggy.\n\nNo, that actually works. What's odd is that I get now an error in `src/sage/tests/french_book/recequadiff.py` that only happens with `sage -tp`. As it is spurious I changed the test. As your work is reviewed someone still needs to look at my commit. Could you please do that and then set positive?\n----\nNew commits:",
    "created_at": "2016-08-10T08:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232989",
    "user": "@rwst"
}
```

> Well that misses the `SR(0)` case and looks buggy.

No, that actually works. What's odd is that I get now an error in `src/sage/tests/french_book/recequadiff.py` that only happens with `sage -tp`. As it is spurious I changed the test. As your work is reviewed someone still needs to look at my commit. Could you please do that and then set positive?
----
New commits:



---

archive/issue_comments_232990.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-10T11:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232990",
    "user": "@arminstraub"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232991.json:
```json
{
    "body": "Looks good! Set to positive review.\n\nReplying to [comment:36 rws]:\n> > Well that misses the `SR(0)` case and looks buggy.\n> No, that actually works.\n\nYes, I was initially worried about that, too, when following the hypergeometric implementation.\n\n> What's odd is that I get now an error in `src/sage/tests/french_book/recequadiff.py` that only happens with `sage -tp`. As it is spurious I changed the test.\n\nYour solution seems fine.  I am seeing the same spurious behavior when running the test versus running the code in a notebook.\n\n> You need `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)`.\n\nOops, you are right!  Definitely not a brief and convenient substitute for `sth == 0`.  I'll open a ticket suggesting a global `is_trivial_zero` function.",
    "created_at": "2016-08-10T11:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232991",
    "user": "@arminstraub"
}
```

Looks good! Set to positive review.

Replying to [comment:36 rws]:
> > Well that misses the `SR(0)` case and looks buggy.
> No, that actually works.

Yes, I was initially worried about that, too, when following the hypergeometric implementation.

> What's odd is that I get now an error in `src/sage/tests/french_book/recequadiff.py` that only happens with `sage -tp`. As it is spurious I changed the test.

Your solution seems fine.  I am seeing the same spurious behavior when running the test versus running the code in a notebook.

> You need `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)`.

Oops, you are right!  Definitely not a brief and convenient substitute for `sth == 0`.  I'll open a ticket suggesting a global `is_trivial_zero` function.



---

archive/issue_comments_232992.json:
```json
{
    "body": "Replying to [comment:34 rws]:\n> > On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero`...\n> Try opening a ticket, but see also #17158\n\nPosted as #21201.",
    "created_at": "2016-08-10T12:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232992",
    "user": "@arminstraub"
}
```

Replying to [comment:34 rws]:
> > On the other hand, wouldn't it be convenient to have a global function `is_trivial_zero`...
> Try opening a ticket, but see also #17158

Posted as #21201.



---

archive/issue_comments_232993.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-13T22:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17441#issuecomment-232993",
    "user": "@vbraun"
}
```

Resolution: fixed
