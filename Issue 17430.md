# Issue 17430: Maxima parser fails on ==

Issue created by migration from https://trac.sagemath.org/ticket/17667

Original creator: vbraun

Original creation time: 2015-01-24 19:47:53

CC:  kcrisman

There is no `==` operator in Maxima, but on invalid input it does bad things to the C-level stream. On Linux (below) this is caught by gilbc, on OSX the Maxima process hangs indefinitely:

```
$ sage -maxima
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/sockets.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/defsystem.fas"
;;; Loading #P"/home/vbraun/Code/sage.git/local/lib/ecl/cmp.fas"
Maxima 5.35.1 http://maxima.sourceforge.net
using Lisp ECL 13.5.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) 1 == 1;

Maxima encountered a Lisp error:

 Read or write operation signaled an error
C library explanation: Illegal seek.

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.
```


This syntax error was diagnosed correctly in Maxima-5.34.1:

```
$ ./sage -maxima
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/cmp.fas"
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; OPTIMIZE levels: Safety=2, Space=0, Speed=3, Debug=0
;;;
;;; End of Pass 1.
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/sockets.fas"
;;; Loading #P"/home/vbraun/Sage/git-temp/local/lib/ecl/defsystem.fas"
Maxima 5.34.1 http://maxima.sourceforge.net
using Lisp ECL 13.5.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) 1 == 1;
incorrect syntax: = is not a prefix operator
1 ==
  ^ 
```



---

Comment by vbraun created at 2015-01-24 20:05:37

Upstream bug: https://sourceforge.net/p/maxima/bugs/2895/


---

Comment by vbraun created at 2015-01-25 18:26:24

This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/


---

Comment by nbruin created at 2015-01-31 16:36:52

Replying to [comment:2 vbraun]:
> This is apparently a bug in ECL: https://sourceforge.net/p/ecls/bugs/298/
There's a proposed almost trivial patch there now. If we need this bug solved in Sage, we can patch our ECL.

There is a good chance that Maxima/SBCL on OSX has the same problem as Maxima/ECL, since the underlying problem is a rather unfortunate interpretation of POSIX mandated behaviour of lseek on terminal streams. It might be worth trying that, because if the problem surfaces there too, then the Maxima developers might want to avoid depending on the behaviour of the "file-position" lisp function that ends up wrapping lseek. (Similarly for other lisps for which Maxima is supported).


---

Comment by vbraun created at 2015-02-13 09:04:15

Changing priority from major to blocker.


---

Comment by vbraun created at 2015-02-13 09:04:15

We should put the backported fix into 6.5, too
----
New commits:


---

Comment by vbraun created at 2015-02-13 09:04:15

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-02-13 09:08:15

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-02-13 09:08:15

Hang on...


---

Comment by jdemeyer created at 2015-02-13 09:11:46

The patch doesn't actually apply due to mismatched TABS/spaces.


---

Comment by git created at 2015-02-13 09:27:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-02-13 09:27:57

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-02-13 09:30:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-02-13 09:31:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-13 09:31:40

lgtm


---

Comment by vbraun created at 2015-02-13 11:11:09

Resolution: fixed


---

Comment by dimpase created at 2015-02-22 08:28:56

ECL devs merged Nils' pull request http://sourceforge.net/p/ecls/ecl/merge-requests/1
