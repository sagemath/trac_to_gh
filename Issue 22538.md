# Issue 22538: conway_polynomials not compatible with python3

Issue created by migration from https://trac.sagemath.org/ticket/22775

Original creator: chapoton

Original creation time: 2017-04-07 12:17:39

CC:  jdemeyer vbraun jhpalmieri jpflori pbruin

The package conway_polynomials does not compile with SAGE_PYTHON3=yes.


```
[conway_polynomials-0.4.p0] Thread model: posix
[conway_polynomials-0.4.p0] gcc version 5.4.0 (GCC) 
[conway_polynomials-0.4.p0] ****************************************************
[conway_polynomials-0.4.p0] Traceback (most recent call last):
[conway_polynomials-0.4.p0]   File "./spkg-install", line 4, in <module>
[conway_polynomials-0.4.p0]     from sage.structure.sage_object import save
[conway_polynomials-0.4.p0] ImportError: No module named 'sage.structure.sage_object'
[conway_polynomials-0.4.p0]
```



---

Comment by chapoton created at 2017-04-07 12:18:01

Changing component from PLEASE CHANGE to python3.


---

Comment by chapoton created at 2017-04-07 12:18:01

Changing type from PLEASE CHANGE to defect.


---

Comment by chapoton created at 2017-04-07 13:46:14

Potentially the same problem with database_odlyzko_zeta ?

```
conway_polynomials/spkg-install:from sage.structure.sage_object import save
conway_polynomials/spkg-install:from sage.env import SAGE_SHARE
database_odlyzko_zeta/spkg-install:from sage.all import save
database_odlyzko_zeta/spkg-install:from sage.env import SAGE_SHARE
database_odlyzko_zeta/spkg-install:from sage.misc.misc import sage_makedirs
```



---

Comment by chapoton created at 2017-04-16 13:20:08

`@`jdemeyer, do you have any idea of what to do here ? This is my current blocking point.


---

Comment by chapoton created at 2017-04-16 13:22:59

and sage (with python3) itself fails to launch because of the line

```
---> 39 from sage.structure.sage_object import SageObject
```

in sage/repl/rich_output/display_manager.py


---

Comment by vbraun created at 2017-04-16 14:05:51

conway_polynomials depends on sagelib, so the latter has be become inport-able into python3 first.

Arguably this is a bad state of affairs, conway_polynomials should just use some Sage-independent format to serialize itself (e.g. plain Python pickles / sqlite / ...).


---

Comment by chapoton created at 2017-04-16 14:13:22

Thanks, Volker. I do not think I will be able to fix that..

By the way, trying to import sage in my python3-sage build, I get

```
./sage -python
Python 3.5.1 (default, Apr 16 2017, 11:35:45) 
[GCC 6.2.0 20161005] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.all import *
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/chapoton/sage3/local/lib/python3.5/site-packages/sage/all.py", line 86, in <module>
    import sage.misc.lazy_import
ImportError: No module named 'sage.misc.lazy_import'
```

So it seems that there is some problem with the cython extensions..


---

Comment by chapoton created at 2017-04-16 14:16:13

here is my current experimental branch, where all pyx files compile with SAGE_PYTHON3=yes
----
Last 10 new commits:


---

Comment by git created at 2017-04-16 14:18:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-04-17 12:01:10

here is a tentative, not yet tested, to use pickle
----
New commits:


---

Comment by git created at 2017-04-17 12:09:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-04-17 12:10:32

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-04-17 12:10:32

this seems to work


---

Comment by chapoton created at 2017-04-17 13:27:12

But fails on python3 with

```
[conway_polynomials-0.4.p1] gcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) 
[conway_polynomials-0.4.p1] ****************************************************
[conway_polynomials-0.4.p1] Traceback (most recent call last):
[conway_polynomials-0.4.p1]   File "./spkg-install", line 22, in <module>
[conway_polynomials-0.4.p1]     create_db()
[conway_polynomials-0.4.p1]   File "./spkg-install", line 11, in create_db
[conway_polynomials-0.4.p1]     from src import conway_polynomials
[conway_polynomials-0.4.p1]   File "/home/chapoton/sage3/local/var/tmp/sage/build/conway_polynomials-0.4.p1/src/__init__.py", line 1, in <module>
[conway_polynomials-0.4.p1]     from table import *
[conway_polynomials-0.4.p1] ImportError: No module named 'table'
[conway_polynomials-0.4.p1] 
[conway_polynomials-0.4.p1] real	0m0.177s
[conway_polynomials-0.4.p1] user	0m0.056s
[conway_polynomials-0.4.p1] sys	0m0.024s
[conway_polynomials-0.4.p1] ************************************************************************
[conway_polynomials-0.4.p1] Error installing package conway_polynomials-0.4.p1
```



---

Comment by tscrim created at 2017-04-18 00:02:27

From the error, looks like a relative import that will needs to be an absolute import. You probably should also fix this `from src import conway_polynomials` in `spkg-install` too.


---

Attachment


---

Comment by git created at 2017-04-18 14:15:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-18 14:31:04

Works for me with Python2. If you tested it with Python3, then set a positive review.


---

Comment by chapoton created at 2017-04-18 19:14:04

works for me in python3 (so that, for the first time ever, I got the message "Sage build/upgrade complete!" with python3 !!)


---

Comment by chapoton created at 2017-04-18 19:14:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-23 12:57:37

Resolution: fixed
