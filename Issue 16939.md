# Issue 16939: Gdb on Yosemite

Issue created by migration from https://trac.sagemath.org/ticket/17176

Original creator: vbraun

Original creation time: 2014-10-18 19:21:49

CC:  ohanar




---

Comment by vbraun created at 2014-10-18 19:28:14

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by vbraun created at 2014-10-18 19:28:14

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2014-10-18 19:28:14

Changing keywords from "" to "yosemite".


---

Comment by vbraun created at 2014-10-18 20:20:52

Aaand codesign doesn't work, can only run gdb as root.
----
New commits:


---

Comment by vbraun created at 2014-10-19 11:14:08

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-10-19 11:50:55

Tried the following to be able to use gdb:

* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/
* Sign: `codesign -fs gdbc ./gdb/gdb`
* Put the `gdb` binary in the `procmod` group and make it chgrp
  {{{
  $ ls -al gdb
  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb
  }}}
* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:
  {{{
  dscl . append /Groups/procmod GroupMembership vbraun
  }}}
* Rebooted

Still can't run without root:

```
$ ./gdb ~/Sage/local/bin/patch 
....
Starting program: /Users/vbraun/Sage/local/bin/patch 
Unable to find Mach task port for process-id 476: (os/kern) failure (0x5).
 (please check gdb is codesigned - see taskgated(8))
```

More info:

```
$ codesign -d --verbose gdb
Executable=/Users/vbraun/Code/gdb-7.8/gdb/gdb
Identifier=org.gnu.gdb
Format=Mach-O thin (x86_64)
CodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded
Signature size=1237
Signed Time=Oct 19, 2014, 12:31:26 PM
Info.plist entries=4
TeamIdentifier=not set
Sealed Resources=none
Internal requirements count=2 size=448
```



---

Comment by vbraun created at 2014-10-19 11:52:04

Of course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.


---

Comment by jhpalmieri created at 2014-10-27 17:52:48

This seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:

```
#ifndef	_MACHINE_SETJMP_H_
#define	_MACHINE_SETJMP_H_

#include <setjmp.h>

#endif	/* _MACHINE_SETJMP_H_ */
```

Is it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.


---

Comment by vbraun created at 2014-10-27 18:14:20

Interesting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:

```
$ ls /usr/include/machine/setjmp.h 
ls: /usr/include/machine/setjmp.h: No such file or directory
```



---

Comment by vbraun created at 2014-10-27 18:18:05

Oh you said 10.9. Thats probably what it was, then.

In any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.


---

Comment by vbraun created at 2015-01-24 19:34:54

Anybody care to review this? Without gdb its hard to debug stuff on OSX


---

Comment by jhpalmieri created at 2015-01-25 06:52:27

It worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.

Is this good enough for a positive review, given that it's an optional package?


---

Comment by vbraun created at 2015-01-25 12:52:54

IMHO thats enough


---

Comment by vbraun created at 2015-01-25 12:52:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-01-29 13:26:25

Resolution: fixed
