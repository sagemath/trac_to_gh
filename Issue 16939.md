# Issue 16939: Gdb on Yosemite

archive/issues_016939.json:
```json
{
    "body": "CC:  @ohanar\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17176\n\n",
    "created_at": "2014-10-18T19:21:49Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Gdb on Yosemite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16939",
    "user": "@vbraun"
}
```
CC:  @ohanar



Issue created by migration from https://trac.sagemath.org/ticket/17176





---

archive/issue_comments_224484.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224484",
    "user": "@vbraun"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_224485.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224485",
    "user": "@vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_224486.json:
```json
{
    "body": "Changing keywords from \"\" to \"yosemite\".",
    "created_at": "2014-10-18T19:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224486",
    "user": "@vbraun"
}
```

Changing keywords from "" to "yosemite".



---

archive/issue_comments_224487.json:
```json
{
    "body": "Aaand codesign doesn't work, can only run gdb as root.\n----\nNew commits:",
    "created_at": "2014-10-18T20:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224487",
    "user": "@vbraun"
}
```

Aaand codesign doesn't work, can only run gdb as root.
----
New commits:



---

archive/issue_comments_224488.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-19T11:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224488",
    "user": "@vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224489.json:
```json
{
    "body": "Tried the following to be able to use gdb:\n\n* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/\n* Sign: `codesign -fs gdbc ./gdb/gdb`\n* Put the `gdb` binary in the `procmod` group and make it chgrp\n  {{{\n  $ ls -al gdb\n  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb\n  }}}\n* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:\n  {{{\n  dscl . append /Groups/procmod GroupMembership vbraun\n  }}}\n* Rebooted\n\nStill can't run without root:\n\n```\n$ ./gdb ~/Sage/local/bin/patch \n....\nStarting program: /Users/vbraun/Sage/local/bin/patch \nUnable to find Mach task port for process-id 476: (os/kern) failure (0x5).\n (please check gdb is codesigned - see taskgated(8))\n```\n\nMore info:\n\n```\n$ codesign -d --verbose gdb\nExecutable=/Users/vbraun/Code/gdb-7.8/gdb/gdb\nIdentifier=org.gnu.gdb\nFormat=Mach-O thin (x86_64)\nCodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded\nSignature size=1237\nSigned Time=Oct 19, 2014, 12:31:26 PM\nInfo.plist entries=4\nTeamIdentifier=not set\nSealed Resources=none\nInternal requirements count=2 size=448\n```\n",
    "created_at": "2014-10-19T11:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224489",
    "user": "@vbraun"
}
```

Tried the following to be able to use gdb:

* Made a `gdbc` certificate (can only be done in the GUI, wtf): http://blog.panks.me/posts/2013/11/install-gdb-on-os-x-mavericks-from-source/
* Sign: `codesign -fs gdbc ./gdb/gdb`
* Put the `gdb` binary in the `procmod` group and make it chgrp
  {{{
  $ ls -al gdb
  -rwxrwsr-x  1 vbraun  procmod  6717344 Oct 19 12:31 gdb
  }}}
* Add myself to the groups `admin`, `_developer`, `procmod`, `procview`:
  {{{
  dscl . append /Groups/procmod GroupMembership vbraun
  }}}
* Rebooted

Still can't run without root:

```
$ ./gdb ~/Sage/local/bin/patch 
....
Starting program: /Users/vbraun/Sage/local/bin/patch 
Unable to find Mach task port for process-id 476: (os/kern) failure (0x5).
 (please check gdb is codesigned - see taskgated(8))
```

More info:

```
$ codesign -d --verbose gdb
Executable=/Users/vbraun/Code/gdb-7.8/gdb/gdb
Identifier=org.gnu.gdb
Format=Mach-O thin (x86_64)
CodeDirectory v=20100 size=32700 flags=0x0(none) hashes=1630+2 location=embedded
Signature size=1237
Signed Time=Oct 19, 2014, 12:31:26 PM
Info.plist entries=4
TeamIdentifier=not set
Sealed Resources=none
Internal requirements count=2 size=448
```




---

archive/issue_comments_224490.json:
```json
{
    "body": "Of course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.",
    "created_at": "2014-10-19T11:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224490",
    "user": "@vbraun"
}
```

Of course if you run gdb as root (e.g. suid rood) then it will erase `DYLD_LIBRARY_PATH` from the environment. This is generally good idea for a suid binary, but really crappy if you want to debug Sage.



---

archive/issue_comments_224491.json:
```json
{
    "body": "This seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:\n\n```\n#ifndef\t_MACHINE_SETJMP_H_\n#define\t_MACHINE_SETJMP_H_\n\n#include <setjmp.h>\n\n#endif\t/* _MACHINE_SETJMP_H_ */\n```\n\nIs it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.",
    "created_at": "2014-10-27T17:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224491",
    "user": "@jhpalmieri"
}
```

This seems to work on an OSX 10.9 machine. I actually see both files `/usr/include/setjmp.h` and `/usr/include/machine/setjmp.h`, and they differ: the second one basically just contains these lines:

```
#ifndef	_MACHINE_SETJMP_H_
#define	_MACHINE_SETJMP_H_

#include <setjmp.h>

#endif	/* _MACHINE_SETJMP_H_ */
```

Is it an issue to not use that one? I also don't have access to earlier versions of OS X to test there.



---

archive/issue_comments_224492.json:
```json
{
    "body": "Interesting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:\n\n```\n$ ls /usr/include/machine/setjmp.h \nls: /usr/include/machine/setjmp.h: No such file or directory\n```\n",
    "created_at": "2014-10-27T18:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224492",
    "user": "@vbraun"
}
```

Interesting, but the latter is probably left-over from an earlier SDK. I removed all files and reinstalled the CLT and got:

```
$ ls /usr/include/machine/setjmp.h 
ls: /usr/include/machine/setjmp.h: No such file or directory
```




---

archive/issue_comments_224493.json:
```json
{
    "body": "Oh you said 10.9. Thats probably what it was, then.\n\nIn any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.",
    "created_at": "2014-10-27T18:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224493",
    "user": "@vbraun"
}
```

Oh you said 10.9. Thats probably what it was, then.

In any case `/usr/include/setjmp.h` is the standard location (or anything directly in the system include path). There was probably some old Apple SDK that didn't do that right, which prompted gdb to include setjmp.h it from a somewhat weird place.



---

archive/issue_comments_224494.json:
```json
{
    "body": "Anybody care to review this? Without gdb its hard to debug stuff on OSX",
    "created_at": "2015-01-24T19:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224494",
    "user": "@vbraun"
}
```

Anybody care to review this? Without gdb its hard to debug stuff on OSX



---

archive/issue_comments_224495.json:
```json
{
    "body": "It worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.\n\nIs this good enough for a positive review, given that it's an optional package?",
    "created_at": "2015-01-25T06:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224495",
    "user": "@jhpalmieri"
}
```

It worked for me before on OS X 10.9, and it works for me now on OS X 10.10. I have no way of testing earlier versions of OS X.

Is this good enough for a positive review, given that it's an optional package?



---

archive/issue_comments_224496.json:
```json
{
    "body": "IMHO thats enough",
    "created_at": "2015-01-25T12:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224496",
    "user": "@vbraun"
}
```

IMHO thats enough



---

archive/issue_comments_224497.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-25T12:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224497",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224498.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-29T13:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16939#issuecomment-224498",
    "user": "@vbraun"
}
```

Resolution: fixed
