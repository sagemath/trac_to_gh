# Issue 24010: Implement __pow__ in the coercion model

archive/issues_024010.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/24247\n\n",
    "created_at": "2017-11-20T09:42:56Z",
    "labels": [
        "coercion",
        "major",
        "enhancement"
    ],
    "title": "Implement __pow__ in the coercion model",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24010",
    "user": "jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/24247





---

archive/issue_comments_336501.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-20T16:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336501",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336502.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-20T18:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336502",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336503.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-21T13:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336503",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336504.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-21T14:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336504",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336505.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-21T17:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336505",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336506.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-24T15:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336506",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336507.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-05T09:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336507",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_336508.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-05T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336508",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336509.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-06T16:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336509",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-07T10:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336510",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336511.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-23T13:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336511",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336512.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-24T09:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336512",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336513.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-24T09:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336513",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336514.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-24T09:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336514",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_336515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-24T13:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336515",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336516.json:
```json
{
    "body": "Isn't `__pow__` just a right action, by either `ZZ` or `RR`?",
    "created_at": "2017-12-25T02:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336516",
    "user": "nbruin"
}
```

Isn't `__pow__` just a right action, by either `ZZ` or `RR`?



---

archive/issue_comments_336517.json:
```json
{
    "body": "Replying to [comment:28 nbruin]:\n> Isn't `__pow__` just a right action, by either `ZZ` or `RR`?\n\nIt could be an action. But I don't really understand what you are trying to say.\n\nAre you saying that it should be an action?\n\nAre you saying that there *should not* be a special method like `_pow_int`?\n\n(Note that these are two independent questions)",
    "created_at": "2017-12-25T09:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336517",
    "user": "jdemeyer"
}
```

Replying to [comment:28 nbruin]:
> Isn't `__pow__` just a right action, by either `ZZ` or `RR`?

It could be an action. But I don't really understand what you are trying to say.

Are you saying that it should be an action?

Are you saying that there *should not* be a special method like `_pow_int`?

(Note that these are two independent questions)



---

archive/issue_comments_336518.json:
```json
{
    "body": "I was really just wondering if there would be a benefit to treating it as an action. There may be other hooks that are already available in the coercion framework, but the standard binary operation code tries (if I recall correctly) to find a *common* parent, and that's not the right thing to do for powering in general. Actions, on the other hand, should come pretty close. I have no feeling for the performance implications, though. I just raised the point because a brief scanning through the contributions here didn't seem to have considered this possibility.\n\nFor `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.",
    "created_at": "2017-12-25T19:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336518",
    "user": "nbruin"
}
```

I was really just wondering if there would be a benefit to treating it as an action. There may be other hooks that are already available in the coercion framework, but the standard binary operation code tries (if I recall correctly) to find a *common* parent, and that's not the right thing to do for powering in general. Actions, on the other hand, should come pretty close. I have no feeling for the performance implications, though. I just raised the point because a brief scanning through the contributions here didn't seem to have considered this possibility.

For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.



---

archive/issue_comments_336519.json:
```json
{
    "body": "Replying to [comment:30 nbruin]:\n> For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.\n\nOK good. So we are just talking about the code which calls this method.",
    "created_at": "2017-12-26T10:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336519",
    "user": "jdemeyer"
}
```

Replying to [comment:30 nbruin]:
> For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.

OK good. So we are just talking about the code which calls this method.



---

archive/issue_comments_336520.json:
```json
{
    "body": "Close to the arguments in [comment:30 comment:30], I am not sure that finding a common parent is a good solution to handle powerings. The only reasonable assumption that could be done with powering is `(x<sup>a)</sup>b = x^(a*b)` (that is: it is a multiplicative action).\n\nAlso, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?  With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence\n\n```\nsage: 4**(1/2)\n2\nsage: type(_)\n<type 'sage.rings.rational.Rational'>\nsage: 3**(1/2)\nsqrt(3)\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\n\nNote also that `x^a * y^a = (x*y)^a` is wrong with rational exponents has often there is a **choice** of a root\n\n```\nsage: ((-1)^(1/3))^3\n-1\nsage: ((-1)^3)^(1/3)\n(-1)^(1/3)\n```\n",
    "created_at": "2017-12-26T16:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336520",
    "user": "vdelecroix"
}
```

Close to the arguments in [comment:30 comment:30], I am not sure that finding a common parent is a good solution to handle powerings. The only reasonable assumption that could be done with powering is `(x<sup>a)</sup>b = x^(a*b)` (that is: it is a multiplicative action).

Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?  With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence

```
sage: 4**(1/2)
2
sage: type(_)
<type 'sage.rings.rational.Rational'>
sage: 3**(1/2)
sqrt(3)
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```

Note also that `x^a * y^a = (x*y)^a` is wrong with rational exponents has often there is a **choice** of a root

```
sage: ((-1)^(1/3))^3
-1
sage: ((-1)^3)^(1/3)
(-1)^(1/3)
```




---

archive/issue_comments_336521.json:
```json
{
    "body": "Replying to [comment:32 vdelecroix]:\n> Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?\n\nYes, on anything with a real or complex analytic structure one probably wants that `x^y` is a shorthand for `exp(log(x)*y)` (although for serious use the latter is much better for understanding subtleties arising from multi-valuedness)\n\nIt does look like we might want to handle powering action by integers (no multi-valuedness problem, but may need existence or adjunction of inverses), by rationals, by appropriate completions of rationals as different actions, because of their different problems.\n\nIn principle, on a commutative multiplicative group of exponent `N` we'd even have a powering action by `ZZ/N ZZ`. I'm not so sure it's worth supporting that explicitly, though.",
    "created_at": "2017-12-27T19:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336521",
    "user": "nbruin"
}
```

Replying to [comment:32 vdelecroix]:
> Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?

Yes, on anything with a real or complex analytic structure one probably wants that `x^y` is a shorthand for `exp(log(x)*y)` (although for serious use the latter is much better for understanding subtleties arising from multi-valuedness)

It does look like we might want to handle powering action by integers (no multi-valuedness problem, but may need existence or adjunction of inverses), by rationals, by appropriate completions of rationals as different actions, because of their different problems.

In principle, on a commutative multiplicative group of exponent `N` we'd even have a powering action by `ZZ/N ZZ`. I'm not so sure it's worth supporting that explicitly, though.



---

archive/issue_comments_336522.json:
```json
{
    "body": "A lot of points are raised here.\n\nFirst of all, the point of this ticket is *making possible* various ways of implementing powering in various parents, not to actually implement it that way. For example, I don't plan to re-implement powering for `QQbar` in this ticket. What is within the scope of this ticket is *making it possible* to implement a parent which treats powering by rationals in a specific way (by going through the coercion model which checks for actions and this `QQbar^QQ` powering should be an action).\n\nSecond, I do agree that powering by integers is special enough that there should be a default action (as suggested by Nils) which calls the special method `_pow_int`.\n\nThird, I think that coercing to a common parent does make sense because:\n\n1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.\n\n2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.\n\n3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?",
    "created_at": "2017-12-27T20:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336522",
    "user": "jdemeyer"
}
```

A lot of points are raised here.

First of all, the point of this ticket is *making possible* various ways of implementing powering in various parents, not to actually implement it that way. For example, I don't plan to re-implement powering for `QQbar` in this ticket. What is within the scope of this ticket is *making it possible* to implement a parent which treats powering by rationals in a specific way (by going through the coercion model which checks for actions and this `QQbar^QQ` powering should be an action).

Second, I do agree that powering by integers is special enough that there should be a default action (as suggested by Nils) which calls the special method `_pow_int`.

Third, I think that coercing to a common parent does make sense because:

1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.

2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.

3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?



---

archive/issue_comments_336523.json:
```json
{
    "body": "Replying to [comment:32 vdelecroix]:\n> With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence\n> {{{\n> sage: 4**(1/2)\n> 2\n> sage: type(_)\n> <type 'sage.rings.rational.Rational'>\n> sage: 3**(1/2)\n> sqrt(3)\n> sage: type(_)\n> <type 'sage.symbolic.expression.Expression'>\n> }}}\n\nSorry, but that is a question about the implementation of powering for a specific parent, so not within the scope of this ticket.",
    "created_at": "2017-12-27T20:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336523",
    "user": "jdemeyer"
}
```

Replying to [comment:32 vdelecroix]:
> With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence
> {{{
> sage: 4**(1/2)
> 2
> sage: type(_)
> <type 'sage.rings.rational.Rational'>
> sage: 3**(1/2)
> sqrt(3)
> sage: type(_)
> <type 'sage.symbolic.expression.Expression'>
> }}}

Sorry, but that is a question about the implementation of powering for a specific parent, so not within the scope of this ticket.



---

archive/issue_comments_336524.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-30T18:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336524",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336525.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T18:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336525",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336526.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-01T18:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336526",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-02T17:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336527",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336528.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-03T11:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336528",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-03T16:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336529",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336530.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-04T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336530",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336531.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-04T16:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336531",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T09:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336532",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336533.json:
```json
{
    "body": "I am not sure I agree with this change:\n\n```diff\n@@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):\n \n         TESTS::\n \n-            sage: complex(0,1)^2\n-            (-1+0j)\n+            sage: complex(0,1) ^ 2\n+            -1.0\n             sage: R.<t> = QQ[]\n             sage: 2^t\n             Traceback (most recent call last):\n```\n\nIn Python, we have\n\n```\n>>> complex(0,1)**2\n(-1+0j)\n```\n\nand generally, I think `x^2` should be the same as `x * x`. In this case, they are equal, but they are different types. While `complex` has all of the methods that `float` has, it is surprising to me that we do not get a `complex` result (in particular, since I thought it was suppose to be considered as an action). Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n\nFor those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef` (see `Integer` and `RealDoubleElement`)? Or is the declaration in `ModuleElement` sufficient (but then why for its subclass `RingElement`)?\n\nHave you looked at timings? I think this is almost certainly the way forward, but I am worried about how much of a speed regression this might have on taking integer exponentiation of, e.g., polynomials. (At least something I do in my research is combinatorial generating functions: `sum(q^s(b) for b in B)` for some set `B` and statistic `s`.)",
    "created_at": "2018-01-08T16:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336533",
    "user": "tscrim"
}
```

I am not sure I agree with this change:

```diff
@@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):
 
         TESTS::
 
-            sage: complex(0,1)^2
-            (-1+0j)
+            sage: complex(0,1) ^ 2
+            -1.0
             sage: R.<t> = QQ[]
             sage: 2^t
             Traceback (most recent call last):
```

In Python, we have

```
>>> complex(0,1)**2
(-1+0j)
```

and generally, I think `x^2` should be the same as `x * x`. In this case, they are equal, but they are different types. While `complex` has all of the methods that `float` has, it is surprising to me that we do not get a `complex` result (in particular, since I thought it was suppose to be considered as an action). Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?

For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef` (see `Integer` and `RealDoubleElement`)? Or is the declaration in `ModuleElement` sufficient (but then why for its subclass `RingElement`)?

Have you looked at timings? I think this is almost certainly the way forward, but I am worried about how much of a speed regression this might have on taking integer exponentiation of, e.g., polynomials. (At least something I do in my research is combinatorial generating functions: `sum(q^s(b) for b in B)` for some set `B` and statistic `s`.)



---

archive/issue_comments_336534.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> I am not sure I agree with this change:\n> {{{#!diff\n> `@``@` -2015,8 +2003,8 `@``@` cdef class Integer(sage.structure.element.EuclideanDomainElement):\n>  \n>          TESTS::\n>  \n> -            sage: complex(0,1)^2\n> -            (-1+0j)\n> +            sage: complex(0,1) ^ 2\n> +            -1.0\n>              sage: R.<t> = QQ[]\n>              sage: 2^t\n>              Traceback (most recent call last):\n> }}}\n\nI thought that any operation between a Python type and a Sage parent should coerce everything to Sage. But it seems that this is not done consistently:\n\n```\nsage: parent(float(1) + 1)\n<type 'float'>\n```\n\n\nFor `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.\n\n> Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n\nWhat do you mean here? That wouldn't use any Sage code.",
    "created_at": "2018-01-08T18:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336534",
    "user": "jdemeyer"
}
```

Replying to [comment:49 tscrim]:
> I am not sure I agree with this change:
> {{{#!diff
> `@``@` -2015,8 +2003,8 `@``@` cdef class Integer(sage.structure.element.EuclideanDomainElement):
>  
>          TESTS::
>  
> -            sage: complex(0,1)^2
> -            (-1+0j)
> +            sage: complex(0,1) ^ 2
> +            -1.0
>              sage: R.<t> = QQ[]
>              sage: 2^t
>              Traceback (most recent call last):
> }}}

I thought that any operation between a Python type and a Sage parent should coerce everything to Sage. But it seems that this is not done consistently:

```
sage: parent(float(1) + 1)
<type 'float'>
```


For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.

> Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?

What do you mean here? That wouldn't use any Sage code.



---

archive/issue_comments_336535.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`\n\nIf it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.\n\n> Or is the declaration in `ModuleElement` sufficient\n\nI guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.",
    "created_at": "2018-01-08T18:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336535",
    "user": "jdemeyer"
}
```

Replying to [comment:49 tscrim]:
> For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`

If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.

> Or is the declaration in `ModuleElement` sufficient

I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.



---

archive/issue_comments_336536.json:
```json
{
    "body": "Replying to [comment:50 jdemeyer]:\n> Replying to [comment:49 tscrim]:\n> I thought that any operation between a Python type and a Sage parent should coerce everything to Sage.\n\nI wasn't aware that this was a policy, but I usually don't think too much about Python types.\n\n> But it seems that this is not done consistently:\n> {{{\n> sage: parent(float(1) + 1)\n> <type 'float'>\n> }}}\n\nWe probably haven't yet implemented the hooks for floats yet.\n\n> For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.\n\n`CDF` would be a good target. Whatever we decide, we should add the parent as part of the test.\n\n> > Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n> \n> What do you mean here? That wouldn't use any Sage code.\n\nAh, right, the coercion model should not be called, and we run into similar sort of discrepancies when doing things like `1 / 2` in a `.py` file.",
    "created_at": "2018-01-08T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336536",
    "user": "tscrim"
}
```

Replying to [comment:50 jdemeyer]:
> Replying to [comment:49 tscrim]:
> I thought that any operation between a Python type and a Sage parent should coerce everything to Sage.

I wasn't aware that this was a policy, but I usually don't think too much about Python types.

> But it seems that this is not done consistently:
> {{{
> sage: parent(float(1) + 1)
> <type 'float'>
> }}}

We probably haven't yet implemented the hooks for floats yet.

> For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.

`CDF` would be a good target. Whatever we decide, we should add the parent as part of the test.

> > Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?
> 
> What do you mean here? That wouldn't use any Sage code.

Ah, right, the coercion model should not be called, and we run into similar sort of discrepancies when doing things like `1 / 2` in a `.py` file.



---

archive/issue_comments_336537.json:
```json
{
    "body": "Replying to [comment:51 jdemeyer]:\n> Replying to [comment:49 tscrim]:\n> > For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`\n> \n> If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.\n\nThen why do you add it for `Expression`?\n\n> > Or is the declaration in `ModuleElement` sufficient\n> \n> I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.\n\nWhoops, yes I do.",
    "created_at": "2018-01-08T22:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336537",
    "user": "tscrim"
}
```

Replying to [comment:51 jdemeyer]:
> Replying to [comment:49 tscrim]:
> > For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`
> 
> If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.

Then why do you add it for `Expression`?

> > Or is the declaration in `ModuleElement` sufficient
> 
> I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.

Whoops, yes I do.



---

archive/issue_comments_336538.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-09T08:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336538",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336539.json:
```json
{
    "body": "Replying to [comment:52 tscrim]:\n> I wasn't aware that this was a policy, but I usually don't think too much about Python types.\n\nNow I don't think that there is such a policy either. I *thought* that was such a policy so I *thought* that `CDF` would be the correct parent for `float ^ ZZ`. But I can easily fix that to return a `float` instead, so let's do that.",
    "created_at": "2018-01-09T08:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336539",
    "user": "jdemeyer"
}
```

Replying to [comment:52 tscrim]:
> I wasn't aware that this was a policy, but I usually don't think too much about Python types.

Now I don't think that there is such a policy either. I *thought* that was such a policy so I *thought* that `CDF` would be the correct parent for `float ^ ZZ`. But I can easily fix that to return a `float` instead, so let's do that.



---

archive/issue_comments_336540.json:
```json
{
    "body": "Replying to [comment:53 tscrim]:\n> Then why do you add it for `Expression`?\n\nNo particular reason. Maybe I needed to add it at some point during the development of this ticket. I'll remove it. The `_pow_` needs to stay though since there is no default implementation.",
    "created_at": "2018-01-09T08:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336540",
    "user": "jdemeyer"
}
```

Replying to [comment:53 tscrim]:
> Then why do you add it for `Expression`?

No particular reason. Maybe I needed to add it at some point during the development of this ticket. I'll remove it. The `_pow_` needs to stay though since there is no default implementation.



---

archive/issue_comments_336541.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-09T10:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336541",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_336542.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-09T10:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336542",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336543.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> In Python, we have\n> {{{\n> >>> complex(0,1)**2\n> (-1+0j)\n> }}}\n\nIn the latest commit, I fixed this: now a non-`Element` raised to a `ZZ` power will do the powering with an `int` exponent instead. For consistency, I did this for all base types, such that `int(3) ^ (-3)` now returns a `float` instead of a `QQ` element.",
    "created_at": "2018-01-09T10:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336543",
    "user": "jdemeyer"
}
```

Replying to [comment:49 tscrim]:
> In Python, we have
> {{{
> >>> complex(0,1)**2
> (-1+0j)
> }}}

In the latest commit, I fixed this: now a non-`Element` raised to a `ZZ` power will do the powering with an `int` exponent instead. For consistency, I did this for all base types, such that `int(3) ^ (-3)` now returns a `float` instead of a `QQ` element.



---

archive/issue_comments_336544.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-09T13:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336544",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336545.json:
```json
{
    "body": "The recent change seems to have introduced various doctest failures.",
    "created_at": "2018-01-09T13:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336545",
    "user": "jdemeyer"
}
```

The recent change seems to have introduced various doctest failures.



---

archive/issue_comments_336546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-09T13:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336546",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_336547.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-09T13:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336547",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_336548.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> Have you looked at timings?\n\nFirst of all, it is important to state that this ticket only changes powering for certain parents. It allows to implement powering using the coercion model, but many parents with a custom `__pow__` still have that custom `__pow__` after applying this ticket and won't use the coercion model. This is case for polynomials for example. So we only look at a few parents where the powering actually uses the new code.\n\nNow the timings. The conclusion seems to be that powering for equal parents is slightly faster than before but that powering with non-equal parents is slower than before. This is because the latter goes through the coercion model now.\n\n**ZZ<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 122 ns per loop\n```\n\n\nAfter:\n\n```\nsage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 110 ns per loop\n```\n\n\n**GF(2<sup>n</sup>)<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 377 ns per loop\n```\n\n\nAfter:\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 607 ns per loop\n```\n\n\n**RDF<sup>RDF</sup>**\n\nBefore:\n\n```\nsage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 139 ns per loop\n```\n\n\nAfter:\n\n```\nsage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 132 ns per loop\n```\n\n\n**RDF<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 156 ns per loop\n```\n\n\nAfter:\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 240 ns per loop\n```\n\n\n**ideal<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)\n10000 loops, best of 20: 13.2 \u00b5s per loop\n```\n\n\nAfter:\n\n```\nsage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)\n10000 loops, best of 20: 14.6 \u00b5s per loop\n```\n",
    "created_at": "2018-01-09T14:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336548",
    "user": "jdemeyer"
}
```

Replying to [comment:49 tscrim]:
> Have you looked at timings?

First of all, it is important to state that this ticket only changes powering for certain parents. It allows to implement powering using the coercion model, but many parents with a custom `__pow__` still have that custom `__pow__` after applying this ticket and won't use the coercion model. This is case for polynomials for example. So we only look at a few parents where the powering actually uses the new code.

Now the timings. The conclusion seems to be that powering for equal parents is slightly faster than before but that powering with non-equal parents is slower than before. This is because the latter goes through the coercion model now.

**ZZ<sup>ZZ</sup>**

Before:

```
sage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 122 ns per loop
```


After:

```
sage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 110 ns per loop
```


**GF(2<sup>n</sup>)<sup>ZZ</sup>**

Before:

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 377 ns per loop
```


After:

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 607 ns per loop
```


**RDF<sup>RDF</sup>**

Before:

```
sage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 139 ns per loop
```


After:

```
sage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 132 ns per loop
```


**RDF<sup>ZZ</sup>**

Before:

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 156 ns per loop
```


After:

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 240 ns per loop
```


**ideal<sup>ZZ</sup>**

Before:

```
sage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)
10000 loops, best of 20: 13.2 µs per loop
```


After:

```
sage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)
10000 loops, best of 20: 14.6 µs per loop
```




---

archive/issue_comments_336549.json:
```json
{
    "body": "Part of the slowdown is caused by `Action.__call__` (see #24500). After optimizing that a bit, I go from\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 607 ns per loop\n```\n\nto\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 506 ns per loop\n```\n\n\nand from\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 240 ns per loop\n```\n\nto\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 182 ns per loop\n```\n",
    "created_at": "2018-01-09T14:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336549",
    "user": "jdemeyer"
}
```

Part of the slowdown is caused by `Action.__call__` (see #24500). After optimizing that a bit, I go from

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 607 ns per loop
```

to

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 506 ns per loop
```


and from

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 240 ns per loop
```

to

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 182 ns per loop
```




---

archive/issue_comments_336550.json:
```json
{
    "body": "Travis, please let me know what you think of the timings and whether #24500 should be a dependency of this ticket. Personally, I think that #24500 will be non-trivial, so I would rather not make it a dependency.",
    "created_at": "2018-01-09T15:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336550",
    "user": "jdemeyer"
}
```

Travis, please let me know what you think of the timings and whether #24500 should be a dependency of this ticket. Personally, I think that #24500 will be non-trivial, so I would rather not make it a dependency.



---

archive/issue_comments_336551.json:
```json
{
    "body": "I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need\n\n```\nApart from this, powering behaves like other binary operators:\ncoercion to a common parent is done if no action is defined. \n```\n",
    "created_at": "2018-01-09T16:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336551",
    "user": "vdelecroix"
}
```

I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need

```
Apart from this, powering behaves like other binary operators:
coercion to a common parent is done if no action is defined. 
```




---

archive/issue_comments_336552.json:
```json
{
    "body": "Replying to [comment:65 vdelecroix]:\n> I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need\n> {{{\n> Apart from this, powering behaves like other binary operators:\n> coercion to a common parent is done if no action is defined. \n> }}}\n\nCopying from [comment:34]:\n\n\nI think that coercing to a common parent does make sense because:\n\n1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.\n\n2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.\n\n3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?",
    "created_at": "2018-01-09T18:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336552",
    "user": "jdemeyer"
}
```

Replying to [comment:65 vdelecroix]:
> I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need
> {{{
> Apart from this, powering behaves like other binary operators:
> coercion to a common parent is done if no action is defined. 
> }}}

Copying from [comment:34]:


I think that coercing to a common parent does make sense because:

1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.

2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.

3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?



---

archive/issue_comments_336553.json:
```json
{
    "body": "Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower as I would expect exponentiation to be a fairly common operation. For me personally, it is not important, but I know for the number theorist using Sage, it could have a much bigger impact. However, you know that area of math/Sage better than I, so if you think it will be okay, then no objection from me.",
    "created_at": "2018-01-09T20:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336553",
    "user": "tscrim"
}
```

Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower as I would expect exponentiation to be a fairly common operation. For me personally, it is not important, but I know for the number theorist using Sage, it could have a much bigger impact. However, you know that area of math/Sage better than I, so if you think it will be okay, then no objection from me.



---

archive/issue_comments_336554.json:
```json
{
    "body": "Replying to [comment:67 tscrim]:\n> Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower\n\nIt's actually only a factor 1.61 slower but that will improve significantly after #24500. Possibly, other optimizations in the coercion model are possible.\n\nIt is also important to note that I intentionally took the worst case of `GF(4)` implemented using NTL. The default implementation for that field size is Givaro, which is not affected by this ticket. Only for `GF(2^16)` and larger is NTL the default and then the cost of the coercion becomes a much smaller fraction of the actual computation.",
    "created_at": "2018-01-10T08:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336554",
    "user": "jdemeyer"
}
```

Replying to [comment:67 tscrim]:
> Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower

It's actually only a factor 1.61 slower but that will improve significantly after #24500. Possibly, other optimizations in the coercion model are possible.

It is also important to note that I intentionally took the worst case of `GF(4)` implemented using NTL. The default implementation for that field size is Givaro, which is not affected by this ticket. Only for `GF(2^16)` and larger is NTL the default and then the cost of the coercion becomes a much smaller fraction of the actual computation.



---

archive/issue_comments_336555.json:
```json
{
    "body": "Okay, then positive review from me.\n\nDoes anyone else have any other objections or questions?",
    "created_at": "2018-01-10T16:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336555",
    "user": "tscrim"
}
```

Okay, then positive review from me.

Does anyone else have any other objections or questions?



---

archive/issue_comments_336556.json:
```json
{
    "body": "fine for me",
    "created_at": "2018-01-11T08:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336556",
    "user": "vdelecroix"
}
```

fine for me



---

archive/issue_comments_336557.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-11T14:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336557",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336558.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-15T22:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24010#issuecomment-336558",
    "user": "vbraun"
}
```

Resolution: fixed
