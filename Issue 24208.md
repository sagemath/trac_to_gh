# Issue 24208: Allow several implementations in random matrix

Issue created by migration from Trac.

Original creator: SimonKing

Original creation time: 2017-12-29 19:58:12

CC:  jipilab tscrim vdelecroix

With the optional meataxe package installed, I get

```
sage: K.<a>=FiniteField(3^2)
sage: MS = MatrixSpace(K, 2, 5, implementation="generic")
sage: type(MS.random_element())
<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
```

which is good, but

```
sage: type(random_matrix(K, 2, 5, implementation="generic"))
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
```

which is bad.

So, the `random_matrix` constructor should take into account what was contributed in #23706.


---

Comment by git created at 2017-12-30 12:32:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by SimonKing created at 2017-12-30 12:33:59

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-12-30 17:57:29

Could you change the following doctest (`matrix/special.py` line 403)

```
The default implementation of :meth:`~sage.matrix.matrix2.randomize` relies
on the ``random_element()`` method for the base ring.  The ``density`` and
``sparse`` keywords behave as described above. Since we have a different
randomisation when using the optional meataxe package, we have to make sure
that we use the default implementation in this test::

    sage: K.<a>=FiniteField(3^2)
    sage: from sage.matrix.matrix_generic_dense import Matrix_generic_dense
    sage: MS = MatrixSpace(K, 2, 5)
    sage: MS._MatrixSpace__matrix_class = Matrix_generic_dense
    sage: random_matrix(K, 2, 5)
    [      1       a       1 2*a + 1       2]
    [    2*a   a + 2       0       2       1]
```

It could now be much simpler without any special hack.


---

Comment by SimonKing created at 2017-12-30 18:15:22

Replying to [comment:4 vdelecroix]:
> Could you change the following doctest (`matrix/special.py` line 403)

The first commit does this:

```
`@``@` -407,10 +419,7 `@``@` def random_matrix(ring, nrows, ncols=None, algorithm='randomize', *args, **kwds)
     that we use the default implementation in this test::
 
         sage: K.<a>=FiniteField(3^2)
-        sage: from sage.matrix.matrix_generic_dense import Matrix_generic_dense
-        sage: MS = MatrixSpace(K, 2, 5)
-        sage: MS._MatrixSpace__matrix_class = Matrix_generic_dense
-        sage: random_matrix(K, 2, 5)
+        sage: random_matrix(K, 2, 5, implementation='generic')
         [      1       a       1 2*a + 1       2]
         [    2*a   a + 2       0       2       1]
 }}}
So, I did change that test. Actually the whole purpose of this ticket was to fix this test (that would fail because of #23706 when meataxe is installed).


---

Comment by vdelecroix created at 2017-12-30 18:17:12

Then I think that I should close #24449 as duplicate as Jeroen suggested.


---

Comment by jdemeyer created at 2017-12-30 18:19:47

Changing priority from major to blocker.


---

Comment by jdemeyer created at 2017-12-30 18:21:25

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-12-30 18:21:25

Doctest failure in `src/sage/misc/lazy_import.pyx`


---

Comment by git created at 2017-12-30 19:12:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by SimonKing created at 2017-12-30 19:13:42

Changing status from needs_work to needs_review.


---

Comment by SimonKing created at 2017-12-30 19:13:42

Replying to [comment:8 jdemeyer]:
> Doctest failure in `src/sage/misc/lazy_import.pyx`

Done


---

Comment by dimpase created at 2018-01-02 08:45:21

It seems there should be doctests/examples showing the use of `MeatAxe` package as a backend.


---

Comment by SimonKing created at 2018-01-02 08:54:02

Replying to [comment:11 dimpase]:
> It seems there should be doctests/examples showing the use of `MeatAxe` package as a backend. 

See basically _all_ tests in `sage.matrix.matrix_gfpn_dense`


---

Comment by jdemeyer created at 2018-01-04 11:19:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-06 11:30:57

Resolution: fixed
