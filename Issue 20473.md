# Issue 20473: upgrade glpk to 4.60

archive/issues_020473.json:
```json
{
    "body": "CC:  jpflori @embray gouezel @kiwifb\n\nI suggest to upgrade `glpk` to the latest available version (4.60 at the time of writing). The current version has been superseded in Gentoo and the formatting of the output has changed.\nHere are the tasks for this upgrade:\n 1) use `spkg-src` instead of patching `configure` directly\n 2) drop the `have_error.patch` has the functionality is now upstream without having to change sage's code.\n 3) clean up `SPKG.txt` and other files so they are reflecting the current reality more closely without obsolete historical comments\n\nIssue created by migration from https://trac.sagemath.org/ticket/20710\n\n",
    "created_at": "2016-05-30T05:10:30Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "upgrade glpk to 4.60",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20473",
    "user": "https://github.com/kiwifb"
}
```
CC:  jpflori @embray gouezel @kiwifb

I suggest to upgrade `glpk` to the latest available version (4.60 at the time of writing). The current version has been superseded in Gentoo and the formatting of the output has changed.
Here are the tasks for this upgrade:
 1) use `spkg-src` instead of patching `configure` directly
 2) drop the `have_error.patch` has the functionality is now upstream without having to change sage's code.
 3) clean up `SPKG.txt` and other files so they are reflecting the current reality more closely without obsolete historical comments

Issue created by migration from https://trac.sagemath.org/ticket/20710





---

archive/issue_comments_282045.json:
```json
{
    "body": "Still doctests to fix.\n\n`@` jpflori could you have a look at the cygwin part? Upstream has added some stuff to add `--no-undefined` if host is `*-*-cygwin*` but you are also checking how gmp/mpir is built if host_os is `cygwin*` at the moment I have adapted the patch but may be it is safe to drop it completely. From `configure.ac`\n\n```\nAC_MSG_CHECKING(\n   [if libtool needs -no-undefined flag to build shared libraries])\ncase \"${host}\" in\n   *-*-cygwin* | *-*-mingw* | *-*-aix*)\n      ## Add in the -no-undefined flag to LDFLAGS for libtool.\n      AC_MSG_RESULT([yes])\n      NOUNDEFINED=\" -no-undefined\"\n      ;;\n   *)\n      ## Don't add in anything.\n      AC_MSG_RESULT([no])\n      ;;\nesac\nAC_SUBST([NOUNDEFINED])\n```\n\nwith a matching bit for `NOUNDEFINED` in `src/Makefile.am`.\n----\nNew commits:",
    "created_at": "2016-05-30T10:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282045",
    "user": "https://github.com/kiwifb"
}
```

Still doctests to fix.

`@` jpflori could you have a look at the cygwin part? Upstream has added some stuff to add `--no-undefined` if host is `*-*-cygwin*` but you are also checking how gmp/mpir is built if host_os is `cygwin*` at the moment I have adapted the patch but may be it is safe to drop it completely. From `configure.ac`

```
AC_MSG_CHECKING(
   [if libtool needs -no-undefined flag to build shared libraries])
case "${host}" in
   *-*-cygwin* | *-*-mingw* | *-*-aix*)
      ## Add in the -no-undefined flag to LDFLAGS for libtool.
      AC_MSG_RESULT([yes])
      NOUNDEFINED=" -no-undefined"
      ;;
   *)
      ## Don't add in anything.
      AC_MSG_RESULT([no])
      ;;
esac
AC_SUBST([NOUNDEFINED])
```

with a matching bit for `NOUNDEFINED` in `src/Makefile.am`.
----
New commits:



---

archive/issue_comments_282046.json:
```json
{
    "body": "Replying to [ticket:20710 fbissey]:\n>  2) drop the `have_error.patch` has the functionality is now upstream without having to change sage's code.\n\nAre you sure about this? As I mentioned in #19525, GLPK upstream accepted the Sage patch **with significant modifications**.",
    "created_at": "2016-05-30T10:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282046",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:20710 fbissey]:
>  2) drop the `have_error.patch` has the functionality is now upstream without having to change sage's code.

Are you sure about this? As I mentioned in #19525, GLPK upstream accepted the Sage patch **with significant modifications**.



---

archive/issue_comments_282047.json:
```json
{
    "body": "I had been using `glpk-4.57` for a while (before moving to 4.60 in my private overlay before starting this ticket) and I had only one doctest failure (version reported is different and cannot just be ellipsed away because that doctest already uses tolerance) for a long time - until some recent MIP work which introduced new doctests. The failures are in verbosity and nothing about error reporting. \n\nBut to be sure do we already have a doctest for the functionality and if not, do you have a test case?",
    "created_at": "2016-05-30T10:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282047",
    "user": "https://github.com/kiwifb"
}
```

I had been using `glpk-4.57` for a while (before moving to 4.60 in my private overlay before starting this ticket) and I had only one doctest failure (version reported is different and cannot just be ellipsed away because that doctest already uses tolerance) for a long time - until some recent MIP work which introduced new doctests. The failures are in verbosity and nothing about error reporting. 

But to be sure do we already have a doctest for the functionality and if not, do you have a test case?



---

archive/issue_comments_282048.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> But to be sure do we already have a doctest for the functionality and if not, do you have a test case? \n\nIt has to do with error handling, which should be doctested. But I will check...",
    "created_at": "2016-05-30T10:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282048",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 fbissey]:
> But to be sure do we already have a doctest for the functionality and if not, do you have a test case? 

It has to do with error handling, which should be doctested. But I will check...



---

archive/issue_comments_282049.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> version reported is different and cannot just be ellipsed away because that doctest already uses tolerance\n\nWell, `4.57` matches `4.55` with `abs tol 0.02` :-)",
    "created_at": "2016-05-30T10:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282049",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 fbissey]:
> version reported is different and cannot just be ellipsed away because that doctest already uses tolerance

Well, `4.57` matches `4.55` with `abs tol 0.02` :-)



---

archive/issue_comments_282050.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Replying to [comment:3 fbissey]:\n> > version reported is different and cannot just be ellipsed away because that doctest already uses tolerance\n> \n> Well, `4.57` matches `4.55` with `abs tol 0.02` :-)\n\nBut increasing the tolerance from 1e-5 just for that feels a bit silly. And currently I'd need 0.05.",
    "created_at": "2016-05-30T11:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282050",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:5 jdemeyer]:
> Replying to [comment:3 fbissey]:
> > version reported is different and cannot just be ellipsed away because that doctest already uses tolerance
> 
> Well, `4.57` matches `4.55` with `abs tol 0.02` :-)

But increasing the tolerance from 1e-5 just for that feels a bit silly. And currently I'd need 0.05.



---

archive/issue_comments_282051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-31T11:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282052.json:
```json
{
    "body": "Besides the error reporting there is one last doctest that require particular attention, possibly from a specialist \n\n```\nsage -t --long src/sage/numerical/backends/glpk_backend.pyx\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 1000, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\nFailed example:\n    p.solve() # rel tol 1\nException raised:\n    Traceback (most recent call last):\n      File \"/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[74]>\", line 1, in <module>\n        p.solve() # rel tol 1\n      File \"sage/numerical/mip.pyx\", line 2197, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/mip.c:15434)\n        self._backend.solve()\n      File \"sage/numerical/backends/glpk_backend.pyx\", line 1040, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8609)\n        \n    MIPSolverException: GLPK: The time limit has been exceeded\n**********************************************************************\n```\n\nAlso does that tell us something about error reporting as you intended it Jeroen?",
    "created_at": "2016-05-31T11:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282052",
    "user": "https://github.com/kiwifb"
}
```

Besides the error reporting there is one last doctest that require particular attention, possibly from a specialist 

```
sage -t --long src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 1000, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
Failed example:
    p.solve() # rel tol 1
Exception raised:
    Traceback (most recent call last):
      File "/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[74]>", line 1, in <module>
        p.solve() # rel tol 1
      File "sage/numerical/mip.pyx", line 2197, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/mip.c:15434)
        self._backend.solve()
      File "sage/numerical/backends/glpk_backend.pyx", line 1040, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8609)
        
    MIPSolverException: GLPK: The time limit has been exceeded
**********************************************************************
```

Also does that tell us something about error reporting as you intended it Jeroen?



---

archive/issue_comments_282053.json:
```json
{
    "body": "Where's the tarball?",
    "created_at": "2016-06-15T03:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282053",
    "user": "https://github.com/mkoeppe"
}
```

Where's the tarball?



---

archive/issue_comments_282054.json:
```json
{
    "body": "Fair point, I haven't uploaded it yet. I'll do it ASAP.",
    "created_at": "2016-06-15T03:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282054",
    "user": "https://github.com/kiwifb"
}
```

Fair point, I haven't uploaded it yet. I'll do it ASAP.



---

archive/issue_comments_282055.json:
```json
{
    "body": "(Are you using the upstream tarball or some kind of repackaged tarball?)",
    "created_at": "2016-06-15T03:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282055",
    "user": "https://github.com/mkoeppe"
}
```

(Are you using the upstream tarball or some kind of repackaged tarball?)



---

archive/issue_comments_282056.json:
```json
{
    "body": "Repackaged.",
    "created_at": "2016-06-15T04:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282056",
    "user": "https://github.com/kiwifb"
}
```

Repackaged.



---

archive/issue_comments_282057.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> But to be sure do we already have a doctest for the functionality and if not, do you have a test case? \n\nI added one in #20832.",
    "created_at": "2016-06-15T08:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282057",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 fbissey]:
> But to be sure do we already have a doctest for the functionality and if not, do you have a test case? 

I added one in #20832.



---

archive/issue_comments_282058.json:
```json
{
    "body": "You still need this piece of `have_error.patch` (upstream explicitly rejected this):\n\n```diff\ndiff -ru glpk-4.55/src/env/error.c glpk-4.55-patched//src/env/error.c\n--- glpk-4.55/src/env/error.c   2014-08-22 08:00:00.000000000 +0200\n+++ glpk-4.55-patched//src/env/error.c  2015-11-05 09:59:57.588718768 +0100\n@@ -47,6 +47,7 @@\n       va_end(arg);\n       xprintf(\"Error detected in file %s at line %d\\n\",\n          env->err_file, env->err_line);\n+      env->err_file = NULL;\n       if (env->err_hook != NULL)\n          env->err_hook(env->err_info);\n       abort();\n```\n",
    "created_at": "2016-06-15T08:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282058",
    "user": "https://github.com/jdemeyer"
}
```

You still need this piece of `have_error.patch` (upstream explicitly rejected this):

```diff
diff -ru glpk-4.55/src/env/error.c glpk-4.55-patched//src/env/error.c
--- glpk-4.55/src/env/error.c   2014-08-22 08:00:00.000000000 +0200
+++ glpk-4.55-patched//src/env/error.c  2015-11-05 09:59:57.588718768 +0100
@@ -47,6 +47,7 @@
       va_end(arg);
       xprintf("Error detected in file %s at line %d\n",
          env->err_file, env->err_line);
+      env->err_file = NULL;
       if (env->err_hook != NULL)
          env->err_hook(env->err_info);
       abort();
```




---

archive/issue_comments_282059.json:
```json
{
    "body": "OK, can you enlighten me on why you think it is needed and why it was rejected?",
    "created_at": "2016-06-15T08:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282059",
    "user": "https://github.com/kiwifb"
}
```

OK, can you enlighten me on why you think it is needed and why it was rejected?



---

archive/issue_comments_282060.json:
```json
{
    "body": "The default behaviour for GLPK when encountering an error is to print an error message and then `abort()`. This printing of the error message is done the same way as the usual printing of messages, for example with verbose output. The printing can be customized with a hook function.\n\nGLPK also has an error hook, which is called after printing the error message. It can be used to do something else besides `abort()`. In the case of Sage, this does a `longjmp()` through the `sig_on()` mechanism, raising a Python exception.\n\nIn Sage, we want the usual messages to appear normally, but we want to intercept the error messages and convert them to a Python exception. For this to work, we need a way to detect whether we are handling an error or not. I added a patch to GLPK to support this. It allows to checking whether `env->err_file` is `NULL` or not. This `env->err_file` is set to some non-NULL value when entering the error handler and is set back to NULL after printing the error message, before the error hook.\n\nThe part which upstream did not accept was the setting back of `env->err_file` to NULL because they don't want to officially support error recovery. In upstream's view, once GLPK has encountered an error, it is in an invalid state and there is no way to recover.",
    "created_at": "2016-06-15T09:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282060",
    "user": "https://github.com/jdemeyer"
}
```

The default behaviour for GLPK when encountering an error is to print an error message and then `abort()`. This printing of the error message is done the same way as the usual printing of messages, for example with verbose output. The printing can be customized with a hook function.

GLPK also has an error hook, which is called after printing the error message. It can be used to do something else besides `abort()`. In the case of Sage, this does a `longjmp()` through the `sig_on()` mechanism, raising a Python exception.

In Sage, we want the usual messages to appear normally, but we want to intercept the error messages and convert them to a Python exception. For this to work, we need a way to detect whether we are handling an error or not. I added a patch to GLPK to support this. It allows to checking whether `env->err_file` is `NULL` or not. This `env->err_file` is set to some non-NULL value when entering the error handler and is set back to NULL after printing the error message, before the error hook.

The part which upstream did not accept was the setting back of `env->err_file` to NULL because they don't want to officially support error recovery. In upstream's view, once GLPK has encountered an error, it is in an invalid state and there is no way to recover.



---

archive/issue_comments_282061.json:
```json
{
    "body": "Grumble.... At least that's a very small patch. Will add it here in the morning.",
    "created_at": "2016-06-15T10:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282061",
    "user": "https://github.com/kiwifb"
}
```

Grumble.... At least that's a very small patch. Will add it here in the morning.



---

archive/issue_comments_282062.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-15T11:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282062",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282063.json:
```json
{
    "body": "OK delivered early. Now if we could have some comments from `@`jpflori about the cygwin bits we could put that to review.",
    "created_at": "2016-06-15T11:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282063",
    "user": "https://github.com/kiwifb"
}
```

OK delivered early. Now if we could have some comments from `@`jpflori about the cygwin bits we could put that to review.



---

archive/issue_comments_282064.json:
```json
{
    "body": "cc-ing `@`embray and `@`gouezel as they might also have some thoughts about the cygwin portion.",
    "created_at": "2016-06-25T04:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282064",
    "user": "https://github.com/tscrim"
}
```

cc-ing `@`embray and `@`gouezel as they might also have some thoughts about the cygwin portion.



---

archive/issue_comments_282065.json:
```json
{
    "body": "And I forgot there is a failing doctest that needs to be looked at by a specialist at comment:8 but I believe we already have someone copied. So this is to bring it back in focus.",
    "created_at": "2016-06-25T04:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282065",
    "user": "https://github.com/kiwifb"
}
```

And I forgot there is a failing doctest that needs to be looked at by a specialist at comment:8 but I believe we already have someone copied. So this is to bring it back in focus.



---

archive/issue_comments_282066.json:
```json
{
    "body": "Replying to [comment:8 fbissey]:\n> Besides the error reporting there is one last doctest that require particular attention, possibly from a specialist \n> {{{\n> sage -t --long src/sage/numerical/backends/glpk_backend.pyx\n> **********************************************************************\n> File \"src/sage/numerical/backends/glpk_backend.pyx\", line 1000, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\n> Failed example:\n>     p.solve() # rel tol 1\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[74]>\", line 1, in <module>\n>         p.solve() # rel tol 1\n>       File \"sage/numerical/mip.pyx\", line 2197, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/mip.c:15434)\n>         self._backend.solve()\n>       File \"sage/numerical/backends/glpk_backend.pyx\", line 1040, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8609)\n>         \n>     MIPSolverException: GLPK: The time limit has been exceeded\n> **********************************************************************\n> }}}\n\nThis test tries to verify that no exception is raised when the optimization process is terminated early because of a set time limit.\nHowever, this is not actually true; no exception is raised only when GLPK has a feasible solution available when the time limit expires. \nHere (in version 4.60) it does not have a feasible solution available. I have not checked the details. \nOn my machine, increasing the time limit to 0.1 fixes this test. Needless to say, this is of course a brittle test.",
    "created_at": "2016-06-25T07:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282066",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:8 fbissey]:
> Besides the error reporting there is one last doctest that require particular attention, possibly from a specialist 
> {{{
> sage -t --long src/sage/numerical/backends/glpk_backend.pyx
> **********************************************************************
> File "src/sage/numerical/backends/glpk_backend.pyx", line 1000, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
> Failed example:
>     p.solve() # rel tol 1
> Exception raised:
>     Traceback (most recent call last):
>       File "/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/home/fbissey/sandbox/git-fork/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[74]>", line 1, in <module>
>         p.solve() # rel tol 1
>       File "sage/numerical/mip.pyx", line 2197, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/mip.c:15434)
>         self._backend.solve()
>       File "sage/numerical/backends/glpk_backend.pyx", line 1040, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/fbissey/sandbox/git-fork/sage/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8609)
>         
>     MIPSolverException: GLPK: The time limit has been exceeded
> **********************************************************************
> }}}

This test tries to verify that no exception is raised when the optimization process is terminated early because of a set time limit.
However, this is not actually true; no exception is raised only when GLPK has a feasible solution available when the time limit expires. 
Here (in version 4.60) it does not have a feasible solution available. I have not checked the details. 
On my machine, increasing the time limit to 0.1 fixes this test. Needless to say, this is of course a brittle test.



---

archive/issue_comments_282067.json:
```json
{
    "body": "I should add that if one increases the time limit, one should probably increase \"rel tol 1\" to \"rel tol 100\", because it might find a better solution than 1 on a fast machine (or in a newer GLPK version).",
    "created_at": "2016-06-25T07:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282067",
    "user": "https://github.com/mkoeppe"
}
```

I should add that if one increases the time limit, one should probably increase "rel tol 1" to "rel tol 100", because it might find a better solution than 1 on a fast machine (or in a newer GLPK version).



---

archive/issue_comments_282068.json:
```json
{
    "body": "Funky the last email I received from this ticket is when Jeroen changed the description :( - Adding myself as cc to avoid problems.\n\nUnless someone wants to write a new test I will make the changes suggested by Matthias to the failing doctest.",
    "created_at": "2016-06-26T21:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282068",
    "user": "https://github.com/kiwifb"
}
```

Funky the last email I received from this ticket is when Jeroen changed the description :( - Adding myself as cc to avoid problems.

Unless someone wants to write a new test I will make the changes suggested by Matthias to the failing doctest.



---

archive/issue_comments_282069.json:
```json
{
    "body": "Replying to [comment:27 fbissey]:\n> Unless someone wants to write a new test I will make the changes suggested by Matthias to the failing doctest.\nGo ahead. There's no fundamentally better way to write a new test for this \"feature\" of the interface.",
    "created_at": "2016-06-27T04:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282069",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:27 fbissey]:
> Unless someone wants to write a new test I will make the changes suggested by Matthias to the failing doctest.
Go ahead. There's no fundamentally better way to write a new test for this "feature" of the interface.



---

archive/issue_comments_282070.json:
```json
{
    "body": "I had to raise the time limit to 1.0, 0.1 was not enough. My machine is not especially slow so I think it may fail on other machines even with `1.0`. I am thinking of raising it higher.",
    "created_at": "2016-06-27T10:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282070",
    "user": "https://github.com/kiwifb"
}
```

I had to raise the time limit to 1.0, 0.1 was not enough. My machine is not especially slow so I think it may fail on other machines even with `1.0`. I am thinking of raising it higher.



---

archive/issue_comments_282071.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-29T22:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282071",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282072.json:
```json
{
    "body": "I get this (on Mac OS X):\n\n```\nFile \"src/sage/numerical/mip.pyx\", line 2477, in sage.numerical.mip.MixedIntegerLinearProgram.number_of_variables.get_backend\nFailed example:\n    p.solve()  # rel tol 1e-5\nExpected:\n    GLPK Simplex Optimizer, v4.60\n    2 rows, 2 columns, 4 non-zeros\n    *     0: obj =   7.000000000e+00  infeas =  0.000e+00 (0)\n    *     2: obj =   9.400000000e+00  infeas =  0.000e+00 (0)\n    OPTIMAL LP SOLUTION FOUND\n    9.4\nGot:\n    GLPK Simplex Optimizer, v4.60\n    2 rows, 2 columns, 4 non-zeros\n    *     0: obj =   7.000000000e+00 inf =   0.000e+00 (2)\n    *     2: obj =   9.400000000e+00 inf =   0.000e+00 (0)\n    OPTIMAL LP SOLUTION FOUND\n    9.399999999999999\nTolerance exceeded in 1 of 13:\n    0 vs 2, tolerance inf > 1e-05\n```\n\nShould this ticket be in `needs_review`?)",
    "created_at": "2016-07-07T22:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282072",
    "user": "https://github.com/mkoeppe"
}
```

I get this (on Mac OS X):

```
File "src/sage/numerical/mip.pyx", line 2477, in sage.numerical.mip.MixedIntegerLinearProgram.number_of_variables.get_backend
Failed example:
    p.solve()  # rel tol 1e-5
Expected:
    GLPK Simplex Optimizer, v4.60
    2 rows, 2 columns, 4 non-zeros
    *     0: obj =   7.000000000e+00  infeas =  0.000e+00 (0)
    *     2: obj =   9.400000000e+00  infeas =  0.000e+00 (0)
    OPTIMAL LP SOLUTION FOUND
    9.4
Got:
    GLPK Simplex Optimizer, v4.60
    2 rows, 2 columns, 4 non-zeros
    *     0: obj =   7.000000000e+00 inf =   0.000e+00 (2)
    *     2: obj =   9.400000000e+00 inf =   0.000e+00 (0)
    OPTIMAL LP SOLUTION FOUND
    9.399999999999999
Tolerance exceeded in 1 of 13:
    0 vs 2, tolerance inf > 1e-05
```

Should this ticket be in `needs_review`?)



---

archive/issue_comments_282073.json:
```json
{
    "body": "What does that `(2)` instead of `(0)` means? I am guessing we should go to review but we may want to fix this first.\ncygwin people will have to catch later, although part of me is convinced that I shouldn't add anything at all for cygwin.",
    "created_at": "2016-07-07T22:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282073",
    "user": "https://github.com/kiwifb"
}
```

What does that `(2)` instead of `(0)` means? I am guessing we should go to review but we may want to fix this first.
cygwin people will have to catch later, although part of me is convinced that I shouldn't add anything at all for cygwin.



---

archive/issue_comments_282074.json:
```json
{
    "body": "Oh I see there are other differences. I need to check...",
    "created_at": "2016-07-07T23:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282074",
    "user": "https://github.com/kiwifb"
}
```

Oh I see there are other differences. I need to check...



---

archive/issue_comments_282075.json:
```json
{
    "body": "I definitely didn't correct that one properly even on linux. Fix coming.",
    "created_at": "2016-07-07T23:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282075",
    "user": "https://github.com/kiwifb"
}
```

I definitely didn't correct that one properly even on linux. Fix coming.



---

archive/issue_comments_282076.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-07T23:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282077.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-07T23:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282077",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_282078.json:
```json
{
    "body": "And now putting to review.",
    "created_at": "2016-07-07T23:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282078",
    "user": "https://github.com/kiwifb"
}
```

And now putting to review.



---

archive/issue_comments_282079.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-07T23:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282079",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282080.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/libs/glpk/error.pyx\n**********************************************************************\nFile \"src/sage/libs/glpk/error.pyx\", line 98, in sage.libs.glpk.error.setup_glpk_error_handler\nFailed example:\n    res = p.solve()\nExpected:\n          0: obj = ...\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.libs.glpk.error.setup_glpk_error_handler\n    [12 tests, 1 failure, 1.34 s]\n```\n",
    "created_at": "2016-07-09T07:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282080",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long src/sage/libs/glpk/error.pyx
**********************************************************************
File "src/sage/libs/glpk/error.pyx", line 98, in sage.libs.glpk.error.setup_glpk_error_handler
Failed example:
    res = p.solve()
Expected:
          0: obj = ...
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of  11 in sage.libs.glpk.error.setup_glpk_error_handler
    [12 tests, 1 failure, 1.34 s]
```




---

archive/issue_comments_282081.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-07-09T07:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282081",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_282082.json:
```json
{
    "body": "That's the test for #20832. I had forgotten about that one. It is very curious, when run at the sage prompt it gives the expected result but in the doctest we have that blank line. And of course it didn't happen with the previous version of `glpk`. Any idea Jeroen?",
    "created_at": "2016-07-09T07:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282082",
    "user": "https://github.com/kiwifb"
}
```

That's the test for #20832. I had forgotten about that one. It is very curious, when run at the sage prompt it gives the expected result but in the doctest we have that blank line. And of course it didn't happen with the previous version of `glpk`. Any idea Jeroen?



---

archive/issue_comments_282083.json:
```json
{
    "body": "Could you merge the current master?",
    "created_at": "2016-07-10T15:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282083",
    "user": "https://github.com/mkoeppe"
}
```

Could you merge the current master?



---

archive/issue_comments_282084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-10T20:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282085.json:
```json
{
    "body": "Replying to [comment:40 mkoeppe]:\n> Could you merge the current master?\n\nDone.",
    "created_at": "2016-07-10T20:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282085",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:40 mkoeppe]:
> Could you merge the current master?

Done.



---

archive/issue_comments_282086.json:
```json
{
    "body": "Better use an official upstream tarball instead of a repackaged one.\n----\nNew commits:",
    "created_at": "2016-10-03T08:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282086",
    "user": "https://github.com/jdemeyer"
}
```

Better use an official upstream tarball instead of a repackaged one.
----
New commits:



---

archive/issue_comments_282087.json:
```json
{
    "body": "I see. We need patches to the autoconf sources. So yes, we need a custom tarball.",
    "created_at": "2016-10-03T08:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282087",
    "user": "https://github.com/jdemeyer"
}
```

I see. We need patches to the autoconf sources. So yes, we need a custom tarball.



---

archive/issue_comments_282088.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> I see. We need patches to the autoconf sources. So yes, we need a custom tarball.\n\nThank you, I prefer repacking rather than \"custom\" patches to configure, Makefile.in and al. Of course, I would prefer running autoreconf on the spot from a pristine tarball but that trade off has already been sold in sagemath.\n\nAny ideas what is going on with the error reporting code?",
    "created_at": "2016-10-03T08:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282088",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:46 jdemeyer]:
> I see. We need patches to the autoconf sources. So yes, we need a custom tarball.

Thank you, I prefer repacking rather than "custom" patches to configure, Makefile.in and al. Of course, I would prefer running autoreconf on the spot from a pristine tarball but that trade off has already been sold in sagemath.

Any ideas what is going on with the error reporting code?



---

archive/issue_comments_282089.json:
```json
{
    "body": "Replying to [comment:47 fbissey]:\n> Any ideas what is going on with the error reporting code?\n\nI'm just building this branch now...",
    "created_at": "2016-10-03T08:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282089",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:47 fbissey]:
> Any ideas what is going on with the error reporting code?

I'm just building this branch now...



---

archive/issue_comments_282090.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-03T13:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282091.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-03T13:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282091",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_282092.json:
```json
{
    "body": "Trivial fix: upstream apparently uses `err_st` instead of `err_file`.",
    "created_at": "2016-10-03T13:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282092",
    "user": "https://github.com/jdemeyer"
}
```

Trivial fix: upstream apparently uses `err_st` instead of `err_file`.



---

archive/issue_comments_282093.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-10-03T13:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282093",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_282094.json:
```json
{
    "body": "I'll test that ASAP.",
    "created_at": "2016-10-03T19:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282094",
    "user": "https://github.com/kiwifb"
}
```

I'll test that ASAP.



---

archive/issue_comments_282095.json:
```json
{
    "body": "Solves the problem here\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/libs/glpk/error.pyx\n    [12 tests, 1.68 s]\n----------------------------------------------------------------------\nAll tests passed!\n```\n",
    "created_at": "2016-10-03T19:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282095",
    "user": "https://github.com/kiwifb"
}
```

Solves the problem here

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/libs/glpk/error.pyx
    [12 tests, 1.68 s]
----------------------------------------------------------------------
All tests passed!
```




---

archive/issue_comments_282096.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-03T19:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282096",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282097.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-08T08:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282097",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_282098.json:
```json
{
    "body": "\n```\n5058sage -t --long src/sage/numerical/backends/glpk_backend.pyx\n5059**********************************************************************\n5060File \"src/sage/numerical/backends/glpk_backend.pyx\", line 912, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\n5061Failed example:\n5062    lp.solve()\n5063Expected:\n5064    2.0\n5065Got:\n5066    glp_exact: 3 rows, 2 columns, 6 non-zeros\n5067    GNU MP bignum library is being used\n5068    *     2:   objval =                      2   (0)\n5069    *     2:   objval =                      2   (0)\n5070    OPTIMAL SOLUTION FOUND\n5071    2.0\n5072**********************************************************************\n5073File \"src/sage/numerical/backends/glpk_backend.pyx\", line 944, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\n5074Failed example:\n5075    lp.solve() == test # yes, we want an exact comparison here\n5076Expected:\n5077    True\n5078Got:\n5079    glp_exact: 1 rows, 1 columns, 1 non-zeros\n5080    GNU MP bignum library is being used\n5081    *     0:   objval =                      0   (0)\n5082    *     1:   objval =   9.00719925474095e+15   (0)\n5083    OPTIMAL SOLUTION FOUND\n5084    True\n5085**********************************************************************\n5086File \"src/sage/numerical/backends/glpk_backend.pyx\", line 1578, in sage.numerical.backends.glpk_backend.GLPKBackend.write_lp\n5087Failed example:\n5088    p.write_lp(os.path.join(SAGE_TMP, \"lp_problem.lp\"))\n5089Expected nothing\n5090Got:\n5091    Writing problem data to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/lp_problem.lp'...\n5092    9 lines were written\n5093**********************************************************************\n5094File \"src/sage/numerical/backends/glpk_backend.pyx\", line 1598, in sage.numerical.backends.glpk_backend.GLPKBackend.write_mps\n5095Failed example:\n5096    p.write_mps(os.path.join(SAGE_TMP, \"lp_problem.mps\"), 2)\n5097Expected nothing\n5098Got:\n5099    Writing problem data to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/lp_problem.mps'...\n5100    17 records were written\n5101**********************************************************************\n5102File \"src/sage/numerical/backends/glpk_backend.pyx\", line 2228, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\n5103Failed example:\n5104    p.print_ranges()\n5105Expected:\n5106    1\n5107Got:\n5108    glp_print_ranges: optimal basic solution required\n5109    1\n5110**********************************************************************\n5111File \"src/sage/numerical/backends/glpk_backend.pyx\", line 2232, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\n5112Failed example:\n5113    p.print_ranges()\n5114Expected:\n5115    GLPK ... - SENSITIVITY ANALYSIS REPORT                                                                         Page   1\n5116    <BLANKLINE>\n5117    Problem:\n5118    Objective:  7.5 (MAXimum)\n5119    <BLANKLINE>\n5120       No. Row name     St      Activity         Slack   Lower bound       Activity      Obj coef  Obj value at Limiting\n5121                                              Marginal   Upper bound          range         range   break point variable\n5122    ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------\n5123         1              NU       3.00000        .               -Inf         .           -2.50000        .\n5124                                               2.50000       3.00000           +Inf          +Inf          +Inf\n5125    <BLANKLINE>\n5126    GLPK ... - SENSITIVITY ANALYSIS REPORT                                                                         Page   2\n5127    <BLANKLINE>\n5128    Problem:\n5129    Objective:  7.5 (MAXimum)\n5130    <BLANKLINE>\n5131       No. Column name  St      Activity      Obj coef   Lower bound       Activity      Obj coef  Obj value at Limiting\n5132                                              Marginal   Upper bound          range         range   break point variable\n5133    ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------\n5134         1              NL        .            2.00000        .                -Inf          -Inf          +Inf\n5135                                               -.50000          +Inf        3.00000       2.50000       6.00000\n5136    <BLANKLINE>\n5137         2              BS       1.50000       5.00000        .                -Inf       4.00000       6.00000\n5138                                                .               +Inf        1.50000          +Inf          +Inf\n5139    <BLANKLINE>\n5140    End of report\n5141    <BLANKLINE>\n5142    0\n5143Got:\n5144    Write sensitivity analysis report to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/ranges.tmp'...\n5145    GLPK 4.60 - SENSITIVITY ANALYSIS REPORT                                                                         Page   1\n5146    <BLANKLINE>\n5147     Problem:    \n5148     Objective:  7.5 (MAXimum)\n5149    <BLANKLINE>\n5150        No. Row name     St      Activity         Slack   Lower bound       Activity      Obj coef  Obj value at Limiting\n5151                                               Marginal   Upper bound          range         range   break point variable\n5152     ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------\n5153          1              NU       3.00000        .               -Inf         .           -2.50000        .     \n5154                                                2.50000       3.00000           +Inf          +Inf          +Inf\n5155    <BLANKLINE>\n5156     GLPK 4.60 - SENSITIVITY ANALYSIS REPORT                                                                         Page   2\n5157    <BLANKLINE>\n5158     Problem:    \n5159     Objective:  7.5 (MAXimum)\n5160    <BLANKLINE>\n5161        No. Column name  St      Activity      Obj coef   Lower bound       Activity      Obj coef  Obj value at Limiting\n5162                                               Marginal   Upper bound          range         range   break point variable\n5163     ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------\n5164          1              NL        .            2.00000        .                -Inf          -Inf          +Inf\n5165                                                -.50000          +Inf        3.00000       2.50000       6.00000\n5166    <BLANKLINE>\n5167          2              BS       1.50000       5.00000        .                -Inf       4.00000       6.00000\n5168                                                 .               +Inf        1.50000          +Inf          +Inf\n5169    <BLANKLINE>\n5170     End of report\n5171    <BLANKLINE>\n5172    <BLANKLINE>\n5173    0\n5174**********************************************************************\n51754 items had failures:\n5176   2 of  11 in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\n5177   2 of  76 in sage.numerical.backends.glpk_backend.GLPKBackend.solve\n5178   1 of   7 in sage.numerical.backends.glpk_backend.GLPKBackend.write_lp\n5179   1 of   7 in sage.numerical.backends.glpk_backend.GLPKBackend.write_mps\n5180    [535 tests, 6 failures, 4.97 s]\n```\n",
    "created_at": "2016-10-08T08:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282098",
    "user": "https://github.com/vbraun"
}
```


```
5058sage -t --long src/sage/numerical/backends/glpk_backend.pyx
5059**********************************************************************
5060File "src/sage/numerical/backends/glpk_backend.pyx", line 912, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
5061Failed example:
5062    lp.solve()
5063Expected:
5064    2.0
5065Got:
5066    glp_exact: 3 rows, 2 columns, 6 non-zeros
5067    GNU MP bignum library is being used
5068    *     2:   objval =                      2   (0)
5069    *     2:   objval =                      2   (0)
5070    OPTIMAL SOLUTION FOUND
5071    2.0
5072**********************************************************************
5073File "src/sage/numerical/backends/glpk_backend.pyx", line 944, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
5074Failed example:
5075    lp.solve() == test # yes, we want an exact comparison here
5076Expected:
5077    True
5078Got:
5079    glp_exact: 1 rows, 1 columns, 1 non-zeros
5080    GNU MP bignum library is being used
5081    *     0:   objval =                      0   (0)
5082    *     1:   objval =   9.00719925474095e+15   (0)
5083    OPTIMAL SOLUTION FOUND
5084    True
5085**********************************************************************
5086File "src/sage/numerical/backends/glpk_backend.pyx", line 1578, in sage.numerical.backends.glpk_backend.GLPKBackend.write_lp
5087Failed example:
5088    p.write_lp(os.path.join(SAGE_TMP, "lp_problem.lp"))
5089Expected nothing
5090Got:
5091    Writing problem data to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/lp_problem.lp'...
5092    9 lines were written
5093**********************************************************************
5094File "src/sage/numerical/backends/glpk_backend.pyx", line 1598, in sage.numerical.backends.glpk_backend.GLPKBackend.write_mps
5095Failed example:
5096    p.write_mps(os.path.join(SAGE_TMP, "lp_problem.mps"), 2)
5097Expected nothing
5098Got:
5099    Writing problem data to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/lp_problem.mps'...
5100    17 records were written
5101**********************************************************************
5102File "src/sage/numerical/backends/glpk_backend.pyx", line 2228, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
5103Failed example:
5104    p.print_ranges()
5105Expected:
5106    1
5107Got:
5108    glp_print_ranges: optimal basic solution required
5109    1
5110**********************************************************************
5111File "src/sage/numerical/backends/glpk_backend.pyx", line 2232, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
5112Failed example:
5113    p.print_ranges()
5114Expected:
5115    GLPK ... - SENSITIVITY ANALYSIS REPORT                                                                         Page   1
5116    <BLANKLINE>
5117    Problem:
5118    Objective:  7.5 (MAXimum)
5119    <BLANKLINE>
5120       No. Row name     St      Activity         Slack   Lower bound       Activity      Obj coef  Obj value at Limiting
5121                                              Marginal   Upper bound          range         range   break point variable
5122    ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------
5123         1              NU       3.00000        .               -Inf         .           -2.50000        .
5124                                               2.50000       3.00000           +Inf          +Inf          +Inf
5125    <BLANKLINE>
5126    GLPK ... - SENSITIVITY ANALYSIS REPORT                                                                         Page   2
5127    <BLANKLINE>
5128    Problem:
5129    Objective:  7.5 (MAXimum)
5130    <BLANKLINE>
5131       No. Column name  St      Activity      Obj coef   Lower bound       Activity      Obj coef  Obj value at Limiting
5132                                              Marginal   Upper bound          range         range   break point variable
5133    ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------
5134         1              NL        .            2.00000        .                -Inf          -Inf          +Inf
5135                                               -.50000          +Inf        3.00000       2.50000       6.00000
5136    <BLANKLINE>
5137         2              BS       1.50000       5.00000        .                -Inf       4.00000       6.00000
5138                                                .               +Inf        1.50000          +Inf          +Inf
5139    <BLANKLINE>
5140    End of report
5141    <BLANKLINE>
5142    0
5143Got:
5144    Write sensitivity analysis report to '/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/98275/ranges.tmp'...
5145    GLPK 4.60 - SENSITIVITY ANALYSIS REPORT                                                                         Page   1
5146    <BLANKLINE>
5147     Problem:    
5148     Objective:  7.5 (MAXimum)
5149    <BLANKLINE>
5150        No. Row name     St      Activity         Slack   Lower bound       Activity      Obj coef  Obj value at Limiting
5151                                               Marginal   Upper bound          range         range   break point variable
5152     ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------
5153          1              NU       3.00000        .               -Inf         .           -2.50000        .     
5154                                                2.50000       3.00000           +Inf          +Inf          +Inf
5155    <BLANKLINE>
5156     GLPK 4.60 - SENSITIVITY ANALYSIS REPORT                                                                         Page   2
5157    <BLANKLINE>
5158     Problem:    
5159     Objective:  7.5 (MAXimum)
5160    <BLANKLINE>
5161        No. Column name  St      Activity      Obj coef   Lower bound       Activity      Obj coef  Obj value at Limiting
5162                                               Marginal   Upper bound          range         range   break point variable
5163     ------ ------------ -- ------------- ------------- -------------  ------------- ------------- ------------- ------------
5164          1              NL        .            2.00000        .                -Inf          -Inf          +Inf
5165                                                -.50000          +Inf        3.00000       2.50000       6.00000
5166    <BLANKLINE>
5167          2              BS       1.50000       5.00000        .                -Inf       4.00000       6.00000
5168                                                 .               +Inf        1.50000          +Inf          +Inf
5169    <BLANKLINE>
5170     End of report
5171    <BLANKLINE>
5172    <BLANKLINE>
5173    0
5174**********************************************************************
51754 items had failures:
5176   2 of  11 in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
5177   2 of  76 in sage.numerical.backends.glpk_backend.GLPKBackend.solve
5178   1 of   7 in sage.numerical.backends.glpk_backend.GLPKBackend.write_lp
5179   1 of   7 in sage.numerical.backends.glpk_backend.GLPKBackend.write_mps
5180    [535 tests, 6 failures, 4.97 s]
```




---

archive/issue_comments_282099.json:
```json
{
    "body": "What machine is that?",
    "created_at": "2016-10-08T08:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282099",
    "user": "https://github.com/kiwifb"
}
```

What machine is that?



---

archive/issue_comments_282100.json:
```json
{
    "body": "OK something changed with this doctest in between the first time it went to the bot and now. Not sure what yet, but apart from the time limit all the corrected doctest have returned to their previous behavior in that file.",
    "created_at": "2016-10-08T09:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282100",
    "user": "https://github.com/kiwifb"
}
```

OK something changed with this doctest in between the first time it went to the bot and now. Not sure what yet, but apart from the time limit all the corrected doctest have returned to their previous behavior in that file.



---

archive/issue_comments_282101.json:
```json
{
    "body": "For me, all tests still pass with in the file `src/sage/numerical/backends/glpk_backend.pyx` (both with and without `--long`).",
    "created_at": "2016-10-08T09:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282101",
    "user": "https://github.com/jdemeyer"
}
```

For me, all tests still pass with in the file `src/sage/numerical/backends/glpk_backend.pyx` (both with and without `--long`).



---

archive/issue_comments_282102.json:
```json
{
    "body": "Possible, I am seeing the change on a recent snapshot of Volker development branch on github (6th of October). So probably after the last beta was published.",
    "created_at": "2016-10-08T09:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282102",
    "user": "https://github.com/kiwifb"
}
```

Possible, I am seeing the change on a recent snapshot of Volker development branch on github (6th of October). So probably after the last beta was published.



---

archive/issue_comments_282103.json:
```json
{
    "body": "I confirm the bug, Volker's output is correct: GLPK does print that output, so we should see it. So the doctests should be restored and I will look why it's failing for me.",
    "created_at": "2016-10-08T09:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282103",
    "user": "https://github.com/jdemeyer"
}
```

I confirm the bug, Volker's output is correct: GLPK does print that output, so we should see it. So the doctests should be restored and I will look why it's failing for me.



---

archive/issue_comments_282104.json:
```json
{
    "body": "False alarm... I was testing an older version of this branch. Good!\n\nSo we just need to restore the doctests, I'll do that right now.",
    "created_at": "2016-10-08T09:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282104",
    "user": "https://github.com/jdemeyer"
}
```

False alarm... I was testing an older version of this branch. Good!

So we just need to restore the doctests, I'll do that right now.



---

archive/issue_comments_282105.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-08T09:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282106.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-08T09:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282106",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_282107.json:
```json
{
    "body": "**ping**",
    "created_at": "2016-10-18T13:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282107",
    "user": "https://github.com/jdemeyer"
}
```

**ping**



---

archive/issue_comments_282108.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-18T18:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282108",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282109.json:
```json
{
    "body": "Putting it back to positive review.",
    "created_at": "2016-10-18T18:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282109",
    "user": "https://github.com/kiwifb"
}
```

Putting it back to positive review.



---

archive/issue_comments_282110.json:
```json
{
    "body": "Looks good to me too.",
    "created_at": "2016-10-19T00:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282110",
    "user": "https://github.com/mkoeppe"
}
```

Looks good to me too.



---

archive/issue_comments_282111.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282111",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019436.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-10-21T07:04:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20473#event-19436"
}
```



---

archive/issue_comments_282112.json:
```json
{
    "body": "It seems like glpk needs an update again in order to keep the patchbot happy. See #23777 .",
    "created_at": "2017-09-02T03:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282112",
    "user": "https://github.com/koffie"
}
```

It seems like glpk needs an update again in order to keep the patchbot happy. See #23777 .



---

archive/issue_comments_282113.json:
```json
{
    "body": "We have to carry a very [counterintuitive patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/dt-version-glpk-4.60-extra-hacky-fixes.patch) in Debian because the GLPK `err_st = 0` [patch](https://git.sagemath.org/sage.git/tree/build/pkgs/glpk/patches/error_recovery.patch?id=3e8450b13d5c5353cd45d5881acf59994cf28b6b) was not accepted upstream. It takes me several minutes to understand what I myself wrote, every time I read it. :/\n\nIs there any way to do the equivalent thing (`err_st = 0`) in Sage instead of GLPK? I thought Cython let you access C internals.",
    "created_at": "2017-11-09T13:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282113",
    "user": "https://github.com/infinity0"
}
```

We have to carry a very [counterintuitive patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/dt-version-glpk-4.60-extra-hacky-fixes.patch) in Debian because the GLPK `err_st = 0` [patch](https://git.sagemath.org/sage.git/tree/build/pkgs/glpk/patches/error_recovery.patch?id=3e8450b13d5c5353cd45d5881acf59994cf28b6b) was not accepted upstream. It takes me several minutes to understand what I myself wrote, every time I read it. :/

Is there any way to do the equivalent thing (`err_st = 0`) in Sage instead of GLPK? I thought Cython let you access C internals.



---

archive/issue_comments_282114.json:
```json
{
    "body": "Or as an alternative attempt at upstreaming this again: perhaps `err_st = 0` could be conditioned so that most users of GLPK are unaffected, but Sage could pass in a special flag to GLPK to activate this behaviour just for Sage.",
    "created_at": "2017-11-09T13:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282114",
    "user": "https://github.com/infinity0"
}
```

Or as an alternative attempt at upstreaming this again: perhaps `err_st = 0` could be conditioned so that most users of GLPK are unaffected, but Sage could pass in a special flag to GLPK to activate this behaviour just for Sage.



---

archive/issue_comments_282115.json:
```json
{
    "body": "Replying to [comment:68 infinity0]:\n> Is there any way to do the equivalent thing (`err_st = 0`) in Sage instead of GLPK?\n\nNo. Otherwise we would have done that.\n\n> I thought Cython let you access C internals.\n\nThat's true, but only C internals which are actually exposed by the library. This concerns some internal structure of GLPK which is not exposed by any API.",
    "created_at": "2017-11-09T14:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282115",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:68 infinity0]:
> Is there any way to do the equivalent thing (`err_st = 0`) in Sage instead of GLPK?

No. Otherwise we would have done that.

> I thought Cython let you access C internals.

That's true, but only C internals which are actually exposed by the library. This concerns some internal structure of GLPK which is not exposed by any API.



---

archive/issue_comments_282116.json:
```json
{
    "body": "Replying to [comment:69 infinity0]:\n> Or as an alternative attempt at upstreaming this again: perhaps `err_st = 0` could be conditioned so that most users of GLPK are unaffected\n\nThe way I understood upstream's answer is that this patch only affects uses of GLPK which are explicitly unsupported. So, by definition this patch wouldn't break any supported use cases. They don't want to accept this patch since it might imply support for something that they don't support. In the view of GLPK, Sage is using GLPK in a wrong way.",
    "created_at": "2017-11-10T12:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282116",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:69 infinity0]:
> Or as an alternative attempt at upstreaming this again: perhaps `err_st = 0` could be conditioned so that most users of GLPK are unaffected

The way I understood upstream's answer is that this patch only affects uses of GLPK which are explicitly unsupported. So, by definition this patch wouldn't break any supported use cases. They don't want to accept this patch since it might imply support for something that they don't support. In the view of GLPK, Sage is using GLPK in a wrong way.



---

archive/issue_comments_282117.json:
```json
{
    "body": "The feature in question is recovery after an error. As far as I can tell, this was first used by Sage in #12309 and we never had problems with it. So, this is a feature which seemingly works but which is unsupported. And GLPK doesn't want to accept a patch to improve something unsupported.\n\nMaybe you could try to convince GLPK again as a Debian maintainer. Alternatively, could you convince Debian to include the Sage patch for GLPK?",
    "created_at": "2017-11-10T12:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20473#issuecomment-282117",
    "user": "https://github.com/jdemeyer"
}
```

The feature in question is recovery after an error. As far as I can tell, this was first used by Sage in #12309 and we never had problems with it. So, this is a feature which seemingly works but which is unsupported. And GLPK doesn't want to accept a patch to improve something unsupported.

Maybe you could try to convince GLPK again as a Debian maintainer. Alternatively, could you convince Debian to include the Sage patch for GLPK?
