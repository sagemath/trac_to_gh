# Issue 30838: Add configuration and documentation for code formatter "black"

Issue created by migration from https://trac.sagemath.org/ticket/31075

Original creator: @tobiasdiez

Original creation time: 2020-12-18 14:23:31

CC:  mkoeppe chapoton

The code formatter "black" is probably the most popular one for Python. We add basic configuration and documentation for it.

I would actually propose to reformat the whole code base with black, and then require that people use it before checkin their code (checked via the official github action). In this way one could get rid of all the formatting problems once and for all. This global reformat probably needs to be done by the release manager to prevent merge conflicts.


---

Comment by @tobiasdiez created at 2020-12-18 14:23:37

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-12-18 18:46:59

The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it


---

Comment by git created at 2020-12-18 21:47:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-18 21:48:01

Replying to [comment:2 mkoeppe]:
> The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it

Good idea. Added, also for pycodestyle.


---

Comment by mkoeppe created at 2020-12-19 17:48:12

Perhaps `@`chapoton could comment on the current status and plans regarding code style in sagelib.  There seems to be a plan but I don't know if it is written anywhere.


---

Comment by @tobiasdiez created at 2021-01-06 12:31:32

Comments concerning a plan how to proceed with the code style are welcome indeed.


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by roed created at 2021-04-28 08:26:30

I think requiring black's code formatting style should be discussed on sage-devel.  I'm personally against various choices they make (mainly the excessive newlines).


---

Comment by @tobiasdiez created at 2021-05-18 07:38:54

`@`mkoeppe, chapoton, how should we proceed with this?


---

Comment by chapoton created at 2021-05-18 07:46:48

from me, a **strong negative vote** on using black


---

Comment by roed created at 2021-05-18 20:24:55

I agree: I would prefer not to use black as a commit hook.  I find that it adds a lot of unnecessary whitespace.  As an example, here's a diff produced by black that I find makes the code less readable:


```
-verbose("Approximants of %r on %r towards %r"%(self, self.domain(), G), level=3)
+verbose(
+    "Approximants of %r on %r towards %r" % (self, self.domain(), G), level=3
+)
```


I also don't think it's worth making a change across Sage that will break everyone's outstanding branches.


---

Comment by roed created at 2021-05-18 20:26:43

Also, the branch on this ticket gives a merge failure.


---

Comment by chapoton created at 2021-05-20 15:30:24

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2021-05-20 15:30:24

red branch => needs work
