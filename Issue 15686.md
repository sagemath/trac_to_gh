# Issue 15686: Incorrect TypeError in FiniteStateMachine.add_from_transition_function

Issue created by migration from Trac.

Original creator: cheuberg

Original creation time: 2014-03-12 12:24:56

Keywords: finite_state_machine

A TypeError occurring in the callback function `sage.combinat.finite_state_machine.FiniteStateMachine.add_from_transition_function`
is incorrectly caught and leads to a misleading ValueError.
   
Old behaviour:
   {{{
   sage: def transition(state, where):
   sage: ...    return (vector([0,0]),1)
   sage: Transducer(transition, input_alphabet=[0], initial_states=[0])
   Traceback (click to the left of this block for traceback)
   ...
   ValueError: The callback function for add_from_transition is expected to
   return a pair (new_state, output_label) or a list of such pairs. For the
   state 0 and the input letter 0, it however returned [((0, 0), 1)], which
   is not acceptable.
   }}}
   
New behaviour:
   {{{ 
   sage: def transition(state, where):
   sage: ...    return (vector([0,0]),1)
   sage: Transducer(transition, input_alphabet=[0], initial_states=[0])
   Traceback (click to the left of this block for traceback)
   ...
   TypeError: mutable vectors are unhashable
   }}}



---

Comment by cheuberg created at 2014-03-12 12:25:23

Changing status from new to needs_review.


---

Comment by dkrenn created at 2014-03-17 13:04:15

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2014-03-18 09:50:00

everything looks fine, doctests pass, docu checked, coverage checked


---

Comment by vbraun created at 2014-03-21 17:47:36

Resolution: fixed
