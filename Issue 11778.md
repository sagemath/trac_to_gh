# Issue 11778: Bug in topological_sort

Issue created by migration from https://trac.sagemath.org/ticket/11950

Original creator: andrejv

Original creation time: 2011-10-24 20:02:56

Assignee: jason, ncohen, rlm

There is a bug in topological_sort for digraphs:

```
sage: D = DiGraph('IR??C?G?OOAOGc@??o')
sage: D.topological_sort()
[0, 1, 4, 9, 6, 7, 5, 8, 3, 2, 1]
```

A correct answer is returned from networkx:

```
sage: D.topological_sort(implementation="NetworkX")
[0, 4, 9, 6, 7, 5, 8, 3, 2, 1]
```



---

Comment by ncohen created at 2011-10-28 18:17:51

For the story, I stared at this algorithm for 50 minutes thinking it was returning a wrong ordering (I must have misread the ordering when first checking), to end up convinced that the orderings returned *HAD* to be valid. 

Only then I noticed that the problem lied in some vertices being returned twice. The fix was easy : once you have said that a vertex needs to be deactivated *DO NOT CONSIDER IT EVER AGAIN*. The fix lies in the lines :


```
                # This vertex may have been deactivated since we added it.                                                                                                                                                                    
                if bitset_not_in(activated, u):                                                                                                                                                                                               
                    stack.pop(-1)                                                                                                                                                                                                             
                    continue  
```


But I modified the code in some other places to make it clearer, and added some documentation. Sorry for that `:-)` !

Nathann


---

Comment by ncohen created at 2011-10-28 18:17:51

Changing status from new to needs_review.


---

Attachment

Milestone sage-4.7.3 deleted


---

Comment by dcoudert created at 2011-12-10 19:53:36

I have no problem for installing the patch and for building the documentation.

I did several trials on several randomly generated DAGs, and the results of D.topological_sort() and D.topological_sort(implementation="NetworkX") are the same. 

I give a positive review.

Thank you.
David.


---

Comment by dcoudert created at 2011-12-10 19:53:36

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2011-12-10 20:04:59

Wouhouuuuuu !! Thanks !! So many of my patches are getting reviewed that I should begin to write new ones ! `:-D`

Nathann


---

Comment by jdemeyer created at 2011-12-14 22:29:02

Resolution: fixed
