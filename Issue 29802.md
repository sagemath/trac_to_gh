# Issue 29802: Implement weighted version of 2Dsweep and DiFUB

archive/issues_029802.json:
```json
{
    "body": "CC:  @dcoudert\n\nKeywords: gsoc2020\n\nThis ticket aims to implement weighted version of `2Dsweep` and `DiFUB`\n\nIssue created by migration from https://trac.sagemath.org/ticket/30039\n\n",
    "created_at": "2020-07-01T12:59:19Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Implement weighted version of 2Dsweep and DiFUB",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29802",
    "user": "@vipul79321"
}
```
CC:  @dcoudert

Keywords: gsoc2020

This ticket aims to implement weighted version of `2Dsweep` and `DiFUB`

Issue created by migration from https://trac.sagemath.org/ticket/30039





---

archive/issue_comments_423270.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-01T13:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423270",
    "user": "@vipul79321"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423271.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-01T13:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423271",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423272.json:
```json
{
    "body": "Replying to [comment:2 git]:\n> ||[2d53b3e](https://git.sagemath.org/sage.git/commit/?id=2d53b3edca6ef352aeaf12b4ff1221ac6b18f534)||` weighted 2Dsweep added`||\n\nHello David, \n\nI have added weighted version of `2Dsweep` and wrapper method for `diameter` computation similar to in `distances_all_pairs.pyx`. Its not final yet, I just wanted to keep you updated with how I have decided to organize it.\n\nKindly take a look at it. Any suggestions will be helpful.\n\nI will hopefully complete the weighted version of `DiFUB` by tomorrow.\n\nVipul",
    "created_at": "2020-07-01T13:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423272",
    "user": "@vipul79321"
}
```

Replying to [comment:2 git]:
> ||[2d53b3e](https://git.sagemath.org/sage.git/commit/?id=2d53b3edca6ef352aeaf12b4ff1221ac6b18f534)||` weighted 2Dsweep added`||

Hello David, 

I have added weighted version of `2Dsweep` and wrapper method for `diameter` computation similar to in `distances_all_pairs.pyx`. Its not final yet, I just wanted to keep you updated with how I have decided to organize it.

Kindly take a look at it. Any suggestions will be helpful.

I will hopefully complete the weighted version of `DiFUB` by tomorrow.

Vipul



---

archive/issue_comments_423273.json:
```json
{
    "body": "You don't compute distances from antipodes...",
    "created_at": "2020-07-01T15:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423273",
    "user": "@dcoudert"
}
```

You don't compute distances from antipodes...



---

archive/issue_comments_423274.json:
```json
{
    "body": "Replying to [comment:4 dcoudert]:\n> You don't compute distances from antipodes...\n> \n> \nI didnt quite understand what you are saying, are you suggesting to stop 2Dsweep after 2nd step. But i would like to mention that we have followed the same steps in unweighted version of 2Dsweep. \n\nSorry to bother you.. But can you please expalin you are saying.",
    "created_at": "2020-07-01T17:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423274",
    "user": "@vipul79321"
}
```

Replying to [comment:4 dcoudert]:
> You don't compute distances from antipodes...
> 
> 
I didnt quite understand what you are saying, are you suggesting to stop 2Dsweep after 2nd step. But i would like to mention that we have followed the same steps in unweighted version of 2Dsweep. 

Sorry to bother you.. But can you please expalin you are saying.



---

archive/issue_comments_423275.json:
```json
{
    "body": "I missed these lines\n\n```\n+    source_1 = antipode_1\n+    source_2 = antipode_2\n```\n\nso it's ok.",
    "created_at": "2020-07-01T17:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423275",
    "user": "@dcoudert"
}
```

I missed these lines

```
+    source_1 = antipode_1
+    source_2 = antipode_2
```

so it's ok.



---

archive/issue_comments_423276.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-02T13:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423276",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423277.json:
```json
{
    "body": "Replying to [comment:7 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[867a0a8](https://git.sagemath.org/sage.git/commit/?id=867a0a8dd653dc70b0280ec1f8532a781ece1a95)||`weighted difub added and exposed in digraph.py`||\n\nP.S. - I have made the changes in `eccentricity` method in `digraph.py` similar to `graph.py`",
    "created_at": "2020-07-02T13:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423277",
    "user": "@vipul79321"
}
```

Replying to [comment:7 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[867a0a8](https://git.sagemath.org/sage.git/commit/?id=867a0a8dd653dc70b0280ec1f8532a781ece1a95)||`weighted difub added and exposed in digraph.py`||

P.S. - I have made the changes in `eccentricity` method in `digraph.py` similar to `graph.py`



---

archive/issue_comments_423278.json:
```json
{
    "body": "\n```diff\n-    Returns lower bound on the diamter of weighted digraph using the weighted\n-    version of the algorithm proposed in [Broder2000]_.\n+    Return a lower bound on the diameter of `G`.\n+    \n+    This method implements the weighted version of the algorithm proposed\n+    in [Broder2000]_ to compute a lower bound of the weighted digraph `G`.\n```\n\n\nThis should work and be slightly faster (ok, minor improvement)\n\n```diff\n-        order_1.push_back(pair[double, v_index](distances[v], v))\n+        order_1.emplace_back(distances[v], v)\n```\n\n\n\n```diff\n-            computed diameter. They also works with negative weight, if there is\n+            computed diameter. They also work with negative weight, if there is\n```\n\n\nThe documentation you added in `digraph.py` suggests that we don't have a basic method for weighted digraphs, but we do.\n\nIn the comparison of methods, you can compare DiFUB with any exact algorithm based on eccentricity.",
    "created_at": "2020-07-02T15:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423278",
    "user": "@dcoudert"
}
```


```diff
-    Returns lower bound on the diamter of weighted digraph using the weighted
-    version of the algorithm proposed in [Broder2000]_.
+    Return a lower bound on the diameter of `G`.
+    
+    This method implements the weighted version of the algorithm proposed
+    in [Broder2000]_ to compute a lower bound of the weighted digraph `G`.
```


This should work and be slightly faster (ok, minor improvement)

```diff
-        order_1.push_back(pair[double, v_index](distances[v], v))
+        order_1.emplace_back(distances[v], v)
```



```diff
-            computed diameter. They also works with negative weight, if there is
+            computed diameter. They also work with negative weight, if there is
```


The documentation you added in `digraph.py` suggests that we don't have a basic method for weighted digraphs, but we do.

In the comparison of methods, you can compare DiFUB with any exact algorithm based on eccentricity.



---

archive/issue_comments_423279.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-03T11:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423279",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423280.json:
```json
{
    "body": "Replying to [comment:9 dcoudert]:\n> \n\n> This should work and be slightly faster (ok, minor improvement)\n> {{{#!diff\n> -        order_1.push_back(pair[double, v_index](distances[v], v))\n> +        order_1.emplace_back(distances[v], v)\n> }}}\n> \nThis threw an error, so I kept the previous version.\n\n> The documentation you added in `digraph.py` suggests that we don't have a basic method for weighted digraphs, but we do.\n> \nI have made changes for that, but i am not sure are those changes sufficient?\n\n> In the comparison of methods, you can compare DiFUB with any exact algorithm based on eccentricity.\n\nDone.",
    "created_at": "2020-07-03T11:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423280",
    "user": "@vipul79321"
}
```

Replying to [comment:9 dcoudert]:
> 

> This should work and be slightly faster (ok, minor improvement)
> {{{#!diff
> -        order_1.push_back(pair[double, v_index](distances[v], v))
> +        order_1.emplace_back(distances[v], v)
> }}}
> 
This threw an error, so I kept the previous version.

> The documentation you added in `digraph.py` suggests that we don't have a basic method for weighted digraphs, but we do.
> 
I have made changes for that, but i am not sure are those changes sufficient?

> In the comparison of methods, you can compare DiFUB with any exact algorithm based on eccentricity.

Done.



---

archive/issue_comments_423281.json:
```json
{
    "body": "have also a look at the errors reported by the patchbot.",
    "created_at": "2020-07-03T11:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423281",
    "user": "@dcoudert"
}
```

have also a look at the errors reported by the patchbot.



---

archive/issue_comments_423282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-05T17:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423282",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423283.json:
```json
{
    "body": "Replying to [comment:12 dcoudert]:\n> have also a look at the errors reported by the patchbot.\nDone",
    "created_at": "2020-07-05T17:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423283",
    "user": "@vipul79321"
}
```

Replying to [comment:12 dcoudert]:
> have also a look at the errors reported by the patchbot.
Done



---

archive/issue_comments_423284.json:
```json
{
    "body": "actually, one of these issue should be fixed in #29422, right ?",
    "created_at": "2020-07-05T17:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423284",
    "user": "@dcoudert"
}
```

actually, one of these issue should be fixed in #29422, right ?



---

archive/issue_comments_423285.json:
```json
{
    "body": "Replying to [comment:15 dcoudert]:\n> actually, one of these issue should be fixed in #29422, right ?\nYeah, i will do the same update there too.",
    "created_at": "2020-07-05T17:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423285",
    "user": "@vipul79321"
}
```

Replying to [comment:15 dcoudert]:
> actually, one of these issue should be fixed in #29422, right ?
Yeah, i will do the same update there too.



---

archive/issue_comments_423286.json:
```json
{
    "body": "While running doctests on the graph module, I get the following error.\n\n```\nsage -t src/sage/graphs/base/boost_graph.pyx\n**********************************************************************\nFile \"src/sage/graphs/base/boost_graph.pyx\", line 2121, in sage.graphs.base.boost_graph.?\nFailed example:\n    diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])\nExpected:\n    2.0\nGot:\n    Traceback (most recent call last):\n      File \"sage/graphs/base/boost_graph.pyx\", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)\n    cysignals.signals.SignalError: Segmentation fault\n    Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'\n    Traceback (most recent call last):\n      File \"sage/graphs/base/boost_graph.pyx\", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)\n    cysignals.signals.SignalError: Segmentation fault\n    0.0\n```\n\n\nAlso, you could add specific doctests for `2Dsweep` and `DiFUB`.",
    "created_at": "2020-07-08T07:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423286",
    "user": "@dcoudert"
}
```

While running doctests on the graph module, I get the following error.

```
sage -t src/sage/graphs/base/boost_graph.pyx
**********************************************************************
File "src/sage/graphs/base/boost_graph.pyx", line 2121, in sage.graphs.base.boost_graph.?
Failed example:
    diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])
Expected:
    2.0
Got:
    Traceback (most recent call last):
      File "sage/graphs/base/boost_graph.pyx", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)
    cysignals.signals.SignalError: Segmentation fault
    Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'
    Traceback (most recent call last):
      File "sage/graphs/base/boost_graph.pyx", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)
    cysignals.signals.SignalError: Segmentation fault
    0.0
```


Also, you could add specific doctests for `2Dsweep` and `DiFUB`.



---

archive/issue_comments_423287.json:
```json
{
    "body": "Replying to [comment:17 dcoudert]:\n> While running doctests on the graph module, I get the following error.\n> {{{\n> sage -t src/sage/graphs/base/boost_graph.pyx\n> **********************************************************************\n> File \"src/sage/graphs/base/boost_graph.pyx\", line 2121, in sage.graphs.base.boost_graph.?\n> Failed example:\n>     diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])\n> Expected:\n>     2.0\n> Got:\n>     Traceback (most recent call last):\n>       File \"sage/graphs/base/boost_graph.pyx\", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)\n>     cysignals.signals.SignalError: Segmentation fault\n>     Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'\n>     Traceback (most recent call last):\n>       File \"sage/graphs/base/boost_graph.pyx\", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)\n>     cysignals.signals.SignalError: Segmentation fault\n>     0.0\n> }}}\n> \nThat's weird, when ran doctest on my system it passed with no error. I have checked it again. Still no problem.\n\n\n```\nsage: from sage.graphs.base.boost_graph import diameter\nsage: G = DiGraph([(0,1,2), (1,0,-1)])\nsage: diameter(G, algorithm='DiFUB')\n1.0\nsage: diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])\n2.0\n```\n\n\n----\n\n\n```\nvipul@vipul-Predator-G3-572:~/sage$ ./sage -t src/sage/graphs/base/boost_graph.pyx\nRunning doctests with ID 2020-07-08-13-24-51-0d1b09f6.\nGit branch: weighted_difub\nUsing --optional=build,dochtml,memlimit,python_openid,sage,speaklater\nDoctesting 1 file.\nsage -t --warn-long 45.7 src/sage/graphs/base/boost_graph.pyx\n    [135 tests, 0.37 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 0.4 seconds\n```\n\n\n\nP.S - I am currently on latest beta release.",
    "created_at": "2020-07-08T07:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423287",
    "user": "@vipul79321"
}
```

Replying to [comment:17 dcoudert]:
> While running doctests on the graph module, I get the following error.
> {{{
> sage -t src/sage/graphs/base/boost_graph.pyx
> **********************************************************************
> File "src/sage/graphs/base/boost_graph.pyx", line 2121, in sage.graphs.base.boost_graph.?
> Failed example:
>     diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])
> Expected:
>     2.0
> Got:
>     Traceback (most recent call last):
>       File "sage/graphs/base/boost_graph.pyx", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)
>     cysignals.signals.SignalError: Segmentation fault
>     Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'
>     Traceback (most recent call last):
>       File "sage/graphs/base/boost_graph.pyx", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)
>     cysignals.signals.SignalError: Segmentation fault
>     0.0
> }}}
> 
That's weird, when ran doctest on my system it passed with no error. I have checked it again. Still no problem.


```
sage: from sage.graphs.base.boost_graph import diameter
sage: G = DiGraph([(0,1,2), (1,0,-1)])
sage: diameter(G, algorithm='DiFUB')
1.0
sage: diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])
2.0
```


----


```
vipul@vipul-Predator-G3-572:~/sage$ ./sage -t src/sage/graphs/base/boost_graph.pyx
Running doctests with ID 2020-07-08-13-24-51-0d1b09f6.
Git branch: weighted_difub
Using --optional=build,dochtml,memlimit,python_openid,sage,speaklater
Doctesting 1 file.
sage -t --warn-long 45.7 src/sage/graphs/base/boost_graph.pyx
    [135 tests, 0.37 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 0.4 seconds
```



P.S - I am currently on latest beta release.



---

archive/issue_comments_423288.json:
```json
{
    "body": "Replying to [comment:17 dcoudert]:\n> While running doctests on the graph module, I get the following error.\n> {{{\n> sage -t src/sage/graphs/base/boost_graph.pyx\n> **********************************************************************\n> File \"src/sage/graphs/base/boost_graph.pyx\", line 2121, in sage.graphs.base.boost_graph.?\n> Failed example:\n>     diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])\n> Expected:\n>     2.0\n> Got:\n>     Traceback (most recent call last):\n>       File \"sage/graphs/base/boost_graph.pyx\", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)\n>     cysignals.signals.SignalError: Segmentation fault\n>     Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'\n> }}}\n\nOne more thing, I would like to ask is why the execption is being ignored. Why it is not raising exception in that method itself.\n\n> Also, you could add specific doctests for `2Dsweep` and `DiFUB`.\n\nOk",
    "created_at": "2020-07-08T07:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423288",
    "user": "@vipul79321"
}
```

Replying to [comment:17 dcoudert]:
> While running doctests on the graph module, I get the following error.
> {{{
> sage -t src/sage/graphs/base/boost_graph.pyx
> **********************************************************************
> File "src/sage/graphs/base/boost_graph.pyx", line 2121, in sage.graphs.base.boost_graph.?
> Failed example:
>     diameter(G, algorithm='DiFUB', weight_function=lambda e:e[2])
> Expected:
>     2.0
> Got:
>     Traceback (most recent call last):
>       File "sage/graphs/base/boost_graph.pyx", line 1869, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20737)
>     cysignals.signals.SignalError: Segmentation fault
>     Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'
> }}}

One more thing, I would like to ask is why the execption is being ignored. Why it is not raising exception in that method itself.

> Also, you could add specific doctests for `2Dsweep` and `DiFUB`.

Ok



---

archive/issue_comments_423289.json:
```json
{
    "body": "This is due to default value of `antipode_2` in `2Dsweep`. Indeed, to find the antipode, you initialize `LB_2 = 0`. But with this graph, the eccentricity of vertex 1 is -1. So `antipode_2` stays at the default value (depends on the system).\n\nIf I change the weights, I can get the error with `antipode_1`\n\n```\nsage: G = DiGraph([(0,1,-1), (1,0,2)])\nsage: diameter(G, algorithm='2Dsweep', weight_function=lambda e:e[2])\n---------------------------------------------------------------------------\nSignalError                               Traceback (most recent call last)\n<ipython-input-6-283ef9f979bc> in <module>()\n----> 1 diameter(G, algorithm='2Dsweep', weight_function=lambda e:e[Integer(2)])\n\n/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter (build/cythonized/sage/graphs/base/boost_graph.cpp:23444)()\n   2077     return LB\n   2078 \n-> 2079 cpdef diameter(G, algorithm=None, source=None,\n   2080                weight_function=None, check_weight=True):\n   2081     r\"\"\"\n\n/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter (build/cythonized/sage/graphs/base/boost_graph.cpp:23145)()\n   2188 \n   2189     if algorithm == '2Dsweep':\n-> 2190         LB = diameter_lower_bound_2Dsweep(g_boost, rev_g_boost,\n   2191                                             isource, algo)[0]\n   2192 \n\n/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20568)()\n   1847     # maximum backward distance. LB_1 will be Backward eccentricity of source_1.\n   1848     if algorithm == 'Bellman-Ford':\n-> 1849         sig_on()\n   1850         result_1 = rev_g_boost.bellman_ford_shortest_paths(source_1)\n   1851         sig_off()\n\nSignalError: Segmentation fault\n```\n",
    "created_at": "2020-07-08T08:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423289",
    "user": "@dcoudert"
}
```

This is due to default value of `antipode_2` in `2Dsweep`. Indeed, to find the antipode, you initialize `LB_2 = 0`. But with this graph, the eccentricity of vertex 1 is -1. So `antipode_2` stays at the default value (depends on the system).

If I change the weights, I can get the error with `antipode_1`

```
sage: G = DiGraph([(0,1,-1), (1,0,2)])
sage: diameter(G, algorithm='2Dsweep', weight_function=lambda e:e[2])
---------------------------------------------------------------------------
SignalError                               Traceback (most recent call last)
<ipython-input-6-283ef9f979bc> in <module>()
----> 1 diameter(G, algorithm='2Dsweep', weight_function=lambda e:e[Integer(2)])

/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter (build/cythonized/sage/graphs/base/boost_graph.cpp:23444)()
   2077     return LB
   2078 
-> 2079 cpdef diameter(G, algorithm=None, source=None,
   2080                weight_function=None, check_weight=True):
   2081     r"""

/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter (build/cythonized/sage/graphs/base/boost_graph.cpp:23145)()
   2188 
   2189     if algorithm == '2Dsweep':
-> 2190         LB = diameter_lower_bound_2Dsweep(g_boost, rev_g_boost,
   2191                                             isource, algo)[0]
   2192 

/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:20568)()
   1847     # maximum backward distance. LB_1 will be Backward eccentricity of source_1.
   1848     if algorithm == 'Bellman-Ford':
-> 1849         sig_on()
   1850         result_1 = rev_g_boost.bellman_ford_shortest_paths(source_1)
   1851         sig_off()

SignalError: Segmentation fault
```




---

archive/issue_comments_423290.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-09T05:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423290",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423291.json:
```json
{
    "body": "Replying to [comment:21 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n\n> ||[e9a4520](https://git.sagemath.org/sage.git/commit/?id=e9a452008ac35064258f7889851d72ac640eb083)||`Fixed segmentation fault in 2dsweep`||\n\nI have added equality while looking for antipode. So that atleast one vertex will be made antipode and i think it will solve it.\n\nPlease check that it works (because i am unable to confirm it).\n\nVipul",
    "created_at": "2020-07-09T05:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423291",
    "user": "@vipul79321"
}
```

Replying to [comment:21 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:

> ||[e9a4520](https://git.sagemath.org/sage.git/commit/?id=e9a452008ac35064258f7889851d72ac640eb083)||`Fixed segmentation fault in 2dsweep`||

I have added equality while looking for antipode. So that atleast one vertex will be made antipode and i think it will solve it.

Please check that it works (because i am unable to confirm it).

Vipul



---

archive/issue_comments_423292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-09T13:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423292",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423293.json:
```json
{
    "body": "check that.",
    "created_at": "2020-07-09T13:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423293",
    "user": "@dcoudert"
}
```

check that.



---

archive/issue_comments_423294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-10T05:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423294",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423295.json:
```json
{
    "body": "\n```\nsage: G = DiGraph([(0,1,-2), (1,0,1)])\nsage: G.diameter(by_weight=True)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:22068)()\n   2012         sig_off()\n   2013     if not result_1.distances.size():\n-> 2014         raise ValueError(\"the graph contains a negative cycle\")\n   2015 \n   2016     LB_1 = -sys.float_info.max\n\nValueError: the graph contains a negative cycle\nException ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'\nTraceback (most recent call last):\n  File \"sage/graphs/base/boost_graph.pyx\", line 2014, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:22068)\nValueError: the graph contains a negative cycle\n0.0\n\n```\n\n\nIs there anyway we can properly get an error and not printing 0.0 ?",
    "created_at": "2020-07-10T05:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423295",
    "user": "@vipul79321"
}
```


```
sage: G = DiGraph([(0,1,-2), (1,0,1)])
sage: G.diameter(by_weight=True)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:22068)()
   2012         sig_off()
   2013     if not result_1.distances.size():
-> 2014         raise ValueError("the graph contains a negative cycle")
   2015 
   2016     LB_1 = -sys.float_info.max

ValueError: the graph contains a negative cycle
Exception ignored in: 'sage.graphs.base.boost_graph.diameter_DiFUB'
Traceback (most recent call last):
  File "sage/graphs/base/boost_graph.pyx", line 2014, in sage.graphs.base.boost_graph.diameter_lower_bound_2Dsweep (build/cythonized/sage/graphs/base/boost_graph.cpp:22068)
ValueError: the graph contains a negative cycle
0.0

```


Is there anyway we can properly get an error and not printing 0.0 ?



---

archive/issue_comments_423296.json:
```json
{
    "body": "I don't understand why the 0.0 is printed. It should not be the case. I don't understand either why it is written that an exception is ignored in `DiFUB`. Which one ? the issue occurs in `2Dsweep`. Have you localized when is 0.0 returned ?",
    "created_at": "2020-07-10T07:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423296",
    "user": "@dcoudert"
}
```

I don't understand why the 0.0 is printed. It should not be the case. I don't understand either why it is written that an exception is ignored in `DiFUB`. Which one ? the issue occurs in `2Dsweep`. Have you localized when is 0.0 returned ?



---

archive/issue_comments_423297.json:
```json
{
    "body": "Replying to [comment:27 dcoudert]:\n>Have you localized when is 0.0 returned ?\nIt will occur only via `DiFUB` and this will occur only when there is an error raised in `2DSweep`.\n\nI am also unable to understand it properly since it is receiving error, instead of terminating right then, it is ignoring it and sending garbage value stored in LB(on my system it is 0.0) without executing remaining part of code.\n\nI am guessing if you run this example on your system you might encounter different value than 0.0(as it has previously happened in case of antipode).",
    "created_at": "2020-07-10T16:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423297",
    "user": "@vipul79321"
}
```

Replying to [comment:27 dcoudert]:
>Have you localized when is 0.0 returned ?
It will occur only via `DiFUB` and this will occur only when there is an error raised in `2DSweep`.

I am also unable to understand it properly since it is receiving error, instead of terminating right then, it is ignoring it and sending garbage value stored in LB(on my system it is 0.0) without executing remaining part of code.

I am guessing if you run this example on your system you might encounter different value than 0.0(as it has previously happened in case of antipode).



---

archive/issue_comments_423298.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-11T13:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423298",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423299.json:
```json
{
    "body": "got it ! the error was not correctly transmitted to caller method. So the solution was:\n\n```diff\n-                           str algorithm):\n+                           str algorithm) except? -1:\n```\n\nSee https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values for more details. \n\nOn the way, I fixed some compilation warnings (got bored of them).",
    "created_at": "2020-07-11T13:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423299",
    "user": "@dcoudert"
}
```

got it ! the error was not correctly transmitted to caller method. So the solution was:

```diff
-                           str algorithm):
+                           str algorithm) except? -1:
```

See https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values for more details. 

On the way, I fixed some compilation warnings (got bored of them).



---

archive/issue_comments_423300.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-12T10:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423300",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423301.json:
```json
{
    "body": "Replying to [comment:30 dcoudert]:\n> got it ! the error was not correctly transmitted to caller method. So the solution was:\n> {{{#!diff\n> -                           str algorithm):\n> +                           str algorithm) except? -1:\n> }}}\n> See https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values for more details. \nOk.\n> \n> On the way, I fixed some compilation warnings (got bored of them).\nWell, that's some relief to eyes. \n\nI have added a doctest for `DiFUB` and I think there is nothing more to do.",
    "created_at": "2020-07-12T10:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423301",
    "user": "@vipul79321"
}
```

Replying to [comment:30 dcoudert]:
> got it ! the error was not correctly transmitted to caller method. So the solution was:
> {{{#!diff
> -                           str algorithm):
> +                           str algorithm) except? -1:
> }}}
> See https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values for more details. 
Ok.
> 
> On the way, I fixed some compilation warnings (got bored of them).
Well, that's some relief to eyes. 

I have added a doctest for `DiFUB` and I think there is nothing more to do.



---

archive/issue_comments_423302.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-12T12:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423302",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423303.json:
```json
{
    "body": "LGTM. Successfully tested over 9.2.beta5.",
    "created_at": "2020-07-12T12:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423303",
    "user": "@dcoudert"
}
```

LGTM. Successfully tested over 9.2.beta5.



---

archive/issue_comments_423304.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-07-15T12:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423304",
    "user": "@dcoudert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_423305.json:
```json
{
    "body": "a small edit is needed.",
    "created_at": "2020-07-15T12:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423305",
    "user": "@dcoudert"
}
```

a small edit is needed.



---

archive/issue_comments_423306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-15T12:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423306",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423307.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-07-15T12:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423307",
    "user": "@dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_423308.json:
```json
{
    "body": "small modification to use `.edges` instead of `edge_iterator` (see #30145).",
    "created_at": "2020-07-15T12:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423308",
    "user": "@dcoudert"
}
```

small modification to use `.edges` instead of `edge_iterator` (see #30145).



---

archive/issue_comments_423309.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-07-15T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423309",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_423310.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2020-07-15T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423310",
    "user": "@vbraun"
}
```

Merge conflict



---

archive/issue_comments_423311.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-27T16:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423311",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423312.json:
```json
{
    "body": "Replying to [comment:39 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[7bcd9db](https://git.sagemath.org/sage.git/commit/?id=7bcd9db9dd80f8902a6bc938b34486a6801ac7c0)||`merge conflict fixed`||\n\nSolved merge conflict in `boost_graph.pyx`.",
    "created_at": "2020-07-27T16:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423312",
    "user": "@vipul79321"
}
```

Replying to [comment:39 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7bcd9db](https://git.sagemath.org/sage.git/commit/?id=7bcd9db9dd80f8902a6bc938b34486a6801ac7c0)||`merge conflict fixed`||

Solved merge conflict in `boost_graph.pyx`.



---

archive/issue_comments_423313.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-27T16:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423313",
    "user": "@vipul79321"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_423314.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-27T21:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423314",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423315.json:
```json
{
    "body": "LGTM.",
    "created_at": "2020-07-27T21:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423315",
    "user": "@dcoudert"
}
```

LGTM.



---

archive/issue_comments_423316.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-02T08:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29802#issuecomment-423316",
    "user": "@vbraun"
}
```

Resolution: fixed
