# Issue 10628: Tachyon on 32-bit OSX still sets CC=cc

Issue created by migration from https://trac.sagemath.org/ticket/10681

Original creator: vbraun

Original creation time: 2011-01-24 15:15:29

Assignee: tbd

CC:  wjp mhampton wdj

I think I forgot to remove this one instance of overwriting CC in tachyon's makefile. In particular, the `macosx` (not `-64`) make target. See also

https://groups.google.com/d/msg/sage-release/8zcyl2Q1VvE/usSSY2v3g74J

Updated tachyon spkg is here:


---

Comment by vbraun created at 2011-01-24 15:19:52

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2011-01-24 20:21:56

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2011-01-24 20:21:56

On my Mac, with the old version compilation is done with commands like

```
  ï¿½cc -Os -ffast-math -DBsd  -DUSEPNG ...
```

while with the new version, I see

```
  gcc -Os -ffast-math -DBsd  -DUSEPNG ...
```

Compilation succeeds in both cases, and tachyon seems to work in both cases.

The spkg looks good, mercurial repo is good -- thanks for checking in the previously unchecked files.


---

Comment by jhpalmieri created at 2011-01-24 20:21:56

Changing priority from major to minor.


---

Comment by vbraun created at 2011-01-24 21:45:23

Changing status from positive_review to needs_info.


---

Comment by vbraun created at 2011-01-24 21:45:23

I've updated the spkg to call `ranlib libtachyon.a`. For some inexplicable reason, the tachyon makefile defaults to not running ranlib. This seems to break at least some Xcode versions.

I've tested the change on my Fedora 14 box, bsd.math (OSX) and t2.math (Solaris). In all cases ranlib works as expected. Not sure why tachyon defaults to not using it...

wdj: This should now definitely fix the "ld: in ../compile/macosx/libtachyon.a, archive has no table of contents" bug. Please confirm.


---

Comment by jhpalmieri created at 2011-01-24 23:52:05

It looks like you updated "Make-arch" without updating "Make-arch.patch".  Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere?  Would it be better just to turn it on for macosx? Or maybe just undo the changes for various platforms at #5281 where you removed all of the `RANLIB = ...` lines?


---

Comment by wdj created at 2011-01-24 23:54:45

Replying to [comment:3 vbraun]:

...

> 
> wdj: This should now definitely fix the 
> "ld: in ../compile/macosx/libtachyon.a, archive has no table of contents" bug. 
> Please confirm.

Confirmed (on 2 different machines both running mac os 10.6.6) in the sense that both compile now.


---

Comment by vbraun created at 2011-01-25 03:41:39

Changing status from needs_info to needs_review.


---

Comment by vbraun created at 2011-01-25 03:41:39

Replying to [comment:4 jhpalmieri]:
> Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere? 

I've now removed the default RANLIB setting in the `Make-arch` completely. Just like CC, the Makefile should just use Sage's RANLIB environment variable. Which happens to be `RANLIB=ranlib`, so ranlib is run on `libtachyon.a`.

Right now Sage is already running ranlib (usually via libtool) on pretty much every static library:

```
[vbraun@volker-two sage]$ grep ranlib install.log  | wc
    274     881   10282
```


Updated spkg is at the same location. I've also refreshed the `Make-arch.patch`.


---

Comment by jdemeyer created at 2011-01-26 22:24:05

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-01-26 22:24:05

Looks fine to me.


---

Comment by jdemeyer created at 2011-01-27 09:14:05

Resolution: fixed
