# Issue 10628: Tachyon on 32-bit OSX still sets CC=cc

archive/issues_010628.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @wjp mhampton @wdjoyner\n\nI think I forgot to remove this one instance of overwriting CC in tachyon's makefile. In particular, the `macosx` (not `-64`) make target. See also\n\nhttps://groups.google.com/d/msg/sage-release/8zcyl2Q1VvE/usSSY2v3g74J\n\nUpdated tachyon spkg is here:\n\nIssue created by migration from https://trac.sagemath.org/ticket/10681\n\n",
    "created_at": "2011-01-24T15:15:29Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Tachyon on 32-bit OSX still sets CC=cc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10628",
    "user": "https://github.com/vbraun"
}
```
Assignee: tbd

CC:  @wjp mhampton @wdjoyner

I think I forgot to remove this one instance of overwriting CC in tachyon's makefile. In particular, the `macosx` (not `-64`) make target. See also

https://groups.google.com/d/msg/sage-release/8zcyl2Q1VvE/usSSY2v3g74J

Updated tachyon spkg is here:

Issue created by migration from https://trac.sagemath.org/ticket/10681





---

archive/issue_comments_111261.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-24T15:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111261",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111262.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-24T20:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111262",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111263.json:
```json
{
    "body": "On my Mac, with the old version compilation is done with commands like\n\n```\n  \ufffdcc -Os -ffast-math -DBsd  -DUSEPNG ...\n```\n\nwhile with the new version, I see\n\n```\n  gcc -Os -ffast-math -DBsd  -DUSEPNG ...\n```\n\nCompilation succeeds in both cases, and tachyon seems to work in both cases.\n\nThe spkg looks good, mercurial repo is good -- thanks for checking in the previously unchecked files.",
    "created_at": "2011-01-24T20:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111263",
    "user": "https://github.com/jhpalmieri"
}
```

On my Mac, with the old version compilation is done with commands like

```
  ï¿½cc -Os -ffast-math -DBsd  -DUSEPNG ...
```

while with the new version, I see

```
  gcc -Os -ffast-math -DBsd  -DUSEPNG ...
```

Compilation succeeds in both cases, and tachyon seems to work in both cases.

The spkg looks good, mercurial repo is good -- thanks for checking in the previously unchecked files.



---

archive/issue_comments_111264.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2011-01-24T20:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111264",
    "user": "https://github.com/jhpalmieri"
}
```

Changing priority from major to minor.



---

archive/issue_comments_111265.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2011-01-24T21:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111265",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_111266.json:
```json
{
    "body": "I've updated the spkg to call `ranlib libtachyon.a`. For some inexplicable reason, the tachyon makefile defaults to not running ranlib. This seems to break at least some Xcode versions.\n\nI've tested the change on my Fedora 14 box, bsd.math (OSX) and t2.math (Solaris). In all cases ranlib works as expected. Not sure why tachyon defaults to not using it...\n\nwdj: This should now definitely fix the \"ld: in ../compile/macosx/libtachyon.a, archive has no table of contents\" bug. Please confirm.",
    "created_at": "2011-01-24T21:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111266",
    "user": "https://github.com/vbraun"
}
```

I've updated the spkg to call `ranlib libtachyon.a`. For some inexplicable reason, the tachyon makefile defaults to not running ranlib. This seems to break at least some Xcode versions.

I've tested the change on my Fedora 14 box, bsd.math (OSX) and t2.math (Solaris). In all cases ranlib works as expected. Not sure why tachyon defaults to not using it...

wdj: This should now definitely fix the "ld: in ../compile/macosx/libtachyon.a, archive has no table of contents" bug. Please confirm.



---

archive/issue_comments_111267.json:
```json
{
    "body": "It looks like you updated \"Make-arch\" without updating \"Make-arch.patch\".  Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere?  Would it be better just to turn it on for macosx? Or maybe just undo the changes for various platforms at #5281 where you removed all of the `RANLIB = ...` lines?",
    "created_at": "2011-01-24T23:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111267",
    "user": "https://github.com/jhpalmieri"
}
```

It looks like you updated "Make-arch" without updating "Make-arch.patch".  Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere?  Would it be better just to turn it on for macosx? Or maybe just undo the changes for various platforms at #5281 where you removed all of the `RANLIB = ...` lines?



---

archive/issue_comments_111268.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n\n...\n\n> \n> wdj: This should now definitely fix the \n> \"ld: in ../compile/macosx/libtachyon.a, archive has no table of contents\" bug. \n> Please confirm.\n\nConfirmed (on 2 different machines both running mac os 10.6.6) in the sense that both compile now.",
    "created_at": "2011-01-24T23:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111268",
    "user": "https://github.com/wdjoyner"
}
```

Replying to [comment:3 vbraun]:

...

> 
> wdj: This should now definitely fix the 
> "ld: in ../compile/macosx/libtachyon.a, archive has no table of contents" bug. 
> Please confirm.

Confirmed (on 2 different machines both running mac os 10.6.6) in the sense that both compile now.



---

archive/issue_comments_111269.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-01-25T03:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111269",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_111270.json:
```json
{
    "body": "Replying to [comment:4 jhpalmieri]:\n> Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere? \n\nI've now removed the default RANLIB setting in the `Make-arch` completely. Just like CC, the Makefile should just use Sage's RANLIB environment variable. Which happens to be `RANLIB=ranlib`, so ranlib is run on `libtachyon.a`.\n\nRight now Sage is already running ranlib (usually via libtool) on pretty much every static library:\n\n```\n[vbraun@volker-two sage]$ grep ranlib install.log  | wc\n    274     881   10282\n```\n\n\nUpdated spkg is at the same location. I've also refreshed the `Make-arch.patch`.",
    "created_at": "2011-01-25T03:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111270",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:4 jhpalmieri]:
> Also, is it too drastic to turn ranlib on everywhere, when it used to be off everywhere? 

I've now removed the default RANLIB setting in the `Make-arch` completely. Just like CC, the Makefile should just use Sage's RANLIB environment variable. Which happens to be `RANLIB=ranlib`, so ranlib is run on `libtachyon.a`.

Right now Sage is already running ranlib (usually via libtool) on pretty much every static library:

```
[vbraun@volker-two sage]$ grep ranlib install.log  | wc
    274     881   10282
```


Updated spkg is at the same location. I've also refreshed the `Make-arch.patch`.



---

archive/issue_comments_111271.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-26T22:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111271",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111272.json:
```json
{
    "body": "Looks fine to me.",
    "created_at": "2011-01-26T22:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111272",
    "user": "https://github.com/jdemeyer"
}
```

Looks fine to me.



---

archive/issue_comments_111273.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-27T09:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10628#issuecomment-111273",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_010745.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-01-27T09:14:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10628",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10628#event-10745"
}
```
