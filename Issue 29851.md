# Issue 29851: Fix "make sdist", add test run to GitHub Actions

archive/issues_029851.json:
```json
{
    "body": "CC:  vbraun jhpalmieri mjo\n\n`make sdist` is currently broken.\n\nhttps://github.com/mkoeppe/sage/runs/848070855\n\n```\nFinished cloning Sage sources\nmake[1]: Entering directory '/home/runner/work/sage/sage/build/make'\nenv SAGE_INSTALL_FETCH_ONLY=yes make -B SAGERUNTIME= \\\n\talabaster appnope arb babel bleach boost_cropped brial bzip2 cddlib c....\n...\ncd '/home/runner/work/sage/sage/build/pkgs/sage_conf' && . '/home/runner/work/sage/sage/src/bin/sage-env' && . '/home/runner/work/sage/sage/build/bin/sage-build-env-config' && sage-logger -p '/home/runner/work/sage/sage/build/pkgs/sage_conf/spkg-install' '/home/runner/work/sage/sage/logs/pkgs/sage_conf-none.log'\n[sage_conf-none] Installing \n[sage_conf-none] Error: Tried to use Sage's Python which was not yet installed.\n[sage_conf-none] If this was called from an spkg-install script for another \n[sage_conf-none] package you should add $(PYTHON) as a dependency in \n[sage_conf-none] build/pkgs/<pkg>/dependencies\n[sage_conf-none] Error: could not determine package name\n[sage_conf-none] ********************************************************************************\n[sage_conf-none] Error installing\n[sage_conf-none] *\n```\n\n\nOn this ticket we fix it and add a test run to GH Actions so that it does not get broken again.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30088\n\n",
    "created_at": "2020-07-08T02:25:48Z",
    "labels": [
        "scripts",
        "major",
        "bug"
    ],
    "title": "Fix \"make sdist\", add test run to GitHub Actions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29851",
    "user": "mkoeppe"
}
```
CC:  vbraun jhpalmieri mjo

`make sdist` is currently broken.

https://github.com/mkoeppe/sage/runs/848070855

```
Finished cloning Sage sources
make[1]: Entering directory '/home/runner/work/sage/sage/build/make'
env SAGE_INSTALL_FETCH_ONLY=yes make -B SAGERUNTIME= \
	alabaster appnope arb babel bleach boost_cropped brial bzip2 cddlib c....
...
cd '/home/runner/work/sage/sage/build/pkgs/sage_conf' && . '/home/runner/work/sage/sage/src/bin/sage-env' && . '/home/runner/work/sage/sage/build/bin/sage-build-env-config' && sage-logger -p '/home/runner/work/sage/sage/build/pkgs/sage_conf/spkg-install' '/home/runner/work/sage/sage/logs/pkgs/sage_conf-none.log'
[sage_conf-none] Installing 
[sage_conf-none] Error: Tried to use Sage's Python which was not yet installed.
[sage_conf-none] If this was called from an spkg-install script for another 
[sage_conf-none] package you should add $(PYTHON) as a dependency in 
[sage_conf-none] build/pkgs/<pkg>/dependencies
[sage_conf-none] Error: could not determine package name
[sage_conf-none] ********************************************************************************
[sage_conf-none] Error installing
[sage_conf-none] *
```


On this ticket we fix it and add a test run to GH Actions so that it does not get broken again.

Issue created by migration from https://trac.sagemath.org/ticket/30088





---

archive/issue_comments_424013.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-07-13T01:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424013",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_424014.json:
```json
{
    "body": "Could you leave a comment in there explaining what's going on? It just took me about 20 minutes to figure out that this was failing on sage_conf because it's a standard package (which are usually incuded in SAGE_SDIST_PACKAGES) but not one whose sources need to be downloaded before being included with the source tarball (which is what the misnomer SAGE_SDIST_PACKAGES actually contains a list of). All script/pip packages should be similar, according to this change.\n\nAlso, per the description, I think we need a tox thingy.",
    "created_at": "2020-07-13T02:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424014",
    "user": "mjo"
}
```

Could you leave a comment in there explaining what's going on? It just took me about 20 minutes to figure out that this was failing on sage_conf because it's a standard package (which are usually incuded in SAGE_SDIST_PACKAGES) but not one whose sources need to be downloaded before being included with the source tarball (which is what the misnomer SAGE_SDIST_PACKAGES actually contains a list of). All script/pip packages should be similar, according to this change.

Also, per the description, I think we need a tox thingy.



---

archive/issue_comments_424015.json:
```json
{
    "body": "I'm working on it currently",
    "created_at": "2020-07-13T04:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424015",
    "user": "mkoeppe"
}
```

I'm working on it currently



---

archive/issue_comments_424016.json:
```json
{
    "body": "`sage_conf` currently is the only package that is `type=standard`, `source=script`.\nAll other `source=script` packages are `type=optional`.",
    "created_at": "2020-07-13T04:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424016",
    "user": "mkoeppe"
}
```

`sage_conf` currently is the only package that is `type=standard`, `source=script`.
All other `source=script` packages are `type=optional`.



---

archive/issue_comments_424017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-13T04:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424017",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424018.json:
```json
{
    "body": "Tests running at https://github.com/mkoeppe/sage/runs/864159160",
    "created_at": "2020-07-13T05:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424018",
    "user": "mkoeppe"
}
```

Tests running at https://github.com/mkoeppe/sage/runs/864159160



---

archive/issue_comments_424019.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-13T15:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424019",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424020.json:
```json
{
    "body": "OK with an added comment? Otherwise, LGTM.\n----\nNew commits:",
    "created_at": "2020-07-13T21:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424020",
    "user": "mjo"
}
```

OK with an added comment? Otherwise, LGTM.
----
New commits:



---

archive/issue_comments_424021.json:
```json
{
    "body": "Thank you!\n\nI'm still waiting for the test run to finish",
    "created_at": "2020-07-13T22:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424021",
    "user": "mkoeppe"
}
```

Thank you!

I'm still waiting for the test run to finish



---

archive/issue_comments_424022.json:
```json
{
    "body": "Re \"the only standard script package is sage_conf\": sagelib is also a script package, isn't it? Or is that changing? (It is listed in `build/bin/Makefile` under `SCRIPT_PACKAGES`.)",
    "created_at": "2020-07-13T23:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424022",
    "user": "jhpalmieri"
}
```

Re "the only standard script package is sage_conf": sagelib is also a script package, isn't it? Or is that changing? (It is listed in `build/bin/Makefile` under `SCRIPT_PACKAGES`.)



---

archive/issue_comments_424023.json:
```json
{
    "body": "You are right, I forgot that the ticket that made sagelib a script package was already merged.",
    "created_at": "2020-07-13T23:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424023",
    "user": "mkoeppe"
}
```

You are right, I forgot that the ticket that made sagelib a script package was already merged.



---

archive/issue_comments_424024.json:
```json
{
    "body": "The successful test run of the new `dist` workflow job can be seen at https://github.com/mkoeppe/sage/runs/864159160\n\nIt is possible that I may need to make some adjustments to the new `local-macos-nohomebrew-nobootstrap` tests, but I'll do that in #29929 as a follow up.\n\nOK to set it to positive review?\n----\nNew commits:",
    "created_at": "2020-07-14T00:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424024",
    "user": "mkoeppe"
}
```

The successful test run of the new `dist` workflow job can be seen at https://github.com/mkoeppe/sage/runs/864159160

It is possible that I may need to make some adjustments to the new `local-macos-nohomebrew-nobootstrap` tests, but I'll do that in #29929 as a follow up.

OK to set it to positive review?
----
New commits:



---

archive/issue_comments_424025.json:
```json
{
    "body": "Ok, you fixed the comment already. Yeah it's good now. John, please add yourself as a reviewer if you want some credit/blame here.",
    "created_at": "2020-07-14T00:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424025",
    "user": "mjo"
}
```

Ok, you fixed the comment already. Yeah it's good now. John, please add yourself as a reviewer if you want some credit/blame here.



---

archive/issue_comments_424026.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-14T00:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424026",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424027.json:
```json
{
    "body": "I will confirm that, not only does `mske dist` work, but I turned off the internet on my computer and built Sage successfully from that tarball.",
    "created_at": "2020-07-14T01:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424027",
    "user": "jhpalmieri"
}
```

I will confirm that, not only does `mske dist` work, but I turned off the internet on my computer and built Sage successfully from that tarball.



---

archive/issue_comments_424028.json:
```json
{
    "body": "Thanks a lot!",
    "created_at": "2020-07-14T01:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424028",
    "user": "mkoeppe"
}
```

Thanks a lot!



---

archive/issue_comments_424029.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-19T07:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29851#issuecomment-424029",
    "user": "vbraun"
}
```

Resolution: fixed
