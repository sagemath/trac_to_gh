# Issue 23696: OpenBLAS randomly crashes / deadlocks 2

Issue created by migration from https://trac.sagemath.org/ticket/23933

Original creator: mderickx

Original creation time: 2017-09-26 14:43:01

CC:  fbissey dimpase

The first of the two bugs at #22021 popped up again in sage 8.1.beta6 on
[arando](https://patchbot.sagemath.org/log/23927/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-09-25%2021:41:12?short)

```
sage -t --long src/sage/matrix/matrix_integer_dense.pyx
    Killed due to segmentation fault
**********************************************************************
Tests run before process (pid=3193) failed:
sage: a = matrix(ZZ, 3,3, range(9)); a ## line 23 ##
[0 1 2]
[3 4 5]
[6 7 8]
sage: a.det() ## line 27 ##
0
...
12
sage: A*C == d*B ## line 4265 ##
True
sage: A = random_matrix(ZZ, 4, 4) ## line 4270 ##
sage: B = random_matrix(ZZ, 2, 3) ## line 4271 ##
sage: B._solve_iml(A) ## line 4272 ##
sage: A._solve_iml(B, right=False) ## line 4276 ##
sage: A._solve_iml(B, right=True) ## line 4280 ##
sage: A = random_matrix(ZZ, 2000, 2000) ## line 4287 ##
sage: B = random_matrix(ZZ, 2000, 2000) ## line 4288 ##
sage: t0 = walltime() ## line 4289 ##
sage: alarm(2); A._solve_iml(B)  # long time ## line 4290 ##
------------------------------------------------------------------------
sage: t = walltime(t0) ## line 4294 ##
```



---

Comment by mderickx created at 2017-09-26 20:55:30

Changing keywords from "" to "patchbot".


---

Comment by embray created at 2018-02-05 13:51:26

I think maybe this has been fixed upstream by https://github.com/xianyi/OpenBLAS/pull/1234 .  I'm going to test it.


---

Comment by jdemeyer created at 2018-02-05 15:16:51

Beware that #24638 also patches openblas.


---

Comment by embray created at 2018-02-06 10:24:43

Apparently we've already upgraded to OpenBLAS 0.2.20 which appears to include the fix.  Then the only thing to do would be to drop the `USE_THREAD=0` from the OpenBLAS build.


---

Comment by embray created at 2018-02-06 10:50:55

Seems to work on my Ubuntu machine.  Indeed, this ticket was reported against 8.1.beta6 which was still on OpenBLAS 0.2.19, but this issue was only fixed in OpenBLAS 0.2.20


---

Comment by embray created at 2018-02-06 11:19:37

If #24669 gets merged and works for people then this can just be closed as worksforme.


---

Comment by mkoeppe created at 2020-03-20 18:08:27

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-03-20 18:08:27

Proposing to close this ticket as outdated -- we have updated OpenBLAS several times since this report, and also openblas/spkg-configure.m4 requires version >= 0.2.20 which fixes it as per the above.


---

Comment by dimpase created at 2020-03-20 18:09:36

indeed


---

Comment by dimpase created at 2020-03-20 18:09:36

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-04-02 06:41:11

Resolution: invalid
