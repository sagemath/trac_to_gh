# Issue 22934: Stability for gcd(x,x)

Issue created by migration from Trac.

Original creator: saraedum

Original creation time: 2017-06-07 22:30:36

CC:  tscrim

Keywords: sd86.5

Currently, trivial gcds do not return the exact element from the input:

```
sage: R.<x> = QQ[]
sage: gcd(x,x) is x
False
```

This is unfortunate because such trivial gcds get computed frequently, and any cached properties on the returned gcd are lost.


---

Comment by roed created at 2017-07-17 21:46:22

Changing keywords from "sd86.5" to "sd86.5, sd87".


---

Comment by roed created at 2018-07-22 20:09:46

Changing keywords from "sd86.5, sd87" to "sd86.5, sd87, padicIMA".


---

Comment by varul created at 2018-07-23 21:07:10

Should we change all implementations of gcd (to make a special exception for the trivial gcd), or are there specific ones in mind?


---

Comment by saraedum created at 2018-07-24 17:58:45

varul: I personally only care about (univariate) polynomial rings. At least in exact rings, I can imagine that if the current implementation has `gcd(x,x) == x`, then `gcd(x,x) is x` could be true.


---

Comment by saraedum created at 2018-07-24 18:37:06

For the inexact ones, we could say that `gcd(x,x) is x` should be true if `gcd(x,x)._cache_key() == x._cache_key()`.


---

Comment by nbruin created at 2018-07-26 11:50:23

How far do you want to take this?

```
sage: GCD(3*x,3*x)
x
```

It looks to me like GCD(f,f) should normally NOT be identical to f. If you want to put an optimization into sage for code that calls GCD(x,x) very frequently then you can do that (provided you can do that at essentially zero penalty for the general case), but this should not be part of the API.

In practice, it means your code should probably not depend on the optimization being present, because I'd expect that a rewrite down the road would make it disappear again. If you are finding you need this optimization, you're probably better off writing

```
(x is y) select x else gcd(x,y)
```

in the relevant places. 
}}}


---

Comment by saraedum created at 2018-07-26 12:16:05

My code does not call the gcd. It's called indirectly in a couple of places. I forget the details but I could create some stack traces to find how this goes exactly. My code won't depend on the optimization being present but it's performance is going to be better if the optimization is present.

I don't want to add this requirement to the API of `gcd`. However, I would of course add a doctest to polynomial gcds linking back to this ticket and checking that some cached value does not disappear maybe.
