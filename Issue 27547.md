# Issue 27547: Characteristic Classes on Manifolds

archive/issues_027547.json:
```json
{
    "body": "CC:  @tscrim @egourgoulhon\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27784\n\n",
    "created_at": "2019-05-06T13:12:30Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Characteristic Classes on Manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27547",
    "user": "@DeRhamSource"
}
```
CC:  @tscrim @egourgoulhon



Issue created by migration from https://trac.sagemath.org/ticket/27784





---

archive/issue_comments_388646.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-05-06T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388646",
    "user": "@DeRhamSource"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_388647.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2019-05-06T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388647",
    "user": "@DeRhamSource"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_comments_388648.json:
```json
{
    "body": "Changing keywords from \"\" to \"characteristic classes, manifolds\".",
    "created_at": "2019-05-06T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388648",
    "user": "@DeRhamSource"
}
```

Changing keywords from "" to "characteristic classes, manifolds".



---

archive/issue_comments_388649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-03T12:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388649",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-06T15:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388651.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388651",
    "user": "@embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_388652.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-06T16:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388652",
    "user": "@DeRhamSource"
}
```

New commits:



---

archive/issue_comments_388653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-11-11T03:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388653",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_388654.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-11-11T03:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388654",
    "user": "@DeRhamSource"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T14:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388655",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-11T18:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388656",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-12T10:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388657",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388658.json:
```json
{
    "body": "I know, you are really busy right now, Eric. However, this ticket is the essence and foundation of my master thesis and I'd highly appreciate at least a short look whether the structure is okay.\n\nTravis, could you take a short look, too?\n\nDetails can be changed later, but the rough structure should be fine before I start writing my thesis.\n\nThank you both! I really appreciate your effort so far. :)",
    "created_at": "2019-11-12T10:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388658",
    "user": "@DeRhamSource"
}
```

I know, you are really busy right now, Eric. However, this ticket is the essence and foundation of my master thesis and I'd highly appreciate at least a short look whether the structure is okay.

Travis, could you take a short look, too?

Details can be changed later, but the rough structure should be fine before I start writing my thesis.

Thank you both! I really appreciate your effort so far. :)



---

archive/issue_comments_388659.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-12T10:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388659",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-12T11:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388660",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-12T12:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388661",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388662.json:
```json
{
    "body": "I won't be able to look at it for at least a few days. However, I will make it a high priority.",
    "created_at": "2019-11-12T15:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388662",
    "user": "@tscrim"
}
```

I won't be able to look at it for at least a few days. However, I will make it a high priority.



---

archive/issue_comments_388663.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> I won't be able to look at it for at least a few days. However, I will make it a high priority. \n\nThank you so much! :)",
    "created_at": "2019-11-12T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388663",
    "user": "@DeRhamSource"
}
```

Replying to [comment:23 tscrim]:
> I won't be able to look at it for at least a few days. However, I will make it a high priority. 

Thank you so much! :)



---

archive/issue_comments_388664.json:
```json
{
    "body": "Here are my comments (mostly on the technical details):\n\nDon't feel the strict need to adhere to PEP8 when it degrades readability. In particular, don't have a line break here:\n\n```diff\n-from sage.manifolds.differentiable.vector_bundle\\\n-                                               import DifferentiableVectorBundle\n+from sage.manifolds.differentiable.vector_bundle import DifferentiableVectorBundle\n```\n\nand similarly here\n\n```\n            sage: from sage.manifolds.differentiable.bundle_connection import \\\n                                                                BundleConnection\n```\n\nIn contrast, you can break `.. MATH::` lines.\n\nRemove the period/full-stop at the end here:\n\n```\n    - ``latex_name`` -- (default: ``None``) LaTeX symbol to denote the bundle\n      connection; if ``None``, it is set to ``name``.\n```\n\n\nI don't see the point of this note:\n\n```\n    .. NOTE::\n\n        Notice that this is a *very* rudimentary form of bundle connections.\n        A more detailed implementation is devoted to :trac:`28640`.\n```\n\nThe only people who will care are developers, it is irrelevant to the use of this class, and it makes it come across as less polished.\n\nThe block after `They certainly obey the structure equation::` is over-indented.\n\nA general comment (not something you need to address here, but I noticed it now): we should have a little mix-in class for `_latex_name` objects (or perhaps more generally `NamedObject`) so we don't have so much repeated boilerplate code.\n\nInstead of `_hash_value`, the more standard naming is `_hash`.\n\nError messages should follow the general Python convention:\n\n```diff\n-raise ValueError(\"A frame must be provided!\")\n+raise ValueError(\"a frame must be provided\")\n```\n\n\nIs this relevant? `# TODO: Compute transformations` Should it instead raise a `NotImplementedError`?\n\nIs there some way we can automate this?\n\n```\n        .. WARNING::\n\n            If the connection has already forms in other frames, it is the\n            user's responsibility to make sure that the 1-forms to be added\n            are consistent with them.\n```\n\n\n\n```diff\n-computation in SAGE.\n+computation in Sage.\n```\n\nAlthough really I would suggest just deleting that sentence (you already are using Sage and such an  internal working, if you insist on including it, should be in an `ALGORITHM:` section).\n\nI generally dislike these things:\n\n```\nClass Documentation\n-------------------\n```\n\nThey don't convey any information and just are a bit of a distraction IMO.\n\n`_get_predefined_class` is not a static method (it is just a separate function). Also ``arg`` -> ```arg```\n\nThis should just be an `if-else` statement:\n\n```python\n    c_dict = {}\n    c_dict['ChernChar'] = ('complex', 'additive', 'ch', r'\\mathrm{ch}', x.exp())\n    c_dict['Todd'] = ('complex', 'additive', 'Td', r'\\mathrm{Td}',\n                      x / (1 - (-x).exp()))\n    c_dict['Chern'] = ('complex', 'multiplicative', 'c', 'c', 1 + x)\n    c_dict['Pontryagin'] = ('real', 'multiplicative', 'p', 'p', 1 + x)\n    c_dict['AHat'] = ('real', 'multiplicative', 'A^', r'\\hat{A}',\n                      x.sqrt() / (2 * (x.sqrt() / 2).sinh()))\n    c_dict['Hirzebruch'] = ('real', 'multiplicative', 'L', 'L',\n                            (x.sqrt() / x.sqrt().tanh()))\n    c_dict['Euler'] = ('real', 'Pfaffian', 'e', 'e', x)\n    # Get class from arg\n    try:\n        res = c_dict[arg]\n    except KeyError:\n        raise ValueError(\"the characteristic class '{}' is \".format(arg) +\n                         \"not predefined yet.\")\n```\n\nunless you were hoping to cache `c_dict`, but I don't see the utility in that as this should not be a bottleneck.\n\nDo not abbreviate class names and `UniqueRepresentation` is better being first in the MRO:\n\n```diff\n-class CharClass(SageObject, UniqueRepresentation):\n+class CharacteristicClass(UniqueRepresentation, SageObject):\n```\n\nIMO, generally you should avoid abbreviated names for inputs/function names/etc. for the main implementation (although it is okay to have an abbreviated alias). (For another example, `get_form(self, con, cmatrices=None):` and use `connection` instead of `con` and `def char_class` to `def characteristic_class`) This better self-documents the code and can make things more discoverable with tab completion. For example, I might type `.charact<tab>` and then be surprised that nothing comes up.\n\nIn `_get_coeff_list`, there is no need for the `coef` variable (just return the result).\nAlso\n\n```diff\n-(self._base_space._dim / 2).floor()\n+self._base_space._dim // 2\n```\n\nand make `from sage.symbolic.ring import SR` at the top-level.\n\n\n```diff\n-- ``cmatrix`` curvature matrix\n+- ``cmatrix`` -- curvature matrix\n```\n",
    "created_at": "2019-11-15T08:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388664",
    "user": "@tscrim"
}
```

Here are my comments (mostly on the technical details):

Don't feel the strict need to adhere to PEP8 when it degrades readability. In particular, don't have a line break here:

```diff
-from sage.manifolds.differentiable.vector_bundle\
-                                               import DifferentiableVectorBundle
+from sage.manifolds.differentiable.vector_bundle import DifferentiableVectorBundle
```

and similarly here

```
            sage: from sage.manifolds.differentiable.bundle_connection import \
                                                                BundleConnection
```

In contrast, you can break `.. MATH::` lines.

Remove the period/full-stop at the end here:

```
    - ``latex_name`` -- (default: ``None``) LaTeX symbol to denote the bundle
      connection; if ``None``, it is set to ``name``.
```


I don't see the point of this note:

```
    .. NOTE::

        Notice that this is a *very* rudimentary form of bundle connections.
        A more detailed implementation is devoted to :trac:`28640`.
```

The only people who will care are developers, it is irrelevant to the use of this class, and it makes it come across as less polished.

The block after `They certainly obey the structure equation::` is over-indented.

A general comment (not something you need to address here, but I noticed it now): we should have a little mix-in class for `_latex_name` objects (or perhaps more generally `NamedObject`) so we don't have so much repeated boilerplate code.

Instead of `_hash_value`, the more standard naming is `_hash`.

Error messages should follow the general Python convention:

```diff
-raise ValueError("A frame must be provided!")
+raise ValueError("a frame must be provided")
```


Is this relevant? `# TODO: Compute transformations` Should it instead raise a `NotImplementedError`?

Is there some way we can automate this?

```
        .. WARNING::

            If the connection has already forms in other frames, it is the
            user's responsibility to make sure that the 1-forms to be added
            are consistent with them.
```



```diff
-computation in SAGE.
+computation in Sage.
```

Although really I would suggest just deleting that sentence (you already are using Sage and such an  internal working, if you insist on including it, should be in an `ALGORITHM:` section).

I generally dislike these things:

```
Class Documentation
-------------------
```

They don't convey any information and just are a bit of a distraction IMO.

`_get_predefined_class` is not a static method (it is just a separate function). Also ``arg`` -> ```arg```

This should just be an `if-else` statement:

```python
    c_dict = {}
    c_dict['ChernChar'] = ('complex', 'additive', 'ch', r'\mathrm{ch}', x.exp())
    c_dict['Todd'] = ('complex', 'additive', 'Td', r'\mathrm{Td}',
                      x / (1 - (-x).exp()))
    c_dict['Chern'] = ('complex', 'multiplicative', 'c', 'c', 1 + x)
    c_dict['Pontryagin'] = ('real', 'multiplicative', 'p', 'p', 1 + x)
    c_dict['AHat'] = ('real', 'multiplicative', 'A^', r'\hat{A}',
                      x.sqrt() / (2 * (x.sqrt() / 2).sinh()))
    c_dict['Hirzebruch'] = ('real', 'multiplicative', 'L', 'L',
                            (x.sqrt() / x.sqrt().tanh()))
    c_dict['Euler'] = ('real', 'Pfaffian', 'e', 'e', x)
    # Get class from arg
    try:
        res = c_dict[arg]
    except KeyError:
        raise ValueError("the characteristic class '{}' is ".format(arg) +
                         "not predefined yet.")
```

unless you were hoping to cache `c_dict`, but I don't see the utility in that as this should not be a bottleneck.

Do not abbreviate class names and `UniqueRepresentation` is better being first in the MRO:

```diff
-class CharClass(SageObject, UniqueRepresentation):
+class CharacteristicClass(UniqueRepresentation, SageObject):
```

IMO, generally you should avoid abbreviated names for inputs/function names/etc. for the main implementation (although it is okay to have an abbreviated alias). (For another example, `get_form(self, con, cmatrices=None):` and use `connection` instead of `con` and `def char_class` to `def characteristic_class`) This better self-documents the code and can make things more discoverable with tab completion. For example, I might type `.charact<tab>` and then be surprised that nothing comes up.

In `_get_coeff_list`, there is no need for the `coef` variable (just return the result).
Also

```diff
-(self._base_space._dim / 2).floor()
+self._base_space._dim // 2
```

and make `from sage.symbolic.ring import SR` at the top-level.


```diff
-- ``cmatrix`` curvature matrix
+- ``cmatrix`` -- curvature matrix
```




---

archive/issue_comments_388665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2019-11-15T09:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388665",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_388666.json:
```json
{
    "body": "Hopefully, I took everything into account you mentioned.\n\nThank you for the extensive feedback! :)",
    "created_at": "2019-11-15T10:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388666",
    "user": "@DeRhamSource"
}
```

Hopefully, I took everything into account you mentioned.

Thank you for the extensive feedback! :)



---

archive/issue_comments_388667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-15T10:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388668.json:
```json
{
    "body": "I gave a quik look. It looks nice!\nThanks for having taken into account Travis' remarks. I fully agree with them. \nHere a few remarks from my side: \n\n- There is a failed doctest:\n\n```\nFile \"src/sage/manifolds/differentiable/char_class.py\", line 685, in sage.manifolds.differentiable.char_class.CharacteristicClass.get_form\nFailed example:\n    ch_form.display()\nExpected:\n    ch(E, nabla^E) = ch_0(E, nabla^E) + zero + ch_1(E, nabla^E)\nGot:\n    ch(E, nabla^E) = ch_0.0(E, nabla^E) + zero + ch_1.0(E, nabla^E)\n```\n\n- There are two warnings when generating the documentation:\n\n```\n[manifolds] <unknown>:2566: DeprecationWarning: invalid escape sequence \\c\n[manifolds] <unknown>:2565: DeprecationWarning: invalid escape sequence \\c\n```\n\n- in the OUTPUT section of `BundleConnection.add_connection_form()`, a back quote is missing:\n\n```diff\n- connection 1-form `\\omega^i_j in the given frame, as an instance of\n+ connection 1-form `\\omega^i_j` in the given frame, as an instance of\n```\n\n- in the introduction to characteristic classes, `N` is not defined in the sentence\n\n```\nfor any continuous map `f: M \\to N`\n```\n\n- in the doctest example of `in DifferentiableVectorBundle.characteristic_class()`:\n\n```diff\n- sage: g = M.metric('g')\n+ sage: g = M.metric()\n```\n\n(since `M` has been defined a Lorentzian manifold, `g` has already been initialized, with the name 'g')",
    "created_at": "2019-11-15T11:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388668",
    "user": "@egourgoulhon"
}
```

I gave a quik look. It looks nice!
Thanks for having taken into account Travis' remarks. I fully agree with them. 
Here a few remarks from my side: 

- There is a failed doctest:

```
File "src/sage/manifolds/differentiable/char_class.py", line 685, in sage.manifolds.differentiable.char_class.CharacteristicClass.get_form
Failed example:
    ch_form.display()
Expected:
    ch(E, nabla^E) = ch_0(E, nabla^E) + zero + ch_1(E, nabla^E)
Got:
    ch(E, nabla^E) = ch_0.0(E, nabla^E) + zero + ch_1.0(E, nabla^E)
```

- There are two warnings when generating the documentation:

```
[manifolds] <unknown>:2566: DeprecationWarning: invalid escape sequence \c
[manifolds] <unknown>:2565: DeprecationWarning: invalid escape sequence \c
```

- in the OUTPUT section of `BundleConnection.add_connection_form()`, a back quote is missing:

```diff
- connection 1-form `\omega^i_j in the given frame, as an instance of
+ connection 1-form `\omega^i_j` in the given frame, as an instance of
```

- in the introduction to characteristic classes, `N` is not defined in the sentence

```
for any continuous map `f: M \to N`
```

- in the doctest example of `in DifferentiableVectorBundle.characteristic_class()`:

```diff
- sage: g = M.metric('g')
+ sage: g = M.metric()
```

(since `M` has been defined a Lorentzian manifold, `g` has already been initialized, with the name 'g')



---

archive/issue_comments_388669.json:
```json
{
    "body": "Replying to [comment:29 egourgoulhon]:\n> I gave a quik look. It looks nice!\n> Thanks for having taken into account Travis' remarks. I fully agree with them. \n> Here a few remarks from my side: \n> \n> - There is a failed doctest:\n> {{{\n> File \"src/sage/manifolds/differentiable/char_class.py\", line 685, in sage.manifolds.differentiable.char_class.CharacteristicClass.get_form\n> Failed example:\n>     ch_form.display()\n> Expected:\n>     ch(E, nabla^E) = ch_0(E, nabla^E) + zero + ch_1(E, nabla^E)\n> Got:\n>     ch(E, nabla^E) = ch_0.0(E, nabla^E) + zero + ch_1.0(E, nabla^E)\n> }}}\n\nThat's strange...I don't get this error. Travis?\n\nThe rest is in progress...",
    "created_at": "2019-11-15T12:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388669",
    "user": "@DeRhamSource"
}
```

Replying to [comment:29 egourgoulhon]:
> I gave a quik look. It looks nice!
> Thanks for having taken into account Travis' remarks. I fully agree with them. 
> Here a few remarks from my side: 
> 
> - There is a failed doctest:
> {{{
> File "src/sage/manifolds/differentiable/char_class.py", line 685, in sage.manifolds.differentiable.char_class.CharacteristicClass.get_form
> Failed example:
>     ch_form.display()
> Expected:
>     ch(E, nabla^E) = ch_0(E, nabla^E) + zero + ch_1(E, nabla^E)
> Got:
>     ch(E, nabla^E) = ch_0.0(E, nabla^E) + zero + ch_1.0(E, nabla^E)
> }}}

That's strange...I don't get this error. Travis?

The rest is in progress...



---

archive/issue_comments_388670.json:
```json
{
    "body": "Ah, that might come from using Python 2.7. Hang on there.",
    "created_at": "2019-11-15T12:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388670",
    "user": "@DeRhamSource"
}
```

Ah, that might come from using Python 2.7. Hang on there.



---

archive/issue_comments_388671.json:
```json
{
    "body": "Replying to [comment:30 gh-DeRhamSource]:\n> That's strange...I don't get this error. Travis?\n> \nAre you using Python 3 Sage ?",
    "created_at": "2019-11-15T12:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388671",
    "user": "@egourgoulhon"
}
```

Replying to [comment:30 gh-DeRhamSource]:
> That's strange...I don't get this error. Travis?
> 
Are you using Python 3 Sage ?



---

archive/issue_comments_388672.json:
```json
{
    "body": "Replying to [comment:31 gh-DeRhamSource]:\n> Ah, that might come from using Python 2.7. Hang on there.\nYes most  probably",
    "created_at": "2019-11-15T12:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388672",
    "user": "@egourgoulhon"
}
```

Replying to [comment:31 gh-DeRhamSource]:
> Ah, that might come from using Python 2.7. Hang on there.
Yes most  probably



---

archive/issue_comments_388673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-15T12:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388673",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388674.json:
```json
{
    "body": "The issue about the `DeprecationWarning` referred to #28564. That has been fixed.\n\nThe other issues has been solved, too.\n\nHowever, I'll build Sage from scratch, now.",
    "created_at": "2019-11-15T12:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388674",
    "user": "@DeRhamSource"
}
```

The issue about the `DeprecationWarning` referred to #28564. That has been fixed.

The other issues has been solved, too.

However, I'll build Sage from scratch, now.



---

archive/issue_comments_388675.json:
```json
{
    "body": "With the latest version, there are two failed doctests in `char_class.py`. I got them on my machine and they are reported by the patchbot as well.",
    "created_at": "2019-11-15T17:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388675",
    "user": "@egourgoulhon"
}
```

With the latest version, there are two failed doctests in `char_class.py`. I got them on my machine and they are reported by the patchbot as well.



---

archive/issue_comments_388676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-15T21:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388676",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388677.json:
```json
{
    "body": "I guess that should be it. However, my build is not finished yet. I will start an extensive test as soon as possible.\n\nThanks so far! :)",
    "created_at": "2019-11-15T21:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388677",
    "user": "@DeRhamSource"
}
```

I guess that should be it. However, my build is not finished yet. I will start an extensive test as soon as possible.

Thanks so far! :)



---

archive/issue_comments_388678.json:
```json
{
    "body": "My tests did all pass. Patchbot says so, too.\n\nBy the way: Why is the patchbot yellow and not green though all tests passed?",
    "created_at": "2019-11-16T13:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388678",
    "user": "@DeRhamSource"
}
```

My tests did all pass. Patchbot says so, too.

By the way: Why is the patchbot yellow and not green though all tests passed?



---

archive/issue_comments_388679.json:
```json
{
    "body": "Replying to [comment:25 tscrim]:\n> Is there some way we can automate this?\n> {{{\n>         .. WARNING::\n> \n>             If the connection has already forms in other frames, it is the\n>             user's responsibility to make sure that the 1-forms to be added\n>             are consistent with them.\n> }}}\n\nThe concept and warning is just copied from `affine_connection.py`. At least it should be possible to return an error message when some incompatibilities occur on the intersection. But that's a topic for another ticket, I'd say.",
    "created_at": "2019-11-16T13:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388679",
    "user": "@DeRhamSource"
}
```

Replying to [comment:25 tscrim]:
> Is there some way we can automate this?
> {{{
>         .. WARNING::
> 
>             If the connection has already forms in other frames, it is the
>             user's responsibility to make sure that the 1-forms to be added
>             are consistent with them.
> }}}

The concept and warning is just copied from `affine_connection.py`. At least it should be possible to return an error message when some incompatibilities occur on the intersection. But that's a topic for another ticket, I'd say.



---

archive/issue_comments_388680.json:
```json
{
    "body": "Patchbot says:\n\n```\nsage -t --long src/sage/parallel/map_reduce.py  # Timed out\nsage -t --long src/doc/en/reference/references/index.rst  # Tab character found\n```\n",
    "created_at": "2019-11-16T13:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388680",
    "user": "@fchapoton"
}
```

Patchbot says:

```
sage -t --long src/sage/parallel/map_reduce.py  # Timed out
sage -t --long src/doc/en/reference/references/index.rst  # Tab character found
```




---

archive/issue_comments_388681.json:
```json
{
    "body": "Replying to [comment:41 chapoton]:\n> Patchbot says:\n> {{{\n> sage -t --long src/sage/parallel/map_reduce.py  # Timed out\n> sage -t --long src/doc/en/reference/references/index.rst  # Tab character found\n> }}}\n\nThe first one has nothing to do with the changes in this ticket.\n\nHowever, the second has been fixed now.\n\nThanks! :)",
    "created_at": "2019-11-16T14:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388681",
    "user": "@DeRhamSource"
}
```

Replying to [comment:41 chapoton]:
> Patchbot says:
> {{{
> sage -t --long src/sage/parallel/map_reduce.py  # Timed out
> sage -t --long src/doc/en/reference/references/index.rst  # Tab character found
> }}}

The first one has nothing to do with the changes in this ticket.

However, the second has been fixed now.

Thanks! :)



---

archive/issue_comments_388682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-16T14:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388682",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388683.json:
```json
{
    "body": "Also, it seems there is a doctest missing in `map_reduce.py`. What's going on there? :-/",
    "created_at": "2019-11-16T15:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388683",
    "user": "@DeRhamSource"
}
```

Also, it seems there is a doctest missing in `map_reduce.py`. What's going on there? :-/



---

archive/issue_comments_388684.json:
```json
{
    "body": "Patchbot has come back green.",
    "created_at": "2019-11-16T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388684",
    "user": "@tscrim"
}
```

Patchbot has come back green.



---

archive/issue_comments_388685.json:
```json
{
    "body": "Replying to [comment:40 gh-DeRhamSource]:\n> Replying to [comment:25 tscrim]:\n> > Is there some way we can automate this?\n> > {{{\n> >         .. WARNING::\n> > \n> >             If the connection has already forms in other frames, it is the\n> >             user's responsibility to make sure that the 1-forms to be added\n> >             are consistent with them.\n> > }}}\n> \n> The concept and warning is just copied from `affine_connection.py`. At least it should be possible to return an error message when some incompatibilities occur on the intersection. But that's a topic for another ticket, I'd say.\n\nI agree: this could be postponed to another ticket; in particular, checking the compatibility can be computationaly demanding and one shall discuss the appropriate way to do this, with possibly an option `check=True` or `check=False`.",
    "created_at": "2019-11-17T09:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388685",
    "user": "@egourgoulhon"
}
```

Replying to [comment:40 gh-DeRhamSource]:
> Replying to [comment:25 tscrim]:
> > Is there some way we can automate this?
> > {{{
> >         .. WARNING::
> > 
> >             If the connection has already forms in other frames, it is the
> >             user's responsibility to make sure that the 1-forms to be added
> >             are consistent with them.
> > }}}
> 
> The concept and warning is just copied from `affine_connection.py`. At least it should be possible to return an error message when some incompatibilities occur on the intersection. But that's a topic for another ticket, I'd say.

I agree: this could be postponed to another ticket; in particular, checking the compatibility can be computationaly demanding and one shall discuss the appropriate way to do this, with possibly an option `check=True` or `check=False`.



---

archive/issue_comments_388686.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> Patchbot has come back green.\n\nFrom my side, I think we are almost done here. Two last remarks:\n- in the introduction to characteristic classes, `\\mathfrak{g}` is not defined\n- could the file `char_class.py` be renamed `characteristic_class.py`? (this would improve the readability of the directory `src/sage/manifolds/differentiable` and would match with the name of the class `CharacteristicClass`)",
    "created_at": "2019-11-17T10:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388686",
    "user": "@egourgoulhon"
}
```

Replying to [comment:45 tscrim]:
> Patchbot has come back green.

From my side, I think we are almost done here. Two last remarks:
- in the introduction to characteristic classes, `\mathfrak{g}` is not defined
- could the file `char_class.py` be renamed `characteristic_class.py`? (this would improve the readability of the directory `src/sage/manifolds/differentiable` and would match with the name of the class `CharacteristicClass`)



---

archive/issue_comments_388687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-17T13:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388687",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388688.json:
```json
{
    "body": "I hope, I took the renaming everywhere into account...",
    "created_at": "2019-11-17T13:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388688",
    "user": "@DeRhamSource"
}
```

I hope, I took the renaming everywhere into account...



---

archive/issue_comments_388689.json:
```json
{
    "body": "Replying to [comment:49 gh-DeRhamSource]:\n> I hope, I took the renaming everywhere into account...\n\nThanks for the changes. \nI am OK for a positive review. Travis?",
    "created_at": "2019-11-17T19:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388689",
    "user": "@egourgoulhon"
}
```

Replying to [comment:49 gh-DeRhamSource]:
> I hope, I took the renaming everywhere into account...

Thanks for the changes. 
I am OK for a positive review. Travis?



---

archive/issue_comments_388690.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-17T20:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388690",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388691.json:
```json
{
    "body": "Yep, I am also good with it.",
    "created_at": "2019-11-17T20:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388691",
    "user": "@tscrim"
}
```

Yep, I am also good with it.



---

archive/issue_comments_388692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-11-18T12:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388692",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388693.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-11-18T12:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388693",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388694.json:
```json
{
    "body": "Please give it a positive review again...",
    "created_at": "2019-11-18T13:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388694",
    "user": "@DeRhamSource"
}
```

Please give it a positive review again...



---

archive/issue_comments_388695.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-18T20:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388695",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388696.json:
```json
{
    "body": "The 9.0.beta6 patchbot is all green.",
    "created_at": "2019-11-18T20:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388696",
    "user": "@egourgoulhon"
}
```

The 9.0.beta6 patchbot is all green.



---

archive/issue_comments_388697.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-11-20T14:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388697",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-11-20T14:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388698",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388699.json:
```json
{
    "body": "That was just a very very minor thing I noticed during my thesis preparation. Sorry.\n\nBy the way: Am I allowed to switch the review status back to \"positive\" by myself in such cases?",
    "created_at": "2019-11-20T14:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388699",
    "user": "@DeRhamSource"
}
```

That was just a very very minor thing I noticed during my thesis preparation. Sorry.

By the way: Am I allowed to switch the review status back to "positive" by myself in such cases?



---

archive/issue_comments_388700.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-20T18:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388700",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388701.json:
```json
{
    "body": "Replying to [comment:56 gh-DeRhamSource]:\n> That was just a very very minor thing I noticed during my thesis preparation. Sorry.\n> \n\nNo problem. It's always good to improve the documentation!\n\n> By the way: Am I allowed to switch the review status back to \"positive\" by myself in such cases?\n\nI don't think we have very precise rules about this. IMHO, it seems better to have an external eye, even for seemingly minor changes.",
    "created_at": "2019-11-20T18:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388701",
    "user": "@egourgoulhon"
}
```

Replying to [comment:56 gh-DeRhamSource]:
> That was just a very very minor thing I noticed during my thesis preparation. Sorry.
> 

No problem. It's always good to improve the documentation!

> By the way: Am I allowed to switch the review status back to "positive" by myself in such cases?

I don't think we have very precise rules about this. IMHO, it seems better to have an external eye, even for seemingly minor changes.



---

archive/issue_comments_388702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-11-28T11:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388702",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388703.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-11-28T11:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388703",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388704.json:
```json
{
    "body": "Please check the merge and doc change.",
    "created_at": "2019-11-28T11:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388704",
    "user": "@DeRhamSource"
}
```

Please check the merge and doc change.



---

archive/issue_comments_388705.json:
```json
{
    "body": "Just checked that everything is in order with the new depedency #28716 and that all doctests are passed.",
    "created_at": "2019-11-28T12:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388705",
    "user": "@egourgoulhon"
}
```

Just checked that everything is in order with the new depedency #28716 and that all doctests are passed.



---

archive/issue_comments_388706.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-28T12:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388706",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-30T13:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27547#issuecomment-388707",
    "user": "@vbraun"
}
```

Resolution: fixed
