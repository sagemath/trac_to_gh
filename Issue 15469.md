# Issue 15469: Graph built from their edges are simple by default

archive/issues_015469.json:
```json
{
    "body": "CC:  azi vdelecroix rbeezer jason dimpase jmantysalo\n\nThe Graph/DiGraph constructor are scary to look at, and waste a lot of computations in order to guess whether the user wants loops or multiple edges. In order to reduce this number of tests and make those functions more efficient, we can change the default and force the user to specify explicitly what they want to obtain.\n\nNote that this is not a bad idea on its own, for graphs which allow multiple edges/loops behave differently with respect to the `add_edge` function, and by specifying this explicitly the user is forced to be aware of what is going to happen next.\n\nAfter many small patches like that, it may become possible to simplify a lot of things in those huge constructors. But first, deprecation for one year `T_T`\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/15706\n\n",
    "created_at": "2014-01-22T10:52:05Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "Graph built from their edges are simple by default",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15469",
    "user": "ncohen"
}
```
CC:  azi vdelecroix rbeezer jason dimpase jmantysalo

The Graph/DiGraph constructor are scary to look at, and waste a lot of computations in order to guess whether the user wants loops or multiple edges. In order to reduce this number of tests and make those functions more efficient, we can change the default and force the user to specify explicitly what they want to obtain.

Note that this is not a bad idea on its own, for graphs which allow multiple edges/loops behave differently with respect to the `add_edge` function, and by specifying this explicitly the user is forced to be aware of what is going to happen next.

After many small patches like that, it may become possible to simplify a lot of things in those huge constructors. But first, deprecation for one year `T_T`

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/15706





---

archive/issue_comments_199863.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-22T11:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199863",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199864.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T11:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199864",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199865.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-18T16:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199865",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199866.json:
```json
{
    "body": "Fixed.\n\nNathann",
    "created_at": "2014-05-18T16:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199866",
    "user": "ncohen"
}
```

Fixed.

Nathann



---

archive/issue_comments_199867.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-19T05:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199867",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199868.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/combinat/finite_state_machine.py  # 2 doctests failed\nsage -t --long src/sage/quivers/path_semigroup.py  # 1 doctest failed\n```\n",
    "created_at": "2014-05-19T05:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199868",
    "user": "rws"
}
```


```
sage -t --long src/sage/combinat/finite_state_machine.py  # 2 doctests failed
sage -t --long src/sage/quivers/path_semigroup.py  # 1 doctest failed
```




---

archive/issue_comments_199869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-19T08:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199870.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-19T08:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199870",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199871.json:
```json
{
    "body": "Interesting idea - that graphs aren't simple by default bit me recently, had to use `to_simple()` everywhere... but I have no particular opinion on what the *best* default is.",
    "created_at": "2014-11-13T19:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199871",
    "user": "kcrisman"
}
```

Interesting idea - that graphs aren't simple by default bit me recently, had to use `to_simple()` everywhere... but I have no particular opinion on what the *best* default is.



---

archive/issue_comments_199872.json:
```json
{
    "body": "What I would like to do is reach a state where people have to say explicitly what they expect. Right now it is automatically detected and this had a real cost in runtime, which is actually pure waste when you only create simple graphs.\n\nWhat this branch does is prepare deprecations so that, one year from now, I am able to rewrite the code correctly without this loss of time. So if you have some time to review it ?... (and discuss whatever is needed of course)\n\nNathann",
    "created_at": "2014-11-14T04:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199872",
    "user": "ncohen"
}
```

What I would like to do is reach a state where people have to say explicitly what they expect. Right now it is automatically detected and this had a real cost in runtime, which is actually pure waste when you only create simple graphs.

What this branch does is prepare deprecations so that, one year from now, I am able to rewrite the code correctly without this loss of time. So if you have some time to review it ?... (and discuss whatever is needed of course)

Nathann



---

archive/issue_comments_199873.json:
```json
{
    "body": "Well, like I said, I'm not sure I want to change that behavior or not.  It seems like the kind of thing that should be discussed at some length.  I do agree there should be a flag to avoid the runtime cost, that seems clear - but again, I am agnostic on the *default*.\n\nAs a constructive comment, maybe one ticket could be to have a flag (how that is named, I don't know) and then this one for making defaults, assuming there is something approaching consensus.",
    "created_at": "2014-11-14T13:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199873",
    "user": "kcrisman"
}
```

Well, like I said, I'm not sure I want to change that behavior or not.  It seems like the kind of thing that should be discussed at some length.  I do agree there should be a flag to avoid the runtime cost, that seems clear - but again, I am agnostic on the *default*.

As a constructive comment, maybe one ticket could be to have a flag (how that is named, I don't know) and then this one for making defaults, assuming there is something approaching consensus.



---

archive/issue_comments_199874.json:
```json
{
    "body": "Yo !\n\n> Well, like I said, I'm not sure I want to change that behavior or not.  It seems like the kind of thing that should be discussed at some length.\n\nWell... I would be glad to discuss it at length with anybody but this ticket has been here for 10 months already....\n\n> I do agree there should be a flag to avoid the runtime cost, that seems clear - but again, I am agnostic on the *default*.\n\nWell... Again, all graph books usually begin by saying that all graphs considered are simple, i.e. no loops nor multiple edges. There is such a thing as \"multigraph\", too. And I really don't like this behaviour:\n\n\n```\nsage: G=Graph([(1,2),(1,2),(1,1)]); G.edges()\n[(1, 1, None), (1, 2, None), (1, 2, None)]\nsage: G=Graph(); G.add_edge(1,2); G.add_edge(1,2); G.add_edge(1,1); G.edges()\n[(1, 2, None)]\n```\n\n\nSomehow the current behaviour of `add_edge` depends on non-explicit information, and considers simple graphs as the default. I would feel better if everybody got used to state clearly what they want to work with and dealt with the consequences. A guy who wants to build multigraphs and initializes them from a list of edges will experience seriously inconsistent behaviour depending on whether the initial information contains multiple edges and/or loops !\n\n> As a constructive comment, maybe one ticket could be to have a flag (how that is named, I don't know) and then this one for making defaults, assuming there is something approaching consensus.\n\nHmmmmm.... Well, what do you expect consensus to look like when it seems after 10 months that only one person cares ? `:-P`\n\nNathann",
    "created_at": "2014-11-15T18:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199874",
    "user": "ncohen"
}
```

Yo !

> Well, like I said, I'm not sure I want to change that behavior or not.  It seems like the kind of thing that should be discussed at some length.

Well... I would be glad to discuss it at length with anybody but this ticket has been here for 10 months already....

> I do agree there should be a flag to avoid the runtime cost, that seems clear - but again, I am agnostic on the *default*.

Well... Again, all graph books usually begin by saying that all graphs considered are simple, i.e. no loops nor multiple edges. There is such a thing as "multigraph", too. And I really don't like this behaviour:


```
sage: G=Graph([(1,2),(1,2),(1,1)]); G.edges()
[(1, 1, None), (1, 2, None), (1, 2, None)]
sage: G=Graph(); G.add_edge(1,2); G.add_edge(1,2); G.add_edge(1,1); G.edges()
[(1, 2, None)]
```


Somehow the current behaviour of `add_edge` depends on non-explicit information, and considers simple graphs as the default. I would feel better if everybody got used to state clearly what they want to work with and dealt with the consequences. A guy who wants to build multigraphs and initializes them from a list of edges will experience seriously inconsistent behaviour depending on whether the initial information contains multiple edges and/or loops !

> As a constructive comment, maybe one ticket could be to have a flag (how that is named, I don't know) and then this one for making defaults, assuming there is something approaching consensus.

Hmmmmm.... Well, what do you expect consensus to look like when it seems after 10 months that only one person cares ? `:-P`

Nathann



---

archive/issue_comments_199875.json:
```json
{
    "body": "> Hmmmmm.... Well, what do you expect consensus to look like when it seems after 10 months that only one person cares ? :-P\n\nWell, I don't consider no one cares when it's only on a ticket.  Only the seriously obsessed (like me?) just look at random tickets without invitation ;-)  And stuff that is actually important often languishes for years.\n\nI think the problem is that while some people like me are lazy and will put in double edges but don't mean it, the most likely thing when people put in extra edges is that they want them.  I don't feel competent to resolve this question - and definitely not *all* graph things assume all are simple.",
    "created_at": "2014-11-17T13:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199875",
    "user": "kcrisman"
}
```

> Hmmmmm.... Well, what do you expect consensus to look like when it seems after 10 months that only one person cares ? :-P

Well, I don't consider no one cares when it's only on a ticket.  Only the seriously obsessed (like me?) just look at random tickets without invitation ;-)  And stuff that is actually important often languishes for years.

I think the problem is that while some people like me are lazy and will put in double edges but don't mean it, the most likely thing when people put in extra edges is that they want them.  I don't feel competent to resolve this question - and definitely not *all* graph things assume all are simple.



---

archive/issue_comments_199876.json:
```json
{
    "body": "Hello !\n\n> Well, I don't consider no one cares when it's only on a ticket.  Only the seriously obsessed (like me?) just look at random tickets without invitation ;-)  And stuff that is actually important often languishes for years.\n\nHmmm... `:-P`\n\n> I think the problem is that while some people like me are lazy and will put in double edges but don't mean it, the most likely thing when people put in extra edges is that they want them.\n\nTrue, but I really worry of those who create many graphs, most of which have multiple edges, and all of a sudden create one from data which (by chance) corresponds to a simple graph. There is a danger of wrong results later on.\n\n> I don't feel competent to resolve this question - and definitely not *all* graph things assume all are simple.\n\n?\n\nWell no, we have stuff that works for both, and stuff that works for simple graphs.. \"recently\" I added a function called \"scream if not simple\" that is used in several places in the graph code, as really some functions that should not be called on non-simple graphs were not checked at all. It is a bit better, but this constructor thing remains a problem, especially when the behaviour of the constructor and the behaviour of `add_edge` is not the same.\n\nNathann",
    "created_at": "2014-11-17T14:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199876",
    "user": "ncohen"
}
```

Hello !

> Well, I don't consider no one cares when it's only on a ticket.  Only the seriously obsessed (like me?) just look at random tickets without invitation ;-)  And stuff that is actually important often languishes for years.

Hmmm... `:-P`

> I think the problem is that while some people like me are lazy and will put in double edges but don't mean it, the most likely thing when people put in extra edges is that they want them.

True, but I really worry of those who create many graphs, most of which have multiple edges, and all of a sudden create one from data which (by chance) corresponds to a simple graph. There is a danger of wrong results later on.

> I don't feel competent to resolve this question - and definitely not *all* graph things assume all are simple.

?

Well no, we have stuff that works for both, and stuff that works for simple graphs.. "recently" I added a function called "scream if not simple" that is used in several places in the graph code, as really some functions that should not be called on non-simple graphs were not checked at all. It is a bit better, but this constructor thing remains a problem, especially when the behaviour of the constructor and the behaviour of `add_edge` is not the same.

Nathann



---

archive/issue_comments_199877.json:
```json
{
    "body": ">There is a danger of wrong results later on.\nReally?  So some of our algorithms only work for multigraphs?  That would be interesting/scary.  I really thought the bigger danger was in the other direction, but that it was user error (such as mine) in that event.\n> ?\nSorry, by 'things' I meant 'books'.",
    "created_at": "2014-11-17T14:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199877",
    "user": "kcrisman"
}
```

>There is a danger of wrong results later on.
Really?  So some of our algorithms only work for multigraphs?  That would be interesting/scary.  I really thought the bigger danger was in the other direction, but that it was user error (such as mine) in that event.
> ?
Sorry, by 'things' I meant 'books'.



---

archive/issue_comments_199878.json:
```json
{
    "body": "Hello !\n\n> >There is a danger of wrong results later on.\n> Really?  So some of our algorithms only work for multigraphs?\n\nNonono, not that I know. But I only deal with simple graphs, remember ? `:-P`\n\nI was thinking of algebraists, or people doing automata theory. I expect them to create some graphs and to modify them later, and `add_edge` will only create a multiple edge if the graph \"allows\" multiple edge (this is decided at creation time).\n\nIf the first graph does not have multiple edge (by luck) this could make the later parts of their algorithms meaningless. I do not think that such a problem would exist in Sage, though. Some functions have no meaning for multigraphs (like .density()) but not the other way around.\n\nNathann",
    "created_at": "2014-11-17T14:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199878",
    "user": "ncohen"
}
```

Hello !

> >There is a danger of wrong results later on.
> Really?  So some of our algorithms only work for multigraphs?

Nonono, not that I know. But I only deal with simple graphs, remember ? `:-P`

I was thinking of algebraists, or people doing automata theory. I expect them to create some graphs and to modify them later, and `add_edge` will only create a multiple edge if the graph "allows" multiple edge (this is decided at creation time).

If the first graph does not have multiple edge (by luck) this could make the later parts of their algorithms meaningless. I do not think that such a problem would exist in Sage, though. Some functions have no meaning for multigraphs (like .density()) but not the other way around.

Nathann



---

archive/issue_comments_199879.json:
```json
{
    "body": "I see, I didn't realize that it was impossible to convert a simple graph into a multigraph.  Is there at least an error thrown?",
    "created_at": "2014-11-17T14:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199879",
    "user": "kcrisman"
}
```

I see, I didn't realize that it was impossible to convert a simple graph into a multigraph.  Is there at least an error thrown?



---

archive/issue_comments_199880.json:
```json
{
    "body": "> I see, I didn't realize that it was impossible to convert a simple graph into a multigraph.\n\nNonononono, it is possible ! You can do `G.allow_multiple_edges(True)`, but then you have to *know* that you need to do that.\n\n> Is there at least an error thrown?\n\nI don't understand what you are talking about, so I will answer the two possibilities:\n\n1) For .density() yes an error is thrown:\n\n```\nsage: Graph([(1,2),(1,2)]).density()\n...\nTypeError: Density is not well-defined for multigraphs.\n```\n\n\n2) For functions that use `scream_if_not_simple` too:\n\n```\nsage: Graph([(1,2),(1,2)]).is_split()\n...\nValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().\n```\n\n\n3) No error is thrown when you want to add an edge to a (simple) graph that already has it:\n\n```\nsage: g = Graph([(0,1)])\nsage: g.edges()\n[(0, 1, None)]\nsage: g.add_edge(0,1)\nsage: g.edges()\n[(0, 1, None)]\n```\n\n\nI believe that this is what should happen, but of course it can be a problem if you have created a simple graph by mistake, which can happen with this automatic detection.\n\nNathann",
    "created_at": "2014-11-17T14:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199880",
    "user": "ncohen"
}
```

> I see, I didn't realize that it was impossible to convert a simple graph into a multigraph.

Nonononono, it is possible ! You can do `G.allow_multiple_edges(True)`, but then you have to *know* that you need to do that.

> Is there at least an error thrown?

I don't understand what you are talking about, so I will answer the two possibilities:

1) For .density() yes an error is thrown:

```
sage: Graph([(1,2),(1,2)]).density()
...
TypeError: Density is not well-defined for multigraphs.
```


2) For functions that use `scream_if_not_simple` too:

```
sage: Graph([(1,2),(1,2)]).is_split()
...
ValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().
```


3) No error is thrown when you want to add an edge to a (simple) graph that already has it:

```
sage: g = Graph([(0,1)])
sage: g.edges()
[(0, 1, None)]
sage: g.add_edge(0,1)
sage: g.edges()
[(0, 1, None)]
```


I believe that this is what should happen, but of course it can be a problem if you have created a simple graph by mistake, which can happen with this automatic detection.

Nathann



---

archive/issue_comments_199881.json:
```json
{
    "body": "rebased on 6.5.b2\n----\nNew commits:",
    "created_at": "2014-12-09T21:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199881",
    "user": "chapoton"
}
```

rebased on 6.5.b2
----
New commits:



---

archive/issue_comments_199882.json:
```json
{
    "body": "Thanks... It would be cool if somebody was willing to review it, though.\n\nNathann",
    "created_at": "2014-12-10T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199882",
    "user": "ncohen"
}
```

Thanks... It would be cool if somebody was willing to review it, though.

Nathann



---

archive/issue_comments_199883.json:
```json
{
    "body": "> > Is there at least an error thrown?\n> I don't understand what you are talking about,\nI said that when I thought it was impossible to convert to multigraphs.\n\nThat said, this current behavior you mention is troubling.\n\n```\nsage: g = Graph([(0,1)])\nsage: g.edges()\n[(0, 1, None)]\nsage: g.add_edge(0,1)\nsage: g.edges()\n[(0, 1, None)]\n```\n\nIdeally, this should raise a warning (once per session, like a deprecation) that you should change to a multigraph, and after the deprecation period it would still raise the warning but now *force* it to be a multigraph.\n\nAs I mentioned before, I'm not a heavy graph theory user (though I do use it) so I think would be better to at least see whether any opinions existed on sage-devel - cc:ing one person who may have an opinion (?).",
    "created_at": "2014-12-10T19:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199883",
    "user": "kcrisman"
}
```

> > Is there at least an error thrown?
> I don't understand what you are talking about,
I said that when I thought it was impossible to convert to multigraphs.

That said, this current behavior you mention is troubling.

```
sage: g = Graph([(0,1)])
sage: g.edges()
[(0, 1, None)]
sage: g.add_edge(0,1)
sage: g.edges()
[(0, 1, None)]
```

Ideally, this should raise a warning (once per session, like a deprecation) that you should change to a multigraph, and after the deprecation period it would still raise the warning but now *force* it to be a multigraph.

As I mentioned before, I'm not a heavy graph theory user (though I do use it) so I think would be better to at least see whether any opinions existed on sage-devel - cc:ing one person who may have an opinion (?).



---

archive/issue_comments_199884.json:
```json
{
    "body": "> Ideally, this should raise a warning (once per session, like a deprecation) that you should change to a multigraph\n\nNot necessarily. I work on simple graphs only, and I use this from time to time. When I add an edge which is already there <do nothing> is what I expect.\n\nCurrently, users may not even know if their graph is simple or may contain multiedges, that's what I think is the problem.\n\n> As I mentioned before, I'm not a heavy graph theory user (though I do use it) so I think would be better to at least see whether any opinions existed on sage-devel - cc:ing one person who may have an opinion (?).\n\nOkay, I'll post there....\n\nNathann",
    "created_at": "2014-12-10T20:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199884",
    "user": "ncohen"
}
```

> Ideally, this should raise a warning (once per session, like a deprecation) that you should change to a multigraph

Not necessarily. I work on simple graphs only, and I use this from time to time. When I add an edge which is already there <do nothing> is what I expect.

Currently, users may not even know if their graph is simple or may contain multiedges, that's what I think is the problem.

> As I mentioned before, I'm not a heavy graph theory user (though I do use it) so I think would be better to at least see whether any opinions existed on sage-devel - cc:ing one person who may have an opinion (?).

Okay, I'll post there....

Nathann



---

archive/issue_comments_199885.json:
```json
{
    "body": "https://groups.google.com/forum/#!topic/sage-devel/78OBybXrfI8",
    "created_at": "2014-12-10T20:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199885",
    "user": "ncohen"
}
```

https://groups.google.com/forum/#!topic/sage-devel/78OBybXrfI8



---

archive/issue_comments_199886.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-11T07:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199886",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199887.json:
```json
{
    "body": "`Graph([(1, 2, 0), (1,2,1)])` gives `NameError: global name 'deprecation' is not defined`.",
    "created_at": "2014-12-11T07:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199887",
    "user": "jmantysalo"
}
```

`Graph([(1, 2, 0), (1,2,1)])` gives `NameError: global name 'deprecation' is not defined`.



---

archive/issue_comments_199888.json:
```json
{
    "body": "To be honest, I think that I do not know enought of graphs code to really review this. Sorry.\n\nIn one place there is missing space after `,` before `multiedges=True`.",
    "created_at": "2014-12-11T08:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199888",
    "user": "jmantysalo"
}
```

To be honest, I think that I do not know enought of graphs code to really review this. Sorry.

In one place there is missing space after `,` before `multiedges=True`.



---

archive/issue_comments_199889.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-11T08:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199889",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_199890.json:
```json
{
    "body": "Yo !\n\n> `Graph([(1, 2, 0), (1,2,1)])` gives `NameError: global name 'deprecation' is not defined`.\n\nThe module-level import of 'deprecation' was probably removed since the branch was written. I just rebased it (and removed the merge commits on the way).\n\n> To be honest, I think that I do not know enought of graphs code to really review this. Sorry.\n\nI see. Well, I do not think that there is much to know about graph code in this case. It deals with the constructor allright, but it is just an user interface decision.\n\nAnybodyyyyyyyyyyyy ?...\n\nNathann",
    "created_at": "2014-12-11T08:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199890",
    "user": "ncohen"
}
```

Yo !

> `Graph([(1, 2, 0), (1,2,1)])` gives `NameError: global name 'deprecation' is not defined`.

The module-level import of 'deprecation' was probably removed since the branch was written. I just rebased it (and removed the merge commits on the way).

> To be honest, I think that I do not know enought of graphs code to really review this. Sorry.

I see. Well, I do not think that there is much to know about graph code in this case. It deals with the constructor allright, but it is just an user interface decision.

Anybodyyyyyyyyyyyy ?...

Nathann



---

archive/issue_comments_199891.json:
```json
{
    "body": "Is it ready for review?",
    "created_at": "2014-12-11T10:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199891",
    "user": "dimpase"
}
```

Is it ready for review?



---

archive/issue_comments_199892.json:
```json
{
    "body": "It is.\n\nNathann",
    "created_at": "2014-12-11T10:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199892",
    "user": "ncohen"
}
```

It is.

Nathann



---

archive/issue_comments_199893.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-11T11:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199893",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199894.json:
```json
{
    "body": "Oops, sorry.",
    "created_at": "2014-12-11T11:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199894",
    "user": "ncohen"
}
```

Oops, sorry.



---

archive/issue_comments_199895.json:
```json
{
    "body": "LGTM",
    "created_at": "2014-12-11T13:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199895",
    "user": "dimpase"
}
```

LGTM



---

archive/issue_comments_199896.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-11T13:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199896",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199897.json:
```json
{
    "body": "Wowwwwwwww !! Super cool, thanks `:-)`\n\nNathann",
    "created_at": "2014-12-11T14:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199897",
    "user": "ncohen"
}
```

Wowwwwwwww !! Super cool, thanks `:-)`

Nathann



---

archive/issue_comments_199898.json:
```json
{
    "body": "Okay, I'll let Dima take the fall if users complain ;-)  Seriously, I hope this leads to less confusion in the long-run for people who like both multigraphs and simple ones; I just didn't want to make that UI decision.\n\nI do have one question that probably has an answer of \"yes\"; are there still enough examples of graphs not in the extremely cryptic/hermetic dictionary of dictionary notation?  I noticed you changed quite a few of the dict of lists ones, and I had never seen that other constructor before.",
    "created_at": "2014-12-11T15:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199898",
    "user": "kcrisman"
}
```

Okay, I'll let Dima take the fall if users complain ;-)  Seriously, I hope this leads to less confusion in the long-run for people who like both multigraphs and simple ones; I just didn't want to make that UI decision.

I do have one question that probably has an answer of "yes"; are there still enough examples of graphs not in the extremely cryptic/hermetic dictionary of dictionary notation?  I noticed you changed quite a few of the dict of lists ones, and I had never seen that other constructor before.



---

archive/issue_comments_199899.json:
```json
{
    "body": "> Okay, I'll let Dima take the fall if users complain ;-)  Seriously, I hope this leads to less confusion in the long-run for people who like both multigraphs and simple ones; I just didn't want to make that UI decision.\n\nWell. Regardless of changing the default to \"always simple\", it is already good that  `add_edge` will become consistent with the constructor.\n\n> I do have one question that probably has an answer of \"yes\"; are there still enough examples of graphs not in the extremely cryptic/hermetic dictionary of dictionary notation?  I noticed you changed quite a few of the dict of lists ones, and I had never seen that other constructor before.\n\nI changed dicts to lists ? Can you tell me where ?\n\nThe dictionary notation is only cryptic when you want \"edge-labelled multigraphs\". When you want simple graphs, it is rather simple: associate to each vertex the list of its neighbors.\n\nTo answer your question a bit more completely: I hope that Sage (the code, not the doctests) contains no occurrence of `Graph(list_of_edges)`, for this is slower than `g=Graph();g.add_edges(list_of_edges)`. This is also the point of this ticket: making both equally fast.\n\nNathann",
    "created_at": "2014-12-11T15:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199899",
    "user": "ncohen"
}
```

> Okay, I'll let Dima take the fall if users complain ;-)  Seriously, I hope this leads to less confusion in the long-run for people who like both multigraphs and simple ones; I just didn't want to make that UI decision.

Well. Regardless of changing the default to "always simple", it is already good that  `add_edge` will become consistent with the constructor.

> I do have one question that probably has an answer of "yes"; are there still enough examples of graphs not in the extremely cryptic/hermetic dictionary of dictionary notation?  I noticed you changed quite a few of the dict of lists ones, and I had never seen that other constructor before.

I changed dicts to lists ? Can you tell me where ?

The dictionary notation is only cryptic when you want "edge-labelled multigraphs". When you want simple graphs, it is rather simple: associate to each vertex the list of its neighbors.

To answer your question a bit more completely: I hope that Sage (the code, not the doctests) contains no occurrence of `Graph(list_of_edges)`, for this is slower than `g=Graph();g.add_edges(list_of_edges)`. This is also the point of this ticket: making both equally fast.

Nathann



---

archive/issue_comments_199900.json:
```json
{
    "body": "Besides, just for your own information:\n\n\n```\nsage: g = Graph()\nsage: edges = list(combinations(range(1000),2))\nsage: %time g.add_edges(edges)\nCPU times: user 992 ms, sys: 44 ms, total: 1.04 s\nWall time: 989 ms\nsage: g = Graph()\nsage: %time for e in edges: g.add_edge(e)\nCPU times: user 1.8 s, sys: 44 ms, total: 1.84 s\nWall time: 1.79 s\n```\n\n\nThis, because `add_edge(u,v)`, `add_edge(u,v,l)`, `add_edge((u,v))`, `add_edge((u,v,l))` are all valid, and that deciding which should be used takes time, at each `add_edge` call.\n\nNathann",
    "created_at": "2014-12-11T15:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199900",
    "user": "ncohen"
}
```

Besides, just for your own information:


```
sage: g = Graph()
sage: edges = list(combinations(range(1000),2))
sage: %time g.add_edges(edges)
CPU times: user 992 ms, sys: 44 ms, total: 1.04 s
Wall time: 989 ms
sage: g = Graph()
sage: %time for e in edges: g.add_edge(e)
CPU times: user 1.8 s, sys: 44 ms, total: 1.84 s
Wall time: 1.79 s
```


This, because `add_edge(u,v)`, `add_edge(u,v,l)`, `add_edge((u,v))`, `add_edge((u,v,l))` are all valid, and that deciding which should be used takes time, at each `add_edge` call.

Nathann



---

archive/issue_comments_199901.json:
```json
{
    "body": "> I changed dicts to lists ? Can you tell me where ?\n\nNo, you changed lists to dicts, e.g. \n\n```diff\n-        sage: G=DiGraph([[0,0],[0,0],[0,0],[1,1],[1,1],[1,1]])\n-        sage: H=DiGraph([[0,0],[0,0],[0,0],[0,0],[1,1],[1,1]])\n+        sage: G=DiGraph({0:[0,0,0],1:[1,1,1]})\n+        sage: H=DiGraph({0:[0,0,0,0],1:[1,1]})\n```\n\nand some similar, which is okay, but also\n\n```diff\n-            sage: DiGraph([(1, 2, 0), (1,2,1)])\n+            sage: DiGraph({1:{2:[0,1]}})\n```\n\nwhich I didn't even know was possible, and certainly don't know how to interpret (though I barely know how to interpret the other one, I guess the last element of each triple is for the direction?).  Edit: after thinking about it for a little, I now get it, but still find it pretty terse.",
    "created_at": "2014-12-11T15:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199901",
    "user": "kcrisman"
}
```

> I changed dicts to lists ? Can you tell me where ?

No, you changed lists to dicts, e.g. 

```diff
-        sage: G=DiGraph([[0,0],[0,0],[0,0],[1,1],[1,1],[1,1]])
-        sage: H=DiGraph([[0,0],[0,0],[0,0],[0,0],[1,1],[1,1]])
+        sage: G=DiGraph({0:[0,0,0],1:[1,1,1]})
+        sage: H=DiGraph({0:[0,0,0,0],1:[1,1]})
```

and some similar, which is okay, but also

```diff
-            sage: DiGraph([(1, 2, 0), (1,2,1)])
+            sage: DiGraph({1:{2:[0,1]}})
```

which I didn't even know was possible, and certainly don't know how to interpret (though I barely know how to interpret the other one, I guess the last element of each triple is for the direction?).  Edit: after thinking about it for a little, I now get it, but still find it pretty terse.



---

archive/issue_comments_199902.json:
```json
{
    "body": "> No, you changed lists to dicts, e.g. \n\nOh sorrysorry, I thought that you were speaking of Sage's code.\n\n> {{{#!diff\n> -            sage: DiGraph([(1, 2, 0), (1,2,1)])\n> +            sage: DiGraph({1:{2:[0,1]}})\n> }}}\n> which I didn't even know was possible, and certainly don't know how to interpret (though I barely know how to interpret the other one, I guess the last element of each triple is for the direction?).  Edit: after thinking about it for a little, I now get it, but still find it pretty terse.\n\nAhaha. Well, indeed, \"multigraph with labelled edges\". It is the most awful thing we handle I believe `:-P`\n\nThis being said, it is \"the right data structure\" in terms of elementary operations. Though hard to read. By the way, it can give you an idea of why I hate multiple edges and loops. It makes everything more complicated, and none of the additional complexities is very interesting from the theoretical point of view. It is just more work and more corner-cases `:-P`\n\nNathann",
    "created_at": "2014-12-11T16:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199902",
    "user": "ncohen"
}
```

> No, you changed lists to dicts, e.g. 

Oh sorrysorry, I thought that you were speaking of Sage's code.

> {{{#!diff
> -            sage: DiGraph([(1, 2, 0), (1,2,1)])
> +            sage: DiGraph({1:{2:[0,1]}})
> }}}
> which I didn't even know was possible, and certainly don't know how to interpret (though I barely know how to interpret the other one, I guess the last element of each triple is for the direction?).  Edit: after thinking about it for a little, I now get it, but still find it pretty terse.

Ahaha. Well, indeed, "multigraph with labelled edges". It is the most awful thing we handle I believe `:-P`

This being said, it is "the right data structure" in terms of elementary operations. Though hard to read. By the way, it can give you an idea of why I hate multiple edges and loops. It makes everything more complicated, and none of the additional complexities is very interesting from the theoretical point of view. It is just more work and more corner-cases `:-P`

Nathann



---

archive/issue_comments_199903.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-12T12:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15469#issuecomment-199903",
    "user": "vbraun"
}
```

Resolution: fixed
