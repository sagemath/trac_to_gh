# Issue 29763: Implement a Q-curve test for elliptic curves over number fields

Issue created by migration from https://trac.sagemath.org/ticket/30000

Original creator: cremona

Original creation time: 2020-06-27 08:16:35

An in teresting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implsmented some, and will include it in Sage when done.


---

Comment by chapoton created at 2020-06-27 08:33:58

Congratulation for the ticket number, and thanks for all your contributions !


---

Comment by kedlaya created at 2020-07-05 18:21:08

Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?


---

Comment by cremona created at 2020-07-06 07:35:18

Replying to [comment:2 kedlaya]:
> Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?

Yes absolutely.  I'll be writing up the strategy as part of a joint paper with Filip Najman and Samuel Le Fourn.   It is mostly coded already, and run on all the curves in the LMFDB, but since I did that we have proved some results which make both parts simpler -- both easy tests of necessary conditions, which in practice eliminate all non-Q-curves, and rigorous tests of the remaining ones to establish that they are.  The key is not having to make an field extensions -- for example if your curve defined over an S6 sextic field, you definitely do not want to work over the Galois closure.  We don't!


---

Comment by cremona created at 2021-02-05 12:23:13

Changing status from new to needs_review.


---

Comment by cremona created at 2021-02-05 12:23:13

Note to reviewers:  the main new code is in a new file Qcurves.py, which I added to the reference manual. That consists of one main function `is_Q_curve()` and a couple of helper functions, all documented.  The user interface is via a new method in the class for elliptic curves over number fields.

For correctness, I refer to the preprint above which both establishes the necessary theory and presents the algorithm.  This paper has been refereed by two people and is provisionally accepted by Research in Number Theory (the referees had no issues with the algorithm).  And I have run the code on many hundreds of thousands of curves in the LMFDB -- so there is no point in comparing the output with the LMFDB, as the data there was computed by this code.  There are no other implementations of this that I know of.  Note that it is easy to try something much simpler which is both wrong and also incorrect, namely to base extend to the Galois closure, compute the isogeny class there, and see if all the Galois conjugates to the original (base-changed) curve are in the class.  This is wrong since the definition of Q-curves allows for the isogenies to be defined over Q-bar, and it is also very inefficient (e.g. if the base field as degree 6 and its Galois closure has degree 720).  My main motivation for the paper cited was to develop a more efficient algorithm, and the crucial new point is to see that one can decide the question without any extension of the base field.
----
New commits:


---

Comment by kedlaya created at 2021-02-05 17:33:40

For the record, I was not one of the two referees, and I just convinced myself that the algorithm described in the paper is correct. (But I have not looked at the code yet.)


---

Comment by kedlaya created at 2021-02-06 03:32:37

I'm seeing some doctest failures in patchbot starting from

```
ModuleNotFoundError: No module named 'sage.schemes.elliptic_curves.Qcurve'
```

but that's just a typo: it should be `Qcurves`.


---

Comment by chapoton created at 2021-02-06 12:08:30

suggestions:

* Rather than importing things from sage.all, import them from where given by "import_statements"

* typos in "using a rigorous computaion" and "Frobenius discrimants"

* no need for square brackets here :

```
if any([d != discs[0] for d in discs[1:]]):
```



---

Comment by chapoton created at 2021-02-06 12:33:49

by the way, John, could you please help to answer

https://ask.sagemath.org/question/55571/what-is-the-sigma-function-for-an-elliptic-curves-formal-group/


---

Comment by cremona created at 2021-02-06 14:17:42

OK, fixing the isses raised (I was sure that I had done a local test of ell_number_field, but clearly not).


---

Comment by git created at 2021-02-06 14:51:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2021-02-09 04:55:39

Looks great! I am eagerly awaiting this to get merged so that I can start using it...


---

Comment by kedlaya created at 2021-02-09 04:55:39

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2021-02-09 09:06:32

Thanks Kiran.  I look forward to feedback, especially if it is not in the form of bug reports.  If you cannot wait, this code (essentially) is also in https://github.com/JohnCremona/ecnf-data/blob/master/sage/Qcurves.py


---

Comment by vbraun created at 2021-03-01 00:20:55

Resolution: fixed
