# Issue 29763: Implement a Q-curve test for elliptic curves over number fields

archive/issues_029763.json:
```json
{
    "body": "An in teresting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implsmented some, and will include it in Sage when done.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30000\n\n",
    "created_at": "2020-06-27T08:16:35Z",
    "labels": [
        "elliptic curves",
        "major",
        "enhancement"
    ],
    "title": "Implement a Q-curve test for elliptic curves over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29763",
    "user": "cremona"
}
```
An in teresting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implsmented some, and will include it in Sage when done.

Issue created by migration from https://trac.sagemath.org/ticket/30000





---

archive/issue_comments_422738.json:
```json
{
    "body": "Congratulation for the ticket number, and thanks for all your contributions !",
    "created_at": "2020-06-27T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422738",
    "user": "chapoton"
}
```

Congratulation for the ticket number, and thanks for all your contributions !



---

archive/issue_comments_422739.json:
```json
{
    "body": "Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?",
    "created_at": "2020-07-05T18:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422739",
    "user": "kedlaya"
}
```

Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?



---

archive/issue_comments_422740.json:
```json
{
    "body": "Replying to [comment:2 kedlaya]:\n> Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?\n\nYes absolutely.  I'll be writing up the strategy as part of a joint paper with Filip Najman and Samuel Le Fourn.   It is mostly coded already, and run on all the curves in the LMFDB, but since I did that we have proved some results which make both parts simpler -- both easy tests of necessary conditions, which in practice eliminate all non-Q-curves, and rigorous tests of the remaining ones to establish that they are.  The key is not having to make an field extensions -- for example if your curve defined over an S6 sextic field, you definitely do not want to work over the Galois closure.  We don't!",
    "created_at": "2020-07-06T07:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422740",
    "user": "cremona"
}
```

Replying to [comment:2 kedlaya]:
> Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?

Yes absolutely.  I'll be writing up the strategy as part of a joint paper with Filip Najman and Samuel Le Fourn.   It is mostly coded already, and run on all the curves in the LMFDB, but since I did that we have proved some results which make both parts simpler -- both easy tests of necessary conditions, which in practice eliminate all non-Q-curves, and rigorous tests of the remaining ones to establish that they are.  The key is not having to make an field extensions -- for example if your curve defined over an S6 sextic field, you definitely do not want to work over the Galois closure.  We don't!



---

archive/issue_comments_422741.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422741",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422742.json:
```json
{
    "body": "Note to reviewers:  the main new code is in a new file Qcurves.py, which I added to the reference manual. That consists of one main function `is_Q_curve()` and a couple of helper functions, all documented.  The user interface is via a new method in the class for elliptic curves over number fields.\n\nFor correctness, I refer to the preprint above which both establishes the necessary theory and presents the algorithm.  This paper has been refereed by two people and is provisionally accepted by Research in Number Theory (the referees had no issues with the algorithm).  And I have run the code on many hundreds of thousands of curves in the LMFDB -- so there is no point in comparing the output with the LMFDB, as the data there was computed by this code.  There are no other implementations of this that I know of.  Note that it is easy to try something much simpler which is both wrong and also incorrect, namely to base extend to the Galois closure, compute the isogeny class there, and see if all the Galois conjugates to the original (base-changed) curve are in the class.  This is wrong since the definition of Q-curves allows for the isogenies to be defined over Q-bar, and it is also very inefficient (e.g. if the base field as degree 6 and its Galois closure has degree 720).  My main motivation for the paper cited was to develop a more efficient algorithm, and the crucial new point is to see that one can decide the question without any extension of the base field.\n----\nNew commits:",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422742",
    "user": "cremona"
}
```

Note to reviewers:  the main new code is in a new file Qcurves.py, which I added to the reference manual. That consists of one main function `is_Q_curve()` and a couple of helper functions, all documented.  The user interface is via a new method in the class for elliptic curves over number fields.

For correctness, I refer to the preprint above which both establishes the necessary theory and presents the algorithm.  This paper has been refereed by two people and is provisionally accepted by Research in Number Theory (the referees had no issues with the algorithm).  And I have run the code on many hundreds of thousands of curves in the LMFDB -- so there is no point in comparing the output with the LMFDB, as the data there was computed by this code.  There are no other implementations of this that I know of.  Note that it is easy to try something much simpler which is both wrong and also incorrect, namely to base extend to the Galois closure, compute the isogeny class there, and see if all the Galois conjugates to the original (base-changed) curve are in the class.  This is wrong since the definition of Q-curves allows for the isogenies to be defined over Q-bar, and it is also very inefficient (e.g. if the base field as degree 6 and its Galois closure has degree 720).  My main motivation for the paper cited was to develop a more efficient algorithm, and the crucial new point is to see that one can decide the question without any extension of the base field.
----
New commits:



---

archive/issue_comments_422743.json:
```json
{
    "body": "For the record, I was not one of the two referees, and I just convinced myself that the algorithm described in the paper is correct. (But I have not looked at the code yet.)",
    "created_at": "2021-02-05T17:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422743",
    "user": "kedlaya"
}
```

For the record, I was not one of the two referees, and I just convinced myself that the algorithm described in the paper is correct. (But I have not looked at the code yet.)



---

archive/issue_comments_422744.json:
```json
{
    "body": "I'm seeing some doctest failures in patchbot starting from\n\n```\nModuleNotFoundError: No module named 'sage.schemes.elliptic_curves.Qcurve'\n```\n\nbut that's just a typo: it should be `Qcurves`.",
    "created_at": "2021-02-06T03:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422744",
    "user": "kedlaya"
}
```

I'm seeing some doctest failures in patchbot starting from

```
ModuleNotFoundError: No module named 'sage.schemes.elliptic_curves.Qcurve'
```

but that's just a typo: it should be `Qcurves`.



---

archive/issue_comments_422745.json:
```json
{
    "body": "suggestions:\n\n* Rather than importing things from sage.all, import them from where given by \"import_statements\"\n\n* typos in \"using a rigorous computaion\" and \"Frobenius discrimants\"\n\n* no need for square brackets here :\n\n```\nif any([d != discs[0] for d in discs[1:]]):\n```\n",
    "created_at": "2021-02-06T12:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422745",
    "user": "chapoton"
}
```

suggestions:

* Rather than importing things from sage.all, import them from where given by "import_statements"

* typos in "using a rigorous computaion" and "Frobenius discrimants"

* no need for square brackets here :

```
if any([d != discs[0] for d in discs[1:]]):
```




---

archive/issue_comments_422746.json:
```json
{
    "body": "by the way, John, could you please help to answer\n\nhttps://ask.sagemath.org/question/55571/what-is-the-sigma-function-for-an-elliptic-curves-formal-group/",
    "created_at": "2021-02-06T12:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422746",
    "user": "chapoton"
}
```

by the way, John, could you please help to answer

https://ask.sagemath.org/question/55571/what-is-the-sigma-function-for-an-elliptic-curves-formal-group/



---

archive/issue_comments_422747.json:
```json
{
    "body": "OK, fixing the isses raised (I was sure that I had done a local test of ell_number_field, but clearly not).",
    "created_at": "2021-02-06T14:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422747",
    "user": "cremona"
}
```

OK, fixing the isses raised (I was sure that I had done a local test of ell_number_field, but clearly not).



---

archive/issue_comments_422748.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-06T14:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422748",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422749.json:
```json
{
    "body": "Looks great! I am eagerly awaiting this to get merged so that I can start using it...",
    "created_at": "2021-02-09T04:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422749",
    "user": "kedlaya"
}
```

Looks great! I am eagerly awaiting this to get merged so that I can start using it...



---

archive/issue_comments_422750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-09T04:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422750",
    "user": "kedlaya"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422751.json:
```json
{
    "body": "Thanks Kiran.  I look forward to feedback, especially if it is not in the form of bug reports.  If you cannot wait, this code (essentially) is also in https://github.com/JohnCremona/ecnf-data/blob/master/sage/Qcurves.py",
    "created_at": "2021-02-09T09:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422751",
    "user": "cremona"
}
```

Thanks Kiran.  I look forward to feedback, especially if it is not in the form of bug reports.  If you cannot wait, this code (essentially) is also in https://github.com/JohnCremona/ecnf-data/blob/master/sage/Qcurves.py



---

archive/issue_comments_422752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-01T00:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29763#issuecomment-422752",
    "user": "vbraun"
}
```

Resolution: fixed
