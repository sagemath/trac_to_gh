# Issue 13509: view generates a LaTex (memory?) error on a graph of size 24

Issue created by migration from Trac.

Original creator: slabbe

Original creation time: 2012-11-15 14:35:56

Assignee: tbd

Keywords: dot2tex

Create this graph:


```
sage: F = GF(3)
sage: gens = [matrix(F,2,[1,0, 1,1]), matrix(F,2, [1,1, 0,1])]
sage: group = MatrixGroup(gens)
sage: G = group.cayley_graph()
```


It is not too big:


```
sage: G
Digraph on 24 vertices
```


Note that since the vertices of G are matrices, the default `format='tkz_graph'` [does not work](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/10/draw-a-graph-of-matrices-in-latex-using-sage/). One need to use `format='dot2tex'`. With dot2tex-2.8.7-2 and graphviz installed, this works:


```
sage: G.set_latex_options(format='dot2tex', prog='neato')
sage: view(G)
```


But not this one:


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G)
An error occurred.
...
LaTex error
```


I know a workaround which is to [use the tikz2pdf script](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/11/using-sage-graphviz-dot2tex-tikz-tikz2pdf-to-draw-a-graph) which compiles fine. But, it would be nice if view could compile G as well.


---

Comment by jhpalmieri created at 2012-11-15 15:38:34

If you run `view(G, debug=True)`, you should get more information about the error.


---

Comment by slabbe created at 2012-11-15 23:54:23

> If you run `view(G, debug=True)`, you should get more information about the error.

In a working example, relevant part of the log is below. So if I understand correctly, the command view is first trying the path tex -> dvi -> png, if some error occurs, then tries dvi -> ps -> pdf. And now I understand why it is so slow when it works::


```
sage: sage: G.set_latex_options(format='dot2tex', prog='neato')
sage: view(G, debug=True)
\documentclass{article}
...
\begin{document}
...
\end{document}
['sage-native-execute', 'latex', '\\nonstopmode', '\\input{sage.tex}']
['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)
entering extended mode
LaTeX2e <2009/09/24>
Babel ...
...
Output written on sage.dvi (1 page, 32420 bytes).
Transcript written on sage.log.
This is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
...
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
bad dvi file; running dvips and ps2pdf instead...
['sage-native-execute', 'dvips', 'sage.dvi']
['sage-native-execute', 'ps2pdf', 'sage.ps']
This is dvips(k) 5.98 Copyright 2009 Radical Eye Software (www.radicaleye.com)
' TeX output 2012.11.16:0002' -> sage.ps
...
viewer: "sage-open"
sage: 
```


And, now the log of the non working example is below. There are some Overfull vbox and hbox during the latex -> dvi phase so that the next dvi -> png ends with an error and thus does not try "running dvips and ps2pdf instead..." as above :


```
sage: sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, debug=True)
\documentclass{article}
...
\begin{document}
...
\end{document}
['sage-native-execute', 'latex', '\\nonstopmode', '\\input{sage.tex}']
['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)
entering extended mode
LaTeX2e <2009/09/24>
Babel ...
...
Overfull \hbox (138.51622pt too wide) detected at line 119
[]
[1]
Overfull \vbox (677.07953pt too high) has occurred while \output is active [2] (./sage.aux) )
(see the transcript file for additional information)
Output written on sage.dvi (2 pages, 35212 bytes).
Transcript written on sage.log.
This is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
...
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
An error occurred.
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009) (format=latex 2011.4.19)  15 NOV 2012 23:59
entering extended mode
...
...
...
...
...
Overfull \hbox (138.51622pt too wide) detected at line 119 [] []
[1] Overfull \vbox (677.07953pt too high) has occurred while \output is active []
...
...
Output written on sage.dvi (2 pages, 35212 bytes).

Latex error
sage: 
```



---

Comment by slabbe created at 2012-11-16 00:12:56

Okay, it turns out that the default compilation (try : tex -> dvi -> png, except: dvi -> ps -> pdf) which doesn't like overfull vbox and hbox can be changed using the `engine` option. Thus,


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, engine='pdflatex')
```


and


```
sage: G.set_latex_options(format='dot2tex', prog='circo')
sage: view(G, engine='pdflatex')
```


both compile fine and give pdf files with clear overfull vbox and hbox. And, one can see the complete graphs by using `tightpage=True`:


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, engine='pdflatex', tightpage=True)
sage: G.set_latex_options(format='dot2tex', prog='circo')
sage: view(G, engine='pdflatex', tightpage=True)
```



---

Comment by slabbe created at 2012-11-16 00:23:29

So before closing this ticket, I ask the following question:

Why is the default compilation of the command view doing (try : tex -> dvi -> png, except: dvi -> ps -> pdf) ? In which case is it better to do (tex -> dvi -> png) or (tex -> dvi -> ps -> pdf) rather then simply (tex -> pdf) ?

It has been a long time since I have seen pstricks code around here... and I would like 


```
view(G)
```


to just work.


---

Comment by nthiery created at 2013-03-11 18:04:19

At first sight, I am also in favor of switching to pdflatex as default engine.


---

Comment by jhpalmieri created at 2013-03-11 18:06:55

Replying to [comment:7 nthiery]:
> At first sight, I am also in favor of switching to pdflatex as default engine.

Sounds okay to me.


---

Comment by slabbe created at 2013-04-02 15:00:12

tested on sage-5.7.beta4


---

Attachment


---

Comment by slabbe created at 2013-04-02 15:50:34

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2013-04-02 18:34:12

I'm happy with the main patch. I think it requires some modifications to the documentation in the `latex_examples` class, so I've attached a referee patch to deal with that.


---

Attachment

For what it's worth, I was getting the "latex error" on just using view with 'latex' after I did some updatings (even doing something as simple as `view(2)`). However with the 'pdflatex', things are working again, so I think this is a good switch to make.


---

Comment by jdemeyer created at 2013-04-03 07:44:46

Don't forget to indicate which patch(es) need to be applied.


---

Comment by jdemeyer created at 2013-04-03 07:44:46

Changing component from packages: optional to graphics.


---

Comment by slabbe created at 2013-04-03 09:57:19

There are 5 tests failing on the patchbot, but do not seem related to this ticket :


```
sage -t sage/interfaces/expect.py  # 1 doctest failed
sage -t sage/interacts/debugger.py  # 8 doctests failed
sage -t doc/en/prep/Intro-Tutorial.rst  # Killed due to kill signal
sage -t sage/modules/free_module_homspace.py  # Killed due to kill signal
sage -t sage/graphs/generators/world_map.py  # Killed due to kill signal
```



---

Comment by tscrim created at 2013-04-08 22:05:57

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-04-08 22:05:57

Everything looks good to me.


---

Comment by jdemeyer created at 2013-04-13 13:49:18

Resolution: fixed
