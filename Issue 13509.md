# Issue 13509: view generates a LaTex (memory?) error on a graph of size 24

archive/issues_013509.json:
```json
{
    "body": "Assignee: tbd\n\nKeywords: dot2tex\n\nCreate this graph:\n\n\n```\nsage: F = GF(3)\nsage: gens = [matrix(F,2,[1,0, 1,1]), matrix(F,2, [1,1, 0,1])]\nsage: group = MatrixGroup(gens)\nsage: G = group.cayley_graph()\n```\n\n\nIt is not too big:\n\n\n```\nsage: G\nDigraph on 24 vertices\n```\n\n\nNote that since the vertices of G are matrices, the default `format='tkz_graph'` [does not work](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/10/draw-a-graph-of-matrices-in-latex-using-sage/). One need to use `format='dot2tex'`. With dot2tex-2.8.7-2 and graphviz installed, this works:\n\n\n```\nsage: G.set_latex_options(format='dot2tex', prog='neato')\nsage: view(G)\n```\n\n\nBut not this one:\n\n\n```\nsage: G.set_latex_options(format='dot2tex', prog='dot')\nsage: view(G)\nAn error occurred.\n...\nLaTex error\n```\n\n\nI know a workaround which is to [use the tikz2pdf script](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/11/using-sage-graphviz-dot2tex-tikz-tikz2pdf-to-draw-a-graph) which compiles fine. But, it would be nice if view could compile G as well.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13713\n\n",
    "created_at": "2012-11-15T14:35:56Z",
    "labels": [
        "packages: optional",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "view generates a LaTex (memory?) error on a graph of size 24",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13509",
    "user": "slabbe"
}
```
Assignee: tbd

Keywords: dot2tex

Create this graph:


```
sage: F = GF(3)
sage: gens = [matrix(F,2,[1,0, 1,1]), matrix(F,2, [1,1, 0,1])]
sage: group = MatrixGroup(gens)
sage: G = group.cayley_graph()
```


It is not too big:


```
sage: G
Digraph on 24 vertices
```


Note that since the vertices of G are matrices, the default `format='tkz_graph'` [does not work](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/10/draw-a-graph-of-matrices-in-latex-using-sage/). One need to use `format='dot2tex'`. With dot2tex-2.8.7-2 and graphviz installed, this works:


```
sage: G.set_latex_options(format='dot2tex', prog='neato')
sage: view(G)
```


But not this one:


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G)
An error occurred.
...
LaTex error
```


I know a workaround which is to [use the tikz2pdf script](http://www.liafa.univ-paris-diderot.fr/~labbe/blogue/2012/11/using-sage-graphviz-dot2tex-tikz-tikz2pdf-to-draw-a-graph) which compiles fine. But, it would be nice if view could compile G as well.

Issue created by migration from https://trac.sagemath.org/ticket/13713





---

archive/issue_comments_166722.json:
```json
{
    "body": "If you run `view(G, debug=True)`, you should get more information about the error.",
    "created_at": "2012-11-15T15:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166722",
    "user": "jhpalmieri"
}
```

If you run `view(G, debug=True)`, you should get more information about the error.



---

archive/issue_comments_166723.json:
```json
{
    "body": "> If you run `view(G, debug=True)`, you should get more information about the error.\n\nIn a working example, relevant part of the log is below. So if I understand correctly, the command view is first trying the path tex -> dvi -> png, if some error occurs, then tries dvi -> ps -> pdf. And now I understand why it is so slow when it works::\n\n\n```\nsage: sage: G.set_latex_options(format='dot2tex', prog='neato')\nsage: view(G, debug=True)\n\\documentclass{article}\n...\n\\begin{document}\n...\n\\end{document}\n['sage-native-execute', 'latex', '\\\\nonstopmode', '\\\\input{sage.tex}']\n['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']\nThis is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)\nentering extended mode\nLaTeX2e <2009/09/24>\nBabel ...\n...\nOutput written on sage.dvi (1 page, 32420 bytes).\nTranscript written on sage.log.\nThis is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson\nGPL Ghostscript 8.70: Unrecoverable error, exit code 1\n...\nGPL Ghostscript 8.70: Unrecoverable error, exit code 1\nbad dvi file; running dvips and ps2pdf instead...\n['sage-native-execute', 'dvips', 'sage.dvi']\n['sage-native-execute', 'ps2pdf', 'sage.ps']\nThis is dvips(k) 5.98 Copyright 2009 Radical Eye Software (www.radicaleye.com)\n' TeX output 2012.11.16:0002' -> sage.ps\n...\nviewer: \"sage-open\"\nsage: \n```\n\n\nAnd, now the log of the non working example is below. There are some Overfull vbox and hbox during the latex -> dvi phase so that the next dvi -> png ends with an error and thus does not try \"running dvips and ps2pdf instead...\" as above :\n\n\n```\nsage: sage: G.set_latex_options(format='dot2tex', prog='dot')\nsage: view(G, debug=True)\n\\documentclass{article}\n...\n\\begin{document}\n...\n\\end{document}\n['sage-native-execute', 'latex', '\\\\nonstopmode', '\\\\input{sage.tex}']\n['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']\nThis is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)\nentering extended mode\nLaTeX2e <2009/09/24>\nBabel ...\n...\nOverfull \\hbox (138.51622pt too wide) detected at line 119\n[]\n[1]\nOverfull \\vbox (677.07953pt too high) has occurred while \\output is active [2] (./sage.aux) )\n(see the transcript file for additional information)\nOutput written on sage.dvi (2 pages, 35212 bytes).\nTranscript written on sage.log.\nThis is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson\nGPL Ghostscript 8.70: Unrecoverable error, exit code 1\n...\nGPL Ghostscript 8.70: Unrecoverable error, exit code 1\nAn error occurred.\nThis is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009) (format=latex 2011.4.19)  15 NOV 2012 23:59\nentering extended mode\n...\n...\n...\n...\n...\nOverfull \\hbox (138.51622pt too wide) detected at line 119 [] []\n[1] Overfull \\vbox (677.07953pt too high) has occurred while \\output is active []\n...\n...\nOutput written on sage.dvi (2 pages, 35212 bytes).\n\nLatex error\nsage: \n```\n",
    "created_at": "2012-11-15T23:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166723",
    "user": "slabbe"
}
```

> If you run `view(G, debug=True)`, you should get more information about the error.

In a working example, relevant part of the log is below. So if I understand correctly, the command view is first trying the path tex -> dvi -> png, if some error occurs, then tries dvi -> ps -> pdf. And now I understand why it is so slow when it works::


```
sage: sage: G.set_latex_options(format='dot2tex', prog='neato')
sage: view(G, debug=True)
\documentclass{article}
...
\begin{document}
...
\end{document}
['sage-native-execute', 'latex', '\\nonstopmode', '\\input{sage.tex}']
['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)
entering extended mode
LaTeX2e <2009/09/24>
Babel ...
...
Output written on sage.dvi (1 page, 32420 bytes).
Transcript written on sage.log.
This is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
...
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
bad dvi file; running dvips and ps2pdf instead...
['sage-native-execute', 'dvips', 'sage.dvi']
['sage-native-execute', 'ps2pdf', 'sage.ps']
This is dvips(k) 5.98 Copyright 2009 Radical Eye Software (www.radicaleye.com)
' TeX output 2012.11.16:0002' -> sage.ps
...
viewer: "sage-open"
sage: 
```


And, now the log of the non working example is below. There are some Overfull vbox and hbox during the latex -> dvi phase so that the next dvi -> png ends with an error and thus does not try "running dvips and ps2pdf instead..." as above :


```
sage: sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, debug=True)
\documentclass{article}
...
\begin{document}
...
\end{document}
['sage-native-execute', 'latex', '\\nonstopmode', '\\input{sage.tex}']
['sage-native-execute', 'dvipng', '--picky', '-q', '-T', 'tight', '-D', '150', 'sage.dvi', '-o', 'sage.png']
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009)
entering extended mode
LaTeX2e <2009/09/24>
Babel ...
...
Overfull \hbox (138.51622pt too wide) detected at line 119
[]
[1]
Overfull \vbox (677.07953pt too high) has occurred while \output is active [2] (./sage.aux) )
(see the transcript file for additional information)
Output written on sage.dvi (2 pages, 35212 bytes).
Transcript written on sage.log.
This is dvipng 1.12 Copyright 2002-2008 Jan-Ake Larsson
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
...
GPL Ghostscript 8.70: Unrecoverable error, exit code 1
An error occurred.
This is pdfTeX, Version 3.1415926-1.40.10 (TeX Live 2009) (format=latex 2011.4.19)  15 NOV 2012 23:59
entering extended mode
...
...
...
...
...
Overfull \hbox (138.51622pt too wide) detected at line 119 [] []
[1] Overfull \vbox (677.07953pt too high) has occurred while \output is active []
...
...
Output written on sage.dvi (2 pages, 35212 bytes).

Latex error
sage: 
```




---

archive/issue_comments_166724.json:
```json
{
    "body": "Okay, it turns out that the default compilation (try : tex -> dvi -> png, except: dvi -> ps -> pdf) which doesn't like overfull vbox and hbox can be changed using the `engine` option. Thus,\n\n\n```\nsage: G.set_latex_options(format='dot2tex', prog='dot')\nsage: view(G, engine='pdflatex')\n```\n\n\nand\n\n\n```\nsage: G.set_latex_options(format='dot2tex', prog='circo')\nsage: view(G, engine='pdflatex')\n```\n\n\nboth compile fine and give pdf files with clear overfull vbox and hbox. And, one can see the complete graphs by using `tightpage=True`:\n\n\n```\nsage: G.set_latex_options(format='dot2tex', prog='dot')\nsage: view(G, engine='pdflatex', tightpage=True)\nsage: G.set_latex_options(format='dot2tex', prog='circo')\nsage: view(G, engine='pdflatex', tightpage=True)\n```\n",
    "created_at": "2012-11-16T00:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166724",
    "user": "slabbe"
}
```

Okay, it turns out that the default compilation (try : tex -> dvi -> png, except: dvi -> ps -> pdf) which doesn't like overfull vbox and hbox can be changed using the `engine` option. Thus,


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, engine='pdflatex')
```


and


```
sage: G.set_latex_options(format='dot2tex', prog='circo')
sage: view(G, engine='pdflatex')
```


both compile fine and give pdf files with clear overfull vbox and hbox. And, one can see the complete graphs by using `tightpage=True`:


```
sage: G.set_latex_options(format='dot2tex', prog='dot')
sage: view(G, engine='pdflatex', tightpage=True)
sage: G.set_latex_options(format='dot2tex', prog='circo')
sage: view(G, engine='pdflatex', tightpage=True)
```




---

archive/issue_comments_166725.json:
```json
{
    "body": "So before closing this ticket, I ask the following question:\n\nWhy is the default compilation of the command view doing (try : tex -> dvi -> png, except: dvi -> ps -> pdf) ? In which case is it better to do (tex -> dvi -> png) or (tex -> dvi -> ps -> pdf) rather then simply (tex -> pdf) ?\n\nIt has been a long time since I have seen pstricks code around here... and I would like \n\n\n```\nview(G)\n```\n\n\nto just work.",
    "created_at": "2012-11-16T00:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166725",
    "user": "slabbe"
}
```

So before closing this ticket, I ask the following question:

Why is the default compilation of the command view doing (try : tex -> dvi -> png, except: dvi -> ps -> pdf) ? In which case is it better to do (tex -> dvi -> png) or (tex -> dvi -> ps -> pdf) rather then simply (tex -> pdf) ?

It has been a long time since I have seen pstricks code around here... and I would like 


```
view(G)
```


to just work.



---

archive/issue_comments_166726.json:
```json
{
    "body": "At first sight, I am also in favor of switching to pdflatex as default engine.",
    "created_at": "2013-03-11T18:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166726",
    "user": "nthiery"
}
```

At first sight, I am also in favor of switching to pdflatex as default engine.



---

archive/issue_comments_166727.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> At first sight, I am also in favor of switching to pdflatex as default engine.\n\nSounds okay to me.",
    "created_at": "2013-03-11T18:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166727",
    "user": "jhpalmieri"
}
```

Replying to [comment:7 nthiery]:
> At first sight, I am also in favor of switching to pdflatex as default engine.

Sounds okay to me.



---

archive/issue_comments_166728.json:
```json
{
    "body": "tested on sage-5.7.beta4",
    "created_at": "2013-04-02T15:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166728",
    "user": "slabbe"
}
```

tested on sage-5.7.beta4



---

archive/issue_comments_166729.json:
```json
{
    "body": "Attachment [trac_13713_engine_pdflatex-sl.patch](tarball://root/attachments/some-uuid/ticket13713/trac_13713_engine_pdflatex-sl.patch) by slabbe created at 2013-04-02 15:37:39",
    "created_at": "2013-04-02T15:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166729",
    "user": "slabbe"
}
```

Attachment [trac_13713_engine_pdflatex-sl.patch](tarball://root/attachments/some-uuid/ticket13713/trac_13713_engine_pdflatex-sl.patch) by slabbe created at 2013-04-02 15:37:39



---

archive/issue_comments_166730.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-02T15:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166730",
    "user": "slabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_166731.json:
```json
{
    "body": "I'm happy with the main patch. I think it requires some modifications to the documentation in the `latex_examples` class, so I've attached a referee patch to deal with that.",
    "created_at": "2013-04-02T18:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166731",
    "user": "jhpalmieri"
}
```

I'm happy with the main patch. I think it requires some modifications to the documentation in the `latex_examples` class, so I've attached a referee patch to deal with that.



---

archive/issue_comments_166732.json:
```json
{
    "body": "Attachment [trac_13713-examples-jhp.patch](tarball://root/attachments/some-uuid/ticket13713/trac_13713-examples-jhp.patch) by tscrim created at 2013-04-02 18:59:03\n\nFor what it's worth, I was getting the \"latex error\" on just using view with 'latex' after I did some updatings (even doing something as simple as `view(2)`). However with the 'pdflatex', things are working again, so I think this is a good switch to make.",
    "created_at": "2013-04-02T18:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166732",
    "user": "tscrim"
}
```

Attachment [trac_13713-examples-jhp.patch](tarball://root/attachments/some-uuid/ticket13713/trac_13713-examples-jhp.patch) by tscrim created at 2013-04-02 18:59:03

For what it's worth, I was getting the "latex error" on just using view with 'latex' after I did some updatings (even doing something as simple as `view(2)`). However with the 'pdflatex', things are working again, so I think this is a good switch to make.



---

archive/issue_comments_166733.json:
```json
{
    "body": "Don't forget to indicate which patch(es) need to be applied.",
    "created_at": "2013-04-03T07:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166733",
    "user": "jdemeyer"
}
```

Don't forget to indicate which patch(es) need to be applied.



---

archive/issue_comments_166734.json:
```json
{
    "body": "Changing component from packages: optional to graphics.",
    "created_at": "2013-04-03T07:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166734",
    "user": "jdemeyer"
}
```

Changing component from packages: optional to graphics.



---

archive/issue_comments_166735.json:
```json
{
    "body": "There are 5 tests failing on the patchbot, but do not seem related to this ticket :\n\n\n```\nsage -t sage/interfaces/expect.py  # 1 doctest failed\nsage -t sage/interacts/debugger.py  # 8 doctests failed\nsage -t doc/en/prep/Intro-Tutorial.rst  # Killed due to kill signal\nsage -t sage/modules/free_module_homspace.py  # Killed due to kill signal\nsage -t sage/graphs/generators/world_map.py  # Killed due to kill signal\n```\n",
    "created_at": "2013-04-03T09:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166735",
    "user": "slabbe"
}
```

There are 5 tests failing on the patchbot, but do not seem related to this ticket :


```
sage -t sage/interfaces/expect.py  # 1 doctest failed
sage -t sage/interacts/debugger.py  # 8 doctests failed
sage -t doc/en/prep/Intro-Tutorial.rst  # Killed due to kill signal
sage -t sage/modules/free_module_homspace.py  # Killed due to kill signal
sage -t sage/graphs/generators/world_map.py  # Killed due to kill signal
```




---

archive/issue_comments_166736.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-08T22:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166736",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166737.json:
```json
{
    "body": "Everything looks good to me.",
    "created_at": "2013-04-08T22:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166737",
    "user": "tscrim"
}
```

Everything looks good to me.



---

archive/issue_comments_166738.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-13T13:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13509#issuecomment-166738",
    "user": "jdemeyer"
}
```

Resolution: fixed
