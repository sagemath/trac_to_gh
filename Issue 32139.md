# Issue 32139: arb.h in arb/ on Fedora 35

Issue created by migration from https://trac.sagemath.org/ticket/32376

Original creator: dimpase

Original creation time: 2021-08-14 11:14:03

CC:  mjo mkoeppe @jamesjer

Fedora 35 puts `arb.h` in arb/ subdirectory.
This means this has to be dealt in some way, if we want to use arb system library.


---

Comment by dimpase created at 2021-08-14 11:14:27

do we already have such a case?


---

Comment by mkoeppe created at 2021-08-14 16:17:20

This is not new in Fedora 35. According to "blame" on https://src.fedoraproject.org/rpms/arb/blob/rawhide/f/arb.spec, this change happened in 2015. Currently we do not seem to accept system `arb` on any Fedora release (on older releases, the prerequisite FLINT is too old.)

Is any of the packages that use `arb` prepared to find headers in Fedora's install location?


---

Comment by dimpase created at 2021-08-14 17:04:00

Replying to [comment:2 mkoeppe]:

> Is any of the packages that use `arb` prepared to find headers in Fedora's install location? 
it's only `symengine`, apart from `sagelib`, that lists `arb` as a dependency.

And no, `symengine` can't find `arb` there, I get cmake erroring out:

```
...
-- Found ECM: /usr/lib64/libecm.so  
-- Found FLINT: /usr/lib64/libflint.so  
CMake Error at /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
  Could NOT find ARB (missing: ARB_INCLUDE_DIRS)
Call Stack (most recent call first):
  /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:594 (_FPHSA_FAILURE_MESSAGE)
  cmake/FindARB.cmake:11 (find_package_handle_standard_args)
  CMakeLists.txt:328 (find_package)


-- Configuring incomplete, errors occurred!
```



---

Comment by dimpase created at 2021-08-14 17:09:23

I opened https://github.com/symengine/symengine/issues/1815


---

Comment by mkoeppe created at 2021-08-14 17:20:16

Also `e_antic` (optional) has a dependency on `arb`


---

Comment by mjo created at 2021-08-14 17:23:07

Not Our Problem if distros want to break their packages. Nothing is going to look for the arb headers in an "arb" subdirectory, because that's not where they go. Fedora should add `/usr/include/arb` to their compilers' search paths if they're going to put things there.


---

Comment by mkoeppe created at 2021-08-14 17:30:28

That's why we're reporting it to upstream, which is in charge of deciding how to deal with this.


---

Comment by mjo created at 2021-08-14 21:01:29

What upstream? Fedora is the only place it should be fixed.

Reporting it to anyone else will only mislead them into doing new stupid things to work around the first stupid thing. (This is how we have so many packages that manually check /usr/lib and find the wrong library on multilib systems.)


---

Comment by mkoeppe created at 2021-08-14 21:53:42

In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.

Also please note, Michael, that distribution package maintainers usually do their work in good faith and within the constraints of the distribution's policy. I don't know the specifics for this decision in the Fedora package, but there *is* an obvious problem in upstream `arb` that it probably addresses -- `arb` installs lots of headerfiles flat in `$prefix/include` -- and not all are nicely namespaced by a prefix (`arb_....h`): There are headers such as `dirichlet.h`, `bernoulli.h`, `partitions.h`, ... This is something that should be addressed by upstream `arb`. I don't know if an attempt has been made to discuss this installation scheme with the upstream author.


---

Comment by mjo created at 2021-08-15 01:39:02

Replying to [comment:9 mkoeppe]:
> In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.

Why? They **must not** do anything about it, or else they'll introduce incorrect behavior into their build systems. The only correct thing they could reasonably do is tell their Fedora users to do what Fedora already should have done, and put `-I/usr/include/arb` in `CPPFLAGS`.
