# Issue 32139: arb.h in arb/ on Fedora 35

archive/issues_032139.json:
```json
{
    "body": "CC:  mjo mkoeppe @jamesjer\n\nFedora 35 puts `arb.h` in arb/ subdirectory.\nThis means this has to be dealt in some way, if we want to use arb system library.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32376\n\n",
    "created_at": "2021-08-14T11:14:03Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "title": "arb.h in arb/ on Fedora 35",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32139",
    "user": "dimpase"
}
```
CC:  mjo mkoeppe @jamesjer

Fedora 35 puts `arb.h` in arb/ subdirectory.
This means this has to be dealt in some way, if we want to use arb system library.

Issue created by migration from https://trac.sagemath.org/ticket/32376





---

archive/issue_comments_459010.json:
```json
{
    "body": "do we already have such a case?",
    "created_at": "2021-08-14T11:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459010",
    "user": "dimpase"
}
```

do we already have such a case?



---

archive/issue_comments_459011.json:
```json
{
    "body": "This is not new in Fedora 35. According to \"blame\" on https://src.fedoraproject.org/rpms/arb/blob/rawhide/f/arb.spec, this change happened in 2015. Currently we do not seem to accept system `arb` on any Fedora release (on older releases, the prerequisite FLINT is too old.)\n\nIs any of the packages that use `arb` prepared to find headers in Fedora's install location?",
    "created_at": "2021-08-14T16:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459011",
    "user": "mkoeppe"
}
```

This is not new in Fedora 35. According to "blame" on https://src.fedoraproject.org/rpms/arb/blob/rawhide/f/arb.spec, this change happened in 2015. Currently we do not seem to accept system `arb` on any Fedora release (on older releases, the prerequisite FLINT is too old.)

Is any of the packages that use `arb` prepared to find headers in Fedora's install location?



---

archive/issue_comments_459012.json:
```json
{
    "body": "Replying to [comment:2 mkoeppe]:\n\n> Is any of the packages that use `arb` prepared to find headers in Fedora's install location? \nit's only `symengine`, apart from `sagelib`, that lists `arb` as a dependency.\n\nAnd no, `symengine` can't find `arb` there, I get cmake erroring out:\n\n```\n...\n-- Found ECM: /usr/lib64/libecm.so  \n-- Found FLINT: /usr/lib64/libflint.so  \nCMake Error at /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:230 (message):\n  Could NOT find ARB (missing: ARB_INCLUDE_DIRS)\nCall Stack (most recent call first):\n  /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:594 (_FPHSA_FAILURE_MESSAGE)\n  cmake/FindARB.cmake:11 (find_package_handle_standard_args)\n  CMakeLists.txt:328 (find_package)\n\n\n-- Configuring incomplete, errors occurred!\n```\n",
    "created_at": "2021-08-14T17:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459012",
    "user": "dimpase"
}
```

Replying to [comment:2 mkoeppe]:

> Is any of the packages that use `arb` prepared to find headers in Fedora's install location? 
it's only `symengine`, apart from `sagelib`, that lists `arb` as a dependency.

And no, `symengine` can't find `arb` there, I get cmake erroring out:

```
...
-- Found ECM: /usr/lib64/libecm.so  
-- Found FLINT: /usr/lib64/libflint.so  
CMake Error at /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
  Could NOT find ARB (missing: ARB_INCLUDE_DIRS)
Call Stack (most recent call first):
  /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:594 (_FPHSA_FAILURE_MESSAGE)
  cmake/FindARB.cmake:11 (find_package_handle_standard_args)
  CMakeLists.txt:328 (find_package)


-- Configuring incomplete, errors occurred!
```




---

archive/issue_comments_459013.json:
```json
{
    "body": "I opened https://github.com/symengine/symengine/issues/1815",
    "created_at": "2021-08-14T17:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459013",
    "user": "dimpase"
}
```

I opened https://github.com/symengine/symengine/issues/1815



---

archive/issue_comments_459014.json:
```json
{
    "body": "Also `e_antic` (optional) has a dependency on `arb`",
    "created_at": "2021-08-14T17:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459014",
    "user": "mkoeppe"
}
```

Also `e_antic` (optional) has a dependency on `arb`



---

archive/issue_comments_459015.json:
```json
{
    "body": "Not Our Problem if distros want to break their packages. Nothing is going to look for the arb headers in an \"arb\" subdirectory, because that's not where they go. Fedora should add `/usr/include/arb` to their compilers' search paths if they're going to put things there.",
    "created_at": "2021-08-14T17:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459015",
    "user": "mjo"
}
```

Not Our Problem if distros want to break their packages. Nothing is going to look for the arb headers in an "arb" subdirectory, because that's not where they go. Fedora should add `/usr/include/arb` to their compilers' search paths if they're going to put things there.



---

archive/issue_comments_459016.json:
```json
{
    "body": "That's why we're reporting it to upstream, which is in charge of deciding how to deal with this.",
    "created_at": "2021-08-14T17:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459016",
    "user": "mkoeppe"
}
```

That's why we're reporting it to upstream, which is in charge of deciding how to deal with this.



---

archive/issue_comments_459017.json:
```json
{
    "body": "What upstream? Fedora is the only place it should be fixed.\n\nReporting it to anyone else will only mislead them into doing new stupid things to work around the first stupid thing. (This is how we have so many packages that manually check /usr/lib and find the wrong library on multilib systems.)",
    "created_at": "2021-08-14T21:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459017",
    "user": "mjo"
}
```

What upstream? Fedora is the only place it should be fixed.

Reporting it to anyone else will only mislead them into doing new stupid things to work around the first stupid thing. (This is how we have so many packages that manually check /usr/lib and find the wrong library on multilib systems.)



---

archive/issue_comments_459018.json:
```json
{
    "body": "In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.\n\nAlso please note, Michael, that distribution package maintainers usually do their work in good faith and within the constraints of the distribution's policy. I don't know the specifics for this decision in the Fedora package, but there *is* an obvious problem in upstream `arb` that it probably addresses -- `arb` installs lots of headerfiles flat in `$prefix/include` -- and not all are nicely namespaced by a prefix (`arb_....h`): There are headers such as `dirichlet.h`, `bernoulli.h`, `partitions.h`, ... This is something that should be addressed by upstream `arb`. I don't know if an attempt has been made to discuss this installation scheme with the upstream author.",
    "created_at": "2021-08-14T21:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459018",
    "user": "mkoeppe"
}
```

In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.

Also please note, Michael, that distribution package maintainers usually do their work in good faith and within the constraints of the distribution's policy. I don't know the specifics for this decision in the Fedora package, but there *is* an obvious problem in upstream `arb` that it probably addresses -- `arb` installs lots of headerfiles flat in `$prefix/include` -- and not all are nicely namespaced by a prefix (`arb_....h`): There are headers such as `dirichlet.h`, `bernoulli.h`, `partitions.h`, ... This is something that should be addressed by upstream `arb`. I don't know if an attempt has been made to discuss this installation scheme with the upstream author.



---

archive/issue_comments_459019.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.\n\nWhy? They **must not** do anything about it, or else they'll introduce incorrect behavior into their build systems. The only correct thing they could reasonably do is tell their Fedora users to do what Fedora already should have done, and put `-I/usr/include/arb` in `CPPFLAGS`.",
    "created_at": "2021-08-15T01:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32139#issuecomment-459019",
    "user": "mjo"
}
```

Replying to [comment:9 mkoeppe]:
> In case it was not clear, I referred to the upstreams of the packages that depend on the `arb` headers: `symengine` and `e_antic`. The maintainers of these packages do have a valid interest in knowing about this issue.

Why? They **must not** do anything about it, or else they'll introduce incorrect behavior into their build systems. The only correct thing they could reasonably do is tell their Fedora users to do what Fedora already should have done, and put `-I/usr/include/arb` in `CPPFLAGS`.
