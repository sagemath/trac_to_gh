# Issue 17139: Cleanup subgraphsearch to avoid crashes

Issue created by migration from https://trac.sagemath.org/ticket/17376

Original creator: ncohen

Original creation time: 2014-11-21 16:08:45

CC:  dcoudert dimpase jmantysalo vdelecroix simon tscrim

The SubgraphSearch code crashes from time to time when you Ctrl+C it during its memory allocation instructions.

This patch cleans the code a bit so that all allocations happen in one place, before the actual code is run. And so `__dealloc__` only frees the memory that has been allocated, even if the code was interrupted.

Basically, we avoid crashed only with simple code cleaning.

1) In order to produce the crash, run this and CTRL+C it immediately:


```
graphs.CompleteMultipartiteGraph([20,20,20,20]).subgraph_search(graphs.CompleteGraph(5))
```


Do it several times in a row if necessary.

2) The code could use a rewrite with bitsets. It would be faster and lighter in memory, but there is already a pretty similar code in `needs_review` at #17309 and I fear that it may take time before it is reviewed. So I will wait for this before reimplementing SubgraphSearch.


---

Comment by ncohen created at 2014-11-21 16:09:30

Changing status from new to needs_review.


---

Comment by git created at 2014-11-21 16:09:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-11-21 16:11:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dcoudert created at 2014-11-24 02:40:55

I tried the patch multiple times and got no crash, while without the patch I can get a segfault.

Install OK, long tests OK => positive review.

David.
PS: I'm changing the patch from "graphics" to "graph theory". It seems more appropriate.


---

Comment by dcoudert created at 2014-11-24 02:40:55

Changing component from graphics to graph theory.


---

Comment by dcoudert created at 2014-11-24 02:41:12

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-11-24 03:13:53

YOooooooooo !

> PS: I'm changing the patch from "graphics" to "graph theory". It seems more appropriate.

Oh, right.

And thanks for the review !

Nathann


---

Comment by vbraun created at 2014-11-24 16:00:26

Resolution: fixed
