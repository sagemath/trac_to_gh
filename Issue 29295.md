# Issue 29295: cygwin: Fix spkg-configure.m4 for iconv

Issue created by migration from https://trac.sagemath.org/ticket/29532

Original creator: mkoeppe

Original creation time: 2020-04-19 13:40:58

CC:  embray mjo dimpase

Follow-up from #27823 (spkg-configure.m4 for iconv), comment 46:

  It seems that, at least on Cygwin, AM_ICONV will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at #include <iconv.h>).

  For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways. But maybe this still needs to be checked for somehow...

Indeed this needs fixing:

```
configure:21635: g++ -std=gnu++11 -o conftest.exe -g -O2    conftest.cpp -lglpk -lreadline -lcurl -lbz2 -lflint -lmpfr -lgmp -lm  -lntl -liconv >&5
conftest.cpp:68:10: fatal error: iconv.h: No such file or directory
   68 | #include <iconv.h>
      |          ^~~~~~~~~
compilation terminated.
...

configure:21645: result: no, consider installing GNU libiconv
## ------------------------------------------------------ ##
## Checking whether SageMath should install SPKG iconv... ##
## ------------------------------------------------------ ##
configure:21940: will use system package and not install SPKG iconv
## ---------------------------------------------------- ##


```



  


---

Comment by dimpase created at 2020-04-19 13:58:16

hmm, so you are not running ./bootstrap on Cygwin?


---

Comment by dimpase created at 2020-04-19 14:02:16

note that spkg-install says 

```
    echo "iconv will be installed as the operating system is Cygwin, HP-UX or Solaris."
    echo "These systems either lack iconv, or do not have a sufficiently capable"
```


Is this no longer true for Cygwin?


---

Comment by mkoeppe created at 2020-04-19 14:03:19

Gettext is installed, bootstrap worked.


---

Comment by mkoeppe created at 2020-04-19 15:17:25

New commits:


---

Comment by mkoeppe created at 2020-04-19 15:31:22

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-04-19 15:45:56

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-04-19 15:45:56

OK, good catch.


---

Comment by mkoeppe created at 2020-04-19 15:48:11

Thanks!


---

Comment by vbraun created at 2020-04-22 20:52:44

Resolution: fixed
