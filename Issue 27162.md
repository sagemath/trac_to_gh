# Issue 27162: Expected ValueError when calling set_vertex()

Issue created by migration from https://trac.sagemath.org/ticket/27399

Original creator: @Rithesh17

Original creation time: 2019-03-02 18:46:47

This is the issue discussed in the comments section of the ticket [https://trac.sagemath.org/ticket/14708](https://trac.sagemath.org/ticket/14708):



```
sage: g = Graph()
sage: g.set_vertex('foo', 'bar')
sage: g.get_vertices()
{}
```

We should have expected a ValueError in the `set_vertex()` method. Also, on continuing,



```
sage: g.add_vertex('foo')
sage: g.get_vertices()
{'foo': 'bar'}
```

Which shouldn't have happened


---

Comment by @Rithesh17 created at 2019-03-02 18:54:42

New commits:


---

Comment by @Rithesh17 created at 2019-03-02 18:54:42

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-03-02 20:44:52

The branch is not clean, but it is mixed up with another branch.


---

Comment by @Rithesh17 created at 2019-03-02 21:14:45

New commits:


---

Comment by @Rithesh17 created at 2019-03-02 21:14:45

Set assignee to @Rithesh17.


---

Comment by dcoudert created at 2019-03-03 15:29:00

Welcome to Sagemath!

The following changes are needed in your patch:

- don't use `not self._backend.has_vertex(vertex)` but `not self.has_vertex(vertex)` or `vertex not in self`
- the error message is too long. You can reduce it as in method `delete_vertex`.
- the error message is for vertex 4 in the doctest, not 1
so you must do:

```diff
-            ValueError: vertex (1) not in the graph.
-            Please use add_vertex() method to add the vertex to the graph before setting it to the object.
+            ValueError: vertex (4) not in the graph
```

and

```diff
-        if not self._backend.has_vertex(vertex):
-            raise ValueError('vertex (%s) not in the graph.\nPlease use add_vertex() method to add the vertex to the graph before setting it to the object.'%str(vertex))
+        if vertex not in self:
+            raise ValueError('vertex (%s) not in the graph'%str(vertex))
```


---

To check that the changes you do are OK, you must run the doctests using for instance

```
sage -btp --long src/sage/graphs/generic_graph.py
```



---

Comment by @Rithesh17 created at 2019-03-03 19:10:50

Thank you for the review. I have adopted all the suggestions provided.

I ran the doctests and this was the output:

```
Running doctests with ID 2019-03-04-00-34-10-23cf6891.
Git branch: set_vertex-mod
Using --optional=dochtml,gfortran,memlimit,mpir,python2,sage
Doctesting 1 file using 4 threads.
sage -t --long src/sage/graphs/generic_graph.py
    [3288 tests, 37.88 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 38.8 seconds
    cpu time: 32.1 seconds
    cumulative wall time: 37.9 seconds

```

----
New commits:


---

Comment by dcoudert created at 2019-03-04 09:56:55

A minor issue: remove the `.` at the end of `'vertex (%s) not in the graph.'` and of course in the doctest.

This is [PEP8](https://www.python.org/dev/peps/pep-0008/).


---

Comment by git created at 2019-03-04 10:44:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-05 12:28:48

Further small remarks:


```diff
-            sage: T.set_vertex(4, graphs.DodecahedralGraph())
+            sage: T.set_vertex(4, 'foo')
```

There is no need to build the graph here as we just want to show that it is not possible to set label of a non existing vertex. Running all doctests is long, so when we can illustrate an issue with a smaller/faster example, it's always better.


```diff
-            raise ValueError('vertex (%s) not in the graph'%str(vertex))
+            raise ValueError('vertex (%s) not in the graph' % str(vertex))
```

this is also PEP8.


---

Comment by git created at 2019-03-05 13:55:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-06 17:30:41

For me this patch is good to go.


---

Comment by dcoudert created at 2019-03-06 17:30:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-07 19:26:51

Resolution: fixed
