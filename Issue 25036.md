# Issue 25036: Unprefixed libGAP interface

archive/issues_025036.json:
```json
{
    "body": "CC:  @slel\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25273\n\n",
    "created_at": "2018-05-01T09:43:19Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Unprefixed libGAP interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25036",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @slel



Issue created by migration from https://trac.sagemath.org/ticket/25273





---

archive/issue_comments_351934.json:
```json
{
    "body": "Does this mean that `libgap.Blah` syntax won't be needed, too?",
    "created_at": "2018-05-01T09:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351934",
    "user": "https://github.com/dimpase"
}
```

Does this mean that `libgap.Blah` syntax won't be needed, too?



---

archive/issue_comments_351935.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-01T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351935",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_351936.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-01T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351936",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_351937.json:
```json
{
    "body": "In libgap.pyx you have\n\n```\nThe ``foobar`` methods are\nthe original GAP methods simply prefixed with the string\n````.\n```\n\nwhich looks like an artefact of non-interactive editing...\n\nI presume there is no prefix any more.",
    "created_at": "2018-05-01T11:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351937",
    "user": "https://github.com/dimpase"
}
```

In libgap.pyx you have

```
The ``foobar`` methods are
the original GAP methods simply prefixed with the string
````.
```

which looks like an artefact of non-interactive editing...

I presume there is no prefix any more.



---

archive/issue_comments_351938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-01T11:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-01T11:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351940.json:
```json
{
    "body": "The only `libGAP_` things left are `libGAP_True/False`. There are also `libgap_`-things, but this is another story. The docs about `libGAP_` ought to be more explicit about this.",
    "created_at": "2018-05-01T11:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351940",
    "user": "https://github.com/dimpase"
}
```

The only `libGAP_` things left are `libGAP_True/False`. There are also `libgap_`-things, but this is another story. The docs about `libGAP_` ought to be more explicit about this.



---

archive/issue_comments_351941.json:
```json
{
    "body": "I'm not sure anymore that we should do this because it's not at all clear what upstream GAP is going to do. Now that merging libGAP upstream looks further away, they might be convinced to change (some of) these names.",
    "created_at": "2018-05-02T07:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351941",
    "user": "https://github.com/jdemeyer"
}
```

I'm not sure anymore that we should do this because it's not at all clear what upstream GAP is going to do. Now that merging libGAP upstream looks further away, they might be convinced to change (some of) these names.



---

archive/issue_comments_351942.json:
```json
{
    "body": "But it's just two names that need special treatment - I don't see why you want to postpone this.\n\nAs well, I think that if one tells GAP people that a couple of macros need to be renamed to be able to inter-operate with Python etc, they would be happy with such a change.",
    "created_at": "2018-05-02T10:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351942",
    "user": "https://github.com/dimpase"
}
```

But it's just two names that need special treatment - I don't see why you want to postpone this.

As well, I think that if one tells GAP people that a couple of macros need to be renamed to be able to inter-operate with Python etc, they would be happy with such a change.



---

archive/issue_comments_351943.json:
```json
{
    "body": "rebased over the latest beta, fixed bug. We could perhaps finish and merge this, as an intermediate step towards #22626.\n----\nNew commits:",
    "created_at": "2018-09-18T09:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351943",
    "user": "https://github.com/dimpase"
}
```

rebased over the latest beta, fixed bug. We could perhaps finish and merge this, as an intermediate step towards #22626.
----
New commits:



---

archive/issue_comments_351944.json:
```json
{
    "body": "Is it clear what upstream's policy on the naming and prefixing is? See #22626#comment:66",
    "created_at": "2018-09-18T09:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351944",
    "user": "https://github.com/jdemeyer"
}
```

Is it clear what upstream's policy on the naming and prefixing is? See #22626#comment:66



---

archive/issue_comments_351945.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-09-18T09:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351945",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_351946.json:
```json
{
    "body": "Well, GAP people are reluctant to change names; in particular T_NUM is merely a C enum, and we don't even need to use it (certainly not with the new, since GAP 4.9, functions).",
    "created_at": "2018-09-18T12:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351946",
    "user": "https://github.com/dimpase"
}
```

Well, GAP people are reluctant to change names; in particular T_NUM is merely a C enum, and we don't even need to use it (certainly not with the new, since GAP 4.9, functions).



---

archive/issue_comments_351947.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> Well, GAP people are reluctant to change names\n\nDid anybody actually try to convince them? Ideally, they would change their names to reduce changes of name collisions. Since this is C, this matters regardless of whether we actually *use* those names.",
    "created_at": "2018-09-18T15:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351947",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 dimpase]:
> Well, GAP people are reluctant to change names

Did anybody actually try to convince them? Ideally, they would change their names to reduce changes of name collisions. Since this is C, this matters regardless of whether we actually *use* those names.



---

archive/issue_comments_351948.json:
```json
{
    "body": "I am at https://www.gapdays.de/gapdays2018-fall/ and spent some time yesterday and today talking about this issue with Markus and Max. They say that as they have no control over their packages, changing API is tricky. \n\nIf you can come up with a convincing argument, please do, I'd do my best to communicate it while here. Are there any name clashes in exported symbols in their new libgap-API? IMHO there are none.",
    "created_at": "2018-09-18T16:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351948",
    "user": "https://github.com/dimpase"
}
```

I am at https://www.gapdays.de/gapdays2018-fall/ and spent some time yesterday and today talking about this issue with Markus and Max. They say that as they have no control over their packages, changing API is tricky. 

If you can come up with a convincing argument, please do, I'd do my best to communicate it while here. Are there any name clashes in exported symbols in their new libgap-API? IMHO there are none.



---

archive/issue_comments_351949.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-10-04T12:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351949",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_351950.json:
```json
{
    "body": "While we at it, are `libgap_enter()` and `libgap_exit()` needed? GAP people told me that they are not. I tried removing them and running ptestlong (with gap_packages installed for a better coverage), no errors (apart from the expected one in libs/gap/util.pyx).\n\nI suggest we proceed with this ticket - it does not look as if #22626 will be ready soon, perhaps we should rather try rebasing libGAP to GAP 4.10, which looks a less daunting task now than a total replacement with \"native\" GAP's libgap.",
    "created_at": "2018-10-04T12:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351950",
    "user": "https://github.com/dimpase"
}
```

While we at it, are `libgap_enter()` and `libgap_exit()` needed? GAP people told me that they are not. I tried removing them and running ptestlong (with gap_packages installed for a better coverage), no errors (apart from the expected one in libs/gap/util.pyx).

I suggest we proceed with this ticket - it does not look as if #22626 will be ready soon, perhaps we should rather try rebasing libGAP to GAP 4.10, which looks a less daunting task now than a total replacement with "native" GAP's libgap.



---

archive/issue_comments_351951.json:
```json
{
    "body": "(sorry I seem to have missed your previous comment)\n\nReplying to [comment:21 dimpase]:\n> They say that as they have no control over their packages, changing API is tricky.\n\nChanging API should not be tricky if you add a compatibility layer changing the new names to the old names. My proposal should literally be 100% API-compatible for GAP packages.\n\n> Are there any name clashes in exported symbols in their new libgap-API?\n\nI haven't tried the new libgap-API, so I cannot tell. But it's not only about exported symbols, it's about anything defined in the GAP header files. In particular `T_INT` is problematic that way (assuming that it still exists in the new libgap-API).",
    "created_at": "2018-10-04T12:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351951",
    "user": "https://github.com/jdemeyer"
}
```

(sorry I seem to have missed your previous comment)

Replying to [comment:21 dimpase]:
> They say that as they have no control over their packages, changing API is tricky.

Changing API should not be tricky if you add a compatibility layer changing the new names to the old names. My proposal should literally be 100% API-compatible for GAP packages.

> Are there any name clashes in exported symbols in their new libgap-API?

I haven't tried the new libgap-API, so I cannot tell. But it's not only about exported symbols, it's about anything defined in the GAP header files. In particular `T_INT` is problematic that way (assuming that it still exists in the new libgap-API).



---

archive/issue_comments_351952.json:
```json
{
    "body": "What I did on #22626 is just simply not use `T_INT` (this is a constant equal to 0), I just used 0 instead.",
    "created_at": "2018-10-04T12:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351952",
    "user": "https://github.com/dimpase"
}
```

What I did on #22626 is just simply not use `T_INT` (this is a constant equal to 0), I just used 0 instead.



---

archive/issue_comments_351953.json:
```json
{
    "body": "Replying to [comment:24 dimpase]:\n> What I did on #22626 is just simply not use `T_INT` (this is a constant equal to 0), I just used 0 instead.\n\nFirst of all, I'd consider that very bad style. For example, what if GAP suddenly decided to change the value of `T_INT`?\n\nSecond, the question is not whether `T_INT` is *used*. The question is whether it's defined in a header file.",
    "created_at": "2018-10-04T12:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351953",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:24 dimpase]:
> What I did on #22626 is just simply not use `T_INT` (this is a constant equal to 0), I just used 0 instead.

First of all, I'd consider that very bad style. For example, what if GAP suddenly decided to change the value of `T_INT`?

Second, the question is not whether `T_INT` is *used*. The question is whether it's defined in a header file.



---

archive/issue_comments_351954.json:
```json
{
    "body": "`T_INT` won't change \"suddenly\", for sure, as these `T_*` things are heavily used in GAP's low-level type system.\n\nAs I said, as I didn't understand the problem fully (and still don't), I wasn't able to convince GAP devs that something needs to be done about it.",
    "created_at": "2018-10-04T12:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351954",
    "user": "https://github.com/dimpase"
}
```

`T_INT` won't change "suddenly", for sure, as these `T_*` things are heavily used in GAP's low-level type system.

As I said, as I didn't understand the problem fully (and still don't), I wasn't able to convince GAP devs that something needs to be done about it.



---

archive/issue_comments_351955.json:
```json
{
    "body": "For the record, in GAP `T_INT` is a part of  `enum` type `TNUM` in `src/objects.h`, i.e. one sees there \n\n```\nenum TNUM {\n ....\n T_INT;\n ...\n};\n```\n",
    "created_at": "2018-10-04T12:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351955",
    "user": "https://github.com/dimpase"
}
```

For the record, in GAP `T_INT` is a part of  `enum` type `TNUM` in `src/objects.h`, i.e. one sees there 

```
enum TNUM {
 ....
 T_INT;
 ...
};
```




---

archive/issue_comments_351956.json:
```json
{
    "body": "The problem is that the Python header `structmember.h` file also does\n\n```\n#define T_INT       1\n```\n\n\nYou can hope that the GAP headers won't be included after that Python header, but that seems dangerous to me especially because we cannot really control the code that Cython generates.",
    "created_at": "2018-10-04T13:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351956",
    "user": "https://github.com/jdemeyer"
}
```

The problem is that the Python header `structmember.h` file also does

```
#define T_INT       1
```


You can hope that the GAP headers won't be included after that Python header, but that seems dangerous to me especially because we cannot really control the code that Cython generates.



---

archive/issue_comments_351957.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> The problem is that the Python header `structmember.h` file also does\n> {{{\n> #define T_INT       1\n> }}}\n> \n> You can hope that the GAP headers won't be included after that Python header, but that seems dangerous to me especially because we cannot really control the code that Cython generates.\n\nIf GAP's headers are included after Python's, you'd get a compilation error. Indeed\n\n```\n#include <stdio.h>\n#define T_INT 42\nenum TNUM { T_INT, T_FOO };\nint main(){\n    int i;\n    i = T_INT;\n    printf(\"%d\\n\", i);\n    return 0;}\n```\n\nand\n\n```\n$ gcc t.c \nt.c:2:15: error: expected identifier before numeric constant\n #define T_INT 42\n               ^~\nt.c:3:13: note: in expansion of macro \u2018T_INT\u2019\n enum TNUM { T_INT, T_FOO };\n             ^~~~~\n```\n\n\nBut if you swap the inclusion order, then yes, everything compiles, and overrides the enum. Indeed\n\n```\n#include <stdio.h>\nenum TNUM { T_INT, T_FOO };\n#define T_INT 42\nint main(){\n    int i;\n    i = T_INT;\n    printf(\"%d\\n\", i);\n    return 0;}\n```\n\ncompiles and outputs 42.\n\nNot sure whether and how this could affect libgap...",
    "created_at": "2018-10-04T13:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351957",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:28 jdemeyer]:
> The problem is that the Python header `structmember.h` file also does
> {{{
> #define T_INT       1
> }}}
> 
> You can hope that the GAP headers won't be included after that Python header, but that seems dangerous to me especially because we cannot really control the code that Cython generates.

If GAP's headers are included after Python's, you'd get a compilation error. Indeed

```
#include <stdio.h>
#define T_INT 42
enum TNUM { T_INT, T_FOO };
int main(){
    int i;
    i = T_INT;
    printf("%d\n", i);
    return 0;}
```

and

```
$ gcc t.c 
t.c:2:15: error: expected identifier before numeric constant
 #define T_INT 42
               ^~
t.c:3:13: note: in expansion of macro ‘T_INT’
 enum TNUM { T_INT, T_FOO };
             ^~~~~
```


But if you swap the inclusion order, then yes, everything compiles, and overrides the enum. Indeed

```
#include <stdio.h>
enum TNUM { T_INT, T_FOO };
#define T_INT 42
int main(){
    int i;
    i = T_INT;
    printf("%d\n", i);
    return 0;}
```

compiles and outputs 42.

Not sure whether and how this could affect libgap...



---

archive/issue_comments_351958.json:
```json
{
    "body": "I'd rather not make the compilation of Sage depend on a specific order of includes.",
    "created_at": "2018-10-04T13:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351958",
    "user": "https://github.com/jdemeyer"
}
```

I'd rather not make the compilation of Sage depend on a specific order of includes.



---

archive/issue_comments_351959.json:
```json
{
    "body": "I'd be more concerned about Python's `#define` shadowing `T_INT`: a compilation error is much easier to deal with than a vague runtime one...\n\nI'd also say that here Python is the bad guy, not using `enum` for its `T_*` constants.\n(I'd say it should rather be using `enum`, no?)",
    "created_at": "2018-10-04T15:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351959",
    "user": "https://github.com/dimpase"
}
```

I'd be more concerned about Python's `#define` shadowing `T_INT`: a compilation error is much easier to deal with than a vague runtime one...

I'd also say that here Python is the bad guy, not using `enum` for its `T_*` constants.
(I'd say it should rather be using `enum`, no?)



---

archive/issue_comments_351960.json:
```json
{
    "body": "Obsolete by #22626",
    "created_at": "2019-01-11T14:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351960",
    "user": "https://github.com/jdemeyer"
}
```

Obsolete by #22626



---

archive/issue_comments_351961.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2019-01-11T14:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25036#issuecomment-351961",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: invalid



---

archive/issue_events_023336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-11T14:30:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25036",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25036#event-23336"
}
```
