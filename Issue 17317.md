# Issue 17317: Unable to substitute univariant Laurent polynomial into usual polynomial

archive/issues_017317.json:
```json
{
    "body": "Assignee: @tscrim\n\nKeywords: Laurent polynomial, substitution\n\nWe can do\n\n```\nsage: R.<q> = QQ[]\nsage: p = q^4 + q^2 - 2*q + 3\nsage: L.<x,y> = LaurentPolynomialRing(QQ)\nsage: p(q=x)\nx^4 + x^2 - 2*x + 3\n```\n\nbut if we change things to a univariate Laurent polynomial ring, we get:\n\n```\nsage: L.<x> = LaurentPolynomialRing(QQ)\nsage: p(q=x)\n...\nIndexError: tuple index out of range\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17554\n\n",
    "created_at": "2014-12-27T06:35:17Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Unable to substitute univariant Laurent polynomial into usual polynomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17317",
    "user": "https://github.com/tscrim"
}
```
Assignee: @tscrim

Keywords: Laurent polynomial, substitution

We can do

```
sage: R.<q> = QQ[]
sage: p = q^4 + q^2 - 2*q + 3
sage: L.<x,y> = LaurentPolynomialRing(QQ)
sage: p(q=x)
x^4 + x^2 - 2*x + 3
```

but if we change things to a univariate Laurent polynomial ring, we get:

```
sage: L.<x> = LaurentPolynomialRing(QQ)
sage: p(q=x)
...
IndexError: tuple index out of range
```


Issue created by migration from https://trac.sagemath.org/ticket/17554





---

archive/issue_comments_230400.json:
```json
{
    "body": "The following seems to be the issue\n\n```\nsage: p() #evaluating with no arguments should probably be a no-op\nq^4 + q^2 - 2*q + 3\nsage: x() #but it raises an error for laurent polynomials\nIndexError: tuple index out of range\n```\n\nThe problem gets triggered by `sage.rings.polynomial.polynomial_element.Polynomial.__call__`, which for keyword arguments does:\n\n```\n          P = self.parent()\n            name = P.variable_name()\n            if name in kwds:\n                if len(x) > 0:\n                    raise ValueError(\"must not specify both a keyword and positional argument\")\n                a = self(kwds[name])\n                del kwds[name]\n                try:\n                    return a(**kwds)\n                except TypeError:\n                    return a\n```\n\nThe command `return a(**kwds)` fails, because it's effectively `a(*(),**{})`. Furthermore, it fails with an `IndexError` which doesn't get caught.\n\nThe better solution is probably to amend laurentpolynomial's `__call__` to do the right thing. Presently, it doesn't support keyword arguments at all and it expects non-empty arguments. Its implementation is\n\n```\n    def __call__(self, *x):\n        if isinstance(x[0], tuple):\n            x = x[0]\n        return self.__u(x) * (x[0]**self.__n)\n```\n\nwhich expects there is at least one argument and doesn't handle keyword arguments.",
    "created_at": "2014-12-27T07:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230400",
    "user": "https://github.com/nbruin"
}
```

The following seems to be the issue

```
sage: p() #evaluating with no arguments should probably be a no-op
q^4 + q^2 - 2*q + 3
sage: x() #but it raises an error for laurent polynomials
IndexError: tuple index out of range
```

The problem gets triggered by `sage.rings.polynomial.polynomial_element.Polynomial.__call__`, which for keyword arguments does:

```
          P = self.parent()
            name = P.variable_name()
            if name in kwds:
                if len(x) > 0:
                    raise ValueError("must not specify both a keyword and positional argument")
                a = self(kwds[name])
                del kwds[name]
                try:
                    return a(**kwds)
                except TypeError:
                    return a
```

The command `return a(**kwds)` fails, because it's effectively `a(*(),**{})`. Furthermore, it fails with an `IndexError` which doesn't get caught.

The better solution is probably to amend laurentpolynomial's `__call__` to do the right thing. Presently, it doesn't support keyword arguments at all and it expects non-empty arguments. Its implementation is

```
    def __call__(self, *x):
        if isinstance(x[0], tuple):
            x = x[0]
        return self.__u(x) * (x[0]**self.__n)
```

which expects there is at least one argument and doesn't handle keyword arguments.



---

archive/issue_comments_230401.json:
```json
{
    "body": "This seems to work now (8.0.b11)",
    "created_at": "2017-06-22T07:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230401",
    "user": "https://github.com/fchapoton"
}
```

This seems to work now (8.0.b11)



---

archive/issue_comments_230402.json:
```json
{
    "body": "However, there are still serious issues with `__call__` that I am recycling this ticket for (sorry it completely fell off my radar). The attached branch makes the behavior standard with the rest of polynomials Sage (with some mild cleanup of the multivariate `__call__`).\n----\nNew commits:",
    "created_at": "2017-06-24T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230402",
    "user": "https://github.com/tscrim"
}
```

However, there are still serious issues with `__call__` that I am recycling this ticket for (sorry it completely fell off my radar). The attached branch makes the behavior standard with the rest of polynomials Sage (with some mild cleanup of the multivariate `__call__`).
----
New commits:



---

archive/issue_comments_230403.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-24T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230403",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230404.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-24T07:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230404",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230405.json:
```json
{
    "body": "ok, let it be. Thanks",
    "created_at": "2017-06-24T07:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230405",
    "user": "https://github.com/fchapoton"
}
```

ok, let it be. Thanks



---

archive/issue_events_016708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-25T15:45:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17317#event-16708"
}
```



---

archive/issue_comments_230406.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-25T15:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17317#issuecomment-230406",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
