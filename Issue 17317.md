# Issue 17317: Unable to substitute univariant Laurent polynomial into usual polynomial

Issue created by migration from https://trac.sagemath.org/ticket/17554

Original creator: tscrim

Original creation time: 2014-12-27 06:35:17

Assignee: tscrim

Keywords: Laurent polynomial, substitution

We can do

```
sage: R.<q> = QQ[]
sage: p = q^4 + q^2 - 2*q + 3
sage: L.<x,y> = LaurentPolynomialRing(QQ)
sage: p(q=x)
x^4 + x^2 - 2*x + 3
```

but if we change things to a univariate Laurent polynomial ring, we get:

```
sage: L.<x> = LaurentPolynomialRing(QQ)
sage: p(q=x)
...
IndexError: tuple index out of range
```



---

Comment by nbruin created at 2014-12-27 07:19:37

The following seems to be the issue

```
sage: p() #evaluating with no arguments should probably be a no-op
q^4 + q^2 - 2*q + 3
sage: x() #but it raises an error for laurent polynomials
IndexError: tuple index out of range
```

The problem gets triggered by `sage.rings.polynomial.polynomial_element.Polynomial.__call__`, which for keyword arguments does:

```
          P = self.parent()
            name = P.variable_name()
            if name in kwds:
                if len(x) > 0:
                    raise ValueError("must not specify both a keyword and positional argument")
                a = self(kwds[name])
                del kwds[name]
                try:
                    return a(**kwds)
                except TypeError:
                    return a
```

The command `return a(**kwds)` fails, because it's effectively `a(*(),**{})`. Furthermore, it fails with an `IndexError` which doesn't get caught.

The better solution is probably to amend laurentpolynomial's `__call__` to do the right thing. Presently, it doesn't support keyword arguments at all and it expects non-empty arguments. Its implementation is

```
    def __call__(self, *x):
        if isinstance(x[0], tuple):
            x = x[0]
        return self.__u(x) * (x[0]**self.__n)
```

which expects there is at least one argument and doesn't handle keyword arguments.


---

Comment by chapoton created at 2017-06-22 07:45:19

This seems to work now (8.0.b11)


---

Comment by tscrim created at 2017-06-24 00:22:59

However, there are still serious issues with `__call__` that I am recycling this ticket for (sorry it completely fell off my radar). The attached branch makes the behavior standard with the rest of polynomials Sage (with some mild cleanup of the multivariate `__call__`).
----
New commits:


---

Comment by tscrim created at 2017-06-24 00:22:59

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-06-24 07:33:40

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-06-24 07:33:40

ok, let it be. Thanks


---

Comment by vbraun created at 2017-06-25 15:45:26

Resolution: fixed
