# Issue 11347: global_minimal_model function is sometimes wrong over number fields, when input model isn't integral.

archive/issues_011175.json:
```json
{
    "body": " The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage `global_minimal_model` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  \n\n```\nsage: K.<g> = NumberField(x^2 - x - 1)\nsage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E\nElliptic Curve defined by y^2 = x^3 + (-1)*x^2 + 12 over Number Field in g with defining polynomial x^2 - x - 1\nsage: E.conductor().factor()\n(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\nsage: E.discriminant().factor()\n(-1) * 2^12 * 3 * (-2*g + 1)^2\n```\nAgain, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  \n\n```\nsage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E\nElliptic Curve defined by y^2 + x*y + y = x^3 + x^2 over Number Field in g with defining polynomial x^2 - x - 1\nsage: E.conductor().factor()\n(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\nsage: E.discriminant().factor()\n(-1) * 3 * (-2*g + 1)^2\n```\n\nYes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!\n\nAssignee: @JohnCremona\n\nResolution: fixed\n\nAuthor: William Stein\n\nReviewer: John Cremona\n\nMerged: sage-4.7.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11347\n\n",
    "closed_at": "2011-05-31T17:06:31Z",
    "created_at": "2011-05-17T18:58:31Z",
    "labels": [
        "component: elliptic curves",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "global_minimal_model function is sometimes wrong over number fields, when input model isn't integral.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11347",
    "user": "https://github.com/williamstein"
}
```
 The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage `global_minimal_model` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  

```
sage: K.<g> = NumberField(x^2 - x - 1)
sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E
Elliptic Curve defined by y^2 = x^3 + (-1)*x^2 + 12 over Number Field in g with defining polynomial x^2 - x - 1
sage: E.conductor().factor()
(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
sage: E.discriminant().factor()
(-1) * 2^12 * 3 * (-2*g + 1)^2
```
Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  

```
sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E
Elliptic Curve defined by y^2 + x*y + y = x^3 + x^2 over Number Field in g with defining polynomial x^2 - x - 1
sage: E.conductor().factor()
(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
sage: E.discriminant().factor()
(-1) * 3 * (-2*g + 1)^2
```

Yes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!

Assignee: @JohnCremona

Resolution: fixed

Author: William Stein

Reviewer: John Cremona

Merged: sage-4.7.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11347





---

archive/issue_comments_129207.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \\`global_minimal_model\\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  \n+ The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \\`global_minimal_model\\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  \n \n \\`\\`\\`\n sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E\n@@ -8,7 +8,7 @@\n sage: E.discriminant().factor()\n (-1) * 2^12 * 3 * (-2*g + 1)^2\n \\`\\`\\`\n-Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.\n+Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  \n \n \\`\\`\\`\n sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E\n@@ -19,6 +19,8 @@\n (-1) * 3 * (-2*g + 1)^2\n \\`\\`\\`\n \n+Yes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/11347\n```\n",
    "created_at": "2011-05-17T19:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129207",
    "user": "https://github.com/williamstein"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \`global_minimal_model\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  
+ The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \`global_minimal_model\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  
 
 \`\`\`
 sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E
@@ -8,7 +8,7 @@
 sage: E.discriminant().factor()
 (-1) * 2^12 * 3 * (-2*g + 1)^2
 \`\`\`
-Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.
+Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  
 
 \`\`\`
 sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E
@@ -19,6 +19,8 @@
 (-1) * 3 * (-2*g + 1)^2
 \`\`\`
 
+Yes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/11347
```




---

archive/issue_comments_129208.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+ The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \\`global_minimal_model\\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  \n \n+\\`\\`\\`\n+sage: K.<g> = NumberField(x^2 - x - 1)\n+sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E\n+Elliptic Curve defined by y^2 = x^3 + (-1)*x^2 + 12 over Number Field in g with defining polynomial x^2 - x - 1\n+sage: E.conductor().factor()\n+(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\n+sage: E.discriminant().factor()\n+(-1) * 2^12 * 3 * (-2*g + 1)^2\n+\\`\\`\\`\n+Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  \n+\n+\\`\\`\\`\n+sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E\n+Elliptic Curve defined by y^2 + x*y + y = x^3 + x^2 over Number Field in g with defining polynomial x^2 - x - 1\n+sage: E.conductor().factor()\n+(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\n+sage: E.discriminant().factor()\n+(-1) * 3 * (-2*g + 1)^2\n+\\`\\`\\`\n+\n+Yes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!\n \n Comment: 1\n \n```\n",
    "created_at": "2011-05-17T19:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129208",
    "user": "https://github.com/williamstein"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+ The discriminant and conductor of a global minimal model must be divisible by the same primes.  However the following code (extracted from examples computed by Joanna Gaski), illustrates the Sage \`global_minimal_model\` function producing a model that can't possibly be a global minimal model (since the conductor and discriminant are divisible by different primes).  
 
+\`\`\`
+sage: K.<g> = NumberField(x^2 - x - 1)
+sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).global_minimal_model(); E
+Elliptic Curve defined by y^2 = x^3 + (-1)*x^2 + 12 over Number Field in g with defining polynomial x^2 - x - 1
+sage: E.conductor().factor()
+(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
+sage: E.discriminant().factor()
+(-1) * 2^12 * 3 * (-2*g + 1)^2
+\`\`\`
+Again, the bug is that the global_minimal_model function is assuming that its input is integral, and the fix is easy, probably.  
+
+\`\`\`
+sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864]).integral_model().global_minimal_model(); E
+Elliptic Curve defined by y^2 + x*y + y = x^3 + x^2 over Number Field in g with defining polynomial x^2 - x - 1
+sage: E.conductor().factor()
+(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
+sage: E.discriminant().factor()
+(-1) * 3 * (-2*g + 1)^2
+\`\`\`
+
+Yes, inspecting the source code shows a *typo* related to this, i.e., somebody defines E to be a global integral model, then forgets to actually use E!
 
 Comment: 1
 
```




---

archive/issue_comments_129209.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_11347.patch](tarball://root/attachments/some-uuid/ticket11347/trac_11347.patch) by @williamstein created at 2011-05-17 19:14:13",
    "created_at": "2011-05-17T19:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129209",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>Attachment [trac_11347.patch](tarball://root/attachments/some-uuid/ticket11347/trac_11347.patch) by @williamstein created at 2011-05-17 19:14:13



---

archive/issue_comments_129210.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-17T19:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129210",
    "user": "https://github.com/williamstein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129211.json:
```json
{
    "body": "<a id='comment:4'></a>Patch looks good to me -- the typo could well have been mine...\n\nTesting now.",
    "created_at": "2011-05-18T11:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129211",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>Patch looks good to me -- the typo could well have been mine...

Testing now.



---

archive/issue_comments_129212.json:
```json
{
    "body": "<a id='comment:5'></a>Applies fine to 4.7.rc1, tests pass.",
    "created_at": "2011-05-18T11:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129212",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>Applies fine to 4.7.rc1, tests pass.



---

archive/issue_comments_129213.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-05-18T11:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129213",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129214.json:
```json
{
    "body": "<a id='comment:6'></a>See the comment (#4) at #11346.",
    "created_at": "2011-05-18T11:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129214",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>See the comment (#4) at #11346.



---

archive/issue_events_029431.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-31T17:06:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11347#event-29431"
}
```



---

archive/issue_comments_129215.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-31T17:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11347#issuecomment-129215",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
