# Issue 11790: `sage --sh -c ...` shouldn't print [that many] messages

archive/issues_011618.json:
```json
{
    "body": "Currently, we have\n\n```sh\n$ ./sage --sh -c \"echo Hello\"\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nHello\nExited Sage subshell.\n$ \n```\nwhich is IMHO odd.\n\nAnd it's inconvenient if one wants to further process the output of some command run in a Sage subshell.\n\nIn `spkg/bin/sage`, we have:\n\n```sh\nif [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; then\n    # AUTHORS:\n    #   Carl Witty and William Stein: initial version\n    #   Craig Citro: add options for not loading profile\n    cd \"$CUR\"\n    shift\n    echo \"\"\n    echo \"Starting subshell with Sage environment variables set.\"\n    echo \"Be sure to exit when you are done and do not do anything\"\n    echo \"with other copies of Sage!\"\n    echo \"\"\n    SHELL_NAME=`basename $SHELL`\n    echo \"Bypassing shell configuration files ...\"\n    echo\n\n    ...\n\n    $SHELL_NAME $SHELL_OPTS \"$@\"\n\n    status=$?\n    echo \"Exited Sage subshell.\"\n    exit $status\nfi\n```\n\nSo I'd propose to change `sage` to not print *any* messages if there are any further arguments to `sage --sh`.\n\nAlternatively, all (or a reduced set of) messages should at least go to `stderr` instead of `stdout`, perhaps regardless of whether `-c` was specified or not.\n\nIn addition, if we dropped the \"`Exited Sage subshell.`\" (at least in the case of `-c`), we could (or should) also use\n\n```sh\n    exec $SHELL_NAME $SHELL_OPTS \"$@\"\n```\n\n(Actually, `exec` should be used in a couple of Sage commands which don't need any \"post-processing\", e.g. by `sage`.)\n\n**Apply** [attachment:11790_sage_sh.patch] and [attachment:11790_review.patch] to the SAGE_ROOT repository.\n\n**CC:**  @gvol\n\n**Keywords:** subshell commands sage-sage environment batch mode stdout\n\n**Reviewer:** Jeroen Demeyer, John Palmieri\n\n**Author:** John Palmieri, Jeroen Demeyer\n\n**Merged:** sage-5.0.beta9\n\n**Dependencies:** #12647\n\nIssue created by migration from https://trac.sagemath.org/ticket/11790\n\n",
    "closed_at": "2012-03-21T22:05:42Z",
    "created_at": "2011-09-11T15:26:48Z",
    "labels": [
        "component: scripts",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "`sage --sh -c ...` shouldn't print [that many] messages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11790",
    "user": "https://github.com/nexttime"
}
```
Currently, we have

```sh
$ ./sage --sh -c "echo Hello"

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

Hello
Exited Sage subshell.
$ 
```
which is IMHO odd.

And it's inconvenient if one wants to further process the output of some command run in a Sage subshell.

In `spkg/bin/sage`, we have:

```sh
if [ "$1" = '-sh'  -o "$1" = '--sh' ]; then
    # AUTHORS:
    #   Carl Witty and William Stein: initial version
    #   Craig Citro: add options for not loading profile
    cd "$CUR"
    shift
    echo ""
    echo "Starting subshell with Sage environment variables set."
    echo "Be sure to exit when you are done and do not do anything"
    echo "with other copies of Sage!"
    echo ""
    SHELL_NAME=`basename $SHELL`
    echo "Bypassing shell configuration files ..."
    echo

    ...

    $SHELL_NAME $SHELL_OPTS "$@"

    status=$?
    echo "Exited Sage subshell."
    exit $status
fi
```

So I'd propose to change `sage` to not print *any* messages if there are any further arguments to `sage --sh`.

Alternatively, all (or a reduced set of) messages should at least go to `stderr` instead of `stdout`, perhaps regardless of whether `-c` was specified or not.

In addition, if we dropped the "`Exited Sage subshell.`" (at least in the case of `-c`), we could (or should) also use

```sh
    exec $SHELL_NAME $SHELL_OPTS "$@"
```

(Actually, `exec` should be used in a couple of Sage commands which don't need any "post-processing", e.g. by `sage`.)

**Apply** [attachment:11790_sage_sh.patch] and [attachment:11790_review.patch] to the SAGE_ROOT repository.

**CC:**  @gvol

**Keywords:** subshell commands sage-sage environment batch mode stdout

**Reviewer:** Jeroen Demeyer, John Palmieri

**Author:** John Palmieri, Jeroen Demeyer

**Merged:** sage-5.0.beta9

**Dependencies:** #12647

Issue created by migration from https://trac.sagemath.org/ticket/11790





---

archive/issue_comments_154510.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere's a first attempt at a patch.  This also fixes some of incorrect prompts (taken from #10822 -- the patch there will need to be rebased on this one if this one gets done first).",
    "created_at": "2011-09-13T01:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154510",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
Here's a first attempt at a patch.  This also fixes some of incorrect prompts (taken from #10822 -- the patch there will need to be rebased on this one if this one gets done first).



---

archive/issue_comments_154511.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2011-09-13T01:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154511",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_comments_154512.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-09-13T01:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154512",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_154513.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew patch rebased w.r.t. #11866.",
    "created_at": "2011-09-28T20:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154513",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
New patch rebased w.r.t. #11866.



---

archive/issue_comments_154514.json:
```json
{
    "body": "**Dependencies:** #11866",
    "created_at": "2011-09-28T20:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154514",
    "user": "https://github.com/jhpalmieri"
}
```

**Dependencies:** #11866



---

archive/issue_comments_154515.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks ok, but I cannot tell (or test right now) whether all prompts, and shell options regarding not executing rc files are correct.\n\nThe code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .\n\nAlso, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).",
    "created_at": "2011-09-28T21:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154515",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Looks ok, but I cannot tell (or test right now) whether all prompts, and shell options regarding not executing rc files are correct.

The code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .

Also, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).



---

archive/issue_comments_154516.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [leif](#comment%3A3):\n> Looks ok, but I cannot tell (or test right now) whether all prompts, and shell options regarding not executing rc files are correct.\n\n\nOn my Mac, I was able to run \"chsh\" and then open up new terminal windows and run \"sage -sh\" to test the prompts.\n\n> The code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .\n\n\nWell, if you're running \"sage --sh CMD\", it should matter whether you're running \"bash\" or \"bash --norc\", right?  The `case ... esac` stuff sets shell options like `--norc` in addition to the prompt, and I think we want this.\n\n> Also, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).\n\n\nSo are you suggesting not checking the status at all? Like this:\n\n```diff\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -518,8 +518,8 @@ PS1=\"SAGE_ROOT=${SAGE_ROOT}\n     esac\n     if [ \"$1\" = '-c' ]; then\n        exec $SHELL_NAME $SHELL_OPTS \"$@\"\n-       status=$?\n-       exit $status\n+       echo \"An error seems to occurred.\" 1>&2\n+       exit 1\n     fi\n     # -c is not the first option, so print informative messages...\n     echo \"\" 1>&2\n```\nI could probably come up with a more cryptic message, though.",
    "created_at": "2011-09-28T21:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154516",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Replying to [leif](#comment%3A3):
> Looks ok, but I cannot tell (or test right now) whether all prompts, and shell options regarding not executing rc files are correct.


On my Mac, I was able to run "chsh" and then open up new terminal windows and run "sage -sh" to test the prompts.

> The code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .


Well, if you're running "sage --sh CMD", it should matter whether you're running "bash" or "bash --norc", right?  The `case ... esac` stuff sets shell options like `--norc` in addition to the prompt, and I think we want this.

> Also, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).


So are you suggesting not checking the status at all? Like this:

```diff
diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -518,8 +518,8 @@ PS1="SAGE_ROOT=${SAGE_ROOT}
     esac
     if [ "$1" = '-c' ]; then
        exec $SHELL_NAME $SHELL_OPTS "$@"
-       status=$?
-       exit $status
+       echo "An error seems to occurred." 1>&2
+       exit 1
     fi
     # -c is not the first option, so print informative messages...
     echo "" 1>&2
```
I could probably come up with a more cryptic message, though.



---

archive/issue_comments_154517.json:
```json
{
    "body": "<a id='comment:5'></a>\ns/to occurred/to have occurred/, obviously.",
    "created_at": "2011-09-28T21:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154517",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
s/to occurred/to have occurred/, obviously.



---

archive/issue_comments_154518.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> Replying to [leif](#comment%3A3):\n> > The code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .\n\n> \n> Well, if you're running \"sage --sh CMD\", it should matter whether you're running \"bash\" or \"bash --norc\", right?  The `case ... esac` stuff sets shell options like `--norc` in addition to the prompt, and I think we want this.\n\n\nAny shell called with `-c` **must not** execute any rc files.\n\n\n\n\n> > Also, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).\n\n> \n> So are you suggesting not checking the status at all? Like this:\n\n\n```diff\n diff --git a/sage-sage b/sage-sage\n --- a/sage-sage\n +++ b/sage-sage\n @@ -518,8 +518,8 @@ PS1=\"SAGE_ROOT=${SAGE_ROOT}\n      esac\n      if [ \"$1\" = '-c' ]; then\n         exec $SHELL_NAME $SHELL_OPTS \"$@\"\n -       status=$?\n -       exit $status\n +       echo \"An error seems to occurred.\" 1>&2\n +       exit 1\n      fi\n      # -c is not the first option, so print informative messages...\n      echo \"\" 1>&2\n```\n> I could probably come up with a more cryptic message, though.\n\n\n:)\n\nI rather meant something like\n\n```sh\n    ...\n    SHELL_NAME=`basename $SHELL`\n\n    if [ \"$1\" = \"-c\" ]; then\n        exec \"$SHELL_NAME\" \"$@\"\n        # If 'exec' returns, an error occurred:\n        status=$?\n        echo >&2 \"Fatal error: 'exec \\\"$SHELL_NAME\\\" \\\"$@\\\"' failed!\"\n        exit $status # Always non-zero, but return the code the shell gave.\n    fi\n\n    case $SHELL_NAME in\n    ...\n```\n\n\n\n\nBtw., any reason to call `$SHELL_NAME` instead of `$SHELL`?\n\nThe latter would IMHO be correct.",
    "created_at": "2011-09-28T21:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154518",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A4):
> Replying to [leif](#comment%3A3):
> > The code testing for `-c` could be moved up, since everything else (in the `case ... esac`) is useless in this case .

> 
> Well, if you're running "sage --sh CMD", it should matter whether you're running "bash" or "bash --norc", right?  The `case ... esac` stuff sets shell options like `--norc` in addition to the prompt, and I think we want this.


Any shell called with `-c` **must not** execute any rc files.




> > Also, if `exec` returns, this means an error, so we could print some according message in this case (although *hopefully*<sup>TM</sup> the shell itself did).

> 
> So are you suggesting not checking the status at all? Like this:


```diff
 diff --git a/sage-sage b/sage-sage
 --- a/sage-sage
 +++ b/sage-sage
 @@ -518,8 +518,8 @@ PS1="SAGE_ROOT=${SAGE_ROOT}
      esac
      if [ "$1" = '-c' ]; then
         exec $SHELL_NAME $SHELL_OPTS "$@"
 -       status=$?
 -       exit $status
 +       echo "An error seems to occurred." 1>&2
 +       exit 1
      fi
      # -c is not the first option, so print informative messages...
      echo "" 1>&2
```
> I could probably come up with a more cryptic message, though.


:)

I rather meant something like

```sh
    ...
    SHELL_NAME=`basename $SHELL`

    if [ "$1" = "-c" ]; then
        exec "$SHELL_NAME" "$@"
        # If 'exec' returns, an error occurred:
        status=$?
        echo >&2 "Fatal error: 'exec \"$SHELL_NAME\" \"$@\"' failed!"
        exit $status # Always non-zero, but return the code the shell gave.
    fi

    case $SHELL_NAME in
    ...
```




Btw., any reason to call `$SHELL_NAME` instead of `$SHELL`?

The latter would IMHO be correct.



---

archive/issue_comments_154519.json:
```json
{
    "body": "<a id='comment:7'></a>\nHere's a new patch.",
    "created_at": "2011-09-29T05:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154519",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Here's a new patch.



---

archive/issue_comments_154520.json:
```json
{
    "body": "scripts repo",
    "created_at": "2011-09-29T05:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154520",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/attachments_015647.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11790-sage-sh.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11790/trac_11790-sage-sh.patch",
    "created_at": "2011-09-29T05:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_154521.json:
```json
{
    "body": "<a id='comment:8'></a>\nBoth `$SHELL` and `$SHELL_NAME` should in principle be quoted... ;-)",
    "created_at": "2011-09-29T05:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154521",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Both `$SHELL` and `$SHELL_NAME` should in principle be quoted... ;-)



---

archive/issue_comments_154522.json:
```json
{
    "body": "<a id='comment:9'></a>\nLike this?\n\n```diff\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -473,7 +473,7 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n     cd \"$CUR\"\n     shift\n     if [ \"$1\" = '-c' ]; then\n-       exec $SHELL \"$@\"\n+       exec \"$SHELL\" \"$@\"\n         # If 'exec' returns, an error occurred:\n         status=$?\n         echo >&2 \"Fatal error: 'exec \\\"$SHELL\\\" \\\"$@\\\"' failed!\"\n@@ -489,8 +489,8 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n     echo \"\" 1>&2\n     # We must start a new shell with no .profile or .bashrc files\n     # processed, so that we know our path is correct\n-    SHELL_NAME=`basename $SHELL`\n-    case $SHELL_NAME in\n+    SHELL_NAME=`basename \"$SHELL\"`\n+    case \"$SHELL_NAME\" in\n         bash)\n             SHELL_OPTS=\" --norc\"\n             PS1=\"SAGE_ROOT=${SAGE_ROOT}\\n(sage subshell) \\h:\\W \\u\\$ \"\n@@ -531,7 +531,7 @@ PS1=\"SAGE_ROOT=${SAGE_ROOT}\n             echo >&2 \"Aborting.\"\n             exit 1\n     esac\n-    $SHELL $SHELL_OPTS \"$@\"\n+    \"$SHELL\" $SHELL_OPTS \"$@\"\n     status=$?\n     echo \"Exited Sage subshell.\" 1>&2\n     exit $status\n```\nLet's make this v2 of the patch.",
    "created_at": "2011-09-29T05:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154522",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Like this?

```diff
diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -473,7 +473,7 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
     cd "$CUR"
     shift
     if [ "$1" = '-c' ]; then
-       exec $SHELL "$@"
+       exec "$SHELL" "$@"
         # If 'exec' returns, an error occurred:
         status=$?
         echo >&2 "Fatal error: 'exec \"$SHELL\" \"$@\"' failed!"
@@ -489,8 +489,8 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
     echo "" 1>&2
     # We must start a new shell with no .profile or .bashrc files
     # processed, so that we know our path is correct
-    SHELL_NAME=`basename $SHELL`
-    case $SHELL_NAME in
+    SHELL_NAME=`basename "$SHELL"`
+    case "$SHELL_NAME" in
         bash)
             SHELL_OPTS=" --norc"
             PS1="SAGE_ROOT=${SAGE_ROOT}\n(sage subshell) \h:\W \u\$ "
@@ -531,7 +531,7 @@ PS1="SAGE_ROOT=${SAGE_ROOT}
             echo >&2 "Aborting."
             exit 1
     esac
-    $SHELL $SHELL_OPTS "$@"
+    "$SHELL" $SHELL_OPTS "$@"
     status=$?
     echo "Exited Sage subshell." 1>&2
     exit $status
```
Let's make this v2 of the patch.



---

archive/attachments_015648.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11790-sage-sh.v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11790/trac_11790-sage-sh.v2.patch",
    "created_at": "2011-09-29T05:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_154523.json:
```json
{
    "body": "scripts repo",
    "created_at": "2011-09-29T05:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154523",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/issue_comments_154524.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> Like this?\n\n\nYep. As a MacOS user, you should be familiar with spaces in filenames... ;-)",
    "created_at": "2011-09-29T05:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154524",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> Like this?


Yep. As a MacOS user, you should be familiar with spaces in filenames... ;-)



---

archive/issue_comments_154525.json:
```json
{
    "body": "<a id='comment:11'></a>\nI would prefer not to special-case `-c` and print the \"informative\" messages only when *no arguments* are given.\n\nSecond, please get rid of the double-line prompt.  I find that so confusing.  No need to print `SAGE_ROOT` on every prompt (maybe print it once in the \"informative\" messages).",
    "created_at": "2011-10-31T12:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154525",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I would prefer not to special-case `-c` and print the "informative" messages only when *no arguments* are given.

Second, please get rid of the double-line prompt.  I find that so confusing.  No need to print `SAGE_ROOT` on every prompt (maybe print it once in the "informative" messages).



---

archive/issue_comments_154526.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-10-31T12:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154526",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_154527.json:
```json
{
    "body": "<a id='comment:12'></a>\nThird, now that you are working on this: it is absolutely wrong to assume that `/bin/sh` supports `--norc`.  I would not make any assumptions at all about which shell is `/bin/sh`, so I would set no options for `sh`.",
    "created_at": "2011-10-31T12:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Third, now that you are working on this: it is absolutely wrong to assume that `/bin/sh` supports `--norc`.  I would not make any assumptions at all about which shell is `/bin/sh`, so I would set no options for `sh`.



---

archive/issue_comments_154528.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2011-10-31T12:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154528",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_154529.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A11):\n> I would prefer not to special-case `-c` and print the \"informative\" messages only when *no arguments* are given.\n> \n> Second, please get rid of the double-line prompt.  I find that so confusing.  No need to print `SAGE_ROOT` on every prompt (maybe print it once in the \"informative\" messages).\n\n\n+N (N>=1)\n\nI always found that annoying, but hesitated to change it since others might argue that it may be helpful to \"less experienced users\"<sup>TM</sup>.\n\n(One reason I hardly ever use the Sage subshell... ;-) )",
    "created_at": "2011-10-31T20:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154529",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A11):
> I would prefer not to special-case `-c` and print the "informative" messages only when *no arguments* are given.
> 
> Second, please get rid of the double-line prompt.  I find that so confusing.  No need to print `SAGE_ROOT` on every prompt (maybe print it once in the "informative" messages).


+N (N>=1)

I always found that annoying, but hesitated to change it since others might argue that it may be helpful to "less experienced users"<sup>TM</sup>.

(One reason I hardly ever use the Sage subshell... ;-) )



---

archive/issue_comments_154530.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jdemeyer](#comment%3A11):\n> I would prefer not to special-case `-c` and print the \"informative\" messages only when *no arguments* are given.\n\n\nWell, other options could be passed such that the shell would still be interactive.\n\nIn that case, the \"informative messages\" should probably still get printed.",
    "created_at": "2011-10-31T20:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154530",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Replying to [jdemeyer](#comment%3A11):
> I would prefer not to special-case `-c` and print the "informative" messages only when *no arguments* are given.


Well, other options could be passed such that the shell would still be interactive.

In that case, the "informative messages" should probably still get printed.



---

archive/issue_comments_154531.json:
```json
{
    "body": "<a id='comment:15'></a>\nI wouldn't mind shortening the prompt to one line, but I'd like to get more feedback, so I asked the question on sage-devel.\n\nIf it is shortened, should we do more to highlight that we're in a subshell?  The following shortens \"(sage subshell)\" to \"(Sage)\" and puts in reverse video.  We could use boldface if reverse video is too obnoxious.\n\n```diff\n\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -490,10 +491,19 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n     # We must start a new shell with no .profile or .bashrc files\n     # processed, so that we know our path is correct\n     SHELL_NAME=`basename \"$SHELL\"`\n+    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then\n+        color_prompt=yes\n+    else\n+        color_prompt=\n+    fi\n     case \"$SHELL_NAME\" in\n         bash)\n             SHELL_OPTS=\" --norc\"\n-            PS1=\"SAGE_ROOT=${SAGE_ROOT}\\n(sage subshell) \\h:\\W \\u\\$ \"\n+            if [ \"$color_prompt\" = yes ] ; then\n+                PS1=\"\\[$(tput rev)\\](Sage)\\[$(tput sgr0)\\] \\h:\\W \\u\\$ \"\n+            else\n+                PS1=\"(Sage) \\h:\\W \\u\\$ \"\n+            fi\n             export PS1\n             ;;\n         csh)\n@@ -504,14 +514,18 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n             ;;\n         ksh)\n             SHELL_OPTS=\" -p\"\n-            PS1=\"SAGE_ROOT=${SAGE_ROOT}\n-(sage subshell) `hostname -s`:\\${PWD##*/} $USER$ \"\n+            if [ \"$color_prompt\" = yes ] ; then\n+                PS1=\"\\[$(tput rev)\\](Sage)\\[$(tput sgr0)\\] `hostname -s`:\\${PWD##*/} $USER$ \"\n+            else\n+                PS1=\"(Sage) `hostname -s`:\\${PWD##*/} $USER$ \"\n+            fi\n             export PS1\n             ;;\n         sh)\n-            SHELL_OPTS=\" --norc\"\n-            PS1=\"SAGE_ROOT=${SAGE_ROOT}\n-(sage subshell) `hostname -s`:\\${PWD##*/} $USER$ \"\n+            # If sh is derived from bash, then the following is okay,\n+            # but we shouldn't assume this.\n+            #SHELL_OPTS=\" --norc\"\n+            PS1=\"(Sage) `hostname -s`:\\${PWD##*/} $USER$ \"\n             export PS1\n             ;;\n         tcsh)\n@@ -521,8 +535,11 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n             SHELL_OPTS=\" -f\"\n             ;;\n         zsh)\n```",
    "created_at": "2011-10-31T21:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154531",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
I wouldn't mind shortening the prompt to one line, but I'd like to get more feedback, so I asked the question on sage-devel.

If it is shortened, should we do more to highlight that we're in a subshell?  The following shortens "(sage subshell)" to "(Sage)" and puts in reverse video.  We could use boldface if reverse video is too obnoxious.

```diff

diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -490,10 +491,19 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
     # We must start a new shell with no .profile or .bashrc files
     # processed, so that we know our path is correct
     SHELL_NAME=`basename "$SHELL"`
+    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
+        color_prompt=yes
+    else
+        color_prompt=
+    fi
     case "$SHELL_NAME" in
         bash)
             SHELL_OPTS=" --norc"
-            PS1="SAGE_ROOT=${SAGE_ROOT}\n(sage subshell) \h:\W \u\$ "
+            if [ "$color_prompt" = yes ] ; then
+                PS1="\[$(tput rev)\](Sage)\[$(tput sgr0)\] \h:\W \u\$ "
+            else
+                PS1="(Sage) \h:\W \u\$ "
+            fi
             export PS1
             ;;
         csh)
@@ -504,14 +514,18 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
             ;;
         ksh)
             SHELL_OPTS=" -p"
-            PS1="SAGE_ROOT=${SAGE_ROOT}
-(sage subshell) `hostname -s`:\${PWD##*/} $USER$ "
+            if [ "$color_prompt" = yes ] ; then
+                PS1="\[$(tput rev)\](Sage)\[$(tput sgr0)\] `hostname -s`:\${PWD##*/} $USER$ "
+            else
+                PS1="(Sage) `hostname -s`:\${PWD##*/} $USER$ "
+            fi
             export PS1
             ;;
         sh)
-            SHELL_OPTS=" --norc"
-            PS1="SAGE_ROOT=${SAGE_ROOT}
-(sage subshell) `hostname -s`:\${PWD##*/} $USER$ "
+            # If sh is derived from bash, then the following is okay,
+            # but we shouldn't assume this.
+            #SHELL_OPTS=" --norc"
+            PS1="(Sage) `hostname -s`:\${PWD##*/} $USER$ "
             export PS1
             ;;
         tcsh)
@@ -521,8 +535,11 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
             SHELL_OPTS=" -f"
             ;;
         zsh)
```



---

archive/issue_comments_154532.json:
```json
{
    "body": "<a id='comment:16'></a>\nSimon King had the interesting suggestion of prepending e.g. \"(sage-sh)\" to the current prompt.  Can we access the current prompt?",
    "created_at": "2011-10-31T21:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154532",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
Simon King had the interesting suggestion of prepending e.g. "(sage-sh)" to the current prompt.  Can we access the current prompt?



---

archive/issue_comments_154533.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jhpalmieri](#comment%3A16):\n> Simon King had the interesting suggestion of prepending e.g. \"(sage-sh)\" to the current prompt.  Can we access the current prompt?\n\n\nWell, `$PS1` is the current prompt.  So you could do\n\n```\nexport PS1=\"(sage-sh) $PS1\"\n```",
    "created_at": "2011-10-31T22:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154533",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [jhpalmieri](#comment%3A16):
> Simon King had the interesting suggestion of prepending e.g. "(sage-sh)" to the current prompt.  Can we access the current prompt?


Well, `$PS1` is the current prompt.  So you could do

```
export PS1="(sage-sh) $PS1"
```



---

archive/issue_comments_154534.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [leif](#comment%3A14):\n> Replying to [jdemeyer](#comment%3A11):\n> > I would prefer not to special-case `-c` and print the \"informative\" messages only when *no arguments* are given.\n\n> \n> Well, other options could be passed such that the shell would still be interactive.\n\n\nOn the other hand, other options (e.g. the name of a script) could be passed such that the shell would *not* be interactive.  I would say that any option passed qualifies as \"advanced usage\" meaning the user knows what he is doing and does not need \"informative\" messages.",
    "created_at": "2011-10-31T22:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154534",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [leif](#comment%3A14):
> Replying to [jdemeyer](#comment%3A11):
> > I would prefer not to special-case `-c` and print the "informative" messages only when *no arguments* are given.

> 
> Well, other options could be passed such that the shell would still be interactive.


On the other hand, other options (e.g. the name of a script) could be passed such that the shell would *not* be interactive.  I would say that any option passed qualifies as "advanced usage" meaning the user knows what he is doing and does not need "informative" messages.



---

archive/issue_comments_154535.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A17):\n> Well, `$PS1` is the current prompt.  So you could do\n\n\nI tried that but it doesn't seem to work: $PS1 is not defined when running sage-sage: add a line `echo \"current prompt is $PS1\"` somewhere.",
    "created_at": "2011-10-31T22:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154535",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A17):
> Well, `$PS1` is the current prompt.  So you could do


I tried that but it doesn't seem to work: $PS1 is not defined when running sage-sage: add a line `echo "current prompt is $PS1"` somewhere.



---

archive/issue_comments_154536.json:
```json
{
    "body": "<a id='comment:20'></a>\nI don't like playing with \"fancy\" prompts.\n\nIf someone needs such, we could support `SAGE_SHELL_PROMPT` or whatever.\n\n(Ceterum censeo we should support `~/.sagerc` [or `$DOT_SAGE/.sagerc` or both], or `~/.sageshrc`, for common environment settings etc., i.e., this should be a shell script which is sourced by `sage-env` if present.)",
    "created_at": "2011-10-31T23:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154536",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
I don't like playing with "fancy" prompts.

If someone needs such, we could support `SAGE_SHELL_PROMPT` or whatever.

(Ceterum censeo we should support `~/.sagerc` [or `$DOT_SAGE/.sagerc` or both], or `~/.sageshrc`, for common environment settings etc., i.e., this should be a shell script which is sourced by `sage-env` if present.)



---

archive/issue_comments_154537.json:
```json
{
    "body": "<a id='comment:21'></a>\nHere is version 3 of the patch.  This implements Leif's idea about ./sage/.sagerc, in a simple-minded way.  It also checks for the environment variable `SAGE_SHPROMPT`.\n\nMy opinion is that the prompt for the Sage shell should indicate **very clearly** that this is a Sage shell, so the default in this patch is for it to start with \"(sage-sh)\" in reverse video.  If you don't like it, you can override it by setting `PS1` in .sagerc or by setting `SAGE_SHPROMPT` anywhere.\n\nThis also doesn't print any warning message or even set the prompt if `sage -sh` is followed by more arguments.  I'm not sure I'm happy about that, in particular the potential lack of a different prompt.",
    "created_at": "2011-11-01T20:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154537",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
Here is version 3 of the patch.  This implements Leif's idea about ./sage/.sagerc, in a simple-minded way.  It also checks for the environment variable `SAGE_SHPROMPT`.

My opinion is that the prompt for the Sage shell should indicate **very clearly** that this is a Sage shell, so the default in this patch is for it to start with "(sage-sh)" in reverse video.  If you don't like it, you can override it by setting `PS1` in .sagerc or by setting `SAGE_SHPROMPT` anywhere.

This also doesn't print any warning message or even set the prompt if `sage -sh` is followed by more arguments.  I'm not sure I'm happy about that, in particular the potential lack of a different prompt.



---

archive/issue_comments_154538.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-11-01T20:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154538",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_154539.json:
```json
{
    "body": "<a id='comment:22'></a>\nOkay, I changed it so it sets the prompt regardless of the number of arguments.",
    "created_at": "2011-11-01T20:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154539",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
Okay, I changed it so it sets the prompt regardless of the number of arguments.



---

archive/attachments_015649.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11790-sage-sh.v3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11790/trac_11790-sage-sh.v3.patch",
    "created_at": "2011-11-01T20:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_154540.json:
```json
{
    "body": "scripts repo",
    "created_at": "2011-11-01T20:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154540",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/issue_comments_154541.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n \n And it's inconvenient if one wants to further process the output of some command run in a Sage subshell.\n \n-In `local/bin/sage-sage`, we have:\n+In `spkg/bin/sage`, we have:\n \n ```sh\n if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; then\n@@ -45,7 +45,7 @@\n fi\n ```\n \n-So I'd propose to change `sage-sage` to not print *any* messages if the first argument to the subshell is `-c`.\n+So I'd propose to change `sage` to not print *any* messages if there are any further arguments to `sage --sh`.\n \n Alternatively, all (or a reduced set of) messages should at least go to `stderr` instead of `stdout`, perhaps regardless of whether `-c` was specified or not.\n \n@@ -55,5 +55,6 @@\n     exec $SHELL_NAME $SHELL_OPTS \"$@\"\n ```\n \n-(Actually, `exec` should be used in a couple of Sage commands which don't need any \"post-processing\", e.g. by `sage-sage`.)\n+(Actually, `exec` should be used in a couple of Sage commands which don't need any \"post-processing\", e.g. by `sage`.)\n \n+**Apply** [attachment:11790_sage_sh.patch] to the SAGE_ROOT repository.\n``````\n",
    "created_at": "2012-03-09T16:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154541",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 
 And it's inconvenient if one wants to further process the output of some command run in a Sage subshell.
 
-In `local/bin/sage-sage`, we have:
+In `spkg/bin/sage`, we have:
 
 ```sh
 if [ "$1" = '-sh'  -o "$1" = '--sh' ]; then
@@ -45,7 +45,7 @@
 fi
 ```
 
-So I'd propose to change `sage-sage` to not print *any* messages if the first argument to the subshell is `-c`.
+So I'd propose to change `sage` to not print *any* messages if there are any further arguments to `sage --sh`.
 
 Alternatively, all (or a reduced set of) messages should at least go to `stderr` instead of `stdout`, perhaps regardless of whether `-c` was specified or not.
 
@@ -55,5 +55,6 @@
     exec $SHELL_NAME $SHELL_OPTS "$@"
 ```
 
-(Actually, `exec` should be used in a couple of Sage commands which don't need any "post-processing", e.g. by `sage-sage`.)
+(Actually, `exec` should be used in a couple of Sage commands which don't need any "post-processing", e.g. by `sage`.)
 
+**Apply** [attachment:11790_sage_sh.patch] to the SAGE_ROOT repository.
``````




---

archive/issue_comments_154542.json:
```json
{
    "body": "**Changing dependencies** from \"#11866\" to \"\".",
    "created_at": "2012-03-09T16:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154542",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#11866" to "".



---

archive/issue_comments_154543.json:
```json
{
    "body": "<a id='comment:26'></a>\nI think adding a `sagerc` file warrants its own ticket: #12647.",
    "created_at": "2012-03-09T20:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154543",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
I think adding a `sagerc` file warrants its own ticket: #12647.



---

archive/issue_comments_154544.json:
```json
{
    "body": "**Dependencies:** #12647",
    "created_at": "2012-03-09T20:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154544",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #12647



---

archive/issue_comments_154545.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-03-09T20:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154545",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_015650.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11790_review.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11790/11790_review.patch",
    "created_at": "2012-03-09T21:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_154546.json:
```json
{
    "body": "",
    "created_at": "2012-03-09T21:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154546",
    "user": "https://github.com/jdemeyer"
}
```





---

archive/issue_comments_154547.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-03-09T21:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154547",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_154548.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -57,4 +57,4 @@\n \n (Actually, `exec` should be used in a couple of Sage commands which don't need any \"post-processing\", e.g. by `sage`.)\n \n-**Apply** [attachment:11790_sage_sh.patch] to the SAGE_ROOT repository.\n+**Apply** [attachment:11790_sage_sh.patch] and [attachment:11790_review.patch] to the SAGE_ROOT repository.\n``````\n",
    "created_at": "2012-03-09T21:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154548",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -57,4 +57,4 @@
 
 (Actually, `exec` should be used in a couple of Sage commands which don't need any "post-processing", e.g. by `sage`.)
 
-**Apply** [attachment:11790_sage_sh.patch] to the SAGE_ROOT repository.
+**Apply** [attachment:11790_sage_sh.patch] and [attachment:11790_review.patch] to the SAGE_ROOT repository.
``````




---

archive/issue_comments_154549.json:
```json
{
    "body": "<a id='comment:29'></a>\nReviewer patch needs review...",
    "created_at": "2012-03-09T21:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154549",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Reviewer patch needs review...



---

archive/issue_comments_154550.json:
```json
{
    "body": "<a id='comment:30'></a>\nAdding a sagerc script (#12637) needs review.",
    "created_at": "2012-03-13T17:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154550",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Adding a sagerc script (#12637) needs review.



---

archive/issue_comments_154551.json:
```json
{
    "body": "<a id='comment:31'></a>\nI meant #12647.",
    "created_at": "2012-03-13T17:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154551",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
I meant #12647.



---

archive/issue_comments_154552.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-03-14T18:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154552",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_154553.json:
```json
{
    "body": "<a id='comment:32'></a>\nThis looks good to me.\n\nRegarding the use of \"exec\", which was suggested by Leif, was in my version of the patch, and is in the current patch: if we want to be able to do something like `sage --norc -c ...` (as in #11932), then we want to be able to delete the temporary `DOTSAGE` directory after the Sage command finishes.  Using \"exec\" prevents this, doesn't it?  So unless I'm misunderstanding and there is a good way to clean things up after \"exec CMD\", we should be wary of overusing \"exec\" in the sage script.\n\nAnyway, I'm willing to give this a positive review.",
    "created_at": "2012-03-14T18:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154553",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
This looks good to me.

Regarding the use of "exec", which was suggested by Leif, was in my version of the patch, and is in the current patch: if we want to be able to do something like `sage --norc -c ...` (as in #11932), then we want to be able to delete the temporary `DOTSAGE` directory after the Sage command finishes.  Using "exec" prevents this, doesn't it?  So unless I'm misunderstanding and there is a good way to clean things up after "exec CMD", we should be wary of overusing "exec" in the sage script.

Anyway, I'm willing to give this a positive review.



---

archive/issue_comments_154554.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, John Palmieri\".",
    "created_at": "2012-03-14T18:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154554",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, John Palmieri".



---

archive/issue_comments_154555.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Jeroen Demeyer\".",
    "created_at": "2012-03-14T18:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154555",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Jeroen Demeyer".



---

archive/issue_comments_154556.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jhpalmieri](#comment%3A32):\n> Regarding the use of \"exec\", which was suggested by Leif, was in my version of the patch, and is in the current patch: if we want to be able to do something like `sage --norc -c ...` (as in #11932), then we want to be able to delete the temporary `DOTSAGE` directory after the Sage command finishes.  Using \"exec\" prevents this, doesn't it?\n\nUsing `exec` **here** doesn't prevent that.  It just means that we cannot implement `--norc` itself using `exec`, which is fine.\n\nExample:\nscriptA does\n\n```\nscriptB\ncleanup\n```\n\nscriptB does\n\n```\nexec scriptC\ncleanup2\n```\n\nThe `exec` in `scriptB` doesn't prevent the `cleanup` in `scriptA`, it only prevents the `cleanup2` in `scriptB`.",
    "created_at": "2012-03-14T19:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154556",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [jhpalmieri](#comment%3A32):
> Regarding the use of "exec", which was suggested by Leif, was in my version of the patch, and is in the current patch: if we want to be able to do something like `sage --norc -c ...` (as in #11932), then we want to be able to delete the temporary `DOTSAGE` directory after the Sage command finishes.  Using "exec" prevents this, doesn't it?

Using `exec` **here** doesn't prevent that.  It just means that we cannot implement `--norc` itself using `exec`, which is fine.

Example:
scriptA does

```
scriptB
cleanup
```

scriptB does

```
exec scriptC
cleanup2
```

The `exec` in `scriptB` doesn't prevent the `cleanup` in `scriptA`, it only prevents the `cleanup2` in `scriptB`.



---

archive/issue_comments_154557.json:
```json
{
    "body": "<a id='comment:34'></a>\nRight, but suppose we do something like this:\n\n```\nif [ \"$1\" = '--norc' -o \"$1\" = '--nodotsage' ]; then\n    export DOT_SAGE=`mktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX`\n    shift\n    sage \"$@\"\n    status=$?\n    rm -rf \"$DOT_SAGE\"\n    exit $status\nfi\n```\nThen if you do `sage --norc --sh ...` (or any other option like `--sh` which uses `exec`), it will never reach the line `rm -rf \"$DOT_SAGE\"`.",
    "created_at": "2012-03-14T20:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154557",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>
Right, but suppose we do something like this:

```
if [ "$1" = '--norc' -o "$1" = '--nodotsage' ]; then
    export DOT_SAGE=`mktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX`
    shift
    sage "$@"
    status=$?
    rm -rf "$DOT_SAGE"
    exit $status
fi
```
Then if you do `sage --norc --sh ...` (or any other option like `--sh` which uses `exec`), it will never reach the line `rm -rf "$DOT_SAGE"`.



---

archive/issue_comments_154558.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jhpalmieri](#comment%3A34):\n> Then if you do `sage --norc --sh ...` (or any other option like `--sh` which uses `exec`), it will never reach the line `rm -rf \"$DOT_SAGE\"`.\n\nThat would be very surprising, are you sure about this?",
    "created_at": "2012-03-14T20:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154558",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [jhpalmieri](#comment%3A34):
> Then if you do `sage --norc --sh ...` (or any other option like `--sh` which uses `exec`), it will never reach the line `rm -rf "$DOT_SAGE"`.

That would be very surprising, are you sure about this?



---

archive/issue_comments_154559.json:
```json
{
    "body": "<a id='comment:36'></a>\nNo, I'm not sure about this - it seems to work the way we want, and as described in [your comment](#comment%3A33). Never mind.",
    "created_at": "2012-03-14T20:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154559",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
No, I'm not sure about this - it seems to work the way we want, and as described in [your comment](#comment%3A33). Never mind.



---

archive/issue_comments_154560.json:
```json
{
    "body": "<a id='comment:37'></a>\nSee #12698 for a sort-of follow-up.",
    "created_at": "2012-03-19T15:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154560",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
See #12698 for a sort-of follow-up.



---

archive/issue_events_036880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:05:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11790#event-36880"
}
```



---

archive/issue_comments_154561.json:
```json
{
    "body": "**Merged:** sage-5.0.beta9",
    "created_at": "2012-03-21T22:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11790#issuecomment-154561",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta9
