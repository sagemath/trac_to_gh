# Issue 11346: major bug in the conductor function for elliptic curves over number fields

archive/issues_011174.json:
```json
{
    "body": "Joanna Gaski found a serious bug in the function for computing conductors of elliptic curves over number fields, when the input curve is not integral.   Witness:\n\n```\nsage: K.<g> = NumberField(x^2 - x - 1)\nsage: E1 = EllipticCurve(K,[0,0,0,-1/48,-161/864]); E1\nElliptic Curve defined by y^2 = x^3 + (-1/48)*x + (-161/864) over Number Field in g with defining polynomial x^2 - x - 1\nsage: factor(E1.conductor())\n(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\nsage: factor(E1.integral_model().conductor())\n(Fractional ideal (2))^4 * (Fractional ideal (3)) * (Fractional ideal (-2*g + 1))\n```\n\nThe bug is actually in the local_data() function, which computes the possible primes of bad reduction by taking the support of the discriminant.  However, this is simply wrong if the input curve is not integral.  \n\n```\nsage: E1.discriminant().support()\n[Fractional ideal (-2*g + 1), Fractional ideal (3)]\nsage: E1.integral_model().discriminant().support()\n[Fractional ideal (-2*g + 1), Fractional ideal (2), Fractional ideal (3)]\n```\n\nThe one-line fix is to first compute an integral model, then ask for the discriminant of that model in the local_data function.  \n\nAssignee: @JohnCremona\n\nResolution: fixed\n\nAuthor: William Stein\n\nReviewer: Robert Bradshaw\n\nMerged: sage-4.7.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11346\n\n",
    "closed_at": "2011-05-31T17:06:26Z",
    "created_at": "2011-05-17T18:14:03Z",
    "labels": [
        "component: elliptic curves",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "major bug in the conductor function for elliptic curves over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11346",
    "user": "https://github.com/williamstein"
}
```
Joanna Gaski found a serious bug in the function for computing conductors of elliptic curves over number fields, when the input curve is not integral.   Witness:

```
sage: K.<g> = NumberField(x^2 - x - 1)
sage: E1 = EllipticCurve(K,[0,0,0,-1/48,-161/864]); E1
Elliptic Curve defined by y^2 = x^3 + (-1/48)*x + (-161/864) over Number Field in g with defining polynomial x^2 - x - 1
sage: factor(E1.conductor())
(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
sage: factor(E1.integral_model().conductor())
(Fractional ideal (2))^4 * (Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
```

The bug is actually in the local_data() function, which computes the possible primes of bad reduction by taking the support of the discriminant.  However, this is simply wrong if the input curve is not integral.  

```
sage: E1.discriminant().support()
[Fractional ideal (-2*g + 1), Fractional ideal (3)]
sage: E1.integral_model().discriminant().support()
[Fractional ideal (-2*g + 1), Fractional ideal (2), Fractional ideal (3)]
```

The one-line fix is to first compute an integral model, then ask for the discriminant of that model in the local_data function.  

Assignee: @JohnCremona

Resolution: fixed

Author: William Stein

Reviewer: Robert Bradshaw

Merged: sage-4.7.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11346





---

archive/issue_comments_122585.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_11346.patch](tarball://root/attachments/some-uuid/ticket11346/trac_11346.patch) by @williamstein created at 2011-05-17 18:46:11",
    "created_at": "2011-05-17T18:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122585",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>Attachment [trac_11346.patch](tarball://root/attachments/some-uuid/ticket11346/trac_11346.patch) by @williamstein created at 2011-05-17 18:46:11



---

archive/issue_comments_122586.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-17T18:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122586",
    "user": "https://github.com/williamstein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_122587.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-05-18T05:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122587",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_122588.json:
```json
{
    "body": "<a id='comment:4'></a>Additional comment on this and #11347.  I think a better fix would have been to add one line in the constructor for `EllipticCurveLocalData` in sage.schemes.elliptic_curves.ell_local_data, namely \n\n```\n    E = E.integral_model()\n```\nrather than having a lot of separate functions have to remember to do this.  The fixes here and at #11347 are fine by themselves, but it remains the case that\n\n```\nsage: K.<g> = NumberField(x^2 - x - 1)          \nsage: E = EllipticCurve(K,[0,0,0,-1/48,161/864])\nsage: E.local_data()   \n```\nfails.\n\nI don't have time to rework this right now, so have not tagged this \"needs work\"...",
    "created_at": "2011-05-18T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122588",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>Additional comment on this and #11347.  I think a better fix would have been to add one line in the constructor for `EllipticCurveLocalData` in sage.schemes.elliptic_curves.ell_local_data, namely 

```
    E = E.integral_model()
```
rather than having a lot of separate functions have to remember to do this.  The fixes here and at #11347 are fine by themselves, but it remains the case that

```
sage: K.<g> = NumberField(x^2 - x - 1)          
sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864])
sage: E.local_data()   
```
fails.

I don't have time to rework this right now, so have not tagged this "needs work"...



---

archive/issue_comments_122589.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [11346-followup.patch](tarball://root/attachments/some-uuid/ticket11346/11346-followup.patch) by @robertwb created at 2011-05-19 06:19:00\n\nI agree, followup patch does just that.",
    "created_at": "2011-05-19T06:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122589",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'></a>Attachment [11346-followup.patch](tarball://root/attachments/some-uuid/ticket11346/11346-followup.patch) by @robertwb created at 2011-05-19 06:19:00

I agree, followup patch does just that.



---

archive/issue_comments_122590.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-31T17:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11346#issuecomment-122590",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_029430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-31T17:06:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11346",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11346#event-29430"
}
```
