# Issue 11226: Sympow spkg fails with gcc 4.6.0

archive/issues_011054.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mariah"
    ],
    "body": "On Linux Itanium (ia64) systems, sympow builds with gcc 4.6.0 but fails doctests.\nExample from cleo (RHEL 5.3 ia64 Itanium 2):\n\n```\nsage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/devel/sage-main/sage/lfunctions/sympow.py\", line 213:\n    sage: sympow.modular_degree(EllipticCurve('11a'))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_6[2]>\", line 1, in <module>\n        sympow.modular_degree(EllipticCurve('11a'))###line 213:\n    sage: sympow.modular_degree(EllipticCurve('11a'))\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/lib/python/site-packages/sage/lfunctions/sympow.py\", line 229, in modular_degree\n        raise RuntimeError, \"failed to compute modular degree\"\n    RuntimeError: failed to compute modular degree\n**********************************************************************\n\n[...]\n\nThe following tests failed:\n\nsage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\nsage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\nsage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\nsage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n----------------------------------------------------------------------\n```\n\nStarting up the `sympow` executable simply gives\n\n```\nsympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]\n```\n\nReported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)\n\nA revised package, which works around this problem by compiling with -fno-expensive-optimizations is [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)\n\nFor other issues related to gcc 4.6.0 see #11216\n\nKeywords: **sympow spkg**\n\nUpstream: **Reported upstream. Developers deny it's a bug.**\n\nReviewer: **David Kirkby**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-4.7.rc2**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11226_\n\n",
    "closed_at": "2011-05-06T07:18:49Z",
    "created_at": "2011-04-20T15:57:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Sympow spkg fails with gcc 4.6.0",
    "type": "issue",
    "updated_at": "2015-09-06T14:47:46Z",
    "url": "https://github.com/sagemath/sage/issues/11226",
    "user": "https://github.com/jdemeyer"
}
```
On Linux Itanium (ia64) systems, sympow builds with gcc 4.6.0 but fails doctests.
Example from cleo (RHEL 5.3 ia64 Itanium 2):

```
sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/devel/sage-main/sage/lfunctions/sympow.py", line 213:
    sage: sympow.modular_degree(EllipticCurve('11a'))
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[2]>", line 1, in <module>
        sympow.modular_degree(EllipticCurve('11a'))###line 213:
    sage: sympow.modular_degree(EllipticCurve('11a'))
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/lib/python/site-packages/sage/lfunctions/sympow.py", line 229, in modular_degree
        raise RuntimeError, "failed to compute modular degree"
    RuntimeError: failed to compute modular degree
**********************************************************************

[...]

The following tests failed:

sage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
sage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
----------------------------------------------------------------------
```

Starting up the `sympow` executable simply gives

```
sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]
```

Reported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)

A revised package, which works around this problem by compiling with -fno-expensive-optimizations is [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)

For other issues related to gcc 4.6.0 see #11216

Keywords: **sympow spkg**

Upstream: **Reported upstream. Developers deny it's a bug.**

Reviewer: **David Kirkby**

Author: **Jeroen Demeyer**

Merged: **sage-4.7.rc2**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/11226_





---

archive/issue_events_148659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:57:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148659"
}
```



---

archive/issue_events_148660.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148660"
}
```



---

archive/issue_events_148661.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148661"
}
```



---

archive/issue_events_148662.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:57:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148662"
}
```



---

archive/issue_comments_112087.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,3 +32,9 @@\n \tsage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n ----------------------------------------------------------------------\n ```\n+\n+Starting up the `sympow` executable simply gives\n+\n+```\n+sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]\n+```\n``````\n",
    "created_at": "2011-04-20T16:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112087",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,3 +32,9 @@
 	sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
 ----------------------------------------------------------------------
 ```
+
+Starting up the `sympow` executable simply gives
+
+```
+sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]
+```
``````




---

archive/issue_comments_112088.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nOn first sight, it looks like compiling with `-O1` solves the problem.",
    "created_at": "2011-04-20T16:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112088",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

On first sight, it looks like compiling with `-O1` solves the problem.



---

archive/issue_comments_112089.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -38,3 +38,5 @@\n ```\n sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]\n ```\n+\n+For other issues related to gcc 4.6.0 see #11216\n``````\n",
    "created_at": "2011-04-23T09:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112089",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -38,3 +38,5 @@
 ```
 sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]
 ```
+
+For other issues related to gcc 4.6.0 see #11216
``````




---

archive/issue_comments_112090.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nCan't say I am surprised. Any clues from the build log?",
    "created_at": "2011-04-24T01:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112090",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Can't say I am surprised. Any clues from the build log?



---

archive/issue_comments_112091.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@kiwifb](#comment:4):\n> Can't say I am surprised. \n\nMe neither! \n\nDave",
    "created_at": "2011-04-24T02:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112091",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@kiwifb](#comment:4):
> Can't say I am surprised. 

Me neither! 

Dave



---

archive/issue_comments_112092.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHas the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?",
    "created_at": "2011-04-27T13:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112092",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:6" align="right">comment:6</div>

Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?



---

archive/issue_comments_112093.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@sagetrac-drkirkby](#comment:6):\n> Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?\n\nYes.  I tried compiling with `-O3 -fno-ivopts`, but sadly\nthe reported problem still exists.",
    "created_at": "2011-04-27T19:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112093",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@sagetrac-drkirkby](#comment:6):
> Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?

Yes.  I tried compiling with `-O3 -fno-ivopts`, but sadly
the reported problem still exists.



---

archive/issue_comments_112094.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIf src/QD.c is compiled with -O1 (and the rest with -O3) then\n`sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`\nno longer fails.  \n\nI am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.",
    "created_at": "2011-04-27T20:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112094",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:8" align="right">comment:8</div>

If src/QD.c is compiled with -O1 (and the rest with -O3) then
`sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`
no longer fails.  

I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.



---

archive/issue_comments_112095.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@sagetrac-mariah](#comment:8):\n> If src/QD.c is compiled with -O1 (and the rest with -O3) then\n> `sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`\n> no longer fails.  \n> \n> I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.\n\nYou are a brave lady Mariah - any code in SYMPOW is difficult to understand. Bill  Hart described it as \"virtually obfuscated\". Unfortunately, since it not actually standard C (the Sun compiler wont compile it), it can't be entered into The International Obfuscated C Code Contest\n\nhttp://www.ioccc.org/\n\nI particualry like SYMPOW's Configure script\n\nhttp://boxen.math.washington.edu/home/kirkby/bad-code/sympow-1.018.1.p7/src/Configure\n\nwhich starts off\n\n```\n#!/bin/sh\n```\n\nthen later has a test to see if sh exists on the system!\n\n```\nSH=`whichexe sh` && echo \"#define SH \\\"$SH\\\"\" >> $CONFIG\nif [ -z \"$SH\" ]; then\n  echo \"**ERROR**: Could not find sh\"; exit 1;\nelse\n  echo \"SH = $SH\"\nfi\n```\n\nGood luck Mariah - I don't envy you. \n\nDave",
    "created_at": "2011-04-27T21:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112095",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@sagetrac-mariah](#comment:8):
> If src/QD.c is compiled with -O1 (and the rest with -O3) then
> `sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`
> no longer fails.  
> 
> I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.

You are a brave lady Mariah - any code in SYMPOW is difficult to understand. Bill  Hart described it as "virtually obfuscated". Unfortunately, since it not actually standard C (the Sun compiler wont compile it), it can't be entered into The International Obfuscated C Code Contest

http://www.ioccc.org/

I particualry like SYMPOW's Configure script

http://boxen.math.washington.edu/home/kirkby/bad-code/sympow-1.018.1.p7/src/Configure

which starts off

```
#!/bin/sh
```

then later has a test to see if sh exists on the system!

```
SH=`whichexe sh` && echo "#define SH \"$SH\"" >> $CONFIG
if [ -z "$SH" ]; then
  echo "**ERROR**: Could not find sh"; exit 1;
else
  echo "SH = $SH"
fi
```

Good luck Mariah - I don't envy you. 

Dave



---

archive/issue_events_148663.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-04-29T14:52:29Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "subject": "https://github.com/sagetrac-mariah",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148663"
}
```



---

archive/issue_comments_112096.json:
```json
{
    "body": "Upstream: **Reported upstream. Little or no feedback.**",
    "created_at": "2011-04-29T16:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112096",
    "user": "https://github.com/sagetrac-mariah"
}
```

Upstream: **Reported upstream. Little or no feedback.**



---

archive/issue_comments_112097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,4 +39,6 @@\n sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]\n ```\n \n+A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)\n+\n For other issues related to gcc 4.6.0 see #11216\n``````\n",
    "created_at": "2011-04-29T16:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112097",
    "user": "https://github.com/sagetrac-mariah"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,4 +39,6 @@
 sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]
 ```
 
+A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)
+
 For other issues related to gcc 4.6.0 see #11216
``````




---

archive/issue_events_148664.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-04-29T16:00:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148664"
}
```



---

archive/issue_comments_112098.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\ngcc-4.6.0 optimization regression of src/QD.c reported to gcc bugzilla [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)",
    "created_at": "2011-04-29T16:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112098",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:11" align="right">comment:11</div>

gcc-4.6.0 optimization regression of src/QD.c reported to gcc bugzilla [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)



---

archive/issue_comments_112099.json:
```json
{
    "body": "Author: **Mariah Lenox**",
    "created_at": "2011-04-29T16:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112099",
    "user": "https://github.com/sagetrac-mariah"
}
```

Author: **Mariah Lenox**



---

archive/issue_comments_112100.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHi Mariah, \n\nthe test in the code \n\n```\nif [ \"`uname -m`\" = \"ia64\" ] && [ $CC = \"gcc\" ]; then \n```\n\nwill fail if CC is set to something like /usr/local/bin/gcc. In this case, $CC is not just gcc. \n\nI would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that `__GNU__` is defined. Then use something like the following, which I'm doing from memory and have not tested. \n\n```\nif [ \"x$UNAME\" = xLinux ] && [ \"x`$SAGE_LOCAL/bin/testcc.sh $CC`\" = xGCC ] && [ \"x`$CC -dumpversion 2>/dev/null`\" = x4.6.0 ] ; then  \n```\n\nThat will\n* Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor. \n* Since the first test uses $UNAME, it should be faster on non-Linux systems, as there is no need to call any external scripts or programs. \n* $CC really is a GNU-like compiler. \n\nYou might want to review #11169 which changes the exit code of the script testcc.sh if it fails. But it wont effect your code here, as you are checking the text output. \n\nDave",
    "created_at": "2011-04-29T23:27:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112100",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:12" align="right">comment:12</div>

Hi Mariah, 

the test in the code 

```
if [ "`uname -m`" = "ia64" ] && [ $CC = "gcc" ]; then 
```

will fail if CC is set to something like /usr/local/bin/gcc. In this case, $CC is not just gcc. 

I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that `__GNU__` is defined. Then use something like the following, which I'm doing from memory and have not tested. 

```
if [ "x$UNAME" = xLinux ] && [ "x`$SAGE_LOCAL/bin/testcc.sh $CC`" = xGCC ] && [ "x`$CC -dumpversion 2>/dev/null`" = x4.6.0 ] ; then  
```

That will
* Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor. 
* Since the first test uses $UNAME, it should be faster on non-Linux systems, as there is no need to call any external scripts or programs. 
* $CC really is a GNU-like compiler. 

You might want to review #11169 which changes the exit code of the script testcc.sh if it fails. But it wont effect your code here, as you are checking the text output. 

Dave



---

archive/issue_events_148665.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-04-29T23:27:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148665"
}
```



---

archive/issue_events_148666.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-04-29T23:27:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148666"
}
```



---

archive/issue_comments_112101.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@sagetrac-drkirkby](#comment:12):\n> * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.\n\nI would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).",
    "created_at": "2011-04-30T10:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112101",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@sagetrac-drkirkby](#comment:12):
> * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.

I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).



---

archive/issue_comments_112102.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Replying to [@sagetrac-drkirkby](#comment:12):\n> > * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.\n\n> \n> I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).\n\nFair enough, so change the test to something like:\n\n```\nif [ \"x`$SAGE_LOCAL/bin/testcc.sh $CC`\" = xGCC ] && [ \"x`$CC -dumpversion 2>/dev/null`\" = x4.6.0 ] ; then  \n```\n\nthen we will know it is gcc, even if someone sets the environment variable CC to be {{{/usr/local/bin/gcc}}\n\nThis release of gcc seems to have caused a fair number of problems for Sage. I'm not aware of any other gcc \"upgrade\" which has caused so much trouble. \n\nDave",
    "created_at": "2011-05-01T17:50:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112102",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:13):
> Replying to [@sagetrac-drkirkby](#comment:12):
> > * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.

> 
> I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).

Fair enough, so change the test to something like:

```
if [ "x`$SAGE_LOCAL/bin/testcc.sh $CC`" = xGCC ] && [ "x`$CC -dumpversion 2>/dev/null`" = x4.6.0 ] ; then  
```

then we will know it is gcc, even if someone sets the environment variable CC to be {{{/usr/local/bin/gcc}}

This release of gcc seems to have caused a fair number of problems for Sage. I'm not aware of any other gcc "upgrade" which has caused so much trouble. 

Dave



---

archive/issue_comments_112103.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@sagetrac-drkirkby](#comment:12):\n\n> I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU!__ is defined.\n\nThe trac formatting has screwed that up a bit. The script `$SAGE_ROOT/local/bin/testcc.sh` checks if !__GNU!__ is defined (I have to put a couple of exclamation marks to escape the formatting, as two underscores causes the text to be underlined).\n\nDave",
    "created_at": "2011-05-01T18:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112103",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@sagetrac-drkirkby](#comment:12):

> I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU!__ is defined.

The trac formatting has screwed that up a bit. The script `$SAGE_ROOT/local/bin/testcc.sh` checks if !__GNU!__ is defined (I have to put a couple of exclamation marks to escape the formatting, as two underscores causes the text to be underlined).

Dave



---

archive/issue_comments_112104.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI simplified the testcase and came up with the following minimal code to demonstrate the problem:\n\n```\nextern int printf (__const char *__restrict __format, ...);\n\ndouble p0 = 2.718281828459045091e+00;\ndouble p1 = 1.445646891729250158e-16;\ndouble q0 = 3.141592653589793116e+00;\ndouble q1 = 1.224646799147353207e-16;\n\nint main()\n{\n  double x;\n  x = p0*q1 + p1*q0 + p0*q0;\n  printf(\"%a\\n\", x);\n\n  return 0;\n}\n```\n\nAlso, `-fno-expensive-optimizations` solves this problem.",
    "created_at": "2011-05-02T09:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112104",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I simplified the testcase and came up with the following minimal code to demonstrate the problem:

```
extern int printf (__const char *__restrict __format, ...);

double p0 = 2.718281828459045091e+00;
double p1 = 1.445646891729250158e-16;
double q0 = 3.141592653589793116e+00;
double q1 = 1.224646799147353207e-16;

int main()
{
  double x;
  x = p0*q1 + p1*q0 + p0*q0;
  printf("%a\n", x);

  return 0;
}
```

Also, `-fno-expensive-optimizations` solves this problem.



---

archive/issue_comments_112105.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,6 +39,8 @@\n sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]\n ```\n \n+Reported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)\n+\n A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)\n \n For other issues related to gcc 4.6.0 see #11216\n``````\n",
    "created_at": "2011-05-02T09:24:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112105",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,6 +39,8 @@
 sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[0]
 ```
 
+Reported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)
+
 A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)
 
 For other issues related to gcc 4.6.0 see #11216
``````




---

archive/issue_comments_112106.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,6 +41,6 @@\n \n Reported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)\n \n-A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)\n+A revised package, which works around this problem by compiling with -fno-expensive-optimizations is [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)\n \n For other issues related to gcc 4.6.0 see #11216\n``````\n",
    "created_at": "2011-05-02T09:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112106",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,6 +41,6 @@
 
 Reported upstream to gcc: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)
 
-A revised package, which works around the gcc-4.6.0 bug by compiling QD.c with -O1 is [http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/mariah/spkg/sympow-1.018.1.p9.spkg)
+A revised package, which works around this problem by compiling with -fno-expensive-optimizations is [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)
 
 For other issues related to gcc 4.6.0 see #11216
``````




---

archive/issue_events_148667.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-02T10:07:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148667"
}
```



---

archive/issue_events_148668.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-02T10:07:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148668"
}
```



---

archive/issue_comments_112107.json:
```json
{
    "body": "Changed author from **Mariah Lenox** to **Jeroen Demeyer, Mariah Lenox**",
    "created_at": "2011-05-02T10:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112107",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Mariah Lenox** to **Jeroen Demeyer, Mariah Lenox**



---

archive/issue_events_148669.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-02T10:07:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148669"
}
```



---

archive/issue_events_148670.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-02T10:07:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148670"
}
```



---

archive/issue_comments_112108.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nNew spkg (with uncommitted changes) needs review: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)",
    "created_at": "2011-05-02T10:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112108",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

New spkg (with uncommitted changes) needs review: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)



---

archive/issue_events_148671.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:43:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148671"
}
```



---

archive/issue_events_148672.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:43:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148672"
}
```



---

archive/issue_events_148673.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:59:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148673"
}
```



---

archive/issue_events_148674.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:59:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148674"
}
```



---

archive/issue_comments_112109.json:
```json
{
    "body": "Changed keywords from **sympow** to **sympow spkg**",
    "created_at": "2011-05-03T12:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112109",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **sympow** to **sympow spkg**



---

archive/issue_events_148675.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:59:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148675"
}
```



---

archive/issue_events_148676.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-03T12:59:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148676"
}
```



---

archive/issue_events_148677.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-05-03T15:11:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148677"
}
```



---

archive/issue_events_148678.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-05-03T15:11:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148678"
}
```



---

archive/issue_comments_112110.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe changes are not checked in\n\n```\ndrkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status\nM SPKG.txt\nM spkg-install\n```\n\nThat obviously needs fixing. A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *\"Working around problems with gcc 4.6.0 on Itanium systems\"*\n\nDave",
    "created_at": "2011-05-03T15:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112110",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:22" align="right">comment:22</div>

The changes are not checked in

```
drkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status
M SPKG.txt
M spkg-install
```

That obviously needs fixing. A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *"Working around problems with gcc 4.6.0 on Itanium systems"*

Dave



---

archive/issue_comments_112111.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI recommend that the patch only apply to gcc-4.6.0.  It might\nbe fixed in later gcc versions.",
    "created_at": "2011-05-03T20:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112111",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:23" align="right">comment:23</div>

I recommend that the patch only apply to gcc-4.6.0.  It might
be fixed in later gcc versions.



---

archive/issue_comments_112112.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@sagetrac-mariah](#comment:23):\n> I recommend that the patch only apply to gcc-4.6.0.  It might\n> be fixed in later gcc versions.\n\nI think that having the workaround for all versions 4.6.x doesn't really hurt. It is certainly a safer alternative than applying the workaround only for gcc 4.6.0. If at some point, this bug is fixed in a later gcc 4.6.x, then we can still change the spkg accordingly.",
    "created_at": "2011-05-04T07:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112112",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@sagetrac-mariah](#comment:23):
> I recommend that the patch only apply to gcc-4.6.0.  It might
> be fixed in later gcc versions.

I think that having the workaround for all versions 4.6.x doesn't really hurt. It is certainly a safer alternative than applying the workaround only for gcc 4.6.0. If at some point, this bug is fixed in a later gcc 4.6.x, then we can still change the spkg accordingly.



---

archive/issue_events_148679.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-04T09:44:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148679"
}
```



---

archive/issue_events_148680.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-04T09:44:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148680"
}
```



---

archive/issue_comments_112113.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@sagetrac-drkirkby](#comment:22):\n> The changes are not checked in\n> \n> ```\n> drkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status\n> M SPKG.txt\n> M spkg-install\n> ```\n> \n> That obviously needs fixing.\n\nNever mind this, it will be fixed after positive_review.\n\n> A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *\"Working around problems with gcc 4.6.0 on Itanium systems\"*\n\nI have changed the comment slightly to:\n\n```\n        echo \"Detected GCC version `$CC -dumpversion` on Itanium. Adding\"\n        echo \"work-around to fix a bug when sympow is compiled with gcc 4.6.0\"\n```",
    "created_at": "2011-05-04T09:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112113",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@sagetrac-drkirkby](#comment:22):
> The changes are not checked in
> 
> ```
> drkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status
> M SPKG.txt
> M spkg-install
> ```
> 
> That obviously needs fixing.

Never mind this, it will be fixed after positive_review.

> A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *"Working around problems with gcc 4.6.0 on Itanium systems"*

I have changed the comment slightly to:

```
        echo "Detected GCC version `$CC -dumpversion` on Itanium. Adding"
        echo "work-around to fix a bug when sympow is compiled with gcc 4.6.0"
```



---

archive/issue_comments_112114.json:
```json
{
    "body": "Diff for the sympow spkg, for reviewing only",
    "created_at": "2011-05-04T09:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112114",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the sympow spkg, for reviewing only



---

archive/issue_comments_112115.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAttachment: **[sympow-1.018.1.p8-p9.diff.gz](https://github.com/sagemath/sage/files/ticket11226/sympow-1.018.1.p8-p9.diff.gz)**",
    "created_at": "2011-05-05T13:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112115",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Attachment: **[sympow-1.018.1.p8-p9.diff.gz](https://github.com/sagemath/sage/files/ticket11226/sympow-1.018.1.p8-p9.diff.gz)**



---

archive/issue_comments_112116.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer, Mariah Lenox** to **Jeroen Demeyer**",
    "created_at": "2011-05-05T13:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112116",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Jeroen Demeyer, Mariah Lenox** to **Jeroen Demeyer**



---

archive/issue_comments_112117.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThat looks fine, so positive review, though don't forget to commit the changes.",
    "created_at": "2011-05-05T21:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112117",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:27" align="right">comment:27</div>

That looks fine, so positive review, though don't forget to commit the changes.



---

archive/issue_comments_112118.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2011-05-05T21:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112118",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_events_148681.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-05-05T21:27:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148681"
}
```



---

archive/issue_events_148682.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-05-05T21:27:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148682"
}
```



---

archive/issue_comments_112119.json:
```json
{
    "body": "Merged: **sage-4.7.rc2**",
    "created_at": "2011-05-06T07:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112119",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.rc2**



---

archive/issue_events_148683.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-06T07:18:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148683"
}
```



---

archive/issue_events_148684.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-06T07:18:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11226#event-148684"
}
```



---

archive/issue_comments_112120.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Little or no feedback.** to **Reported upstream. Developers deny it's a bug.**",
    "created_at": "2011-10-13T19:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112120",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. Little or no feedback.** to **Reported upstream. Developers deny it's a bug.**



---

archive/issue_comments_112121.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAccording to gcc, it's okay to violate the floating-point standard with `-O3`.  They also say the correct workaround is the **undocumented** option\n\n```\n-ffp-contract=on\n```",
    "created_at": "2011-10-13T19:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112121",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

According to gcc, it's okay to violate the floating-point standard with `-O3`.  They also say the correct workaround is the **undocumented** option

```
-ffp-contract=on
```



---

archive/issue_comments_112122.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSorry, it is documented.  I was looking at documentation of an older gcc.",
    "created_at": "2011-10-13T19:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112122",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Sorry, it is documented.  I was looking at documentation of an older gcc.



---

archive/issue_comments_112123.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFrom [http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html):\n\n```\n-ffp-contract=style\n    -ffp-contract=off disables floating-point expression contraction. -ffp-contract=fast enables floating-point expression contraction such as forming of fused multiply-add operations if the target has native support for them. -ffp-contract=on enables floating-point expression contraction if allowed by the language standard. This is currently not implemented and treated equal to -ffp-contract=off.\n\n    The default is -ffp-contract=fast.\n```",
    "created_at": "2011-10-13T19:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112123",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

From [http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html):

```
-ffp-contract=style
    -ffp-contract=off disables floating-point expression contraction. -ffp-contract=fast enables floating-point expression contraction such as forming of fused multiply-add operations if the target has native support for them. -ffp-contract=on enables floating-point expression contraction if allowed by the language standard. This is currently not implemented and treated equal to -ffp-contract=off.

    The default is -ffp-contract=fast.
```



---

archive/issue_comments_112124.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,10 +26,10 @@\n \n The following tests failed:\n \n-\tsage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\n-\tsage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\n-\tsage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\n-\tsage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n+sage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\n+sage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\n+sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\n+sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n ----------------------------------------------------------------------\n ```\n \n``````\n",
    "created_at": "2015-09-06T14:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11226#issuecomment-112124",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,10 +26,10 @@
 
 The following tests failed:
 
-	sage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
-	sage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
-	sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
-	sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
+sage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
+sage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
+sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
+sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
 ----------------------------------------------------------------------
 ```
 
``````

