# Issue 11670: fix number fields being unique parents -- this got broken over the years

archive/issues_011498.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "For example, these are all wrong:\n\n```\nsage: K.<a> = NumberField(x^2 - x - 1)\nsage: loads(dumps(K)) is K\nFalse\nsage: K.<a> = NumberField(x^3 - x - 1)\nsage: loads(dumps(K)) is K\nFalse\nsage: K.<a> = CyclotomicField(7)\nsage: loads(dumps(K)) is K\nFalse\n```\n\n\nNOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. \n\nThis is related to #10448. \n\nComponent: **number fields**\n\nAuthor: **Julian Rueth**\n\nBranch/Commit: **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**\n\nReviewer: **Simon King, Peter Bruin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11670_\n\n",
    "closed_at": "2014-05-06T22:02:47Z",
    "created_at": "2011-08-09T00:19:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix number fields being unique parents -- this got broken over the years",
    "type": "issue",
    "updated_at": "2014-05-06T22:02:47Z",
    "url": "https://github.com/sagemath/sage/issues/11670",
    "user": "https://github.com/williamstein"
}
```
For example, these are all wrong:

```
sage: K.<a> = NumberField(x^2 - x - 1)
sage: loads(dumps(K)) is K
False
sage: K.<a> = NumberField(x^3 - x - 1)
sage: loads(dumps(K)) is K
False
sage: K.<a> = CyclotomicField(7)
sage: loads(dumps(K)) is K
False
```


NOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. 

This is related to #10448. 

Component: **number fields**

Author: **Julian Rueth**

Branch/Commit: **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**

Reviewer: **Simon King, Peter Bruin**

_Issue created by migration from https://trac.sagemath.org/ticket/11670_





---

archive/issue_events_154902.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-09T00:19:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154902"
}
```



---

archive/issue_events_154903.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-09T00:19:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154903"
}
```



---

archive/issue_events_154904.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-09T00:19:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154904"
}
```



---

archive/issue_events_154905.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-09T00:19:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154905"
}
```



---

archive/issue_events_154906.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-08-09T00:19:58Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154906"
}
```



---

archive/issue_comments_120361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,6 @@\n sage: loads(dumps(K)) is K\n False\n ```\n+\n+\n+NOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. \n``````\n",
    "created_at": "2011-08-09T16:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120361",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,6 @@
 sage: loads(dumps(K)) is K
 False
 ```
+
+
+NOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. 
``````




---

archive/issue_comments_120362.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhen working on this ticket, I also found a potentially serious bug, which is that the parameters `assume_disc_small` and `maximize_at_primes` of a number field were both lost upon pickling and unpickling. This ticket fixes that.   We used to have this bug:\n\n```\nsage: K.<a> = NumberField(x^3-2, assume_disc_small=True, maximize_at_primes=[2], latex_name='\\\\alpha', embedding=2^(1/3))\nsage: K._assume_disc_small\nTrue\nsage: K._maximize_at_primes\n[2]\nsage: L = loads(dumps(K))\nsage: L._assume_disc_small\nFalse\nsage: L._maximize_at_primes  # None\n```\n\nAttached patch fixes that.",
    "created_at": "2011-08-09T16:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120362",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

When working on this ticket, I also found a potentially serious bug, which is that the parameters `assume_disc_small` and `maximize_at_primes` of a number field were both lost upon pickling and unpickling. This ticket fixes that.   We used to have this bug:

```
sage: K.<a> = NumberField(x^3-2, assume_disc_small=True, maximize_at_primes=[2], latex_name='\\alpha', embedding=2^(1/3))
sage: K._assume_disc_small
True
sage: K._maximize_at_primes
[2]
sage: L = loads(dumps(K))
sage: L._assume_disc_small
False
sage: L._maximize_at_primes  # None
```

Attached patch fixes that.



---

archive/issue_comments_120363.json:
```json
{
    "body": "Attachment: **[trac_11670.patch.gz](https://github.com/sagemath/sage/files/ticket11670/trac_11670.patch.gz)**",
    "created_at": "2011-08-09T17:12:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120363",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac_11670.patch.gz](https://github.com/sagemath/sage/files/ticket11670/trac_11670.patch.gz)**



---

archive/issue_events_154907.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-09T17:13:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154907"
}
```



---

archive/issue_comments_120364.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,5 @@\n \n \n NOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. \n+\n+This is related to #10448. \n``````\n",
    "created_at": "2011-08-09T17:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120364",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,5 @@
 
 
 NOTE: To keep this project manageable for now, this ticket does *not* address similar issues for relative number fields, if there are any. 
+
+This is related to #10448. 
``````




---

archive/issue_comments_120365.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI should comment on UniqueFactory and UniqueRepresentation (from sage.structure.unique*).   I made some attempt to use it, but decided against it for *this patch*.   The main reason is that I want to fully maintain backward compatibility with old pickled objects, since there are a lot of pickled number field elements in the wild, and that is really opaque using UniqueRepresentation.   (Also, I am concerned using UniqueRepresentation has some efficiency issues in terms of size and later changing how pickling works, since every time you pickle an object it wraps it in its own wrapper around other stuff, leading to another level of abstraction.)  I don't claim that the current approach is the easiest to maintain in the long run -- in fact, it got broke before by bad patches.  But in this new patch, I've added a ton of comments and a big warning to help prevent this in the future.",
    "created_at": "2011-08-09T17:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120365",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:4" align="right">comment:4</div>

I should comment on UniqueFactory and UniqueRepresentation (from sage.structure.unique*).   I made some attempt to use it, but decided against it for *this patch*.   The main reason is that I want to fully maintain backward compatibility with old pickled objects, since there are a lot of pickled number field elements in the wild, and that is really opaque using UniqueRepresentation.   (Also, I am concerned using UniqueRepresentation has some efficiency issues in terms of size and later changing how pickling works, since every time you pickle an object it wraps it in its own wrapper around other stuff, leading to another level of abstraction.)  I don't claim that the current approach is the easiest to maintain in the long run -- in fact, it got broke before by bad patches.  But in this new patch, I've added a ton of comments and a big warning to help prevent this in the future.



---

archive/issue_comments_120366.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI also applied the patch to sage-4.7.2.alpha1 and ran \"make ptestlong\" with complete success.",
    "created_at": "2011-08-09T17:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120366",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">comment:5</div>

I also applied the patch to sage-4.7.2.alpha1 and ran "make ptestlong" with complete success.



---

archive/issue_comments_120367.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDoes that fix the issues discussed on #10448 as well?\n\nThere, I tried to fix the missing uniqueness of maximal orders in number fields using cached_method decorators. However, the most recent post on #10448 (five months ago) also mentions the problem that number fields aren't unique, and thus the maximal orders can only be as unique as the umber fields they are contained in.",
    "created_at": "2011-08-09T19:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120367",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

Does that fix the issues discussed on #10448 as well?

There, I tried to fix the missing uniqueness of maximal orders in number fields using cached_method decorators. However, the most recent post on #10448 (five months ago) also mentions the problem that number fields aren't unique, and thus the maximal orders can only be as unique as the umber fields they are contained in.



---

archive/issue_comments_120368.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIt turns out that this ticket is also related with #10667. Since #10667 (among other things) extends caching of homsets, the non-uniqueness of number fields then yields actual coercion errors.",
    "created_at": "2011-09-06T06:29:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120368",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

It turns out that this ticket is also related with #10667. Since #10667 (among other things) extends caching of homsets, the non-uniqueness of number fields then yields actual coercion errors.



---

archive/issue_comments_120369.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSome brief remarks:\n\n* In the test for `NumberField_absolute_v2`, you use `NumberField_absolute_v1` (should be v2, not v1). The same for `NumberField_cyclotomic_v2` and `NumberField_quadratic_v2`.\n\n* The format, if I am not mistaken, should be\n\n ```\n        OUTPUT:\n\n        - tuple of parameters that define this field; used in \n          caching and pickling \n ```\n not\n\n ```\n        OUTPUT: \n            - tuple of parameters that define this field; used in \n              caching and pickling \n ```",
    "created_at": "2011-09-06T06:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120369",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Some brief remarks:

* In the test for `NumberField_absolute_v2`, you use `NumberField_absolute_v1` (should be v2, not v1). The same for `NumberField_cyclotomic_v2` and `NumberField_quadratic_v2`.

* The format, if I am not mistaken, should be

 ```
        OUTPUT:

        - tuple of parameters that define this field; used in 
          caching and pickling 
 ```
 not

 ```
        OUTPUT: 
            - tuple of parameters that define this field; used in 
              caching and pickling 
 ```



---

archive/issue_comments_120370.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOne problem bugging me at #10667 remains: If one calls the method `point_exact` from sage.schemes.elliptic_curves.heegner with the option `optimize=True` then a non-unique absolute number field (namely `Number Field in a with defining polynomial x^12 + 4*x^11 + 56*x^10 + 170*x^9 + 1130*x^8 + 2564*x^7 + 10791*x^6 + 18054*x^5 + 51340*x^4 + 57530*x^3 + 102986*x^2 + 53724*x + 35001`) emerges.\n\nIf I can fix it then I'll post a patch here, not at #10667.",
    "created_at": "2011-09-06T07:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120370",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

One problem bugging me at #10667 remains: If one calls the method `point_exact` from sage.schemes.elliptic_curves.heegner with the option `optimize=True` then a non-unique absolute number field (namely `Number Field in a with defining polynomial x^12 + 4*x^11 + 56*x^10 + 170*x^9 + 1130*x^8 + 2564*x^7 + 10791*x^6 + 18054*x^5 + 51340*x^4 + 57530*x^3 + 102986*x^2 + 53724*x + 35001`) emerges.

If I can fix it then I'll post a patch here, not at #10667.



---

archive/issue_comments_120371.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYep. Here is an explicit example exposing the missing uniqueness:\n\n```\nsage: N = NumberField(x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, 'a')\nsage: M = N.optimized_representation()[0]\nsage: M\nNumber Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1\nsage: N is M.change_names(names='a')\nFalse\nsage: N == M.change_names(names='a')\nTrue\n```\n\nI guess it can be fixed in the `change_names` method.",
    "created_at": "2011-09-06T07:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120371",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Yep. Here is an explicit example exposing the missing uniqueness:

```
sage: N = NumberField(x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, 'a')
sage: M = N.optimized_representation()[0]
sage: M
Number Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1
sage: N is M.change_names(names='a')
False
sage: N == M.change_names(names='a')
True
```

I guess it can be fixed in the `change_names` method.



---

archive/issue_events_154908.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-06T07:11:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154908"
}
```



---

archive/issue_events_154909.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-06T07:11:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154909"
}
```



---

archive/issue_comments_120372.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAha, it boils down to one line in `N.absolute_field`:\n\n```python\n        try:\n            return self.__absolute_field[names]\n        except KeyError:\n            pass\n        except AttributeError:\n            self.__absolute_field = {}\n        K = NumberField(self.defining_polynomial(), names, cache=False)\n        K._set_structure(maps.NameChangeMap(K, self), maps.NameChangeMap(self, K))\n        self.__absolute_field[names] = K\n        return K\n```\n\nWhy is the option `cache=False` used in that method?",
    "created_at": "2011-09-06T07:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120372",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

Aha, it boils down to one line in `N.absolute_field`:

```python
        try:
            return self.__absolute_field[names]
        except KeyError:
            pass
        except AttributeError:
            self.__absolute_field = {}
        K = NumberField(self.defining_polynomial(), names, cache=False)
        K._set_structure(maps.NameChangeMap(K, self), maps.NameChangeMap(self, K))
        self.__absolute_field[names] = K
        return K
```

Why is the option `cache=False` used in that method?



---

archive/issue_comments_120373.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI read the comment\n\n```\n        # Note -- never call this on a cached number field, since\n        # that could eventually lead to problems.\n```\nin `N._set_structure`. That might be a show stopper. But what actually happens if one applies it to a cached number field?",
    "created_at": "2011-09-06T07:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120373",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

I read the comment

```
        # Note -- never call this on a cached number field, since
        # that could eventually lead to problems.
```
in `N._set_structure`. That might be a show stopper. But what actually happens if one applies it to a cached number field?



---

archive/issue_comments_120374.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI see a potential work-around. In my example, we have\n\n```\nsage: N = NumberField(x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, 'a')\nsage: M = N.optimized_representation()[0]\nsage: K = M.change_names(names='a')\nsage: N == K\nTrue\nsage: N is K\nFalse\nsage: N.structure()\n(Ring Coercion endomorphism of Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, Ring Coercion endomorphism of Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1)\nsage: K.structure()\n(Isomorphism given by variable name change map:\n  From: Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1\n  To:   Number Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, Isomorphism given by variable name change map:\n  From: Number Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1\n  To:   Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1)\n```\n\nWould it make sense to declare two number fields different if they have different `structure()`?",
    "created_at": "2011-09-06T07:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120374",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

I see a potential work-around. In my example, we have

```
sage: N = NumberField(x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, 'a')
sage: M = N.optimized_representation()[0]
sage: K = M.change_names(names='a')
sage: N == K
True
sage: N is K
False
sage: N.structure()
(Ring Coercion endomorphism of Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, Ring Coercion endomorphism of Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1)
sage: K.structure()
(Isomorphism given by variable name change map:
  From: Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1
  To:   Number Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1, Isomorphism given by variable name change map:
  From: Number Field in a6 with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1
  To:   Number Field in a with defining polynomial x^12 - 4*x^11 + 6*x^10 - 5*x^9 + 5*x^8 - 9*x^7 + 21*x^6 - 9*x^5 + 5*x^4 - 5*x^3 + 6*x^2 - 4*x + 1)
```

Would it make sense to declare two number fields different if they have different `structure()`?



---

archive/issue_comments_120375.json:
```json
{
    "body": "Author: **William Stein**",
    "created_at": "2011-09-27T01:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120375",
    "user": "https://github.com/williamstein"
}
```

Author: **William Stein**



---

archive/issue_comments_120376.json:
```json
{
    "body": "Reviewer: **Simon King**",
    "created_at": "2011-09-27T01:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120376",
    "user": "https://github.com/williamstein"
}
```

Reviewer: **Simon King**



---

archive/issue_events_154910.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-09-27T01:28:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154910"
}
```



---

archive/issue_events_154911.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-09-27T01:28:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154911"
}
```



---

archive/issue_events_154912.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-09-27T01:29:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154912"
}
```



---

archive/issue_events_154913.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-09-27T01:29:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154913"
}
```



---

archive/issue_events_154914.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154914"
}
```



---

archive/issue_events_154915.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154915"
}
```



---

archive/issue_events_154916.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154916"
}
```



---

archive/issue_events_154917.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154917"
}
```



---

archive/issue_comments_120377.json:
```json
{
    "body": "Branch: **[u/saraedum/ticket/11670](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11670)**",
    "created_at": "2014-04-08T09:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120377",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/ticket/11670](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11670)**



---

archive/issue_comments_120378.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWith the branch I just pushed, I got rid of ``_set_structure``. The structure of a number field is now always set when it is created. I know that unpickling of old objects is currently broken, I'm working on a fix. Anyway, maybe somebody already wants to have a look at what I have done so far? Any comments would be appreciated.\n\nShould I now add old number field pickles to the pickle jar? I could not find out how to do this from the reference manual. Or is this somehow done automagically?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9b7129c203f9c73c3959257ac0470c62cd68432\"><code>c9b7129</code></a></td><td><code>Removed number field's _set_structure() which breaks caching</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16aa7ec42263cc6767a6e898e2ea125248a5491b\"><code>16aa7ec</code></a></td><td><code>Create number fields in a factory to make sure they are unique parents.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/835c817cae746755cf8c46fc5c996fb0f7ff1a6f\"><code>835c817</code></a></td><td><code>Implemented NumberFieldStructure classes to improve caching of (absolute) number fields.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a11836185f41fbce189ae979ecc6ee0028ab985\"><code>3a11836</code></a></td><td><code>Made assume_disc_small part of the key for the number field cache (as it used to be).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936\"><code>cab3fe1</code></a></td><td><code>added missing docstrings to number field factories</code></td></tr></table>\n",
    "created_at": "2014-04-08T09:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120378",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:20" align="right">comment:20</div>

With the branch I just pushed, I got rid of ``_set_structure``. The structure of a number field is now always set when it is created. I know that unpickling of old objects is currently broken, I'm working on a fix. Anyway, maybe somebody already wants to have a look at what I have done so far? Any comments would be appreciated.

Should I now add old number field pickles to the pickle jar? I could not find out how to do this from the reference manual. Or is this somehow done automagically?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9b7129c203f9c73c3959257ac0470c62cd68432"><code>c9b7129</code></a></td><td><code>Removed number field's _set_structure() which breaks caching</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16aa7ec42263cc6767a6e898e2ea125248a5491b"><code>16aa7ec</code></a></td><td><code>Create number fields in a factory to make sure they are unique parents.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/835c817cae746755cf8c46fc5c996fb0f7ff1a6f"><code>835c817</code></a></td><td><code>Implemented NumberFieldStructure classes to improve caching of (absolute) number fields.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a11836185f41fbce189ae979ecc6ee0028ab985"><code>3a11836</code></a></td><td><code>Made assume_disc_small part of the key for the number field cache (as it used to be).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936"><code>cab3fe1</code></a></td><td><code>added missing docstrings to number field factories</code></td></tr></table>




---

archive/issue_comments_120379.json:
```json
{
    "body": "Commit: **[`cab3fe1`](https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936)**",
    "created_at": "2014-04-08T09:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120379",
    "user": "https://github.com/saraedum"
}
```

Commit: **[`cab3fe1`](https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936)**



---

archive/issue_comments_120380.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nPickling of old and new number fields should work now. I found these issues though.\n\nAbsolute number fields used to forget about their structure, this is fixed now (of course the structure can not be recovered for old pickles):\n\n```\nsage: K.<a> = QuadraticField(2)\nsage: L.<b> = K.change_names()\nsage: M=loads(dumps(L))\nsage: M.structure() # old behaviour\n(Ring Coercion endomorphism of Number Field in b with defining polynomial x^2 - 2,\n Ring Coercion endomorphism of Number Field in b with defining polynomial x^2 - 2)\nsage: L.structure() # this is what M.structure() returns now\n(Isomorphism given by variable name change map:\n  From: Number Field in b with defining polynomial x^2 - 2\n  To:   Number Field in a with defining polynomial x^2 - 2,\n Isomorphism given by variable name change map:\n  From: Number Field in a with defining polynomial x^2 - 2\n  To:   Number Field in b with defining polynomial x^2 - 2)\n```\n\nRelative number fields also used to forget about their structure. Since I have not touched the pickling of relative number fields, I would rather put this into a separate ticket:\n\n```\nsage:             sage: Z = var('Z')\nsage:             sage: K.<w> = NumberField(Z^3 + Z + 1)\nsage:             sage: L.<z> = K.extension(Z^3 + 2)\nsage:             sage: M.<u,v> = L.change_names()\nsage:             sage: M.structure()\n(Isomorphism given by variable name change map:\n  From: Number Field in u with defining polynomial x^3 + 2 over its base field\n  To:   Number Field in z with defining polynomial Z^3 + 2 over its base field,\n Isomorphism given by variable name change map:\n  From: Number Field in z with defining polynomial Z^3 + 2 over its base field\n  To:   Number Field in u with defining polynomial x^3 + 2 over its base field)\nsage:             sage: M = loads(dumps(M))\nsage:             sage: M.structure()\n(Ring Coercion endomorphism of Number Field in u with defining polynomial x^3 + 2 over its base field,\n Ring Coercion endomorphism of Number Field in u with defining polynomial x^3 + 2 over its base field)\n```",
    "created_at": "2014-04-09T12:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120380",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:21" align="right">comment:21</div>

Pickling of old and new number fields should work now. I found these issues though.

Absolute number fields used to forget about their structure, this is fixed now (of course the structure can not be recovered for old pickles):

```
sage: K.<a> = QuadraticField(2)
sage: L.<b> = K.change_names()
sage: M=loads(dumps(L))
sage: M.structure() # old behaviour
(Ring Coercion endomorphism of Number Field in b with defining polynomial x^2 - 2,
 Ring Coercion endomorphism of Number Field in b with defining polynomial x^2 - 2)
sage: L.structure() # this is what M.structure() returns now
(Isomorphism given by variable name change map:
  From: Number Field in b with defining polynomial x^2 - 2
  To:   Number Field in a with defining polynomial x^2 - 2,
 Isomorphism given by variable name change map:
  From: Number Field in a with defining polynomial x^2 - 2
  To:   Number Field in b with defining polynomial x^2 - 2)
```

Relative number fields also used to forget about their structure. Since I have not touched the pickling of relative number fields, I would rather put this into a separate ticket:

```
sage:             sage: Z = var('Z')
sage:             sage: K.<w> = NumberField(Z^3 + Z + 1)
sage:             sage: L.<z> = K.extension(Z^3 + 2)
sage:             sage: M.<u,v> = L.change_names()
sage:             sage: M.structure()
(Isomorphism given by variable name change map:
  From: Number Field in u with defining polynomial x^3 + 2 over its base field
  To:   Number Field in z with defining polynomial Z^3 + 2 over its base field,
 Isomorphism given by variable name change map:
  From: Number Field in z with defining polynomial Z^3 + 2 over its base field
  To:   Number Field in u with defining polynomial x^3 + 2 over its base field)
sage:             sage: M = loads(dumps(M))
sage:             sage: M.structure()
(Ring Coercion endomorphism of Number Field in u with defining polynomial x^3 + 2 over its base field,
 Ring Coercion endomorphism of Number Field in u with defining polynomial x^3 + 2 over its base field)
```



---

archive/issue_events_154918.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T12:20:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154918"
}
```



---

archive/issue_events_154919.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T12:20:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154919"
}
```



---

archive/issue_comments_120381.json:
```json
{
    "body": "Changed author from **William Stein** to **Julian Rueth**",
    "created_at": "2014-04-09T12:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120381",
    "user": "https://github.com/saraedum"
}
```

Changed author from **William Stein** to **Julian Rueth**



---

archive/issue_events_154920.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T12:25:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154920"
}
```



---

archive/issue_events_154921.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T12:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154921"
}
```



---

archive/issue_comments_120382.json:
```json
{
    "body": "Changed commit from **[`cab3fe1`](https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936)** to **[`70702aa`](https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee)**",
    "created_at": "2014-04-09T14:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120382",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cab3fe1`](https://github.com/sagemath/sagetrac-mirror/commit/cab3fe1eb4c425f0028b221494f95a03199f2936)** to **[`70702aa`](https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee)**



---

archive/issue_comments_120383.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71532de7b9e7a1b4c22d367cdae3c3c4d1fb2840\"><code>71532de</code></a></td><td><code>Hash function for absolute number fields.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af58e0cdc9101bfad57b7effa24d93d3fb257b48\"><code>af58e0c</code></a></td><td><code>Fixed unpickling of absolute number fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb5b8880beabf606cb71900f7abbf36c45ccc3f\"><code>7bb5b88</code></a></td><td><code>Added a test case to verify that pickling preserves the structure of a relative number field.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/622b238987f2ff84618050028ea4a42d8842cfc7\"><code>622b238</code></a></td><td><code>Pickling is broken for relative number fields. The structure of a number field is lost. Added a doctest to document this behaviour.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e8de679c62d695aa277da171a9099f65944b036\"><code>9e8de67</code></a></td><td><code>Relative and absolute number fields defined by the same (absolute) polynomial should not be equal.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0581f379070c7ceade3d573e96bdf8d2cdc8186c\"><code>0581f37</code></a></td><td><code>A number field's structure() may define conversion maps between number fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baeeb5c72004174bd26517d291f872fc21724dcd\"><code>baeeb5c</code></a></td><td><code>fixed a pickling test case</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee\"><code>70702aa</code></a></td><td><code>Fixed a hash doctest.</code></td></tr></table>\n",
    "created_at": "2014-04-09T14:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120383",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71532de7b9e7a1b4c22d367cdae3c3c4d1fb2840"><code>71532de</code></a></td><td><code>Hash function for absolute number fields.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af58e0cdc9101bfad57b7effa24d93d3fb257b48"><code>af58e0c</code></a></td><td><code>Fixed unpickling of absolute number fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb5b8880beabf606cb71900f7abbf36c45ccc3f"><code>7bb5b88</code></a></td><td><code>Added a test case to verify that pickling preserves the structure of a relative number field.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/622b238987f2ff84618050028ea4a42d8842cfc7"><code>622b238</code></a></td><td><code>Pickling is broken for relative number fields. The structure of a number field is lost. Added a doctest to document this behaviour.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e8de679c62d695aa277da171a9099f65944b036"><code>9e8de67</code></a></td><td><code>Relative and absolute number fields defined by the same (absolute) polynomial should not be equal.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0581f379070c7ceade3d573e96bdf8d2cdc8186c"><code>0581f37</code></a></td><td><code>A number field's structure() may define conversion maps between number fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baeeb5c72004174bd26517d291f872fc21724dcd"><code>baeeb5c</code></a></td><td><code>fixed a pickling test case</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee"><code>70702aa</code></a></td><td><code>Fixed a hash doctest.</code></td></tr></table>




---

archive/issue_events_154922.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T14:52:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154922"
}
```



---

archive/issue_events_154923.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-09T14:52:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154923"
}
```



---

archive/issue_comments_120384.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think it is indeed important that if one considers fields equipped with a `structure` (in the sense of this ticket), then (1) the `structure` should be fixed once and for all at the time of construction, and (2) no two fields with a different `structure` should be considered as equal.  Given (1), it would be good to to have a clear picture of what sort of things one can specify as a `structure`, and I would be interested in finding out how flexible this concept of `structure` is.\n\nFor example, it would be nice to be able to equip a number field *K* with an additional \"piece of structure\" *z* such that there is a category (in the mathematical sense) in which the objects are such pairs (*K*, *z*) and in which there exists at most one morphism between any two objects.  Then (a suitable finite representation of) *z* could be taken as an especially nice type of `structure` in the above sense.\n\nOne particular \"piece of structure\" that comes to mind is an embedding *z* of *K* into a fixed algebraic closure of **Q**.  In Sage, this means an embedding into `QQbar`.  Since `QQbar` encodes field elements (roughly speaking) by a polynomial and a complex root, represented by a sufficiently small complex region to determine the root uniquely, specifying *z* really means giving a small complex region representing a root of the defining polynomial of *K*.\n\nNow it is already the case that one can specify an `embedding` parameter when creating a number field.  Hence (finally) the following question: does the concept of a `structure` in the sense of this ticket allow the existing `embedding` parameter to be implemented as a special case of a `structure`?",
    "created_at": "2014-04-09T17:51:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120384",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:25" align="right">comment:25</div>

I think it is indeed important that if one considers fields equipped with a `structure` (in the sense of this ticket), then (1) the `structure` should be fixed once and for all at the time of construction, and (2) no two fields with a different `structure` should be considered as equal.  Given (1), it would be good to to have a clear picture of what sort of things one can specify as a `structure`, and I would be interested in finding out how flexible this concept of `structure` is.

For example, it would be nice to be able to equip a number field *K* with an additional "piece of structure" *z* such that there is a category (in the mathematical sense) in which the objects are such pairs (*K*, *z*) and in which there exists at most one morphism between any two objects.  Then (a suitable finite representation of) *z* could be taken as an especially nice type of `structure` in the above sense.

One particular "piece of structure" that comes to mind is an embedding *z* of *K* into a fixed algebraic closure of **Q**.  In Sage, this means an embedding into `QQbar`.  Since `QQbar` encodes field elements (roughly speaking) by a polynomial and a complex root, represented by a sufficiently small complex region to determine the root uniquely, specifying *z* really means giving a small complex region representing a root of the defining polynomial of *K*.

Now it is already the case that one can specify an `embedding` parameter when creating a number field.  Hence (finally) the following question: does the concept of a `structure` in the sense of this ticket allow the existing `embedding` parameter to be implemented as a special case of a `structure`?



---

archive/issue_comments_120385.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@pjbruin](#comment%3A25): \n> Now it is already the case that one can specify an `embedding` parameter when creating a number field.  Hence (finally) the following question: does the concept of a `structure` in the sense of this ticket allow the existing `embedding` parameter to be implemented as a special case of a `structure`?\n\nNot really. One difference is that two fields with different `embedding` are not considered equal, but two fields with different `structure` are. I think this makes sense since `structure` currently tells you how a field has been created (e.g. as the absolute field of a relative field.) However, treating two number fields with different complex embedding as being the same would most probably lead to nasty bugs. \n\nThere might be a more general concept that `structure` and `embedding` are special cases of but I would not try to abuse one of them for this (right now). There is probably too much code that expects these two attributes to have a specific format to make such a change. It could be the content of a followup ticket.",
    "created_at": "2014-04-09T18:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120385",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@pjbruin](#comment%3A25): 
> Now it is already the case that one can specify an `embedding` parameter when creating a number field.  Hence (finally) the following question: does the concept of a `structure` in the sense of this ticket allow the existing `embedding` parameter to be implemented as a special case of a `structure`?

Not really. One difference is that two fields with different `embedding` are not considered equal, but two fields with different `structure` are. I think this makes sense since `structure` currently tells you how a field has been created (e.g. as the absolute field of a relative field.) However, treating two number fields with different complex embedding as being the same would most probably lead to nasty bugs. 

There might be a more general concept that `structure` and `embedding` are special cases of but I would not try to abuse one of them for this (right now). There is probably too much code that expects these two attributes to have a specific format to make such a change. It could be the content of a followup ticket.



---

archive/issue_comments_120386.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@saraedum](#comment%3A26):\n> Not really. One difference is that two fields with different `embedding` are not considered equal, but two fields with different `structure` are.\n\nOK, I misunderstood the discussion on this ticket so far (I did not yet look at the code carefully); I somehow concluded that your implementation answered Simon's question from [comment:13](#comment%3A13) with \"yes\".  So do I understand correctly that two number fields are explicitly allowed to be equal but not identical?  Is this really desirable?  From the [manual page](http://sagemath.org/doc/reference/structure/sage/structure/unique_representation.html) on unique representation:\n\n\"Instances of a class have a unique representation behavior when instances evaluate equal if and only if they are identical (i.e., share the same memory representation), if and only if they were created using equal arguments. [...]  This behaviour is typically desirable for parents and categories.\"",
    "created_at": "2014-04-09T18:32:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120386",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@saraedum](#comment%3A26):
> Not really. One difference is that two fields with different `embedding` are not considered equal, but two fields with different `structure` are.

OK, I misunderstood the discussion on this ticket so far (I did not yet look at the code carefully); I somehow concluded that your implementation answered Simon's question from [comment:13](#comment%3A13) with "yes".  So do I understand correctly that two number fields are explicitly allowed to be equal but not identical?  Is this really desirable?  From the [manual page](http://sagemath.org/doc/reference/structure/sage/structure/unique_representation.html) on unique representation:

"Instances of a class have a unique representation behavior when instances evaluate equal if and only if they are identical (i.e., share the same memory representation), if and only if they were created using equal arguments. [...]  This behaviour is typically desirable for parents and categories."



---

archive/issue_comments_120387.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@pjbruin](#comment%3A27):\n> OK, I misunderstood the discussion on this ticket so far (I did not yet look at the code carefully); I somehow concluded that your implementation answered Simon's question from [comment:13](#comment%3A13) with \"yes\".\n\nI agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though. I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).\n\nI could certainly imagine helping on a followup ticket which tries to make `==` and `is` the same for number fields.",
    "created_at": "2014-04-09T18:42:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120387",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@pjbruin](#comment%3A27):
> OK, I misunderstood the discussion on this ticket so far (I did not yet look at the code carefully); I somehow concluded that your implementation answered Simon's question from [comment:13](#comment%3A13) with "yes".

I agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though. I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).

I could certainly imagine helping on a followup ticket which tries to make `==` and `is` the same for number fields.



---

archive/issue_comments_120388.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@saraedum](#comment%3A28):\n> I agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though.\n\nHmm, I wonder if one could test easily if this would indeed be a problem (within the Sage library, say).\n> I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).\n\nDoesn't \"unique parents\" mean precisely that parents are equal if and only if they are identical (see the third paragraph of [this page](http://www.sagemath.org/doc/thematic_tutorials/coercion_and_categories.html))?\n\n(I'm only starting to understand the finer points of all this; I thought understanding the situation for number fields would be a good first step towards the similar problem for elliptic curves in #11474.)",
    "created_at": "2014-04-09T18:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120388",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@saraedum](#comment%3A28):
> I agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though.

Hmm, I wonder if one could test easily if this would indeed be a problem (within the Sage library, say).
> I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).

Doesn't "unique parents" mean precisely that parents are equal if and only if they are identical (see the third paragraph of [this page](http://www.sagemath.org/doc/thematic_tutorials/coercion_and_categories.html))?

(I'm only starting to understand the finer points of all this; I thought understanding the situation for number fields would be a good first step towards the similar problem for elliptic curves in #11474.)



---

archive/issue_comments_120389.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@pjbruin](#comment%3A29):\n> Replying to [@saraedum](#comment%3A28):\n> > I agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though.\n\n> Hmm, I wonder if one could test easily if this would indeed be a problem (within the Sage library, say).\n> > I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).\n\n> Doesn't \"unique parents\" mean precisely that parents are equal if and only if they are identical (see the third paragraph of [this page](http://www.sagemath.org/doc/thematic_tutorials/coercion_and_categories.html))?\n\nOk. Maybe I am using the wrong vocabulary here. I meant, \"uniue\" as in \"two fields generated from the same arguments are identical\", not as in \"unique representation\".",
    "created_at": "2014-04-09T19:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120389",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@pjbruin](#comment%3A29):
> Replying to [@saraedum](#comment%3A28):
> > I agree that it makes sense that two number fields are different if they have a different structure. I had a feeling that this would break too much existing code, though.

> Hmm, I wonder if one could test easily if this would indeed be a problem (within the Sage library, say).
> > I think it is a natural first step to rewrite number fields to use a factory and make them unique parents (this ticket).

> Doesn't "unique parents" mean precisely that parents are equal if and only if they are identical (see the third paragraph of [this page](http://www.sagemath.org/doc/thematic_tutorials/coercion_and_categories.html))?

Ok. Maybe I am using the wrong vocabulary here. I meant, "uniue" as in "two fields generated from the same arguments are identical", not as in "unique representation".



---

archive/issue_comments_120390.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI see what you mean.  Maybe one could try to formalise the notion of \"unique parents\" more precisely as follows.\n\nWe have some Python callable `NumberField()` that takes as input some key (defining datum) `d` and outputs some Python object `K` depending on `d` and representing a number field.  This `NumberField()` uses (implicitly) some algorithm, say `same(d, e)`, that given two keys `d` and `e` decides whether `d` and `e` define the same number field.  (The meaning of \"the same\" is a bit vague; one could either use a mathematical definition involving extra structure on the number field, or one could take \"the same\" to mean by definition that `same(d, e)` returns True.)\n\nOf course, `same` should behave like an equivalence relation (`same(d, d) == True`, `same(d, e) == same(e, d)`, and transitivity holds).  I think that \"`K` and `L` were created using the same arguments\" should be interpreted as `K` and `L` being names assigned to the objects returned by `NumberField(d)` and `NumberField(e)` for some `d` and `e` for which `same(d, e)` is True.  I'm not sure if we have to assume any implication between `same(d, e)` and `d == e`; it is possible that `same(d, e)` is actually implemented as `d == e`.\n\nNow consider the following boolean-valued statements about possible keys `d` and `e`:\n1. `d is e`\n2. `same(d, e)`\n3. `NumberField(d) is NumberField(e)`\n4. `NumberField(d) == NumberField(e)`\nClearly, the implications 1 => 2 and 3 => 4 are automatic, and 2 => 4 probably holds already.  It seems that saying \"number fields are unique parents\" is the same as saying that the implementation of `NumberField()` ensures that the implications 2 => 3 (hence 2 => 4) and 4 => 3 both hold, and maybe even 3 => 2.\n\nIf I understand correctly, this ticket makes sure that 2 => 3 holds, but not necessarily 4 => 3.  From that perspective it makes sense to have a separate ticket to implement the \"other half\" of the unique parents property.",
    "created_at": "2014-04-09T20:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120390",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:31" align="right">comment:31</div>

I see what you mean.  Maybe one could try to formalise the notion of "unique parents" more precisely as follows.

We have some Python callable `NumberField()` that takes as input some key (defining datum) `d` and outputs some Python object `K` depending on `d` and representing a number field.  This `NumberField()` uses (implicitly) some algorithm, say `same(d, e)`, that given two keys `d` and `e` decides whether `d` and `e` define the same number field.  (The meaning of "the same" is a bit vague; one could either use a mathematical definition involving extra structure on the number field, or one could take "the same" to mean by definition that `same(d, e)` returns True.)

Of course, `same` should behave like an equivalence relation (`same(d, d) == True`, `same(d, e) == same(e, d)`, and transitivity holds).  I think that "`K` and `L` were created using the same arguments" should be interpreted as `K` and `L` being names assigned to the objects returned by `NumberField(d)` and `NumberField(e)` for some `d` and `e` for which `same(d, e)` is True.  I'm not sure if we have to assume any implication between `same(d, e)` and `d == e`; it is possible that `same(d, e)` is actually implemented as `d == e`.

Now consider the following boolean-valued statements about possible keys `d` and `e`:
1. `d is e`
2. `same(d, e)`
3. `NumberField(d) is NumberField(e)`
4. `NumberField(d) == NumberField(e)`
Clearly, the implications 1 => 2 and 3 => 4 are automatic, and 2 => 4 probably holds already.  It seems that saying "number fields are unique parents" is the same as saying that the implementation of `NumberField()` ensures that the implications 2 => 3 (hence 2 => 4) and 4 => 3 both hold, and maybe even 3 => 2.

If I understand correctly, this ticket makes sure that 2 => 3 holds, but not necessarily 4 => 3.  From that perspective it makes sense to have a separate ticket to implement the "other half" of the unique parents property.



---

archive/issue_comments_120391.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@saraedum](#comment%3A30):\n> Ok. Maybe I am using the wrong vocabulary here. I meant, \"uniue\" as in \"two fields generated from the same arguments are identical\", not as in \"unique representation\".\n\nIf you want two fields generated from the same arguments to be identical, then you can either use `CachedRepresentation` or `UniqueFactory`.\n\nIf you additionally want unique parent behaviour (which means you cannot have two distinct instance of your class that evaluate equal), you can use `UniqueRepresentation`, or you can add `WithEqualityById` (it could be that I wrongly remember the name, but it is something similar to this) as a base class.",
    "created_at": "2014-04-10T05:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120391",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@saraedum](#comment%3A30):
> Ok. Maybe I am using the wrong vocabulary here. I meant, "uniue" as in "two fields generated from the same arguments are identical", not as in "unique representation".

If you want two fields generated from the same arguments to be identical, then you can either use `CachedRepresentation` or `UniqueFactory`.

If you additionally want unique parent behaviour (which means you cannot have two distinct instance of your class that evaluate equal), you can use `UniqueRepresentation`, or you can add `WithEqualityById` (it could be that I wrongly remember the name, but it is something similar to this) as a base class.



---

archive/issue_comments_120392.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nWith your changes, Sage doesn't complain anymore if the user does not specify the name of the generator, but silently names it \"a\":\n\n```\nsage: K = NumberField(x^2 + 1); K\nNumber Field in a with defining polynomial x^2 + 1\n```\nI don't like this; since the name is part of the defining data, I think we should insist on the user specifying the name.  If you think this should be changed, I think it is better to create a new ticket so this interface issue can be discussed separately from the technical changes made in this ticket.",
    "created_at": "2014-04-10T11:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120392",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:33" align="right">comment:33</div>

With your changes, Sage doesn't complain anymore if the user does not specify the name of the generator, but silently names it "a":

```
sage: K = NumberField(x^2 + 1); K
Number Field in a with defining polynomial x^2 + 1
```
I don't like this; since the name is part of the defining data, I think we should insist on the user specifying the name.  If you think this should be changed, I think it is better to create a new ticket so this interface issue can be discussed separately from the technical changes made in this ticket.



---

archive/issue_comments_120393.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1cbe039cc9305bc898fbc01b7f138ced5db23eb\"><code>f1cbe03</code></a></td><td><code>Merge branch 'develop' into ticket/11670</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182\"><code>8e96824</code></a></td><td><code>Raise an error if the generator of a number field has not been specified.</code></td></tr></table>\n",
    "created_at": "2014-04-10T11:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120393",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1cbe039cc9305bc898fbc01b7f138ced5db23eb"><code>f1cbe03</code></a></td><td><code>Merge branch 'develop' into ticket/11670</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182"><code>8e96824</code></a></td><td><code>Raise an error if the generator of a number field has not been specified.</code></td></tr></table>




---

archive/issue_comments_120394.json:
```json
{
    "body": "Changed commit from **[`70702aa`](https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee)** to **[`8e96824`](https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182)**",
    "created_at": "2014-04-10T11:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120394",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70702aa`](https://github.com/sagemath/sagetrac-mirror/commit/70702aa690a31cc36b9febe36462c67ebd57dcee)** to **[`8e96824`](https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182)**



---

archive/issue_comments_120395.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@pjbruin](#comment%3A33):\n> With your changes, Sage doesn't complain anymore if the user does not specify the name of the generator, but silently names it \"a\":\n\nYou are right. I just implemented what the docstring used to say. I fixed the implementation and the docstring.",
    "created_at": "2014-04-10T11:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120395",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@pjbruin](#comment%3A33):
> With your changes, Sage doesn't complain anymore if the user does not specify the name of the generator, but silently names it "a":

You are right. I just implemented what the docstring used to say. I fixed the implementation and the docstring.



---

archive/issue_comments_120396.json:
```json
{
    "body": "Changed branch from **[u/saraedum/ticket/11670](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11670)** to **[u/pbruin/11670-NumberField_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11670-NumberField_unique)**",
    "created_at": "2014-04-10T17:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120396",
    "user": "https://github.com/pjbruin"
}
```

Changed branch from **[u/saraedum/ticket/11670](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11670)** to **[u/pbruin/11670-NumberField_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11670-NumberField_unique)**



---

archive/issue_comments_120397.json:
```json
{
    "body": "Changed reviewer from **Simon King** to **Simon King, Peter Bruin**",
    "created_at": "2014-04-10T17:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120397",
    "user": "https://github.com/pjbruin"
}
```

Changed reviewer from **Simon King** to **Simon King, Peter Bruin**



---

archive/issue_comments_120398.json:
```json
{
    "body": "Changed commit from **[`8e96824`](https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182)** to **[`9b4deff`](https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f)**",
    "created_at": "2014-04-10T17:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120398",
    "user": "https://github.com/pjbruin"
}
```

Changed commit from **[`8e96824`](https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182)** to **[`9b4deff`](https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f)**



---

archive/issue_comments_120399.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThanks.  I made a reviewer patch to fix some typos, formatting and Python 3 compatibility things; I changed the error message for `name=None` back to what it was to fix one failing doctest.\n\nI would be happy give this a positive review, but I think it is better if Simon or someone else with expertise in this area takes a quick look at it as well.",
    "created_at": "2014-04-10T17:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120399",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:36" align="right">comment:36</div>

Thanks.  I made a reviewer patch to fix some typos, formatting and Python 3 compatibility things; I changed the error message for `name=None` back to what it was to fix one failing doctest.

I would be happy give this a positive review, but I think it is better if Simon or someone else with expertise in this area takes a quick look at it as well.



---

archive/issue_comments_120400.json:
```json
{
    "body": "Work Issues: **merge conflicts with 6.2\u03b28**",
    "created_at": "2014-04-15T08:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120400",
    "user": "https://github.com/mezzarobba"
}
```

Work Issues: **merge conflicts with 6.2β8**



---

archive/issue_events_154924.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-04-15T08:31:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154924"
}
```



---

archive/issue_events_154925.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2014-04-15T08:31:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154925"
}
```



---

archive/issue_comments_120401.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e\"><code>8b06ff7</code></a></td><td><code>Merge branch 'develop' into ticket/11670-NumberField_unique</code></td></tr></table>\n",
    "created_at": "2014-04-22T16:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120401",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e"><code>8b06ff7</code></a></td><td><code>Merge branch 'develop' into ticket/11670-NumberField_unique</code></td></tr></table>




---

archive/issue_comments_120402.json:
```json
{
    "body": "Changed commit from **[`9b4deff`](https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f)** to **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**",
    "created_at": "2014-04-22T16:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120402",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9b4deff`](https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f)** to **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**



---

archive/issue_events_154926.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-04-22T16:13:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154926"
}
```



---

archive/issue_events_154927.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-04-22T16:13:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154927"
}
```



---

archive/issue_comments_120403.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e\"><code>8b06ff7</code></a></td><td><code>Merge branch 'develop' into ticket/11670-NumberField_unique</code></td></tr></table>\n",
    "created_at": "2014-04-22T16:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120403",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:39"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e"><code>8b06ff7</code></a></td><td><code>Merge branch 'develop' into ticket/11670-NumberField_unique</code></td></tr></table>




---

archive/issue_comments_120404.json:
```json
{
    "body": "Changed work issues from **merge conflicts with 6.2\u03b28** to none",
    "created_at": "2014-04-22T16:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120404",
    "user": "https://github.com/pjbruin"
}
```

Changed work issues from **merge conflicts with 6.2β8** to none



---

archive/issue_comments_120405.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nOK, let's not leave this to bitrot.  As an additional test, I checked that #11669 (which depends on this ticket) still works correctly, and it does.",
    "created_at": "2014-05-02T13:57:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120405",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:40" align="right">comment:40</div>

OK, let's not leave this to bitrot.  As an additional test, I checked that #11669 (which depends on this ticket) still works correctly, and it does.



---

archive/issue_events_154928.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-02T13:57:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154928"
}
```



---

archive/issue_events_154929.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-02T13:57:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154929"
}
```



---

archive/issue_events_154930.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154930"
}
```



---

archive/issue_events_154931.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154931"
}
```



---

archive/issue_comments_120406.json:
```json
{
    "body": "Changed branch from **[u/pbruin/11670-NumberField_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11670-NumberField_unique)** to **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**",
    "created_at": "2014-05-06T22:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11670#issuecomment-120406",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/11670-NumberField_unique](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11670-NumberField_unique)** to **[`8b06ff7`](https://github.com/sagemath/sagetrac-mirror/commit/8b06ff7d7fef13bd3746a1524bc5744242f1a75e)**



---

archive/issue_events_154932.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-06T22:02:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154932"
}
```



---

archive/issue_events_154933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d3886dffe89759a96ece8b53e6ebd7c52992f4a0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-06T22:02:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11670#event-154933"
}
```
