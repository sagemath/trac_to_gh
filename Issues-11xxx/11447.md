# Issue 11447: python spkg build fails on various Debian systems

archive/issues_011275.json:
```json
{
    "body": "Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.\n\nThis is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n\n---\n\n**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n\n**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`\n\n(With Jan Medlock's patch of June 17th applied, **and now also** [attachment:trac_11447-give_hint_on_dpkg-dev.patch]. The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)\n\n\n---\n\nNo patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n\n**Assignee:** @jdemeyer\n\n**CC:**  drkirkby jpflori\n\n**Keywords:** python spkg crypt library\n\n**Author:** Jan Medlock\n\n**Reviewer:** David Kirkby, Bill Odefey, Jan Groenewald\n\n**Merged:** sage-4.7.1.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11447\n\n",
    "closed_at": "2011-07-08T12:00:38Z",
    "created_at": "2011-06-08T04:28:43Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "python spkg build fails on various Debian systems",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11447",
    "user": "https://github.com/pipedream"
}
```
Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.

This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.

---

**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**

**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`

(With Jan Medlock's patch of June 17th applied, **and now also** [attachment:trac_11447-give_hint_on_dpkg-dev.patch]. The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)


---

No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 

**Assignee:** @jdemeyer

**CC:**  drkirkby jpflori

**Keywords:** python spkg crypt library

**Author:** Jan Medlock

**Reviewer:** David Kirkby, Bill Odefey, Jan Groenewald

**Merged:** sage-4.7.1.rc0

Issue created by migration from https://trac.sagemath.org/ticket/11447





---

archive/attachments_015060.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11447-python-mint11.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11447/11447-python-mint11.patch",
    "created_at": "2011-06-08T04:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/pipedream"
}
```



---

archive/issue_comments_145882.json:
```json
{
    "body": "Patch for building crypt module on Linux Mint 11",
    "created_at": "2011-06-08T04:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145882",
    "user": "https://github.com/pipedream"
}
```

Patch for building crypt module on Linux Mint 11



---

archive/issue_comments_145883.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-06-08T04:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145883",
    "user": "https://github.com/pipedream"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_145884.json:
```json
{
    "body": "<a id='comment:1'></a>\nPlease test http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\non Ubuntu 11.04, Linux Mint 11, and other systems.\n\n( Dave: I changed a grep to egrep. Is this POSIX? Is grep -E better?\nIs splitting it into two separate greps better? )",
    "created_at": "2011-06-08T04:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145884",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:1'></a>
Please test http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
on Ubuntu 11.04, Linux Mint 11, and other systems.

( Dave: I changed a grep to egrep. Is this POSIX? Is grep -E better?
Is splitting it into two separate greps better? )



---

archive/issue_comments_145885.json:
```json
{
    "body": "**Changing assignee** from GeorgSWeber to @pipedream.",
    "created_at": "2011-06-08T04:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145885",
    "user": "https://github.com/pipedream"
}
```

**Changing assignee** from GeorgSWeber to @pipedream.



---

archive/issue_comments_145886.json:
```json
{
    "body": "<a id='comment:3'></a>\nJan, if you want to make sure someone sees a ticket, you will need to cc: them like I am doing with drkirkby now.\n\nYou could also put the person for whom it worked properly (as you mentioned on sage-devel) as a reviewer - why not?  They helped, after all, even if they can't check that the code is fine (which it certainly seems to me, but I don't know what etc/issue is for sure).",
    "created_at": "2011-06-08T18:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145886",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Jan, if you want to make sure someone sees a ticket, you will need to cc: them like I am doing with drkirkby now.

You could also put the person for whom it worked properly (as you mentioned on sage-devel) as a reviewer - why not?  They helped, after all, even if they can't check that the code is fine (which it certainly seems to me, but I don't know what etc/issue is for sure).



---

archive/issue_comments_145887.json:
```json
{
    "body": "**Work_Issues:** Remove extra | character. Create a complete package.",
    "created_at": "2011-06-08T22:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145887",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Work_Issues:** Remove extra | character. Create a complete package.



---

archive/issue_comments_145888.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-06-08T22:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145888",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_145889.json:
```json
{
    "body": "<a id='comment:4'></a>\nThese should not be two '|' characters in the egrep expression. \n\n\n```\ndrkirkby@hawk:~$ echo foo | egrep \"Ubuntu 11.04||Linux Mint 11 Katya\"\negrep: syntax error\ndrkirkby@hawk:~$ \n```\n\nThere should be only one. \n\nYou also need to create a new package, so we can test the complete package, but this looks pretty simple to me. \n\nIt would be good if we could attempt to find other popular Ubuntu derivatives that will get the problem and include the patch for them too. But that's not important - just nice if possible to do easily. \n\nDave",
    "created_at": "2011-06-08T22:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145889",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:4'></a>
These should not be two '|' characters in the egrep expression. 


```
drkirkby@hawk:~$ echo foo | egrep "Ubuntu 11.04||Linux Mint 11 Katya"
egrep: syntax error
drkirkby@hawk:~$ 
```

There should be only one. 

You also need to create a new package, so we can test the complete package, but this looks pretty simple to me. 

It would be good if we could attempt to find other popular Ubuntu derivatives that will get the problem and include the patch for them too. But that's not important - just nice if possible to do easily. 

Dave



---

archive/issue_comments_145890.json:
```json
{
    "body": "**Reviewer:** David Kirkby",
    "created_at": "2011-06-08T22:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145890",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Reviewer:** David Kirkby



---

archive/issue_comments_145891.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-06-09T04:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145891",
    "user": "https://github.com/pipedream"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_145892.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks Dave, new patch following. I made a typo with the pipe, but it \ndid not throw a syntax error on Ubuntu (I think it parsed \n\"Ubuntu 11.04\" or \"\" or \"Linux Mint 11 Katya\". The empty string matched\nevery line though which is another problem. This is however why\nthe spkg compiled properly for the Linux Mint tester/reviewer.\n\nI'm not sure he has a trac account (for reviewing).\n\nNew patch attached for review purposes, and spkg at \nhttp://users.aims.ac.za/~jan/python-2.6.4.p11.spkg",
    "created_at": "2011-06-09T04:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145892",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:5'></a>
Thanks Dave, new patch following. I made a typo with the pipe, but it 
did not throw a syntax error on Ubuntu (I think it parsed 
"Ubuntu 11.04" or "" or "Linux Mint 11 Katya". The empty string matched
every line though which is another problem. This is however why
the spkg compiled properly for the Linux Mint tester/reviewer.

I'm not sure he has a trac account (for reviewing).

New patch attached for review purposes, and spkg at 
http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg



---

archive/issue_comments_145893.json:
```json
{
    "body": "Replaces previous patch to build on Linux Mint 11",
    "created_at": "2011-06-09T04:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145893",
    "user": "https://github.com/pipedream"
}
```

Replaces previous patch to build on Linux Mint 11



---

archive/attachments_015061.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11447-python-mint11b.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11447/11447-python-mint11b.patch",
    "created_at": "2011-06-09T12:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_145894.json:
```json
{
    "body": "<a id='comment:6'></a>\n> I'm not sure he has a trac account (for reviewing).\n\n\nWhat I meant was that you could put his name down as a reviewer, assuming you do not have actual access to a Mint machine and neither does David.",
    "created_at": "2011-06-09T12:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145894",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
> I'm not sure he has a trac account (for reviewing).


What I meant was that you could put his name down as a reviewer, assuming you do not have actual access to a Mint machine and neither does David.



---

archive/issue_comments_145895.json:
```json
{
    "body": "**Changing reviewer** from \"David Kirkby\" to \"David Kirkby, Bill Odefey\".",
    "created_at": "2011-06-09T14:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145895",
    "user": "https://github.com/pipedream"
}
```

**Changing reviewer** from "David Kirkby" to "David Kirkby, Bill Odefey".



---

archive/issue_comments_145896.json:
```json
{
    "body": "<a id='comment:8'></a>\nBill Odefey reports that the new spkg worked for him again on Linux Mint 11.",
    "created_at": "2011-06-09T16:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145896",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:8'></a>
Bill Odefey reports that the new spkg worked for him again on Linux Mint 11.



---

archive/issue_comments_145897.json:
```json
{
    "body": "<a id='comment:9'></a>\negrep is not a POSIX command, but I think in this instance it is acceptable to use it. \n\nThe use of 'grep -E' confirms to the latest POSIX, but would fail on Solaris if someone has /usr/bin in their path before /usr/xpg4/bin. This is because to maintain backwards compatibility with older Solaris releases, whilst still conforming to the various POSIX versions, there are two or sometimes three versions of some commands on Solaris. \n\nMore portable would be to split the two greps up, but I think that would unnecessarily complicate things.\n\nPositive review.",
    "created_at": "2011-06-10T11:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145897",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>
egrep is not a POSIX command, but I think in this instance it is acceptable to use it. 

The use of 'grep -E' confirms to the latest POSIX, but would fail on Solaris if someone has /usr/bin in their path before /usr/xpg4/bin. This is because to maintain backwards compatibility with older Solaris releases, whilst still conforming to the various POSIX versions, there are two or sometimes three versions of some commands on Solaris. 

More portable would be to split the two greps up, but I think that would unnecessarily complicate things.

Positive review.



---

archive/issue_comments_145898.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,8 @@\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n \n-A patch will follow shortly to change the #11243 patch to also apply on Linux Mint 11.\n+The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n+\n+http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n+\n+No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n``````\n",
    "created_at": "2011-06-10T11:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145898",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,8 @@
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
 
-A patch will follow shortly to change the #11243 patch to also apply on Linux Mint 11.
+The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
+
+http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
+
+No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 
``````




---

archive/issue_comments_145899.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-06-10T11:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145899",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_145900.json:
```json
{
    "body": "**Changing work_issues** from \"Remove extra | character. Create a complete package.\" to \"\".",
    "created_at": "2011-06-14T21:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145900",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work_issues** from "Remove extra | character. Create a complete package." to "".



---

archive/issue_comments_145901.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooking at `/etc/issue` is a *very bad* way of checking the system.  This is a file which is sometimes customized by system administrators.  You should try to understand *why* Python doesn't build on such a system and check for the true cause.",
    "created_at": "2011-06-14T21:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145901",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Looking at `/etc/issue` is a *very bad* way of checking the system.  This is a file which is sometimes customized by system administrators.  You should try to understand *why* Python doesn't build on such a system and check for the true cause.



---

archive/issue_comments_145902.json:
```json
{
    "body": "<a id='comment:11'></a>\nYes, it is hidden in the original thread which lead to ticket #11243.\nhttp://trac.sagemath.org/sage_trac/ticket/11243\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/593b9a4124f5075d\n\nIf the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n(It is a patch that Debian and Ubuntu and therefore all derivatives apply to their own python debs for python to build.)\n\nIt comes down to this http://bugs.python.org/issue9762 .\nIt may be fixed in python 2.7 http://hg.python.org/cpython/rev/bd0f73a9538e\nbut those are beyond my experience.",
    "created_at": "2011-06-15T05:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145902",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:11'></a>
Yes, it is hidden in the original thread which lead to ticket #11243.
http://trac.sagemath.org/sage_trac/ticket/11243
http://groups.google.com/group/sage-devel/browse_thread/thread/593b9a4124f5075d

If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?
(It is a patch that Debian and Ubuntu and therefore all derivatives apply to their own python debs for python to build.)

It comes down to this http://bugs.python.org/issue9762 .
It may be fixed in python 2.7 http://hg.python.org/cpython/rev/bd0f73a9538e
but those are beyond my experience.



---

archive/issue_comments_145903.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [pipedream](#comment%3A11):\n> If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n\nWell, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?",
    "created_at": "2011-06-15T07:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145903",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [pipedream](#comment%3A11):
> If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?

Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?



---

archive/issue_comments_145904.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2011-06-15T07:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145904",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_145905.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> Replying to [pipedream](#comment%3A11):\n> > If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n\n> Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?\n\nThe solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n\nThis requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...",
    "created_at": "2011-06-17T04:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145905",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> Replying to [pipedream](#comment%3A11):
> > If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?

> Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?

The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.

This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...



---

archive/issue_comments_145906.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [medlock](#comment%3A13):\n> ...\n> The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n> \n> This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...\n\n\nAll this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...",
    "created_at": "2011-06-17T04:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145906",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:14'></a>
Replying to [medlock](#comment%3A13):
> ...
> The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.
> 
> This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...


All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...



---

archive/issue_comments_145907.json:
```json
{
    "body": "Debian patch to Python 2.6 to fix paths",
    "created_at": "2011-06-17T04:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145907",
    "user": "https://github.com/janmedlock"
}
```

Debian patch to Python 2.6 to fix paths



---

archive/attachments_015062.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deb-setup.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11447/deb-setup.diff",
    "created_at": "2011-06-17T04:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/janmedlock"
}
```



---

archive/issue_comments_145908.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [medlock](#comment%3A14):\n> Replying to [medlock](#comment%3A13):\n> > ...\n> > The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n> > \n> > This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...\n\n> \n> All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...\n\n\nSee also [http://lists.debian.org/debian-devel/2011/06/msg00431.html](http://lists.debian.org/debian-devel/2011/06/msg00431.html).",
    "created_at": "2011-06-17T04:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145908",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:15'></a>
Replying to [medlock](#comment%3A14):
> Replying to [medlock](#comment%3A13):
> > ...
> > The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.
> > 
> > This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...

> 
> All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...


See also [http://lists.debian.org/debian-devel/2011/06/msg00431.html](http://lists.debian.org/debian-devel/2011/06/msg00431.html).



---

archive/issue_comments_145909.json:
```json
{
    "body": "<a id='comment:16'></a>\nNote that in #11243 we realised lsb_release does not work -- it tries to import an underlying system python package; but SAGE spkg installs run in a SAGE python environment and does not know\nthe path to import lsb_release. That is why we switched to check whether /etc/issue exists, and then to use that. \n\nIt is a good question whether the patch to use -lcrypt will break other Linux distros? Then a standard uname check for Linux could be used and the patch applied on all Linux patched while SAGE still uses python 2.6.\n\nWhat is the timeline for SAGE to get to python 2.7?",
    "created_at": "2011-06-17T06:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145909",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:16'></a>
Note that in #11243 we realised lsb_release does not work -- it tries to import an underlying system python package; but SAGE spkg installs run in a SAGE python environment and does not know
the path to import lsb_release. That is why we switched to check whether /etc/issue exists, and then to use that. 

It is a good question whether the patch to use -lcrypt will break other Linux distros? Then a standard uname check for Linux could be used and the patch applied on all Linux patched while SAGE still uses python 2.6.

What is the timeline for SAGE to get to python 2.7?



---

archive/attachments_015063.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11447-Python-Debian-multiarch.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11447/11447-Python-Debian-multiarch.patch",
    "created_at": "2011-06-17T23:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/janmedlock"
}
```



---

archive/issue_comments_145910.json:
```json
{
    "body": "Patch to python-2.6.4.p10.spkg to fix multiarch build.  Solution copied from Python 2.7.",
    "created_at": "2011-06-17T23:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145910",
    "user": "https://github.com/janmedlock"
}
```

Patch to python-2.6.4.p10.spkg to fix multiarch build.  Solution copied from Python 2.7.



---

archive/issue_comments_145911.json:
```json
{
    "body": "<a id='comment:17'></a>\n11447-Python-Debian-multiarch.patch uses the solution from Python 2.7 to fix build on Debian and derivatives with multiarch.\n\nThe patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\nNote that on Debian and derivatives, if the command dpkg-architecture, from the package dpkg-dev, is not available, the build will fail as before.  Again, this is how Python 2.7 is set up.\n\nThis looks like the best solution to me.",
    "created_at": "2011-06-17T23:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145911",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:17'></a>
11447-Python-Debian-multiarch.patch uses the solution from Python 2.7 to fix build on Debian and derivatives with multiarch.

The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.

Note that on Debian and derivatives, if the command dpkg-architecture, from the package dpkg-dev, is not available, the build will fail as before.  Again, this is how Python 2.7 is set up.

This looks like the best solution to me.



---

archive/issue_comments_145912.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-06-18T10:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145912",
    "user": "https://github.com/pipedream"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_145913.json:
```json
{
    "body": "<a id='comment:18'></a>\nLooks good to me. This does mean -lcrypt in Setup.dist is uncommented on all\nsystems, Debian or not, Linux or not. Does that have unintended side effects?",
    "created_at": "2011-06-18T10:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145913",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:18'></a>
Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all
systems, Debian or not, Linux or not. Does that have unintended side effects?



---

archive/issue_comments_145914.json:
```json
{
    "body": "**Changing reviewer** from \"David Kirkby, Bill Odefey\" to \"David Kirkby, Bill Odefey, Jan Groenewald\".",
    "created_at": "2011-06-18T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145914",
    "user": "https://github.com/pipedream"
}
```

**Changing reviewer** from "David Kirkby, Bill Odefey" to "David Kirkby, Bill Odefey, Jan Groenewald".



---

archive/issue_comments_145915.json:
```json
{
    "body": "**Changing author** from \"Jan Groenewald\" to \"Jan Medlock\".",
    "created_at": "2011-06-18T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145915",
    "user": "https://github.com/pipedream"
}
```

**Changing author** from "Jan Groenewald" to "Jan Medlock".



---

archive/issue_comments_145916.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [pipedream](#comment%3A18):\n> Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all\n> systems, Debian or not, Linux or not. Does that have unintended side effects?\n\n\nNo, -lcrypt is not uncommented in Setup.dist on any system.\n\nThe library search directories are now set up in setup.py on Debian and derivatives to correctly find libcrypt automatically.  There is no change to the library search directories on other systems.  This is done by testing for the presence of the command 'dpkg-architecture'.\n\nI don't see any side effects and this is how it is done in Python 2.7.\n\n(Setup.dist is a work around for setup.py not automatically finding the libraries.)",
    "created_at": "2011-06-18T17:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145916",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:20'></a>
Replying to [pipedream](#comment%3A18):
> Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all
> systems, Debian or not, Linux or not. Does that have unintended side effects?


No, -lcrypt is not uncommented in Setup.dist on any system.

The library search directories are now set up in setup.py on Debian and derivatives to correctly find libcrypt automatically.  There is no change to the library search directories on other systems.  This is done by testing for the presence of the command 'dpkg-architecture'.

I don't see any side effects and this is how it is done in Python 2.7.

(Setup.dist is a work around for setup.py not automatically finding the libraries.)



---

archive/issue_comments_145917.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-07-01T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145917",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_145918.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"crypt library\".",
    "created_at": "2011-07-01T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145918",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "crypt library".



---

archive/issue_comments_145919.json:
```json
{
    "body": "**Work_Issues:** Provide an updated spkg",
    "created_at": "2011-07-01T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145919",
    "user": "https://github.com/nexttime"
}
```

**Work_Issues:** Provide an updated spkg



---

archive/issue_comments_145920.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [medlock](#comment%3A17):\n> The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\n\nJust to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.\n\n(Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)\n\n\n\n\n> Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.\n\n\nAgain, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.\n\n---\n\nCould someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?\n\n**http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**",
    "created_at": "2011-07-01T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145920",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [medlock](#comment%3A17):
> The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.


Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.

(Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)




> Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.


Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.

---

Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?

**http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**



---

archive/issue_comments_145921.json:
```json
{
    "body": "<a id='comment:23'></a>\nP.S.:\n\nI think if the test importing the `crypt` module (in `spkg-install`) fails and `dpkg-architecture` isn't installed, the user should get a hint on installing it (i.e., `dpkg-dev`; maybe only on newer Debian derivatives, but this could also just be part of the message.)\n\nOtherwise we should at least document this in the Sage Installation Guide, and perhaps also on one of the wiki pages.",
    "created_at": "2011-07-01T13:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145921",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
P.S.:

I think if the test importing the `crypt` module (in `spkg-install`) fails and `dpkg-architecture` isn't installed, the user should get a hint on installing it (i.e., `dpkg-dev`; maybe only on newer Debian derivatives, but this could also just be part of the message.)

Otherwise we should at least document this in the Sage Installation Guide, and perhaps also on one of the wiki pages.



---

archive/issue_comments_145922.json:
```json
{
    "body": "**Changing work_issues** from \"Provide an updated spkg\" to \"\".",
    "created_at": "2011-07-01T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145922",
    "user": "https://github.com/nexttime"
}
```

**Changing work_issues** from "Provide an updated spkg" to "".



---

archive/issue_comments_145923.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,23 @@\n-Linux Mint 11 fails to build python.\n+Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n+\n+---\n+\n+Old spkg (now obsolete):\n \n The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n \n http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n \n+---\n+\n+**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n+\n+**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n+\n+(With Jan Medlock's patch of June 17th applied.)\n+\n+---\n+\n No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n``````\n",
    "created_at": "2011-07-01T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145923",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,23 @@
-Linux Mint 11 fails to build python.
+Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
+
+---
+
+Old spkg (now obsolete):
 
 The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
 
 http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
 
+---
+
+**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**
+
+**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
+
+(With Jan Medlock's patch of June 17th applied.)
+
+---
+
 No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 
``````




---

archive/issue_comments_145924.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-07-01T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145924",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_145925.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [leif](#comment%3A22):\n> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?\n> \n> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**\n\n\n\nOk, did it myself:\n\n**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n\n**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n\n(I haven't made any changes, just applied Jan Medlock's patch of June 17th.)",
    "created_at": "2011-07-01T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145925",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Replying to [leif](#comment%3A22):
> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?
> 
> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**



Ok, did it myself:

**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**

**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`

(I haven't made any changes, just applied Jan Medlock's patch of June 17th.)



---

archive/issue_comments_145926.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [leif](#comment%3A22):\n> Replying to [medlock](#comment%3A17):\n> > The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\n> \n> Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.\n> \n> (Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)\n> \n> \n\n\n> \n> > Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.\n\n> \n> Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.\n> \n> \n> ---\n> \n> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?\n> \n> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**\n\n\nThanks for the clarification.  I can confirm for the record that this is the intended behavior.",
    "created_at": "2011-07-01T16:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145926",
    "user": "https://github.com/janmedlock"
}
```

<a id='comment:25'></a>
Replying to [leif](#comment%3A22):
> Replying to [medlock](#comment%3A17):
> > The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.

> 
> Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.
> 
> (Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)
> 
> 


> 
> > Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.

> 
> Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.
> 
> 
> ---
> 
> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment:11447-Python-Debian-multiarch.patch] to p10 I guess)?
> 
> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**


Thanks for the clarification.  I can confirm for the record that this is the intended behavior.



---

archive/issue_events_035531.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "rename": {
        "from": "python spkg build fails on Ubuntu 11.04 derivative Mint 11",
        "to": "python spkg build fails on various Debian systems"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11447#event-35531"
}
```



---

archive/issue_comments_145927.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,14 +1,6 @@\n-Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.\n+Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n-\n----\n-\n-Old spkg (now obsolete):\n-\n-The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n-\n-http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T07:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145927",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,14 +1,6 @@
-Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.
+Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
-
----
-
-Old spkg (now obsolete):
-
-The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
-
-http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
 
 ---
 
``````




---

archive/issue_comments_145928.json:
```json
{
    "body": "<a id='comment:27'></a>\nI will test the new package on the buildbots and give positive_review if these are successful.",
    "created_at": "2011-07-05T07:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145928",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
I will test the new package on the buildbots and give positive_review if these are successful.



---

archive/issue_comments_145929.json:
```json
{
    "body": "**Changing keywords** from \"crypt library\" to \"python spkg crypt library\".",
    "created_at": "2011-07-05T07:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145929",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "crypt library" to "python spkg crypt library".



---

archive/issue_events_035532.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11447#event-35532"
}
```



---

archive/issue_comments_145930.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [jdemeyer](#comment%3A27):\n> I will test the new package on the buildbots and give positive_review if these are successful.\n\n\nSo adding a note on installing `dpkg-dev` to the \"Known Issues\" / wiki page(s) is sufficient? (I can't judge how common it is to *not* have it installed.)\n\nIt's perhaps to specific to get into the Sage Installation Guide.\n\n\nP.S.: You don't need to add keywords that are already in the ticket's title.",
    "created_at": "2011-07-05T07:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145930",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Replying to [jdemeyer](#comment%3A27):
> I will test the new package on the buildbots and give positive_review if these are successful.


So adding a note on installing `dpkg-dev` to the "Known Issues" / wiki page(s) is sufficient? (I can't judge how common it is to *not* have it installed.)

It's perhaps to specific to get into the Sage Installation Guide.


P.S.: You don't need to add keywords that are already in the ticket's title.



---

archive/issue_comments_145931.json:
```json
{
    "body": "<a id='comment:30'></a>\nIt would be great if the patch included a suggestion to \"sudo apt-get install dpkg-dev\" if it is not installed.",
    "created_at": "2011-07-05T08:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145931",
    "user": "https://github.com/pipedream"
}
```

<a id='comment:30'></a>
It would be great if the patch included a suggestion to "sudo apt-get install dpkg-dev" if it is not installed.



---

archive/issue_comments_145932.json:
```json
{
    "body": "**Changing assignee** from @pipedream to @jdemeyer.",
    "created_at": "2011-07-05T08:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145932",
    "user": "https://github.com/pipedream"
}
```

**Changing assignee** from @pipedream to @jdemeyer.



---

archive/issue_comments_145933.json:
```json
{
    "body": "<a id='comment:32'></a>\nP.S.:\n\nTo detect Debian and any of its derivatives (in order to give an appropriate message if importing `crypt` fails) testing `command -v dpkg` should suffice.",
    "created_at": "2011-07-05T08:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145933",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
P.S.:

To detect Debian and any of its derivatives (in order to give an appropriate message if importing `crypt` fails) testing `command -v dpkg` should suffice.



---

archive/issue_comments_145934.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [pipedream](#comment%3A30):\n> It would be great if the patch included a suggestion to \"sudo apt-get install dpkg-dev\" if it is not installed.\n\n\nPatch is on the way...\n\nCannot really test it myself though, as I have no newer Debian here.",
    "created_at": "2011-07-05T09:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145934",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'></a>
Replying to [pipedream](#comment%3A30):
> It would be great if the patch included a suggestion to "sudo apt-get install dpkg-dev" if it is not installed.


Patch is on the way...

Cannot really test it myself though, as I have no newer Debian here.



---

archive/issue_comments_145935.json:
```json
{
    "body": "SPKG patch. Adds message, some minor changes. Apply on top of Jan Medlock's patch.",
    "created_at": "2011-07-05T09:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145935",
    "user": "https://github.com/nexttime"
}
```

SPKG patch. Adds message, some minor changes. Apply on top of Jan Medlock's patch.



---

archive/attachments_015064.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11447-give_hint_on_dpkg-dev.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch",
    "created_at": "2011-07-05T10:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_145936.json:
```json
{
    "body": "<a id='comment:34'></a>\nPatch is up. Relevant part:\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -242,12 +248,28 @@\n # All these modules are important and if any one \n # fails to build, Sage will not work. \n \n+import_errors=false\n for module in math hashlib crypt ; do \n    \"$SAGE_LOCAL/bin/python\" -c \"import $module\"\n    if [ $? -eq 0 ] ; then\n       echo \"$module module imported OK\"\n    else\n-      echo \"$module module failed to import\"\n-      exit 1\n+      echo >&2 \"$module module failed to import\"\n+      import_errors=true\n+      # exit 1 # not yet\n    fi\n done\n+\n+if $import_errors; then\n+    echo >&2 \"Error: One or more modules failed to import.\"\n+    # Check if we are on Debian or one of its derivatives:\n+    if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n+        echo >&2 \"You may have to install 'dpkg-architecture'\"\n+        echo >&2 \"which is part of the Debian package 'dpkg-dev'.\"\n+        echo >&2 \"Try installing it by typing\"\n+        echo >&2 \"    sudo apt-get install dpkg-dev\"\n+        echo >&2 \"and rerun 'make'.\"\n+    fi\n+    exit 1\n+fi\n```\n\n**I haven't uploaded the new spkg to G**gle code yet.**\n\nMaybe Jeroen wants to create it on `sage.math`. (My patch [attachment:trac_11447-give_hint_on_dpkg-dev.patch] is based on the p11 I previously uploaded.)",
    "created_at": "2011-07-05T10:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145936",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:34'></a>
Patch is up. Relevant part:

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -242,12 +248,28 @@
 # All these modules are important and if any one 
 # fails to build, Sage will not work. 
 
+import_errors=false
 for module in math hashlib crypt ; do 
    "$SAGE_LOCAL/bin/python" -c "import $module"
    if [ $? -eq 0 ] ; then
       echo "$module module imported OK"
    else
-      echo "$module module failed to import"
-      exit 1
+      echo >&2 "$module module failed to import"
+      import_errors=true
+      # exit 1 # not yet
    fi
 done
+
+if $import_errors; then
+    echo >&2 "Error: One or more modules failed to import."
+    # Check if we are on Debian or one of its derivatives:
+    if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
+        echo >&2 "You may have to install 'dpkg-architecture'"
+        echo >&2 "which is part of the Debian package 'dpkg-dev'."
+        echo >&2 "Try installing it by typing"
+        echo >&2 "    sudo apt-get install dpkg-dev"
+        echo >&2 "and rerun 'make'."
+    fi
+    exit 1
+fi
```

**I haven't uploaded the new spkg to G**gle code yet.**

Maybe Jeroen wants to create it on `sage.math`. (My patch [attachment:trac_11447-give_hint_on_dpkg-dev.patch] is based on the p11 I previously uploaded.)



---

archive/issue_comments_145937.json:
```json
{
    "body": "<a id='comment:35'></a>\nOoops, I just noticed the output of `command -v dpkg` is not redirected. But IMHO negligible.",
    "created_at": "2011-07-05T10:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145937",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
Ooops, I just noticed the output of `command -v dpkg` is not redirected. But IMHO negligible.



---

archive/issue_comments_145938.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n \n **md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n \n-(With Jan Medlock's patch of June 17th applied.)\n+(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment:trac_11447-give_hint_on_dpkg-dev.patch].)\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T10:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145938",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 
 **md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
 
-(With Jan Medlock's patch of June 17th applied.)
+(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment:trac_11447-give_hint_on_dpkg-dev.patch].)
 
 ---
 
``````




---

archive/issue_comments_145939.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [leif](#comment%3A34):\n> **I haven't uploaded the new spkg to G**gle code yet.**\n\n\nOk, will do now...",
    "created_at": "2011-07-05T11:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145939",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>
Replying to [leif](#comment%3A34):
> **I haven't uploaded the new spkg to G**gle code yet.**


Ok, will do now...



---

archive/issue_comments_145940.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [leif](#comment%3A37):\n> Replying to [leif](#comment%3A34):\n> > **I haven't uploaded the new spkg to G**gle code yet.**\n\n> \n> Ok, will do now...\n\n\nDone. New `md5sum: e808dc5edba8c82c098f0c9641b34634` (Same name, same place.)",
    "created_at": "2011-07-05T11:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145940",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
Replying to [leif](#comment%3A37):
> Replying to [leif](#comment%3A34):
> > **I haven't uploaded the new spkg to G**gle code yet.**

> 
> Ok, will do now...


Done. New `md5sum: e808dc5edba8c82c098f0c9641b34634` (Same name, same place.)



---

archive/issue_comments_145941.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,9 +6,10 @@\n \n **Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n \n-**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n+**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`\n \n-(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment:trac_11447-give_hint_on_dpkg-dev.patch].)\n+(With Jan Medlock's patch of June 17th applied, **and now also** [attachment:trac_11447-give_hint_on_dpkg-dev.patch]. The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)\n+\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T11:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145941",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,9 +6,10 @@
 
 **Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**
 
-**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
+**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`
 
-(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment:trac_11447-give_hint_on_dpkg-dev.patch].)
+(With Jan Medlock's patch of June 17th applied, **and now also** [attachment:trac_11447-give_hint_on_dpkg-dev.patch]. The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)
+
 
 ---
 
``````




---

archive/issue_comments_145942.json:
```json
{
    "body": "<a id='comment:39'></a>\nMessy in various places, but at least it improves over the existing version, so positive_review.",
    "created_at": "2011-07-07T09:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145942",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Messy in various places, but at least it improves over the existing version, so positive_review.



---

archive/issue_comments_145943.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-07-07T09:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145943",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_145944.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [jdemeyer](#comment%3A39):\n> Messy in various places, \n\n\nDetails, please. ;-)",
    "created_at": "2011-07-07T09:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145944",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>
Replying to [jdemeyer](#comment%3A39):
> Messy in various places, 


Details, please. ;-)



---

archive/issue_comments_145945.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [leif](#comment%3A40):\n> Replying to [jdemeyer](#comment%3A39):\n> Details, please. ;-)\n\n\n\n```\nif command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n```\nshould be\n\n```\nif command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then\n```\nor\n\n```\nif ( command -v dpkg && ! command -v dpkg-architecture ) >/dev/null; then\n```\n\nMixed usage of `cp` of `patch`, better always use `patch`.\n\nOn SunOS, you first patch `setup.py` and then copy a different version over it.\n\nPatching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.\n\nWhy call `./configure` with arguments `CC=\"$CC $CFLAGS\" CXX=\"$CXX $CXXFLAGS\"`?  Any why only on certain systems?\n\n```\nMAKE=make; export MAKE\nmake -i install\n```\nshould be\n\n```\n$MAKE -j1 -i install\n```\n\nRemove this:\n\n```\n# Do not exit script if there is an error, but instead print an\n# informative error message. This is helps in determining why the\n# configuration, compilation or installation failed. So put this before the\n# build() function.\nset +e # This is redundant here, but doesn't hurt to keep it... ;-)\n```\n\nWhy this:\n\n```\necho \"Sleeping for three seconds before testing python\"\nsleep 3\n```\n\nI guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?\n\nOn SunOS, do we need the configure flag `--with-gcc=\"gcc -m64\"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?",
    "created_at": "2011-07-07T10:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145945",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
Replying to [leif](#comment%3A40):
> Replying to [jdemeyer](#comment%3A39):
> Details, please. ;-)



```
if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
```
should be

```
if command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then
```
or

```
if ( command -v dpkg && ! command -v dpkg-architecture ) >/dev/null; then
```

Mixed usage of `cp` of `patch`, better always use `patch`.

On SunOS, you first patch `setup.py` and then copy a different version over it.

Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.

Why call `./configure` with arguments `CC="$CC $CFLAGS" CXX="$CXX $CXXFLAGS"`?  Any why only on certain systems?

```
MAKE=make; export MAKE
make -i install
```
should be

```
$MAKE -j1 -i install
```

Remove this:

```
# Do not exit script if there is an error, but instead print an
# informative error message. This is helps in determining why the
# configuration, compilation or installation failed. So put this before the
# build() function.
set +e # This is redundant here, but doesn't hurt to keep it... ;-)
```

Why this:

```
echo "Sleeping for three seconds before testing python"
sleep 3
```

I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?

On SunOS, do we need the configure flag `--with-gcc="gcc -m64"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?



---

archive/issue_comments_145946.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [jdemeyer](#comment%3A41):\n> Replying to [leif](#comment%3A40):\n> > Replying to [jdemeyer](#comment%3A39):\n> > Details, please. ;-)\n\n> \n\n```\nif command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n```\n> should be\n\n\n```\n if command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then\n```\nYes, I mentioned on the ticket that I forgot it; minor.\n\n> Mixed usage of `cp` of `patch`, better always use `patch`.\n\n\nAgreed, but didn't want to change too much, since it is a blocker and needs quick review.\n\n> On SunOS, you first patch `setup.py` and then copy a different version over it.\n\n\nNo idea. Ask Dave. (The real patch is only necessary on Debian Linuces, so at least that shouldn't break anything.)\n\n> Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.\n\n\nHmmm, depends on the situation. Order might matter, and not all patches are applied on all systems. You'd also have to delete (or rename) patches that [currently] don't get applied anymore. Having a bit of redundancy in `spkg-install` and `SPKG.txt` also isn't that bad, as it should reduce the risk of unintentional changes.\n\nBut we still have the `cp`s in there anyway, so this should be changed when all patches get real patches.\n\n\n\n> Why call `./configure` with arguments `CC=\"$CC $CFLAGS\" CXX=\"$CXX $CXXFLAGS\"`?  Any why only on certain systems?\n\n\nGuess that's some libtool issue, which sometimes drops e.g. `-m64`, but apparently not on all systems (or it doesn't matter on all).\n\n>\n\n```\n MAKE=make; export MAKE\n make -i install\n```\nshould be\n\n```\n$MAKE -j1 -i install\n```\nI know. I always get beaten when I change such, as some people consider it to be a \"dangerous change\"... (I put a comment on that in.)\n\n> Remove this:\n\n\n```\n # Do not exit script if there is an error, but instead print an\n # informative error message. This is helps in determining why the\n # configuration, compilation or installation failed. So put this before the\n # build() function.\n set +e # This is redundant here, but doesn't hurt to keep it... ;-)\n```\nOrrr.\n \n> Why this:\n\n\n```\n echo \"Sleeping for three seconds before testing python\"\n sleep 3\n```\nSee above (\"dangerous change\"). I added a comment that this is certainly no longer necessary, on the other hand it doesn't hurt much.\n\n> I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?\n\n\nTypical stupidity. Only one of N instances of that.\n\n> On SunOS, do we need the configure flag `--with-gcc=\"gcc -m64\"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?\n\n\nThat's again related to libtool I think.\n\n---\n\nIf you come across such things and don't want to fix them immediately, it's IMHO best to simply put comments into the files or `SPKG.txt`. Comments don't hurt and don't have to be tested, so no reviewer should complain about them (as opposed to too many or \"difficult\" functional changes).\n\nAlso, the next one touching the spkg (or files in general) hopefully will take them into account, and doesn't have to search trac for older tickets with open issues.",
    "created_at": "2011-07-07T11:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145946",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:42'></a>
Replying to [jdemeyer](#comment%3A41):
> Replying to [leif](#comment%3A40):
> > Replying to [jdemeyer](#comment%3A39):
> > Details, please. ;-)

> 

```
if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
```
> should be


```
 if command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then
```
Yes, I mentioned on the ticket that I forgot it; minor.

> Mixed usage of `cp` of `patch`, better always use `patch`.


Agreed, but didn't want to change too much, since it is a blocker and needs quick review.

> On SunOS, you first patch `setup.py` and then copy a different version over it.


No idea. Ask Dave. (The real patch is only necessary on Debian Linuces, so at least that shouldn't break anything.)

> Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.


Hmmm, depends on the situation. Order might matter, and not all patches are applied on all systems. You'd also have to delete (or rename) patches that [currently] don't get applied anymore. Having a bit of redundancy in `spkg-install` and `SPKG.txt` also isn't that bad, as it should reduce the risk of unintentional changes.

But we still have the `cp`s in there anyway, so this should be changed when all patches get real patches.



> Why call `./configure` with arguments `CC="$CC $CFLAGS" CXX="$CXX $CXXFLAGS"`?  Any why only on certain systems?


Guess that's some libtool issue, which sometimes drops e.g. `-m64`, but apparently not on all systems (or it doesn't matter on all).

>

```
 MAKE=make; export MAKE
 make -i install
```
should be

```
$MAKE -j1 -i install
```
I know. I always get beaten when I change such, as some people consider it to be a "dangerous change"... (I put a comment on that in.)

> Remove this:


```
 # Do not exit script if there is an error, but instead print an
 # informative error message. This is helps in determining why the
 # configuration, compilation or installation failed. So put this before the
 # build() function.
 set +e # This is redundant here, but doesn't hurt to keep it... ;-)
```
Orrr.
 
> Why this:


```
 echo "Sleeping for three seconds before testing python"
 sleep 3
```
See above ("dangerous change"). I added a comment that this is certainly no longer necessary, on the other hand it doesn't hurt much.

> I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?


Typical stupidity. Only one of N instances of that.

> On SunOS, do we need the configure flag `--with-gcc="gcc -m64"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?


That's again related to libtool I think.

---

If you come across such things and don't want to fix them immediately, it's IMHO best to simply put comments into the files or `SPKG.txt`. Comments don't hurt and don't have to be tested, so no reviewer should complain about them (as opposed to too many or "difficult" functional changes).

Also, the next one touching the spkg (or files in general) hopefully will take them into account, and doesn't have to search trac for older tickets with open issues.



---

archive/issue_events_035533.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-08T12:00:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11447#event-35533"
}
```



---

archive/issue_comments_145947.json:
```json
{
    "body": "**Merged:** sage-4.7.1.rc0",
    "created_at": "2011-07-08T12:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11447#issuecomment-145947",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.rc0
