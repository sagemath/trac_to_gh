# Issue 11447: python spkg build fails on various Debian systems

archive/issues_011275.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.\n\nThis is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n\n---\n\n**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n\n**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`\n\n(With Jan Medlock's patch of June 17th applied, **and now also** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz). The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)\n\n\n---\n\nNo patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n\nCC:  @sagetrac-drkirkby @jpflori\n\nComponent: **packages: standard**\n\nKeywords: **python spkg crypt library**\n\nAuthor: **Jan Medlock**\n\nReviewer: **David Kirkby, Bill Odefey, Jan Groenewald**\n\nMerged: **sage-4.7.1.rc0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11447_\n\n",
    "closed_at": "2011-07-08T12:00:38Z",
    "created_at": "2011-06-08T04:28:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "python spkg build fails on various Debian systems",
    "type": "issue",
    "updated_at": "2011-07-08T12:00:38Z",
    "url": "https://github.com/sagemath/sage/issues/11447",
    "user": "https://github.com/pipedream"
}
```
Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.

This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.

---

**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**

**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`

(With Jan Medlock's patch of June 17th applied, **and now also** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz). The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)


---

No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 

CC:  @sagetrac-drkirkby @jpflori

Component: **packages: standard**

Keywords: **python spkg crypt library**

Author: **Jan Medlock**

Reviewer: **David Kirkby, Bill Odefey, Jan Groenewald**

Merged: **sage-4.7.1.rc0**

_Issue created by migration from https://trac.sagemath.org/ticket/11447_





---

archive/issue_events_150889.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:28:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150889"
}
```



---

archive/issue_events_150890.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:28:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150890"
}
```



---

archive/issue_events_150891.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:28:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150891"
}
```



---

archive/issue_events_150892.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:28:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150892"
}
```



---

archive/issue_events_150893.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2011-06-08T04:28:43Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "subject": "https://github.com/pipedream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150893"
}
```



---

archive/issue_comments_115831.json:
```json
{
    "body": "Attachment: **[11447-python-mint11.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-python-mint11.patch.gz)**\n\nPatch for building crypt module on Linux Mint 11",
    "created_at": "2011-06-08T04:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115831",
    "user": "https://github.com/pipedream"
}
```

Attachment: **[11447-python-mint11.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-python-mint11.patch.gz)**

Patch for building crypt module on Linux Mint 11



---

archive/issue_events_150894.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:48:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150894"
}
```



---

archive/issue_comments_115832.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPlease test http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\non Ubuntu 11.04, Linux Mint 11, and other systems.\n\n( Dave: I changed a grep to egrep. Is this POSIX? Is grep -E better?\nIs splitting it into two separate greps better? )",
    "created_at": "2011-06-08T04:48:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115832",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:1" align="right">comment:1</div>

Please test http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
on Ubuntu 11.04, Linux Mint 11, and other systems.

( Dave: I changed a grep to egrep. Is this POSIX? Is grep -E better?
Is splitting it into two separate greps better? )



---

archive/issue_events_150895.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2011-06-08T04:48:16Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "subject": "https://github.com/pipedream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150895"
}
```



---

archive/issue_events_150896.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-08T04:48:16Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "subject": "https://github.com/pipedream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150896"
}
```



---

archive/issue_comments_115833.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nJan, if you want to make sure someone sees a ticket, you will need to cc: them like I am doing with drkirkby now.\n\nYou could also put the person for whom it worked properly (as you mentioned on sage-devel) as a reviewer - why not?  They helped, after all, even if they can't check that the code is fine (which it certainly seems to me, but I don't know what etc/issue is for sure).",
    "created_at": "2011-06-08T18:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115833",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Jan, if you want to make sure someone sees a ticket, you will need to cc: them like I am doing with drkirkby now.

You could also put the person for whom it worked properly (as you mentioned on sage-devel) as a reviewer - why not?  They helped, after all, even if they can't check that the code is fine (which it certainly seems to me, but I don't know what etc/issue is for sure).



---

archive/issue_comments_115834.json:
```json
{
    "body": "Work Issues: **Remove extra | character. Create a complete package.**",
    "created_at": "2011-06-08T22:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115834",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Work Issues: **Remove extra | character. Create a complete package.**



---

archive/issue_events_150897.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-06-08T22:49:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150897"
}
```



---

archive/issue_events_150898.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-06-08T22:49:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150898"
}
```



---

archive/issue_comments_115835.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThese should not be two '|' characters in the egrep expression. \n\n\n```\ndrkirkby@hawk:~$ echo foo | egrep \"Ubuntu 11.04||Linux Mint 11 Katya\"\negrep: syntax error\ndrkirkby@hawk:~$ \n```\n\nThere should be only one. \n\nYou also need to create a new package, so we can test the complete package, but this looks pretty simple to me. \n\nIt would be good if we could attempt to find other popular Ubuntu derivatives that will get the problem and include the patch for them too. But that's not important - just nice if possible to do easily. \n\nDave",
    "created_at": "2011-06-08T22:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115835",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:4" align="right">comment:4</div>

These should not be two '|' characters in the egrep expression. 


```
drkirkby@hawk:~$ echo foo | egrep "Ubuntu 11.04||Linux Mint 11 Katya"
egrep: syntax error
drkirkby@hawk:~$ 
```

There should be only one. 

You also need to create a new package, so we can test the complete package, but this looks pretty simple to me. 

It would be good if we could attempt to find other popular Ubuntu derivatives that will get the problem and include the patch for them too. But that's not important - just nice if possible to do easily. 

Dave



---

archive/issue_comments_115836.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2011-06-08T22:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115836",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_events_150899.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-09T04:29:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150899"
}
```



---

archive/issue_events_150900.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-09T04:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150900"
}
```



---

archive/issue_comments_115837.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks Dave, new patch following. I made a typo with the pipe, but it \ndid not throw a syntax error on Ubuntu (I think it parsed \n\"Ubuntu 11.04\" or \"\" or \"Linux Mint 11 Katya\". The empty string matched\nevery line though which is another problem. This is however why\nthe spkg compiled properly for the Linux Mint tester/reviewer.\n\nI'm not sure he has a trac account (for reviewing).\n\nNew patch attached for review purposes, and spkg at \nhttp://users.aims.ac.za/~jan/python-2.6.4.p11.spkg",
    "created_at": "2011-06-09T04:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115837",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks Dave, new patch following. I made a typo with the pipe, but it 
did not throw a syntax error on Ubuntu (I think it parsed 
"Ubuntu 11.04" or "" or "Linux Mint 11 Katya". The empty string matched
every line though which is another problem. This is however why
the spkg compiled properly for the Linux Mint tester/reviewer.

I'm not sure he has a trac account (for reviewing).

New patch attached for review purposes, and spkg at 
http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg



---

archive/issue_comments_115838.json:
```json
{
    "body": "Replaces previous patch to build on Linux Mint 11",
    "created_at": "2011-06-09T04:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115838",
    "user": "https://github.com/pipedream"
}
```

Replaces previous patch to build on Linux Mint 11



---

archive/issue_comments_115839.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[11447-python-mint11b.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-python-mint11b.patch.gz)**\n\n> I'm not sure he has a trac account (for reviewing).\n\nWhat I meant was that you could put his name down as a reviewer, assuming you do not have actual access to a Mint machine and neither does David.",
    "created_at": "2011-06-09T12:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115839",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[11447-python-mint11b.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-python-mint11b.patch.gz)**

> I'm not sure he has a trac account (for reviewing).

What I meant was that you could put his name down as a reviewer, assuming you do not have actual access to a Mint machine and neither does David.



---

archive/issue_comments_115840.json:
```json
{
    "body": "Changed reviewer from **David Kirkby** to **David Kirkby, Bill Odefey**",
    "created_at": "2011-06-09T14:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115840",
    "user": "https://github.com/pipedream"
}
```

Changed reviewer from **David Kirkby** to **David Kirkby, Bill Odefey**



---

archive/issue_comments_115841.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nBill Odefey reports that the new spkg worked for him again on Linux Mint 11.",
    "created_at": "2011-06-09T16:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115841",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:8" align="right">comment:8</div>

Bill Odefey reports that the new spkg worked for him again on Linux Mint 11.



---

archive/issue_comments_115842.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\negrep is not a POSIX command, but I think in this instance it is acceptable to use it. \n\nThe use of 'grep -E' confirms to the latest POSIX, but would fail on Solaris if someone has /usr/bin in their path before /usr/xpg4/bin. This is because to maintain backwards compatibility with older Solaris releases, whilst still conforming to the various POSIX versions, there are two or sometimes three versions of some commands on Solaris. \n\nMore portable would be to split the two greps up, but I think that would unnecessarily complicate things.\n\nPositive review.",
    "created_at": "2011-06-10T11:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115842",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:9" align="right">comment:9</div>

egrep is not a POSIX command, but I think in this instance it is acceptable to use it. 

The use of 'grep -E' confirms to the latest POSIX, but would fail on Solaris if someone has /usr/bin in their path before /usr/xpg4/bin. This is because to maintain backwards compatibility with older Solaris releases, whilst still conforming to the various POSIX versions, there are two or sometimes three versions of some commands on Solaris. 

More portable would be to split the two greps up, but I think that would unnecessarily complicate things.

Positive review.



---

archive/issue_comments_115843.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,8 @@\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n \n-A patch will follow shortly to change the #11243 patch to also apply on Linux Mint 11.\n+The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n+\n+http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n+\n+No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n``````\n",
    "created_at": "2011-06-10T11:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115843",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,8 @@
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
 
-A patch will follow shortly to change the #11243 patch to also apply on Linux Mint 11.
+The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
+
+http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
+
+No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 
``````




---

archive/issue_events_150901.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-06-10T11:22:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150901"
}
```



---

archive/issue_events_150902.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-06-10T11:22:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150902"
}
```



---

archive/issue_comments_115844.json:
```json
{
    "body": "Changed work issues from **Remove extra | character. Create a complete package.** to none",
    "created_at": "2011-06-14T21:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115844",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **Remove extra | character. Create a complete package.** to none



---

archive/issue_comments_115845.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nLooking at `/etc/issue` is a *very bad* way of checking the system.  This is a file which is sometimes customized by system administrators.  You should try to understand *why* Python doesn't build on such a system and check for the true cause.",
    "created_at": "2011-06-14T21:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115845",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Looking at `/etc/issue` is a *very bad* way of checking the system.  This is a file which is sometimes customized by system administrators.  You should try to understand *why* Python doesn't build on such a system and check for the true cause.



---

archive/issue_comments_115846.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nYes, it is hidden in the original thread which lead to ticket #11243.\nhttps://github.com/sagemath/sage/issues/11243\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/593b9a4124f5075d\n\nIf the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n(It is a patch that Debian and Ubuntu and therefore all derivatives apply to their own python debs for python to build.)\n\nIt comes down to this http://bugs.python.org/issue9762 .\nIt may be fixed in python 2.7 http://hg.python.org/cpython/rev/bd0f73a9538e\nbut those are beyond my experience.",
    "created_at": "2011-06-15T05:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115846",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:11" align="right">comment:11</div>

Yes, it is hidden in the original thread which lead to ticket #11243.
https://github.com/sagemath/sage/issues/11243
http://groups.google.com/group/sage-devel/browse_thread/thread/593b9a4124f5075d

If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?
(It is a patch that Debian and Ubuntu and therefore all derivatives apply to their own python debs for python to build.)

It comes down to this http://bugs.python.org/issue9762 .
It may be fixed in python 2.7 http://hg.python.org/cpython/rev/bd0f73a9538e
but those are beyond my experience.



---

archive/issue_comments_115847.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@pipedream](#comment%3A11):\n> If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n\nWell, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?",
    "created_at": "2011-06-15T07:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115847",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@pipedream](#comment%3A11):
> If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?

Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?



---

archive/issue_events_150903.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T07:22:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150903"
}
```



---

archive/issue_events_150904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T07:22:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150904"
}
```



---

archive/issue_comments_115848.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> Replying to [@pipedream](#comment%3A11):\n> > If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?\n\n> Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?\n\nThe solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n\nThis requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...",
    "created_at": "2011-06-17T04:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115848",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment%3A12):
> Replying to [@pipedream](#comment%3A11):
> > If the way to check for Linux Release/Distribution it is suboptimal, do you know of a better way?

> Well, it is dead simple: **don't** check the Linux Release/Distribution.  Would it make sense to apply the workaround on all Linux systems or could that break things?

The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.

This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...



---

archive/issue_comments_115849.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@janmedlock](#comment%3A13):\n> ...\n> The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n> \n> This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...\n\nAll this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...",
    "created_at": "2011-06-17T04:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115849",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@janmedlock](#comment%3A13):
> ...
> The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.
> 
> This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...

All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...



---

archive/issue_comments_115850.json:
```json
{
    "body": "Debian patch to Python 2.6 to fix paths",
    "created_at": "2011-06-17T04:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115850",
    "user": "https://github.com/janmedlock"
}
```

Debian patch to Python 2.6 to fix paths



---

archive/issue_comments_115851.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[deb-setup.diff.gz](https://github.com/sagemath/sage/files/ticket11447/deb-setup.diff.gz)**\n\nReplying to [@janmedlock](#comment%3A14):\n> Replying to [@janmedlock](#comment%3A13):\n> > ...\n> > The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.\n> > \n> > This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...\n\n> \n> All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...\n\nSee also [http://lists.debian.org/debian-devel/2011/06/msg00431.html](http://lists.debian.org/debian-devel/2011/06/msg00431.html).",
    "created_at": "2011-06-17T04:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115851",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[deb-setup.diff.gz](https://github.com/sagemath/sage/files/ticket11447/deb-setup.diff.gz)**

Replying to [@janmedlock](#comment%3A14):
> Replying to [@janmedlock](#comment%3A13):
> > ...
> > The solution that's in Python 2.7 and in Debian's patches to Python 2.6 (patch deb-setup.diff attached) is to use `dpkg-architecture -qDEB_HOST_MULTIARCH`.  These packages use this command to set the library paths correctly.
> > 
> > This requires that the optional package dpkg-dev is installed.  A wrapper should probably be written that complains if `lsb_release -i` is (Debian|Ubuntu|Mint) and `dpkg-architecture` is not present, otherwise the build will fail without the user knowing why...

> 
> All this can get ripped out when Sage upgrades to Python 2.7, where this issue is fixed...

See also [http://lists.debian.org/debian-devel/2011/06/msg00431.html](http://lists.debian.org/debian-devel/2011/06/msg00431.html).



---

archive/issue_comments_115852.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nNote that in #11243 we realised lsb_release does not work -- it tries to import an underlying system python package; but SAGE spkg installs run in a SAGE python environment and does not know\nthe path to import lsb_release. That is why we switched to check whether /etc/issue exists, and then to use that. \n\nIt is a good question whether the patch to use -lcrypt will break other Linux distros? Then a standard uname check for Linux could be used and the patch applied on all Linux patched while SAGE still uses python 2.6.\n\nWhat is the timeline for SAGE to get to python 2.7?",
    "created_at": "2011-06-17T06:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115852",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:16" align="right">comment:16</div>

Note that in #11243 we realised lsb_release does not work -- it tries to import an underlying system python package; but SAGE spkg installs run in a SAGE python environment and does not know
the path to import lsb_release. That is why we switched to check whether /etc/issue exists, and then to use that. 

It is a good question whether the patch to use -lcrypt will break other Linux distros? Then a standard uname check for Linux could be used and the patch applied on all Linux patched while SAGE still uses python 2.6.

What is the timeline for SAGE to get to python 2.7?



---

archive/issue_comments_115853.json:
```json
{
    "body": "Attachment: **[11447-Python-Debian-multiarch.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz)**\n\nPatch to python-2.6.4.p10.spkg to fix multiarch build.  Solution copied from Python 2.7.",
    "created_at": "2011-06-17T23:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115853",
    "user": "https://github.com/janmedlock"
}
```

Attachment: **[11447-Python-Debian-multiarch.patch.gz](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz)**

Patch to python-2.6.4.p10.spkg to fix multiarch build.  Solution copied from Python 2.7.



---

archive/issue_comments_115854.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n11447-Python-Debian-multiarch.patch uses the solution from Python 2.7 to fix build on Debian and derivatives with multiarch.\n\nThe patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\nNote that on Debian and derivatives, if the command dpkg-architecture, from the package dpkg-dev, is not available, the build will fail as before.  Again, this is how Python 2.7 is set up.\n\nThis looks like the best solution to me.",
    "created_at": "2011-06-17T23:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115854",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:17" align="right">comment:17</div>

11447-Python-Debian-multiarch.patch uses the solution from Python 2.7 to fix build on Debian and derivatives with multiarch.

The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.

Note that on Debian and derivatives, if the command dpkg-architecture, from the package dpkg-dev, is not available, the build will fail as before.  Again, this is how Python 2.7 is set up.

This looks like the best solution to me.



---

archive/issue_events_150905.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-18T10:09:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150905"
}
```



---

archive/issue_events_150906.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-06-18T10:09:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150906"
}
```



---

archive/issue_comments_115855.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nLooks good to me. This does mean -lcrypt in Setup.dist is uncommented on all\nsystems, Debian or not, Linux or not. Does that have unintended side effects?",
    "created_at": "2011-06-18T10:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115855",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:18" align="right">comment:18</div>

Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all
systems, Debian or not, Linux or not. Does that have unintended side effects?



---

archive/issue_comments_115856.json:
```json
{
    "body": "Changed reviewer from **David Kirkby, Bill Odefey** to **David Kirkby, Bill Odefey, Jan Groenewald**",
    "created_at": "2011-06-18T12:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115856",
    "user": "https://github.com/pipedream"
}
```

Changed reviewer from **David Kirkby, Bill Odefey** to **David Kirkby, Bill Odefey, Jan Groenewald**



---

archive/issue_comments_115857.json:
```json
{
    "body": "Changed author from **Jan Groenewald** to **Jan Medlock**",
    "created_at": "2011-06-18T12:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115857",
    "user": "https://github.com/pipedream"
}
```

Changed author from **Jan Groenewald** to **Jan Medlock**



---

archive/issue_comments_115858.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@pipedream](#comment%3A18):\n> Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all\n> systems, Debian or not, Linux or not. Does that have unintended side effects?\n\nNo, -lcrypt is not uncommented in Setup.dist on any system.\n\nThe library search directories are now set up in setup.py on Debian and derivatives to correctly find libcrypt automatically.  There is no change to the library search directories on other systems.  This is done by testing for the presence of the command 'dpkg-architecture'.\n\nI don't see any side effects and this is how it is done in Python 2.7.\n\n(Setup.dist is a work around for setup.py not automatically finding the libraries.)",
    "created_at": "2011-06-18T17:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115858",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@pipedream](#comment%3A18):
> Looks good to me. This does mean -lcrypt in Setup.dist is uncommented on all
> systems, Debian or not, Linux or not. Does that have unintended side effects?

No, -lcrypt is not uncommented in Setup.dist on any system.

The library search directories are now set up in setup.py on Debian and derivatives to correctly find libcrypt automatically.  There is no change to the library search directories on other systems.  This is done by testing for the presence of the command 'dpkg-architecture'.

I don't see any side effects and this is how it is done in Python 2.7.

(Setup.dist is a work around for setup.py not automatically finding the libraries.)



---

archive/issue_events_150907.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-01T12:53:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150907"
}
```



---

archive/issue_events_150908.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-01T12:53:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150908"
}
```



---

archive/issue_comments_115859.json:
```json
{
    "body": "Changed keywords from none to **crypt library**",
    "created_at": "2011-07-01T12:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115859",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from none to **crypt library**



---

archive/issue_comments_115860.json:
```json
{
    "body": "Work Issues: **Provide an updated spkg**",
    "created_at": "2011-07-01T12:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115860",
    "user": "https://github.com/nexttime"
}
```

Work Issues: **Provide an updated spkg**



---

archive/issue_comments_115861.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@janmedlock](#comment%3A17):\n> The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\nJust to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.\n\n(Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)\n\n\n\n\n> Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.\n\nAgain, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.\n\n---\n\nCould someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?\n\n**http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**",
    "created_at": "2011-07-01T12:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115861",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@janmedlock](#comment%3A17):
> The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.

Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.

(Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)




> Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.

Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.

---

Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?

**http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**



---

archive/issue_comments_115862.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nP.S.:\n\nI think if the test importing the `crypt` module (in `spkg-install`) fails and `dpkg-architecture` isn't installed, the user should get a hint on installing it (i.e., `dpkg-dev`; maybe only on newer Debian derivatives, but this could also just be part of the message.)\n\nOtherwise we should at least document this in the Sage Installation Guide, and perhaps also on one of the wiki pages.",
    "created_at": "2011-07-01T13:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115862",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:23" align="right">comment:23</div>

P.S.:

I think if the test importing the `crypt` module (in `spkg-install`) fails and `dpkg-architecture` isn't installed, the user should get a hint on installing it (i.e., `dpkg-dev`; maybe only on newer Debian derivatives, but this could also just be part of the message.)

Otherwise we should at least document this in the Sage Installation Guide, and perhaps also on one of the wiki pages.



---

archive/issue_comments_115863.json:
```json
{
    "body": "Changed work issues from **Provide an updated spkg** to none",
    "created_at": "2011-07-01T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115863",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Provide an updated spkg** to none



---

archive/issue_comments_115864.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,23 @@\n-Linux Mint 11 fails to build python.\n+Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n+\n+---\n+\n+Old spkg (now obsolete):\n \n The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n \n http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n \n+---\n+\n+**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n+\n+**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n+\n+(With Jan Medlock's patch of June 17th applied.)\n+\n+---\n+\n No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. \n``````\n",
    "created_at": "2011-07-01T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115864",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,23 @@
-Linux Mint 11 fails to build python.
+Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
+
+---
+
+Old spkg (now obsolete):
 
 The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
 
 http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
 
+---
+
+**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**
+
+**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
+
+(With Jan Medlock's patch of June 17th applied.)
+
+---
+
 No patches need to be applied to the Sage library - only the package updated. The patches attached to the ticket are for review purposes only. 
``````




---

archive/issue_events_150909.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-01T15:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150909"
}
```



---

archive/issue_events_150910.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-01T15:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150910"
}
```



---

archive/issue_comments_115865.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nexttime](#comment%3A22):\n> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?\n> \n> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**\n\n\nOk, did it myself:\n\n**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n\n**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n\n(I haven't made any changes, just applied Jan Medlock's patch of June 17th.)",
    "created_at": "2011-07-01T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115865",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nexttime](#comment%3A22):
> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?
> 
> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**


Ok, did it myself:

**Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**

**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`

(I haven't made any changes, just applied Jan Medlock's patch of June 17th.)



---

archive/issue_comments_115866.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@nexttime](#comment%3A22):\n> Replying to [@janmedlock](#comment%3A17):\n> > The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.\n\n> \n> Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.\n> \n> (Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)\n> \n> \n\n> \n> > Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.\n\n> \n> Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.\n> \n> \n> ---\n> \n> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?\n> \n> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**\n\nThanks for the clarification.  I can confirm for the record that this is the intended behavior.",
    "created_at": "2011-07-01T16:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115866",
    "user": "https://github.com/janmedlock"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@nexttime](#comment%3A22):
> Replying to [@janmedlock](#comment%3A17):
> > The patch to python-2.6.4.p10/src/setup.py is applied on all hosts, not just Debian and derivatives, but the new code will end up doing nothing on non-Debian-derived hosts.  This is how the build is set up in Python 2.7.

> 
> Just to make it a bit clearer: The code also doesn't change the search paths on *older Debian / Ubuntu systems*, regardless if `dpkg-architecture` is installed or not, so won't break anything there.
> 
> (Tested with Ubuntu 9.04 and 10.04; `dpkg-architecture` there doesn't know `DEB_HOST_MULTIARCH` and therefore exits with a non-zero status such that nothing gets added to the paths.)
> 
> 

> 
> > Note that on Debian and derivatives, if the command `dpkg-architecture`, from the package dpkg-dev, is not available, the build will fail as before.

> 
> Again, of course the build will only fail on *newer* Debian derivatives which require a change (more precisely: additions) to the search paths.
> 
> 
> ---
> 
> Could someone please update the p11 / provide a new p11 spkg (by applying only [attachment: 11447-Python-Debian-multiarch.patch](https://github.com/sagemath/sage/files/ticket11447/11447-Python-Debian-multiarch.patch.gz) to p10 I guess)?
> 
> **http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg (and also the ticket description) is not current.**

Thanks for the clarification.  I can confirm for the record that this is the intended behavior.



---

archive/issue_events_150911.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T07:35:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "title_is": "python spkg build fails on various Debian systems",
    "title_was": "python spkg build fails on Ubuntu 11.04 derivative Mint 11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150911"
}
```



---

archive/issue_comments_115867.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,6 @@\n-Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.\n+Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.\n \n This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.\n-\n----\n-\n-Old spkg (now obsolete):\n-\n-The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.\n-\n-http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T07:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115867",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,6 @@
-Linux Mint 11 and other newer Debian derivatives fail to build the Python spkg.
+Ubuntu 11.04 derivative Mint 11 and other newer Debian GNU/Linux derivatives fail to build the Python spkg.
 
 This is a known issue in #11243 on Ubuntu 11.04, and any derivatives such as Mint 11 will suffer from this as well.
-
----
-
-Old spkg (now obsolete):
-
-The package below applies the same patch on Linux Mint 11 as #11243 does on Ubuntu 11.04.
-
-http://users.aims.ac.za/~jan/python-2.6.4.p11.spkg
 
 ---
 
``````




---

archive/issue_comments_115868.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI will test the new package on the buildbots and give positive_review if these are successful.",
    "created_at": "2011-07-05T07:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115868",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

I will test the new package on the buildbots and give positive_review if these are successful.



---

archive/issue_comments_115869.json:
```json
{
    "body": "Changed keywords from **crypt library** to **python spkg crypt library**",
    "created_at": "2011-07-05T07:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115869",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **crypt library** to **python spkg crypt library**



---

archive/issue_events_150912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T07:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150912"
}
```



---

archive/issue_events_150913.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T07:38:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150913"
}
```



---

archive/issue_events_150914.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T07:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150914"
}
```



---

archive/issue_events_150915.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T07:38:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150915"
}
```



---

archive/issue_comments_115870.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment%3A27):\n> I will test the new package on the buildbots and give positive_review if these are successful.\n\nSo adding a note on installing `dpkg-dev` to the \"Known Issues\" / wiki page(s) is sufficient? (I can't judge how common it is to *not* have it installed.)\n\nIt's perhaps to specific to get into the Sage Installation Guide.\n\n\nP.S.: You don't need to add keywords that are already in the ticket's title.",
    "created_at": "2011-07-05T07:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115870",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment%3A27):
> I will test the new package on the buildbots and give positive_review if these are successful.

So adding a note on installing `dpkg-dev` to the "Known Issues" / wiki page(s) is sufficient? (I can't judge how common it is to *not* have it installed.)

It's perhaps to specific to get into the Sage Installation Guide.


P.S.: You don't need to add keywords that are already in the ticket's title.



---

archive/issue_comments_115871.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIt would be great if the patch included a suggestion to \"sudo apt-get install dpkg-dev\" if it is not installed.",
    "created_at": "2011-07-05T08:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115871",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:30" align="right">comment:30</div>

It would be great if the patch included a suggestion to "sudo apt-get install dpkg-dev" if it is not installed.



---

archive/issue_events_150916.json:
```json
{
    "actor": "https://github.com/pipedream",
    "created_at": "2011-07-05T08:01:53Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "subject": "https://github.com/pipedream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150916"
}
```



---

archive/issue_events_150917.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-05T08:01:53Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "subject": "https://github.com/pipedream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150917"
}
```



---

archive/issue_comments_115872.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nP.S.:\n\nTo detect Debian and any of its derivatives (in order to give an appropriate message if importing `crypt` fails) testing `command -v dpkg` should suffice.",
    "created_at": "2011-07-05T08:02:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115872",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

P.S.:

To detect Debian and any of its derivatives (in order to give an appropriate message if importing `crypt` fails) testing `command -v dpkg` should suffice.



---

archive/issue_comments_115873.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@pipedream](#comment%3A30):\n> It would be great if the patch included a suggestion to \"sudo apt-get install dpkg-dev\" if it is not installed.\n\nPatch is on the way...\n\nCannot really test it myself though, as I have no newer Debian here.",
    "created_at": "2011-07-05T09:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115873",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@pipedream](#comment%3A30):
> It would be great if the patch included a suggestion to "sudo apt-get install dpkg-dev" if it is not installed.

Patch is on the way...

Cannot really test it myself though, as I have no newer Debian here.



---

archive/issue_comments_115874.json:
```json
{
    "body": "SPKG patch. Adds message, some minor changes. Apply on top of Jan Medlock's patch.",
    "created_at": "2011-07-05T09:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115874",
    "user": "https://github.com/nexttime"
}
```

SPKG patch. Adds message, some minor changes. Apply on top of Jan Medlock's patch.



---

archive/issue_comments_115875.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAttachment: **[trac_11447-give_hint_on_dpkg-dev.patch.gz](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz)**\n\nPatch is up. Relevant part:\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -242,12 +248,28 @@\n # All these modules are important and if any one \n # fails to build, Sage will not work. \n \n+import_errors=false\n for module in math hashlib crypt ; do \n    \"$SAGE_LOCAL/bin/python\" -c \"import $module\"\n    if [ $? -eq 0 ] ; then\n       echo \"$module module imported OK\"\n    else\n-      echo \"$module module failed to import\"\n-      exit 1\n+      echo >&2 \"$module module failed to import\"\n+      import_errors=true\n+      # exit 1 # not yet\n    fi\n done\n+\n+if $import_errors; then\n+    echo >&2 \"Error: One or more modules failed to import.\"\n+    # Check if we are on Debian or one of its derivatives:\n+    if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n+        echo >&2 \"You may have to install 'dpkg-architecture'\"\n+        echo >&2 \"which is part of the Debian package 'dpkg-dev'.\"\n+        echo >&2 \"Try installing it by typing\"\n+        echo >&2 \"    sudo apt-get install dpkg-dev\"\n+        echo >&2 \"and rerun 'make'.\"\n+    fi\n+    exit 1\n+fi\n```\n\n**I haven't uploaded the new spkg to G**gle code yet.**\n\nMaybe Jeroen wants to create it on `sage.math`. (My patch [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz) is based on the p11 I previously uploaded.)",
    "created_at": "2011-07-05T10:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115875",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:34" align="right">comment:34</div>

Attachment: **[trac_11447-give_hint_on_dpkg-dev.patch.gz](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz)**

Patch is up. Relevant part:

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -242,12 +248,28 @@
 # All these modules are important and if any one 
 # fails to build, Sage will not work. 
 
+import_errors=false
 for module in math hashlib crypt ; do 
    "$SAGE_LOCAL/bin/python" -c "import $module"
    if [ $? -eq 0 ] ; then
       echo "$module module imported OK"
    else
-      echo "$module module failed to import"
-      exit 1
+      echo >&2 "$module module failed to import"
+      import_errors=true
+      # exit 1 # not yet
    fi
 done
+
+if $import_errors; then
+    echo >&2 "Error: One or more modules failed to import."
+    # Check if we are on Debian or one of its derivatives:
+    if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
+        echo >&2 "You may have to install 'dpkg-architecture'"
+        echo >&2 "which is part of the Debian package 'dpkg-dev'."
+        echo >&2 "Try installing it by typing"
+        echo >&2 "    sudo apt-get install dpkg-dev"
+        echo >&2 "and rerun 'make'."
+    fi
+    exit 1
+fi
```

**I haven't uploaded the new spkg to G**gle code yet.**

Maybe Jeroen wants to create it on `sage.math`. (My patch [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz) is based on the p11 I previously uploaded.)



---

archive/issue_comments_115876.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nOoops, I just noticed the output of `command -v dpkg` is not redirected. But IMHO negligible.",
    "created_at": "2011-07-05T10:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115876",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:35" align="right">comment:35</div>

Ooops, I just noticed the output of `command -v dpkg` is not redirected. But IMHO negligible.



---

archive/issue_comments_115877.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n \n **md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n \n-(With Jan Medlock's patch of June 17th applied.)\n+(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz).)\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T10:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115877",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 
 **md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
 
-(With Jan Medlock's patch of June 17th applied.)
+(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz).)
 
 ---
 
``````




---

archive/issue_comments_115878.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@nexttime](#comment%3A34):\n> **I haven't uploaded the new spkg to G**gle code yet.**\n\nOk, will do now...",
    "created_at": "2011-07-05T11:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115878",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@nexttime](#comment%3A34):
> **I haven't uploaded the new spkg to G**gle code yet.**

Ok, will do now...



---

archive/issue_comments_115879.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@nexttime](#comment%3A37):\n> Replying to [@nexttime](#comment%3A34):\n> > **I haven't uploaded the new spkg to G**gle code yet.**\n\n> \n> Ok, will do now...\n\nDone. New `md5sum: e808dc5edba8c82c098f0c9641b34634` (Same name, same place.)",
    "created_at": "2011-07-05T11:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115879",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@nexttime](#comment%3A37):
> Replying to [@nexttime](#comment%3A34):
> > **I haven't uploaded the new spkg to G**gle code yet.**

> 
> Ok, will do now...

Done. New `md5sum: e808dc5edba8c82c098f0c9641b34634` (Same name, same place.)



---

archive/issue_comments_115880.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,9 +6,10 @@\n \n **Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**\n \n-**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`\n+**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`\n \n-(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz).)\n+(With Jan Medlock's patch of June 17th applied, **and now also** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz). The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)\n+\n \n ---\n \n``````\n",
    "created_at": "2011-07-05T11:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115880",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,9 +6,10 @@
 
 **Updated spkg: http://spkg-upload.googlecode.com/files/python-2.6.4.p11.spkg**
 
-**md5sum:** `5bc63c1814fc7ae34f4fed5a8fffe380  python-2.6.4.p11.spkg`
+**md5sum:** `e808dc5edba8c82c098f0c9641b34634  python-2.6.4.p11.spkg`
 
-(With Jan Medlock's patch of June 17th applied, **but not yet** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz).)
+(With Jan Medlock's patch of June 17th applied, **and now also** [attachment: trac_11447-give_hint_on_dpkg-dev.patch](https://github.com/sagemath/sage/files/ticket11447/trac_11447-give_hint_on_dpkg-dev.patch.gz). The old one with only Jan Medlock's patch applied had `md5sum 5bc63c1814fc7ae34f4fed5a8fffe380`.)
+
 
 ---
 
``````




---

archive/issue_comments_115881.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nMessy in various places, but at least it improves over the existing version, so positive_review.",
    "created_at": "2011-07-07T09:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115881",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Messy in various places, but at least it improves over the existing version, so positive_review.



---

archive/issue_events_150918.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-07T09:50:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150918"
}
```



---

archive/issue_events_150919.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-07T09:50:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150919"
}
```



---

archive/issue_comments_115882.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jdemeyer](#comment%3A39):\n> Messy in various places, \n\nDetails, please. ;-)",
    "created_at": "2011-07-07T09:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115882",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jdemeyer](#comment%3A39):
> Messy in various places, 

Details, please. ;-)



---

archive/issue_comments_115883.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nexttime](#comment%3A40):\n> Replying to [@jdemeyer](#comment%3A39):\n> Details, please. ;-)\n\n```\nif command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n```\nshould be\n\n```\nif command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then\n```\nor\n\n```\nif ( command -v dpkg && ! command -v dpkg-architecture ) >/dev/null; then\n```\n\nMixed usage of `cp` of `patch`, better always use `patch`.\n\nOn SunOS, you first patch `setup.py` and then copy a different version over it.\n\nPatching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.\n\nWhy call `./configure` with arguments `CC=\"$CC $CFLAGS\" CXX=\"$CXX $CXXFLAGS\"`?  Any why only on certain systems?\n\n```\nMAKE=make; export MAKE\nmake -i install\n```\nshould be\n\n```\n$MAKE -j1 -i install\n```\n\nRemove this:\n\n```\n# Do not exit script if there is an error, but instead print an\n# informative error message. This is helps in determining why the\n# configuration, compilation or installation failed. So put this before the\n# build() function.\nset +e # This is redundant here, but doesn't hurt to keep it... ;-)\n```\n\nWhy this:\n\n```\necho \"Sleeping for three seconds before testing python\"\nsleep 3\n```\n\nI guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?\n\nOn SunOS, do we need the configure flag `--with-gcc=\"gcc -m64\"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?",
    "created_at": "2011-07-07T10:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115883",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nexttime](#comment%3A40):
> Replying to [@jdemeyer](#comment%3A39):
> Details, please. ;-)

```
if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
```
should be

```
if command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then
```
or

```
if ( command -v dpkg && ! command -v dpkg-architecture ) >/dev/null; then
```

Mixed usage of `cp` of `patch`, better always use `patch`.

On SunOS, you first patch `setup.py` and then copy a different version over it.

Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.

Why call `./configure` with arguments `CC="$CC $CFLAGS" CXX="$CXX $CXXFLAGS"`?  Any why only on certain systems?

```
MAKE=make; export MAKE
make -i install
```
should be

```
$MAKE -j1 -i install
```

Remove this:

```
# Do not exit script if there is an error, but instead print an
# informative error message. This is helps in determining why the
# configuration, compilation or installation failed. So put this before the
# build() function.
set +e # This is redundant here, but doesn't hurt to keep it... ;-)
```

Why this:

```
echo "Sleeping for three seconds before testing python"
sleep 3
```

I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?

On SunOS, do we need the configure flag `--with-gcc="gcc -m64"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?



---

archive/issue_comments_115884.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@jdemeyer](#comment%3A41):\n> Replying to [@nexttime](#comment%3A40):\n> > Replying to [@jdemeyer](#comment%3A39):\n> > Details, please. ;-)\n\n> \n\n```\nif command -v dpkg && ! command -v dpkg-architecture >/dev/null; then\n```\n> should be\n\n\n```\nif command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then\n```\nYes, I mentioned on the ticket that I forgot it; minor.\n\n> Mixed usage of `cp` of `patch`, better always use `patch`.\n\nAgreed, but didn't want to change too much, since it is a blocker and needs quick review.\n\n> On SunOS, you first patch `setup.py` and then copy a different version over it.\n\nNo idea. Ask Dave. (The real patch is only necessary on Debian Linuces, so at least that shouldn't break anything.)\n\n> Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.\n\nHmmm, depends on the situation. Order might matter, and not all patches are applied on all systems. You'd also have to delete (or rename) patches that [currently] don't get applied anymore. Having a bit of redundancy in `spkg-install` and `SPKG.txt` also isn't that bad, as it should reduce the risk of unintentional changes.\n\nBut we still have the `cp`s in there anyway, so this should be changed when all patches get real patches.\n\n\n\n> Why call `./configure` with arguments `CC=\"$CC $CFLAGS\" CXX=\"$CXX $CXXFLAGS\"`?  Any why only on certain systems?\n\nGuess that's some libtool issue, which sometimes drops e.g. `-m64`, but apparently not on all systems (or it doesn't matter on all).\n\n>\n\n```\nMAKE=make; export MAKE\nmake -i install\n```\nshould be\n\n```\n$MAKE -j1 -i install\n```\nI know. I always get beaten when I change such, as some people consider it to be a \"dangerous change\"... (I put a comment on that in.)\n\n> Remove this:\n\n\n```\n# Do not exit script if there is an error, but instead print an\n# informative error message. This is helps in determining why the\n# configuration, compilation or installation failed. So put this before the\n# build() function.\nset +e # This is redundant here, but doesn't hurt to keep it... ;-)\n```\nOrrr.\n \n> Why this:\n\n\n```\necho \"Sleeping for three seconds before testing python\"\nsleep 3\n```\nSee above (\"dangerous change\"). I added a comment that this is certainly no longer necessary, on the other hand it doesn't hurt much.\n\n> I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?\n\nTypical stupidity. Only one of N instances of that.\n\n> On SunOS, do we need the configure flag `--with-gcc=\"gcc -m64\"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?\n\nThat's again related to libtool I think.\n\n---\n\nIf you come across such things and don't want to fix them immediately, it's IMHO best to simply put comments into the files or `SPKG.txt`. Comments don't hurt and don't have to be tested, so no reviewer should complain about them (as opposed to too many or \"difficult\" functional changes).\n\nAlso, the next one touching the spkg (or files in general) hopefully will take them into account, and doesn't have to search trac for older tickets with open issues.",
    "created_at": "2011-07-07T11:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115884",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@jdemeyer](#comment%3A41):
> Replying to [@nexttime](#comment%3A40):
> > Replying to [@jdemeyer](#comment%3A39):
> > Details, please. ;-)

> 

```
if command -v dpkg && ! command -v dpkg-architecture >/dev/null; then
```
> should be


```
if command -v dpkg >/dev/null && ! command -v dpkg-architecture >/dev/null; then
```
Yes, I mentioned on the ticket that I forgot it; minor.

> Mixed usage of `cp` of `patch`, better always use `patch`.

Agreed, but didn't want to change too much, since it is a blocker and needs quick review.

> On SunOS, you first patch `setup.py` and then copy a different version over it.

No idea. Ask Dave. (The real patch is only necessary on Debian Linuces, so at least that shouldn't break anything.)

> Patching is better done using one `for` loop to prevent an error-prone laundry list of patches to be applied.

Hmmm, depends on the situation. Order might matter, and not all patches are applied on all systems. You'd also have to delete (or rename) patches that [currently] don't get applied anymore. Having a bit of redundancy in `spkg-install` and `SPKG.txt` also isn't that bad, as it should reduce the risk of unintentional changes.

But we still have the `cp`s in there anyway, so this should be changed when all patches get real patches.



> Why call `./configure` with arguments `CC="$CC $CFLAGS" CXX="$CXX $CXXFLAGS"`?  Any why only on certain systems?

Guess that's some libtool issue, which sometimes drops e.g. `-m64`, but apparently not on all systems (or it doesn't matter on all).

>

```
MAKE=make; export MAKE
make -i install
```
should be

```
$MAKE -j1 -i install
```
I know. I always get beaten when I change such, as some people consider it to be a "dangerous change"... (I put a comment on that in.)

> Remove this:


```
# Do not exit script if there is an error, but instead print an
# informative error message. This is helps in determining why the
# configuration, compilation or installation failed. So put this before the
# build() function.
set +e # This is redundant here, but doesn't hurt to keep it... ;-)
```
Orrr.
 
> Why this:


```
echo "Sleeping for three seconds before testing python"
sleep 3
```
See above ("dangerous change"). I added a comment that this is certainly no longer necessary, on the other hand it doesn't hurt much.

> I guess `EXTRAFLAGS` is only used inside the `spkg-install` script, so why export it?

Typical stupidity. Only one of N instances of that.

> On SunOS, do we need the configure flag `--with-gcc="gcc -m64"` given that `-m64` is already inside `$OPT`?  Or, if `$OPT` does nothing, why specify `$OPT`?

That's again related to libtool I think.

---

If you come across such things and don't want to fix them immediately, it's IMHO best to simply put comments into the files or `SPKG.txt`. Comments don't hurt and don't have to be tested, so no reviewer should complain about them (as opposed to too many or "difficult" functional changes).

Also, the next one touching the spkg (or files in general) hopefully will take them into account, and doesn't have to search trac for older tickets with open issues.



---

archive/issue_events_150920.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-08T12:00:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150920"
}
```



---

archive/issue_events_150921.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-08T12:00:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11447#event-150921"
}
```



---

archive/issue_comments_115885.json:
```json
{
    "body": "Merged: **sage-4.7.1.rc0**",
    "created_at": "2011-07-08T12:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11447",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11447#issuecomment-115885",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.1.rc0**
