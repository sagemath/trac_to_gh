# Issue 11682: Thematic Tutorial on Sandpiles

archive/issues_011510.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nI would like to add a thematic tutorial on the abelian sandpile model.\n\n---\n\nApply only [attachment: trac_11682_sandpile_doc.v6.patch](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz) to the Sage library.\n\n\n\n\nNote: To fully make use of it, the optional 4ti2 spkg is required; see comments below.\n\n\n\nCC:  @sagetrac-mhampton @rbeezer\n\nComponent: **documentation**\n\nKeywords: **sandpile**\n\nAuthor: **David Perkinson**\n\nReviewer: **Rob Beezer, John Palmieri**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11682_\n\n",
    "closed_at": "2011-09-27T17:40:35Z",
    "created_at": "2011-08-12T17:21:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Thematic Tutorial on Sandpiles",
    "type": "issue",
    "updated_at": "2011-09-27T17:40:35Z",
    "url": "https://github.com/sagemath/sage/issues/11682",
    "user": "https://github.com/sagetrac-dperkinson"
}
```
<div id="comment:0"></div>

I would like to add a thematic tutorial on the abelian sandpile model.

---

Apply only [attachment: trac_11682_sandpile_doc.v6.patch](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz) to the Sage library.




Note: To fully make use of it, the optional 4ti2 spkg is required; see comments below.



CC:  @sagetrac-mhampton @rbeezer

Component: **documentation**

Keywords: **sandpile**

Author: **David Perkinson**

Reviewer: **Rob Beezer, John Palmieri**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/11682_





---

archive/issue_events_155139.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-08-12T17:21:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155139"
}
```



---

archive/issue_events_155140.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-08-12T17:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155140"
}
```



---

archive/issue_events_155141.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-08-12T17:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155141"
}
```



---

archive/issue_events_155142.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-08-12T17:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155142"
}
```



---

archive/issue_events_155143.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2011-08-12T17:21:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "subject": "https://github.com/sagetrac-dperkinson",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155143"
}
```



---

archive/issue_comments_120647.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhile you're at it, there are some typos(?) in `sandpile.py`'s docstring (just the modification dates), and GLPK is meanwhile a standard Sage package.",
    "created_at": "2011-08-12T17:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120647",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

While you're at it, there are some typos(?) in `sandpile.py`'s docstring (just the modification dates), and GLPK is meanwhile a standard Sage package.



---

archive/issue_comments_120648.json:
```json
{
    "body": "Attachment: **[trac_11682_sandpile_doc.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.patch.gz)**\n\nthematic tutorial on the abelian sandpile model",
    "created_at": "2011-08-12T17:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120648",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

Attachment: **[trac_11682_sandpile_doc.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.patch.gz)**

thematic tutorial on the abelian sandpile model



---

archive/issue_comments_120649.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI am new at this. So although I did my best to follow the online documentation for submitting a change, I apologize in advance for any mistakes I may have made.  My intention was to add three changes to the thematic_tutorials directory:\n\n1. Add the file sandpile.rst.\n2. Change index.rst to include a reference to sandpile.rst.\n3. Add a directory, sandpile, containing png image files for sandpile.rst.",
    "created_at": "2011-08-12T18:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120649",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:2" align="right">comment:2</div>

I am new at this. So although I did my best to follow the online documentation for submitting a change, I apologize in advance for any mistakes I may have made.  My intention was to add three changes to the thematic_tutorials directory:

1. Add the file sandpile.rst.
2. Change index.rst to include a reference to sandpile.rst.
3. Add a directory, sandpile, containing png image files for sandpile.rst.



---

archive/issue_comments_120650.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@nexttime](#comment%3A1):\n> While you're at it, there are some typos(?) in `sandpile.py`'s docstring (just the modification dates), and GLPK is meanwhile a standard Sage package.\n\nWill do. Thanks.",
    "created_at": "2011-08-12T18:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120650",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@nexttime](#comment%3A1):
> While you're at it, there are some typos(?) in `sandpile.py`'s docstring (just the modification dates), and GLPK is meanwhile a standard Sage package.

Will do. Thanks.



---

archive/issue_comments_120651.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHi David,\n\nThis will be a nice contribution!  \n\nOne suggestion after a quick look.  *Really* long output in code blocks can be broken at any white-space character without breaking doctests (and you can add whitespace to existing whitespace).\n\nSo sometimes you can break, and line-up output to be a bit more readable, rather than spilling over the margin in PDF versions, or having to use a very long horizontal scrollbar in HTML versions.  Experiment with one instance before doing a lot of tedious editing, to see what works and how.\n\nRob",
    "created_at": "2011-08-12T18:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120651",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:4" align="right">comment:4</div>

Hi David,

This will be a nice contribution!  

One suggestion after a quick look.  *Really* long output in code blocks can be broken at any white-space character without breaking doctests (and you can add whitespace to existing whitespace).

So sometimes you can break, and line-up output to be a bit more readable, rather than spilling over the margin in PDF versions, or having to use a very long horizontal scrollbar in HTML versions.  Experiment with one instance before doing a lot of tedious editing, to see what works and how.

Rob



---

archive/issue_comments_120652.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@sagetrac-dperkinson](#comment%3A2):\n> I am new at this. So although I did my best to follow the online documentation for submitting a change, I apologize in advance for any mistakes I may have made.\n\nNothing to apologize for.\n\nAlthough they'll meanwhile be added in case they're missing *when a ticket gets merged into a release*, commit messages should IMHO still contain the trac ticket number, i.e. *start* with e.g. either \"`#11682 ...`\" or \"`Trac 11682: ...`\", or at least reference the ticket on the first line (\"*brief one-line description* `(#11682)`\").\n\n\n\n\nI think the indices to collections of rather unrelated documents (like *Thematic Tutorials*) are kept in alphabetical order, so `sandpile` should unfortunately be the *last*. ;-)",
    "created_at": "2011-08-12T22:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120652",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@sagetrac-dperkinson](#comment%3A2):
> I am new at this. So although I did my best to follow the online documentation for submitting a change, I apologize in advance for any mistakes I may have made.

Nothing to apologize for.

Although they'll meanwhile be added in case they're missing *when a ticket gets merged into a release*, commit messages should IMHO still contain the trac ticket number, i.e. *start* with e.g. either "`#11682 ...`" or "`Trac 11682: ...`", or at least reference the ticket on the first line ("*brief one-line description* `(#11682)`").




I think the indices to collections of rather unrelated documents (like *Thematic Tutorials*) are kept in alphabetical order, so `sandpile` should unfortunately be the *last*. ;-)



---

archive/issue_comments_120653.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> Although they'll meanwhile be added in case they're missing *when a ticket gets merged into a release*, commit messages should IMHO still contain the trac ticket number, i.e. *start* with e.g. either \"`#11682 ...`\" or \"`Trac 11682: ...`\", or at least reference the ticket on the first line (\"*brief one-line description* `(#11682)`\").\n> \n\nYes.  I accidentally left that out, and then could not figure out how to change the commit message after-the-fact.  How does one do that?  Can it be changed now?\n\n> \n\n> \n> I think the indices to collections of rather unrelated documents (like *Thematic Tutorials*) are kept in alphabetical order, so `sandpile` should unfortunately be the *last*. ;-)\n> \n\nI realize the topics should be in alphatical order.  The issue here is that the file is called \"sandpile.rst\" and the title of the resulting html page is \"Abelian sandpile model\".  So if you do a html docbuild, the topics actually will be in alphabetical order.",
    "created_at": "2011-08-12T22:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120653",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:6" align="right">comment:6</div>

> Although they'll meanwhile be added in case they're missing *when a ticket gets merged into a release*, commit messages should IMHO still contain the trac ticket number, i.e. *start* with e.g. either "`#11682 ...`" or "`Trac 11682: ...`", or at least reference the ticket on the first line ("*brief one-line description* `(#11682)`").
> 

Yes.  I accidentally left that out, and then could not figure out how to change the commit message after-the-fact.  How does one do that?  Can it be changed now?

> 

> 
> I think the indices to collections of rather unrelated documents (like *Thematic Tutorials*) are kept in alphabetical order, so `sandpile` should unfortunately be the *last*. ;-)
> 

I realize the topics should be in alphatical order.  The issue here is that the file is called "sandpile.rst" and the title of the resulting html page is "Abelian sandpile model".  So if you do a html docbuild, the topics actually will be in alphabetical order.



---

archive/issue_comments_120654.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@sagetrac-dperkinson](#comment%3A6):\n> > commit messages should IMHO still contain the trac ticket number\n> \n> Yes.  I accidentally left that out, and then could not figure out how to change the commit message after-the-fact.  How does one do that?  Can it be changed now?\n\nNot an issue if you update your patch anyway. (You can check *Replace existing file of the same name* or whatever it is called when you re-attach a new version of the patch.)\n\nYou can also just edit the patch you exported with Mercurial (since it is a plain text file) with any editor and re-upload it (with the same filename, see above).\n\nNobody will mind if you decide to attach a new version of your patch *with a different filename*, e.g. `trac_11682_sandpile_doc.v2.patch`, but the previous, obsolete one doesn't contain the ticket number in its commit message.\n\nIf there are different [versions of] patches or other files (to *not* be applied) attached to the ticket, the ticket's description should state which files have to actually be applied, and if necessary, in which order. (You could also attach a second patch *to be applied on top of your previous one*, in which case you should change the commit message of the first as mentioned above.)\n\n\n\n\n> The issue here is that the file is called \"sandpile.rst\" and the title of the resulting html page is \"Abelian sandpile model\".\n\nAh sorry, did not notice.",
    "created_at": "2011-08-12T23:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120654",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@sagetrac-dperkinson](#comment%3A6):
> > commit messages should IMHO still contain the trac ticket number
> 
> Yes.  I accidentally left that out, and then could not figure out how to change the commit message after-the-fact.  How does one do that?  Can it be changed now?

Not an issue if you update your patch anyway. (You can check *Replace existing file of the same name* or whatever it is called when you re-attach a new version of the patch.)

You can also just edit the patch you exported with Mercurial (since it is a plain text file) with any editor and re-upload it (with the same filename, see above).

Nobody will mind if you decide to attach a new version of your patch *with a different filename*, e.g. `trac_11682_sandpile_doc.v2.patch`, but the previous, obsolete one doesn't contain the ticket number in its commit message.

If there are different [versions of] patches or other files (to *not* be applied) attached to the ticket, the ticket's description should state which files have to actually be applied, and if necessary, in which order. (You could also attach a second patch *to be applied on top of your previous one*, in which case you should change the commit message of the first as mentioned above.)




> The issue here is that the file is called "sandpile.rst" and the title of the resulting html page is "Abelian sandpile model".

Ah sorry, did not notice.



---

archive/issue_comments_120655.json:
```json
{
    "body": "Attachment: **[trac_11682_sandpile_doc.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v2.patch.gz)**\n\nreplaces trac_11682_sandpile_doc.patch",
    "created_at": "2011-08-13T19:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120655",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

Attachment: **[trac_11682_sandpile_doc.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v2.patch.gz)**

replaces trac_11682_sandpile_doc.patch



---

archive/issue_comments_120656.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI just posted trac_11682_sandpile_doc.v2.patch.  It replaces trac_11682_sandpile_doc.patch.  So trac_11682_sandpile_doc.v2.patch should *not* be applied after applying trac_11682_sandpile_doc.patch.\n\nIn trac_11682_sandpile_doc.v2.patch, I have fixed the long lines as suggested by Rob Beezer (thanks, Rob!).  I have included the trac number in the commit message this time around.\n\nFor me, all tests passed with the command\n\nsudo sage -t -verbose -long --optional <PATH_TO_SAGE_BRANCH>/doc/en/thematic_tutorials/sandpile.rst",
    "created_at": "2011-08-13T19:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120656",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:8" align="right">comment:8</div>

I just posted trac_11682_sandpile_doc.v2.patch.  It replaces trac_11682_sandpile_doc.patch.  So trac_11682_sandpile_doc.v2.patch should *not* be applied after applying trac_11682_sandpile_doc.patch.

In trac_11682_sandpile_doc.v2.patch, I have fixed the long lines as suggested by Rob Beezer (thanks, Rob!).  I have included the trac number in the commit message this time around.

For me, all tests passed with the command

sudo sage -t -verbose -long --optional <PATH_TO_SAGE_BRANCH>/doc/en/thematic_tutorials/sandpile.rst



---

archive/issue_comments_120657.json:
```json
{
    "body": "replaces first two versions",
    "created_at": "2011-08-14T21:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120657",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

replaces first two versions



---

archive/issue_comments_120658.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_11682_sandpile_doc.v3.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v3.patch.gz)**\n\nThe third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:\n\n1. Adds the file sandpile.rst, \n2. Changes index.rst to include a reference to sandpile.rst. (Note that in index.rst, 'sandpile' does not appear in alphabetical order, but in the actual index.html that is produced, the corresponding title is 'Abelian sandpile model', which is in alphabetical order.)\n3. Adds a subdirectory, media/sandpile, containing png image files for sandpile.rst. \n\nTo test the patch, I created a fresh clone of sage-main, applied the patch\n\n    trac_11682_sandpile_doc.v3.patch\n\nand ran 'sage -docbuild thematic_tutorials html' and 'sage -docbuild thematic_tutorials pdf'.  The resulting html and pdf files and the index for the thematic tutorials were all as expected.  I reran \n\n    sage -t -verbose -long --optional <PATH_TO_SAGE_BRANCH>/doc/en/thematic_tutorials/sandpile.rst \n\nand again the tests all passed.\n\n[The problem with v2 of the patch was that mercurial was not allowing me to add png files.  (I needed to add appropriate lines to my .hgrc).]",
    "created_at": "2011-08-14T21:49:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120658",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_11682_sandpile_doc.v3.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v3.patch.gz)**

The third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:

1. Adds the file sandpile.rst, 
2. Changes index.rst to include a reference to sandpile.rst. (Note that in index.rst, 'sandpile' does not appear in alphabetical order, but in the actual index.html that is produced, the corresponding title is 'Abelian sandpile model', which is in alphabetical order.)
3. Adds a subdirectory, media/sandpile, containing png image files for sandpile.rst. 

To test the patch, I created a fresh clone of sage-main, applied the patch

    trac_11682_sandpile_doc.v3.patch

and ran 'sage -docbuild thematic_tutorials html' and 'sage -docbuild thematic_tutorials pdf'.  The resulting html and pdf files and the index for the thematic tutorials were all as expected.  I reran 

    sage -t -verbose -long --optional <PATH_TO_SAGE_BRANCH>/doc/en/thematic_tutorials/sandpile.rst 

and again the tests all passed.

[The problem with v2 of the patch was that mercurial was not allowing me to add png files.  (I needed to add appropriate lines to my .hgrc).]



---

archive/issue_events_155144.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2011-08-15T06:11:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155144"
}
```



---

archive/issue_comments_120659.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@sagetrac-dperkinson](#comment%3A9):\n> The third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:\n\nAt http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see\n\n```\nThe zero set for the sandpile ideal  is\n\n      Extra close brace\n```\n(the latter is in a red frame)\ninstead of a rendering of the (correctly looking) TeX formula. Is it just me (MacOSX 10.6, Sage 4.7.apha5)?\n\nPS. I looked at it in hope of finding code to supply the addition operation on the spanning trees, but to no avail :-)",
    "created_at": "2011-08-15T06:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120659",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@sagetrac-dperkinson](#comment%3A9):
> The third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:

At http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see

```
The zero set for the sandpile ideal  is

      Extra close brace
```
(the latter is in a red frame)
instead of a rendering of the (correctly looking) TeX formula. Is it just me (MacOSX 10.6, Sage 4.7.apha5)?

PS. I looked at it in hope of finding code to supply the addition operation on the spanning trees, but to no avail :-)



---

archive/issue_comments_120660.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHmm...  I am not having that problem (Ubuntu 10.10, Sage Version 4.7, Release Date: 2011-05-23).\n\nAbout spanning trees: are you thinking of adding them, using a bijection between them and elements of the sandpile group?\n\nReplying to [@dimpase](#comment%3A10):\n> Replying to [@sagetrac-dperkinson](#comment%3A9):\n> > The third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:\n> \n> \n> At http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see\n> \n> ```\n> The zero set for the sandpile ideal  is\n> \n>       Extra close brace\n> ```\n> (the latter is in a red frame)\n> instead of a rendering of the (correctly looking) TeX formula. Is it just me (MacOSX 10.6, Sage 4.7.apha5)?\n> \n> PS. I looked at it in hope of finding code to supply the addition operation on the spanning trees, but to no avail :-)",
    "created_at": "2011-08-15T06:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120660",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:11" align="right">comment:11</div>

Hmm...  I am not having that problem (Ubuntu 10.10, Sage Version 4.7, Release Date: 2011-05-23).

About spanning trees: are you thinking of adding them, using a bijection between them and elements of the sandpile group?

Replying to [@dimpase](#comment%3A10):
> Replying to [@sagetrac-dperkinson](#comment%3A9):
> > The third version of the patch, trac_11682_sandpile_doc.v3.patch does the following:
> 
> 
> At http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see
> 
> ```
> The zero set for the sandpile ideal  is
> 
>       Extra close brace
> ```
> (the latter is in a red frame)
> instead of a rendering of the (correctly looking) TeX formula. Is it just me (MacOSX 10.6, Sage 4.7.apha5)?
> 
> PS. I looked at it in hope of finding code to supply the addition operation on the spanning trees, but to no avail :-)



---

archive/issue_comments_120661.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@sagetrac-dperkinson](#comment%3A11):\n> Hmm...  I am not having that problem (Ubuntu 10.10, Sage Version 4.7, Release Date: 2011-05-23).\n\nOK, I'll look further into this.\n\n> \n> About spanning trees: are you thinking of adding them, using a bijection between them and elements of the sandpile group?\n\nactually, I need it for directed graphs, in view of https://oeis.org/draft/A027362;\n the only reference in literature on sandpiles for directed graphs I know is in a recent paper by Lionel Levine --- and no explicit bijection is given there. It seems one has to roll his own here, no?",
    "created_at": "2011-08-15T07:12:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120661",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@sagetrac-dperkinson](#comment%3A11):
> Hmm...  I am not having that problem (Ubuntu 10.10, Sage Version 4.7, Release Date: 2011-05-23).

OK, I'll look further into this.

> 
> About spanning trees: are you thinking of adding them, using a bijection between them and elements of the sandpile group?

actually, I need it for directed graphs, in view of https://oeis.org/draft/A027362;
 the only reference in literature on sandpiles for directed graphs I know is in a recent paper by Lionel Levine --- and no explicit bijection is given there. It seems one has to roll his own here, no?



---

archive/issue_events_155145.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-16T05:08:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155145"
}
```



---

archive/issue_events_155146.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-16T05:08:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155146"
}
```



---

archive/issue_comments_120662.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHi David,\n\nThis is very nice and all seems to be working pretty well as far as patches and images and all that.\n\nI have one doctest failure (same command twice, then a follow-on command fails).  I'm using 4.7.1.alpha4.  It could be I am behind?  Has this changed?  Which version are you testing on?\n\n```\nFile \"/sage/sage-4.7.1.alpha4/devel/sage-main/doc/en/thematic_tutorials/sandpile.rst\", line 4189:\n    sage: eff = D.effective_div()\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/sage-4.7.1.alpha4/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/sage/sage-4.7.1.alpha4/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/sage/sage-4.7.1.alpha4/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_102[4]>\", line 1, in <module>\n        eff = D.effective_div()###line 4189:\n    sage: eff = D.effective_div()\n      File \"/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 4212, in effective_div\n        return deepcopy(self._effective_div)\n      File \"/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 3551, in __getattr__\n        self._set_effective_div()\n      File \"/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 4178, in _set_effective_div\n        r = self.linear_system()\n      File \"/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 4157, in linear_system\n        return self._linear_system\n      File \"/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 3549, in __getattr__\n        return self.__dict__[name]\n    KeyError: '_linear_system'\n```\n\nSame thing at line 4360.\n\n\nSome comments on formatting, etc, in no particular order.\n\n1.  Other tutorials have a main title (in the index of tutorials) that is capitalized, so maybe yours should be also.\n\n2.  Maybe \"is in the works\" could read as \"will appear as\"?\n\n3.  Installing 4ti2.  Does it really need the patch level and all?  I thought it was smarter and `sage -i 4ti2` would grab the newest spkg?\n\n4.  URL references to other parts of the documentation should perhaps be relative links, not full-blown `http://` style.  Sage should not presume an internet connection, and indeed, many may view the documentation locally, especially if coming to it from within the notebook.  So\n\n```\nhttp://sagemath.org/doc/reference/sage/graphs/graph_generators.html \n```\n\ncould become\n\n```\n../reference/sage/graphs/graph_generators.html\n```\n\nThere are also ways to link to documentation for classes, modules, functions, etc with syntax such as\n\n```\n:mod:`sage.graphs.graph_generators`\n```\n\nwhich might even work better (ask if you need help with this).\n\n5.  SandpileConfig, !^ operator: needs a double-colon for the examples, they are not being rendered verbatim.\n\n6.  Do you want triple-dashes to make full-width horizontal rules in your lists of methods?  I'm just getting a short stubby thing, maybe you need more dashes?\n\n7.  Are Sage code examples in the \"python blocks\" being tested?  (Break one and see.)  I don't know - I've never used this construct in writing documentation.  Doesn't matter either way, I think.",
    "created_at": "2011-08-16T05:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120662",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:13" align="right">comment:13</div>

Hi David,

This is very nice and all seems to be working pretty well as far as patches and images and all that.

I have one doctest failure (same command twice, then a follow-on command fails).  I'm using 4.7.1.alpha4.  It could be I am behind?  Has this changed?  Which version are you testing on?

```
File "/sage/sage-4.7.1.alpha4/devel/sage-main/doc/en/thematic_tutorials/sandpile.rst", line 4189:
    sage: eff = D.effective_div()
Exception raised:
    Traceback (most recent call last):
      File "/sage/sage-4.7.1.alpha4/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/sage/sage-4.7.1.alpha4/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/sage/sage-4.7.1.alpha4/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_102[4]>", line 1, in <module>
        eff = D.effective_div()###line 4189:
    sage: eff = D.effective_div()
      File "/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 4212, in effective_div
        return deepcopy(self._effective_div)
      File "/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 3551, in __getattr__
        self._set_effective_div()
      File "/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 4178, in _set_effective_div
        r = self.linear_system()
      File "/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 4157, in linear_system
        return self._linear_system
      File "/sage/sage-4.7.1.alpha4/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 3549, in __getattr__
        return self.__dict__[name]
    KeyError: '_linear_system'
```

Same thing at line 4360.


Some comments on formatting, etc, in no particular order.

1.  Other tutorials have a main title (in the index of tutorials) that is capitalized, so maybe yours should be also.

2.  Maybe "is in the works" could read as "will appear as"?

3.  Installing 4ti2.  Does it really need the patch level and all?  I thought it was smarter and `sage -i 4ti2` would grab the newest spkg?

4.  URL references to other parts of the documentation should perhaps be relative links, not full-blown `http://` style.  Sage should not presume an internet connection, and indeed, many may view the documentation locally, especially if coming to it from within the notebook.  So

```
http://sagemath.org/doc/reference/sage/graphs/graph_generators.html 
```

could become

```
../reference/sage/graphs/graph_generators.html
```

There are also ways to link to documentation for classes, modules, functions, etc with syntax such as

```
:mod:`sage.graphs.graph_generators`
```

which might even work better (ask if you need help with this).

5.  SandpileConfig, !^ operator: needs a double-colon for the examples, they are not being rendered verbatim.

6.  Do you want triple-dashes to make full-width horizontal rules in your lists of methods?  I'm just getting a short stubby thing, maybe you need more dashes?

7.  Are Sage code examples in the "python blocks" being tested?  (Break one and see.)  I don't know - I've never used this construct in writing documentation.  Doesn't matter either way, I think.



---

archive/issue_comments_120663.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment%3A10):\n> At http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see\n\nI didn't see this problem, all looks well at `#zeros`.\n\nUbuntu 11.04, Sage 4.7.1.alpha4",
    "created_at": "2011-08-16T05:10:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120663",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment%3A10):
> At http://localhost:8000/doc/live/thematic_tutorials/sandpile.html#zeros I see

I didn't see this problem, all looks well at `#zeros`.

Ubuntu 11.04, Sage 4.7.1.alpha4



---

archive/issue_events_155147.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-16T05:10:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155147"
}
```



---

archive/issue_events_155148.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-16T05:10:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155148"
}
```



---

archive/issue_comments_120664.json:
```json
{
    "body": "Attachment: **[trac_11682_sandpile_doc.v4.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v4.patch.gz)**\n\nfirst, apply trac_11682_sandpile_doc.v3.patch then trac_11682_sandpile_doc.v4.patch",
    "created_at": "2011-09-11T17:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120664",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

Attachment: **[trac_11682_sandpile_doc.v4.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v4.patch.gz)**

first, apply trac_11682_sandpile_doc.v3.patch then trac_11682_sandpile_doc.v4.patch



---

archive/issue_comments_120665.json:
```json
{
    "body": "first apply trac_11682_sandpile_doc.v3.patch then trac_11682_sandpile_doc.v4.patch",
    "created_at": "2011-09-11T17:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120665",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

first apply trac_11682_sandpile_doc.v3.patch then trac_11682_sandpile_doc.v4.patch



---

archive/issue_comments_120666.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[trac_11682_sandpile_doc.v4.2.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v4.2.patch.gz)**\n\nRob: thanks for the comments!  \n\nI have addressed them all (see specifics below).  I doctested the current\nversion (v4) with the --optional and -long and all tests passed.\n\nNOTE: First apply trac_11682_sandpile_doc.v3.patch, then\ntrac_11682_sandpile_doc.v4.patch on top of that.  Also, v4 and v4.2 are identical.  I just tried to remove a comma from the description and ended up with two copies.\n\nThanks,\nDave\n\n>I have one doctest failure (same command twice, then a follow-on command\n>fails). I'm using 4.7.1.alpha4. It could be I am behind? Has this changed?\n>Which version are you testing on?\n\nThe problem here is that you do not have 4ti2 installed and I forgot to put to\ninclude '# optional 4ti2' next to these examples.  I have added '# optional\n4ti2' in these two places in v4.\n\n(I am testing on version 4.7.1 now.)\n\n>1. Other tutorials have a main title (in the index of tutorials) that is\n>capitalized, so maybe yours should be also.\n\nFixed.\n\n>2. Maybe \"is in the works\" could read as \"will appear as\"?\n\nFixed (I removed the reference entirely for the time being).\n\n>3. Installing 4ti2. Does it really need the patch level and all? I thought it\n>was smarter and sage -i 4ti2 would grab the newest spkg?\n\nI just tested this again.  The command 'sage -i 4ti2' attempts to install the\nwrong version of 4ti2 and crashes, whereas 'sage -i 4ti2.p0' works fine.  I sent\na note to sage-devel about this.\n\n>4. URL references to other parts of the documentation should perhaps\n>be.relative links, not full-blown http:// style. Sage should not presume an\n>internet connection, and indeed, many may view the documentation locally,\n>especially if coming to it from within the notebook. So\n>\n>http://sagemath.org/doc/reference/sage/graphs/graph_generators.html \n>\n>could become\n>\n>../reference/sage/graphs/graph_generators.html\n>\n>There are also ways to link to documentation for classes, modules, functions,\n>etc with syntax such as\n>\n>:mod:`sage.graphs.graph_generators`\n>\n>which might even work better (ask if you need help with this).\n\nFixed.  I used your former suggestion.\n\n>5. SandpileConfig, ^ operator: needs a double-colon for the examples, they are\n>not being rendered verbatim.\n\nFixed.\n\n>6. Do you want triple-dashes to make full-width horizontal rules in your lists\n>of methods? I'm just getting a short stubby thing, maybe you need more dashes?\n\nI am getting em-dashes from '---' in the rst file.  I don't understand why you\nare not getting longer dashes.\n\n>7. Are Sage code examples in the \"python blocks\" being tested? (Break one and\n>see.) I don't know - I've never used this construct in writing documentation.\n>Doesn't matter either way, I think.\n\nI ascertained that the python blocks were *not* being tested.  So I checked\neach manually, found several problems (due to out-of-date syntax), and fixed\nthem.  I do not want to have the blocks labeled as 'EXAMPLES'.  I putua warning\nat the top of sandpile.rst that these blocks need to be tested by hand.",
    "created_at": "2011-09-11T17:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120666",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[trac_11682_sandpile_doc.v4.2.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v4.2.patch.gz)**

Rob: thanks for the comments!  

I have addressed them all (see specifics below).  I doctested the current
version (v4) with the --optional and -long and all tests passed.

NOTE: First apply trac_11682_sandpile_doc.v3.patch, then
trac_11682_sandpile_doc.v4.patch on top of that.  Also, v4 and v4.2 are identical.  I just tried to remove a comma from the description and ended up with two copies.

Thanks,
Dave

>I have one doctest failure (same command twice, then a follow-on command
>fails). I'm using 4.7.1.alpha4. It could be I am behind? Has this changed?
>Which version are you testing on?

The problem here is that you do not have 4ti2 installed and I forgot to put to
include '# optional 4ti2' next to these examples.  I have added '# optional
4ti2' in these two places in v4.

(I am testing on version 4.7.1 now.)

>1. Other tutorials have a main title (in the index of tutorials) that is
>capitalized, so maybe yours should be also.

Fixed.

>2. Maybe "is in the works" could read as "will appear as"?

Fixed (I removed the reference entirely for the time being).

>3. Installing 4ti2. Does it really need the patch level and all? I thought it
>was smarter and sage -i 4ti2 would grab the newest spkg?

I just tested this again.  The command 'sage -i 4ti2' attempts to install the
wrong version of 4ti2 and crashes, whereas 'sage -i 4ti2.p0' works fine.  I sent
a note to sage-devel about this.

>4. URL references to other parts of the documentation should perhaps
>be.relative links, not full-blown http:// style. Sage should not presume an
>internet connection, and indeed, many may view the documentation locally,
>especially if coming to it from within the notebook. So
>
>http://sagemath.org/doc/reference/sage/graphs/graph_generators.html 
>
>could become
>
>../reference/sage/graphs/graph_generators.html
>
>There are also ways to link to documentation for classes, modules, functions,
>etc with syntax such as
>
>:mod:`sage.graphs.graph_generators`
>
>which might even work better (ask if you need help with this).

Fixed.  I used your former suggestion.

>5. SandpileConfig, ^ operator: needs a double-colon for the examples, they are
>not being rendered verbatim.

Fixed.

>6. Do you want triple-dashes to make full-width horizontal rules in your lists
>of methods? I'm just getting a short stubby thing, maybe you need more dashes?

I am getting em-dashes from '---' in the rst file.  I don't understand why you
are not getting longer dashes.

>7. Are Sage code examples in the "python blocks" being tested? (Break one and
>see.) I don't know - I've never used this construct in writing documentation.
>Doesn't matter either way, I think.

I ascertained that the python blocks were *not* being tested.  So I checked
each manually, found several problems (due to out-of-date syntax), and fixed
them.  I do not want to have the blocks labeled as 'EXAMPLES'.  I putua warning
at the top of sandpile.rst that these blocks need to be tested by hand.



---

archive/issue_comments_120667.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> I ascertained that the python blocks were *not* being tested. So I checked each manually, found several problems (due to out-of-date syntax), and fixed them. I do not want to have the blocks labeled as 'EXAMPLES'. I putua warning at the top of sandpile.rst that these blocks need to be tested by hand.\n\nThis code **must** be tested automatically.\n\nTo do this, you don't have to label them as `EXAMPLES`, you just need to delimit them with a double colon, say like this:\n\n```diff\n@@ -74,16 +77,14 @@ configuration `c'=(1,1,3)`.  Here, `4` g\n these has gone to the sink vertex (and forgotten), one has gone to vertex 1,\n and two have gone to vertex 2, since the edge from 1 to 2 has weight 2.\n Vertex 3 in the new configuration is now unstable.  The Sage code for this\n-example looks like this:\n-\n-.. code-block:: python\n-\n-    Create the sandpile:\n+example looks like this::\n+\n+   Create the sandpile:\n \n         sage: g = {'sink':{},\n-                   1:{'sink':1, 2:1, 3:2},\n-                   2:{1:1, 3:1},\n-                   3:{1:1, 2:1}}\n+        ...        1:{'sink':1, 2:1, 3:2},\n+        ...        2:{1:1, 3:1},\n+        ...        3:{1:1, 2:1}}\n         sage: S = Sandpile(g, 'sink')\n         sage: S.show(edge_labels=true)  # to display the graph\n```\n(The triple dots are to denote continuation lines.)  I would also suggest that you put `.. linkall` near the top of the file to tell Sage to link all of the examples when doctesting, since you define `S` in one block and then use it in the next one.\n\nWhen I made changes like the above, I got a bunch of doctest failures, e.g.\n\n```\nsh: /Applications/sage/local/bin/zsolve: No such file or directory\nsh: /Applications/sage/local/bin/zsolve: No such file or directory\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/doc/en/thematic_tutorials/sandpile.rst\", line 212:\n    sage: S.is_recurrent(c)\nException raised:\n    Traceback (most recent call last):\n      File \"/Applications/sage/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Applications/sage/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Applications/sage/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[23]>\", line 1, in <module>\n        S.is_recurrent(c)###line 212:\n    sage: S.is_recurrent(c)\n      File \"/Applications/sage/local/lib/python/site-packages/sage/sandpiles/sandpile.py\", line 416, in __getattr__\n        raise AttributeError, name\n    AttributeError: is_recurrent\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/doc/en/thematic_tutorials/sandpile.rst\", line 317:\n    sage: S.reduced_laplacian().dense_matrix().smith_form()\nExpected:\n    ([1 0 0]\n    [0 1 0]\n    [0 0 3],\n     [ 0  0  1]\n    [ 1  0  0]\n    [ 0  1 -1],\n     [3 1 4]\n    [4 1 6]\n    [4 1 5])\nGot:\n    (\n    [1 0 0]  [ 0  0  1]  [3 1 4]\n    [0 1 0]  [ 1  0  0]  [4 1 6]\n    [0 0 3], [ 0  1 -1], [4 1 5]\n    )\n```\nThere were 32 failures in all, some of which are minor, like the spacing in the matrix, but some look more significant.",
    "created_at": "2011-09-11T18:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120667",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

> I ascertained that the python blocks were *not* being tested. So I checked each manually, found several problems (due to out-of-date syntax), and fixed them. I do not want to have the blocks labeled as 'EXAMPLES'. I putua warning at the top of sandpile.rst that these blocks need to be tested by hand.

This code **must** be tested automatically.

To do this, you don't have to label them as `EXAMPLES`, you just need to delimit them with a double colon, say like this:

```diff
@@ -74,16 +77,14 @@ configuration `c'=(1,1,3)`.  Here, `4` g
 these has gone to the sink vertex (and forgotten), one has gone to vertex 1,
 and two have gone to vertex 2, since the edge from 1 to 2 has weight 2.
 Vertex 3 in the new configuration is now unstable.  The Sage code for this
-example looks like this:
-
-.. code-block:: python
-
-    Create the sandpile:
+example looks like this::
+
+   Create the sandpile:
 
         sage: g = {'sink':{},
-                   1:{'sink':1, 2:1, 3:2},
-                   2:{1:1, 3:1},
-                   3:{1:1, 2:1}}
+        ...        1:{'sink':1, 2:1, 3:2},
+        ...        2:{1:1, 3:1},
+        ...        3:{1:1, 2:1}}
         sage: S = Sandpile(g, 'sink')
         sage: S.show(edge_labels=true)  # to display the graph
```
(The triple dots are to denote continuation lines.)  I would also suggest that you put `.. linkall` near the top of the file to tell Sage to link all of the examples when doctesting, since you define `S` in one block and then use it in the next one.

When I made changes like the above, I got a bunch of doctest failures, e.g.

```
sh: /Applications/sage/local/bin/zsolve: No such file or directory
sh: /Applications/sage/local/bin/zsolve: No such file or directory
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/doc/en/thematic_tutorials/sandpile.rst", line 212:
    sage: S.is_recurrent(c)
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Applications/sage/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Applications/sage/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[23]>", line 1, in <module>
        S.is_recurrent(c)###line 212:
    sage: S.is_recurrent(c)
      File "/Applications/sage/local/lib/python/site-packages/sage/sandpiles/sandpile.py", line 416, in __getattr__
        raise AttributeError, name
    AttributeError: is_recurrent
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/doc/en/thematic_tutorials/sandpile.rst", line 317:
    sage: S.reduced_laplacian().dense_matrix().smith_form()
Expected:
    ([1 0 0]
    [0 1 0]
    [0 0 3],
     [ 0  0  1]
    [ 1  0  0]
    [ 0  1 -1],
     [3 1 4]
    [4 1 6]
    [4 1 5])
Got:
    (
    [1 0 0]  [ 0  0  1]  [3 1 4]
    [0 1 0]  [ 1  0  0]  [4 1 6]
    [0 0 3], [ 0  1 -1], [4 1 5]
    )
```
There were 32 failures in all, some of which are minor, like the spacing in the matrix, but some look more significant.



---

archive/issue_comments_120668.json:
```json
{
    "body": "Attachment: **[trac_11682_sandpile_doc.v5.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v5.patch.gz)**\n\nthis patch replaces all of the previous patches",
    "created_at": "2011-09-13T23:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120668",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

Attachment: **[trac_11682_sandpile_doc.v5.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v5.patch.gz)**

this patch replaces all of the previous patches



---

archive/issue_comments_120669.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks for the useful comments!\n\nI have moved all of the sage examples that were in python code-blocks so that\nthey are doctest-able.  Running the doctests made me aware of several\nsignificant problems, which I fixed.  When I now run sage -t --verbose -long\n--optional on sandpile.rst, all tests pass.\n\nThe current patch, trac_11682_sandpile_doc.v5.patch, replaces all the others,\ni.e, it should not be applied on top of any of the previous patches.",
    "created_at": "2011-09-13T23:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120669",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks for the useful comments!

I have moved all of the sage examples that were in python code-blocks so that
they are doctest-able.  Running the doctests made me aware of several
significant problems, which I fixed.  When I now run sage -t --verbose -long
--optional on sandpile.rst, all tests pass.

The current patch, trac_11682_sandpile_doc.v5.patch, replaces all the others,
i.e, it should not be applied on top of any of the previous patches.



---

archive/issue_events_155149.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-09-13T23:09:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155149"
}
```



---

archive/issue_events_155150.json:
```json
{
    "actor": "https://github.com/sagetrac-dperkinson",
    "created_at": "2011-09-13T23:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155150"
}
```



---

archive/issue_events_155151.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-09-18T17:24:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155151"
}
```



---

archive/issue_events_155152.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-09-18T17:24:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155152"
}
```



---

archive/issue_comments_120670.json:
```json
{
    "body": "Reviewer: **Rob Beezer, John Palmieri**",
    "created_at": "2011-09-18T17:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120670",
    "user": "https://github.com/rbeezer"
}
```

Reviewer: **Rob Beezer, John Palmieri**



---

archive/issue_comments_120671.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nDavid,\n\nI think this is looking real good.  It'll be a very nice contribution.\n\nAnd despite my earlier (unconsidered) ambivalence, the Python blocks really should be doctested, or they will eventually become useless (and an embarassment).  So I'm glad John P brought it up and that you have those reworked.\n\nJust one technical problem.  The six image files are not available. I don't see a \"sandpile\" subdirectory in `doc/en/thematic_tutorials/media/` after applying the patch, and from the sizes of your patches, it looks like a healthy number of bytes are AWOL.\n\nHow about manufacturing a patch with **just** the images?  That'll be really easy to check as a patch on top of the \"v5\" patch.  I'll presume you've done this once and can do it again, but feel free to ask for guidance.  With this done, this should move to positive review.\n\nThanks for this substantial contribution.\n\nRob",
    "created_at": "2011-09-18T17:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120671",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:18" align="right">comment:18</div>

David,

I think this is looking real good.  It'll be a very nice contribution.

And despite my earlier (unconsidered) ambivalence, the Python blocks really should be doctested, or they will eventually become useless (and an embarassment).  So I'm glad John P brought it up and that you have those reworked.

Just one technical problem.  The six image files are not available. I don't see a "sandpile" subdirectory in `doc/en/thematic_tutorials/media/` after applying the patch, and from the sizes of your patches, it looks like a healthy number of bytes are AWOL.

How about manufacturing a patch with **just** the images?  That'll be really easy to check as a patch on top of the "v5" patch.  I'll presume you've done this once and can do it again, but feel free to ask for guidance.  With this done, this should move to positive review.

Thanks for this substantial contribution.

Rob



---

archive/issue_comments_120672.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHopefully David can easily include the media files back in.  I tried to make a cumulative patch but I'm not sure where to put them.  In case someone wants to beat David to this, I put a copy of the missing media files at [http://sage.math.washington.edu/home/mhampton/sandpile_media.zip](http://sage.math.washington.edu/home/mhampton/sandpile_media.zip)\n-Marshall",
    "created_at": "2011-09-18T22:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120672",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<div id="comment:19" align="right">comment:19</div>

Hopefully David can easily include the media files back in.  I tried to make a cumulative patch but I'm not sure where to put them.  In case someone wants to beat David to this, I put a copy of the missing media files at [http://sage.math.washington.edu/home/mhampton/sandpile_media.zip](http://sage.math.washington.edu/home/mhampton/sandpile_media.zip)
-Marshall



---

archive/issue_comments_120673.json:
```json
{
    "body": "Attachment: **[trac_11682_sandpile_doc.v6.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz)**\n\nIncluded forgotten images.  This patch replaces all the previous ones.",
    "created_at": "2011-09-19T19:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120673",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

Attachment: **[trac_11682_sandpile_doc.v6.patch.gz](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz)**

Included forgotten images.  This patch replaces all the previous ones.



---

archive/issue_comments_120674.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPatch v6 includes the image files.  The computer I was using did not have the lines \n\n[diff]\ngit=1\n\nin its .hgrc file.\n\nThanks again.",
    "created_at": "2011-09-19T19:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120674",
    "user": "https://github.com/sagetrac-dperkinson"
}
```

<div id="comment:20" align="right">comment:20</div>

Patch v6 includes the image files.  The computer I was using did not have the lines 

[diff]
git=1

in its .hgrc file.

Thanks again.



---

archive/issue_comments_120675.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nDone!  Looks good.  Images are present and included properly.\n\nDid a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.  Positive review (and nice job!).",
    "created_at": "2011-09-21T02:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120675",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:21" align="right">comment:21</div>

Done!  Looks good.  Images are present and included properly.

Did a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.  Positive review (and nice job!).



---

archive/issue_events_155153.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-09-21T02:20:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155153"
}
```



---

archive/issue_events_155154.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-09-21T02:20:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155154"
}
```



---

archive/issue_comments_120676.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@rbeezer](#comment%3A21):\n> Did a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.\n\nFor the record, there's [a (not that) new 4ti2 spkg](http://sage.math.washington.edu/home/leif/Sage/release/sage-4.7.2.alpha3-prerelease/4ti2-1.3.2.p1.spkg) which will be \"included\" in Sage 4.7.2.alpha3. (It's still an *optional* package; cf. #8217.)",
    "created_at": "2011-09-21T12:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120676",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@rbeezer](#comment%3A21):
> Did a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.

For the record, there's [a (not that) new 4ti2 spkg](http://sage.math.washington.edu/home/leif/Sage/release/sage-4.7.2.alpha3-prerelease/4ti2-1.3.2.p1.spkg) which will be "included" in Sage 4.7.2.alpha3. (It's still an *optional* package; cf. #8217.)



---

archive/issue_events_155155.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-21T12:57:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "title_is": "Thematic Tutorial on Sandpiles",
    "title_was": "thematic tutorial on sandpiles",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155155"
}
```



---

archive/issue_comments_120677.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n I would like to add a thematic tutorial on the abelian sandpile model.\n+\n+---\n+\n+Apply only [attachment: trac_11682_sandpile_doc.v6.patch](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz) to the Sage library.\n+\n+\n+\n+\n+Note: To fully make use of it, the optional 4ti2 spkg is required; see comments below.\n+\n+\n``````\n",
    "created_at": "2011-09-21T12:57:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120677",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
 I would like to add a thematic tutorial on the abelian sandpile model.
+
+---
+
+Apply only [attachment: trac_11682_sandpile_doc.v6.patch](https://github.com/sagemath/sage/files/ticket11682/trac_11682_sandpile_doc.v6.patch.gz) to the Sage library.
+
+
+
+
+Note: To fully make use of it, the optional 4ti2 spkg is required; see comments below.
+
+
``````




---

archive/issue_comments_120678.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nexttime](#comment%3A22):\n> Replying to [@rbeezer](#comment%3A21):\n> > Did a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.\n> \n> \n> For the record, there's [a (not that) new 4ti2 spkg](http://sage.math.washington.edu/home/leif/Sage/release/sage-4.7.2.alpha3-prerelease/4ti2-1.3.2.p1.spkg) which will be \"included\" in Sage 4.7.2.alpha3. (It's still an *optional* package; cf. #8217.)\n\nFWIW, passes all (long, optional) doctests in `sage/sandpiles/` and `doc/en/thematic_tutorials/sandpile.rst` with the newer 4ti2 spkg and the Sage 4.7.2.alpha3 prerelease as well.",
    "created_at": "2011-09-21T15:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120678",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nexttime](#comment%3A22):
> Replying to [@rbeezer](#comment%3A21):
> > Did a full test of the new `sandpile.rst` file with `-long -optional` while the `4ti2.p0.spkg` spkg installed and all tests pass.
> 
> 
> For the record, there's [a (not that) new 4ti2 spkg](http://sage.math.washington.edu/home/leif/Sage/release/sage-4.7.2.alpha3-prerelease/4ti2-1.3.2.p1.spkg) which will be "included" in Sage 4.7.2.alpha3. (It's still an *optional* package; cf. #8217.)

FWIW, passes all (long, optional) doctests in `sage/sandpiles/` and `doc/en/thematic_tutorials/sandpile.rst` with the newer 4ti2 spkg and the Sage 4.7.2.alpha3 prerelease as well.



---

archive/issue_comments_120679.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-27T17:40:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11682#issuecomment-120679",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**



---

archive/issue_events_155156.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:40:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155156"
}
```



---

archive/issue_events_155157.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:40:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11682",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11682#event-155157"
}
```
