# Issue 11765: Sage's 'pkg-config' directory should always be added to PKG_CONFIG_PATH

archive/issues_011593.json:
```json
{
    "body": "Currently, `PKG_CONFIG_PATH` is only **set** to Sage's `pkg-config` directory (`$SAGE_ROOT/local/lib/pkgconfig/`) if it is empty (or not set at all).\n\nThe patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.\n\nThe previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the \"global\" environment, i.e. outside the Sage environment.\n\n---\n\nApply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch] to the **scripts repo**.\n\n\nAssignee: @nexttime\n\nCC:  @kiwifb @jhpalmieri\n\nKeywords: pkgconfig .pc sage-env\n\nResolution: fixed\n\nAuthor: Leif Leonhardy\n\nReviewer: Steven Trogdon\n\nMerged: sage-4.7.2.rc1\n\nIssue created by migration from https://trac.sagemath.org/ticket/11765\n\n",
    "closed_at": "2011-10-27T13:45:33Z",
    "created_at": "2011-08-31T17:25:23Z",
    "labels": [
        "component: scripts",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Sage's 'pkg-config' directory should always be added to PKG_CONFIG_PATH",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11765",
    "user": "https://github.com/nexttime"
}
```
Currently, `PKG_CONFIG_PATH` is only **set** to Sage's `pkg-config` directory (`$SAGE_ROOT/local/lib/pkgconfig/`) if it is empty (or not set at all).

The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.

The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the "global" environment, i.e. outside the Sage environment.

---

Apply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch] to the **scripts repo**.


Assignee: @nexttime

CC:  @kiwifb @jhpalmieri

Keywords: pkgconfig .pc sage-env

Resolution: fixed

Author: Leif Leonhardy

Reviewer: Steven Trogdon

Merged: sage-4.7.2.rc1

Issue created by migration from https://trac.sagemath.org/ticket/11765





---

archive/issue_comments_137903.json:
```json
{
    "body": "SCRIPTS repo. Based on Sage 4.7.2.alpha2.",
    "created_at": "2011-08-31T17:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137903",
    "user": "https://github.com/nexttime"
}
```

SCRIPTS repo. Based on Sage 4.7.2.alpha2.



---

archive/issue_comments_137904.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,11 @@\n The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.\n \n The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the \"global\" environment, i.e. outside the Sage environment.\n+\n+---\n+\n+Apply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch] to the **scripts repo**.\n+\n \n Author: Leif Leonhardy\n \n``````\n",
    "created_at": "2011-08-31T17:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137904",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,11 @@
 The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.
 
 The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the "global" environment, i.e. outside the Sage environment.
+
+---
+
+Apply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch] to the **scripts repo**.
+
 
 Author: Leif Leonhardy
 
``````




---

archive/issue_comments_137905.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch](tarball://root/attachments/some-uuid/ticket11765/trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch) by @nexttime created at 2011-08-31 17:41:52",
    "created_at": "2011-08-31T17:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137905",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>Attachment [trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch](tarball://root/attachments/some-uuid/ticket11765/trac_11765-always_add_sages_pc_dir_in_sage-env.scripts.patch) by @nexttime created at 2011-08-31 17:41:52



---

archive/issue_comments_137906.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-31T17:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137906",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_137907.json:
```json
{
    "body": "<a id='comment:2'></a>I looked at the patch and the reasoning is sound. I cannot test the patch properly right now but it looks correct to me.",
    "created_at": "2011-08-31T22:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137907",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>I looked at the patch and the reasoning is sound. I cannot test the patch properly right now but it looks correct to me.



---

archive/issue_comments_137908.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-26T04:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137908",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_137909.json:
```json
{
    "body": "<a id='comment:3'></a>I encountered this pkg-config problem while building vanilla sage-4.7.2.rc0 in a gentoo prefix on two different debian machines. On a x86 machine the build broke at the R spkg and on an amd64 machine at the matplotlib spkg. In both situations the failure was due to an incompatibility resulting from trying to include headers for libpng15, my system libpng headers, instead of headers for the sage-installed libpng12. Applying this patch allowed the correct headers to be located and sage to be built on both machines. I give this a positive review. The patch may need to be rebased.\n\n```\npatching file sage-env\nHunk #2 succeeded at 261 (offset 7 lines).\n```",
    "created_at": "2011-10-26T04:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137909",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'></a>I encountered this pkg-config problem while building vanilla sage-4.7.2.rc0 in a gentoo prefix on two different debian machines. On a x86 machine the build broke at the R spkg and on an amd64 machine at the matplotlib spkg. In both situations the failure was due to an incompatibility resulting from trying to include headers for libpng15, my system libpng headers, instead of headers for the sage-installed libpng12. Applying this patch allowed the correct headers to be located and sage to be built on both machines. I give this a positive review. The patch may need to be rebased.

```
patching file sage-env
Hunk #2 succeeded at 261 (offset 7 lines).
```



---

archive/issue_comments_137910.json:
```json
{
    "body": "<a id='comment:4'></a>Perhaps an explanation, which was pointed out to me by Fran\u00e7ois, is in order as to why the patch is needed here. I had previously built sage-4.7.2.rc0 on a gentoo system without a problem. However, the build process broke when done from within a gentoo prefix. On gentoo\u00a0PKG_CONFIG_PATH is not defined, by default, and thus there was no problem. But from within gentoo prefix\u00a0PKG_CONFIG_PATH is defined. Thus the patch is needed there to prepend to PKG_CONFIG_PATH the sage paths so the correct .pc files can be found.",
    "created_at": "2011-10-26T15:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137910",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>Perhaps an explanation, which was pointed out to me by François, is in order as to why the patch is needed here. I had previously built sage-4.7.2.rc0 on a gentoo system without a problem. However, the build process broke when done from within a gentoo prefix. On gentoo PKG_CONFIG_PATH is not defined, by default, and thus there was no problem. But from within gentoo prefix PKG_CONFIG_PATH is defined. Thus the patch is needed there to prepend to PKG_CONFIG_PATH the sage paths so the correct .pc files can be found.



---

archive/issue_comments_137911.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2011-10-26T20:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137911",
    "user": "https://github.com/kiwifb"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_137912.json:
```json
{
    "body": "<a id='comment:5'></a>PKG_CONFIG_PATH is not defined on Gentoo full stop. Prefix or regular. So this may break sage in subtle ways. R-2.10.1 as shipped in sage may break in the build stage because it is not compatible with png-1.5.\n\nI will elevate this to blocker and rebase it ASAP. Jeroen can decide whether it should be shipped in 4.7.2.",
    "created_at": "2011-10-26T20:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137912",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>PKG_CONFIG_PATH is not defined on Gentoo full stop. Prefix or regular. So this may break sage in subtle ways. R-2.10.1 as shipped in sage may break in the build stage because it is not compatible with png-1.5.

I will elevate this to blocker and rebase it ASAP. Jeroen can decide whether it should be shipped in 4.7.2.



---

archive/issue_comments_137913.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 fbissey]:\n> I will elevate this to blocker and rebase it ASAP.\n\n\nWell, there's no fuzz, just a few lines offset, so you don't have to rebase the patch.",
    "created_at": "2011-10-26T21:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137913",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>Replying to [comment:5 fbissey]:
> I will elevate this to blocker and rebase it ASAP.


Well, there's no fuzz, just a few lines offset, so you don't have to rebase the patch.



---

archive/issue_comments_137914.json:
```json
{
    "body": "Attachment [trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch](tarball://root/attachments/some-uuid/ticket11765/trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch) by @nexttime created at 2011-10-26 21:35:32\n\nSCRIPTS repo. Same patch rebased on Sage 4.7.2.rc0.",
    "created_at": "2011-10-26T21:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137914",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch](tarball://root/attachments/some-uuid/ticket11765/trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch) by @nexttime created at 2011-10-26 21:35:32

SCRIPTS repo. Same patch rebased on Sage 4.7.2.rc0.



---

archive/issue_comments_137915.json:
```json
{
    "body": "<a id='comment:7'></a>Well thanks that saves me the work :)",
    "created_at": "2011-10-26T21:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137915",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>Well thanks that saves me the work :)



---

archive/issue_comments_137916.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+Currently, `PKG_CONFIG_PATH` is only **set** to Sage's `pkg-config` directory (`$SAGE_ROOT/local/lib/pkgconfig/`) if it is empty (or not set at all).\n+\n+The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.\n+\n+The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the \"global\" environment, i.e. outside the Sage environment.\n+\n+---\n+\n+Apply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch] to the **scripts repo**.\n \n \n Author: Leif Leonhardy\n``````\n",
    "created_at": "2011-10-26T21:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137916",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
+Currently, `PKG_CONFIG_PATH` is only **set** to Sage's `pkg-config` directory (`$SAGE_ROOT/local/lib/pkgconfig/`) if it is empty (or not set at all).
+
+The patch now also prepends Sage's directory otherwise, such that Sage's `.pc` files will be picked up first.
+
+The previous behaviour could obviously break the build if `PKG_CONFIG_PATH` was already set in the "global" environment, i.e. outside the Sage environment.
+
+---
+
+Apply [attachment:trac_11765-always_add_sages_pc_dir_in_sage-env.rebased.scripts.patch] to the **scripts repo**.
 
 
 Author: Leif Leonhardy
``````




---

archive/issue_comments_137917.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 fbissey]:\n> Well thanks that saves me the work :)\n\n\nIf it makes you happy... ;-)",
    "created_at": "2011-10-26T21:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137917",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Replying to [comment:7 fbissey]:
> Well thanks that saves me the work :)


If it makes you happy... ;-)



---

archive/issue_events_030948.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-27T13:45:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11765#event-30948"
}
```



---

archive/issue_comments_137918.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-27T13:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11765#issuecomment-137918",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
