# Issue 11932: Allow running Sage with a temporary DOT_SAGE directory

archive/issues_011760.json:
```json
{
    "assignees": [
        "https://github.com/nexttime"
    ],
    "body": "Version which deals with matplotlib issue: apply \n\n- [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository\n- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository\n- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n- [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) to the Sage repository\n\n\n\nDepends on #11926\n\nCC:  @jhpalmieri\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **John Palmieri**\n\nMerged: **sage-5.1.beta0**\n\nComponent: **scripts**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11932_\n\n",
    "closed_at": "2012-05-13T21:32:43Z",
    "created_at": "2011-10-17T18:29:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Allow running Sage with a temporary DOT_SAGE directory",
    "type": "issue",
    "updated_at": "2012-05-13T21:32:43Z",
    "url": "https://github.com/sagemath/sage/issues/11932",
    "user": "https://github.com/jdemeyer"
}
```
Version which deals with matplotlib issue: apply 

- [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository
- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository
- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
- [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) to the Sage repository



Depends on #11926

CC:  @jhpalmieri

Reviewer: **Jeroen Demeyer**

Author: **John Palmieri**

Merged: **sage-5.1.beta0**

Component: **scripts**

_Issue created by migration from https://trac.sagemath.org/ticket/11932_





---

archive/issue_events_161080.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:29:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161080"
}
```



---

archive/issue_events_161081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:29:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "000080",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161081"
}
```



---

archive/issue_events_161082.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:29:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161082"
}
```



---

archive/issue_events_161083.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:29:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161083"
}
```



---

archive/issue_events_161084.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-17T18:29:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161084"
}
```



---

archive/issue_comments_126079.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI copied some patches from #11926 (and make some small changes to John's patch).",
    "created_at": "2011-10-17T18:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126079",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

I copied some patches from #11926 (and make some small changes to John's patch).



---

archive/issue_comments_126080.json:
```json
{
    "body": "Dependencies: **#11926**",
    "created_at": "2011-10-17T18:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126080",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#11926**



---

archive/issue_comments_126081.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'd rename the function (as it creates a temporary *directory*), and not use a global variable for the \"return value\".\n\nThe function could either take the variable name as its parameter (such that `sage_make_tmp_dir DIR` assigns the directory name to `DIR`), or just \"echo\" the result (as `mktemp` already does), such that one writes `DIR=sage_make_tmp_dir` or whatever.",
    "created_at": "2011-10-17T21:55:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126081",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

I'd rename the function (as it creates a temporary *directory*), and not use a global variable for the "return value".

The function could either take the variable name as its parameter (such that `sage_make_tmp_dir DIR` assigns the directory name to `DIR`), or just "echo" the result (as `mktemp` already does), such that one writes `DIR=sage_make_tmp_dir` or whatever.



---

archive/issue_comments_126082.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@nexttime](#comment:3):\n> or just \"echo\" the result (as `mktemp` already does), such that one writes `DIR=sage_make_tmp_dir` or whatever.\n\n<code>DIR=\\`sage_make_tmp_dir\\`</code> of course.",
    "created_at": "2011-10-18T06:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126082",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@nexttime](#comment:3):
> or just "echo" the result (as `mktemp` already does), such that one writes `DIR=sage_make_tmp_dir` or whatever.

<code>DIR=\`sage_make_tmp_dir\`</code> of course.



---

archive/issue_comments_126083.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHere's a version in which the function echoes the path of the temp dir.\n\nThis works best with the patch from #11924: without applying the patch there, the parent directory of the temporary .sage directory gets polluted with pickle cache files.",
    "created_at": "2011-10-18T18:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126083",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Here's a version in which the function echoes the path of the temp dir.

This works best with the patch from #11924: without applying the patch there, the parent directory of the temporary .sage directory gets polluted with pickle cache files.



---

archive/issue_comments_126084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+Apply \n \n+- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) to the Sage root repository\n+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the scripts repository\n+\n``````\n",
    "created_at": "2011-10-18T18:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126084",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+Apply 
 
+- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) to the Sage root repository
+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the scripts repository
+
``````




---

archive/issue_events_161085.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-10-18T18:49:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161085"
}
```



---

archive/issue_comments_126085.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126085",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_161086.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161086"
}
```



---

archive/issue_events_161087.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-28T22:16:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161087"
}
```



---

archive/issue_comments_126086.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRebased to #11073.  Documentation added.",
    "created_at": "2012-02-28T22:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126086",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Rebased to #11073.  Documentation added.



---

archive/issue_comments_126087.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Apply \n \n-- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) to the Sage root repository\n-- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the scripts repository\n+- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) and [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository\n+- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n \n``````\n",
    "created_at": "2012-02-28T22:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126087",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Apply 
 
-- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) to the Sage root repository
-- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the scripts repository
+- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) and [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository
+- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
 
``````




---

archive/issue_events_161088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-29T09:13:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161088"
}
```



---

archive/issue_events_161089.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-29T09:13:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161089"
}
```



---

archive/issue_comments_126088.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2012-02-29T09:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126088",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_126089.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe following seems to be portable:\n\n```\nmktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX\n```\nso I would use this instead of `sage_mktempdir`.\n\n`sage-sage` needs to be replaced by `sage`.\n\nFinally, why not simply run\n\n```\n./sage --norc </dev/null >/dev/null 2>/dev/null\n```\nin `spkg-install`?",
    "created_at": "2012-02-29T09:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126089",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

The following seems to be portable:

```
mktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX
```
so I would use this instead of `sage_mktempdir`.

`sage-sage` needs to be replaced by `sage`.

Finally, why not simply run

```
./sage --norc </dev/null >/dev/null 2>/dev/null
```
in `spkg-install`?



---

archive/issue_comments_126090.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2012-02-29T09:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126090",
    "user": "https://github.com/jdemeyer"
}
```

Author: **John Palmieri**



---

archive/issue_comments_126091.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI meant \"in `spkg/install`\".",
    "created_at": "2012-02-29T09:19:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126091",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I meant "in `spkg/install`".



---

archive/issue_comments_126092.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n Apply \n \n-- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) and [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository\n+- [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository\n+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository\n - [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n \n``````\n",
    "created_at": "2012-02-29T18:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126092",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 Apply 
 
-- [attachment: 11932_sage_root.patch](https://github.com/sagemath/sage/files/ticket11932/11932_sage_root.patch.gz) and [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository
+- [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository
+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository
 - [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
 
``````




---

archive/issue_comments_126093.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFixed. The patch to spkg/install is no longer valid; instead, we need to patch the sage-starts script.",
    "created_at": "2012-02-29T18:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126093",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Fixed. The patch to spkg/install is no longer valid; instead, we need to patch the sage-starts script.



---

archive/issue_events_161090.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T18:14:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161090"
}
```



---

archive/issue_events_161091.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T18:14:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161091"
}
```



---

archive/issue_events_161092.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T22:14:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161092"
}
```



---

archive/issue_events_161093.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T22:14:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161093"
}
```



---

archive/issue_comments_126094.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThis is not working, and I'm probably making some bash error in the `sage` script. When I run\n\n```\nsage -c 'print \"hello\"'\n```\nit works as it should: no banner, just \"hello\", then a new shell prompt.  When I run\n\n```\nsage --norc -c 'print \"hello\"'\n```\nit starts up Sage, prints a banner, prints \"hello\", and then gives the Sage prompt. As a consequence, the `sage-starts` script is not working right. What am I doing wrong?",
    "created_at": "2012-02-29T22:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126094",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

This is not working, and I'm probably making some bash error in the `sage` script. When I run

```
sage -c 'print "hello"'
```
it works as it should: no banner, just "hello", then a new shell prompt.  When I run

```
sage --norc -c 'print "hello"'
```
it starts up Sage, prints a banner, prints "hello", and then gives the Sage prompt. As a consequence, the `sage-starts` script is not working right. What am I doing wrong?



---

archive/issue_events_161094.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T22:34:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161094"
}
```



---

archive/issue_events_161095.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-02-29T22:34:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161095"
}
```



---

archive/issue_comments_126095.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nNever mind, I've found various work-arounds. The best seems to be to replace `sage \"@$\"` with `source sage \"@$\"`.",
    "created_at": "2012-02-29T22:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126095",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Never mind, I've found various work-arounds. The best seems to be to replace `sage "@$"` with `source sage "@$"`.



---

archive/issue_comments_126096.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNo, that doesn't work: it doesn't clean up the temporary directory afterward. Using `\"$SAGE_ROOT/sage\" \"$@\"` seems to work, but is that a good solution?",
    "created_at": "2012-02-29T23:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126096",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

No, that doesn't work: it doesn't clean up the temporary directory afterward. Using `"$SAGE_ROOT/sage" "$@"` seems to work, but is that a good solution?



---

archive/issue_comments_126097.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jhpalmieri](#comment:13):\n> Using `\"$SAGE_ROOT/sage\" \"$@\"` seems to work, but is that a good solution?\n\nI don't see how calling `sage` could be different from calling `$SAGE_ROOT/sage`, are you sure the former doesn't work (I haven't tried).",
    "created_at": "2012-03-14T20:00:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126097",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jhpalmieri](#comment:13):
> Using `"$SAGE_ROOT/sage" "$@"` seems to work, but is that a good solution?

I don't see how calling `sage` could be different from calling `$SAGE_ROOT/sage`, are you sure the former doesn't work (I haven't tried).



---

archive/issue_comments_126098.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nCalling `sage` at this point in the script will call the script `spkg/bin/sage`, because that directory is now in the path, so it is conceivably different from calling `$SAGE_ROOT/sage`. In practice, it does behave differently, as I mentioned above: using `$SAGE_ROOT/sage` in the script, the command `sage --norc -c 'print \"hello\"'` works as expected, while using just `sage`, the command prints the Sage banner, prints \"hello\", and then you end up at a Sage prompt, running Sage interactively.",
    "created_at": "2012-03-14T20:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126098",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Calling `sage` at this point in the script will call the script `spkg/bin/sage`, because that directory is now in the path, so it is conceivably different from calling `$SAGE_ROOT/sage`. In practice, it does behave differently, as I mentioned above: using `$SAGE_ROOT/sage` in the script, the command `sage --norc -c 'print "hello"'` works as expected, while using just `sage`, the command prints the Sage banner, prints "hello", and then you end up at a Sage prompt, running Sage interactively.



---

archive/issue_comments_126099.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI confirm your observation but I still don't understand what's going on.  I'm investigating...",
    "created_at": "2012-03-14T20:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126099",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I confirm your observation but I still don't understand what's going on.  I'm investigating...



---

archive/issue_events_161096.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-14T20:50:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161096"
}
```



---

archive/issue_events_161097.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-14T20:50:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161097"
}
```



---

archive/issue_comments_126100.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOkay, found it.  \"sage\" refers to the shell function\n\n```\nsage() {\n    sage_setup\n    sage-ipython \"$@\" -i\n}\n```\nWe should probably rename this function to `run_sage` or so...\n\nIn the mean time, replace `$SAGE_ROOT/sage \"$@\"` by\n\n```\ncommand sage \"$@\"\n```\n\nHelp of command:\n\n```\ncommand: command [-pVv] command [arg ...]\n    Execute a simple command or display information about commands.\n\n    Runs COMMAND with ARGS suppressing  shell function lookup, or display\n    information about the specified COMMANDs.  Can be used to invoke commands\n    on disk when a function with the same name exists.\n\n    Options:\n      -p        use a default value for PATH that is guaranteed to find all of\n        the standard utilities\n      -v        print a description of COMMAND similar to the `type' builtin\n      -V        print a more verbose description of each COMMAND\n\n    Exit Status:\n    Returns exit status of COMMAND, or failure if COMMAND is not found.\n```",
    "created_at": "2012-03-14T21:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126100",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Okay, found it.  "sage" refers to the shell function

```
sage() {
    sage_setup
    sage-ipython "$@" -i
}
```
We should probably rename this function to `run_sage` or so...

In the mean time, replace `$SAGE_ROOT/sage "$@"` by

```
command sage "$@"
```

Help of command:

```
command: command [-pVv] command [arg ...]
    Execute a simple command or display information about commands.

    Runs COMMAND with ARGS suppressing  shell function lookup, or display
    information about the specified COMMANDs.  Can be used to invoke commands
    on disk when a function with the same name exists.

    Options:
      -p        use a default value for PATH that is guaranteed to find all of
        the standard utilities
      -v        print a description of COMMAND similar to the `type' builtin
      -V        print a more verbose description of each COMMAND

    Exit Status:
    Returns exit status of COMMAND, or failure if COMMAND is not found.
```



---

archive/issue_events_161098.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T21:13:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161098"
}
```



---

archive/issue_events_161099.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T21:13:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161099"
}
```



---

archive/issue_comments_126101.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAh, good, thank you. I agree, having a function named \"sage\" is probably a bad idea, but changing it should be dealt with elsewhere. (It would require a number of changes in the `sage` script, and a correspondingly large number of tests to make sure everything works.)",
    "created_at": "2012-03-14T21:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126101",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Ah, good, thank you. I agree, having a function named "sage" is probably a bad idea, but changing it should be dealt with elsewhere. (It would require a number of changes in the `sage` script, and a correspondingly large number of tests to make sure everything works.)



---

archive/issue_comments_126102.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOn an entirely different topic: I don't like the `--norc` option name.  In the light of #12647, I would expect that option to suppress the reading of the `sagerc` script (and/or the `init.sage` script).  I would only support `--nodotsage`.",
    "created_at": "2012-03-14T21:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126102",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

On an entirely different topic: I don't like the `--norc` option name.  In the light of #12647, I would expect that option to suppress the reading of the `sagerc` script (and/or the `init.sage` script).  I would only support `--nodotsage`.



---

archive/issue_comments_126103.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHere are new patches which just use `--nodotsage`.  (I also considered `--tmpdotsage`, but it doesn't matter too much, as long as it's documented.)",
    "created_at": "2012-03-19T17:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126103",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Here are new patches which just use `--nodotsage`.  (I also considered `--tmpdotsage`, but it doesn't matter too much, as long as it's documented.)



---

archive/issue_comments_126104.json:
```json
{
    "body": "Attachment: **[trac_11932-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz)**\n\nscripts repo",
    "created_at": "2012-03-19T17:47:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126104",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_11932-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz)**

scripts repo



---

archive/issue_comments_126105.json:
```json
{
    "body": "documentation patch (Sage library)",
    "created_at": "2012-03-19T17:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126105",
    "user": "https://github.com/jhpalmieri"
}
```

documentation patch (Sage library)



---

archive/issue_comments_126106.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[trac_11932-doc.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz)**\n\nIt would be nice to also have `--nosagerc`, and let `--nodotsage` by default *not* bypass `[$DOT_SAGE/]sagerc` (if it exists; of course no directory should be created if it doesn't).",
    "created_at": "2012-03-19T18:11:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126106",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[trac_11932-doc.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz)**

It would be nice to also have `--nosagerc`, and let `--nodotsage` by default *not* bypass `[$DOT_SAGE/]sagerc` (if it exists; of course no directory should be created if it doesn't).



---

archive/issue_comments_126107.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nPerhaps on another ticket...",
    "created_at": "2012-03-19T18:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126107",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

Perhaps on another ticket...



---

archive/issue_comments_126108.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nUnfortunately, this doesn't quite work properly since `DOT_SAGE` is changed *after* reading `sage-env`.  The following variables still refer to `$HOME/.sage`:\n\n```\njdemeyer@arcanis:/usr/local/src/sage-5.0.beta13$ ./sage --nodotsage --sh -c env | fgrep \"$HOME/.sage\"\nMPLCONFIGDIR=/home/jdemeyer/.sage//matplotlib-1.1.0\nSAGE_STARTUP_FILE=/home/jdemeyer/.sage//init.sage\nSAGE_TESTDIR=/home/jdemeyer/.sage//tmp\n```\n\nI suggest moving the `--nodotsage` check before the sourcing of `sage-env`.",
    "created_at": "2012-04-09T19:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126108",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Unfortunately, this doesn't quite work properly since `DOT_SAGE` is changed *after* reading `sage-env`.  The following variables still refer to `$HOME/.sage`:

```
jdemeyer@arcanis:/usr/local/src/sage-5.0.beta13$ ./sage --nodotsage --sh -c env | fgrep "$HOME/.sage"
MPLCONFIGDIR=/home/jdemeyer/.sage//matplotlib-1.1.0
SAGE_STARTUP_FILE=/home/jdemeyer/.sage//init.sage
SAGE_TESTDIR=/home/jdemeyer/.sage//tmp
```

I suggest moving the `--nodotsage` check before the sourcing of `sage-env`.



---

archive/issue_events_161100.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T19:39:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161100"
}
```



---

archive/issue_events_161101.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T19:39:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161101"
}
```



---

archive/issue_comments_126109.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOkay, here's a new root patch.",
    "created_at": "2012-04-13T20:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126109",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

Okay, here's a new root patch.



---

archive/issue_events_161102.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-13T20:21:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161102"
}
```



---

archive/issue_events_161103.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-13T20:21:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161103"
}
```



---

archive/issue_comments_126110.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nJust one more issue: now that you don't source `sage-env`, the `command sage` looks for `sage` in the **system** `PATH`.  I suggest to replace\n\n```\ncommand sage \"$@\"\n```\nby\n\n```\ncommand \"$0\" \"$@\"\n```\nIf you make this change, you can give this ticket positive review.\n\nFurthermore, I would like to point out that `$HOME/.sage/matplotlib-1.1.0` is still created by `sage-env` when building Sage.  But that shouldn't stop this ticket.",
    "created_at": "2012-04-26T08:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126110",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Just one more issue: now that you don't source `sage-env`, the `command sage` looks for `sage` in the **system** `PATH`.  I suggest to replace

```
command sage "$@"
```
by

```
command "$0" "$@"
```
If you make this change, you can give this ticket positive review.

Furthermore, I would like to point out that `$HOME/.sage/matplotlib-1.1.0` is still created by `sage-env` when building Sage.  But that shouldn't stop this ticket.



---

archive/issue_comments_126111.json:
```json
{
    "body": "root repo",
    "created_at": "2012-04-30T17:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126111",
    "user": "https://github.com/jhpalmieri"
}
```

root repo



---

archive/issue_comments_126112.json:
```json
{
    "body": "Attachment: **[trac_11932-root.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz)**",
    "created_at": "2012-04-30T17:08:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126112",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_11932-root.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz)**



---

archive/issue_comments_126113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,16 @@\n-Apply \n+Version which ignores matplotlib issue: apply \n \n - [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository\n - [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository\n - [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n \n+---\n+\n+Version which deals with matplotlib issue: apply \n+\n+- [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository\n+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository\n+- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n+- [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) to the Sage repository\n+\n+\n``````\n",
    "created_at": "2012-04-30T17:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126113",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,16 @@
-Apply 
+Version which ignores matplotlib issue: apply 
 
 - [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository
 - [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository
 - [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
 
+---
+
+Version which deals with matplotlib issue: apply 
+
+- [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository
+- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository
+- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
+- [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) to the Sage repository
+
+
``````




---

archive/issue_comments_126114.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAttachment: **[trac_11932-root.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz)**\n\nHere are two versions. If we want the easy root, the first version just makes the change\n\n```diff\ndiff --git a/spkg/bin/sage b/spkg/bin/sage\n--- a/spkg/bin/sage\n+++ b/spkg/bin/sage\n@@ -238,7 +238,7 @@ cd \"$SAGE_ROOT\"\n if [ \"$1\" = '--nodotsage' ]; then\n     export DOT_SAGE=`mktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX`\n     shift\n-    command sage \"$@\"\n+    command \"$0\" \"$@\"\n     status=$?\n     rm -rf \"$DOT_SAGE\"\n     exit $status\n```\nThe second version deals (I think) with the matplotlib issue, creating the config directory in sage.misc.misc, where other subdirectories of `DOT_SAGE` are created. It's not a very significant difference: the file [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) and these changes to the root patch:\n\n```diff\ndiff --git a/spkg/bin/sage-env b/spkg/bin/sage-env\n--- a/spkg/bin/sage-env\n+++ b/spkg/bin/sage-env\n@@ -281,8 +281,9 @@ fi\n \n if [ \"$DOT_SAGE\" = \"\" ]; then\n     # It is *not* an error if this directory does not exist, it will\n-    # be created in spkg/bin/sage.  This also works if $HOME/.sage is a\n-    # symbolic link to a non-existing directory.\n+    # be created in spkg/bin/sage or devel/sage/sage/misc/misc.py.\n+    # This also works if $HOME/.sage is a symbolic link to a\n+    # non-existing directory.\n     DOT_SAGE=`resolvelinks \"$HOME/.sage\"`\n \n     # In theory, DOT_SAGE is not required to have a trailing slash.\n@@ -340,8 +341,7 @@ if [ -f \"$MPLINITFILE\" ]; then\n         MPLCONFIGDIR=\"$DOT_SAGE/matplotlib\"\n     fi\n     export MPLCONFIGDIR\n-    # Create the directory, because matplotlib doesn't seem to be happy otherwi\n-    mkdir -p \"$MPLCONFIGDIR\"\n+    # The directory is created when Sage starts (see sage.misc.misc).\n fi\n \n # Add some directories to $LD_LIBRARY_PATH:\n```\nIf you have time to look at the second version, please consider it. If you would rather deal with just the first version here, we can move the other version to a new ticket.",
    "created_at": "2012-04-30T17:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126114",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

Attachment: **[trac_11932-root.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz)**

Here are two versions. If we want the easy root, the first version just makes the change

```diff
diff --git a/spkg/bin/sage b/spkg/bin/sage
--- a/spkg/bin/sage
+++ b/spkg/bin/sage
@@ -238,7 +238,7 @@ cd "$SAGE_ROOT"
 if [ "$1" = '--nodotsage' ]; then
     export DOT_SAGE=`mktemp -d ${TMPDIR:-/tmp}/dotsageXXXXXX`
     shift
-    command sage "$@"
+    command "$0" "$@"
     status=$?
     rm -rf "$DOT_SAGE"
     exit $status
```
The second version deals (I think) with the matplotlib issue, creating the config directory in sage.misc.misc, where other subdirectories of `DOT_SAGE` are created. It's not a very significant difference: the file [attachment: trac_11932-sage.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz) and these changes to the root patch:

```diff
diff --git a/spkg/bin/sage-env b/spkg/bin/sage-env
--- a/spkg/bin/sage-env
+++ b/spkg/bin/sage-env
@@ -281,8 +281,9 @@ fi
 
 if [ "$DOT_SAGE" = "" ]; then
     # It is *not* an error if this directory does not exist, it will
-    # be created in spkg/bin/sage.  This also works if $HOME/.sage is a
-    # symbolic link to a non-existing directory.
+    # be created in spkg/bin/sage or devel/sage/sage/misc/misc.py.
+    # This also works if $HOME/.sage is a symbolic link to a
+    # non-existing directory.
     DOT_SAGE=`resolvelinks "$HOME/.sage"`
 
     # In theory, DOT_SAGE is not required to have a trailing slash.
@@ -340,8 +341,7 @@ if [ -f "$MPLINITFILE" ]; then
         MPLCONFIGDIR="$DOT_SAGE/matplotlib"
     fi
     export MPLCONFIGDIR
-    # Create the directory, because matplotlib doesn't seem to be happy otherwi
-    mkdir -p "$MPLCONFIGDIR"
+    # The directory is created when Sage starts (see sage.misc.misc).
 fi
 
 # Add some directories to $LD_LIBRARY_PATH:
```
If you have time to look at the second version, please consider it. If you would rather deal with just the first version here, we can move the other version to a new ticket.



---

archive/issue_comments_126115.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nFor the Sage patch, what about:\n\n```\ntry:\n    # Create the matplotlib config directory\n    sage_makedirs(os.environ[\"MPLCONFIGDIR\"])\nexcept KeyError:\n    pass\n```\nI don't see a reason to create a directory when the environment variable doesn't exist.",
    "created_at": "2012-05-07T13:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126115",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

For the Sage patch, what about:

```
try:
    # Create the matplotlib config directory
    sage_makedirs(os.environ["MPLCONFIGDIR"])
except KeyError:
    pass
```
I don't see a reason to create a directory when the environment variable doesn't exist.



---

archive/issue_events_161104.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-07T13:57:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161104"
}
```



---

archive/issue_events_161105.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-07T13:57:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161105"
}
```



---

archive/issue_comments_126116.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSince we set `MPLCONFIGDIR` in sage-env, there is no reason for it not to be set (unless someone does something risky and unsupported like try to import the Sage library using the system's Python). But I made the change anyway.",
    "created_at": "2012-05-07T17:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126116",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

Since we set `MPLCONFIGDIR` in sage-env, there is no reason for it not to be set (unless someone does something risky and unsupported like try to import the Sage library using the system's Python). But I made the change anyway.



---

archive/issue_comments_126117.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nAttachment: **[trac_11932-sage.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz)**\n\nLooks good and works well.\n\nI'm currently running\n\n```\nsage --nodotsage -tp 2 devel/sage/sage\n```",
    "created_at": "2012-05-08T10:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126117",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Attachment: **[trac_11932-sage.v2.patch.gz](https://github.com/sagemath/sage/files/ticket11932/trac_11932-sage.v2.patch.gz)**

Looks good and works well.

I'm currently running

```
sage --nodotsage -tp 2 devel/sage/sage
```



---

archive/issue_comments_126118.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,3 @@\n-Version which ignores matplotlib issue: apply \n-\n-- [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository\n-- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository\n-- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository\n-\n----\n-\n Version which deals with matplotlib issue: apply \n \n - [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository\n``````\n",
    "created_at": "2012-05-08T10:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126118",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,3 @@
-Version which ignores matplotlib issue: apply 
-
-- [attachment: trac_11932-root.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.patch.gz) to the Sage root repository
-- [attachment: trac_11932-scripts.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-scripts.patch.gz) to the local/bin repository
-- [attachment: trac_11932-doc.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-doc.patch.gz) to the Sage repository
-
----
-
 Version which deals with matplotlib issue: apply 
 
 - [attachment: trac_11932-root.v2.patch](https://github.com/sagemath/sage/files/ticket11932/trac_11932-root.v2.patch.gz) to the Sage root repository
``````




---

archive/issue_events_161106.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T11:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161106"
}
```



---

archive/issue_events_161107.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T11:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161107"
}
```



---

archive/issue_comments_126119.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n\n```\nAll tests passed!\n```",
    "created_at": "2012-05-08T11:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126119",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>


```
All tests passed!
```



---

archive/issue_comments_126120.json:
```json
{
    "body": "Merged: **sage-5.1.beta0**",
    "created_at": "2012-05-13T21:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11932#issuecomment-126120",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.1.beta0**



---

archive/issue_events_161108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-13T21:32:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161108"
}
```



---

archive/issue_events_161109.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-13T21:32:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11932",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11932#event-161109"
}
```
