# Issue 11053: improving shortest path all pairs through BFS computations

archive/issues_010945.json:
```json
{
    "body": "After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n\n**Assignee:** @jasongrout, @nathanncohen, @rlmill\n\n**CC:**  ylchapuy\n\n**Dependencies:** #10905\n\n**Author:** Nathann Cohen\n\n**Reviewer:** Leonardo Sampaio\n\n**Merged:** sage-4.7.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11053\n\n",
    "closed_at": "2011-08-18T22:03:18Z",
    "created_at": "2011-03-26T21:07:04Z",
    "labels": [
        "component: graph theory",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "improving shortest path all pairs through BFS computations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11053",
    "user": "https://github.com/nathanncohen"
}
```
After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.

**Assignee:** @jasongrout, @nathanncohen, @rlmill

**CC:**  ylchapuy

**Dependencies:** #10905

**Author:** Nathann Cohen

**Reviewer:** Leonardo Sampaio

**Merged:** sage-4.7.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11053





---

archive/issue_comments_112630.json:
```json
{
    "body": "<a id='comment:1'></a>\nBefore \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s\nWall time: 15.03 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 752 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 73.5 \u00b5s per loop\n```\n\nAfter \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s\nWall time: 11.24 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 549 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 53.4 \u00b5s per loop\n```",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112630",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>
Before 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s
Wall time: 15.03 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 752 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 73.5 µs per loop
```

After 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s
Wall time: 11.24 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 549 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 53.4 µs per loop
```



---

archive/issue_events_088330.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-03-26T21:15:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88330"
}
```



---

archive/issue_comments_112631.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n \n+Requires : #10905\n``````\n",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112631",
    "user": "https://github.com/nathanncohen"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.
 
+Requires : #10905
``````




---

archive/issue_events_088331.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-03-30T14:02:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88331"
}
```



---

archive/issue_events_088332.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-03-30T14:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88332"
}
```



---

archive/attachments_014500.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11053.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11053/trac_11053.patch",
    "created_at": "2011-06-05T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nathanncohen"
}
```



---

archive/issue_comments_112632.json:
```json
{
    "body": "",
    "created_at": "2011-06-05T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112632",
    "user": "https://github.com/nathanncohen"
}
```





---

archive/issue_events_088333.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-06-05T16:10:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88333"
}
```



---

archive/issue_events_088334.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-06-05T16:10:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88334"
}
```



---

archive/issue_comments_112633.json:
```json
{
    "body": "<a id='comment:3'></a>\nI had set this patch to \"needs review\", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. \n\nIn the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.\n\nHail Cython `;-)`\n\nNathann",
    "created_at": "2011-06-05T16:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112633",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
I had set this patch to "needs review", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. 

In the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.

Hail Cython `;-)`

Nathann



---

archive/issue_events_088335.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/lsampaio",
    "created_at": "2011-08-04T08:58:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88335"
}
```



---

archive/issue_events_088336.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/lsampaio",
    "created_at": "2011-08-04T08:58:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88336"
}
```



---

archive/issue_comments_112634.json:
```json
{
    "body": "<a id='comment:4'></a>\nI reviwed the patch and it seens to be working well!",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112634",
    "user": "https://trac.sagemath.org/admin/accounts/users/lsampaio"
}
```

<a id='comment:4'></a>
I reviwed the patch and it seens to be working well!



---

archive/issue_comments_112635.json:
```json
{
    "body": "**Reviewer:** Leonardo Sampaio",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112635",
    "user": "https://trac.sagemath.org/admin/accounts/users/lsampaio"
}
```

**Reviewer:** Leonardo Sampaio



---

archive/issue_events_088337.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-05T09:03:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88337"
}
```



---

archive/issue_events_088338.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-05T09:03:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88338"
}
```



---

archive/issue_comments_112636.json:
```json
{
    "body": "**Dependencies:** #10905",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112636",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #10905



---

archive/issue_comments_112637.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha2",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112637",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha2



---

archive/issue_events_088339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:03:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88339"
}
```



---

archive/issue_events_088340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:03:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-88340"
}
```



---

archive/issue_comments_112638.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n-\n-Requires : #10905\n``````\n",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-112638",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1 @@
 After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.
-
-Requires : #10905
``````

