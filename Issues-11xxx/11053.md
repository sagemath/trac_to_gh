# Issue 11053: improving shortest path all pairs through BFS computations

archive/issues_010945.json:
```json
{
    "body": "After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n\n**Assignee:** @jasongrout, @nathanncohen, @rlmill\n\n**CC:**  ylchapuy\n\n**Resolution:** fixed\n\n**Dependencies:** #10905\n\n**Author:** Nathann Cohen\n\n**Reviewer:** Leonardo Sampaio\n\n**Merged:** sage-4.7.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11053\n\n",
    "closed_at": "2011-08-18T22:03:18Z",
    "created_at": "2011-03-26T21:07:04Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "improving shortest path all pairs through BFS computations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11053",
    "user": "https://github.com/nathanncohen"
}
```
After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.

**Assignee:** @jasongrout, @nathanncohen, @rlmill

**CC:**  ylchapuy

**Resolution:** fixed

**Dependencies:** #10905

**Author:** Nathann Cohen

**Reviewer:** Leonardo Sampaio

**Merged:** sage-4.7.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11053





---

archive/issue_comments_148760.json:
```json
{
    "body": "<a id='comment:1'></a>\nBefore \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s\nWall time: 15.03 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 752 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 73.5 \u00b5s per loop\n```\n\nAfter \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s\nWall time: 11.24 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 549 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 53.4 \u00b5s per loop\n```",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148760",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>
Before 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s
Wall time: 15.03 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 752 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 73.5 µs per loop
```

After 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s
Wall time: 11.24 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 549 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 53.4 µs per loop
```



---

archive/issue_comments_148761.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148761",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_148762.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n \n+Requires : #10905\n``````\n",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148762",
    "user": "https://github.com/nathanncohen"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.
 
+Requires : #10905
``````




---

archive/issue_comments_148763.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-03-30T14:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148763",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_014500.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11053.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11053/trac_11053.patch",
    "created_at": "2011-06-05T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nathanncohen"
}
```



---

archive/issue_comments_148764.json:
```json
{
    "body": "",
    "created_at": "2011-06-05T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148764",
    "user": "https://github.com/nathanncohen"
}
```





---

archive/issue_comments_148765.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-06-05T16:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148765",
    "user": "https://github.com/nathanncohen"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_148766.json:
```json
{
    "body": "<a id='comment:3'></a>\nI had set this patch to \"needs review\", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. \n\nIn the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.\n\nHail Cython `;-)`\n\nNathann",
    "created_at": "2011-06-05T16:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148766",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
I had set this patch to "needs review", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. 

In the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.

Hail Cython `;-)`

Nathann



---

archive/issue_comments_148767.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148767",
    "user": "https://trac.sagemath.org/admin/accounts/users/lsampaio"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_148768.json:
```json
{
    "body": "<a id='comment:4'></a>\nI reviwed the patch and it seens to be working well!",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148768",
    "user": "https://trac.sagemath.org/admin/accounts/users/lsampaio"
}
```

<a id='comment:4'></a>
I reviwed the patch and it seens to be working well!



---

archive/issue_comments_148769.json:
```json
{
    "body": "**Reviewer:** Leonardo Sampaio",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148769",
    "user": "https://trac.sagemath.org/admin/accounts/users/lsampaio"
}
```

**Reviewer:** Leonardo Sampaio



---

archive/issue_events_034171.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-05T09:03:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-34171"
}
```



---

archive/issue_comments_148770.json:
```json
{
    "body": "**Dependencies:** #10905",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148770",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #10905



---

archive/issue_comments_148771.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148771",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_148772.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha2",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148772",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha2



---

archive/issue_events_034172.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:03:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11053#event-34172"
}
```



---

archive/issue_comments_148773.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n-\n-Requires : #10905\n``````\n",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-148773",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1 @@
 After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.
-
-Requires : #10905
``````

