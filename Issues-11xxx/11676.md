# Issue 11676: sage-pkg does not force world-readable permissions

archive/issues_011504.json:
```json
{
    "body": "As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n\nThe following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).\n\n**Apply** [attachment:sage-pkg-tarmode.2.patch]\n\n**Assignee:** @alexanderdreyer\n\n**CC:**  @jdemeyer @nexttime\n\n**Keywords:** chmod umask install mode\n\n**Reviewer:** Alexander Dreyer, Jeroen Demeyer\n\n**Resolution:** wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/11676\n\n",
    "closed_at": "2014-02-04T21:11:38Z",
    "created_at": "2011-08-10T07:44:20Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage-pkg does not force world-readable permissions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11676",
    "user": "https://github.com/alexanderdreyer"
}
```
As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.

The following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).

**Apply** [attachment:sage-pkg-tarmode.2.patch]

**Assignee:** @alexanderdreyer

**CC:**  @jdemeyer @nexttime

**Keywords:** chmod umask install mode

**Reviewer:** Alexander Dreyer, Jeroen Demeyer

**Resolution:** wontfix

Issue created by migration from https://trac.sagemath.org/ticket/11676





---

archive/issue_comments_163069.json:
```json
{
    "body": "<a id='comment:2'></a>\nWhat is the desired resolution? `sage-pkg` should not modify the `src/` directory when making an SPKG.",
    "created_at": "2011-08-10T08:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163069",
    "user": "https://github.com/kini"
}
```

<a id='comment:2'></a>
What is the desired resolution? `sage-pkg` should not modify the `src/` directory when making an SPKG.



---

archive/issue_comments_163070.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'd also say they should, but they don't have to. ;-)\n\nIt would be better to just change them in `sage-spkg` (including `umask`) if at all.\n\nThe proper way would IMHO be to fix the permissions of the **installed** files.\n\n`sage-pkg` could issue a warning though.",
    "created_at": "2011-08-10T08:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163070",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
I'd also say they should, but they don't have to. ;-)

It would be better to just change them in `sage-spkg` (including `umask`) if at all.

The proper way would IMHO be to fix the permissions of the **installed** files.

`sage-pkg` could issue a warning though.



---

archive/issue_comments_163071.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs mentioned elsewhere, if all files would get installed with `install` (and `-m`) this would be a non-issue.\n\nWe may patch `distutils` for Python packages accordingly.",
    "created_at": "2011-08-10T08:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163071",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
As mentioned elsewhere, if all files would get installed with `install` (and `-m`) this would be a non-issue.

We may patch `distutils` for Python packages accordingly.



---

archive/issue_comments_163072.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"chmod umask install mode\".",
    "created_at": "2011-08-10T08:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163072",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "chmod umask install mode".



---

archive/issue_comments_163073.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [leif](#comment%3A4):\n> As mentioned elsewhere, if all files would get installed with `install` (and `-m`) this would be a non-issue.\n\nThis is not going to happen, unless you want to patch all upstream packages.\n\nI am personally in favour of a warning, instead of forcably changing permissions.",
    "created_at": "2011-08-10T08:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163073",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [leif](#comment%3A4):
> As mentioned elsewhere, if all files would get installed with `install` (and `-m`) this would be a non-issue.

This is not going to happen, unless you want to patch all upstream packages.

I am personally in favour of a warning, instead of forcably changing permissions.



---

archive/issue_comments_163074.json:
```json
{
    "body": "Monkey patching permssions etc. for sage -pkg",
    "created_at": "2011-08-10T08:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163074",
    "user": "https://github.com/alexanderdreyer"
}
```

Monkey patching permssions etc. for sage -pkg



---

archive/issue_comments_163075.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [sage-pkg-tarmode.0.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.0.patch) by @alexanderdreyer created at 2011-08-10 08:53:51\n\nSee my monkey patch for fixing this.\n\nSee also the discussion here:\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/4b50ca1df10f0ac3/242d36cdbbb194e8#242d36cdbbb194e8",
    "created_at": "2011-08-10T08:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163075",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:6'></a>
Attachment [sage-pkg-tarmode.0.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.0.patch) by @alexanderdreyer created at 2011-08-10 08:53:51

See my monkey patch for fixing this.

See also the discussion here:
http://groups.google.com/group/sage-devel/browse_thread/thread/4b50ca1df10f0ac3/242d36cdbbb194e8#242d36cdbbb194e8



---

archive/issue_comments_163076.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-08-10T08:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163076",
    "user": "https://github.com/alexanderdreyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_163077.json:
```json
{
    "body": "**Changing assignee** from @jasongrout to @alexanderdreyer.",
    "created_at": "2011-08-10T08:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163077",
    "user": "https://github.com/alexanderdreyer"
}
```

**Changing assignee** from @jasongrout to @alexanderdreyer.



---

archive/issue_comments_163078.json:
```json
{
    "body": "**Author:** Alexander Dreyer",
    "created_at": "2011-08-10T08:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163078",
    "user": "https://github.com/alexanderdreyer"
}
```

**Author:** Alexander Dreyer



---

archive/issue_comments_163079.json:
```json
{
    "body": "<a id='comment:8'></a>\nWell, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)",
    "created_at": "2011-08-10T09:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163079",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Well, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)



---

archive/issue_comments_163080.json:
```json
{
    "body": "beter Monkey patch (checks directory permissions)",
    "created_at": "2011-08-10T22:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163080",
    "user": "https://github.com/alexanderdreyer"
}
```

beter Monkey patch (checks directory permissions)



---

archive/issue_comments_163081.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n+\n+## Current patch fpr Sage's local/bin repository\n+http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch\n``````\n",
    "created_at": "2011-08-10T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163081",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.
+
+## Current patch fpr Sage's local/bin repository
+http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch
``````




---

archive/issue_comments_163082.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [sage-pkg-tarmode.1.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.1.patch) by @alexanderdreyer created at 2011-08-10 22:31:37",
    "created_at": "2011-08-10T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163082",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:9'></a>
Attachment [sage-pkg-tarmode.1.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.1.patch) by @alexanderdreyer created at 2011-08-10 22:31:37



---

archive/issue_comments_163083.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n \n-## Current patch fpr Sage's local/bin repository\n+## Current patch for Sage's local/bin repository\n http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch\n``````\n",
    "created_at": "2011-08-11T06:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163083",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.
 
-## Current patch fpr Sage's local/bin repository
+## Current patch for Sage's local/bin repository
 http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch
``````




---

archive/issue_comments_163084.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm still not convinced that this is the correct way to handle this.  I dislike the idea of **forcing** certain permissions, I prefer a warning (and it seems leif also).",
    "created_at": "2011-08-11T08:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163084",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I'm still not convinced that this is the correct way to handle this.  I dislike the idea of **forcing** certain permissions, I prefer a warning (and it seems leif also).



---

archive/issue_comments_163085.json:
```json
{
    "body": "**Changing upstream** from \"None of the above - read trac for reasoning.\" to \"N/A\".",
    "created_at": "2011-08-11T08:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163085",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "None of the above - read trac for reasoning." to "N/A".



---

archive/issue_comments_163086.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n \n ## Current patch for Sage's local/bin repository\n-http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch\n+[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch]\n``````\n",
    "created_at": "2011-08-11T08:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163086",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.
 
 ## Current patch for Sage's local/bin repository
-http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch
+[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch]
``````




---

archive/issue_comments_163087.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A8):\n> Well, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)\n\n\nI don't see the point why this information is useful, one would better look at the `hg log` or `SPKG.txt` for this.  With my current merge-script this information is lost anyway because every spkg is unpacked and repacked (in between changes are committed, a `hg tag` is added and the spkg is checked for some obvious mistakes).",
    "created_at": "2011-08-11T08:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163087",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A8):
> Well, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)


I don't see the point why this information is useful, one would better look at the `hg log` or `SPKG.txt` for this.  With my current merge-script this information is lost anyway because every spkg is unpacked and repacked (in between changes are committed, a `hg tag` is added and the spkg is checked for some obvious mistakes).



---

archive/issue_comments_163088.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> Replying to [leif](#comment%3A8):\n> > Well, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)\n\n> \n> I don't see the point why this information is useful, one would better look at the `hg log` or `SPKG.txt` for this.  With my current merge-script this information is lost anyway because every spkg is unpacked and repacked (in between changes are committed, a `hg tag` is added and the spkg is checked for some obvious mistakes).\n\n\nYep, in the Sage distros.\n\nI won't object making both modifications optional, i.e. adding separate options to `sage-pkg` for changing the owner/group, and the file modes (\"permissions\").\n\nThe first could default to \"yes\" (or `True`), the second IMHO shouldn't.",
    "created_at": "2011-08-11T13:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163088",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> Replying to [leif](#comment%3A8):
> > Well, it's sometimes better to know who packaged an spkg (though one can easily fake this of course). ;-)

> 
> I don't see the point why this information is useful, one would better look at the `hg log` or `SPKG.txt` for this.  With my current merge-script this information is lost anyway because every spkg is unpacked and repacked (in between changes are committed, a `hg tag` is added and the spkg is checked for some obvious mistakes).


Yep, in the Sage distros.

I won't object making both modifications optional, i.e. adding separate options to `sage-pkg` for changing the owner/group, and the file modes ("permissions").

The first could default to "yes" (or `True`), the second IMHO shouldn't.



---

archive/issue_comments_163089.json:
```json
{
    "body": "<a id='comment:14'></a>\nA warning should IMHO independently be given in case there are files with \"suspicious\" permissions, perhaps with an option to disable this, as there are usually a lot of files that don't get installed (or at least not by `cp`) where the permissions hardly matter.",
    "created_at": "2011-08-11T13:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163089",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
A warning should IMHO independently be given in case there are files with "suspicious" permissions, perhaps with an option to disable this, as there are usually a lot of files that don't get installed (or at least not by `cp`) where the permissions hardly matter.



---

archive/issue_comments_163090.json:
```json
{
    "body": "<a id='comment:15'></a>\nJust another 2pence from me: in my current environment permissions and owners/groups are sometimes enforced by the file system. So the only way to reliably change is within the tarball. So: should I prepare a patch which makes enforcing optional?",
    "created_at": "2011-08-17T11:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163090",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:15'></a>
Just another 2pence from me: in my current environment permissions and owners/groups are sometimes enforced by the file system. So the only way to reliably change is within the tarball. So: should I prepare a patch which makes enforcing optional?



---

archive/issue_comments_163091.json:
```json
{
    "body": "Attachment [sage-pkg-tarmode.2.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.2.patch) by @alexanderdreyer created at 2011-08-17 14:14:55\n\nMaking enforcement optional, also fixing Darwin",
    "created_at": "2011-08-17T14:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163091",
    "user": "https://github.com/alexanderdreyer"
}
```

Attachment [sage-pkg-tarmode.2.patch](tarball://root/attachments/some-uuid/ticket11676/sage-pkg-tarmode.2.patch) by @alexanderdreyer created at 2011-08-17 14:14:55

Making enforcement optional, also fixing Darwin



---

archive/issue_comments_163092.json:
```json
{
    "body": "**Remove assignee** @alexanderdreyer.",
    "created_at": "2011-08-17T14:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163092",
    "user": "https://github.com/alexanderdreyer"
}
```

**Remove assignee** @alexanderdreyer.



---

archive/issue_comments_163093.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n \n ## Current patch for Sage's local/bin repository\n-[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch]\n+[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]\n``````\n",
    "created_at": "2011-08-17T14:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163093",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.
 
 ## Current patch for Sage's local/bin repository
-[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.1.patch]
+[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]
``````




---

archive/issue_comments_163094.json:
```json
{
    "body": "<a id='comment:16'></a>\nSo here's an patch  which makes things optional, for instance use `sage -pkg -wa dir` for all extensions. See `sage -pkg -h` for details.",
    "created_at": "2011-08-17T14:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163094",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:16'></a>
So here's an patch  which makes things optional, for instance use `sage -pkg -wa dir` for all extensions. See `sage -pkg -h` for details.



---

archive/issue_comments_163095.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.\n+\n+The following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).\n \n ## Current patch for Sage's local/bin repository\n [attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]\n``````\n",
    "created_at": "2011-08-17T14:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163095",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 As pointed out here: #11660 and here: #11664 archives have to be world-readable. sage-pkg does not enforce this.
+
+The following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).
 
 ## Current patch for Sage's local/bin repository
 [attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]
``````




---

archive/issue_comments_163096.json:
```json
{
    "body": "**Assignee:** @alexanderdreyer",
    "created_at": "2011-08-17T20:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163096",
    "user": "https://github.com/alexanderdreyer"
}
```

**Assignee:** @alexanderdreyer



---

archive/issue_comments_163097.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,4 @@\n \n The following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).\n \n-## Current patch for Sage's local/bin repository\n-[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]\n+**Apply** [attachment:sage-pkg-tarmode.2.patch]\n``````\n",
    "created_at": "2011-10-15T13:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163097",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,4 @@
 
 The following patch adds options to `sage -pkg` which allow to force anonymous or world-readable file settings (or both).
 
-## Current patch for Sage's local/bin repository
-[attachment:http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11676/sage-pkg-tarmode.2.patch]
+**Apply** [attachment:sage-pkg-tarmode.2.patch]
``````




---

archive/issue_comments_163098.json:
```json
{
    "body": "<a id='comment:20'></a>\nMy personal opinion on this is still that we don't need any of these options, I don't think `sage -spkg` should mess with permissions or user names.",
    "created_at": "2011-10-15T13:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163098",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
My personal opinion on this is still that we don't need any of these options, I don't think `sage -spkg` should mess with permissions or user names.



---

archive/issue_comments_163099.json:
```json
{
    "body": "<a id='comment:21'></a>\nI agree. Certainly `sage-spkg` should not touch the `src/` directory under any circumstances, IMO, as the SPKG format should be flexible enough to be distributed sans the `src/` directory with the expectation that a particular upstream source archive can be extracted into `src/` before running `spkg-install` (if we at some point decide to build a more complex package manager, etc.).\n\nI don't think that changes to the other files in the SPKG should be made by `sage-spkg` immediately before archiving, either, because this results in uncommitted changes in the Mercurial repository shipped inside the SPKG, which is not good. Though I guess you may disagree with me on this point, Jeroen, as (IIRC) you use scripts which make automated commits in SPKGs before publishing them, right?",
    "created_at": "2011-10-15T14:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163099",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'></a>
I agree. Certainly `sage-spkg` should not touch the `src/` directory under any circumstances, IMO, as the SPKG format should be flexible enough to be distributed sans the `src/` directory with the expectation that a particular upstream source archive can be extracted into `src/` before running `spkg-install` (if we at some point decide to build a more complex package manager, etc.).

I don't think that changes to the other files in the SPKG should be made by `sage-spkg` immediately before archiving, either, because this results in uncommitted changes in the Mercurial repository shipped inside the SPKG, which is not good. Though I guess you may disagree with me on this point, Jeroen, as (IIRC) you use scripts which make automated commits in SPKGs before publishing them, right?



---

archive/issue_comments_163100.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [jdemeyer](#comment%3A20):\n> My personal opinion on this is still that we don't need any of these options, I don't think `sage -spkg` should mess with permissions or user names.\n\nFirst of all, this is a patch to `sage-pkg`, not `sage-spkg`. So I'm talking about generating an spkg, not installing it. But remember, the original reason for this patch was, that you indeed proposed in #11664 to change the src (namely to give world-readable permissions).\n\nSince I'm forced to work on a non-standard network file system, where I cannot enforce the requested permissions, I have to change the permissions while bundling the spkg, i.e. when generating the tar-file. (Despite from my broken file system, the same is true, when working on a fat-based drive, may USB sticks, etc.)\n\nSo, in order to provide valid PolyBoRi spkgs in the future I have to apply this patch.",
    "created_at": "2011-10-15T18:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163100",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:22'></a>
Replying to [jdemeyer](#comment%3A20):
> My personal opinion on this is still that we don't need any of these options, I don't think `sage -spkg` should mess with permissions or user names.

First of all, this is a patch to `sage-pkg`, not `sage-spkg`. So I'm talking about generating an spkg, not installing it. But remember, the original reason for this patch was, that you indeed proposed in #11664 to change the src (namely to give world-readable permissions).

Since I'm forced to work on a non-standard network file system, where I cannot enforce the requested permissions, I have to change the permissions while bundling the spkg, i.e. when generating the tar-file. (Despite from my broken file system, the same is true, when working on a fat-based drive, may USB sticks, etc.)

So, in order to provide valid PolyBoRi spkgs in the future I have to apply this patch.



---

archive/issue_comments_163101.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [AlexanderDreyer](#comment%3A22):\n> Since I'm forced to work on a non-standard network file system, where I cannot enforce the requested permissions, I have to change the permissions while bundling the spkg, i.e. when generating the tar-file. (Despite from my broken file system, the same is true, when working on a fat-based drive, may USB sticks, etc.)\n\n\nPartially off-topic but highly important question: what does your \"broken\" filesystem do to executable permissions?  If it doesn't preserve permissions, it might also change the executable bit which is very bad anyway.\n\nCould you please tell me which OS you are using, which filesystem it is precisely and what happens when you do\n\n```\n$ chmod 644 some_file\n$ ls -l some_file\n$ chmod 755 some_file\n$ ls -l some_file\n```\non that filesystem?  I'm just trying to understand the situation better so I can find out the best fix.",
    "created_at": "2011-10-15T19:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [AlexanderDreyer](#comment%3A22):
> Since I'm forced to work on a non-standard network file system, where I cannot enforce the requested permissions, I have to change the permissions while bundling the spkg, i.e. when generating the tar-file. (Despite from my broken file system, the same is true, when working on a fat-based drive, may USB sticks, etc.)


Partially off-topic but highly important question: what does your "broken" filesystem do to executable permissions?  If it doesn't preserve permissions, it might also change the executable bit which is very bad anyway.

Could you please tell me which OS you are using, which filesystem it is precisely and what happens when you do

```
$ chmod 644 some_file
$ ls -l some_file
$ chmod 755 some_file
$ ls -l some_file
```
on that filesystem?  I'm just trying to understand the situation better so I can find out the best fix.



---

archive/issue_comments_163102.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2011-10-15T19:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163102",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_163103.json:
```json
{
    "body": "<a id='comment:24'></a>\nEr, sorry, I meant `sage -pkg` rather than `sage -spkg`, as I assume Jeroen did too.",
    "created_at": "2011-10-15T19:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163103",
    "user": "https://github.com/kini"
}
```

<a id='comment:24'></a>
Er, sorry, I meant `sage -pkg` rather than `sage -spkg`, as I assume Jeroen did too.



---

archive/issue_comments_163104.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [AlexanderDreyer](#comment%3A22):\n> First of all, this is a patch to `sage-pkg`, not `sage-spkg`. So I'm talking about generating an spkg, not installing it.\n\nThat's what I meant, though I might have said it wrongly.",
    "created_at": "2011-10-15T19:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [AlexanderDreyer](#comment%3A22):
> First of all, this is a patch to `sage-pkg`, not `sage-spkg`. So I'm talking about generating an spkg, not installing it.

That's what I meant, though I might have said it wrongly.



---

archive/issue_comments_163105.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [jdemeyer](#comment%3A23):\n> Partially off-topic but highly important question: what does your \"broken\" filesystem do to executable permissions?  If it doesn't preserve permissions, it might also change the executable bit which is very bad anyway.\n\nThe (owner) execetable bit is not affected.\n \n> Could you please tell me which OS you are using, which filesystem it is precisely and what happens when you do\n> \n> ```\n> $ chmod 644 some_file\n> $ ls -l some_file\n> $ chmod 755 some_file\n> $ ls -l some_file\n> ```\n> on that filesystem?  I'm just trying to understand the situation better so I can find out the best fix.\n\nIt is Linux, in particular SuSE Enterprise 11, but that's not part of the problem. The file are on an standalone file server which caches a lot of things. It seems there is a bug in the fileserver's system or in the driver, so that permissions are sometimes \"stuck\", i.e. chmod doesn't to anything (resp. the changes last some minutes to become active).\n\nBut anyway, as I understand from #11664 the sources *must* be world readable in any case. So Sage should provides a tool to ensure this while packaging - at least optionally.  Alternatively, `sage-pkg` should test the permissions and give a warning if necessary. \n\nBTW: For the second part of the patch - namely changing the user/group to root - this should be done for privacy reasons anyway. (This can only be done in the tar file)",
    "created_at": "2011-10-15T20:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163105",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:26'></a>
Replying to [jdemeyer](#comment%3A23):
> Partially off-topic but highly important question: what does your "broken" filesystem do to executable permissions?  If it doesn't preserve permissions, it might also change the executable bit which is very bad anyway.

The (owner) execetable bit is not affected.
 
> Could you please tell me which OS you are using, which filesystem it is precisely and what happens when you do
> 
> ```
> $ chmod 644 some_file
> $ ls -l some_file
> $ chmod 755 some_file
> $ ls -l some_file
> ```
> on that filesystem?  I'm just trying to understand the situation better so I can find out the best fix.

It is Linux, in particular SuSE Enterprise 11, but that's not part of the problem. The file are on an standalone file server which caches a lot of things. It seems there is a bug in the fileserver's system or in the driver, so that permissions are sometimes "stuck", i.e. chmod doesn't to anything (resp. the changes last some minutes to become active).

But anyway, as I understand from #11664 the sources *must* be world readable in any case. So Sage should provides a tool to ensure this while packaging - at least optionally.  Alternatively, `sage-pkg` should test the permissions and give a warning if necessary. 

BTW: For the second part of the patch - namely changing the user/group to root - this should be done for privacy reasons anyway. (This can only be done in the tar file)



---

archive/issue_comments_163106.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [AlexanderDreyer](#comment%3A26):\n> But anyway, as I understand from #11664 the sources *must* be world readable in any case. So Sage should provides a tool to ensure this while packaging - at least optionally.  Alternatively, `sage-pkg` should test the permissions and give a warning if necessary.\n\n\nWell, in principle only files that are to be *copied* (with `-p`) into the Sage installation tree should have 0644 or 0755 permissions (one should usually use some BSD-like `install` where this isn't an issue at all), but it's of course nearly impossible to check that when doing an automatic \"sanity\" check on an spkg.\n\n\n\n\n> BTW: For the second part of the patch - namely changing the user/group to root - this should be done for privacy reasons anyway. (This can only be done in the tar file)\n\n\nFWIW, doing\n\n```sh\n$ tar -C /tmp -xvjf foo-x.y.z.pN.spkg &&\n  tar -C /tmp --owner=0 --group=0 -cvjf foo-x.y.z.pN.spkg foo-x.y.z.pN\n```\nyou can achieve the same.\n\n(I personally don't think privacy really matters here, especially since you can fake arbitrary user/group names or IDs, and your e-mail address should be contained in the log anyway.  Instead, it is IMHO useful to see who packaged an spkg, modulo that there need not be a relation to a user you really know.  Alternatively, you could also use *numeric* UIDs/GIDs for the tarball in case you feel using your real logname is dangerous from a security point of view.)",
    "created_at": "2011-10-18T03:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163106",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [AlexanderDreyer](#comment%3A26):
> But anyway, as I understand from #11664 the sources *must* be world readable in any case. So Sage should provides a tool to ensure this while packaging - at least optionally.  Alternatively, `sage-pkg` should test the permissions and give a warning if necessary.


Well, in principle only files that are to be *copied* (with `-p`) into the Sage installation tree should have 0644 or 0755 permissions (one should usually use some BSD-like `install` where this isn't an issue at all), but it's of course nearly impossible to check that when doing an automatic "sanity" check on an spkg.




> BTW: For the second part of the patch - namely changing the user/group to root - this should be done for privacy reasons anyway. (This can only be done in the tar file)


FWIW, doing

```sh
$ tar -C /tmp -xvjf foo-x.y.z.pN.spkg &&
  tar -C /tmp --owner=0 --group=0 -cvjf foo-x.y.z.pN.spkg foo-x.y.z.pN
```
you can achieve the same.

(I personally don't think privacy really matters here, especially since you can fake arbitrary user/group names or IDs, and your e-mail address should be contained in the log anyway.  Instead, it is IMHO useful to see who packaged an spkg, modulo that there need not be a relation to a user you really know.  Alternatively, you could also use *numeric* UIDs/GIDs for the tarball in case you feel using your real logname is dangerous from a security point of view.)



---

archive/issue_comments_163107.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [leif](#comment%3A27):\n> Well, in principle only files that are to be *copied* (with `-p`) into the Sage installation tree should have 0644 or 0755 permissions (one should usually use some BSD-like `install` where this isn't an issue at all), but it's of course nearly impossible to check that when doing an automatic \"sanity\" check on an spkg.\n\nThe installation tree of that old spkg had always been sane, since PolyBoRi enforces the permissions on install. \n\nThe permissions in the source tree were considered as buggy. But if you what specific permissions in the source, you need a tool to either enforce or check this. (That patch for checking would be trivial. I'll provide it, if there's a chance for a review.)\n\n> FWIW, doing\n\n[...]\n> you can achieve the same.\n\nRight, but others could be trapped in the same way.\n\n> (I personally don't think privacy really matters here, especially since you can fake arbitrary user/group names or IDs, and your e-mail address should be contained in the log anyway.  Instead, it is IMHO useful to see who packaged an spkg, modulo that there need not be a relation to a user you really know.  Alternatively, you could also use *numeric* UIDs/GIDs for the tarball in case you feel using your real logname is dangerous from a security point of view.)\n\nMy group id encodes part of my institute's organization and even details of my contract (if you know how to read it). If you want security you need to sign spkgs. But that's another quest.",
    "created_at": "2011-10-18T06:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163107",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:28'></a>
Replying to [leif](#comment%3A27):
> Well, in principle only files that are to be *copied* (with `-p`) into the Sage installation tree should have 0644 or 0755 permissions (one should usually use some BSD-like `install` where this isn't an issue at all), but it's of course nearly impossible to check that when doing an automatic "sanity" check on an spkg.

The installation tree of that old spkg had always been sane, since PolyBoRi enforces the permissions on install. 

The permissions in the source tree were considered as buggy. But if you what specific permissions in the source, you need a tool to either enforce or check this. (That patch for checking would be trivial. I'll provide it, if there's a chance for a review.)

> FWIW, doing

[...]
> you can achieve the same.

Right, but others could be trapped in the same way.

> (I personally don't think privacy really matters here, especially since you can fake arbitrary user/group names or IDs, and your e-mail address should be contained in the log anyway.  Instead, it is IMHO useful to see who packaged an spkg, modulo that there need not be a relation to a user you really know.  Alternatively, you could also use *numeric* UIDs/GIDs for the tarball in case you feel using your real logname is dangerous from a security point of view.)

My group id encodes part of my institute's organization and even details of my contract (if you know how to read it). If you want security you need to sign spkgs. But that's another quest.



---

archive/issue_comments_163108.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [AlexanderDreyer](#comment%3A28):\n> The permissions in the source tree were considered as buggy. But if you what specific permissions in the source, you need a tool to either enforce or check this. (That patch for checking would be trivial. I'll provide it, if there's a chance for a review.)\n\n\nI'd rather set the `umask` in `sage-spkg`, and do a `chmod -R +rX` on the *extracted* spkg upon installation, if one wants to go triple-safe.\n\nThe added spkg \"sanity check\" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.\n\n\n\n\n> If you want security you need to sign spkgs. But that's another quest.\n\n\nI meant security on your side, not on the user's who installs an spkg.\n\nSigning spkgs, at least those officially shipped or made available, wouldn't be bad either, but that's a different issue.  Of course also every Sage developer could sign his spkgs; I usually provide md5sums for mine, although for a different reason.  But as far as I know Jeroen currently repackages all spkgs anyway before they get merged into a release, just like commit messages of patches get \"beautified\", regardless of whether they already contain the ticket number.",
    "created_at": "2011-10-18T08:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163108",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Replying to [AlexanderDreyer](#comment%3A28):
> The permissions in the source tree were considered as buggy. But if you what specific permissions in the source, you need a tool to either enforce or check this. (That patch for checking would be trivial. I'll provide it, if there's a chance for a review.)


I'd rather set the `umask` in `sage-spkg`, and do a `chmod -R +rX` on the *extracted* spkg upon installation, if one wants to go triple-safe.

The added spkg "sanity check" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.




> If you want security you need to sign spkgs. But that's another quest.


I meant security on your side, not on the user's who installs an spkg.

Signing spkgs, at least those officially shipped or made available, wouldn't be bad either, but that's a different issue.  Of course also every Sage developer could sign his spkgs; I usually provide md5sums for mine, although for a different reason.  But as far as I know Jeroen currently repackages all spkgs anyway before they get merged into a release, just like commit messages of patches get "beautified", regardless of whether they already contain the ticket number.



---

archive/issue_comments_163109.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [leif](#comment%3A29):\n> The added spkg \"sanity check\" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.\n\nI don't agree (it would have helped to avoid #11664), but it seems there's no way to fix the ticket.",
    "created_at": "2011-10-18T19:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163109",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:30'></a>
Replying to [leif](#comment%3A29):
> The added spkg "sanity check" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.

I don't agree (it would have helped to avoid #11664), but it seems there's no way to fix the ticket.



---

archive/issue_events_036281.json:
```json
{
    "actor": "https://github.com/alexanderdreyer",
    "created_at": "2011-10-18T19:25:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11676#event-36281"
}
```



---

archive/issue_comments_163110.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [AlexanderDreyer](#comment%3A30):\n> Replying to [leif](#comment%3A29):\n> > The added spkg \"sanity check\" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.\n\n> I don't agree (it would have helped to avoid #11664), but it seems there's no way to fix the ticket.\n\nI didn't mean `sage -pkg` (i.e., a sanity check regarding permissions *there*, although you'd have the same problems unless you're upstream), but the *merger script* which complains about any \"suspicious\" permissions since -- as mentioned -- it's hard or impossible to do a *reasonable* check regarding this, i.e., to make sure all *installed files* have or will have the correct permissions.\n\nSo I wouldn't mind if `sage -pkg` issued warnings (to perhaps be disabled by some option), but the proper or safest way to avoid such issues is IMHO still to set the umask and do a `chmod -R` on `src/` at least (from `sage-spkg`), although this will in most cases be redundant or superfluous (e.g. if `install -c -m ...` is used by the spkg anyway, or all files to be copied with `cp -p` already have the proper permissions).  In fact, a sanity check should be made *on the Sage installation*, after one or more (or all) spkgs have been built and installed.",
    "created_at": "2011-10-20T06:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163110",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>
Replying to [AlexanderDreyer](#comment%3A30):
> Replying to [leif](#comment%3A29):
> > The added spkg "sanity check" regarding permissions is IMHO superfluous and rather annoying; as Keshav mentioned, we should in general leave the upstream alone, i.e., ship it really vanilla, and maybe fix individual permissions in the corresponding `spkg-install` file if necessary.

> I don't agree (it would have helped to avoid #11664), but it seems there's no way to fix the ticket.

I didn't mean `sage -pkg` (i.e., a sanity check regarding permissions *there*, although you'd have the same problems unless you're upstream), but the *merger script* which complains about any "suspicious" permissions since -- as mentioned -- it's hard or impossible to do a *reasonable* check regarding this, i.e., to make sure all *installed files* have or will have the correct permissions.

So I wouldn't mind if `sage -pkg` issued warnings (to perhaps be disabled by some option), but the proper or safest way to avoid such issues is IMHO still to set the umask and do a `chmod -R` on `src/` at least (from `sage-spkg`), although this will in most cases be redundant or superfluous (e.g. if `install -c -m ...` is used by the spkg anyway, or all files to be copied with `cp -p` already have the proper permissions).  In fact, a sanity check should be made *on the Sage installation*, after one or more (or all) spkgs have been built and installed.



---

archive/issue_comments_163111.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [leif](#comment%3A31):\n> So I wouldn't mind if `sage -pkg` issued warnings (to perhaps be disabled by some option), but the proper or safest way to avoid such issues is IMHO still to set the umask and do a `chmod -R` on `src/` at least (from `sage-spkg`), although this will in most cases be redundant or superfluous (e.g. if `install -c -m ...` is used by the spkg anyway, or all files to be copied with `cp -p` already have the proper permissions).  In fact, a sanity check should be made *on the Sage installation*, after one or more (or all) spkgs have been built and installed.\n\numask alone is not enough, the standalone file server, where my projects live, is configured to override the user's umask and enforces world-writable permissions. Installed files should not preserve them, so install (or something equivalent) is necessary indeed.\nchmod is not work always be effective. For instance, think of working on a FAT-based USB-drive. The latter has fixed permissions, set on mount time.",
    "created_at": "2011-10-20T20:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163111",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:32'></a>
Replying to [leif](#comment%3A31):
> So I wouldn't mind if `sage -pkg` issued warnings (to perhaps be disabled by some option), but the proper or safest way to avoid such issues is IMHO still to set the umask and do a `chmod -R` on `src/` at least (from `sage-spkg`), although this will in most cases be redundant or superfluous (e.g. if `install -c -m ...` is used by the spkg anyway, or all files to be copied with `cp -p` already have the proper permissions).  In fact, a sanity check should be made *on the Sage installation*, after one or more (or all) spkgs have been built and installed.

umask alone is not enough, the standalone file server, where my projects live, is configured to override the user's umask and enforces world-writable permissions. Installed files should not preserve them, so install (or something equivalent) is necessary indeed.
chmod is not work always be effective. For instance, think of working on a FAT-based USB-drive. The latter has fixed permissions, set on mount time.



---

archive/issue_comments_163112.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [AlexanderDreyer](#comment%3A32):\n> Replying to [leif](#comment%3A31):\n> chmod is not work always be effective. For instance, think of working on a FAT-based USB-drive. The latter has fixed permissions, set on mount time.\n\n\nAs I mentioned above, that would be very bad anyway, because you also lose information on *executable* permissions.  Linux, for example, treats all files on a FAT system as executable.",
    "created_at": "2011-10-22T16:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163112",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [AlexanderDreyer](#comment%3A32):
> Replying to [leif](#comment%3A31):
> chmod is not work always be effective. For instance, think of working on a FAT-based USB-drive. The latter has fixed permissions, set on mount time.


As I mentioned above, that would be very bad anyway, because you also lose information on *executable* permissions.  Linux, for example, treats all files on a FAT system as executable.



---

archive/issue_comments_163113.json:
```json
{
    "body": "**Changing status** from needs_info to positive_review.",
    "created_at": "2014-02-04T08:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163113",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_info to positive_review.



---

archive/issue_comments_163114.json:
```json
{
    "body": "**Reviewer:** Alexander Dreyer, Jeroen Demeyer",
    "created_at": "2014-02-04T08:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163114",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Alexander Dreyer, Jeroen Demeyer



---

archive/issue_comments_163115.json:
```json
{
    "body": "<a id='comment:34'></a>\nShould be closed since `sage-pkg` is obsolete.",
    "created_at": "2014-02-04T08:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163115",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Should be closed since `sage-pkg` is obsolete.



---

archive/issue_comments_163116.json:
```json
{
    "body": "**Changing author** from \"Alexander Dreyer\" to \"\".",
    "created_at": "2014-02-04T08:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163116",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Alexander Dreyer" to "".



---

archive/issue_events_036282.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-04T21:11:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11676#event-36282"
}
```



---

archive/issue_comments_163117.json:
```json
{
    "body": "**Resolution:** wontfix",
    "created_at": "2014-02-04T21:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11676#issuecomment-163117",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** wontfix
