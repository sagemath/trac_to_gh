# Issue 11904: Change default variable name for NumberField and NumberFieldElement -> PARI conversion

archive/issues_011732.json:
```json
{
    "body": "This should be fixed:\n\n```\nsage: K.<a> = NumberField(x^3 + 2)\nsage: R.<x> = PolynomialRing(K)\nsage: pari(a*x)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n\n/usr/local/src/sage-4.7.2.alpha2/<ipython console> in <module>()\n\n/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.PariInstance.__call__ (sage/libs/pari/gen.c:43353)()\n\n/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial._pari_ (sage/rings/polynomial/polynomial_element.c:27815)()\n\n/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial._pari_with_name (sage/rings/polynomial/polynomial_element.c:28109)()\n\n/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:48151)()\n\nPariError:  (5)\n```\n\nThe reason is:\n\n```\nsage: K.<a> = NumberField(x^3 + 2)\nsage: a._pari_()\nMod(x, x^3 + 2)\n```\nNote that the variable `x` is used. Since polynomials prefer the variable name `x`, it might be better to use `y` by default (or any other name) for number field elements.\n\nThere is no good way to fix this for relative number fields, so we don't change that.\n\nAlso, the `_pari_()` methods for `NumberFieldElement_absolute` and `NumberFieldElement_relative` are exactly the same, so we should avoid code duplication.\n\nAssignee: @loefflerd\n\nResolution: fixed\n\nDependencies: sage-4.8.alpha2\n\nAuthor: Jeroen Demeyer\n\nReviewer: John Cremona\n\nMerged: sage-4.8.alpha5\n\nIssue created by migration from https://trac.sagemath.org/ticket/11904\n\n",
    "closed_at": "2011-12-17T09:11:39Z",
    "created_at": "2011-10-07T10:24:59Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Change default variable name for NumberField and NumberFieldElement -> PARI conversion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11904",
    "user": "https://github.com/jdemeyer"
}
```
This should be fixed:

```
sage: K.<a> = NumberField(x^3 + 2)
sage: R.<x> = PolynomialRing(K)
sage: pari(a*x)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)

/usr/local/src/sage-4.7.2.alpha2/<ipython console> in <module>()

/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.PariInstance.__call__ (sage/libs/pari/gen.c:43353)()

/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial._pari_ (sage/rings/polynomial/polynomial_element.c:27815)()

/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial._pari_with_name (sage/rings/polynomial/polynomial_element.c:28109)()

/usr/local/src/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:48151)()

PariError:  (5)
```

The reason is:

```
sage: K.<a> = NumberField(x^3 + 2)
sage: a._pari_()
Mod(x, x^3 + 2)
```
Note that the variable `x` is used. Since polynomials prefer the variable name `x`, it might be better to use `y` by default (or any other name) for number field elements.

There is no good way to fix this for relative number fields, so we don't change that.

Also, the `_pari_()` methods for `NumberFieldElement_absolute` and `NumberFieldElement_relative` are exactly the same, so we should avoid code duplication.

Assignee: @loefflerd

Resolution: fixed

Dependencies: sage-4.8.alpha2

Author: Jeroen Demeyer

Reviewer: John Cremona

Merged: sage-4.8.alpha5

Issue created by migration from https://trac.sagemath.org/ticket/11904





---

archive/issue_comments_133145.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-10T13:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133145",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133146.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-10T20:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133146",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133147.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-15T11:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133147",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133148.json:
```json
{
    "body": "<a id='comment:9'></a>Quick question?   What happens if I do:\n\n```\nsage: K.<a> = NumberField(x^3 + 2)\nsage: R.<y> = PolynomialRing(K)\nsage: pari(a*y)\n```\n\nI would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.\n\n\nIf the above fails, isn't this a pretty bad approach to this problem?    Wouldn't it be better to call the variable in PARI something like \"__x\" or \"_x\" (say), which is very very unlikely to class.   That would use the standard Sage/Python convention that one should not use stuff prefixed with underscores except in programming.",
    "created_at": "2011-10-30T04:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133148",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>Quick question?   What happens if I do:

```
sage: K.<a> = NumberField(x^3 + 2)
sage: R.<y> = PolynomialRing(K)
sage: pari(a*y)
```

I would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.


If the above fails, isn't this a pretty bad approach to this problem?    Wouldn't it be better to call the variable in PARI something like "__x" or "_x" (say), which is very very unlikely to class.   That would use the standard Sage/Python convention that one should not use stuff prefixed with underscores except in programming.



---

archive/issue_comments_133149.json:
```json
{
    "body": "<a id='comment:10'></a>It might make sense to set the default value to depend on the name of the generator (e.g. for instance `a` -> `a_pari` or `a_parivar`).",
    "created_at": "2011-10-30T04:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133149",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:10'></a>It might make sense to set the default value to depend on the name of the generator (e.g. for instance `a` -> `a_pari` or `a_parivar`).



---

archive/issue_comments_133150.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 was]:\n> Quick question?   What happens if I do:\n> \n> ```\n> sage: K.<a> = NumberField(x^3 + 2)\n> sage: R.<y> = PolynomialRing(K)\n> sage: pari(a*y)\n> ```\n\nThis fails by raising `PariError`.\n\nThe following *does* work (and it does *not* without the patch):\n\n```\nsage: K.<a> = NumberField(x^3 + 2)\nsage: R.<y> = PolynomialRing(K)\nsage: (a*y)._pari_with_name('x')\nMod(y, y^3 + 2)*x\n```\n\n> I would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.\n\nWell, it should apply against sage-4.7.2.alpha3 (or more recent) if you apply all the dependencies.  But it is possible that I forgot a dependency.\n\n> If the above fails, isn't this a pretty bad approach to this problem?    Wouldn't it be better to call the variable in PARI something like `__x` or `_x` (say).\n\nNo, this has to do with variable priorities and is not something which is easily fixed.  Besides, even if we do this, then you would still have problems again with polynomial rings in multiple variables or relative extensions.\n\nSo I'm not claiming this patch fixes all issues, it just *improves* on the existing behaviour.  My patch changes the `pari` function for number field polynomials from **never** working to **sometimes** working (it works if you use *x* as polynomial variable).\n\nI also think this patch is important for the Sage library, since there we can easily take the PARI variable to be *x*.  For example, my patch changes\n\n```\nKbnf = self.pari_bnf(proof=proof).nf_subst(\"'y\")\ncoeffs = [ a._pari_(\"y\") for a in relpoly.coeffs() ]\npolrel = pari(coeffs).Polrev()\nreturn Kbnf.rnfisnorminit(polrel)\n```\nto the much simpler\n\n```\nKbnf = self.pari_bnf(proof=proof)\nreturn Kbnf.rnfisnorminit(relpoly._pari_with_name())\n```",
    "created_at": "2011-10-30T11:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133150",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:9 was]:
> Quick question?   What happens if I do:
> 
> ```
> sage: K.<a> = NumberField(x^3 + 2)
> sage: R.<y> = PolynomialRing(K)
> sage: pari(a*y)
> ```

This fails by raising `PariError`.

The following *does* work (and it does *not* without the patch):

```
sage: K.<a> = NumberField(x^3 + 2)
sage: R.<y> = PolynomialRing(K)
sage: (a*y)._pari_with_name('x')
Mod(y, y^3 + 2)*x
```

> I would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.

Well, it should apply against sage-4.7.2.alpha3 (or more recent) if you apply all the dependencies.  But it is possible that I forgot a dependency.

> If the above fails, isn't this a pretty bad approach to this problem?    Wouldn't it be better to call the variable in PARI something like `__x` or `_x` (say).

No, this has to do with variable priorities and is not something which is easily fixed.  Besides, even if we do this, then you would still have problems again with polynomial rings in multiple variables or relative extensions.

So I'm not claiming this patch fixes all issues, it just *improves* on the existing behaviour.  My patch changes the `pari` function for number field polynomials from **never** working to **sometimes** working (it works if you use *x* as polynomial variable).

I also think this patch is important for the Sage library, since there we can easily take the PARI variable to be *x*.  For example, my patch changes

```
Kbnf = self.pari_bnf(proof=proof).nf_subst("'y")
coeffs = [ a._pari_("y") for a in relpoly.coeffs() ]
polrel = pari(coeffs).Polrev()
return Kbnf.rnfisnorminit(polrel)
```
to the much simpler

```
Kbnf = self.pari_bnf(proof=proof)
return Kbnf.rnfisnorminit(relpoly._pari_with_name())
```



---

archive/issue_comments_133151.json:
```json
{
    "body": "<a id='comment:12'></a>`@`was: truly fixing the whole Sage<->PARI variable conversion is possible but would require some serious redesigning.  Basically, before every computation, we should fix the PARI variables in the correct order.",
    "created_at": "2011-10-30T11:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133151",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>`@`was: truly fixing the whole Sage<->PARI variable conversion is possible but would require some serious redesigning.  Basically, before every computation, we should fix the PARI variables in the correct order.



---

archive/issue_comments_133152.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:9 was]:\n> I would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.\n\n\nI just tried to apply all dependencies + this patch against sage-4.7.2.alpha4 without any problems at all.  Probably you missed some dependency.",
    "created_at": "2011-10-30T20:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133152",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:9 was]:
> I would find out for myself, but with sage-4.7.2.alpha3, I get 13 hunks fail, so I can't apply the patch.  And I don't know which version of Sage this patch is against.


I just tried to apply all dependencies + this patch against sage-4.7.2.alpha4 without any problems at all.  Probably you missed some dependency.



---

archive/issue_comments_133153.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133153",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_031470.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-11T21:42:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11904#event-31470"
}
```



---

archive/issue_comments_133154.json:
```json
{
    "body": "<a id='comment:17'></a>Attachment [11904.patch](tarball://root/attachments/some-uuid/ticket11904/11904.patch) by @jdemeyer created at 2011-11-11 22:06:25",
    "created_at": "2011-11-11T22:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133154",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Attachment [11904.patch](tarball://root/attachments/some-uuid/ticket11904/11904.patch) by @jdemeyer created at 2011-11-11 22:06:25



---

archive/issue_comments_133155.json:
```json
{
    "body": "<a id='comment:19'></a>Applies fine to 4.8.alpha4.  Testing now.  I take the point that this may not be perfect but it's a lot better than it was, so I'll give it a positive review when the tests finish.  (Given the author I am not expecting a problem....)",
    "created_at": "2011-12-16T14:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133155",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>Applies fine to 4.8.alpha4.  Testing now.  I take the point that this may not be perfect but it's a lot better than it was, so I'll give it a positive review when the tests finish.  (Given the author I am not expecting a problem....)



---

archive/issue_comments_133156.json:
```json
{
    "body": "<a id='comment:20'></a>Happy Christmas!",
    "created_at": "2011-12-16T15:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133156",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'></a>Happy Christmas!



---

archive/issue_comments_133157.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-16T15:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133157",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133158.json:
```json
{
    "body": "<a id='comment:21'></a>Happy Christmas to you too, and see you on monday!",
    "created_at": "2011-12-17T09:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133158",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Happy Christmas to you too, and see you on monday!



---

archive/issue_comments_133159.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-12-17T09:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-133159",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_031471.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-17T09:11:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11904#event-31471"
}
```
