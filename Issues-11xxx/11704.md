# Issue 11704: Resolve symbolic links in $HOME/.sage

archive/issues_011532.json:
```json
{
    "body": "CC:  @nexttime\n\nSimilarly to `SAGE_ROOT`, it might be good to resolve symbolic links in `$HOME/.sage` when assigning `DOT_SAGE`.  This can be useful for example when `$HOME/.sage` is a symbolic link to a non-existent directory (the directory would be created later in `sage-sage`).\n\nProbably we should use whatever solution comes from #5852.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11704\n\n",
    "closed_at": "2011-12-29T07:03:06Z",
    "created_at": "2011-08-18T19:20:40Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Resolve symbolic links in $HOME/.sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11704",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @nexttime

Similarly to `SAGE_ROOT`, it might be good to resolve symbolic links in `$HOME/.sage` when assigning `DOT_SAGE`.  This can be useful for example when `$HOME/.sage` is a symbolic link to a non-existent directory (the directory would be created later in `sage-sage`).

Probably we should use whatever solution comes from #5852.

Issue created by migration from https://trac.sagemath.org/ticket/11704





---

archive/issue_comments_129142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-18T19:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129142",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129143.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-18T19:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129143",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129144.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-23T13:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129144",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129145.json:
```json
{
    "body": "Note also #11924: currently if `DOTSAGE` doesn't end with a slash, then there are unintended consequences.  (#11924 should be an easy review.)",
    "created_at": "2011-11-17T23:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129145",
    "user": "https://github.com/jhpalmieri"
}
```

Note also #11924: currently if `DOTSAGE` doesn't end with a slash, then there are unintended consequences.  (#11924 should be an easy review.)



---

archive/issue_comments_129146.json:
```json
{
    "body": "I wonder if we should put the `resolvelinks` script in a separate file in the root repo, and then call it from the top-level sage script (as in #5852) or from sage-env (for this ticket).  As such, this seems related to #11073.",
    "created_at": "2011-12-19T21:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129146",
    "user": "https://github.com/jhpalmieri"
}
```

I wonder if we should put the `resolvelinks` script in a separate file in the root repo, and then call it from the top-level sage script (as in #5852) or from sage-env (for this ticket).  As such, this seems related to #11073.



---

archive/issue_comments_129147.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> I wonder if we should put the `resolvelinks` script in a separate file in the root repo, and then call it from the top-level sage script (as in #5852) or from sage-env (for this ticket).\n\n\nWe *cannot* put it in a seperate file because `$SAGE_ROOT/sage` would need to know `SAGE_ROOT` in order to find this new separate file.  So, in any case, `$SAGE_ROOT/sage` needs the `resolvelinks` script.  So, we would have to source `$SAGE_ROOT/sage` from `sage-env` which doesn't sound like a very good idea (it *could* be done though).",
    "created_at": "2011-12-19T21:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129147",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 jhpalmieri]:
> I wonder if we should put the `resolvelinks` script in a separate file in the root repo, and then call it from the top-level sage script (as in #5852) or from sage-env (for this ticket).


We *cannot* put it in a seperate file because `$SAGE_ROOT/sage` would need to know `SAGE_ROOT` in order to find this new separate file.  So, in any case, `$SAGE_ROOT/sage` needs the `resolvelinks` script.  So, we would have to source `$SAGE_ROOT/sage` from `sage-env` which doesn't sound like a very good idea (it *could* be done though).



---

archive/issue_comments_129148.json:
```json
{
    "body": "Well, what's the purpose of canonicalizing SAGE_ROOT in the `sage` script?  It seems useful to have canonical names for paths, and it's important for some doctests (etc.), but do we actually need to do this for the script to function properly right at the start?  If not, we could detect a preliminary value for `SAGE_ROOT` first, find the `resolvelinks` script, run it if it exists (e.g., check after seeing if `sage-sage` exists and before exporting `SAGE_ROOT`), and then find and export the permanent value for `SAGE_ROOT`.",
    "created_at": "2011-12-20T00:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129148",
    "user": "https://github.com/jhpalmieri"
}
```

Well, what's the purpose of canonicalizing SAGE_ROOT in the `sage` script?  It seems useful to have canonical names for paths, and it's important for some doctests (etc.), but do we actually need to do this for the script to function properly right at the start?  If not, we could detect a preliminary value for `SAGE_ROOT` first, find the `resolvelinks` script, run it if it exists (e.g., check after seeing if `sage-sage` exists and before exporting `SAGE_ROOT`), and then find and export the permanent value for `SAGE_ROOT`.



---

archive/issue_comments_129149.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> Well, what's the purpose of canonicalizing SAGE_ROOT in the `sage` script?\n\n\nIt's precisely for the reason I said: we need to be able to determine a usable value of `$SAGE_ROOT` before we can do *anything* with Sage.\n\nIt's true that it doesn't matter that it's canonical, but we still need to dereference symbolic links in `$0` (the script filename) to find `$SAGE_ROOT`.  Since #5852, we support an installation where somebody makes a symbolic link from `/usr/local/bin/sage` to `/usr/local/sage/sage-4.8/sage` or whatever.\n\nI agree the code duplication is not so nice, but I still think the patch can be reviewed as-is.",
    "created_at": "2011-12-21T10:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129149",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 jhpalmieri]:
> Well, what's the purpose of canonicalizing SAGE_ROOT in the `sage` script?


It's precisely for the reason I said: we need to be able to determine a usable value of `$SAGE_ROOT` before we can do *anything* with Sage.

It's true that it doesn't matter that it's canonical, but we still need to dereference symbolic links in `$0` (the script filename) to find `$SAGE_ROOT`.  Since #5852, we support an installation where somebody makes a symbolic link from `/usr/local/bin/sage` to `/usr/local/sage/sage-4.8/sage` or whatever.

I agree the code duplication is not so nice, but I still think the patch can be reviewed as-is.



---

archive/issue_comments_129150.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-21T17:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129150",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129151.json:
```json
{
    "body": "Amazing, this causes\n\n```\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py\", line 526:\n    sage: E.conductor(algorithm=\"gp\")\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[5]>\", line 1, in <module>\n        E.conductor(algorithm=\"gp\")###line 526:\n    sage: E.conductor(algorithm=\"gp\")\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 552, in conductor\n        self.__conductor_gp = Integer(gp.eval('ellglobalred(ellinit(%s,0))[1]'%list(self.a_invariants())))\n      File \"integer.pyx\", line 681, in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:6786)\n    TypeError: unable to convert x (=read(\"/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/home/.sage/temp/sage.math.washington.edu/9425//interface//tmp11939\") ) to an integer\n**********************************************************************\n```",
    "created_at": "2011-12-22T12:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129151",
    "user": "https://github.com/jdemeyer"
}
```

Amazing, this causes

```
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py", line 526:
    sage: E.conductor(algorithm="gp")
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[5]>", line 1, in <module>
        E.conductor(algorithm="gp")###line 526:
    sage: E.conductor(algorithm="gp")
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 552, in conductor
        self.__conductor_gp = Integer(gp.eval('ellglobalred(ellinit(%s,0))[1]'%list(self.a_invariants())))
      File "integer.pyx", line 681, in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:6786)
    TypeError: unable to convert x (=read("/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha4-remove-base/home/.sage/temp/sage.math.washington.edu/9425//interface//tmp11939") ) to an integer
**********************************************************************
```



---

archive/issue_comments_129152.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-12-22T12:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129152",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_129153.json:
```json
{
    "body": "I keep positive review here, the latter problem is now #12221.",
    "created_at": "2011-12-22T13:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129153",
    "user": "https://github.com/jdemeyer"
}
```

I keep positive review here, the latter problem is now #12221.



---

archive/issue_comments_129154.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-12-22T13:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129154",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_129155.json:
```json
{
    "body": "Attachment [11704.patch](tarball://root/attachments/some-uuid/ticket11704/11704.patch) by @jdemeyer created at 2011-12-24 01:47:22\n\nPatch to the SCRIPTS repository (local/bin)",
    "created_at": "2011-12-24T01:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129155",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [11704.patch](tarball://root/attachments/some-uuid/ticket11704/11704.patch) by @jdemeyer created at 2011-12-24 01:47:22

Patch to the SCRIPTS repository (local/bin)



---

archive/issue_comments_129156.json:
```json
{
    "body": "I changed the patch slightly to add the slash after $DOT_SAGE.  I don't see how this could cause #12221, but it seems safer to keep the slash, just like it was before.  Needs review please.",
    "created_at": "2011-12-24T01:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129156",
    "user": "https://github.com/jdemeyer"
}
```

I changed the patch slightly to add the slash after $DOT_SAGE.  I don't see how this could cause #12221, but it seems safer to keep the slash, just like it was before.  Needs review please.



---

archive/issue_comments_129157.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-12-24T01:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129157",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_129158.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-24T01:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129158",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129159.json:
```json
{
    "body": "John, can you please review this new revised patch?",
    "created_at": "2011-12-26T11:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129159",
    "user": "https://github.com/jdemeyer"
}
```

John, can you please review this new revised patch?



---

archive/issue_comments_129160.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-27T19:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129160",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129161.json:
```json
{
    "body": "The only real change is to append the slash, right?  It works for me in my testing.",
    "created_at": "2011-12-27T19:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129161",
    "user": "https://github.com/jhpalmieri"
}
```

The only real change is to append the slash, right?  It works for me in my testing.



---

archive/issue_events_030759.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-29T07:03:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11704#event-30759"
}
```



---

archive/issue_comments_129162.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-12-29T07:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11704#issuecomment-129162",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
