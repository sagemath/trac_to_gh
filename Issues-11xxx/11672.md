# Issue 11672: Some more doctests from the book "Calcul mathématique avec Sage"

archive/issues_011500.json:
```json
{
    "body": "The attached patch adds to the Sage testsuite most examples appearing Chapters 6 and 8 (Polynomials, Polynomial Systems) of the French book [Calcul math\u00e9matique avec Sage](http://sagebook.gforge.inria.fr/). See #9395 for some background.\n\nAll tests pass with sage 5.5.\n\nAssignee: mvngu\n\nCC:  @malb bouillaguet\n\nReviewer: Martin Albrecht, Charles Bouillaguet\n\nAuthor: Marc Mezzarobba\n\nMerged: sage-5.7.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11672\n\n",
    "closed_at": "2013-01-30T07:34:57Z",
    "created_at": "2011-08-09T19:59:51Z",
    "labels": [
        "component: doctest coverage",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Some more doctests from the book \"Calcul math\u00e9matique avec Sage\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11672",
    "user": "https://github.com/mezzarobba"
}
```
The attached patch adds to the Sage testsuite most examples appearing Chapters 6 and 8 (Polynomials, Polynomial Systems) of the French book [Calcul mathématique avec Sage](http://sagebook.gforge.inria.fr/). See #9395 for some background.

All tests pass with sage 5.5.

Assignee: mvngu

CC:  @malb bouillaguet

Reviewer: Martin Albrecht, Charles Bouillaguet

Author: Marc Mezzarobba

Merged: sage-5.7.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11672





---

archive/issue_comments_135626.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-10T06:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135626",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135627.json:
```json
{
    "body": "<a id='comment:2'></a>Martin, please could you review this? This will help our book to be more stable with future\nversions of Sage. Thank you in advance (as a coauthor of the book, I'm quite reluctant to\nreview this).\n\nPaul",
    "created_at": "2011-08-24T19:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135627",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:2'></a>Martin, please could you review this? This will help our book to be more stable with future
versions of Sage. Thank you in advance (as a coauthor of the book, I'm quite reluctant to
review this).

Paul



---

archive/issue_comments_135628.json:
```json
{
    "body": "<a id='comment:3'></a>Sure, I can take a look:\n\n* Please rename the patch to have the \".patch\" suffix.\n* There might be an issue with the UTF-8, but we should try and wait if anybody complaints.\n* Do you really want to include an autogenerated file without any manual post processing? (\"This file was *autogenerated* from sagebook.tex with sagetex.sty\")\n* Please add your full name to the author field here on Trac.\n* I get some numerical noise errors:\n\n```python\nFile \"/mnt/usb1/scratch/malb/sage-4.7.2/devel/sage/sage/tests/french_book/mpoly.py\", line 373:\n    sage: [CDF['x'](p(y=ys[0][0])).roots() for p in J.gens()]\nExpected:\n    [[(-0.6 - 1.30624677741e-16*I, 1), (0.6 + 1.30624677741e-16*I, 1)],\n    [(0.6 - 3.13499226579e-16*I, 1), (2.6 + 3.13499226579e-16*I, 1)]]\nGot:\n    [[(-0.6 - 1.30628991909e-16*I, 1), (0.6 + 1.30628991909e-16*I, 1)], \n    [(0.6 - 3.13509580582e-16*I, 1), (2.6 + 3.13509580582e-16*I, 1)]]\n```",
    "created_at": "2011-08-24T21:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135628",
    "user": "https://github.com/malb"
}
```

<a id='comment:3'></a>Sure, I can take a look:

* Please rename the patch to have the ".patch" suffix.
* There might be an issue with the UTF-8, but we should try and wait if anybody complaints.
* Do you really want to include an autogenerated file without any manual post processing? ("This file was *autogenerated* from sagebook.tex with sagetex.sty")
* Please add your full name to the author field here on Trac.
* I get some numerical noise errors:

```python
File "/mnt/usb1/scratch/malb/sage-4.7.2/devel/sage/sage/tests/french_book/mpoly.py", line 373:
    sage: [CDF['x'](p(y=ys[0][0])).roots() for p in J.gens()]
Expected:
    [[(-0.6 - 1.30624677741e-16*I, 1), (0.6 + 1.30624677741e-16*I, 1)],
    [(0.6 - 3.13499226579e-16*I, 1), (2.6 + 3.13499226579e-16*I, 1)]]
Got:
    [[(-0.6 - 1.30628991909e-16*I, 1), (0.6 + 1.30628991909e-16*I, 1)], 
    [(0.6 - 3.13509580582e-16*I, 1), (2.6 + 3.13509580582e-16*I, 1)]]
```



---

archive/issue_comments_135629.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-24T21:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135629",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135630.json:
```json
{
    "body": "<a id='comment:4'></a>Martin, on which platform do you get numerical noise errors? With Sage 4.7 on a 64-bit Core 2,\nI get no difference.\n\nPaul",
    "created_at": "2011-08-25T10:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135630",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>Martin, on which platform do you get numerical noise errors? With Sage 4.7 on a 64-bit Core 2,
I get no difference.

Paul



---

archive/issue_comments_135631.json:
```json
{
    "body": "<a id='comment:5'></a>This was on sage.math (sorry, should have mentioned).",
    "created_at": "2011-08-26T12:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135631",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>This was on sage.math (sorry, should have mentioned).



---

archive/issue_comments_135632.json:
```json
{
    "body": "<a id='comment:6'></a>I will try to make this go through",
    "created_at": "2013-01-12T09:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135632",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:6'></a>I will try to make this go through



---

archive/issue_comments_135633.json:
```json
{
    "body": "<a id='comment:7'></a>thanks Charles!\n\nPaul",
    "created_at": "2013-01-12T11:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135633",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'></a>thanks Charles!

Paul



---

archive/issue_comments_135634.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2013-01-18T13:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135634",
    "user": "https://github.com/mezzarobba"
}
```

Changing priority from major to minor.



---

archive/issue_comments_135635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-18T13:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135635",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135636.json:
```json
{
    "body": "<a id='comment:9'></a>Charles: Thanks!\n\nHere is a new version of the patch, updated to the last draft of the book (which contains what should hopefully be the final version of the chapters in question...) and to Sage 5.5.",
    "created_at": "2013-01-18T13:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135636",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>Charles: Thanks!

Here is a new version of the patch, updated to the last draft of the book (which contains what should hopefully be the final version of the chapters in question...) and to Sage 5.5.



---

archive/issue_comments_135637.json:
```json
{
    "body": "<a id='comment:10'></a>Looks good to me !",
    "created_at": "2013-01-18T16:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135637",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:10'></a>Looks good to me !



---

archive/issue_comments_135638.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n The attached patch adds to the Sage testsuite most examples appearing Chapters 6 and 8 (Polynomials, Polynomial Systems) of the French book [Calcul math\u00e9matique avec Sage](http://sagebook.gforge.inria.fr/). See #9395 for some background.\n \n-All tests pass with sage 4.7.\n+All tests pass with sage 5.5.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-01-18T16:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135638",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 The attached patch adds to the Sage testsuite most examples appearing Chapters 6 and 8 (Polynomials, Polynomial Systems) of the French book [Calcul mathématique avec Sage](http://sagebook.gforge.inria.fr/). See #9395 for some background.
 
-All tests pass with sage 4.7.
+All tests pass with sage 5.5.
 
 Comment: 1
 
``````




---

archive/issue_comments_135639.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-18T16:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135639",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_030649.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet",
    "created_at": "2013-01-18T16:57:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11672#event-30649"
}
```



---

archive/issue_comments_135640.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-19T13:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135640",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_135641.json:
```json
{
    "body": "<a id='comment:11'></a>On sage.math (Linux x86_64):\n\n```\nsage -t  -force_lib devel/sage/sage/tests/french_book/mpoly.py\n**********************************************************************\nFile \"/release/merger/sage-5.7.beta0/devel/sage-main/sage/tests/french_book/mpoly.py\", line 366:\n    sage: [CDF['x'](p(y=ys[0][0])).roots() for p in J.gens()]\nExpected:\n    [[(-0.6 - 1.30624...e-16*I, 1), (0.6 + 1.30624...e-16*I, 1)],\n    [(0.6 - 3.13499...e-16*I, 1), (2.6 + 3.13499...e-16*I, 1)]]\nGot:\n    [[(-0.6 - 1.30628991909e-16*I, 1), (0.6 + 1.30628991909e-16*I, 1)], [(0.6 - 3.13509580582e-16*I, 1), (2.6 + 3.13509580582e-16*I, 1)]]\n**********************************************************************\n```",
    "created_at": "2013-01-19T13:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135641",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>On sage.math (Linux x86_64):

```
sage -t  -force_lib devel/sage/sage/tests/french_book/mpoly.py
**********************************************************************
File "/release/merger/sage-5.7.beta0/devel/sage-main/sage/tests/french_book/mpoly.py", line 366:
    sage: [CDF['x'](p(y=ys[0][0])).roots() for p in J.gens()]
Expected:
    [[(-0.6 - 1.30624...e-16*I, 1), (0.6 + 1.30624...e-16*I, 1)],
    [(0.6 - 3.13499...e-16*I, 1), (2.6 + 3.13499...e-16*I, 1)]]
Got:
    [[(-0.6 - 1.30628991909e-16*I, 1), (0.6 + 1.30628991909e-16*I, 1)], [(0.6 - 3.13509580582e-16*I, 1), (2.6 + 3.13509580582e-16*I, 1)]]
**********************************************************************
```



---

archive/issue_comments_135642.json:
```json
{
    "body": "<a id='comment:12'></a>I am unable to reproduce the failure you get on sage.math (though I am working on Linux x86_64 too),  so I just reduced the number of digits taken into account in this test again.",
    "created_at": "2013-01-19T14:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135642",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:12'></a>I am unable to reproduce the failure you get on sage.math (though I am working on Linux x86_64 too),  so I just reduced the number of digits taken into account in this test again.



---

archive/issue_comments_135643.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-19T14:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135643",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-20T10:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135644",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135645.json:
```json
{
    "body": "<a id='comment:13'></a>I confirm that I ran the tests before giving the earlier positive review. It did work fine on my core i7-3615QM CPU running OS X 10.7.5...\n\nThe new patch also gets a positive review (the tests pass).",
    "created_at": "2013-01-20T10:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135645",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:13'></a>I confirm that I ran the tests before giving the earlier positive review. It did work fine on my core i7-3615QM CPU running OS X 10.7.5...

The new patch also gets a positive review (the tests pass).



---

archive/issue_comments_135646.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-21T14:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135646",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_135647.json:
```json
{
    "body": "<a id='comment:14'></a>On bsd (OS X 10.6 x86_64):\n\n```\nsage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py\n**********************************************************************\nFile \"/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.7.alpha1/devel/sage-main/sage/tests/french_book/mpoly.py\", line 373:\n    sage: J.variety(RDF)\nExpected:\n    [{y: 396340.89..., x: 26.61226...}]\nGot:\n    [{y: 396340.890167, x: -54.9445477048}]\n**********************************************************************\n```\n\nOn arando (Linux Ubuntu 12.04 i686):\n\n```\nsage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.alpha1/devel/sage-main/sage/tests/french_book/mpoly.py\", line 373:\n    sage: J.variety(RDF)\nExpected:\n    [{y: 396340.89..., x: 26.61226...}]\nGot:\n    [{y: 396340.890167, x: -46.7888621592}]\n**********************************************************************\n```",
    "created_at": "2013-01-21T14:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135647",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>On bsd (OS X 10.6 x86_64):

```
sage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py
**********************************************************************
File "/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.7.alpha1/devel/sage-main/sage/tests/french_book/mpoly.py", line 373:
    sage: J.variety(RDF)
Expected:
    [{y: 396340.89..., x: 26.61226...}]
Got:
    [{y: 396340.890167, x: -54.9445477048}]
**********************************************************************
```

On arando (Linux Ubuntu 12.04 i686):

```
sage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.7.alpha1/devel/sage-main/sage/tests/french_book/mpoly.py", line 373:
    sage: J.variety(RDF)
Expected:
    [{y: 396340.89..., x: 26.61226...}]
Got:
    [{y: 396340.890167, x: -46.7888621592}]
**********************************************************************
```



---

archive/issue_comments_135648.json:
```json
{
    "body": "<a id='comment:15'></a>I wonder why we get different results for `x`. If all computations are based on IEEE 754, we should get the same (wrong) value. Is it possible to know which components of Sage are used for `J.variety(RDF)` on each platform? On mine I get:\n\n```\nsage: get_systems('J.variety(RDF)')                          \n['MPFI', 'Singular', 'numpy', 'ginac']\n```\nSince MPFI is based on MPFR, MPFI should be architecture independent, but I wonder if the same applies to Singular, numpy and ginac...\n\nPaul",
    "created_at": "2013-01-21T15:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135648",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:15'></a>I wonder why we get different results for `x`. If all computations are based on IEEE 754, we should get the same (wrong) value. Is it possible to know which components of Sage are used for `J.variety(RDF)` on each platform? On mine I get:

```
sage: get_systems('J.variety(RDF)')                          
['MPFI', 'Singular', 'numpy', 'ginac']
```
Since MPFI is based on MPFR, MPFI should be architecture independent, but I wonder if the same applies to Singular, numpy and ginac...

Paul



---

archive/issue_comments_135649.json:
```json
{
    "body": "Attachment [trac_11672_doctests_from_french_book.patch](tarball://root/attachments/some-uuid/ticket11672/trac_11672_doctests_from_french_book.patch) by @mezzarobba created at 2013-01-21 16:20:53\n\nNew version (last draft of the book, Sage 5.5)",
    "created_at": "2013-01-21T16:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135649",
    "user": "https://github.com/mezzarobba"
}
```

Attachment [trac_11672_doctests_from_french_book.patch](tarball://root/attachments/some-uuid/ticket11672/trac_11672_doctests_from_french_book.patch) by @mezzarobba created at 2013-01-21 16:20:53

New version (last draft of the book, Sage 5.5)



---

archive/issue_comments_135650.json:
```json
{
    "body": "<a id='comment:16'></a>Paul: Could it be that whatever is used is compiled using extended precision on some platforms? Another strange thing, though, is that\n\n```\nsage: J.variety(Reals(p))\n[{y: -1.00000001350726, x: -1929.60019649825}, {y: -0.999999986492719, x: 1929.62017010095}, {y: 396340.890166545, x: 10.3009522157620}]\n```\nfinds 3 solutions for p as low as 39...\n\nAnyway, this test doesn't make much sense, I shouldn't have included this test in the first place. Here is a new version of the patch without that test. I took the opportunity to ignore the last few significant digits in another numerical result that might change a bit in the future.",
    "created_at": "2013-01-21T16:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135650",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>Paul: Could it be that whatever is used is compiled using extended precision on some platforms? Another strange thing, though, is that

```
sage: J.variety(Reals(p))
[{y: -1.00000001350726, x: -1929.60019649825}, {y: -0.999999986492719, x: 1929.62017010095}, {y: 396340.890166545, x: 10.3009522157620}]
```
finds 3 solutions for p as low as 39...

Anyway, this test doesn't make much sense, I shouldn't have included this test in the first place. Here is a new version of the patch without that test. I took the opportunity to ignore the last few significant digits in another numerical result that might change a bit in the future.



---

archive/issue_comments_135651.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-21T16:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135651",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135652.json:
```json
{
    "body": "<a id='comment:18'></a>> Paul: Could it be that whatever is used is compiled using extended precision on some platforms?\n\n\nyes, or with a different rounding precision. Anyway, it might be worth tracking down this issue. Jeroen, is there a way to trace the calls to the different Sage components (MPFI, Singular, numpy, ginac)?\n\nPaul",
    "created_at": "2013-01-21T16:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135652",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:18'></a>> Paul: Could it be that whatever is used is compiled using extended precision on some platforms?


yes, or with a different rounding precision. Anyway, it might be worth tracking down this issue. Jeroen, is there a way to trace the calls to the different Sage components (MPFI, Singular, numpy, ginac)?

Paul



---

archive/issue_comments_135653.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 mmezzarobba]:\n> Paul: Could it be that whatever is used is compiled using extended precision on some platforms? Another strange thing, though, is that\n> \n> ```\n> sage: J.variety(Reals(p))\n> [{y: -1.00000001350726, x: -1929.60019649825}, {y: -0.999999986492719, x: 1929.62017010095}, {y: 396340.890166545, x: 10.3009522157620}]\n> ```\n> finds 3 solutions for p as low as 39...\n> \n> Anyway, this test doesn't make much sense, I shouldn't have included this test in the first place. Here is a new version of the patch without that test. I took the opportunity to ignore the last few significant digits in another numerical result that might change a bit in the future.\n\n\nWell, the test obviously indicate that there is a problem somewhere, and I tend to believe that we should keep the test and track the problem.\n\nEither your computation is ill-conditioned, and the test should be removed from Sage (and probably also from the book), or there is a component of sage that misbehaves. We should understand what the situation is, and act accordingly. These tests have been there for 1.5 years, so we are not in a hurry.  Maybe we could compare intermediate results on different machines?",
    "created_at": "2013-01-21T16:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135653",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:19'></a>Replying to [comment:16 mmezzarobba]:
> Paul: Could it be that whatever is used is compiled using extended precision on some platforms? Another strange thing, though, is that
> 
> ```
> sage: J.variety(Reals(p))
> [{y: -1.00000001350726, x: -1929.60019649825}, {y: -0.999999986492719, x: 1929.62017010095}, {y: 396340.890166545, x: 10.3009522157620}]
> ```
> finds 3 solutions for p as low as 39...
> 
> Anyway, this test doesn't make much sense, I shouldn't have included this test in the first place. Here is a new version of the patch without that test. I took the opportunity to ignore the last few significant digits in another numerical result that might change a bit in the future.


Well, the test obviously indicate that there is a problem somewhere, and I tend to believe that we should keep the test and track the problem.

Either your computation is ill-conditioned, and the test should be removed from Sage (and probably also from the book), or there is a component of sage that misbehaves. We should understand what the situation is, and act accordingly. These tests have been there for 1.5 years, so we are not in a hurry.  Maybe we could compare intermediate results on different machines?



---

archive/issue_comments_135654.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 zimmerma]:\n> Jeroen, is there a way to trace the calls to the different Sage components (MPFI, Singular, numpy, ginac)?\n\nI don't think so.  You could of course use `gdb` and set suitable breakpoints...",
    "created_at": "2013-01-21T19:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135654",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:18 zimmerma]:
> Jeroen, is there a way to trace the calls to the different Sage components (MPFI, Singular, numpy, ginac)?

I don't think so.  You could of course use `gdb` and set suitable breakpoints...



---

archive/issue_comments_135655.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 Bouillaguet]:\n> Either your computation is ill-conditioned, and the test should be removed from Sage (and probably also from the book), or there is a component of sage that misbehaves. We should understand what the situation is, and act accordingly.\n\n\nSorry for the lack of context. Yes, the computation is ill-conditioned, that's deliberate (see http://purple.lateralis.org/sagebook-r1014.pdf, p. 210-211), and all three results above are completely wrong (the correct result is x=6.305...).\n\nAs Paul noted, in an ideal world, this code should nontheless yield the same result everywhere, so it might have made sense to test that the result didn't change over time. But there are a number of reasonable explanations for what we observe, and (as far as I can tell) in Sage, floating-point results are usually interpreted as mere approximations that should agree with the correct answer \"up to some numerical noise\" rather than well-defined exact results. So I am in favor of dropping this testcase\u2014unless the policy *is* that machine-precision floating-point computations should yield exactly the same result on all platforms.\n\n(Of course, this doesn't mean we shouldn't try to understand exactly what is going on!)",
    "created_at": "2013-01-21T19:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135655",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:21'></a>Replying to [comment:19 Bouillaguet]:
> Either your computation is ill-conditioned, and the test should be removed from Sage (and probably also from the book), or there is a component of sage that misbehaves. We should understand what the situation is, and act accordingly.


Sorry for the lack of context. Yes, the computation is ill-conditioned, that's deliberate (see http://purple.lateralis.org/sagebook-r1014.pdf, p. 210-211), and all three results above are completely wrong (the correct result is x=6.305...).

As Paul noted, in an ideal world, this code should nontheless yield the same result everywhere, so it might have made sense to test that the result didn't change over time. But there are a number of reasonable explanations for what we observe, and (as far as I can tell) in Sage, floating-point results are usually interpreted as mere approximations that should agree with the correct answer "up to some numerical noise" rather than well-defined exact results. So I am in favor of dropping this testcase—unless the policy *is* that machine-precision floating-point computations should yield exactly the same result on all platforms.

(Of course, this doesn't mean we shouldn't try to understand exactly what is going on!)



---

archive/issue_comments_135656.json:
```json
{
    "body": "<a id='comment:22'></a>Or, add\n\n```\nJ.variety(RDF)    # random\n```",
    "created_at": "2013-01-21T19:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135656",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Or, add

```
J.variety(RDF)    # random
```



---

archive/issue_comments_135657.json:
```json
{
    "body": "<a id='comment:23'></a>I have created #13980 to keep track of the numerical noise issue, so that we can make progress on this\nticket independently.\n\nPaul",
    "created_at": "2013-01-21T20:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135657",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:23'></a>I have created #13980 to keep track of the numerical noise issue, so that we can make progress on this
ticket independently.

Paul



---

archive/issue_comments_135658.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 jdemeyer]:\n\n> Or, add ` J.variety(RDF)    # random `\n\n\nIs that better? (Given that many examples from the book are already excluded from the tests for various reasons.) Please tell me if you would like me to update the test file.",
    "created_at": "2013-01-21T21:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135658",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:24'></a>Replying to [comment:22 jdemeyer]:

> Or, add ` J.variety(RDF)    # random `


Is that better? (Given that many examples from the book are already excluded from the tests for various reasons.) Please tell me if you would like me to update the test file.



---

archive/issue_comments_135659.json:
```json
{
    "body": "<a id='comment:25'></a>It was only a suggestion, do as you wish.",
    "created_at": "2013-01-21T21:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135659",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>It was only a suggestion, do as you wish.



---

archive/issue_comments_135660.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-26T11:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135660",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_030650.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-30T07:34:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11672#event-30650"
}
```



---

archive/issue_comments_135661.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-30T07:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11672",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11672#issuecomment-135661",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
