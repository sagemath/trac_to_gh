# Issue 11164: Integral of sin(x)/x gives false result.

archive/issues_011011.json:
```json
{
    "body": "\n```\n> eq = sin(x)/x\n> integrate(eq, x, -1e-6, 1e-6)\n-3.14159065359\n```\nI expected an answer of about 2e-6.\n\n**Keywords:** maxima, integration\n\n**Upstream:** Reported upstream. Developers acknowledge bug.\n\n**Stopgaps:** todo\n\n**Status:** needs_info\n\nIssue created by migration from https://trac.sagemath.org/ticket/11164\n\n",
    "created_at": "2011-04-09T20:05:30Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "title": "Integral of sin(x)/x gives false result.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11164",
    "user": "https://trac.sagemath.org/admin/accounts/users/benreynwar"
}
```

```
> eq = sin(x)/x
> integrate(eq, x, -1e-6, 1e-6)
-3.14159065359
```
I expected an answer of about 2e-6.

**Keywords:** maxima, integration

**Upstream:** Reported upstream. Developers acknowledge bug.

**Stopgaps:** todo

**Status:** needs_info

Issue created by migration from https://trac.sagemath.org/ticket/11164





---

archive/issue_comments_151264.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151264",
    "user": "https://github.com/kcrisman"
}
```

**Changing upstream** from "N/A" to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_151265.json:
```json
{
    "body": "**Assignee:** @burcin",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151265",
    "user": "https://github.com/kcrisman"
}
```

**Assignee:** @burcin



---

archive/issue_comments_151266.json:
```json
{
    "body": "<a id='comment:1'></a>\nIn the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.\n\nThere are two problems here.\n* The actual problem - the report unfortunately has a typo.\n\n```\nsage: integrate(eq,x,-1e-6,1e-6)\n-3.14159065359\n```\n   This is definitely a problem.  However, it's fixed in the latest Maxima.  Here is the old one, in Sage:\n\n```\nMaxima 5.22.1 http://maxima.sourceforge.net\nusing Lisp ECL 10.4.1\n<snip>\n(%i2) keepfloat:true;\n(%o2)                                true\n(%i3) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6)\n;\n(%o3)                         - 3.141590653589793\n```\n   And here is 5.24.0.  I assume this isn't a problem of which Lisp we are using?\n\n```\nMaxima 5.24.0 http://maxima.sourceforge.net\nusing Lisp SBCL 1.0.24\n(%i3) keepfloat:true;\n(%o3)                                true\n(%i8) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6);\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n                                 %i                                %i\n(%o8) %i gamma_incomplete(0, - -------) - %i gamma_incomplete(0, -------)\n                               1000000                           1000000\n```\n* A problem revealed, but also fixed in the latest.   Old:\n\n```\n(%i4) integrate(sin(x)/x,x,-1e-6,1e6);\n\nMaxima encountered a Lisp error:\n\n #<a FLOATING-POINT-OVERFLOW>\n\nAutomatically continuing.\nTo enable the Lisp debugger set *debugger-hook* to nil.\n\n```\n   New:\n\n```\n(%i10) integrate(sin(x)/x,x,-1e-6,1e6);\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced -1000000.0 by -1000000/1 = -1000000.0\n\nrat: replaced 1000000.0 by 1000000/1 = 1000000.0\n                                                                       %i\n                                              %i gamma_incomplete(0, -------)\n         %i gamma_incomplete(0, 1000000 %i)                          1000000\n(%o10) - ---------------------------------- - -------------------------------\n                         2                                   2\n                                  %i\n       %i gamma_incomplete(0, - -------)\n                                1000000    %i gamma_incomplete(0, - 1000000 %i)\n     + --------------------------------- + ------------------------------------\n                       2                                    2\n```\n\nWe'd need doctesting to test both of these once we upgrade Maxima.",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151266",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.

There are two problems here.
* The actual problem - the report unfortunately has a typo.

```
sage: integrate(eq,x,-1e-6,1e-6)
-3.14159065359
```
   This is definitely a problem.  However, it's fixed in the latest Maxima.  Here is the old one, in Sage:

```
Maxima 5.22.1 http://maxima.sourceforge.net
using Lisp ECL 10.4.1
<snip>
(%i2) keepfloat:true;
(%o2)                                true
(%i3) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6)
;
(%o3)                         - 3.141590653589793
```
   And here is 5.24.0.  I assume this isn't a problem of which Lisp we are using?

```
Maxima 5.24.0 http://maxima.sourceforge.net
using Lisp SBCL 1.0.24
(%i3) keepfloat:true;
(%o3)                                true
(%i8) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6);

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7
                                 %i                                %i
(%o8) %i gamma_incomplete(0, - -------) - %i gamma_incomplete(0, -------)
                               1000000                           1000000
```
* A problem revealed, but also fixed in the latest.   Old:

```
(%i4) integrate(sin(x)/x,x,-1e-6,1e6);

Maxima encountered a Lisp error:

 #<a FLOATING-POINT-OVERFLOW>

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.

```
   New:

```
(%i10) integrate(sin(x)/x,x,-1e-6,1e6);

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced -1000000.0 by -1000000/1 = -1000000.0

rat: replaced 1000000.0 by 1000000/1 = 1000000.0
                                                                       %i
                                              %i gamma_incomplete(0, -------)
         %i gamma_incomplete(0, 1000000 %i)                          1000000
(%o10) - ---------------------------------- - -------------------------------
                         2                                   2
                                  %i
       %i gamma_incomplete(0, - -------)
                                1000000    %i gamma_incomplete(0, - 1000000 %i)
     + --------------------------------- + ------------------------------------
                       2                                    2
```

We'd need doctesting to test both of these once we upgrade Maxima.



---

archive/issue_comments_151267.json:
```json
{
    "body": "add doctest to confirm fix",
    "created_at": "2011-12-15T05:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151267",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

add doctest to confirm fix



---

archive/issue_comments_151268.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-12-15T05:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151268",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Changing status** from new to needs_review.



---

archive/attachments_014634.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11164_verify_integration_sinx_x.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11164/trac_11164_verify_integration_sinx_x.patch",
    "created_at": "2011-12-15T05:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```



---

archive/issue_comments_151269.json:
```json
{
    "body": "<a id='comment:2'></a>\nMight as well doctest and close.",
    "created_at": "2011-12-15T05:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151269",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:2'></a>
Might as well doctest and close.



---

archive/issue_comments_151270.json:
```json
{
    "body": "<a id='comment:3'></a>\nI may have misstated whether this is \"fixed\". \n\n```\nsage: integrate(sin(x)/x,x,-1e-6,1e-6)\nI*Ei(-1/1000000*I) - I*Ei(1/1000000*I)\nsage: integrate(sin(x)/x,x,-1e-6,1e-6).n()\n3.14159465358979\nsage: numerical_integral(sin(x)/x,-1e-6,1e-6)\n(1.9999999999998889e-06, nan)\n```\nThe graph makes it very obvious the second (numerical) answer is correct.  Unsurprisingly, the other answer is off by exactly `pi`...\n\nPresumably the first answer is \"correct\" in the sense that it is an alternate representation of the `Si` sine integral function.  But I think there are some branch issues - `Ei(I*x)` only has an alternate formula for `x>0`.  \n\nSo we still need to do something with this.  Or at the very least warn about branches.  But really, `sin(x)/x` shouldn't have to worry about this!",
    "created_at": "2011-12-15T14:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151270",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
I may have misstated whether this is "fixed". 

```
sage: integrate(sin(x)/x,x,-1e-6,1e-6)
I*Ei(-1/1000000*I) - I*Ei(1/1000000*I)
sage: integrate(sin(x)/x,x,-1e-6,1e-6).n()
3.14159465358979
sage: numerical_integral(sin(x)/x,-1e-6,1e-6)
(1.9999999999998889e-06, nan)
```
The graph makes it very obvious the second (numerical) answer is correct.  Unsurprisingly, the other answer is off by exactly `pi`...

Presumably the first answer is "correct" in the sense that it is an alternate representation of the `Si` sine integral function.  But I think there are some branch issues - `Ei(I*x)` only has an alternate formula for `x>0`.  

So we still need to do something with this.  Or at the very least warn about branches.  But really, `sin(x)/x` shouldn't have to worry about this!



---

archive/issue_comments_151271.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-15T14:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151271",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_151272.json:
```json
{
    "body": "<a id='comment:4'></a>\nYou're right, of course.  It's silly to start with sin(x)/x and then generalize to something which doesn't reduce to the expected value, but far, far sillier to add a doctest enshrining the goofy behaviour as the expected. :^) \n\nDoes this work on the current maxima trunk now?",
    "created_at": "2011-12-15T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151272",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:4'></a>
You're right, of course.  It's silly to start with sin(x)/x and then generalize to something which doesn't reduce to the expected value, but far, far sillier to add a doctest enshrining the goofy behaviour as the expected. :^) 

Does this work on the current maxima trunk now?



---

archive/issue_comments_151273.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2011-12-15T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151273",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_151274.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is the previous version (5.25.1):\n\n```\n\n(%i5) integrate(sin(x)/x,x,-1/1000000,1/1000000);\n\n(%o5) %i*gamma_incomplete(0,-%i/1000000)-%i*gamma_incomplete(0,%i/1000000)\n\n```\nW|A agrees that this is about `-pi`.  (To be precise, `2*Si(1/10^6)-pi`.)  \n\n```\n\n(%i4) display2d:false;\n\n(%o4) false\n(%i5) integrate(sin(x)/x,x);\n\n(%o5) -(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\n```\nHere is the issue; this function may or may not be the same as the sine integral.  The problem seems to be that although Maxima has the sine integral (`expintegral_si`), it isn't really connected with the rest of Maxima (?).\n\nWhat do you think a good solution to this is?  I suppose we could open a ticket for it on the Maxima site, but I'm not sure whether the `Si` there is robust enough to handle all this yet.",
    "created_at": "2011-12-15T14:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151274",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
This is the previous version (5.25.1):

```

(%i5) integrate(sin(x)/x,x,-1/1000000,1/1000000);

(%o5) %i*gamma_incomplete(0,-%i/1000000)-%i*gamma_incomplete(0,%i/1000000)

```
W|A agrees that this is about `-pi`.  (To be precise, `2*Si(1/10^6)-pi`.)  

```

(%i4) display2d:false;

(%o4) false
(%i5) integrate(sin(x)/x,x);

(%o5) -(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
```
Here is the issue; this function may or may not be the same as the sine integral.  The problem seems to be that although Maxima has the sine integral (`expintegral_si`), it isn't really connected with the rest of Maxima (?).

What do you think a good solution to this is?  I suppose we could open a ticket for it on the Maxima site, but I'm not sure whether the `Si` there is robust enough to handle all this yet.



---

archive/issue_comments_151275.json:
```json
{
    "body": "<a id='comment:6'></a>\n> Here is the issue; this function may or may not be the same as the sine integral.  \n\nBy which I mean it isn't the same, of course, but also that (as defined) it isn't even always the same constant away.  Antiderivatives can differ by a constant, but when the constant is different depending on what `x` is, that's annoying.  I think the Maxima folks would say this is a feature (for symbolic reasons).",
    "created_at": "2011-12-15T14:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151275",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
> Here is the issue; this function may or may not be the same as the sine integral.  

By which I mean it isn't the same, of course, but also that (as defined) it isn't even always the same constant away.  Antiderivatives can differ by a constant, but when the constant is different depending on what `x` is, that's annoying.  I think the Maxima folks would say this is a feature (for symbolic reasons).



---

archive/issue_comments_151276.json:
```json
{
    "body": "<a id='comment:7'></a>\nBy the way, achrzesz has a great one-liner for [a related question](http://ask.sagemath.org/question/6/how-do-i-understand-the-result-of-symbolic):\n\n```\n maxima('integrate(diff((exp(x)-1)/x,x),x),gamma_expand:true,factor').sage()\n```\nThough here it doesn't solve the problem, but maybe it will trigger someone's memory as to another Maxima flag to set...\n\n```\nsage: maxima('integrate(sin(x)/x,x,-1/1000000,1/1000000),gamma_expand:true').sage()\nI*expintegral_ei(-1/1000000*I) - I*expintegral_ei(1/1000000*I) # currently not translated into Sage, but see #11143\nsage: a = I*Ei(-1/1000000*I)-I*Ei(1/1000000*I)\nsage: a.n()\n3.14159465358979\n```",
    "created_at": "2011-12-24T04:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151276",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
By the way, achrzesz has a great one-liner for [a related question](http://ask.sagemath.org/question/6/how-do-i-understand-the-result-of-symbolic):

```
 maxima('integrate(diff((exp(x)-1)/x,x),x),gamma_expand:true,factor').sage()
```
Though here it doesn't solve the problem, but maybe it will trigger someone's memory as to another Maxima flag to set...

```
sage: maxima('integrate(sin(x)/x,x,-1/1000000,1/1000000),gamma_expand:true').sage()
I*expintegral_ei(-1/1000000*I) - I*expintegral_ei(1/1000000*I) # currently not translated into Sage, but see #11143
sage: a = I*Ei(-1/1000000*I)-I*Ei(1/1000000*I)
sage: a.n()
3.14159465358979
```



---

archive/issue_comments_151277.json:
```json
{
    "body": "<a id='comment:8'></a>\nI wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...",
    "created_at": "2013-01-20T01:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151277",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>
I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...



---

archive/issue_comments_151278.json:
```json
{
    "body": "<a id='comment:9'></a>\n> I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...\n\nApparently not yet.",
    "created_at": "2013-06-26T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151278",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
> I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...

Apparently not yet.



---

archive/issue_comments_151279.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n \n ```\n > eq = sin(x)/x\n-> integrate(eq, x, -1e-6, 1e6)\n+> integrate(eq, x, -1e-6, 1e-6)\n -3.14159065359\n ```\n I expected an answer of about 2e-6.\n``````\n",
    "created_at": "2014-06-23T18:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151279",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 
 ```
 > eq = sin(x)/x
-> integrate(eq, x, -1e-6, 1e6)
+> integrate(eq, x, -1e-6, 1e-6)
 -3.14159065359
 ```
 I expected an answer of about 2e-6.
``````




---

archive/issue_comments_151280.json:
```json
{
    "body": "<a id='comment:10'></a>\nIn 6.3.beta4 (so with #13973), I get:\n\n```\nsage: eq = sin(x) / x\nsage: integrate(eq, x, -1e-6, 1e-6)\n-I*Ei(1/1000000*I) + I*Ei(-1/1000000*I)\nsage: _.n()\n3.14159465358979\nsage: integrate(eq, x, -1e-12, 1e-12)\n-I*Ei(1/1000000000000*I) + I*Ei(-1/1000000000000*I)\nsage: _.n()\n3.14159265359179\n```\nSomething bad happens with the integration computation when crossing over 0 as we have:\n\n```\nsage: integrate(eq, x, 1e-12, 1e-6)\n-1/2*I*Ei(1/1000000*I) + 1/2*I*Ei(1/1000000000000*I) - 1/2*I*Ei(-1/1000000000000*I) + 1/2*I*Ei(-1/1000000*I)\nsage: _.n()\n9.99999000050877e-7\n```",
    "created_at": "2014-06-23T18:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151280",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
In 6.3.beta4 (so with #13973), I get:

```
sage: eq = sin(x) / x
sage: integrate(eq, x, -1e-6, 1e-6)
-I*Ei(1/1000000*I) + I*Ei(-1/1000000*I)
sage: _.n()
3.14159465358979
sage: integrate(eq, x, -1e-12, 1e-12)
-I*Ei(1/1000000000000*I) + I*Ei(-1/1000000000000*I)
sage: _.n()
3.14159265359179
```
Something bad happens with the integration computation when crossing over 0 as we have:

```
sage: integrate(eq, x, 1e-12, 1e-6)
-1/2*I*Ei(1/1000000*I) + 1/2*I*Ei(1/1000000000000*I) - 1/2*I*Ei(-1/1000000000000*I) + 1/2*I*Ei(-1/1000000*I)
sage: _.n()
9.99999000050877e-7
```



---

archive/issue_comments_151281.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe problem is caused by the integral being computed via symbolic integration; see also [comment:5](#comment%3A5).  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.",
    "created_at": "2014-06-24T00:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151281",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:11'></a>
The problem is caused by the integral being computed via symbolic integration; see also [comment:5](#comment%3A5).  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.



---

archive/issue_comments_151282.json:
```json
{
    "body": "<a id='comment:12'></a>\n> The problem is caused by the integral being computed via symbolic integration; see also [comment:5](#comment%3A5).  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.\n\n\nHow much you wanna bet this is the same underlying problem as in #17328?",
    "created_at": "2014-11-14T21:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151282",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
> The problem is caused by the integral being computed via symbolic integration; see also [comment:5](#comment%3A5).  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.


How much you wanna bet this is the same underlying problem as in #17328?



---

archive/issue_comments_151283.json:
```json
{
    "body": "<a id='comment:13'></a>\n> How much you wanna bet this is the same underlying problem as in #17328?\n\nNah, I was thrown off by the gammas, I think.\n\nWhat if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?",
    "created_at": "2014-11-15T02:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151283",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
> How much you wanna bet this is the same underlying problem as in #17328?

Nah, I was thrown off by the gammas, I think.

What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?



---

archive/issue_comments_151284.json:
```json
{
    "body": "<a id='comment:14'></a>\n> What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\n\nLooks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).",
    "created_at": "2014-11-17T16:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151284",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
> What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?

Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).



---

archive/issue_comments_151285.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, in a later stable release.\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2014-11-17T16:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151285",
    "user": "https://github.com/kcrisman"
}
```

**Changing upstream** from "Fixed upstream, in a later stable release." to "Reported upstream. No feedback yet.".



---

archive/issue_comments_151286.json:
```json
{
    "body": "<a id='comment:15'></a>\n> > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\n\n> Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).\nOr maybe not; \n\n```\nsage: maxima('integrate(sin(x)/x,x)')\n-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\nsage: maxima('integrate(sin(x)/x,x), gamma_expand:true')\n-(%i*expintegral_ei(%i*x)-%i*expintegral_ei(-%i*x)+2*%pi)/2\n```\nso maybe we are already setting `gamma_expand:true` somewhere nowadays.  Reported upstream at https://sourceforge.net/p/maxima/bugs/2842/",
    "created_at": "2014-11-17T16:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151286",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
> > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?

> Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).
Or maybe not; 

```
sage: maxima('integrate(sin(x)/x,x)')
-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
sage: maxima('integrate(sin(x)/x,x), gamma_expand:true')
-(%i*expintegral_ei(%i*x)-%i*expintegral_ei(-%i*x)+2*%pi)/2
```
so maybe we are already setting `gamma_expand:true` somewhere nowadays.  Reported upstream at https://sourceforge.net/p/maxima/bugs/2842/



---

archive/issue_comments_151287.json:
```json
{
    "body": "<a id='comment:16'></a>\nSee also the documentation for [gamma_expand](http://maxima.sourceforge.net/docs/manual/maxima_15.html#Item_003a-gamma_005fexpand).  The [changelog says](http://www.walkingrandomly.com/images/maxima/ChangeLog-5.17-special-functions.txt)\n\n```\n\nImplementation of the Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete(a,z)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for gamma_incomplete(a,0) and gamma_incomplete(a,inf)\n - When $gamma_expand T expand the following expressions:\n   gamma_incomplete(0,z)\n   gamma_incomplete(n+1/2)\n   gamma_incomplete(1/2-n)\n   gamma_incomplete(n,z)\n   gamma_incomplete(-n,z)\n   gamma_incomplete(a+n,z)\n   gamma_incomplete(a-n,z)\n - Mirror symmetry\n - Derivative wrt the arguments a and z\n\n--------------------------------------------------------------------------------\nImplementation of the Generalized Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete_generalized(a,z1,z2)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for:\n   gamma_incomplete_generalized(a,z1,0)\n   gamma_incomplete_generalized(a,0,z2),\n   gamma_incomplete_generalized(a,z1,inf)\n   gamma_incomplete_generalized(a,inf,z2)\n   gamma_incomplete_generalized(a,0,inf)\n   gamma_incomplete_generalized(a,x,x)\n - When $gamma_expand T and n an integer expand\n   gamma_incomplete_generalized(a+n,z1,z2)\n - Implementation of Mirror symmetry\n - Derivative wrt the arguments a, z1 and z2\n\n--------------------------------------------------------------------------------\nImplementation of the Regularized Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete_regularized(a,z)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for:\n   gamma_incomplete_regularized(a,0)\n   gamma_incomplete_regularized(0,z)\n   gamma_incomplete_regularized(a,inf)\n - When $gamma_expand T and n a positive integer expansions for\n   gamma_incomplete_regularized(n+1/2,z)\n   gamma_incomplete_regularized(1/2-n,z)\n   gamma_incomplete_regularized(n,z)\n   gamma_incomplete_regularized(a+n,z)\n   gamma_incomplete_regularized(a-n,z)\n - Derivative wrt the arguments a and z\n - Implementation of Mirror symmetry\n\n```",
    "created_at": "2014-11-17T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151287",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
See also the documentation for [gamma_expand](http://maxima.sourceforge.net/docs/manual/maxima_15.html#Item_003a-gamma_005fexpand).  The [changelog says](http://www.walkingrandomly.com/images/maxima/ChangeLog-5.17-special-functions.txt)

```

Implementation of the Incomplete Gamma function

 New Maxima User function: gamma_incomplete(a,z)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for gamma_incomplete(a,0) and gamma_incomplete(a,inf)
 - When $gamma_expand T expand the following expressions:
   gamma_incomplete(0,z)
   gamma_incomplete(n+1/2)
   gamma_incomplete(1/2-n)
   gamma_incomplete(n,z)
   gamma_incomplete(-n,z)
   gamma_incomplete(a+n,z)
   gamma_incomplete(a-n,z)
 - Mirror symmetry
 - Derivative wrt the arguments a and z

--------------------------------------------------------------------------------
Implementation of the Generalized Incomplete Gamma function

 New Maxima User function: gamma_incomplete_generalized(a,z1,z2)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for:
   gamma_incomplete_generalized(a,z1,0)
   gamma_incomplete_generalized(a,0,z2),
   gamma_incomplete_generalized(a,z1,inf)
   gamma_incomplete_generalized(a,inf,z2)
   gamma_incomplete_generalized(a,0,inf)
   gamma_incomplete_generalized(a,x,x)
 - When $gamma_expand T and n an integer expand
   gamma_incomplete_generalized(a+n,z1,z2)
 - Implementation of Mirror symmetry
 - Derivative wrt the arguments a, z1 and z2

--------------------------------------------------------------------------------
Implementation of the Regularized Incomplete Gamma function

 New Maxima User function: gamma_incomplete_regularized(a,z)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for:
   gamma_incomplete_regularized(a,0)
   gamma_incomplete_regularized(0,z)
   gamma_incomplete_regularized(a,inf)
 - When $gamma_expand T and n a positive integer expansions for
   gamma_incomplete_regularized(n+1/2,z)
   gamma_incomplete_regularized(1/2-n,z)
   gamma_incomplete_regularized(n,z)
   gamma_incomplete_regularized(a+n,z)
   gamma_incomplete_regularized(a-n,z)
 - Derivative wrt the arguments a and z
 - Implementation of Mirror symmetry

```



---

archive/issue_comments_151288.json:
```json
{
    "body": "<a id='comment:17'></a>\n> > > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\n\n> > Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).\n> Or maybe not; \nDrivel.  We could try this, though the branch problem is likely still there with incomplete gamma.\n\n```\nsage: maxima_calculus('integrate(sin(x)/x,x)')\n-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\nsage: maxima_calculus('integrate(sin(x)/x,x)').sage()\n-1/2*I*Ei(I*x) + 1/2*I*Ei(-I*x)\n```\nbecause we do\n\n```\n        if x == 0:\n            return -Ei(-y)\n```\nin sage/functions/other.py\n\nBut unfortunately\n\n```\nsage: i*CC(0).gamma_inc(-i/100000)-i*CC(0).gamma_inc(i/100000)\n-3.14157265358979\n```\nSo same problem there.  Yuck.  We really need Maxima to provide a proper `Si` function, or somehow magically translate such combos ourselves with pattern-matching, which sounds horrible too.",
    "created_at": "2014-11-17T17:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151288",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:17'></a>
> > > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?

> > Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).
> Or maybe not; 
Drivel.  We could try this, though the branch problem is likely still there with incomplete gamma.

```
sage: maxima_calculus('integrate(sin(x)/x,x)')
-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
sage: maxima_calculus('integrate(sin(x)/x,x)').sage()
-1/2*I*Ei(I*x) + 1/2*I*Ei(-I*x)
```
because we do

```
        if x == 0:
            return -Ei(-y)
```
in sage/functions/other.py

But unfortunately

```
sage: i*CC(0).gamma_inc(-i/100000)-i*CC(0).gamma_inc(i/100000)
-3.14157265358979
```
So same problem there.  Yuck.  We really need Maxima to provide a proper `Si` function, or somehow magically translate such combos ourselves with pattern-matching, which sounds horrible too.



---

archive/issue_comments_151289.json:
```json
{
    "body": "**Stopgaps:** todo",
    "created_at": "2015-08-25T15:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151289",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

**Stopgaps:** todo



---

archive/issue_comments_151290.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jakobkroeker](#comment%3A17):\n> We really need Maxima to provide a proper `Si` function\n\nMaxima has provided a proper Si function for a while called `expintegral_si(x)` which seems to fit the bill. Maxima doesn't seem to use it though, and the behavior you described still occurs:\n\n`sage: maxima_calculus('integrate(sin(x)/x,x)')`\n`-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2`\n\nEdit: upstream said this would be fixed [here](https://sourceforge.net/p/maxima/bugs/3079/#94bd) in 2016.",
    "created_at": "2019-07-20T16:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151290",
    "user": "https://github.com/JohnScott623"
}
```

<a id='comment:19'></a>
Replying to [jakobkroeker](#comment%3A17):
> We really need Maxima to provide a proper `Si` function

Maxima has provided a proper Si function for a while called `expintegral_si(x)` which seems to fit the bill. Maxima doesn't seem to use it though, and the behavior you described still occurs:

`sage: maxima_calculus('integrate(sin(x)/x,x)')`
`-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2`

Edit: upstream said this would be fixed [here](https://sourceforge.net/p/maxima/bugs/3079/#94bd) in 2016.



---

archive/issue_comments_151291.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"maxima\".",
    "created_at": "2019-07-21T06:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151291",
    "user": "https://github.com/mwageringel"
}
```

**Changing keywords** from "" to "maxima".



---

archive/issue_comments_151292.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2019-07-21T06:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151292",
    "user": "https://github.com/mwageringel"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_151293.json:
```json
{
    "body": "**Remove assignee** @burcin.",
    "created_at": "2019-08-01T13:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151293",
    "user": "https://github.com/JohnScott623"
}
```

**Remove assignee** @burcin.



---

archive/issue_comments_151294.json:
```json
{
    "body": "**Changing keywords** from \"maxima\" to \"maxima, integration\".",
    "created_at": "2019-08-24T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151294",
    "user": "https://github.com/fchapoton"
}
```

**Changing keywords** from "maxima" to "maxima, integration".



---

archive/issue_comments_151295.json:
```json
{
    "body": "<a id='comment:23'></a>\nSimilar bug (regression after upgrade to Maxima 5.44.0): #30389",
    "created_at": "2020-08-20T06:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11164#issuecomment-151295",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:23'></a>
Similar bug (regression after upgrade to Maxima 5.44.0): #30389
