# Issue 11062: Fractional ideal class double exponentiation fails

archive/issues_011062.json:
```json
{
    "body": "Assignee: @loefflerd\n\nKeywords: pari class group\n\n```\nsage: k.<a> = NumberField(x^2 + 20072); G = k.class_group(); (G.0^2)^2\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/usr/local/src/sage-4.7.alpha4/<ipython console> in <module>()\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/number_field/class_group.pyc in __pow__(self, n)\n    302         # we go along; actually computing self.__ideal ** n would\n    303         # be disastrous.\n--> 304         n = n % self.order()\n    305         return MonoidElement.__pow__(self, n)\n    306\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/number_field/class_group.pyc in order(self)\n    392         \"\"\"\n    393         # an old method with a new docstring\n--> 394         return AbelianGroupElement.order(self)\n    395\n    396     def multiplicative_order(self):\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/groups/abelian_gps/abelian_group_element.pyc in order(self)\n    304             return o\n    305         L = list(self.list())\n--> 306         N = LCM([invs[i]//GCD(invs[i],L[i]) for i in range(len(invs)) if L[i]!=0])\n    307         if N == 0:\n    308             return infinity\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:12659)()\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:19135)()\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:19033)()\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6498)()\n\n/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6436)()\n\nTypeError: unsupported operand type(s) for //: 'sage.libs.pari.gen.gen' and 'sage.libs.pari.gen.gen'\n```\n\nBoth patches should be applied.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11234\n\n",
    "closed_at": "2011-04-26T09:06:48Z",
    "created_at": "2011-04-21T20:07:37Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "Fractional ideal class double exponentiation fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11062",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: @loefflerd

Keywords: pari class group

```
sage: k.<a> = NumberField(x^2 + 20072); G = k.class_group(); (G.0^2)^2
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/usr/local/src/sage-4.7.alpha4/<ipython console> in <module>()

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/number_field/class_group.pyc in __pow__(self, n)
    302         # we go along; actually computing self.__ideal ** n would
    303         # be disastrous.
--> 304         n = n % self.order()
    305         return MonoidElement.__pow__(self, n)
    306

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/number_field/class_group.pyc in order(self)
    392         """
    393         # an old method with a new docstring
--> 394         return AbelianGroupElement.order(self)
    395
    396     def multiplicative_order(self):

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/groups/abelian_gps/abelian_group_element.pyc in order(self)
    304             return o
    305         L = list(self.list())
--> 306         N = LCM([invs[i]//GCD(invs[i],L[i]) for i in range(len(invs)) if L[i]!=0])
    307         if N == 0:
    308             return infinity

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:12659)()

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:19135)()

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:19033)()

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6498)()

/usr/local/src/sage-4.7.alpha4/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6436)()

TypeError: unsupported operand type(s) for //: 'sage.libs.pari.gen.gen' and 'sage.libs.pari.gen.gen'
```

Both patches should be applied.

Issue created by migration from https://trac.sagemath.org/ticket/11234





---

archive/issue_comments_120404.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-24T09:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120404",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120405.json:
```json
{
    "body": "Attachment [trac_11234_ideal_class_order.patch](tarball://root/attachments/some-uuid/ticket11234/trac_11234_ideal_class_order.patch) by fwclarke created at 2011-04-24 09:49:23\n\nThe root cause of this defect is that the coordinates of class group elements were Pari integers.\u00a0\n\nThe problem wasn't detected before because only generators were tested in the doctests for `sage.rings.number_field.class_group.FractionalIdealClass.order` .\n\nThe attached patch fixes the problem and alters one doctest.",
    "created_at": "2011-04-24T09:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120405",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Attachment [trac_11234_ideal_class_order.patch](tarball://root/attachments/some-uuid/ticket11234/trac_11234_ideal_class_order.patch) by fwclarke created at 2011-04-24 09:49:23

The root cause of this defect is that the coordinates of class group elements were Pari integers. 

The problem wasn't detected before because only generators were tested in the doctests for `sage.rings.number_field.class_group.FractionalIdealClass.order` .

The attached patch fixes the problem and alters one doctest.



---

archive/issue_comments_120406.json:
```json
{
    "body": "Replying to [comment:2 fwclarke]:\n> The root cause of this defect is that the coordinates of class group elements were Pari integers.\u00a0\n> \n> The problem wasn't detected before because only generators were tested in the doctests for `sage.rings.number_field.class_group.FractionalIdealClass.order` .\n> \n> The attached patch fixes the problem and alters one doctest.\n\n\nThanks, I will test it.  However, you should add a doctest to show that the problem from this ticket is fixed (so needs_work for this reason).",
    "created_at": "2011-04-24T19:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120406",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 fwclarke]:
> The root cause of this defect is that the coordinates of class group elements were Pari integers. 
> 
> The problem wasn't detected before because only generators were tested in the doctests for `sage.rings.number_field.class_group.FractionalIdealClass.order` .
> 
> The attached patch fixes the problem and alters one doctest.


Thanks, I will test it.  However, you should add a doctest to show that the problem from this ticket is fixed (so needs_work for this reason).



---

archive/issue_comments_120407.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-24T19:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120407",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120408.json:
```json
{
    "body": "Attachment [trac_11234_extra_doctest.patch](tarball://root/attachments/some-uuid/ticket11234/trac_11234_extra_doctest.patch) by fwclarke created at 2011-04-25 09:15:48\n\nApply both patches",
    "created_at": "2011-04-25T09:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120408",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Attachment [trac_11234_extra_doctest.patch](tarball://root/attachments/some-uuid/ticket11234/trac_11234_extra_doctest.patch) by fwclarke created at 2011-04-25 09:15:48

Apply both patches



---

archive/issue_comments_120409.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n>  you should add a doctest to show that the problem from this ticket is fixed.\n\n\nDone.  All the previous tests only took powers of a generator.",
    "created_at": "2011-04-25T09:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120409",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Replying to [comment:3 jdemeyer]:
>  you should add a doctest to show that the problem from this ticket is fixed.


Done.  All the previous tests only took powers of a generator.



---

archive/issue_comments_120410.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-25T09:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120410",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120411.json:
```json
{
    "body": "Looks good!  Patch makes sense and fixes the problem.",
    "created_at": "2011-04-25T10:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120411",
    "user": "https://github.com/jdemeyer"
}
```

Looks good!  Patch makes sense and fixes the problem.



---

archive/issue_comments_120412.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-25T10:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120412",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120413.json:
```json
{
    "body": "I also tested the patch (after #11230 and on the way to #11130) and everything tested fine.",
    "created_at": "2011-04-25T13:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120413",
    "user": "https://github.com/JohnCremona"
}
```

I also tested the patch (after #11230 and on the way to #11130) and everything tested fine.



---

archive/issue_events_029091.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-26T09:06:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11062#event-29091"
}
```



---

archive/issue_comments_120414.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-26T09:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11062#issuecomment-120414",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
