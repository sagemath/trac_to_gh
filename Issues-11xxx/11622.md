# Issue 11622: Add some targets to the top-level Makefile

archive/issues_011450.json:
```json
{
    "body": "This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.\n\nThere are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):\n* `build-check`, perhaps also `all-check`, as an \"alias\" for\n\n```sh\nenv SAGE_CHECK=yes make build\n```\n* `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n* similar things for `doc` and `all`\n\nAssignee: @nexttime\n\nCC:  @kiwifb @jdemeyer @jhpalmieri\n\nKeywords: make upgrade documentation rebuild parallel sequential SAGE_CHECK SAGE_PARALLEL_SPKG_BUILD\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/11622\n\n",
    "closed_at": "2021-09-02T18:48:47Z",
    "created_at": "2011-07-24T21:56:36Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Add some targets to the top-level Makefile",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11622",
    "user": "https://github.com/nexttime"
}
```
This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.

There are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):
* `build-check`, perhaps also `all-check`, as an "alias" for

```sh
env SAGE_CHECK=yes make build
```
* `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
* similar things for `doc` and `all`

Assignee: @nexttime

CC:  @kiwifb @jdemeyer @jhpalmieri

Keywords: make upgrade documentation rebuild parallel sequential SAGE_CHECK SAGE_PARALLEL_SPKG_BUILD

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/11622





---

archive/issue_comments_127620.json:
```json
{
    "body": "<a id='comment:3'></a>There are some changes to the top-level `Makefile` at #11969, needs_review.",
    "created_at": "2011-11-04T09:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127620",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>There are some changes to the top-level `Makefile` at #11969, needs_review.



---

archive/issue_events_030487.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30487"
}
```



---

archive/issue_events_030488.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30488"
}
```



---

archive/issue_events_030489.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30489"
}
```



---

archive/issue_events_030490.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30490"
}
```



---

archive/issue_events_030491.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30491"
}
```



---

archive/issue_events_030492.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30492"
}
```



---

archive/issue_events_030493.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30493"
}
```



---

archive/issue_events_030494.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-16T08:26:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30494"
}
```



---

archive/issue_events_030495.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-16T08:26:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30495"
}
```



---

archive/issue_comments_127621.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n>  * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)\n \nWe don't have `SAGE_CHECK=ignore` yet, so this isn't applicable.\n\n>  * `build-sequential` in case we one day default to a parallel build\n \nWell, we don't build in parallel by default.\n\n>  * perhaps `library` as an alias for `./sage -b`\n \nVery bad idea. We shouldn't encourage `./sage -b`, just run `make` or `make build` or `make sagelib` if needed.",
    "created_at": "2015-09-16T08:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127621",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
>  * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)
 
We don't have `SAGE_CHECK=ignore` yet, so this isn't applicable.

>  * `build-sequential` in case we one day default to a parallel build
 
Well, we don't build in parallel by default.

>  * perhaps `library` as an alias for `./sage -b`
 
Very bad idea. We shouldn't encourage `./sage -b`, just run `make` or `make build` or `make sagelib` if needed.



---

archive/issue_comments_127622.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n>  It's perhaps discussable whether we should do that in *all* test receipts\n\nIt is done in all test targets.",
    "created_at": "2015-09-16T08:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127622",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
>  It's perhaps discussable whether we should do that in *all* test receipts

It is done in all test targets.



---

archive/issue_comments_127623.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n>  * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:\n>    * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an \"unlimited\" number of jobs, it uses twice the number of hardware threads.) \n\n\n>      One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.\n\n>    * It complains about an *\"impossibly large number of threads\"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.\n\nNeither of this is still true.",
    "created_at": "2015-09-16T08:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127623",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
>  * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:
>    * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an "unlimited" number of jobs, it uses twice the number of hardware threads.) 


>      One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.

>    * It complains about an *"impossibly large number of threads"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.

Neither of this is still true.



---

archive/issue_comments_127624.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n> it is possible to set all environment variables in `build/make/Makefile` itself.\n\nI don't think so (or at least, I don't know how to do it). In any case, I don't see the point of *repeating* all environment variables in `build/make/Makefile`, what's wrong with keeping the use of `sage-env`?",
    "created_at": "2015-09-16T08:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127624",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
> it is possible to set all environment variables in `build/make/Makefile` itself.

I don't think so (or at least, I don't know how to do it). In any case, I don't see the point of *repeating* all environment variables in `build/make/Makefile`, what's wrong with keeping the use of `sage-env`?



---

archive/issue_comments_127625.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n>  * `build-sequential` in case we one day default to a parallel build\n \nWe still don't do that by default.",
    "created_at": "2015-09-16T08:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127625",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
>  * `build-sequential` in case we one day default to a parallel build
 
We still don't do that by default.



---

archive/issue_comments_127626.json:
```json
{
    "body": "<a id='comment:17'></a>I propose to use `pbuild` and `pall` as target names, by analogy to `ptest(long)`.\n\nI don't see the need for a target `pdoc` (I never need to run `make doc`, I just run `make` which is mostly the same anyway).",
    "created_at": "2015-09-16T08:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127626",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>I propose to use `pbuild` and `pall` as target names, by analogy to `ptest(long)`.

I don't see the need for a target `pdoc` (I never need to run `make doc`, I just run `make` which is mostly the same anyway).



---

archive/issue_events_030496.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30496"
}
```



---

archive/issue_events_030497.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30497"
}
```



---

archive/issue_comments_127627.json:
```json
{
    "body": "<a id='comment:18'></a>Outdated, should close",
    "created_at": "2021-08-26T19:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127627",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Outdated, should close



---

archive/issue_comments_127628.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-26T19:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127628",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127629.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-26T21:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127629",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127630.json:
```json
{
    "body": "<a id='comment:19'></a>There might be something with some validity here, but we can always open a new ticket with a more clear focus.",
    "created_at": "2021-08-26T21:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127630",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>There might be something with some validity here, but we can always open a new ticket with a more clear focus.



---

archive/issue_events_030498.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T18:48:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11622#event-30498"
}
```



---

archive/issue_comments_127631.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-09-02T18:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11622#issuecomment-127631",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
