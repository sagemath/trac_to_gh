# Issue 11622: Add some targets to the top-level Makefile

archive/issues_011450.json:
```json
{
    "assignees": [
        "https://github.com/nexttime"
    ],
    "body": "This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.\n\nThere are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):\n* `build-check`, perhaps also `all-check`, as an \"alias\" for\n\n```sh\nenv SAGE_CHECK=yes make build\n```\n* `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n* similar things for `doc` and `all`\n\nCC:  @kiwifb @jdemeyer @jhpalmieri\n\nKeywords: **make upgrade documentation rebuild parallel sequential SAGE_CHECK SAGE_PARALLEL_SPKG_BUILD**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11622_\n\n",
    "closed_at": "2021-09-02T18:48:47Z",
    "created_at": "2011-07-24T21:56:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add some targets to the top-level Makefile",
    "type": "issue",
    "updated_at": "2021-09-02T18:48:47Z",
    "url": "https://github.com/sagemath/sage/issues/11622",
    "user": "https://github.com/nexttime"
}
```
This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.

There are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):
* `build-check`, perhaps also `all-check`, as an "alias" for

```sh
env SAGE_CHECK=yes make build
```
* `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
* similar things for `doc` and `all`

CC:  @kiwifb @jdemeyer @jhpalmieri

Keywords: **make upgrade documentation rebuild parallel sequential SAGE_CHECK SAGE_PARALLEL_SPKG_BUILD**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/11622_





---

archive/issue_events_156348.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156348"
}
```



---

archive/issue_events_156349.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156349"
}
```



---

archive/issue_events_156350.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156350"
}
```



---

archive/issue_events_156351.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156351"
}
```



---

archive/issue_events_156352.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156352"
}
```



---

archive/issue_events_156353.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-24T21:56:36Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156353"
}
```



---

archive/issue_comments_119569.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,7 +14,9 @@\n ```\n * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)\n * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n-* `build-sequential` in case we one day default to a parallel build\n+* `build-sequential` in case we one day default to a parallel build \n+\n+  **Note:** #11959 now enables parallel spkg building by default, and adds a target `build-serial`.\n * similar things for `doc` (see below) and `all`\n * perhaps `library` as an alias for `./sage -b`\n * ...\n``````\n",
    "created_at": "2011-11-04T00:04:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119569",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,7 +14,9 @@
 ```
 * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)
 * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
-* `build-sequential` in case we one day default to a parallel build
+* `build-sequential` in case we one day default to a parallel build 
+
+  **Note:** #11959 now enables parallel spkg building by default, and adds a target `build-serial`.
 * similar things for `doc` (see below) and `all`
 * perhaps `library` as an alias for `./sage -b`
 * ...
``````




---

archive/issue_comments_119570.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -58,7 +58,10 @@\n     time make -f standard/deps $1\n fi\n ```\n- So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately.\n+ So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately. \n+\n+\n+   **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.\n \n \n * The sequence top-level Makefile (`make`) -> `spkg/install` (shell script) -> `spkg/standard/deps`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `spkg/standard/deps` (ill name for a Makefile that isn't included by another one) itself. \n``````\n",
    "created_at": "2011-11-04T00:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119570",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -58,7 +58,10 @@
     time make -f standard/deps $1
 fi
 ```
- So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately.
+ So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately. 
+
+
+   **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.
 
 
 * The sequence top-level Makefile (`make`) -> `spkg/install` (shell script) -> `spkg/standard/deps`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `spkg/standard/deps` (ill name for a Makefile that isn't included by another one) itself. 
``````




---

archive/issue_comments_119571.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThere are some changes to the top-level `Makefile` at #11969, needs_review.",
    "created_at": "2011-11-04T09:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119571",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

There are some changes to the top-level `Makefile` at #11969, needs_review.



---

archive/issue_events_156354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156354"
}
```



---

archive/issue_events_156355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156355"
}
```



---

archive/issue_events_156356.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156356"
}
```



---

archive/issue_events_156357.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156357"
}
```



---

archive/issue_events_156358.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156358"
}
```



---

archive/issue_events_156359.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156359"
}
```



---

archive/issue_events_156360.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156360"
}
```



---

archive/issue_events_156361.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156361"
}
```



---

archive/issue_events_156362.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-16T08:26:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156362"
}
```



---

archive/issue_events_156363.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-16T08:26:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156363"
}
```



---

archive/issue_comments_119572.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,6 @@\n This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.\n \n There are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):\n-* `rebuild` as a short-cut (or, more precisely, the user interface) to the currently (intentionally) undocumented\n-\n-```sh\n-env SAGE_UPGRADING=yes make build\n-```\n-   which builds new / updated spkgs copied to `spkg/standard/` and also forces the rebuild of all dependent packages.\n * `build-check`, perhaps also `all-check`, as an \"alias\" for\n \n ```sh\n``````\n",
    "created_at": "2015-09-16T08:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119572",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,6 @@
 This perhaps just gets a meta-ticket to collect various additions (or changes), to be discussed and implemented on their own tickets.
 
 There are a few things I would like to have a `make` target for, partially just for convenience (at the moment random choice / incomplete, random order):
-* `rebuild` as a short-cut (or, more precisely, the user interface) to the currently (intentionally) undocumented
-
-```sh
-env SAGE_UPGRADING=yes make build
-```
-   which builds new / updated spkgs copied to `spkg/standard/` and also forces the rebuild of all dependent packages.
 * `build-check`, perhaps also `all-check`, as an "alias" for
 
 ```sh
``````




---

archive/issue_comments_119573.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n> * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)\n\nWe don't have `SAGE_CHECK=ignore` yet, so this isn't applicable.\n\n> * `build-sequential` in case we one day default to a parallel build\n\nWell, we don't build in parallel by default.\n\n> * perhaps `library` as an alias for `./sage -b`\n\nVery bad idea. We shouldn't encourage `./sage -b`, just run `make` or `make build` or `make sagelib` if needed.",
    "created_at": "2015-09-16T08:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119573",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
> * `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)

We don't have `SAGE_CHECK=ignore` yet, so this isn't applicable.

> * `build-sequential` in case we one day default to a parallel build

Well, we don't build in parallel by default.

> * perhaps `library` as an alias for `./sage -b`

Very bad idea. We shouldn't encourage `./sage -b`, just run `make` or `make build` or `make sagelib` if needed.



---

archive/issue_comments_119574.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,18 +6,9 @@\n ```sh\n env SAGE_CHECK=yes make build\n ```\n-* `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)\n * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n-* `build-sequential` in case we one day default to a parallel build \n-\n-  **Note:** #11959 now enables parallel spkg building by default, and adds a target `build-serial`.\n+* `build-sequential` in case we one day default to a parallel build\n * similar things for `doc` (see below) and `all`\n-* perhaps `library` as an alias for `./sage -b`\n-* ...\n-\n-I could imagine to also have\n-* different targets to build the documentation sequentially or in parallel (cf. #6495),\n-* ...\n \n **Please add further suggestions (and the tickets implementing them).**\n \n``````\n",
    "created_at": "2015-09-16T08:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119574",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,18 +6,9 @@
 ```sh
 env SAGE_CHECK=yes make build
 ```
-* `build-check-ignore` once we support `SAGE_CHECK=ignore` to (build and) run all test suites without treating failed tests as fatal errors (since e.g. the Python test suite fails on many systems)
 * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
-* `build-sequential` in case we one day default to a parallel build 
-
-  **Note:** #11959 now enables parallel spkg building by default, and adds a target `build-serial`.
+* `build-sequential` in case we one day default to a parallel build
 * similar things for `doc` (see below) and `all`
-* perhaps `library` as an alias for `./sage -b`
-* ...
-
-I could imagine to also have
-* different targets to build the documentation sequentially or in parallel (cf. #6495),
-* ...
 
 **Please add further suggestions (and the tickets implementing them).**
 
``````




---

archive/issue_comments_119575.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n>  It's perhaps discussable whether we should do that in *all* test receipts\n\nIt is done in all test targets.",
    "created_at": "2015-09-16T08:32:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119575",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
>  It's perhaps discussable whether we should do that in *all* test receipts

It is done in all test targets.



---

archive/issue_comments_119576.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,9 +15,6 @@\n ---\n \n Related:\n-\n-* As of Sage 4.7.1.rc0, running `./sage -b` before running tests is currently not performed consistently. It's perhaps discussable whether we should do that in *all* test receipts or none of them, or provide *separate* targets which do that (which is a trivial task except for the choice of names).\n-\n \n * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:\n   * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an \"unlimited\" number of jobs, it uses twice the number of hardware threads.) \n``````\n",
    "created_at": "2015-09-16T08:32:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119576",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,9 +15,6 @@
 ---
 
 Related:
-
-* As of Sage 4.7.1.rc0, running `./sage -b` before running tests is currently not performed consistently. It's perhaps discussable whether we should do that in *all* test receipts or none of them, or provide *separate* targets which do that (which is a trivial task except for the choice of names).
-
 
 * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:
   * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an "unlimited" number of jobs, it uses twice the number of hardware threads.) 
``````




---

archive/issue_comments_119577.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n> * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:\n>   * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an \"unlimited\" number of jobs, it uses twice the number of hardware threads.) \n\n>     One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.\n>   * It complains about an *\"impossibly large number of threads\"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.\n\nNeither of this is still true.",
    "created_at": "2015-09-16T08:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119577",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
> * The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:
>   * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an "unlimited" number of jobs, it uses twice the number of hardware threads.) 

>     One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.
>   * It complains about an *"impossibly large number of threads"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.

Neither of this is still true.



---

archive/issue_comments_119578.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,13 +15,6 @@\n ---\n \n Related:\n-\n-* The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:\n-  * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an \"unlimited\" number of jobs, it uses twice the number of hardware threads.) \n-\n-    One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.\n-  * It complains about an *\"impossibly large number of threads\"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.\n-\n \n * We should stop unsetting `MAKEFLAGS` and setting `MAKE` to `make` whenever `SAGE_PARALLEL_SPKG_BUILD!=yes` in `spkg/install`, which is simply wrong for a couple of reasons:\n   * It invalidates e.g. `MAKE=gmake`.\n``````\n",
    "created_at": "2015-09-16T08:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119578",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,13 +15,6 @@
 ---
 
 Related:
-
-* The current behaviour of `devel/sage/setup.py` w.r.t. to parallel building is IMHO undesirable or sub-optimal:
-  * It uses the number of hardware threads even if `MAKE` isn't set (*of course<sup>TM</sup>* regardless of the system load). (If `MAKE` is set to e.g. `make -j`, which means an "unlimited" number of jobs, it uses twice the number of hardware threads.) 
-
-    One can of course circumvent that by setting `MAKE` to `make -j1`, but that's IMHO kind of odd.
-  * It complains about an *"impossibly large number of threads"* if the number of jobs (`-j...`) found in `$MAKE` exceeds twice the number of hardware threads, where the number of hardware threads is equal to the number of cores on processors without what Intel calls Hyper-Threading (HT), then falling back to (at most) the number of hardware threads.
-
 
 * We should stop unsetting `MAKEFLAGS` and setting `MAKE` to `make` whenever `SAGE_PARALLEL_SPKG_BUILD!=yes` in `spkg/install`, which is simply wrong for a couple of reasons:
   * It invalidates e.g. `MAKE=gmake`.
``````




---

archive/issue_comments_119579.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,7 +39,7 @@\n    **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.\n \n \n-* The sequence top-level Makefile (`make`) -> `spkg/install` (shell script) -> `spkg/standard/deps`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `spkg/standard/deps` (ill name for a Makefile that isn't included by another one) itself. \n+* The sequence top-level Makefile (`make`) -> `build/make/install` (shell script) -> `build/make/Makefile`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `build/make/Makefile` itself. \n \n   Changing this is of course a bigger task. (We have to keep the two-stage make procedure, i.e. two separate Makefiles, to support upgrading at least, which I think isn't bad since it is more modular.)\n \n``````\n",
    "created_at": "2015-09-16T08:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119579",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,7 +39,7 @@
    **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.
 
 
-* The sequence top-level Makefile (`make`) -> `spkg/install` (shell script) -> `spkg/standard/deps`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `spkg/standard/deps` (ill name for a Makefile that isn't included by another one) itself. 
+* The sequence top-level Makefile (`make`) -> `build/make/install` (shell script) -> `build/make/Makefile`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `build/make/Makefile` itself. 
 
   Changing this is of course a bigger task. (We have to keep the two-stage make procedure, i.e. two separate Makefiles, to support upgrading at least, which I think isn't bad since it is more modular.)
 
``````




---

archive/issue_comments_119580.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -38,12 +38,6 @@\n \n    **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.\n \n-\n-* The sequence top-level Makefile (`make`) -> `build/make/install` (shell script) -> `build/make/Makefile`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `build/make/Makefile` itself. \n-\n-  Changing this is of course a bigger task. (We have to keep the two-stage make procedure, i.e. two separate Makefiles, to support upgrading at least, which I think isn't bad since it is more modular.)\n-\n ---\n \n In case we disagree or have contrary opinions on / suggestions for some changes or in design, we can move the discussion of *individual aspects* to `sage-devel` (or `sage-release` :-) ) threads, but we IMHO shouldn't move the *whole* discussion there. There'll certainly be follow-up or \"real\" (non-meta) tickets anyway, so it should be possible to not mix up different aspects in a single thread.\n-\n``````\n",
    "created_at": "2015-09-16T08:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119580",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -38,12 +38,6 @@
 
    **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.
 
-
-* The sequence top-level Makefile (`make`) -> `build/make/install` (shell script) -> `build/make/Makefile`, another Makefile run by a *different* `make` instance is IMHO bad and not necessary anyway, since it is possible to set all environment (or `make`) variables in `build/make/Makefile` itself. 
-
-  Changing this is of course a bigger task. (We have to keep the two-stage make procedure, i.e. two separate Makefiles, to support upgrading at least, which I think isn't bad since it is more modular.)
-
 ---
 
 In case we disagree or have contrary opinions on / suggestions for some changes or in design, we can move the discussion of *individual aspects* to `sage-devel` (or `sage-release` :-) ) threads, but we IMHO shouldn't move the *whole* discussion there. There'll certainly be follow-up or "real" (non-meta) tickets anyway, so it should be possible to not mix up different aspects in a single thread.
-
``````




---

archive/issue_comments_119581.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n> it is possible to set all environment variables in `build/make/Makefile` itself.\n\nI don't think so (or at least, I don't know how to do it). In any case, I don't see the point of *repeating* all environment variables in `build/make/Makefile`, what's wrong with keeping the use of `sage-env`?",
    "created_at": "2015-09-16T08:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119581",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
> it is possible to set all environment variables in `build/make/Makefile` itself.

I don't think so (or at least, I don't know how to do it). In any case, I don't see the point of *repeating* all environment variables in `build/make/Makefile`, what's wrong with keeping the use of `sage-env`?



---

archive/issue_events_156364.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-16T08:41:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "title_is": "Add some targets to the top-level Makefile",
    "title_was": "Add some targets to the top-level Makefile (and other make-related issues)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156364"
}
```



---

archive/issue_comments_119582.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,35 +9,3 @@\n * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n * `build-sequential` in case we one day default to a parallel build\n * similar things for `doc` (see below) and `all`\n-\n-**Please add further suggestions (and the tickets implementing them).**\n-\n----\n-\n-Related:\n-\n-* We should stop unsetting `MAKEFLAGS` and setting `MAKE` to `make` whenever `SAGE_PARALLEL_SPKG_BUILD!=yes` in `spkg/install`, which is simply wrong for a couple of reasons:\n-  * It invalidates e.g. `MAKE=gmake`.\n-  * It clears all flags passed to `make` on the command line as well as those eventually added in `MAKE` (or to `MAKEFLAGS`), e.g. `-d`, `-k` (`--keep-going`), and even `-n` (`--dry-run`) and `-q`. \n-\n-\n- It should instead (if at all) just add `-j1` to `MAKE` if `SAGE_PARALLEL_SPKG_BUILD!=yes`. \n-\n-\n- Oh, just noticed this has meanwhile slightly changed (but don't want to rewrite all the above):\n-\n-```sh\n-if [ \"$SAGE_PARALLEL_SPKG_BUILD\" = \"yes\" ] && [ -n \"$MAKE\" ]; then\n-    time $MAKE -f standard/deps $1\n-else\n-    time make -f standard/deps $1\n-fi\n-```\n- So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately. \n-\n-\n-   **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.\n-\n----\n-\n-In case we disagree or have contrary opinions on / suggestions for some changes or in design, we can move the discussion of *individual aspects* to `sage-devel` (or `sage-release` :-) ) threads, but we IMHO shouldn't move the *whole* discussion there. There'll certainly be follow-up or \"real\" (non-meta) tickets anyway, so it should be possible to not mix up different aspects in a single thread.\n``````\n",
    "created_at": "2015-09-16T08:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119582",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,35 +9,3 @@
 * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
 * `build-sequential` in case we one day default to a parallel build
 * similar things for `doc` (see below) and `all`
-
-**Please add further suggestions (and the tickets implementing them).**
-
----
-
-Related:
-
-* We should stop unsetting `MAKEFLAGS` and setting `MAKE` to `make` whenever `SAGE_PARALLEL_SPKG_BUILD!=yes` in `spkg/install`, which is simply wrong for a couple of reasons:
-  * It invalidates e.g. `MAKE=gmake`.
-  * It clears all flags passed to `make` on the command line as well as those eventually added in `MAKE` (or to `MAKEFLAGS`), e.g. `-d`, `-k` (`--keep-going`), and even `-n` (`--dry-run`) and `-q`. 
-
-
- It should instead (if at all) just add `-j1` to `MAKE` if `SAGE_PARALLEL_SPKG_BUILD!=yes`. 
-
-
- Oh, just noticed this has meanwhile slightly changed (but don't want to rewrite all the above):
-
-```sh
-if [ "$SAGE_PARALLEL_SPKG_BUILD" = "yes" ] && [ -n "$MAKE" ]; then
-    time $MAKE -f standard/deps $1
-else
-    time make -f standard/deps $1
-fi
-```
- So we do no longer clear `MAKEFLAGS`, but not using `$MAKE` there remains. (And this won't prevent a parallel build invoked through `-j` without a number of jobs.) Note that `MAKE` will always be set at that point, unless some user tries to call `spkg/install` directly (or doesn't use GNU `make`), which is an error condition by itself, to be catched separately. 
-
-
-   **Note:** This is meanwhile also fixed by #11959, i.e. `${MAKE:-make}` is now consistently used.
-
----
-
-In case we disagree or have contrary opinions on / suggestions for some changes or in design, we can move the discussion of *individual aspects* to `sage-devel` (or `sage-release` :-) ) threads, but we IMHO shouldn't move the *whole* discussion there. There'll certainly be follow-up or "real" (non-meta) tickets anyway, so it should be possible to not mix up different aspects in a single thread.
``````




---

archive/issue_comments_119583.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,4 +8,4 @@\n ```\n * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n * `build-sequential` in case we one day default to a parallel build\n-* similar things for `doc` (see below) and `all`\n+* similar things for `doc` and `all`\n``````\n",
    "created_at": "2015-09-16T08:41:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119583",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,4 +8,4 @@
 ```
 * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
 * `build-sequential` in case we one day default to a parallel build
-* similar things for `doc` (see below) and `all`
+* similar things for `doc` and `all`
``````




---

archive/issue_comments_119584.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,4 @@\n env SAGE_CHECK=yes make build\n ```\n * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing\n-* `build-sequential` in case we one day default to a parallel build\n * similar things for `doc` and `all`\n``````\n",
    "created_at": "2015-09-16T08:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119584",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,4 @@
 env SAGE_CHECK=yes make build
 ```
 * `build-parallel` or something like that to build Sage in parallel with a default number of jobs (preferably the number of cores or hardware threads), or at least (currently just) setting `SAGE_PARALLEL_SPKG_BUILD=yes` and doing the usual thing
-* `build-sequential` in case we one day default to a parallel build
 * similar things for `doc` and `all`
``````




---

archive/issue_comments_119585.json:
```json
{
    "body": "Replying to [ticket:11622 leif]:\n> * `build-sequential` in case we one day default to a parallel build\n\nWe still don't do that by default.",
    "created_at": "2015-09-16T08:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119585",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11622 leif]:
> * `build-sequential` in case we one day default to a parallel build

We still don't do that by default.



---

archive/issue_comments_119586.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI propose to use `pbuild` and `pall` as target names, by analogy to `ptest(long)`.\n\nI don't see the need for a target `pdoc` (I never need to run `make doc`, I just run `make` which is mostly the same anyway).",
    "created_at": "2015-09-16T08:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119586",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

I propose to use `pbuild` and `pall` as target names, by analogy to `ptest(long)`.

I don't see the need for a target `pdoc` (I never need to run `make doc`, I just run `make` which is mostly the same anyway).



---

archive/issue_events_156365.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156365"
}
```



---

archive/issue_events_156366.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156366"
}
```



---

archive/issue_events_156367.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156367"
}
```



---

archive/issue_comments_119587.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOutdated, should close",
    "created_at": "2021-08-26T19:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119587",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Outdated, should close



---

archive/issue_events_156368.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T19:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156368"
}
```



---

archive/issue_events_156369.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-08-26T21:18:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156369"
}
```



---

archive/issue_events_156370.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-08-26T21:18:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156370"
}
```



---

archive/issue_comments_119588.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThere might be something with some validity here, but we can always open a new ticket with a more clear focus.",
    "created_at": "2021-08-26T21:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11622#issuecomment-119588",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

There might be something with some validity here, but we can always open a new ticket with a more clear focus.



---

archive/issue_events_156371.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T18:48:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156371"
}
```



---

archive/issue_events_156372.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-02T18:48:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11622#event-156372"
}
```
