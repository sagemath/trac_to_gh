# Issue 11966: OS X 10.7 Lion: Maxima fails to build

archive/issues_011794.json:
```json
{
    "body": "(The home base for this ticket is the Lion ticket #11881.)\n\nSee the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. \n\n---\n\n**New spkg:** [http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg)\n\n**md5sum:** `f87e697e9497ccf69a91ae77c9b5a591`\n\n### maxima-5.23.2.p2 (Leif Leonhardy, November 3rd 2011)\n* Trac #11966: Modification so that Sage will build on Lion.\n  Actually the new patch isn't specific to MacOS X 10.7 / Lion,\n  but necessary when building with the new ECL version from git\n  (ecl-11.1.2.git.20111030.spkg, see #11884).\n* Reviewer changes: Clean up `spkg-install`.\n\n### maxima-5.23.2.p1 (William Stein, 31 October 2011)\n* Trac #11966: Modification so that Sage will build on Lion.\n\n\n\n**Assignee:** drkirkby\n\n**CC:**  @nexttime\n\n**Author:** William Stein\n\n**Reviewer:** Leif Leonhardy, John Palmieri\n\n**Merged:** sage-4.8.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11966\n\n",
    "closed_at": "2011-11-10T13:30:22Z",
    "created_at": "2011-10-31T07:04:01Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "title": "OS X 10.7 Lion: Maxima fails to build",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11966",
    "user": "https://github.com/williamstein"
}
```
(The home base for this ticket is the Lion ticket #11881.)

See the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. 

---

**New spkg:** [http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg)

**md5sum:** `f87e697e9497ccf69a91ae77c9b5a591`

### maxima-5.23.2.p2 (Leif Leonhardy, November 3rd 2011)
* Trac #11966: Modification so that Sage will build on Lion.
  Actually the new patch isn't specific to MacOS X 10.7 / Lion,
  but necessary when building with the new ECL version from git
  (ecl-11.1.2.git.20111030.spkg, see #11884).
* Reviewer changes: Clean up `spkg-install`.

### maxima-5.23.2.p1 (William Stein, 31 October 2011)
* Trac #11966: Modification so that Sage will build on Lion.



**Assignee:** drkirkby

**CC:**  @nexttime

**Author:** William Stein

**Reviewer:** Leif Leonhardy, John Palmieri

**Merged:** sage-4.8.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11966





---

archive/issue_comments_129017.json:
```json
{
    "body": "<a id='comment:1'></a>\nMy first guess about a way to solve this problem was to add the two lines\n\n```\n(require :cmp)\n(setf c::*compile-in-constants* t)\n```\nto the top of the file `maxima-5.23.2.p0/src/src/maxima.system`.  This was inspired by reading the error message and this post: http://www.mail-archive.com/ecls-list@lists.sourceforge.net/msg01243.html",
    "created_at": "2011-10-31T07:12:29Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129017",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>
My first guess about a way to solve this problem was to add the two lines

```
(require :cmp)
(setf c::*compile-in-constants* t)
```
to the top of the file `maxima-5.23.2.p0/src/src/maxima.system`.  This was inspired by reading the error message and this post: http://www.mail-archive.com/ecls-list@lists.sourceforge.net/msg01243.html



---

archive/issue_comments_129018.json:
```json
{
    "body": "**Dependencies:** 11884",
    "created_at": "2011-10-31T07:12:29Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129018",
    "user": "https://github.com/williamstein"
}
```

**Dependencies:** 11884



---

archive/issue_comments_129019.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's an spkg with the patch.  This built fine for me on OS X 10.7.2 (taking 23 minutes). \n\n  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg",
    "created_at": "2011-10-31T07:40:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129019",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
Here's an spkg with the patch.  This built fine for me on OS X 10.7.2 (taking 23 minutes). 

  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg



---

archive/issue_events_096618.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-10-31T07:40:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96618"
}
```



---

archive/issue_comments_129020.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n \n See the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. \n \n+\n+  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg\n``````\n",
    "created_at": "2011-10-31T07:40:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129020",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 
 See the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. 
 
+
+  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg
``````




---

archive/issue_comments_129021.json:
```json
{
    "body": "<a id='comment:3'></a>\nI realize that Sage doesn't start yet (#11967).  But can you try\n\n```\n./sage -maxima\n```\nand see if the Maxima standalone binary works fine?  If not, we have problems, but presumably it will.",
    "created_at": "2011-10-31T16:56:13Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129021",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
I realize that Sage doesn't start yet (#11967).  But can you try

```
./sage -maxima
```
and see if the Maxima standalone binary works fine?  If not, we have problems, but presumably it will.



---

archive/issue_events_096619.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-31T20:03:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "rename": {
        "from": "lion os x 10.7: Maxima fails to build",
        "to": "OS X 10.7 Lion: Maxima fails to build"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96619"
}
```



---

archive/issue_comments_129022.json:
```json
{
    "body": "**Author:** William Stein",
    "created_at": "2011-10-31T20:03:26Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129022",
    "user": "https://github.com/nexttime"
}
```

**Author:** William Stein



---

archive/issue_comments_129023.json:
```json
{
    "body": "**Changing dependencies** from \"11884\" to \"#11884\".",
    "created_at": "2011-10-31T20:17:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129023",
    "user": "https://github.com/nexttime"
}
```

**Changing dependencies** from "11884" to "#11884".



---

archive/issue_comments_129024.json:
```json
{
    "body": "<a id='comment:5'></a>\nShould we apply the patch on *all* platforms? (Which the spkg currently does.)",
    "created_at": "2011-10-31T20:17:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129024",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>
Should we apply the patch on *all* platforms? (Which the spkg currently does.)



---

archive/issue_comments_129025.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [leif](#comment%3A5):\n> Should we apply the patch on *all* platforms? (Which the spkg currently does.)\n\n\nGood question, which I wondered about.    It seems to work on other platforms, and logically it makes sense to me that it should be the right thing to do.    However, I'm not very knowledgable about the subtleties of lisp compilation.",
    "created_at": "2011-11-01T17:20:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129025",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
Replying to [leif](#comment%3A5):
> Should we apply the patch on *all* platforms? (Which the spkg currently does.)


Good question, which I wondered about.    It seems to work on other platforms, and logically it makes sense to me that it should be the right thing to do.    However, I'm not very knowledgable about the subtleties of lisp compilation.



---

archive/issue_comments_129026.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129026",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_096620.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96620"
}
```



---

archive/issue_comments_129027.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [was](#comment%3A6):\n> Replying to [leif](#comment%3A5):\n> > Should we apply the patch on *all* platforms? (Which the spkg currently does.)\n\n> \n> Good question, which I wondered about.    It seems to work on other platforms, and logically it makes sense to me that it should be the right thing to do.    However, I'm not very knowledgable about the subtleties of lisp compilation.\n\n\nThe patch seems to be necessary (when building with the new ECL from git / #11884) on other platforms as well.",
    "created_at": "2011-11-04T02:26:39Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129027",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Replying to [was](#comment%3A6):
> Replying to [leif](#comment%3A5):
> > Should we apply the patch on *all* platforms? (Which the spkg currently does.)

> 
> Good question, which I wondered about.    It seems to work on other platforms, and logically it makes sense to me that it should be the right thing to do.    However, I'm not very knowledgable about the subtleties of lisp compilation.


The patch seems to be necessary (when building with the new ECL from git / #11884) on other platforms as well.



---

archive/issue_events_096621.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-04T02:26:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96621"
}
```



---

archive/issue_comments_129028.json:
```json
{
    "body": "<a id='comment:9'></a>\nFWIW, I made a [\"reviewer\" p2 spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg) with some fixes to / clean-up of `spkg-install` and some additions to `SPKG.txt`, but doctesting `sage/interfaces/maxima*` immediately segfaults (with both Williams p1 and my p2, with the ECL spkg from #11884):\n\n```sh\n$ ./sage -t -long devel/sage/sage/interfaces/maxima*\nsage -t -long \"devel/sage/sage/interfaces/maxima.py\"\n...\nsage -t -long \"devel/sage/sage/interfaces/maxima_lib.py\"    \n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(print_backtrace+0x31)[0x7f000546c817]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(sigdie+0x14)[0x7f000546c849]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(sage_signal_handler+0x20e)[0x7f000546c474]\n/lib/libpthread.so.0(+0xf8f0)[0x7f00070ab8f0]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libgc.so.1(GC_free+0x40)[0x7effd69d1a50]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libecl.so.11.1(ecl_dealloc+0x16)[0x7effd6e3c786]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x38a8)[0x7f00036268a8]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x6fd2)[0x7f0003629fd2]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x7439)[0x7f000362a439]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4dca)[0x7f00073a0e1a]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(+0x71c2b)[0x7f000732ac2b]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyObject_Call+0x52)[0x7f00073011a2]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(+0x5a8bd)[0x7f00073138bd]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyObject_Call+0x52)[0x7f00073011a2]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x464c)[0x7f00073a069c]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x32)[0x7f00073a2a22]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb0)[0x7f00073c45a0]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0x1ff)[0x7f00073c504f]\n/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(Py_Main+0xb2c)[0x7f00073d3d3c]\n/lib/libc.so.6(__libc_start_main+0xfd)[0x7f00066adc4d]\npython[0x400619]\n\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off(). You might\nwant to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n\n\t [3.4 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -long \"devel/sage/sage/interfaces/maxima.py\"\n\tsage -t -long \"devel/sage/sage/interfaces/maxima_abstract.py\"\n\tsage -t -long \"devel/sage/sage/interfaces/maxima_lib.py\"\n```\n\nI think that's most probably \"just\" due to ECL (or Boehm GC?), i.e. #11884, so I could otherwise give this ticket a positive review... ;-)\n\nAnyway, someone would have to look at my reviewer changes.\n\nBtw., there's an `spkg-dist` script apparently nobody used recently (I added a comment on that to `SPKG.txt`), which deletes the following (and creates dummy `Makefile.in`s):\n\n```sh\n$ du -sch /home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/{es,pt}*\n9.9M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es\n7.3M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es.utf8\n8.2M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt\n8.8M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR\n6.5M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR.utf8\n6.0M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt.utf8\n47M\ttotal\n```",
    "created_at": "2011-11-04T05:16:17Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129028",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
FWIW, I made a ["reviewer" p2 spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg) with some fixes to / clean-up of `spkg-install` and some additions to `SPKG.txt`, but doctesting `sage/interfaces/maxima*` immediately segfaults (with both Williams p1 and my p2, with the ECL spkg from #11884):

```sh
$ ./sage -t -long devel/sage/sage/interfaces/maxima*
sage -t -long "devel/sage/sage/interfaces/maxima.py"
...
sage -t -long "devel/sage/sage/interfaces/maxima_lib.py"    
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(print_backtrace+0x31)[0x7f000546c817]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(sigdie+0x14)[0x7f000546c849]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libcsage.so(sage_signal_handler+0x20e)[0x7f000546c474]
/lib/libpthread.so.0(+0xf8f0)[0x7f00070ab8f0]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libgc.so.1(GC_free+0x40)[0x7effd69d1a50]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libecl.so.11.1(ecl_dealloc+0x16)[0x7effd6e3c786]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x38a8)[0x7f00036268a8]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x6fd2)[0x7f0003629fd2]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/python/site-packages/sage/misc/randstate.so(+0x7439)[0x7f000362a439]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4dca)[0x7f00073a0e1a]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(+0x71c2b)[0x7f000732ac2b]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyObject_Call+0x52)[0x7f00073011a2]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(+0x5a8bd)[0x7f00073138bd]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyObject_Call+0x52)[0x7f00073011a2]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x464c)[0x7f00073a069c]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4ba4)[0x7f00073a0bf4]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x888)[0x7f00073a2948]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x32)[0x7f00073a2a22]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb0)[0x7f00073c45a0]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0x1ff)[0x7f00073c504f]
/home/leif/Sage/sage-4.7.2.rc0-gcc-4.5.1/local/lib/libpython2.6.so.1.0(Py_Main+0xb2c)[0x7f00073d3d3c]
/lib/libc.so.6(__libc_start_main+0xfd)[0x7f00066adc4d]
python[0x400619]

------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off(). You might
want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate.
------------------------------------------------------------------------
Segmentation fault

	 [3.4 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -long "devel/sage/sage/interfaces/maxima.py"
	sage -t -long "devel/sage/sage/interfaces/maxima_abstract.py"
	sage -t -long "devel/sage/sage/interfaces/maxima_lib.py"
```

I think that's most probably "just" due to ECL (or Boehm GC?), i.e. #11884, so I could otherwise give this ticket a positive review... ;-)

Anyway, someone would have to look at my reviewer changes.

Btw., there's an `spkg-dist` script apparently nobody used recently (I added a comment on that to `SPKG.txt`), which deletes the following (and creates dummy `Makefile.in`s):

```sh
$ du -sch /home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/{es,pt}*
9.9M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es
7.3M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es.utf8
8.2M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt
8.8M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR
6.5M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR.utf8
6.0M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt.utf8
47M	total
```



---

archive/issue_events_096622.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-04T05:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96622"
}
```



---

archive/issue_events_096623.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-04T05:16:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96623"
}
```



---

archive/issue_comments_129029.json:
```json
{
    "body": "**Reviewer:** Leif Leonhardy",
    "created_at": "2011-11-04T05:16:17Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129029",
    "user": "https://github.com/nexttime"
}
```

**Reviewer:** Leif Leonhardy



---

archive/attachments_016494.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "maxima-5.23.2.p1-p2.diff",
    "asset_url": "tarball://root/attachments/ticket11966/maxima-5.23.2.p1-p2.diff",
    "created_at": "2011-11-04T05:19:16Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11966/maxima-5.23.2.p1-p2.diff",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_129030.json:
```json
{
    "body": "**Attachment:** [maxima-5.23.2.p1-p2.diff](https://github.com/sagemath/sage/files/ticket11966/maxima-5.23.2.p1-p2.diff)\n\nDiff between William's p1 and my p2. For reference / review.",
    "created_at": "2011-11-04T05:19:16Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129030",
    "user": "https://github.com/nexttime"
}
```

**Attachment:** [maxima-5.23.2.p1-p2.diff](https://github.com/sagemath/sage/files/ticket11966/maxima-5.23.2.p1-p2.diff)

Diff between William's p1 and my p2. For reference / review.



---

archive/issue_comments_129031.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,24 @@\n \n See the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. \n \n+---\n \n-  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg\n+**New spkg:** [http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg)\n+\n+**md5sum:** `f87e697e9497ccf69a91ae77c9b5a591`\n+\n+### maxima-5.23.2.p2 (Leif Leonhardy, November 3rd 2011)\n+* Trac #11966: Modification so that Sage will build on Lion.\n+  Actually the new patch isn't specific to MacOS X 10.7 / Lion,\n+  but necessary when building with the new ECL version from git\n+  (ecl-11.1.2.git.20111030.spkg, see #11884).\n+* Reviewer changes: Clean up `spkg-install`.\n+\n+### maxima-5.23.2.p1 (William Stein, 31 October 2011)\n+* Trac #11966: Modification so that Sage will build on Lion.\n+\n+\n+\n+\n+__Note:__ Turns out that this Maxima spkg **builds** with the current ECL from #11884 (on MacOS X 10.7 as well as Linux), **but** -- as of November 3rd -- **doesn't work**, i.e. segfaults (cf. comments below).\n+\n``````\n",
    "created_at": "2011-11-04T05:32:59Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129031",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,24 @@
 
 See the discussion at #11884.  To fix this we may need to slightly modify the Maxima spkg, at least for now. 
 
+---
 
-  http://sage.math.washington.edu/home/wstein/patches/maxima-5.23.2.p1.spkg
+**New spkg:** [http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg)
+
+**md5sum:** `f87e697e9497ccf69a91ae77c9b5a591`
+
+### maxima-5.23.2.p2 (Leif Leonhardy, November 3rd 2011)
+* Trac #11966: Modification so that Sage will build on Lion.
+  Actually the new patch isn't specific to MacOS X 10.7 / Lion,
+  but necessary when building with the new ECL version from git
+  (ecl-11.1.2.git.20111030.spkg, see #11884).
+* Reviewer changes: Clean up `spkg-install`.
+
+### maxima-5.23.2.p1 (William Stein, 31 October 2011)
+* Trac #11966: Modification so that Sage will build on Lion.
+
+
+
+
+__Note:__ Turns out that this Maxima spkg **builds** with the current ECL from #11884 (on MacOS X 10.7 as well as Linux), **but** -- as of November 3rd -- **doesn't work**, i.e. segfaults (cf. comments below).
+
``````




---

archive/issue_events_096624.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-04T06:20:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96624"
}
```



---

archive/issue_events_096625.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-04T06:20:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96625"
}
```



---

archive/issue_comments_129032.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [leif](#comment%3A9):\n> FWIW, I made a [\"reviewer\" p2 spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg) with some fixes to / clean-up of `spkg-install` and some additions to `SPKG.txt`, but doctesting `sage/interfaces/maxima*` immediately segfaults (with both Williams p1 and my p2, with the ECL spkg from #11884) [...] \n\n\n> I think that's most probably \"just\" due to ECL (or Boehm GC?), i.e. #11884, so I could otherwise give this ticket a positive review... ;-)\n\n\nOooops, one should perhaps run `./sage -b` after installing a new ECL spkg... B)\n\n```sh\n$ ./sage -t -long devel/sage/sage/interfaces/maxima*\nsage -t -long \"devel/sage/sage/interfaces/maxima.py\"        \n\t [25.7 s]\nsage -t -long \"devel/sage/sage/interfaces/maxima_abstract.py\"\n\t [38.4 s]\nsage -t -long \"devel/sage/sage/interfaces/maxima_lib.py\"    \n\t [5.2 s]\n \n----------------------------------------------------------------------\nAll tests passed!\n```\n\nBy the way, the new ECL + patched Maxima spkgs work with both the boehm_gc-7.2.alpha6.p0 (from #11883) and the boehm_gc-7.1.p7 spkg.\n\n\n\n\n> Anyway, someone would have to look at my reviewer changes.\n\n\nThat still applies.\n\n\n\n\n> Btw., there's an `spkg-dist` script apparently nobody used recently (I added a comment on that to `SPKG.txt`), which deletes the following (and creates dummy `Makefile.in`s):\n\n\n```sh\n $ du -sch /home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/{es,pt}*\n 9.9M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es\n 7.3M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es.utf8\n 8.2M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt\n 8.8M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR\n 6.5M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR.utf8\n 6.0M\t/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt.utf8\n 47M\ttotal\n```\n\nIf nobody objects, I can make a stripped spkg with these files removed (and `SPKG.txt` updated accordingly).\n\nThe relevant languages are Portuguese (Portugal and Brazil) and Spanish:\n\n```python\n#!/usr/bin/env python\n\nimport os, sys, time\n\ndef cmd(x):\n    print x\n    if os.system(x):\n        print \"(Failed.)\"\n\nfor X in ['es', 'es.utf8', 'pt', 'pt.utf8', 'pt_BR', 'pt_BR.utf8']:\n    cmd('rm -rf \"src/doc/info/%s/\"*'%X)\n    open('src/doc/info/%s/Makefile.in'%X,'w').write('all:\\n\\tls\\n\\n')\n```",
    "created_at": "2011-11-04T06:20:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129032",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [leif](#comment%3A9):
> FWIW, I made a ["reviewer" p2 spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/maxima-5.23.2.p2.spkg) with some fixes to / clean-up of `spkg-install` and some additions to `SPKG.txt`, but doctesting `sage/interfaces/maxima*` immediately segfaults (with both Williams p1 and my p2, with the ECL spkg from #11884) [...] 


> I think that's most probably "just" due to ECL (or Boehm GC?), i.e. #11884, so I could otherwise give this ticket a positive review... ;-)


Oooops, one should perhaps run `./sage -b` after installing a new ECL spkg... B)

```sh
$ ./sage -t -long devel/sage/sage/interfaces/maxima*
sage -t -long "devel/sage/sage/interfaces/maxima.py"        
	 [25.7 s]
sage -t -long "devel/sage/sage/interfaces/maxima_abstract.py"
	 [38.4 s]
sage -t -long "devel/sage/sage/interfaces/maxima_lib.py"    
	 [5.2 s]
 
----------------------------------------------------------------------
All tests passed!
```

By the way, the new ECL + patched Maxima spkgs work with both the boehm_gc-7.2.alpha6.p0 (from #11883) and the boehm_gc-7.1.p7 spkg.




> Anyway, someone would have to look at my reviewer changes.


That still applies.




> Btw., there's an `spkg-dist` script apparently nobody used recently (I added a comment on that to `SPKG.txt`), which deletes the following (and creates dummy `Makefile.in`s):


```sh
 $ du -sch /home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/{es,pt}*
 9.9M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es
 7.3M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/es.utf8
 8.2M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt
 8.8M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR
 6.5M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt_BR.utf8
 6.0M	/home/leif/Sage/spkgs/maxima-5.23.2.p2/src/doc/info/pt.utf8
 47M	total
```

If nobody objects, I can make a stripped spkg with these files removed (and `SPKG.txt` updated accordingly).

The relevant languages are Portuguese (Portugal and Brazil) and Spanish:

```python
#!/usr/bin/env python

import os, sys, time

def cmd(x):
    print x
    if os.system(x):
        print "(Failed.)"

for X in ['es', 'es.utf8', 'pt', 'pt.utf8', 'pt_BR', 'pt_BR.utf8']:
    cmd('rm -rf "src/doc/info/%s/"*'%X)
    open('src/doc/info/%s/Makefile.in'%X,'w').write('all:\n\tls\n\n')
```



---

archive/issue_comments_129033.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,3 @@\n * Trac #11966: Modification so that Sage will build on Lion.\n \n \n-\n-\n-__Note:__ Turns out that this Maxima spkg **builds** with the current ECL from #11884 (on MacOS X 10.7 as well as Linux), **but** -- as of November 3rd -- **doesn't work**, i.e. segfaults (cf. comments below).\n-\n``````\n",
    "created_at": "2011-11-04T06:24:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129033",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,3 @@
 * Trac #11966: Modification so that Sage will build on Lion.
 
 
-
-
-__Note:__ Turns out that this Maxima spkg **builds** with the current ECL from #11884 (on MacOS X 10.7 as well as Linux), **but** -- as of November 3rd -- **doesn't work**, i.e. segfaults (cf. comments below).
-
``````




---

archive/issue_comments_129034.json:
```json
{
    "body": "<a id='comment:13'></a>\nBoth spkgs (new ECL and Maxima 5.23.2.p2) also build on Solaris SPARC (32-bit mode), and all long tests pass in `sage/interfaces/maxima*`.\n\n`ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...",
    "created_at": "2011-11-04T07:42:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129034",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Both spkgs (new ECL and Maxima 5.23.2.p2) also build on Solaris SPARC (32-bit mode), and all long tests pass in `sage/interfaces/maxima*`.

`ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...



---

archive/issue_comments_129035.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [leif](#comment%3A13):\n> `ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...\n\n\nOn Ubuntu 10.04.3 I get:\n\n```\nThe following tests failed:\n\n\tsage -t  -long -force_lib devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # 1 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/rings/number_field/number_field.py # 5 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/rings/polynomial/multi_polynomial_element.py # 4 doctests failed\n\tsage -t  -long -force_lib devel/sage/doc/en/bordeaux_2008/l_series.rst # 3 doctests failed\n\tsage -t  -long -force_lib devel/sage/doc/en/bordeaux_2008/elliptic_curves.rst # 2 doctests failed\n\tsage -t  -long -force_lib devel/sage/doc/en/reference/coercion.rst # 2 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/plane_curves/projective_curve.py # 3 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/heegner.py # 7 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 15 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 2 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/BSD.py # 1 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/schemes/generic/divisor_group.py # 3 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/lfunctions/dokchitser.py # 16 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/modular/modform/eis_series.py # 4 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/modular/modform/element.py # 10 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed\n----------------------------------------------------------------------\n```\n\n(Although I'm not that sure how clean the installation is, but IIRC the last `ptestlong` passed all tests.)",
    "created_at": "2011-11-04T08:12:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129035",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Replying to [leif](#comment%3A13):
> `ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...


On Ubuntu 10.04.3 I get:

```
The following tests failed:

	sage -t  -long -force_lib devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # 1 doctests failed
	sage -t  -long -force_lib devel/sage/sage/rings/number_field/number_field.py # 5 doctests failed
	sage -t  -long -force_lib devel/sage/sage/rings/polynomial/multi_polynomial_element.py # 4 doctests failed
	sage -t  -long -force_lib devel/sage/doc/en/bordeaux_2008/l_series.rst # 3 doctests failed
	sage -t  -long -force_lib devel/sage/doc/en/bordeaux_2008/elliptic_curves.rst # 2 doctests failed
	sage -t  -long -force_lib devel/sage/doc/en/reference/coercion.rst # 2 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/plane_curves/projective_curve.py # 3 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/heegner.py # 7 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 15 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 2 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/elliptic_curves/BSD.py # 1 doctests failed
	sage -t  -long -force_lib devel/sage/sage/schemes/generic/divisor_group.py # 3 doctests failed
	sage -t  -long -force_lib devel/sage/sage/lfunctions/dokchitser.py # 16 doctests failed
	sage -t  -long -force_lib devel/sage/sage/modular/modform/eis_series.py # 4 doctests failed
	sage -t  -long -force_lib devel/sage/sage/modular/modform/element.py # 10 doctests failed
	sage -t  -long -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed
----------------------------------------------------------------------
```

(Although I'm not that sure how clean the installation is, but IIRC the last `ptestlong` passed all tests.)



---

archive/issue_comments_129036.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [leif](#comment%3A14):\n> Replying to [leif](#comment%3A13):\n> > `ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...\n\n> \n> On Ubuntu 10.04.3 I get:\n\n\n```\n The following tests failed:\n ...\n```\n> \n\n\n> (Although I'm not that sure how clean the installation is, but IIRC the last `ptestlong` passed all tests.)\n\n\nWeird.  After building Sage 4.7.2 (final) from scratch with the two spkgs, all tests (`ptestlong`) passed.\n\n`ptestlong` also passed on Solaris SPARC, with Sage 4.7.2.alpha3.",
    "created_at": "2011-11-04T19:01:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129036",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Replying to [leif](#comment%3A14):
> Replying to [leif](#comment%3A13):
> > `ptestlong` (also on Ubuntu 10.04.3 x86_64) in progress...

> 
> On Ubuntu 10.04.3 I get:


```
 The following tests failed:
 ...
```
> 


> (Although I'm not that sure how clean the installation is, but IIRC the last `ptestlong` passed all tests.)


Weird.  After building Sage 4.7.2 (final) from scratch with the two spkgs, all tests (`ptestlong`) passed.

`ptestlong` also passed on Solaris SPARC, with Sage 4.7.2.alpha3.



---

archive/issue_comments_129037.json:
```json
{
    "body": "<a id='comment:16'></a>\nBy the way, have you tried using this spkg *without* the ECL spkg from #11884?  It worked for me (with a build from scratch) on sage.math, hawk (OpenSolaris) and various skynet machines (cleo, eno, silius, taurus; tests passed on all of these except for silius, which has other problems, and cleo, because it hasn't made it that far yet, but it's about 90% done and all tests have passed so far).  I'm also building on mark2 (Solaris), but it is really slow; the maxima build just completed successfully.  Maybe some time tomorrow we'll know about doctests there...\n\nI wonder if we should remove the dependency on #11884.",
    "created_at": "2011-11-04T20:40:28Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129037",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
By the way, have you tried using this spkg *without* the ECL spkg from #11884?  It worked for me (with a build from scratch) on sage.math, hawk (OpenSolaris) and various skynet machines (cleo, eno, silius, taurus; tests passed on all of these except for silius, which has other problems, and cleo, because it hasn't made it that far yet, but it's about 90% done and all tests have passed so far).  I'm also building on mark2 (Solaris), but it is really slow; the maxima build just completed successfully.  Maybe some time tomorrow we'll know about doctests there...

I wonder if we should remove the dependency on #11884.



---

archive/issue_comments_129038.json:
```json
{
    "body": "**Changing dependencies** from \"#11884\" to \"\".",
    "created_at": "2011-11-04T21:30:00Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129038",
    "user": "https://github.com/nexttime"
}
```

**Changing dependencies** from "#11884" to "".



---

archive/issue_comments_129039.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jhpalmieri](#comment%3A16):\n> By the way, have you tried using this spkg *without* the ECL spkg from #11884?\n\n\nNope, since it would be surprising if it did *not* work... :-)\n\n> I wonder if we should remove the dependency on #11884.\n\n\nBreaking the cycle...",
    "created_at": "2011-11-04T21:30:00Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129039",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Replying to [jhpalmieri](#comment%3A16):
> By the way, have you tried using this spkg *without* the ECL spkg from #11884?


Nope, since it would be surprising if it did *not* work... :-)

> I wonder if we should remove the dependency on #11884.


Breaking the cycle...



---

archive/issue_events_096626.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-07T16:32:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96626"
}
```



---

archive/issue_events_096627.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-07T16:32:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96627"
}
```



---

archive/issue_comments_129040.json:
```json
{
    "body": "<a id='comment:18'></a>\nI've built this on a bunch of different systems, both with and without the new ecl spkg at #11884.  I'm giving it (Leif's changes, in particular) a positive review.",
    "created_at": "2011-11-07T16:32:35Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129040",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
I've built this on a bunch of different systems, both with and without the new ecl spkg at #11884.  I'm giving it (Leif's changes, in particular) a positive review.



---

archive/issue_comments_129041.json:
```json
{
    "body": "**Changing reviewer** from \"Leif Leonhardy\" to \"Leif Leonhardy, John Palmieri\".",
    "created_at": "2011-11-07T16:32:35Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129041",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing reviewer** from "Leif Leonhardy" to "Leif Leonhardy, John Palmieri".



---

archive/issue_comments_129042.json:
```json
{
    "body": "**Merged:** sage-4.8.alpha2",
    "created_at": "2011-11-10T13:30:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129042",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.8.alpha2



---

archive/issue_events_096628.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-10T13:30:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96628"
}
```



---

archive/issue_events_096629.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-10T13:30:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11966#event-96629"
}
```



---

archive/issue_comments_129043.json:
```json
{
    "body": "<a id='comment:20'></a>\nSo, somewhat weirdly, since this was tested a lot on various platforms, with #11884 *and* this spkg, I get an error on PPC OS X 10.4.   Error is\n\n```\n\n;;; Note:\n;;;   Invoking external command:\n;;;   ranlib lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a \n;;; Note:\n;;;   Invoking external command:\n;;;   gcc -I. -I/Users/student/Desktop/sage-4.8.alpha1/local/include/ -I/Users/student/Desktop/sage-4.8.alpha1/local/include -I/Users/student/Desktop/sage-4.8.alpha1/local/include -g -O2 -mno-altivec -mabi=no-altivec -fPIC -fno-common -Ddarwin -O2 -w -c eclinit4LFMq0.c -o eclinit4LFMq0.o \n/usr/libexec/gcc/powerpc-apple-darwin8/4.0.1/ld: truncated or malformed archive: lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a at offset 28816248 (archive header of next member extends past the end of the file, can't load from it)\ncollect2: ld returned 1 exit status\nAn error occurred during initialization:\nError code 1 when executing\n(RUN-PROGRAM \"gcc\" (\"-o\"\n                    \"lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/maxima.fasb\"\n                    \"-L/Users/student/Desktop/sage-4.8.alpha1/local/lib/\"\n                    \"/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/eclinit4LFMq0.o\"\n                    \"lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a\"\n                    \"-bundle\"\n                    \"-L/Users/student/Desktop/sage-4.8.alpha1/local/lib\"\n                    \"-L/Users/student/Desktop/sage-4.8.alpha1/local/lib\"\n                    \"-L/Users/student/Desktop/sage-4.8.alpha1/local/lib\"\n                    \"-lecl\" \"-lgmp\" \"-lgc\" \"-lm\")).\n;;; Note:\n;;;   Invoking external command:\n;;;   gcc -o lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/maxima.fasb -L/Users/student/Desktop/sage-4.8.alpha1/local/lib/ /Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/eclinit4LFMq0.o lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a -bundle -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -lecl -lgmp -lgc -lm ***********************************************************\nError: Failed to build Maxima as an ECL library.\n***********************************************************\n\nreal    151m29.005s\nuser    27m50.456s\nsys     14m7.400s\n************************************************************************\nError installing package maxima-5.23.2.p2\n************************************************************************\n```\nThis error looks a LOT like the error in #11884 on the same platform.",
    "created_at": "2011-11-15T18:55:50Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129043",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>
So, somewhat weirdly, since this was tested a lot on various platforms, with #11884 *and* this spkg, I get an error on PPC OS X 10.4.   Error is

```

;;; Note:
;;;   Invoking external command:
;;;   ranlib lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a 
;;; Note:
;;;   Invoking external command:
;;;   gcc -I. -I/Users/student/Desktop/sage-4.8.alpha1/local/include/ -I/Users/student/Desktop/sage-4.8.alpha1/local/include -I/Users/student/Desktop/sage-4.8.alpha1/local/include -g -O2 -mno-altivec -mabi=no-altivec -fPIC -fno-common -Ddarwin -O2 -w -c eclinit4LFMq0.c -o eclinit4LFMq0.o 
/usr/libexec/gcc/powerpc-apple-darwin8/4.0.1/ld: truncated or malformed archive: lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a at offset 28816248 (archive header of next member extends past the end of the file, can't load from it)
collect2: ld returned 1 exit status
An error occurred during initialization:
Error code 1 when executing
(RUN-PROGRAM "gcc" ("-o"
                    "lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/maxima.fasb"
                    "-L/Users/student/Desktop/sage-4.8.alpha1/local/lib/"
                    "/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/eclinit4LFMq0.o"
                    "lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a"
                    "-bundle"
                    "-L/Users/student/Desktop/sage-4.8.alpha1/local/lib"
                    "-L/Users/student/Desktop/sage-4.8.alpha1/local/lib"
                    "-L/Users/student/Desktop/sage-4.8.alpha1/local/lib"
                    "-lecl" "-lgmp" "-lgc" "-lm")).
;;; Note:
;;;   Invoking external command:
;;;   gcc -o lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/maxima.fasb -L/Users/student/Desktop/sage-4.8.alpha1/local/lib/ /Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/eclinit4LFMq0.o lisp-cache/Users/student/Desktop/sage-4.8.alpha1/spkg/build/maxima-5.23.2.p2/src/src/libmaxima.a -bundle -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -L/Users/student/Desktop/sage-4.8.alpha1/local/lib -lecl -lgmp -lgc -lm ***********************************************************
Error: Failed to build Maxima as an ECL library.
***********************************************************

real    151m29.005s
user    27m50.456s
sys     14m7.400s
************************************************************************
Error installing package maxima-5.23.2.p2
************************************************************************
```
This error looks a LOT like the error in #11884 on the same platform.



---

archive/issue_comments_129044.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnd yes, this is *after* using the correct spkg on #11884.",
    "created_at": "2011-11-15T18:56:44Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129044",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
And yes, this is *after* using the correct spkg on #11884.



---

archive/issue_comments_129045.json:
```json
{
    "body": "<a id='comment:22'></a>\nIncidentally, the binary works fine from the command line; it's just the library that failed to install.",
    "created_at": "2011-11-15T19:12:45Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129045",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
Incidentally, the binary works fine from the command line; it's just the library that failed to install.



---

archive/issue_comments_129046.json:
```json
{
    "body": "<a id='comment:23'></a>\nImportant question: does it make sense to merge this *without* merging the new ECL package (#11884) also?",
    "created_at": "2011-11-16T20:13:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129046",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Important question: does it make sense to merge this *without* merging the new ECL package (#11884) also?



---

archive/issue_comments_129047.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [kcrisman](#comment%3A20):\n> This error looks a LOT like the error in #11884 on the same platform.  \n\n\nIndeed. And since the problem only occurs with new versions of ECL, it think ECL (not Maxima) is to blaim.",
    "created_at": "2011-11-16T20:15:30Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129047",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [kcrisman](#comment%3A20):
> This error looks a LOT like the error in #11884 on the same platform.  


Indeed. And since the problem only occurs with new versions of ECL, it think ECL (not Maxima) is to blaim.



---

archive/issue_comments_129048.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [jdemeyer](#comment%3A24):\n> Replying to [kcrisman](#comment%3A20):\n> > This error looks a LOT like the error in #11884 on the same platform.  \n\n> \n> Indeed. And since the problem only occurs with new versions of ECL, it think ECL (not Maxima) is to blaim.\n\n\nI concur.  Which means it's probably okay to merge this?  (Maybe?)",
    "created_at": "2011-11-16T21:17:20Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129048",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:25'></a>
Replying to [jdemeyer](#comment%3A24):
> Replying to [kcrisman](#comment%3A20):
> > This error looks a LOT like the error in #11884 on the same platform.  

> 
> Indeed. And since the problem only occurs with new versions of ECL, it think ECL (not Maxima) is to blaim.


I concur.  Which means it's probably okay to merge this?  (Maybe?)



---

archive/issue_comments_129049.json:
```json
{
    "body": "<a id='comment:26'></a>\nI [tested this](#comment%3A18) on a number of systems (not OS X 10.4 PPC, though) without the new ECL package, and it worked just fine.  So except for testing on OS X 10.4 PPC, I think it makes sense to merge it independently of ECL.",
    "created_at": "2011-11-16T21:19:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129049",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
I [tested this](#comment%3A18) on a number of systems (not OS X 10.4 PPC, though) without the new ECL package, and it worked just fine.  So except for testing on OS X 10.4 PPC, I think it makes sense to merge it independently of ECL.



---

archive/issue_comments_129050.json:
```json
{
    "body": "<a id='comment:27'></a>\nAnd it builds fine with or without #11884 on that platform, and Maxima works, though I didn't run the testsuite - it takes so long to build, and maxima.py times out always :)  And I think Jeroen *has* tested it on PPC OS X 10.4.",
    "created_at": "2011-11-16T21:38:16Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129050",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:27'></a>
And it builds fine with or without #11884 on that platform, and Maxima works, though I didn't run the testsuite - it takes so long to build, and maxima.py times out always :)  And I think Jeroen *has* tested it on PPC OS X 10.4.



---

archive/issue_comments_129051.json:
```json
{
    "body": "<a id='comment:28'></a>\nI am planning to start testing a tentative sage-4.8.alpha2 tomorrow, which includes this ticket.  So if all goes well, the new Maxima will be merged in sage-4.8.alpha2 *without* the new ECL.  For ECL, we have to see what upstream says...",
    "created_at": "2011-11-16T22:27:23Z",
    "issue": "https://github.com/sagemath/sage/issues/11966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11966#issuecomment-129051",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
I am planning to start testing a tentative sage-4.8.alpha2 tomorrow, which includes this ticket.  So if all goes well, the new Maxima will be merged in sage-4.8.alpha2 *without* the new ECL.  For ECL, we have to see what upstream says...
