# Issue 11213: Orbit closure as toric variety

archive/issues_011213.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  @novoselt\n\nKeywords: sd31\n\nThe closure of the torus orbit associated to a cone of the fan is again a toric variety. This patch implements a method `toric_variety.orbit_closure(cone)` to construct this toric variety.\n\n**Apply:**\n1. [attachment:trac_11385_orbit_closure_as_toric_variety.patch]\n2. [attachment:trac_11385_reviewer.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/11385\n\n",
    "closed_at": "2011-09-17T04:47:55Z",
    "created_at": "2011-05-26T21:33:05Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Orbit closure as toric variety",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11213",
    "user": "https://github.com/vbraun"
}
```
Assignee: @aghitza

CC:  @novoselt

Keywords: sd31

The closure of the torus orbit associated to a cone of the fan is again a toric variety. This patch implements a method `toric_variety.orbit_closure(cone)` to construct this toric variety.

**Apply:**
1. [attachment:trac_11385_orbit_closure_as_toric_variety.patch]
2. [attachment:trac_11385_reviewer.patch]

Issue created by migration from https://trac.sagemath.org/ticket/11385





---

archive/issue_comments_123227.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-26T21:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123227",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_123228.json:
```json
{
    "body": "Um, I don't really understand the documentation of the first (private) function. Could you please expand/rewrite it a bit?-) In particular the INPUT section is a bit confusing given that there are two parameters and one of them is already called cone.\n\nAs a possible optimization\n\n```\nreturn ToricVariety(Fan(cones))\n```\ncan be replaced with\n\n```\nreturn ToricVariety(Fan(discard_faces(cones), check=False))\n```\nwhere `discard_faces` is added to the fan module by #11200.",
    "created_at": "2011-05-30T02:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123228",
    "user": "https://github.com/novoselt"
}
```

Um, I don't really understand the documentation of the first (private) function. Could you please expand/rewrite it a bit?-) In particular the INPUT section is a bit confusing given that there are two parameters and one of them is already called cone.

As a possible optimization

```
return ToricVariety(Fan(cones))
```
can be replaced with

```
return ToricVariety(Fan(discard_faces(cones), check=False))
```
where `discard_faces` is added to the fan module by #11200.



---

archive/issue_comments_123229.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-17T18:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123229",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_123230.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-17T18:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123230",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_123231.json:
```json
{
    "body": "Attachment [trac_11385_orbit_closure_as_toric_variety.patch](tarball://root/attachments/some-uuid/ticket11385/trac_11385_orbit_closure_as_toric_variety.patch) by @vbraun created at 2011-06-29 19:46:45\n\nUpdated patch",
    "created_at": "2011-06-29T19:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123231",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11385_orbit_closure_as_toric_variety.patch](tarball://root/attachments/some-uuid/ticket11385/trac_11385_orbit_closure_as_toric_variety.patch) by @vbraun created at 2011-06-29 19:46:45

Updated patch



---

archive/issue_comments_123232.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-29T19:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123232",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_123233.json:
```json
{
    "body": "I've added some documentation and a reference to [CLS].",
    "created_at": "2011-06-29T19:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123233",
    "user": "https://github.com/vbraun"
}
```

I've added some documentation and a reference to [CLS].



---

archive/issue_comments_123234.json:
```json
{
    "body": "Note that this is my first day in sage package reviewing, so take this with a grain of salt. However, I did manage to apply another patch correctly before this one.\n\nWhen I hg.apply() the patch, I get the following error :\n\n```\n hg_sage.apply(\"/home/simon/sage/devel/sage-test/patches/trac_11385_orbit_cl>\ncd \"/home/simon/sage/devel/sage\" && hg status\ncd \"/home/simon/sage/devel/sage\" && hg status\ncd \"/home/simon/sage/devel/sage\" && hg import   \"/home/simon/sage/devel/sage-test/patches/trac_11385_orbit_closure_as_toric_variety.patch\"\napplying /home/simon/sage/devel/sage-test/patches/trac_11385_orbit_closure_as_toric_variety.patch\ninternal patcher failed\nplease report details to http://mercurial.selenic.com/bts/\nor mercurial@selenic.com\n/home/simon/sage/local/bin/patch: **** Only garbage was found in the patch input.\nabort: patch command failed: exited with status 512\n```",
    "created_at": "2011-07-11T11:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123234",
    "user": "https://trac.sagemath.org/admin/accounts/users/SimonPL"
}
```

Note that this is my first day in sage package reviewing, so take this with a grain of salt. However, I did manage to apply another patch correctly before this one.

When I hg.apply() the patch, I get the following error :

```
 hg_sage.apply("/home/simon/sage/devel/sage-test/patches/trac_11385_orbit_cl>
cd "/home/simon/sage/devel/sage" && hg status
cd "/home/simon/sage/devel/sage" && hg status
cd "/home/simon/sage/devel/sage" && hg import   "/home/simon/sage/devel/sage-test/patches/trac_11385_orbit_closure_as_toric_variety.patch"
applying /home/simon/sage/devel/sage-test/patches/trac_11385_orbit_closure_as_toric_variety.patch
internal patcher failed
please report details to http://mercurial.selenic.com/bts/
or mercurial@selenic.com
/home/simon/sage/local/bin/patch: **** Only garbage was found in the patch input.
abort: patch command failed: exited with status 512
```



---

archive/issue_comments_123235.json:
```json
{
    "body": "Thanks for having a look! Instead of `apply`, its probably better to use `import_patch` like this:\n\n```\nsage: hg_sage.import_patch('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11385/trac_11385_orbit_closure_as_toric_variety.patch')\n```\nYou probably downloaded the html-formatted patch instead of the raw patch file.\n\nIf you want to get more serious about Sage development then you should read about mercurial queues, though. This is a much better way to handle multiple patches.",
    "created_at": "2011-07-11T12:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123235",
    "user": "https://github.com/vbraun"
}
```

Thanks for having a look! Instead of `apply`, its probably better to use `import_patch` like this:

```
sage: hg_sage.import_patch('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/11385/trac_11385_orbit_closure_as_toric_variety.patch')
```
You probably downloaded the html-formatted patch instead of the raw patch file.

If you want to get more serious about Sage development then you should read about mercurial queues, though. This is a much better way to handle multiple patches.



---

archive/issue_comments_123236.json:
```json
{
    "body": "For the record - I have not abandoned this patch ;-) I would be happier if the default was to construct the fan of the orbit closure in the honest quotient lattice. I suspect Volker has not done it this way because it just does not work. Well, I am trying to make it work, since it will be yet another step in the direction of the full support of quotients and sublattices. I think they should be freely usable everywhere where lattices can be used, because, well, they are lattices as well ;-)",
    "created_at": "2011-07-11T13:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123236",
    "user": "https://github.com/novoselt"
}
```

For the record - I have not abandoned this patch ;-) I would be happier if the default was to construct the fan of the orbit closure in the honest quotient lattice. I suspect Volker has not done it this way because it just does not work. Well, I am trying to make it work, since it will be yet another step in the direction of the full support of quotients and sublattices. I think they should be freely usable everywhere where lattices can be used, because, well, they are lattices as well ;-)



---

archive/issue_comments_123237.json:
```json
{
    "body": "Making it work properly with quotient lattices is a noble goal, of course.\n\nAnother question is where to put the method to restrict line bundles from the ambient to the orbit closure. Because of the quotient lattice it is not literally pull-back by a toric morphism. I tend to think that `ToricOrbitClosure` should derive from `ToricVariety` and add a `restrict_divisor()` method.\n\nThough as far as this ticket is concerned, I think we all agree that there should be a `.orbit_closure(cone)` method for toric varieties that returns a toric variety. So maybe we should merge this ticket before improving the presentation of the resulting toric variety.",
    "created_at": "2011-07-11T13:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123237",
    "user": "https://github.com/vbraun"
}
```

Making it work properly with quotient lattices is a noble goal, of course.

Another question is where to put the method to restrict line bundles from the ambient to the orbit closure. Because of the quotient lattice it is not literally pull-back by a toric morphism. I tend to think that `ToricOrbitClosure` should derive from `ToricVariety` and add a `restrict_divisor()` method.

Though as far as this ticket is concerned, I think we all agree that there should be a `.orbit_closure(cone)` method for toric varieties that returns a toric variety. So maybe we should merge this ticket before improving the presentation of the resulting toric variety.



---

archive/issue_events_029554.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-11T13:34:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11213#event-29554"
}
```



---

archive/issue_comments_123238.json:
```json
{
    "body": "Attachment [trac_11385_reviewer.patch](tarball://root/attachments/some-uuid/ticket11385/trac_11385_reviewer.patch) by @novoselt created at 2011-07-12 18:35:33\n\nIdeally the toric variety of the orbit closure should come with the canonical embedding, even though it does not come from a fan morphism. So I think it would be better to have the restriction directly in the toric variety class.\n\nThe attached patch contains bits of code that move us closer to supporting quotient lattices, so I propose to add them - I wrote them while making the commented code work. It still does not work for cones, so I agree to leave the rest of necessary changes for the future. I also changed the docstrings quite a bit, hopefully for the best ;-)\n\nIf you are OK with the new stuff, please switch to positive review.",
    "created_at": "2011-07-12T18:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123238",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_11385_reviewer.patch](tarball://root/attachments/some-uuid/ticket11385/trac_11385_reviewer.patch) by @novoselt created at 2011-07-12 18:35:33

Ideally the toric variety of the orbit closure should come with the canonical embedding, even though it does not come from a fan morphism. So I think it would be better to have the restriction directly in the toric variety class.

The attached patch contains bits of code that move us closer to supporting quotient lattices, so I propose to add them - I wrote them while making the commented code work. It still does not work for cones, so I agree to leave the rest of necessary changes for the future. I also changed the docstrings quite a bit, hopefully for the best ;-)

If you are OK with the new stuff, please switch to positive review.



---

archive/issue_comments_123239.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-11T21:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123239",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_123240.json:
```json
{
    "body": "looks good!",
    "created_at": "2011-08-11T21:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123240",
    "user": "https://github.com/vbraun"
}
```

looks good!



---

archive/issue_comments_123241.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T04:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11213#issuecomment-123241",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_events_029555.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:47:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11213#event-29555"
}
```
