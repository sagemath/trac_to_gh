# Issue 11979: Divided power algebras

archive/issues_011807.json:
```json
{
    "body": "The two attached files implement divided power algebra as a graded Hopf algebra and the quantum divided power algebra as a graded algebra. This is related to the ticket #11929 on quasisymmetric functions.\n\nI have read\n\nWalking Through the Development Process\n\nbut I am not clear on what the process is for me to submit these two files for review and inclusion in sage.\n\nI would also like to add an algebra homomorphism from symmetric functions to the quantum divided power algebra and would appreciate any pointers.\n\nAssignee: @jbandlow\n\nCC:  @tscrim @nthiery\n\nKeywords: divided powers\n\nAuthor: Bruce Westbury\n\nBranch: public/combinat/divided_power_alg\n\nStatus: needs_work\n\nCommit: 103a503427c2ad28a10dad60cad3646f86e4f18b\n\nIssue created by migration from https://trac.sagemath.org/ticket/11979\n\n",
    "created_at": "2011-11-02T11:06:40Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Divided power algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11979",
    "user": "https://github.com/BruceWestbury"
}
```
The two attached files implement divided power algebra as a graded Hopf algebra and the quantum divided power algebra as a graded algebra. This is related to the ticket #11929 on quasisymmetric functions.

I have read

Walking Through the Development Process

but I am not clear on what the process is for me to submit these two files for review and inclusion in sage.

I would also like to add an algebra homomorphism from symmetric functions to the quantum divided power algebra and would appreciate any pointers.

Assignee: @jbandlow

CC:  @tscrim @nthiery

Keywords: divided powers

Author: Bruce Westbury

Branch: public/combinat/divided_power_alg

Status: needs_work

Commit: 103a503427c2ad28a10dad60cad3646f86e4f18b

Issue created by migration from https://trac.sagemath.org/ticket/11979





---

archive/issue_comments_134780.json:
```json
{
    "body": "Attachment [quantumdividedpower.py](tarball://root/attachments/some-uuid/ticket11979/quantumdividedpower.py) by @BruceWestbury created at 2011-11-02 11:07:15",
    "created_at": "2011-11-02T11:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134780",
    "user": "https://github.com/BruceWestbury"
}
```

Attachment [quantumdividedpower.py](tarball://root/attachments/some-uuid/ticket11979/quantumdividedpower.py) by @BruceWestbury created at 2011-11-02 11:07:15



---

archive/issue_comments_134781.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134781",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_134782.json:
```json
{
    "body": "<a id='comment:2'></a>here is a patch for the first file. To be continued",
    "created_at": "2013-08-20T21:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134782",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>here is a patch for the first file. To be continued



---

archive/issue_events_031745.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2013-08-20T21:21:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31745"
}
```



---

archive/issue_comments_134783.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_11979_divided_power.patch](tarball://root/attachments/some-uuid/ticket11979/trac_11979_divided_power.patch) by @fchapoton created at 2013-08-21 07:44:31\n\nHere is a patch including both files",
    "created_at": "2013-08-21T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134783",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>Attachment [trac_11979_divided_power.patch](tarball://root/attachments/some-uuid/ticket11979/trac_11979_divided_power.patch) by @fchapoton created at 2013-08-21 07:44:31

Here is a patch including both files



---

archive/issue_comments_134784.json:
```json
{
    "body": "<a id='comment:4'></a>Here is a git branch\n\n---\nNew commits:",
    "created_at": "2014-01-29T09:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134784",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>Here is a git branch

---
New commits:



---

archive/issue_comments_134785.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-29T10:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134785",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_031746.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31746"
}
```



---

archive/issue_events_031747.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31747"
}
```



---

archive/issue_comments_134786.json:
```json
{
    "body": "<a id='comment:7'></a>Minor fixes made. Sorry, not a review. Don't have the time or skills for that (an example should highlight all that one needs to know about the respective categories; I'm not the right person to judge...).\n\nPlease note the branch change!\n\n---\nNew commits:",
    "created_at": "2014-03-07T05:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134786",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:7'></a>Minor fixes made. Sorry, not a review. Don't have the time or skills for that (an example should highlight all that one needs to know about the respective categories; I'm not the right person to judge...).

Please note the branch change!

---
New commits:



---

archive/issue_events_031748.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31748"
}
```



---

archive/issue_events_031749.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31749"
}
```



---

archive/issue_comments_134787.json:
```json
{
    "body": "<a id='comment:9'></a>patchbot:\n\n```\nsage -t --long src/sage/algebras/divided_power_algebra.py  # 1 doctest failed\n```",
    "created_at": "2014-05-11T06:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134787",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>patchbot:

```
sage -t --long src/sage/algebras/divided_power_algebra.py  # 1 doctest failed
```



---

archive/issue_comments_134788.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-11T06:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134788",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134789.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-11T12:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134790.json:
```json
{
    "body": "<a id='comment:11'></a>I have corrected the doctest, and also cleaned a little bit (up to pep8 standard).",
    "created_at": "2014-05-11T12:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134790",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I have corrected the doctest, and also cleaned a little bit (up to pep8 standard).



---

archive/issue_comments_134791.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-11T12:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134791",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_031750.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31750"
}
```



---

archive/issue_events_031751.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11979#event-31751"
}
```



---

archive/issue_comments_134792.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-29T06:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134793.json:
```json
{
    "body": "<a id='comment:14'></a>Reviewed the maths. This is a neat piece of example code that would be nice to have in sage, but someone else has to check if this is teaching good coding practices, if it is up to date, and if it isn't missing important parts (I don't see any coercions defined in the code, nor a dedicated `element_class`).",
    "created_at": "2014-10-29T06:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134793",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:14'></a>Reviewed the maths. This is a neat piece of example code that would be nice to have in sage, but someone else has to check if this is teaching good coding practices, if it is up to date, and if it isn't missing important parts (I don't see any coercions defined in the code, nor a dedicated `element_class`).



---

archive/issue_comments_134794.json:
```json
{
    "body": "<a id='comment:15'></a>Seems to need rebase.",
    "created_at": "2014-11-05T19:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134794",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>Seems to need rebase.



---

archive/issue_comments_134795.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-05T19:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134795",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134796.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-05T22:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134797.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-05T22:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134797",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_134798.json:
```json
{
    "body": "<a id='comment:18'></a>Actually these imports that caused the conflicts were probably temporary, made for easier testing. The examples in the doctests all begin with an import instruction, so I suspect these algebras were not supposed to be in the global scope. So I've removed them now. Was this a good idea?",
    "created_at": "2014-11-05T22:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134798",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:18'></a>Actually these imports that caused the conflicts were probably temporary, made for easier testing. The examples in the doctests all begin with an import instruction, so I suspect these algebras were not supposed to be in the global scope. So I've removed them now. Was this a good idea?



---

archive/issue_comments_134799.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-06T19:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134800.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-06T20:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134801.json:
```json
{
    "body": "<a id='comment:21'></a>I have gotten rid of all failing doctests, but there is a new one (I think, related to a doctest I added beforehand):\n\n```\nsage -t src/sage/algebras/divided_power_algebra.py\n**********************************************************************\nFile \"src/sage/algebras/divided_power_algebra.py\", line 171, in sage.algebras.divided_power_algebra.UnivariateDividedPowerAlgebra.product_on_basis\nFailed example:\n    B = UnivariateDividedPowerAlgebra(Zmod(5)).basis()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 851, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.algebras.divided_power_algebra.UnivariateDividedPowerAlgebra.product_on_basis[3]>\", line 1, in <module>\n        B = UnivariateDividedPowerAlgebra(Zmod(Integer(5))).basis()\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)\n      File \"sage/misc/cachefunc.pyx\", line 1290, in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.py\", line 1021, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 518, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/algebras/divided_power_algebra.py\", line 125, in __init__\n        GHWBR = GradedHopfAlgebrasWithBasis(R)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py\", line 112, in __classcall__\n        return base_category_class(category, *args).Graded()\n      File \"sage/misc/cachefunc.pyx\", line 1874, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:11291)\n      File \"sage/misc/cachefunc.pyx\", line 2490, in sage.misc.cachefunc.CachedMethod._instance_call (build/cythonized/sage/misc/cachefunc.c:14055)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/modules.py\", line 379, in Graded\n        return GradedModulesCategory.category_of(self)\n      File \"sage/misc/cachefunc.pyx\", line 936, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:4969)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py\", line 279, in category_of\n        return functor_category(category, *args)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py\", line 110, in __classcall__\n        return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 442, in __classcall__\n        return super(Category, cls).__classcall__(cls, *args, **options)\n      File \"sage/misc/cachefunc.pyx\", line 1290, in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.py\", line 1021, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 518, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py\", line 37, in __init__\n        super(GradedModulesCategory, self).__init__(base_category, base_category.base_ring())\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py\", line 304, in __init__\n        super(FunctorialConstructionCategory, self).__init__(*args)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py\", line 485, in __init__\n        Category_over_base.__init__(self, base, name)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py\", line 243, in __init__\n        Category.__init__(self, name)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 473, in __init__\n        (self.__class__, self.subcategory_class, ),\n      File \"sage/misc/lazy_attribute.pyx\", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1632, in subcategory_class\n        cache=False, picklable=False)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 2793, in _make_named_class\n        cache=cache, **options)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1588, in _make_named_class\n        tuple(getattr(cat,name) for cat in self._super_categories_for_classes),\n      File \"sage/misc/lazy_attribute.pyx\", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1029, in _super_categories_for_classes\n        self._all_super_categories\n      File \"sage/misc/lazy_attribute.pyx\", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 862, in _all_super_categories\n        for cat in self._super_categories] +\n      File \"sage/misc/lazy_attribute.pyx\", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1004, in _super_categories\n        return sorted(_flatten_categories(self.super_categories(),JoinCategory), key = category_sort_key, reverse=True)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py\", line 347, in super_categories\n        return Category.join([self.__class__.default_super_categories(self.base_category(), *self._args)] +\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py\", line 552, in default_super_categories\n        return Category.join([category, super(RegressiveCovariantConstructionCategory, cls).default_super_categories(category, *args)])\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py\", line 443, in default_super_categories\n        if hasattr(cat, cls._functor_category)])\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 2475, in join\n        result = join_as_tuple(cache_key, axioms, ignore_axioms)\n      File \"sage/categories/category_cy_helper.pyx\", line 117, in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:3145)\n      File \"sage/categories/category_cy_helper.pyx\", line 184, in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:2425)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1802, in is_subcategory\n        subcat_hook = c._subcategory_hook_(self)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py\", line 434, in _subcategory_hook_\n        if not issubclass(C.parent_class, self.parent_class):\n      File \"sage/misc/lazy_attribute.pyx\", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1677, in parent_class\n        return self._make_named_class('parent_class', 'ParentMethods')\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 2793, in _make_named_class\n        cache=cache, **options)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py\", line 1590, in _make_named_class\n        reduction = reduction, cache = cache)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py\", line 316, in dynamic_class\n        return dynamic_class_internal.f(name, bases, cls, reduction, doccls, prepend_cls_bases)\n      File \"/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py\", line 411, in dynamic_class_internal\n        return metaclass(name, bases, methods)\n    TypeError: Cannot create a consistent method resolution\n    order (MRO) for bases Bialgebras.parent_class, CoalgebrasWithBasis.parent_class, Algebras.parent_class\n**********************************************************************\n```\nI have no buggering idea what is going wrong here, but I've got a hunch that it might be the same issue as #15475.",
    "created_at": "2014-11-06T21:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134801",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:21'></a>I have gotten rid of all failing doctests, but there is a new one (I think, related to a doctest I added beforehand):

```
sage -t src/sage/algebras/divided_power_algebra.py
**********************************************************************
File "src/sage/algebras/divided_power_algebra.py", line 171, in sage.algebras.divided_power_algebra.UnivariateDividedPowerAlgebra.product_on_basis
Failed example:
    B = UnivariateDividedPowerAlgebra(Zmod(5)).basis()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 851, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.algebras.divided_power_algebra.UnivariateDividedPowerAlgebra.product_on_basis[3]>", line 1, in <module>
        B = UnivariateDividedPowerAlgebra(Zmod(Integer(5))).basis()
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)
      File "sage/misc/cachefunc.pyx", line 1290, in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.py", line 1021, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 518, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/algebras/divided_power_algebra.py", line 125, in __init__
        GHWBR = GradedHopfAlgebrasWithBasis(R)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py", line 112, in __classcall__
        return base_category_class(category, *args).Graded()
      File "sage/misc/cachefunc.pyx", line 1874, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:11291)
      File "sage/misc/cachefunc.pyx", line 2490, in sage.misc.cachefunc.CachedMethod._instance_call (build/cythonized/sage/misc/cachefunc.c:14055)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/modules.py", line 379, in Graded
        return GradedModulesCategory.category_of(self)
      File "sage/misc/cachefunc.pyx", line 936, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:4969)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py", line 279, in category_of
        return functor_category(category, *args)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py", line 110, in __classcall__
        return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 442, in __classcall__
        return super(Category, cls).__classcall__(cls, *args, **options)
      File "sage/misc/cachefunc.pyx", line 1290, in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.py", line 1021, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 518, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.py", line 37, in __init__
        super(GradedModulesCategory, self).__init__(base_category, base_category.base_ring())
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py", line 304, in __init__
        super(FunctorialConstructionCategory, self).__init__(*args)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py", line 485, in __init__
        Category_over_base.__init__(self, base, name)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py", line 243, in __init__
        Category.__init__(self, name)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 473, in __init__
        (self.__class__, self.subcategory_class, ),
      File "sage/misc/lazy_attribute.pyx", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1632, in subcategory_class
        cache=False, picklable=False)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 2793, in _make_named_class
        cache=cache, **options)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1588, in _make_named_class
        tuple(getattr(cat,name) for cat in self._super_categories_for_classes),
      File "sage/misc/lazy_attribute.pyx", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1029, in _super_categories_for_classes
        self._all_super_categories
      File "sage/misc/lazy_attribute.pyx", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 862, in _all_super_categories
        for cat in self._super_categories] +
      File "sage/misc/lazy_attribute.pyx", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1004, in _super_categories
        return sorted(_flatten_categories(self.super_categories(),JoinCategory), key = category_sort_key, reverse=True)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py", line 347, in super_categories
        return Category.join([self.__class__.default_super_categories(self.base_category(), *self._args)] +
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py", line 552, in default_super_categories
        return Category.join([category, super(RegressiveCovariantConstructionCategory, cls).default_super_categories(category, *args)])
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.py", line 443, in default_super_categories
        if hasattr(cat, cls._functor_category)])
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 2475, in join
        result = join_as_tuple(cache_key, axioms, ignore_axioms)
      File "sage/categories/category_cy_helper.pyx", line 117, in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:3145)
      File "sage/categories/category_cy_helper.pyx", line 184, in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:2425)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1802, in is_subcategory
        subcat_hook = c._subcategory_hook_(self)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.py", line 434, in _subcategory_hook_
        if not issubclass(C.parent_class, self.parent_class):
      File "sage/misc/lazy_attribute.pyx", line 127, in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1677, in parent_class
        return self._make_named_class('parent_class', 'ParentMethods')
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 2793, in _make_named_class
        cache=cache, **options)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py", line 1590, in _make_named_class
        reduction = reduction, cache = cache)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py", line 316, in dynamic_class
        return dynamic_class_internal.f(name, bases, cls, reduction, doccls, prepend_cls_bases)
      File "/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.py", line 411, in dynamic_class_internal
        return metaclass(name, bases, methods)
    TypeError: Cannot create a consistent method resolution
    order (MRO) for bases Bialgebras.parent_class, CoalgebrasWithBasis.parent_class, Algebras.parent_class
**********************************************************************
```
I have no buggering idea what is going wrong here, but I've got a hunch that it might be the same issue as #15475.



---

archive/issue_comments_134802.json:
```json
{
    "body": "<a id='comment:22'></a>Here is a minimal counterexample:\n\n```\ndarij@travis-virtualbox:~/gitsage$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.4.rc0, Release Date: 2014-10-30                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: from sage.algebras.divided_power_algebra import UnivariateDividedPowerAlgebra\nsage: A = UnivariateDividedPowerAlgebra(Zmod(9)); A\nThe divided power algebra over Ring of integers modulo 9\nsage: A = UnivariateDividedPowerAlgebra(Zmod(5)); A\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.hopf_algebras.HopfAlgebras_with_category'>\n  self.__class__))\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.hopf_algebras_with_basis.HopfAlgebrasWithBasis'>\n  self.__class__))\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.category.JoinCategory'>\n  self.__class__))\nException TypeError: 'Cannot create a consistent method resolution\\norder (MRO) for bases Bialgebras.parent_class, Algebras.parent_class, CoalgebrasWithBasis.parent_class' in 'sage.categories.category_cy_helper.is_supercategory_of_done' ignored\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-008c24a8840f> in <module>()\n----> 1 A = UnivariateDividedPowerAlgebra(Zmod(Integer(5))); A\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)\n   1019             True\n   1020         \"\"\"\n-> 1021         instance = typecall(cls, *args, **options)\n   1022         assert isinstance( instance, cls )\n   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/algebras/divided_power_algebra.pyc in __init__(self, R)\n    123         if not R in Rings():\n    124             raise ValueError('R is not a ring')\n--> 125         GHWBR = GradedHopfAlgebrasWithBasis(R)\n    126         CombinatorialFreeModule.__init__(self, R, NonNegativeIntegers(),\n    127                                          category=GHWBR)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __classcall__(cls, category, *args)\n    110             return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)\n    111         else:\n--> 112             return base_category_class(category, *args).Graded()\n    113 \n    114     def _repr_object_names(self):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:11291)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedMethod._instance_call (build/cythonized/sage/misc/cachefunc.c:14055)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/modules.pyc in Graded(self, base_ring)\n    377             assert base_ring is None or base_ring is self.base_ring()\n    378             from sage.categories.graded_modules import GradedModulesCategory\n--> 379             return GradedModulesCategory.category_of(self)\n    380 \n    381         @cached_method\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:4969)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in category_of(cls, category, *args)\n    277         functor_category = getattr(category.__class__, cls._functor_category)\n    278         if isinstance(functor_category, type) and issubclass(functor_category, Category):\n--> 279             return functor_category(category, *args)\n    280         else:\n    281             return cls.default_super_categories(category, *args)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __classcall__(cls, category, *args)\n    108         base_category_class = cls._base_category_class[0]\n    109         if isinstance(category, base_category_class):\n--> 110             return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)\n    111         else:\n    112             return base_category_class(category, *args).Graded()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in __classcall__(cls, *args, **options)\n    440         if isinstance(cls, DynamicMetaclass):\n    441             cls = cls.__base__\n--> 442         return super(Category, cls).__classcall__(cls, *args, **options)\n    443 \n    444     def __init__(self, s=None):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)\n   1019             True\n   1020         \"\"\"\n-> 1021         instance = typecall(cls, *args, **options)\n   1022         assert isinstance( instance, cls )\n   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __init__(self, base_category)\n     35             Rational Field\n     36         \"\"\"\n---> 37         super(GradedModulesCategory, self).__init__(base_category, base_category.base_ring())\n     38 \n     39     _functor_category = \"Graded\"\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in __init__(self, category, *args)\n    302         self._base_category = category\n    303         self._args = args\n--> 304         super(FunctorialConstructionCategory, self).__init__(*args)\n    305 \n    306     def base_category(self):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in __init__(self, base, name)\n    483                 isinstance(base, Category) and base.is_subcategory(Rings())):\n    484             raise ValueError(\"base must be a ring or a subcategory of Rings()\")\n--> 485         Category_over_base.__init__(self, base, name)\n    486 \n    487     def base_ring(self):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in __init__(self, base, name)\n    241         \"\"\"\n    242         self.__base = base\n--> 243         Category.__init__(self, name)\n    244 \n    245     def _test_category_over_bases(self, **options):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in __init__(self, s)\n    471         assert s is None\n    472         self.__class__ = dynamic_class(\"{}_with_category\".format(self.__class__.__name__),\n--> 473                                        (self.__class__, self.subcategory_class, ),\n    474                                        cache = False, reduction = None,\n    475                                        doccls=self.__class__)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in subcategory_class(self)\n   1630         \"\"\"\n   1631         return self._make_named_class('subcategory_class', 'SubcategoryMethods',\n-> 1632                                       cache=False, picklable=False)\n   1633 \n   1634     @lazy_attribute\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, **options)\n   2791             pass\n   2792         result = Category._make_named_class(self, name, method_provider,\n-> 2793                                             cache=cache, **options)\n   2794         self._make_named_class_cache[key] = result\n   2795         return result\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, picklable)\n   1586             reduction = None\n   1587         return dynamic_class(class_name,\n-> 1588                              tuple(getattr(cat,name) for cat in self._super_categories_for_classes),\n   1589                              method_provider_cls, prepend_cls_bases = False, doccls = doccls,\n   1590                              reduction = reduction, cache = cache)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _super_categories_for_classes(self)\n   1027             [Category of rngs, Category of semirings]\n   1028         \"\"\"\n-> 1029         self._all_super_categories\n   1030         return self._super_categories_for_classes\n   1031 \n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _all_super_categories(self)\n    860         \"\"\"\n    861         (result, bases) = C3_sorted_merge([cat._all_super_categories\n--> 862                                            for cat in self._super_categories] +\n    863                                           [self._super_categories],\n    864                                           category_sort_key)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _super_categories(self)\n   1002             [Category of rngs, Category of semirings]\n   1003         \"\"\"\n-> 1004         return sorted(_flatten_categories(self.super_categories(),JoinCategory), key = category_sort_key, reverse=True)\n   1005 \n   1006     @lazy_attribute\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in super_categories(self)\n    345             [Category of subquotients of semigroups, Category of quotients of sets]\n    346         \"\"\"\n--> 347         return Category.join([self.__class__.default_super_categories(self.base_category(), *self._args)] +\n    348                              self.extra_super_categories(),\n    349                              as_list = True)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in default_super_categories(cls, category, *args)\n    550             Category of unital subquotients of semigroups\n    551         \"\"\"\n--> 552         return Category.join([category, super(RegressiveCovariantConstructionCategory, cls).default_super_categories(category, *args)])\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in default_super_categories(cls, category, *args)\n    441         return Category.join([getattr(cat, cls._functor_category)(*args)\n    442                               for cat in category._super_categories\n--> 443                               if hasattr(cat, cls._functor_category)])\n    444 \n    445     def is_construction_defined_by_base(self):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in join(categories, as_list, ignore_axioms, axioms)\n   2473 \n   2474         # Handle axioms\n-> 2475         result = join_as_tuple(cache_key, axioms, ignore_axioms)\n   2476         if as_list:\n   2477             return list(result)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_cy_helper.so in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:3145)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_cy_helper.so in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:2425)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in is_subcategory(self, c)\n   1800         if c is self:\n   1801             return True\n-> 1802         subcat_hook = c._subcategory_hook_(self)\n   1803         if subcat_hook is Unknown:\n   1804             return c in self._set_of_super_categories\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in _subcategory_hook_(self, C)\n    432 \n    433         \"\"\"\n--> 434         if not issubclass(C.parent_class, self.parent_class):\n    435             return False\n    436         if not isinstance(C, Category_over_base):\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in parent_class(self)\n   1675         :class:`sage.categories.category.JoinCategory`.\n   1676         \"\"\"\n-> 1677         return self._make_named_class('parent_class', 'ParentMethods')\n   1678 \n   1679     @lazy_attribute\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, **options)\n   2791             pass\n   2792         result = Category._make_named_class(self, name, method_provider,\n-> 2793                                             cache=cache, **options)\n   2794         self._make_named_class_cache[key] = result\n   2795         return result\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, picklable)\n   1588                              tuple(getattr(cat,name) for cat in self._super_categories_for_classes),\n   1589                              method_provider_cls, prepend_cls_bases = False, doccls = doccls,\n-> 1590                              reduction = reduction, cache = cache)\n   1591 \n   1592 \n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.pyc in dynamic_class(name, bases, cls, reduction, doccls, prepend_cls_bases, cache)\n    314     elif cache is False:\n    315         # bypass the cached method\n--> 316         return dynamic_class_internal.f(name, bases, cls, reduction, doccls, prepend_cls_bases)\n    317     else: # cache = \"ignore_reduction\"\n    318         result = dynamic_class_internal(name, bases, cls, False, doccls, prepend_cls_bases)\n\n/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.pyc in dynamic_class_internal(name, bases, cls, reduction, doccls, prepend_cls_bases)\n    409         if isinstance(base, ClasscallMetaclass):\n    410             metaclass = DynamicClasscallMetaclass\n--> 411     return metaclass(name, bases, methods)\n    412 \n    413 class DynamicMetaclass(type):\n\nTypeError: Cannot create a consistent method resolution\norder (MRO) for bases Bialgebras.parent_class, Algebras.parent_class, CoalgebrasWithBasis.parent_class\nsage: \n```\nCompare with the following, which does not go wrong:\n\n```\ndarij@travis-virtualbox:~/gitsage$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.4.rc0, Release Date: 2014-10-30                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage:  from sage.algebras.divided_power_algebra import UnivariateDividedPowerAlgbra\nsage: A = UnivariateDividedPowerAlgebra(Zmod(5)); A\nThe divided power algebra over Ring of integers modulo 5\nsage: A = UnivariateDividedPowerAlgebra(Zmod(9)); A\nThe divided power algebra over Ring of integers modulo 9\nsage: \n```\n(It says rc0, but it is rc1 which I have only compiled with ./sage -br instead of make build to avoid building atlas again.)\n\nIt seems that the category refinement for the bialgebra category goes wrong when first applied over a ring and then over a field, but goes fine the other way roud.\n\n(No, this is not fixed by #17096.)",
    "created_at": "2014-11-06T21:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134802",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:22'></a>Here is a minimal counterexample:

```
darij@travis-virtualbox:~/gitsage$ ./sage

 Sage Version 6.4.rc0, Release Date: 2014-10-30                     
 Type "notebook()" for the browser-based notebook interface.        
 Type "help()" for help.                                            


 Warning: this is a prerelease version, and it may be unstable.     

sage: from sage.algebras.divided_power_algebra import UnivariateDividedPowerAlgebra
sage: A = UnivariateDividedPowerAlgebra(Zmod(9)); A
The divided power algebra over Ring of integers modulo 9
sage: A = UnivariateDividedPowerAlgebra(Zmod(5)); A
/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.hopf_algebras.HopfAlgebras_with_category'>
  self.__class__))
/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.hopf_algebras_with_basis.HopfAlgebrasWithBasis'>
  self.__class__))
/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.py:867: UserWarning: Inconsistent sorting results for all super categories of <class 'sage.categories.category.JoinCategory'>
  self.__class__))
Exception TypeError: 'Cannot create a consistent method resolution\norder (MRO) for bases Bialgebras.parent_class, Algebras.parent_class, CoalgebrasWithBasis.parent_class' in 'sage.categories.category_cy_helper.is_supercategory_of_done' ignored
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-008c24a8840f> in <module>()
----> 1 A = UnivariateDividedPowerAlgebra(Zmod(Integer(5))); A

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)
   1019             True
   1020         """
-> 1021         instance = typecall(cls, *args, **options)
   1022         assert isinstance( instance, cls )
   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/algebras/divided_power_algebra.pyc in __init__(self, R)
    123         if not R in Rings():
    124             raise ValueError('R is not a ring')
--> 125         GHWBR = GradedHopfAlgebrasWithBasis(R)
    126         CombinatorialFreeModule.__init__(self, R, NonNegativeIntegers(),
    127                                          category=GHWBR)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __classcall__(cls, category, *args)
    110             return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)
    111         else:
--> 112             return base_category_class(category, *args).Graded()
    113 
    114     def _repr_object_names(self):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:11291)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedMethod._instance_call (build/cythonized/sage/misc/cachefunc.c:14055)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/modules.pyc in Graded(self, base_ring)
    377             assert base_ring is None or base_ring is self.base_ring()
    378             from sage.categories.graded_modules import GradedModulesCategory
--> 379             return GradedModulesCategory.category_of(self)
    380 
    381         @cached_method

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:4969)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in category_of(cls, category, *args)
    277         functor_category = getattr(category.__class__, cls._functor_category)
    278         if isinstance(functor_category, type) and issubclass(functor_category, Category):
--> 279             return functor_category(category, *args)
    280         else:
    281             return cls.default_super_categories(category, *args)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1176)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __classcall__(cls, category, *args)
    108         base_category_class = cls._base_category_class[0]
    109         if isinstance(category, base_category_class):
--> 110             return super(GradedModulesCategory, cls).__classcall__(cls, category, *args)
    111         else:
    112             return base_category_class(category, *args).Graded()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in __classcall__(cls, *args, **options)
    440         if isinstance(cls, DynamicMetaclass):
    441             cls = cls.__base__
--> 442         return super(Category, cls).__classcall__(cls, *args, **options)
    443 
    444     def __init__(self, s=None):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.WeakCachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:8031)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/unique_representation.pyc in __classcall__(cls, *args, **options)
   1019             True
   1020         """
-> 1021         instance = typecall(cls, *args, **options)
   1022         assert isinstance( instance, cls )
   1023         if instance.__class__.__reduce__ == CachedRepresentation.__reduce__:

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:1603)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/graded_modules.pyc in __init__(self, base_category)
     35             Rational Field
     36         """
---> 37         super(GradedModulesCategory, self).__init__(base_category, base_category.base_ring())
     38 
     39     _functor_category = "Graded"

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in __init__(self, category, *args)
    302         self._base_category = category
    303         self._args = args
--> 304         super(FunctorialConstructionCategory, self).__init__(*args)
    305 
    306     def base_category(self):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in __init__(self, base, name)
    483                 isinstance(base, Category) and base.is_subcategory(Rings())):
    484             raise ValueError("base must be a ring or a subcategory of Rings()")
--> 485         Category_over_base.__init__(self, base, name)
    486 
    487     def base_ring(self):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in __init__(self, base, name)
    241         """
    242         self.__base = base
--> 243         Category.__init__(self, name)
    244 
    245     def _test_category_over_bases(self, **options):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in __init__(self, s)
    471         assert s is None
    472         self.__class__ = dynamic_class("{}_with_category".format(self.__class__.__name__),
--> 473                                        (self.__class__, self.subcategory_class, ),
    474                                        cache = False, reduction = None,
    475                                        doccls=self.__class__)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in subcategory_class(self)
   1630         """
   1631         return self._make_named_class('subcategory_class', 'SubcategoryMethods',
-> 1632                                       cache=False, picklable=False)
   1633 
   1634     @lazy_attribute

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, **options)
   2791             pass
   2792         result = Category._make_named_class(self, name, method_provider,
-> 2793                                             cache=cache, **options)
   2794         self._make_named_class_cache[key] = result
   2795         return result

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, picklable)
   1586             reduction = None
   1587         return dynamic_class(class_name,
-> 1588                              tuple(getattr(cat,name) for cat in self._super_categories_for_classes),
   1589                              method_provider_cls, prepend_cls_bases = False, doccls = doccls,
   1590                              reduction = reduction, cache = cache)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _super_categories_for_classes(self)
   1027             [Category of rngs, Category of semirings]
   1028         """
-> 1029         self._all_super_categories
   1030         return self._super_categories_for_classes
   1031 

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _all_super_categories(self)
    860         """
    861         (result, bases) = C3_sorted_merge([cat._all_super_categories
--> 862                                            for cat in self._super_categories] +
    863                                           [self._super_categories],
    864                                           category_sort_key)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _super_categories(self)
   1002             [Category of rngs, Category of semirings]
   1003         """
-> 1004         return sorted(_flatten_categories(self.super_categories(),JoinCategory), key = category_sort_key, reverse=True)
   1005 
   1006     @lazy_attribute

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in super_categories(self)
    345             [Category of subquotients of semigroups, Category of quotients of sets]
    346         """
--> 347         return Category.join([self.__class__.default_super_categories(self.base_category(), *self._args)] +
    348                              self.extra_super_categories(),
    349                              as_list = True)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in default_super_categories(cls, category, *args)
    550             Category of unital subquotients of semigroups
    551         """
--> 552         return Category.join([category, super(RegressiveCovariantConstructionCategory, cls).default_super_categories(category, *args)])

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/covariant_functorial_construction.pyc in default_super_categories(cls, category, *args)
    441         return Category.join([getattr(cat, cls._functor_category)(*args)
    442                               for cat in category._super_categories
--> 443                               if hasattr(cat, cls._functor_category)])
    444 
    445     def is_construction_defined_by_base(self):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in join(categories, as_list, ignore_axioms, axioms)
   2473 
   2474         # Handle axioms
-> 2475         result = join_as_tuple(cache_key, axioms, ignore_axioms)
   2476         if as_list:
   2477             return list(result)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_cy_helper.so in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:3145)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_cy_helper.so in sage.categories.category_cy_helper.join_as_tuple (build/cythonized/sage/categories/category_cy_helper.c:2425)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in is_subcategory(self, c)
   1800         if c is self:
   1801             return True
-> 1802         subcat_hook = c._subcategory_hook_(self)
   1803         if subcat_hook is Unknown:
   1804             return c in self._set_of_super_categories

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category_types.pyc in _subcategory_hook_(self, C)
    432 
    433         """
--> 434         if not issubclass(C.parent_class, self.parent_class):
    435             return False
    436         if not isinstance(C, Category_over_base):

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/misc/lazy_attribute.so in sage.misc.lazy_attribute._lazy_attribute.__get__ (build/cythonized/sage/misc/lazy_attribute.c:1276)()

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in parent_class(self)
   1675         :class:`sage.categories.category.JoinCategory`.
   1676         """
-> 1677         return self._make_named_class('parent_class', 'ParentMethods')
   1678 
   1679     @lazy_attribute

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, **options)
   2791             pass
   2792         result = Category._make_named_class(self, name, method_provider,
-> 2793                                             cache=cache, **options)
   2794         self._make_named_class_cache[key] = result
   2795         return result

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/categories/category.pyc in _make_named_class(self, name, method_provider, cache, picklable)
   1588                              tuple(getattr(cat,name) for cat in self._super_categories_for_classes),
   1589                              method_provider_cls, prepend_cls_bases = False, doccls = doccls,
-> 1590                              reduction = reduction, cache = cache)
   1591 
   1592 

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.pyc in dynamic_class(name, bases, cls, reduction, doccls, prepend_cls_bases, cache)
    314     elif cache is False:
    315         # bypass the cached method
--> 316         return dynamic_class_internal.f(name, bases, cls, reduction, doccls, prepend_cls_bases)
    317     else: # cache = "ignore_reduction"
    318         result = dynamic_class_internal(name, bases, cls, False, doccls, prepend_cls_bases)

/home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/structure/dynamic_class.pyc in dynamic_class_internal(name, bases, cls, reduction, doccls, prepend_cls_bases)
    409         if isinstance(base, ClasscallMetaclass):
    410             metaclass = DynamicClasscallMetaclass
--> 411     return metaclass(name, bases, methods)
    412 
    413 class DynamicMetaclass(type):

TypeError: Cannot create a consistent method resolution
order (MRO) for bases Bialgebras.parent_class, Algebras.parent_class, CoalgebrasWithBasis.parent_class
sage: 
```
Compare with the following, which does not go wrong:

```
darij@travis-virtualbox:~/gitsage$ ./sage

 Sage Version 6.4.rc0, Release Date: 2014-10-30                     
 Type "notebook()" for the browser-based notebook interface.        
 Type "help()" for help.                                            


 Warning: this is a prerelease version, and it may be unstable.     

sage:  from sage.algebras.divided_power_algebra import UnivariateDividedPowerAlgbra
sage: A = UnivariateDividedPowerAlgebra(Zmod(5)); A
The divided power algebra over Ring of integers modulo 5
sage: A = UnivariateDividedPowerAlgebra(Zmod(9)); A
The divided power algebra over Ring of integers modulo 9
sage: 
```
(It says rc0, but it is rc1 which I have only compiled with ./sage -br instead of make build to avoid building atlas again.)

It seems that the category refinement for the bialgebra category goes wrong when first applied over a ring and then over a field, but goes fine the other way roud.

(No, this is not fixed by #17096.)



---

archive/issue_comments_134803.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-05T05:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134803",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134804.json:
```json
{
    "body": "<a id='comment:23'></a>Looks like there are some failed tests and triggered deprecation warnings...",
    "created_at": "2017-02-05T05:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11979#issuecomment-134804",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:23'></a>Looks like there are some failed tests and triggered deprecation warnings...
